<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 24439:0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d" />
<meta property="og:url" content="/comm-central/rev/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d" />
<meta property="og:description" content="Bug 1477478 - Remove listboxes from event attendees dialog. r=philipp" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d">shortlog</a> |
<a href="/comm-central/log/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d">files</a> |
changeset |
<a href="/comm-central/raw-rev/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d">raw</a>  | <a href="/comm-central/archive/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1477478">Bug 1477478</a> - Remove listboxes from event attendees dialog. r=philipp
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 03 Aug 2018 11:47:46 +1200</td></tr>

<tr>
 <td>changeset 24439</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d">0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d</a></td>
</tr>



<tr>
<td>parent 24438</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b3975c8d27c10bfad83b9af956fea2bb43045b1a">b3975c8d27c10bfad83b9af956fea2bb43045b1a</a>
</td>
</tr>

<tr>
<td>child 24440</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2f38cf81ace350134ae9fa2902499bd5bba2923b">2f38cf81ace350134ae9fa2902499bd5bba2923b</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d">14706</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 06 Aug 2018 06:25:16 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@2f38cf81ace3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2f38cf81ace350134ae9fa2902499bd5bba2923b">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2f38cf81ace350134ae9fa2902499bd5bba2923b&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2f38cf81ace350134ae9fa2902499bd5bba2923b&newProject=comm-central&newRevision=b3975c8d27c10bfad83b9af956fea2bb43045b1a&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2f38cf81ace350134ae9fa2902499bd5bba2923b&newProject=comm-central&newRevision=b3975c8d27c10bfad83b9af956fea2bb43045b1a&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2f38cf81ace350134ae9fa2902499bd5bba2923b&newProject=comm-central&newRevision=b3975c8d27c10bfad83b9af956fea2bb43045b1a&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28philipp%29&revcount=50">philipp</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1477478">1477478</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1477478">Bug 1477478</a> - Remove listboxes from event attendees dialog. r=philipp</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">calendar/base/content/dialogs/calendar-event-dialog-attendees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">file</a> |
<a href="/comm-central/annotate/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">annotate</a> |
<a href="/comm-central/diff/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">diff</a> |
<a href="/comm-central/comparison/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">comparison</a> |
<a href="/comm-central/log/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xul">calendar/base/content/dialogs/calendar-event-dialog-attendees.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xul">file</a> |
<a href="/comm-central/annotate/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xul">annotate</a> |
<a href="/comm-central/diff/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xul">diff</a> |
<a href="/comm-central/comparison/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xul">comparison</a> |
<a href="/comm-central/log/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-attendees.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">file</a> |
<a href="/comm-central/annotate/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">annotate</a> |
<a href="/comm-central/diff/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">diff</a> |
<a href="/comm-central/comparison/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">comparison</a> |
<a href="/comm-central/log/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/themes/common/dialogs/calendar-event-dialog.css">calendar/base/themes/common/dialogs/calendar-event-dialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/themes/common/dialogs/calendar-event-dialog.css">file</a> |
<a href="/comm-central/annotate/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/themes/common/dialogs/calendar-event-dialog.css">annotate</a> |
<a href="/comm-central/diff/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/themes/common/dialogs/calendar-event-dialog.css">diff</a> |
<a href="/comm-central/comparison/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/themes/common/dialogs/calendar-event-dialog.css">comparison</a> |
<a href="/comm-central/log/0b7261b6e5e50e5b46eeaec8b7bca1a5310c0f1d/calendar/base/themes/common/dialogs/calendar-event-dialog.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -84,33 +84,16 @@ function onLoad() {</span>
<a href="#l1.4"></a><span id="l1.4">     }</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">     loadDateTime(startTime, endTime);</span>
<a href="#l1.7"></a><span id="l1.7">     propagateDateTime();</span>
<a href="#l1.8"></a><span id="l1.8">     // Set the scroll bar at where the event is</span>
<a href="#l1.9"></a><span id="l1.9">     scrollToCurrentTime();</span>
<a href="#l1.10"></a><span id="l1.10">     updateButtons();</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    // we need to enforce several layout constraints which can't be modelled</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-    // with plain xul and css, at least as far as i know.</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-    const kStylesheet = &quot;chrome://calendar/skin/calendar-event-dialog.css&quot;;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-    for (let stylesheet of document.styleSheets) {</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-        if (stylesheet.href == kStylesheet) {</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-            // make the dummy-spacer #1 [top] the same height as the timebar</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-            let timebar = document.getElementById(&quot;timebar&quot;);</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-            stylesheet.insertRule(&quot;.attendee-spacer-top { height: &quot; +</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-                                  timebar.boxObject.height + &quot;px; }&quot;, 0);</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-            // make the dummy-spacer #2 [bottom] the same height as the scrollbar</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-            let scrollbar = document.getElementById(&quot;horizontal-scrollbar&quot;);</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-            stylesheet.insertRule(&quot;.attendee-spacer-bottom { height: &quot; +</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-                                  scrollbar.boxObject.height + &quot;px; }&quot;, 0);</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-            break;</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-        }</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-    }</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-</span>
<a href="#l1.29"></a><span id="l1.29">     // attach an observer to get notified of changes</span>
<a href="#l1.30"></a><span id="l1.30">     // that are relevant to this dialog.</span>
<a href="#l1.31"></a><span id="l1.31">     let prefObserver = {</span>
<a href="#l1.32"></a><span id="l1.32">         observe: function(aSubject, aTopic, aPrefName) {</span>
<a href="#l1.33"></a><span id="l1.33">             switch (aPrefName) {</span>
<a href="#l1.34"></a><span id="l1.34">                 case &quot;calendar.view.daystarthour&quot;:</span>
<a href="#l1.35"></a><span id="l1.35">                 case &quot;calendar.view.dayendhour&quot;:</span>
<a href="#l1.36"></a><span id="l1.36">                     initTimeRange();</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineat">@@ -936,19 +919,24 @@ function onAttrModified(event) {</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39"> /**</span>
<a href="#l1.40"></a><span id="l1.40">  * Handler function for initializing the selection bar, event usually emitted</span>
<a href="#l1.41"></a><span id="l1.41">  * from the freebusy-timebar binding.</span>
<a href="#l1.42"></a><span id="l1.42">  *</span>
<a href="#l1.43"></a><span id="l1.43">  * @param event     The &quot;timebar&quot; event with details and height property.</span>
<a href="#l1.44"></a><span id="l1.44">  */</span>
<a href="#l1.45"></a><span id="l1.45"> function onTimebar(event) {</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-    document.getElementById(</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-        &quot;selection-bar&quot;)</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-            .init(event.details, event.height);</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+    document.getElementById(&quot;selection-bar&quot;).init(event.details, event.height);</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+    // we need to enforce several layout constraints which can't be modelled</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+    // with plain xul and css, at least as far as i know.</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+    let timebar = document.getElementById(&quot;timebar&quot;);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+    let scrollbar = document.getElementById(&quot;horizontal-scrollbar&quot;);</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+    document.documentElement.style.setProperty(&quot;--spacer-top-height&quot;, timebar.boxObject.height + &quot;px&quot;);</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+    document.documentElement.style.setProperty(&quot;--spacer-bottom-height&quot;, scrollbar.boxObject.height + &quot;px&quot;);</span>
<a href="#l1.57"></a><span id="l1.57"> }</span>
<a href="#l1.58"></a><span id="l1.58"> </span>
<a href="#l1.59"></a><span id="l1.59"> /**</span>
<a href="#l1.60"></a><span id="l1.60">  * Handler function to update controls when the time has changed on the</span>
<a href="#l1.61"></a><span id="l1.61">  * selection bar.</span>
<a href="#l1.62"></a><span id="l1.62">  *</span>
<a href="#l1.63"></a><span id="l1.63">  * @param event     The &quot;timechange&quot; event with startDate and endDate</span>
<a href="#l1.64"></a><span id="l1.64">  *                    properties.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -7,64 +7,22 @@</span>
<a href="#l2.4"></a><span id="l2.4">   &lt;!ENTITY % dtd1 SYSTEM &quot;chrome://calendar/locale/global.dtd&quot; &gt; %dtd1;</span>
<a href="#l2.5"></a><span id="l2.5">   &lt;!ENTITY % dtd2 SYSTEM &quot;chrome://calendar/locale/calendar.dtd&quot; &gt; %dtd2;</span>
<a href="#l2.6"></a><span id="l2.6">   &lt;!ENTITY % dtd3 SYSTEM &quot;chrome://calendar/locale/calendar-event-dialog.dtd&quot;&gt; %dtd3;</span>
<a href="#l2.7"></a><span id="l2.7"> ]&gt;</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> &lt;bindings xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l2.10"></a><span id="l2.10">           xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l2.11"></a><span id="l2.11">           xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  &lt;binding id=&quot;attendees-list&quot;&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-      &lt;xul:listbox anonid=&quot;listbox&quot;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-                   seltype=&quot;multiple&quot;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-                   class=&quot;listbox-noborder&quot;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-                   rows=&quot;-1&quot;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-                   flex=&quot;1&quot;&gt;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-        &lt;xul:listcols&gt;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-          &lt;xul:listcol/&gt;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-          &lt;xul:listcol/&gt;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-          &lt;xul:listcol flex=&quot;1&quot;/&gt;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-        &lt;/xul:listcols&gt;</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-        &lt;xul:listitem anonid=&quot;item&quot; class=&quot;addressingWidgetItem&quot; allowevents=&quot;true&quot;&gt;</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-          &lt;xul:listcell class=&quot;addressingWidgetCell&quot; align=&quot;center&quot; pack=&quot;center&quot;&gt;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-            &lt;xul:image id=&quot;attendeeCol1#1&quot; anonid=&quot;rolestatus-icon&quot;/&gt;</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">-          &lt;/xul:listcell&gt;</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">-          &lt;xul:listcell class=&quot;addressingWidgetCell&quot;&gt;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineminus">-              &lt;xul:image id=&quot;attendeeCol2#1&quot; anonid=&quot;usertype-icon&quot; class=&quot;usertype-icon&quot; onclick=&quot;this.parentNode.select();&quot;/&gt;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-          &lt;/xul:listcell&gt;</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-          &lt;xul:listcell class=&quot;addressingWidgetCell&quot;&gt;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-            &lt;xul:textbox id=&quot;attendeeCol3#1&quot;</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-                         anonid=&quot;input&quot;</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-                         class=&quot;plain textbox-addressingWidget uri-element&quot;</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-                         type=&quot;autocomplete&quot;</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-                         flex=&quot;1&quot;</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-                         autocompletesearch=&quot;addrbook ldap&quot;</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-                         autocompletesearchparam=&quot;{}&quot;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-                         timeout=&quot;300&quot;</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-                         maxrows=&quot;4&quot;</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-                         completedefaultindex=&quot;true&quot;</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-                         forcecomplete=&quot;true&quot;</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-                         completeselectedindex=&quot;true&quot;</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-                         minresultsforpopup=&quot;1&quot;</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineminus">-                         onblur=&quot;if (this.localName == 'textbox') document.getBindingParent(this).returnHit(this, true)&quot;</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineminus">-                         ignoreblurwhilesearching=&quot;true&quot;</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-                         oninput=&quot;this.setAttribute('dirty', 'true');&quot;</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-                         ontextentered=&quot;document.getBindingParent(this).returnHit(this);&quot;&gt;</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-            &lt;/xul:textbox&gt;</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-          &lt;/xul:listcell&gt;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-        &lt;/xul:listitem&gt;</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-      &lt;/xul:listbox&gt;</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+  &lt;binding id=&quot;attendees-list&quot; extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistbox&quot;&gt;</span>
<a href="#l2.56"></a><span id="l2.56">     &lt;implementation&gt;</span>
<a href="#l2.57"></a><span id="l2.57">       &lt;field name=&quot;mMaxAttendees&quot;&gt;0&lt;/field&gt;</span>
<a href="#l2.58"></a><span id="l2.58">       &lt;field name=&quot;mContentHeight&quot;&gt;0&lt;/field&gt;</span>
<a href="#l2.59"></a><span id="l2.59">       &lt;field name=&quot;mRowHeight&quot;&gt;0&lt;/field&gt;</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-      &lt;field name=&quot;mNumColumns&quot;&gt;0&lt;/field&gt;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+      &lt;field name=&quot;mNumColumns&quot;&gt;3&lt;/field&gt;</span>
<a href="#l2.62"></a><span id="l2.62">       &lt;field name=&quot;mIsOffline&quot;&gt;0&lt;/field&gt;</span>
<a href="#l2.63"></a><span id="l2.63">       &lt;field name=&quot;mIsReadOnly&quot;&gt;false&lt;/field&gt;</span>
<a href="#l2.64"></a><span id="l2.64">       &lt;field name=&quot;mIsInvitation&quot;&gt;false&lt;/field&gt;</span>
<a href="#l2.65"></a><span id="l2.65">       &lt;field name=&quot;mPopupOpen&quot;&gt;false&lt;/field&gt;</span>
<a href="#l2.66"></a><span id="l2.66"> </span>
<a href="#l2.67"></a><span id="l2.67">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l2.68"></a><span id="l2.68">           ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l2.69"></a><span id="l2.69">           ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineat">@@ -104,26 +62,21 @@</span>
<a href="#l2.71"></a><span id="l2.71">             // does not support the concept of identities].</span>
<a href="#l2.72"></a><span id="l2.72">             let organizerID = ((organizer &amp;&amp; organizer.id)</span>
<a href="#l2.73"></a><span id="l2.73">                                ? organizer.id</span>
<a href="#l2.74"></a><span id="l2.74">                                : calendar.getProperty(&quot;organizerId&quot;));</span>
<a href="#l2.75"></a><span id="l2.75"> </span>
<a href="#l2.76"></a><span id="l2.76">             calendar = cal.wrapInstance(calendar, Components.interfaces.calISchedulingSupport);</span>
<a href="#l2.77"></a><span id="l2.77">             this.mIsInvitation = (calendar &amp;&amp; calendar.isInvitation(args.item));</span>
<a href="#l2.78"></a><span id="l2.78"> </span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-            let listbox =</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-            let template =</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;item&quot;);</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+            let template = this.querySelector(&quot;.addressingWidgetItem&quot;);</span>
<a href="#l2.86"></a><span id="l2.86">             template.focus();</span>
<a href="#l2.87"></a><span id="l2.87"> </span>
<a href="#l2.88"></a><span id="l2.88">             if (this.mIsReadOnly || this.mIsInvitation) {</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-                listbox.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+                this.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l2.91"></a><span id="l2.91">             }</span>
<a href="#l2.92"></a><span id="l2.92"> </span>
<a href="#l2.93"></a><span id="l2.93">             // TODO: the organizer should show up in the attendee list, but this information</span>
<a href="#l2.94"></a><span id="l2.94">             // should be based on the organizer contained in the appropriate field of calIItemBase.</span>
<a href="#l2.95"></a><span id="l2.95">             // This is currently not supported, since we're still missing calendar identities.</span>
<a href="#l2.96"></a><span id="l2.96">             if (organizerID &amp;&amp; organizerID != &quot;&quot;) {</span>
<a href="#l2.97"></a><span id="l2.97">                 if (organizer) {</span>
<a href="#l2.98"></a><span id="l2.98">                     if (!organizer.id) {</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineat">@@ -140,59 +93,52 @@</span>
<a href="#l2.100"></a><span id="l2.100">                     organizer.id = organizerID;</span>
<a href="#l2.101"></a><span id="l2.101">                     organizer.role = &quot;CHAIR&quot;;</span>
<a href="#l2.102"></a><span id="l2.102">                     organizer.participationStatus = &quot;ACCEPTED&quot;;</span>
<a href="#l2.103"></a><span id="l2.103">                 }</span>
<a href="#l2.104"></a><span id="l2.104">                 if (!organizer.commonName || !organizer.commonName.length) {</span>
<a href="#l2.105"></a><span id="l2.105">                     organizer.commonName = calendar.getProperty(&quot;organizerCN&quot;);</span>
<a href="#l2.106"></a><span id="l2.106">                 }</span>
<a href="#l2.107"></a><span id="l2.107">                 organizer.isOrganizer = true;</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineminus">-                this.appendAttendee(organizer, listbox, template, true);</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineplus">+                this.appendAttendee(organizer, template, true);</span>
<a href="#l2.110"></a><span id="l2.110">             }</span>
<a href="#l2.111"></a><span id="l2.111"> </span>
<a href="#l2.112"></a><span id="l2.112">             let numRowsAdded = 0;</span>
<a href="#l2.113"></a><span id="l2.113">             if (attendees.length &gt; 0) {</span>
<a href="#l2.114"></a><span id="l2.114">                 for (let attendee of attendees) {</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineminus">-                    this.appendAttendee(attendee, listbox, template, false);</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+                    this.appendAttendee(attendee, template, false);</span>
<a href="#l2.117"></a><span id="l2.117">                     numRowsAdded++;</span>
<a href="#l2.118"></a><span id="l2.118">                 }</span>
<a href="#l2.119"></a><span id="l2.119">             }</span>
<a href="#l2.120"></a><span id="l2.120">             if (numRowsAdded == 0) {</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-                this.appendAttendee(null, listbox, template, false);</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineplus">+                this.appendAttendee(null, template, false);</span>
<a href="#l2.123"></a><span id="l2.123">             }</span>
<a href="#l2.124"></a><span id="l2.124"> </span>
<a href="#l2.125"></a><span id="l2.125">             // detach the template item from the listbox, but hold the reference.</span>
<a href="#l2.126"></a><span id="l2.126">             // until this function returns we add at least a single copy of this template back again.</span>
<a href="#l2.127"></a><span id="l2.127">             template.remove();</span>
<a href="#l2.128"></a><span id="l2.128"> </span>
<a href="#l2.129"></a><span id="l2.129">             this.setFocus(this.mMaxAttendees);</span>
<a href="#l2.130"></a><span id="l2.130">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.131"></a><span id="l2.131">       &lt;/method&gt;</span>
<a href="#l2.132"></a><span id="l2.132"> </span>
<a href="#l2.133"></a><span id="l2.133">       &lt;!-- appends a new row using an existing attendee structure --&gt;</span>
<a href="#l2.134"></a><span id="l2.134">       &lt;method name=&quot;appendAttendee&quot;&gt;</span>
<a href="#l2.135"></a><span id="l2.135">         &lt;parameter name=&quot;aAttendee&quot;/&gt;</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineminus">-        &lt;parameter name=&quot;aParentNode&quot;/&gt;</span>
<a href="#l2.137"></a><span id="l2.137">         &lt;parameter name=&quot;aTemplateNode&quot;/&gt;</span>
<a href="#l2.138"></a><span id="l2.138">         &lt;parameter name=&quot;aDisableIfOrganizer&quot;/&gt;</span>
<a href="#l2.139"></a><span id="l2.139">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.140"></a><span id="l2.140">             // create a new listbox item and append it to our parent control.</span>
<a href="#l2.141"></a><span id="l2.141">             let newNode = aTemplateNode.cloneNode(true);</span>
<a href="#l2.142"></a><span id="l2.142"> </span>
<a href="#l2.143"></a><span id="l2.143" class="difflineminus">-            aParentNode.appendChild(newNode);</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineplus">+            this.appendChild(newNode);</span>
<a href="#l2.145"></a><span id="l2.145"> </span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-            let input =</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineminus">-                    newNode, &quot;anonid&quot;, &quot;input&quot;);</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-            let roleStatusIcon =</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineminus">-                    newNode, &quot;anonid&quot;, &quot;rolestatus-icon&quot;);</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineminus">-            let userTypeIcon =</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineminus">-                    newNode, &quot;anonid&quot;, &quot;usertype-icon&quot;);</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineplus">+            let input = newNode.querySelector(&quot;.textbox-addressingWidget&quot;);</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineplus">+            let roleStatusIcon = newNode.querySelector(&quot;.status-icon&quot;);</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineplus">+            let userTypeIcon = newNode.querySelector(&quot;.usertype-icon&quot;);</span>
<a href="#l2.158"></a><span id="l2.158"> </span>
<a href="#l2.159"></a><span id="l2.159">             // We always clone the first row. The problem is that the first row</span>
<a href="#l2.160"></a><span id="l2.160">             // could be focused. When we clone that row, we end up with a cloned</span>
<a href="#l2.161"></a><span id="l2.161">             // XUL textbox that has a focused attribute set.  Therefore we think</span>
<a href="#l2.162"></a><span id="l2.162">             // we're focused and don't properly refocus.  The best solution to this</span>
<a href="#l2.163"></a><span id="l2.163">             // would be to clone a template row that didn't really have any presentation,</span>
<a href="#l2.164"></a><span id="l2.164">             // rather than using the real visible first row of the listbox.</span>
<a href="#l2.165"></a><span id="l2.165">             // For now we'll just put in a hack that ensures the focused attribute</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineat">@@ -215,22 +161,16 @@</span>
<a href="#l2.167"></a><span id="l2.167"> </span>
<a href="#l2.168"></a><span id="l2.168">             // disable the input-field [name &lt;email&gt;] if this attendee</span>
<a href="#l2.169"></a><span id="l2.169">             // appears to be the organizer.</span>
<a href="#l2.170"></a><span id="l2.170">             if (aDisableIfOrganizer &amp;&amp; aAttendee &amp;&amp; aAttendee.isOrganizer) {</span>
<a href="#l2.171"></a><span id="l2.171">                 input.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l2.172"></a><span id="l2.172">             }</span>
<a href="#l2.173"></a><span id="l2.173"> </span>
<a href="#l2.174"></a><span id="l2.174">             this.mMaxAttendees++;</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineminus">-            let rowNumber = this.mMaxAttendees;</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineminus">-            if (rowNumber &gt;= 0) {</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineminus">-                roleStatusIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol1#&quot; + rowNumber);</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineminus">-                userTypeIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol2#&quot; + rowNumber);</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineminus">-                input.setAttribute(&quot;id&quot;, &quot;attendeeCol3#&quot; + rowNumber);</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineminus">-            }</span>
<a href="#l2.181"></a><span id="l2.181"> </span>
<a href="#l2.182"></a><span id="l2.182">             if (!aAttendee) {</span>
<a href="#l2.183"></a><span id="l2.183">                 aAttendee = this.createAttendee();</span>
<a href="#l2.184"></a><span id="l2.184">             }</span>
<a href="#l2.185"></a><span id="l2.185"> </span>
<a href="#l2.186"></a><span id="l2.186">             // construct the display string from common name and/or email address.</span>
<a href="#l2.187"></a><span id="l2.187">             let commonName = aAttendee.commonName || &quot;&quot;;</span>
<a href="#l2.188"></a><span id="l2.188">             let inputValue = cal.email.removeMailTo(aAttendee.id || &quot;&quot;);</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineat">@@ -274,64 +214,49 @@</span>
<a href="#l2.190"></a><span id="l2.190">             return true;</span>
<a href="#l2.191"></a><span id="l2.191">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.192"></a><span id="l2.192">       &lt;/method&gt;</span>
<a href="#l2.193"></a><span id="l2.193"> </span>
<a href="#l2.194"></a><span id="l2.194">       &lt;method name=&quot;appendNewRow&quot;&gt;</span>
<a href="#l2.195"></a><span id="l2.195">         &lt;parameter name=&quot;aSetFocus&quot;/&gt;</span>
<a href="#l2.196"></a><span id="l2.196">         &lt;parameter name=&quot;aInsertAfter&quot;/&gt;</span>
<a href="#l2.197"></a><span id="l2.197">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineminus">-            let listbox =</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l2.201"></a><span id="l2.201">             let listitem1 = this.getListItem(1);</span>
<a href="#l2.202"></a><span id="l2.202">             let newNode = null;</span>
<a href="#l2.203"></a><span id="l2.203"> </span>
<a href="#l2.204"></a><span id="l2.204" class="difflineminus">-            if (listbox &amp;&amp; listitem1) {</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineplus">+            if (listitem1) {</span>
<a href="#l2.206"></a><span id="l2.206">                 let newAttendee = this.createAttendee();</span>
<a href="#l2.207"></a><span id="l2.207">                 let nextDummy = this.getNextDummyRow();</span>
<a href="#l2.208"></a><span id="l2.208">                 newNode = listitem1.cloneNode(true);</span>
<a href="#l2.209"></a><span id="l2.209"> </span>
<a href="#l2.210"></a><span id="l2.210">                 if (aInsertAfter) {</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineminus">-                    listbox.insertBefore(newNode, aInsertAfter.nextSibling);</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineplus">+                    this.insertBefore(newNode, aInsertAfter.nextSibling);</span>
<a href="#l2.213"></a><span id="l2.213">                 } else if (nextDummy) {</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineminus">-                    listbox.replaceChild(newNode, nextDummy);</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineplus">+                    this.replaceChild(newNode, nextDummy);</span>
<a href="#l2.216"></a><span id="l2.216">                 } else {</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineminus">-                    listbox.appendChild(newNode);</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineplus">+                    this.appendChild(newNode);</span>
<a href="#l2.219"></a><span id="l2.219">                 }</span>
<a href="#l2.220"></a><span id="l2.220"> </span>
<a href="#l2.221"></a><span id="l2.221" class="difflineminus">-                let input =</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineminus">-                    document.getAnonymousElementByAttribute(</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineminus">-                        newNode, &quot;anonid&quot;, &quot;input&quot;);</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineminus">-                let roleStatusIcon =</span>
<a href="#l2.225"></a><span id="l2.225" class="difflineminus">-                    document.getAnonymousElementByAttribute(</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineminus">-                        newNode, &quot;anonid&quot;, &quot;rolestatus-icon&quot;);</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineminus">-                let userTypeIcon =</span>
<a href="#l2.228"></a><span id="l2.228" class="difflineminus">-                    document.getAnonymousElementByAttribute(</span>
<a href="#l2.229"></a><span id="l2.229" class="difflineminus">-                        newNode, &quot;anonid&quot;, &quot;usertype-icon&quot;);</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineplus">+                let input = newNode.querySelector(&quot;.textbox-addressingWidget&quot;);</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineplus">+                let roleStatusIcon = newNode.querySelector(&quot;.status-icon&quot;);</span>
<a href="#l2.232"></a><span id="l2.232" class="difflineplus">+                let userTypeIcon = newNode.querySelector(&quot;.usertype-icon&quot;);</span>
<a href="#l2.233"></a><span id="l2.233"> </span>
<a href="#l2.234"></a><span id="l2.234">                 // the template could have its fields disabled,</span>
<a href="#l2.235"></a><span id="l2.235">                 // that's why we need to reset their status.</span>
<a href="#l2.236"></a><span id="l2.236">                 input.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l2.237"></a><span id="l2.237">                 roleStatusIcon.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l2.238"></a><span id="l2.238">                 userTypeIcon.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l2.239"></a><span id="l2.239"> </span>
<a href="#l2.240"></a><span id="l2.240">                 if (this.mIsReadOnly || this.mIsInvitation) {</span>
<a href="#l2.241"></a><span id="l2.241">                     input.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l2.242"></a><span id="l2.242">                     roleStatusIcon.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l2.243"></a><span id="l2.243">                     userTypeIcon.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l2.244"></a><span id="l2.244">                 }</span>
<a href="#l2.245"></a><span id="l2.245"> </span>
<a href="#l2.246"></a><span id="l2.246">                 this.mMaxAttendees++;</span>
<a href="#l2.247"></a><span id="l2.247" class="difflineminus">-                let rowNumber = this.mMaxAttendees;</span>
<a href="#l2.248"></a><span id="l2.248" class="difflineminus">-                if (rowNumber &gt;= 0) {</span>
<a href="#l2.249"></a><span id="l2.249" class="difflineminus">-                    roleStatusIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol1#&quot; + rowNumber);</span>
<a href="#l2.250"></a><span id="l2.250" class="difflineminus">-                    userTypeIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol2#&quot; + rowNumber);</span>
<a href="#l2.251"></a><span id="l2.251" class="difflineminus">-                    input.setAttribute(&quot;id&quot;, &quot;attendeeCol3#&quot; + rowNumber);</span>
<a href="#l2.252"></a><span id="l2.252" class="difflineminus">-                }</span>
<a href="#l2.253"></a><span id="l2.253"> </span>
<a href="#l2.254"></a><span id="l2.254">                 input.value = null;</span>
<a href="#l2.255"></a><span id="l2.255">                 input.removeAttribute(&quot;value&quot;);</span>
<a href="#l2.256"></a><span id="l2.256">                 input.attendee = newAttendee;</span>
<a href="#l2.257"></a><span id="l2.257"> </span>
<a href="#l2.258"></a><span id="l2.258">                 // set role and participation status</span>
<a href="#l2.259"></a><span id="l2.259">                 roleStatusIcon.setAttribute(&quot;class&quot;, &quot;role-icon&quot;);</span>
<a href="#l2.260"></a><span id="l2.260">                 roleStatusIcon.setAttribute(&quot;role&quot;, &quot;REQ-PARTICIPANT&quot;);</span>
<a href="#l2.261"></a><span id="l2.261" class="difflineat">@@ -547,74 +472,64 @@</span>
<a href="#l2.262"></a><span id="l2.262">     &lt;/method&gt;</span>
<a href="#l2.263"></a><span id="l2.263"> </span>
<a href="#l2.264"></a><span id="l2.264">     &lt;method name=&quot;_fillListItemWithEntry&quot;&gt;</span>
<a href="#l2.265"></a><span id="l2.265">         &lt;parameter name=&quot;listitem&quot;/&gt;</span>
<a href="#l2.266"></a><span id="l2.266">         &lt;parameter name=&quot;entry&quot;/&gt;</span>
<a href="#l2.267"></a><span id="l2.267">         &lt;parameter name=&quot;rowNumber&quot;/&gt;</span>
<a href="#l2.268"></a><span id="l2.268">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.269"></a><span id="l2.269">               let newAttendee = this.createAttendee(entry);</span>
<a href="#l2.270"></a><span id="l2.270" class="difflineminus">-              let input = document.getAnonymousElementByAttribute(listitem, &quot;anonid&quot;, &quot;input&quot;);</span>
<a href="#l2.271"></a><span id="l2.271" class="difflineplus">+              let input = listitem.querySelector(&quot;.textbox-addressingWidget&quot;);</span>
<a href="#l2.272"></a><span id="l2.272">               input.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineminus">-              input.setAttribute(&quot;id&quot;, &quot;attendeeCol3#&quot; + rowNumber);</span>
<a href="#l2.274"></a><span id="l2.274"> </span>
<a href="#l2.275"></a><span id="l2.275">               input.attendee = newAttendee;</span>
<a href="#l2.276"></a><span id="l2.276">               input.value = entry;</span>
<a href="#l2.277"></a><span id="l2.277">               input.setAttribute(&quot;value&quot;, entry);</span>
<a href="#l2.278"></a><span id="l2.278">               input.setAttribute(&quot;dirty&quot;, &quot;true&quot;);</span>
<a href="#l2.279"></a><span id="l2.279">               if (input.getAttribute(&quot;focused&quot;) != &quot;&quot;) {</span>
<a href="#l2.280"></a><span id="l2.280">                   input.removeAttribute(&quot;focused&quot;);</span>
<a href="#l2.281"></a><span id="l2.281">               }</span>
<a href="#l2.282"></a><span id="l2.282"> </span>
<a href="#l2.283"></a><span id="l2.283" class="difflineminus">-              let roleStatusIcon = document.getAnonymousElementByAttribute(listitem, &quot;anonid&quot;, &quot;rolestatus-icon&quot;);</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineplus">+              let roleStatusIcon = listitem.querySelector(&quot;.status-icon&quot;);</span>
<a href="#l2.285"></a><span id="l2.285">               roleStatusIcon.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineminus">-              roleStatusIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol1#&quot; + rowNumber);</span>
<a href="#l2.287"></a><span id="l2.287">               roleStatusIcon.setAttribute(&quot;class&quot;, &quot;role-icon&quot;);</span>
<a href="#l2.288"></a><span id="l2.288">               roleStatusIcon.setAttribute(&quot;role&quot;, newAttendee.role);</span>
<a href="#l2.289"></a><span id="l2.289"> </span>
<a href="#l2.290"></a><span id="l2.290" class="difflineminus">-              let userTypeIcon = document.getAnonymousElementByAttribute(listitem, &quot;anonid&quot;, &quot;usertype-icon&quot;);</span>
<a href="#l2.291"></a><span id="l2.291" class="difflineplus">+              let userTypeIcon = listitem.querySelector(&quot;.usertype-icon&quot;);</span>
<a href="#l2.292"></a><span id="l2.292">               userTypeIcon.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l2.293"></a><span id="l2.293" class="difflineminus">-              userTypeIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol2#&quot; + rowNumber);</span>
<a href="#l2.294"></a><span id="l2.294">               userTypeIcon.setAttribute(&quot;cutype&quot;, newAttendee.userType);</span>
<a href="#l2.295"></a><span id="l2.295">           ]]&gt;&lt;/body&gt;</span>
<a href="#l2.296"></a><span id="l2.296">     &lt;/method&gt;</span>
<a href="#l2.297"></a><span id="l2.297"> </span>
<a href="#l2.298"></a><span id="l2.298">     &lt;method name=&quot;resolvePotentialList&quot;&gt;</span>
<a href="#l2.299"></a><span id="l2.299">       &lt;parameter name=&quot;aInput&quot;/&gt;</span>
<a href="#l2.300"></a><span id="l2.300">       &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.301"></a><span id="l2.301">             let fieldValue = aInput.value;</span>
<a href="#l2.302"></a><span id="l2.302">             if (aInput.id.length &gt; 0 &amp;&amp; fieldValue.length &gt; 0) {</span>
<a href="#l2.303"></a><span id="l2.303">                 let mailingList = this._resolveListByName(fieldValue);</span>
<a href="#l2.304"></a><span id="l2.304">                 if (mailingList) {</span>
<a href="#l2.305"></a><span id="l2.305">                     let entries = this._getListEntries(mailingList);</span>
<a href="#l2.306"></a><span id="l2.306">                     if (entries.length &gt; 0) {</span>
<a href="#l2.307"></a><span id="l2.307">                         let currentIndex = parseInt(aInput.id.substr(13), 10);</span>
<a href="#l2.308"></a><span id="l2.308" class="difflineminus">-                        let template = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item&quot;);</span>
<a href="#l2.309"></a><span id="l2.309" class="difflineplus">+                        let template = this.querySelector(&quot;.addressingWidgetItem&quot;);</span>
<a href="#l2.310"></a><span id="l2.310">                         let currentNode = template.parentNode.childNodes[currentIndex];</span>
<a href="#l2.311"></a><span id="l2.311">                         this._fillListItemWithEntry(currentNode, entries[0], currentIndex);</span>
<a href="#l2.312"></a><span id="l2.312">                         entries.shift();</span>
<a href="#l2.313"></a><span id="l2.313">                         let nextNode = template.parentNode.childNodes[currentIndex + 1];</span>
<a href="#l2.314"></a><span id="l2.314">                         currentIndex++;</span>
<a href="#l2.315"></a><span id="l2.315">                         for (let entry of entries) {</span>
<a href="#l2.316"></a><span id="l2.316">                             currentNode = template.cloneNode(true);</span>
<a href="#l2.317"></a><span id="l2.317">                             template.parentNode.insertBefore(currentNode, nextNode);</span>
<a href="#l2.318"></a><span id="l2.318">                             this._fillListItemWithEntry(currentNode, entry, currentIndex);</span>
<a href="#l2.319"></a><span id="l2.319">                             currentIndex++;</span>
<a href="#l2.320"></a><span id="l2.320">                         }</span>
<a href="#l2.321"></a><span id="l2.321">                         this.mMaxAttendees += entries.length;</span>
<a href="#l2.322"></a><span id="l2.322">                         for (let i = currentIndex; i &lt;= this.mMaxAttendees; i++) {</span>
<a href="#l2.323"></a><span id="l2.323">                             let row = template.parentNode.childNodes[i];</span>
<a href="#l2.324"></a><span id="l2.324" class="difflineminus">-                            let roleStatusIcon = document.getAnonymousElementByAttribute(row, &quot;anonid&quot;, &quot;rolestatus-icon&quot;);</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineminus">-                            roleStatusIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol1#&quot; + i);</span>
<a href="#l2.326"></a><span id="l2.326" class="difflineminus">-</span>
<a href="#l2.327"></a><span id="l2.327" class="difflineminus">-                            let userTypeIcon = document.getAnonymousElementByAttribute(row, &quot;anonid&quot;, &quot;usertype-icon&quot;);</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineminus">-                            userTypeIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol2#&quot; + i);</span>
<a href="#l2.329"></a><span id="l2.329" class="difflineminus">-</span>
<a href="#l2.330"></a><span id="l2.330" class="difflineminus">-                            let input = document.getAnonymousElementByAttribute(row, &quot;anonid&quot;, &quot;input&quot;);</span>
<a href="#l2.331"></a><span id="l2.331" class="difflineminus">-                            input.setAttribute(&quot;id&quot;, &quot;attendeeCol3#&quot; + i);</span>
<a href="#l2.332"></a><span id="l2.332" class="difflineplus">+                            let input = row.querySelector(&quot;.textbox-addressingWidget&quot;);</span>
<a href="#l2.333"></a><span id="l2.333">                             input.setAttribute(&quot;dirty&quot;, &quot;true&quot;);</span>
<a href="#l2.334"></a><span id="l2.334">                         }</span>
<a href="#l2.335"></a><span id="l2.335">                     }</span>
<a href="#l2.336"></a><span id="l2.336">                 }</span>
<a href="#l2.337"></a><span id="l2.337">             }</span>
<a href="#l2.338"></a><span id="l2.338">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.339"></a><span id="l2.339">       &lt;/method&gt;</span>
<a href="#l2.340"></a><span id="l2.340"> </span>
<a href="#l2.341"></a><span id="l2.341" class="difflineat">@@ -648,33 +563,33 @@</span>
<a href="#l2.342"></a><span id="l2.342">             this.dispatchEvent(event);</span>
<a href="#l2.343"></a><span id="l2.343">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.344"></a><span id="l2.344">       &lt;/method&gt;</span>
<a href="#l2.345"></a><span id="l2.345"> </span>
<a href="#l2.346"></a><span id="l2.346">      &lt;method name=&quot;updateTooltip&quot;&gt;</span>
<a href="#l2.347"></a><span id="l2.347">       &lt;parameter name=&quot;targetIcon&quot;/&gt;</span>
<a href="#l2.348"></a><span id="l2.348">       &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.349"></a><span id="l2.349">           // Function setting the tooltip of attendeeicons based on their role</span>
<a href="#l2.350"></a><span id="l2.350" class="difflineminus">-          if (targetIcon.className == &quot;role-icon&quot;) {</span>
<a href="#l2.351"></a><span id="l2.351" class="difflineplus">+          if (targetIcon.classList.contains(&quot;role-icon&quot;)) {</span>
<a href="#l2.352"></a><span id="l2.352">               let role = targetIcon.getAttribute(&quot;role&quot;);</span>
<a href="#l2.353"></a><span id="l2.353">               // Set tooltip for rolenames</span>
<a href="#l2.354"></a><span id="l2.354"> </span>
<a href="#l2.355"></a><span id="l2.355">               const roleMap = {</span>
<a href="#l2.356"></a><span id="l2.356">                   &quot;REQ-PARTICIPANT&quot;: &quot;required&quot;,</span>
<a href="#l2.357"></a><span id="l2.357">                   &quot;OPT-PARTICIPANT&quot;: &quot;optional&quot;,</span>
<a href="#l2.358"></a><span id="l2.358">                   &quot;NON-PARTICIPANT&quot;: &quot;nonparticipant&quot;,</span>
<a href="#l2.359"></a><span id="l2.359">                   &quot;CHAIR&quot;: &quot;chair&quot;</span>
<a href="#l2.360"></a><span id="l2.360">               };</span>
<a href="#l2.361"></a><span id="l2.361"> </span>
<a href="#l2.362"></a><span id="l2.362">               let roleNameString = &quot;event.attendee.role.&quot; + (role in roleMap ? roleMap[role] : &quot;unknown&quot;);</span>
<a href="#l2.363"></a><span id="l2.363">               let tooltip = cal.l10n.getString(&quot;calendar-event-dialog-attendees&quot;,</span>
<a href="#l2.364"></a><span id="l2.364">                                                roleNameString,</span>
<a href="#l2.365"></a><span id="l2.365">                                                role in roleMap ? []: [role]);</span>
<a href="#l2.366"></a><span id="l2.366">               targetIcon.setAttribute(&quot;tooltiptext&quot;, tooltip);</span>
<a href="#l2.367"></a><span id="l2.367" class="difflineminus">-          } else if (targetIcon.className == &quot;usertype-icon&quot;) {</span>
<a href="#l2.368"></a><span id="l2.368" class="difflineplus">+          } else if (targetIcon.classList.contains(&quot;usertype-icon&quot;)) {</span>
<a href="#l2.369"></a><span id="l2.369">               let cutype = targetIcon.getAttribute(&quot;cutype&quot;);</span>
<a href="#l2.370"></a><span id="l2.370">               const cutypeMap = {</span>
<a href="#l2.371"></a><span id="l2.371">                   INDIVIDUAL: &quot;individual&quot;,</span>
<a href="#l2.372"></a><span id="l2.372">                   GROUP: &quot;group&quot;,</span>
<a href="#l2.373"></a><span id="l2.373">                   RESOURCE: &quot;resource&quot;,</span>
<a href="#l2.374"></a><span id="l2.374">                   ROOM: &quot;room&quot;,</span>
<a href="#l2.375"></a><span id="l2.375">                   // I've decided UNKNOWN will not be handled.</span>
<a href="#l2.376"></a><span id="l2.376">               };</span>
<a href="#l2.377"></a><span id="l2.377" class="difflineat">@@ -700,250 +615,183 @@</span>
<a href="#l2.378"></a><span id="l2.378">                 this.calcContentHeight();</span>
<a href="#l2.379"></a><span id="l2.379">                 this.createOrRemoveDummyRows();</span>
<a href="#l2.380"></a><span id="l2.380">             }, 0);</span>
<a href="#l2.381"></a><span id="l2.381">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.382"></a><span id="l2.382">       &lt;/method&gt;</span>
<a href="#l2.383"></a><span id="l2.383"> </span>
<a href="#l2.384"></a><span id="l2.384">       &lt;method name=&quot;calcContentHeight&quot;&gt;</span>
<a href="#l2.385"></a><span id="l2.385">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.386"></a><span id="l2.386" class="difflineminus">-            let listbox =</span>
<a href="#l2.387"></a><span id="l2.387" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.388"></a><span id="l2.388" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l2.389"></a><span id="l2.389" class="difflineminus">-            let items = listbox.getElementsByTagNameNS(&quot;*&quot;, &quot;listitem&quot;);</span>
<a href="#l2.390"></a><span id="l2.390" class="difflineplus">+            let items = this.getElementsByTagName(&quot;richlistitem&quot;);</span>
<a href="#l2.391"></a><span id="l2.391">             this.mContentHeight = 0;</span>
<a href="#l2.392"></a><span id="l2.392">             if (items.length &gt; 0) {</span>
<a href="#l2.393"></a><span id="l2.393">                 let i = 0;</span>
<a href="#l2.394"></a><span id="l2.394">                 do {</span>
<a href="#l2.395"></a><span id="l2.395">                     this.mRowHeight = items[i].boxObject.height;</span>
<a href="#l2.396"></a><span id="l2.396">                     ++i;</span>
<a href="#l2.397"></a><span id="l2.397">                 } while (i &lt; items.length &amp;&amp; !this.mRowHeight);</span>
<a href="#l2.398"></a><span id="l2.398">                 this.mContentHeight = this.mRowHeight * items.length;</span>
<a href="#l2.399"></a><span id="l2.399">             }</span>
<a href="#l2.400"></a><span id="l2.400">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.401"></a><span id="l2.401">       &lt;/method&gt;</span>
<a href="#l2.402"></a><span id="l2.402"> </span>
<a href="#l2.403"></a><span id="l2.403">       &lt;method name=&quot;createOrRemoveDummyRows&quot;&gt;</span>
<a href="#l2.404"></a><span id="l2.404">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.405"></a><span id="l2.405" class="difflineminus">-            let listbox =</span>
<a href="#l2.406"></a><span id="l2.406" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.407"></a><span id="l2.407" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l2.408"></a><span id="l2.408" class="difflineminus">-            let listboxHeight = listbox.boxObject.height;</span>
<a href="#l2.409"></a><span id="l2.409" class="difflineplus">+            let listboxHeight = this.boxObject.height;</span>
<a href="#l2.410"></a><span id="l2.410"> </span>
<a href="#l2.411"></a><span id="l2.411">             // remove rows to remove scrollbar</span>
<a href="#l2.412"></a><span id="l2.412" class="difflineminus">-            let kids = listbox.childNodes;</span>
<a href="#l2.413"></a><span id="l2.413" class="difflineplus">+            let kids = this.childNodes;</span>
<a href="#l2.414"></a><span id="l2.414">             for (let i = kids.length - 1; this.mContentHeight &gt; listboxHeight &amp;&amp; i &gt;= 0; --i) {</span>
<a href="#l2.415"></a><span id="l2.415">                 if (kids[i].hasAttribute(&quot;_isDummyRow&quot;)) {</span>
<a href="#l2.416"></a><span id="l2.416">                     this.mContentHeight -= this.mRowHeight;</span>
<a href="#l2.417"></a><span id="l2.417">                     kids[i].remove();</span>
<a href="#l2.418"></a><span id="l2.418">                 }</span>
<a href="#l2.419"></a><span id="l2.419">             }</span>
<a href="#l2.420"></a><span id="l2.420"> </span>
<a href="#l2.421"></a><span id="l2.421">             // add rows to fill space</span>
<a href="#l2.422"></a><span id="l2.422">             if (this.mRowHeight) {</span>
<a href="#l2.423"></a><span id="l2.423">                 while (this.mContentHeight + this.mRowHeight &lt; listboxHeight) {</span>
<a href="#l2.424"></a><span id="l2.424" class="difflineminus">-                    this.createDummyItem(listbox);</span>
<a href="#l2.425"></a><span id="l2.425" class="difflineplus">+                    this.createDummyItem();</span>
<a href="#l2.426"></a><span id="l2.426">                     this.mContentHeight += this.mRowHeight;</span>
<a href="#l2.427"></a><span id="l2.427">                 }</span>
<a href="#l2.428"></a><span id="l2.428">             }</span>
<a href="#l2.429"></a><span id="l2.429">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.430"></a><span id="l2.430">       &lt;/method&gt;</span>
<a href="#l2.431"></a><span id="l2.431"> </span>
<a href="#l2.432"></a><span id="l2.432" class="difflineminus">-      &lt;method name=&quot;createDummyCell&quot;&gt;</span>
<a href="#l2.433"></a><span id="l2.433" class="difflineminus">-        &lt;parameter name=&quot;aParent&quot;/&gt;</span>
<a href="#l2.434"></a><span id="l2.434" class="difflineplus">+      &lt;method name=&quot;createDummyItem&quot;&gt;</span>
<a href="#l2.435"></a><span id="l2.435">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.436"></a><span id="l2.436" class="difflineminus">-            let cell = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;, &quot;listcell&quot;);</span>
<a href="#l2.437"></a><span id="l2.437" class="difflineminus">-            cell.setAttribute(&quot;class&quot;, &quot;addressingWidgetCell dummy-row-cell&quot;);</span>
<a href="#l2.438"></a><span id="l2.438" class="difflineminus">-            if (aParent) {</span>
<a href="#l2.439"></a><span id="l2.439" class="difflineminus">-                aParent.appendChild(cell);</span>
<a href="#l2.440"></a><span id="l2.440" class="difflineminus">-            }</span>
<a href="#l2.441"></a><span id="l2.441" class="difflineminus">-            return cell;</span>
<a href="#l2.442"></a><span id="l2.442" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l2.443"></a><span id="l2.443" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l2.444"></a><span id="l2.444" class="difflineminus">-</span>
<a href="#l2.445"></a><span id="l2.445" class="difflineminus">-      &lt;method name=&quot;createDummyItem&quot;&gt;</span>
<a href="#l2.446"></a><span id="l2.446" class="difflineminus">-        &lt;parameter name=&quot;aParent&quot;/&gt;</span>
<a href="#l2.447"></a><span id="l2.447" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.448"></a><span id="l2.448" class="difflineminus">-            let titem = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;, &quot;listitem&quot;);</span>
<a href="#l2.449"></a><span id="l2.449" class="difflineplus">+            let titem = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l2.450"></a><span id="l2.450">             titem.setAttribute(&quot;_isDummyRow&quot;, &quot;true&quot;);</span>
<a href="#l2.451"></a><span id="l2.451">             titem.setAttribute(&quot;class&quot;, &quot;dummy-row&quot;);</span>
<a href="#l2.452"></a><span id="l2.452" class="difflineminus">-            for (let i = this.numColumns; i &gt; 0; i--) {</span>
<a href="#l2.453"></a><span id="l2.453" class="difflineminus">-                this.createDummyCell(titem);</span>
<a href="#l2.454"></a><span id="l2.454" class="difflineplus">+            for (let i = this.mNumColumns; i &gt; 0; i--) {</span>
<a href="#l2.455"></a><span id="l2.455" class="difflineplus">+                let cell = document.createElement(&quot;hbox&quot;);</span>
<a href="#l2.456"></a><span id="l2.456" class="difflineplus">+                cell.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l2.457"></a><span id="l2.457" class="difflineplus">+                cell.setAttribute(&quot;class&quot;, &quot;addressingWidgetCell dummy-row-cell&quot;);</span>
<a href="#l2.458"></a><span id="l2.458" class="difflineplus">+                titem.appendChild(cell);</span>
<a href="#l2.459"></a><span id="l2.459">             }</span>
<a href="#l2.460"></a><span id="l2.460" class="difflineminus">-            if (aParent) {</span>
<a href="#l2.461"></a><span id="l2.461" class="difflineminus">-                aParent.appendChild(titem);</span>
<a href="#l2.462"></a><span id="l2.462" class="difflineminus">-            }</span>
<a href="#l2.463"></a><span id="l2.463" class="difflineplus">+            this.appendChild(titem);</span>
<a href="#l2.464"></a><span id="l2.464">             return titem;</span>
<a href="#l2.465"></a><span id="l2.465">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.466"></a><span id="l2.466">       &lt;/method&gt;</span>
<a href="#l2.467"></a><span id="l2.467"> </span>
<a href="#l2.468"></a><span id="l2.468">       &lt;!-- gets the next row from the top down --&gt;</span>
<a href="#l2.469"></a><span id="l2.469">       &lt;method name=&quot;getNextDummyRow&quot;&gt;</span>
<a href="#l2.470"></a><span id="l2.470">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.471"></a><span id="l2.471" class="difflineminus">-            let listbox =</span>
<a href="#l2.472"></a><span id="l2.472" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.473"></a><span id="l2.473" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l2.474"></a><span id="l2.474" class="difflineminus">-            let kids = listbox.childNodes;</span>
<a href="#l2.475"></a><span id="l2.475" class="difflineplus">+            let kids = this.childNodes;</span>
<a href="#l2.476"></a><span id="l2.476">             for (let i = 0; i &lt; kids.length; ++i) {</span>
<a href="#l2.477"></a><span id="l2.477">                 if (kids[i].hasAttribute(&quot;_isDummyRow&quot;)) {</span>
<a href="#l2.478"></a><span id="l2.478">                     return kids[i];</span>
<a href="#l2.479"></a><span id="l2.479">                 }</span>
<a href="#l2.480"></a><span id="l2.480">             }</span>
<a href="#l2.481"></a><span id="l2.481">             return null;</span>
<a href="#l2.482"></a><span id="l2.482">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.483"></a><span id="l2.483">       &lt;/method&gt;</span>
<a href="#l2.484"></a><span id="l2.484"> </span>
<a href="#l2.485"></a><span id="l2.485" class="difflineminus">-      &lt;!-- This method returns the &lt;xul:listitem&gt; at row numer 'aRow' --&gt;</span>
<a href="#l2.486"></a><span id="l2.486" class="difflineplus">+      &lt;!-- This method returns the &lt;xul:richlistitem&gt; at row numer 'aRow' --&gt;</span>
<a href="#l2.487"></a><span id="l2.487">       &lt;method name=&quot;getListItem&quot;&gt;</span>
<a href="#l2.488"></a><span id="l2.488">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l2.489"></a><span id="l2.489">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.490"></a><span id="l2.490" class="difflineminus">-            let listbox =</span>
<a href="#l2.491"></a><span id="l2.491" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.492"></a><span id="l2.492" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l2.493"></a><span id="l2.493" class="difflineminus">-            if (listbox &amp;&amp; aRow &gt; 0) {</span>
<a href="#l2.494"></a><span id="l2.494" class="difflineminus">-                let listitems = listbox.getElementsByTagNameNS(&quot;*&quot;, &quot;listitem&quot;);</span>
<a href="#l2.495"></a><span id="l2.495" class="difflineminus">-                if (listitems &amp;&amp; listitems.length &gt;= aRow) {</span>
<a href="#l2.496"></a><span id="l2.496" class="difflineminus">-                    return listitems[aRow - 1];</span>
<a href="#l2.497"></a><span id="l2.497" class="difflineminus">-                }</span>
<a href="#l2.498"></a><span id="l2.498" class="difflineminus">-            }</span>
<a href="#l2.499"></a><span id="l2.499" class="difflineminus">-            return 0;</span>
<a href="#l2.500"></a><span id="l2.500" class="difflineplus">+            return this.getElementsByTagName(&quot;richlistitem&quot;)[aRow - 1];</span>
<a href="#l2.501"></a><span id="l2.501">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.502"></a><span id="l2.502">       &lt;/method&gt;</span>
<a href="#l2.503"></a><span id="l2.503"> </span>
<a href="#l2.504"></a><span id="l2.504">       &lt;method name=&quot;getInputFromListitem&quot;&gt;</span>
<a href="#l2.505"></a><span id="l2.505">         &lt;parameter name=&quot;aListItem&quot;/&gt;</span>
<a href="#l2.506"></a><span id="l2.506">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.507"></a><span id="l2.507" class="difflineminus">-            return aListItem.getElementsByTagNameNS(&quot;*&quot;, &quot;textbox&quot;)[0];</span>
<a href="#l2.508"></a><span id="l2.508" class="difflineplus">+            return aListItem.getElementsByTagName(&quot;textbox&quot;)[0];</span>
<a href="#l2.509"></a><span id="l2.509">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.510"></a><span id="l2.510">       &lt;/method&gt;</span>
<a href="#l2.511"></a><span id="l2.511"> </span>
<a href="#l2.512"></a><span id="l2.512">       &lt;method name=&quot;getRowByInputElement&quot;&gt;</span>
<a href="#l2.513"></a><span id="l2.513">         &lt;parameter name=&quot;aElement&quot;/&gt;</span>
<a href="#l2.514"></a><span id="l2.514">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.515"></a><span id="l2.515">             let row = 0;</span>
<a href="#l2.516"></a><span id="l2.516" class="difflineminus">-            while (aElement &amp;&amp; aElement.localName != &quot;listitem&quot;) {</span>
<a href="#l2.517"></a><span id="l2.517" class="difflineminus">-                aElement = aElement.parentNode;</span>
<a href="#l2.518"></a><span id="l2.518" class="difflineminus">-            }</span>
<a href="#l2.519"></a><span id="l2.519" class="difflineplus">+            aElement = aElement.closest(&quot;richlistitem&quot;);</span>
<a href="#l2.520"></a><span id="l2.520">             if (aElement) {</span>
<a href="#l2.521"></a><span id="l2.521">                 while (aElement) {</span>
<a href="#l2.522"></a><span id="l2.522" class="difflineminus">-                    if (aElement.localName == &quot;listitem&quot;) {</span>
<a href="#l2.523"></a><span id="l2.523" class="difflineplus">+                    if (aElement.localName == &quot;richlistitem&quot;) {</span>
<a href="#l2.524"></a><span id="l2.524">                         ++row;</span>
<a href="#l2.525"></a><span id="l2.525">                     }</span>
<a href="#l2.526"></a><span id="l2.526">                     aElement = aElement.previousSibling;</span>
<a href="#l2.527"></a><span id="l2.527">                 }</span>
<a href="#l2.528"></a><span id="l2.528">             }</span>
<a href="#l2.529"></a><span id="l2.529">             return row;</span>
<a href="#l2.530"></a><span id="l2.530">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.531"></a><span id="l2.531">       &lt;/method&gt;</span>
<a href="#l2.532"></a><span id="l2.532"> </span>
<a href="#l2.533"></a><span id="l2.533">       &lt;!-- This method returns the &lt;xul:textbox&gt; that contains</span>
<a href="#l2.534"></a><span id="l2.534">            the name of the attendee at row number 'aRow' --&gt;</span>
<a href="#l2.535"></a><span id="l2.535">       &lt;method name=&quot;getInputElement&quot;&gt;</span>
<a href="#l2.536"></a><span id="l2.536">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l2.537"></a><span id="l2.537">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.538"></a><span id="l2.538" class="difflineminus">-            return document.getAnonymousElementByAttribute(this, &quot;id&quot;, &quot;attendeeCol3#&quot; + aRow);</span>
<a href="#l2.539"></a><span id="l2.539" class="difflineplus">+            return this.getListItem(aRow).querySelector(&quot;.textbox-addressingWidget&quot;);</span>
<a href="#l2.540"></a><span id="l2.540">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.541"></a><span id="l2.541">       &lt;/method&gt;</span>
<a href="#l2.542"></a><span id="l2.542"> </span>
<a href="#l2.543"></a><span id="l2.543">       &lt;method name=&quot;getRoleElement&quot;&gt;</span>
<a href="#l2.544"></a><span id="l2.544">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l2.545"></a><span id="l2.545">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.546"></a><span id="l2.546" class="difflineminus">-            return document.getAnonymousElementByAttribute(this, &quot;id&quot;, &quot;attendeeCol1#&quot; + aRow);</span>
<a href="#l2.547"></a><span id="l2.547" class="difflineplus">+            return this.getListItem(aRow).querySelector(&quot;.status-icon&quot;);</span>
<a href="#l2.548"></a><span id="l2.548">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.549"></a><span id="l2.549">       &lt;/method&gt;</span>
<a href="#l2.550"></a><span id="l2.550"> </span>
<a href="#l2.551"></a><span id="l2.551">       &lt;method name=&quot;getStatusElement&quot;&gt;</span>
<a href="#l2.552"></a><span id="l2.552">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l2.553"></a><span id="l2.553">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.554"></a><span id="l2.554" class="difflineminus">-            return document.getAnonymousElementByAttribute(this, &quot;id&quot;, &quot;attendeeCol1#&quot; + aRow);</span>
<a href="#l2.555"></a><span id="l2.555" class="difflineplus">+            return this.getListItem(aRow).querySelector(&quot;.status-icon&quot;);</span>
<a href="#l2.556"></a><span id="l2.556">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.557"></a><span id="l2.557">       &lt;/method&gt;</span>
<a href="#l2.558"></a><span id="l2.558"> </span>
<a href="#l2.559"></a><span id="l2.559">       &lt;method name=&quot;getUserTypeElement&quot;&gt;</span>
<a href="#l2.560"></a><span id="l2.560">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l2.561"></a><span id="l2.561">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.562"></a><span id="l2.562" class="difflineminus">-            return document.getAnonymousElementByAttribute(this, &quot;id&quot;, &quot;attendeeCol2#&quot; + aRow);</span>
<a href="#l2.563"></a><span id="l2.563" class="difflineplus">+            return this.getListItem(aRow).querySelector(&quot;.usertype-icon&quot;);</span>
<a href="#l2.564"></a><span id="l2.564">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.565"></a><span id="l2.565">       &lt;/method&gt;</span>
<a href="#l2.566"></a><span id="l2.566"> </span>
<a href="#l2.567"></a><span id="l2.567">       &lt;method name=&quot;setFocus&quot;&gt;</span>
<a href="#l2.568"></a><span id="l2.568">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l2.569"></a><span id="l2.569">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.570"></a><span id="l2.570" class="difflineminus">-            let self = this;</span>
<a href="#l2.571"></a><span id="l2.571" class="difflineminus">-            let set_focus = function() {</span>
<a href="#l2.572"></a><span id="l2.572" class="difflineplus">+            setTimeout(() =&gt; {</span>
<a href="#l2.573"></a><span id="l2.573">                 let node;</span>
<a href="#l2.574"></a><span id="l2.574">                 if (typeof aRow == &quot;number&quot;) {</span>
<a href="#l2.575"></a><span id="l2.575" class="difflineminus">-                    node = self.getListItem(aRow);</span>
<a href="#l2.576"></a><span id="l2.576" class="difflineplus">+                    node = this.getListItem(aRow);</span>
<a href="#l2.577"></a><span id="l2.577">                 } else {</span>
<a href="#l2.578"></a><span id="l2.578">                     node = aRow;</span>
<a href="#l2.579"></a><span id="l2.579">                 }</span>
<a href="#l2.580"></a><span id="l2.580"> </span>
<a href="#l2.581"></a><span id="l2.581" class="difflineminus">-                // do we need to scroll in order to see the selected row?</span>
<a href="#l2.582"></a><span id="l2.582" class="difflineminus">-                let listbox =</span>
<a href="#l2.583"></a><span id="l2.583" class="difflineminus">-                    document.getAnonymousElementByAttribute(</span>
<a href="#l2.584"></a><span id="l2.584" class="difflineminus">-                        self, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l2.585"></a><span id="l2.585" class="difflineminus">-                let firstVisibleRow = listbox.getIndexOfFirstVisibleRow();</span>
<a href="#l2.586"></a><span id="l2.586" class="difflineminus">-                let numOfVisibleRows = listbox.getNumberOfVisibleRows();</span>
<a href="#l2.587"></a><span id="l2.587" class="difflineminus">-                if (aRow &lt;= firstVisibleRow) {</span>
<a href="#l2.588"></a><span id="l2.588" class="difflineminus">-                    listbox.scrollToIndex(aRow - 1);</span>
<a href="#l2.589"></a><span id="l2.589" class="difflineminus">-                } else if (aRow - 1 &gt;= (firstVisibleRow + numOfVisibleRows)) {</span>
<a href="#l2.590"></a><span id="l2.590" class="difflineminus">-                    listbox.scrollToIndex(aRow - numOfVisibleRows);</span>
<a href="#l2.591"></a><span id="l2.591" class="difflineminus">-                }</span>
<a href="#l2.592"></a><span id="l2.592" class="difflineminus">-                let input =</span>
<a href="#l2.593"></a><span id="l2.593" class="difflineminus">-                    document.getAnonymousElementByAttribute(</span>
<a href="#l2.594"></a><span id="l2.594" class="difflineminus">-                        node, &quot;anonid&quot;, &quot;input&quot;);</span>
<a href="#l2.595"></a><span id="l2.595" class="difflineplus">+                this.ensureElementIsVisible(node);</span>
<a href="#l2.596"></a><span id="l2.596" class="difflineplus">+</span>
<a href="#l2.597"></a><span id="l2.597" class="difflineplus">+                let input = node.querySelector(&quot;.textbox-addressingWidget&quot;);</span>
<a href="#l2.598"></a><span id="l2.598">                 input.focus();</span>
<a href="#l2.599"></a><span id="l2.599" class="difflineminus">-            };</span>
<a href="#l2.600"></a><span id="l2.600" class="difflineminus">-            setTimeout(set_focus, 0);</span>
<a href="#l2.601"></a><span id="l2.601" class="difflineplus">+            }, 0);</span>
<a href="#l2.602"></a><span id="l2.602">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.603"></a><span id="l2.603">       &lt;/method&gt;</span>
<a href="#l2.604"></a><span id="l2.604"> </span>
<a href="#l2.605"></a><span id="l2.605">       &lt;property name=&quot;firstVisibleRow&quot;&gt;</span>
<a href="#l2.606"></a><span id="l2.606">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l2.607"></a><span id="l2.607" class="difflineminus">-            let listbox =</span>
<a href="#l2.608"></a><span id="l2.608" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.609"></a><span id="l2.609" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l2.610"></a><span id="l2.610" class="difflineminus">-            return listbox.getIndexOfFirstVisibleRow();</span>
<a href="#l2.611"></a><span id="l2.611" class="difflineplus">+            return this.getIndexOfFirstVisibleRow();</span>
<a href="#l2.612"></a><span id="l2.612">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l2.613"></a><span id="l2.613">       &lt;/property&gt;</span>
<a href="#l2.614"></a><span id="l2.614"> </span>
<a href="#l2.615"></a><span id="l2.615">       &lt;method name=&quot;createAttendee&quot;&gt;</span>
<a href="#l2.616"></a><span id="l2.616">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.617"></a><span id="l2.617">             let attendee = cal.createAttendee();</span>
<a href="#l2.618"></a><span id="l2.618">             attendee.id = &quot;&quot;;</span>
<a href="#l2.619"></a><span id="l2.619">             attendee.rsvp = &quot;TRUE&quot;;</span>
<a href="#l2.620"></a><span id="l2.620">             attendee.role = &quot;REQ-PARTICIPANT&quot;;</span>
<a href="#l2.621"></a><span id="l2.621">             attendee.participationStatus = &quot;NEEDS-ACTION&quot;;</span>
<a href="#l2.622"></a><span id="l2.622">             return attendee;</span>
<a href="#l2.623"></a><span id="l2.623">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.624"></a><span id="l2.624">       &lt;/method&gt;</span>
<a href="#l2.625"></a><span id="l2.625"> </span>
<a href="#l2.626"></a><span id="l2.626" class="difflineminus">-      &lt;property name=&quot;numColumns&quot;&gt;</span>
<a href="#l2.627"></a><span id="l2.627" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l2.628"></a><span id="l2.628" class="difflineminus">-            if (!this.mNumColumns) {</span>
<a href="#l2.629"></a><span id="l2.629" class="difflineminus">-                let listbox =</span>
<a href="#l2.630"></a><span id="l2.630" class="difflineminus">-                    document.getAnonymousElementByAttribute(</span>
<a href="#l2.631"></a><span id="l2.631" class="difflineminus">-                        this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l2.632"></a><span id="l2.632" class="difflineminus">-                let listCols = listbox.getElementsByTagNameNS(&quot;*&quot;, &quot;listcol&quot;);</span>
<a href="#l2.633"></a><span id="l2.633" class="difflineminus">-                this.mNumColumns = listCols.length;</span>
<a href="#l2.634"></a><span id="l2.634" class="difflineminus">-                if (!this.mNumColumns) {</span>
<a href="#l2.635"></a><span id="l2.635" class="difflineminus">-                    this.mNumColumns = 1;</span>
<a href="#l2.636"></a><span id="l2.636" class="difflineminus">-                }</span>
<a href="#l2.637"></a><span id="l2.637" class="difflineminus">-            }</span>
<a href="#l2.638"></a><span id="l2.638" class="difflineminus">-            return this.mNumColumns;</span>
<a href="#l2.639"></a><span id="l2.639" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l2.640"></a><span id="l2.640" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l2.641"></a><span id="l2.641" class="difflineminus">-</span>
<a href="#l2.642"></a><span id="l2.642">       &lt;property name=&quot;ratio&quot;&gt;</span>
<a href="#l2.643"></a><span id="l2.643">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l2.644"></a><span id="l2.644" class="difflineminus">-            let listbox =</span>
<a href="#l2.645"></a><span id="l2.645" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l2.646"></a><span id="l2.646" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l2.647"></a><span id="l2.647" class="difflineminus">-            let rowcount = listbox.getRowCount();</span>
<a href="#l2.648"></a><span id="l2.648" class="difflineminus">-            listbox.scrollToIndex(Math.floor(rowcount * val));</span>
<a href="#l2.649"></a><span id="l2.649" class="difflineplus">+            let rowcount = this.getRowCount();</span>
<a href="#l2.650"></a><span id="l2.650" class="difflineplus">+            this.scrollToIndex(Math.floor(rowcount * val));</span>
<a href="#l2.651"></a><span id="l2.651">             return val;</span>
<a href="#l2.652"></a><span id="l2.652">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l2.653"></a><span id="l2.653">       &lt;/property&gt;</span>
<a href="#l2.654"></a><span id="l2.654"> </span>
<a href="#l2.655"></a><span id="l2.655">       &lt;method name=&quot;returnHit&quot;&gt;</span>
<a href="#l2.656"></a><span id="l2.656">         &lt;parameter name=&quot;element&quot;/&gt;</span>
<a href="#l2.657"></a><span id="l2.657">         &lt;parameter name=&quot;noAdvance&quot;/&gt;</span>
<a href="#l2.658"></a><span id="l2.658">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.659"></a><span id="l2.659" class="difflineat">@@ -1028,29 +876,17 @@</span>
<a href="#l2.660"></a><span id="l2.660">             event.details = row;</span>
<a href="#l2.661"></a><span id="l2.661">             this.dispatchEvent(event);</span>
<a href="#l2.662"></a><span id="l2.662">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.663"></a><span id="l2.663">       &lt;/method&gt;</span>
<a href="#l2.664"></a><span id="l2.664"> </span>
<a href="#l2.665"></a><span id="l2.665">       &lt;method name=&quot;deleteRow&quot;&gt;</span>
<a href="#l2.666"></a><span id="l2.666">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l2.667"></a><span id="l2.667">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.668"></a><span id="l2.668" class="difflineminus">-            // reset id's in order to not break the sequence</span>
<a href="#l2.669"></a><span id="l2.669" class="difflineminus">-            let maxAttendees = this.mMaxAttendees;</span>
<a href="#l2.670"></a><span id="l2.670">             this.removeRow(aRow);</span>
<a href="#l2.671"></a><span id="l2.671" class="difflineminus">-            let numberOfCols = this.numColumns;</span>
<a href="#l2.672"></a><span id="l2.672" class="difflineminus">-            for (let row = aRow + 1; row &lt;= maxAttendees; row++) {</span>
<a href="#l2.673"></a><span id="l2.673" class="difflineminus">-                for (let col = 1; col &lt;= numberOfCols; col++) {</span>
<a href="#l2.674"></a><span id="l2.674" class="difflineminus">-                    let colID = &quot;attendeeCol&quot; + col + &quot;#&quot; + row;</span>
<a href="#l2.675"></a><span id="l2.675" class="difflineminus">-                    let elem = document.getAnonymousElementByAttribute(this, &quot;id&quot;, colID);</span>
<a href="#l2.676"></a><span id="l2.676" class="difflineminus">-                    if (elem) {</span>
<a href="#l2.677"></a><span id="l2.677" class="difflineminus">-                        elem.setAttribute(&quot;id&quot;, &quot;attendeeCol&quot; + col + &quot;#&quot; + (row - 1));</span>
<a href="#l2.678"></a><span id="l2.678" class="difflineminus">-                    }</span>
<a href="#l2.679"></a><span id="l2.679" class="difflineminus">-                }</span>
<a href="#l2.680"></a><span id="l2.680" class="difflineminus">-            }</span>
<a href="#l2.681"></a><span id="l2.681">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.682"></a><span id="l2.682">       &lt;/method&gt;</span>
<a href="#l2.683"></a><span id="l2.683"> </span>
<a href="#l2.684"></a><span id="l2.684">       &lt;method name=&quot;removeRow&quot;&gt;</span>
<a href="#l2.685"></a><span id="l2.685">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l2.686"></a><span id="l2.686">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.687"></a><span id="l2.687">             this.getListItem(aRow).remove();</span>
<a href="#l2.688"></a><span id="l2.688">             this.fitDummyRows();</span>
<a href="#l2.689"></a><span id="l2.689" class="difflineat">@@ -1062,50 +898,47 @@</span>
<a href="#l2.690"></a><span id="l2.690">     &lt;handlers&gt;</span>
<a href="#l2.691"></a><span id="l2.691">       &lt;handler event=&quot;click&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l2.692"></a><span id="l2.692">           function cycle(values, current) {</span>
<a href="#l2.693"></a><span id="l2.693">               let nextIndex = (values.indexOf(current) + 1) % values.length;</span>
<a href="#l2.694"></a><span id="l2.694">               return values[nextIndex];</span>
<a href="#l2.695"></a><span id="l2.695">           }</span>
<a href="#l2.696"></a><span id="l2.696"> </span>
<a href="#l2.697"></a><span id="l2.697">           let target = event.originalTarget;</span>
<a href="#l2.698"></a><span id="l2.698" class="difflineminus">-          if (target.className == &quot;role-icon&quot;) {</span>
<a href="#l2.699"></a><span id="l2.699" class="difflineplus">+          if (target.classList.contains(&quot;role-icon&quot;)) {</span>
<a href="#l2.700"></a><span id="l2.700">               if (target.getAttribute(&quot;disabled&quot;) != &quot;true&quot;) {</span>
<a href="#l2.701"></a><span id="l2.701">                   const roleCycle = [</span>
<a href="#l2.702"></a><span id="l2.702">                       &quot;REQ-PARTICIPANT&quot;, &quot;OPT-PARTICIPANT&quot;,</span>
<a href="#l2.703"></a><span id="l2.703">                       &quot;NON-PARTICIPANT&quot;, &quot;CHAIR&quot;</span>
<a href="#l2.704"></a><span id="l2.704">                   ];</span>
<a href="#l2.705"></a><span id="l2.705"> </span>
<a href="#l2.706"></a><span id="l2.706">                   let nextValue = cycle(roleCycle, target.getAttribute(&quot;role&quot;));</span>
<a href="#l2.707"></a><span id="l2.707">                   target.setAttribute(&quot;role&quot;, nextValue);</span>
<a href="#l2.708"></a><span id="l2.708">                   this.updateTooltip(target);</span>
<a href="#l2.709"></a><span id="l2.709">               }</span>
<a href="#l2.710"></a><span id="l2.710" class="difflineminus">-          } else if (target.className == &quot;status-icon&quot;) {</span>
<a href="#l2.711"></a><span id="l2.711" class="difflineplus">+          } else if (target.classList.contains(&quot;status-icon&quot;)) {</span>
<a href="#l2.712"></a><span id="l2.712">               if (target.getAttribute(&quot;disabled&quot;) != &quot;true&quot;) {</span>
<a href="#l2.713"></a><span id="l2.713">                   const statusCycle = [&quot;ACCEPTED&quot;, &quot;DECLINED&quot;, &quot;TENTATIVE&quot;];</span>
<a href="#l2.714"></a><span id="l2.714"> </span>
<a href="#l2.715"></a><span id="l2.715">                   let nextValue = cycle(statusCycle, target.getAttribute(&quot;status&quot;));</span>
<a href="#l2.716"></a><span id="l2.716">                   target.setAttribute(&quot;status&quot;, nextValue);</span>
<a href="#l2.717"></a><span id="l2.717">                   this.updateTooltip(target);</span>
<a href="#l2.718"></a><span id="l2.718">               }</span>
<a href="#l2.719"></a><span id="l2.719" class="difflineminus">-          } else if (target.className == &quot;usertype-icon&quot;) {</span>
<a href="#l2.720"></a><span id="l2.720" class="difflineplus">+          } else if (target.classList.contains(&quot;usertype-icon&quot;)) {</span>
<a href="#l2.721"></a><span id="l2.721">               let fieldNum = target.getAttribute(&quot;id&quot;).split(&quot;#&quot;)[1];</span>
<a href="#l2.722"></a><span id="l2.722">               let inputField = this.getInputElement(fieldNum);</span>
<a href="#l2.723"></a><span id="l2.723">               if (target.getAttribute(&quot;disabled&quot;) != &quot;true&quot; &amp;&amp;</span>
<a href="#l2.724"></a><span id="l2.724">                   !inputField.attendee.isOrganizer) {</span>
<a href="#l2.725"></a><span id="l2.725">                   const cutypeCycle = [&quot;INDIVIDUAL&quot;, &quot;GROUP&quot;, &quot;RESOURCE&quot;, &quot;ROOM&quot;];</span>
<a href="#l2.726"></a><span id="l2.726"> </span>
<a href="#l2.727"></a><span id="l2.727">                   let nextValue = cycle(cutypeCycle, target.getAttribute(&quot;cutype&quot;));</span>
<a href="#l2.728"></a><span id="l2.728">                   target.setAttribute(&quot;cutype&quot;, nextValue);</span>
<a href="#l2.729"></a><span id="l2.729">                   this.updateTooltip(target);</span>
<a href="#l2.730"></a><span id="l2.730">               }</span>
<a href="#l2.731"></a><span id="l2.731" class="difflineminus">-          } else if (this.mIsReadOnly || this.mIsInvitation || target == null ||</span>
<a href="#l2.732"></a><span id="l2.732" class="difflineminus">-                     (target.localName != &quot;listboxbody&quot; &amp;&amp;</span>
<a href="#l2.733"></a><span id="l2.733" class="difflineminus">-                      target.localName != &quot;listcell&quot; &amp;&amp;</span>
<a href="#l2.734"></a><span id="l2.734" class="difflineminus">-                      target.localName != &quot;listitem&quot;)) {</span>
<a href="#l2.735"></a><span id="l2.735" class="difflineplus">+          } else if (this.mIsReadOnly || this.mIsInvitation || target == null || target.closest(&quot;richlistitem&quot;)) {</span>
<a href="#l2.736"></a><span id="l2.736">               // These are cases where we don't want to append a new row, keep</span>
<a href="#l2.737"></a><span id="l2.737">               // them here so we can put the rest in the else case.</span>
<a href="#l2.738"></a><span id="l2.738">           } else {</span>
<a href="#l2.739"></a><span id="l2.739">               let lastInput = this.getInputElement(this.mMaxAttendees);</span>
<a href="#l2.740"></a><span id="l2.740">               if (lastInput &amp;&amp; lastInput.value) {</span>
<a href="#l2.741"></a><span id="l2.741">                   this.appendNewRow(true);</span>
<a href="#l2.742"></a><span id="l2.742">               }</span>
<a href="#l2.743"></a><span id="l2.743">           }</span>
<a href="#l2.744"></a><span id="l2.744" class="difflineat">@@ -1147,18 +980,17 @@</span>
<a href="#l2.745"></a><span id="l2.745">                           if (this.mMaxAttendees == 1) {</span>
<a href="#l2.746"></a><span id="l2.746">                               this.appendNewRow(true);</span>
<a href="#l2.747"></a><span id="l2.747">                           } else {</span>
<a href="#l2.748"></a><span id="l2.748">                               this.setFocus(targetRowId);</span>
<a href="#l2.749"></a><span id="l2.749">                           }</span>
<a href="#l2.750"></a><span id="l2.750"> </span>
<a href="#l2.751"></a><span id="l2.751">                           // set cursor to begin or end of focused input box based on deletion direction</span>
<a href="#l2.752"></a><span id="l2.752">                           let cPos = 0;</span>
<a href="#l2.753"></a><span id="l2.753" class="difflineminus">-                          let input = document.getAnonymousElementByAttribute(this.getListItem(targetRowId),</span>
<a href="#l2.754"></a><span id="l2.754" class="difflineminus">-                                                                              &quot;anonid&quot;, &quot;input&quot;);</span>
<a href="#l2.755"></a><span id="l2.755" class="difflineplus">+                          let input = this.getListItem(targetRowId).querySelector(&quot;.textbox-addressingWidget&quot;);</span>
<a href="#l2.756"></a><span id="l2.756">                           if (targetRowId != curRowId) {</span>
<a href="#l2.757"></a><span id="l2.757">                               cPos = input.textLength;</span>
<a href="#l2.758"></a><span id="l2.758">                           }</span>
<a href="#l2.759"></a><span id="l2.759">                           input.setSelectionRange(cPos, cPos);</span>
<a href="#l2.760"></a><span id="l2.760">                       }</span>
<a href="#l2.761"></a><span id="l2.761"> </span>
<a href="#l2.762"></a><span id="l2.762">                       event.stopPropagation();</span>
<a href="#l2.763"></a><span id="l2.763">                       break;</span>
<a href="#l2.764"></a><span id="l2.764" class="difflineat">@@ -1267,19 +1099,17 @@</span>
<a href="#l2.765"></a><span id="l2.765"> </span>
<a href="#l2.766"></a><span id="l2.766">           this.initTimeRange();</span>
<a href="#l2.767"></a><span id="l2.767"> </span>
<a href="#l2.768"></a><span id="l2.768">           // The basedate is the date/time from which the display</span>
<a href="#l2.769"></a><span id="l2.769">           // of the timebar starts. The range is the number of days</span>
<a href="#l2.770"></a><span id="l2.770">           // we should be able to show. the start- and enddate</span>
<a href="#l2.771"></a><span id="l2.771">           // is the time the event is scheduled for.</span>
<a href="#l2.772"></a><span id="l2.772">           this.mRange = Number(this.getAttribute(&quot;range&quot;));</span>
<a href="#l2.773"></a><span id="l2.773" class="difflineminus">-          this.mSelectionbar =</span>
<a href="#l2.774"></a><span id="l2.774" class="difflineminus">-              document.getAnonymousElementByAttribute(</span>
<a href="#l2.775"></a><span id="l2.775" class="difflineminus">-                  this, &quot;anonid&quot;, &quot;selection-bar&quot;);</span>
<a href="#l2.776"></a><span id="l2.776" class="difflineplus">+          this.mSelectionbar = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;selection-bar&quot;);</span>
<a href="#l2.777"></a><span id="l2.777">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l2.778"></a><span id="l2.778"> </span>
<a href="#l2.779"></a><span id="l2.779">       &lt;property name=&quot;baseDate&quot;&gt;</span>
<a href="#l2.780"></a><span id="l2.780">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l2.781"></a><span id="l2.781">             // we need to convert the date/time in question in</span>
<a href="#l2.782"></a><span id="l2.782">             // order to calculate with hours that are aligned</span>
<a href="#l2.783"></a><span id="l2.783">             // with our timebar display.</span>
<a href="#l2.784"></a><span id="l2.784">             let kDefaultTimezone = cal.dtz.defaultTimezone;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -63,28 +63,79 @@</span>
<a href="#l3.4"></a><span id="l3.4">     &lt;/menulist&gt;</span>
<a href="#l3.5"></a><span id="l3.5">     &lt;toolbarbutton id=&quot;zoom-in-button&quot;</span>
<a href="#l3.6"></a><span id="l3.6">                    class=&quot;zoom-in-icon&quot;</span>
<a href="#l3.7"></a><span id="l3.7">                    oncommand=&quot;zoomWithButtons(false);&quot;/&gt;</span>
<a href="#l3.8"></a><span id="l3.8">   &lt;/hbox&gt;</span>
<a href="#l3.9"></a><span id="l3.9">   &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l3.10"></a><span id="l3.10">     &lt;vbox id=&quot;attendees-container&quot; flex=&quot;1&quot; persist=&quot;width&quot;&gt;</span>
<a href="#l3.11"></a><span id="l3.11">       &lt;box class=&quot;attendee-spacer-top&quot;/&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-      &lt;attendees-list flex=&quot;1&quot; id=&quot;attendees-list&quot;/&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+      &lt;attendees-list flex=&quot;1&quot; id=&quot;attendees-list&quot; class=&quot;listbox-noborder&quot;&gt;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+        &lt;richlistitem class=&quot;addressingWidgetItem&quot; allowevents=&quot;true&quot;&gt;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+          &lt;hbox class=&quot;addressingWidgetCell&quot; width=&quot;27&quot; align=&quot;center&quot; pack=&quot;center&quot;&gt;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+            &lt;image class=&quot;status-icon&quot;/&gt;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+          &lt;hbox class=&quot;addressingWidgetCell&quot; width=&quot;16&quot;&gt;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+            &lt;image class=&quot;usertype-icon&quot; onclick=&quot;this.parentNode.select();&quot;/&gt;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+          &lt;hbox class=&quot;addressingWidgetCell&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+            &lt;textbox class=&quot;plain textbox-addressingWidget uri-element&quot;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+                     type=&quot;autocomplete&quot;</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+                     flex=&quot;1&quot;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+                     autocompletesearch=&quot;addrbook ldap&quot;</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+                     autocompletesearchparam=&quot;{}&quot;</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+                     timeout=&quot;300&quot;</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+                     maxrows=&quot;4&quot;</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+                     completedefaultindex=&quot;true&quot;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+                     forcecomplete=&quot;true&quot;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+                     completeselectedindex=&quot;true&quot;</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+                     minresultsforpopup=&quot;1&quot;</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+                     onblur=&quot;if (this.localName == 'textbox') this.closest(&amp;quot;attendees-list&amp;quot;).returnHit(this, true)&quot;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+                     ignoreblurwhilesearching=&quot;true&quot;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+                     oninput=&quot;this.setAttribute('dirty', 'true');&quot;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+                     ontextentered=&quot;this.closest(&amp;quot;attendees-list&amp;quot;).returnHit(this);&quot;&gt;</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+            &lt;/textbox&gt;</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+        &lt;/richlistitem&gt;</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+      &lt;/attendees-list&gt;</span>
<a href="#l3.41"></a><span id="l3.41">       &lt;box class=&quot;attendee-spacer-bottom&quot;/&gt;</span>
<a href="#l3.42"></a><span id="l3.42">     &lt;/vbox&gt;</span>
<a href="#l3.43"></a><span id="l3.43">     &lt;splitter id=&quot;splitter&quot;/&gt;</span>
<a href="#l3.44"></a><span id="l3.44">     &lt;vbox id=&quot;freebusy-container&quot; persist=&quot;width&quot;&gt;</span>
<a href="#l3.45"></a><span id="l3.45">       &lt;stack flex=&quot;1&quot;&gt;</span>
<a href="#l3.46"></a><span id="l3.46">         &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l3.47"></a><span id="l3.47">           &lt;freebusy-timebar id=&quot;timebar&quot;</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-                            range=&quot;16&quot;/&gt;</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+                            class=&quot;listbox-noborder&quot;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+                            seltype=&quot;multiple&quot;</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+                            rows=&quot;1&quot;</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+                            disabled=&quot;true&quot;</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+                            range=&quot;16&quot;&gt;</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+            &lt;richlistitem class=&quot;freebusy-listitem&quot;</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+                          allowevents=&quot;true&quot;&gt;</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+              &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+                &lt;scroll-container flex=&quot;1&quot;&gt;</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+                  &lt;freebusy-day/&gt;</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+                &lt;/scroll-container&gt;</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+              &lt;/hbox&gt;</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+            &lt;/richlistitem&gt;</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+          &lt;/freebusy-timebar&gt;</span>
<a href="#l3.63"></a><span id="l3.63">           &lt;freebusy-grid flex=&quot;1&quot;</span>
<a href="#l3.64"></a><span id="l3.64">                          id=&quot;freebusy-grid&quot;</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-                         range=&quot;16&quot;/&gt;</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+                         range=&quot;16&quot;</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+                         class=&quot;listbox-noborder&quot;</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+                         seltype=&quot;multiple&quot;</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+                         rows=&quot;-1&quot;</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+                         disabled=&quot;true&quot;&gt;</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+            &lt;richlistitem class=&quot;addressingWidgetItem&quot;</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+                          allowevents=&quot;true&quot;&gt;</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+              &lt;hbox class=&quot;addressingWidgetCell&quot;&gt;</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+                &lt;freebusy-row dirty=&quot;true&quot;/&gt;</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+              &lt;/hbox&gt;</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+            &lt;/richlistitem&gt;</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+          &lt;/freebusy-grid&gt;</span>
<a href="#l3.78"></a><span id="l3.78">         &lt;/vbox&gt;</span>
<a href="#l3.79"></a><span id="l3.79">         &lt;selection-bar id=&quot;selection-bar&quot;</span>
<a href="#l3.80"></a><span id="l3.80">                        range=&quot;16&quot;/&gt;</span>
<a href="#l3.81"></a><span id="l3.81">       &lt;/stack&gt;</span>
<a href="#l3.82"></a><span id="l3.82">       &lt;scrollbar orient=&quot;horizontal&quot;</span>
<a href="#l3.83"></a><span id="l3.83">                  id=&quot;horizontal-scrollbar&quot;</span>
<a href="#l3.84"></a><span id="l3.84">                  maxpos=&quot;100&quot;/&gt;</span>
<a href="#l3.85"></a><span id="l3.85">     &lt;/vbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -8,21 +8,16 @@</span>
<a href="#l4.4"></a><span id="l4.4">   &lt;!ENTITY % dtd2 SYSTEM &quot;chrome://calendar/locale/calendar.dtd&quot; &gt; %dtd2;</span>
<a href="#l4.5"></a><span id="l4.5">   &lt;!ENTITY % dtd3 SYSTEM &quot;chrome://calendar/locale/calendar-event-dialog.dtd&quot; &gt; %dtd3;</span>
<a href="#l4.6"></a><span id="l4.6"> ]&gt;</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> &lt;bindings xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l4.9"></a><span id="l4.9">           xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l4.10"></a><span id="l4.10">           xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  &lt;!--</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-  ########################################################################</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-  ## scroll-container</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-  ########################################################################</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-  --&gt;</span>
<a href="#l4.17"></a><span id="l4.17">   &lt;binding id=&quot;scroll-container&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l4.18"></a><span id="l4.18">     &lt;content&gt;</span>
<a href="#l4.19"></a><span id="l4.19">       &lt;xul:box class=&quot;container&quot;</span>
<a href="#l4.20"></a><span id="l4.20">                xbl:inherits=&quot;flex&quot;</span>
<a href="#l4.21"></a><span id="l4.21">                anonid=&quot;container&quot;</span>
<a href="#l4.22"></a><span id="l4.22">                style=&quot;overflow: hidden; clip: rect(0px 0px 0px 0px);&quot;&gt;</span>
<a href="#l4.23"></a><span id="l4.23">         &lt;xul:box class=&quot;content&quot;</span>
<a href="#l4.24"></a><span id="l4.24">                  xbl:inherits=&quot;flex,orient&quot;</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineat">@@ -66,21 +61,16 @@</span>
<a href="#l4.26"></a><span id="l4.26">             content.setAttribute(&quot;style&quot;,</span>
<a href="#l4.27"></a><span id="l4.27">                                  &quot;margin-top: &quot; + (-val) + &quot;px;&quot;);</span>
<a href="#l4.28"></a><span id="l4.28">             return val;</span>
<a href="#l4.29"></a><span id="l4.29">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.30"></a><span id="l4.30">       &lt;/property&gt;</span>
<a href="#l4.31"></a><span id="l4.31">     &lt;/implementation&gt;</span>
<a href="#l4.32"></a><span id="l4.32">   &lt;/binding&gt;</span>
<a href="#l4.33"></a><span id="l4.33"> </span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-  &lt;!--</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-  ########################################################################</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-  ## freebusy-day</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-  ########################################################################</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-  --&gt;</span>
<a href="#l4.39"></a><span id="l4.39">   &lt;binding id=&quot;freebusy-day&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l4.40"></a><span id="l4.40">     &lt;content&gt;</span>
<a href="#l4.41"></a><span id="l4.41">       &lt;xul:box orient=&quot;vertical&quot;&gt;</span>
<a href="#l4.42"></a><span id="l4.42">         &lt;xul:text class=&quot;freebusy-timebar-title&quot;</span>
<a href="#l4.43"></a><span id="l4.43">                   style=&quot;font-weight:bold;&quot;</span>
<a href="#l4.44"></a><span id="l4.44">                   anonid=&quot;day&quot;/&gt;</span>
<a href="#l4.45"></a><span id="l4.45">         &lt;xul:box equalsize=&quot;always&quot; anonid=&quot;hours&quot;/&gt;</span>
<a href="#l4.46"></a><span id="l4.46">       &lt;/xul:box&gt;</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineat">@@ -201,63 +191,36 @@</span>
<a href="#l4.48"></a><span id="l4.48">                 let count = Math.ceil(</span>
<a href="#l4.49"></a><span id="l4.49">                     (this.mEndHour - this.mStartHour) * 60 / step_in_minutes);</span>
<a href="#l4.50"></a><span id="l4.50">                 let remain = count;</span>
<a href="#l4.51"></a><span id="l4.51">                 let first = true;</span>
<a href="#l4.52"></a><span id="l4.52">                 while (remain--) {</span>
<a href="#l4.53"></a><span id="l4.53">                     let newNode = template.cloneNode(false);</span>
<a href="#l4.54"></a><span id="l4.54">                     let value = this.mDateFormatter.formatTime(date);</span>
<a href="#l4.55"></a><span id="l4.55">                     if (first) {</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-                        newNode.className += &quot; first-in-day&quot;;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+                        newNode.classList.add(&quot;first-in-day&quot;);</span>
<a href="#l4.58"></a><span id="l4.58">                         first = false;</span>
<a href="#l4.59"></a><span id="l4.59">                     }</span>
<a href="#l4.60"></a><span id="l4.60">                     newNode.setAttribute(&quot;value&quot;, value);</span>
<a href="#l4.61"></a><span id="l4.61">                     hours.appendChild(newNode);</span>
<a href="#l4.62"></a><span id="l4.62">                     date.minute += step_in_minutes;</span>
<a href="#l4.63"></a><span id="l4.63"> </span>
<a href="#l4.64"></a><span id="l4.64">                     if (remain == 0) {</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-                        newNode.className += &quot; last-in-day&quot;;</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+                        newNode.classList.add(&quot;last-in-day&quot;);</span>
<a href="#l4.67"></a><span id="l4.67">                     }</span>
<a href="#l4.68"></a><span id="l4.68">                 }</span>
<a href="#l4.69"></a><span id="l4.69">             }</span>
<a href="#l4.70"></a><span id="l4.70"> </span>
<a href="#l4.71"></a><span id="l4.71">             return val;</span>
<a href="#l4.72"></a><span id="l4.72">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.73"></a><span id="l4.73">       &lt;/property&gt;</span>
<a href="#l4.74"></a><span id="l4.74">     &lt;/implementation&gt;</span>
<a href="#l4.75"></a><span id="l4.75">   &lt;/binding&gt;</span>
<a href="#l4.76"></a><span id="l4.76"> </span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-  &lt;!--</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-  ########################################################################</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-  ## freebusy-timebar</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-  ########################################################################</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-  --&gt;</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-  &lt;binding id=&quot;freebusy-timebar&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-      &lt;xul:listbox anonid=&quot;listbox&quot;</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-                   class=&quot;listbox-noborder&quot;</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-                   seltype=&quot;multiple&quot;</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineminus">-                   rows=&quot;1&quot;</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-                   flex=&quot;1&quot;</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-                   disabled=&quot;true&quot;&gt;</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-        &lt;xul:listcols&gt;</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-          &lt;xul:listcol anonid=&quot;day-column&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-        &lt;/xul:listcols&gt;</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-        &lt;xul:listitem anonid=&quot;item&quot;</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineminus">-                      class=&quot;freebusy-listitem&quot;</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineminus">-                      allowevents=&quot;true&quot;&gt;</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineminus">-          &lt;xul:listcell &gt;</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">-            &lt;xul:scroll-container anonid=&quot;container&quot;&gt;</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-              &lt;xul:freebusy-day anonid=&quot;template&quot;/&gt;</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineminus">-            &lt;/xul:scroll-container&gt;</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-          &lt;/xul:listcell&gt;</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-        &lt;/xul:listitem&gt;</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineminus">-      &lt;/xul:listbox&gt;</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineplus">+  &lt;binding id=&quot;freebusy-timebar&quot; extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistbox&quot;&gt;</span>
<a href="#l4.106"></a><span id="l4.106">     &lt;implementation&gt;</span>
<a href="#l4.107"></a><span id="l4.107">       &lt;field name=&quot;mNumDays&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.108"></a><span id="l4.108">       &lt;field name=&quot;mRange&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.109"></a><span id="l4.109">       &lt;field name=&quot;mStartDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.110"></a><span id="l4.110">       &lt;field name=&quot;mEndDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.111"></a><span id="l4.111">       &lt;field name=&quot;mDayOffset&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.112"></a><span id="l4.112">       &lt;field name=&quot;mScrollOffset&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.113"></a><span id="l4.113">       &lt;field name=&quot;mStartHour&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineat">@@ -267,19 +230,17 @@</span>
<a href="#l4.115"></a><span id="l4.115"> </span>
<a href="#l4.116"></a><span id="l4.116">       &lt;property name=&quot;zoomFactor&quot;&gt;</span>
<a href="#l4.117"></a><span id="l4.117">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.118"></a><span id="l4.118">             return this.mZoomFactor;</span>
<a href="#l4.119"></a><span id="l4.119">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.120"></a><span id="l4.120">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.121"></a><span id="l4.121">             this.mZoomFactor = val;</span>
<a href="#l4.122"></a><span id="l4.122"> </span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">-            let template =</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;template&quot;);</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineplus">+            let template = this.getElementsByTagName(&quot;freebusy-day&quot;)[0];</span>
<a href="#l4.127"></a><span id="l4.127">             let parent = template.parentNode;</span>
<a href="#l4.128"></a><span id="l4.128">             while (parent.childNodes.length &gt; 1) {</span>
<a href="#l4.129"></a><span id="l4.129">                 parent.lastChild.remove();</span>
<a href="#l4.130"></a><span id="l4.130">             }</span>
<a href="#l4.131"></a><span id="l4.131"> </span>
<a href="#l4.132"></a><span id="l4.132">             template.force24Hours = this.mForce24Hours;</span>
<a href="#l4.133"></a><span id="l4.133">             template.zoomFactor = this.mZoomFactor;</span>
<a href="#l4.134"></a><span id="l4.134"> </span>
<a href="#l4.135"></a><span id="l4.135" class="difflineat">@@ -292,19 +253,17 @@</span>
<a href="#l4.136"></a><span id="l4.136">       &lt;property name=&quot;force24Hours&quot;&gt;</span>
<a href="#l4.137"></a><span id="l4.137">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.138"></a><span id="l4.138">             return this.mForce24Hours;</span>
<a href="#l4.139"></a><span id="l4.139">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.140"></a><span id="l4.140">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.141"></a><span id="l4.141">             this.mForce24Hours = val;</span>
<a href="#l4.142"></a><span id="l4.142">             this.initTimeRange();</span>
<a href="#l4.143"></a><span id="l4.143"> </span>
<a href="#l4.144"></a><span id="l4.144" class="difflineminus">-            let template =</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;template&quot;);</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineplus">+            let template = this.getElementsByTagName(&quot;freebusy-day&quot;)[0];</span>
<a href="#l4.148"></a><span id="l4.148"> </span>
<a href="#l4.149"></a><span id="l4.149">             let parent = template.parentNode;</span>
<a href="#l4.150"></a><span id="l4.150">             while (parent.childNodes.length &gt; 1) {</span>
<a href="#l4.151"></a><span id="l4.151">                 parent.lastChild.remove();</span>
<a href="#l4.152"></a><span id="l4.152">             }</span>
<a href="#l4.153"></a><span id="l4.153"> </span>
<a href="#l4.154"></a><span id="l4.154">             template.force24Hours = this.mForce24Hours;</span>
<a href="#l4.155"></a><span id="l4.155">             template.zoomFactor = this.mZoomFactor;</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineat">@@ -315,19 +274,17 @@</span>
<a href="#l4.157"></a><span id="l4.157">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.158"></a><span id="l4.158">       &lt;/property&gt;</span>
<a href="#l4.159"></a><span id="l4.159"> </span>
<a href="#l4.160"></a><span id="l4.160">       &lt;property name=&quot;contentWidth&quot;&gt;</span>
<a href="#l4.161"></a><span id="l4.161">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.162"></a><span id="l4.162">             // Calculate the difference between the first to day-elements, since</span>
<a href="#l4.163"></a><span id="l4.163">             // the width of the head element does not specify the width we need</span>
<a href="#l4.164"></a><span id="l4.164">             // due to an arbitrary margin value.</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-            let template =</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;template&quot;);</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineplus">+            let template = this.getElementsByTagName(&quot;freebusy-day&quot;)[0];</span>
<a href="#l4.169"></a><span id="l4.169">             return template.nextSibling.boxObject.x - template.boxObject.x;</span>
<a href="#l4.170"></a><span id="l4.170">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.171"></a><span id="l4.171">       &lt;/property&gt;</span>
<a href="#l4.172"></a><span id="l4.172"> </span>
<a href="#l4.173"></a><span id="l4.173">       &lt;property name=&quot;containerWidth&quot;&gt;</span>
<a href="#l4.174"></a><span id="l4.174">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.175"></a><span id="l4.175">             return this.parentNode.boxObject.width;</span>
<a href="#l4.176"></a><span id="l4.176">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineat">@@ -353,19 +310,17 @@</span>
<a href="#l4.178"></a><span id="l4.178">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.179"></a><span id="l4.179">             return this.mEndDate;</span>
<a href="#l4.180"></a><span id="l4.180">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.181"></a><span id="l4.181">       &lt;/property&gt;</span>
<a href="#l4.182"></a><span id="l4.182"> </span>
<a href="#l4.183"></a><span id="l4.183">       &lt;property name=&quot;dayOffset&quot;&gt;</span>
<a href="#l4.184"></a><span id="l4.184">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.185"></a><span id="l4.185">             this.mDayOffset = val;</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineminus">-            let container =</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;container&quot;);</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineplus">+            let container = this.getElementsByTagName(&quot;scroll-container&quot;)[0];</span>
<a href="#l4.190"></a><span id="l4.190">             let date = this.mStartDate.clone();</span>
<a href="#l4.191"></a><span id="l4.191">             date.day += val;</span>
<a href="#l4.192"></a><span id="l4.192">             let numChilds = container.childNodes.length;</span>
<a href="#l4.193"></a><span id="l4.193">             for (let i = 0; i &lt; numChilds; i++) {</span>
<a href="#l4.194"></a><span id="l4.194">                 let child = container.childNodes[i];</span>
<a href="#l4.195"></a><span id="l4.195">                 child.date = date;</span>
<a href="#l4.196"></a><span id="l4.196">                 date.day++;</span>
<a href="#l4.197"></a><span id="l4.197">             }</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineat">@@ -407,19 +362,17 @@</span>
<a href="#l4.199"></a><span id="l4.199">             // this is a simple division which always yields a positive integer value.</span>
<a href="#l4.200"></a><span id="l4.200">             this.dayOffset = (offset - (offset % oneday)) / oneday;</span>
<a href="#l4.201"></a><span id="l4.201"> </span>
<a href="#l4.202"></a><span id="l4.202">             // Set the pixel offset for the content which will always need</span>
<a href="#l4.203"></a><span id="l4.203">             // to be in the range [0 &lt;= offset &lt;= oneday].</span>
<a href="#l4.204"></a><span id="l4.204">             offset %= oneday;</span>
<a href="#l4.205"></a><span id="l4.205"> </span>
<a href="#l4.206"></a><span id="l4.206">             // Set the offset at the content node.</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineminus">-            let container =</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;container&quot;);</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineplus">+            let container = this.getElementsByTagName(&quot;scroll-container&quot;)[0];</span>
<a href="#l4.211"></a><span id="l4.211">             container.x = offset;</span>
<a href="#l4.212"></a><span id="l4.212">             return val;</span>
<a href="#l4.213"></a><span id="l4.213">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.214"></a><span id="l4.214">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.215"></a><span id="l4.215">             return this.mScrollOffset;</span>
<a href="#l4.216"></a><span id="l4.216">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.217"></a><span id="l4.217">       &lt;/property&gt;</span>
<a href="#l4.218"></a><span id="l4.218"> </span>
<a href="#l4.219"></a><span id="l4.219" class="difflineat">@@ -435,27 +388,26 @@</span>
<a href="#l4.220"></a><span id="l4.220"> </span>
<a href="#l4.221"></a><span id="l4.221">           // The basedate is the date/time from which the display</span>
<a href="#l4.222"></a><span id="l4.222">           // of the timebar starts. The range is the number of days</span>
<a href="#l4.223"></a><span id="l4.223">           // we should be able to show. The start- and enddate</span>
<a href="#l4.224"></a><span id="l4.224">           // is the time the event is scheduled for.</span>
<a href="#l4.225"></a><span id="l4.225">           let kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l4.226"></a><span id="l4.226">           this.startDate = startTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l4.227"></a><span id="l4.227">           this.endDate = endTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineminus">-          this.mRange = Number(this.getAttribute(&quot;range&quot;));</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineplus">+          let grid = document.getElementById(&quot;freebusy-grid&quot;);</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineplus">+          this.mRange = Number(grid.getAttribute(&quot;range&quot;));</span>
<a href="#l4.231"></a><span id="l4.231"> </span>
<a href="#l4.232"></a><span id="l4.232">           window.addEventListener(&quot;load&quot;, this.onLoad.bind(this), true);</span>
<a href="#l4.233"></a><span id="l4.233">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l4.234"></a><span id="l4.234"> </span>
<a href="#l4.235"></a><span id="l4.235">       &lt;method name=&quot;refresh&quot;&gt;</span>
<a href="#l4.236"></a><span id="l4.236">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.237"></a><span id="l4.237">             let date = this.mStartDate.clone();</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineminus">-            let template =</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;template&quot;);</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineplus">+            let template = this.getElementsByTagName(&quot;freebusy-day&quot;)[0];</span>
<a href="#l4.242"></a><span id="l4.242">             let parent = template.parentNode;</span>
<a href="#l4.243"></a><span id="l4.243">             let numChilds = parent.childNodes.length;</span>
<a href="#l4.244"></a><span id="l4.244">             for (let i = 0; i &lt; numChilds; i++) {</span>
<a href="#l4.245"></a><span id="l4.245">                 let child = parent.childNodes[i];</span>
<a href="#l4.246"></a><span id="l4.246">                 child.startDate = this.mStartDate;</span>
<a href="#l4.247"></a><span id="l4.247">                 child.endDate = this.mEndDate;</span>
<a href="#l4.248"></a><span id="l4.248">                 child.date = date;</span>
<a href="#l4.249"></a><span id="l4.249">                 date.day++;</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineat">@@ -463,68 +415,66 @@</span>
<a href="#l4.251"></a><span id="l4.251">             let offset = this.mDayOffset;</span>
<a href="#l4.252"></a><span id="l4.252">             this.dayOffset = offset;</span>
<a href="#l4.253"></a><span id="l4.253">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.254"></a><span id="l4.254">       &lt;/method&gt;</span>
<a href="#l4.255"></a><span id="l4.255"> </span>
<a href="#l4.256"></a><span id="l4.256">       &lt;method name=&quot;onLoad&quot;&gt;</span>
<a href="#l4.257"></a><span id="l4.257">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.258"></a><span id="l4.258">             this.initialize();</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineminus">-            let template =</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;template&quot;);</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineminus">-            let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-            event.initEvent(&quot;timebar&quot;, true, false);</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineminus">-            event.details = this.contentWidth;</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineminus">-            event.height = template.dayHeight;</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineminus">-            this.dispatchEvent(event);</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineplus">+            setTimeout(() =&gt; {</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineplus">+                let template = this.getElementsByTagName(&quot;freebusy-day&quot;)[0];</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineplus">+                let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineplus">+                event.initEvent(&quot;timebar&quot;, true, false);</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineplus">+                event.details = this.contentWidth;</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineplus">+                event.height = template.dayHeight;</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineplus">+                this.dispatchEvent(event);</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineplus">+            }, 0);</span>
<a href="#l4.275"></a><span id="l4.275">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.276"></a><span id="l4.276">       &lt;/method&gt;</span>
<a href="#l4.277"></a><span id="l4.277"> </span>
<a href="#l4.278"></a><span id="l4.278">       &lt;method name=&quot;initialize&quot;&gt;</span>
<a href="#l4.279"></a><span id="l4.279">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.280"></a><span id="l4.280">             let args = window.arguments[0];</span>
<a href="#l4.281"></a><span id="l4.281">             let startTime = args.startTime;</span>
<a href="#l4.282"></a><span id="l4.282">             let endTime = args.endTime;</span>
<a href="#l4.283"></a><span id="l4.283"> </span>
<a href="#l4.284"></a><span id="l4.284">             let kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineminus">-            this.startDate = startTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineminus">-            this.endDate = endTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineplus">+            this.mStartDate = startTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineplus">+            this.mEndDate = endTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l4.289"></a><span id="l4.289"> </span>
<a href="#l4.290"></a><span id="l4.290">             // Set the number of 'freebusy-day'-elements</span>
<a href="#l4.291"></a><span id="l4.291">             // we need to fill up the content box.</span>
<a href="#l4.292"></a><span id="l4.292">             // TODO: hardcoded value</span>
<a href="#l4.293"></a><span id="l4.293">             this.mNumDays = 4 * this.mZoomFactor / 100;</span>
<a href="#l4.294"></a><span id="l4.294">             if (this.mNumDays &lt; 2) {</span>
<a href="#l4.295"></a><span id="l4.295">                 this.mNumDays = 2;</span>
<a href="#l4.296"></a><span id="l4.296">             }</span>
<a href="#l4.297"></a><span id="l4.297"> </span>
<a href="#l4.298"></a><span id="l4.298">             // Now create those elements and set their date property.</span>
<a href="#l4.299"></a><span id="l4.299">             let date = this.mStartDate.clone();</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineminus">-            let template =</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;template&quot;);</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineplus">+            let template = this.getElementsByTagName(&quot;freebusy-day&quot;)[0];</span>
<a href="#l4.304"></a><span id="l4.304">             template.force24Hours = this.mForce24Hours;</span>
<a href="#l4.305"></a><span id="l4.305">             template.zoomFactor = this.mZoomFactor;</span>
<a href="#l4.306"></a><span id="l4.306">             template.startDate = this.mStartDate;</span>
<a href="#l4.307"></a><span id="l4.307">             template.endDate = this.mEndDate;</span>
<a href="#l4.308"></a><span id="l4.308">             template.date = date;</span>
<a href="#l4.309"></a><span id="l4.309">             let parent = template.parentNode;</span>
<a href="#l4.310"></a><span id="l4.310">             if (parent.childNodes.length &lt;= 1) {</span>
<a href="#l4.311"></a><span id="l4.311">                 let count = this.mNumDays - 1;</span>
<a href="#l4.312"></a><span id="l4.312">                 if (count &gt; 0) {</span>
<a href="#l4.313"></a><span id="l4.313">                     for (let i = 0; i &lt; count; i++) {</span>
<a href="#l4.314"></a><span id="l4.314">                         date.day++;</span>
<a href="#l4.315"></a><span id="l4.315">                         let newNode = template.cloneNode(false);</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineplus">+                        parent.appendChild(newNode);</span>
<a href="#l4.317"></a><span id="l4.317">                         newNode.force24Hours = this.mForce24Hours;</span>
<a href="#l4.318"></a><span id="l4.318">                         newNode.zoomFactor = this.mZoomFactor;</span>
<a href="#l4.319"></a><span id="l4.319">                         newNode.startDate = this.mStartDate;</span>
<a href="#l4.320"></a><span id="l4.320">                         newNode.endDate = this.mEndDate;</span>
<a href="#l4.321"></a><span id="l4.321">                         newNode.date = date;</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineminus">-                        parent.appendChild(newNode);</span>
<a href="#l4.323"></a><span id="l4.323">                     }</span>
<a href="#l4.324"></a><span id="l4.324">                 }</span>
<a href="#l4.325"></a><span id="l4.325">             }</span>
<a href="#l4.326"></a><span id="l4.326">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.327"></a><span id="l4.327">       &lt;/method&gt;</span>
<a href="#l4.328"></a><span id="l4.328"> </span>
<a href="#l4.329"></a><span id="l4.329">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l4.330"></a><span id="l4.330">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.331"></a><span id="l4.331" class="difflineat">@@ -535,21 +485,16 @@</span>
<a href="#l4.332"></a><span id="l4.332">                 this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l4.333"></a><span id="l4.333">                 this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l4.334"></a><span id="l4.334">             }</span>
<a href="#l4.335"></a><span id="l4.335">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.336"></a><span id="l4.336">       &lt;/method&gt;</span>
<a href="#l4.337"></a><span id="l4.337">     &lt;/implementation&gt;</span>
<a href="#l4.338"></a><span id="l4.338">   &lt;/binding&gt;</span>
<a href="#l4.339"></a><span id="l4.339"> </span>
<a href="#l4.340"></a><span id="l4.340" class="difflineminus">-  &lt;!--</span>
<a href="#l4.341"></a><span id="l4.341" class="difflineminus">-  ########################################################################</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineminus">-  ## freebusy-row</span>
<a href="#l4.343"></a><span id="l4.343" class="difflineminus">-  ########################################################################</span>
<a href="#l4.344"></a><span id="l4.344" class="difflineminus">-  --&gt;</span>
<a href="#l4.345"></a><span id="l4.345">   &lt;binding id=&quot;freebusy-row&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l4.346"></a><span id="l4.346">     &lt;content&gt;</span>
<a href="#l4.347"></a><span id="l4.347">       &lt;xul:scroll-container flex=&quot;1&quot; anonid=&quot;container&quot;&gt;</span>
<a href="#l4.348"></a><span id="l4.348">         &lt;xul:box equalsize=&quot;always&quot; anonid=&quot;hours&quot;/&gt;</span>
<a href="#l4.349"></a><span id="l4.349">       &lt;/xul:scroll-container&gt;</span>
<a href="#l4.350"></a><span id="l4.350">     &lt;/content&gt;</span>
<a href="#l4.351"></a><span id="l4.351"> </span>
<a href="#l4.352"></a><span id="l4.352">     &lt;implementation&gt;</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineat">@@ -652,52 +597,33 @@</span>
<a href="#l4.354"></a><span id="l4.354">       &lt;property name=&quot;documentSize&quot;&gt;</span>
<a href="#l4.355"></a><span id="l4.355">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.356"></a><span id="l4.356">             return this.contentWidth * this.mRange;</span>
<a href="#l4.357"></a><span id="l4.357">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.358"></a><span id="l4.358">       &lt;/property&gt;</span>
<a href="#l4.359"></a><span id="l4.359"> </span>
<a href="#l4.360"></a><span id="l4.360">       &lt;property name=&quot;scroll&quot;&gt;</span>
<a href="#l4.361"></a><span id="l4.361">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.362"></a><span id="l4.362" class="difflineminus">-            // How much pixels spans a single day</span>
<a href="#l4.363"></a><span id="l4.363" class="difflineminus">-            let oneday = this.contentWidth;</span>
<a href="#l4.364"></a><span id="l4.364" class="difflineminus">-            if (oneday &lt;= 0) {</span>
<a href="#l4.365"></a><span id="l4.365" class="difflineminus">-                return val;</span>
<a href="#l4.366"></a><span id="l4.366" class="difflineminus">-            }</span>
<a href="#l4.367"></a><span id="l4.367" class="difflineminus">-</span>
<a href="#l4.368"></a><span id="l4.368" class="difflineminus">-            // The difference in pixels between the content and the container.</span>
<a href="#l4.369"></a><span id="l4.369" class="difflineminus">-            let shift = (oneday * this.mRange) - (this.containerWidth);</span>
<a href="#l4.370"></a><span id="l4.370" class="difflineminus">-</span>
<a href="#l4.371"></a><span id="l4.371" class="difflineminus">-            // Now calculate the (positive) offset in pixels which the content</span>
<a href="#l4.372"></a><span id="l4.372" class="difflineminus">-            // needs to be shifted. This is a simple scaling in one dimension.</span>
<a href="#l4.373"></a><span id="l4.373" class="difflineminus">-            let offset = Math.floor(val * shift);</span>
<a href="#l4.374"></a><span id="l4.374" class="difflineminus">-</span>
<a href="#l4.375"></a><span id="l4.375" class="difflineminus">-            // Now find out how much days this offset effectively skips.</span>
<a href="#l4.376"></a><span id="l4.376" class="difflineminus">-            // this is a simple division which always yields a positive integer value.</span>
<a href="#l4.377"></a><span id="l4.377" class="difflineminus">-            this.dayOffset = (offset - (offset % oneday)) / oneday;</span>
<a href="#l4.378"></a><span id="l4.378" class="difflineminus">-</span>
<a href="#l4.379"></a><span id="l4.379" class="difflineminus">-            // Set the pixel offset for the content which will always need</span>
<a href="#l4.380"></a><span id="l4.380" class="difflineminus">-            // to be in the range [0 &lt;= offset &lt;= oneday].</span>
<a href="#l4.381"></a><span id="l4.381" class="difflineminus">-            offset %= oneday;</span>
<a href="#l4.382"></a><span id="l4.382" class="difflineplus">+            let timebarContainer = document.querySelector(&quot;#timebar scroll-container&quot;);</span>
<a href="#l4.383"></a><span id="l4.383" class="difflineplus">+            let offset = timebarContainer.x;</span>
<a href="#l4.384"></a><span id="l4.384"> </span>
<a href="#l4.385"></a><span id="l4.385">             // Set the offset at the content node.</span>
<a href="#l4.386"></a><span id="l4.386" class="difflineminus">-            let container =</span>
<a href="#l4.387"></a><span id="l4.387" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.388"></a><span id="l4.388" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;container&quot;);</span>
<a href="#l4.389"></a><span id="l4.389" class="difflineplus">+            let container = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;container&quot;);</span>
<a href="#l4.390"></a><span id="l4.390">             container.x = offset;</span>
<a href="#l4.391"></a><span id="l4.391">             return val;</span>
<a href="#l4.392"></a><span id="l4.392">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.393"></a><span id="l4.393">       &lt;/property&gt;</span>
<a href="#l4.394"></a><span id="l4.394"> </span>
<a href="#l4.395"></a><span id="l4.395">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l4.396"></a><span id="l4.396">           ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l4.397"></a><span id="l4.397">           ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l4.398"></a><span id="l4.398"> </span>
<a href="#l4.399"></a><span id="l4.399">           this.initTimeRange();</span>
<a href="#l4.400"></a><span id="l4.400" class="difflineminus">-          this.mRange = Number(this.getAttribute(&quot;range&quot;));</span>
<a href="#l4.401"></a><span id="l4.401" class="difflineplus">+          let grid = document.getElementById(&quot;freebusy-grid&quot;);</span>
<a href="#l4.402"></a><span id="l4.402" class="difflineplus">+          this.mRange = Number(grid.getAttribute(&quot;range&quot;));</span>
<a href="#l4.403"></a><span id="l4.403">           this.onLoad();</span>
<a href="#l4.404"></a><span id="l4.404">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l4.405"></a><span id="l4.405"> </span>
<a href="#l4.406"></a><span id="l4.406">       &lt;method name=&quot;onLoad&quot;&gt;</span>
<a href="#l4.407"></a><span id="l4.407">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.408"></a><span id="l4.408">             let numHours = this.mEndHour - this.mStartHour;</span>
<a href="#l4.409"></a><span id="l4.409">             this.mState = new Array(this.mRange * numHours);</span>
<a href="#l4.410"></a><span id="l4.410">             for (let i = 0; i &lt; this.mState.length; i++) {</span>
<a href="#l4.411"></a><span id="l4.411" class="difflineat">@@ -724,26 +650,26 @@</span>
<a href="#l4.412"></a><span id="l4.412">                     (this.mEndHour - this.mStartHour) * 60 / step_in_minutes);</span>
<a href="#l4.413"></a><span id="l4.413">                 let remain = count;</span>
<a href="#l4.414"></a><span id="l4.414">                 for (let day = 1; day &lt;= num_days; day++) {</span>
<a href="#l4.415"></a><span id="l4.415">                     let first = true;</span>
<a href="#l4.416"></a><span id="l4.416">                     while (remain--) {</span>
<a href="#l4.417"></a><span id="l4.417">                         let newNode = template.cloneNode(false);</span>
<a href="#l4.418"></a><span id="l4.418">                         let value = formatter.formatTime(date);</span>
<a href="#l4.419"></a><span id="l4.419">                         if (first) {</span>
<a href="#l4.420"></a><span id="l4.420" class="difflineminus">-                            newNode.className += &quot; first-in-day&quot;;</span>
<a href="#l4.421"></a><span id="l4.421" class="difflineplus">+                            newNode.classList.add(&quot;first-in-day&quot;);</span>
<a href="#l4.422"></a><span id="l4.422">                             first = false;</span>
<a href="#l4.423"></a><span id="l4.423">                         }</span>
<a href="#l4.424"></a><span id="l4.424"> </span>
<a href="#l4.425"></a><span id="l4.425">                         newNode.setAttribute(&quot;value&quot;, value);</span>
<a href="#l4.426"></a><span id="l4.426">                         hours.appendChild(newNode);</span>
<a href="#l4.427"></a><span id="l4.427">                         date.minute += step_in_minutes;</span>
<a href="#l4.428"></a><span id="l4.428"> </span>
<a href="#l4.429"></a><span id="l4.429">                         if (remain == 0) {</span>
<a href="#l4.430"></a><span id="l4.430" class="difflineminus">-                            newNode.className += &quot; last-in-day&quot;;</span>
<a href="#l4.431"></a><span id="l4.431" class="difflineplus">+                            newNode.classList.add(&quot;last-in-day&quot;);</span>
<a href="#l4.432"></a><span id="l4.432">                         }</span>
<a href="#l4.433"></a><span id="l4.433">                     }</span>
<a href="#l4.434"></a><span id="l4.434">                     date.hour = this.mStartHour;</span>
<a href="#l4.435"></a><span id="l4.435">                     date.day++;</span>
<a href="#l4.436"></a><span id="l4.436">                     remain = count;</span>
<a href="#l4.437"></a><span id="l4.437">                 }</span>
<a href="#l4.438"></a><span id="l4.438">             }</span>
<a href="#l4.439"></a><span id="l4.439">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.440"></a><span id="l4.440" class="difflineat">@@ -967,50 +893,20 @@</span>
<a href="#l4.441"></a><span id="l4.441">                 this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l4.442"></a><span id="l4.442">                 this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l4.443"></a><span id="l4.443">             }</span>
<a href="#l4.444"></a><span id="l4.444">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.445"></a><span id="l4.445">       &lt;/method&gt;</span>
<a href="#l4.446"></a><span id="l4.446">     &lt;/implementation&gt;</span>
<a href="#l4.447"></a><span id="l4.447">   &lt;/binding&gt;</span>
<a href="#l4.448"></a><span id="l4.448"> </span>
<a href="#l4.449"></a><span id="l4.449" class="difflineminus">-  &lt;!-- ############################################################################# --&gt;</span>
<a href="#l4.450"></a><span id="l4.450" class="difflineminus">-  &lt;!-- 'freebusy-grid'-binding                                                       --&gt;</span>
<a href="#l4.451"></a><span id="l4.451" class="difflineminus">-  &lt;!-- ############################################################################# --&gt;</span>
<a href="#l4.452"></a><span id="l4.452" class="difflineminus">-</span>
<a href="#l4.453"></a><span id="l4.453" class="difflineminus">-  &lt;!-- id's are evil, use anonid --&gt;</span>
<a href="#l4.454"></a><span id="l4.454" class="difflineminus">-  &lt;binding id=&quot;freebusy-grid&quot;&gt;</span>
<a href="#l4.455"></a><span id="l4.455" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l4.456"></a><span id="l4.456" class="difflineminus">-      &lt;xul:listbox anonid=&quot;listbox&quot;</span>
<a href="#l4.457"></a><span id="l4.457" class="difflineminus">-                   class=&quot;listbox-noborder&quot;</span>
<a href="#l4.458"></a><span id="l4.458" class="difflineminus">-                   seltype=&quot;multiple&quot;</span>
<a href="#l4.459"></a><span id="l4.459" class="difflineminus">-                   rows=&quot;-1&quot;</span>
<a href="#l4.460"></a><span id="l4.460" class="difflineminus">-                   disabled=&quot;true&quot;</span>
<a href="#l4.461"></a><span id="l4.461" class="difflineminus">-                   flex=&quot;1&quot;</span>
<a href="#l4.462"></a><span id="l4.462" class="difflineminus">-                   style=&quot;min-width: 50em; min-height: 30em&quot;&gt;</span>
<a href="#l4.463"></a><span id="l4.463" class="difflineminus">-        &lt;xul:listcols&gt;</span>
<a href="#l4.464"></a><span id="l4.464" class="difflineminus">-          &lt;xul:listcol anonid=&quot;grid-column&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l4.465"></a><span id="l4.465" class="difflineminus">-        &lt;/xul:listcols&gt;</span>
<a href="#l4.466"></a><span id="l4.466" class="difflineminus">-        &lt;xul:listitem anonid=&quot;item&quot;</span>
<a href="#l4.467"></a><span id="l4.467" class="difflineminus">-                      class=&quot;addressingWidgetItem&quot;</span>
<a href="#l4.468"></a><span id="l4.468" class="difflineminus">-                      allowevents=&quot;true&quot;&gt;</span>
<a href="#l4.469"></a><span id="l4.469" class="difflineminus">-          &lt;xul:listcell class=&quot;addressingWidgetCell&quot;&gt;</span>
<a href="#l4.470"></a><span id="l4.470" class="difflineminus">-            &lt;xul:freebusy-row id=&quot;attendeeCol4#1&quot;</span>
<a href="#l4.471"></a><span id="l4.471" class="difflineminus">-                              anonid=&quot;grid&quot;</span>
<a href="#l4.472"></a><span id="l4.472" class="difflineminus">-                              dirty=&quot;true&quot;</span>
<a href="#l4.473"></a><span id="l4.473" class="difflineminus">-                              xbl:inherits=&quot;range&quot;/&gt;</span>
<a href="#l4.474"></a><span id="l4.474" class="difflineminus">-          &lt;/xul:listcell&gt;</span>
<a href="#l4.475"></a><span id="l4.475" class="difflineminus">-        &lt;/xul:listitem&gt;</span>
<a href="#l4.476"></a><span id="l4.476" class="difflineminus">-      &lt;/xul:listbox&gt;</span>
<a href="#l4.477"></a><span id="l4.477" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l4.478"></a><span id="l4.478" class="difflineminus">-</span>
<a href="#l4.479"></a><span id="l4.479" class="difflineplus">+  &lt;binding id=&quot;freebusy-grid&quot; extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistbox&quot;&gt;</span>
<a href="#l4.480"></a><span id="l4.480">     &lt;implementation&gt;</span>
<a href="#l4.481"></a><span id="l4.481">       &lt;field name=&quot;mContentHeight&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.482"></a><span id="l4.482">       &lt;field name=&quot;mRowHeight&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.483"></a><span id="l4.483" class="difflineminus">-      &lt;field name=&quot;mNumColumns&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.484"></a><span id="l4.484">       &lt;field name=&quot;mMaxFreeBusy&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.485"></a><span id="l4.485">       &lt;field name=&quot;mPendingRequests&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.486"></a><span id="l4.486">       &lt;field name=&quot;mStartDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.487"></a><span id="l4.487">       &lt;field name=&quot;mEndDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.488"></a><span id="l4.488">       &lt;field name=&quot;mScrollOffset&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.489"></a><span id="l4.489">       &lt;field name=&quot;mRange&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.490"></a><span id="l4.490">       &lt;field name=&quot;mStartHour&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.491"></a><span id="l4.491">       &lt;field name=&quot;mEndHour&quot;&gt;24&lt;/field&gt;</span>
<a href="#l4.492"></a><span id="l4.492" class="difflineat">@@ -1044,48 +940,40 @@</span>
<a href="#l4.493"></a><span id="l4.493">                 freebusy.force24Hours = this.mForce24Hours;</span>
<a href="#l4.494"></a><span id="l4.494">             }</span>
<a href="#l4.495"></a><span id="l4.495">             return val;</span>
<a href="#l4.496"></a><span id="l4.496">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.497"></a><span id="l4.497">       &lt;/property&gt;</span>
<a href="#l4.498"></a><span id="l4.498"> </span>
<a href="#l4.499"></a><span id="l4.499">       &lt;property name=&quot;firstVisibleRow&quot;&gt;</span>
<a href="#l4.500"></a><span id="l4.500">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.501"></a><span id="l4.501" class="difflineminus">-            let listbox =</span>
<a href="#l4.502"></a><span id="l4.502" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.503"></a><span id="l4.503" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l4.504"></a><span id="l4.504" class="difflineminus">-            return listbox.getIndexOfFirstVisibleRow();</span>
<a href="#l4.505"></a><span id="l4.505" class="difflineplus">+            return this.getIndexOfFirstVisibleRow();</span>
<a href="#l4.506"></a><span id="l4.506">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.507"></a><span id="l4.507">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.508"></a><span id="l4.508" class="difflineminus">-            let listbox =</span>
<a href="#l4.509"></a><span id="l4.509" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.510"></a><span id="l4.510" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l4.511"></a><span id="l4.511" class="difflineminus">-            listbox.scrollToIndex(val);</span>
<a href="#l4.512"></a><span id="l4.512" class="difflineplus">+            this.scrollToIndex(val);</span>
<a href="#l4.513"></a><span id="l4.513">             return val;</span>
<a href="#l4.514"></a><span id="l4.514">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.515"></a><span id="l4.515">       &lt;/property&gt;</span>
<a href="#l4.516"></a><span id="l4.516"> </span>
<a href="#l4.517"></a><span id="l4.517">       &lt;property name=&quot;ratio&quot;&gt;</span>
<a href="#l4.518"></a><span id="l4.518">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.519"></a><span id="l4.519" class="difflineminus">-            let listbox =</span>
<a href="#l4.520"></a><span id="l4.520" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.521"></a><span id="l4.521" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l4.522"></a><span id="l4.522" class="difflineminus">-            let rowcount = listbox.getRowCount();</span>
<a href="#l4.523"></a><span id="l4.523" class="difflineminus">-            listbox.scrollToIndex(Math.floor(rowcount * val));</span>
<a href="#l4.524"></a><span id="l4.524" class="difflineplus">+            let rowcount = this.getRowCount();</span>
<a href="#l4.525"></a><span id="l4.525" class="difflineplus">+            this.scrollToIndex(Math.floor(rowcount * val));</span>
<a href="#l4.526"></a><span id="l4.526">             return val;</span>
<a href="#l4.527"></a><span id="l4.527">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.528"></a><span id="l4.528">       &lt;/property&gt;</span>
<a href="#l4.529"></a><span id="l4.529"> </span>
<a href="#l4.530"></a><span id="l4.530">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l4.531"></a><span id="l4.531">           ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l4.532"></a><span id="l4.532">           ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l4.533"></a><span id="l4.533"> </span>
<a href="#l4.534"></a><span id="l4.534">           this.initTimeRange();</span>
<a href="#l4.535"></a><span id="l4.535"> </span>
<a href="#l4.536"></a><span id="l4.536" class="difflineminus">-          this.mRange = Number(this.getAttribute(&quot;range&quot;));</span>
<a href="#l4.537"></a><span id="l4.537" class="difflineplus">+          let grid = document.getElementById(&quot;freebusy-grid&quot;);</span>
<a href="#l4.538"></a><span id="l4.538" class="difflineplus">+          this.mRange = Number(grid.getAttribute(&quot;range&quot;));</span>
<a href="#l4.539"></a><span id="l4.539"> </span>
<a href="#l4.540"></a><span id="l4.540">           this.mMaxFreeBusy = 0;</span>
<a href="#l4.541"></a><span id="l4.541">           this.mPendingRequests = [];</span>
<a href="#l4.542"></a><span id="l4.542"> </span>
<a href="#l4.543"></a><span id="l4.543">           window.addEventListener(&quot;load&quot;, this.onLoad.bind(this), true);</span>
<a href="#l4.544"></a><span id="l4.544">           window.addEventListener(&quot;unload&quot;, this.onUnload.bind(this), true);</span>
<a href="#l4.545"></a><span id="l4.545">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l4.546"></a><span id="l4.546"> </span>
<a href="#l4.547"></a><span id="l4.547" class="difflineat">@@ -1145,56 +1033,44 @@</span>
<a href="#l4.548"></a><span id="l4.548">             let args = window.arguments[0];</span>
<a href="#l4.549"></a><span id="l4.549">             let startTime = args.startTime;</span>
<a href="#l4.550"></a><span id="l4.550">             let endTime = args.endTime;</span>
<a href="#l4.551"></a><span id="l4.551"> </span>
<a href="#l4.552"></a><span id="l4.552">             let kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l4.553"></a><span id="l4.553">             this.startDate = startTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l4.554"></a><span id="l4.554">             this.endDate = endTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l4.555"></a><span id="l4.555"> </span>
<a href="#l4.556"></a><span id="l4.556" class="difflineminus">-            let listbox =</span>
<a href="#l4.557"></a><span id="l4.557" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.558"></a><span id="l4.558" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l4.559"></a><span id="l4.559" class="difflineminus">-            let template =</span>
<a href="#l4.560"></a><span id="l4.560" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.561"></a><span id="l4.561" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;item&quot;);</span>
<a href="#l4.562"></a><span id="l4.562" class="difflineminus">-            this.appendNewRow(listbox, template, null);</span>
<a href="#l4.563"></a><span id="l4.563" class="difflineplus">+            let template = this.getElementsByTagName(&quot;richlistitem&quot;)[0];</span>
<a href="#l4.564"></a><span id="l4.564" class="difflineplus">+            this.appendNewRow(template, null);</span>
<a href="#l4.565"></a><span id="l4.565">             template.remove();</span>
<a href="#l4.566"></a><span id="l4.566"> </span>
<a href="#l4.567"></a><span id="l4.567">             this.updateFreeBusy();</span>
<a href="#l4.568"></a><span id="l4.568">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.569"></a><span id="l4.569">       &lt;/method&gt;</span>
<a href="#l4.570"></a><span id="l4.570"> </span>
<a href="#l4.571"></a><span id="l4.571">       &lt;method name=&quot;onChangeCalendar&quot;&gt;</span>
<a href="#l4.572"></a><span id="l4.572">         &lt;parameter name=&quot;calendar&quot;/&gt;</span>
<a href="#l4.573"></a><span id="l4.573">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.574"></a><span id="l4.574">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.575"></a><span id="l4.575">       &lt;/method&gt;</span>
<a href="#l4.576"></a><span id="l4.576"> </span>
<a href="#l4.577"></a><span id="l4.577">       &lt;!-- appends a new empty row --&gt;</span>
<a href="#l4.578"></a><span id="l4.578">       &lt;method name=&quot;appendNewRow&quot;&gt;</span>
<a href="#l4.579"></a><span id="l4.579" class="difflineminus">-        &lt;parameter name=&quot;aParentNode&quot;/&gt;</span>
<a href="#l4.580"></a><span id="l4.580">         &lt;parameter name=&quot;aTemplateNode&quot;/&gt;</span>
<a href="#l4.581"></a><span id="l4.581">         &lt;parameter name=&quot;aReplaceNode&quot;/&gt;</span>
<a href="#l4.582"></a><span id="l4.582">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.583"></a><span id="l4.583">             this.mMaxFreeBusy++;</span>
<a href="#l4.584"></a><span id="l4.584">             let newNode = aTemplateNode.cloneNode(true);</span>
<a href="#l4.585"></a><span id="l4.585">             if (aReplaceNode) {</span>
<a href="#l4.586"></a><span id="l4.586" class="difflineminus">-                aParentNode.replaceChild(newNode, aReplaceNode);</span>
<a href="#l4.587"></a><span id="l4.587" class="difflineplus">+                this.replaceChild(newNode, aReplaceNode);</span>
<a href="#l4.588"></a><span id="l4.588">             } else {</span>
<a href="#l4.589"></a><span id="l4.589" class="difflineminus">-                aParentNode.appendChild(newNode);</span>
<a href="#l4.590"></a><span id="l4.590" class="difflineplus">+                this.appendChild(newNode);</span>
<a href="#l4.591"></a><span id="l4.591">             }</span>
<a href="#l4.592"></a><span id="l4.592"> </span>
<a href="#l4.593"></a><span id="l4.593" class="difflineminus">-            let grid =</span>
<a href="#l4.594"></a><span id="l4.594" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.595"></a><span id="l4.595" class="difflineminus">-                    newNode, &quot;anonid&quot;, &quot;grid&quot;);</span>
<a href="#l4.596"></a><span id="l4.596" class="difflineminus">-            let rowNumber = this.mMaxFreeBusy;</span>
<a href="#l4.597"></a><span id="l4.597" class="difflineminus">-            if (rowNumber &gt;= 0) {</span>
<a href="#l4.598"></a><span id="l4.598" class="difflineminus">-                grid.setAttribute(&quot;id&quot;, &quot;attendeeCol4#&quot; + rowNumber);</span>
<a href="#l4.599"></a><span id="l4.599" class="difflineminus">-            }</span>
<a href="#l4.600"></a><span id="l4.600" class="difflineplus">+            let grid = newNode.getElementsByTagName(&quot;freebusy-row&quot;)[0];</span>
<a href="#l4.601"></a><span id="l4.601"> </span>
<a href="#l4.602"></a><span id="l4.602">             // Propagate start/enddate to the new row.</span>
<a href="#l4.603"></a><span id="l4.603">             grid.startDate = this.mStartDate;</span>
<a href="#l4.604"></a><span id="l4.604">             grid.endDate = this.mEndDate;</span>
<a href="#l4.605"></a><span id="l4.605"> </span>
<a href="#l4.606"></a><span id="l4.606">             grid.force24Hours = this.mForce24Hours;</span>
<a href="#l4.607"></a><span id="l4.607">             grid.zoomFactor = this.mZoomFactor;</span>
<a href="#l4.608"></a><span id="l4.608"> </span>
<a href="#l4.609"></a><span id="l4.609" class="difflineat">@@ -1224,28 +1100,21 @@</span>
<a href="#l4.610"></a><span id="l4.610"> </span>
<a href="#l4.611"></a><span id="l4.611">       &lt;method name=&quot;onModify&quot;&gt;</span>
<a href="#l4.612"></a><span id="l4.612">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l4.613"></a><span id="l4.613">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.614"></a><span id="l4.614">             // Add or remove rows depending on the number of items</span>
<a href="#l4.615"></a><span id="l4.615">             // contained in the list passed as argument.</span>
<a href="#l4.616"></a><span id="l4.616">             let list = event.details;</span>
<a href="#l4.617"></a><span id="l4.617">             if (this.mMaxFreeBusy != list.length) {</span>
<a href="#l4.618"></a><span id="l4.618" class="difflineminus">-                let listbox =</span>
<a href="#l4.619"></a><span id="l4.619" class="difflineminus">-                    document.getAnonymousElementByAttribute(</span>
<a href="#l4.620"></a><span id="l4.620" class="difflineminus">-                        this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l4.621"></a><span id="l4.621" class="difflineminus">-                let template =</span>
<a href="#l4.622"></a><span id="l4.622" class="difflineminus">-                    document.getAnonymousElementByAttribute(</span>
<a href="#l4.623"></a><span id="l4.623" class="difflineminus">-                        this, &quot;anonid&quot;, &quot;item&quot;);</span>
<a href="#l4.624"></a><span id="l4.624" class="difflineplus">+                let template = this.getElementsByTagName(&quot;richlistitem&quot;)[0];</span>
<a href="#l4.625"></a><span id="l4.625">                 while (this.mMaxFreeBusy &lt; list.length) {</span>
<a href="#l4.626"></a><span id="l4.626">                     let nextDummy = this.getNextDummyRow();</span>
<a href="#l4.627"></a><span id="l4.627" class="difflineminus">-                    this.appendNewRow(listbox, template, nextDummy);</span>
<a href="#l4.628"></a><span id="l4.628" class="difflineminus">-                    template =</span>
<a href="#l4.629"></a><span id="l4.629" class="difflineminus">-                        document.getAnonymousElementByAttribute(</span>
<a href="#l4.630"></a><span id="l4.630" class="difflineminus">-                            this, &quot;anonid&quot;, &quot;item&quot;);</span>
<a href="#l4.631"></a><span id="l4.631" class="difflineplus">+                    this.appendNewRow(template, nextDummy);</span>
<a href="#l4.632"></a><span id="l4.632" class="difflineplus">+                    template = this.getElementsByTagName(&quot;richlistitem&quot;)[0];</span>
<a href="#l4.633"></a><span id="l4.633">                 }</span>
<a href="#l4.634"></a><span id="l4.634">                 while (this.mMaxFreeBusy &gt; list.length) {</span>
<a href="#l4.635"></a><span id="l4.635">                     this.deleteRow(this.mMaxFreeBusy);</span>
<a href="#l4.636"></a><span id="l4.636">                 }</span>
<a href="#l4.637"></a><span id="l4.637">             }</span>
<a href="#l4.638"></a><span id="l4.638"> </span>
<a href="#l4.639"></a><span id="l4.639">             // Store the attributes in our grid rows.</span>
<a href="#l4.640"></a><span id="l4.640">             for (let i = 1; i &lt;= this.mMaxFreeBusy; i++) {</span>
<a href="#l4.641"></a><span id="l4.641" class="difflineat">@@ -1416,78 +1285,51 @@</span>
<a href="#l4.642"></a><span id="l4.642">             for (let i = 1; i &lt;= this.mMaxFreeBusy; i++) {</span>
<a href="#l4.643"></a><span id="l4.643">                 let row = this.getFreeBusyElement(i);</span>
<a href="#l4.644"></a><span id="l4.644">                 row.setAttribute(&quot;dirty&quot;, &quot;true&quot;);</span>
<a href="#l4.645"></a><span id="l4.645">             }</span>
<a href="#l4.646"></a><span id="l4.646">             this.updateFreeBusy();</span>
<a href="#l4.647"></a><span id="l4.647">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.648"></a><span id="l4.648">       &lt;/method&gt;</span>
<a href="#l4.649"></a><span id="l4.649"> </span>
<a href="#l4.650"></a><span id="l4.650" class="difflineminus">-      &lt;!-- This method returns the &lt;xul:listitem&gt; at row numer 'aRow' --&gt;</span>
<a href="#l4.651"></a><span id="l4.651" class="difflineplus">+      &lt;!-- This method returns the &lt;xul:richlistitem&gt; at row numer 'aRow' --&gt;</span>
<a href="#l4.652"></a><span id="l4.652">       &lt;method name=&quot;getListItem&quot;&gt;</span>
<a href="#l4.653"></a><span id="l4.653">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.654"></a><span id="l4.654">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.655"></a><span id="l4.655" class="difflineminus">-            let listbox =</span>
<a href="#l4.656"></a><span id="l4.656" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.657"></a><span id="l4.657" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l4.658"></a><span id="l4.658" class="difflineminus">-            if (listbox &amp;&amp; aRow &gt; 0) {</span>
<a href="#l4.659"></a><span id="l4.659" class="difflineminus">-                let listitems = listbox.getElementsByTagNameNS(&quot;*&quot;, &quot;listitem&quot;);</span>
<a href="#l4.660"></a><span id="l4.660" class="difflineminus">-                if (listitems &amp;&amp; listitems.length &gt;= aRow) {</span>
<a href="#l4.661"></a><span id="l4.661" class="difflineminus">-                    return listitems[aRow - 1];</span>
<a href="#l4.662"></a><span id="l4.662" class="difflineminus">-                }</span>
<a href="#l4.663"></a><span id="l4.663" class="difflineminus">-            }</span>
<a href="#l4.664"></a><span id="l4.664" class="difflineminus">-            return 0;</span>
<a href="#l4.665"></a><span id="l4.665" class="difflineplus">+            return this.getElementsByTagName(&quot;richlistitem&quot;)[aRow - 1];</span>
<a href="#l4.666"></a><span id="l4.666">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.667"></a><span id="l4.667">       &lt;/method&gt;</span>
<a href="#l4.668"></a><span id="l4.668"> </span>
<a href="#l4.669"></a><span id="l4.669">       &lt;method name=&quot;getFreeBusyElement&quot;&gt;</span>
<a href="#l4.670"></a><span id="l4.670">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.671"></a><span id="l4.671">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.672"></a><span id="l4.672" class="difflineminus">-            return document.getAnonymousElementByAttribute(this, &quot;id&quot;,</span>
<a href="#l4.673"></a><span id="l4.673" class="difflineminus">-                                                           &quot;attendeeCol4#&quot; + aRow);</span>
<a href="#l4.674"></a><span id="l4.674" class="difflineplus">+            return this.getListItem(aRow).getElementsByTagName(&quot;freebusy-row&quot;)[0];</span>
<a href="#l4.675"></a><span id="l4.675">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.676"></a><span id="l4.676">       &lt;/method&gt;</span>
<a href="#l4.677"></a><span id="l4.677"> </span>
<a href="#l4.678"></a><span id="l4.678">       &lt;method name=&quot;deleteRow&quot;&gt;</span>
<a href="#l4.679"></a><span id="l4.679">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.680"></a><span id="l4.680">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.681"></a><span id="l4.681" class="difflineminus">-            // Reset id's in order to not break the sequence</span>
<a href="#l4.682"></a><span id="l4.682" class="difflineminus">-            let max = this.mMaxFreeBusy;</span>
<a href="#l4.683"></a><span id="l4.683">             this.removeRow(aRow);</span>
<a href="#l4.684"></a><span id="l4.684" class="difflineminus">-            let numberOfCols = this.numColumns;</span>
<a href="#l4.685"></a><span id="l4.685" class="difflineminus">-            for (let row = aRow + 1; row &lt;= max; row++) {</span>
<a href="#l4.686"></a><span id="l4.686" class="difflineminus">-                for (let col = 1; col &lt;= numberOfCols; col++) {</span>
<a href="#l4.687"></a><span id="l4.687" class="difflineminus">-                    let colID = &quot;attendeeCol&quot; + col + &quot;#&quot; + row;</span>
<a href="#l4.688"></a><span id="l4.688" class="difflineminus">-                    let elem = document.getAnonymousElementByAttribute(this, &quot;id&quot;, colID);</span>
<a href="#l4.689"></a><span id="l4.689" class="difflineminus">-                    if (elem) {</span>
<a href="#l4.690"></a><span id="l4.690" class="difflineminus">-                        elem.setAttribute(</span>
<a href="#l4.691"></a><span id="l4.691" class="difflineminus">-                            &quot;id&quot;,</span>
<a href="#l4.692"></a><span id="l4.692" class="difflineminus">-                            &quot;attendeeCol&quot; + (col) + &quot;#&quot; + (row - 1));</span>
<a href="#l4.693"></a><span id="l4.693" class="difflineminus">-                    }</span>
<a href="#l4.694"></a><span id="l4.694" class="difflineminus">-                }</span>
<a href="#l4.695"></a><span id="l4.695" class="difflineminus">-            }</span>
<a href="#l4.696"></a><span id="l4.696">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.697"></a><span id="l4.697">       &lt;/method&gt;</span>
<a href="#l4.698"></a><span id="l4.698"> </span>
<a href="#l4.699"></a><span id="l4.699">       &lt;method name=&quot;removeRow&quot;&gt;</span>
<a href="#l4.700"></a><span id="l4.700">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.701"></a><span id="l4.701">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.702"></a><span id="l4.702">             this.getListItem(aRow).remove();</span>
<a href="#l4.703"></a><span id="l4.703">             this.fitDummyRows();</span>
<a href="#l4.704"></a><span id="l4.704">             this.mMaxFreeBusy--;</span>
<a href="#l4.705"></a><span id="l4.705">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.706"></a><span id="l4.706">       &lt;/method&gt;</span>
<a href="#l4.707"></a><span id="l4.707"> </span>
<a href="#l4.708"></a><span id="l4.708">       &lt;!-- gets the next row from the top down --&gt;</span>
<a href="#l4.709"></a><span id="l4.709">       &lt;method name=&quot;getNextDummyRow&quot;&gt;</span>
<a href="#l4.710"></a><span id="l4.710">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.711"></a><span id="l4.711" class="difflineminus">-            let listbox =</span>
<a href="#l4.712"></a><span id="l4.712" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.713"></a><span id="l4.713" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l4.714"></a><span id="l4.714" class="difflineminus">-            let kids = listbox.childNodes;</span>
<a href="#l4.715"></a><span id="l4.715" class="difflineplus">+            let kids = this.childNodes;</span>
<a href="#l4.716"></a><span id="l4.716">             for (let i = 0; i &lt; kids.length; ++i) {</span>
<a href="#l4.717"></a><span id="l4.717">                 if (kids[i].hasAttribute(&quot;_isDummyRow&quot;)) {</span>
<a href="#l4.718"></a><span id="l4.718">                     return kids[i];</span>
<a href="#l4.719"></a><span id="l4.719">                 }</span>
<a href="#l4.720"></a><span id="l4.720">             }</span>
<a href="#l4.721"></a><span id="l4.721">             return null;</span>
<a href="#l4.722"></a><span id="l4.722">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.723"></a><span id="l4.723">       &lt;/method&gt;</span>
<a href="#l4.724"></a><span id="l4.724" class="difflineat">@@ -1498,99 +1340,66 @@</span>
<a href="#l4.725"></a><span id="l4.725">                 this.calcContentHeight();</span>
<a href="#l4.726"></a><span id="l4.726">                 this.createOrRemoveDummyRows();</span>
<a href="#l4.727"></a><span id="l4.727">             }, 0);</span>
<a href="#l4.728"></a><span id="l4.728">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.729"></a><span id="l4.729">       &lt;/method&gt;</span>
<a href="#l4.730"></a><span id="l4.730"> </span>
<a href="#l4.731"></a><span id="l4.731">       &lt;method name=&quot;calcContentHeight&quot;&gt;</span>
<a href="#l4.732"></a><span id="l4.732">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.733"></a><span id="l4.733" class="difflineminus">-            let listbox =</span>
<a href="#l4.734"></a><span id="l4.734" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.735"></a><span id="l4.735" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l4.736"></a><span id="l4.736" class="difflineminus">-            let items = listbox.getElementsByTagNameNS(&quot;*&quot;, &quot;listitem&quot;);</span>
<a href="#l4.737"></a><span id="l4.737" class="difflineplus">+            let items = this.getElementsByTagName(&quot;richlistitem&quot;);</span>
<a href="#l4.738"></a><span id="l4.738">             this.mContentHeight = 0;</span>
<a href="#l4.739"></a><span id="l4.739">             if (items.length &gt; 0) {</span>
<a href="#l4.740"></a><span id="l4.740">                 let i = 0;</span>
<a href="#l4.741"></a><span id="l4.741">                 do {</span>
<a href="#l4.742"></a><span id="l4.742">                     this.mRowHeight = items[i].boxObject.height;</span>
<a href="#l4.743"></a><span id="l4.743">                     ++i;</span>
<a href="#l4.744"></a><span id="l4.744">                 } while (i &lt; items.length &amp;&amp; !this.mRowHeight);</span>
<a href="#l4.745"></a><span id="l4.745">                 this.mContentHeight = this.mRowHeight * items.length;</span>
<a href="#l4.746"></a><span id="l4.746">             }</span>
<a href="#l4.747"></a><span id="l4.747">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.748"></a><span id="l4.748">       &lt;/method&gt;</span>
<a href="#l4.749"></a><span id="l4.749"> </span>
<a href="#l4.750"></a><span id="l4.750">       &lt;method name=&quot;createOrRemoveDummyRows&quot;&gt;</span>
<a href="#l4.751"></a><span id="l4.751">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.752"></a><span id="l4.752" class="difflineminus">-            let listbox =</span>
<a href="#l4.753"></a><span id="l4.753" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l4.754"></a><span id="l4.754" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l4.755"></a><span id="l4.755" class="difflineminus">-            let listboxHeight = listbox.boxObject.height;</span>
<a href="#l4.756"></a><span id="l4.756" class="difflineplus">+            let listboxHeight = this.boxObject.height;</span>
<a href="#l4.757"></a><span id="l4.757"> </span>
<a href="#l4.758"></a><span id="l4.758">             // Remove rows to remove scrollbar</span>
<a href="#l4.759"></a><span id="l4.759" class="difflineminus">-            let kids = listbox.childNodes;</span>
<a href="#l4.760"></a><span id="l4.760" class="difflineplus">+            let kids = this.childNodes;</span>
<a href="#l4.761"></a><span id="l4.761">             for (let i = kids.length - 1; this.mContentHeight &gt; listboxHeight &amp;&amp; i &gt;= 0; --i) {</span>
<a href="#l4.762"></a><span id="l4.762">                 if (kids[i].hasAttribute(&quot;_isDummyRow&quot;)) {</span>
<a href="#l4.763"></a><span id="l4.763">                     this.mContentHeight -= this.mRowHeight;</span>
<a href="#l4.764"></a><span id="l4.764">                     kids[i].remove();</span>
<a href="#l4.765"></a><span id="l4.765">                 }</span>
<a href="#l4.766"></a><span id="l4.766">             }</span>
<a href="#l4.767"></a><span id="l4.767"> </span>
<a href="#l4.768"></a><span id="l4.768">             // Add rows to fill space</span>
<a href="#l4.769"></a><span id="l4.769">             if (this.mRowHeight) {</span>
<a href="#l4.770"></a><span id="l4.770">                 while (this.mContentHeight + this.mRowHeight &lt; listboxHeight) {</span>
<a href="#l4.771"></a><span id="l4.771" class="difflineminus">-                    this.createDummyItem(listbox);</span>
<a href="#l4.772"></a><span id="l4.772" class="difflineplus">+                    this.createDummyItem();</span>
<a href="#l4.773"></a><span id="l4.773">                     this.mContentHeight += this.mRowHeight;</span>
<a href="#l4.774"></a><span id="l4.774">                 }</span>
<a href="#l4.775"></a><span id="l4.775">             }</span>
<a href="#l4.776"></a><span id="l4.776">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.777"></a><span id="l4.777">       &lt;/method&gt;</span>
<a href="#l4.778"></a><span id="l4.778"> </span>
<a href="#l4.779"></a><span id="l4.779" class="difflineminus">-      &lt;method name=&quot;createDummyCell&quot;&gt;</span>
<a href="#l4.780"></a><span id="l4.780" class="difflineminus">-        &lt;parameter name=&quot;aParent&quot;/&gt;</span>
<a href="#l4.781"></a><span id="l4.781" class="difflineplus">+      &lt;method name=&quot;createDummyItem&quot;&gt;</span>
<a href="#l4.782"></a><span id="l4.782">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.783"></a><span id="l4.783" class="difflineminus">-            let cell = document.createElement(&quot;listcell&quot;);</span>
<a href="#l4.784"></a><span id="l4.784" class="difflineplus">+            let item = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l4.785"></a><span id="l4.785" class="difflineplus">+            item.setAttribute(&quot;_isDummyRow&quot;, &quot;true&quot;);</span>
<a href="#l4.786"></a><span id="l4.786" class="difflineplus">+            item.setAttribute(&quot;class&quot;, &quot;dummy-row&quot;);</span>
<a href="#l4.787"></a><span id="l4.787" class="difflineplus">+            let cell = document.createElement(&quot;hbox&quot;);</span>
<a href="#l4.788"></a><span id="l4.788" class="difflineplus">+            cell.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l4.789"></a><span id="l4.789">             cell.setAttribute(&quot;class&quot;, &quot;addressingWidgetCell dummy-row-cell&quot;);</span>
<a href="#l4.790"></a><span id="l4.790" class="difflineminus">-            if (aParent) {</span>
<a href="#l4.791"></a><span id="l4.791" class="difflineminus">-                aParent.appendChild(cell);</span>
<a href="#l4.792"></a><span id="l4.792" class="difflineminus">-            }</span>
<a href="#l4.793"></a><span id="l4.793" class="difflineminus">-            return cell;</span>
<a href="#l4.794"></a><span id="l4.794" class="difflineplus">+            item.appendChild(cell);</span>
<a href="#l4.795"></a><span id="l4.795" class="difflineplus">+            this.appendChild(item);</span>
<a href="#l4.796"></a><span id="l4.796" class="difflineplus">+            return item;</span>
<a href="#l4.797"></a><span id="l4.797">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.798"></a><span id="l4.798">       &lt;/method&gt;</span>
<a href="#l4.799"></a><span id="l4.799"> </span>
<a href="#l4.800"></a><span id="l4.800" class="difflineminus">-      &lt;method name=&quot;createDummyItem&quot;&gt;</span>
<a href="#l4.801"></a><span id="l4.801" class="difflineminus">-        &lt;parameter name=&quot;aParent&quot;/&gt;</span>
<a href="#l4.802"></a><span id="l4.802" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.803"></a><span id="l4.803" class="difflineminus">-            let titem = document.createElement(&quot;listitem&quot;);</span>
<a href="#l4.804"></a><span id="l4.804" class="difflineminus">-            titem.setAttribute(&quot;_isDummyRow&quot;, &quot;true&quot;);</span>
<a href="#l4.805"></a><span id="l4.805" class="difflineminus">-            titem.setAttribute(&quot;class&quot;, &quot;dummy-row&quot;);</span>
<a href="#l4.806"></a><span id="l4.806" class="difflineminus">-            for (let i = this.numColumns; i &gt; 0; i--) {</span>
<a href="#l4.807"></a><span id="l4.807" class="difflineminus">-                this.createDummyCell(titem);</span>
<a href="#l4.808"></a><span id="l4.808" class="difflineminus">-            }</span>
<a href="#l4.809"></a><span id="l4.809" class="difflineminus">-            if (aParent) {</span>
<a href="#l4.810"></a><span id="l4.810" class="difflineminus">-                aParent.appendChild(titem);</span>
<a href="#l4.811"></a><span id="l4.811" class="difflineminus">-            }</span>
<a href="#l4.812"></a><span id="l4.812" class="difflineminus">-            return titem;</span>
<a href="#l4.813"></a><span id="l4.813" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.814"></a><span id="l4.814" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.815"></a><span id="l4.815" class="difflineminus">-</span>
<a href="#l4.816"></a><span id="l4.816" class="difflineminus">-      &lt;property name=&quot;numColumns&quot;&gt;</span>
<a href="#l4.817"></a><span id="l4.817" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.818"></a><span id="l4.818" class="difflineminus">-            if (!this.mNumColumns) {</span>
<a href="#l4.819"></a><span id="l4.819" class="difflineminus">-                let listbox =</span>
<a href="#l4.820"></a><span id="l4.820" class="difflineminus">-                    document.getAnonymousElementByAttribute(</span>
<a href="#l4.821"></a><span id="l4.821" class="difflineminus">-                        this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l4.822"></a><span id="l4.822" class="difflineminus">-                let listCols = listbox.getElementsByTagNameNS(&quot;*&quot;, &quot;listcol&quot;);</span>
<a href="#l4.823"></a><span id="l4.823" class="difflineminus">-                this.mNumColumns = listCols.length || 1;</span>
<a href="#l4.824"></a><span id="l4.824" class="difflineminus">-            }</span>
<a href="#l4.825"></a><span id="l4.825" class="difflineminus">-            return this.mNumColumns;</span>
<a href="#l4.826"></a><span id="l4.826" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.827"></a><span id="l4.827" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l4.828"></a><span id="l4.828" class="difflineminus">-</span>
<a href="#l4.829"></a><span id="l4.829">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l4.830"></a><span id="l4.830">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.831"></a><span id="l4.831">             if (this.force24Hours) {</span>
<a href="#l4.832"></a><span id="l4.832">                 this.mStartHour = 0;</span>
<a href="#l4.833"></a><span id="l4.833">                 this.mEndHour = 24;</span>
<a href="#l4.834"></a><span id="l4.834">             } else {</span>
<a href="#l4.835"></a><span id="l4.835">                 this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l4.836"></a><span id="l4.836">                 this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/themes/common/dialogs/calendar-event-dialog.css</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/themes/common/dialogs/calendar-event-dialog.css</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -317,16 +317,17 @@ daypicker-monthday {</span>
<a href="#l5.4"></a><span id="l5.4"> /*--------------------------------------------------------------------</span>
<a href="#l5.5"></a><span id="l5.5">  *   Attendees Dialog</span>
<a href="#l5.6"></a><span id="l5.6">  *-------------------------------------------------------------------*/</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> .listbox-noborder {</span>
<a href="#l5.9"></a><span id="l5.9">     -moz-appearance: none;</span>
<a href="#l5.10"></a><span id="l5.10">     margin: 0px 0px;</span>
<a href="#l5.11"></a><span id="l5.11">     border: 1px solid var(--eventBorderColor);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+    background-color: #fff;</span>
<a href="#l5.13"></a><span id="l5.13"> }</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15"> #timebar &gt; .listbox-noborder {</span>
<a href="#l5.16"></a><span id="l5.16">     border-bottom-style: none;</span>
<a href="#l5.17"></a><span id="l5.17"> }</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19"> #freebusy-grid &gt; .listbox-noborder {</span>
<a href="#l5.20"></a><span id="l5.20">     border-top-color: transparent;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -449,16 +450,25 @@ freebusy-day &gt; box {</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23"> #dialog-box {</span>
<a href="#l5.24"></a><span id="l5.24">     padding-top: 8px;</span>
<a href="#l5.25"></a><span id="l5.25">     padding-bottom: 10px;</span>
<a href="#l5.26"></a><span id="l5.26">     padding-inline-start: 8px;</span>
<a href="#l5.27"></a><span id="l5.27">     padding-inline-end: 10px;</span>
<a href="#l5.28"></a><span id="l5.28"> }</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+/* --spacer-top-height and --spacer-bottom-height are defined at runtime */</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+.attendee-spacer-top {</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+    height: var(--spacer-top-height);</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+}</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+.attendee-spacer-bottom {</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+    height: var(--spacer-bottom-height);</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+}</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+</span>
<a href="#l5.39"></a><span id="l5.39"> #addressingWidget {</span>
<a href="#l5.40"></a><span id="l5.40">     -moz-user-focus: none;</span>
<a href="#l5.41"></a><span id="l5.41"> }</span>
<a href="#l5.42"></a><span id="l5.42"> </span>
<a href="#l5.43"></a><span id="l5.43"> #typecol-addressingWidget {</span>
<a href="#l5.44"></a><span id="l5.44">     min-width: 9em;</span>
<a href="#l5.45"></a><span id="l5.45">     border-right: 1px solid var(--eventWidgetBorderColor);</span>
<a href="#l5.46"></a><span id="l5.46"> }</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineat">@@ -470,17 +480,18 @@ freebusy-day &gt; box {</span>
<a href="#l5.48"></a><span id="l5.48">     background-color: inherit !important;</span>
<a href="#l5.49"></a><span id="l5.49">     color: inherit !important;</span>
<a href="#l5.50"></a><span id="l5.50"> </span>
<a href="#l5.51"></a><span id="l5.51">     /* we set the minimal height to the height of the</span>
<a href="#l5.52"></a><span id="l5.52">      largest icon [the usertype-icon in this case] to</span>
<a href="#l5.53"></a><span id="l5.53">      ensure that the rows of the freebusy-grid and</span>
<a href="#l5.54"></a><span id="l5.54">      the attendee-list always have the same height,</span>
<a href="#l5.55"></a><span id="l5.55">      regardless of the font size. */</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-    min-height: 16px;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+    height: 17px;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+    overflow: hidden;</span>
<a href="#l5.59"></a><span id="l5.59"> }</span>
<a href="#l5.60"></a><span id="l5.60"> </span>
<a href="#l5.61"></a><span id="l5.61"> .addressingWidgetCell {</span>
<a href="#l5.62"></a><span id="l5.62">     border-bottom: 1px solid var(--eventWidgetBorderColor);</span>
<a href="#l5.63"></a><span id="l5.63">     padding: 0px;</span>
<a href="#l5.64"></a><span id="l5.64"> }</span>
<a href="#l5.65"></a><span id="l5.65"> </span>
<a href="#l5.66"></a><span id="l5.66"> .addressingWidgetCell:first-child {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

