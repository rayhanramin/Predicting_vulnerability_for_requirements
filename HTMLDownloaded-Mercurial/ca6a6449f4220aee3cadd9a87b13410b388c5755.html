<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 9571:ca6a6449f4220aee3cadd9a87b13410b388c5755</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ca6a6449f4220aee3cadd9a87b13410b388c5755" />
<meta property="og:url" content="/comm-central/rev/ca6a6449f4220aee3cadd9a87b13410b388c5755" />
<meta property="og:description" content="Bug 550800 - &quot;Summary&quot; pref is overridden in multifeed folders. r=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ca6a6449f4220aee3cadd9a87b13410b388c5755 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ca6a6449f4220aee3cadd9a87b13410b388c5755">shortlog</a> |
<a href="/comm-central/log/ca6a6449f4220aee3cadd9a87b13410b388c5755">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ca6a6449f4220aee3cadd9a87b13410b388c5755">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ca6a6449f4220aee3cadd9a87b13410b388c5755">files</a> |
changeset |
<a href="/comm-central/raw-rev/ca6a6449f4220aee3cadd9a87b13410b388c5755">raw</a>  | <a href="/comm-central/archive/ca6a6449f4220aee3cadd9a87b13410b388c5755.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=550800">Bug 550800</a> - &quot;Summary&quot; pref is overridden in multifeed folders. r=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#108;&#116;&#97;&#56;&#56;&#32;&#60;&#97;&#108;&#116;&#97;&#56;&#56;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 03 Mar 2012 16:26:27 -0700</td></tr>

<tr>
 <td>changeset 9571</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ca6a6449f4220aee3cadd9a87b13410b388c5755">ca6a6449f4220aee3cadd9a87b13410b388c5755</a></td>
</tr>



<tr>
<td>parent 9570</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ee195bb99d1dfeece858f0a0e950c4b2f154bae8">ee195bb99d1dfeece858f0a0e950c4b2f154bae8</a>
</td>
</tr>

<tr>
<td>child 9572</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4f7dd383534c3ff33a1ed57af246e56e39dc7349">4f7dd383534c3ff33a1ed57af246e56e39dc7349</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ca6a6449f4220aee3cadd9a87b13410b388c5755">7310</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 06 Mar 2012 21:26:30 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@4f7dd383534c [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4f7dd383534c3ff33a1ed57af246e56e39dc7349">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4f7dd383534c3ff33a1ed57af246e56e39dc7349&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4f7dd383534c3ff33a1ed57af246e56e39dc7349&newProject=comm-central&newRevision=ee195bb99d1dfeece858f0a0e950c4b2f154bae8&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4f7dd383534c3ff33a1ed57af246e56e39dc7349&newProject=comm-central&newRevision=ee195bb99d1dfeece858f0a0e950c4b2f154bae8&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4f7dd383534c3ff33a1ed57af246e56e39dc7349&newProject=comm-central&newRevision=ee195bb99d1dfeece858f0a0e950c4b2f154bae8&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=550800">550800</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=550800">Bug 550800</a> - &quot;Summary&quot; pref is overridden in multifeed folders. r=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.js">mailnews/extensions/newsblog/content/feed-subscriptions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.js">file</a> |
<a href="/comm-central/annotate/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.js">annotate</a> |
<a href="/comm-central/diff/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.js">diff</a> |
<a href="/comm-central/comparison/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.js">comparison</a> |
<a href="/comm-central/log/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.xul">mailnews/extensions/newsblog/content/feed-subscriptions.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.xul">file</a> |
<a href="/comm-central/annotate/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.xul">annotate</a> |
<a href="/comm-central/diff/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.xul">diff</a> |
<a href="/comm-central/comparison/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.xul">comparison</a> |
<a href="/comm-central/log/ca6a6449f4220aee3cadd9a87b13410b388c5755/mailnews/extensions/newsblog/content/feed-subscriptions.xul">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -17,16 +17,17 @@</span>
<a href="#l1.4"></a><span id="l1.4"> # The Initial Developer of the Original Code is</span>
<a href="#l1.5"></a><span id="l1.5"> # The Mozilla Foundation.</span>
<a href="#l1.6"></a><span id="l1.6"> # Portions created by the Initial Developer are Copyright (C) 2005</span>
<a href="#l1.7"></a><span id="l1.7"> # the Initial Developer. All Rights Reserved.</span>
<a href="#l1.8"></a><span id="l1.8"> #</span>
<a href="#l1.9"></a><span id="l1.9"> # Contributor(s):</span>
<a href="#l1.10"></a><span id="l1.10"> #  Scott MacGregor &lt;mscott@mozilla.org&gt;</span>
<a href="#l1.11"></a><span id="l1.11"> #  Ian Neal &lt;iann_bugzilla@blueyonder.co.uk&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+#  alta88 &lt;alta88@gmail.com&gt;</span>
<a href="#l1.13"></a><span id="l1.13"> #</span>
<a href="#l1.14"></a><span id="l1.14"> # Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l1.15"></a><span id="l1.15"> # either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l1.16"></a><span id="l1.16"> # the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l1.17"></a><span id="l1.17"> # in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l1.18"></a><span id="l1.18"> # of those above. If you wish to allow use of your version of this file only</span>
<a href="#l1.19"></a><span id="l1.19"> # under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l1.20"></a><span id="l1.20"> # use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -333,17 +334,17 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l1.22"></a><span id="l1.22">       // Preselect the drop folder.</span>
<a href="#l1.23"></a><span id="l1.23">       this.selection.select(aRow);</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">       if (results.url)</span>
<a href="#l1.26"></a><span id="l1.26">       {</span>
<a href="#l1.27"></a><span id="l1.27">         // Don't freeze the app that initiated the drop just because we are</span>
<a href="#l1.28"></a><span id="l1.28">         // in a loop waiting for the user to dimisss the add feed dialog.</span>
<a href="#l1.29"></a><span id="l1.29">         setTimeout(function() {</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-          win.addFeed(results.url, null, true, win.kSubscribeMode);</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+          win.addFeed(results.url, null, true, null, win.kSubscribeMode);</span>
<a href="#l1.32"></a><span id="l1.32">         }, 0);</span>
<a href="#l1.33"></a><span id="l1.33">         let folderItem = this.getItemAtIndex(aRow);</span>
<a href="#l1.34"></a><span id="l1.34">         FeedUtils.log.debug(&quot;drop: folder, url - &quot; +</span>
<a href="#l1.35"></a><span id="l1.35">                             folderItem.folder.name+&quot;, &quot;+results.url);</span>
<a href="#l1.36"></a><span id="l1.36">       }</span>
<a href="#l1.37"></a><span id="l1.37">       else if (results.index != this.kRowIndexUndefined)</span>
<a href="#l1.38"></a><span id="l1.38">       {</span>
<a href="#l1.39"></a><span id="l1.39">         win.moveFeed(results.index, aRow);</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineat">@@ -532,17 +533,16 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l1.41"></a><span id="l1.41">   makeFolderObject: function (aFolder, aCurrentLevel)</span>
<a href="#l1.42"></a><span id="l1.42">   {</span>
<a href="#l1.43"></a><span id="l1.43">     let defaultQuickMode = aFolder.server.getBoolValue(&quot;quickMode&quot;);</span>
<a href="#l1.44"></a><span id="l1.44">     let folderObject =  { children : [],</span>
<a href="#l1.45"></a><span id="l1.45">                           folder   : aFolder,</span>
<a href="#l1.46"></a><span id="l1.46">                           name     : aFolder.prettiestName,</span>
<a href="#l1.47"></a><span id="l1.47">                           level    : aCurrentLevel,</span>
<a href="#l1.48"></a><span id="l1.48">                           url      : aFolder.URI,</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-                          //QueryInterface(Ci.nsIRDFResource).Value,</span>
<a href="#l1.50"></a><span id="l1.50">                           quickMode: defaultQuickMode,</span>
<a href="#l1.51"></a><span id="l1.51">                           open     : false,</span>
<a href="#l1.52"></a><span id="l1.52">                           container: true };</span>
<a href="#l1.53"></a><span id="l1.53"> </span>
<a href="#l1.54"></a><span id="l1.54">     // If a feed has any sub folders, add them to the list of children.</span>
<a href="#l1.55"></a><span id="l1.55">     let folderEnumerator = aFolder.subFolders;</span>
<a href="#l1.56"></a><span id="l1.56"> </span>
<a href="#l1.57"></a><span id="l1.57">     while (folderEnumerator.hasMoreElements())</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineat">@@ -565,29 +565,28 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l1.59"></a><span id="l1.59">       return a.name.toLowerCase() &gt; b.name.toLowerCase();</span>
<a href="#l1.60"></a><span id="l1.60">     }</span>
<a href="#l1.61"></a><span id="l1.61">  </span>
<a href="#l1.62"></a><span id="l1.62">     folderObject.children.sort(sorter);</span>
<a href="#l1.63"></a><span id="l1.63"> </span>
<a href="#l1.64"></a><span id="l1.64">     let feeds = this.getFeedsInFolder(aFolder);</span>
<a href="#l1.65"></a><span id="l1.65">     for (let feed in feeds)</span>
<a href="#l1.66"></a><span id="l1.66">     {</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-      // Special case, if a folder only has a single feed associated with it,</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-      // then just use the feed in the view and don't show the folder at all.</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-      // Note: split always adds an empty element to the array...</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-//      if (feedUrlArray.length &lt;= 2 &amp;&amp; !aFolder.hasSubFolders)</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-//        this.mFeedContainers[aCurrentLength] =</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-//            this.makeFeedObject(feed, aCurrentLevel);</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-//      else</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineminus">-        // Now add any feed urls for the folder.</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineminus">-        folderObject.children.push(this.makeFeedObject(feeds[feed],</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineminus">-                                                       aFolder,</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-                                                       aCurrentLevel + 1));</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+      // Now add any feed urls for the folder.</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+      folderObject.children.push(this.makeFeedObject(feeds[feed],</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+                                                     aFolder,</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+                                                     aCurrentLevel + 1));</span>
<a href="#l1.82"></a><span id="l1.82">     }</span>
<a href="#l1.83"></a><span id="l1.83"> </span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+    // Finally, set the folder's quickMode based on the its first feed's</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+    // quickMode, since that is how the view determines summary mode, and now</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+    // quickMode is updated to be the same for all feeds in a folder.</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+    if (feeds)</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+      folderObject.quickMode = feeds[0].quickMode;</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+</span>
<a href="#l1.90"></a><span id="l1.90">     return folderObject;</span>
<a href="#l1.91"></a><span id="l1.91">   },</span>
<a href="#l1.92"></a><span id="l1.92"> </span>
<a href="#l1.93"></a><span id="l1.93">   getFeedsInFolder: function (aFolder)</span>
<a href="#l1.94"></a><span id="l1.94">   {</span>
<a href="#l1.95"></a><span id="l1.95">     let feeds = new Array();</span>
<a href="#l1.96"></a><span id="l1.96">     let feedUrlArray = getFeedUrlsInFolder(aFolder);</span>
<a href="#l1.97"></a><span id="l1.97">     if (!feedUrlArray)</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineat">@@ -820,55 +819,115 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l1.99"></a><span id="l1.99"> </span>
<a href="#l1.100"></a><span id="l1.100">     // Set quick mode value.</span>
<a href="#l1.101"></a><span id="l1.101">     document.getElementById(&quot;quickMode&quot;).checked = aItem.quickMode;</span>
<a href="#l1.102"></a><span id="l1.102">   },</span>
<a href="#l1.103"></a><span id="l1.103"> </span>
<a href="#l1.104"></a><span id="l1.104">   setFolderPicker: function(aFolderURI)</span>
<a href="#l1.105"></a><span id="l1.105">   {</span>
<a href="#l1.106"></a><span id="l1.106">     let selectFolder = document.getElementById(&quot;selectFolder&quot;);</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+    let editFeed = document.getElementById(&quot;editFeed&quot;);</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+</span>
<a href="#l1.109"></a><span id="l1.109">     let msgFolder = GetMsgFolderFromUri(aFolderURI, true);</span>
<a href="#l1.110"></a><span id="l1.110">     if (!msgFolder)</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineplus">+      return editFeed.disabled = true;</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineplus">+</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+    editFeed.disabled = false;</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineplus">+    selectFolder.setAttribute(&quot;label&quot;, msgFolder.name);</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineplus">+    selectFolder.setAttribute(&quot;uri&quot;, msgFolder.URI);</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineplus">+  },</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+  setSummary: function(aChecked)</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+  {</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+    let item = this.mView.currentItem;</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineplus">+    if (!item || !item.folder)</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+      // Not a folder.</span>
<a href="#l1.123"></a><span id="l1.123">       return;</span>
<a href="#l1.124"></a><span id="l1.124"> </span>
<a href="#l1.125"></a><span id="l1.125" class="difflineminus">-    selectFolder.setAttribute(&quot;label&quot;, msgFolder.name);</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineminus">-    selectFolder.setAttribute(&quot;uri&quot;, msgFolder.URI);</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineplus">+    if (item.folder.isServer)</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineplus">+    {</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineplus">+      if (document.getElementById(&quot;locationValue&quot;).value)</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineplus">+        // Intent is to add a feed/folder to the account, so return.</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineplus">+        return;</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineplus">+</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineplus">+      // An account folder.  If it changes, all non feed containing subfolders</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineplus">+      // need to be updated with the new default.</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineplus">+      item.folder.server.setBoolValue(&quot;quickMode&quot;, aChecked);</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineplus">+      this.refreshSubscriptionView();</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineplus">+    }</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineplus">+    else if (!getFeedUrlsInFolder(item.folder))</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineplus">+      // Not a folder with feeds.</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineplus">+      return;</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineplus">+    else</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineplus">+    {</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineplus">+      let feedsInFolder = this.getFeedsInFolder(item.folder);</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineplus">+      // Update the feeds database, for each feed in the folder.</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineplus">+      feedsInFolder.forEach(function(feed) { feed.quickMode = aChecked; });</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineplus">+      // Update the folder's feeds properties in the tree map.</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineplus">+      item.children.forEach(function(feed) { feed.quickMode = aChecked; });</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineplus">+    }</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineplus">+</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineplus">+    // Update the folder in the tree map.</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineplus">+    item.quickMode = aChecked;</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineplus">+    let message = FeedUtils.strings.GetStringFromName(&quot;subscribe-feedUpdated&quot;);</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineplus">+    this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l1.154"></a><span id="l1.154">   },</span>
<a href="#l1.155"></a><span id="l1.155"> </span>
<a href="#l1.156"></a><span id="l1.156">   onKeyPress: function(aEvent)</span>
<a href="#l1.157"></a><span id="l1.157">   {</span>
<a href="#l1.158"></a><span id="l1.158">     if (aEvent.keyCode == aEvent.DOM_VK_DELETE)</span>
<a href="#l1.159"></a><span id="l1.159">       this.removeFeed(true);</span>
<a href="#l1.160"></a><span id="l1.160"> </span>
<a href="#l1.161"></a><span id="l1.161">     this.clearStatusInfo();</span>
<a href="#l1.162"></a><span id="l1.162">   },</span>
<a href="#l1.163"></a><span id="l1.163"> </span>
<a href="#l1.164"></a><span id="l1.164">   onSelect: function ()</span>
<a href="#l1.165"></a><span id="l1.165">   {</span>
<a href="#l1.166"></a><span id="l1.166">     let item = this.mView.currentItem;</span>
<a href="#l1.167"></a><span id="l1.167">     let isServer = item &amp;&amp; item.folder &amp;&amp; item.folder.isServer;</span>
<a href="#l1.168"></a><span id="l1.168">     let disable;</span>
<a href="#l1.169"></a><span id="l1.169">     this.updateFeedData(item);</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineplus">+    this.setSummaryFocus();</span>
<a href="#l1.171"></a><span id="l1.171">     disable = !item || (!item.container || this.mActionMode == this.kMoveMode);</span>
<a href="#l1.172"></a><span id="l1.172">     document.getElementById(&quot;addFeed&quot;).disabled = disable;</span>
<a href="#l1.173"></a><span id="l1.173">     disable = !item || (item.container &amp;&amp; this.mActionMode != this.kMoveMode);</span>
<a href="#l1.174"></a><span id="l1.174">     document.getElementById(&quot;removeFeed&quot;).disabled = disable;</span>
<a href="#l1.175"></a><span id="l1.175">     document.getElementById(&quot;editFeed&quot;).disabled = disable;</span>
<a href="#l1.176"></a><span id="l1.176">     document.getElementById(&quot;importOPML&quot;).disabled = !item || !isServer;</span>
<a href="#l1.177"></a><span id="l1.177">     document.getElementById(&quot;exportOPML&quot;).disabled = !item || !isServer;</span>
<a href="#l1.178"></a><span id="l1.178">   },</span>
<a href="#l1.179"></a><span id="l1.179"> </span>
<a href="#l1.180"></a><span id="l1.180" class="difflineminus">-  onClick: function (aEvent)</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineplus">+  onMouseDown: function (aEvent)</span>
<a href="#l1.182"></a><span id="l1.182">   {</span>
<a href="#l1.183"></a><span id="l1.183">     if (aEvent.button != 0)</span>
<a href="#l1.184"></a><span id="l1.184">       return;</span>
<a href="#l1.185"></a><span id="l1.185"> </span>
<a href="#l1.186"></a><span id="l1.186">     this.clearStatusInfo();</span>
<a href="#l1.187"></a><span id="l1.187">   },</span>
<a href="#l1.188"></a><span id="l1.188"> </span>
<a href="#l1.189"></a><span id="l1.189" class="difflineplus">+  setSummaryFocus: function ()</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineplus">+  {</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineplus">+    let item = this.mView.currentItem;</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineplus">+    let locationValue = document.getElementById(&quot;locationValue&quot;);</span>
<a href="#l1.193"></a><span id="l1.193" class="difflineplus">+    let quickMode = document.getElementById(&quot;quickMode&quot;);</span>
<a href="#l1.194"></a><span id="l1.194" class="difflineplus">+</span>
<a href="#l1.195"></a><span id="l1.195" class="difflineplus">+    if (item &amp;&amp; item.folder &amp;&amp;</span>
<a href="#l1.196"></a><span id="l1.196" class="difflineplus">+        (locationValue.hasAttribute(&quot;focused&quot;) || locationValue.value ||</span>
<a href="#l1.197"></a><span id="l1.197" class="difflineplus">+         item.folder.isServer || getFeedUrlsInFolder(item.folder)))</span>
<a href="#l1.198"></a><span id="l1.198" class="difflineplus">+    {</span>
<a href="#l1.199"></a><span id="l1.199" class="difflineplus">+      // Enable summary for account folder or folder with feeds or focus/value</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineplus">+      // in the feed url field of empty folders prior to add.</span>
<a href="#l1.201"></a><span id="l1.201" class="difflineplus">+      quickMode.disabled = false;</span>
<a href="#l1.202"></a><span id="l1.202" class="difflineplus">+    }</span>
<a href="#l1.203"></a><span id="l1.203" class="difflineplus">+    else</span>
<a href="#l1.204"></a><span id="l1.204" class="difflineplus">+    {</span>
<a href="#l1.205"></a><span id="l1.205" class="difflineplus">+      quickMode.disabled = true;</span>
<a href="#l1.206"></a><span id="l1.206" class="difflineplus">+    }</span>
<a href="#l1.207"></a><span id="l1.207" class="difflineplus">+  },</span>
<a href="#l1.208"></a><span id="l1.208" class="difflineplus">+</span>
<a href="#l1.209"></a><span id="l1.209">   removeFeed: function (aPrompt)</span>
<a href="#l1.210"></a><span id="l1.210">   {</span>
<a href="#l1.211"></a><span id="l1.211">     let seln = this.mView.selection;</span>
<a href="#l1.212"></a><span id="l1.212">     if (seln.count != 1)</span>
<a href="#l1.213"></a><span id="l1.213">       return;</span>
<a href="#l1.214"></a><span id="l1.214"> </span>
<a href="#l1.215"></a><span id="l1.215">     let itemToRemove = this.mView.getItemAtIndex(seln.currentIndex);</span>
<a href="#l1.216"></a><span id="l1.216"> </span>
<a href="#l1.217"></a><span id="l1.217" class="difflineat">@@ -888,18 +947,21 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l1.218"></a><span id="l1.218">         return;</span>
<a href="#l1.219"></a><span id="l1.219">     }</span>
<a href="#l1.220"></a><span id="l1.220"> </span>
<a href="#l1.221"></a><span id="l1.221">     deleteFeed(rdf.GetResource(itemToRemove.url),</span>
<a href="#l1.222"></a><span id="l1.222">                itemToRemove.parentFolder.server,</span>
<a href="#l1.223"></a><span id="l1.223">                itemToRemove.parentFolder);</span>
<a href="#l1.224"></a><span id="l1.224"> </span>
<a href="#l1.225"></a><span id="l1.225">     // Now that we have removed the feed from the datasource, it is time to</span>
<a href="#l1.226"></a><span id="l1.226" class="difflineminus">-    // update our view layer.  Start by removing the child from its parent</span>
<a href="#l1.227"></a><span id="l1.227" class="difflineminus">-    // folder object.</span>
<a href="#l1.228"></a><span id="l1.228" class="difflineplus">+    // update our view layer.  Update parent folder's quickMode if necessary</span>
<a href="#l1.229"></a><span id="l1.229" class="difflineplus">+    // and remove the child from its parent folder object.</span>
<a href="#l1.230"></a><span id="l1.230" class="difflineplus">+    let parentIndex = this.mView.getParentIndex(seln.currentIndex);</span>
<a href="#l1.231"></a><span id="l1.231" class="difflineplus">+    let parentItem = this.mView.getItemAtIndex(parentIndex);</span>
<a href="#l1.232"></a><span id="l1.232" class="difflineplus">+    this.updateFolderQuickModeInView(itemToRemove, parentItem, true);</span>
<a href="#l1.233"></a><span id="l1.233">     this.mView.removeItemAtIndex(seln.currentIndex, false);</span>
<a href="#l1.234"></a><span id="l1.234">     let message = FeedUtils.strings.GetStringFromName(&quot;subscribe-feedRemoved&quot;);</span>
<a href="#l1.235"></a><span id="l1.235">     this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l1.236"></a><span id="l1.236">   },</span>
<a href="#l1.237"></a><span id="l1.237"> </span>
<a href="#l1.238"></a><span id="l1.238"> </span>
<a href="#l1.239"></a><span id="l1.239">   /**</span>
<a href="#l1.240"></a><span id="l1.240">    * This addFeed is used by 1) Add button, 1) Update button, 3) Drop of a</span>
<a href="#l1.241"></a><span id="l1.241" class="difflineat">@@ -911,28 +973,31 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l1.242"></a><span id="l1.242">    * url better in case of errors.</span>
<a href="#l1.243"></a><span id="l1.243">    * </span>
<a href="#l1.244"></a><span id="l1.244">    * @param  [aFeedLocation] string    - the feed url; get the url from the</span>
<a href="#l1.245"></a><span id="l1.245">    *                                     input field if null.</span>
<a href="#l1.246"></a><span id="l1.246">    * @param  [aFolder] nsIMsgFolder    - folder to subscribe, current selected</span>
<a href="#l1.247"></a><span id="l1.247">    *                                     folder if null.</span>
<a href="#l1.248"></a><span id="l1.248">    * @param  [aParse] boolean          - if true (default) parse and download</span>
<a href="#l1.249"></a><span id="l1.249">    *                                     the feed's articles.</span>
<a href="#l1.250"></a><span id="l1.250" class="difflineplus">+   * @param  [aParams] object          - additional params.</span>
<a href="#l1.251"></a><span id="l1.251">    * @param  [aMode] integer           - action mode (default is kSubscribeMode)</span>
<a href="#l1.252"></a><span id="l1.252">    *                                     of the add.</span>
<a href="#l1.253"></a><span id="l1.253">    * </span>
<a href="#l1.254"></a><span id="l1.254">    * @return success boolean           - true if edit checks passed and an</span>
<a href="#l1.255"></a><span id="l1.255">    *                                     async download has been initiated.</span>
<a href="#l1.256"></a><span id="l1.256">    */</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineminus">-  addFeed: function(aFeedLocation, aFolder, aParse, aMode)</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineplus">+  addFeed: function(aFeedLocation, aFolder, aParse, aParams, aMode)</span>
<a href="#l1.259"></a><span id="l1.259">   {</span>
<a href="#l1.260"></a><span id="l1.260">     let message;</span>
<a href="#l1.261"></a><span id="l1.261">     let parse = aParse == null ? true : aParse;</span>
<a href="#l1.262"></a><span id="l1.262">     let mode = aMode == null ? this.kSubscribeMode : aMode;</span>
<a href="#l1.263"></a><span id="l1.263">     let locationValue = document.getElementById(&quot;locationValue&quot;);</span>
<a href="#l1.264"></a><span id="l1.264" class="difflineplus">+    let quickMode = aParams &amp;&amp; (&quot;quickMode&quot; in aParams) ?</span>
<a href="#l1.265"></a><span id="l1.265" class="difflineplus">+        aParams.quickMode : document.getElementById(&quot;quickMode&quot;).checked;</span>
<a href="#l1.266"></a><span id="l1.266"> </span>
<a href="#l1.267"></a><span id="l1.267">     if (aFeedLocation)</span>
<a href="#l1.268"></a><span id="l1.268">       locationValue.value = aFeedLocation;</span>
<a href="#l1.269"></a><span id="l1.269">     let feedLocation = locationValue.value.trim();</span>
<a href="#l1.270"></a><span id="l1.270"> </span>
<a href="#l1.271"></a><span id="l1.271">     if (!feedLocation)</span>
<a href="#l1.272"></a><span id="l1.272">     {</span>
<a href="#l1.273"></a><span id="l1.273">       message = locationValue.getAttribute(&quot;placeholder&quot;);</span>
<a href="#l1.274"></a><span id="l1.274" class="difflineat">@@ -966,17 +1031,16 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l1.275"></a><span id="l1.275">     {</span>
<a href="#l1.276"></a><span id="l1.276">       message = FeedUtils.strings.GetStringFromName(</span>
<a href="#l1.277"></a><span id="l1.277">                   &quot;subscribe-feedAlreadySubscribed&quot;);</span>
<a href="#l1.278"></a><span id="l1.278">       this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l1.279"></a><span id="l1.279">       return false;</span>
<a href="#l1.280"></a><span id="l1.280">     }</span>
<a href="#l1.281"></a><span id="l1.281"> </span>
<a href="#l1.282"></a><span id="l1.282">     let name = document.getElementById(&quot;nameValue&quot;).value;</span>
<a href="#l1.283"></a><span id="l1.283" class="difflineminus">-    let quickMode = document.getElementById(&quot;quickMode&quot;).checked;</span>
<a href="#l1.284"></a><span id="l1.284">     let folderURI = addFolder.isServer ? null : addFolder.URI;</span>
<a href="#l1.285"></a><span id="l1.285">     let feedProperties = { feedName     : name,</span>
<a href="#l1.286"></a><span id="l1.286">                            feedLocation : feedLocation,</span>
<a href="#l1.287"></a><span id="l1.287">                            folderURI    : folderURI,</span>
<a href="#l1.288"></a><span id="l1.288">                            server       : addFolder.server,</span>
<a href="#l1.289"></a><span id="l1.289">                            quickMode    : quickMode };</span>
<a href="#l1.290"></a><span id="l1.290"> </span>
<a href="#l1.291"></a><span id="l1.291">     let feed = this.storeFeed(feedProperties);</span>
<a href="#l1.292"></a><span id="l1.292" class="difflineat">@@ -1036,17 +1100,17 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l1.293"></a><span id="l1.293">     let editNameValue = document.getElementById(&quot;nameValue&quot;).value;</span>
<a href="#l1.294"></a><span id="l1.294">     let editFeedLocation = document.getElementById(&quot;locationValue&quot;).value.trim();</span>
<a href="#l1.295"></a><span id="l1.295">     let editQuickMode = document.getElementById(&quot;quickMode&quot;).checked;</span>
<a href="#l1.296"></a><span id="l1.296"> </span>
<a href="#l1.297"></a><span id="l1.297">     if (feed.url != editFeedLocation)</span>
<a href="#l1.298"></a><span id="l1.298">     {</span>
<a href="#l1.299"></a><span id="l1.299">       // Updating a url.  We need to add the new url and delete the old, to</span>
<a href="#l1.300"></a><span id="l1.300">       // ensure everything is cleaned up correctly.</span>
<a href="#l1.301"></a><span id="l1.301" class="difflineminus">-      this.addFeed(null, itemToEdit.parentFolder, false, this.kUpdateMode)</span>
<a href="#l1.302"></a><span id="l1.302" class="difflineplus">+      this.addFeed(null, itemToEdit.parentFolder, false, null, this.kUpdateMode)</span>
<a href="#l1.303"></a><span id="l1.303">       return;</span>
<a href="#l1.304"></a><span id="l1.304">     }</span>
<a href="#l1.305"></a><span id="l1.305"> </span>
<a href="#l1.306"></a><span id="l1.306">     let updated = false;</span>
<a href="#l1.307"></a><span id="l1.307">     // Check to see if the title value changed.</span>
<a href="#l1.308"></a><span id="l1.308">     if (feed.title != editNameValue)</span>
<a href="#l1.309"></a><span id="l1.309">     {</span>
<a href="#l1.310"></a><span id="l1.310">       feed.title = editNameValue;</span>
<a href="#l1.311"></a><span id="l1.311" class="difflineat">@@ -1133,56 +1197,88 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l1.312"></a><span id="l1.312">       // Add our feed url property to the new folder.</span>
<a href="#l1.313"></a><span id="l1.313">       updateFolderFeedUrl(newFolder, currentItem.url, false);</span>
<a href="#l1.314"></a><span id="l1.314">     }</span>
<a href="#l1.315"></a><span id="l1.315">     else</span>
<a href="#l1.316"></a><span id="l1.316">     {</span>
<a href="#l1.317"></a><span id="l1.317">       // Moving to a new account.  If dropping on the account folder, a new</span>
<a href="#l1.318"></a><span id="l1.318">       // subfolder is created if necessary.</span>
<a href="#l1.319"></a><span id="l1.319">       accountMove = true;</span>
<a href="#l1.320"></a><span id="l1.320" class="difflineplus">+      let params = {quickMode: currentItem.quickMode};</span>
<a href="#l1.321"></a><span id="l1.321">       // Subscribe to the new folder first.  If it already exists in the</span>
<a href="#l1.322"></a><span id="l1.322">       // account or on error, return.</span>
<a href="#l1.323"></a><span id="l1.323" class="difflineminus">-      if (!this.addFeed(currentItem.url, newFolder, false, this.kMoveMode))</span>
<a href="#l1.324"></a><span id="l1.324" class="difflineplus">+      if (!this.addFeed(currentItem.url, newFolder, false, params, this.kMoveMode))</span>
<a href="#l1.325"></a><span id="l1.325">         return;</span>
<a href="#l1.326"></a><span id="l1.326">       // Unsubscribe the feed from the old folder, if add to the new folder</span>
<a href="#l1.327"></a><span id="l1.327">       // is successfull.</span>
<a href="#l1.328"></a><span id="l1.328">       deleteFeed(rdf.GetResource(currentItem.url),</span>
<a href="#l1.329"></a><span id="l1.329">                  currentItem.parentFolder.server,</span>
<a href="#l1.330"></a><span id="l1.330">                  currentItem.parentFolder);</span>
<a href="#l1.331"></a><span id="l1.331">     }</span>
<a href="#l1.332"></a><span id="l1.332"> </span>
<a href="#l1.333"></a><span id="l1.333" class="difflineminus">-    // Finally, update our view layer.  Remove the old row.</span>
<a href="#l1.334"></a><span id="l1.334" class="difflineplus">+    // Finally, update our view layer.  Update old parent folder's quickMode</span>
<a href="#l1.335"></a><span id="l1.335" class="difflineplus">+    // and remove the old row.</span>
<a href="#l1.336"></a><span id="l1.336" class="difflineplus">+    this.updateFolderQuickModeInView(currentItem, currentParentItem, true);</span>
<a href="#l1.337"></a><span id="l1.337">     this.mView.removeItemAtIndex(aOldFeedIndex, true);</span>
<a href="#l1.338"></a><span id="l1.338">     if (aNewParentIndex &gt; aOldFeedIndex)</span>
<a href="#l1.339"></a><span id="l1.339">       aNewParentIndex--;</span>
<a href="#l1.340"></a><span id="l1.340"> </span>
<a href="#l1.341"></a><span id="l1.341">     if (accountMove)</span>
<a href="#l1.342"></a><span id="l1.342">     {</span>
<a href="#l1.343"></a><span id="l1.343">       // If a cross account move, download callback will update the view with</span>
<a href="#l1.344"></a><span id="l1.344">       // the new location.  Preselect folder/mode for callback.</span>
<a href="#l1.345"></a><span id="l1.345">       this.selectFolder(newFolder, true, aNewParentIndex);</span>
<a href="#l1.346"></a><span id="l1.346">       return true;</span>
<a href="#l1.347"></a><span id="l1.347">     }</span>
<a href="#l1.348"></a><span id="l1.348"> </span>
<a href="#l1.349"></a><span id="l1.349">     // Add the new row location to the view.</span>
<a href="#l1.350"></a><span id="l1.350">     currentItem.level = newParentItem.level + 1;</span>
<a href="#l1.351"></a><span id="l1.351">     currentItem.parentFolder = newFolder;</span>
<a href="#l1.352"></a><span id="l1.352" class="difflineplus">+    this.updateFolderQuickModeInView(currentItem, newParentItem, false);</span>
<a href="#l1.353"></a><span id="l1.353">     newParentItem.children.push(currentItem);</span>
<a href="#l1.354"></a><span id="l1.354"> </span>
<a href="#l1.355"></a><span id="l1.355">     if (newParentItem.open)</span>
<a href="#l1.356"></a><span id="l1.356">       // Close the container, selecting the feed will rebuild the view rows.</span>
<a href="#l1.357"></a><span id="l1.357">       this.mView.toggle(aNewParentIndex);</span>
<a href="#l1.358"></a><span id="l1.358"> </span>
<a href="#l1.359"></a><span id="l1.359">     this.selectFeed({folder: newParentItem.folder, url: currentItem.url},</span>
<a href="#l1.360"></a><span id="l1.360">                     aNewParentIndex);</span>
<a href="#l1.361"></a><span id="l1.361"> </span>
<a href="#l1.362"></a><span id="l1.362">     let message = FeedUtils.strings.GetStringFromName(&quot;subscribe-feedMoved&quot;);</span>
<a href="#l1.363"></a><span id="l1.363">     this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l1.364"></a><span id="l1.364">   },</span>
<a href="#l1.365"></a><span id="l1.365"> </span>
<a href="#l1.366"></a><span id="l1.366" class="difflineplus">+  updateFolderQuickModeInView: function (aFeedItem, aParentItem, aRemove)</span>
<a href="#l1.367"></a><span id="l1.367" class="difflineplus">+  {</span>
<a href="#l1.368"></a><span id="l1.368" class="difflineplus">+    let feedItem = aFeedItem;</span>
<a href="#l1.369"></a><span id="l1.369" class="difflineplus">+    let parentItem = aParentItem;</span>
<a href="#l1.370"></a><span id="l1.370" class="difflineplus">+    let feedUrlArray = getFeedUrlsInFolder(feedItem.parentFolder);</span>
<a href="#l1.371"></a><span id="l1.371" class="difflineplus">+    let feedsInFolder = feedUrlArray ? feedUrlArray.length : 0;</span>
<a href="#l1.372"></a><span id="l1.372" class="difflineplus">+</span>
<a href="#l1.373"></a><span id="l1.373" class="difflineplus">+    if (aRemove &amp;&amp; feedsInFolder &lt; 1)</span>
<a href="#l1.374"></a><span id="l1.374" class="difflineplus">+      // Removed only feed in folder; set quickMode to server default.</span>
<a href="#l1.375"></a><span id="l1.375" class="difflineplus">+      parentItem.quickMode = parentItem.folder.server.getBoolValue(&quot;quickMode&quot;);</span>
<a href="#l1.376"></a><span id="l1.376" class="difflineplus">+</span>
<a href="#l1.377"></a><span id="l1.377" class="difflineplus">+    if (!aRemove)</span>
<a href="#l1.378"></a><span id="l1.378" class="difflineplus">+    {</span>
<a href="#l1.379"></a><span id="l1.379" class="difflineplus">+      // Just added a feed to a folder.  If there are already feeds in the</span>
<a href="#l1.380"></a><span id="l1.380" class="difflineplus">+      // folder, the feed must reflect the parent's quickMode.  If it is the</span>
<a href="#l1.381"></a><span id="l1.381" class="difflineplus">+      // only feed, update the parent folder to the feed's quickMode.</span>
<a href="#l1.382"></a><span id="l1.382" class="difflineplus">+      if (feedsInFolder &gt; 1)</span>
<a href="#l1.383"></a><span id="l1.383" class="difflineplus">+      {</span>
<a href="#l1.384"></a><span id="l1.384" class="difflineplus">+        let feedResource = rdf.GetResource(feedItem.url);</span>
<a href="#l1.385"></a><span id="l1.385" class="difflineplus">+        let feed = new Feed(feedResource, feedItem.parentFolder.server);</span>
<a href="#l1.386"></a><span id="l1.386" class="difflineplus">+        feed.quickMode = parentItem.quickMode;</span>
<a href="#l1.387"></a><span id="l1.387" class="difflineplus">+        feedItem.quickMode = parentItem.quickMode;</span>
<a href="#l1.388"></a><span id="l1.388" class="difflineplus">+      }</span>
<a href="#l1.389"></a><span id="l1.389" class="difflineplus">+      else</span>
<a href="#l1.390"></a><span id="l1.390" class="difflineplus">+        parentItem.quickMode = feedItem.quickMode;</span>
<a href="#l1.391"></a><span id="l1.391" class="difflineplus">+    }</span>
<a href="#l1.392"></a><span id="l1.392" class="difflineplus">+  },</span>
<a href="#l1.393"></a><span id="l1.393" class="difflineplus">+</span>
<a href="#l1.394"></a><span id="l1.394">   beginDrag: function (aEvent)</span>
<a href="#l1.395"></a><span id="l1.395">   {</span>
<a href="#l1.396"></a><span id="l1.396">     // Get the selected feed article (if there is one).</span>
<a href="#l1.397"></a><span id="l1.397">     let seln = this.mView.selection;</span>
<a href="#l1.398"></a><span id="l1.398">     if (seln.count != 1)</span>
<a href="#l1.399"></a><span id="l1.399">       return;</span>
<a href="#l1.400"></a><span id="l1.400"> </span>
<a href="#l1.401"></a><span id="l1.401">     // Only initiate a drag if the item is a feed (ignore folders/containers).</span>
<a href="#l1.402"></a><span id="l1.402" class="difflineat">@@ -1222,17 +1318,17 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l1.403"></a><span id="l1.403">         if (curItem)</span>
<a href="#l1.404"></a><span id="l1.404">         {</span>
<a href="#l1.405"></a><span id="l1.405">           let parentIndex, parentItem, newItem, level;</span>
<a href="#l1.406"></a><span id="l1.406">           let rows = win.mFeedContainers;</span>
<a href="#l1.407"></a><span id="l1.407">           if (curItem.container)</span>
<a href="#l1.408"></a><span id="l1.408">           {</span>
<a href="#l1.409"></a><span id="l1.409">             // Open the container, if it exists.</span>
<a href="#l1.410"></a><span id="l1.410">             let folderExists = win.selectFolder(feed.folder, true, curIndex);</span>
<a href="#l1.411"></a><span id="l1.411" class="difflineminus">-            if (!folderExists) //curItem.folder.isServer &amp;&amp; </span>
<a href="#l1.412"></a><span id="l1.412" class="difflineplus">+            if (!folderExists)</span>
<a href="#l1.413"></a><span id="l1.413">             {</span>
<a href="#l1.414"></a><span id="l1.414">               // This means a new folder was created.</span>
<a href="#l1.415"></a><span id="l1.415">               parentIndex = curIndex;</span>
<a href="#l1.416"></a><span id="l1.416">               parentItem = curItem;</span>
<a href="#l1.417"></a><span id="l1.417">               level = curItem.level + 1;</span>
<a href="#l1.418"></a><span id="l1.418">               newItem = win.makeFolderObject(feed.folder, level);</span>
<a href="#l1.419"></a><span id="l1.419">             }</span>
<a href="#l1.420"></a><span id="l1.420">             else</span>
<a href="#l1.421"></a><span id="l1.421" class="difflineat">@@ -1251,16 +1347,17 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l1.422"></a><span id="l1.422">           else</span>
<a href="#l1.423"></a><span id="l1.423">           {</span>
<a href="#l1.424"></a><span id="l1.424">             parentIndex = win.mView.getParentIndex(curIndex);</span>
<a href="#l1.425"></a><span id="l1.425">             parentItem = win.mView.getItemAtIndex(parentIndex);</span>
<a href="#l1.426"></a><span id="l1.426">             level = curItem.level;</span>
<a href="#l1.427"></a><span id="l1.427">             newItem = win.makeFeedObject(feed, feed.folder, level);</span>
<a href="#l1.428"></a><span id="l1.428">           }</span>
<a href="#l1.429"></a><span id="l1.429"> </span>
<a href="#l1.430"></a><span id="l1.430" class="difflineplus">+          win.updateFolderQuickModeInView(newItem, parentItem, false);</span>
<a href="#l1.431"></a><span id="l1.431">           parentItem.children.push(newItem);</span>
<a href="#l1.432"></a><span id="l1.432"> </span>
<a href="#l1.433"></a><span id="l1.433">           if (win.mActionMode == win.kSubscribeMode)</span>
<a href="#l1.434"></a><span id="l1.434">             message = FeedUtils.strings.GetStringFromName(</span>
<a href="#l1.435"></a><span id="l1.435">                         &quot;subscribe-feedAdded&quot;);</span>
<a href="#l1.436"></a><span id="l1.436">           if (win.mActionMode == win.kUpdateMode)</span>
<a href="#l1.437"></a><span id="l1.437">           {</span>
<a href="#l1.438"></a><span id="l1.438">             win.removeFeed(false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-subscriptions.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-subscriptions.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -48,17 +48,18 @@</span>
<a href="#l2.4"></a><span id="l2.4">         title=&quot;&amp;feedSubscriptions.label;&quot;</span>
<a href="#l2.5"></a><span id="l2.5">         windowtype=&quot;Mail:News-BlogSubscriptions&quot;</span>
<a href="#l2.6"></a><span id="l2.6">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l2.7"></a><span id="l2.7">         xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l2.8"></a><span id="l2.8">         xmlns:nc=&quot;http://home.netscape.com/NC-rdf#&quot;</span>
<a href="#l2.9"></a><span id="l2.9">         persist=&quot;width height screenX screenY sizemode&quot;</span>
<a href="#l2.10"></a><span id="l2.10">         onload=&quot;gFeedSubscriptionsWindow.onLoad();&quot;</span>
<a href="#l2.11"></a><span id="l2.11">         onunload=&quot;return gFeedSubscriptionsWindow.onUnload();&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        onclick=&quot;gFeedSubscriptionsWindow.onClick(event);&quot;&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+        onkeypress=&quot;gFeedSubscriptionsWindow.onKeyPress(event);&quot;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+        onmousedown=&quot;gFeedSubscriptionsWindow.onMouseDown(event);&quot;&gt;</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16">   &lt;script type=&quot;application/javascript&quot; src=&quot;utils.js&quot;/&gt;</span>
<a href="#l2.17"></a><span id="l2.17">   &lt;script type=&quot;application/javascript&quot; src=&quot;file-utils.js&quot;/&gt;</span>
<a href="#l2.18"></a><span id="l2.18">   &lt;script type=&quot;application/javascript&quot; src=&quot;debug-utils.js&quot;/&gt;</span>
<a href="#l2.19"></a><span id="l2.19">   &lt;script type=&quot;application/javascript&quot; src=&quot;feed-subscriptions.js&quot;/&gt;</span>
<a href="#l2.20"></a><span id="l2.20">   &lt;script type=&quot;application/javascript&quot; src=&quot;Feed.js&quot;/&gt;</span>
<a href="#l2.21"></a><span id="l2.21">   &lt;script type=&quot;application/javascript&quot; src=&quot;FeedItem.js&quot;/&gt;</span>
<a href="#l2.22"></a><span id="l2.22">   &lt;script type=&quot;application/javascript&quot; src=&quot;feed-parser.js&quot;/&gt;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineat">@@ -85,17 +86,16 @@</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25">     &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27">     &lt;tree id=&quot;rssSubscriptionsList&quot;</span>
<a href="#l2.28"></a><span id="l2.28">           treelines=&quot;true&quot;</span>
<a href="#l2.29"></a><span id="l2.29">           flex=&quot;1&quot;</span>
<a href="#l2.30"></a><span id="l2.30">           hidecolumnpicker=&quot;true&quot;</span>
<a href="#l2.31"></a><span id="l2.31">           onselect=&quot;gFeedSubscriptionsWindow.onSelect();&quot;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-          onkeypress=&quot;gFeedSubscriptionsWindow.onKeyPress(event);&quot;</span>
<a href="#l2.33"></a><span id="l2.33">           seltype=&quot;single&quot;&gt;</span>
<a href="#l2.34"></a><span id="l2.34">       &lt;treecols&gt;</span>
<a href="#l2.35"></a><span id="l2.35">         &lt;treecol id=&quot;folderNameCol&quot;</span>
<a href="#l2.36"></a><span id="l2.36">                  flex=&quot;2&quot;</span>
<a href="#l2.37"></a><span id="l2.37">                  primary=&quot;true&quot;</span>
<a href="#l2.38"></a><span id="l2.38">                  hideheader=&quot;true&quot;/&gt;</span>
<a href="#l2.39"></a><span id="l2.39">       &lt;/treecols&gt;</span>
<a href="#l2.40"></a><span id="l2.40">       &lt;treechildren id=&quot;subscriptionChildren&quot;</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineat">@@ -125,17 +125,19 @@</span>
<a href="#l2.42"></a><span id="l2.42">                 &lt;label id=&quot;locationLabel&quot;</span>
<a href="#l2.43"></a><span id="l2.43">                        accesskey=&quot;&amp;feedLocation.accesskey;&quot;</span>
<a href="#l2.44"></a><span id="l2.44">                        control=&quot;locationValue&quot;</span>
<a href="#l2.45"></a><span id="l2.45">                        value=&quot;&amp;feedLocation.label;&quot;/&gt;</span>
<a href="#l2.46"></a><span id="l2.46">               &lt;/hbox&gt;</span>
<a href="#l2.47"></a><span id="l2.47">               &lt;textbox id=&quot;locationValue&quot;</span>
<a href="#l2.48"></a><span id="l2.48">                        class=&quot;uri-element&quot;</span>
<a href="#l2.49"></a><span id="l2.49">                        placeholder=&quot;&amp;feedLocation.placeholder;&quot;</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-                       clickSelectsAll=&quot;true&quot;/&gt;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+                       clickSelectsAll=&quot;true&quot;</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+                       onfocus=&quot;gFeedSubscriptionsWindow.setSummaryFocus();&quot;</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+                       onblur=&quot;gFeedSubscriptionsWindow.setSummaryFocus();&quot;/&gt;</span>
<a href="#l2.54"></a><span id="l2.54">             &lt;/row&gt;</span>
<a href="#l2.55"></a><span id="l2.55">             &lt;row&gt;</span>
<a href="#l2.56"></a><span id="l2.56">               &lt;hbox align=&quot;right&quot; valign=&quot;middle&quot;&gt;</span>
<a href="#l2.57"></a><span id="l2.57">                 &lt;label id=&quot;feedFolderLabel&quot;</span>
<a href="#l2.58"></a><span id="l2.58">                        value=&quot;&amp;feedFolder.label;&quot;</span>
<a href="#l2.59"></a><span id="l2.59">                        accesskey=&quot;&amp;feedFolder.accesskey;&quot;</span>
<a href="#l2.60"></a><span id="l2.60">                        control=&quot;selectFolder&quot;/&gt;</span>
<a href="#l2.61"></a><span id="l2.61">               &lt;/hbox&gt;</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineat">@@ -194,17 +196,18 @@</span>
<a href="#l2.63"></a><span id="l2.63">                     &lt;/rule&gt;</span>
<a href="#l2.64"></a><span id="l2.64">                   &lt;/template&gt;</span>
<a href="#l2.65"></a><span id="l2.65">               &lt;/menulist&gt;</span>
<a href="#l2.66"></a><span id="l2.66">             &lt;/row&gt;</span>
<a href="#l2.67"></a><span id="l2.67">           &lt;/rows&gt;</span>
<a href="#l2.68"></a><span id="l2.68">         &lt;/grid&gt;</span>
<a href="#l2.69"></a><span id="l2.69">         &lt;checkbox id=&quot;quickMode&quot;</span>
<a href="#l2.70"></a><span id="l2.70">                   accesskey=&quot;&amp;quickMode.accesskey;&quot;</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-                  label=&quot;&amp;quickMode.label;&quot;/&gt;</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+                  label=&quot;&amp;quickMode.label;&quot;</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+                  oncommand=&quot;gFeedSubscriptionsWindow.setSummary(this.checked)&quot;/&gt;</span>
<a href="#l2.74"></a><span id="l2.74">       &lt;/vbox&gt;</span>
<a href="#l2.75"></a><span id="l2.75">     &lt;/hbox&gt;</span>
<a href="#l2.76"></a><span id="l2.76"> </span>
<a href="#l2.77"></a><span id="l2.77">     &lt;hbox id=&quot;statusContainerBox&quot;</span>
<a href="#l2.78"></a><span id="l2.78">           align=&quot;center&quot;</span>
<a href="#l2.79"></a><span id="l2.79">           valign=&quot;middle&quot;&gt;</span>
<a href="#l2.80"></a><span id="l2.80">       &lt;label id=&quot;statusText&quot;</span>
<a href="#l2.81"></a><span id="l2.81">              class=&quot;statusbarpanel-text&quot;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

