<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 12851:28c68bdee3e6da1894add7f35d45105348791f89</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 28c68bdee3e6da1894add7f35d45105348791f89" />
<meta property="og:url" content="/comm-central/rev/28c68bdee3e6da1894add7f35d45105348791f89" />
<meta property="og:description" content="Bug 798278 - Implement multiple plugin doorhanger UI (Port Bug 797677 and Bug 754472), fix plugin tests" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 28c68bdee3e6da1894add7f35d45105348791f89 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/28c68bdee3e6da1894add7f35d45105348791f89">shortlog</a> |
<a href="/comm-central/log/28c68bdee3e6da1894add7f35d45105348791f89">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/28c68bdee3e6da1894add7f35d45105348791f89">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/28c68bdee3e6da1894add7f35d45105348791f89">files</a> |
changeset |
<a href="/comm-central/raw-rev/28c68bdee3e6da1894add7f35d45105348791f89">raw</a>  | <a href="/comm-central/archive/28c68bdee3e6da1894add7f35d45105348791f89.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=798278">Bug 798278</a> - Implement multiple plugin doorhanger UI (Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=797677">Bug 797677</a> and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=754472">Bug 754472</a>), fix plugin tests
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#114;&#97;&#110;&#107;&#32;&#87;&#101;&#105;&#110;&#32;&#60;&#109;&#99;&#115;&#109;&#117;&#114;&#102;&#64;&#109;&#99;&#115;&#109;&#117;&#114;&#102;&#46;&#100;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 03 Aug 2013 16:39:18 +0200</td></tr>

<tr>
 <td>changeset 12851</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/28c68bdee3e6da1894add7f35d45105348791f89">28c68bdee3e6da1894add7f35d45105348791f89</a></td>
</tr>



<tr>
<td>parent 12850</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e36c030950bc6b325861c1642673a345d6a07f2d">e36c030950bc6b325861c1642673a345d6a07f2d</a>
</td>
</tr>

<tr>
<td>child 12852</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d9ab7a6d13fe0b691944434fc38e5a7565e82934">d9ab7a6d13fe0b691944434fc38e5a7565e82934</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=28c68bdee3e6da1894add7f35d45105348791f89">9387</a></td></tr>
<tr><td>push user</td><td>mcsmurf@mcsmurf.de</td></tr>
<tr><td>push date</td><td class="date age">Sat, 03 Aug 2013 14:40:17 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d9ab7a6d13fe [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d9ab7a6d13fe0b691944434fc38e5a7565e82934">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d9ab7a6d13fe0b691944434fc38e5a7565e82934&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d9ab7a6d13fe0b691944434fc38e5a7565e82934&newProject=comm-central&newRevision=e36c030950bc6b325861c1642673a345d6a07f2d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d9ab7a6d13fe0b691944434fc38e5a7565e82934&newProject=comm-central&newRevision=e36c030950bc6b325861c1642673a345d6a07f2d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d9ab7a6d13fe0b691944434fc38e5a7565e82934&newProject=comm-central&newRevision=e36c030950bc6b325861c1642673a345d6a07f2d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=798278">798278</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=797677">797677</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=754472">754472</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=798278">Bug 798278</a> - Implement multiple plugin doorhanger UI (Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=797677">Bug 797677</a> and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=754472">Bug 754472</a>), fix plugin tests
approval for CLOSED TREE by ewong</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/Makefile.in">suite/browser/test/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/Makefile.in">file</a> |
<a href="/comm-central/annotate/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/Makefile.in">annotate</a> |
<a href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/Makefile.in">diff</a> |
<a href="/comm-central/comparison/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/Makefile.in">comparison</a> |
<a href="/comm-central/log/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockNoPlugins.xml">suite/browser/test/browser/blockNoPlugins.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockNoPlugins.xml">file</a> |
<a href="/comm-central/annotate/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockNoPlugins.xml">annotate</a> |
<a href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockNoPlugins.xml">diff</a> |
<a href="/comm-central/comparison/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockNoPlugins.xml">comparison</a> |
<a href="/comm-central/log/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockNoPlugins.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableNoUpdate.xml">suite/browser/test/browser/blockPluginVulnerableNoUpdate.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableNoUpdate.xml">file</a> |
<a href="/comm-central/annotate/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableNoUpdate.xml">annotate</a> |
<a href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableNoUpdate.xml">diff</a> |
<a href="/comm-central/comparison/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableNoUpdate.xml">comparison</a> |
<a href="/comm-central/log/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableNoUpdate.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableUpdatable.xml">suite/browser/test/browser/blockPluginVulnerableUpdatable.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableUpdatable.xml">file</a> |
<a href="/comm-central/annotate/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableUpdatable.xml">annotate</a> |
<a href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableUpdatable.xml">diff</a> |
<a href="/comm-central/comparison/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableUpdatable.xml">comparison</a> |
<a href="/comm-central/log/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/blockPluginVulnerableUpdatable.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/browser_pluginnotification.js">suite/browser/test/browser/browser_pluginnotification.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/browser_pluginnotification.js">file</a> |
<a href="/comm-central/annotate/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/browser_pluginnotification.js">annotate</a> |
<a href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/browser_pluginnotification.js">diff</a> |
<a href="/comm-central/comparison/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/browser_pluginnotification.js">comparison</a> |
<a href="/comm-central/log/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/browser_pluginnotification.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/head.js">suite/browser/test/browser/head.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/head.js">file</a> |
<a href="/comm-central/annotate/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/head.js">annotate</a> |
<a href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/head.js">diff</a> |
<a href="/comm-central/comparison/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/head.js">comparison</a> |
<a href="/comm-central/log/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/head.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/plugin_clickToPlayDeny.html">suite/browser/test/browser/plugin_clickToPlayDeny.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/plugin_clickToPlayDeny.html">file</a> |
<a href="/comm-central/annotate/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/plugin_clickToPlayDeny.html">annotate</a> |
<a href="/comm-central/diff/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/plugin_clickToPlayDeny.html">diff</a> |
<a href="/comm-central/comparison/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/plugin_clickToPlayDeny.html">comparison</a> |
<a href="/comm-central/log/28c68bdee3e6da1894add7f35d45105348791f89/suite/browser/test/browser/plugin_clickToPlayDeny.html">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/browser/test/Makefile.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/browser/test/Makefile.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -45,27 +45,32 @@ endif</span>
<a href="#l1.4"></a><span id="l1.4">                  browser_bug561636.js \</span>
<a href="#l1.5"></a><span id="l1.5">                  browser_bug562649.js \</span>
<a href="#l1.6"></a><span id="l1.6">                  browser_bug581947.js \</span>
<a href="#l1.7"></a><span id="l1.7">                  browser_bug585511.js \</span>
<a href="#l1.8"></a><span id="l1.8">                  browser_bug595507.js \</span>
<a href="#l1.9"></a><span id="l1.9">                  browser_bug623155.js \</span>
<a href="#l1.10"></a><span id="l1.10">                  browser_fayt.js \</span>
<a href="#l1.11"></a><span id="l1.11">                  browser_page_style_menu.js \</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+                 blockPluginVulnerableNoUpdate.xml \</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+                 blockPluginVulnerableUpdatable.xml \</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+                 blockNoPlugins.xml \</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+                 blockPluginHard.xml \</span>
<a href="#l1.16"></a><span id="l1.16">                  browser_pluginCrashCommentAndURL.js \</span>
<a href="#l1.17"></a><span id="l1.17">                  page_style_sample.html \</span>
<a href="#l1.18"></a><span id="l1.18">                  browser_pageInfo.js \</span>
<a href="#l1.19"></a><span id="l1.19">                  feed_tab.html \</span>
<a href="#l1.20"></a><span id="l1.20">                  browser_pluginnotification.js \</span>
<a href="#l1.21"></a><span id="l1.21">                  browser_pluginplaypreview.js \</span>
<a href="#l1.22"></a><span id="l1.22">                  pluginCrashCommentAndURL.html \</span>
<a href="#l1.23"></a><span id="l1.23">                  plugin_alternate_content.html \</span>
<a href="#l1.24"></a><span id="l1.24">                  plugin_bug743421.html \</span>
<a href="#l1.25"></a><span id="l1.25">                  plugin_bug749455.html \</span>
<a href="#l1.26"></a><span id="l1.26">                  plugin_clickToPlayAllow.html \</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+                 plugin_clickToPlayDeny.html \</span>
<a href="#l1.28"></a><span id="l1.28">                  plugin_hidden_to_visible.html \</span>
<a href="#l1.29"></a><span id="l1.29">                  plugin_unknown.html \</span>
<a href="#l1.30"></a><span id="l1.30">                  plugin_test.html \</span>
<a href="#l1.31"></a><span id="l1.31">                  plugin_test2.html \</span>
<a href="#l1.32"></a><span id="l1.32">                  plugin_test3.html \</span>
<a href="#l1.33"></a><span id="l1.33">                  plugin_two_types.html \</span>
<a href="#l1.34"></a><span id="l1.34">                  plugin_both.html \</span>
<a href="#l1.35"></a><span id="l1.35">                  plugin_both2.html \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/suite/browser/test/browser/blockNoPlugins.xml</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,7 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+&lt;blocklist xmlns=&quot;http://www.mozilla.org/2006/addons-blocklist&quot; lastupdate=&quot;1336406310001&quot;&gt;</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+  &lt;emItems&gt;</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+  &lt;/emItems&gt;</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+  &lt;pluginItems&gt;</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+  &lt;/pluginItems&gt;</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+&lt;/blocklist&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/suite/browser/test/browser/blockPluginVulnerableNoUpdate.xml</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,11 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+&lt;blocklist xmlns=&quot;http://www.mozilla.org/2006/addons-blocklist&quot; lastupdate=&quot;1336406310000&quot;&gt;</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+  &lt;emItems&gt;</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+  &lt;/emItems&gt;</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+  &lt;pluginItems&gt;</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+    &lt;pluginItem blockID=&quot;p9999&quot;&gt;</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+      &lt;match name=&quot;filename&quot; exp=&quot;libnptest\.so|nptest\.dll|Test\.plugin&quot; /&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+      &lt;versionRange severity=&quot;0&quot; vulnerabilitystatus=&quot;2&quot;&gt;&lt;/versionRange&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    &lt;/pluginItem&gt;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  &lt;/pluginItems&gt;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+&lt;/blocklist&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">new file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- /dev/null</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ b/suite/browser/test/browser/blockPluginVulnerableUpdatable.xml</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -0,0 +1,11 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineplus">+&lt;blocklist xmlns=&quot;http://www.mozilla.org/2006/addons-blocklist&quot; lastupdate=&quot;1336406310000&quot;&gt;</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineplus">+  &lt;emItems&gt;</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineplus">+  &lt;/emItems&gt;</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+  &lt;pluginItems&gt;</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+    &lt;pluginItem blockID=&quot;p9999&quot;&gt;</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+      &lt;match name=&quot;filename&quot; exp=&quot;libnptest\.so|nptest\.dll|Test\.plugin&quot; /&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+      &lt;versionRange severity=&quot;0&quot; vulnerabilitystatus=&quot;1&quot;&gt;&lt;/versionRange&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    &lt;/pluginItem&gt;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+  &lt;/pluginItems&gt;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+&lt;/blocklist&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/browser/test/browser/browser_pluginnotification.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/browser/test/browser/browser_pluginnotification.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l5.4"></a><span id="l5.4"> var rootDir = getRootDirectory(gTestPath);</span>
<a href="#l5.5"></a><span id="l5.5"> const gTestRoot = rootDir;</span>
<a href="#l5.6"></a><span id="l5.6"> const gHttpTestRoot = rootDir.replace(&quot;chrome://mochitests/content/&quot;, &quot;http://127.0.0.1:8888/&quot;);</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> var gTestBrowser = null;</span>
<a href="#l5.9"></a><span id="l5.9"> var gNextTest = null;</span>
<a href="#l5.10"></a><span id="l5.10"> var gClickToPlayPluginActualEvents = 0;</span>
<a href="#l5.11"></a><span id="l5.11"> var gClickToPlayPluginExpectedEvents = 5;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+var gPluginHost = Components.classes[&quot;@mozilla.org/plugin/host;1&quot;].getService(Components.interfaces.nsIPluginHost);</span>
<a href="#l5.13"></a><span id="l5.13"> </span>
<a href="#l5.14"></a><span id="l5.14"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> // This listens for the next opened tab and checks it is of the right url.</span>
<a href="#l5.17"></a><span id="l5.17"> // opencallback is called when the new tab is fully loaded</span>
<a href="#l5.18"></a><span id="l5.18"> // closecallback is called when the tab is closed</span>
<a href="#l5.19"></a><span id="l5.19"> function TabOpenListener(url, opencallback, closecallback) {</span>
<a href="#l5.20"></a><span id="l5.20">   this.url = url;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -52,18 +53,27 @@ TabOpenListener.prototype = {</span>
<a href="#l5.22"></a><span id="l5.22">       executeSoon(this.closecallback);</span>
<a href="#l5.23"></a><span id="l5.23">       this.closecallback = null;</span>
<a href="#l5.24"></a><span id="l5.24">     }</span>
<a href="#l5.25"></a><span id="l5.25">   }</span>
<a href="#l5.26"></a><span id="l5.26"> };</span>
<a href="#l5.27"></a><span id="l5.27"> </span>
<a href="#l5.28"></a><span id="l5.28"> function test() {</span>
<a href="#l5.29"></a><span id="l5.29">   waitForExplicitFinish();</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-  registerCleanupFunction(function() { Services.prefs.clearUserPref(&quot;plugins.click_to_play&quot;); });</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+  registerCleanupFunction(function() {</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+    Services.prefs.clearUserPref(&quot;plugins.click_to_play&quot;);</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+    Services.prefs.clearUserPref(&quot;extensions.blocklist.suppressUI&quot;);</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+    getTestPlugin().enabledState = Ci.nsIPluginTag.STATE_ENABLED;</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+    getTestPlugin(&quot;Second Test Plug-in&quot;).enabledState = Ci.nsIPluginTag.STATE_ENABLED;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+  });</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+</span>
<a href="#l5.38"></a><span id="l5.38">   Services.prefs.setBoolPref(&quot;plugins.click_to_play&quot;, false);</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+  Services.prefs.setBoolPref(&quot;extensions.blocklist.suppressUI&quot;, true);</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+  var plugin = getTestPlugin();</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+  plugin.enabledState = Ci.nsIPluginTag.STATE_ENABLED;</span>
<a href="#l5.42"></a><span id="l5.42"> </span>
<a href="#l5.43"></a><span id="l5.43">   var newTab = gBrowser.addTab();</span>
<a href="#l5.44"></a><span id="l5.44">   gBrowser.selectedTab = newTab;</span>
<a href="#l5.45"></a><span id="l5.45">   gTestBrowser = gBrowser.selectedBrowser;</span>
<a href="#l5.46"></a><span id="l5.46">   gTestBrowser.addEventListener(&quot;load&quot;, pageLoad, true);</span>
<a href="#l5.47"></a><span id="l5.47">   gTestBrowser.addEventListener(&quot;PluginBindingAttached&quot;, handleBindingAttached, true);</span>
<a href="#l5.48"></a><span id="l5.48">   prepareTest(test1, gTestRoot + &quot;plugin_unknown.html&quot;);</span>
<a href="#l5.49"></a><span id="l5.49"> }</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineat">@@ -105,17 +115,16 @@ function test1() {</span>
<a href="#l5.51"></a><span id="l5.51">   var pluginNode = gTestBrowser.contentDocument.getElementById(&quot;unknown&quot;);</span>
<a href="#l5.52"></a><span id="l5.52">   ok(pluginNode, &quot;Test 1, Found plugin in page&quot;);</span>
<a href="#l5.53"></a><span id="l5.53">   var objLoadingContent = pluginNode.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.54"></a><span id="l5.54">   is(objLoadingContent.pluginFallbackType, Ci.nsIObjectLoadingContent.PLUGIN_UNSUPPORTED, &quot;Test 1, plugin fallback type should be PLUGIN_UNSUPPORTED&quot;);</span>
<a href="#l5.55"></a><span id="l5.55"> </span>
<a href="#l5.56"></a><span id="l5.56">   var plugin = getTestPlugin();</span>
<a href="#l5.57"></a><span id="l5.57">   ok(plugin, &quot;Should have a test plugin&quot;);</span>
<a href="#l5.58"></a><span id="l5.58">   plugin.enabledState = Ci.nsIPluginTag.STATE_ENABLED;</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-  plugin.blocklisted = false;</span>
<a href="#l5.60"></a><span id="l5.60">   prepareTest(test2, gTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.61"></a><span id="l5.61"> }</span>
<a href="#l5.62"></a><span id="l5.62"> </span>
<a href="#l5.63"></a><span id="l5.63"> // Tests a page with a working plugin in it.</span>
<a href="#l5.64"></a><span id="l5.64"> function test2() {</span>
<a href="#l5.65"></a><span id="l5.65">   var notificationBox = gBrowser.getNotificationBox(gTestBrowser);</span>
<a href="#l5.66"></a><span id="l5.66">   ok(!notificationBox.getNotificationWithValue(&quot;missing-plugins&quot;), &quot;Test 2, Should not have displayed the missing plugin notification&quot;);</span>
<a href="#l5.67"></a><span id="l5.67">   ok(!notificationBox.getNotificationWithValue(&quot;blocked-plugins&quot;), &quot;Test 2, Should not have displayed the blocked plugin notification&quot;);</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineat">@@ -149,18 +158,21 @@ function test3() {</span>
<a href="#l5.69"></a><span id="l5.69"> function test4(tab, win) {</span>
<a href="#l5.70"></a><span id="l5.70">   is(win.wrappedJSObject.gViewController.currentViewId, &quot;addons://list/plugin&quot;, &quot;Test 4, Should have displayed the plugins pane&quot;);</span>
<a href="#l5.71"></a><span id="l5.71">   gBrowser.removeTab(tab);</span>
<a href="#l5.72"></a><span id="l5.72"> }</span>
<a href="#l5.73"></a><span id="l5.73"> </span>
<a href="#l5.74"></a><span id="l5.74"> function prepareTest5() {</span>
<a href="#l5.75"></a><span id="l5.75">   var plugin = getTestPlugin();</span>
<a href="#l5.76"></a><span id="l5.76">   plugin.enabledState = Ci.nsIPluginTag.STATE_ENABLED;</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-  plugin.blocklisted = true;</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-  prepareTest(test5, gTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+  setAndUpdateBlocklist(gHttpTestRoot + &quot;blockPluginHard.xml&quot;,</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+    function() {</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+      info(&quot;prepareTest5 callback&quot;);</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+      prepareTest(test5, gTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+    });</span>
<a href="#l5.84"></a><span id="l5.84"> }</span>
<a href="#l5.85"></a><span id="l5.85"> </span>
<a href="#l5.86"></a><span id="l5.86"> // Tests a page with a blocked plugin in it.</span>
<a href="#l5.87"></a><span id="l5.87"> function test5() {</span>
<a href="#l5.88"></a><span id="l5.88">   var notificationBox = gBrowser.getNotificationBox(gTestBrowser);</span>
<a href="#l5.89"></a><span id="l5.89">   ok(!notificationBox.getNotificationWithValue(&quot;missing-plugins&quot;), &quot;Test 5, Should not have displayed the missing plugin notification&quot;);</span>
<a href="#l5.90"></a><span id="l5.90">   ok(notificationBox.getNotificationWithValue(&quot;blocked-plugins&quot;), &quot;Test 5, Should have displayed the blocked plugin notification&quot;);</span>
<a href="#l5.91"></a><span id="l5.91">   ok(notificationBox._missingPlugins, &quot;Test 5, Should be a missing plugin list&quot;);</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineat">@@ -190,22 +202,24 @@ function test6() {</span>
<a href="#l5.93"></a><span id="l5.93"> function test7() {</span>
<a href="#l5.94"></a><span id="l5.94">   var notificationBox = gBrowser.getNotificationBox(gTestBrowser);</span>
<a href="#l5.95"></a><span id="l5.95">   ok(notificationBox.getNotificationWithValue(&quot;missing-plugins&quot;), &quot;Test 7, Should have displayed the missing plugin notification&quot;);</span>
<a href="#l5.96"></a><span id="l5.96">   ok(!notificationBox.getNotificationWithValue(&quot;blocked-plugins&quot;), &quot;Test 7, Should not have displayed the blocked plugin notification&quot;);</span>
<a href="#l5.97"></a><span id="l5.97">   ok(notificationBox._missingPlugins, &quot;Test 7, Should be a missing plugin list&quot;);</span>
<a href="#l5.98"></a><span id="l5.98">   ok(notificationBox.missingPlugins.has(&quot;application/x-unknown&quot;), &quot;Test 7, Should know about application/x-unknown&quot;);</span>
<a href="#l5.99"></a><span id="l5.99">   ok(notificationBox.missingPlugins.has(&quot;application/x-test&quot;), &quot;Test 7, Should know about application/x-test&quot;);</span>
<a href="#l5.100"></a><span id="l5.100"> </span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+  Services.prefs.setBoolPref(&quot;plugins.click_to_play&quot;, true);</span>
<a href="#l5.102"></a><span id="l5.102">   var plugin = getTestPlugin();</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-  plugin.enabledState = Ci.nsIPluginTag.STATE_ENABLED;</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-  plugin.blocklisted = false;</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-  Services.prefs.setBoolPref(&quot;plugins.click_to_play&quot;, true);</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineplus">+  plugin.enabledState = Ci.nsIPluginTag.STATE_CLICKTOPLAY;</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+  getTestPlugin(&quot;Second Test Plug-in&quot;).enabledState = Ci.nsIPluginTag.STATE_CLICKTOPLAY;</span>
<a href="#l5.108"></a><span id="l5.108"> </span>
<a href="#l5.109"></a><span id="l5.109" class="difflineminus">-  prepareTest(test8, gTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+  setAndUpdateBlocklist(gHttpTestRoot + &quot;blockNoPlugins.xml&quot;, function() {</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+    prepareTest(test8, gTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+  });</span>
<a href="#l5.113"></a><span id="l5.113"> }</span>
<a href="#l5.114"></a><span id="l5.114"> </span>
<a href="#l5.115"></a><span id="l5.115"> // Tests a page with a working plugin that is click-to-play</span>
<a href="#l5.116"></a><span id="l5.116"> function test8() {</span>
<a href="#l5.117"></a><span id="l5.117">   var notificationBox = gBrowser.getNotificationBox(gTestBrowser);</span>
<a href="#l5.118"></a><span id="l5.118">   ok(!notificationBox.getNotificationWithValue(&quot;missing-plugins&quot;), &quot;Test 8, Should not have displayed the missing plugin notification&quot;);</span>
<a href="#l5.119"></a><span id="l5.119">   ok(!notificationBox.getNotificationWithValue(&quot;blocked-plugins&quot;), &quot;Test 8, Should not have displayed the blocked plugin notification&quot;);</span>
<a href="#l5.120"></a><span id="l5.120">   ok(!notificationBox._missingPlugins, &quot;Test 8, Should not be a missing plugin list&quot;);</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineat">@@ -364,17 +378,17 @@ function test11d() {</span>
<a href="#l5.122"></a><span id="l5.122">   ok(popupNotification, &quot;Test 11d, Should have a click-to-play notification&quot;);</span>
<a href="#l5.123"></a><span id="l5.123">   is(gClickToPlayPluginActualEvents, gClickToPlayPluginExpectedEvents,</span>
<a href="#l5.124"></a><span id="l5.124">      &quot;There should be a PluginClickToPlay event for each plugin that was &quot; +</span>
<a href="#l5.125"></a><span id="l5.125">      &quot;blocked due to the plugins.click_to_play pref&quot;);</span>
<a href="#l5.126"></a><span id="l5.126"> </span>
<a href="#l5.127"></a><span id="l5.127">   prepareTest(test12a, gHttpTestRoot + &quot;plugin_clickToPlayAllow.html&quot;);</span>
<a href="#l5.128"></a><span id="l5.128"> }</span>
<a href="#l5.129"></a><span id="l5.129"> </span>
<a href="#l5.130"></a><span id="l5.130" class="difflineminus">-// Tests that the &quot;Allow Always&quot; permission works for click-to-play plugins (part 1/3)</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineplus">+// Tests that the &quot;Allow Always&quot; permission works for click-to-play plugins (part 1/5)</span>
<a href="#l5.132"></a><span id="l5.132"> function test12a() {</span>
<a href="#l5.133"></a><span id="l5.133">   var popupNotification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.134"></a><span id="l5.134">   ok(popupNotification, &quot;Test 12a, Should have a click-to-play notification&quot;);</span>
<a href="#l5.135"></a><span id="l5.135">   var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.136"></a><span id="l5.136">   var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.137"></a><span id="l5.137">   ok(!objLoadingContent.activated, &quot;Test 12a, Plugin should not be activated&quot;);</span>
<a href="#l5.138"></a><span id="l5.138"> </span>
<a href="#l5.139"></a><span id="l5.139">   // Simulate clicking the &quot;Allow Always&quot; button.</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineat">@@ -397,19 +411,36 @@ function test12b() {</span>
<a href="#l5.141"></a><span id="l5.141"> // Tests that the &quot;Always&quot; permission works for click-to-play plugins (part 3/3)</span>
<a href="#l5.142"></a><span id="l5.142"> function test12c() {</span>
<a href="#l5.143"></a><span id="l5.143">   var popupNotification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.144"></a><span id="l5.144">   ok(!popupNotification, &quot;Test 12c, Should not have a click-to-play notification&quot;);</span>
<a href="#l5.145"></a><span id="l5.145">   var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.146"></a><span id="l5.146">   var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.147"></a><span id="l5.147">   ok(objLoadingContent.activated, &quot;Test 12c, Plugin should be activated&quot;);</span>
<a href="#l5.148"></a><span id="l5.148"> </span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-  Services.perms.remove(&quot;127.0.0.1:8888&quot;, &quot;plugins&quot;);</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-  gNextTest = test13a;</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineminus">-  gTestBrowser.reload();</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineplus">+  prepareTest(test12d, gHttpTestRoot + &quot;plugin_two_types.html&quot;);</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineplus">+}</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineplus">+</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineplus">+// Test that the &quot;Always&quot; permission, when set for just the Test plugin,</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineplus">+// does not also allow the Second Test plugin.</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineplus">+function test12d() {</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineplus">+  var popupNotification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineplus">+  ok(popupNotification, &quot;Test 12d, Should have a click-to-play notification&quot;);</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineplus">+  var test = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineplus">+  var secondtestA = gTestBrowser.contentDocument.getElementById(&quot;secondtestA&quot;);</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineplus">+  var secondtestB = gTestBrowser.contentDocument.getElementById(&quot;secondtestB&quot;);</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineplus">+  var objLoadingContent = test.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineplus">+  ok(objLoadingContent.activated, &quot;Test 12d, Test plugin should be activated&quot;);</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineplus">+  var objLoadingContent = secondtestA.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 12d, Second Test plugin (A) should not be activated&quot;);</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineplus">+  var objLoadingContent = secondtestB.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 12d, Second Test plugin (B) should not be activated&quot;);</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineplus">+</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineplus">+  Services.perms.remove(&quot;127.0.0.1:8888&quot;, gPluginHost.getPermissionStringForType(&quot;application/x-test&quot;));</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineplus">+  prepareTest(test13a, gHttpTestRoot + &quot;plugin_clickToPlayDeny.html&quot;);</span>
<a href="#l5.172"></a><span id="l5.172"> }</span>
<a href="#l5.173"></a><span id="l5.173"> </span>
<a href="#l5.174"></a><span id="l5.174"> // Tests that the &quot;Deny Always&quot; permission works for click-to-play plugins (part 1/3)</span>
<a href="#l5.175"></a><span id="l5.175"> function test13a() {</span>
<a href="#l5.176"></a><span id="l5.176">   var popupNotification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.177"></a><span id="l5.177">   ok(popupNotification, &quot;Test 13a, Should have a click-to-play notification&quot;);</span>
<a href="#l5.178"></a><span id="l5.178">   var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.179"></a><span id="l5.179">   var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineat">@@ -436,34 +467,90 @@ function test13b() {</span>
<a href="#l5.181"></a><span id="l5.181"> </span>
<a href="#l5.182"></a><span id="l5.182"> // Tests that the &quot;Deny Always&quot; permission works for click-to-play plugins (part 3/3)</span>
<a href="#l5.183"></a><span id="l5.183"> function test13c() {</span>
<a href="#l5.184"></a><span id="l5.184">   var popupNotification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.185"></a><span id="l5.185">   ok(!popupNotification, &quot;Test 13c, Should not have a click-to-play notification&quot;);</span>
<a href="#l5.186"></a><span id="l5.186">   var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.187"></a><span id="l5.187">   var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.188"></a><span id="l5.188">   ok(!objLoadingContent.activated, &quot;Test 13c, Plugin should not be activated&quot;);</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineplus">+  is(objLoadingContent.pluginFallbackType, Ci.nsIObjectLoadingContent.PLUGIN_DISABLED, &quot;Test 13c, Plugin should be disabled&quot;);</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineplus">+</span>
<a href="#l5.191"></a><span id="l5.191">   var overlay = gTestBrowser.contentDocument.getAnonymousElementByAttribute(plugin, &quot;class&quot;, &quot;mainBox&quot;);</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineminus">-  ok(overlay.style.visibility == &quot;hidden&quot;, &quot;Test 13c, Plugin should not have visible overlay&quot;);</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineplus">+  ok(overlay.style.visibility != &quot;visible&quot;, &quot;Test 13c, Plugin should not have visible overlay&quot;);</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineplus">+</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineplus">+  prepareTest(test13d, gHttpTestRoot + &quot;plugin_two_types.html&quot;);</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineplus">+}</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineplus">+</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineplus">+// Test that the &quot;Deny Always&quot; permission, when set for just the Test plugin,</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineplus">+// does not also block the Second Test plugin (i.e. it gets an overlay and</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineplus">+// there's a notification and everything).</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineplus">+function test13d() {</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineplus">+  var popupNotification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineplus">+  ok(popupNotification, &quot;Test 13d, Should have a click-to-play notification&quot;);</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineplus">+</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineplus">+  var test = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineplus">+  var objLoadingContent = test.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineplus">+  var overlay = gTestBrowser.contentDocument.getAnonymousElementByAttribute(test, &quot;class&quot;, &quot;mainBox&quot;);</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineplus">+  ok(overlay.style.visibility != &quot;hidden&quot;, &quot;Test 13d, Test plugin should have visible overlay&quot;);</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 13d, Test plugin should not be activated&quot;);</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineplus">+  is(objLoadingContent.pluginFallbackType, Ci.nsIObjectLoadingContent.PLUGIN_DISABLED, &quot;Test 13d, Test plugin should be disabled&quot;);</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineplus">+</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineplus">+  var secondtestA = gTestBrowser.contentDocument.getElementById(&quot;secondtestA&quot;);</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineplus">+  var objLoadingContent = secondtestA.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineplus">+  var overlay = gTestBrowser.contentDocument.getAnonymousElementByAttribute(secondtestA, &quot;class&quot;, &quot;mainBox&quot;);</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineplus">+  ok(overlay.style.visibility != &quot;hidden&quot;, &quot;Test 13d, Test plugin should have visible overlay&quot;);</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 13d, Second Test plugin (A) should not be activated&quot;);</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineplus">+  is(objLoadingContent.pluginFallbackType, Ci.nsIObjectLoadingContent.PLUGIN_CLICK_TO_PLAY, &quot;Test 13d, Test plugin should be disabled&quot;);</span>
<a href="#l5.218"></a><span id="l5.218"> </span>
<a href="#l5.219"></a><span id="l5.219" class="difflineminus">-  Services.perms.remove(&quot;127.0.0.1:8888&quot;, &quot;plugins&quot;);</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineplus">+  var secondtestB = gTestBrowser.contentDocument.getElementById(&quot;secondtestB&quot;);</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineplus">+  var objLoadingContent = secondtestB.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineplus">+  var overlay = gTestBrowser.contentDocument.getAnonymousElementByAttribute(secondtestB, &quot;class&quot;, &quot;mainBox&quot;);</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineplus">+  ok(overlay.style.visibility != &quot;hidden&quot;, &quot;Test 13d, Test plugin should have visible overlay&quot;);</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 13d, Second Test plugin (B) should not be activated&quot;);</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineplus">+</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineplus">+  var condition = function() objLoadingContent.activated;</span>
<a href="#l5.227"></a><span id="l5.227" class="difflineplus">+  // &quot;click&quot; &quot;Activate All Plugins&quot;</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineplus">+  popupNotification.mainAction.callback();</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineplus">+  waitForCondition(condition, test13e, &quot;Test 13d, Waited too long for plugin to activate&quot;);</span>
<a href="#l5.230"></a><span id="l5.230" class="difflineplus">+}</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineplus">+</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineplus">+// Test that clicking &quot;Activate All Plugins&quot; won't activate plugins that</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineplus">+// have previously been &quot;Deny Always&quot;-ed.</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineplus">+function test13e() {</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineplus">+  var test = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.236"></a><span id="l5.236" class="difflineplus">+  var objLoadingContent = test.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.237"></a><span id="l5.237" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 13e, Test plugin should not be activated&quot;);</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineplus">+</span>
<a href="#l5.239"></a><span id="l5.239" class="difflineplus">+  var secondtestA = gTestBrowser.contentDocument.getElementById(&quot;secondtestA&quot;);</span>
<a href="#l5.240"></a><span id="l5.240" class="difflineplus">+  var objLoadingContent = secondtestA.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineplus">+  ok(objLoadingContent.activated, &quot;Test 13e, Second Test plugin (A) should be activated&quot;);</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineplus">+</span>
<a href="#l5.243"></a><span id="l5.243" class="difflineplus">+  var secondtestB = gTestBrowser.contentDocument.getElementById(&quot;secondtestB&quot;);</span>
<a href="#l5.244"></a><span id="l5.244" class="difflineplus">+  var objLoadingContent = secondtestB.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineplus">+  ok(objLoadingContent.activated, &quot;Test 13e, Second Test plugin (B) should be activated&quot;);</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineplus">+</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineplus">+  Services.perms.remove(&quot;127.0.0.1:8888&quot;, gPluginHost.getPermissionStringForType(&quot;application/x-test&quot;));</span>
<a href="#l5.248"></a><span id="l5.248">   Services.prefs.setBoolPref(&quot;plugins.click_to_play&quot;, false);</span>
<a href="#l5.249"></a><span id="l5.249" class="difflineplus">+  var plugin = getTestPlugin();</span>
<a href="#l5.250"></a><span id="l5.250" class="difflineplus">+  plugin.enabledState = Ci.nsIPluginTag.STATE_ENABLED;</span>
<a href="#l5.251"></a><span id="l5.251">   prepareTest(test14, gTestRoot + &quot;plugin_test2.html&quot;);</span>
<a href="#l5.252"></a><span id="l5.252"> }</span>
<a href="#l5.253"></a><span id="l5.253"> </span>
<a href="#l5.254"></a><span id="l5.254"> // Tests that the plugin's &quot;activated&quot; property is true for working plugins with click-to-play disabled.</span>
<a href="#l5.255"></a><span id="l5.255"> function test14() {</span>
<a href="#l5.256"></a><span id="l5.256">   var plugin = gTestBrowser.contentDocument.getElementById(&quot;test1&quot;);</span>
<a href="#l5.257"></a><span id="l5.257">   var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.258"></a><span id="l5.258">   ok(objLoadingContent.activated, &quot;Test 14, Plugin should be activated&quot;);</span>
<a href="#l5.259"></a><span id="l5.259"> </span>
<a href="#l5.260"></a><span id="l5.260" class="difflineplus">+  Services.prefs.setBoolPref(&quot;plugins.click_to_play&quot;, true);</span>
<a href="#l5.261"></a><span id="l5.261">   var plugin = getTestPlugin();</span>
<a href="#l5.262"></a><span id="l5.262" class="difflineminus">-  plugin.enabled = Ci.nsIPluginTag.STATE_ENABLED;</span>
<a href="#l5.263"></a><span id="l5.263" class="difflineplus">+  plugin.enabledState = Ci.nsIPluginTag.STATE_CLICKTOPLAY;</span>
<a href="#l5.264"></a><span id="l5.264">   plugin.blocklisted = false;</span>
<a href="#l5.265"></a><span id="l5.265" class="difflineminus">-  Services.prefs.setBoolPref(&quot;plugins.click_to_play&quot;, true);</span>
<a href="#l5.266"></a><span id="l5.266" class="difflineplus">+  getTestPlugin(&quot;Second Test Plug-in&quot;).enabledState = Ci.nsIPluginTag.STATE_CLICKTOPLAY;</span>
<a href="#l5.267"></a><span id="l5.267">   prepareTest(test15, gTestRoot + &quot;plugin_alternate_content.html&quot;);</span>
<a href="#l5.268"></a><span id="l5.268"> }</span>
<a href="#l5.269"></a><span id="l5.269"> </span>
<a href="#l5.270"></a><span id="l5.270"> // Tests that the overlay is shown instead of alternate content when</span>
<a href="#l5.271"></a><span id="l5.271"> // plugins are click to play</span>
<a href="#l5.272"></a><span id="l5.272"> function test15() {</span>
<a href="#l5.273"></a><span id="l5.273">   var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.274"></a><span id="l5.274">   var doc = gTestBrowser.contentDocument;</span>
<a href="#l5.275"></a><span id="l5.275" class="difflineat">@@ -521,65 +608,30 @@ function test16d() {</span>
<a href="#l5.276"></a><span id="l5.276"> // Tests that mContentType is used for click-to-play plugins, and not the</span>
<a href="#l5.277"></a><span id="l5.277"> // inspected type.</span>
<a href="#l5.278"></a><span id="l5.278"> function test17() {</span>
<a href="#l5.279"></a><span id="l5.279">   var clickToPlayNotification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.280"></a><span id="l5.280">   ok(clickToPlayNotification, &quot;Test 17, Should have a click-to-play notification&quot;);</span>
<a href="#l5.281"></a><span id="l5.281">   var missingNotification = PopupNotifications.getNotification(&quot;missing-plugins&quot;, gTestBrowser);</span>
<a href="#l5.282"></a><span id="l5.282">   ok(!missingNotification, &quot;Test 17, Should not have a missing plugin notification&quot;);</span>
<a href="#l5.283"></a><span id="l5.283"> </span>
<a href="#l5.284"></a><span id="l5.284" class="difflineminus">-  registerFakeBlocklistService(Ci.nsIBlocklistService.STATE_VULNERABLE_UPDATE_AVAILABLE);</span>
<a href="#l5.285"></a><span id="l5.285" class="difflineminus">-  prepareTest(test18a, gHttpTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.286"></a><span id="l5.286" class="difflineplus">+  setAndUpdateBlocklist(gHttpTestRoot + &quot;blockPluginVulnerableUpdatable.xml&quot;,</span>
<a href="#l5.287"></a><span id="l5.287" class="difflineplus">+  function() {</span>
<a href="#l5.288"></a><span id="l5.288" class="difflineplus">+    prepareTest(test18a, gHttpTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.289"></a><span id="l5.289" class="difflineplus">+  });</span>
<a href="#l5.290"></a><span id="l5.290"> }</span>
<a href="#l5.291"></a><span id="l5.291"> </span>
<a href="#l5.292"></a><span id="l5.292"> const Cr = Components.results;</span>
<a href="#l5.293"></a><span id="l5.293"> const Cm = Components.manager;</span>
<a href="#l5.294"></a><span id="l5.294"> const Cc = Components.classes;</span>
<a href="#l5.295"></a><span id="l5.295"> const gReg = Cm.QueryInterface(Ci.nsIComponentRegistrar);</span>
<a href="#l5.296"></a><span id="l5.296"> const gRealBlocklistServiceCID = Cc[&quot;@mozilla.org/extensions/blocklist;1&quot;];</span>
<a href="#l5.297"></a><span id="l5.297"> const gFakeBlocklistServiceCID = Components.ID(&quot;{614b68a0-3c53-4ec0-8146-28cc1e25f8a1}&quot;);</span>
<a href="#l5.298"></a><span id="l5.298"> var gFactory = null;</span>
<a href="#l5.299"></a><span id="l5.299"> </span>
<a href="#l5.300"></a><span id="l5.300" class="difflineminus">-function registerFakeBlocklistService(blockState) {</span>
<a href="#l5.301"></a><span id="l5.301" class="difflineminus">-</span>
<a href="#l5.302"></a><span id="l5.302" class="difflineminus">-  var BlocklistService = {</span>
<a href="#l5.303"></a><span id="l5.303" class="difflineminus">-    getPluginBlocklistState: function(plugin, appVersion, toolkitVersion) {</span>
<a href="#l5.304"></a><span id="l5.304" class="difflineminus">-      return blockState;</span>
<a href="#l5.305"></a><span id="l5.305" class="difflineminus">-    },</span>
<a href="#l5.306"></a><span id="l5.306" class="difflineminus">-</span>
<a href="#l5.307"></a><span id="l5.307" class="difflineminus">-    classID: gFakeBlocklistServiceCID,</span>
<a href="#l5.308"></a><span id="l5.308" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Ci.nsIBlocklistService])</span>
<a href="#l5.309"></a><span id="l5.309" class="difflineminus">-  };</span>
<a href="#l5.310"></a><span id="l5.310" class="difflineminus">-</span>
<a href="#l5.311"></a><span id="l5.311" class="difflineminus">-  gFactory = {</span>
<a href="#l5.312"></a><span id="l5.312" class="difflineminus">-    createInstance: function(outer, iid) {</span>
<a href="#l5.313"></a><span id="l5.313" class="difflineminus">-      if (outer != null)</span>
<a href="#l5.314"></a><span id="l5.314" class="difflineminus">-        throw Cr.NS_ERROR_NO_AGGREGATION;</span>
<a href="#l5.315"></a><span id="l5.315" class="difflineminus">-      return BlocklistService.QueryInterface(iid);</span>
<a href="#l5.316"></a><span id="l5.316" class="difflineminus">-    }</span>
<a href="#l5.317"></a><span id="l5.317" class="difflineminus">-  };</span>
<a href="#l5.318"></a><span id="l5.318" class="difflineminus">-</span>
<a href="#l5.319"></a><span id="l5.319" class="difflineminus">-  gReg.registerFactory(gFakeBlocklistServiceCID,</span>
<a href="#l5.320"></a><span id="l5.320" class="difflineminus">-                       &quot;Fake Blocklist Service&quot;,</span>
<a href="#l5.321"></a><span id="l5.321" class="difflineminus">-                       &quot;@mozilla.org/extensions/blocklist;1&quot;,</span>
<a href="#l5.322"></a><span id="l5.322" class="difflineminus">-                       gFactory);</span>
<a href="#l5.323"></a><span id="l5.323" class="difflineminus">-}</span>
<a href="#l5.324"></a><span id="l5.324" class="difflineminus">-</span>
<a href="#l5.325"></a><span id="l5.325" class="difflineminus">-function unregisterFakeBlocklistService() {</span>
<a href="#l5.326"></a><span id="l5.326" class="difflineminus">-  if (gFactory != null ) {</span>
<a href="#l5.327"></a><span id="l5.327" class="difflineminus">-    gReg.unregisterFactory(gFakeBlocklistServiceCID, gFactory);</span>
<a href="#l5.328"></a><span id="l5.328" class="difflineminus">-    gFactory = null;</span>
<a href="#l5.329"></a><span id="l5.329" class="difflineminus">-    // This should restore the original blocklist service:</span>
<a href="#l5.330"></a><span id="l5.330" class="difflineminus">-    gReg.registerFactory(gRealBlocklistServiceCID,</span>
<a href="#l5.331"></a><span id="l5.331" class="difflineminus">-                         &quot;Blocklist Service&quot;,</span>
<a href="#l5.332"></a><span id="l5.332" class="difflineminus">-                         &quot;@mozilla.org/extensions/blocklist;1&quot;,</span>
<a href="#l5.333"></a><span id="l5.333" class="difflineminus">-                         null);</span>
<a href="#l5.334"></a><span id="l5.334" class="difflineminus">-  }</span>
<a href="#l5.335"></a><span id="l5.335" class="difflineminus">-}</span>
<a href="#l5.336"></a><span id="l5.336" class="difflineminus">-</span>
<a href="#l5.337"></a><span id="l5.337"> // Tests a vulnerable, updatable plugin</span>
<a href="#l5.338"></a><span id="l5.338"> function test18a() {</span>
<a href="#l5.339"></a><span id="l5.339">   var clickToPlayNotification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.340"></a><span id="l5.340">   ok(clickToPlayNotification, &quot;Test 18a, Should have a click-to-play notification&quot;);</span>
<a href="#l5.341"></a><span id="l5.341">   var doc = gTestBrowser.contentDocument;</span>
<a href="#l5.342"></a><span id="l5.342">   var plugin = doc.getElementById(&quot;test&quot;);</span>
<a href="#l5.343"></a><span id="l5.343">   ok(plugin, &quot;Test 18a, Found plugin in page&quot;);</span>
<a href="#l5.344"></a><span id="l5.344">   var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.345"></a><span id="l5.345" class="difflineat">@@ -611,19 +663,20 @@ function test18b() {</span>
<a href="#l5.346"></a><span id="l5.346">   // clicking the update link should not activate the plugin</span>
<a href="#l5.347"></a><span id="l5.347">   var doc = gTestBrowser.contentDocument;</span>
<a href="#l5.348"></a><span id="l5.348">   var plugin = doc.getElementById(&quot;test&quot;);</span>
<a href="#l5.349"></a><span id="l5.349">   var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.350"></a><span id="l5.350">   ok(!objLoadingContent.activated, &quot;Test 18b, Plugin should not be activated&quot;);</span>
<a href="#l5.351"></a><span id="l5.351">   var overlay = doc.getAnonymousElementByAttribute(plugin, &quot;class&quot;, &quot;mainBox&quot;);</span>
<a href="#l5.352"></a><span id="l5.352">   ok(overlay.style.visibility != &quot;hidden&quot;, &quot;Test 18b, Plugin overlay should exist, not be hidden&quot;);</span>
<a href="#l5.353"></a><span id="l5.353"> </span>
<a href="#l5.354"></a><span id="l5.354" class="difflineminus">-  unregisterFakeBlocklistService();</span>
<a href="#l5.355"></a><span id="l5.355" class="difflineminus">-  registerFakeBlocklistService(Ci.nsIBlocklistService.STATE_VULNERABLE_NO_UPDATE);</span>
<a href="#l5.356"></a><span id="l5.356" class="difflineminus">-  prepareTest(test18c, gHttpTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.357"></a><span id="l5.357" class="difflineplus">+  setAndUpdateBlocklist(gHttpTestRoot + &quot;blockPluginVulnerableNoUpdate.xml&quot;,</span>
<a href="#l5.358"></a><span id="l5.358" class="difflineplus">+  function() {</span>
<a href="#l5.359"></a><span id="l5.359" class="difflineplus">+    prepareTest(test18c, gHttpTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.360"></a><span id="l5.360" class="difflineplus">+  });</span>
<a href="#l5.361"></a><span id="l5.361"> }</span>
<a href="#l5.362"></a><span id="l5.362"> </span>
<a href="#l5.363"></a><span id="l5.363"> // Tests a vulnerable plugin with no update</span>
<a href="#l5.364"></a><span id="l5.364"> function test18c() {</span>
<a href="#l5.365"></a><span id="l5.365">   var clickToPlayNotification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.366"></a><span id="l5.366">   ok(clickToPlayNotification, &quot;Test 18c, Should have a click-to-play notification&quot;);</span>
<a href="#l5.367"></a><span id="l5.367">   var doc = gTestBrowser.contentDocument;</span>
<a href="#l5.368"></a><span id="l5.368">   var plugin = doc.getElementById(&quot;test&quot;);</span>
<a href="#l5.369"></a><span id="l5.369" class="difflineat">@@ -631,17 +684,17 @@ function test18c() {</span>
<a href="#l5.370"></a><span id="l5.370">   var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.371"></a><span id="l5.371">   is(objLoadingContent.pluginFallbackType, Ci.nsIObjectLoadingContent.PLUGIN_VULNERABLE_NO_UPDATE, &quot;Test 18c, plugin fallback type should be PLUGIN_VULNERABLE_NO_UPDATE&quot;);</span>
<a href="#l5.372"></a><span id="l5.372">   ok(!objLoadingContent.activated, &quot;Test 18c, Plugin should not be activated&quot;);</span>
<a href="#l5.373"></a><span id="l5.373">   var overlay = doc.getAnonymousElementByAttribute(plugin, &quot;class&quot;, &quot;mainBox&quot;);</span>
<a href="#l5.374"></a><span id="l5.374">   ok(overlay.style.visibility != &quot;hidden&quot;, &quot;Test 18c, Plugin overlay should exist, not be hidden&quot;);</span>
<a href="#l5.375"></a><span id="l5.375">   var updateLink = doc.getAnonymousElementByAttribute(plugin, &quot;class&quot;, &quot;checkForUpdatesLink&quot;);</span>
<a href="#l5.376"></a><span id="l5.376">   ok(updateLink.style.display != &quot;block&quot;, &quot;Test 18c, Plugin should not have an update link&quot;);</span>
<a href="#l5.377"></a><span id="l5.377"> </span>
<a href="#l5.378"></a><span id="l5.378" class="difflineminus">-  // check that click &quot;Always allow&quot; works with blocklisted plugins (for now)</span>
<a href="#l5.379"></a><span id="l5.379" class="difflineplus">+  // check that click &quot;Always allow&quot; works with blocklisted plugins</span>
<a href="#l5.380"></a><span id="l5.380">   clickToPlayNotification.secondaryActions[0].callback();</span>
<a href="#l5.381"></a><span id="l5.381">   var condition = function() objLoadingContent.activated;</span>
<a href="#l5.382"></a><span id="l5.382">   waitForCondition(condition, test18d, &quot;Test 18d, Waited too long for plugin to activate&quot;);</span>
<a href="#l5.383"></a><span id="l5.383"> }</span>
<a href="#l5.384"></a><span id="l5.384"> </span>
<a href="#l5.385"></a><span id="l5.385"> // continue testing &quot;Always allow&quot;</span>
<a href="#l5.386"></a><span id="l5.386"> function test18d() {</span>
<a href="#l5.387"></a><span id="l5.387">   var popupNotification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.388"></a><span id="l5.388" class="difflineat">@@ -656,20 +709,56 @@ function test18d() {</span>
<a href="#l5.389"></a><span id="l5.389"> // continue testing &quot;Always allow&quot;</span>
<a href="#l5.390"></a><span id="l5.390"> function test18e() {</span>
<a href="#l5.391"></a><span id="l5.391">   var popupNotification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.392"></a><span id="l5.392">   ok(!popupNotification, &quot;Test 18e, Should not have a click-to-play notification&quot;);</span>
<a href="#l5.393"></a><span id="l5.393">   var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.394"></a><span id="l5.394">   var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.395"></a><span id="l5.395">   ok(objLoadingContent.activated, &quot;Test 18e, Plugin should be activated&quot;);</span>
<a href="#l5.396"></a><span id="l5.396"> </span>
<a href="#l5.397"></a><span id="l5.397" class="difflineminus">-  unregisterFakeBlocklistService();</span>
<a href="#l5.398"></a><span id="l5.398" class="difflineminus">-  Services.perms.remove(&quot;127.0.0.1:8888&quot;, &quot;plugins&quot;);</span>
<a href="#l5.399"></a><span id="l5.399" class="difflineplus">+  Services.perms.remove(&quot;127.0.0.1:8888&quot;, gPluginHost.getPermissionStringForType(&quot;application/x-test&quot;));</span>
<a href="#l5.400"></a><span id="l5.400" class="difflineplus">+  setAndUpdateBlocklist(gHttpTestRoot + &quot;blockNoPlugins.xml&quot;,</span>
<a href="#l5.401"></a><span id="l5.401" class="difflineplus">+  function() {</span>
<a href="#l5.402"></a><span id="l5.402" class="difflineplus">+    resetBlocklist();</span>
<a href="#l5.403"></a><span id="l5.403" class="difflineplus">+    prepareTest(test19a, gTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.404"></a><span id="l5.404" class="difflineplus">+  });</span>
<a href="#l5.405"></a><span id="l5.405" class="difflineplus">+</span>
<a href="#l5.406"></a><span id="l5.406" class="difflineplus">+  // SeaMonkey does not want to bring up the notification for now when clicking</span>
<a href="#l5.407"></a><span id="l5.407" class="difflineplus">+  // on the CTP GUI for a vulnerable plugin</span>
<a href="#l5.408"></a><span id="l5.408" class="difflineplus">+  // prepareTest(test18f, gHttpTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.409"></a><span id="l5.409" class="difflineplus">+}</span>
<a href="#l5.410"></a><span id="l5.410"> </span>
<a href="#l5.411"></a><span id="l5.411" class="difflineminus">-  prepareTest(test19a, gTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.412"></a><span id="l5.412" class="difflineplus">+// clicking the in-content overlay of a vulnerable plugin should bring</span>
<a href="#l5.413"></a><span id="l5.413" class="difflineplus">+// up the notification and not directly activate the plugin</span>
<a href="#l5.414"></a><span id="l5.414" class="difflineplus">+function test18f() {</span>
<a href="#l5.415"></a><span id="l5.415" class="difflineplus">+  var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.416"></a><span id="l5.416" class="difflineplus">+  ok(notification, &quot;Test 18f, Should have a click-to-play notification&quot;);</span>
<a href="#l5.417"></a><span id="l5.417" class="difflineplus">+  ok(notification.dismissed, &quot;Test 18f, notification should start dismissed&quot;);</span>
<a href="#l5.418"></a><span id="l5.418" class="difflineplus">+  var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.419"></a><span id="l5.419" class="difflineplus">+  var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.420"></a><span id="l5.420" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 18f, Plugin should not be activated&quot;);</span>
<a href="#l5.421"></a><span id="l5.421" class="difflineplus">+</span>
<a href="#l5.422"></a><span id="l5.422" class="difflineplus">+  notification.options.eventCallback = function() { executeSoon(test18g); };</span>
<a href="#l5.423"></a><span id="l5.423" class="difflineplus">+  EventUtils.synthesizeMouseAtCenter(plugin, {}, gTestBrowser.contentWindow);</span>
<a href="#l5.424"></a><span id="l5.424" class="difflineplus">+}</span>
<a href="#l5.425"></a><span id="l5.425" class="difflineplus">+</span>
<a href="#l5.426"></a><span id="l5.426" class="difflineplus">+function test18g() {</span>
<a href="#l5.427"></a><span id="l5.427" class="difflineplus">+  var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.428"></a><span id="l5.428" class="difflineplus">+  ok(notification, &quot;Test 18g, Should have a click-to-play notification&quot;);</span>
<a href="#l5.429"></a><span id="l5.429" class="difflineplus">+  ok(!notification.dismissed, &quot;Test 18g, notification should be open&quot;);</span>
<a href="#l5.430"></a><span id="l5.430" class="difflineplus">+  notification.options.eventCallback = null;</span>
<a href="#l5.431"></a><span id="l5.431" class="difflineplus">+  var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.432"></a><span id="l5.432" class="difflineplus">+  var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.433"></a><span id="l5.433" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 18g, Plugin should not be activated&quot;);</span>
<a href="#l5.434"></a><span id="l5.434" class="difflineplus">+</span>
<a href="#l5.435"></a><span id="l5.435" class="difflineplus">+  setAndUpdateBlocklist(gHttpTestRoot + &quot;blockNoPlugins.xml&quot;,</span>
<a href="#l5.436"></a><span id="l5.436" class="difflineplus">+  function() {</span>
<a href="#l5.437"></a><span id="l5.437" class="difflineplus">+    resetBlocklist();</span>
<a href="#l5.438"></a><span id="l5.438" class="difflineplus">+    prepareTest(test19a, gTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.439"></a><span id="l5.439" class="difflineplus">+  });</span>
<a href="#l5.440"></a><span id="l5.440"> }</span>
<a href="#l5.441"></a><span id="l5.441"> </span>
<a href="#l5.442"></a><span id="l5.442"> // Tests that clicking the icon of the overlay activates the plugin</span>
<a href="#l5.443"></a><span id="l5.443"> function test19a() {</span>
<a href="#l5.444"></a><span id="l5.444">   var doc = gTestBrowser.contentDocument;</span>
<a href="#l5.445"></a><span id="l5.445">   var plugin = doc.getElementById(&quot;test&quot;);</span>
<a href="#l5.446"></a><span id="l5.446">   var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.447"></a><span id="l5.447">   ok(!objLoadingContent.activated, &quot;Test 19a, Plugin should not be activated&quot;);</span>
<a href="#l5.448"></a><span id="l5.448" class="difflineat">@@ -778,23 +867,17 @@ function test20c() {</span>
<a href="#l5.449"></a><span id="l5.449">   var doc = gTestBrowser.contentDocument;</span>
<a href="#l5.450"></a><span id="l5.450">   var plugin = doc.getElementById(&quot;plugin&quot;);</span>
<a href="#l5.451"></a><span id="l5.451">   var pluginRect = doc.getAnonymousElementByAttribute(plugin, &quot;class&quot;, &quot;mainBox&quot;).getBoundingClientRect();</span>
<a href="#l5.452"></a><span id="l5.452">   ok(pluginRect.width == 0, &quot;Test 20c, plugin should have click-to-play overlay with zero width&quot;);</span>
<a href="#l5.453"></a><span id="l5.453">   ok(pluginRect.height == 0, &quot;Test 20c, plugin should have click-to-play overlay with zero height&quot;);</span>
<a href="#l5.454"></a><span id="l5.454">   var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.455"></a><span id="l5.455">   ok(objLoadingContent.activated, &quot;Test 20c, plugin should be activated&quot;);</span>
<a href="#l5.456"></a><span id="l5.456"> </span>
<a href="#l5.457"></a><span id="l5.457" class="difflineminus">-  Services.prefs.setBoolPref(&quot;plugins.click_to_play&quot;, true);</span>
<a href="#l5.458"></a><span id="l5.458" class="difflineminus">-  prepareTest(test22, gTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.459"></a><span id="l5.459" class="difflineminus">-</span>
<a href="#l5.460"></a><span id="l5.460" class="difflineminus">-  // Skip test21(a-e) for now as it relies on notification.options.centerActions</span>
<a href="#l5.461"></a><span id="l5.461" class="difflineminus">-  // SeaMonkey does not support this yet, this is part of the multiple plugin</span>
<a href="#l5.462"></a><span id="l5.462" class="difflineminus">-  // doorhanger UI, Bug 798278 will port this code to SeaMonkey</span>
<a href="#l5.463"></a><span id="l5.463" class="difflineminus">-  // prepareTest(test21a, gTestRoot + &quot;plugin_two_types.html&quot;);</span>
<a href="#l5.464"></a><span id="l5.464" class="difflineplus">+  prepareTest(test21a, gTestRoot + &quot;plugin_two_types.html&quot;);</span>
<a href="#l5.465"></a><span id="l5.465"> }</span>
<a href="#l5.466"></a><span id="l5.466"> </span>
<a href="#l5.467"></a><span id="l5.467"> // Test having multiple different types of plugin on one page</span>
<a href="#l5.468"></a><span id="l5.468"> function test21a() {</span>
<a href="#l5.469"></a><span id="l5.469">   var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.470"></a><span id="l5.470">   ok(notification, &quot;Test 21a, Should have a click-to-play notification&quot;);</span>
<a href="#l5.471"></a><span id="l5.471">   ok(notification.options.centerActions.length == 2, &quot;Test 21a, Should have two types of plugin in the notification&quot;);</span>
<a href="#l5.472"></a><span id="l5.472"> </span>
<a href="#l5.473"></a><span id="l5.473" class="difflineat">@@ -805,34 +888,37 @@ function test21a() {</span>
<a href="#l5.474"></a><span id="l5.474">     var rect = doc.getAnonymousElementByAttribute(plugin, &quot;class&quot;, &quot;mainBox&quot;).getBoundingClientRect();</span>
<a href="#l5.475"></a><span id="l5.475">     ok(rect.width == 200, &quot;Test 21a, Plugin with id=&quot; + plugin.id + &quot; overlay rect should have 200px width before being clicked&quot;);</span>
<a href="#l5.476"></a><span id="l5.476">     ok(rect.height == 200, &quot;Test 21a, Plugin with id=&quot; + plugin.id + &quot; overlay rect should have 200px height before being clicked&quot;);</span>
<a href="#l5.477"></a><span id="l5.477">     var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.478"></a><span id="l5.478">     ok(!objLoadingContent.activated, &quot;Test 21a, Plugin with id=&quot; + plugin.id + &quot; should not be activated&quot;);</span>
<a href="#l5.479"></a><span id="l5.479">   }</span>
<a href="#l5.480"></a><span id="l5.480"> </span>
<a href="#l5.481"></a><span id="l5.481">   // we have to actually show the panel to get the bindings to instantiate</span>
<a href="#l5.482"></a><span id="l5.482" class="difflineminus">-  notification.options.dismissed = false;</span>
<a href="#l5.483"></a><span id="l5.483">   notification.options.eventCallback = test21b;</span>
<a href="#l5.484"></a><span id="l5.484" class="difflineminus">-  PopupNotifications._showPanel([notification], notification.anchorElement);</span>
<a href="#l5.485"></a><span id="l5.485" class="difflineplus">+  notification.reshow();</span>
<a href="#l5.486"></a><span id="l5.486"> }</span>
<a href="#l5.487"></a><span id="l5.487"> </span>
<a href="#l5.488"></a><span id="l5.488" class="difflineminus">-function test21b() {</span>
<a href="#l5.489"></a><span id="l5.489" class="difflineplus">+function test21b(type) {</span>
<a href="#l5.490"></a><span id="l5.490" class="difflineplus">+  if (type != &quot;shown&quot;)</span>
<a href="#l5.491"></a><span id="l5.491" class="difflineplus">+    return;</span>
<a href="#l5.492"></a><span id="l5.492" class="difflineplus">+</span>
<a href="#l5.493"></a><span id="l5.493">   var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.494"></a><span id="l5.494">   notification.options.eventCallback = null;</span>
<a href="#l5.495"></a><span id="l5.495">   var centerAction = null;</span>
<a href="#l5.496"></a><span id="l5.496">   for (var action of notification.options.centerActions) {</span>
<a href="#l5.497"></a><span id="l5.497">     if (action.message == &quot;Test&quot;) {</span>
<a href="#l5.498"></a><span id="l5.498">       centerAction = action;</span>
<a href="#l5.499"></a><span id="l5.499">       break;</span>
<a href="#l5.500"></a><span id="l5.500">     }</span>
<a href="#l5.501"></a><span id="l5.501">   }</span>
<a href="#l5.502"></a><span id="l5.502">   ok(centerAction, &quot;Test 21b, found center action for the Test plugin&quot;);</span>
<a href="#l5.503"></a><span id="l5.503"> </span>
<a href="#l5.504"></a><span id="l5.504">   var centerItem = null;</span>
<a href="#l5.505"></a><span id="l5.505" class="difflineplus">+  info(&quot;centerAction is &quot; + centerAction);</span>
<a href="#l5.506"></a><span id="l5.506">   for (var item of centerAction.popupnotification.childNodes) {</span>
<a href="#l5.507"></a><span id="l5.507">     if (item.action == centerAction) {</span>
<a href="#l5.508"></a><span id="l5.508">       centerItem = item;</span>
<a href="#l5.509"></a><span id="l5.509">       break;</span>
<a href="#l5.510"></a><span id="l5.510">     }</span>
<a href="#l5.511"></a><span id="l5.511">   }</span>
<a href="#l5.512"></a><span id="l5.512">   ok(centerItem, &quot;Test 21b, found center item for the Test plugin&quot;);</span>
<a href="#l5.513"></a><span id="l5.513"> </span>
<a href="#l5.514"></a><span id="l5.514" class="difflineat">@@ -865,22 +951,24 @@ function test21c() {</span>
<a href="#l5.515"></a><span id="l5.515">     var rect = doc.getAnonymousElementByAttribute(plugin, &quot;class&quot;, &quot;mainBox&quot;).getBoundingClientRect();</span>
<a href="#l5.516"></a><span id="l5.516">     ok(rect.width == 200, &quot;Test 21c, Plugin with id=&quot; + plugin.id + &quot; overlay rect should have 200px width before being clicked&quot;);</span>
<a href="#l5.517"></a><span id="l5.517">     ok(rect.height == 200, &quot;Test 21c, Plugin with id=&quot; + plugin.id + &quot; overlay rect should have 200px height before being clicked&quot;);</span>
<a href="#l5.518"></a><span id="l5.518">     var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.519"></a><span id="l5.519">     ok(!objLoadingContent.activated, &quot;Test 21c, Plugin with id=&quot; + plugin.id + &quot; should not be activated&quot;);</span>
<a href="#l5.520"></a><span id="l5.520">   }</span>
<a href="#l5.521"></a><span id="l5.521"> </span>
<a href="#l5.522"></a><span id="l5.522">   // we have to actually show the panel to get the bindings to instantiate</span>
<a href="#l5.523"></a><span id="l5.523" class="difflineminus">-  notification.options.dismissed = false;</span>
<a href="#l5.524"></a><span id="l5.524">   notification.options.eventCallback = test21d;</span>
<a href="#l5.525"></a><span id="l5.525" class="difflineminus">-  PopupNotifications._showPanel([notification], notification.anchorElement);</span>
<a href="#l5.526"></a><span id="l5.526" class="difflineplus">+  notification.reshow();</span>
<a href="#l5.527"></a><span id="l5.527"> }</span>
<a href="#l5.528"></a><span id="l5.528"> </span>
<a href="#l5.529"></a><span id="l5.529" class="difflineminus">-function test21d() {</span>
<a href="#l5.530"></a><span id="l5.530" class="difflineplus">+function test21d(type) {</span>
<a href="#l5.531"></a><span id="l5.531" class="difflineplus">+  if (type != &quot;shown&quot;)</span>
<a href="#l5.532"></a><span id="l5.532" class="difflineplus">+    return;</span>
<a href="#l5.533"></a><span id="l5.533" class="difflineplus">+</span>
<a href="#l5.534"></a><span id="l5.534">   var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.535"></a><span id="l5.535">   notification.options.eventCallback = null;</span>
<a href="#l5.536"></a><span id="l5.536"> </span>
<a href="#l5.537"></a><span id="l5.537">   var centerAction = null;</span>
<a href="#l5.538"></a><span id="l5.538">   for (var action of notification.options.centerActions) {</span>
<a href="#l5.539"></a><span id="l5.539">     if (action.message == &quot;Second Test&quot;) {</span>
<a href="#l5.540"></a><span id="l5.540">       centerAction = action;</span>
<a href="#l5.541"></a><span id="l5.541">       break;</span>
<a href="#l5.542"></a><span id="l5.542" class="difflineat">@@ -918,16 +1006,18 @@ function test21e() {</span>
<a href="#l5.543"></a><span id="l5.543">     var rect = doc.getAnonymousElementByAttribute(plugin, &quot;class&quot;, &quot;mainBox&quot;).getBoundingClientRect();</span>
<a href="#l5.544"></a><span id="l5.544">     ok(rect.width == 0, &quot;Test 21e, Plugin with id=&quot; + plugin.id + &quot; overlay rect should have 0px width after being clicked&quot;);</span>
<a href="#l5.545"></a><span id="l5.545">     ok(rect.height == 0, &quot;Test 21e, Plugin with id=&quot; + plugin.id + &quot; overlay rect should have 0px height after being clicked&quot;);</span>
<a href="#l5.546"></a><span id="l5.546">     var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.547"></a><span id="l5.547">     ok(objLoadingContent.activated, &quot;Test 21e, Plugin with id=&quot; + plugin.id + &quot; should be activated&quot;);</span>
<a href="#l5.548"></a><span id="l5.548">   }</span>
<a href="#l5.549"></a><span id="l5.549"> </span>
<a href="#l5.550"></a><span id="l5.550">   Services.prefs.setBoolPref(&quot;plugins.click_to_play&quot;, true);</span>
<a href="#l5.551"></a><span id="l5.551" class="difflineplus">+  getTestPlugin().enabledState = Ci.nsIPluginTag.STATE_CLICKTOPLAY;</span>
<a href="#l5.552"></a><span id="l5.552" class="difflineplus">+  getTestPlugin(&quot;Second Test Plug-in&quot;).enabledState = Ci.nsIPluginTag.STATE_CLICKTOPLAY;</span>
<a href="#l5.553"></a><span id="l5.553">   prepareTest(test22, gTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.554"></a><span id="l5.554"> }</span>
<a href="#l5.555"></a><span id="l5.555"> </span>
<a href="#l5.556"></a><span id="l5.556"> // Tests that a click-to-play plugin retains its activated state upon reloading</span>
<a href="#l5.557"></a><span id="l5.557"> function test22() {</span>
<a href="#l5.558"></a><span id="l5.558">   ok(PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser), &quot;Test 22, Should have a click-to-play notification&quot;);</span>
<a href="#l5.559"></a><span id="l5.559"> </span>
<a href="#l5.560"></a><span id="l5.560">   // Plugin should start as CTP</span>
<a href="#l5.561"></a><span id="l5.561" class="difflineat">@@ -978,10 +1068,135 @@ function test23() {</span>
<a href="#l5.562"></a><span id="l5.562">   pluginNode.src = pluginNode.src; // We currently don't properly change state just on type change, bug 767631</span>
<a href="#l5.563"></a><span id="l5.563">   is(objLoadingContent.displayedType, Ci.nsIObjectLoadingContent.TYPE_NULL, &quot;Test 23, plugin should be unloaded&quot;);</span>
<a href="#l5.564"></a><span id="l5.564">   pluginNode.type = &quot;application/x-test&quot;;</span>
<a href="#l5.565"></a><span id="l5.565">   pluginNode.src = pluginNode.src;</span>
<a href="#l5.566"></a><span id="l5.566">   is(objLoadingContent.displayedType, Ci.nsIObjectLoadingContent.TYPE_NULL, &quot;Test 23, Plugin should not have activated&quot;);</span>
<a href="#l5.567"></a><span id="l5.567">   is(objLoadingContent.pluginFallbackType, Ci.nsIObjectLoadingContent.PLUGIN_CLICK_TO_PLAY, &quot;Test 23, Plugin should be click-to-play&quot;);</span>
<a href="#l5.568"></a><span id="l5.568">   ok(!pluginNode.activated, &quot;Test 23, plugin node should not be activated&quot;);</span>
<a href="#l5.569"></a><span id="l5.569"> </span>
<a href="#l5.570"></a><span id="l5.570" class="difflineplus">+  prepareTest(test24a, gHttpTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.571"></a><span id="l5.571" class="difflineplus">+}</span>
<a href="#l5.572"></a><span id="l5.572" class="difflineplus">+</span>
<a href="#l5.573"></a><span id="l5.573" class="difflineplus">+// Test that &quot;always allow&quot;-ing a plugin will not allow it when it becomes</span>
<a href="#l5.574"></a><span id="l5.574" class="difflineplus">+// blocklisted.</span>
<a href="#l5.575"></a><span id="l5.575" class="difflineplus">+function test24a() {</span>
<a href="#l5.576"></a><span id="l5.576" class="difflineplus">+  var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.577"></a><span id="l5.577" class="difflineplus">+  ok(notification, &quot;Test 24a, Should have a click-to-play notification&quot;);</span>
<a href="#l5.578"></a><span id="l5.578" class="difflineplus">+  var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.579"></a><span id="l5.579" class="difflineplus">+  ok(plugin, &quot;Test 24a, Found plugin in page&quot;);</span>
<a href="#l5.580"></a><span id="l5.580" class="difflineplus">+  var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.581"></a><span id="l5.581" class="difflineplus">+  is(objLoadingContent.pluginFallbackType, Ci.nsIObjectLoadingContent.PLUGIN_CLICK_TO_PLAY, &quot;Test 24a, Plugin should be click-to-play&quot;);</span>
<a href="#l5.582"></a><span id="l5.582" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 24a, plugin should not be activated&quot;);</span>
<a href="#l5.583"></a><span id="l5.583" class="difflineplus">+</span>
<a href="#l5.584"></a><span id="l5.584" class="difflineplus">+  // simulate &quot;always allow&quot;</span>
<a href="#l5.585"></a><span id="l5.585" class="difflineplus">+  notification.secondaryActions[0].callback();</span>
<a href="#l5.586"></a><span id="l5.586" class="difflineplus">+  prepareTest(test24b, gHttpTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.587"></a><span id="l5.587" class="difflineplus">+}</span>
<a href="#l5.588"></a><span id="l5.588" class="difflineplus">+</span>
<a href="#l5.589"></a><span id="l5.589" class="difflineplus">+// did the &quot;always allow&quot; work as intended?</span>
<a href="#l5.590"></a><span id="l5.590" class="difflineplus">+function test24b() {</span>
<a href="#l5.591"></a><span id="l5.591" class="difflineplus">+  var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.592"></a><span id="l5.592" class="difflineplus">+  ok(!notification, &quot;Test 24b, Should not have a click-to-play notification&quot;);</span>
<a href="#l5.593"></a><span id="l5.593" class="difflineplus">+  var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.594"></a><span id="l5.594" class="difflineplus">+  ok(plugin, &quot;Test 24b, Found plugin in page&quot;);</span>
<a href="#l5.595"></a><span id="l5.595" class="difflineplus">+  var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.596"></a><span id="l5.596" class="difflineplus">+  ok(objLoadingContent.activated, &quot;Test 24b, plugin should be activated&quot;);</span>
<a href="#l5.597"></a><span id="l5.597" class="difflineplus">+  setAndUpdateBlocklist(gHttpTestRoot + &quot;blockPluginVulnerableUpdatable.xml&quot;,</span>
<a href="#l5.598"></a><span id="l5.598" class="difflineplus">+  function() {</span>
<a href="#l5.599"></a><span id="l5.599" class="difflineplus">+    prepareTest(test24c, gHttpTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.600"></a><span id="l5.600" class="difflineplus">+  });</span>
<a href="#l5.601"></a><span id="l5.601" class="difflineplus">+}</span>
<a href="#l5.602"></a><span id="l5.602" class="difflineplus">+</span>
<a href="#l5.603"></a><span id="l5.603" class="difflineplus">+// the plugin is now blocklisted, so it should not automatically load</span>
<a href="#l5.604"></a><span id="l5.604" class="difflineplus">+function test24c() {</span>
<a href="#l5.605"></a><span id="l5.605" class="difflineplus">+  var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.606"></a><span id="l5.606" class="difflineplus">+  ok(notification, &quot;Test 24c, Should have a click-to-play notification&quot;);</span>
<a href="#l5.607"></a><span id="l5.607" class="difflineplus">+  var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.608"></a><span id="l5.608" class="difflineplus">+  ok(plugin, &quot;Test 24c, Found plugin in page&quot;);</span>
<a href="#l5.609"></a><span id="l5.609" class="difflineplus">+  var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.610"></a><span id="l5.610" class="difflineplus">+  is(objLoadingContent.pluginFallbackType, Ci.nsIObjectLoadingContent.PLUGIN_VULNERABLE_UPDATABLE, &quot;Test 24c, Plugin should be vulnerable/updatable&quot;);</span>
<a href="#l5.611"></a><span id="l5.611" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 24c, plugin should not be activated&quot;);</span>
<a href="#l5.612"></a><span id="l5.612" class="difflineplus">+</span>
<a href="#l5.613"></a><span id="l5.613" class="difflineplus">+  // simulate &quot;always allow&quot;</span>
<a href="#l5.614"></a><span id="l5.614" class="difflineplus">+  notification.secondaryActions[0].callback();</span>
<a href="#l5.615"></a><span id="l5.615" class="difflineplus">+  prepareTest(test24d, gHttpTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.616"></a><span id="l5.616" class="difflineplus">+}</span>
<a href="#l5.617"></a><span id="l5.617" class="difflineplus">+</span>
<a href="#l5.618"></a><span id="l5.618" class="difflineplus">+// We should still be able to always allow a plugin after we've seen that it's</span>
<a href="#l5.619"></a><span id="l5.619" class="difflineplus">+// blocklisted.</span>
<a href="#l5.620"></a><span id="l5.620" class="difflineplus">+function test24d() {</span>
<a href="#l5.621"></a><span id="l5.621" class="difflineplus">+  var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.622"></a><span id="l5.622" class="difflineplus">+  ok(!notification, &quot;Test 24d, Should not have a click-to-play notification&quot;);</span>
<a href="#l5.623"></a><span id="l5.623" class="difflineplus">+  var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.624"></a><span id="l5.624" class="difflineplus">+  ok(plugin, &quot;Test 24d, Found plugin in page&quot;);</span>
<a href="#l5.625"></a><span id="l5.625" class="difflineplus">+  var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.626"></a><span id="l5.626" class="difflineplus">+  ok(objLoadingContent.activated, &quot;Test 24d, plugin should be activated&quot;);</span>
<a href="#l5.627"></a><span id="l5.627" class="difflineplus">+</span>
<a href="#l5.628"></a><span id="l5.628" class="difflineplus">+  // this resets the vulnerable plugin permission</span>
<a href="#l5.629"></a><span id="l5.629" class="difflineplus">+  Services.perms.remove(&quot;127.0.0.1:8888&quot;, gPluginHost.getPermissionStringForType(&quot;application/x-test&quot;));</span>
<a href="#l5.630"></a><span id="l5.630" class="difflineplus">+  setAndUpdateBlocklist(gHttpTestRoot + &quot;blockNoPlugins.xml&quot;,</span>
<a href="#l5.631"></a><span id="l5.631" class="difflineplus">+  function() {</span>
<a href="#l5.632"></a><span id="l5.632" class="difflineplus">+    // this resets the normal plugin permission</span>
<a href="#l5.633"></a><span id="l5.633" class="difflineplus">+    Services.perms.remove(&quot;127.0.0.1:8888&quot;, gPluginHost.getPermissionStringForType(&quot;application/x-test&quot;));</span>
<a href="#l5.634"></a><span id="l5.634" class="difflineplus">+    resetBlocklist();</span>
<a href="#l5.635"></a><span id="l5.635" class="difflineplus">+    prepareTest(test25a, gHttpTestRoot + &quot;plugin_test.html&quot;);</span>
<a href="#l5.636"></a><span id="l5.636" class="difflineplus">+  });</span>
<a href="#l5.637"></a><span id="l5.637" class="difflineplus">+}</span>
<a href="#l5.638"></a><span id="l5.638" class="difflineplus">+</span>
<a href="#l5.639"></a><span id="l5.639" class="difflineplus">+// Test that clicking &quot;always allow&quot; or &quot;always deny&quot; doesn't affect plugins</span>
<a href="#l5.640"></a><span id="l5.640" class="difflineplus">+// that already have permission given to them</span>
<a href="#l5.641"></a><span id="l5.641" class="difflineplus">+function test25a() {</span>
<a href="#l5.642"></a><span id="l5.642" class="difflineplus">+  var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.643"></a><span id="l5.643" class="difflineplus">+  ok(notification, &quot;Test 25a, Should have a click-to-play notification&quot;);</span>
<a href="#l5.644"></a><span id="l5.644" class="difflineplus">+  var plugin = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.645"></a><span id="l5.645" class="difflineplus">+  ok(plugin, &quot;Test 25a, Found plugin in page&quot;);</span>
<a href="#l5.646"></a><span id="l5.646" class="difflineplus">+  var objLoadingContent = plugin.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.647"></a><span id="l5.647" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 25a, plugin should not be activated&quot;);</span>
<a href="#l5.648"></a><span id="l5.648" class="difflineplus">+</span>
<a href="#l5.649"></a><span id="l5.649" class="difflineplus">+  // simulate &quot;always allow&quot;</span>
<a href="#l5.650"></a><span id="l5.650" class="difflineplus">+  notification.secondaryActions[0].callback();</span>
<a href="#l5.651"></a><span id="l5.651" class="difflineplus">+  prepareTest(test25b, gHttpTestRoot + &quot;plugin_two_types.html&quot;);</span>
<a href="#l5.652"></a><span id="l5.652" class="difflineplus">+}</span>
<a href="#l5.653"></a><span id="l5.653" class="difflineplus">+</span>
<a href="#l5.654"></a><span id="l5.654" class="difflineplus">+function test25b() {</span>
<a href="#l5.655"></a><span id="l5.655" class="difflineplus">+  var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.656"></a><span id="l5.656" class="difflineplus">+  ok(notification, &quot;Test 25b, Should have a click-to-play notification&quot;);</span>
<a href="#l5.657"></a><span id="l5.657" class="difflineplus">+</span>
<a href="#l5.658"></a><span id="l5.658" class="difflineplus">+  var test = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.659"></a><span id="l5.659" class="difflineplus">+  ok(test, &quot;Test 25b, Found test plugin in page&quot;);</span>
<a href="#l5.660"></a><span id="l5.660" class="difflineplus">+  var objLoadingContent = test.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.661"></a><span id="l5.661" class="difflineplus">+  ok(objLoadingContent.activated, &quot;Test 25b, test plugin should be activated&quot;);</span>
<a href="#l5.662"></a><span id="l5.662" class="difflineplus">+</span>
<a href="#l5.663"></a><span id="l5.663" class="difflineplus">+  var secondtest = gTestBrowser.contentDocument.getElementById(&quot;secondtestA&quot;);</span>
<a href="#l5.664"></a><span id="l5.664" class="difflineplus">+  ok(secondtest, &quot;Test 25b, Found second test plugin in page&quot;);</span>
<a href="#l5.665"></a><span id="l5.665" class="difflineplus">+  var objLoadingContent = secondtest.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.666"></a><span id="l5.666" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 25b, second test plugin should not be activated&quot;);</span>
<a href="#l5.667"></a><span id="l5.667" class="difflineplus">+</span>
<a href="#l5.668"></a><span id="l5.668" class="difflineplus">+  // simulate &quot;always deny&quot;</span>
<a href="#l5.669"></a><span id="l5.669" class="difflineplus">+  notification.secondaryActions[1].callback();</span>
<a href="#l5.670"></a><span id="l5.670" class="difflineplus">+  prepareTest(test25c, gHttpTestRoot + &quot;plugin_two_types.html&quot;);</span>
<a href="#l5.671"></a><span id="l5.671" class="difflineplus">+}</span>
<a href="#l5.672"></a><span id="l5.672" class="difflineplus">+</span>
<a href="#l5.673"></a><span id="l5.673" class="difflineplus">+// we should have one plugin allowed to activate and the other plugin(s) denied</span>
<a href="#l5.674"></a><span id="l5.674" class="difflineplus">+// (so it should have an invisible overlay)</span>
<a href="#l5.675"></a><span id="l5.675" class="difflineplus">+function test25c() {</span>
<a href="#l5.676"></a><span id="l5.676" class="difflineplus">+  var notification = PopupNotifications.getNotification(&quot;click-to-play-plugins&quot;, gTestBrowser);</span>
<a href="#l5.677"></a><span id="l5.677" class="difflineplus">+  ok(!notification, &quot;Test 25c, Should not have a click-to-play notification&quot;);</span>
<a href="#l5.678"></a><span id="l5.678" class="difflineplus">+</span>
<a href="#l5.679"></a><span id="l5.679" class="difflineplus">+  var test = gTestBrowser.contentDocument.getElementById(&quot;test&quot;);</span>
<a href="#l5.680"></a><span id="l5.680" class="difflineplus">+  ok(test, &quot;Test 25c, Found test plugin in page&quot;);</span>
<a href="#l5.681"></a><span id="l5.681" class="difflineplus">+  var objLoadingContent = test.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.682"></a><span id="l5.682" class="difflineplus">+  ok(objLoadingContent.activated, &quot;Test 25c, test plugin should be activated&quot;);</span>
<a href="#l5.683"></a><span id="l5.683" class="difflineplus">+</span>
<a href="#l5.684"></a><span id="l5.684" class="difflineplus">+  var secondtest = gTestBrowser.contentDocument.getElementById(&quot;secondtestA&quot;);</span>
<a href="#l5.685"></a><span id="l5.685" class="difflineplus">+  ok(secondtest, &quot;Test 25c, Found second test plugin in page&quot;);</span>
<a href="#l5.686"></a><span id="l5.686" class="difflineplus">+  var objLoadingContent = secondtest.QueryInterface(Ci.nsIObjectLoadingContent);</span>
<a href="#l5.687"></a><span id="l5.687" class="difflineplus">+  ok(!objLoadingContent.activated, &quot;Test 25c, second test plugin should not be activated&quot;);</span>
<a href="#l5.688"></a><span id="l5.688" class="difflineplus">+  is(objLoadingContent.pluginFallbackType, Ci.nsIObjectLoadingContent.PLUGIN_DISABLED, &quot;Test 25c, second test plugin should be disabled&quot;);</span>
<a href="#l5.689"></a><span id="l5.689" class="difflineplus">+  var overlay = gTestBrowser.contentDocument.getAnonymousElementByAttribute(secondtest, &quot;class&quot;, &quot;mainBox&quot;);</span>
<a href="#l5.690"></a><span id="l5.690" class="difflineplus">+  ok(overlay.style.visibility != &quot;hidden&quot;, &quot;Test 25c, second test plugin should have visible overlay&quot;);</span>
<a href="#l5.691"></a><span id="l5.691" class="difflineplus">+</span>
<a href="#l5.692"></a><span id="l5.692" class="difflineplus">+  Services.perms.remove(&quot;127.0.0.1:8888&quot;, gPluginHost.getPermissionStringForType(&quot;application/x-test&quot;));</span>
<a href="#l5.693"></a><span id="l5.693" class="difflineplus">+  Services.perms.remove(&quot;127.0.0.1:8888&quot;, gPluginHost.getPermissionStringForType(&quot;application/x-second-test&quot;));</span>
<a href="#l5.694"></a><span id="l5.694" class="difflineplus">+</span>
<a href="#l5.695"></a><span id="l5.695">   finishTest();</span>
<a href="#l5.696"></a><span id="l5.696"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/browser/test/browser/head.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/browser/test/browser/head.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,20 +1,21 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.5"></a><span id="l6.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.6"></a><span id="l6.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">-function getTestPlugin() {</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+function getTestPlugin(aName) {</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+  var pluginName = aName || &quot;Test Plug-in&quot;;</span>
<a href="#l6.11"></a><span id="l6.11">   var ph = Components.classes[&quot;@mozilla.org/plugin/host;1&quot;]</span>
<a href="#l6.12"></a><span id="l6.12">                      .getService(Components.interfaces.nsIPluginHost);</span>
<a href="#l6.13"></a><span id="l6.13">   var tags = ph.getPluginTags();</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15">   // Find the test plugin</span>
<a href="#l6.16"></a><span id="l6.16">   for (var i = 0; i &lt; tags.length; i++) {</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-    if (tags[i].name == &quot;Test Plug-in&quot;)</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+    if (tags[i].name == pluginName)</span>
<a href="#l6.19"></a><span id="l6.19">       return tags[i];</span>
<a href="#l6.20"></a><span id="l6.20">   }</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22">   ok(false, &quot;Unable to find plugin&quot;);</span>
<a href="#l6.23"></a><span id="l6.23">   return null;</span>
<a href="#l6.24"></a><span id="l6.24"> }</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26"> function waitForCondition(condition, nextTest, errorMsg) {</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineat">@@ -38,8 +39,31 @@ function whenNewWindowLoaded(aOptions, a</span>
<a href="#l6.28"></a><span id="l6.28">                            &quot;non-private,chrome,all,dialog=no&quot;;</span>
<a href="#l6.29"></a><span id="l6.29">   var win = window.openDialog(getBrowserURL(), &quot;_blank&quot;, features,</span>
<a href="#l6.30"></a><span id="l6.30">                               &quot;about:blank&quot;);</span>
<a href="#l6.31"></a><span id="l6.31">   win.addEventListener(&quot;load&quot;, function onLoad() {</span>
<a href="#l6.32"></a><span id="l6.32">     win.removeEventListener(&quot;load&quot;, onLoad, false);</span>
<a href="#l6.33"></a><span id="l6.33">     aCallback(win);</span>
<a href="#l6.34"></a><span id="l6.34">   }, false);</span>
<a href="#l6.35"></a><span id="l6.35"> }</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+function updateBlocklist(aCallback) {</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+  var blocklistNotifier = Components.classes[&quot;@mozilla.org/extensions/blocklist;1&quot;]</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+                                    .getService(Components.interfaces.nsITimerCallback);</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+  var observer = function() {</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+    Services.obs.removeObserver(observer, &quot;blocklist-updated&quot;);</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+    SimpleTest.executeSoon(aCallback);</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+  };</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+  Services.obs.addObserver(observer, &quot;blocklist-updated&quot;, false);</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+  blocklistNotifier.notify(null);</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+}</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+var _originalTestBlocklistURL = null;</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+function setAndUpdateBlocklist(aURL, aCallback) {</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+  if (!_originalTestBlocklistURL)</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+    _originalTestBlocklistURL = Services.prefs.getCharPref(&quot;extensions.blocklist.url&quot;);</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+  Services.prefs.setCharPref(&quot;extensions.blocklist.url&quot;, aURL);</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+  updateBlocklist(aCallback);</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+}</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+function resetBlocklist() {</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+  Services.prefs.setCharPref(&quot;extensions.blocklist.url&quot;, _originalTestBlocklistURL);</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">new file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- /dev/null</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ b/suite/browser/test/browser/plugin_clickToPlayDeny.html</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -0,0 +1,10 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineplus">+&lt;!DOCTYPE html&gt;</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineplus">+&lt;html&gt;</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineplus">+&lt;head&gt;</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+&lt;meta charset=&quot;utf-8&quot;&gt;</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineplus">+&lt;/head&gt;</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineplus">+&lt;body&gt;</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+&lt;embed id=&quot;test&quot; style=&quot;width: 200px; height: 200px&quot; type=&quot;application/x-test&quot;&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+&lt;/body&gt;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+&lt;/html&gt;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

