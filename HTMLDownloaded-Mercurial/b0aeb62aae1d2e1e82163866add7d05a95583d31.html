<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29591:b0aeb62aae1d2e1e82163866add7d05a95583d31</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ b0aeb62aae1d2e1e82163866add7d05a95583d31" />
<meta property="og:url" content="/comm-central/rev/b0aeb62aae1d2e1e82163866add7d05a95583d31" />
<meta property="og:description" content="Bug 1637458 - Implement &quot;message security info&quot; for received OpenPGP messages. r=PatrickBrunschwig,mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / b0aeb62aae1d2e1e82163866add7d05a95583d31 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/b0aeb62aae1d2e1e82163866add7d05a95583d31">shortlog</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/b0aeb62aae1d2e1e82163866add7d05a95583d31">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31">files</a> |
changeset |
<a href="/comm-central/raw-rev/b0aeb62aae1d2e1e82163866add7d05a95583d31">raw</a>  | <a href="/comm-central/archive/b0aeb62aae1d2e1e82163866add7d05a95583d31.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1637458">Bug 1637458</a> - Implement &quot;message security info&quot; for received OpenPGP messages. r=PatrickBrunschwig,mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#97;&#105;&#32;&#69;&#110;&#103;&#101;&#114;&#116;&#32;&#60;&#107;&#97;&#105;&#101;&#64;&#107;&#117;&#105;&#120;&#46;&#100;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 11 May 2020 16:58:15 +0200</td></tr>

<tr>
 <td>changeset 29591</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/b0aeb62aae1d2e1e82163866add7d05a95583d31">b0aeb62aae1d2e1e82163866add7d05a95583d31</a></td>
</tr>



<tr>
<td>parent 29590</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1dd226bb8d772fafbfad436e8b7258a15b7632d0">1dd226bb8d772fafbfad436e8b7258a15b7632d0</a>
</td>
</tr>

<tr>
<td>child 29592</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/01c458714912adb6478f6795c5b7b4e16974bb81">01c458714912adb6478f6795c5b7b4e16974bb81</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=b0aeb62aae1d2e1e82163866add7d05a95583d31">17447</a></td></tr>
<tr><td>push user</td><td>kaie@kuix.de</td></tr>
<tr><td>push date</td><td class="date age">Sat, 16 May 2020 21:18:36 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f53587e55c91 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f53587e55c913603d69fcf7e8cc5b55cee534c65">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f53587e55c913603d69fcf7e8cc5b55cee534c65&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f53587e55c913603d69fcf7e8cc5b55cee534c65&newProject=comm-central&newRevision=b0aeb62aae1d2e1e82163866add7d05a95583d31&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f53587e55c913603d69fcf7e8cc5b55cee534c65&newProject=comm-central&newRevision=b0aeb62aae1d2e1e82163866add7d05a95583d31&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f53587e55c913603d69fcf7e8cc5b55cee534c65&newProject=comm-central&newRevision=b0aeb62aae1d2e1e82163866add7d05a95583d31&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28PatrickBrunschwig%29&revcount=50">PatrickBrunschwig</a>, <a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1637458">1637458</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1637458">Bug 1637458</a> - Implement &quot;message security info&quot; for received OpenPGP messages. r=PatrickBrunschwig,mkmelin

Differential Revision: <a href="https://phabricator.services.mozilla.com/D74988">https://phabricator.services.mozilla.com/D74988</a></div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/base/content/msgHdrView.inc.xhtml">mail/base/content/msgHdrView.inc.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/base/content/msgHdrView.inc.xhtml">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/base/content/msgHdrView.inc.xhtml">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/base/content/msgHdrView.inc.xhtml">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/base/content/msgHdrView.inc.xhtml">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/base/content/msgHdrView.inc.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNP.jsm">mail/extensions/openpgp/content/modules/RNP.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNP.jsm">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNP.jsm">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNP.jsm">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNP.jsm">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNP.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNPLib.jsm">mail/extensions/openpgp/content/modules/RNPLib.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNPLib.jsm">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNPLib.jsm">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNPLib.jsm">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNPLib.jsm">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/RNPLib.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/constants.jsm">mail/extensions/openpgp/content/modules/constants.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/constants.jsm">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/constants.jsm">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/constants.jsm">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/constants.jsm">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/constants.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/mimeDecrypt.jsm">mail/extensions/openpgp/content/modules/mimeDecrypt.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/mimeDecrypt.jsm">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/mimeDecrypt.jsm">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/mimeDecrypt.jsm">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/mimeDecrypt.jsm">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/modules/mimeDecrypt.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.dtd">mail/extensions/openpgp/content/strings/msgReadStatus.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.dtd">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.dtd">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.dtd">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.dtd">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.properties">mail/extensions/openpgp/content/strings/msgReadStatus.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.properties">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.properties">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.properties">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.properties">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/strings/msgReadStatus.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailCommon.js">mail/extensions/openpgp/content/ui/enigmailCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailCommon.js">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailCommon.js">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailCommon.js">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailCommon.js">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailCommon.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.js">mail/extensions/openpgp/content/ui/msgReadStatus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.js">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.js">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.js">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.js">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.xhtml">mail/extensions/openpgp/content/ui/msgReadStatus.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.xhtml">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.xhtml">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.xhtml">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.xhtml">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/content/ui/msgReadStatus.xhtml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/jar.mn">mail/extensions/openpgp/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/jar.mn">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/jar.mn">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/jar.mn">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/jar.mn">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/openpgp/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/smime/content/msgHdrViewSMIMEOverlay.js">mail/extensions/smime/content/msgHdrViewSMIMEOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/smime/content/msgHdrViewSMIMEOverlay.js">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/smime/content/msgHdrViewSMIMEOverlay.js">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/smime/content/msgHdrViewSMIMEOverlay.js">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/smime/content/msgHdrViewSMIMEOverlay.js">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/extensions/smime/content/msgHdrViewSMIMEOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/locales/en-US/chrome/messenger-smime/msgReadSecurityInfo.dtd">mail/locales/en-US/chrome/messenger-smime/msgReadSecurityInfo.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/locales/en-US/chrome/messenger-smime/msgReadSecurityInfo.dtd">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/locales/en-US/chrome/messenger-smime/msgReadSecurityInfo.dtd">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/locales/en-US/chrome/messenger-smime/msgReadSecurityInfo.dtd">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/locales/en-US/chrome/messenger-smime/msgReadSecurityInfo.dtd">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/locales/en-US/chrome/messenger-smime/msgReadSecurityInfo.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/linux/mail/smime/msgReadSecurityInfo.css">mail/themes/linux/mail/smime/msgReadSecurityInfo.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/linux/mail/smime/msgReadSecurityInfo.css">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/linux/mail/smime/msgReadSecurityInfo.css">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/linux/mail/smime/msgReadSecurityInfo.css">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/linux/mail/smime/msgReadSecurityInfo.css">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/linux/mail/smime/msgReadSecurityInfo.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/osx/mail/smime/msgReadSecurityInfo.css">mail/themes/osx/mail/smime/msgReadSecurityInfo.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/osx/mail/smime/msgReadSecurityInfo.css">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/osx/mail/smime/msgReadSecurityInfo.css">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/osx/mail/smime/msgReadSecurityInfo.css">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/osx/mail/smime/msgReadSecurityInfo.css">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/osx/mail/smime/msgReadSecurityInfo.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/jar.inc.mn">mail/themes/shared/jar.inc.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/jar.inc.mn">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/jar.inc.mn">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/jar.inc.mn">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/jar.inc.mn">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/jar.inc.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/openpgp/msgReadStatus.css">mail/themes/shared/openpgp/msgReadStatus.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/openpgp/msgReadStatus.css">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/openpgp/msgReadStatus.css">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/openpgp/msgReadStatus.css">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/openpgp/msgReadStatus.css">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/shared/openpgp/msgReadStatus.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/windows/mail/smime/msgReadSecurityInfo.css">mail/themes/windows/mail/smime/msgReadSecurityInfo.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/windows/mail/smime/msgReadSecurityInfo.css">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/windows/mail/smime/msgReadSecurityInfo.css">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/windows/mail/smime/msgReadSecurityInfo.css">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/windows/mail/smime/msgReadSecurityInfo.css">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mail/themes/windows/mail/smime/msgReadSecurityInfo.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">mailnews/extensions/smime/content/msgReadSMIMEOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.js">mailnews/extensions/smime/content/msgReadSecurityInfo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.js">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.js">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.js">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.js">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.xhtml">mailnews/extensions/smime/content/msgReadSecurityInfo.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.xhtml">file</a> |
<a href="/comm-central/annotate/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.xhtml">annotate</a> |
<a href="/comm-central/diff/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.xhtml">diff</a> |
<a href="/comm-central/comparison/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.xhtml">comparison</a> |
<a href="/comm-central/log/b0aeb62aae1d2e1e82163866add7d05a95583d31/mailnews/extensions/smime/content/msgReadSecurityInfo.xhtml">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/msgHdrView.inc.xhtml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/msgHdrView.inc.xhtml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -429,17 +429,17 @@</span>
<a href="#l1.4"></a><span id="l1.4">                                                         aria-labelledby=&quot;expandeduser-agentLabel&quot;/&gt;</span>
<a href="#l1.5"></a><span id="l1.5">                                     &lt;/html:td&gt;</span>
<a href="#l1.6"></a><span id="l1.6">                                   &lt;/html:tr&gt;</span>
<a href="#l1.7"></a><span id="l1.7">                                 &lt;/html:table&gt;</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">                                 &lt;!-- perhaps this should be a customizable toolbar too --&gt;</span>
<a href="#l1.10"></a><span id="l1.10">                                 &lt;vbox id=&quot;otherActionsBox&quot; align=&quot;end&quot;&gt;</span>
<a href="#l1.11"></a><span id="l1.11">                                   &lt;hbox id=&quot;dateValueBox&quot; align=&quot;start&quot;&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-                                    &lt;hbox id=&quot;smimeBox&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+                                    &lt;hbox id=&quot;cryptoBox&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l1.14"></a><span id="l1.14">                                       &lt;image id=&quot;signedHdrIcon&quot;</span>
<a href="#l1.15"></a><span id="l1.15">                                              onclick=&quot;showMessageReadSecurityInfo();&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l1.16"></a><span id="l1.16">                                       &lt;image id=&quot;encryptedHdrIcon&quot;</span>
<a href="#l1.17"></a><span id="l1.17">                                              onclick=&quot;showMessageReadSecurityInfo();&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l1.18"></a><span id="l1.18">                                     &lt;/hbox&gt;</span>
<a href="#l1.19"></a><span id="l1.19">                                     &lt;label id=&quot;dateLabel&quot; class=&quot;dateLabel&quot; flex=&quot;1&quot; role=&quot;textbox&quot;</span>
<a href="#l1.20"></a><span id="l1.20">                                            aria-readonly=&quot;true&quot;/&gt;</span>
<a href="#l1.21"></a><span id="l1.21">                                   &lt;/hbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/RNP.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/RNP.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -253,17 +253,16 @@ var RNP = {</span>
<a href="#l2.4"></a><span id="l2.4">         if (keyObj) {</span>
<a href="#l2.5"></a><span id="l2.5">           keys.push(keyObj);</span>
<a href="#l2.6"></a><span id="l2.6">         }</span>
<a href="#l2.7"></a><span id="l2.7">       }</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">       RNPLib.rnp_identifier_iterator_destroy(iter);</span>
<a href="#l2.10"></a><span id="l2.10">     }</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    console.debug(keys);</span>
<a href="#l2.13"></a><span id="l2.13">     return keys;</span>
<a href="#l2.14"></a><span id="l2.14">   },</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16">   // return false if handle refers to subkey and should be ignored</span>
<a href="#l2.17"></a><span id="l2.17">   getKeyInfoFromHandle(ffi, handle, keyObj, usePrimaryIfSubkey, forListing) {</span>
<a href="#l2.18"></a><span id="l2.18">     keyObj.ownerTrust = null;</span>
<a href="#l2.19"></a><span id="l2.19">     keyObj.userId = null;</span>
<a href="#l2.20"></a><span id="l2.20">     keyObj.userIds = [];</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -605,26 +604,32 @@ var RNP = {</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23">     let result = {};</span>
<a href="#l2.24"></a><span id="l2.24">     result.decryptedData = &quot;&quot;;</span>
<a href="#l2.25"></a><span id="l2.25">     result.statusFlags = 0;</span>
<a href="#l2.26"></a><span id="l2.26">     result.extStatusFlags = 0;</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">     result.userId = &quot;&quot;;</span>
<a href="#l2.29"></a><span id="l2.29">     result.keyId = &quot;&quot;;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+    result.encToDetails = &quot;&quot;;</span>
<a href="#l2.31"></a><span id="l2.31"> </span>
<a href="#l2.32"></a><span id="l2.32">     let verify_op = new RNPLib.rnp_op_verify_t();</span>
<a href="#l2.33"></a><span id="l2.33">     result.exitCode = RNPLib.rnp_op_verify_create(</span>
<a href="#l2.34"></a><span id="l2.34">       verify_op.address(),</span>
<a href="#l2.35"></a><span id="l2.35">       RNPLib.ffi,</span>
<a href="#l2.36"></a><span id="l2.36">       input_from_memory,</span>
<a href="#l2.37"></a><span id="l2.37">       output_to_memory</span>
<a href="#l2.38"></a><span id="l2.38">     );</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+    RNPLib.password_cb_collected_info = {};</span>
<a href="#l2.41"></a><span id="l2.41">     result.exitCode = RNPLib.rnp_op_verify_execute(verify_op);</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+    let rnplib_context = RNPLib.password_cb_collected_info;</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+    if (rnplib_context.context == &quot;decrypt&quot;) {</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+      result.encToDetails = rnplib_context.keyId;</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+    }</span>
<a href="#l2.46"></a><span id="l2.46"> </span>
<a href="#l2.47"></a><span id="l2.47">     let useDecryptedData;</span>
<a href="#l2.48"></a><span id="l2.48">     let processSignature;</span>
<a href="#l2.49"></a><span id="l2.49">     switch (result.exitCode) {</span>
<a href="#l2.50"></a><span id="l2.50">       case RNPLib.RNP_SUCCESS:</span>
<a href="#l2.51"></a><span id="l2.51">         useDecryptedData = true;</span>
<a href="#l2.52"></a><span id="l2.52">         processSignature = true;</span>
<a href="#l2.53"></a><span id="l2.53">         break;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineat">@@ -633,19 +638,33 @@ var RNP = {</span>
<a href="#l2.55"></a><span id="l2.55">         useDecryptedData = true;</span>
<a href="#l2.56"></a><span id="l2.56">         processSignature = false;</span>
<a href="#l2.57"></a><span id="l2.57">         break;</span>
<a href="#l2.58"></a><span id="l2.58">       case RNPLib.RNP_ERROR_SIGNATURE_EXPIRED:</span>
<a href="#l2.59"></a><span id="l2.59">         useDecryptedData = true;</span>
<a href="#l2.60"></a><span id="l2.60">         processSignature = false;</span>
<a href="#l2.61"></a><span id="l2.61">         result.statusFlags |= EnigmailConstants.EXPIRED_SIGNATURE;</span>
<a href="#l2.62"></a><span id="l2.62">         break;</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+      case RNPLib.RNP_ERROR_DECRYPT_FAILED:</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+        useDecryptedData = false;</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+        processSignature = false;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+        result.statusFlags |= EnigmailConstants.DECRYPTION_FAILED;</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+        break;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+      case RNPLib.RNP_ERROR_NO_SUITABLE_KEY:</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+        useDecryptedData = false;</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+        processSignature = false;</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+        result.statusFlags |=</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+          EnigmailConstants.DECRYPTION_FAILED | EnigmailConstants.NO_SECKEY;</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+        break;</span>
<a href="#l2.74"></a><span id="l2.74">       default:</span>
<a href="#l2.75"></a><span id="l2.75">         useDecryptedData = false;</span>
<a href="#l2.76"></a><span id="l2.76">         processSignature = false;</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+        console.debug(</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+          &quot;rnp_op_verify_execute returned unexpected: &quot; + result.exitCode</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+        );</span>
<a href="#l2.80"></a><span id="l2.80">         break;</span>
<a href="#l2.81"></a><span id="l2.81">     }</span>
<a href="#l2.82"></a><span id="l2.82"> </span>
<a href="#l2.83"></a><span id="l2.83">     if (useDecryptedData) {</span>
<a href="#l2.84"></a><span id="l2.84">       let result_buf = new ctypes.uint8_t.ptr();</span>
<a href="#l2.85"></a><span id="l2.85">       let result_len = new ctypes.size_t();</span>
<a href="#l2.86"></a><span id="l2.86">       let rv = RNPLib.rnp_output_memory_get_buf(</span>
<a href="#l2.87"></a><span id="l2.87">         output_to_memory,</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineat">@@ -817,60 +836,68 @@ var RNP = {</span>
<a href="#l2.89"></a><span id="l2.89">       }</span>
<a href="#l2.90"></a><span id="l2.90"> </span>
<a href="#l2.91"></a><span id="l2.91">       let useUndecided = true;</span>
<a href="#l2.92"></a><span id="l2.92"> </span>
<a href="#l2.93"></a><span id="l2.93">       if (keyInfo.secretAvailable) {</span>
<a href="#l2.94"></a><span id="l2.94">         if (fromMatchesAnyUid) {</span>
<a href="#l2.95"></a><span id="l2.95">           result.extStatusFlags |= EnigmailConstants.EXT_SELF_IDENTITY;</span>
<a href="#l2.96"></a><span id="l2.96">           useUndecided = false;</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+        } else {</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+          result.statusFlags |= EnigmailConstants.INVALID_RECIPIENT;</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+          useUndecided = true;</span>
<a href="#l2.100"></a><span id="l2.100">         }</span>
<a href="#l2.101"></a><span id="l2.101">       } else if (result.statusFlags &amp; EnigmailConstants.GOOD_SIGNATURE) {</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineminus">-        let acceptanceResult = {};</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineminus">-        try {</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineminus">-          await PgpSqliteDb2.getAcceptance(</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineminus">-            keyInfo.fpr,</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-            fromLower,</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-            acceptanceResult</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineminus">-          );</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineminus">-        } catch (ex) {</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineminus">-          console.debug(&quot;getAcceptance failed: &quot; + ex);</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineminus">-        }</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineminus">-</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineminus">-        // unverified key acceptance means, we consider the signature OK,</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineminus">-        //   but it's not a trusted identity.</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineminus">-        // unverified signature means, we cannot decide if the signature</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineminus">-        //   is ok.</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+        if (!fromMatchesAnyUid) {</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineplus">+          /* At the time the user had accepted the key,</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineplus">+           * a different set of email addresses might have been</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineplus">+           * contained inside the key. In the meantime, we might</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineplus">+           * have refreshed the key, a email addresses</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineplus">+           * might have been removed or revoked.</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineplus">+           * If the current from was removed/revoked, we'd still</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineplus">+           * get an acceptance match, but the from is no longer found</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineplus">+           * in the key's UID list. That should get &quot;undecided&quot;.</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineplus">+           */</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+          result.statusFlags |= EnigmailConstants.INVALID_RECIPIENT;</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+          useUndecided = true;</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineplus">+        } else {</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineplus">+          let acceptanceResult = {};</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+          try {</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineplus">+            await PgpSqliteDb2.getAcceptance(</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+              keyInfo.fpr,</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+              fromLower,</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineplus">+              acceptanceResult</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineplus">+            );</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineplus">+          } catch (ex) {</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineplus">+            console.debug(&quot;getAcceptance failed: &quot; + ex);</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineplus">+          }</span>
<a href="#l2.140"></a><span id="l2.140"> </span>
<a href="#l2.141"></a><span id="l2.141" class="difflineminus">-        if (</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineminus">-          &quot;emailDecided&quot; in acceptanceResult &amp;&amp;</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineminus">-          acceptanceResult.emailDecided &amp;&amp;</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineminus">-          &quot;fingerprintAcceptance&quot; in acceptanceResult &amp;&amp;</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineminus">-          acceptanceResult.fingerprintAcceptance != &quot;undecided&quot;</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-        ) {</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-          if (acceptanceResult.fingerprintAcceptance == &quot;rejected&quot;) {</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineminus">-            result.statusFlags &amp;= ~EnigmailConstants.GOOD_SIGNATURE;</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-            result.statusFlags |= EnigmailConstants.BAD_SIGNATURE;</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-            useUndecided = false;</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineminus">-          } else if (!fromMatchesAnyUid) {</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineminus">-            /* At the time the user had accepted the key,</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineminus">-             * a different set of email addresses might have been</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineminus">-             * contained inside the key. In the meantime, we might</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineminus">-             * have refreshed the key, a email addresses</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineminus">-             * might have been removed or revoked.</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineminus">-             * If the current from was removed/revoked, we'd still</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineminus">-             * get an acceptance match, but the from is no longer found</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineminus">-             * in the key's UID list. That should get &quot;undecided&quot;.</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineminus">-             */</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineminus">-            useUndecided = true;</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineminus">-          } else if (acceptanceResult.fingerprintAcceptance == &quot;verified&quot;) {</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineminus">-            result.statusFlags |= EnigmailConstants.TRUSTED_IDENTITY;</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineminus">-            useUndecided = false;</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineminus">-          } else if (acceptanceResult.fingerprintAcceptance == &quot;unverified&quot;) {</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineminus">-            useUndecided = false;</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineplus">+          // unverified key acceptance means, we consider the signature OK,</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineplus">+          //   but it's not a trusted identity.</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineplus">+          // unverified signature means, we cannot decide if the signature</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineplus">+          //   is ok.</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineplus">+</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineplus">+          if (</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineplus">+            &quot;emailDecided&quot; in acceptanceResult &amp;&amp;</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineplus">+            acceptanceResult.emailDecided &amp;&amp;</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineplus">+            &quot;fingerprintAcceptance&quot; in acceptanceResult &amp;&amp;</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineplus">+            acceptanceResult.fingerprintAcceptance != &quot;undecided&quot;</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineplus">+          ) {</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineplus">+            if (acceptanceResult.fingerprintAcceptance == &quot;rejected&quot;) {</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineplus">+              result.statusFlags &amp;= ~EnigmailConstants.GOOD_SIGNATURE;</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineplus">+              result.statusFlags |=</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineplus">+                EnigmailConstants.BAD_SIGNATURE |</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineplus">+                EnigmailConstants.INVALID_RECIPIENT;</span>
<a href="#l2.183"></a><span id="l2.183" class="difflineplus">+              useUndecided = false;</span>
<a href="#l2.184"></a><span id="l2.184" class="difflineplus">+            } else if (acceptanceResult.fingerprintAcceptance == &quot;verified&quot;) {</span>
<a href="#l2.185"></a><span id="l2.185" class="difflineplus">+              result.statusFlags |= EnigmailConstants.TRUSTED_IDENTITY;</span>
<a href="#l2.186"></a><span id="l2.186" class="difflineplus">+              useUndecided = false;</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineplus">+            } else if (acceptanceResult.fingerprintAcceptance == &quot;unverified&quot;) {</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineplus">+              useUndecided = false;</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineplus">+            }</span>
<a href="#l2.190"></a><span id="l2.190">           }</span>
<a href="#l2.191"></a><span id="l2.191">         }</span>
<a href="#l2.192"></a><span id="l2.192">       }</span>
<a href="#l2.193"></a><span id="l2.193"> </span>
<a href="#l2.194"></a><span id="l2.194">       if (useUndecided) {</span>
<a href="#l2.195"></a><span id="l2.195">         result.statusFlags &amp;= ~EnigmailConstants.GOOD_SIGNATURE;</span>
<a href="#l2.196"></a><span id="l2.196">         result.statusFlags |= EnigmailConstants.UNCERTAIN_SIGNATURE;</span>
<a href="#l2.197"></a><span id="l2.197">       }</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineat">@@ -1133,23 +1160,25 @@ var RNP = {</span>
<a href="#l2.199"></a><span id="l2.199">       flags,</span>
<a href="#l2.200"></a><span id="l2.200">       jsonInfo.address()</span>
<a href="#l2.201"></a><span id="l2.201">     );</span>
<a href="#l2.202"></a><span id="l2.202"> </span>
<a href="#l2.203"></a><span id="l2.203">     // TODO: parse jsonInfo and return a list of keys,</span>
<a href="#l2.204"></a><span id="l2.204">     // as seen in keyRing.importKeyAsync.</span>
<a href="#l2.205"></a><span id="l2.205">     // (should prevent the incorrect popup &quot;no keys imported&quot;.)</span>
<a href="#l2.206"></a><span id="l2.206"> </span>
<a href="#l2.207"></a><span id="l2.207" class="difflineplus">+    /*</span>
<a href="#l2.208"></a><span id="l2.208">     if (!rv) {</span>
<a href="#l2.209"></a><span id="l2.209">       console.debug(</span>
<a href="#l2.210"></a><span id="l2.210">         &quot;result key listing, rv= %s, result= %s&quot;,</span>
<a href="#l2.211"></a><span id="l2.211">         rv,</span>
<a href="#l2.212"></a><span id="l2.212">         jsonInfo.readString()</span>
<a href="#l2.213"></a><span id="l2.213">       );</span>
<a href="#l2.214"></a><span id="l2.214">     }</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineplus">+    */</span>
<a href="#l2.216"></a><span id="l2.216"> </span>
<a href="#l2.217"></a><span id="l2.217">     RNPLib.rnp_buffer_destroy(jsonInfo);</span>
<a href="#l2.218"></a><span id="l2.218">     RNPLib.rnp_input_destroy(input_from_memory);</span>
<a href="#l2.219"></a><span id="l2.219"> </span>
<a href="#l2.220"></a><span id="l2.220">     return rv;</span>
<a href="#l2.221"></a><span id="l2.221">   },</span>
<a href="#l2.222"></a><span id="l2.222"> </span>
<a href="#l2.223"></a><span id="l2.223">   isSimpleASCII(str) {</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineat">@@ -2046,18 +2075,16 @@ var RNP = {</span>
<a href="#l2.225"></a><span id="l2.225">     let result_len = new ctypes.size_t();</span>
<a href="#l2.226"></a><span id="l2.226">     let exitCode = RNPLib.rnp_output_memory_get_buf(</span>
<a href="#l2.227"></a><span id="l2.227">       out_final,</span>
<a href="#l2.228"></a><span id="l2.228">       result_buf.address(),</span>
<a href="#l2.229"></a><span id="l2.229">       result_len.address(),</span>
<a href="#l2.230"></a><span id="l2.230">       false</span>
<a href="#l2.231"></a><span id="l2.231">     );</span>
<a href="#l2.232"></a><span id="l2.232"> </span>
<a href="#l2.233"></a><span id="l2.233" class="difflineminus">-    console.debug(exitCode);</span>
<a href="#l2.234"></a><span id="l2.234" class="difflineminus">-</span>
<a href="#l2.235"></a><span id="l2.235">     if (!exitCode) {</span>
<a href="#l2.236"></a><span id="l2.236">       let char_array = ctypes.cast(</span>
<a href="#l2.237"></a><span id="l2.237">         result_buf,</span>
<a href="#l2.238"></a><span id="l2.238">         ctypes.char.array(result_len.value).ptr</span>
<a href="#l2.239"></a><span id="l2.239">       ).contents;</span>
<a href="#l2.240"></a><span id="l2.240">       result = char_array.readString();</span>
<a href="#l2.241"></a><span id="l2.241">     }</span>
<a href="#l2.242"></a><span id="l2.242"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/RNPLib.jsm</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/RNPLib.jsm</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -237,21 +237,76 @@ function enableRNPLibJS() {</span>
<a href="#l3.4"></a><span id="l3.4">       this.rnp_output_destroy(out2);</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">       output_to_path = null;</span>
<a href="#l3.7"></a><span id="l3.7">       out2 = null;</span>
<a href="#l3.8"></a><span id="l3.8">     },</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">     keep_password_cb_alive: null,</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+    password_cb_collected_info: {},</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+</span>
<a href="#l3.14"></a><span id="l3.14">     password_cb(ffi, app_ctx, key, pgp_context, buf, buf_len) {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-      console.log(</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-        &quot;in RNPLib.password_cb, context: &quot; + pgp_context.readString()</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-      );</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-      console.log(&quot;max_len: &quot; + buf_len);</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+      // Before we fullfil the request, we collect context information.</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+      RNPLib.password_cb_collected_info.context = pgp_context.readString();</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+      if (RNPLib.password_cb_collected_info.context == &quot;decrypt&quot;) {</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+        // Get the key ID of the key used to decrypt. If it's a subkey,</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+        // we use the ID of the primary key.</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+        let usePrimaryHandle = false;</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+        let primaryHandle = null;</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+        let is_subkey = new ctypes.bool();</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+        if (RNPLib.rnp_key_is_sub(key, is_subkey.address())) {</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+          throw new Error(&quot;rnp_key_is_sub failed&quot;);</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+        }</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+        if (is_subkey.value) {</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+          let primary_grip = new ctypes.char.ptr();</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+          if (RNPLib.rnp_key_get_primary_grip(key, primary_grip.address())) {</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+            throw new Error(&quot;rnp_key_get_primary_grip failed&quot;);</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+          }</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+          if (!primary_grip.isNull()) {</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+            primaryHandle = new RNPLib.rnp_key_handle_t();</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+            if (</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+              RNPLib.rnp_locate_key(</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+                ffi,</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+                &quot;grip&quot;,</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+                primary_grip,</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+                primaryHandle.address()</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+              )</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+            ) {</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+              throw new Error(&quot;rnp_locate_key failed&quot;);</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+            }</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+            if (!primaryHandle.isNull()) {</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+              usePrimaryHandle = true;</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+            }</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+            RNPLib.rnp_buffer_destroy(primary_grip);</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+          }</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+        }</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+        let key_id = new ctypes.char.ptr();</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+        if (</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+          RNPLib.rnp_key_get_keyid(</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+            usePrimaryHandle ? primaryHandle : key,</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+            key_id.address()</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineplus">+          )</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+        ) {</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+          throw new Error(&quot;rnp_key_get_keyid failed&quot;);</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+        }</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+        RNPLib.password_cb_collected_info.keyId = key_id.readString();</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+        RNPLib.rnp_buffer_destroy(key_id);</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+        if (primaryHandle) {</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+          RNPLib.rnp_key_handle_destroy(primaryHandle);</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+        }</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+      }</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+      // Now do what we've been asked to do.</span>
<a href="#l3.76"></a><span id="l3.76"> </span>
<a href="#l3.77"></a><span id="l3.77">       let pass = OpenPGPMasterpass.retrieveOpenPGPPassword();</span>
<a href="#l3.78"></a><span id="l3.78">       var passCTypes = ctypes.char.array()(pass); // UTF-8</span>
<a href="#l3.79"></a><span id="l3.79">       let passLen = passCTypes.length;</span>
<a href="#l3.80"></a><span id="l3.80"> </span>
<a href="#l3.81"></a><span id="l3.81">       if (buf_len &lt; passLen) {</span>
<a href="#l3.82"></a><span id="l3.82">         return false;</span>
<a href="#l3.83"></a><span id="l3.83">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/constants.jsm</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/constants.jsm</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -108,18 +108,35 @@ var EnigmailConstants = {</span>
<a href="#l4.4"></a><span id="l4.4">   PHOTO_AVAILABLE: 0x02000000,</span>
<a href="#l4.5"></a><span id="l4.5">   OVERFLOWED: 0x04000000,</span>
<a href="#l4.6"></a><span id="l4.6">   CARDCTRL: 0x08000000,</span>
<a href="#l4.7"></a><span id="l4.7">   SC_OP_FAILURE: 0x10000000,</span>
<a href="#l4.8"></a><span id="l4.8">   UNKNOWN_ALGO: 0x20000000,</span>
<a href="#l4.9"></a><span id="l4.9">   SIG_CREATED: 0x40000000,</span>
<a href="#l4.10"></a><span id="l4.10">   END_ENCRYPTION: 0x80000000,</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+  /* Extended status flags */</span>
<a href="#l4.13"></a><span id="l4.13">   EXT_SELF_IDENTITY: 0x00000001,</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+  /* UI message status flags */</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+  MSG_SIG_NONE: 0,</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+  MSG_SIG_VALID_SELF: 1,</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+  MSG_SIG_VALID_KEY_VERIFIED: 2,</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+  MSG_SIG_VALID_KEY_UNVERIFIED: 3,</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+  MSG_SIG_UNCERTAIN_KEY_UNAVAILABLE: 4,</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+  MSG_SIG_UNCERTAIN_UID_MISMATCH: 5,</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+  MSG_SIG_UNCERTAIN_KEY_NOT_ACCEPTED: 6,</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+  MSG_SIG_INVALID: 7,</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+  MSG_SIG_INVALID_KEY_REJECTED: 8,</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+  MSG_ENC_NONE: 0,</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+  MSG_ENC_OK: 1,</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+  MSG_ENC_FAILURE: 2,</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+  MSG_ENC_NO_SECRET_KEY: 3,</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+</span>
<a href="#l4.31"></a><span id="l4.31">   /*** key handling functions ***/</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33">   EXTRACT_SECRET_KEY: 0x01,</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35">   /* Keyserver Action Flags */</span>
<a href="#l4.36"></a><span id="l4.36">   SEARCH_KEY: 1,</span>
<a href="#l4.37"></a><span id="l4.37">   DOWNLOAD_KEY: 2,</span>
<a href="#l4.38"></a><span id="l4.38">   UPLOAD_KEY: 3,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/mimeDecrypt.jsm</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/mimeDecrypt.jsm</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -561,16 +561,17 @@ MimeDecryptHandler.prototype = {</span>
<a href="#l5.4"></a><span id="l5.4">       if (!options.fromAddr) {</span>
<a href="#l5.5"></a><span id="l5.5">         var win2 = Services.wm.getMostRecentWindow(null);</span>
<a href="#l5.6"></a><span id="l5.6">         options.fromAddr = EnigmailDecryption.getFromAddr(win2);</span>
<a href="#l5.7"></a><span id="l5.7">       }</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">       const cApi = EnigmailCryptoAPI();</span>
<a href="#l5.10"></a><span id="l5.10">       EnigmailLog.DEBUG(&quot;mimeDecrypt.jsm: got API: &quot; + cApi.api_name + &quot;\n&quot;);</span>
<a href="#l5.11"></a><span id="l5.11">       this.returnStatus = cApi.sync(cApi.decryptMime(this.outQueue, options));</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+</span>
<a href="#l5.13"></a><span id="l5.13">       if (!this.returnStatus) {</span>
<a href="#l5.14"></a><span id="l5.14">         this.returnStatus = {</span>
<a href="#l5.15"></a><span id="l5.15">           decryptedData: &quot;&quot;,</span>
<a href="#l5.16"></a><span id="l5.16">           exitCode: -1,</span>
<a href="#l5.17"></a><span id="l5.17">           statusFlags: EnigmailConstants.DECRYPTION_FAILED,</span>
<a href="#l5.18"></a><span id="l5.18">         };</span>
<a href="#l5.19"></a><span id="l5.19">       }</span>
<a href="#l5.20"></a><span id="l5.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/mail/extensions/openpgp/content/strings/msgReadStatus.dtd</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,9 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+&lt;!ENTITY ViewSignerKey &quot;View signer key&quot;&gt;</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+&lt;!ENTITY ViewYourEncryptionKey &quot;View your recipient key&quot;&gt;</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+&lt;!-- LOCALIZATION NOTE(OpenPGP): This a name for a technical standard. You should not translate it, but if applicable, you may write it using localized characters. --&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+&lt;!ENTITY OpenPGP &quot;OpenPGP&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">new file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- /dev/null</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ b/mail/extensions/openpgp/content/strings/msgReadStatus.properties</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -0,0 +1,22 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineplus">+NoSig=No Digital Signature</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineplus">+UncertainSig=Uncertain Digital Signature</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+InvalidSig=Invalid Digital Signature</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+GoodSig=Good Digital Signature</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+SigUncertainNoKey=This message contains a digital signature, but it is uncertain if it is correct. To verify the signature, you need to obtain a copy of the sender's public key.</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+SigUncertainUidMismatch=This message contains a digital signature, but a mismatch was detected. The message was sent from an email address that doesn't match the signer's public key.</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+SigUncertainNotAccepted=This message contains a digital signature, but you haven't yet decided if the signer's key is acceptable to you.</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+SigInvalidRejected=This message contains a digital signature, but you have previously decided to reject the signer key.</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+SigInvalidTechnicalProblem=This message contains a digital signature, but a technical error was detected. Either the message has been corrupted, or the message has been modified by someone else.</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+SigValidUnverified=This message includes a valid digital signature from a key that you have already accepted. However, you have not yet verified that the key is really owned by the sender.</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+SigValidVerified=This message includes a valid digital signature from a verified key.</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+SigValidOwnKey=This message includes a valid digital signature from your personal key.</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+#SenderAddress=Sender's email address: %s</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+SigKeyId=Signer key ID: %S</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+EncKeyId=Recipient key ID: %S</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/enigmailCommon.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/enigmailCommon.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -145,17 +145,16 @@ const ENIG_IMG_NOT_SELECTED = &quot;chrome://</span>
<a href="#l8.4"></a><span id="l8.4"> const ENIG_IMG_SELECTED = &quot;chrome://openpgp/content/ui/check1.png&quot;;</span>
<a href="#l8.5"></a><span id="l8.5"> const ENIG_IMG_DISABLED = &quot;chrome://openpgp/content/ui/check2.png&quot;;</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> // UsePGPMimeOption values</span>
<a href="#l8.8"></a><span id="l8.8"> const PGP_MIME_NEVER = 0;</span>
<a href="#l8.9"></a><span id="l8.9"> const PGP_MIME_POSSIBLE = 1;</span>
<a href="#l8.10"></a><span id="l8.10"> const PGP_MIME_ALWAYS = 2;</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-const ENIG_POSSIBLE_PGPMIME = EnigmailConstants.POSSIBLE_PGPMIME;</span>
<a href="#l8.13"></a><span id="l8.13"> const ENIG_PGP_DESKTOP_ATT = -2082;</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15"> var gUsePGPMimeOptionList = [</span>
<a href="#l8.16"></a><span id="l8.16">   &quot;usePGPMimeNever&quot;,</span>
<a href="#l8.17"></a><span id="l8.17">   &quot;usePGPMimePossible&quot;,</span>
<a href="#l8.18"></a><span id="l8.18">   &quot;usePGPMimeAlways&quot;,</span>
<a href="#l8.19"></a><span id="l8.19"> ];</span>
<a href="#l8.20"></a><span id="l8.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -203,23 +203,25 @@ Enigmail.msg = {</span>
<a href="#l9.4"></a><span id="l9.4">         }</span>
<a href="#l9.5"></a><span id="l9.5">       }</span>
<a href="#l9.6"></a><span id="l9.6">     }</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8">     Enigmail.msg.messagePane = document.getElementById(&quot;messagepane&quot;);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10">     EnigmailLog.DEBUG(&quot;enigmailMessengerOverlay.js: Startup\n&quot;);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+    /*</span>
<a href="#l9.13"></a><span id="l9.13">     // Override SMIME ui</span>
<a href="#l9.14"></a><span id="l9.14">     overrideAttribute(</span>
<a href="#l9.15"></a><span id="l9.15">       [&quot;cmd_viewSecurityStatus&quot;],</span>
<a href="#l9.16"></a><span id="l9.16">       &quot;Enigmail.msg.viewSecurityInfo(null, true);&quot;,</span>
<a href="#l9.17"></a><span id="l9.17">       &quot;&quot;,</span>
<a href="#l9.18"></a><span id="l9.18">       &quot;&quot;</span>
<a href="#l9.19"></a><span id="l9.19">     );</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+    */</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22">     // Override print command</span>
<a href="#l9.23"></a><span id="l9.23">     var printElementIds = [</span>
<a href="#l9.24"></a><span id="l9.24">       &quot;cmd_print&quot;,</span>
<a href="#l9.25"></a><span id="l9.25">       &quot;cmd_printpreview&quot;,</span>
<a href="#l9.26"></a><span id="l9.26">       &quot;key_print&quot;,</span>
<a href="#l9.27"></a><span id="l9.27">       &quot;button-print&quot;,</span>
<a href="#l9.28"></a><span id="l9.28">       &quot;mailContext-print&quot;,</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineat">@@ -305,16 +307,17 @@ Enigmail.msg = {</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31">     EnigmailMsgRead.ensureExtraAddonHeaders();</span>
<a href="#l9.32"></a><span id="l9.32">     gMessageListeners.push(Enigmail.msg.messageListener);</span>
<a href="#l9.33"></a><span id="l9.33">     Enigmail.msg.messageListener.onEndHeaders();</span>
<a href="#l9.34"></a><span id="l9.34">   },</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36">   messageListener: {</span>
<a href="#l9.37"></a><span id="l9.37">     onStartHeaders() {</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+      Enigmail.hdrView.reset();</span>
<a href="#l9.39"></a><span id="l9.39">       Enigmail.msg.mimeParts = null;</span>
<a href="#l9.40"></a><span id="l9.40">       let b = document.getElementById(&quot;openpgpKeyBox&quot;);</span>
<a href="#l9.41"></a><span id="l9.41">       b.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l9.42"></a><span id="l9.42">       b.removeAttribute(&quot;keydata&quot;);</span>
<a href="#l9.43"></a><span id="l9.43"> </span>
<a href="#l9.44"></a><span id="l9.44">       let b2 = document.getElementById(&quot;signatureKeyBox&quot;);</span>
<a href="#l9.45"></a><span id="l9.45">       b2.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l9.46"></a><span id="l9.46">       b2.removeAttribute(&quot;keyid&quot;);</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineat">@@ -327,42 +330,33 @@ Enigmail.msg = {</span>
<a href="#l9.48"></a><span id="l9.48">       if (&quot;openpgp&quot; in gExpandedHeaderView) {</span>
<a href="#l9.49"></a><span id="l9.49">         delete gExpandedHeaderView.openpgp;</span>
<a href="#l9.50"></a><span id="l9.50">       }</span>
<a href="#l9.51"></a><span id="l9.51">     },</span>
<a href="#l9.52"></a><span id="l9.52">     onEndHeaders() {},</span>
<a href="#l9.53"></a><span id="l9.53">     onEndAttachments() {},</span>
<a href="#l9.54"></a><span id="l9.54">   },</span>
<a href="#l9.55"></a><span id="l9.55"> </span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+  /*</span>
<a href="#l9.57"></a><span id="l9.57">   viewSecurityInfo(event, displaySmimeMsg) {</span>
<a href="#l9.58"></a><span id="l9.58">     EnigmailLog.DEBUG(&quot;enigmailMessengerOverlay.js: viewSecurityInfo\n&quot;);</span>
<a href="#l9.59"></a><span id="l9.59"> </span>
<a href="#l9.60"></a><span id="l9.60">     if (event &amp;&amp; event.button !== 0) {</span>
<a href="#l9.61"></a><span id="l9.61">       return;</span>
<a href="#l9.62"></a><span id="l9.62">     }</span>
<a href="#l9.63"></a><span id="l9.63"> </span>
<a href="#l9.64"></a><span id="l9.64">     if (gSignatureStatus &gt;= 0 || gEncryptionStatus &gt;= 0) {</span>
<a href="#l9.65"></a><span id="l9.65">       showMessageReadSecurityInfo();</span>
<a href="#l9.66"></a><span id="l9.66">     } else if (Enigmail.msg.securityInfo) {</span>
<a href="#l9.67"></a><span id="l9.67">       this.viewOpenpgpInfo();</span>
<a href="#l9.68"></a><span id="l9.68">     } else {</span>
<a href="#l9.69"></a><span id="l9.69">       showMessageReadSecurityInfo();</span>
<a href="#l9.70"></a><span id="l9.70">     }</span>
<a href="#l9.71"></a><span id="l9.71">   },</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineminus">-</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineminus">-  viewOpenpgpInfo() {</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-    if (Enigmail.msg.securityInfo) {</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineminus">-      // Thunderbird</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineminus">-      EnigmailDialog.info(</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineminus">-        window,</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineminus">-        EnigmailLocale.getString(&quot;securityInfo&quot;) +</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineminus">-          Enigmail.msg.securityInfo.statusInfo</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">-      );</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineminus">-    }</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineminus">-  },</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+  */</span>
<a href="#l9.84"></a><span id="l9.84"> </span>
<a href="#l9.85"></a><span id="l9.85">   clearLastMessage() {</span>
<a href="#l9.86"></a><span id="l9.86">     const { EnigmailSingletons } = ChromeUtils.import(</span>
<a href="#l9.87"></a><span id="l9.87">       &quot;chrome://openpgp/content/modules/singletons.jsm&quot;</span>
<a href="#l9.88"></a><span id="l9.88">     );</span>
<a href="#l9.89"></a><span id="l9.89">     EnigmailSingletons.clearLastDecryptedMessage();</span>
<a href="#l9.90"></a><span id="l9.90">   },</span>
<a href="#l9.91"></a><span id="l9.91"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l10.4"></a><span id="l10.4">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.5"></a><span id="l10.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.6"></a><span id="l10.6">  * file, You can obtain one at https://mozilla.org/MPL/2.0/.</span>
<a href="#l10.7"></a><span id="l10.7">  */</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> &quot;use strict&quot;;</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11"> /* Globals from Thunderbird: */</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-/* global gFolderDisplay: false, currentAttachments: false, gSMIMEContainer: false, gSignedUINode: false, gEncryptedUINode: false */</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+/* global gFolderDisplay: false, currentAttachments: false, gCryptoContainer: false, gSignedUINode: false, gEncryptedUINode: false */</span>
<a href="#l10.14"></a><span id="l10.14"> /* global gDBView: false, msgWindow: false, messageHeaderSink: false, gMessageListeners: false, findEmailNodeFromPopupNode: true */</span>
<a href="#l10.15"></a><span id="l10.15"> /* global gExpandedHeaderView: false, CanDetachAttachments: true, gEncryptedURIService: false, FillAttachmentListPopup: false */</span>
<a href="#l10.16"></a><span id="l10.16"> /* global attachmentList: false, MailOfflineMgr: false, currentHeaderData: false, ContentTypeIsSMIME: false */</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> /* import-globals-from ../BondOpenPGP.jsm */</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> var EnigmailCore = ChromeUtils.import(</span>
<a href="#l10.21"></a><span id="l10.21">   &quot;chrome://openpgp/content/modules/core.jsm&quot;</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -88,22 +88,31 @@ var EnigmailCompat = ChromeUtils.import(</span>
<a href="#l10.23"></a><span id="l10.23">   &quot;chrome://openpgp/content/modules/compat.jsm&quot;</span>
<a href="#l10.24"></a><span id="l10.24"> ).EnigmailCompat;</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26"> if (!Enigmail) {</span>
<a href="#l10.27"></a><span id="l10.27">   var Enigmail = {};</span>
<a href="#l10.28"></a><span id="l10.28"> }</span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30"> Enigmail.hdrView = {</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-  //enigmailBox: null,</span>
<a href="#l10.32"></a><span id="l10.32">   lastEncryptedMsgKey: null,</span>
<a href="#l10.33"></a><span id="l10.33">   lastEncryptedUri: null,</span>
<a href="#l10.34"></a><span id="l10.34">   flexbuttonAction: null,</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">-  isEncrypted: &quot;&quot;,</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-  isSigned: &quot;&quot;,</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+  msgSignatureState: EnigmailConstants.MSG_SIG_NONE,</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+  msgEncryptionState: EnigmailConstants.MSG_ENC_NONE,</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+  msgSignatureKeyId: &quot;&quot;,</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+  msgEncryptionKeyId: &quot;&quot;,</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+  reset() {</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+    this.msgSignatureState = EnigmailConstants.MSG_SIG_NONE;</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+    this.msgEncryptionState = EnigmailConstants.MSG_ENC_NONE;</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+    this.msgSignatureKeyId = &quot;&quot;;</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+    this.msgEncryptionKeyId = &quot;&quot;;</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+  },</span>
<a href="#l10.49"></a><span id="l10.49"> </span>
<a href="#l10.50"></a><span id="l10.50">   hdrViewLoad() {</span>
<a href="#l10.51"></a><span id="l10.51">     EnigmailLog.DEBUG(&quot;enigmailMsgHdrViewOverlay.js: this.hdrViewLoad\n&quot;);</span>
<a href="#l10.52"></a><span id="l10.52"> </span>
<a href="#l10.53"></a><span id="l10.53">     // THE FOLLOWING OVERRIDES CODE IN msgHdrViewOverlay.js</span>
<a href="#l10.54"></a><span id="l10.54">     // which wouldn't work otherwise</span>
<a href="#l10.55"></a><span id="l10.55"> </span>
<a href="#l10.56"></a><span id="l10.56">     this.origCanDetachAttachments = CanDetachAttachments;</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineat">@@ -130,18 +139,16 @@ Enigmail.hdrView = {</span>
<a href="#l10.58"></a><span id="l10.58">     if (encryptedHdrElement) {</span>
<a href="#l10.59"></a><span id="l10.59">       encryptedHdrElement.setAttribute(</span>
<a href="#l10.60"></a><span id="l10.60">         &quot;onclick&quot;,</span>
<a href="#l10.61"></a><span id="l10.61">         &quot;Enigmail.msg.viewSecurityInfo(event, true);&quot;</span>
<a href="#l10.62"></a><span id="l10.62">       );</span>
<a href="#l10.63"></a><span id="l10.63">     }</span>
<a href="#l10.64"></a><span id="l10.64">     */</span>
<a href="#l10.65"></a><span id="l10.65"> </span>
<a href="#l10.66"></a><span id="l10.66" class="difflineminus">-    //this.enigmailBox = document.getElementById(&quot;enigmailBox&quot;);</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineminus">-</span>
<a href="#l10.68"></a><span id="l10.68">     let addrPopup = document.getElementById(&quot;emailAddressPopup&quot;);</span>
<a href="#l10.69"></a><span id="l10.69">     if (addrPopup) {</span>
<a href="#l10.70"></a><span id="l10.70">       addrPopup.addEventListener(</span>
<a href="#l10.71"></a><span id="l10.71">         &quot;popupshowing&quot;,</span>
<a href="#l10.72"></a><span id="l10.72">         Enigmail.hdrView.displayAddressPopup.bind(addrPopup)</span>
<a href="#l10.73"></a><span id="l10.73">       );</span>
<a href="#l10.74"></a><span id="l10.74">     }</span>
<a href="#l10.75"></a><span id="l10.75"> </span>
<a href="#l10.76"></a><span id="l10.76" class="difflineat">@@ -158,41 +165,54 @@ Enigmail.hdrView = {</span>
<a href="#l10.77"></a><span id="l10.77">   displayAddressPopup(event) {</span>
<a href="#l10.78"></a><span id="l10.78">     let target = event.target;</span>
<a href="#l10.79"></a><span id="l10.79">     EnigmailFuncs.collapseAdvanced(target, &quot;hidden&quot;);</span>
<a href="#l10.80"></a><span id="l10.80">   },</span>
<a href="#l10.81"></a><span id="l10.81"> </span>
<a href="#l10.82"></a><span id="l10.82">   statusBarHide() {</span>
<a href="#l10.83"></a><span id="l10.83">     /* elements might not have been set yet, so we try and ignore */</span>
<a href="#l10.84"></a><span id="l10.84">     try {</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineminus">-      this.isSigned = null;</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineminus">-      this.isEncrypted = null;</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineminus">-      //this.enigmailBox.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+      this.reset();</span>
<a href="#l10.89"></a><span id="l10.89"> </span>
<a href="#l10.90"></a><span id="l10.90">       Enigmail.msg.setAttachmentReveal(null);</span>
<a href="#l10.91"></a><span id="l10.91">       if (Enigmail.msg.securityInfo) {</span>
<a href="#l10.92"></a><span id="l10.92">         Enigmail.msg.securityInfo.statusFlags = 0;</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineminus">-        Enigmail.msg.securityInfo.msgSigned = 0;</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineminus">-        Enigmail.msg.securityInfo.msgEncrypted = 0;</span>
<a href="#l10.95"></a><span id="l10.95">       }</span>
<a href="#l10.96"></a><span id="l10.96"> </span>
<a href="#l10.97"></a><span id="l10.97" class="difflineminus">-      //let enigMsgPane = document.getElementById(&quot;enigmailMsgDisplay&quot;);</span>
<a href="#l10.98"></a><span id="l10.98">       let bodyElement = document.getElementById(&quot;messagepane&quot;);</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineminus">-      //enigMsgPane.setAttribute(&quot;collapsed&quot;, true);</span>
<a href="#l10.100"></a><span id="l10.100">       bodyElement.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l10.101"></a><span id="l10.101">     } catch (ex) {</span>
<a href="#l10.102"></a><span id="l10.102">       console.debug(ex);</span>
<a href="#l10.103"></a><span id="l10.103">     }</span>
<a href="#l10.104"></a><span id="l10.104">   },</span>
<a href="#l10.105"></a><span id="l10.105"> </span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-  setStatusText(txt) {</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-    // TODO: replace with other information display, tracker bug 1595227</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineminus">-    if (txt) {</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineminus">-      console.debug(txt);</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+  viewOpenpgpInfo() {</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineplus">+    let params = {};</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+    params.msgSignatureState = this.msgSignatureState;</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+    params.msgEncryptionState = this.msgEncryptionState;</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+    params.msgSignatureKeyId = this.msgSignatureKeyId;</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+    params.msgEncryptionKeyId = this.msgEncryptionKeyId;</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineplus">+    params.from = &quot;&quot;;</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineplus">+</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+    if (&quot;from&quot; in currentHeaderData) {</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineplus">+      try {</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineplus">+        params.from = EnigmailFuncs.stripEmail(</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+          currentHeaderData.from.headerValue</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineplus">+        ).toLowerCase();</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineplus">+      } catch (ex) {</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineplus">+        console.debug(ex);</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineplus">+      }</span>
<a href="#l10.126"></a><span id="l10.126">     }</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineplus">+    window.openDialog(</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineplus">+      &quot;chrome://openpgp/content/ui/msgReadStatus.xhtml&quot;,</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineplus">+      &quot;&quot;,</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineplus">+      &quot;chrome,resizable,modal,dialog,centerscreen&quot;,</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineplus">+      params</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineplus">+    );</span>
<a href="#l10.134"></a><span id="l10.134">   },</span>
<a href="#l10.135"></a><span id="l10.135"> </span>
<a href="#l10.136"></a><span id="l10.136">   updateHdrIcons(</span>
<a href="#l10.137"></a><span id="l10.137">     exitCode,</span>
<a href="#l10.138"></a><span id="l10.138">     statusFlags,</span>
<a href="#l10.139"></a><span id="l10.139">     extStatusFlags,</span>
<a href="#l10.140"></a><span id="l10.140">     keyId,</span>
<a href="#l10.141"></a><span id="l10.141">     userId,</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineat">@@ -224,27 +244,27 @@ Enigmail.hdrView = {</span>
<a href="#l10.143"></a><span id="l10.143">       Enigmail.msg.securityInfo &amp;&amp;</span>
<a href="#l10.144"></a><span id="l10.144">       Enigmail.msg.securityInfo.xtraStatus &amp;&amp;</span>
<a href="#l10.145"></a><span id="l10.145">       Enigmail.msg.securityInfo.xtraStatus === &quot;wks-request&quot;</span>
<a href="#l10.146"></a><span id="l10.146">     ) {</span>
<a href="#l10.147"></a><span id="l10.147">       return;</span>
<a href="#l10.148"></a><span id="l10.148">     }</span>
<a href="#l10.149"></a><span id="l10.149">     */</span>
<a href="#l10.150"></a><span id="l10.150"> </span>
<a href="#l10.151"></a><span id="l10.151" class="difflineminus">-    //this.enigmailBox = document.getElementById(&quot;enigmailBox&quot;);</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineminus">-</span>
<a href="#l10.153"></a><span id="l10.153">     if (</span>
<a href="#l10.154"></a><span id="l10.154">       gFolderDisplay.selectedMessageUris &amp;&amp;</span>
<a href="#l10.155"></a><span id="l10.155">       gFolderDisplay.selectedMessageUris.length &gt; 0</span>
<a href="#l10.156"></a><span id="l10.156">     ) {</span>
<a href="#l10.157"></a><span id="l10.157">       this.lastEncryptedMsgKey = gFolderDisplay.selectedMessageUris[0];</span>
<a href="#l10.158"></a><span id="l10.158">     }</span>
<a href="#l10.159"></a><span id="l10.159"> </span>
<a href="#l10.160"></a><span id="l10.160">     if (!errorMsg) {</span>
<a href="#l10.161"></a><span id="l10.161">       errorMsg = &quot;&quot;;</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineplus">+    } else {</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineplus">+      console.debug(&quot;OpenPGP error status: &quot; + errorMsg);</span>
<a href="#l10.164"></a><span id="l10.164">     }</span>
<a href="#l10.165"></a><span id="l10.165"> </span>
<a href="#l10.166"></a><span id="l10.166">     var replaceUid = null;</span>
<a href="#l10.167"></a><span id="l10.167">     if (keyId &amp;&amp; gFolderDisplay.selectedMessage) {</span>
<a href="#l10.168"></a><span id="l10.168">       replaceUid = EnigmailMsgRead.matchUidToSender(</span>
<a href="#l10.169"></a><span id="l10.169">         keyId,</span>
<a href="#l10.170"></a><span id="l10.170">         gFolderDisplay.selectedMessage.author</span>
<a href="#l10.171"></a><span id="l10.171">       );</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineat">@@ -268,24 +288,22 @@ Enigmail.hdrView = {</span>
<a href="#l10.173"></a><span id="l10.173"> </span>
<a href="#l10.174"></a><span id="l10.174">     if (userId &amp;&amp; replaceUid) {</span>
<a href="#l10.175"></a><span id="l10.175">       // no EnigConvertGpgToUnicode() here; strings are already UTF-8</span>
<a href="#l10.176"></a><span id="l10.176">       replaceUid = replaceUid.replace(/\\[xe]3a/gi, &quot;:&quot;);</span>
<a href="#l10.177"></a><span id="l10.177">       errorMsg = errorMsg.replace(userId, replaceUid);</span>
<a href="#l10.178"></a><span id="l10.178">     }</span>
<a href="#l10.179"></a><span id="l10.179"> </span>
<a href="#l10.180"></a><span id="l10.180">     var errorLines = &quot;&quot;;</span>
<a href="#l10.181"></a><span id="l10.181" class="difflineminus">-    var fullStatusInfo = &quot;&quot;;</span>
<a href="#l10.182"></a><span id="l10.182"> </span>
<a href="#l10.183"></a><span id="l10.183">     if (exitCode == EnigmailConstants.POSSIBLE_PGPMIME) {</span>
<a href="#l10.184"></a><span id="l10.184">       exitCode = 0;</span>
<a href="#l10.185"></a><span id="l10.185">     } else if (errorMsg) {</span>
<a href="#l10.186"></a><span id="l10.186">       // no EnigConvertGpgToUnicode() here; strings are already UTF-8</span>
<a href="#l10.187"></a><span id="l10.187">       errorLines = errorMsg.split(/\r?\n/);</span>
<a href="#l10.188"></a><span id="l10.188" class="difflineminus">-      fullStatusInfo = errorMsg;</span>
<a href="#l10.189"></a><span id="l10.189">     }</span>
<a href="#l10.190"></a><span id="l10.190"> </span>
<a href="#l10.191"></a><span id="l10.191">     if (errorLines &amp;&amp; errorLines.length &gt; 22) {</span>
<a href="#l10.192"></a><span id="l10.192">       // Retain only first twenty lines and last two lines of error message</span>
<a href="#l10.193"></a><span id="l10.193">       var lastLines =</span>
<a href="#l10.194"></a><span id="l10.194">         errorLines[errorLines.length - 2] +</span>
<a href="#l10.195"></a><span id="l10.195">         &quot;\n&quot; +</span>
<a href="#l10.196"></a><span id="l10.196">         errorLines[errorLines.length - 1] +</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineat">@@ -293,147 +311,64 @@ Enigmail.hdrView = {</span>
<a href="#l10.198"></a><span id="l10.198"> </span>
<a href="#l10.199"></a><span id="l10.199">       while (errorLines.length &gt; 20) {</span>
<a href="#l10.200"></a><span id="l10.200">         errorLines.pop();</span>
<a href="#l10.201"></a><span id="l10.201">       }</span>
<a href="#l10.202"></a><span id="l10.202"> </span>
<a href="#l10.203"></a><span id="l10.203">       errorMsg = errorLines.join(&quot;\n&quot;) + &quot;\n...\n&quot; + lastLines;</span>
<a href="#l10.204"></a><span id="l10.204">     }</span>
<a href="#l10.205"></a><span id="l10.205"> </span>
<a href="#l10.206"></a><span id="l10.206" class="difflineminus">-    var statusInfo = &quot;&quot;;</span>
<a href="#l10.207"></a><span id="l10.207" class="difflineminus">-</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineminus">-    if (statusFlags &amp; EnigmailConstants.NODATA) {</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineminus">-      if (statusFlags &amp; EnigmailConstants.PGP_MIME_SIGNED) {</span>
<a href="#l10.210"></a><span id="l10.210" class="difflineminus">-        statusFlags |= EnigmailConstants.UNCERTAIN_SIGNATURE;</span>
<a href="#l10.211"></a><span id="l10.211" class="difflineminus">-      }</span>
<a href="#l10.212"></a><span id="l10.212" class="difflineminus">-</span>
<a href="#l10.213"></a><span id="l10.213" class="difflineminus">-      if (statusFlags &amp; EnigmailConstants.PGP_MIME_ENCRYPTED) {</span>
<a href="#l10.214"></a><span id="l10.214" class="difflineminus">-        statusFlags |= EnigmailConstants.DECRYPTION_INCOMPLETE;</span>
<a href="#l10.215"></a><span id="l10.215" class="difflineminus">-      }</span>
<a href="#l10.216"></a><span id="l10.216" class="difflineminus">-    }</span>
<a href="#l10.217"></a><span id="l10.217" class="difflineminus">-</span>
<a href="#l10.218"></a><span id="l10.218">     if (!(statusFlags &amp; EnigmailConstants.PGP_MIME_ENCRYPTED)) {</span>
<a href="#l10.219"></a><span id="l10.219">       encMimePartNumber = &quot;&quot;;</span>
<a href="#l10.220"></a><span id="l10.220">     }</span>
<a href="#l10.221"></a><span id="l10.221"> </span>
<a href="#l10.222"></a><span id="l10.222">     if (</span>
<a href="#l10.223"></a><span id="l10.223">       statusFlags &amp; EnigmailConstants.PARTIALLY_PGP &amp;&amp;</span>
<a href="#l10.224"></a><span id="l10.224">       statusFlags &amp; EnigmailConstants.BAD_SIGNATURE</span>
<a href="#l10.225"></a><span id="l10.225">     ) {</span>
<a href="#l10.226"></a><span id="l10.226">       statusFlags &amp;= ~(</span>
<a href="#l10.227"></a><span id="l10.227">         EnigmailConstants.PARTIALLY_PGP | EnigmailConstants.BAD_SIGNATURE</span>
<a href="#l10.228"></a><span id="l10.228">       );</span>
<a href="#l10.229"></a><span id="l10.229">       if (statusFlags === 0) {</span>
<a href="#l10.230"></a><span id="l10.230">         errorMsg = &quot;&quot;;</span>
<a href="#l10.231"></a><span id="l10.231" class="difflineminus">-        fullStatusInfo = &quot;&quot;;</span>
<a href="#l10.232"></a><span id="l10.232">       }</span>
<a href="#l10.233"></a><span id="l10.233" class="difflineplus">+      throw new Error(&quot;unhandled partial PGP message with bad signature&quot;);</span>
<a href="#l10.234"></a><span id="l10.234">     }</span>
<a href="#l10.235"></a><span id="l10.235"> </span>
<a href="#l10.236"></a><span id="l10.236">     var msgSigned =</span>
<a href="#l10.237"></a><span id="l10.237">       statusFlags &amp;</span>
<a href="#l10.238"></a><span id="l10.238">       (EnigmailConstants.BAD_SIGNATURE |</span>
<a href="#l10.239"></a><span id="l10.239">         EnigmailConstants.GOOD_SIGNATURE |</span>
<a href="#l10.240"></a><span id="l10.240">         EnigmailConstants.EXPIRED_KEY_SIGNATURE |</span>
<a href="#l10.241"></a><span id="l10.241">         EnigmailConstants.EXPIRED_SIGNATURE |</span>
<a href="#l10.242"></a><span id="l10.242">         EnigmailConstants.UNCERTAIN_SIGNATURE |</span>
<a href="#l10.243"></a><span id="l10.243">         EnigmailConstants.REVOKED_KEY |</span>
<a href="#l10.244"></a><span id="l10.244">         EnigmailConstants.EXPIRED_KEY_SIGNATURE |</span>
<a href="#l10.245"></a><span id="l10.245">         EnigmailConstants.EXPIRED_SIGNATURE);</span>
<a href="#l10.246"></a><span id="l10.246" class="difflineminus">-    /*</span>
<a href="#l10.247"></a><span id="l10.247" class="difflineminus">-    var msgEncrypted =</span>
<a href="#l10.248"></a><span id="l10.248" class="difflineminus">-      statusFlags &amp;</span>
<a href="#l10.249"></a><span id="l10.249" class="difflineminus">-      (EnigmailConstants.DECRYPTION_OKAY |</span>
<a href="#l10.250"></a><span id="l10.250" class="difflineminus">-        EnigmailConstants.DECRYPTION_INCOMPLETE |</span>
<a href="#l10.251"></a><span id="l10.251" class="difflineminus">-        EnigmailConstants.DECRYPTION_FAILED);</span>
<a href="#l10.252"></a><span id="l10.252" class="difflineminus">-    */</span>
<a href="#l10.253"></a><span id="l10.253"> </span>
<a href="#l10.254"></a><span id="l10.254" class="difflineminus">-    /*</span>
<a href="#l10.255"></a><span id="l10.255">     if (msgSigned &amp;&amp; statusFlags &amp; EnigmailConstants.IMPORTED_KEY) {</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineplus">+      console.debug(&quot;unhandled status IMPORTED_KEY&quot;);</span>
<a href="#l10.257"></a><span id="l10.257">       statusFlags &amp;= ~EnigmailConstants.IMPORTED_KEY;</span>
<a href="#l10.258"></a><span id="l10.258">     }</span>
<a href="#l10.259"></a><span id="l10.259" class="difflineminus">-    */</span>
<a href="#l10.260"></a><span id="l10.260"> </span>
<a href="#l10.261"></a><span id="l10.261">     // TODO: visualize the following signature attributes,</span>
<a href="#l10.262"></a><span id="l10.262">     // cross-check with corresponding email attributes</span>
<a href="#l10.263"></a><span id="l10.263">     // - date</span>
<a href="#l10.264"></a><span id="l10.264">     // - signer uid</span>
<a href="#l10.265"></a><span id="l10.265">     // - signer key</span>
<a href="#l10.266"></a><span id="l10.266">     // - signing and hash alg</span>
<a href="#l10.267"></a><span id="l10.267"> </span>
<a href="#l10.268"></a><span id="l10.268" class="difflineminus">-    // - process failed decryptions first because they imply bad signature handling</span>
<a href="#l10.269"></a><span id="l10.269" class="difflineminus">-    if (statusFlags &amp; EnigmailConstants.BAD_PASSPHRASE) {</span>
<a href="#l10.270"></a><span id="l10.270" class="difflineminus">-      statusInfo = EnigmailLocale.getString(&quot;badPhrase&quot;);</span>
<a href="#l10.271"></a><span id="l10.271" class="difflineminus">-    } else if (statusFlags &amp; EnigmailConstants.DECRYPTION_FAILED) {</span>
<a href="#l10.272"></a><span id="l10.272" class="difflineminus">-      if (statusFlags &amp; EnigmailConstants.MISSING_MDC) {</span>
<a href="#l10.273"></a><span id="l10.273" class="difflineminus">-        statusInfo = EnigmailLocale.getString(&quot;missingMdcError&quot;);</span>
<a href="#l10.274"></a><span id="l10.274" class="difflineminus">-      } else if (statusFlags &amp; EnigmailConstants.MISSING_PASSPHRASE) {</span>
<a href="#l10.275"></a><span id="l10.275" class="difflineminus">-        statusInfo = EnigmailLocale.getString(&quot;missingPassphrase&quot;);</span>
<a href="#l10.276"></a><span id="l10.276" class="difflineminus">-      } else if (statusFlags &amp; EnigmailConstants.NO_SECKEY) {</span>
<a href="#l10.277"></a><span id="l10.277" class="difflineminus">-        statusInfo = EnigmailLocale.getString(&quot;needKey&quot;);</span>
<a href="#l10.278"></a><span id="l10.278" class="difflineminus">-      } else {</span>
<a href="#l10.279"></a><span id="l10.279" class="difflineminus">-        statusInfo = EnigmailLocale.getString(&quot;failedDecrypt&quot;);</span>
<a href="#l10.280"></a><span id="l10.280" class="difflineminus">-      }</span>
<a href="#l10.281"></a><span id="l10.281" class="difflineminus">-    } else if (statusFlags &amp; EnigmailConstants.UNCERTAIN_SIGNATURE) {</span>
<a href="#l10.282"></a><span id="l10.282" class="difflineminus">-      statusInfo = EnigmailLocale.getString(&quot;uncertainSig&quot;);</span>
<a href="#l10.283"></a><span id="l10.283" class="difflineminus">-      if (statusFlags &amp; EnigmailConstants.NO_PUBKEY) {</span>
<a href="#l10.284"></a><span id="l10.284" class="difflineminus">-        let b = document.getElementById(&quot;signatureKeyBox&quot;);</span>
<a href="#l10.285"></a><span id="l10.285" class="difflineminus">-        b.setAttribute(&quot;hidden&quot;, false);</span>
<a href="#l10.286"></a><span id="l10.286" class="difflineminus">-        b.setAttribute(&quot;keyid&quot;, keyId);</span>
<a href="#l10.287"></a><span id="l10.287" class="difflineminus">-      }</span>
<a href="#l10.288"></a><span id="l10.288" class="difflineminus">-    } else if (statusFlags &amp; EnigmailConstants.GOOD_SIGNATURE) {</span>
<a href="#l10.289"></a><span id="l10.289" class="difflineminus">-      statusInfo = EnigmailLocale.getString(&quot;goodSig&quot;, [keyId]);</span>
<a href="#l10.290"></a><span id="l10.290" class="difflineminus">-    } else if (</span>
<a href="#l10.291"></a><span id="l10.291" class="difflineminus">-      statusFlags &amp;</span>
<a href="#l10.292"></a><span id="l10.292" class="difflineminus">-      (EnigmailConstants.BAD_SIGNATURE |</span>
<a href="#l10.293"></a><span id="l10.293" class="difflineminus">-        EnigmailConstants.EXPIRED_SIGNATURE |</span>
<a href="#l10.294"></a><span id="l10.294" class="difflineminus">-        EnigmailConstants.EXPIRED_KEY_SIGNATURE)</span>
<a href="#l10.295"></a><span id="l10.295" class="difflineminus">-    ) {</span>
<a href="#l10.296"></a><span id="l10.296" class="difflineminus">-      statusInfo = EnigmailLocale.getString(&quot;badSig&quot;);</span>
<a href="#l10.297"></a><span id="l10.297" class="difflineminus">-    } else if (statusFlags &amp; EnigmailConstants.DECRYPTION_OKAY) {</span>
<a href="#l10.298"></a><span id="l10.298" class="difflineminus">-      statusInfo = EnigmailLocale.getString(&quot;decryptedMsg&quot;);</span>
<a href="#l10.299"></a><span id="l10.299" class="difflineminus">-    } else if (statusFlags &amp; EnigmailConstants.DECRYPTION_INCOMPLETE) {</span>
<a href="#l10.300"></a><span id="l10.300" class="difflineminus">-      statusInfo = EnigmailLocale.getString(&quot;incompleteDecrypt&quot;);</span>
<a href="#l10.301"></a><span id="l10.301" class="difflineminus">-    } else if (statusFlags &amp; EnigmailConstants.IMPORTED_KEY) {</span>
<a href="#l10.302"></a><span id="l10.302" class="difflineminus">-      statusInfo = &quot;&quot;;</span>
<a href="#l10.303"></a><span id="l10.303" class="difflineminus">-      EnigmailDialog.info(window, errorMsg);</span>
<a href="#l10.304"></a><span id="l10.304" class="difflineminus">-    }</span>
<a href="#l10.305"></a><span id="l10.305" class="difflineminus">-    // add key infos if available</span>
<a href="#l10.306"></a><span id="l10.306" class="difflineminus">-    if (keyId) {</span>
<a href="#l10.307"></a><span id="l10.307" class="difflineminus">-      var si = EnigmailLocale.getString(&quot;uncertainSig&quot;); // &quot;Uncertain signature&quot;</span>
<a href="#l10.308"></a><span id="l10.308" class="difflineminus">-      if (statusInfo === &quot;&quot;) {</span>
<a href="#l10.309"></a><span id="l10.309" class="difflineminus">-        statusInfo += si;</span>
<a href="#l10.310"></a><span id="l10.310" class="difflineminus">-      }</span>
<a href="#l10.311"></a><span id="l10.311" class="difflineminus">-      statusInfo += &quot;\n&quot; + EnigmailLocale.getString(&quot;signatureFrom&quot;, [keyId]);</span>
<a href="#l10.312"></a><span id="l10.312" class="difflineminus">-    }</span>
<a href="#l10.313"></a><span id="l10.313" class="difflineminus">-    //statusInfo += &quot;\n\n&quot; + errorMsg;</span>
<a href="#l10.314"></a><span id="l10.314" class="difflineminus">-</span>
<a href="#l10.315"></a><span id="l10.315" class="difflineminus">-    if (</span>
<a href="#l10.316"></a><span id="l10.316" class="difflineminus">-      statusFlags &amp; EnigmailConstants.DECRYPTION_OKAY ||</span>
<a href="#l10.317"></a><span id="l10.317" class="difflineminus">-      this.isEncrypted === &quot;ok&quot;</span>
<a href="#l10.318"></a><span id="l10.318" class="difflineminus">-    ) {</span>
<a href="#l10.319"></a><span id="l10.319" class="difflineminus">-      var statusMsg;</span>
<a href="#l10.320"></a><span id="l10.320" class="difflineminus">-      if (xtraStatus &amp;&amp; xtraStatus == &quot;buggyMailFormat&quot;) {</span>
<a href="#l10.321"></a><span id="l10.321" class="difflineminus">-        statusMsg = EnigmailLocale.getString(&quot;decryptedMsgWithFormatError&quot;);</span>
<a href="#l10.322"></a><span id="l10.322" class="difflineminus">-      } else {</span>
<a href="#l10.323"></a><span id="l10.323" class="difflineminus">-        statusMsg = EnigmailLocale.getString(&quot;decryptedMsg&quot;);</span>
<a href="#l10.324"></a><span id="l10.324" class="difflineminus">-      }</span>
<a href="#l10.325"></a><span id="l10.325" class="difflineminus">-      if (!statusInfo) {</span>
<a href="#l10.326"></a><span id="l10.326" class="difflineminus">-        statusInfo = statusMsg;</span>
<a href="#l10.327"></a><span id="l10.327" class="difflineminus">-      } else {</span>
<a href="#l10.328"></a><span id="l10.328" class="difflineminus">-        statusInfo = statusMsg + &quot;\n&quot; + statusInfo;</span>
<a href="#l10.329"></a><span id="l10.329" class="difflineminus">-      }</span>
<a href="#l10.330"></a><span id="l10.330" class="difflineminus">-    }</span>
<a href="#l10.331"></a><span id="l10.331" class="difflineplus">+    this.msgSignatureKeyId = keyId;</span>
<a href="#l10.332"></a><span id="l10.332" class="difflineplus">+    this.msgEncryptionKeyId = encToDetails;</span>
<a href="#l10.333"></a><span id="l10.333"> </span>
<a href="#l10.334"></a><span id="l10.334">     if (statusFlags &amp; EnigmailConstants.PARTIALLY_PGP) {</span>
<a href="#l10.335"></a><span id="l10.335" class="difflineminus">-      statusInfo = &quot;&quot;;</span>
<a href="#l10.336"></a><span id="l10.336" class="difflineplus">+      console.debug(&quot;unhandled PARTIALLY_PGP =&gt; statusFlags = 0&quot;);</span>
<a href="#l10.337"></a><span id="l10.337" class="difflineplus">+      statusFlags = 0;</span>
<a href="#l10.338"></a><span id="l10.338">     }</span>
<a href="#l10.339"></a><span id="l10.339"> </span>
<a href="#l10.340"></a><span id="l10.340" class="difflineminus">-    // TODO: if encToDetails.length then make it available in status</span>
<a href="#l10.341"></a><span id="l10.341" class="difflineminus">-    // EnigmailLocale.getString(&quot;encryptKeysNote&quot;, [encToDetails]);</span>
<a href="#l10.342"></a><span id="l10.342" class="difflineminus">-</span>
<a href="#l10.343"></a><span id="l10.343">     /*</span>
<a href="#l10.344"></a><span id="l10.344">     if (xtraStatus === &quot;process-manually&quot;) {</span>
<a href="#l10.345"></a><span id="l10.345">       let buttonLabel = &quot;&quot;;</span>
<a href="#l10.346"></a><span id="l10.346">       if (statusFlags &amp; EnigmailConstants.UNCERTAIN_SIGNATURE) {</span>
<a href="#l10.347"></a><span id="l10.347">         statusLine = EnigmailLocale.getString(&quot;msgPart&quot;, [</span>
<a href="#l10.348"></a><span id="l10.348">           EnigmailLocale.getString(&quot;msgSigned&quot;),</span>
<a href="#l10.349"></a><span id="l10.349">         ]);</span>
<a href="#l10.350"></a><span id="l10.350">         statusLine += EnigmailLocale.getString(&quot;verifyManually&quot;);</span>
<a href="#l10.351"></a><span id="l10.351" class="difflineat">@@ -453,18 +388,16 @@ Enigmail.hdrView = {</span>
<a href="#l10.352"></a><span id="l10.352">     */</span>
<a href="#l10.353"></a><span id="l10.353"> </span>
<a href="#l10.354"></a><span id="l10.354">     let tmp = {</span>
<a href="#l10.355"></a><span id="l10.355">       statusFlags,</span>
<a href="#l10.356"></a><span id="l10.356">       extStatusFlags,</span>
<a href="#l10.357"></a><span id="l10.357">       keyId,</span>
<a href="#l10.358"></a><span id="l10.358">       userId,</span>
<a href="#l10.359"></a><span id="l10.359">       msgSigned,</span>
<a href="#l10.360"></a><span id="l10.360" class="difflineminus">-      statusInfo,</span>
<a href="#l10.361"></a><span id="l10.361" class="difflineminus">-      fullStatusInfo,</span>
<a href="#l10.362"></a><span id="l10.362">       blockSeparation,</span>
<a href="#l10.363"></a><span id="l10.363">       xtraStatus,</span>
<a href="#l10.364"></a><span id="l10.364">       encryptedMimePart: encMimePartNumber,</span>
<a href="#l10.365"></a><span id="l10.365">     };</span>
<a href="#l10.366"></a><span id="l10.366">     Enigmail.msg.securityInfo = tmp;</span>
<a href="#l10.367"></a><span id="l10.367"> </span>
<a href="#l10.368"></a><span id="l10.368">     //Enigmail.msg.createArtificialAutocryptHeader();</span>
<a href="#l10.369"></a><span id="l10.369"> </span>
<a href="#l10.370"></a><span id="l10.370" class="difflineat">@@ -513,49 +446,16 @@ Enigmail.hdrView = {</span>
<a href="#l10.371"></a><span id="l10.371">       EnigmailLog.DEBUG(</span>
<a href="#l10.372"></a><span id="l10.372">         &quot;enigmailMsgHdrViewOverlay.js: checkWksConfirmRequest failed condition\n&quot;</span>
<a href="#l10.373"></a><span id="l10.373">       );</span>
<a href="#l10.374"></a><span id="l10.374">     }</span>
<a href="#l10.375"></a><span id="l10.375">   },</span>
<a href="#l10.376"></a><span id="l10.376">   */</span>
<a href="#l10.377"></a><span id="l10.377"> </span>
<a href="#l10.378"></a><span id="l10.378">   /**</span>
<a href="#l10.379"></a><span id="l10.379" class="difflineminus">-   * Display Enigmail header with text and specific button</span>
<a href="#l10.380"></a><span id="l10.380" class="difflineminus">-   *</span>
<a href="#l10.381"></a><span id="l10.381" class="difflineminus">-   * @param {String} hdrMessage: Message to be displayed in header</span>
<a href="#l10.382"></a><span id="l10.382" class="difflineminus">-   * @param {String} buttonLabel: Label of button</span>
<a href="#l10.383"></a><span id="l10.383" class="difflineminus">-   * @param {String} requestType: action to be performed</span>
<a href="#l10.384"></a><span id="l10.384" class="difflineminus">-   */</span>
<a href="#l10.385"></a><span id="l10.385" class="difflineminus">-  displayFlexAction(hdrMessage, buttonLabel, requestType) {</span>
<a href="#l10.386"></a><span id="l10.386" class="difflineminus">-    if (!Enigmail.msg.securityInfo) {</span>
<a href="#l10.387"></a><span id="l10.387" class="difflineminus">-      Enigmail.msg.securityInfo = {};</span>
<a href="#l10.388"></a><span id="l10.388" class="difflineminus">-    }</span>
<a href="#l10.389"></a><span id="l10.389" class="difflineminus">-    Enigmail.msg.securityInfo.xtraStatus = requestType;</span>
<a href="#l10.390"></a><span id="l10.390" class="difflineminus">-    Enigmail.msg.securityInfo.statusInfo = hdrMessage;</span>
<a href="#l10.391"></a><span id="l10.391" class="difflineminus">-</span>
<a href="#l10.392"></a><span id="l10.392" class="difflineminus">-    // Thunderbird</span>
<a href="#l10.393"></a><span id="l10.393" class="difflineminus">-    this.setStatusText(hdrMessage);</span>
<a href="#l10.394"></a><span id="l10.394" class="difflineminus">-    //this.enigmailBox.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l10.395"></a><span id="l10.395" class="difflineminus">-    //let button = document.getElementById(&quot;enigmail_flexActionButton&quot;);</span>
<a href="#l10.396"></a><span id="l10.396" class="difflineminus">-    //button.setAttribute(&quot;label&quot;, buttonLabel);</span>
<a href="#l10.397"></a><span id="l10.397" class="difflineminus">-    //button.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l10.398"></a><span id="l10.398" class="difflineminus">-    /*</span>
<a href="#l10.399"></a><span id="l10.399" class="difflineminus">-    document</span>
<a href="#l10.400"></a><span id="l10.400" class="difflineminus">-      .getElementById(&quot;enigmail_importKey&quot;)</span>
<a href="#l10.401"></a><span id="l10.401" class="difflineminus">-      .setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l10.402"></a><span id="l10.402" class="difflineminus">-    */</span>
<a href="#l10.403"></a><span id="l10.403" class="difflineminus">-    /*</span>
<a href="#l10.404"></a><span id="l10.404" class="difflineminus">-    this.enigmailBox.setAttribute(</span>
<a href="#l10.405"></a><span id="l10.405" class="difflineminus">-      &quot;class&quot;,</span>
<a href="#l10.406"></a><span id="l10.406" class="difflineminus">-      &quot;expandedEnigmailBox enigmailHeaderBoxLabelSignatureUnknown&quot;</span>
<a href="#l10.407"></a><span id="l10.407" class="difflineminus">-    );</span>
<a href="#l10.408"></a><span id="l10.408" class="difflineminus">-    */</span>
<a href="#l10.409"></a><span id="l10.409" class="difflineminus">-  },</span>
<a href="#l10.410"></a><span id="l10.410" class="difflineminus">-</span>
<a href="#l10.411"></a><span id="l10.411" class="difflineminus">-  /**</span>
<a href="#l10.412"></a><span id="l10.412">    * Display a localized message in lieu of the original message text</span>
<a href="#l10.413"></a><span id="l10.413">    */</span>
<a href="#l10.414"></a><span id="l10.414">   /*</span>
<a href="#l10.415"></a><span id="l10.415">   displayWksMessage() {</span>
<a href="#l10.416"></a><span id="l10.416">     EnigmailLog.DEBUG(&quot;enigmailMsgHdrViewOverlay.js: displayWksMessage()\n&quot;);</span>
<a href="#l10.417"></a><span id="l10.417"> </span>
<a href="#l10.418"></a><span id="l10.418">     if (Enigmail.msg.securityInfo.xtraStatus === &quot;wks-request&quot;) {</span>
<a href="#l10.419"></a><span id="l10.419">       let enigMsgPane = document.getElementById(&quot;enigmailMsgDisplay&quot;);</span>
<a href="#l10.420"></a><span id="l10.420" class="difflineat">@@ -624,317 +524,112 @@ Enigmail.hdrView = {</span>
<a href="#l10.421"></a><span id="l10.421">    */</span>
<a href="#l10.422"></a><span id="l10.422">   /*</span>
<a href="#l10.423"></a><span id="l10.423">   displayAutoCryptSetupMsgHeader() {</span>
<a href="#l10.424"></a><span id="l10.424">     Enigmail.hdrView.displayFlexAction(</span>
<a href="#l10.425"></a><span id="l10.425">       EnigmailLocale.getString(&quot;autocryptSetupReq&quot;),</span>
<a href="#l10.426"></a><span id="l10.426">       EnigmailLocale.getString(&quot;autocryptSetupReq.button.label&quot;),</span>
<a href="#l10.427"></a><span id="l10.427">       &quot;autocrypt-setup&quot;</span>
<a href="#l10.428"></a><span id="l10.428">     );</span>
<a href="#l10.429"></a><span id="l10.429" class="difflineminus">-    //view.enigmailBox.setAttribute(&quot;class&quot;, &quot;expandedEnigmailBox enigmailHeaderBoxLabelSignatureUnknown&quot;);</span>
<a href="#l10.430"></a><span id="l10.430">     this.displayAutocryptMessage(true);</span>
<a href="#l10.431"></a><span id="l10.431">   },</span>
<a href="#l10.432"></a><span id="l10.432"> </span>
<a href="#l10.433"></a><span id="l10.433">   displayAutocryptMessage(allowImport) {</span>
<a href="#l10.434"></a><span id="l10.434">     EnigmailLog.DEBUG(</span>
<a href="#l10.435"></a><span id="l10.435">       &quot;enigmailMsgHdrViewOverlay.js: displayAutocryptMessage()\n&quot;</span>
<a href="#l10.436"></a><span id="l10.436">     );</span>
<a href="#l10.437"></a><span id="l10.437">   },</span>
<a href="#l10.438"></a><span id="l10.438">   */</span>
<a href="#l10.439"></a><span id="l10.439"> </span>
<a href="#l10.440"></a><span id="l10.440">   displayStatusBar() {</span>
<a href="#l10.441"></a><span id="l10.441" class="difflineminus">-    let bodyElement = document.getElementById(&quot;messagepanebox&quot;);</span>
<a href="#l10.442"></a><span id="l10.442" class="difflineminus">-</span>
<a href="#l10.443"></a><span id="l10.443">     let secInfo = Enigmail.msg.securityInfo;</span>
<a href="#l10.444"></a><span id="l10.444">     let statusFlags = secInfo.statusFlags;</span>
<a href="#l10.445"></a><span id="l10.445">     let extStatusFlags =</span>
<a href="#l10.446"></a><span id="l10.446">       &quot;extStatusFlags&quot; in secInfo ? secInfo.extStatusFlags : 0;</span>
<a href="#l10.447"></a><span id="l10.447" class="difflineminus">-    let sMimeContainer, encryptedUINode, signedUINode;</span>
<a href="#l10.448"></a><span id="l10.448" class="difflineminus">-</span>
<a href="#l10.449"></a><span id="l10.449" class="difflineminus">-    if (secInfo.statusInfo) {</span>
<a href="#l10.450"></a><span id="l10.450" class="difflineminus">-      this.setStatusText(secInfo.statusInfo + &quot; &quot;);</span>
<a href="#l10.451"></a><span id="l10.451" class="difflineminus">-      //this.enigmailBox.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l10.452"></a><span id="l10.452" class="difflineplus">+    let cryptoContainer, encryptedUINode, signedUINode;</span>
<a href="#l10.453"></a><span id="l10.453"> </span>
<a href="#l10.454"></a><span id="l10.454" class="difflineminus">-      /*</span>
<a href="#l10.455"></a><span id="l10.455" class="difflineminus">-      if (</span>
<a href="#l10.456"></a><span id="l10.456" class="difflineminus">-        (secInfo.keyId &amp;&amp;</span>
<a href="#l10.457"></a><span id="l10.457" class="difflineminus">-          statusFlags &amp; EnigmailConstants.UNCERTAIN_SIGNATURE) ||</span>
<a href="#l10.458"></a><span id="l10.458" class="difflineminus">-        statusFlags &amp; EnigmailConstants.INLINE_KEY</span>
<a href="#l10.459"></a><span id="l10.459" class="difflineminus">-      ) {</span>
<a href="#l10.460"></a><span id="l10.460" class="difflineminus">-        document.getElementById(&quot;enigmail_importKey&quot;).removeAttribute(&quot;hidden&quot;);</span>
<a href="#l10.461"></a><span id="l10.461" class="difflineminus">-      } else {</span>
<a href="#l10.462"></a><span id="l10.462" class="difflineminus">-        document</span>
<a href="#l10.463"></a><span id="l10.463" class="difflineminus">-          .getElementById(&quot;enigmail_importKey&quot;)</span>
<a href="#l10.464"></a><span id="l10.464" class="difflineminus">-          .setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l10.465"></a><span id="l10.465" class="difflineminus">-      }</span>
<a href="#l10.466"></a><span id="l10.466" class="difflineminus">-      document</span>
<a href="#l10.467"></a><span id="l10.467" class="difflineminus">-        .getElementById(&quot;enigmail_flexActionButton&quot;)</span>
<a href="#l10.468"></a><span id="l10.468" class="difflineminus">-        .setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l10.469"></a><span id="l10.469" class="difflineminus">-      */</span>
<a href="#l10.470"></a><span id="l10.470" class="difflineminus">-    } else {</span>
<a href="#l10.471"></a><span id="l10.471" class="difflineminus">-      this.setStatusText(&quot;&quot;);</span>
<a href="#l10.472"></a><span id="l10.472" class="difflineminus">-      //this.enigmailBox.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l10.473"></a><span id="l10.473" class="difflineminus">-    }</span>
<a href="#l10.474"></a><span id="l10.474" class="difflineminus">-</span>
<a href="#l10.475"></a><span id="l10.475" class="difflineminus">-    sMimeContainer = gSMIMEContainer;</span>
<a href="#l10.476"></a><span id="l10.476" class="difflineplus">+    cryptoContainer = gCryptoContainer;</span>
<a href="#l10.477"></a><span id="l10.477">     signedUINode = gSignedUINode;</span>
<a href="#l10.478"></a><span id="l10.478">     encryptedUINode = gEncryptedUINode;</span>
<a href="#l10.479"></a><span id="l10.479"> </span>
<a href="#l10.480"></a><span id="l10.480" class="difflineminus">-    /* eslint block-scoped-var: 0*/</span>
<a href="#l10.481"></a><span id="l10.481" class="difflineminus">-    if (typeof sMimeContainer !== &quot;object&quot;) {</span>
<a href="#l10.482"></a><span id="l10.482" class="difflineminus">-      return;</span>
<a href="#l10.483"></a><span id="l10.483" class="difflineminus">-    }</span>
<a href="#l10.484"></a><span id="l10.484" class="difflineminus">-    if (!sMimeContainer) {</span>
<a href="#l10.485"></a><span id="l10.485" class="difflineminus">-      return;</span>
<a href="#l10.486"></a><span id="l10.486" class="difflineminus">-    }</span>
<a href="#l10.487"></a><span id="l10.487" class="difflineminus">-</span>
<a href="#l10.488"></a><span id="l10.488" class="difflineminus">-    // Update icons and header-box css-class</span>
<a href="#l10.489"></a><span id="l10.489" class="difflineminus">-    try {</span>
<a href="#l10.490"></a><span id="l10.490" class="difflineminus">-      sMimeContainer.collapsed = false;</span>
<a href="#l10.491"></a><span id="l10.491" class="difflineminus">-      signedUINode.collapsed = false;</span>
<a href="#l10.492"></a><span id="l10.492" class="difflineminus">-      encryptedUINode.collapsed = false;</span>
<a href="#l10.493"></a><span id="l10.493" class="difflineminus">-</span>
<a href="#l10.494"></a><span id="l10.494" class="difflineminus">-      if (</span>
<a href="#l10.495"></a><span id="l10.495" class="difflineminus">-        statusFlags &amp; EnigmailConstants.BAD_SIGNATURE &amp;&amp;</span>
<a href="#l10.496"></a><span id="l10.496" class="difflineminus">-        !(statusFlags &amp; EnigmailConstants.GOOD_SIGNATURE)</span>
<a href="#l10.497"></a><span id="l10.497" class="difflineminus">-      ) {</span>
<a href="#l10.498"></a><span id="l10.498" class="difflineminus">-        // Display untrusted/bad signature icon</span>
<a href="#l10.499"></a><span id="l10.499" class="difflineminus">-        signedUINode.setAttribute(&quot;signed&quot;, &quot;notok&quot;);</span>
<a href="#l10.500"></a><span id="l10.500" class="difflineminus">-        /*</span>
<a href="#l10.501"></a><span id="l10.501" class="difflineminus">-        this.enigmailBox.setAttribute(</span>
<a href="#l10.502"></a><span id="l10.502" class="difflineminus">-          &quot;class&quot;,</span>
<a href="#l10.503"></a><span id="l10.503" class="difflineminus">-          &quot;expandedEnigmailBox enigmailHeaderBoxLabelSignatureUnknown&quot;</span>
<a href="#l10.504"></a><span id="l10.504" class="difflineminus">-        );</span>
<a href="#l10.505"></a><span id="l10.505" class="difflineminus">-        */</span>
<a href="#l10.506"></a><span id="l10.506" class="difflineminus">-        this.isSigned = &quot;notok&quot;;</span>
<a href="#l10.507"></a><span id="l10.507" class="difflineminus">-      } else if (</span>
<a href="#l10.508"></a><span id="l10.508" class="difflineminus">-        statusFlags &amp; EnigmailConstants.GOOD_SIGNATURE &amp;&amp;</span>
<a href="#l10.509"></a><span id="l10.509" class="difflineminus">-        !(</span>
<a href="#l10.510"></a><span id="l10.510" class="difflineminus">-          statusFlags &amp;</span>
<a href="#l10.511"></a><span id="l10.511" class="difflineminus">-          (EnigmailConstants.REVOKED_KEY |</span>
<a href="#l10.512"></a><span id="l10.512" class="difflineminus">-            EnigmailConstants.EXPIRED_KEY_SIGNATURE |</span>
<a href="#l10.513"></a><span id="l10.513" class="difflineminus">-            EnigmailConstants.EXPIRED_SIGNATURE)</span>
<a href="#l10.514"></a><span id="l10.514" class="difflineminus">-        )</span>
<a href="#l10.515"></a><span id="l10.515" class="difflineminus">-      ) {</span>
<a href="#l10.516"></a><span id="l10.516" class="difflineminus">-        let val;</span>
<a href="#l10.517"></a><span id="l10.517" class="difflineminus">-        if (extStatusFlags &amp; EnigmailConstants.EXT_SELF_IDENTITY) {</span>
<a href="#l10.518"></a><span id="l10.518" class="difflineminus">-          val = &quot;ok&quot;;</span>
<a href="#l10.519"></a><span id="l10.519" class="difflineminus">-        } else if (statusFlags &amp; EnigmailConstants.TRUSTED_IDENTITY) {</span>
<a href="#l10.520"></a><span id="l10.520" class="difflineminus">-          val = &quot;verified&quot;;</span>
<a href="#l10.521"></a><span id="l10.521" class="difflineminus">-        } else {</span>
<a href="#l10.522"></a><span id="l10.522" class="difflineminus">-          val = &quot;unverified&quot;;</span>
<a href="#l10.523"></a><span id="l10.523" class="difflineminus">-        }</span>
<a href="#l10.524"></a><span id="l10.524" class="difflineminus">-</span>
<a href="#l10.525"></a><span id="l10.525" class="difflineminus">-        // Display trusted good signature icon</span>
<a href="#l10.526"></a><span id="l10.526" class="difflineminus">-        signedUINode.setAttribute(&quot;signed&quot;, val);</span>
<a href="#l10.527"></a><span id="l10.527" class="difflineminus">-        /*</span>
<a href="#l10.528"></a><span id="l10.528" class="difflineminus">-        this.enigmailBox.setAttribute(</span>
<a href="#l10.529"></a><span id="l10.529" class="difflineminus">-          &quot;class&quot;,</span>
<a href="#l10.530"></a><span id="l10.530" class="difflineminus">-          &quot;expandedEnigmailBox enigmailHeaderBoxLabelSignatureOk&quot;</span>
<a href="#l10.531"></a><span id="l10.531" class="difflineminus">-        );</span>
<a href="#l10.532"></a><span id="l10.532" class="difflineminus">-        */</span>
<a href="#l10.533"></a><span id="l10.533" class="difflineminus">-        this.isSigned = val;</span>
<a href="#l10.534"></a><span id="l10.534" class="difflineminus">-        bodyElement.setAttribute(&quot;enigSigned&quot;, val);</span>
<a href="#l10.535"></a><span id="l10.535" class="difflineminus">-      } else if (statusFlags &amp; EnigmailConstants.UNCERTAIN_SIGNATURE) {</span>
<a href="#l10.536"></a><span id="l10.536" class="difflineminus">-        // Display uncertain signature icon</span>
<a href="#l10.537"></a><span id="l10.537" class="difflineminus">-        signedUINode.setAttribute(&quot;signed&quot;, &quot;unknown&quot;);</span>
<a href="#l10.538"></a><span id="l10.538" class="difflineminus">-        /*</span>
<a href="#l10.539"></a><span id="l10.539" class="difflineminus">-        this.enigmailBox.setAttribute(</span>
<a href="#l10.540"></a><span id="l10.540" class="difflineminus">-          &quot;class&quot;,</span>
<a href="#l10.541"></a><span id="l10.541" class="difflineminus">-          &quot;expandedEnigmailBox enigmailHeaderBoxLabelSignatureUnknown&quot;</span>
<a href="#l10.542"></a><span id="l10.542" class="difflineminus">-        );</span>
<a href="#l10.543"></a><span id="l10.543" class="difflineminus">-        */</span>
<a href="#l10.544"></a><span id="l10.544" class="difflineminus">-        this.isSigned = &quot;unknown&quot;;</span>
<a href="#l10.545"></a><span id="l10.545" class="difflineminus">-      } else if (</span>
<a href="#l10.546"></a><span id="l10.546" class="difflineminus">-        statusFlags &amp;</span>
<a href="#l10.547"></a><span id="l10.547" class="difflineminus">-        (EnigmailConstants.REVOKED_KEY |</span>
<a href="#l10.548"></a><span id="l10.548" class="difflineminus">-          EnigmailConstants.EXPIRED_KEY_SIGNATURE |</span>
<a href="#l10.549"></a><span id="l10.549" class="difflineminus">-          EnigmailConstants.EXPIRED_SIGNATURE)</span>
<a href="#l10.550"></a><span id="l10.550" class="difflineminus">-      ) {</span>
<a href="#l10.551"></a><span id="l10.551" class="difflineminus">-        signedUINode.setAttribute(&quot;signed&quot;, &quot;notok&quot;);</span>
<a href="#l10.552"></a><span id="l10.552" class="difflineminus">-        /*</span>
<a href="#l10.553"></a><span id="l10.553" class="difflineminus">-        this.enigmailBox.setAttribute(</span>
<a href="#l10.554"></a><span id="l10.554" class="difflineminus">-          &quot;class&quot;,</span>
<a href="#l10.555"></a><span id="l10.555" class="difflineminus">-          &quot;expandedEnigmailBox enigmailHeaderBoxLabelSignatureVerified&quot;</span>
<a href="#l10.556"></a><span id="l10.556" class="difflineminus">-        );</span>
<a href="#l10.557"></a><span id="l10.557" class="difflineminus">-        */</span>
<a href="#l10.558"></a><span id="l10.558" class="difflineminus">-        this.isSigned = &quot;notok&quot;;</span>
<a href="#l10.559"></a><span id="l10.559" class="difflineminus">-      } else if (statusFlags &amp; EnigmailConstants.INLINE_KEY) {</span>
<a href="#l10.560"></a><span id="l10.560" class="difflineminus">-        /*</span>
<a href="#l10.561"></a><span id="l10.561" class="difflineminus">-        this.enigmailBox.setAttribute(</span>
<a href="#l10.562"></a><span id="l10.562" class="difflineminus">-          &quot;class&quot;,</span>
<a href="#l10.563"></a><span id="l10.563" class="difflineminus">-          &quot;expandedEnigmailBox enigmailHeaderBoxLabelSignatureUnknown&quot;</span>
<a href="#l10.564"></a><span id="l10.564" class="difflineminus">-        );</span>
<a href="#l10.565"></a><span id="l10.565" class="difflineminus">-        */</span>
<a href="#l10.566"></a><span id="l10.566" class="difflineminus">-      } else {</span>
<a href="#l10.567"></a><span id="l10.567" class="difflineminus">-        /*</span>
<a href="#l10.568"></a><span id="l10.568" class="difflineminus">-        this.enigmailBox.setAttribute(</span>
<a href="#l10.569"></a><span id="l10.569" class="difflineminus">-          &quot;class&quot;,</span>
<a href="#l10.570"></a><span id="l10.570" class="difflineminus">-          &quot;expandedEnigmailBox enigmailHeaderBoxLabelNoSignature&quot;</span>
<a href="#l10.571"></a><span id="l10.571" class="difflineminus">-        );</span>
<a href="#l10.572"></a><span id="l10.572" class="difflineminus">-        */</span>
<a href="#l10.573"></a><span id="l10.573" class="difflineminus">-      }</span>
<a href="#l10.574"></a><span id="l10.574" class="difflineplus">+    cryptoContainer.collapsed = false;</span>
<a href="#l10.575"></a><span id="l10.575" class="difflineplus">+    cryptoContainer.setAttribute(&quot;tech&quot;, &quot;OpenPGP&quot;);</span>
<a href="#l10.576"></a><span id="l10.576" class="difflineplus">+    signedUINode.collapsed = false;</span>
<a href="#l10.577"></a><span id="l10.577" class="difflineplus">+    encryptedUINode.collapsed = false;</span>
<a href="#l10.578"></a><span id="l10.578"> </span>
<a href="#l10.579"></a><span id="l10.579" class="difflineminus">-      if (statusFlags &amp; EnigmailConstants.DECRYPTION_OKAY) {</span>
<a href="#l10.580"></a><span id="l10.580" class="difflineminus">-        EnigmailURIs.rememberEncryptedUri(this.lastEncryptedMsgKey);</span>
<a href="#l10.581"></a><span id="l10.581" class="difflineminus">-</span>
<a href="#l10.582"></a><span id="l10.582" class="difflineminus">-        // Display encrypted icon</span>
<a href="#l10.583"></a><span id="l10.583" class="difflineminus">-        encryptedUINode.setAttribute(&quot;encrypted&quot;, &quot;ok&quot;);</span>
<a href="#l10.584"></a><span id="l10.584" class="difflineminus">-        this.isEncrypted = &quot;ok&quot;;</span>
<a href="#l10.585"></a><span id="l10.585" class="difflineminus">-      } else if (</span>
<a href="#l10.586"></a><span id="l10.586" class="difflineminus">-        statusFlags &amp;</span>
<a href="#l10.587"></a><span id="l10.587" class="difflineminus">-        (EnigmailConstants.DECRYPTION_INCOMPLETE |</span>
<a href="#l10.588"></a><span id="l10.588" class="difflineminus">-          EnigmailConstants.DECRYPTION_FAILED)</span>
<a href="#l10.589"></a><span id="l10.589" class="difflineminus">-      ) {</span>
<a href="#l10.590"></a><span id="l10.590" class="difflineminus">-        // Display un-encrypted icon</span>
<a href="#l10.591"></a><span id="l10.591" class="difflineminus">-        encryptedUINode.setAttribute(&quot;encrypted&quot;, &quot;notok&quot;);</span>
<a href="#l10.592"></a><span id="l10.592" class="difflineminus">-        this.isEncrypted = &quot;notok&quot;;</span>
<a href="#l10.593"></a><span id="l10.593" class="difflineminus">-        /*</span>
<a href="#l10.594"></a><span id="l10.594" class="difflineminus">-        this.enigmailBox.setAttribute(</span>
<a href="#l10.595"></a><span id="l10.595" class="difflineminus">-          &quot;class&quot;,</span>
<a href="#l10.596"></a><span id="l10.596" class="difflineminus">-          &quot;expandedEnigmailBox enigmailHeaderBoxLabelSignatureNotOk&quot;</span>
<a href="#l10.597"></a><span id="l10.597" class="difflineminus">-        );</span>
<a href="#l10.598"></a><span id="l10.598" class="difflineminus">-        */</span>
<a href="#l10.599"></a><span id="l10.599" class="difflineminus">-      }</span>
<a href="#l10.600"></a><span id="l10.600" class="difflineminus">-</span>
<a href="#l10.601"></a><span id="l10.601" class="difflineminus">-      // special handling after trying to fix buggy mail format (see buggyExchangeEmailContent in code)</span>
<a href="#l10.602"></a><span id="l10.602" class="difflineminus">-      if (secInfo.xtraStatus &amp;&amp; secInfo.xtraStatus == &quot;buggyMailFormat&quot;) {</span>
<a href="#l10.603"></a><span id="l10.603" class="difflineminus">-        /*</span>
<a href="#l10.604"></a><span id="l10.604" class="difflineminus">-        this.enigmailBox.setAttribute(</span>
<a href="#l10.605"></a><span id="l10.605" class="difflineminus">-          &quot;class&quot;,</span>
<a href="#l10.606"></a><span id="l10.606" class="difflineminus">-          &quot;expandedEnigmailBox enigmailHeaderBoxLabelBuggyMailFormat&quot;</span>
<a href="#l10.607"></a><span id="l10.607" class="difflineminus">-        );</span>
<a href="#l10.608"></a><span id="l10.608" class="difflineminus">-        */</span>
<a href="#l10.609"></a><span id="l10.609" class="difflineplus">+    if (</span>
<a href="#l10.610"></a><span id="l10.610" class="difflineplus">+      statusFlags &amp;</span>
<a href="#l10.611"></a><span id="l10.611" class="difflineplus">+      (EnigmailConstants.DECRYPTION_FAILED |</span>
<a href="#l10.612"></a><span id="l10.612" class="difflineplus">+        EnigmailConstants.DECRYPTION_INCOMPLETE)</span>
<a href="#l10.613"></a><span id="l10.613" class="difflineplus">+    ) {</span>
<a href="#l10.614"></a><span id="l10.614" class="difflineplus">+      encryptedUINode.setAttribute(&quot;encrypted&quot;, &quot;notok&quot;);</span>
<a href="#l10.615"></a><span id="l10.615" class="difflineplus">+      if (statusFlags &amp; EnigmailConstants.NO_SECKEY) {</span>
<a href="#l10.616"></a><span id="l10.616" class="difflineplus">+        this.msgEncryptionState = EnigmailConstants.MSG_ENC_NO_SECRET_KEY;</span>
<a href="#l10.617"></a><span id="l10.617" class="difflineplus">+      } else {</span>
<a href="#l10.618"></a><span id="l10.618" class="difflineplus">+        this.msgEncryptionState = EnigmailConstants.MSG_ENC_FAILURE;</span>
<a href="#l10.619"></a><span id="l10.619">       }</span>
<a href="#l10.620"></a><span id="l10.620" class="difflineminus">-    } catch (ex) {</span>
<a href="#l10.621"></a><span id="l10.621" class="difflineminus">-      EnigmailLog.writeException(&quot;displayStatusBar&quot;, ex);</span>
<a href="#l10.622"></a><span id="l10.622" class="difflineminus">-    }</span>
<a href="#l10.623"></a><span id="l10.623" class="difflineminus">-  },</span>
<a href="#l10.624"></a><span id="l10.624" class="difflineminus">-</span>
<a href="#l10.625"></a><span id="l10.625" class="difflineminus">-  dispSecurityContext() {</span>
<a href="#l10.626"></a><span id="l10.626" class="difflineminus">-    try {</span>
<a href="#l10.627"></a><span id="l10.627" class="difflineminus">-      if (Enigmail.msg.securityInfo) {</span>
<a href="#l10.628"></a><span id="l10.628" class="difflineminus">-        if (</span>
<a href="#l10.629"></a><span id="l10.629" class="difflineminus">-          Enigmail.msg.securityInfo.statusFlags &amp; EnigmailConstants.NODATA &amp;&amp;</span>
<a href="#l10.630"></a><span id="l10.630" class="difflineminus">-          Enigmail.msg.securityInfo.statusFlags &amp;</span>
<a href="#l10.631"></a><span id="l10.631" class="difflineminus">-            (EnigmailConstants.PGP_MIME_SIGNED |</span>
<a href="#l10.632"></a><span id="l10.632" class="difflineminus">-              EnigmailConstants.PGP_MIME_ENCRYPTED)</span>
<a href="#l10.633"></a><span id="l10.633" class="difflineminus">-        ) {</span>
<a href="#l10.634"></a><span id="l10.634" class="difflineminus">-          document</span>
<a href="#l10.635"></a><span id="l10.635" class="difflineminus">-            .getElementById(&quot;enigmail_reloadMessage&quot;)</span>
<a href="#l10.636"></a><span id="l10.636" class="difflineminus">-            .removeAttribute(&quot;hidden&quot;);</span>
<a href="#l10.637"></a><span id="l10.637" class="difflineminus">-        } else {</span>
<a href="#l10.638"></a><span id="l10.638" class="difflineminus">-          document</span>
<a href="#l10.639"></a><span id="l10.639" class="difflineminus">-            .getElementById(&quot;enigmail_reloadMessage&quot;)</span>
<a href="#l10.640"></a><span id="l10.640" class="difflineminus">-            .setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l10.641"></a><span id="l10.641" class="difflineminus">-        }</span>
<a href="#l10.642"></a><span id="l10.642" class="difflineminus">-      }</span>
<a href="#l10.643"></a><span id="l10.643" class="difflineminus">-</span>
<a href="#l10.644"></a><span id="l10.644" class="difflineminus">-      var optList = [&quot;pgpSecurityInfo&quot;, &quot;copySecurityInfo&quot;];</span>
<a href="#l10.645"></a><span id="l10.645" class="difflineminus">-      for (var j = 0; j &lt; optList.length; j++) {</span>
<a href="#l10.646"></a><span id="l10.646" class="difflineminus">-        var menuElement = document.getElementById(&quot;enigmail_&quot; + optList[j]);</span>
<a href="#l10.647"></a><span id="l10.647" class="difflineminus">-        if (Enigmail.msg.securityInfo) {</span>
<a href="#l10.648"></a><span id="l10.648" class="difflineminus">-          menuElement.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l10.649"></a><span id="l10.649" class="difflineminus">-        } else {</span>
<a href="#l10.650"></a><span id="l10.650" class="difflineminus">-          menuElement.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l10.651"></a><span id="l10.651" class="difflineminus">-        }</span>
<a href="#l10.652"></a><span id="l10.652" class="difflineminus">-      }</span>
<a href="#l10.653"></a><span id="l10.653" class="difflineminus">-</span>
<a href="#l10.654"></a><span id="l10.654" class="difflineminus">-      this.setSenderStatus(</span>
<a href="#l10.655"></a><span id="l10.655" class="difflineminus">-        &quot;signSenderKey&quot;,</span>
<a href="#l10.656"></a><span id="l10.656" class="difflineminus">-        &quot;editSenderKeyTrust&quot;,</span>
<a href="#l10.657"></a><span id="l10.657" class="difflineminus">-        &quot;showPhoto&quot;,</span>
<a href="#l10.658"></a><span id="l10.658" class="difflineminus">-        &quot;dispKeyDetails&quot;</span>
<a href="#l10.659"></a><span id="l10.659" class="difflineminus">-      );</span>
<a href="#l10.660"></a><span id="l10.660" class="difflineminus">-    } catch (ex) {</span>
<a href="#l10.661"></a><span id="l10.661" class="difflineminus">-      EnigmailLog.ERROR(</span>
<a href="#l10.662"></a><span id="l10.662" class="difflineminus">-        &quot;error on displaying Security menu:\n&quot; + ex.toString() + &quot;\n&quot;</span>
<a href="#l10.663"></a><span id="l10.663" class="difflineminus">-      );</span>
<a href="#l10.664"></a><span id="l10.664" class="difflineminus">-    }</span>
<a href="#l10.665"></a><span id="l10.665" class="difflineminus">-  },</span>
<a href="#l10.666"></a><span id="l10.666" class="difflineminus">-</span>
<a href="#l10.667"></a><span id="l10.667" class="difflineminus">-  updateSendersKeyMenu() {</span>
<a href="#l10.668"></a><span id="l10.668" class="difflineminus">-    this.setSenderStatus(</span>
<a href="#l10.669"></a><span id="l10.669" class="difflineminus">-      &quot;keyMgmtSignKey&quot;,</span>
<a href="#l10.670"></a><span id="l10.670" class="difflineminus">-      &quot;keyMgmtKeyTrust&quot;,</span>
<a href="#l10.671"></a><span id="l10.671" class="difflineminus">-      &quot;keyMgmtShowPhoto&quot;,</span>
<a href="#l10.672"></a><span id="l10.672" class="difflineminus">-      &quot;keyMgmtDispKeyDetails&quot;,</span>
<a href="#l10.673"></a><span id="l10.673" class="difflineminus">-      &quot;importpublickey&quot;</span>
<a href="#l10.674"></a><span id="l10.674" class="difflineminus">-    );</span>
<a href="#l10.675"></a><span id="l10.675" class="difflineminus">-  },</span>
<a href="#l10.676"></a><span id="l10.676" class="difflineminus">-</span>
<a href="#l10.677"></a><span id="l10.677" class="difflineminus">-  setSenderStatus(elemSign, elemTrust, elemPhoto, elemKeyProps, elemImportKey) {</span>
<a href="#l10.678"></a><span id="l10.678" class="difflineminus">-    function setElemStatus(elemName, disabledValue) {</span>
<a href="#l10.679"></a><span id="l10.679" class="difflineminus">-      document</span>
<a href="#l10.680"></a><span id="l10.680" class="difflineminus">-        .getElementById(&quot;enigmail_&quot; + elemName)</span>
<a href="#l10.681"></a><span id="l10.681" class="difflineminus">-        .setAttribute(&quot;disabled&quot;, !disabledValue);</span>
<a href="#l10.682"></a><span id="l10.682" class="difflineminus">-</span>
<a href="#l10.683"></a><span id="l10.683" class="difflineminus">-      let secondElem = document.getElementById(&quot;enigmail_&quot; + elemName + &quot;2&quot;);</span>
<a href="#l10.684"></a><span id="l10.684" class="difflineminus">-      if (secondElem) {</span>
<a href="#l10.685"></a><span id="l10.685" class="difflineminus">-        secondElem.setAttribute(&quot;disabled&quot;, !disabledValue);</span>
<a href="#l10.686"></a><span id="l10.686" class="difflineplus">+      this.msgSignatureState = EnigmailConstants.MSG_SIG_NONE;</span>
<a href="#l10.687"></a><span id="l10.687" class="difflineplus">+    } else if (statusFlags &amp; EnigmailConstants.DECRYPTION_OKAY) {</span>
<a href="#l10.688"></a><span id="l10.688" class="difflineplus">+      EnigmailURIs.rememberEncryptedUri(this.lastEncryptedMsgKey);</span>
<a href="#l10.689"></a><span id="l10.689" class="difflineplus">+      encryptedUINode.setAttribute(&quot;encrypted&quot;, &quot;ok&quot;);</span>
<a href="#l10.690"></a><span id="l10.690" class="difflineplus">+      this.msgEncryptionState = EnigmailConstants.MSG_ENC_OK;</span>
<a href="#l10.691"></a><span id="l10.691" class="difflineplus">+      if (secInfo.xtraStatus &amp;&amp; secInfo.xtraStatus == &quot;buggyMailFormat&quot;) {</span>
<a href="#l10.692"></a><span id="l10.692" class="difflineplus">+        console.log(EnigmailLocale.getString(&quot;decryptedMsgWithFormatError&quot;));</span>
<a href="#l10.693"></a><span id="l10.693">       }</span>
<a href="#l10.694"></a><span id="l10.694">     }</span>
<a href="#l10.695"></a><span id="l10.695"> </span>
<a href="#l10.696"></a><span id="l10.696" class="difflineminus">-    var photo = false;</span>
<a href="#l10.697"></a><span id="l10.697" class="difflineminus">-    var sign = false;</span>
<a href="#l10.698"></a><span id="l10.698" class="difflineminus">-    var trust = false;</span>
<a href="#l10.699"></a><span id="l10.699" class="difflineminus">-    var unknown = false;</span>
<a href="#l10.700"></a><span id="l10.700" class="difflineminus">-    var signedMsg = false;</span>
<a href="#l10.701"></a><span id="l10.701" class="difflineminus">-    var keyObj = null;</span>
<a href="#l10.702"></a><span id="l10.702" class="difflineminus">-</span>
<a href="#l10.703"></a><span id="l10.703" class="difflineminus">-    if (Enigmail.msg.securityInfo) {</span>
<a href="#l10.704"></a><span id="l10.704" class="difflineminus">-      if (</span>
<a href="#l10.705"></a><span id="l10.705" class="difflineminus">-        Enigmail.msg.securityInfo.statusFlags &amp;</span>
<a href="#l10.706"></a><span id="l10.706" class="difflineminus">-        EnigmailConstants.PHOTO_AVAILABLE</span>
<a href="#l10.707"></a><span id="l10.707" class="difflineminus">-      ) {</span>
<a href="#l10.708"></a><span id="l10.708" class="difflineminus">-        photo = true;</span>
<a href="#l10.709"></a><span id="l10.709" class="difflineplus">+    if (</span>
<a href="#l10.710"></a><span id="l10.710" class="difflineplus">+      statusFlags &amp;</span>
<a href="#l10.711"></a><span id="l10.711" class="difflineplus">+      (EnigmailConstants.BAD_SIGNATURE |</span>
<a href="#l10.712"></a><span id="l10.712" class="difflineplus">+        EnigmailConstants.REVOKED_KEY |</span>
<a href="#l10.713"></a><span id="l10.713" class="difflineplus">+        EnigmailConstants.EXPIRED_KEY_SIGNATURE |</span>
<a href="#l10.714"></a><span id="l10.714" class="difflineplus">+        EnigmailConstants.EXPIRED_SIGNATURE)</span>
<a href="#l10.715"></a><span id="l10.715" class="difflineplus">+    ) {</span>
<a href="#l10.716"></a><span id="l10.716" class="difflineplus">+      if (statusFlags &amp; EnigmailConstants.INVALID_RECIPIENT) {</span>
<a href="#l10.717"></a><span id="l10.717" class="difflineplus">+        this.msgSignatureState = EnigmailConstants.MSG_SIG_INVALID_KEY_REJECTED;</span>
<a href="#l10.718"></a><span id="l10.718" class="difflineplus">+      } else {</span>
<a href="#l10.719"></a><span id="l10.719" class="difflineplus">+        this.msgSignatureState = EnigmailConstants.MSG_SIG_INVALID;</span>
<a href="#l10.720"></a><span id="l10.720">       }</span>
<a href="#l10.721"></a><span id="l10.721" class="difflineminus">-      if (Enigmail.msg.securityInfo.keyId) {</span>
<a href="#l10.722"></a><span id="l10.722" class="difflineminus">-        keyObj = EnigmailKeyRing.getKeyById(Enigmail.msg.securityInfo.keyId);</span>
<a href="#l10.723"></a><span id="l10.723" class="difflineplus">+      signedUINode.setAttribute(&quot;signed&quot;, &quot;notok&quot;);</span>
<a href="#l10.724"></a><span id="l10.724" class="difflineplus">+    } else if (statusFlags &amp; EnigmailConstants.GOOD_SIGNATURE) {</span>
<a href="#l10.725"></a><span id="l10.725" class="difflineplus">+      let val;</span>
<a href="#l10.726"></a><span id="l10.726" class="difflineplus">+      if (statusFlags &amp; EnigmailConstants.TRUSTED_IDENTITY) {</span>
<a href="#l10.727"></a><span id="l10.727" class="difflineplus">+        this.msgSignatureState = EnigmailConstants.MSG_SIG_VALID_KEY_VERIFIED;</span>
<a href="#l10.728"></a><span id="l10.728" class="difflineplus">+        val = &quot;verified&quot;;</span>
<a href="#l10.729"></a><span id="l10.729" class="difflineplus">+      } else if (extStatusFlags &amp; EnigmailConstants.EXT_SELF_IDENTITY) {</span>
<a href="#l10.730"></a><span id="l10.730" class="difflineplus">+        val = &quot;ok&quot;;</span>
<a href="#l10.731"></a><span id="l10.731" class="difflineplus">+        this.msgSignatureState = EnigmailConstants.MSG_SIG_VALID_SELF;</span>
<a href="#l10.732"></a><span id="l10.732" class="difflineplus">+      } else {</span>
<a href="#l10.733"></a><span id="l10.733" class="difflineplus">+        val = &quot;unverified&quot;;</span>
<a href="#l10.734"></a><span id="l10.734" class="difflineplus">+        this.msgSignatureState = EnigmailConstants.MSG_SIG_VALID_KEY_UNVERIFIED;</span>
<a href="#l10.735"></a><span id="l10.735">       }</span>
<a href="#l10.736"></a><span id="l10.736" class="difflineminus">-      if (Enigmail.msg.securityInfo.msgSigned) {</span>
<a href="#l10.737"></a><span id="l10.737" class="difflineminus">-        signedMsg = true;</span>
<a href="#l10.738"></a><span id="l10.738" class="difflineminus">-        if (</span>
<a href="#l10.739"></a><span id="l10.739" class="difflineminus">-          !(</span>
<a href="#l10.740"></a><span id="l10.740" class="difflineminus">-            Enigmail.msg.securityInfo.statusFlags &amp;</span>
<a href="#l10.741"></a><span id="l10.741" class="difflineminus">-            (EnigmailConstants.REVOKED_KEY |</span>
<a href="#l10.742"></a><span id="l10.742" class="difflineminus">-              EnigmailConstants.EXPIRED_KEY_SIGNATURE |</span>
<a href="#l10.743"></a><span id="l10.743" class="difflineminus">-              EnigmailConstants.UNCERTAIN_SIGNATURE)</span>
<a href="#l10.744"></a><span id="l10.744" class="difflineminus">-          )</span>
<a href="#l10.745"></a><span id="l10.745" class="difflineminus">-        ) {</span>
<a href="#l10.746"></a><span id="l10.746" class="difflineminus">-          sign = true;</span>
<a href="#l10.747"></a><span id="l10.747" class="difflineminus">-        }</span>
<a href="#l10.748"></a><span id="l10.748" class="difflineminus">-        if (keyObj &amp;&amp; keyObj.isOwnerTrustUseful()) {</span>
<a href="#l10.749"></a><span id="l10.749" class="difflineminus">-          trust = true;</span>
<a href="#l10.750"></a><span id="l10.750" class="difflineminus">-        }</span>
<a href="#l10.751"></a><span id="l10.751" class="difflineplus">+      signedUINode.setAttribute(&quot;signed&quot;, val);</span>
<a href="#l10.752"></a><span id="l10.752" class="difflineplus">+    } else if (statusFlags &amp; EnigmailConstants.UNCERTAIN_SIGNATURE) {</span>
<a href="#l10.753"></a><span id="l10.753" class="difflineplus">+      if (statusFlags &amp; EnigmailConstants.INVALID_RECIPIENT) {</span>
<a href="#l10.754"></a><span id="l10.754" class="difflineplus">+        this.msgSignatureState =</span>
<a href="#l10.755"></a><span id="l10.755" class="difflineplus">+          EnigmailConstants.MSG_SIG_UNCERTAIN_UID_MISMATCH;</span>
<a href="#l10.756"></a><span id="l10.756" class="difflineplus">+      } else if (statusFlags &amp; EnigmailConstants.NO_PUBKEY) {</span>
<a href="#l10.757"></a><span id="l10.757" class="difflineplus">+        this.msgSignatureState =</span>
<a href="#l10.758"></a><span id="l10.758" class="difflineplus">+          EnigmailConstants.MSG_SIG_UNCERTAIN_KEY_UNAVAILABLE;</span>
<a href="#l10.759"></a><span id="l10.759" class="difflineplus">+        let b = document.getElementById(&quot;signatureKeyBox&quot;);</span>
<a href="#l10.760"></a><span id="l10.760" class="difflineplus">+        b.setAttribute(&quot;hidden&quot;, false);</span>
<a href="#l10.761"></a><span id="l10.761" class="difflineplus">+        b.setAttribute(&quot;keyid&quot;, secInfo.keyId);</span>
<a href="#l10.762"></a><span id="l10.762" class="difflineplus">+      } else {</span>
<a href="#l10.763"></a><span id="l10.763" class="difflineplus">+        this.msgSignatureState =</span>
<a href="#l10.764"></a><span id="l10.764" class="difflineplus">+          EnigmailConstants.MSG_SIG_UNCERTAIN_KEY_NOT_ACCEPTED;</span>
<a href="#l10.765"></a><span id="l10.765" class="difflineplus">+      }</span>
<a href="#l10.766"></a><span id="l10.766" class="difflineplus">+      signedUINode.setAttribute(&quot;signed&quot;, &quot;mismatch&quot;);</span>
<a href="#l10.767"></a><span id="l10.767" class="difflineplus">+    }</span>
<a href="#l10.768"></a><span id="l10.768" class="difflineplus">+    // (statusFlags &amp; EnigmailConstants.INLINE_KEY) ???</span>
<a href="#l10.769"></a><span id="l10.769"> </span>
<a href="#l10.770"></a><span id="l10.770" class="difflineminus">-        if (</span>
<a href="#l10.771"></a><span id="l10.771" class="difflineminus">-          Enigmail.msg.securityInfo.statusFlags &amp;</span>
<a href="#l10.772"></a><span id="l10.772" class="difflineminus">-          EnigmailConstants.UNCERTAIN_SIGNATURE</span>
<a href="#l10.773"></a><span id="l10.773" class="difflineminus">-        ) {</span>
<a href="#l10.774"></a><span id="l10.774" class="difflineminus">-          unknown = true;</span>
<a href="#l10.775"></a><span id="l10.775" class="difflineminus">-        }</span>
<a href="#l10.776"></a><span id="l10.776" class="difflineminus">-      }</span>
<a href="#l10.777"></a><span id="l10.777" class="difflineminus">-    }</span>
<a href="#l10.778"></a><span id="l10.778" class="difflineminus">-</span>
<a href="#l10.779"></a><span id="l10.779" class="difflineminus">-    if (elemTrust) {</span>
<a href="#l10.780"></a><span id="l10.780" class="difflineminus">-      setElemStatus(elemTrust, trust);</span>
<a href="#l10.781"></a><span id="l10.781" class="difflineplus">+    /*</span>
<a href="#l10.782"></a><span id="l10.782" class="difflineplus">+    // special handling after trying to fix buggy mail format (see buggyExchangeEmailContent in code)</span>
<a href="#l10.783"></a><span id="l10.783" class="difflineplus">+    if (secInfo.xtraStatus &amp;&amp; secInfo.xtraStatus == &quot;buggyMailFormat&quot;) {</span>
<a href="#l10.784"></a><span id="l10.784">     }</span>
<a href="#l10.785"></a><span id="l10.785" class="difflineminus">-    if (elemSign) {</span>
<a href="#l10.786"></a><span id="l10.786" class="difflineminus">-      setElemStatus(elemSign, sign);</span>
<a href="#l10.787"></a><span id="l10.787" class="difflineminus">-    }</span>
<a href="#l10.788"></a><span id="l10.788" class="difflineminus">-    if (elemPhoto) {</span>
<a href="#l10.789"></a><span id="l10.789" class="difflineminus">-      setElemStatus(elemPhoto, photo);</span>
<a href="#l10.790"></a><span id="l10.790" class="difflineminus">-    }</span>
<a href="#l10.791"></a><span id="l10.791" class="difflineminus">-    if (elemKeyProps) {</span>
<a href="#l10.792"></a><span id="l10.792" class="difflineminus">-      setElemStatus(elemKeyProps, signedMsg &amp;&amp; !unknown);</span>
<a href="#l10.793"></a><span id="l10.793" class="difflineminus">-    }</span>
<a href="#l10.794"></a><span id="l10.794" class="difflineminus">-    if (elemImportKey) {</span>
<a href="#l10.795"></a><span id="l10.795" class="difflineminus">-      setElemStatus(elemImportKey, unknown);</span>
<a href="#l10.796"></a><span id="l10.796" class="difflineminus">-    }</span>
<a href="#l10.797"></a><span id="l10.797" class="difflineplus">+    */</span>
<a href="#l10.798"></a><span id="l10.798">   },</span>
<a href="#l10.799"></a><span id="l10.799"> </span>
<a href="#l10.800"></a><span id="l10.800">   editKeyExpiry() {</span>
<a href="#l10.801"></a><span id="l10.801">     EnigmailWindows.editKeyExpiry(</span>
<a href="#l10.802"></a><span id="l10.802">       window,</span>
<a href="#l10.803"></a><span id="l10.803">       [Enigmail.msg.securityInfo.userId],</span>
<a href="#l10.804"></a><span id="l10.804">       [Enigmail.msg.securityInfo.keyId]</span>
<a href="#l10.805"></a><span id="l10.805">     );</span>
<a href="#l10.806"></a><span id="l10.806" class="difflineat">@@ -963,35 +658,27 @@ Enigmail.hdrView = {</span>
<a href="#l10.807"></a><span id="l10.807">     );</span>
<a href="#l10.808"></a><span id="l10.808">     gDBView.reloadMessageWithAllParts();</span>
<a href="#l10.809"></a><span id="l10.809">   },</span>
<a href="#l10.810"></a><span id="l10.810"> </span>
<a href="#l10.811"></a><span id="l10.811">   msgHdrViewLoad() {</span>
<a href="#l10.812"></a><span id="l10.812">     EnigmailLog.DEBUG(&quot;enigmailMsgHdrViewOverlay.js: this.msgHdrViewLoad\n&quot;);</span>
<a href="#l10.813"></a><span id="l10.813"> </span>
<a href="#l10.814"></a><span id="l10.814">     this.messageListener = {</span>
<a href="#l10.815"></a><span id="l10.815" class="difflineminus">-      //enigmailBox: document.getElementById(&quot;enigmailBox&quot;),</span>
<a href="#l10.816"></a><span id="l10.816">       onStartHeaders() {</span>
<a href="#l10.817"></a><span id="l10.817">         EnigmailLog.DEBUG(</span>
<a href="#l10.818"></a><span id="l10.818">           &quot;enigmailMsgHdrViewOverlay.js: _listener_onStartHeaders\n&quot;</span>
<a href="#l10.819"></a><span id="l10.819">         );</span>
<a href="#l10.820"></a><span id="l10.820"> </span>
<a href="#l10.821"></a><span id="l10.821">         try {</span>
<a href="#l10.822"></a><span id="l10.822">           Enigmail.hdrView.statusBarHide();</span>
<a href="#l10.823"></a><span id="l10.823">           EnigmailVerify.setMsgWindow(</span>
<a href="#l10.824"></a><span id="l10.824">             msgWindow,</span>
<a href="#l10.825"></a><span id="l10.825">             Enigmail.msg.getCurrentMsgUriSpec()</span>
<a href="#l10.826"></a><span id="l10.826">           );</span>
<a href="#l10.827"></a><span id="l10.827" class="difflineminus">-          Enigmail.hdrView.setStatusText(&quot;&quot;);</span>
<a href="#l10.828"></a><span id="l10.828" class="difflineminus">-          /*</span>
<a href="#l10.829"></a><span id="l10.829" class="difflineminus">-          this.enigmailBox.setAttribute(</span>
<a href="#l10.830"></a><span id="l10.830" class="difflineminus">-            &quot;class&quot;,</span>
<a href="#l10.831"></a><span id="l10.831" class="difflineminus">-            &quot;expandedEnigmailBox enigmailHeaderBoxLabelSignatureOk&quot;</span>
<a href="#l10.832"></a><span id="l10.832" class="difflineminus">-          );</span>
<a href="#l10.833"></a><span id="l10.833" class="difflineminus">-          */</span>
<a href="#l10.834"></a><span id="l10.834"> </span>
<a href="#l10.835"></a><span id="l10.835">           let msgFrame = document.getElementById(&quot;messagepane&quot;).contentDocument;</span>
<a href="#l10.836"></a><span id="l10.836"> </span>
<a href="#l10.837"></a><span id="l10.837">           if (msgFrame) {</span>
<a href="#l10.838"></a><span id="l10.838">             msgFrame.addEventListener(</span>
<a href="#l10.839"></a><span id="l10.839">               &quot;unload&quot;,</span>
<a href="#l10.840"></a><span id="l10.840">               Enigmail.hdrView.messageUnload.bind(Enigmail.hdrView),</span>
<a href="#l10.841"></a><span id="l10.841">               true</span>
<a href="#l10.842"></a><span id="l10.842" class="difflineat">@@ -1012,22 +699,16 @@ Enigmail.hdrView = {</span>
<a href="#l10.843"></a><span id="l10.843"> </span>
<a href="#l10.844"></a><span id="l10.844">       onEndHeaders() {</span>
<a href="#l10.845"></a><span id="l10.845">         EnigmailLog.DEBUG(</span>
<a href="#l10.846"></a><span id="l10.846">           &quot;enigmailMsgHdrViewOverlay.js: _listener_onEndHeaders\n&quot;</span>
<a href="#l10.847"></a><span id="l10.847">         );</span>
<a href="#l10.848"></a><span id="l10.848"> </span>
<a href="#l10.849"></a><span id="l10.849">         try {</span>
<a href="#l10.850"></a><span id="l10.850">           Enigmail.hdrView.statusBarHide();</span>
<a href="#l10.851"></a><span id="l10.851" class="difflineminus">-          /*</span>
<a href="#l10.852"></a><span id="l10.852" class="difflineminus">-          this.enigmailBox.setAttribute(</span>
<a href="#l10.853"></a><span id="l10.853" class="difflineminus">-            &quot;class&quot;,</span>
<a href="#l10.854"></a><span id="l10.854" class="difflineminus">-            &quot;expandedEnigmailBox enigmailHeaderBoxLabelSignatureOk&quot;</span>
<a href="#l10.855"></a><span id="l10.855" class="difflineminus">-          );</span>
<a href="#l10.856"></a><span id="l10.856" class="difflineminus">-          */</span>
<a href="#l10.857"></a><span id="l10.857">         } catch (ex) {}</span>
<a href="#l10.858"></a><span id="l10.858">       },</span>
<a href="#l10.859"></a><span id="l10.859"> </span>
<a href="#l10.860"></a><span id="l10.860">       beforeStartHeaders() {</span>
<a href="#l10.861"></a><span id="l10.861">         return true;</span>
<a href="#l10.862"></a><span id="l10.862">       },</span>
<a href="#l10.863"></a><span id="l10.863">     };</span>
<a href="#l10.864"></a><span id="l10.864"> </span>
<a href="#l10.865"></a><span id="l10.865" class="difflineat">@@ -1050,24 +731,16 @@ Enigmail.hdrView = {</span>
<a href="#l10.866"></a><span id="l10.866"> </span>
<a href="#l10.867"></a><span id="l10.867">   messageLoad(event) {</span>
<a href="#l10.868"></a><span id="l10.868">     EnigmailLog.DEBUG(&quot;enigmailMsgHdrViewOverlay.js: this.messageLoad\n&quot;);</span>
<a href="#l10.869"></a><span id="l10.869"> </span>
<a href="#l10.870"></a><span id="l10.870">     Enigmail.msg.messageAutoDecrypt();</span>
<a href="#l10.871"></a><span id="l10.871">     Enigmail.msg.handleAttchmentEvent();</span>
<a href="#l10.872"></a><span id="l10.872">   },</span>
<a href="#l10.873"></a><span id="l10.873"> </span>
<a href="#l10.874"></a><span id="l10.874" class="difflineminus">-  copyStatusInfo() {</span>
<a href="#l10.875"></a><span id="l10.875" class="difflineminus">-    if (Enigmail.msg.securityInfo) {</span>
<a href="#l10.876"></a><span id="l10.876" class="difflineminus">-      EnigmailClipboard.setClipboardContent(</span>
<a href="#l10.877"></a><span id="l10.877" class="difflineminus">-        Enigmail.msg.securityInfo.statusInfo</span>
<a href="#l10.878"></a><span id="l10.878" class="difflineminus">-      );</span>
<a href="#l10.879"></a><span id="l10.879" class="difflineminus">-    }</span>
<a href="#l10.880"></a><span id="l10.880" class="difflineminus">-  },</span>
<a href="#l10.881"></a><span id="l10.881" class="difflineminus">-</span>
<a href="#l10.882"></a><span id="l10.882">   showPhoto() {</span>
<a href="#l10.883"></a><span id="l10.883">     if (!Enigmail.msg.securityInfo) {</span>
<a href="#l10.884"></a><span id="l10.884">       return;</span>
<a href="#l10.885"></a><span id="l10.885">     }</span>
<a href="#l10.886"></a><span id="l10.886"> </span>
<a href="#l10.887"></a><span id="l10.887">     let key = EnigmailKeyRing.getKeyById(Enigmail.msg.securityInfo.keyId);</span>
<a href="#l10.888"></a><span id="l10.888"> </span>
<a href="#l10.889"></a><span id="l10.889">     EnigmailWindows.showPhoto(</span>
<a href="#l10.890"></a><span id="l10.890" class="difflineat">@@ -1198,17 +871,17 @@ Enigmail.hdrView = {</span>
<a href="#l10.891"></a><span id="l10.891">     EnigmailLog.DEBUG(&quot;enigmailMsgHdrViewOverlay.js: this.updateMsgDb\n&quot;);</span>
<a href="#l10.892"></a><span id="l10.892">     var msg = gFolderDisplay.selectedMessage;</span>
<a href="#l10.893"></a><span id="l10.893">     if (!msg || !msg.folder) {</span>
<a href="#l10.894"></a><span id="l10.894">       return;</span>
<a href="#l10.895"></a><span id="l10.895">     }</span>
<a href="#l10.896"></a><span id="l10.896"> </span>
<a href="#l10.897"></a><span id="l10.897">     var msgHdr = msg.folder.GetMessageHeader(msg.messageKey);</span>
<a href="#l10.898"></a><span id="l10.898"> </span>
<a href="#l10.899"></a><span id="l10.899" class="difflineminus">-    if (this.isEncrypted === &quot;ok&quot;) {</span>
<a href="#l10.900"></a><span id="l10.900" class="difflineplus">+    if (this.msgEncryptionState === EnigmailConstants.MSG_ENC_OK) {</span>
<a href="#l10.901"></a><span id="l10.901">       Enigmail.msg.securityInfo.statusFlags |=</span>
<a href="#l10.902"></a><span id="l10.902">         EnigmailConstants.DECRYPTION_OKAY;</span>
<a href="#l10.903"></a><span id="l10.903">     }</span>
<a href="#l10.904"></a><span id="l10.904">     msgHdr.setUint32Property(&quot;enigmail&quot;, Enigmail.msg.securityInfo.statusFlags);</span>
<a href="#l10.905"></a><span id="l10.905">   },</span>
<a href="#l10.906"></a><span id="l10.906"> </span>
<a href="#l10.907"></a><span id="l10.907">   enigCanDetachAttachments() {</span>
<a href="#l10.908"></a><span id="l10.908">     EnigmailLog.DEBUG(</span>
<a href="#l10.909"></a><span id="l10.909" class="difflineat">@@ -1672,16 +1345,17 @@ Enigmail.hdrView = {</span>
<a href="#l10.910"></a><span id="l10.910">       return this._smimeHeaderSink.encryptionStatus(</span>
<a href="#l10.911"></a><span id="l10.911">         aNestingLevel,</span>
<a href="#l10.912"></a><span id="l10.912">         aEncryptionStatus,</span>
<a href="#l10.913"></a><span id="l10.913">         aRecipientCert</span>
<a href="#l10.914"></a><span id="l10.914">       );</span>
<a href="#l10.915"></a><span id="l10.915">     },</span>
<a href="#l10.916"></a><span id="l10.916">   },</span>
<a href="#l10.917"></a><span id="l10.917"> </span>
<a href="#l10.918"></a><span id="l10.918" class="difflineplus">+  /*</span>
<a href="#l10.919"></a><span id="l10.919">   onUnloadEnigmail() {</span>
<a href="#l10.920"></a><span id="l10.920">     window.removeEventListener(&quot;load-enigmail&quot;, Enigmail.hdrView.hdrViewLoad);</span>
<a href="#l10.921"></a><span id="l10.921">     for (let i = 0; i &lt; gMessageListeners.length; i++) {</span>
<a href="#l10.922"></a><span id="l10.922">       if (gMessageListeners[i] === Enigmail.hdrView.messageListener) {</span>
<a href="#l10.923"></a><span id="l10.923">         gMessageListeners.splice(i, 1);</span>
<a href="#l10.924"></a><span id="l10.924">         break;</span>
<a href="#l10.925"></a><span id="l10.925">       }</span>
<a href="#l10.926"></a><span id="l10.926">     }</span>
<a href="#l10.927"></a><span id="l10.927" class="difflineat">@@ -1725,14 +1399,15 @@ Enigmail.hdrView = {</span>
<a href="#l10.928"></a><span id="l10.928">         Enigmail.hdrView.messageUnload,</span>
<a href="#l10.929"></a><span id="l10.929">         true</span>
<a href="#l10.930"></a><span id="l10.930">       );</span>
<a href="#l10.931"></a><span id="l10.931">       msgFrame.removeEventListener(&quot;load&quot;, Enigmail.hdrView.messageLoad);</span>
<a href="#l10.932"></a><span id="l10.932">     }</span>
<a href="#l10.933"></a><span id="l10.933"> </span>
<a href="#l10.934"></a><span id="l10.934">     CanDetachAttachments = Enigmail.hdrView.origCanDetachAttachments;</span>
<a href="#l10.935"></a><span id="l10.935">   },</span>
<a href="#l10.936"></a><span id="l10.936" class="difflineplus">+  */</span>
<a href="#l10.937"></a><span id="l10.937"> };</span>
<a href="#l10.938"></a><span id="l10.938"> </span>
<a href="#l10.939"></a><span id="l10.939"> window.addEventListener(</span>
<a href="#l10.940"></a><span id="l10.940">   &quot;load-enigmail&quot;,</span>
<a href="#l10.941"></a><span id="l10.941">   Enigmail.hdrView.hdrViewLoad.bind(Enigmail.hdrView)</span>
<a href="#l10.942"></a><span id="l10.942"> );</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/msgReadStatus.js</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,185 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+var { EnigmailConstants } = ChromeUtils.import(</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+  &quot;chrome://openpgp/content/modules/constants.jsm&quot;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+var { EnigmailWindows } = ChromeUtils.import(</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+  &quot;chrome://openpgp/content/modules/windows.jsm&quot;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+);</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+var { EnigmailKeyRing } = ChromeUtils.import(</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+  &quot;chrome://openpgp/content/modules/keyRing.jsm&quot;</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+);</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+let gSigKeyId;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+let gEncKeyId;</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+function setText(id, value) {</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+  var element = document.getElementById(id);</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+  if (!element) {</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+    return;</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+  }</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+  if (element.hasChildNodes()) {</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+    element.firstElementChild.remove();</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+  }</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+  var textNode = document.createTextNode(value);</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+  element.appendChild(textNode);</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+}</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+/* eslint-disable complexity */</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+function onLoad() {</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+  let params = window.arguments[0];</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+  var sBundle = document.getElementById(&quot;bundle_smime_read_info&quot;);</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+  var oBundle = document.getElementById(&quot;bundle_openpgp_read_info&quot;);</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+  if (!sBundle || !oBundle) {</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+    return;</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+  }</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineplus">+  var hasAnySig = true;</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+  var hasAnyEnc = true;</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+  var sigInfoLabel = null;</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+  var sigInfo = null;</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+  switch (params.msgSignatureState) {</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+    case EnigmailConstants.MSG_SIG_NONE:</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+      sigInfoLabel = oBundle.getString(&quot;NoSig&quot;);</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+      sigInfo = sBundle.getString(&quot;SINone&quot;);</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+      hasAnySig = false;</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+      break;</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineplus">+</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+    case EnigmailConstants.MSG_SIG_UNCERTAIN_KEY_UNAVAILABLE:</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+      sigInfoLabel = oBundle.getString(&quot;UncertainSig&quot;);</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineplus">+      sigInfo = oBundle.getString(&quot;SigUncertainNoKey&quot;);</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineplus">+      break;</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineplus">+</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineplus">+    case EnigmailConstants.MSG_SIG_UNCERTAIN_UID_MISMATCH:</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineplus">+      sigInfoLabel = oBundle.getString(&quot;UncertainSig&quot;);</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineplus">+      sigInfo = oBundle.getString(&quot;SigUncertainUidMismatch&quot;);</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineplus">+      break;</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineplus">+</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+    case EnigmailConstants.MSG_SIG_UNCERTAIN_KEY_NOT_ACCEPTED:</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineplus">+      sigInfoLabel = oBundle.getString(&quot;UncertainSig&quot;);</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineplus">+      sigInfo = oBundle.getString(&quot;SigUncertainNotAccepted&quot;);</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+      break;</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+    case EnigmailConstants.MSG_SIG_INVALID_KEY_REJECTED:</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+      sigInfoLabel = oBundle.getString(&quot;InvalidSig&quot;);</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineplus">+      sigInfo = oBundle.getString(&quot;SigInvalidRejected&quot;);</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineplus">+      break;</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineplus">+</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineplus">+    case EnigmailConstants.MSG_SIG_INVALID:</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineplus">+      sigInfoLabel = oBundle.getString(&quot;InvalidSig&quot;);</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineplus">+      sigInfo = oBundle.getString(&quot;SigInvalidTechnicalProblem&quot;);</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineplus">+      break;</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineplus">+</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineplus">+    case EnigmailConstants.MSG_SIG_VALID_KEY_UNVERIFIED:</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineplus">+      sigInfoLabel = oBundle.getString(&quot;GoodSig&quot;);</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineplus">+      sigInfo = oBundle.getString(&quot;SigValidUnverified&quot;);</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+      break;</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineplus">+    case EnigmailConstants.MSG_SIG_VALID_KEY_VERIFIED:</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+      sigInfoLabel = oBundle.getString(&quot;GoodSig&quot;);</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineplus">+      sigInfo = oBundle.getString(&quot;SigValidVerified&quot;);</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+      break;</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+    case EnigmailConstants.MSG_SIG_VALID_SELF:</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineplus">+      sigInfoLabel = oBundle.getString(&quot;GoodSig&quot;);</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineplus">+      sigInfo = oBundle.getString(&quot;SigValidOwnKey&quot;);</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineplus">+      break;</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineplus">+</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineplus">+    default:</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineplus">+      Cu.reportError(</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineplus">+        &quot;Unexpected msgSignatureState: &quot; + params.msgSignatureState</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineplus">+      );</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineplus">+  }</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineplus">+</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineplus">+  document.getElementById(&quot;signatureLabel&quot;).value = sigInfoLabel;</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineplus">+  setText(&quot;signatureExplanation&quot;, sigInfo);</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineplus">+</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineplus">+  var encInfoLabel = null;</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineplus">+  var encInfo = null;</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineplus">+</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineplus">+  switch (params.msgEncryptionState) {</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineplus">+    case EnigmailConstants.MSG_ENC_NONE:</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineplus">+      encInfoLabel = sBundle.getString(&quot;EINoneLabel2&quot;);</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineplus">+      encInfo = sBundle.getString(&quot;EINone&quot;);</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineplus">+      hasAnyEnc = false;</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineplus">+      break;</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineplus">+</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineplus">+    case EnigmailConstants.MSG_ENC_NO_SECRET_KEY:</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineplus">+      encInfoLabel = sBundle.getString(&quot;EIInvalidLabel&quot;);</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineplus">+      encInfo = sBundle.getString(&quot;EIInvalidHeader&quot;);</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineplus">+      break;</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineplus">+</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineplus">+    case EnigmailConstants.MSG_ENC_FAILURE:</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineplus">+      encInfoLabel = sBundle.getString(&quot;EIInvalidLabel&quot;);</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineplus">+      encInfo = sBundle.getString(&quot;EIClueless&quot;);</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineplus">+      break;</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineplus">+</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineplus">+    case EnigmailConstants.MSG_ENC_OK:</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineplus">+      encInfoLabel = sBundle.getString(&quot;EIValidLabel&quot;);</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineplus">+      encInfo = sBundle.getString(&quot;EIValid&quot;);</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineplus">+      break;</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineplus">+</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineplus">+    default:</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineplus">+      Cu.reportError(</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineplus">+        &quot;Unexpected msgEncryptionState: &quot; + params.msgEncryptionState</span>
<a href="#l11.137"></a><span id="l11.137" class="difflineplus">+      );</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineplus">+  }</span>
<a href="#l11.139"></a><span id="l11.139" class="difflineplus">+</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineplus">+  if (hasAnyEnc || hasAnySig) {</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineplus">+    document.getElementById(&quot;techLabel&quot;).collapsed = false;</span>
<a href="#l11.142"></a><span id="l11.142" class="difflineplus">+  }</span>
<a href="#l11.143"></a><span id="l11.143" class="difflineplus">+</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineplus">+  document.getElementById(&quot;encryptionLabel&quot;).value = encInfoLabel;</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineplus">+  setText(&quot;encryptionExplanation&quot;, encInfo);</span>
<a href="#l11.146"></a><span id="l11.146" class="difflineplus">+</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineplus">+  if (params.msgSignatureKeyId) {</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineplus">+    let idElement = document.getElementById(&quot;signatureKeyId&quot;);</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineplus">+    idElement.collapsed = false;</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineplus">+    idElement.value = oBundle.getFormattedString(&quot;SigKeyId&quot;, [</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineplus">+      &quot;0x&quot; + params.msgSignatureKeyId,</span>
<a href="#l11.152"></a><span id="l11.152" class="difflineplus">+    ]);</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineplus">+</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineplus">+    if (EnigmailKeyRing.getKeyById(params.msgSignatureKeyId)) {</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineplus">+      document.getElementById(&quot;viewSignatureKey&quot;).collapsed = false;</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineplus">+      gSigKeyId = params.msgSignatureKeyId;</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineplus">+    }</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineplus">+  }</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineplus">+</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineplus">+  if (params.msgEncryptionKeyId) {</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineplus">+    let idElement = document.getElementById(&quot;encryptionKeyId&quot;);</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineplus">+    idElement.collapsed = false;</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineplus">+    idElement.value = oBundle.getFormattedString(&quot;EncKeyId&quot;, [</span>
<a href="#l11.164"></a><span id="l11.164" class="difflineplus">+      &quot;0x&quot; + params.msgEncryptionKeyId,</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineplus">+    ]);</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineplus">+</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineplus">+    if (EnigmailKeyRing.getKeyById(params.msgEncryptionKeyId)) {</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineplus">+      document.getElementById(&quot;viewEncryptionKey&quot;).collapsed = false;</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineplus">+      gEncKeyId = params.msgEncryptionKeyId;</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineplus">+    }</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineplus">+  }</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineplus">+}</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineplus">+/* eslint-enable complexity */</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineplus">+</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineplus">+function viewKeyHelper(keyId) {</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineplus">+  EnigmailWindows.openKeyDetails(window, keyId, false);</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineplus">+}</span>
<a href="#l11.178"></a><span id="l11.178" class="difflineplus">+</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineplus">+function viewSignatureKey() {</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineplus">+  if (gSigKeyId) {</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineplus">+    viewKeyHelper(gSigKeyId);</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineplus">+  }</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineplus">+}</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineplus">+</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineplus">+function viewEncryptionKey() {</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineplus">+  if (gEncKeyId) {</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineplus">+    viewKeyHelper(gEncKeyId);</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineplus">+  }</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">copy from mailnews/extensions/smime/content/msgReadSecurityInfo.xhtml</span>
<a href="#l12.2"></a><span id="l12.2">copy to mail/extensions/openpgp/content/ui/msgReadStatus.xhtml</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineminus">--- a/mailnews/extensions/smime/content/msgReadSecurityInfo.xhtml</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/msgReadStatus.xhtml</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineat">@@ -1,69 +1,53 @@</span>
<a href="#l12.6"></a><span id="l12.6"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l12.7"></a><span id="l12.7"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.8"></a><span id="l12.8">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.9"></a><span id="l12.9">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11"> &lt;?xml-stylesheet href=&quot;chrome://global/skin/global.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/smime/msgReadSecurityInfo.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/openpgp/msgReadStatus.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-&lt;!DOCTYPE window SYSTEM &quot;chrome://messenger-smime/locale/msgReadSecurityInfo.dtd&quot;&gt;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+&lt;!DOCTYPE window [</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+&lt;!ENTITY % smimeDTD SYSTEM &quot;chrome://messenger-smime/locale/msgReadSecurityInfo.dtd&quot; &gt;</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+%smimeDTD;</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+&lt;!ENTITY % openpgpDTD SYSTEM &quot;chrome://openpgp/content/strings/msgReadStatus.dtd&quot; &gt;</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+%openpgpDTD;</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+]&gt;</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23"> &lt;window title=&quot;&amp;status.label;&quot;</span>
<a href="#l12.24"></a><span id="l12.24">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-        style=&quot;width: 40em;&quot;</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+        style=&quot;width: 40em; height: 15em&quot;</span>
<a href="#l12.27"></a><span id="l12.27">         onload=&quot;onLoad();&quot;&gt;</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-&lt;dialog id=&quot;msgReadSecurityInfo&quot;</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+&lt;dialog id=&quot;msgReadStatus&quot;</span>
<a href="#l12.30"></a><span id="l12.30">         buttons=&quot;accept&quot;&gt;</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-  &lt;script src=&quot;chrome://messenger-smime/content/msgReadSecurityInfo.js&quot;/&gt;</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+  &lt;script src=&quot;chrome://openpgp/content/ui/msgReadStatus.js&quot;/&gt;</span>
<a href="#l12.33"></a><span id="l12.33"> </span>
<a href="#l12.34"></a><span id="l12.34">   &lt;stringbundle id=&quot;bundle_smime_read_info&quot; src=&quot;chrome://messenger-smime/locale/msgSecurityInfo.properties&quot;/&gt;</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+  &lt;stringbundle id=&quot;bundle_openpgp_read_info&quot; src=&quot;chrome://openpgp/content/strings/msgReadStatus.properties&quot;/&gt;</span>
<a href="#l12.36"></a><span id="l12.36"> </span>
<a href="#l12.37"></a><span id="l12.37">   &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+    &lt;label id=&quot;techLabel&quot; value=&quot;&amp;OpenPGP;&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+</span>
<a href="#l12.40"></a><span id="l12.40">     &lt;label id=&quot;signatureLabel&quot;/&gt;</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-    &lt;label id=&quot;signatureHeader&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l12.42"></a><span id="l12.42">     &lt;description id=&quot;signatureExplanation&quot;/&gt;</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-    &lt;vbox id=&quot;signatureCert&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-      &lt;hbox&gt;</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-        &lt;label id=&quot;signedByLabel&quot;&gt;&amp;signer.name;&lt;/label&gt;</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-        &lt;description id=&quot;signedBy&quot;/&gt;</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+    &lt;vbox id=&quot;signatureKey&quot;&gt;</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+      &lt;label id=&quot;signatureKeyId&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l12.50"></a><span id="l12.50">       &lt;hbox&gt;</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-        &lt;label id=&quot;signerEmailLabel&quot;&gt;&amp;email.address;&lt;/label&gt;</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-        &lt;description id=&quot;signerEmail&quot;/&gt;</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-      &lt;hbox&gt;</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-        &lt;label id=&quot;sigCertIssuedByLabel&quot;&gt;&amp;issuer.name;&lt;/label&gt;</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineminus">-        &lt;description id=&quot;sigCertIssuedBy&quot;/&gt;</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineminus">-      &lt;hbox&gt;</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-        &lt;button id=&quot;signatureCertView&quot; label=&quot;&amp;signatureCert.label;&quot;</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineminus">-                oncommand=&quot;viewSignatureCert()&quot;/&gt;</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+        &lt;button id=&quot;viewSignatureKey&quot; label=&quot;&amp;ViewSignerKey;&quot;</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+                oncommand=&quot;viewSignatureKey()&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l12.63"></a><span id="l12.63">       &lt;/hbox&gt;</span>
<a href="#l12.64"></a><span id="l12.64">     &lt;/vbox&gt;</span>
<a href="#l12.65"></a><span id="l12.65"> </span>
<a href="#l12.66"></a><span id="l12.66">     &lt;separator/&gt;</span>
<a href="#l12.67"></a><span id="l12.67"> </span>
<a href="#l12.68"></a><span id="l12.68">     &lt;label id=&quot;encryptionLabel&quot;/&gt;</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-    &lt;label id=&quot;encryptionHeader&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l12.70"></a><span id="l12.70">     &lt;description id=&quot;encryptionExplanation&quot;/&gt;</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineminus">-    &lt;vbox id=&quot;encryptionCert&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-      &lt;hbox&gt;</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-        &lt;label id=&quot;encryptedForLabel&quot;&gt;&amp;recipient.name;&lt;/label&gt;</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-        &lt;description id=&quot;encryptedFor&quot;/&gt;</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineplus">+    &lt;vbox id=&quot;encryptionKey&quot;&gt;</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineplus">+      &lt;label id=&quot;encryptionKeyId&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l12.78"></a><span id="l12.78">       &lt;hbox&gt;</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-        &lt;label id=&quot;recipientEmailLabel&quot;&gt;&amp;email.address;&lt;/label&gt;</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-        &lt;description id=&quot;recipientEmail&quot;/&gt;</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-      &lt;hbox&gt;</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-        &lt;label id=&quot;encCertIssuedByLabel&quot;&gt;&amp;issuer.name;&lt;/label&gt;</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-        &lt;description id=&quot;encCertIssuedBy&quot;/&gt;</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-      &lt;hbox&gt;</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-        &lt;button id=&quot;encryptionCertView&quot; label=&quot;&amp;encryptionCert.label;&quot;</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-                oncommand=&quot;viewEncryptionCert()&quot;/&gt;</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+        &lt;button id=&quot;viewEncryptionKey&quot; label=&quot;&amp;ViewYourEncryptionKey;&quot;</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineplus">+                oncommand=&quot;viewEncryptionKey()&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l12.91"></a><span id="l12.91">       &lt;/hbox&gt;</span>
<a href="#l12.92"></a><span id="l12.92">     &lt;/vbox&gt;</span>
<a href="#l12.93"></a><span id="l12.93">   &lt;/vbox&gt;</span>
<a href="#l12.94"></a><span id="l12.94"> &lt;/dialog&gt;</span>
<a href="#l12.95"></a><span id="l12.95"> &lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/extensions/openpgp/jar.mn</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/extensions/openpgp/jar.mn</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -10,15 +10,17 @@ openpgp.jar:</span>
<a href="#l13.4"></a><span id="l13.4">   content/openpgp/modules/stdlib               (content/modules/stdlib/*.js*)</span>
<a href="#l13.5"></a><span id="l13.5">   content/openpgp/modules/cryptoAPI            (content/modules/cryptoAPI/*.js*)</span>
<a href="#l13.6"></a><span id="l13.6">   content/openpgp/strings/enigmail.properties  (content/strings/enigmail.properties)</span>
<a href="#l13.7"></a><span id="l13.7">   content/openpgp/strings/enigmail.dtd         (content/strings/enigmail.dtd)</span>
<a href="#l13.8"></a><span id="l13.8">   content/openpgp/strings/oneRecipientStatus.properties (content/strings/oneRecipientStatus.properties)</span>
<a href="#l13.9"></a><span id="l13.9">   content/openpgp/strings/oneRecipientStatus.dtd        (content/strings/oneRecipientStatus.dtd)</span>
<a href="#l13.10"></a><span id="l13.10">   content/openpgp/strings/composeKeyStatus.properties   (content/strings/composeKeyStatus.properties)</span>
<a href="#l13.11"></a><span id="l13.11">   content/openpgp/strings/composeKeyStatus.dtd          (content/strings/composeKeyStatus.dtd)</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+  content/openpgp/strings/msgReadStatus.properties     (content/strings/msgReadStatus.properties)</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  content/openpgp/strings/msgReadStatus.dtd            (content/strings/msgReadStatus.dtd)</span>
<a href="#l13.14"></a><span id="l13.14">   content/openpgp/strings/bond.dtd             (content/strings/bond.dtd)</span>
<a href="#l13.15"></a><span id="l13.15">   content/openpgp/ui                           (content/ui/*.js)</span>
<a href="#l13.16"></a><span id="l13.16">   content/openpgp/ui                           (content/ui/*.xhtml)</span>
<a href="#l13.17"></a><span id="l13.17">   content/openpgp/ui                           (content/ui/*.css)</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19"> [localization] @AB_CD@.jar:</span>
<a href="#l13.20"></a><span id="l13.20">   openpgp/content/ui/keyPicker.ftl             (content/ui/keyPicker.ftl)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/extensions/smime/content/msgHdrViewSMIMEOverlay.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/extensions/smime/content/msgHdrViewSMIMEOverlay.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -5,17 +5,17 @@</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5"> /* import-globals-from ../../../../mailnews/extensions/smime/content/msgReadSMIMEOverlay.js */</span>
<a href="#l14.6"></a><span id="l14.6"> /* import-globals-from ../../../base/content/folderDisplay.js */</span>
<a href="#l14.7"></a><span id="l14.7"> /* import-globals-from ../../../base/content/mailWindow.js */</span>
<a href="#l14.8"></a><span id="l14.8"> /* import-globals-from ../../../base/content/msgHdrView.js */</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10"> var gSignedUINode = null;</span>
<a href="#l14.11"></a><span id="l14.11"> var gEncryptedUINode = null;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-var gSMIMEContainer = null;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+var gCryptoContainer = null;</span>
<a href="#l14.14"></a><span id="l14.14"> var gStatusBar = null;</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> var gEncryptedURIService = null;</span>
<a href="#l14.17"></a><span id="l14.17"> var gMyLastEncryptedURI = null;</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19"> var gSMIMEBundle = null;</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21"> var gSignatureStatusForURI = null;</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -74,17 +74,18 @@ var smimeHeaderSink = {</span>
<a href="#l14.23"></a><span id="l14.23">         return;</span>
<a href="#l14.24"></a><span id="l14.24">       }</span>
<a href="#l14.25"></a><span id="l14.25">     }</span>
<a href="#l14.26"></a><span id="l14.26"> </span>
<a href="#l14.27"></a><span id="l14.27">     gSignatureStatusForURI = aMsgNeckoURL;</span>
<a href="#l14.28"></a><span id="l14.28">     gSignatureStatus = aSignatureStatus;</span>
<a href="#l14.29"></a><span id="l14.29">     gSignerCert = aSignerCert;</span>
<a href="#l14.30"></a><span id="l14.30"> </span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-    gSMIMEContainer.collapsed = false;</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+    gCryptoContainer.collapsed = false;</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+    gCryptoContainer.setAttribute(&quot;tech&quot;, &quot;S/MIME&quot;);</span>
<a href="#l14.34"></a><span id="l14.34">     gSignedUINode.collapsed = false;</span>
<a href="#l14.35"></a><span id="l14.35"> </span>
<a href="#l14.36"></a><span id="l14.36">     switch (aSignatureStatus) {</span>
<a href="#l14.37"></a><span id="l14.37">       case Ci.nsICMSMessageErrors.SUCCESS:</span>
<a href="#l14.38"></a><span id="l14.38">         gSignedUINode.setAttribute(&quot;signed&quot;, &quot;ok&quot;);</span>
<a href="#l14.39"></a><span id="l14.39">         gStatusBar.setAttribute(&quot;signed&quot;, &quot;ok&quot;);</span>
<a href="#l14.40"></a><span id="l14.40">         break;</span>
<a href="#l14.41"></a><span id="l14.41"> </span>
<a href="#l14.42"></a><span id="l14.42" class="difflineat">@@ -164,17 +165,18 @@ var smimeHeaderSink = {</span>
<a href="#l14.43"></a><span id="l14.43">         return;</span>
<a href="#l14.44"></a><span id="l14.44">       }</span>
<a href="#l14.45"></a><span id="l14.45">     }</span>
<a href="#l14.46"></a><span id="l14.46"> </span>
<a href="#l14.47"></a><span id="l14.47">     gEncryptionStatusForURI = aMsgNeckoURL;</span>
<a href="#l14.48"></a><span id="l14.48">     gEncryptionStatus = aEncryptionStatus;</span>
<a href="#l14.49"></a><span id="l14.49">     gEncryptionCert = aRecipientCert;</span>
<a href="#l14.50"></a><span id="l14.50"> </span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-    gSMIMEContainer.collapsed = false;</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+    gCryptoContainer.collapsed = false;</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+    gCryptoContainer.setAttribute(&quot;tech&quot;, &quot;S/MIME&quot;);</span>
<a href="#l14.54"></a><span id="l14.54">     gEncryptedUINode.collapsed = false;</span>
<a href="#l14.55"></a><span id="l14.55"> </span>
<a href="#l14.56"></a><span id="l14.56">     if (Ci.nsICMSMessageErrors.SUCCESS == aEncryptionStatus) {</span>
<a href="#l14.57"></a><span id="l14.57">       gEncryptedUINode.setAttribute(&quot;encrypted&quot;, &quot;ok&quot;);</span>
<a href="#l14.58"></a><span id="l14.58">       gStatusBar.setAttribute(&quot;encrypted&quot;, &quot;ok&quot;);</span>
<a href="#l14.59"></a><span id="l14.59">     } else {</span>
<a href="#l14.60"></a><span id="l14.60">       gEncryptedUINode.setAttribute(&quot;encrypted&quot;, &quot;notok&quot;);</span>
<a href="#l14.61"></a><span id="l14.61">       gStatusBar.setAttribute(&quot;encrypted&quot;, &quot;notok&quot;);</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineat">@@ -242,17 +244,18 @@ function onSMIMEStartHeaders() {</span>
<a href="#l14.63"></a><span id="l14.63">   gSignatureStatus = -1;</span>
<a href="#l14.64"></a><span id="l14.64"> </span>
<a href="#l14.65"></a><span id="l14.65">   gSignatureStatusForURI = null;</span>
<a href="#l14.66"></a><span id="l14.66">   gEncryptionStatusForURI = null;</span>
<a href="#l14.67"></a><span id="l14.67"> </span>
<a href="#l14.68"></a><span id="l14.68">   gSignerCert = null;</span>
<a href="#l14.69"></a><span id="l14.69">   gEncryptionCert = null;</span>
<a href="#l14.70"></a><span id="l14.70"> </span>
<a href="#l14.71"></a><span id="l14.71" class="difflineminus">-  gSMIMEContainer.collapsed = true;</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+  gCryptoContainer.collapsed = true;</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineplus">+  gCryptoContainer.removeAttribute(&quot;tech&quot;);</span>
<a href="#l14.74"></a><span id="l14.74"> </span>
<a href="#l14.75"></a><span id="l14.75">   gSignedUINode.collapsed = true;</span>
<a href="#l14.76"></a><span id="l14.76">   gSignedUINode.removeAttribute(&quot;signed&quot;);</span>
<a href="#l14.77"></a><span id="l14.77">   gStatusBar.removeAttribute(&quot;signed&quot;);</span>
<a href="#l14.78"></a><span id="l14.78"> </span>
<a href="#l14.79"></a><span id="l14.79">   gEncryptedUINode.collapsed = true;</span>
<a href="#l14.80"></a><span id="l14.80">   gEncryptedUINode.removeAttribute(&quot;encrypted&quot;);</span>
<a href="#l14.81"></a><span id="l14.81">   gStatusBar.removeAttribute(&quot;encrypted&quot;);</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineat">@@ -291,17 +294,17 @@ function msgHdrViewSMIMEOnLoad(event) {</span>
<a href="#l14.83"></a><span id="l14.83">   }</span>
<a href="#l14.84"></a><span id="l14.84"> </span>
<a href="#l14.85"></a><span id="l14.85">   // we want to register our security header sink as an opaque nsISupports</span>
<a href="#l14.86"></a><span id="l14.86">   // on the msgHdrSink used by mail.....</span>
<a href="#l14.87"></a><span id="l14.87">   msgWindow.msgHeaderSink.securityInfo = smimeHeaderSink;</span>
<a href="#l14.88"></a><span id="l14.88"> </span>
<a href="#l14.89"></a><span id="l14.89">   gSignedUINode = document.getElementById(&quot;signedHdrIcon&quot;);</span>
<a href="#l14.90"></a><span id="l14.90">   gEncryptedUINode = document.getElementById(&quot;encryptedHdrIcon&quot;);</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineminus">-  gSMIMEContainer = document.getElementById(&quot;smimeBox&quot;);</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+  gCryptoContainer = document.getElementById(&quot;cryptoBox&quot;);</span>
<a href="#l14.93"></a><span id="l14.93">   gStatusBar = document.getElementById(&quot;status-bar&quot;);</span>
<a href="#l14.94"></a><span id="l14.94"> </span>
<a href="#l14.95"></a><span id="l14.95">   // Add ourself to the list of message display listeners so we get notified</span>
<a href="#l14.96"></a><span id="l14.96">   // when we are about to display a message.</span>
<a href="#l14.97"></a><span id="l14.97">   var listener = {};</span>
<a href="#l14.98"></a><span id="l14.98">   listener.onStartHeaders = onSMIMEStartHeaders;</span>
<a href="#l14.99"></a><span id="l14.99">   listener.onEndHeaders = onSMIMEEndHeaders;</span>
<a href="#l14.100"></a><span id="l14.100">   listener.onBeforeShowHeaderPane = onSMIMEBeforeShowHeaderPane;</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineat">@@ -327,24 +330,24 @@ function msgHdrViewSMIMEOnUnload(event) </span>
<a href="#l14.102"></a><span id="l14.102">   removeEventListener(</span>
<a href="#l14.103"></a><span id="l14.103">     &quot;messagepane-unhide&quot;,</span>
<a href="#l14.104"></a><span id="l14.104">     msgHdrViewSMIMEOnMessagePaneUnhide,</span>
<a href="#l14.105"></a><span id="l14.105">     true</span>
<a href="#l14.106"></a><span id="l14.106">   );</span>
<a href="#l14.107"></a><span id="l14.107"> }</span>
<a href="#l14.108"></a><span id="l14.108"> </span>
<a href="#l14.109"></a><span id="l14.109"> function msgHdrViewSMIMEOnMessagePaneHide() {</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineminus">-  gSMIMEContainer.collapsed = true;</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineplus">+  gCryptoContainer.collapsed = true;</span>
<a href="#l14.112"></a><span id="l14.112">   gSignedUINode.collapsed = true;</span>
<a href="#l14.113"></a><span id="l14.113">   gEncryptedUINode.collapsed = true;</span>
<a href="#l14.114"></a><span id="l14.114"> }</span>
<a href="#l14.115"></a><span id="l14.115"> </span>
<a href="#l14.116"></a><span id="l14.116"> function msgHdrViewSMIMEOnMessagePaneUnhide() {</span>
<a href="#l14.117"></a><span id="l14.117">   if (gEncryptionStatus != -1 || gSignatureStatus != -1) {</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineminus">-    gSMIMEContainer.collapsed = false;</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineplus">+    gCryptoContainer.collapsed = false;</span>
<a href="#l14.120"></a><span id="l14.120"> </span>
<a href="#l14.121"></a><span id="l14.121">     if (gSignatureStatus != -1) {</span>
<a href="#l14.122"></a><span id="l14.122">       gSignedUINode.collapsed = false;</span>
<a href="#l14.123"></a><span id="l14.123">     }</span>
<a href="#l14.124"></a><span id="l14.124"> </span>
<a href="#l14.125"></a><span id="l14.125">     if (gEncryptionStatus != -1) {</span>
<a href="#l14.126"></a><span id="l14.126">       gEncryptedUINode.collapsed = false;</span>
<a href="#l14.127"></a><span id="l14.127">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger-smime/msgReadSecurityInfo.dtd</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger-smime/msgReadSecurityInfo.dtd</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -7,8 +7,11 @@</span>
<a href="#l15.4"></a><span id="l15.4"> &lt;!ENTITY status.label &quot;Message Security&quot;&gt;</span>
<a href="#l15.5"></a><span id="l15.5"> &lt;!ENTITY signatureCert.label &quot;View Signature Certificate&quot;&gt;</span>
<a href="#l15.6"></a><span id="l15.6"> &lt;!ENTITY encryptionCert.label &quot;View Encryption Certificate&quot;&gt;</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> &lt;!ENTITY signer.name &quot;Signed by:&quot;&gt;</span>
<a href="#l15.9"></a><span id="l15.9"> &lt;!ENTITY recipient.name &quot;Encrypted for:&quot;&gt;</span>
<a href="#l15.10"></a><span id="l15.10"> &lt;!ENTITY email.address &quot;Email address:&quot;&gt;</span>
<a href="#l15.11"></a><span id="l15.11"> &lt;!ENTITY issuer.name &quot;Certificate issued by:&quot;&gt;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+&lt;!-- LOCALIZATION NOTE(SMIME.label): This a name for a technical standard. You should not translate it, but if applicable, you may write it using localized characters. --&gt;</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+&lt;!ENTITY SMIME.label &quot;S/MIME&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/themes/linux/mail/smime/msgReadSecurityInfo.css</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/themes/linux/mail/smime/msgReadSecurityInfo.css</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -5,16 +5,21 @@</span>
<a href="#l16.4"></a><span id="l16.4"> /* ===== msgReadSecurityInfo.css ========================================</span>
<a href="#l16.5"></a><span id="l16.5">   == Styles for the security info window when displaying received mail.</span>
<a href="#l16.6"></a><span id="l16.6">   ======================================================================= */</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> @import url(&quot;chrome://messenger/skin/messenger.css&quot;);</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+#techLabel {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  font-weight: bold;</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+  text-align: right;</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+}</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+</span>
<a href="#l16.17"></a><span id="l16.17"> #signatureLabel {</span>
<a href="#l16.18"></a><span id="l16.18">   font-weight: bold;</span>
<a href="#l16.19"></a><span id="l16.19"> }</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21"> #signatureCert {</span>
<a href="#l16.22"></a><span id="l16.22">   margin: 5px;</span>
<a href="#l16.23"></a><span id="l16.23"> }</span>
<a href="#l16.24"></a><span id="l16.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/themes/osx/mail/smime/msgReadSecurityInfo.css</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/themes/osx/mail/smime/msgReadSecurityInfo.css</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -5,16 +5,21 @@</span>
<a href="#l17.4"></a><span id="l17.4"> /* ===== msgReadSecurityInfo.css ========================================</span>
<a href="#l17.5"></a><span id="l17.5">   == Styles for the security info window when displaying received mail.</span>
<a href="#l17.6"></a><span id="l17.6">   ======================================================================= */</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8"> @import url(&quot;chrome://messenger/skin/messenger.css&quot;);</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+#techLabel {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  font-weight: bold;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+  text-align: right;</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+}</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+</span>
<a href="#l17.17"></a><span id="l17.17"> #signatureLabel {</span>
<a href="#l17.18"></a><span id="l17.18">   font-weight: bold;</span>
<a href="#l17.19"></a><span id="l17.19"> }</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21"> #signatureCert {</span>
<a href="#l17.22"></a><span id="l17.22">   margin: 5px;</span>
<a href="#l17.23"></a><span id="l17.23"> }</span>
<a href="#l17.24"></a><span id="l17.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/themes/shared/jar.inc.mn</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/themes/shared/jar.inc.mn</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -270,8 +270,9 @@</span>
<a href="#l18.4"></a><span id="l18.4">   skin/classic/messenger/openpgp/sign-disabled-18.svg         (../shared/openpgp/sign-disabled-18.svg)</span>
<a href="#l18.5"></a><span id="l18.5">   skin/classic/messenger/openpgp/sign-inactive-18.svg         (../shared/openpgp/sign-inactive-18.svg)</span>
<a href="#l18.6"></a><span id="l18.6">   skin/classic/messenger/openpgp/spinning-wheel.png           (../shared/openpgp/spinning-wheel.png)</span>
<a href="#l18.7"></a><span id="l18.7">   skin/classic/messenger/openpgp/twisty-clsd.png              (../shared/openpgp/twisty-clsd.png)</span>
<a href="#l18.8"></a><span id="l18.8">   skin/classic/messenger/openpgp/twisty-open.png              (../shared/openpgp/twisty-open.png)</span>
<a href="#l18.9"></a><span id="l18.9">   skin/classic/messenger/openpgp/warning-16.png               (../shared/openpgp/warning-16.png)</span>
<a href="#l18.10"></a><span id="l18.10">   skin/classic/messenger/openpgp/composeKeyStatus.css         (../shared/openpgp/composeKeyStatus.css)</span>
<a href="#l18.11"></a><span id="l18.11">   skin/classic/messenger/openpgp/oneRecipientStatus.css       (../shared/openpgp/oneRecipientStatus.css)</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+  skin/classic/messenger/openpgp/msgReadStatus.css            (../shared/openpgp/msgReadStatus.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">new file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- /dev/null</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ b/mail/themes/shared/openpgp/msgReadStatus.css</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -0,0 +1,28 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineplus">+</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineplus">+@import url(&quot;chrome://messenger/skin/messenger.css&quot;);</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineplus">+</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineplus">+@namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+#techLabel {</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+  font-weight: bold;</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+  text-align: right;</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+}</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+#signatureLabel {</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+  font-weight: bold;</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+}</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineplus">+</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineplus">+#signatureKey {</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+  margin: 5px;</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+}</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineplus">+</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineplus">+#encryptionLabel {</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineplus">+  font-weight: bold;</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineplus">+}</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineplus">+</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineplus">+#encryptionKey {</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineplus">+  margin: 5px;</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/themes/windows/mail/smime/msgReadSecurityInfo.css</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/themes/windows/mail/smime/msgReadSecurityInfo.css</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -5,16 +5,21 @@</span>
<a href="#l20.4"></a><span id="l20.4"> /* ===== msgReadSecurityInfo.css ========================================</span>
<a href="#l20.5"></a><span id="l20.5">   == Styles for the security info window when displaying received mail.</span>
<a href="#l20.6"></a><span id="l20.6">   ======================================================================= */</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8"> @import url(&quot;chrome://messenger/skin/messenger.css&quot;);</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+#techLabel {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  font-weight: bold;</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+  text-align: right;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+}</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+</span>
<a href="#l20.17"></a><span id="l20.17"> #signatureLabel {</span>
<a href="#l20.18"></a><span id="l20.18">   font-weight: bold;</span>
<a href="#l20.19"></a><span id="l20.19"> }</span>
<a href="#l20.20"></a><span id="l20.20"> </span>
<a href="#l20.21"></a><span id="l20.21"> #signatureCert {</span>
<a href="#l20.22"></a><span id="l20.22">   margin: 5px;</span>
<a href="#l20.23"></a><span id="l20.23"> }</span>
<a href="#l20.24"></a><span id="l20.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l21.4"></a><span id="l21.4"> /* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l21.5"></a><span id="l21.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.6"></a><span id="l21.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.7"></a><span id="l21.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9"> /* globals gDBView, GetNumSelectedMessages */</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineplus">+/* globals MailConstants, Enigmail, BondOpenPGP */</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l21.13"></a><span id="l21.13"> </span>
<a href="#l21.14"></a><span id="l21.14"> var gEncryptionStatus = -1;</span>
<a href="#l21.15"></a><span id="l21.15"> var gSignatureStatus = -1;</span>
<a href="#l21.16"></a><span id="l21.16"> var gSignerCert = null;</span>
<a href="#l21.17"></a><span id="l21.17"> var gEncryptionCert = null;</span>
<a href="#l21.18"></a><span id="l21.18"> </span>
<a href="#l21.19"></a><span id="l21.19" class="difflineat">@@ -38,16 +39,26 @@ function showImapSignatureUnknown() {</span>
<a href="#l21.20"></a><span id="l21.20">       readSmimeBundle.getString(&quot;ImapOnDemand&quot;)</span>
<a href="#l21.21"></a><span id="l21.21">     )</span>
<a href="#l21.22"></a><span id="l21.22">   ) {</span>
<a href="#l21.23"></a><span id="l21.23">     gDBView.reloadMessageWithAllParts();</span>
<a href="#l21.24"></a><span id="l21.24">   }</span>
<a href="#l21.25"></a><span id="l21.25"> }</span>
<a href="#l21.26"></a><span id="l21.26"> </span>
<a href="#l21.27"></a><span id="l21.27"> function showMessageReadSecurityInfo() {</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+  if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+    let box = document.getElementById(&quot;cryptoBox&quot;);</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+    let tech = box.getAttribute(&quot;tech&quot;);</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+    if (tech &amp;&amp; tech === &quot;OpenPGP&quot;) {</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+      Enigmail.hdrView.viewOpenpgpInfo();</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+      return;</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+    }</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+  }</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+  // S/MIME</span>
<a href="#l21.38"></a><span id="l21.38">   let gSignedUINode = document.getElementById(&quot;signedHdrIcon&quot;);</span>
<a href="#l21.39"></a><span id="l21.39">   if (gSignedUINode &amp;&amp; gSignedUINode.getAttribute(&quot;signed&quot;) == &quot;unknown&quot;) {</span>
<a href="#l21.40"></a><span id="l21.40">     showImapSignatureUnknown();</span>
<a href="#l21.41"></a><span id="l21.41">     return;</span>
<a href="#l21.42"></a><span id="l21.42">   }</span>
<a href="#l21.43"></a><span id="l21.43"> </span>
<a href="#l21.44"></a><span id="l21.44">   let params = Cc[&quot;@mozilla.org/embedcomp/dialogparam;1&quot;].createInstance(</span>
<a href="#l21.45"></a><span id="l21.45">     Ci.nsIDialogParamBlock</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/extensions/smime/content/msgReadSecurityInfo.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/msgReadSecurityInfo.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -38,29 +38,33 @@ function onLoad() {</span>
<a href="#l22.4"></a><span id="l22.4">   } catch (e) {} // maybe null</span>
<a href="#l22.5"></a><span id="l22.5">   try {</span>
<a href="#l22.6"></a><span id="l22.6">     gEncryptionCert = paramBlock.objects.queryElementAt(1, nsIX509Cert);</span>
<a href="#l22.7"></a><span id="l22.7">   } catch (e) {} // maybe null</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9">   gSignatureStatus = paramBlock.GetInt(1);</span>
<a href="#l22.10"></a><span id="l22.10">   gEncryptionStatus = paramBlock.GetInt(2);</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+  var hasAnySig = true;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+  var hasAnyEnc = true;</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+</span>
<a href="#l22.15"></a><span id="l22.15">   var bundle = document.getElementById(&quot;bundle_smime_read_info&quot;);</span>
<a href="#l22.16"></a><span id="l22.16"> </span>
<a href="#l22.17"></a><span id="l22.17">   if (bundle) {</span>
<a href="#l22.18"></a><span id="l22.18">     var sigInfoLabel = null;</span>
<a href="#l22.19"></a><span id="l22.19">     var sigInfoHeader = null;</span>
<a href="#l22.20"></a><span id="l22.20">     var sigInfo = null;</span>
<a href="#l22.21"></a><span id="l22.21">     var sigInfo_clueless = false;</span>
<a href="#l22.22"></a><span id="l22.22"> </span>
<a href="#l22.23"></a><span id="l22.23">     switch (gSignatureStatus) {</span>
<a href="#l22.24"></a><span id="l22.24">       case -1:</span>
<a href="#l22.25"></a><span id="l22.25">       case nsICMSMessageErrors.VERIFY_NOT_SIGNED:</span>
<a href="#l22.26"></a><span id="l22.26">         sigInfoLabel = &quot;SINoneLabel&quot;;</span>
<a href="#l22.27"></a><span id="l22.27">         sigInfo = &quot;SINone&quot;;</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineplus">+        hasAnySig = false;</span>
<a href="#l22.29"></a><span id="l22.29">         break;</span>
<a href="#l22.30"></a><span id="l22.30"> </span>
<a href="#l22.31"></a><span id="l22.31">       case nsICMSMessageErrors.SUCCESS:</span>
<a href="#l22.32"></a><span id="l22.32">         sigInfoLabel = &quot;SIValidLabel&quot;;</span>
<a href="#l22.33"></a><span id="l22.33">         sigInfo = &quot;SIValid&quot;;</span>
<a href="#l22.34"></a><span id="l22.34">         break;</span>
<a href="#l22.35"></a><span id="l22.35"> </span>
<a href="#l22.36"></a><span id="l22.36">       case nsICMSMessageErrors.VERIFY_BAD_SIGNATURE:</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineat">@@ -137,16 +141,17 @@ function onLoad() {</span>
<a href="#l22.38"></a><span id="l22.38">     var encInfoHeader = null;</span>
<a href="#l22.39"></a><span id="l22.39">     var encInfo = null;</span>
<a href="#l22.40"></a><span id="l22.40">     var encInfo_clueless = false;</span>
<a href="#l22.41"></a><span id="l22.41"> </span>
<a href="#l22.42"></a><span id="l22.42">     switch (gEncryptionStatus) {</span>
<a href="#l22.43"></a><span id="l22.43">       case -1:</span>
<a href="#l22.44"></a><span id="l22.44">         encInfoLabel = &quot;EINoneLabel2&quot;;</span>
<a href="#l22.45"></a><span id="l22.45">         encInfo = &quot;EINone&quot;;</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineplus">+        hasAnyEnc = false;</span>
<a href="#l22.47"></a><span id="l22.47">         break;</span>
<a href="#l22.48"></a><span id="l22.48"> </span>
<a href="#l22.49"></a><span id="l22.49">       case nsICMSMessageErrors.SUCCESS:</span>
<a href="#l22.50"></a><span id="l22.50">         encInfoLabel = &quot;EIValidLabel&quot;;</span>
<a href="#l22.51"></a><span id="l22.51">         encInfo = &quot;EIValid&quot;;</span>
<a href="#l22.52"></a><span id="l22.52">         break;</span>
<a href="#l22.53"></a><span id="l22.53"> </span>
<a href="#l22.54"></a><span id="l22.54">       case nsICMSMessageErrors.ENCRYPT_INCOMPLETE:</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineat">@@ -158,16 +163,20 @@ function onLoad() {</span>
<a href="#l22.56"></a><span id="l22.56">         encInfoLabel = &quot;EIInvalidLabel&quot;;</span>
<a href="#l22.57"></a><span id="l22.57">         encInfoHeader = &quot;EIInvalidHeader&quot;;</span>
<a href="#l22.58"></a><span id="l22.58">         encInfo_clueless = 1;</span>
<a href="#l22.59"></a><span id="l22.59">         break;</span>
<a href="#l22.60"></a><span id="l22.60">       default:</span>
<a href="#l22.61"></a><span id="l22.61">         Cu.reportError(&quot;Unexpected gEncryptionStatus: &quot; + gEncryptionStatus);</span>
<a href="#l22.62"></a><span id="l22.62">     }</span>
<a href="#l22.63"></a><span id="l22.63"> </span>
<a href="#l22.64"></a><span id="l22.64" class="difflineplus">+    if (hasAnyEnc || hasAnySig) {</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineplus">+      document.getElementById(&quot;techLabel&quot;).collapsed = false;</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineplus">+    }</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineplus">+</span>
<a href="#l22.68"></a><span id="l22.68">     document.getElementById(&quot;encryptionLabel&quot;).value = bundle.getString(</span>
<a href="#l22.69"></a><span id="l22.69">       encInfoLabel</span>
<a href="#l22.70"></a><span id="l22.70">     );</span>
<a href="#l22.71"></a><span id="l22.71"> </span>
<a href="#l22.72"></a><span id="l22.72">     if (encInfoHeader) {</span>
<a href="#l22.73"></a><span id="l22.73">       label = document.getElementById(&quot;encryptionHeader&quot;);</span>
<a href="#l22.74"></a><span id="l22.74">       label.collapsed = false;</span>
<a href="#l22.75"></a><span id="l22.75">       label.value = bundle.getString(encInfoHeader);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/extensions/smime/content/msgReadSecurityInfo.xhtml</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/msgReadSecurityInfo.xhtml</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -14,16 +14,18 @@</span>
<a href="#l23.4"></a><span id="l23.4">         onload=&quot;onLoad();&quot;&gt;</span>
<a href="#l23.5"></a><span id="l23.5"> &lt;dialog id=&quot;msgReadSecurityInfo&quot;</span>
<a href="#l23.6"></a><span id="l23.6">         buttons=&quot;accept&quot;&gt;</span>
<a href="#l23.7"></a><span id="l23.7">   &lt;script src=&quot;chrome://messenger-smime/content/msgReadSecurityInfo.js&quot;/&gt;</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9">   &lt;stringbundle id=&quot;bundle_smime_read_info&quot; src=&quot;chrome://messenger-smime/locale/msgSecurityInfo.properties&quot;/&gt;</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11">   &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+    &lt;label id=&quot;techLabel&quot; value=&quot;&amp;SMIME.label;&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+</span>
<a href="#l23.14"></a><span id="l23.14">     &lt;label id=&quot;signatureLabel&quot;/&gt;</span>
<a href="#l23.15"></a><span id="l23.15">     &lt;label id=&quot;signatureHeader&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l23.16"></a><span id="l23.16">     &lt;description id=&quot;signatureExplanation&quot;/&gt;</span>
<a href="#l23.17"></a><span id="l23.17">     &lt;vbox id=&quot;signatureCert&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l23.18"></a><span id="l23.18">       &lt;hbox&gt;</span>
<a href="#l23.19"></a><span id="l23.19">         &lt;label id=&quot;signedByLabel&quot;&gt;&amp;signer.name;&lt;/label&gt;</span>
<a href="#l23.20"></a><span id="l23.20">         &lt;description id=&quot;signedBy&quot;/&gt;</span>
<a href="#l23.21"></a><span id="l23.21">       &lt;/hbox&gt;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

