<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 17649:bc959dd6181feacd1775cc6f14cb3c9338c7f847</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ bc959dd6181feacd1775cc6f14cb3c9338c7f847" />
<meta property="og:url" content="/comm-central/rev/bc959dd6181feacd1775cc6f14cb3c9338c7f847" />
<meta property="og:description" content="Bug 1142261 - Don't split interfaces between libical and ical.js. r=darktrojan" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / bc959dd6181feacd1775cc6f14cb3c9338c7f847 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/bc959dd6181feacd1775cc6f14cb3c9338c7f847">shortlog</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/bc959dd6181feacd1775cc6f14cb3c9338c7f847">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847">files</a> |
changeset |
<a href="/comm-central/raw-rev/bc959dd6181feacd1775cc6f14cb3c9338c7f847">raw</a>  | <a href="/comm-central/archive/bc959dd6181feacd1775cc6f14cb3c9338c7f847.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1142261">Bug 1142261</a> - Don't split interfaces between libical and ical.js. r=darktrojan
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 12 Mar 2015 11:33:03 +0100</td></tr>

<tr>
 <td>changeset 17649</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/bc959dd6181feacd1775cc6f14cb3c9338c7f847">bc959dd6181feacd1775cc6f14cb3c9338c7f847</a></td>
</tr>



<tr>
<td>parent 17648</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5fa28ac91f5501473061973b8499b09bb4941dee">5fa28ac91f5501473061973b8499b09bb4941dee</a>
</td>
</tr>

<tr>
<td>child 17650</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/115057dbe1953ae91888bfaf27ee339789cab2b0">115057dbe1953ae91888bfaf27ee339789cab2b0</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=bc959dd6181feacd1775cc6f14cb3c9338c7f847">10865</a></td></tr>
<tr><td>push user</td><td>aleth@instantbird.org</td></tr>
<tr><td>push date</td><td class="date age">Thu, 12 Mar 2015 22:38:10 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@bc959dd6181f [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bc959dd6181feacd1775cc6f14cb3c9338c7f847">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bc959dd6181feacd1775cc6f14cb3c9338c7f847&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bc959dd6181feacd1775cc6f14cb3c9338c7f847&newProject=comm-central&newRevision=357d9913125ce4e6b416d4c0257c06d5255ef5d4&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bc959dd6181feacd1775cc6f14cb3c9338c7f847&newProject=comm-central&newRevision=357d9913125ce4e6b416d4c0257c06d5255ef5d4&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bc959dd6181feacd1775cc6f14cb3c9338c7f847&newProject=comm-central&newRevision=357d9913125ce4e6b416d4c0257c06d5255ef5d4&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28darktrojan%29&revcount=50">darktrojan</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1142261">1142261</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1142261">Bug 1142261</a> - Don't split interfaces between libical and ical.js. r=darktrojan</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIDateTimeJS.idl">calendar/base/backend/icaljs/calIDateTimeJS.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIDateTimeJS.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIDateTimeJS.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIDateTimeJS.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIDurationJS.idl">calendar/base/backend/icaljs/calIDurationJS.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIDurationJS.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIDurationJS.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIDurationJS.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIICSServiceJS.idl">calendar/base/backend/icaljs/calIICSServiceJS.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIICSServiceJS.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIICSServiceJS.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIICSServiceJS.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIPeriodJS.idl">calendar/base/backend/icaljs/calIPeriodJS.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIPeriodJS.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIPeriodJS.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calIPeriodJS.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calRecurrenceRule.js">calendar/base/backend/icaljs/calRecurrenceRule.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calRecurrenceRule.js">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calRecurrenceRule.js">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calRecurrenceRule.js">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calRecurrenceRule.js">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/calRecurrenceRule.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/icaljs.manifest">calendar/base/backend/icaljs/icaljs.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/icaljs.manifest">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/icaljs.manifest">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/icaljs.manifest">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/icaljs.manifest">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/icaljs.manifest">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/moz.build">calendar/base/backend/icaljs/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/moz.build">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/moz.build">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/moz.build">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/moz.build">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/icaljs/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/build/libical.manifest">calendar/base/backend/libical/build/libical.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/build/libical.manifest">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/build/libical.manifest">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/build/libical.manifest">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/build/libical.manifest">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/build/libical.manifest">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.cpp">calendar/base/backend/libical/calDateTime.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.cpp">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.cpp">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.cpp">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.cpp">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.h">calendar/base/backend/libical/calDateTime.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.h">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.h">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.h">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.h">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDateTime.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.cpp">calendar/base/backend/libical/calDuration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.cpp">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.cpp">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.cpp">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.cpp">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.h">calendar/base/backend/libical/calDuration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.h">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.h">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.h">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.h">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calDuration.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.cpp">calendar/base/backend/libical/calICSService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.cpp">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.cpp">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.cpp">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.cpp">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.h">calendar/base/backend/libical/calICSService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.h">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.h">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.h">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.h">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calICSService.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIDateTime.idl">calendar/base/backend/libical/calIDateTime.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIDateTime.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIDateTime.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIDateTime.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIDuration.idl">calendar/base/backend/libical/calIDuration.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIDuration.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIDuration.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIDuration.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIICSService.idl">calendar/base/backend/libical/calIICSService.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIICSService.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIICSService.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIICSService.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIPeriod.idl">calendar/base/backend/libical/calIPeriod.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIPeriod.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIPeriod.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calIPeriod.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.cpp">calendar/base/backend/libical/calPeriod.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.cpp">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.cpp">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.cpp">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.cpp">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.h">calendar/base/backend/libical/calPeriod.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.h">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.h">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.h">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.h">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calPeriod.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calRecurrenceRule.cpp">calendar/base/backend/libical/calRecurrenceRule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calRecurrenceRule.cpp">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calRecurrenceRule.cpp">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calRecurrenceRule.cpp">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calRecurrenceRule.cpp">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calRecurrenceRule.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calUtils.cpp">calendar/base/backend/libical/calUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calUtils.cpp">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calUtils.cpp">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calUtils.cpp">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calUtils.cpp">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/calUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/moz.build">calendar/base/backend/libical/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/moz.build">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/moz.build">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/moz.build">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/moz.build">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/backend/libical/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDateTime.idl">calendar/base/public/calIDateTime.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDateTime.idl">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDateTime.idl">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDateTime.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDateTime.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDateTime.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDuration.idl">calendar/base/public/calIDuration.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDuration.idl">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDuration.idl">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDuration.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDuration.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIDuration.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIICSService.idl">calendar/base/public/calIICSService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIICSService.idl">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIICSService.idl">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIICSService.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIICSService.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIICSService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIPeriod.idl">calendar/base/public/calIPeriod.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIPeriod.idl">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIPeriod.idl">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIPeriod.idl">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIPeriod.idl">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/calIPeriod.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/moz.build">calendar/base/public/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/moz.build">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/moz.build">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/moz.build">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/moz.build">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/base/public/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/test/unit/test_recur.js">calendar/test/unit/test_recur.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/test/unit/test_recur.js">file</a> |
<a href="/comm-central/annotate/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/test/unit/test_recur.js">annotate</a> |
<a href="/comm-central/diff/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/test/unit/test_recur.js">diff</a> |
<a href="/comm-central/comparison/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/test/unit/test_recur.js">comparison</a> |
<a href="/comm-central/log/bc959dd6181feacd1775cc6f14cb3c9338c7f847/calendar/test/unit/test_recur.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/backend/icaljs/calRecurrenceRule.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/calRecurrenceRule.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -124,16 +124,21 @@ calRecurrenceRule.prototype = {</span>
<a href="#l1.4"></a><span id="l1.4">     get untilDate() {</span>
<a href="#l1.5"></a><span id="l1.5">         if (this.innerObject.until) {</span>
<a href="#l1.6"></a><span id="l1.6">             return new calDateTime(this.innerObject.until);</span>
<a href="#l1.7"></a><span id="l1.7">         } else {</span>
<a href="#l1.8"></a><span id="l1.8">             return null;</span>
<a href="#l1.9"></a><span id="l1.9">         }</span>
<a href="#l1.10"></a><span id="l1.10">     },</span>
<a href="#l1.11"></a><span id="l1.11">     set untilDate(val) unwrapSetter(ICAL.Time, val, function(val) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+        if (val.timezone != ICAL.Timezone.utcTimezone &amp;&amp;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+            val.timezone != ICAL.Timezone.localTimezone) {</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+            val = val.convertToZone(ICAL.Timezone.utcTimezone);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+        }</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+</span>
<a href="#l1.17"></a><span id="l1.17">         this.innerObject.until = val;</span>
<a href="#l1.18"></a><span id="l1.18">     }, this),</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">     get isByCount() this.innerObject.isByCount(),</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22">     get weekStart() this.innerObject.wkst - 1,</span>
<a href="#l1.23"></a><span id="l1.23">     set weekStart(val) this.innerObject.wkst = val + 1,</span>
<a href="#l1.24"></a><span id="l1.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/backend/icaljs/icaljs.manifest</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/icaljs.manifest</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -10,10 +10,8 @@ contract @mozilla.org/calendar/ics-servi</span>
<a href="#l2.4"></a><span id="l2.4"> component {394a281f-7299-45f7-8b1f-cce21258972f} calICALJSComponents.js</span>
<a href="#l2.5"></a><span id="l2.5"> contract @mozilla.org/calendar/period;1 {394a281f-7299-45f7-8b1f-cce21258972f}</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> component {df19281a-5389-4146-b941-798cb93a7f0d} calICALJSComponents.js</span>
<a href="#l2.8"></a><span id="l2.8"> contract @mozilla.org/calendar/recurrence-rule;1 {df19281a-5389-4146-b941-798cb93a7f0d}</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> component {6702eb17-a968-4b43-b562-0d0c5f8e9eb5} calICALJSComponents.js</span>
<a href="#l2.11"></a><span id="l2.11"> contract @mozilla.org/calendar/timezone;1 {6702eb17-a968-4b43-b562-0d0c5f8e9eb5}</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-interfaces caldatetime_icaljs.xpt</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/backend/icaljs/moz.build</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/moz.build</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,17 +1,8 @@</span>
<a href="#l3.4"></a><span id="l3.4"> # vim: set filetype=python:</span>
<a href="#l3.5"></a><span id="l3.5"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.6"></a><span id="l3.6"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.7"></a><span id="l3.7"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">-XPIDL_SOURCES += [</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">-    'calIDateTimeJS.idl',</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">-    'calIDurationJS.idl',</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    'calIICSServiceJS.idl',</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-    'calIPeriodJS.idl',</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-]</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-XPIDL_MODULE = 'caldatetime_icaljs'</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-</span>
<a href="#l3.18"></a><span id="l3.18"> EXTRA_COMPONENTS += [</span>
<a href="#l3.19"></a><span id="l3.19">     'calICALJSComponents.js',</span>
<a href="#l3.20"></a><span id="l3.20"> ]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/backend/libical/build/libical.manifest</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/backend/libical/build/libical.manifest</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,2 +1,1 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #expand binary-component __SHARED_LIBRARY__</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineminus">-interfaces caldatetime_libical.xpt</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/backend/libical/calDateTime.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/backend/libical/calDateTime.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -19,18 +19,18 @@</span>
<a href="#l5.4"></a><span id="l5.4"> extern &quot;C&quot; {</span>
<a href="#l5.5"></a><span id="l5.5"> #include &quot;ical.h&quot;</span>
<a href="#l5.6"></a><span id="l5.6"> }</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> #define CAL_ATTR_SET_PRE NS_ENSURE_FALSE(mImmutable, NS_ERROR_OBJECT_IS_IMMUTABLE)</span>
<a href="#l5.9"></a><span id="l5.9"> #define CAL_ATTR_SET_POST Normalize()</span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;calAttributeHelpers.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-NS_IMPL_CLASSINFO(calDateTime, NULL, 0, CAL_DATETIME_CID)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-NS_IMPL_ISUPPORTS_CI(calDateTime, calIDateTime)</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+NS_IMPL_CLASSINFO(calDateTime, nullptr, 0, CAL_DATETIME_CID)</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+NS_IMPL_ISUPPORTS_CI(calDateTime, calIDateTime, calIDateTimeLibical)</span>
<a href="#l5.16"></a><span id="l5.16"> </span>
<a href="#l5.17"></a><span id="l5.17"> calDateTime::calDateTime()</span>
<a href="#l5.18"></a><span id="l5.18">     : mImmutable(false)</span>
<a href="#l5.19"></a><span id="l5.19"> {</span>
<a href="#l5.20"></a><span id="l5.20">     Reset();</span>
<a href="#l5.21"></a><span id="l5.21"> }</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23"> calDateTime::calDateTime(icaltimetype const* atimeptr, calITimezone *tz)</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineat">@@ -163,18 +163,22 @@ calDateTime::SetNativeTime(PRTime aNativ</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26"> NS_IMETHODIMP</span>
<a href="#l5.27"></a><span id="l5.27"> calDateTime::AddDuration(calIDuration *aDuration)</span>
<a href="#l5.28"></a><span id="l5.28"> {</span>
<a href="#l5.29"></a><span id="l5.29">     NS_ENSURE_FALSE(mImmutable, NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l5.30"></a><span id="l5.30">     NS_ENSURE_ARG_POINTER(aDuration);</span>
<a href="#l5.31"></a><span id="l5.31">     ensureTimezone();</span>
<a href="#l5.32"></a><span id="l5.32"> </span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+    nsresult rv;</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+    nsCOMPtr&lt;calIDurationLibical&gt; icaldur = do_QueryInterface(aDuration, &amp;rv);</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+</span>
<a href="#l5.37"></a><span id="l5.37">     icaldurationtype idt;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-    aDuration-&gt;ToIcalDuration(&amp;idt);</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+    icaldur-&gt;ToIcalDuration(&amp;idt);</span>
<a href="#l5.40"></a><span id="l5.40"> </span>
<a href="#l5.41"></a><span id="l5.41">     icaltimetype itt;</span>
<a href="#l5.42"></a><span id="l5.42">     ToIcalTime(&amp;itt);</span>
<a href="#l5.43"></a><span id="l5.43"> </span>
<a href="#l5.44"></a><span id="l5.44">     icaltimetype const newitt = icaltime_add(itt, idt);</span>
<a href="#l5.45"></a><span id="l5.45">     FromIcalTime(&amp;newitt, mTimezone);</span>
<a href="#l5.46"></a><span id="l5.46"> </span>
<a href="#l5.47"></a><span id="l5.47">     return NS_OK;</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineat">@@ -563,29 +567,33 @@ void calDateTime::PRTimeToIcaltime(PRTim</span>
<a href="#l5.49"></a><span id="l5.49"> }</span>
<a href="#l5.50"></a><span id="l5.50"> </span>
<a href="#l5.51"></a><span id="l5.51"> NS_IMETHODIMP</span>
<a href="#l5.52"></a><span id="l5.52"> calDateTime::Compare(calIDateTime * aOther, int32_t * aResult)</span>
<a href="#l5.53"></a><span id="l5.53"> {</span>
<a href="#l5.54"></a><span id="l5.54">     NS_ENSURE_ARG_POINTER(aOther);</span>
<a href="#l5.55"></a><span id="l5.55">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l5.56"></a><span id="l5.56"> </span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+    nsresult rv;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+    nsCOMPtr&lt;calIDateTimeLibical&gt; icalother = do_QueryInterface(aOther, &amp;rv);</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+</span>
<a href="#l5.61"></a><span id="l5.61">     bool otherIsDate = false;</span>
<a href="#l5.62"></a><span id="l5.62">     aOther-&gt;GetIsDate(&amp;otherIsDate);</span>
<a href="#l5.63"></a><span id="l5.63"> </span>
<a href="#l5.64"></a><span id="l5.64">     icaltimetype a, b;</span>
<a href="#l5.65"></a><span id="l5.65">     ToIcalTime(&amp;a);</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-    aOther-&gt;ToIcalTime(&amp;b);</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+    icalother-&gt;ToIcalTime(&amp;b);</span>
<a href="#l5.68"></a><span id="l5.68"> </span>
<a href="#l5.69"></a><span id="l5.69">     // If either this or aOther is floating, both objects are treated</span>
<a href="#l5.70"></a><span id="l5.70">     // as floating for the comparison.</span>
<a href="#l5.71"></a><span id="l5.71">     if (!a.zone || !b.zone) {</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-        a.zone = NULL;</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+        a.zone = nullptr;</span>
<a href="#l5.74"></a><span id="l5.74">         a.is_utc = 0;</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-        b.zone = NULL;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+        b.zone = nullptr;</span>
<a href="#l5.77"></a><span id="l5.77">         b.is_utc = 0;</span>
<a href="#l5.78"></a><span id="l5.78">     }</span>
<a href="#l5.79"></a><span id="l5.79"> </span>
<a href="#l5.80"></a><span id="l5.80">     if (mIsDate || otherIsDate) {</span>
<a href="#l5.81"></a><span id="l5.81">         *aResult = icaltime_compare_date_only_tz(a, b, cal::getIcalTimezone(mTimezone));</span>
<a href="#l5.82"></a><span id="l5.82">     } else {</span>
<a href="#l5.83"></a><span id="l5.83">         *aResult = icaltime_compare(a, b);</span>
<a href="#l5.84"></a><span id="l5.84">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/backend/libical/calDateTime.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/backend/libical/calDateTime.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -6,25 +6,26 @@</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5"> #include &quot;calIDateTime.h&quot;</span>
<a href="#l6.6"></a><span id="l6.6"> #include &quot;calITimezoneProvider.h&quot;</span>
<a href="#l6.7"></a><span id="l6.7"> #include &quot;calUtils.h&quot;</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> struct icaltimetype;</span>
<a href="#l6.10"></a><span id="l6.10"> typedef struct _icaltimezone icaltimezone;</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-class calDateTime : public calIDateTime,</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+class calDateTime : public calIDateTimeLibical,</span>
<a href="#l6.14"></a><span id="l6.14">                     public cal::XpcomBase</span>
<a href="#l6.15"></a><span id="l6.15"> {</span>
<a href="#l6.16"></a><span id="l6.16"> public:</span>
<a href="#l6.17"></a><span id="l6.17">     calDateTime();</span>
<a href="#l6.18"></a><span id="l6.18">     calDateTime(icaltimetype const* icalt, calITimezone * tz);</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20">     NS_DECL_ISUPPORTS</span>
<a href="#l6.21"></a><span id="l6.21">     NS_DECL_CALIDATETIME</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+    NS_DECL_CALIDATETIMELIBICAL</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24"> protected:</span>
<a href="#l6.25"></a><span id="l6.25">     virtual ~calDateTime() {}</span>
<a href="#l6.26"></a><span id="l6.26">     bool mImmutable;</span>
<a href="#l6.27"></a><span id="l6.27">     bool mIsValid;</span>
<a href="#l6.28"></a><span id="l6.28">     bool mIsDate;</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30">     int16_t mYear;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/backend/libical/calDuration.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/backend/libical/calDuration.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -13,18 +13,18 @@</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> #include &quot;calUtils.h&quot;</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> #define SECONDS_PER_WEEK   604800</span>
<a href="#l7.8"></a><span id="l7.8"> #define SECONDS_PER_DAY     86400</span>
<a href="#l7.9"></a><span id="l7.9"> #define SECONDS_PER_HOUR     3600</span>
<a href="#l7.10"></a><span id="l7.10"> #define SECONDS_PER_MINUTE     60</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-NS_IMPL_CLASSINFO(calDuration, NULL, 0, CAL_DURATION_CID)</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-NS_IMPL_ISUPPORTS_CI(calDuration, calIDuration)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+NS_IMPL_CLASSINFO(calDuration, nullptr, 0, CAL_DURATION_CID)</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+NS_IMPL_ISUPPORTS_CI(calDuration, calIDuration, calIDurationLibical)</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17"> calDuration::calDuration()</span>
<a href="#l7.18"></a><span id="l7.18">     : mImmutable(false)</span>
<a href="#l7.19"></a><span id="l7.19"> {</span>
<a href="#l7.20"></a><span id="l7.20">     Reset();</span>
<a href="#l7.21"></a><span id="l7.21"> }</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23"> calDuration::calDuration(const calDuration&amp; cdt)</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineat">@@ -214,18 +214,22 @@ NS_IMETHODIMP calDuration::SetInSeconds(</span>
<a href="#l7.25"></a><span id="l7.25">     return NS_OK;</span>
<a href="#l7.26"></a><span id="l7.26"> }</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28"> NS_IMETHODIMP calDuration::AddDuration(calIDuration *aDuration)</span>
<a href="#l7.29"></a><span id="l7.29"> {</span>
<a href="#l7.30"></a><span id="l7.30">     if (mImmutable)</span>
<a href="#l7.31"></a><span id="l7.31">         return NS_ERROR_CALENDAR_IMMUTABLE;</span>
<a href="#l7.32"></a><span id="l7.32"> </span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+    nsresult rv;</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+    nsCOMPtr&lt;calIDurationLibical&gt; icaldur = do_QueryInterface(aDuration, &amp;rv);</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+</span>
<a href="#l7.37"></a><span id="l7.37">     struct icaldurationtype idt;</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-    aDuration-&gt;ToIcalDuration(&amp;idt);</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+    icaldur-&gt;ToIcalDuration(&amp;idt);</span>
<a href="#l7.40"></a><span id="l7.40"> </span>
<a href="#l7.41"></a><span id="l7.41">     // Calculate the new absolute value of the duration</span>
<a href="#l7.42"></a><span id="l7.42">     // For two negative durations, the abs. value will increase,</span>
<a href="#l7.43"></a><span id="l7.43">     // so use + in that case.</span>
<a href="#l7.44"></a><span id="l7.44">     // Of course, also use + when both durations are positive.</span>
<a href="#l7.45"></a><span id="l7.45">     if (idt.is_neg == mDuration.is_neg) {</span>
<a href="#l7.46"></a><span id="l7.46">         mDuration.weeks   += idt.weeks;</span>
<a href="#l7.47"></a><span id="l7.47">         mDuration.days    += idt.days;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/backend/libical/calDuration.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/backend/libical/calDuration.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -7,28 +7,29 @@</span>
<a href="#l8.4"></a><span id="l8.4"> #define CALDURATION_H_</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> #include &quot;calIDuration.h&quot;</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> extern &quot;C&quot; {</span>
<a href="#l8.9"></a><span id="l8.9">     #include &quot;ical.h&quot;</span>
<a href="#l8.10"></a><span id="l8.10"> }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-class calDuration MOZ_FINAL : public calIDuration</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+class calDuration MOZ_FINAL : public calIDurationLibical</span>
<a href="#l8.14"></a><span id="l8.14"> {</span>
<a href="#l8.15"></a><span id="l8.15"> public:</span>
<a href="#l8.16"></a><span id="l8.16">     calDuration ();</span>
<a href="#l8.17"></a><span id="l8.17">     calDuration (const calDuration&amp; cdt);</span>
<a href="#l8.18"></a><span id="l8.18">     calDuration (const struct icaldurationtype * const aDurationPtr);</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">     // nsISupports interface</span>
<a href="#l8.21"></a><span id="l8.21">     NS_DECL_ISUPPORTS</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23">     // calIDateTime interface</span>
<a href="#l8.24"></a><span id="l8.24">     NS_DECL_CALIDURATION</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+    NS_DECL_CALIDURATIONLIBICAL</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27"> protected:</span>
<a href="#l8.28"></a><span id="l8.28">     ~calDuration() {}</span>
<a href="#l8.29"></a><span id="l8.29">     bool mImmutable;</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31">     struct icaldurationtype mDuration;</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33">     void FromIcalDuration(const struct icaldurationtype * const icald);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/backend/libical/calICSService.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/backend/libical/calICSService.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -17,18 +17,18 @@ extern &quot;C&quot; {</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5"> calIcalProperty::~calIcalProperty()</span>
<a href="#l9.6"></a><span id="l9.6"> {</span>
<a href="#l9.7"></a><span id="l9.7">     if (!mParent) {</span>
<a href="#l9.8"></a><span id="l9.8">         icalproperty_free(mProperty);</span>
<a href="#l9.9"></a><span id="l9.9">     }</span>
<a href="#l9.10"></a><span id="l9.10"> }</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-NS_IMPL_CLASSINFO(calIcalProperty, NULL, 0, CAL_ICALPROPERTY_CID)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-NS_IMPL_ISUPPORTS_CI(calIcalProperty, calIIcalProperty)</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+NS_IMPL_CLASSINFO(calIcalProperty, nullptr, 0, CAL_ICALPROPERTY_CID)</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+NS_IMPL_ISUPPORTS_CI(calIcalProperty, calIIcalProperty, calIIcalPropertyLibical)</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17"> NS_IMETHODIMP_(icalproperty *)</span>
<a href="#l9.18"></a><span id="l9.18"> calIcalProperty::GetLibicalProperty()</span>
<a href="#l9.19"></a><span id="l9.19"> {</span>
<a href="#l9.20"></a><span id="l9.20">     return mProperty;</span>
<a href="#l9.21"></a><span id="l9.21"> }</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23"> NS_IMETHODIMP_(icalcomponent *)</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineat">@@ -107,17 +107,17 @@ calIcalProperty::SetValue(const nsACStri</span>
<a href="#l9.25"></a><span id="l9.25">     if (kind == ICAL_TEXT_VALUE) {</span>
<a href="#l9.26"></a><span id="l9.26">         icalvalue *v = icalvalue_new_text(PromiseFlatCString(str).get());</span>
<a href="#l9.27"></a><span id="l9.27">         icalproperty_set_value(mProperty, v);</span>
<a href="#l9.28"></a><span id="l9.28">     } else if (kind == ICAL_X_VALUE) {</span>
<a href="#l9.29"></a><span id="l9.29">         icalvalue *v = icalvalue_new_x(PromiseFlatCString(str).get());</span>
<a href="#l9.30"></a><span id="l9.30">         icalproperty_set_value(mProperty, v);</span>
<a href="#l9.31"></a><span id="l9.31">     } else if (kind == ICAL_ATTACH_VALUE) {</span>
<a href="#l9.32"></a><span id="l9.32">         const char *strdata = PromiseFlatCString(str).get();</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-        icalattach *v = icalattach_new_from_data(strdata, NULL, NULL);</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+        icalattach *v = icalattach_new_from_data(strdata, nullptr, nullptr);</span>
<a href="#l9.35"></a><span id="l9.35">         icalproperty_set_attach(mProperty, v);</span>
<a href="#l9.36"></a><span id="l9.36">     } else {</span>
<a href="#l9.37"></a><span id="l9.37">         icalproperty_set_value_from_string(mProperty,</span>
<a href="#l9.38"></a><span id="l9.38">                                            PromiseFlatCString(str).get(),</span>
<a href="#l9.39"></a><span id="l9.39">                                            icalvalue_kind_to_string(kind));</span>
<a href="#l9.40"></a><span id="l9.40">     }</span>
<a href="#l9.41"></a><span id="l9.41">     return NS_OK;</span>
<a href="#l9.42"></a><span id="l9.42"> }</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineat">@@ -769,23 +769,27 @@ calIcalProperty::SetValueAsDatetime(calI</span>
<a href="#l9.44"></a><span id="l9.44"> </span>
<a href="#l9.45"></a><span id="l9.45"> nsresult calIcalProperty::setDatetime_(calIcalComponent * parent,</span>
<a href="#l9.46"></a><span id="l9.46">                                        icalproperty * prop,</span>
<a href="#l9.47"></a><span id="l9.47">                                        calIDateTime * dt)</span>
<a href="#l9.48"></a><span id="l9.48"> {</span>
<a href="#l9.49"></a><span id="l9.49">     NS_ENSURE_ARG_POINTER(prop);</span>
<a href="#l9.50"></a><span id="l9.50">     NS_ENSURE_ARG_POINTER(dt);</span>
<a href="#l9.51"></a><span id="l9.51"> </span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+    nsresult rv;</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+    nsCOMPtr&lt;calIDateTimeLibical&gt; icaldt = do_QueryInterface(dt, &amp;rv);</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+</span>
<a href="#l9.56"></a><span id="l9.56">     icaltimetype itt;</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineminus">-    dt-&gt;ToIcalTime(&amp;itt);</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+    icaldt-&gt;ToIcalTime(&amp;itt);</span>
<a href="#l9.59"></a><span id="l9.59"> </span>
<a href="#l9.60"></a><span id="l9.60">     if (parent) {</span>
<a href="#l9.61"></a><span id="l9.61">         if (!itt.is_utc) {</span>
<a href="#l9.62"></a><span id="l9.62">             nsCOMPtr&lt;calITimezone&gt; tz;</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-            nsresult rv = dt-&gt;GetTimezone(getter_AddRefs(tz));</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+            rv = dt-&gt;GetTimezone(getter_AddRefs(tz));</span>
<a href="#l9.65"></a><span id="l9.65">             NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.66"></a><span id="l9.66">             if (itt.zone) {</span>
<a href="#l9.67"></a><span id="l9.67">                 rv = parent-&gt;getParentVCalendarOrThis()-&gt;AddTimezoneReference(tz);</span>
<a href="#l9.68"></a><span id="l9.68">                 NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.69"></a><span id="l9.69">                 icalparameter * const param = icalparameter_new_from_value_string(</span>
<a href="#l9.70"></a><span id="l9.70">                     ICAL_TZID_PARAMETER, icaltimezone_get_tzid(const_cast&lt;icaltimezone *&gt;(itt.zone)));</span>
<a href="#l9.71"></a><span id="l9.71">                 icalproperty_set_parameter(prop, param);</span>
<a href="#l9.72"></a><span id="l9.72">             } else { // either floating or phantom:</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineat">@@ -847,20 +851,19 @@ calIcalComponent::Get##Attrname(calIDura</span>
<a href="#l9.74"></a><span id="l9.74">         icalvalue_get_duration(icalproperty_get_value(prop));           \</span>
<a href="#l9.75"></a><span id="l9.75">     *dtp = new calDuration(&amp;idt);                                       \</span>
<a href="#l9.76"></a><span id="l9.76">     CAL_ENSURE_MEMORY(*dtp);                                            \</span>
<a href="#l9.77"></a><span id="l9.77">     NS_ADDREF(*dtp);                                                    \</span>
<a href="#l9.78"></a><span id="l9.78">     return NS_OK;                                                       \</span>
<a href="#l9.79"></a><span id="l9.79"> }</span>
<a href="#l9.80"></a><span id="l9.80"> </span>
<a href="#l9.81"></a><span id="l9.81"> </span>
<a href="#l9.82"></a><span id="l9.82" class="difflineminus">-NS_IMPL_CLASSINFO(calIcalComponent, NULL, nsIClassInfo::THREADSAFE, CAL_ICALCOMPONENT_CID)</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-NS_IMPL_ISUPPORTS(calIcalComponent, calIIcalComponent, nsIClassInfo)</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">-NS_IMPL_CI_INTERFACE_GETTER(calIcalComponent, calIIcalComponent)</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-NS_IMPL_THREADSAFE_CI(calIcalComponent)</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+NS_IMPL_CLASSINFO(calIcalComponent, nullptr, nsIClassInfo::THREADSAFE, CAL_ICALCOMPONENT_CID)</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+NS_IMPL_ISUPPORTS_CI(calIcalComponent, calIIcalComponent, calIIcalComponentLibical)</span>
<a href="#l9.89"></a><span id="l9.89"> </span>
<a href="#l9.90"></a><span id="l9.90"> NS_IMETHODIMP_(icalcomponent *)</span>
<a href="#l9.91"></a><span id="l9.91"> calIcalComponent::GetLibicalComponent()</span>
<a href="#l9.92"></a><span id="l9.92"> {</span>
<a href="#l9.93"></a><span id="l9.93">     return mComponent;</span>
<a href="#l9.94"></a><span id="l9.94"> }</span>
<a href="#l9.95"></a><span id="l9.95"> </span>
<a href="#l9.96"></a><span id="l9.96"> NS_IMETHODIMP_(icaltimezone *)</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineat">@@ -1064,34 +1067,39 @@ calIcalComponent::Clone(calIIcalComponen</span>
<a href="#l9.98"></a><span id="l9.98">         icalcomponent_free(cloned);</span>
<a href="#l9.99"></a><span id="l9.99">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l9.100"></a><span id="l9.100">     }</span>
<a href="#l9.101"></a><span id="l9.101">     NS_ADDREF(*_retval = comp);</span>
<a href="#l9.102"></a><span id="l9.102">     return NS_OK;</span>
<a href="#l9.103"></a><span id="l9.103"> }</span>
<a href="#l9.104"></a><span id="l9.104"> </span>
<a href="#l9.105"></a><span id="l9.105"> NS_IMETHODIMP</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineminus">-calIcalComponent::AddSubcomponent(calIIcalComponent *comp)</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+calIcalComponent::AddSubcomponent(calIIcalComponent *aComp)</span>
<a href="#l9.108"></a><span id="l9.108"> {</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineminus">-    NS_ENSURE_ARG_POINTER(comp);</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineplus">+    NS_ENSURE_ARG_POINTER(aComp);</span>
<a href="#l9.111"></a><span id="l9.111"> </span>
<a href="#l9.112"></a><span id="l9.112">     /* XXX mildly unsafe assumption here.</span>
<a href="#l9.113"></a><span id="l9.113">      * To fix it, I will:</span>
<a href="#l9.114"></a><span id="l9.114">      * - check the object's classinfo to find out if I have one of my</span>
<a href="#l9.115"></a><span id="l9.115">      *   own objects, and if not</span>
<a href="#l9.116"></a><span id="l9.116">      * - use comp-&gt;serializeToICS and reparse to create a copy.</span>
<a href="#l9.117"></a><span id="l9.117">      *</span>
<a href="#l9.118"></a><span id="l9.118">      * I should probably also return the new/reused component so that the</span>
<a href="#l9.119"></a><span id="l9.119">      * caller has something it can poke at all live-like.</span>
<a href="#l9.120"></a><span id="l9.120">      */</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineminus">-    calIcalComponent * const ical = toIcalComponent(comp);</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineplus">+</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineplus">+    nsresult rv;</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineplus">+    nsCOMPtr&lt;calIIcalComponentLibical&gt; icalcomp = do_QueryInterface(aComp, &amp;rv);</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineplus">+</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+    calIcalComponent * const ical = toIcalComponent(icalcomp);</span>
<a href="#l9.128"></a><span id="l9.128"> </span>
<a href="#l9.129"></a><span id="l9.129">     uint32_t tzCount = 0;</span>
<a href="#l9.130"></a><span id="l9.130">     calITimezone ** timezones = nullptr;</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineminus">-    nsresult rv = ical-&gt;GetReferencedTimezones(&amp;tzCount, &amp;timezones);</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineplus">+    rv = ical-&gt;GetReferencedTimezones(&amp;tzCount, &amp;timezones);</span>
<a href="#l9.133"></a><span id="l9.133">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.134"></a><span id="l9.134"> </span>
<a href="#l9.135"></a><span id="l9.135">     calIcalComponent * const vcal = getParentVCalendarOrThis();</span>
<a href="#l9.136"></a><span id="l9.136">     bool failed = false;</span>
<a href="#l9.137"></a><span id="l9.137">     for (uint32_t i = 0; i &lt; tzCount; i++) {</span>
<a href="#l9.138"></a><span id="l9.138">         if (!failed) {</span>
<a href="#l9.139"></a><span id="l9.139">             rv = vcal-&gt;AddTimezoneReference(timezones[i]);</span>
<a href="#l9.140"></a><span id="l9.140">             if (NS_FAILED(rv))</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineat">@@ -1194,31 +1202,36 @@ calIcalComponent::GetNextProperty(const </span>
<a href="#l9.142"></a><span id="l9.142"> </span>
<a href="#l9.143"></a><span id="l9.143">     *prop = new calIcalProperty(icalprop, this);</span>
<a href="#l9.144"></a><span id="l9.144">     CAL_ENSURE_MEMORY(*prop);</span>
<a href="#l9.145"></a><span id="l9.145">     NS_ADDREF(*prop);</span>
<a href="#l9.146"></a><span id="l9.146">     return NS_OK;</span>
<a href="#l9.147"></a><span id="l9.147"> }</span>
<a href="#l9.148"></a><span id="l9.148"> </span>
<a href="#l9.149"></a><span id="l9.149"> NS_IMETHODIMP</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineminus">-calIcalComponent::AddProperty(calIIcalProperty * prop)</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineplus">+calIcalComponent::AddProperty(calIIcalProperty * aProp)</span>
<a href="#l9.152"></a><span id="l9.152"> {</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineminus">-    NS_ENSURE_ARG_POINTER(prop);</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineplus">+    NS_ENSURE_ARG_POINTER(aProp);</span>
<a href="#l9.155"></a><span id="l9.155">     // We assume a calIcalProperty is passed in (else the cast wouldn't run and</span>
<a href="#l9.156"></a><span id="l9.156">     // we are about to crash), so we assume that this ICS service code has created</span>
<a href="#l9.157"></a><span id="l9.157">     // the property.</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineminus">-    calIcalProperty * const ical = toIcalProperty(prop);</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineplus">+</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineplus">+    nsresult rv;</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineplus">+    nsCOMPtr&lt;calIIcalPropertyLibical&gt; icalprop = do_QueryInterface(aProp, &amp;rv);</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineplus">+</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineplus">+    calIcalProperty * const ical = toIcalProperty(icalprop);</span>
<a href="#l9.165"></a><span id="l9.165">     if (ical-&gt;mParent) {</span>
<a href="#l9.166"></a><span id="l9.166">         ical-&gt;mProperty = icalproperty_new_clone(ical-&gt;mProperty);</span>
<a href="#l9.167"></a><span id="l9.167">     }</span>
<a href="#l9.168"></a><span id="l9.168">     ical-&gt;mParent = this;</span>
<a href="#l9.169"></a><span id="l9.169">     icalcomponent_add_property(mComponent, ical-&gt;mProperty);</span>
<a href="#l9.170"></a><span id="l9.170"> </span>
<a href="#l9.171"></a><span id="l9.171">     nsCOMPtr&lt;calIDateTime&gt; dt;</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineminus">-    if (NS_SUCCEEDED(prop-&gt;GetValueAsDatetime(getter_AddRefs(dt))) &amp;&amp; dt) {</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+    if (NS_SUCCEEDED(aProp-&gt;GetValueAsDatetime(getter_AddRefs(dt))) &amp;&amp; dt) {</span>
<a href="#l9.174"></a><span id="l9.174">         // make sure timezone definition will be included:</span>
<a href="#l9.175"></a><span id="l9.175">         nsCOMPtr&lt;calITimezone&gt; tz;</span>
<a href="#l9.176"></a><span id="l9.176">         if (NS_SUCCEEDED(dt-&gt;GetTimezone(getter_AddRefs(tz))) &amp;&amp; tz) {</span>
<a href="#l9.177"></a><span id="l9.177">             getParentVCalendarOrThis()-&gt;AddTimezoneReference(tz);</span>
<a href="#l9.178"></a><span id="l9.178">         }</span>
<a href="#l9.179"></a><span id="l9.179">     }</span>
<a href="#l9.180"></a><span id="l9.180">     return NS_OK;</span>
<a href="#l9.181"></a><span id="l9.181"> }</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineat">@@ -1232,20 +1245,18 @@ calIcalComponent::AddProperty(calIIcalPr</span>
<a href="#l9.183"></a><span id="l9.183"> //     NS_ENSURE_ARG_POINTER(prop);</span>
<a href="#l9.184"></a><span id="l9.184"> //     // XXX like AddSubcomponent, this is questionable</span>
<a href="#l9.185"></a><span id="l9.185"> //     calIcalProperty *ical = static_cast&lt;calIcalProperty *&gt;(prop);</span>
<a href="#l9.186"></a><span id="l9.186"> //     icalcomponent_remove_property(mComponent, ical-&gt;mProperty);</span>
<a href="#l9.187"></a><span id="l9.187"> //     ical-&gt;mParent = nullptr;</span>
<a href="#l9.188"></a><span id="l9.188"> //     return NS_OK;</span>
<a href="#l9.189"></a><span id="l9.189"> // }</span>
<a href="#l9.190"></a><span id="l9.190"> </span>
<a href="#l9.191"></a><span id="l9.191" class="difflineminus">-NS_IMPL_CLASSINFO(calICSService, NULL, nsIClassInfo::THREADSAFE, CAL_ICSSERVICE_CID)</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineminus">-NS_IMPL_ISUPPORTS(calICSService, calIICSService, nsIClassInfo)</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineminus">-NS_IMPL_CI_INTERFACE_GETTER(calICSService, calIICSService)</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineminus">-NS_IMPL_THREADSAFE_CI(calICSService)</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineplus">+NS_IMPL_CLASSINFO(calICSService, nullptr, nsIClassInfo::THREADSAFE, CAL_ICSSERVICE_CID)</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineplus">+NS_IMPL_ISUPPORTS_CI(calICSService, calIICSService)</span>
<a href="#l9.197"></a><span id="l9.197"> </span>
<a href="#l9.198"></a><span id="l9.198"> calICSService::calICSService()</span>
<a href="#l9.199"></a><span id="l9.199"> {</span>
<a href="#l9.200"></a><span id="l9.200"> }</span>
<a href="#l9.201"></a><span id="l9.201"> </span>
<a href="#l9.202"></a><span id="l9.202"> NS_IMETHODIMP</span>
<a href="#l9.203"></a><span id="l9.203"> calICSService::ParseICS(const nsACString&amp; serialized,</span>
<a href="#l9.204"></a><span id="l9.204">                         calITimezoneProvider *tzProvider,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/backend/libical/calICSService.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/backend/libical/calICSService.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -12,17 +12,16 @@</span>
<a href="#l10.4"></a><span id="l10.4"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l10.5"></a><span id="l10.5"> #include &quot;calUtils.h&quot;</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7"> extern &quot;C&quot; {</span>
<a href="#l10.8"></a><span id="l10.8"> #include &quot;ical.h&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> }</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11"> class calICSService : public calIICSService,</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-                      public nsIClassInfo,</span>
<a href="#l10.13"></a><span id="l10.13">                       public cal::XpcomBase</span>
<a href="#l10.14"></a><span id="l10.14"> {</span>
<a href="#l10.15"></a><span id="l10.15"> protected:</span>
<a href="#l10.16"></a><span id="l10.16">     virtual ~calICSService() {}</span>
<a href="#l10.17"></a><span id="l10.17">     class ParserWorker : public nsRunnable {</span>
<a href="#l10.18"></a><span id="l10.18">     public:</span>
<a href="#l10.19"></a><span id="l10.19">       ParserWorker(nsIThread *mainThread,</span>
<a href="#l10.20"></a><span id="l10.20">                    nsIThread *workerThread,</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -45,106 +44,105 @@ protected:</span>
<a href="#l10.22"></a><span id="l10.22">       nsCOMPtr&lt;nsIThread&gt; mWorkerThread;</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24">       class ParserWorkerCompleter : public nsRunnable {</span>
<a href="#l10.25"></a><span id="l10.25">       public:</span>
<a href="#l10.26"></a><span id="l10.26">         ParserWorkerCompleter(nsIThread *workerThread,</span>
<a href="#l10.27"></a><span id="l10.27">                               nsresult status,</span>
<a href="#l10.28"></a><span id="l10.28">                               calIIcalComponent *component,</span>
<a href="#l10.29"></a><span id="l10.29">                               const nsMainThreadPtrHandle&lt;calIIcsComponentParsingListener&gt; &amp;listener) :</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-          mListener(listener), mComp(component),</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-          mStatus(status), mWorkerThread(workerThread)</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+          mWorkerThread(workerThread), mListener(listener),</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+          mComp(component), mStatus(status)</span>
<a href="#l10.34"></a><span id="l10.34">         {</span>
<a href="#l10.35"></a><span id="l10.35">         }</span>
<a href="#l10.36"></a><span id="l10.36"> </span>
<a href="#l10.37"></a><span id="l10.37">         NS_DECL_NSIRUNNABLE</span>
<a href="#l10.38"></a><span id="l10.38">       protected:</span>
<a href="#l10.39"></a><span id="l10.39">         nsCOMPtr&lt;nsIThread&gt; mWorkerThread;</span>
<a href="#l10.40"></a><span id="l10.40">         nsMainThreadPtrHandle&lt;calIIcsComponentParsingListener&gt; mListener;</span>
<a href="#l10.41"></a><span id="l10.41">         nsCOMPtr&lt;calIIcalComponent&gt; mComp;</span>
<a href="#l10.42"></a><span id="l10.42">         nsresult mStatus;</span>
<a href="#l10.43"></a><span id="l10.43">       };</span>
<a href="#l10.44"></a><span id="l10.44">     };</span>
<a href="#l10.45"></a><span id="l10.45"> public:</span>
<a href="#l10.46"></a><span id="l10.46">     calICSService();</span>
<a href="#l10.47"></a><span id="l10.47"> </span>
<a href="#l10.48"></a><span id="l10.48">     NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-    NS_DECL_NSICLASSINFO</span>
<a href="#l10.50"></a><span id="l10.50">     NS_DECL_CALIICSSERVICE</span>
<a href="#l10.51"></a><span id="l10.51"> };</span>
<a href="#l10.52"></a><span id="l10.52"> </span>
<a href="#l10.53"></a><span id="l10.53"> class calIcalComponent;</span>
<a href="#l10.54"></a><span id="l10.54"> </span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-class calIcalProperty : public calIIcalProperty,</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+class calIcalProperty : public calIIcalPropertyLibical,</span>
<a href="#l10.57"></a><span id="l10.57">                         public cal::XpcomBase</span>
<a href="#l10.58"></a><span id="l10.58"> {</span>
<a href="#l10.59"></a><span id="l10.59">     friend class calIcalComponent;</span>
<a href="#l10.60"></a><span id="l10.60"> public:</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">-    calIcalProperty(icalproperty * prop, calIIcalComponent * parent)</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+    calIcalProperty(icalproperty * prop, calIIcalComponentLibical * parent)</span>
<a href="#l10.63"></a><span id="l10.63">         : mProperty(prop), mParent(parent) {}</span>
<a href="#l10.64"></a><span id="l10.64"> </span>
<a href="#l10.65"></a><span id="l10.65">     NS_DECL_ISUPPORTS</span>
<a href="#l10.66"></a><span id="l10.66">     NS_DECL_CALIICALPROPERTY</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+    NS_DECL_CALIICALPROPERTYLIBICAL</span>
<a href="#l10.68"></a><span id="l10.68"> </span>
<a href="#l10.69"></a><span id="l10.69"> protected:</span>
<a href="#l10.70"></a><span id="l10.70">     virtual ~calIcalProperty();</span>
<a href="#l10.71"></a><span id="l10.71"> </span>
<a href="#l10.72"></a><span id="l10.72">     static nsresult getDatetime_(calIcalComponent *parent,</span>
<a href="#l10.73"></a><span id="l10.73">                                  icalproperty *prop,</span>
<a href="#l10.74"></a><span id="l10.74">                                  calIDateTime **dtp);</span>
<a href="#l10.75"></a><span id="l10.75">     static nsresult setDatetime_(calIcalComponent *parent,</span>
<a href="#l10.76"></a><span id="l10.76">                                  icalproperty *prop,</span>
<a href="#l10.77"></a><span id="l10.77">                                  calIDateTime *dt);</span>
<a href="#l10.78"></a><span id="l10.78"> </span>
<a href="#l10.79"></a><span id="l10.79" class="difflineminus">-    icalproperty *              mProperty;</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineminus">-    nsCOMPtr&lt;calIIcalComponent&gt; mParent;</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+    icalproperty *                     mProperty;</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+    nsCOMPtr&lt;calIIcalComponentLibical&gt; mParent;</span>
<a href="#l10.83"></a><span id="l10.83"> };</span>
<a href="#l10.84"></a><span id="l10.84"> </span>
<a href="#l10.85"></a><span id="l10.85" class="difflineminus">-class calIcalComponent : public calIIcalComponent,</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineminus">-                         public nsIClassInfo,</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+class calIcalComponent : public calIIcalComponentLibical,</span>
<a href="#l10.88"></a><span id="l10.88">                          public cal::XpcomBase</span>
<a href="#l10.89"></a><span id="l10.89"> {</span>
<a href="#l10.90"></a><span id="l10.90">     friend class calIcalProperty;</span>
<a href="#l10.91"></a><span id="l10.91"> public:</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineminus">-    calIcalComponent(icalcomponent *ical, calIIcalComponent *parent,</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+    calIcalComponent(icalcomponent *ical, calIIcalComponentLibical *parent,</span>
<a href="#l10.94"></a><span id="l10.94">                      calITimezoneProvider *tzProvider = nullptr)</span>
<a href="#l10.95"></a><span id="l10.95">         : mComponent(ical), mTimezone(nullptr), mTzProvider(tzProvider), mParent(parent)</span>
<a href="#l10.96"></a><span id="l10.96">     {</span>
<a href="#l10.97"></a><span id="l10.97">     }</span>
<a href="#l10.98"></a><span id="l10.98"> </span>
<a href="#l10.99"></a><span id="l10.99">     // VTIMEZONE ctor</span>
<a href="#l10.100"></a><span id="l10.100">     calIcalComponent(icaltimezone * icaltz, icalcomponent * ical) : mComponent(ical), mTimezone(icaltz) {</span>
<a href="#l10.101"></a><span id="l10.101">     }</span>
<a href="#l10.102"></a><span id="l10.102"> </span>
<a href="#l10.103"></a><span id="l10.103">     NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-    NS_DECL_NSICLASSINFO</span>
<a href="#l10.105"></a><span id="l10.105">     NS_DECL_CALIICALCOMPONENT</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineplus">+    NS_DECL_CALIICALCOMPONENTLIBICAL</span>
<a href="#l10.107"></a><span id="l10.107"> </span>
<a href="#l10.108"></a><span id="l10.108"> protected:</span>
<a href="#l10.109"></a><span id="l10.109">     virtual ~calIcalComponent();</span>
<a href="#l10.110"></a><span id="l10.110"> </span>
<a href="#l10.111"></a><span id="l10.111">     calITimezoneProvider * getTzProvider() const {</span>
<a href="#l10.112"></a><span id="l10.112">         // walk up the parents to find a tz provider:</span>
<a href="#l10.113"></a><span id="l10.113">         calIcalComponent const * that = this;</span>
<a href="#l10.114"></a><span id="l10.114">         while (that) {</span>
<a href="#l10.115"></a><span id="l10.115">             calITimezoneProvider * const ret = that-&gt;mTzProvider;</span>
<a href="#l10.116"></a><span id="l10.116">             if (ret) {</span>
<a href="#l10.117"></a><span id="l10.117">                 return ret;</span>
<a href="#l10.118"></a><span id="l10.118">             }</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineminus">-            calIIcalComponent * const p = that-&gt;mParent;</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineplus">+            calIIcalComponentLibical * const p = that-&gt;mParent;</span>
<a href="#l10.121"></a><span id="l10.121">             that = static_cast&lt;calIcalComponent const *&gt;(p);</span>
<a href="#l10.122"></a><span id="l10.122">         }</span>
<a href="#l10.123"></a><span id="l10.123">         return nullptr;</span>
<a href="#l10.124"></a><span id="l10.124">     }</span>
<a href="#l10.125"></a><span id="l10.125"> </span>
<a href="#l10.126"></a><span id="l10.126">     calIcalComponent * getParentVCalendarOrThis() {</span>
<a href="#l10.127"></a><span id="l10.127">         // walk up the parents to find a VCALENDAR:</span>
<a href="#l10.128"></a><span id="l10.128">         calIcalComponent * that = this;</span>
<a href="#l10.129"></a><span id="l10.129">         while (that &amp;&amp; icalcomponent_isa(that-&gt;mComponent) != ICAL_VCALENDAR_COMPONENT) {</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineminus">-            calIIcalComponent * const p = that-&gt;mParent;</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineplus">+            calIIcalComponentLibical * const p = that-&gt;mParent;</span>
<a href="#l10.132"></a><span id="l10.132">             that = static_cast&lt;calIcalComponent *&gt;(p);</span>
<a href="#l10.133"></a><span id="l10.133">         }</span>
<a href="#l10.134"></a><span id="l10.134">         if (!that)</span>
<a href="#l10.135"></a><span id="l10.135">             that = this;</span>
<a href="#l10.136"></a><span id="l10.136">         return that;</span>
<a href="#l10.137"></a><span id="l10.137">     }</span>
<a href="#l10.138"></a><span id="l10.138"> </span>
<a href="#l10.139"></a><span id="l10.139">     nsresult GetDateTimeAttribute(icalproperty_kind kind, calIDateTime ** dtp);</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineat">@@ -162,19 +160,19 @@ protected:</span>
<a href="#l10.141"></a><span id="l10.141">     void ClearAllProperties(icalproperty_kind kind);</span>
<a href="#l10.142"></a><span id="l10.142"> </span>
<a href="#l10.143"></a><span id="l10.143">     nsresult Serialize(char ** icalstr);</span>
<a href="#l10.144"></a><span id="l10.144"> </span>
<a href="#l10.145"></a><span id="l10.145">     nsInterfaceHashtable&lt;nsCStringHashKey, calITimezone&gt; mReferencedTimezones;</span>
<a href="#l10.146"></a><span id="l10.146">     icalcomponent *                                      mComponent;</span>
<a href="#l10.147"></a><span id="l10.147">     icaltimezone *                                       mTimezone; // set iff VTIMEZONE</span>
<a href="#l10.148"></a><span id="l10.148">     nsCOMPtr&lt;calITimezoneProvider&gt; const                 mTzProvider;</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineminus">-    nsCOMPtr&lt;calIIcalComponent&gt;                          mParent;</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineplus">+    nsCOMPtr&lt;calIIcalComponentLibical&gt;                   mParent;</span>
<a href="#l10.151"></a><span id="l10.151"> };</span>
<a href="#l10.152"></a><span id="l10.152"> </span>
<a href="#l10.153"></a><span id="l10.153" class="difflineminus">-inline calIcalProperty * toIcalProperty(calIIcalProperty * p) {</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineplus">+inline calIcalProperty * toIcalProperty(calIIcalPropertyLibical * p) {</span>
<a href="#l10.155"></a><span id="l10.155">     return static_cast&lt;calIcalProperty *&gt;(p);</span>
<a href="#l10.156"></a><span id="l10.156"> }</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineminus">-inline calIcalComponent * toIcalComponent(calIIcalComponent * p) {</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineplus">+inline calIcalComponent * toIcalComponent(calIIcalComponentLibical * p) {</span>
<a href="#l10.159"></a><span id="l10.159">     return static_cast&lt;calIcalComponent *&gt;(p);</span>
<a href="#l10.160"></a><span id="l10.160"> }</span>
<a href="#l10.161"></a><span id="l10.161"> </span>
<a href="#l10.162"></a><span id="l10.162"> #endif // INCLUDED_CALICSSERVICE_H</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">deleted file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- a/calendar/base/backend/libical/calIDateTime.idl</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ /dev/null</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -1,226 +0,0 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineminus">-</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineminus">-#include &quot;nsISupports.idl&quot;</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">-</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineminus">-interface calIDuration;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-interface calITimezone;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-[ptr] native icaltimetypeptr(struct icaltimetype);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-[scriptable, uuid(04139dff-a6f0-446d-9aec-2062df887ef2)]</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-interface calIDateTime : nsISupports</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-{</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-  /**</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-   * isMutable is true if this instance is modifiable.</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-   * If isMutable is false, any attempts to modify</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-   * the object will throw NS_ERROR_OBJECT_IS_IMMUTABLE.</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-   */</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">-  readonly attribute boolean isMutable;</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">-</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineminus">-  /**</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">-   * Make this calIDateTime instance immutable.</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-   */</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineminus">-  void makeImmutable();</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineminus">-</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-  /**</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-   * Clone this calIDateTime instance into a new</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-   * mutable object.</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-   */</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-  calIDateTime clone();</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-  /**</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineminus">-   * valid is true if this object contains a valid</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">-   * time/date.</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineminus">-   */</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineminus">-  // true if this thing is set/valid</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineminus">-  readonly attribute boolean isValid;</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">-</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-  /**</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineminus">-   * nativeTime contains this instance's PRTime value relative</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-   * to the UTC epoch, regardless of the timezone that's set</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineminus">-   * on this instance.  If nativeTime is set, the given UTC PRTime</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-   * value is exploded into year/month/etc, forcing the timezone</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineminus">-   * setting to UTC.</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-   *</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-   * @warning: When the timezone is set to 'floating', this will return</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-   * the nativeTime as-if the timezone was UTC. Take this into account</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-   * when comparing values.</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-   *</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineminus">-   * @note on objects that are pinned to a timezone and have isDate set,</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineminus">-   * nativeTime will be 00:00:00 in the timezone of that date, not 00:00:00 in</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-   * UTC.</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-   */</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineminus">-  attribute PRTime nativeTime;</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineminus">-</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-  /**</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineminus">-   * Full 4-digit year value (e.g. &quot;1989&quot;, &quot;2004&quot;)</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineminus">-   */</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineminus">-  attribute short year;</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineminus">-</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-  /**</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineminus">-   * Month, 0-11, 0 = January</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-   */</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineminus">-  attribute short month;</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineminus">-</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineminus">-  /**</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineminus">-   * Day of month, 1-[28,29,30,31]</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineminus">-   */</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineminus">-  attribute short day;</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineminus">-</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineminus">-  /**</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineminus">-   * Hour, 0-23</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineminus">-   */</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineminus">-  attribute short hour;</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineminus">-</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineminus">-  /**</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineminus">-   * Minute, 0-59</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineminus">-   */</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineminus">-  attribute short minute;</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineminus">-</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineminus">-  /**</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineminus">-   * Second, 0-59</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineminus">-   */</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineminus">-  attribute short second;</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineminus">-</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineminus">-  /**</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineminus">-   * Gets or sets the timezone of this calIDateTime instance.</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineminus">-   * Setting the timezone does not change the actual date/time components;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineminus">-   * to convert between timezones, use getInTimezone().</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineminus">-   *</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineminus">-   * @throws NS_ERROR_INVALID_ARG if null is passed in.</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineminus">-   */</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineminus">-  attribute calITimezone timezone;</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineminus">-</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineminus">-  /**</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineminus">-   * Resets the datetime object.</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineminus">-   *</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineminus">-   * @param year     full 4-digit year value (e.g. &quot;1989&quot;, &quot;2004&quot;)</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineminus">-   * @param month    month, 0-11, 0 = January</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineminus">-   * @param day      day of month, 1-[28,29,31]</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineminus">-   * @param hour     hour, 0-23</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineminus">-   * @param minute   minute, 0-59</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineminus">-   * @param second   decond, 0-59</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineminus">-   * @param timezone timezone</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineminus">-   *</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineminus">-   * The passed datetime will be normalized, e.g. a minute value of 60 will</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineminus">-   * increase the hour.</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineminus">-   *</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineminus">-   * @throws NS_ERROR_INVALID_ARG if no timezone is passed in.</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineminus">-   */</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineminus">-  void resetTo(in short year,</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineminus">-               in short month,</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineminus">-               in short day,</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineminus">-               in short hour,</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineminus">-               in short minute,</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineminus">-               in short second,</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineminus">-               in calITimezone timezone);</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineminus">-</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineminus">-  /**</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineminus">-   * The offset of the timezone this datetime is in, relative to UTC, in</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineminus">-   * seconds. A positive number means that the timezone is ahead of UTC.</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineminus">-   */</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineminus">-  readonly attribute long timezoneOffset;</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineminus">-</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineminus">-  /**</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineminus">-   * isDate indicates that this calIDateTime instance represents a date</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineminus">-   * (a whole day), and not a specific time on that day.  If isDate is set,</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineminus">-   * accessing the hour/minute/second fields will return 0, and and setting</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineminus">-   * them is an illegal operation.</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineminus">-   */</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineminus">-  attribute boolean isDate;</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineminus">-</span>
<a href="#l11.137"></a><span id="l11.137" class="difflineminus">-  /*</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineminus">-   * computed values</span>
<a href="#l11.139"></a><span id="l11.139" class="difflineminus">-   */</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineminus">-</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineminus">-  /**</span>
<a href="#l11.142"></a><span id="l11.142" class="difflineminus">-   * Day of the week. 0-6, with Sunday = 0.</span>
<a href="#l11.143"></a><span id="l11.143" class="difflineminus">-   */</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineminus">-  readonly attribute short weekday;</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineminus">-</span>
<a href="#l11.146"></a><span id="l11.146" class="difflineminus">-  /**</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineminus">-   * Day of the year, 1-[365,366].</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineminus">-   */</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineminus">-  readonly attribute short yearday;</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineminus">-</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineminus">-  /*</span>
<a href="#l11.152"></a><span id="l11.152" class="difflineminus">-   * Methods</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineminus">-   */</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineminus">-</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineminus">-  /**</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineminus">-   * Resets this instance to Jan 1, 1970 00:00:00 UTC.</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineminus">-   */</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineminus">-  void reset();</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineminus">-</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineminus">-  /**</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineminus">-   * Return a string representation of this instance.</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineminus">-   */</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineminus">-  AUTF8String toString();</span>
<a href="#l11.164"></a><span id="l11.164" class="difflineminus">-</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineminus">-  /**</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineminus">-   * Return a new calIDateTime instance that's the result of</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineminus">-   * converting this one into the given timezone.  Valid values</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineminus">-   * for aTimezone are the same as the timezone field.  If</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineminus">-   * the &quot;floating&quot; timezone is given, then this object</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineminus">-   * is just cloned, and the timezone is set to floating.</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineminus">-   */</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineminus">-  calIDateTime getInTimezone(in calITimezone aTimezone);</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineminus">-</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineminus">-  // add the given calIDateTime, treating it as a duration, to</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineminus">-  // this item.</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineminus">-  // XXX will change</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineminus">-  void addDuration (in calIDuration aDuration);</span>
<a href="#l11.178"></a><span id="l11.178" class="difflineminus">-</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineminus">-  // Subtract two dates and return a duration</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineminus">-  // returns duration of this - aOtherDate</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineminus">-  // if aOtherDate is &gt; this the duration will be negative</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineminus">-  calIDuration subtractDate (in calIDateTime aOtherDate);</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineminus">-</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineminus">-  /**</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineminus">-   * Compare this calIDateTime instance to aOther.  Returns -1, 0, 1 to</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineminus">-   * indicate if this &lt; aOther, this == aOther, or this &gt; aOther,</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineminus">-   * respectively.</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineminus">-   *</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineminus">-   * This comparison is timezone-aware; the given values are converted</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineminus">-   * to a common timezone before comparing. If either this or aOther is</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineminus">-   * floating, both objects are treated as floating for the comparison.</span>
<a href="#l11.192"></a><span id="l11.192" class="difflineminus">-   *</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineminus">-   * If either this or aOther has isDate set, then only the date portion is</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineminus">-   * compared.</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineminus">-   *</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineminus">-   * @exception calIErrors.INVALID_TIMEZONE  bad timezone on this object</span>
<a href="#l11.197"></a><span id="l11.197" class="difflineminus">-   *                                         (not the argument object)</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineminus">-   */</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineminus">-  long compare (in calIDateTime aOther);</span>
<a href="#l11.200"></a><span id="l11.200" class="difflineminus">-</span>
<a href="#l11.201"></a><span id="l11.201" class="difflineminus">-  //</span>
<a href="#l11.202"></a><span id="l11.202" class="difflineminus">-  // Some helper getters for calculating useful ranges</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineminus">-  //</span>
<a href="#l11.204"></a><span id="l11.204" class="difflineminus">-</span>
<a href="#l11.205"></a><span id="l11.205" class="difflineminus">-  /**</span>
<a href="#l11.206"></a><span id="l11.206" class="difflineminus">-   * Returns SUNDAY of the given datetime object's week.</span>
<a href="#l11.207"></a><span id="l11.207" class="difflineminus">-   */</span>
<a href="#l11.208"></a><span id="l11.208" class="difflineminus">-  readonly attribute calIDateTime startOfWeek;</span>
<a href="#l11.209"></a><span id="l11.209" class="difflineminus">-</span>
<a href="#l11.210"></a><span id="l11.210" class="difflineminus">-  /**</span>
<a href="#l11.211"></a><span id="l11.211" class="difflineminus">-   * Returns SATURDAY of the datetime object's week.</span>
<a href="#l11.212"></a><span id="l11.212" class="difflineminus">-   */</span>
<a href="#l11.213"></a><span id="l11.213" class="difflineminus">-  readonly attribute calIDateTime endOfWeek;</span>
<a href="#l11.214"></a><span id="l11.214" class="difflineminus">-</span>
<a href="#l11.215"></a><span id="l11.215" class="difflineminus">-  // the start/end of the current object's month</span>
<a href="#l11.216"></a><span id="l11.216" class="difflineminus">-  readonly attribute calIDateTime startOfMonth;</span>
<a href="#l11.217"></a><span id="l11.217" class="difflineminus">-  readonly attribute calIDateTime endOfMonth;</span>
<a href="#l11.218"></a><span id="l11.218" class="difflineminus">-</span>
<a href="#l11.219"></a><span id="l11.219" class="difflineminus">-  // the start/end of the current object's year</span>
<a href="#l11.220"></a><span id="l11.220" class="difflineminus">-  readonly attribute calIDateTime startOfYear;</span>
<a href="#l11.221"></a><span id="l11.221" class="difflineminus">-  readonly attribute calIDateTime endOfYear;</span>
<a href="#l11.222"></a><span id="l11.222" class="difflineminus">-</span>
<a href="#l11.223"></a><span id="l11.223" class="difflineminus">-  [noscript,notxpcom] void toIcalTime(in icaltimetypeptr itt);</span>
<a href="#l11.224"></a><span id="l11.224" class="difflineminus">-</span>
<a href="#l11.225"></a><span id="l11.225" class="difflineminus">-  /**</span>
<a href="#l11.226"></a><span id="l11.226" class="difflineminus">-   * This object as either an iCalendar DATE or DATETIME string, as</span>
<a href="#l11.227"></a><span id="l11.227" class="difflineminus">-   * appropriate and sets the timezone to either UTC or floating.</span>
<a href="#l11.228"></a><span id="l11.228" class="difflineminus">-   */</span>
<a href="#l11.229"></a><span id="l11.229" class="difflineminus">-  attribute ACString icalString;</span>
<a href="#l11.230"></a><span id="l11.230" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">deleted file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- a/calendar/base/backend/libical/calIDuration.idl</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ /dev/null</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -1,107 +0,0 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineminus">-/* -*- Mode: idl; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineminus">-</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">-#include &quot;nsISupports.idl&quot;</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineminus">-</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-[ptr] native icaldurationtypeptr(struct icaldurationtype);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-[scriptable, uuid(f5e1c987-e722-4dec-bf91-93d4062b504a)]</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-interface calIDuration : nsISupports</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-{</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-  /**</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-   * isMutable is true if this instance is modifiable.</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-   * If isMutable is false, any attempts to modify</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-   * the object will throw CAL_ERROR_ITEM_IS_MUTABLE.</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">-   */</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">-  readonly attribute boolean isMutable;</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-  /**</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-   * Make this calIDuration instance immutable.</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-   */</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-  void makeImmutable();</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-  /**</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-   * Clone this calIDuration instance into a new</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-   * mutable object.</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-   */</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-  calIDuration clone();</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-  /**</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-   * Is Negative</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-   */</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-  attribute boolean isNegative;</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-  /**</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-   * Weeks</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-   */</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-  attribute short weeks;</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-  /**</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-   * Days</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-   */</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-  attribute short days;</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-  /**</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-   * Hours</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-   */</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-  attribute short hours;</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-  /**</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineminus">-   * Minutes</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">-   */</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineminus">-  attribute short minutes;</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineminus">-  /**</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineminus">-   * Seconds</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineminus">-   */</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineminus">-  attribute short seconds;</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-  /**</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-   * total duration in seconds</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-   */</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-  attribute long inSeconds;</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-  /*</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineminus">-   * Methods</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-   */</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-  /**</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-   * Add a duration</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-   */</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineminus">-  void addDuration(in calIDuration aDuration);</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-  /**</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-   * Compare with another duration</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-   *</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-   * @param    aOther     to be compared with this object</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-   * </span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-   * @return   -1, 0, 1 if this &lt; aOther, this == aOther, or this &gt; aOther,</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineminus">-   *           respectively.</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-   */</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-  long compare(in calIDuration aOther);</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineminus">-  /**</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineminus">-   * Reset this duration to 0</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-   */</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-  void reset();</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-  /**</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineminus">-   * Normalize the duration</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineminus">-   */</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineminus">-  void normalize();</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineminus">-</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-  /**</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineminus">-   * Return a string representation of this instance.</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineminus">-   */</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-  AUTF8String toString();</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineminus">-  [noscript,notxpcom] void toIcalDuration(in icaldurationtypeptr idt);</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineminus">-  attribute jsval icalDuration;</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineminus">-</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-  /**</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineminus">-   * This object as an iCalendar DURATION string</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineminus">-   */</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineminus">-  attribute ACString icalString;</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">deleted file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- a/calendar/base/backend/libical/calIICSService.idl</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ /dev/null</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -1,270 +0,0 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineminus">-/* -*- Mode: idl; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineminus">-</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">-// XXX use strings for kind values instead of enumerated constants?</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineminus">-</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-#include &quot;nsISupports.idl&quot;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-interface calIItemBase;</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-interface calIDateTime;</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-interface calIDuration;</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-interface calITimezone;</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-interface calITimezoneProvider;</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">-interface calIIcalProperty;</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">-interface nsIUTF8StringEnumerator;</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-interface nsIInputStream;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">-[ptr] native icalpropertyptr(struct icalproperty_impl);</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">-[ptr] native icalcomponentptr(struct icalcomponent_impl);</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineminus">-[ptr] native icaltimezoneptr(struct _icaltimezone);</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">-</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">-/**</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">- * General notes:</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">- *</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">- * As with libical, use of getNextFoo(footype) is only valid if there have been</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">- * no intervening getNextFoo(otherfootype)s, or removeFoo()s, or addFoo()s. In</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">- * general, you want to do as little manipulation of your FooContainers as</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">- * possible while iterating over them.</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">- */</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-[scriptable,uuid(d2fc0264-191e-435e-8ef2-b2ab1fa81ca9)]</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-interface calIIcalComponent : nsISupports</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-{</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-    /**</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-     * The parent ical property</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-     */</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-    readonly attribute calIIcalComponent parent;</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-    /**</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-     * Access to the inner ical.js objects. Only use these if you know what you</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-     * are doing.</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-     */</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-    attribute jsval icalComponent;</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-    attribute jsval icalTimezone;</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-    /**</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineminus">-     * This is the value that an integer-valued getter will provide if</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-     * there is no such property on the wrapped ical structure.</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineminus">-     */</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineminus">-    const int32_t INVALID_VALUE = -1;</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineminus">-    /**</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineminus">-     * @param kind ANY, XROOT, VCALENDAR, VEVENT, etc.</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-     */</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-    calIIcalComponent getFirstSubcomponent(in AUTF8String componentType);</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-    calIIcalComponent getNextSubcomponent(in AUTF8String componentType);</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineminus">-</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineminus">-    readonly attribute AUTF8String componentType;</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineminus">-</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-    attribute AUTF8String uid;</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-    attribute AUTF8String prodid;</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-    attribute AUTF8String version;</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineminus">-    /**</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineminus">-     * PUBLISH, REQUEST, REPLY, etc.</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineminus">-     */</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineminus">-    attribute AUTF8String method;</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineminus">-</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineminus">-    /**</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineminus">-     * TENTATIVE, CONFIRMED, CANCELLED, etc.</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineminus">-     */</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineminus">-    attribute AUTF8String status;</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineminus">-</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineminus">-    attribute AUTF8String summary;</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineminus">-    attribute AUTF8String description;</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineminus">-    attribute AUTF8String location;</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineminus">-    attribute AUTF8String categories;</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineminus">-    attribute AUTF8String URL;</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineminus">-</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineminus">-    attribute int32_t priority;</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineminus">-</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-    attribute calIDateTime startTime;</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-    attribute calIDateTime endTime;</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-    readonly attribute calIDuration duration;</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineminus">-    attribute calIDateTime dueTime;</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineminus">-    attribute calIDateTime stampTime;</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineminus">-</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineminus">-    attribute calIDateTime createdTime;</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineminus">-    attribute calIDateTime completedTime;</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineminus">-    attribute calIDateTime lastModified;</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineminus">-</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineminus">-    /**</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineminus">-     * The recurrence ID, a.k.a. DTSTART-of-calculated-occurrence,</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineminus">-     * or null if this isn't an occurrence.</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineminus">-     */</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineminus">-    attribute calIDateTime recurrenceId;</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineminus">-</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineminus">-    AUTF8String serializeToICS();</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineminus">-</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineminus">-    /**</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineminus">-     * Return a string representation of this instance.</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineminus">-     */</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineminus">-    AUTF8String toString();</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineminus">-</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineminus">-    /**</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineminus">-     * Serializes this component (and subcomponents) directly to an</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineminus">-     * input stream.  Typically used for performance to avoid</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineminus">-     * unnecessary conversions and XPConnect traversals.</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineminus">-     *</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineminus">-     * @result     an input stream which can be read to get the serialized</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineminus">-     *             version of this component, encoded in UTF-8.  Implements</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineminus">-     *             nsISeekableStream so that it can be used with</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineminus">-     *             nsIUploadChannel.</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineminus">-     */</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineminus">-    nsIInputStream serializeToICSStream();</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineminus">-</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineminus">-    void addSubcomponent(in calIIcalComponent comp);</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineminus">-// If you add then remove a property/component, the referenced</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineminus">-// timezones won't get purged out. There's currently no client code.</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineminus">-//     void removeSubcomponent(in calIIcalComponent comp);</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineminus">-</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineminus">-    /**</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineminus">-     * @param kind ANY, ATTENDEE, X-WHATEVER, etc.</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineminus">-     */</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineminus">-    calIIcalProperty getFirstProperty(in AUTF8String kind);</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineminus">-    calIIcalProperty getNextProperty(in AUTF8String kind);</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineminus">-    void addProperty(in calIIcalProperty prop);</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineminus">-// If you add then remove a property/component, the referenced</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineminus">-// timezones won't get purged out. There's currently no client code.</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineminus">-//     void removeProperty(in calIIcalProperty prop);</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineminus">-</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineminus">-    /**</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineminus">-     * Timezones need special handling, as they must be</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineminus">-     * emitted as children of VCALENDAR, but can be referenced by</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineminus">-     * any sub component.</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineminus">-     * Adding a second timezone (of the same TZID) will remove the</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineminus">-     * first one.</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineminus">-     */</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineminus">-    void addTimezoneReference(in calITimezone aTimezone);</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineminus">-</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineminus">-    /**</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineminus">-     * Returns an array of VTIMEZONE components.</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineminus">-     * These are the timezones that are in use by this</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineminus">-     * component and its children.</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineminus">-     */</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineminus">-    void getReferencedTimezones(out uint32_t aCount,</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineminus">-                                [array,size_is(aCount),retval] out calITimezone aTimezones);</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineminus">-</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineminus">-    /**</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineminus">-     * Clones the component. The cloned component is decoupled from any parent.</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineminus">-     * @return cloned component</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineminus">-     */</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineminus">-    calIIcalComponent clone();</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineminus">-</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineminus">-    [noscript,notxpcom] icalcomponentptr getLibicalComponent();</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineminus">-    [noscript,notxpcom] icaltimezoneptr getLibicalTimezone();</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineminus">-};</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineminus">-</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineminus">-[scriptable,uuid(e0b9067f-0a53-4724-9c69-63599681877e)]</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineminus">-interface calIIcalProperty : nsISupports</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineminus">-{</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineminus">-    /**</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineminus">-     * The whole property as an ical string.</span>
<a href="#l13.170"></a><span id="l13.170" class="difflineminus">-     * @exception Any libical error will be thrown as an calIError::ICS_ error.</span>
<a href="#l13.171"></a><span id="l13.171" class="difflineminus">-     */</span>
<a href="#l13.172"></a><span id="l13.172" class="difflineminus">-    readonly attribute AUTF8String icalString;</span>
<a href="#l13.173"></a><span id="l13.173" class="difflineminus">-</span>
<a href="#l13.174"></a><span id="l13.174" class="difflineminus">-    /**</span>
<a href="#l13.175"></a><span id="l13.175" class="difflineminus">-     * Access to the inner ical.js objects. Only use these if you know what you</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineminus">-     * are doing.</span>
<a href="#l13.177"></a><span id="l13.177" class="difflineminus">-     */</span>
<a href="#l13.178"></a><span id="l13.178" class="difflineminus">-    attribute jsval icalProperty;</span>
<a href="#l13.179"></a><span id="l13.179" class="difflineminus">-</span>
<a href="#l13.180"></a><span id="l13.180" class="difflineminus">-    /**</span>
<a href="#l13.181"></a><span id="l13.181" class="difflineminus">-     * The parent component containing this property</span>
<a href="#l13.182"></a><span id="l13.182" class="difflineminus">-     */</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineminus">-    readonly attribute calIIcalComponent parent;</span>
<a href="#l13.184"></a><span id="l13.184" class="difflineminus">-</span>
<a href="#l13.185"></a><span id="l13.185" class="difflineminus">-    /**</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineminus">-     * Return a string representation of this instance.</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineminus">-     */</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineminus">-    AUTF8String toString();</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineminus">-</span>
<a href="#l13.190"></a><span id="l13.190" class="difflineminus">-    /**</span>
<a href="#l13.191"></a><span id="l13.191" class="difflineminus">-     * The value of the property as string.</span>
<a href="#l13.192"></a><span id="l13.192" class="difflineminus">-     * The exception for properties of TEXT or X- type, those will be unescaped</span>
<a href="#l13.193"></a><span id="l13.193" class="difflineminus">-     * when getting, and also expects an unescaped string when setting.</span>
<a href="#l13.194"></a><span id="l13.194" class="difflineminus">-     * Datetime, numeric and other non-text types are represented as ical string</span>
<a href="#l13.195"></a><span id="l13.195" class="difflineminus">-     */</span>
<a href="#l13.196"></a><span id="l13.196" class="difflineminus">-    attribute AUTF8String value;</span>
<a href="#l13.197"></a><span id="l13.197" class="difflineminus">-</span>
<a href="#l13.198"></a><span id="l13.198" class="difflineminus">-    /**</span>
<a href="#l13.199"></a><span id="l13.199" class="difflineminus">-     * The value of the property in (escaped) ical format.</span>
<a href="#l13.200"></a><span id="l13.200" class="difflineminus">-     */</span>
<a href="#l13.201"></a><span id="l13.201" class="difflineminus">-    attribute AUTF8String valueAsIcalString;</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineminus">-</span>
<a href="#l13.203"></a><span id="l13.203" class="difflineminus">-    /**</span>
<a href="#l13.204"></a><span id="l13.204" class="difflineminus">-     * The value of the property as date/datetime value, keeping</span>
<a href="#l13.205"></a><span id="l13.205" class="difflineminus">-     * track of the used timezone referenced in the owning component.</span>
<a href="#l13.206"></a><span id="l13.206" class="difflineminus">-     */</span>
<a href="#l13.207"></a><span id="l13.207" class="difflineminus">-    attribute calIDateTime valueAsDatetime;</span>
<a href="#l13.208"></a><span id="l13.208" class="difflineminus">-</span>
<a href="#l13.209"></a><span id="l13.209" class="difflineminus">-    // XXX attribute AUTF8String stringValueWithParams; ?</span>
<a href="#l13.210"></a><span id="l13.210" class="difflineminus">-    readonly attribute AUTF8String propertyName;</span>
<a href="#l13.211"></a><span id="l13.211" class="difflineminus">-</span>
<a href="#l13.212"></a><span id="l13.212" class="difflineminus">-    AUTF8String getParameter(in AUTF8String paramname);</span>
<a href="#l13.213"></a><span id="l13.213" class="difflineminus">-    void setParameter(in AUTF8String paramname, in AUTF8String paramval);</span>
<a href="#l13.214"></a><span id="l13.214" class="difflineminus">-</span>
<a href="#l13.215"></a><span id="l13.215" class="difflineminus">-    AUTF8String getFirstParameterName();</span>
<a href="#l13.216"></a><span id="l13.216" class="difflineminus">-    AUTF8String getNextParameterName();</span>
<a href="#l13.217"></a><span id="l13.217" class="difflineminus">-</span>
<a href="#l13.218"></a><span id="l13.218" class="difflineminus">-    void removeParameter(in AUTF8String paramname);</span>
<a href="#l13.219"></a><span id="l13.219" class="difflineminus">-    void clearXParameters();</span>
<a href="#l13.220"></a><span id="l13.220" class="difflineminus">-</span>
<a href="#l13.221"></a><span id="l13.221" class="difflineminus">-    [noscript,notxpcom] icalpropertyptr getLibicalProperty();</span>
<a href="#l13.222"></a><span id="l13.222" class="difflineminus">-    [noscript,notxpcom] icalcomponentptr getLibicalComponent();</span>
<a href="#l13.223"></a><span id="l13.223" class="difflineminus">-};</span>
<a href="#l13.224"></a><span id="l13.224" class="difflineminus">-</span>
<a href="#l13.225"></a><span id="l13.225" class="difflineminus">-[scriptable,uuid(131b419f-1373-4013-b470-5359aaff4049)]</span>
<a href="#l13.226"></a><span id="l13.226" class="difflineminus">-interface calIIcsComponentParsingListener : nsISupports</span>
<a href="#l13.227"></a><span id="l13.227" class="difflineminus">-{</span>
<a href="#l13.228"></a><span id="l13.228" class="difflineminus">-    /**</span>
<a href="#l13.229"></a><span id="l13.229" class="difflineminus">-     * Called when the parsing has completed.</span>
<a href="#l13.230"></a><span id="l13.230" class="difflineminus">-     *</span>
<a href="#l13.231"></a><span id="l13.231" class="difflineminus">-     * @param rc            The result code of parsing</span>
<a href="#l13.232"></a><span id="l13.232" class="difflineminus">-     * @param rootComp      The root ical component that was parsed</span>
<a href="#l13.233"></a><span id="l13.233" class="difflineminus">-     */</span>
<a href="#l13.234"></a><span id="l13.234" class="difflineminus">-    void onParsingComplete(in nsresult rc, in calIIcalComponent rootComp);</span>
<a href="#l13.235"></a><span id="l13.235" class="difflineminus">-};</span>
<a href="#l13.236"></a><span id="l13.236" class="difflineminus">-</span>
<a href="#l13.237"></a><span id="l13.237" class="difflineminus">-[scriptable,uuid(fea79ff8-07ba-46ae-ac92-7f9d8c49c9d2)]</span>
<a href="#l13.238"></a><span id="l13.238" class="difflineminus">-interface calIICSService : nsISupports</span>
<a href="#l13.239"></a><span id="l13.239" class="difflineminus">-{</span>
<a href="#l13.240"></a><span id="l13.240" class="difflineminus">-    /**</span>
<a href="#l13.241"></a><span id="l13.241" class="difflineminus">-     * Parses an ICS string and uses the passed tzProvider instance to</span>
<a href="#l13.242"></a><span id="l13.242" class="difflineminus">-     * resolve timezones not contained withing the VCALENDAR.</span>
<a href="#l13.243"></a><span id="l13.243" class="difflineminus">-     *</span>
<a href="#l13.244"></a><span id="l13.244" class="difflineminus">-     * @param serialized     an ICS string</span>
<a href="#l13.245"></a><span id="l13.245" class="difflineminus">-     * @param tzProvider     timezone provider used to resolve TZIDs</span>
<a href="#l13.246"></a><span id="l13.246" class="difflineminus">-     *                       not contained within the VCALENDAR;</span>
<a href="#l13.247"></a><span id="l13.247" class="difflineminus">-     *                       if null is passed, parsing falls back to</span>
<a href="#l13.248"></a><span id="l13.248" class="difflineminus">-     *                       using the timezone service</span>
<a href="#l13.249"></a><span id="l13.249" class="difflineminus">-     */</span>
<a href="#l13.250"></a><span id="l13.250" class="difflineminus">-    calIIcalComponent parseICS(in AUTF8String serialized,</span>
<a href="#l13.251"></a><span id="l13.251" class="difflineminus">-                               in calITimezoneProvider tzProvider);</span>
<a href="#l13.252"></a><span id="l13.252" class="difflineminus">-</span>
<a href="#l13.253"></a><span id="l13.253" class="difflineminus">-    /**</span>
<a href="#l13.254"></a><span id="l13.254" class="difflineminus">-     * Asynchronously parse an ICS string</span>
<a href="#l13.255"></a><span id="l13.255" class="difflineminus">-     *</span>
<a href="#l13.256"></a><span id="l13.256" class="difflineminus">-     * @param serialized     an ICS string</span>
<a href="#l13.257"></a><span id="l13.257" class="difflineminus">-     * @param tzProvider     timezone provider used to resolve TZIDs</span>
<a href="#l13.258"></a><span id="l13.258" class="difflineminus">-     *                       not contained within the VCALENDAR;</span>
<a href="#l13.259"></a><span id="l13.259" class="difflineminus">-     *                       if null is passed, parsing falls back to</span>
<a href="#l13.260"></a><span id="l13.260" class="difflineminus">-     *                       using the timezone service</span>
<a href="#l13.261"></a><span id="l13.261" class="difflineminus">-     * @param listener       The listener that notifies the root component</span>
<a href="#l13.262"></a><span id="l13.262" class="difflineminus">-     */</span>
<a href="#l13.263"></a><span id="l13.263" class="difflineminus">-    void parseICSAsync(in AUTF8String serialized,</span>
<a href="#l13.264"></a><span id="l13.264" class="difflineminus">-                       in calITimezoneProvider tzProvider,</span>
<a href="#l13.265"></a><span id="l13.265" class="difflineminus">-                       in calIIcsComponentParsingListener listener);</span>
<a href="#l13.266"></a><span id="l13.266" class="difflineminus">-</span>
<a href="#l13.267"></a><span id="l13.267" class="difflineminus">-    calIIcalComponent createIcalComponent(in AUTF8String kind);</span>
<a href="#l13.268"></a><span id="l13.268" class="difflineminus">-    calIIcalProperty createIcalProperty(in AUTF8String kind);</span>
<a href="#l13.269"></a><span id="l13.269" class="difflineminus">-    calIIcalProperty createIcalPropertyFromString(in AUTF8String str);</span>
<a href="#l13.270"></a><span id="l13.270" class="difflineminus">-    /* I wish I could write this function atop libical!</span>
<a href="#l13.271"></a><span id="l13.271" class="difflineminus">-    boolean isLegalParameterValue(in AUTF8String paramKind,</span>
<a href="#l13.272"></a><span id="l13.272" class="difflineminus">-                                  in AUTF8String paramValue);</span>
<a href="#l13.273"></a><span id="l13.273" class="difflineminus">-    */</span>
<a href="#l13.274"></a><span id="l13.274" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">deleted file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- a/calendar/base/backend/libical/calIPeriod.idl</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ /dev/null</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -1,62 +0,0 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineminus">-</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineminus">-#include &quot;nsISupports.idl&quot;</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineminus">-</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineminus">-interface calIDateTime;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-interface calIDuration;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-[ptr] native icalperiodtypeptr(struct icalperiodtype);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-[scriptable,uuid(04ee525f-96db-4731-8d61-688e754df24f)]</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-interface calIPeriod : nsISupports</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-{</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-  attribute jsval icalPeriod;</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-  /**</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-   * isMutable is true if this instance is modifiable.</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-   * If isMutable is false, any attempts to modify</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-   * the object will throw NS_ERROR_OBJECT_IS_IMMUTABLE.</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-   */</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">-  readonly attribute boolean isMutable;</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-  /**</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">-   * Make this calIPeriod instance immutable.</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-   */</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-  void makeImmutable();</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-  /**</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-   * Clone this calIPeriod instance into a new</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-   * mutable object.</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-   */</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">-  calIPeriod clone();</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-  /**</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-   * The start datetime of this period</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-   */</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-  attribute calIDateTime start;</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-  /**</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-   * The end datetime of this period</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-   */</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-  attribute calIDateTime end;</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-  /**</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-   * The duration, equal to end-start</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-   */</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-  readonly attribute calIDuration duration;</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-  /**</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-   * Return a string representation of this instance.</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-   */</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-  AUTF8String toString();</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">-</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineminus">-  [noscript,notxpcom] void toIcalPeriod(in icalperiodtypeptr idt);</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">-</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-  /**</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineminus">-   * This object as an iCalendar DURATION string</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineminus">-   */</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineminus">-  attribute ACString icalString;</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/backend/libical/calPeriod.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/backend/libical/calPeriod.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -5,31 +5,37 @@</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5"> #include &quot;calPeriod.h&quot;</span>
<a href="#l15.6"></a><span id="l15.6"> #include &quot;calBaseCID.h&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> #include &quot;nsIClassInfoImpl.h&quot;</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10"> #include &quot;calUtils.h&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-NS_IMPL_CLASSINFO(calPeriod, NULL, 0, CAL_PERIOD_CID)</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-NS_IMPL_ISUPPORTS_CI(calPeriod, calIPeriod)</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+NS_IMPL_CLASSINFO(calPeriod, nullptr, 0, CAL_PERIOD_CID)</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+NS_IMPL_ISUPPORTS_CI(calPeriod, calIPeriod, calIPeriodLibical)</span>
<a href="#l15.16"></a><span id="l15.16"> </span>
<a href="#l15.17"></a><span id="l15.17"> calPeriod::calPeriod()</span>
<a href="#l15.18"></a><span id="l15.18">     : mImmutable(false)</span>
<a href="#l15.19"></a><span id="l15.19"> {</span>
<a href="#l15.20"></a><span id="l15.20"> }</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22"> calPeriod::calPeriod(const calPeriod&amp; cpt)</span>
<a href="#l15.23"></a><span id="l15.23">     : mImmutable(false)</span>
<a href="#l15.24"></a><span id="l15.24"> {</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">-    if (cpt.mStart)</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-        cpt.mStart-&gt;Clone(getter_AddRefs(mStart));</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-    if (cpt.mEnd)</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-        cpt.mEnd-&gt;Clone(getter_AddRefs(mEnd));</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+    if (cpt.mStart) {</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+        nsCOMPtr&lt;calIDateTime&gt; start;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+        cpt.mStart-&gt;Clone(getter_AddRefs(start));</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+        mStart = do_QueryInterface(start);</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+    }</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+    if (cpt.mEnd) {</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+        nsCOMPtr&lt;calIDateTime&gt; end;</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+        cpt.mEnd-&gt;Clone(getter_AddRefs(end));</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+        mEnd = do_QueryInterface(end);</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+    }</span>
<a href="#l15.39"></a><span id="l15.39"> }</span>
<a href="#l15.40"></a><span id="l15.40"> </span>
<a href="#l15.41"></a><span id="l15.41"> calPeriod::calPeriod(struct icalperiodtype const* aPeriodPtr)</span>
<a href="#l15.42"></a><span id="l15.42">     : mImmutable(false)</span>
<a href="#l15.43"></a><span id="l15.43"> {</span>
<a href="#l15.44"></a><span id="l15.44">     FromIcalPeriod(aPeriodPtr);</span>
<a href="#l15.45"></a><span id="l15.45"> }</span>
<a href="#l15.46"></a><span id="l15.46"> </span>
<a href="#l15.47"></a><span id="l15.47" class="difflineat">@@ -82,34 +88,34 @@ NS_IMETHODIMP calPeriod::GetStart(calIDa</span>
<a href="#l15.48"></a><span id="l15.48">     return NS_OK;</span>
<a href="#l15.49"></a><span id="l15.49"> }</span>
<a href="#l15.50"></a><span id="l15.50"> NS_IMETHODIMP calPeriod::SetStart(calIDateTime *aValue)</span>
<a href="#l15.51"></a><span id="l15.51"> {</span>
<a href="#l15.52"></a><span id="l15.52">     NS_ENSURE_ARG_POINTER(aValue);</span>
<a href="#l15.53"></a><span id="l15.53">     if (mImmutable)</span>
<a href="#l15.54"></a><span id="l15.54">         return NS_ERROR_OBJECT_IS_IMMUTABLE;</span>
<a href="#l15.55"></a><span id="l15.55"> </span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-    mStart = aValue;</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+    mStart = do_QueryInterface(aValue);</span>
<a href="#l15.58"></a><span id="l15.58">     return mStart-&gt;MakeImmutable();</span>
<a href="#l15.59"></a><span id="l15.59"> }</span>
<a href="#l15.60"></a><span id="l15.60"> </span>
<a href="#l15.61"></a><span id="l15.61"> NS_IMETHODIMP calPeriod::GetEnd(calIDateTime **_retval)</span>
<a href="#l15.62"></a><span id="l15.62"> {</span>
<a href="#l15.63"></a><span id="l15.63">     NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l15.64"></a><span id="l15.64">     *_retval = mEnd;</span>
<a href="#l15.65"></a><span id="l15.65">     NS_IF_ADDREF(*_retval);</span>
<a href="#l15.66"></a><span id="l15.66">     return NS_OK;</span>
<a href="#l15.67"></a><span id="l15.67"> }</span>
<a href="#l15.68"></a><span id="l15.68"> NS_IMETHODIMP calPeriod::SetEnd(calIDateTime *aValue)</span>
<a href="#l15.69"></a><span id="l15.69"> {</span>
<a href="#l15.70"></a><span id="l15.70">     NS_ENSURE_ARG_POINTER(aValue);</span>
<a href="#l15.71"></a><span id="l15.71">     if (mImmutable)</span>
<a href="#l15.72"></a><span id="l15.72">         return NS_ERROR_OBJECT_IS_IMMUTABLE;</span>
<a href="#l15.73"></a><span id="l15.73"> </span>
<a href="#l15.74"></a><span id="l15.74" class="difflineminus">-    mEnd = aValue;</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineplus">+    mEnd = do_QueryInterface(aValue);</span>
<a href="#l15.76"></a><span id="l15.76">     return mEnd-&gt;MakeImmutable();</span>
<a href="#l15.77"></a><span id="l15.77"> }</span>
<a href="#l15.78"></a><span id="l15.78"> </span>
<a href="#l15.79"></a><span id="l15.79"> NS_IMETHODIMP calPeriod::GetDuration(calIDuration **_retval)</span>
<a href="#l15.80"></a><span id="l15.80"> {</span>
<a href="#l15.81"></a><span id="l15.81">     NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l15.82"></a><span id="l15.82">     if (!mStart || !mEnd)</span>
<a href="#l15.83"></a><span id="l15.83">         return NS_ERROR_UNEXPECTED;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/backend/libical/calPeriod.h</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/backend/libical/calPeriod.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -11,36 +11,37 @@</span>
<a href="#l16.4"></a><span id="l16.4"> #include &quot;calIPeriod.h&quot;</span>
<a href="#l16.5"></a><span id="l16.5"> #include &quot;calDateTime.h&quot;</span>
<a href="#l16.6"></a><span id="l16.6"> #include &quot;calIDuration.h&quot;</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> extern &quot;C&quot; {</span>
<a href="#l16.9"></a><span id="l16.9">     #include &quot;ical.h&quot;</span>
<a href="#l16.10"></a><span id="l16.10"> }</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-class calPeriod MOZ_FINAL : public calIPeriod</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+class calPeriod MOZ_FINAL : public calIPeriodLibical</span>
<a href="#l16.14"></a><span id="l16.14"> {</span>
<a href="#l16.15"></a><span id="l16.15"> public:</span>
<a href="#l16.16"></a><span id="l16.16">     calPeriod ();</span>
<a href="#l16.17"></a><span id="l16.17">     explicit calPeriod (const calPeriod&amp; cpt);</span>
<a href="#l16.18"></a><span id="l16.18">     explicit calPeriod (struct icalperiodtype const* aPeriodPtr);</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20">     // nsISupports interface</span>
<a href="#l16.21"></a><span id="l16.21">     NS_DECL_ISUPPORTS</span>
<a href="#l16.22"></a><span id="l16.22"> </span>
<a href="#l16.23"></a><span id="l16.23">     // calIPeriod interface</span>
<a href="#l16.24"></a><span id="l16.24">     NS_DECL_CALIPERIOD</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineplus">+    NS_DECL_CALIPERIODLIBICAL</span>
<a href="#l16.26"></a><span id="l16.26"> </span>
<a href="#l16.27"></a><span id="l16.27"> protected:</span>
<a href="#l16.28"></a><span id="l16.28">     ~calPeriod() {}</span>
<a href="#l16.29"></a><span id="l16.29">     calPeriod const&amp; operator=(calPeriod const&amp;);</span>
<a href="#l16.30"></a><span id="l16.30"> </span>
<a href="#l16.31"></a><span id="l16.31">     bool mImmutable;</span>
<a href="#l16.32"></a><span id="l16.32"> </span>
<a href="#l16.33"></a><span id="l16.33">     //struct icaldurationtype mPeriod;</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-    nsCOMPtr&lt;calIDateTime&gt; mStart;</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-    nsCOMPtr&lt;calIDateTime&gt; mEnd;</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+    nsCOMPtr&lt;calIDateTimeLibical&gt; mStart;</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+    nsCOMPtr&lt;calIDateTimeLibical&gt; mEnd;</span>
<a href="#l16.38"></a><span id="l16.38">     </span>
<a href="#l16.39"></a><span id="l16.39">     void FromIcalPeriod(struct icalperiodtype const* icalp);</span>
<a href="#l16.40"></a><span id="l16.40"> };</span>
<a href="#l16.41"></a><span id="l16.41"> </span>
<a href="#l16.42"></a><span id="l16.42"> #endif /* CALPERIOD_H_ */</span>
<a href="#l16.43"></a><span id="l16.43"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/backend/libical/calRecurrenceRule.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/backend/libical/calRecurrenceRule.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -192,27 +192,35 @@ calRecurrenceRule::GetUntilDate(calIDate</span>
<a href="#l17.4"></a><span id="l17.4">     }</span>
<a href="#l17.5"></a><span id="l17.5">     return NS_OK;</span>
<a href="#l17.6"></a><span id="l17.6"> }</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8"> NS_IMETHODIMP</span>
<a href="#l17.9"></a><span id="l17.9"> calRecurrenceRule::SetUntilDate(calIDateTime * aRecurEnd)</span>
<a href="#l17.10"></a><span id="l17.10"> {</span>
<a href="#l17.11"></a><span id="l17.11">     if (aRecurEnd) {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-        nsCOMPtr&lt;calIDateTime&gt; dt(aRecurEnd);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+        nsresult rv;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+        bool b;</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+        nsCOMPtr&lt;calIDateTimeLibical&gt; icaldt;</span>
<a href="#l17.16"></a><span id="l17.16">         nsCOMPtr&lt;calITimezone&gt; tz;</span>
<a href="#l17.17"></a><span id="l17.17">         aRecurEnd-&gt;GetTimezone(getter_AddRefs(tz));</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-        bool b;</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+</span>
<a href="#l17.20"></a><span id="l17.20">         if (NS_SUCCEEDED(tz-&gt;GetIsUTC(&amp;b)) &amp;&amp; !b &amp;&amp;</span>
<a href="#l17.21"></a><span id="l17.21">             NS_SUCCEEDED(tz-&gt;GetIsFloating(&amp;b)) &amp;&amp; !b) {</span>
<a href="#l17.22"></a><span id="l17.22">             // convert to UTC:</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+            nsCOMPtr&lt;calIDateTime&gt; dt;</span>
<a href="#l17.24"></a><span id="l17.24">             aRecurEnd-&gt;GetInTimezone(cal::UTC(), getter_AddRefs(dt));</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+            icaldt = do_QueryInterface(dt, &amp;rv);</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+        } else {</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+            icaldt = do_QueryInterface(aRecurEnd, &amp;rv);</span>
<a href="#l17.28"></a><span id="l17.28">         }</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.31"></a><span id="l17.31">         struct icaltimetype itt;</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-        dt-&gt;ToIcalTime(&amp;itt);</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+        icaldt-&gt;ToIcalTime(&amp;itt);</span>
<a href="#l17.34"></a><span id="l17.34"> </span>
<a href="#l17.35"></a><span id="l17.35">         mIcalRecur.until = itt;</span>
<a href="#l17.36"></a><span id="l17.36">     } else {</span>
<a href="#l17.37"></a><span id="l17.37">         mIcalRecur.until = icaltime_null_time();</span>
<a href="#l17.38"></a><span id="l17.38">     }</span>
<a href="#l17.39"></a><span id="l17.39"> </span>
<a href="#l17.40"></a><span id="l17.40">     mIcalRecur.count = 0;</span>
<a href="#l17.41"></a><span id="l17.41"> </span>
<a href="#l17.42"></a><span id="l17.42" class="difflineat">@@ -330,21 +338,29 @@ NS_IMETHODIMP</span>
<a href="#l17.43"></a><span id="l17.43"> calRecurrenceRule::GetNextOccurrence(calIDateTime *aStartTime,</span>
<a href="#l17.44"></a><span id="l17.44">                                      calIDateTime *aOccurrenceTime,</span>
<a href="#l17.45"></a><span id="l17.45">                                      calIDateTime **_retval)</span>
<a href="#l17.46"></a><span id="l17.46"> {</span>
<a href="#l17.47"></a><span id="l17.47">     NS_ENSURE_ARG_POINTER(aStartTime);</span>
<a href="#l17.48"></a><span id="l17.48">     NS_ENSURE_ARG_POINTER(aOccurrenceTime);</span>
<a href="#l17.49"></a><span id="l17.49">     NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l17.50"></a><span id="l17.50"> </span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+    nsresult rv;</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+    nsCOMPtr&lt;calIDateTimeLibical&gt; icaldtstart = do_QueryInterface(aStartTime, &amp;rv);</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+    nsCOMPtr&lt;calIDateTimeLibical&gt; icaloccurtime = do_QueryInterface(aOccurrenceTime, &amp;rv);</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+</span>
<a href="#l17.59"></a><span id="l17.59">     struct icaltimetype dtstart;</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineminus">-    aStartTime-&gt;ToIcalTime(&amp;dtstart);</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+    icaldtstart-&gt;ToIcalTime(&amp;dtstart);</span>
<a href="#l17.62"></a><span id="l17.62"> </span>
<a href="#l17.63"></a><span id="l17.63">     struct icaltimetype occurtime;</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-    aOccurrenceTime-&gt;ToIcalTime(&amp;occurtime);</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+    icaloccurtime-&gt;ToIcalTime(&amp;occurtime);</span>
<a href="#l17.66"></a><span id="l17.66"> </span>
<a href="#l17.67"></a><span id="l17.67">     icalrecur_iterator* recur_iter;</span>
<a href="#l17.68"></a><span id="l17.68">     recur_iter = icalrecur_iterator_new(mIcalRecur, dtstart);</span>
<a href="#l17.69"></a><span id="l17.69">     if (!recur_iter)</span>
<a href="#l17.70"></a><span id="l17.70">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l17.71"></a><span id="l17.71"> </span>
<a href="#l17.72"></a><span id="l17.72">     struct icaltimetype next = icalrecur_iterator_next(recur_iter);</span>
<a href="#l17.73"></a><span id="l17.73">     while (!icaltime_is_null_time(next)) {</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineat">@@ -406,25 +422,35 @@ calRecurrenceRule::GetOccurrences(calIDa</span>
<a href="#l17.75"></a><span id="l17.75">         char const * const ss = icalrecurrencetype_as_string(&amp;mIcalRecur);</span>
<a href="#l17.76"></a><span id="l17.76">         nsAutoCString tst, tend;</span>
<a href="#l17.77"></a><span id="l17.77">         aRangeStart-&gt;ToString(tst);</span>
<a href="#l17.78"></a><span id="l17.78">         aRangeEnd-&gt;ToString(tend);</span>
<a href="#l17.79"></a><span id="l17.79">         printf(&quot;RULE: [%s -&gt; %s, %d]: %s\n&quot;, tst.get(), tend.get(), mIcalRecur.count, ss);</span>
<a href="#l17.80"></a><span id="l17.80">     }</span>
<a href="#l17.81"></a><span id="l17.81"> #endif</span>
<a href="#l17.82"></a><span id="l17.82"> </span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+    nsresult rv;</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+    nsCOMPtr&lt;calIDateTimeLibical&gt; icalrangestart = do_QueryInterface(aRangeStart, &amp;rv);</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+    nsCOMPtr&lt;calIDateTimeLibical&gt; icaldtstart = do_QueryInterface(aStartTime, &amp;rv);</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineplus">+</span>
<a href="#l17.90"></a><span id="l17.90">     struct icaltimetype rangestart, dtstart, dtend;</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineminus">-    aRangeStart-&gt;ToIcalTime(&amp;rangestart);</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineplus">+    icalrangestart-&gt;ToIcalTime(&amp;rangestart);</span>
<a href="#l17.93"></a><span id="l17.93">     rangestart = ensureDateTime(rangestart);</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineminus">-    aStartTime-&gt;ToIcalTime(&amp;dtstart);</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineplus">+    icaldtstart-&gt;ToIcalTime(&amp;dtstart);</span>
<a href="#l17.96"></a><span id="l17.96">     nsCOMPtr&lt;calITimezone&gt; tz;</span>
<a href="#l17.97"></a><span id="l17.97">     aStartTime-&gt;GetTimezone(getter_AddRefs(tz));</span>
<a href="#l17.98"></a><span id="l17.98"> </span>
<a href="#l17.99"></a><span id="l17.99">     if (aRangeEnd) {</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineminus">-        aRangeEnd-&gt;ToIcalTime(&amp;dtend);</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineplus">+        nsCOMPtr&lt;calIDateTimeLibical&gt; icalrangeend = do_QueryInterface(aRangeEnd, &amp;rv);</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineplus">+        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineplus">+</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineplus">+        icalrangeend-&gt;ToIcalTime(&amp;dtend);</span>
<a href="#l17.105"></a><span id="l17.105">         dtend = ensureDateTime(dtend);</span>
<a href="#l17.106"></a><span id="l17.106"> </span>
<a href="#l17.107"></a><span id="l17.107">         // if the start of the recurrence is past the end,</span>
<a href="#l17.108"></a><span id="l17.108">         // we have no dates</span>
<a href="#l17.109"></a><span id="l17.109">         if (icaltime_compare (dtstart, dtend) &gt;= 0) {</span>
<a href="#l17.110"></a><span id="l17.110">             *aDates = nullptr;</span>
<a href="#l17.111"></a><span id="l17.111">             *aCount = 0;</span>
<a href="#l17.112"></a><span id="l17.112">             return NS_OK;</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineat">@@ -507,33 +533,37 @@ calRecurrenceRule::GetIcalProperty(calII</span>
<a href="#l17.114"></a><span id="l17.114">     NS_ADDREF(*prop);</span>
<a href="#l17.115"></a><span id="l17.115">     return NS_OK;</span>
<a href="#l17.116"></a><span id="l17.116"> }</span>
<a href="#l17.117"></a><span id="l17.117"> </span>
<a href="#l17.118"></a><span id="l17.118"> NS_IMETHODIMP</span>
<a href="#l17.119"></a><span id="l17.119"> calRecurrenceRule::SetIcalProperty(calIIcalProperty *aProp)</span>
<a href="#l17.120"></a><span id="l17.120"> {</span>
<a href="#l17.121"></a><span id="l17.121">     NS_ENSURE_ARG_POINTER(aProp);</span>
<a href="#l17.122"></a><span id="l17.122" class="difflineplus">+    nsresult rv;</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineplus">+</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineplus">+    nsCOMPtr&lt;calIIcalPropertyLibical&gt; icalprop = do_QueryInterface(aProp, &amp;rv);</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.126"></a><span id="l17.126"> </span>
<a href="#l17.127"></a><span id="l17.127">     if (mImmutable)</span>
<a href="#l17.128"></a><span id="l17.128">         return NS_ERROR_OBJECT_IS_IMMUTABLE;</span>
<a href="#l17.129"></a><span id="l17.129"> </span>
<a href="#l17.130"></a><span id="l17.130">     nsAutoCString propname;</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineminus">-    nsresult rv = aProp-&gt;GetPropertyName(propname);</span>
<a href="#l17.132"></a><span id="l17.132" class="difflineplus">+    rv = aProp-&gt;GetPropertyName(propname);</span>
<a href="#l17.133"></a><span id="l17.133">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.134"></a><span id="l17.134">     if (propname.EqualsLiteral(&quot;RRULE&quot;)) {</span>
<a href="#l17.135"></a><span id="l17.135">         mIsNegative = false;</span>
<a href="#l17.136"></a><span id="l17.136">     } else {</span>
<a href="#l17.137"></a><span id="l17.137">         return NS_ERROR_INVALID_ARG;</span>
<a href="#l17.138"></a><span id="l17.138">     }</span>
<a href="#l17.139"></a><span id="l17.139"> </span>
<a href="#l17.140"></a><span id="l17.140">     icalproperty *prop;</span>
<a href="#l17.141"></a><span id="l17.141">     struct icalrecurrencetype icalrecur;</span>
<a href="#l17.142"></a><span id="l17.142"> </span>
<a href="#l17.143"></a><span id="l17.143" class="difflineminus">-    prop = aProp-&gt;GetLibicalProperty();</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineplus">+    prop = icalprop-&gt;GetLibicalProperty();</span>
<a href="#l17.145"></a><span id="l17.145"> </span>
<a href="#l17.146"></a><span id="l17.146">     icalrecur = icalproperty_get_rrule(prop);</span>
<a href="#l17.147"></a><span id="l17.147"> </span>
<a href="#l17.148"></a><span id="l17.148">     // XXX Note that we ignore the dtstart and use the one from the</span>
<a href="#l17.149"></a><span id="l17.149">     // event, though I realize now that we shouldn't.  Ignoring</span>
<a href="#l17.150"></a><span id="l17.150">     // dtstart makes it impossible to have multiple RRULEs on one</span>
<a href="#l17.151"></a><span id="l17.151">     // event that start at different times (e.g. every day starting on</span>
<a href="#l17.152"></a><span id="l17.152">     // jan 1 for 2 weeks, every other day starting on feb 1 for 2</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/backend/libical/calUtils.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/backend/libical/calUtils.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -75,17 +75,18 @@ icaltimezone * getIcalTimezone(calITimez</span>
<a href="#l18.4"></a><span id="l18.4">     bool b;</span>
<a href="#l18.5"></a><span id="l18.5">     tz-&gt;GetIsUTC(&amp;b);</span>
<a href="#l18.6"></a><span id="l18.6">     if (b) {</span>
<a href="#l18.7"></a><span id="l18.7">         icaltz = icaltimezone_get_utc_timezone();</span>
<a href="#l18.8"></a><span id="l18.8">     } else {</span>
<a href="#l18.9"></a><span id="l18.9">         nsCOMPtr&lt;calIIcalComponent&gt; tzComp;</span>
<a href="#l18.10"></a><span id="l18.10">         tz-&gt;GetIcalComponent(getter_AddRefs(tzComp));</span>
<a href="#l18.11"></a><span id="l18.11">         if (tzComp) {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-            icaltz = tzComp-&gt;GetLibicalTimezone();</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+            nsCOMPtr&lt;calIIcalComponentLibical&gt; tzCompLibical = do_QueryInterface(tzComp);</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+            icaltz = tzCompLibical-&gt;GetLibicalTimezone();</span>
<a href="#l18.15"></a><span id="l18.15">         } // else floating or phantom timezone</span>
<a href="#l18.16"></a><span id="l18.16">     }</span>
<a href="#l18.17"></a><span id="l18.17">     return icaltz;</span>
<a href="#l18.18"></a><span id="l18.18"> }</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20"> XpcomBase::~XpcomBase() {</span>
<a href="#l18.21"></a><span id="l18.21"> }</span>
<a href="#l18.22"></a><span id="l18.22"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/backend/libical/moz.build</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/backend/libical/moz.build</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -2,25 +2,16 @@</span>
<a href="#l19.4"></a><span id="l19.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l19.5"></a><span id="l19.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l19.6"></a><span id="l19.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8"> DIRS = [</span>
<a href="#l19.9"></a><span id="l19.9">     'build'</span>
<a href="#l19.10"></a><span id="l19.10"> ]</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-XPIDL_SOURCES += [</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-    'calIDateTime.idl',</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-    'calIDuration.idl',</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-    'calIICSService.idl',</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-    'calIPeriod.idl',</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">-]</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">-</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-XPIDL_MODULE = 'caldatetime_libical'</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">-</span>
<a href="#l19.21"></a><span id="l19.21"> SOURCES += [</span>
<a href="#l19.22"></a><span id="l19.22">     'calDateTime.cpp',</span>
<a href="#l19.23"></a><span id="l19.23">     'calDuration.cpp',</span>
<a href="#l19.24"></a><span id="l19.24">     'calICSService.cpp',</span>
<a href="#l19.25"></a><span id="l19.25">     'calPeriod.cpp',</span>
<a href="#l19.26"></a><span id="l19.26">     'calRecurrenceRule.cpp',</span>
<a href="#l19.27"></a><span id="l19.27">     'calTimezone.cpp',</span>
<a href="#l19.28"></a><span id="l19.28">     'calUtils.cpp',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">rename from calendar/base/backend/icaljs/calIDateTimeJS.idl</span>
<a href="#l20.2"></a><span id="l20.2">rename to calendar/base/public/calIDateTime.idl</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineminus">--- a/calendar/base/backend/icaljs/calIDateTimeJS.idl</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineplus">+++ b/calendar/base/public/calIDateTime.idl</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineat">@@ -216,8 +216,17 @@ interface calIDateTime : nsISupports</span>
<a href="#l20.6"></a><span id="l20.6">   readonly attribute calIDateTime endOfYear;</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8">   /**</span>
<a href="#l20.9"></a><span id="l20.9">    * This object as either an iCalendar DATE or DATETIME string, as</span>
<a href="#l20.10"></a><span id="l20.10">    * appropriate and sets the timezone to either UTC or floating.</span>
<a href="#l20.11"></a><span id="l20.11">    */</span>
<a href="#l20.12"></a><span id="l20.12">   attribute ACString icalString;</span>
<a href="#l20.13"></a><span id="l20.13"> };</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+/** Libical specific interfaces */</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+[ptr] native icaltimetypeptr(struct icaltimetype);</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+[scriptable, uuid(04139dff-a6f0-446d-9aec-2062df887ef2)]</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+interface calIDateTimeLibical : calIDateTime</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+{</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+  [noscript,notxpcom] void toIcalTime(in icaltimetypeptr itt);</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">rename from calendar/base/backend/icaljs/calIDurationJS.idl</span>
<a href="#l21.2"></a><span id="l21.2">rename to calendar/base/public/calIDuration.idl</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineminus">--- a/calendar/base/backend/icaljs/calIDurationJS.idl</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineplus">+++ b/calendar/base/public/calIDuration.idl</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineat">@@ -97,8 +97,17 @@ interface calIDuration : nsISupports</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7">   attribute jsval icalDuration;</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9">   /**</span>
<a href="#l21.10"></a><span id="l21.10">    * This object as an iCalendar DURATION string</span>
<a href="#l21.11"></a><span id="l21.11">    */</span>
<a href="#l21.12"></a><span id="l21.12">   attribute ACString icalString;</span>
<a href="#l21.13"></a><span id="l21.13"> };</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+/** Libical specific interfaces */</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+[ptr] native icaldurationtypeptr(struct icaldurationtype);</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+[scriptable, uuid(f5e1c987-e722-4dec-bf91-93d4062b504a)]</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+interface calIDurationLibical : calIDuration</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+{</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+  [noscript,notxpcom] void toIcalDuration(in icaldurationtypeptr idt);</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">rename from calendar/base/backend/icaljs/calIICSServiceJS.idl</span>
<a href="#l22.2"></a><span id="l22.2">rename to calendar/base/public/calIICSService.idl</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineminus">--- a/calendar/base/backend/icaljs/calIICSServiceJS.idl</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineplus">+++ b/calendar/base/public/calIICSService.idl</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineat">@@ -253,8 +253,28 @@ interface calIICSService : nsISupports</span>
<a href="#l22.6"></a><span id="l22.6">     calIIcalComponent createIcalComponent(in AUTF8String kind);</span>
<a href="#l22.7"></a><span id="l22.7">     calIIcalProperty createIcalProperty(in AUTF8String kind);</span>
<a href="#l22.8"></a><span id="l22.8">     calIIcalProperty createIcalPropertyFromString(in AUTF8String str);</span>
<a href="#l22.9"></a><span id="l22.9">     /* I wish I could write this function atop libical!</span>
<a href="#l22.10"></a><span id="l22.10">     boolean isLegalParameterValue(in AUTF8String paramKind,</span>
<a href="#l22.11"></a><span id="l22.11">                                   in AUTF8String paramValue);</span>
<a href="#l22.12"></a><span id="l22.12">     */</span>
<a href="#l22.13"></a><span id="l22.13"> };</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+/** Libical specific interfaces */</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+[ptr] native icalpropertyptr(struct icalproperty_impl);</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+[ptr] native icalcomponentptr(struct icalcomponent_impl);</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+[ptr] native icaltimezoneptr(struct _icaltimezone);</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+[scriptable,uuid(d2fc0264-191e-435e-8ef2-b2ab1fa81ca9)]</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineplus">+interface calIIcalComponentLibical : calIIcalComponent</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineplus">+{</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineplus">+    [noscript,notxpcom] icalcomponentptr getLibicalComponent();</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+    [noscript,notxpcom] icaltimezoneptr getLibicalTimezone();</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+};</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineplus">+</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineplus">+[scriptable,uuid(e0b9067f-0a53-4724-9c69-63599681877e)]</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineplus">+interface calIIcalPropertyLibical : calIIcalProperty</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineplus">+{</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineplus">+    [noscript,notxpcom] icalpropertyptr getLibicalProperty();</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+    [noscript,notxpcom] icalcomponentptr getLibicalComponent();</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">rename from calendar/base/backend/icaljs/calIPeriodJS.idl</span>
<a href="#l23.2"></a><span id="l23.2">rename to calendar/base/public/calIPeriod.idl</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineminus">--- a/calendar/base/backend/icaljs/calIPeriodJS.idl</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineplus">+++ b/calendar/base/public/calIPeriod.idl</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineat">@@ -51,8 +51,17 @@ interface calIPeriod : nsISupports</span>
<a href="#l23.6"></a><span id="l23.6">    */</span>
<a href="#l23.7"></a><span id="l23.7">   AUTF8String toString();</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9">   /**</span>
<a href="#l23.10"></a><span id="l23.10">    * This object as an iCalendar DURATION string</span>
<a href="#l23.11"></a><span id="l23.11">    */</span>
<a href="#l23.12"></a><span id="l23.12">   attribute ACString icalString;</span>
<a href="#l23.13"></a><span id="l23.13"> };</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+/** Libical specific interfaces */</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineplus">+[ptr] native icalperiodtypeptr(struct icalperiodtype);</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineplus">+[scriptable,uuid(04ee525f-96db-4731-8d61-688e754df24f)]</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineplus">+interface calIPeriodLibical : calIPeriod</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineplus">+{</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineplus">+  [noscript,notxpcom] void toIcalPeriod(in icalperiodtypeptr idt);</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/public/moz.build</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/public/moz.build</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -11,28 +11,32 @@ XPIDL_SOURCES += [</span>
<a href="#l24.4"></a><span id="l24.4">     'calICalendar.idl',</span>
<a href="#l24.5"></a><span id="l24.5">     'calICalendarACLManager.idl',</span>
<a href="#l24.6"></a><span id="l24.6">     'calICalendarManager.idl',</span>
<a href="#l24.7"></a><span id="l24.7">     'calICalendarProvider.idl',</span>
<a href="#l24.8"></a><span id="l24.8">     'calICalendarSearchProvider.idl',</span>
<a href="#l24.9"></a><span id="l24.9">     'calICalendarView.idl',</span>
<a href="#l24.10"></a><span id="l24.10">     'calICalendarViewController.idl',</span>
<a href="#l24.11"></a><span id="l24.11">     'calIChangeLog.idl',</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+    'calIDateTime.idl',</span>
<a href="#l24.13"></a><span id="l24.13">     'calIDateTimeFormatter.idl',</span>
<a href="#l24.14"></a><span id="l24.14">     'calIDeletedItems.idl',</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+    'calIDuration.idl',</span>
<a href="#l24.16"></a><span id="l24.16">     'calIErrors.idl',</span>
<a href="#l24.17"></a><span id="l24.17">     'calIEvent.idl',</span>
<a href="#l24.18"></a><span id="l24.18">     'calIFreeBusyProvider.idl',</span>
<a href="#l24.19"></a><span id="l24.19">     'calIIcsParser.idl',</span>
<a href="#l24.20"></a><span id="l24.20">     'calIIcsSerializer.idl',</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineplus">+    'calIICSService.idl',</span>
<a href="#l24.22"></a><span id="l24.22">     'calIImportExport.idl',</span>
<a href="#l24.23"></a><span id="l24.23">     'calIItemBase.idl',</span>
<a href="#l24.24"></a><span id="l24.24">     'calIItipItem.idl',</span>
<a href="#l24.25"></a><span id="l24.25">     'calIItipTransport.idl',</span>
<a href="#l24.26"></a><span id="l24.26">     'calIOperation.idl',</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineplus">+    'calIPeriod.idl',</span>
<a href="#l24.28"></a><span id="l24.28">     'calIPrintFormatter.idl',</span>
<a href="#l24.29"></a><span id="l24.29">     'calIRecurrenceDate.idl',</span>
<a href="#l24.30"></a><span id="l24.30">     'calIRecurrenceInfo.idl',</span>
<a href="#l24.31"></a><span id="l24.31">     'calIRecurrenceItem.idl',</span>
<a href="#l24.32"></a><span id="l24.32">     'calIRecurrenceRule.idl',</span>
<a href="#l24.33"></a><span id="l24.33">     'calIRelation.idl',</span>
<a href="#l24.34"></a><span id="l24.34">     'calISchedulingSupport.idl',</span>
<a href="#l24.35"></a><span id="l24.35">     'calIStartupService.idl',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/test/unit/test_recur.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/test/unit/test_recur.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -567,31 +567,47 @@ function test_rrule_interface() {</span>
<a href="#l25.4"></a><span id="l25.4">     // Now start changing things</span>
<a href="#l25.5"></a><span id="l25.5">     rrule.setComponent(&quot;BYDAY&quot;, 2, [4,5]);</span>
<a href="#l25.6"></a><span id="l25.6">     equal(rrule.icalString.match(/BYDAY=WE,TH/), &quot;BYDAY=WE,TH&quot;);</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8">     rrule.count = -1;</span>
<a href="#l25.9"></a><span id="l25.9">     ok(!rrule.isByCount);</span>
<a href="#l25.10"></a><span id="l25.10">     ok(!rrule.isFinite);</span>
<a href="#l25.11"></a><span id="l25.11">     equal(rrule.icalString.match(/COUNT=/), null);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    throws(function() {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-        rrule.count;</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-    }, /0x80004005/);</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+    throws(() =&gt; rrule.count, /0x80004005/);</span>
<a href="#l25.16"></a><span id="l25.16"> </span>
<a href="#l25.17"></a><span id="l25.17">     rrule.interval = 1;</span>
<a href="#l25.18"></a><span id="l25.18">     equal(rrule.interval, 1);</span>
<a href="#l25.19"></a><span id="l25.19">     equal(rrule.icalString.match(/INTERVAL=/), null);</span>
<a href="#l25.20"></a><span id="l25.20"> </span>
<a href="#l25.21"></a><span id="l25.21">     rrule.interval = 3;</span>
<a href="#l25.22"></a><span id="l25.22">     equal(rrule.interval, 3);</span>
<a href="#l25.23"></a><span id="l25.23">     equal(rrule.icalString.match(/INTERVAL=3/), &quot;INTERVAL=3&quot;);</span>
<a href="#l25.24"></a><span id="l25.24"> </span>
<a href="#l25.25"></a><span id="l25.25">     rrule.type = &quot;MONTHLY&quot;;</span>
<a href="#l25.26"></a><span id="l25.26">     equal(rrule.type, &quot;MONTHLY&quot;);</span>
<a href="#l25.27"></a><span id="l25.27">     equal(rrule.icalString.match(/FREQ=MONTHLY/), &quot;FREQ=MONTHLY&quot;);</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineplus">+</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineplus">+    // untilDate (without UTC)</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineplus">+    rrule.count = 3;</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineplus">+    let untilDate = cal.createDateTime();</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+    untilDate.timezone = cal.getTimezoneService().getTimezone(&quot;Europe/Berlin&quot;);</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+    rrule.untilDate = untilDate;</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+    ok(!rrule.isByCount)</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+    throws(() =&gt; rrule.count, /0x80004005/);</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+    equal(rrule.untilDate.icalString, untilDate.getInTimezone(cal.UTC()).icalString);</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineplus">+</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineplus">+    // untilDate (with UTC)</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineplus">+    rrule.count = 3;</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineplus">+    untilDate = cal.createDateTime();</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineplus">+    untilDate.timezone = cal.UTC();</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineplus">+    rrule.untilDate = untilDate;</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineplus">+    ok(!rrule.isByCount)</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineplus">+    throws(() =&gt; rrule.count, /0x80004005/);</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineplus">+    equal(rrule.untilDate.icalString, untilDate.icalString);</span>
<a href="#l25.46"></a><span id="l25.46"> }</span>
<a href="#l25.47"></a><span id="l25.47"> </span>
<a href="#l25.48"></a><span id="l25.48"> function test_startdate_change() {</span>
<a href="#l25.49"></a><span id="l25.49"> </span>
<a href="#l25.50"></a><span id="l25.50">     // Setting a start date if its missing shouldn't throw</span>
<a href="#l25.51"></a><span id="l25.51">     let item = makeEvent(&quot;DTEND:20020402T124500Z\r\n&quot; +</span>
<a href="#l25.52"></a><span id="l25.52">                          &quot;RRULE:FREQ=DAILY\r\n&quot;);</span>
<a href="#l25.53"></a><span id="l25.53">     item.startDate = cal.createDateTime(&quot;20020502T114500Z&quot;);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

