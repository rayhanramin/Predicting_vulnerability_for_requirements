<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 3958:6f68182d5e7f506004a471d89186a5b200c5300c</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 6f68182d5e7f506004a471d89186a5b200c5300c" />
<meta property="og:url" content="/comm-central/rev/6f68182d5e7f506004a471d89186a5b200c5300c" />
<meta property="og:description" content="Bug 519041 Implement context menu for contentTabs - share mailContext menu with context tabs. r=mkmelin,ui-review=clarkbw,a=Standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 6f68182d5e7f506004a471d89186a5b200c5300c 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/6f68182d5e7f506004a471d89186a5b200c5300c">shortlog</a> |
<a href="/comm-central/log/6f68182d5e7f506004a471d89186a5b200c5300c">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/6f68182d5e7f506004a471d89186a5b200c5300c">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/6f68182d5e7f506004a471d89186a5b200c5300c">files</a> |
changeset |
<a href="/comm-central/raw-rev/6f68182d5e7f506004a471d89186a5b200c5300c">raw</a>  | <a href="/comm-central/archive/6f68182d5e7f506004a471d89186a5b200c5300c.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=519041">Bug 519041</a> Implement context menu for contentTabs - share mailContext menu with context tabs. r=mkmelin,ui-review=clarkbw,a=Standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 29 Sep 2009 09:17:57 +0100</td></tr>

<tr>
 <td>changeset 3958</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/6f68182d5e7f506004a471d89186a5b200c5300c">6f68182d5e7f506004a471d89186a5b200c5300c</a></td>
</tr>



<tr>
<td>parent 3957</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e615de59a7d057b95695942cd260485568290eaa">e615de59a7d057b95695942cd260485568290eaa</a>
</td>
</tr>

<tr>
<td>child 3959</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/21e93a577fa3f5cc7e257da7096c4ed5265e0c19">21e93a577fa3f5cc7e257da7096c4ed5265e0c19</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=6f68182d5e7f506004a471d89186a5b200c5300c">3089</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 29 Sep 2009 08:34:23 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@be58ebcea946 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=be58ebcea9462d695f966e5d2f2205358e2599ce">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=be58ebcea9462d695f966e5d2f2205358e2599ce&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=be58ebcea9462d695f966e5d2f2205358e2599ce&newProject=comm-central&newRevision=6f68182d5e7f506004a471d89186a5b200c5300c&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=be58ebcea9462d695f966e5d2f2205358e2599ce&newProject=comm-central&newRevision=6f68182d5e7f506004a471d89186a5b200c5300c&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=be58ebcea9462d695f966e5d2f2205358e2599ce&newProject=comm-central&newRevision=6f68182d5e7f506004a471d89186a5b200c5300c&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a>, <a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=519041">519041</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=519041">Bug 519041</a> Implement context menu for contentTabs - share mailContext menu with context tabs. r=mkmelin,ui-review=clarkbw,a=Standard8</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailContextMenus.js">mail/base/content/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailWindowOverlay.xul">mail/base/content/mailWindowOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailWindowOverlay.xul">file</a> |
<a href="/comm-central/annotate/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailWindowOverlay.xul">annotate</a> |
<a href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailWindowOverlay.xul">diff</a> |
<a href="/comm-central/comparison/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailWindowOverlay.xul">comparison</a> |
<a href="/comm-central/log/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/mailWindowOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messageWindow.xul">mail/base/content/messageWindow.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messageWindow.xul">file</a> |
<a href="/comm-central/annotate/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messageWindow.xul">annotate</a> |
<a href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messageWindow.xul">diff</a> |
<a href="/comm-central/comparison/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messageWindow.xul">comparison</a> |
<a href="/comm-central/log/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messageWindow.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messenger.xul">mail/base/content/messenger.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messenger.xul">file</a> |
<a href="/comm-central/annotate/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messenger.xul">annotate</a> |
<a href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messenger.xul">diff</a> |
<a href="/comm-central/comparison/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messenger.xul">comparison</a> |
<a href="/comm-central/log/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/messenger.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/nsContextMenu.js">mail/base/content/nsContextMenu.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/nsContextMenu.js">file</a> |
<a href="/comm-central/annotate/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/nsContextMenu.js">annotate</a> |
<a href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/nsContextMenu.js">diff</a> |
<a href="/comm-central/comparison/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/nsContextMenu.js">comparison</a> |
<a href="/comm-central/log/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/nsContextMenu.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/specialTabs.xul">mail/base/content/specialTabs.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/specialTabs.xul">file</a> |
<a href="/comm-central/annotate/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/specialTabs.xul">annotate</a> |
<a href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/specialTabs.xul">diff</a> |
<a href="/comm-central/comparison/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/specialTabs.xul">comparison</a> |
<a href="/comm-central/log/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/content/specialTabs.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/jar.mn">mail/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/jar.mn">file</a> |
<a href="/comm-central/annotate/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/jar.mn">comparison</a> |
<a href="/comm-central/log/6f68182d5e7f506004a471d89186a5b200c5300c/mail/base/jar.mn">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mailContextMenus.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mailContextMenus.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -79,184 +79,29 @@ function RestoreSelectionWithoutContentL</span>
<a href="#l1.4"></a><span id="l1.4">  */</span>
<a href="#l1.5"></a><span id="l1.5"> function mailContextOnPopupHiding(aEvent)</span>
<a href="#l1.6"></a><span id="l1.6"> {</span>
<a href="#l1.7"></a><span id="l1.7">   // Don't do anything if it's a submenu's onpopuphiding that's just bubbling</span>
<a href="#l1.8"></a><span id="l1.8">   // up to the top.</span>
<a href="#l1.9"></a><span id="l1.9">   if (aEvent.target != aEvent.currentTarget)</span>
<a href="#l1.10"></a><span id="l1.10">     return;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+  let wasInThreadPane = gContextMenu.inThreadPane;</span>
<a href="#l1.13"></a><span id="l1.13">   gContextMenu = null;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-  if (popupNodeIsInThreadPane())</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+  if (wasInThreadPane)</span>
<a href="#l1.16"></a><span id="l1.16">     RestoreSelectionWithoutContentLoad(GetThreadTree());</span>
<a href="#l1.17"></a><span id="l1.17"> }</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-/**</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">- * Determines whether the context menu was triggered by a node that's a child</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">- * of the threadpane by looking for a parent node with id=&quot;threadTree&quot;.</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">- * @return true if the popupNode is a child of the threadpane, otherwise false</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">- */</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-function popupNodeIsInThreadPane()</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-{</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-  var node = document.popupNode;</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-  while (node)</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-  {</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-    if (node.id == &quot;threadTree&quot;)</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-      return true;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-    node = node.parentNode;</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-  }</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-  return false;</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-}</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-</span>
<a href="#l1.37"></a><span id="l1.37"> function fillMailContextMenu(event)</span>
<a href="#l1.38"></a><span id="l1.38"> {</span>
<a href="#l1.39"></a><span id="l1.39">   // If the popupshowing was for a submenu, we don't need to do anything.</span>
<a href="#l1.40"></a><span id="l1.40">   if (event.target != event.currentTarget)</span>
<a href="#l1.41"></a><span id="l1.41">     return true;</span>
<a href="#l1.42"></a><span id="l1.42"> </span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-  var numSelected = GetNumSelectedMessages();</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-  if (numSelected == 0)</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-    return false; // Don't show the context menu if no items are selected.</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-  var inThreadPane = popupNodeIsInThreadPane();</span>
<a href="#l1.48"></a><span id="l1.48">   gContextMenu = new nsContextMenu(event.target);</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-  var selectedMessage = gFolderDisplay.selectedMessage;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-  var isNewsgroup = gFolderDisplay.selectedMessageIsNews;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-  // Don't show mail items for links/images, just show related items.</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-  var hideMailItems = !inThreadPane &amp;&amp;</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-                      (gContextMenu.onImage || gContextMenu.onLink);</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-  var single = (numSelected == 1);</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineminus">-</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-  let onPlayableMedia = gContextMenu.onVideo || gContextMenu.onAudio;</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-  // Select-all and copy are only available in the message-pane</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineminus">-  ShowMenuItem(&quot;mailContext-selectall&quot;, !inThreadPane &amp;&amp; !onPlayableMedia);</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-  ShowMenuItem(&quot;mailContext-copy&quot;, !inThreadPane &amp;&amp; !onPlayableMedia);</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-  // Show the Open in New Window  and New Tab options if there is exactly one</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineminus">-  // message selected.</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-  ShowMenuItem(&quot;mailContext-openNewWindow&quot;, single &amp;&amp; inThreadPane);</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-  ShowMenuItem(&quot;threadPaneContext-openNewTab&quot;, single &amp;&amp; inThreadPane);</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-  /**</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-   * Most menu items are visible if there's 1 or 0 messages selected, and</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-   * enabled if there's exactly one selected. Handle those here.</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-   * Exception: playable media is selected, in which case, don't show them.</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-   *</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineminus">-   * @param aID   the id of the element to display/enable</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineminus">-   * @param aHide (optional)  an additional criteria to evaluate when we</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineminus">-   *              decide whether to display the element. If false, we'll hide</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-   *              the item no matter what messages are selected</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-   */</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">- function setSingleSelection(aID, aHide) {</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineminus">-    var hide = aHide != undefined ? aHide : true;</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineminus">-    ShowMenuItem(aID, single &amp;&amp; !hideMailItems &amp;&amp; hide &amp;&amp; !onPlayableMedia);</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-    EnableMenuItem(aID, single);</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineminus">-  }</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineminus">-</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineminus">-  setSingleSelection(&quot;mailContext-replySender&quot;);</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineminus">-  setSingleSelection(&quot;mailContext-editAsNew&quot;);</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineminus">-  setSingleSelection(&quot;mailContext-replyNewsgroup&quot;, isNewsgroup);</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineminus">-  setSingleSelection(&quot;mailContext-replyAll&quot;);</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineminus">-  setSingleSelection(&quot;mailContext-replyList&quot;);</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineminus">-  setSingleSelection(&quot;mailContext-forward&quot;);</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineminus">-  ShowMenuItem(&quot;mailContext-forwardAsAttachment&quot;,</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineminus">-               numSelected &gt; 1 &amp;&amp; inThreadPane &amp;&amp; !hideMailItems);</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineminus">-</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineminus">-  setSingleSelection(&quot;mailContext-copyMessageUrl&quot;, isNewsgroup);</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineminus">-</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineminus">-  ShowMenuItem(&quot;mailContext-sep-open&quot;, single);</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineminus">-</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineminus">-  ShowMenuItem(&quot;mailContext-sep-reply&quot;, true);</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineminus">-</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineminus">-  let msgFolder = gFolderDisplay.displayedFolder;</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineminus">-</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineminus">-  // Set up the move menu. We can't move from newsgroups.</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineminus">-  ShowMenuItem(&quot;mailContext-moveMenu&quot;,</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineminus">-               !isNewsgroup &amp;&amp; !hideMailItems &amp;&amp; msgFolder &amp;&amp; !onPlayableMedia);</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineminus">-</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineminus">-  // disable move if we can't delete message(s) from this folder</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineminus">-  var canMove = msgFolder &amp;&amp; msgFolder.canDeleteMessages;</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineminus">-  EnableMenuItem(&quot;mailContext-moveMenu&quot;, canMove &amp;&amp; !onPlayableMedia);</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineminus">-</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineminus">-  ShowMenuItem(&quot;mailContext-archive&quot;, canMove);</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineminus">-</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineminus">-  // Copy is available as long as something is selected.</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineminus">-  ShowMenuItem(&quot;mailContext-copyMenu&quot;,</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineminus">-               !hideMailItems &amp;&amp; msgFolder &amp;&amp; !onPlayableMedia);</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineminus">-</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineminus">-  let hideMoveToFolderAgain = !hideMailItems &amp;&amp; msgFolder &amp;&amp; !onPlayableMedia;</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineminus">-  ShowMenuItem(&quot;mailContext-moveToFolderAgain&quot;, hideMoveToFolderAgain);</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineminus">-  if (hideMoveToFolderAgain) {</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineminus">-    initMoveToFolderAgainMenu(document.getElementById(&quot;mailContext-moveToFolderAgain&quot;));</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineminus">-    goUpdateCommand(&quot;cmd_moveToFolderAgain&quot;);</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineminus">-  }</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineminus">-</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineminus">-  ShowMenuItem(&quot;paneContext-afterMove&quot;, !inThreadPane);</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineminus">-</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineminus">-  ShowMenuItem(&quot;mailContext-tags&quot;, !hideMailItems &amp;&amp; msgFolder &amp;&amp; !onPlayableMedia);</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineminus">-</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineminus">-  ShowMenuItem(&quot;mailContext-mark&quot;, !hideMailItems &amp;&amp; msgFolder &amp;&amp; !onPlayableMedia);</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineminus">-</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineminus">-  setSingleSelection(&quot;mailContext-saveAs&quot;);</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineminus">-  if (Application.platformIsMac)</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineminus">-    ShowMenuItem(&quot;mailContext-printpreview&quot;, false);</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineminus">-  else</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineminus">-    setSingleSelection(&quot;mailContext-printpreview&quot;);</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineminus">-</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineminus">-  ShowMenuItem(&quot;mailContext-print&quot;, !hideMailItems &amp;&amp; !onPlayableMedia);</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineminus">-</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineminus">-  ShowMenuItem(&quot;mailContext-delete&quot;,</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineminus">-               !hideMailItems &amp;&amp; (isNewsgroup || canMove) &amp;&amp; !onPlayableMedia);</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineminus">-  // This function is needed for the case where a folder is just loaded (while</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineminus">-  // there isn't a message loaded in the message pane), a right-click is done</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineminus">-  // in the thread pane.  This function will disable enable the 'Delete</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineminus">-  // Message' menu item.</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineminus">-  goUpdateCommand('cmd_delete');</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineminus">-</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineminus">-  setSingleSelection(&quot;mailContext-composeemailto&quot;,</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineminus">-                     gContextMenu.onMailtoLink &amp;&amp; !inThreadPane);</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineminus">-  setSingleSelection(&quot;mailContext-addemail&quot;,</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineminus">-                     gContextMenu.onMailtoLink &amp;&amp; !inThreadPane);</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineminus">-</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineminus">-  ShowMenuItem(&quot;mailContext-sep-edit&quot;, single);</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineminus">-</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineminus">-  ShowMenuItem('downloadSelected', numSelected &gt; 1 &amp;&amp; !hideMailItems);</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineminus">-</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineminus">-  ShowMenuItem(&quot;mailContext-reportPhishingURL&quot;,</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineminus">-               !inThreadPane &amp;&amp; gContextMenu.onLink &amp;&amp; !gContextMenu.onMailtoLink);</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineminus">-</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineminus">-  // handle our separators</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineminus">-  function hideIfAppropriate(aID) {</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineminus">-    var separator = document.getElementById(aID);</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineminus">-    var sibling = separator.previousSibling;</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineminus">-    while (sibling) {</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineminus">-      if (!sibling.hidden) {</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineminus">-        ShowMenuItem(aID, sibling.localName != &quot;menuseparator&quot; &amp;&amp;</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineminus">-                          hasAVisibleNextSibling(separator));</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineminus">-        return;</span>
<a href="#l1.166"></a><span id="l1.166" class="difflineminus">-      }</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineminus">-      sibling = sibling.previousSibling;</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineminus">-    }</span>
<a href="#l1.169"></a><span id="l1.169" class="difflineminus">-    ShowMenuItem(aID, false);</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineminus">-  }</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineminus">-</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineminus">-  hideIfAppropriate(&quot;mailContext-sep-link&quot;);</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineminus">-  hideIfAppropriate(&quot;mailContext-sep-open&quot;);</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineminus">-  hideIfAppropriate(&quot;mailContext-sep-open2&quot;);</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineminus">-  hideIfAppropriate(&quot;mailContext-sep-reply&quot;);</span>
<a href="#l1.176"></a><span id="l1.176" class="difflineminus">-  hideIfAppropriate(&quot;paneContext-afterMove&quot;);</span>
<a href="#l1.177"></a><span id="l1.177" class="difflineminus">-  hideIfAppropriate(&quot;mailContext-sep-afterMarkMenu&quot;);</span>
<a href="#l1.178"></a><span id="l1.178" class="difflineminus">-  hideIfAppropriate(&quot;mailContext-sep-edit&quot;);</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineminus">-  hideIfAppropriate(&quot;mailContext-sep-copy&quot;);</span>
<a href="#l1.180"></a><span id="l1.180" class="difflineminus">-  hideIfAppropriate(&quot;mailContext-sep-reportPhishing&quot;);</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineminus">-</span>
<a href="#l1.182"></a><span id="l1.182">   return true;</span>
<a href="#l1.183"></a><span id="l1.183"> }</span>
<a href="#l1.184"></a><span id="l1.184"> </span>
<a href="#l1.185"></a><span id="l1.185"> // show the message id in the context menu</span>
<a href="#l1.186"></a><span id="l1.186"> function FillMessageIdContextMenu(messageIdNode)</span>
<a href="#l1.187"></a><span id="l1.187"> {</span>
<a href="#l1.188"></a><span id="l1.188">   if (messageIdNode)</span>
<a href="#l1.189"></a><span id="l1.189">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -622,17 +622,16 @@</span>
<a href="#l2.4"></a><span id="l2.4">                  fileHereAccessKey=&quot;&amp;copyHereMenu.accesskey;&quot;</span>
<a href="#l2.5"></a><span id="l2.5">                  recentLabel=&quot;&amp;contextMoveCopyMsgRecentMenu.label;&quot;</span>
<a href="#l2.6"></a><span id="l2.6">                  recentAccessKey=&quot;&amp;contextMoveCopyMsgRecentMenu.accesskey;&quot;/&gt;</span>
<a href="#l2.7"></a><span id="l2.7">     &lt;/menu&gt;</span>
<a href="#l2.8"></a><span id="l2.8">     &lt;menuitem id=&quot;mailContext-moveToFolderAgain&quot;</span>
<a href="#l2.9"></a><span id="l2.9">               command=&quot;cmd_moveToFolderAgain&quot;</span>
<a href="#l2.10"></a><span id="l2.10">               label=&quot;&amp;moveToFolderAgain.label;&quot;</span>
<a href="#l2.11"></a><span id="l2.11">               accesskey=&quot;&amp;moveToFolderAgain.accesskey;&quot;/&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    &lt;!-- This separator is only shown in the message pane --&gt;</span>
<a href="#l2.13"></a><span id="l2.13">     &lt;menuseparator id=&quot;paneContext-afterMove&quot;/&gt;</span>
<a href="#l2.14"></a><span id="l2.14">     &lt;menu id=&quot;mailContext-tags&quot; label=&quot;&amp;tagMenu.label;&quot; accesskey=&quot;&amp;tagMenu.accesskey;&quot;&gt;</span>
<a href="#l2.15"></a><span id="l2.15">       &lt;menupopup id=&quot;mailContext-tagpopup&quot;</span>
<a href="#l2.16"></a><span id="l2.16">                  onpopupshowing=&quot;InitMessageTags(this)&quot;&gt;</span>
<a href="#l2.17"></a><span id="l2.17">         &lt;menuitem id=&quot;mailContext-tagRemoveAll&quot;</span>
<a href="#l2.18"></a><span id="l2.18">                   oncommand=&quot;RemoveAllMessageTags();&quot;/&gt;</span>
<a href="#l2.19"></a><span id="l2.19">         &lt;menuseparator id=&quot;mailContext-sep-afterTagRemoveAll&quot;/&gt;</span>
<a href="#l2.20"></a><span id="l2.20">         &lt;menuseparator id=&quot;mailContext-sep-beforeAddNewTag&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/messageWindow.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/messageWindow.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -81,17 +81,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/shareglue.js&quot;/&gt;</span>
<a href="#l3.5"></a><span id="l3.5">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/commandglue.js&quot;/&gt;</span>
<a href="#l3.6"></a><span id="l3.6">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/folderDisplay.js&quot;/&gt;</span>
<a href="#l3.7"></a><span id="l3.7">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/messageDisplay.js&quot;/&gt;</span>
<a href="#l3.8"></a><span id="l3.8">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/mailWindow.js&quot;/&gt;</span>
<a href="#l3.9"></a><span id="l3.9">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/messageWindow.js&quot;/&gt;</span>
<a href="#l3.10"></a><span id="l3.10">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/accountUtils.js&quot;/&gt;</span>
<a href="#l3.11"></a><span id="l3.11">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://global/content/contentAreaUtils.js&quot;/&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://communicator/content/nsContextMenu.js&quot;/&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/nsContextMenu.js&quot;/&gt;</span>
<a href="#l3.14"></a><span id="l3.14">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/mailContextMenus.js&quot;/&gt;</span>
<a href="#l3.15"></a><span id="l3.15">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/phishingDetector.js&quot;/&gt;</span>
<a href="#l3.16"></a><span id="l3.16">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://communicator/content/contentAreaClick.js&quot;/&gt;</span>
<a href="#l3.17"></a><span id="l3.17">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://global/content/nsDragAndDrop.js&quot;/&gt;</span>
<a href="#l3.18"></a><span id="l3.18">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/msgViewNavigation.js&quot;/&gt;</span>
<a href="#l3.19"></a><span id="l3.19">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/widgetglue.js&quot;/&gt;</span>
<a href="#l3.20"></a><span id="l3.20">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/editContactOverlay.js&quot;/&gt;</span>
<a href="#l3.21"></a><span id="l3.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/messenger.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/messenger.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -91,17 +91,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/mailWindow.js&quot;/&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/selectionsummaries.js&quot;/&gt;</span>
<a href="#l4.6"></a><span id="l4.6"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/msgMail3PaneWindow.js&quot;/&gt;</span>
<a href="#l4.7"></a><span id="l4.7"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/specialTabs.js&quot;/&gt;</span>
<a href="#l4.8"></a><span id="l4.8"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/glodaFacetTab.js&quot;/&gt;</span>
<a href="#l4.9"></a><span id="l4.9"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/searchBar.js&quot;/&gt;</span>
<a href="#l4.10"></a><span id="l4.10"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/mail3PaneWindowCommands.js&quot;/&gt;</span>
<a href="#l4.11"></a><span id="l4.11"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://global/content/contentAreaUtils.js&quot;/&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-&lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://communicator/content/nsContextMenu.js&quot;/&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+&lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/nsContextMenu.js&quot;/&gt;</span>
<a href="#l4.14"></a><span id="l4.14"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/mailContextMenus.js&quot;/&gt;</span>
<a href="#l4.15"></a><span id="l4.15"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/accountUtils.js&quot;/&gt;</span>
<a href="#l4.16"></a><span id="l4.16"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/folderPane.js&quot;/&gt;</span>
<a href="#l4.17"></a><span id="l4.17"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/phishingDetector.js&quot;/&gt;</span>
<a href="#l4.18"></a><span id="l4.18"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://communicator/content/contentAreaClick.js&quot;/&gt;</span>
<a href="#l4.19"></a><span id="l4.19"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://global/content/nsDragAndDrop.js&quot;/&gt;</span>
<a href="#l4.20"></a><span id="l4.20"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/editContactOverlay.js&quot;/&gt;</span>
<a href="#l4.21"></a><span id="l4.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/nsContextMenu.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/nsContextMenu.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,129 +1,254 @@</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineminus">-# -*- Mode: C; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">-#</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-#</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-# License.</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-#</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-# The Original Code is Mozilla Communicator client code, released</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-# March 31, 1998.</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-#</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-#</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-#   William A. (&quot;PowerGUI&quot;) Law &lt;law@netscape.com&gt;</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-#   Blake Ross &lt;blakeross@telocity.com&gt;</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-#   Gervase Markham &lt;gerv@gerv.net&gt;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-#   Phil Ringnalda &lt;philringnalda@gmail.com&gt;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-#</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-#</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+/** ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+ *</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+ *</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+ * License.</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+ *</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+ * The Original Code is Mozilla Communicator client code, released</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+ * March 31, 1998.</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+ *</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+ * Netscape Communications Corporation.</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+ *</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+ * Contributor(s):</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+ *   William A. (&quot;PowerGUI&quot;) Law &lt;law@netscape.com&gt;</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+ *   Blake Ross &lt;blakeross@telocity.com&gt;</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+ *   Gervase Markham &lt;gerv@gerv.net&gt;</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+ *   Phil Ringnalda &lt;philringnalda@gmail.com&gt;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+ *</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+ *</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l5.85"></a><span id="l5.85"> </span>
<a href="#l5.86"></a><span id="l5.86"> function nsContextMenu(aXulMenu) {</span>
<a href="#l5.87"></a><span id="l5.87">   this.target         = null;</span>
<a href="#l5.88"></a><span id="l5.88">   this.menu           = null;</span>
<a href="#l5.89"></a><span id="l5.89">   this.onTextInput    = false;</span>
<a href="#l5.90"></a><span id="l5.90">   this.onImage        = false;</span>
<a href="#l5.91"></a><span id="l5.91">   this.onLoadedImage  = false;</span>
<a href="#l5.92"></a><span id="l5.92">   this.onVideo        = false;</span>
<a href="#l5.93"></a><span id="l5.93">   this.onAudio        = false;</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+  this.onPlayableMedia = false;</span>
<a href="#l5.95"></a><span id="l5.95">   this.onLink         = false;</span>
<a href="#l5.96"></a><span id="l5.96">   this.onMailtoLink   = false;</span>
<a href="#l5.97"></a><span id="l5.97">   this.onSaveableLink = false;</span>
<a href="#l5.98"></a><span id="l5.98">   this.onMetaDataItem = false;</span>
<a href="#l5.99"></a><span id="l5.99">   this.onMathML       = false;</span>
<a href="#l5.100"></a><span id="l5.100">   this.link           = false;</span>
<a href="#l5.101"></a><span id="l5.101">   this.linkURL        = &quot;&quot;;</span>
<a href="#l5.102"></a><span id="l5.102">   this.linkURI        = null;</span>
<a href="#l5.103"></a><span id="l5.103">   this.linkProtocol   = null;</span>
<a href="#l5.104"></a><span id="l5.104">   this.mediaURL       = &quot;&quot;;</span>
<a href="#l5.105"></a><span id="l5.105">   this.inFrame        = false;</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-  this.hasBGImage     = false;</span>
<a href="#l5.107"></a><span id="l5.107">   this.isContentSelected = false;</span>
<a href="#l5.108"></a><span id="l5.108">   this.inDirList      = false;</span>
<a href="#l5.109"></a><span id="l5.109">   this.shouldDisplay  = true;</span>
<a href="#l5.110"></a><span id="l5.110"> </span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+  // Message Related Items</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+  this.inMessageArea = false;</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+  this.inThreadPane = false;</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+  this.numSelectedMessages = 0;</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+  this.selectedMessage = null;</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineplus">+  this.isNewsgroup = false;</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineplus">+  this.hideMailItems = false;</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+</span>
<a href="#l5.119"></a><span id="l5.119">   this.initMenu(aXulMenu);</span>
<a href="#l5.120"></a><span id="l5.120"> }</span>
<a href="#l5.121"></a><span id="l5.121"> </span>
<a href="#l5.122"></a><span id="l5.122"> nsContextMenu.prototype = {</span>
<a href="#l5.123"></a><span id="l5.123">   /**</span>
<a href="#l5.124"></a><span id="l5.124">    * Init: set properties based on the clicked-on element and the state of</span>
<a href="#l5.125"></a><span id="l5.125">    * the world, then determine which context menu items to show based on</span>
<a href="#l5.126"></a><span id="l5.126">    * those properties.</span>
<a href="#l5.127"></a><span id="l5.127">    */</span>
<a href="#l5.128"></a><span id="l5.128">   initMenu : function CM_initMenu(aPopup) {</span>
<a href="#l5.129"></a><span id="l5.129">     this.menu = aPopup;</span>
<a href="#l5.130"></a><span id="l5.130"> </span>
<a href="#l5.131"></a><span id="l5.131">     // Get contextual info.</span>
<a href="#l5.132"></a><span id="l5.132">     this.setTarget(document.popupNode);</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineplus">+    this.setMessageTargets(document.popupNode);</span>
<a href="#l5.134"></a><span id="l5.134">     this.isContentSelected = this.isContentSelection();</span>
<a href="#l5.135"></a><span id="l5.135"> </span>
<a href="#l5.136"></a><span id="l5.136">     this.initItems();</span>
<a href="#l5.137"></a><span id="l5.137">   },</span>
<a href="#l5.138"></a><span id="l5.138">   initItems : function CM_initItems() {</span>
<a href="#l5.139"></a><span id="l5.139">     this.initSaveItems();</span>
<a href="#l5.140"></a><span id="l5.140">     this.initClipboardItems();</span>
<a href="#l5.141"></a><span id="l5.141">     this.initMediaPlayerItems();</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineplus">+    this.initMessageItems();</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+    this.initSeparators();</span>
<a href="#l5.144"></a><span id="l5.144">   },</span>
<a href="#l5.145"></a><span id="l5.145">   initSaveItems : function CM_initSaveItems() {</span>
<a href="#l5.146"></a><span id="l5.146">     this.showItem(&quot;mailContext-savelink&quot;, this.onSaveableLink);</span>
<a href="#l5.147"></a><span id="l5.147">     this.showItem(&quot;mailContext-saveimage&quot;, this.onLoadedImage);</span>
<a href="#l5.148"></a><span id="l5.148">   },</span>
<a href="#l5.149"></a><span id="l5.149">   initClipboardItems : function CM_initClipboardItems() {</span>
<a href="#l5.150"></a><span id="l5.150">     // Copy depends on whether there is selected text.</span>
<a href="#l5.151"></a><span id="l5.151">     // Enabling this context menu item is now done through the global</span>
<a href="#l5.152"></a><span id="l5.152">     // command updating system.</span>
<a href="#l5.153"></a><span id="l5.153"> </span>
<a href="#l5.154"></a><span id="l5.154">     goUpdateGlobalEditMenuItems();</span>
<a href="#l5.155"></a><span id="l5.155"> </span>
<a href="#l5.156"></a><span id="l5.156" class="difflineminus">-    this.showItem(&quot;mailContext-copy&quot;, this.isContentSelected || this.onTextInput);</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineminus">-    this.showItem(&quot;mailContext-selectall&quot;, true);</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineplus">+    this.showItem(&quot;mailContext-copy&quot;,</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineplus">+                  !this.inThreadPane &amp;&amp; !this.onPlayableMedia &amp;&amp;</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineplus">+                  (this.isContentSelected || this.onTextInput));</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineplus">+</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineplus">+    // Select all not available in the thread pane or on playable media.</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineplus">+    this.showItem(&quot;mailContext-selectall&quot;, !this.inThreadPane &amp;&amp; !this.onPlayableMedia);</span>
<a href="#l5.164"></a><span id="l5.164">     this.showItem(&quot;mailContext-copyemail&quot;, this.onMailtoLink);</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineminus">-    this.showItem(&quot;mailContext-copylink&quot;, this.onLink);</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineplus">+    this.showItem(&quot;mailContext-copylink&quot;, this.onLink &amp;&amp; !this.onMailtoLink);</span>
<a href="#l5.167"></a><span id="l5.167">     this.showItem(&quot;mailContext-copyimage&quot;, this.onImage);</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineplus">+</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineplus">+    this.showItem(&quot;mailContext-composeemailto&quot;, this.onMailtoLink &amp;&amp; !this.inThreadPane);</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineplus">+    this.showItem(&quot;mailContext-addemail&quot;, this.onMailtoLink &amp;&amp; !this.inThreadPane);</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineplus">+</span>
<a href="#l5.172"></a><span id="l5.172">   },</span>
<a href="#l5.173"></a><span id="l5.173">   initMediaPlayerItems: function CM_initMediaPlayerItems() {</span>
<a href="#l5.174"></a><span id="l5.174">     let onMedia = this.onVideo || this.onAudio;</span>
<a href="#l5.175"></a><span id="l5.175">     // Several mutually exclusive items.... play/pause, mute/unmute, show/hide</span>
<a href="#l5.176"></a><span id="l5.176">     this.showItem(&quot;mailContext-media-play&quot;, onMedia &amp;&amp; this.target.paused);</span>
<a href="#l5.177"></a><span id="l5.177">     this.showItem(&quot;mailContext-media-pause&quot;, onMedia &amp;&amp; !this.target.paused);</span>
<a href="#l5.178"></a><span id="l5.178">     this.showItem(&quot;mailContext-media-mute&quot;, onMedia &amp;&amp; !this.target.muted);</span>
<a href="#l5.179"></a><span id="l5.179">     this.showItem(&quot;mailContext-media-unmute&quot;, onMedia &amp;&amp; this.target.muted);</span>
<a href="#l5.180"></a><span id="l5.180">     if (onMedia) {</span>
<a href="#l5.181"></a><span id="l5.181">       let hasError = this.target.error != null;</span>
<a href="#l5.182"></a><span id="l5.182">       this.setItemAttr(&quot;mailContext-media-play&quot;, &quot;disabled&quot;, hasError);</span>
<a href="#l5.183"></a><span id="l5.183">       this.setItemAttr(&quot;mailContext-media-pause&quot;, &quot;disabled&quot;, hasError);</span>
<a href="#l5.184"></a><span id="l5.184">       this.setItemAttr(&quot;mailContext-media-mute&quot;, &quot;disabled&quot;, hasError);</span>
<a href="#l5.185"></a><span id="l5.185">       this.setItemAttr(&quot;mailContext-media-unmute&quot;, &quot;disabled&quot;, hasError);</span>
<a href="#l5.186"></a><span id="l5.186">     }</span>
<a href="#l5.187"></a><span id="l5.187">   },</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineplus">+  initMessageItems: function CM_initMessageItems() {</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineplus">+    // If we're not in a message related tab, we're just going to bulk hide most</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineplus">+    // items as this simplifies the logic below.</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineplus">+    if (!this.inMessageArea) {</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineplus">+      const messageTabSpecificItems = [</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineplus">+        &quot;mailContext-openNewWindow&quot;, &quot;threadPaneContext-openNewTab&quot;,</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineplus">+        &quot;mailContext-archive&quot;, &quot;mailContext-replySender&quot;,</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineplus">+        &quot;mailContext-editAsNew&quot;, &quot;mailContext-replyNewsgroup&quot;,</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineplus">+        &quot;mailContext-replyAll&quot;, &quot;mailContext-replyList&quot;,</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineplus">+        &quot;mailContext-forward&quot;, &quot;mailContext-forwardAsAttachment&quot;,</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineplus">+        &quot;mailContext-copyMessageUrl&quot;, &quot;mailContext-moveMenu&quot;,</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineplus">+        &quot;mailContext-copyMenu&quot;, &quot;mailContext-moveToFolderAgain&quot;,</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineplus">+        &quot;mailContext-tags&quot;, &quot;mailContext-mark&quot;, &quot;mailContext-saveAs&quot;,</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineplus">+        &quot;mailContext-printpreview&quot;, &quot;mailContext-print&quot;, &quot;mailContext-delete&quot;,</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineplus">+        &quot;downloadSelected&quot;, &quot;mailContext-reportPhishingURL&quot;</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineplus">+      ];</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineplus">+      for (let i = 0; i &lt; messageTabSpecificItems.length; ++i)</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineplus">+        this.showItem(messageTabSpecificItems[i], false);</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineplus">+      return;</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineplus">+    }</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineplus">+</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineplus">+    let msgFolder = gFolderDisplay.displayedFolder;</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineplus">+    var canMove = msgFolder &amp;&amp; msgFolder.canDeleteMessages;</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineplus">+</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineplus">+    // Show the Open in New Window and New Tab options if there is exactly one</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineplus">+    // message selected.</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineplus">+    this.showItem(&quot;mailContext-openNewWindow&quot;,</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineplus">+                  this.numSelectedMessages == 1 &amp;&amp; this.inThreadPane);</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineplus">+    this.showItem(&quot;threadPaneContext-openNewTab&quot;,</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineplus">+                  this.numSelectedMessages == 1 &amp;&amp; this.inThreadPane);</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineplus">+</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineplus">+    this.setSingleSelection(&quot;mailContext-replySender&quot;);</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineplus">+    this.setSingleSelection(&quot;mailContext-editAsNew&quot;);</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineplus">+    this.setSingleSelection(&quot;mailContext-replyNewsgroup&quot;, this.isNewsgroup);</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineplus">+    this.setSingleSelection(&quot;mailContext-replyAll&quot;);</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineplus">+    this.setSingleSelection(&quot;mailContext-replyList&quot;);</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineplus">+    this.setSingleSelection(&quot;mailContext-forward&quot;);</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineplus">+</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineplus">+    this.showItem(&quot;mailContext-forwardAsAttachment&quot;,</span>
<a href="#l5.227"></a><span id="l5.227" class="difflineplus">+                  this.numSelectedMessages &gt; 1 &amp;&amp; this.inThreadPane &amp;&amp;</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineplus">+                  !this.hideMailItems);</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineplus">+</span>
<a href="#l5.230"></a><span id="l5.230" class="difflineplus">+    this.setSingleSelection(&quot;mailContext-copyMessageUrl&quot;, this.isNewsgroup);</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineplus">+</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineplus">+    let msgModifyItems = this.numSelectedMessages &gt; 0 &amp;&amp; !this.hideMailItems &amp;&amp;</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineplus">+                         msgFolder &amp;&amp; !this.onPlayableMedia;</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineplus">+</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineplus">+    this.showItem(&quot;mailContext-archive&quot;, canMove &amp;&amp; msgModifyItems);</span>
<a href="#l5.236"></a><span id="l5.236" class="difflineplus">+</span>
<a href="#l5.237"></a><span id="l5.237" class="difflineplus">+    // Set up the move menu. We can't move from newsgroups.</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineplus">+    this.showItem(&quot;mailContext-moveMenu&quot;,</span>
<a href="#l5.239"></a><span id="l5.239" class="difflineplus">+                  msgModifyItems &amp;&amp; !this.isNewsgroup);</span>
<a href="#l5.240"></a><span id="l5.240" class="difflineplus">+</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineplus">+    // disable move if we can't delete message(s) from this folder</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineplus">+    this.enableItem(&quot;mailContext-moveMenu&quot;, canMove &amp;&amp; !this.onPlayableMedia);</span>
<a href="#l5.243"></a><span id="l5.243" class="difflineplus">+</span>
<a href="#l5.244"></a><span id="l5.244" class="difflineplus">+    // Copy is available as long as something is selected.</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineplus">+    this.showItem(&quot;mailContext-copyMenu&quot;, msgModifyItems);</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineplus">+</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineplus">+    this.showItem(&quot;mailContext-moveToFolderAgain&quot;, msgModifyItems);</span>
<a href="#l5.248"></a><span id="l5.248" class="difflineplus">+    if (msgModifyItems) {</span>
<a href="#l5.249"></a><span id="l5.249" class="difflineplus">+      initMoveToFolderAgainMenu(document.getElementById(&quot;mailContext-moveToFolderAgain&quot;));</span>
<a href="#l5.250"></a><span id="l5.250" class="difflineplus">+      goUpdateCommand(&quot;cmd_moveToFolderAgain&quot;);</span>
<a href="#l5.251"></a><span id="l5.251" class="difflineplus">+    }</span>
<a href="#l5.252"></a><span id="l5.252" class="difflineplus">+</span>
<a href="#l5.253"></a><span id="l5.253" class="difflineplus">+    this.showItem(&quot;mailContext-tags&quot;, msgModifyItems);</span>
<a href="#l5.254"></a><span id="l5.254" class="difflineplus">+</span>
<a href="#l5.255"></a><span id="l5.255" class="difflineplus">+    this.showItem(&quot;mailContext-mark&quot;, msgModifyItems);</span>
<a href="#l5.256"></a><span id="l5.256" class="difflineplus">+</span>
<a href="#l5.257"></a><span id="l5.257" class="difflineplus">+    this.setSingleSelection(&quot;mailContext-saveAs&quot;);</span>
<a href="#l5.258"></a><span id="l5.258" class="difflineplus">+    if (Application.platformIsMac)</span>
<a href="#l5.259"></a><span id="l5.259" class="difflineplus">+      this.showItem(&quot;mailContext-printpreview&quot;, false);</span>
<a href="#l5.260"></a><span id="l5.260" class="difflineplus">+    else</span>
<a href="#l5.261"></a><span id="l5.261" class="difflineplus">+      this.setSingleSelection(&quot;mailContext-printpreview&quot;);</span>
<a href="#l5.262"></a><span id="l5.262" class="difflineplus">+</span>
<a href="#l5.263"></a><span id="l5.263" class="difflineplus">+    // XXX Not quite modifying the message, but the same rules apply at the</span>
<a href="#l5.264"></a><span id="l5.264" class="difflineplus">+    // moment as we can't print non-message content from the message pane yet.</span>
<a href="#l5.265"></a><span id="l5.265" class="difflineplus">+    this.showItem(&quot;mailContext-print&quot;, msgModifyItems);</span>
<a href="#l5.266"></a><span id="l5.266" class="difflineplus">+</span>
<a href="#l5.267"></a><span id="l5.267" class="difflineplus">+    this.showItem(&quot;mailContext-delete&quot;,</span>
<a href="#l5.268"></a><span id="l5.268" class="difflineplus">+                  msgModifyItems &amp;&amp; (this.isNewsgroup || canMove));</span>
<a href="#l5.269"></a><span id="l5.269" class="difflineplus">+</span>
<a href="#l5.270"></a><span id="l5.270" class="difflineplus">+    // This function is needed for the case where a folder is just loaded (while</span>
<a href="#l5.271"></a><span id="l5.271" class="difflineplus">+    // there isn't a message loaded in the message pane), a right-click is done</span>
<a href="#l5.272"></a><span id="l5.272" class="difflineplus">+    // in the thread pane. This function will disable enable the 'Delete</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineplus">+    // Message' menu item.</span>
<a href="#l5.274"></a><span id="l5.274" class="difflineplus">+    goUpdateCommand('cmd_delete');</span>
<a href="#l5.275"></a><span id="l5.275" class="difflineplus">+</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineplus">+    this.showItem('downloadSelected',</span>
<a href="#l5.277"></a><span id="l5.277" class="difflineplus">+                  this.numSelectedMessages &gt; 1 &amp;&amp; !this.hideMailItems);</span>
<a href="#l5.278"></a><span id="l5.278" class="difflineplus">+</span>
<a href="#l5.279"></a><span id="l5.279" class="difflineplus">+    this.showItem(&quot;mailContext-reportPhishingURL&quot;,</span>
<a href="#l5.280"></a><span id="l5.280" class="difflineplus">+                  this.numSelectedMessages &gt; 0 &amp;&amp; !this.inThreadPane &amp;&amp;</span>
<a href="#l5.281"></a><span id="l5.281" class="difflineplus">+                  this.onLink &amp;&amp; !this.onMailtoLink);</span>
<a href="#l5.282"></a><span id="l5.282" class="difflineplus">+  },</span>
<a href="#l5.283"></a><span id="l5.283" class="difflineplus">+  initSeparators: function CM_initSeparators() {</span>
<a href="#l5.284"></a><span id="l5.284" class="difflineplus">+    this.hideIfAppropriate(&quot;mailContext-sep-link&quot;);</span>
<a href="#l5.285"></a><span id="l5.285" class="difflineplus">+    this.hideIfAppropriate(&quot;mailContext-sep-open&quot;);</span>
<a href="#l5.286"></a><span id="l5.286" class="difflineplus">+    this.hideIfAppropriate(&quot;mailContext-sep-open2&quot;);</span>
<a href="#l5.287"></a><span id="l5.287" class="difflineplus">+    this.hideIfAppropriate(&quot;mailContext-sep-reply&quot;);</span>
<a href="#l5.288"></a><span id="l5.288" class="difflineplus">+    this.hideIfAppropriate(&quot;paneContext-afterMove&quot;);</span>
<a href="#l5.289"></a><span id="l5.289" class="difflineplus">+    this.hideIfAppropriate(&quot;mailContext-sep-afterMarkMenu&quot;);</span>
<a href="#l5.290"></a><span id="l5.290" class="difflineplus">+    this.hideIfAppropriate(&quot;mailContext-sep-edit&quot;);</span>
<a href="#l5.291"></a><span id="l5.291" class="difflineplus">+    this.hideIfAppropriate(&quot;mailContext-sep-copy&quot;);</span>
<a href="#l5.292"></a><span id="l5.292" class="difflineplus">+    this.hideIfAppropriate(&quot;mailContext-sep-reportPhishing&quot;);</span>
<a href="#l5.293"></a><span id="l5.293" class="difflineplus">+    this.checkLastSeparator(this.menu);</span>
<a href="#l5.294"></a><span id="l5.294" class="difflineplus">+  },</span>
<a href="#l5.295"></a><span id="l5.295"> </span>
<a href="#l5.296"></a><span id="l5.296">   /**</span>
<a href="#l5.297"></a><span id="l5.297">    * Set the nsContextMenu properties based on the selected node and</span>
<a href="#l5.298"></a><span id="l5.298">    * its ancestors.</span>
<a href="#l5.299"></a><span id="l5.299">    */</span>
<a href="#l5.300"></a><span id="l5.300">   setTarget : function CM_setTarget(aNode) {</span>
<a href="#l5.301"></a><span id="l5.301">     const xulNS =</span>
<a href="#l5.302"></a><span id="l5.302">       &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;;</span>
<a href="#l5.303"></a><span id="l5.303" class="difflineat">@@ -140,18 +265,16 @@ nsContextMenu.prototype = {</span>
<a href="#l5.304"></a><span id="l5.304">     this.onVideo        = false;</span>
<a href="#l5.305"></a><span id="l5.305">     this.onAudio        = false;</span>
<a href="#l5.306"></a><span id="l5.306">     this.mediaURL       = &quot;&quot;;</span>
<a href="#l5.307"></a><span id="l5.307">     this.linkURL        = &quot;&quot;;</span>
<a href="#l5.308"></a><span id="l5.308">     this.linkURI        = null;</span>
<a href="#l5.309"></a><span id="l5.309">     this.linkProtocol   = null;</span>
<a href="#l5.310"></a><span id="l5.310">     this.onMathML       = false;</span>
<a href="#l5.311"></a><span id="l5.311">     this.inFrame        = false;</span>
<a href="#l5.312"></a><span id="l5.312" class="difflineminus">-    this.hasBGImage     = false;</span>
<a href="#l5.313"></a><span id="l5.313" class="difflineminus">-    this.bgImageURL     = &quot;&quot;;</span>
<a href="#l5.314"></a><span id="l5.314"> </span>
<a href="#l5.315"></a><span id="l5.315">     this.target = aNode;</span>
<a href="#l5.316"></a><span id="l5.316"> </span>
<a href="#l5.317"></a><span id="l5.317">     // First, do checks for nodes that never have children.</span>
<a href="#l5.318"></a><span id="l5.318">     if (this.target.nodeType == Node.ELEMENT_NODE) {</span>
<a href="#l5.319"></a><span id="l5.319">       if (this.target instanceof Components.interfaces.nsIImageLoadingContent &amp;&amp;</span>
<a href="#l5.320"></a><span id="l5.320">           this.target.currentURI) {</span>
<a href="#l5.321"></a><span id="l5.321">         this.onImage = true;</span>
<a href="#l5.322"></a><span id="l5.322" class="difflineat">@@ -163,30 +286,23 @@ nsContextMenu.prototype = {</span>
<a href="#l5.323"></a><span id="l5.323"> </span>
<a href="#l5.324"></a><span id="l5.324">         this.imageURL = this.target.currentURI.spec;</span>
<a href="#l5.325"></a><span id="l5.325">       } else if (this.target instanceof HTMLInputElement) {</span>
<a href="#l5.326"></a><span id="l5.326">         this.onTextInput = this.isTargetATextBox(this.target);</span>
<a href="#l5.327"></a><span id="l5.327">       } else if (this.target instanceof HTMLTextAreaElement) {</span>
<a href="#l5.328"></a><span id="l5.328">         this.onTextInput = true;</span>
<a href="#l5.329"></a><span id="l5.329">       } else if (this.target instanceof HTMLVideoElement) {</span>
<a href="#l5.330"></a><span id="l5.330">         this.onVideo = true;</span>
<a href="#l5.331"></a><span id="l5.331" class="difflineplus">+        this.onPlayableMedia = true;</span>
<a href="#l5.332"></a><span id="l5.332">         this.mediaURL = this.target.currentSrc || this.target.src;</span>
<a href="#l5.333"></a><span id="l5.333">       } else if (this.target instanceof HTMLAudioElement) {</span>
<a href="#l5.334"></a><span id="l5.334">         this.onAudio = true;</span>
<a href="#l5.335"></a><span id="l5.335" class="difflineplus">+        this.onPlayableMedia = true;</span>
<a href="#l5.336"></a><span id="l5.336">         this.mediaURL = this.target.currentSrc || this.target.src;</span>
<a href="#l5.337"></a><span id="l5.337" class="difflineminus">-      } else if (this.target instanceof HTMLHtmlElement) {</span>
<a href="#l5.338"></a><span id="l5.338" class="difflineminus">-        var bodyElt = this.target.ownerDocument.body;</span>
<a href="#l5.339"></a><span id="l5.339" class="difflineminus">-        if (bodyElt) {</span>
<a href="#l5.340"></a><span id="l5.340" class="difflineminus">-          var computedURL = this.getComputedURL(bodyElt, &quot;background-image&quot;);</span>
<a href="#l5.341"></a><span id="l5.341" class="difflineminus">-          if (computedURL) {</span>
<a href="#l5.342"></a><span id="l5.342" class="difflineminus">-            this.hasBGImage = true;</span>
<a href="#l5.343"></a><span id="l5.343" class="difflineminus">-            this.bgImageURL = this.makeURLAbsolute(bodyElt.baseURI,</span>
<a href="#l5.344"></a><span id="l5.344" class="difflineminus">-                                                   computedURL);</span>
<a href="#l5.345"></a><span id="l5.345" class="difflineminus">-          }</span>
<a href="#l5.346"></a><span id="l5.346" class="difflineminus">-        }</span>
<a href="#l5.347"></a><span id="l5.347" class="difflineplus">+      // Browser supports background images here but we don't need to.</span>
<a href="#l5.348"></a><span id="l5.348">       } else if (&quot;HTTPIndex&quot; in content &amp;&amp;</span>
<a href="#l5.349"></a><span id="l5.349">                  content.HTTPIndex instanceof Components.interfaces.nsIHTTPIndex) {</span>
<a href="#l5.350"></a><span id="l5.350">         this.inDirList = true;</span>
<a href="#l5.351"></a><span id="l5.351">         // Bubble outward till we get to an element with URL attribute</span>
<a href="#l5.352"></a><span id="l5.352">         // (which should be the href).</span>
<a href="#l5.353"></a><span id="l5.353">         var root = this.target;</span>
<a href="#l5.354"></a><span id="l5.354">         while (root &amp;&amp; !this.link) {</span>
<a href="#l5.355"></a><span id="l5.355">           if (root.tagName == &quot;tree&quot;) {</span>
<a href="#l5.356"></a><span id="l5.356" class="difflineat">@@ -253,26 +369,17 @@ nsContextMenu.prototype = {</span>
<a href="#l5.357"></a><span id="l5.357">                 (elem.cite || elem.dateTime)) ||</span>
<a href="#l5.358"></a><span id="l5.358">               (elem instanceof HTMLElement &amp;&amp;</span>
<a href="#l5.359"></a><span id="l5.359">                 (elem.title || elem.lang)) ||</span>
<a href="#l5.360"></a><span id="l5.360">               (elem.getAttributeNS(XMLNS, &quot;lang&quot;))) {</span>
<a href="#l5.361"></a><span id="l5.361">             this.onMetaDataItem = true;</span>
<a href="#l5.362"></a><span id="l5.362">           }</span>
<a href="#l5.363"></a><span id="l5.363">         }</span>
<a href="#l5.364"></a><span id="l5.364"> </span>
<a href="#l5.365"></a><span id="l5.365" class="difflineminus">-        // Background image? Don't bother if we've already found a</span>
<a href="#l5.366"></a><span id="l5.366" class="difflineminus">-        // background image further down the hierarchy. Otherwise,</span>
<a href="#l5.367"></a><span id="l5.367" class="difflineminus">-        // we look for the computed background-image style.</span>
<a href="#l5.368"></a><span id="l5.368" class="difflineminus">-        if (!this.hasBGImage) {</span>
<a href="#l5.369"></a><span id="l5.369" class="difflineminus">-          var bgImgUrl = this.getComputedURL(elem, &quot;background-image&quot;);</span>
<a href="#l5.370"></a><span id="l5.370" class="difflineminus">-          if (bgImgUrl) {</span>
<a href="#l5.371"></a><span id="l5.371" class="difflineminus">-            this.hasBGImage = true;</span>
<a href="#l5.372"></a><span id="l5.372" class="difflineminus">-            this.bgImageURL = this.makeURLAbsolute(elem.baseURI, bgImgUrl);</span>
<a href="#l5.373"></a><span id="l5.373" class="difflineminus">-          }</span>
<a href="#l5.374"></a><span id="l5.374" class="difflineminus">-        }</span>
<a href="#l5.375"></a><span id="l5.375" class="difflineplus">+        // Browser supports background images here but we don't need to.</span>
<a href="#l5.376"></a><span id="l5.376">       }</span>
<a href="#l5.377"></a><span id="l5.377">       elem = elem.parentNode;</span>
<a href="#l5.378"></a><span id="l5.378">     }</span>
<a href="#l5.379"></a><span id="l5.379"> </span>
<a href="#l5.380"></a><span id="l5.380">     // See if the user clicked on MathML.</span>
<a href="#l5.381"></a><span id="l5.381">     const NS_MathML = &quot;http://www.w3.org/1998/Math/MathML&quot;;</span>
<a href="#l5.382"></a><span id="l5.382">     if ((this.target.nodeType == Node.TEXT_NODE &amp;&amp;</span>
<a href="#l5.383"></a><span id="l5.383">          this.target.parentNode.namespaceURI == NS_MathML) ||</span>
<a href="#l5.384"></a><span id="l5.384" class="difflineat">@@ -280,16 +387,47 @@ nsContextMenu.prototype = {</span>
<a href="#l5.385"></a><span id="l5.385">       this.onMathML = true;</span>
<a href="#l5.386"></a><span id="l5.386"> </span>
<a href="#l5.387"></a><span id="l5.387">     // See if the user clicked in a frame.</span>
<a href="#l5.388"></a><span id="l5.388">     if (this.target.ownerDocument != window.content.document) {</span>
<a href="#l5.389"></a><span id="l5.389">       this.inFrame = true;</span>
<a href="#l5.390"></a><span id="l5.390">     }</span>
<a href="#l5.391"></a><span id="l5.391">   },</span>
<a href="#l5.392"></a><span id="l5.392"> </span>
<a href="#l5.393"></a><span id="l5.393" class="difflineplus">+  setMessageTargets: function CM_setMessageTargets(aNode) {</span>
<a href="#l5.394"></a><span id="l5.394" class="difflineplus">+    let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l5.395"></a><span id="l5.395" class="difflineplus">+    if (tabmail) {</span>
<a href="#l5.396"></a><span id="l5.396" class="difflineplus">+      // Not all tabs are message tabs - if we're in a tab mode that is in</span>
<a href="#l5.397"></a><span id="l5.397" class="difflineplus">+      // mailTabType's list of modes, then we'll assume it is a message related</span>
<a href="#l5.398"></a><span id="l5.398" class="difflineplus">+      // tab.</span>
<a href="#l5.399"></a><span id="l5.399" class="difflineplus">+      this.inMessageArea = tabmail.selectedTab.mode.name in mailTabType.modes;</span>
<a href="#l5.400"></a><span id="l5.400" class="difflineplus">+    }</span>
<a href="#l5.401"></a><span id="l5.401" class="difflineplus">+    else</span>
<a href="#l5.402"></a><span id="l5.402" class="difflineplus">+      // Assume that if we haven't got a tabmail item, then we're in standalone</span>
<a href="#l5.403"></a><span id="l5.403" class="difflineplus">+      // window</span>
<a href="#l5.404"></a><span id="l5.404" class="difflineplus">+      this.inMessageArea = true;</span>
<a href="#l5.405"></a><span id="l5.405" class="difflineplus">+</span>
<a href="#l5.406"></a><span id="l5.406" class="difflineplus">+    if (!this.inMessageArea) {</span>
<a href="#l5.407"></a><span id="l5.407" class="difflineplus">+      this.inThreadPane = false;</span>
<a href="#l5.408"></a><span id="l5.408" class="difflineplus">+      this.numSelectedMessages = 0;</span>
<a href="#l5.409"></a><span id="l5.409" class="difflineplus">+      this.selectedMessage = null;</span>
<a href="#l5.410"></a><span id="l5.410" class="difflineplus">+      this.isNewsgroup = false;</span>
<a href="#l5.411"></a><span id="l5.411" class="difflineplus">+      this.hideMailItems = true;</span>
<a href="#l5.412"></a><span id="l5.412" class="difflineplus">+      return;</span>
<a href="#l5.413"></a><span id="l5.413" class="difflineplus">+    }</span>
<a href="#l5.414"></a><span id="l5.414" class="difflineplus">+</span>
<a href="#l5.415"></a><span id="l5.415" class="difflineplus">+    this.inThreadPane = this.popupNodeIsInThreadPane(aNode);</span>
<a href="#l5.416"></a><span id="l5.416" class="difflineplus">+    this.numSelectedMessages = GetNumSelectedMessages();</span>
<a href="#l5.417"></a><span id="l5.417" class="difflineplus">+    this.selectedMessage = gFolderDisplay.selectedMessage;</span>
<a href="#l5.418"></a><span id="l5.418" class="difflineplus">+    this.isNewsgroup = gFolderDisplay.selectedMessageIsNews;</span>
<a href="#l5.419"></a><span id="l5.419" class="difflineplus">+    // Don't show mail items for links/images, just show related items.</span>
<a href="#l5.420"></a><span id="l5.420" class="difflineplus">+    this.hideMailItems = !this.inThreadPane &amp;&amp;</span>
<a href="#l5.421"></a><span id="l5.421" class="difflineplus">+                         (this.onImage || this.onLink);</span>
<a href="#l5.422"></a><span id="l5.422" class="difflineplus">+  },</span>
<a href="#l5.423"></a><span id="l5.423" class="difflineplus">+</span>
<a href="#l5.424"></a><span id="l5.424">   /**</span>
<a href="#l5.425"></a><span id="l5.425">    * Get a computed style property for an element.</span>
<a href="#l5.426"></a><span id="l5.426">    * @param  aElem</span>
<a href="#l5.427"></a><span id="l5.427">    *         A DOM node</span>
<a href="#l5.428"></a><span id="l5.428">    * @param  aProp</span>
<a href="#l5.429"></a><span id="l5.429">    *         The desired CSS property</span>
<a href="#l5.430"></a><span id="l5.430">    * @return the value of the property</span>
<a href="#l5.431"></a><span id="l5.431">    */</span>
<a href="#l5.432"></a><span id="l5.432" class="difflineat">@@ -402,16 +540,45 @@ nsContextMenu.prototype = {</span>
<a href="#l5.433"></a><span id="l5.433">    *        true to show, false to hide</span>
<a href="#l5.434"></a><span id="l5.434">    */</span>
<a href="#l5.435"></a><span id="l5.435">   showItem : function CM_showItem(aItemOrId, aShow) {</span>
<a href="#l5.436"></a><span id="l5.436">     var item = aItemOrId.constructor == String ? document.getElementById(aItemOrId) : aItemOrId;</span>
<a href="#l5.437"></a><span id="l5.437">     item.hidden = !aShow;</span>
<a href="#l5.438"></a><span id="l5.438">   },</span>
<a href="#l5.439"></a><span id="l5.439"> </span>
<a href="#l5.440"></a><span id="l5.440">   /**</span>
<a href="#l5.441"></a><span id="l5.441" class="difflineplus">+   * Set a DOM node's disabled property by passing in the node's id or the</span>
<a href="#l5.442"></a><span id="l5.442" class="difflineplus">+   * element itself.</span>
<a href="#l5.443"></a><span id="l5.443" class="difflineplus">+   *</span>
<a href="#l5.444"></a><span id="l5.444" class="difflineplus">+   * @param aItemOrId  A DOM node or the id of a DOM node</span>
<a href="#l5.445"></a><span id="l5.445" class="difflineplus">+   * @param aEnabled   True to enable the element, false to disable.</span>
<a href="#l5.446"></a><span id="l5.446" class="difflineplus">+   */</span>
<a href="#l5.447"></a><span id="l5.447" class="difflineplus">+  enableItem: function CM_enableItem(aItemOrId, aEnabled) {</span>
<a href="#l5.448"></a><span id="l5.448" class="difflineplus">+    var item = aItemOrId.constructor == String ? document.getElementById(aItemOrId) : aItemOrId;</span>
<a href="#l5.449"></a><span id="l5.449" class="difflineplus">+    item.disabled = !aEnabled;</span>
<a href="#l5.450"></a><span id="l5.450" class="difflineplus">+  },</span>
<a href="#l5.451"></a><span id="l5.451" class="difflineplus">+</span>
<a href="#l5.452"></a><span id="l5.452" class="difflineplus">+  /**</span>
<a href="#l5.453"></a><span id="l5.453" class="difflineplus">+   * Most menu items are visible if there's 1 or 0 messages selected, and</span>
<a href="#l5.454"></a><span id="l5.454" class="difflineplus">+   * enabled if there's exactly one selected. Handle those here.</span>
<a href="#l5.455"></a><span id="l5.455" class="difflineplus">+   * Exception: playable media is selected, in which case, don't show them.</span>
<a href="#l5.456"></a><span id="l5.456" class="difflineplus">+   *</span>
<a href="#l5.457"></a><span id="l5.457" class="difflineplus">+   * @param aID   the id of the element to display/enable</span>
<a href="#l5.458"></a><span id="l5.458" class="difflineplus">+   * @param aHide (optional)  an additional criteria to evaluate when we</span>
<a href="#l5.459"></a><span id="l5.459" class="difflineplus">+   *              decide whether to display the element. If false, we'll hide</span>
<a href="#l5.460"></a><span id="l5.460" class="difflineplus">+   *              the item no matter what messages are selected</span>
<a href="#l5.461"></a><span id="l5.461" class="difflineplus">+   */</span>
<a href="#l5.462"></a><span id="l5.462" class="difflineplus">+  setSingleSelection: function CM_setSingleSelection(aID, aHide) {</span>
<a href="#l5.463"></a><span id="l5.463" class="difflineplus">+    var hide = aHide != undefined ? aHide : true;</span>
<a href="#l5.464"></a><span id="l5.464" class="difflineplus">+    this.showItem(aID, this.numSelectedMessages == 1 &amp;&amp; !this.hideMailItems &amp;&amp;</span>
<a href="#l5.465"></a><span id="l5.465" class="difflineplus">+                  hide &amp;&amp; !this.onPlayableMedia);</span>
<a href="#l5.466"></a><span id="l5.466" class="difflineplus">+    this.enableItem(aID, this.numSelectedMessages == 1);</span>
<a href="#l5.467"></a><span id="l5.467" class="difflineplus">+  },</span>
<a href="#l5.468"></a><span id="l5.468" class="difflineplus">+</span>
<a href="#l5.469"></a><span id="l5.469" class="difflineplus">+  /**</span>
<a href="#l5.470"></a><span id="l5.470">    * Set given attribute of specified context-menu item. If the</span>
<a href="#l5.471"></a><span id="l5.471">    * value is null, then it removes the attribute (which works</span>
<a href="#l5.472"></a><span id="l5.472">    * nicely for the disabled attribute).</span>
<a href="#l5.473"></a><span id="l5.473">    * @param  aId</span>
<a href="#l5.474"></a><span id="l5.474">    *         The id of an element</span>
<a href="#l5.475"></a><span id="l5.475">    * @param  aAttr</span>
<a href="#l5.476"></a><span id="l5.476">    *         The attribute name</span>
<a href="#l5.477"></a><span id="l5.477">    * @param  aVal</span>
<a href="#l5.478"></a><span id="l5.478" class="difflineat">@@ -505,16 +672,33 @@ nsContextMenu.prototype = {</span>
<a href="#l5.479"></a><span id="l5.479">    * Determines whether the focused window has something selected.</span>
<a href="#l5.480"></a><span id="l5.480">    * @return true if there is a selection, false if not</span>
<a href="#l5.481"></a><span id="l5.481">    */</span>
<a href="#l5.482"></a><span id="l5.482">   isContentSelection : function CM_isContentSelection() {</span>
<a href="#l5.483"></a><span id="l5.483">     return !document.commandDispatcher.focusedWindow.getSelection().isCollapsed;</span>
<a href="#l5.484"></a><span id="l5.484">   },</span>
<a href="#l5.485"></a><span id="l5.485"> </span>
<a href="#l5.486"></a><span id="l5.486">   /**</span>
<a href="#l5.487"></a><span id="l5.487" class="difflineplus">+   * Determines whether the context menu was triggered by a node that's a child</span>
<a href="#l5.488"></a><span id="l5.488" class="difflineplus">+   * of the threadpane by looking for a parent node with id=&quot;threadTree&quot;.</span>
<a href="#l5.489"></a><span id="l5.489" class="difflineplus">+   * @return true if the popupNode is a child of the threadpane, otherwise false</span>
<a href="#l5.490"></a><span id="l5.490" class="difflineplus">+   */</span>
<a href="#l5.491"></a><span id="l5.491" class="difflineplus">+  popupNodeIsInThreadPane: function CM_popupNodeIsInThreadPane(aNode) {</span>
<a href="#l5.492"></a><span id="l5.492" class="difflineplus">+    var node = aNode;</span>
<a href="#l5.493"></a><span id="l5.493" class="difflineplus">+    while (node)</span>
<a href="#l5.494"></a><span id="l5.494" class="difflineplus">+    {</span>
<a href="#l5.495"></a><span id="l5.495" class="difflineplus">+      if (node.id == &quot;threadTree&quot;)</span>
<a href="#l5.496"></a><span id="l5.496" class="difflineplus">+        return true;</span>
<a href="#l5.497"></a><span id="l5.497" class="difflineplus">+</span>
<a href="#l5.498"></a><span id="l5.498" class="difflineplus">+      node = node.parentNode;</span>
<a href="#l5.499"></a><span id="l5.499" class="difflineplus">+    }</span>
<a href="#l5.500"></a><span id="l5.500" class="difflineplus">+    return false;</span>
<a href="#l5.501"></a><span id="l5.501" class="difflineplus">+  },</span>
<a href="#l5.502"></a><span id="l5.502" class="difflineplus">+</span>
<a href="#l5.503"></a><span id="l5.503" class="difflineplus">+  /**</span>
<a href="#l5.504"></a><span id="l5.504">    * Convert relative URL to absolute, using a provided &lt;base&gt;.</span>
<a href="#l5.505"></a><span id="l5.505">    * @param  aBase</span>
<a href="#l5.506"></a><span id="l5.506">    *         The URL string to use as the base</span>
<a href="#l5.507"></a><span id="l5.507">    * @param  aUrl</span>
<a href="#l5.508"></a><span id="l5.508">    *         The possibly-relative URL string</span>
<a href="#l5.509"></a><span id="l5.509">    * @return The string absolute URL</span>
<a href="#l5.510"></a><span id="l5.510">    */</span>
<a href="#l5.511"></a><span id="l5.511">   makeURLAbsolute : function CM_makeURLAbsolute(aBase, aUrl) {</span>
<a href="#l5.512"></a><span id="l5.512" class="difflineat">@@ -535,16 +719,26 @@ nsContextMenu.prototype = {</span>
<a href="#l5.513"></a><span id="l5.513">   isTargetATextBox : function CM_isTargetATextBox(aNode) {</span>
<a href="#l5.514"></a><span id="l5.514">     if (aNode instanceof HTMLInputElement)</span>
<a href="#l5.515"></a><span id="l5.515">       return (aNode.type == &quot;text&quot; || aNode.type == &quot;password&quot;);</span>
<a href="#l5.516"></a><span id="l5.516"> </span>
<a href="#l5.517"></a><span id="l5.517">     return (aNode instanceof HTMLTextAreaElement);</span>
<a href="#l5.518"></a><span id="l5.518">   },</span>
<a href="#l5.519"></a><span id="l5.519"> </span>
<a href="#l5.520"></a><span id="l5.520">   /**</span>
<a href="#l5.521"></a><span id="l5.521" class="difflineplus">+   * Hide a separator based on whether there are any non-hidden items between</span>
<a href="#l5.522"></a><span id="l5.522" class="difflineplus">+   * it and the previous separator.</span>
<a href="#l5.523"></a><span id="l5.523" class="difflineplus">+   *</span>
<a href="#l5.524"></a><span id="l5.524" class="difflineplus">+   * @param aSeparatorID  The id of the separator element.</span>
<a href="#l5.525"></a><span id="l5.525" class="difflineplus">+   */</span>
<a href="#l5.526"></a><span id="l5.526" class="difflineplus">+  hideIfAppropriate: function CM_hideIfAppropriate(aSeparatorID) {</span>
<a href="#l5.527"></a><span id="l5.527" class="difflineplus">+    this.showItem(aSeparatorID, this.shouldShowSeparator(aSeparatorID));</span>
<a href="#l5.528"></a><span id="l5.528" class="difflineplus">+  },</span>
<a href="#l5.529"></a><span id="l5.529" class="difflineplus">+</span>
<a href="#l5.530"></a><span id="l5.530" class="difflineplus">+  /**</span>
<a href="#l5.531"></a><span id="l5.531">    * Determine whether a separator should be shown based on whether</span>
<a href="#l5.532"></a><span id="l5.532">    * there are any non-hidden items between it and the previous separator.</span>
<a href="#l5.533"></a><span id="l5.533">    * @param  aSeparatorID</span>
<a href="#l5.534"></a><span id="l5.534">    *         The id of the separator element</span>
<a href="#l5.535"></a><span id="l5.535">    * @return true if the separator should be shown, false if not</span>
<a href="#l5.536"></a><span id="l5.536">    */</span>
<a href="#l5.537"></a><span id="l5.537">   shouldShowSeparator : function CM_shouldShowSeparator(aSeparatorID) {</span>
<a href="#l5.538"></a><span id="l5.538">     var separator = document.getElementById(aSeparatorID);</span>
<a href="#l5.539"></a><span id="l5.539" class="difflineat">@@ -554,16 +748,38 @@ nsContextMenu.prototype = {</span>
<a href="#l5.540"></a><span id="l5.540">         if (sibling.getAttribute(&quot;hidden&quot;) != &quot;true&quot;)</span>
<a href="#l5.541"></a><span id="l5.541">           return true;</span>
<a href="#l5.542"></a><span id="l5.542">         sibling = sibling.previousSibling;</span>
<a href="#l5.543"></a><span id="l5.543">       }</span>
<a href="#l5.544"></a><span id="l5.544">     }</span>
<a href="#l5.545"></a><span id="l5.545">     return false;</span>
<a href="#l5.546"></a><span id="l5.546">   },</span>
<a href="#l5.547"></a><span id="l5.547"> </span>
<a href="#l5.548"></a><span id="l5.548" class="difflineplus">+  /**</span>
<a href="#l5.549"></a><span id="l5.549" class="difflineplus">+   * Ensures that there isn't a separator shown at the bottom of the menu.</span>
<a href="#l5.550"></a><span id="l5.550" class="difflineplus">+   *</span>
<a href="#l5.551"></a><span id="l5.551" class="difflineplus">+   * @param aPopup  The menu to check.</span>
<a href="#l5.552"></a><span id="l5.552" class="difflineplus">+   */</span>
<a href="#l5.553"></a><span id="l5.553" class="difflineplus">+  checkLastSeparator: function CM_checkLastSeparator(aPopup) {</span>
<a href="#l5.554"></a><span id="l5.554" class="difflineplus">+    let sibling = aPopup.lastChild;</span>
<a href="#l5.555"></a><span id="l5.555" class="difflineplus">+    while (sibling) {</span>
<a href="#l5.556"></a><span id="l5.556" class="difflineplus">+      if (sibling.getAttribute(&quot;hidden&quot;) != &quot;true&quot;) {</span>
<a href="#l5.557"></a><span id="l5.557" class="difflineplus">+        if (sibling.localName == &quot;menuseparator&quot;) {</span>
<a href="#l5.558"></a><span id="l5.558" class="difflineplus">+          // If we got here then the item is a menuseparator and everything</span>
<a href="#l5.559"></a><span id="l5.559" class="difflineplus">+          // below it hidden.</span>
<a href="#l5.560"></a><span id="l5.560" class="difflineplus">+          sibling.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l5.561"></a><span id="l5.561" class="difflineplus">+          return;</span>
<a href="#l5.562"></a><span id="l5.562" class="difflineplus">+        }</span>
<a href="#l5.563"></a><span id="l5.563" class="difflineplus">+        else</span>
<a href="#l5.564"></a><span id="l5.564" class="difflineplus">+          return;</span>
<a href="#l5.565"></a><span id="l5.565" class="difflineplus">+      }</span>
<a href="#l5.566"></a><span id="l5.566" class="difflineplus">+      sibling = sibling.previousSibling;</span>
<a href="#l5.567"></a><span id="l5.567" class="difflineplus">+    }</span>
<a href="#l5.568"></a><span id="l5.568" class="difflineplus">+  },</span>
<a href="#l5.569"></a><span id="l5.569" class="difflineplus">+</span>
<a href="#l5.570"></a><span id="l5.570">   mediaCommand : function CM_mediaCommand(command) {</span>
<a href="#l5.571"></a><span id="l5.571">     var media = this.target;</span>
<a href="#l5.572"></a><span id="l5.572"> </span>
<a href="#l5.573"></a><span id="l5.573">     switch (command) {</span>
<a href="#l5.574"></a><span id="l5.574">       case &quot;play&quot;:</span>
<a href="#l5.575"></a><span id="l5.575">         media.play();</span>
<a href="#l5.576"></a><span id="l5.576">         break;</span>
<a href="#l5.577"></a><span id="l5.577">       case &quot;pause&quot;:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/content/specialTabs.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/content/specialTabs.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -49,15 +49,16 @@</span>
<a href="#l6.4"></a><span id="l6.4">     &lt;panel type=&quot;autocomplete&quot; id=&quot;PopupAutoComplete&quot; level=&quot;top&quot;</span>
<a href="#l6.5"></a><span id="l6.5">            noautofocus=&quot;true&quot; chromedir=&quot;&amp;locale.dir;&quot;/&gt;</span>
<a href="#l6.6"></a><span id="l6.6">   &lt;/popupset&gt;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">   &lt;vbox id=&quot;contentTab&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l6.9"></a><span id="l6.9">     &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l6.10"></a><span id="l6.10">       &lt;notificationbox flex=&quot;1&quot;&gt;</span>
<a href="#l6.11"></a><span id="l6.11">         &lt;browser id=&quot;dummycontentbrowser&quot; type=&quot;content-targetable&quot; flex=&quot;1&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                 disablehistory=&quot;true&quot; autocompletepopup=&quot;PopupAutoComplete&quot;/&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+                 disablehistory=&quot;true&quot; autocompletepopup=&quot;PopupAutoComplete&quot;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+                 context=&quot;mailContext&quot;/&gt;</span>
<a href="#l6.15"></a><span id="l6.15">       &lt;/notificationbox&gt;</span>
<a href="#l6.16"></a><span id="l6.16">       &lt;findbar browserid=&quot;dummycontentbrowser&quot;/&gt;</span>
<a href="#l6.17"></a><span id="l6.17">     &lt;/vbox&gt;</span>
<a href="#l6.18"></a><span id="l6.18">   &lt;/vbox&gt;</span>
<a href="#l6.19"></a><span id="l6.19"> &lt;/overlay&gt;</span>
<a href="#l6.20"></a><span id="l6.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/jar.mn</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/jar.mn</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -15,16 +15,17 @@ messenger.jar:</span>
<a href="#l7.4"></a><span id="l7.4">     content/messenger/folderDisplay.js              (content/folderDisplay.js)</span>
<a href="#l7.5"></a><span id="l7.5">     content/messenger/mailWindowOverlay.js          (content/mailWindowOverlay.js)</span>
<a href="#l7.6"></a><span id="l7.6"> *   content/messenger/mailWindowOverlay.xul         (content/mailWindowOverlay.xul)</span>
<a href="#l7.7"></a><span id="l7.7">     content/messenger/extraCustomizeItems.xul       (content/extraCustomizeItems.xul)</span>
<a href="#l7.8"></a><span id="l7.8"> *   content/messenger/mailOverlay.xul               (content/mailOverlay.xul)</span>
<a href="#l7.9"></a><span id="l7.9"> *   content/messenger/messageWindow.xul             (content/messageWindow.xul)</span>
<a href="#l7.10"></a><span id="l7.10">     content/messenger/messageWindow.js              (content/messageWindow.js)</span>
<a href="#l7.11"></a><span id="l7.11">     content/messenger/mailContextMenus.js           (content/mailContextMenus.js)</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+    content/messenger/nsContextMenu.js              (content/nsContextMenu.js)</span>
<a href="#l7.13"></a><span id="l7.13"> *   content/messenger/messenger.xul                 (content/messenger.xul)</span>
<a href="#l7.14"></a><span id="l7.14"> *   content/messenger/hiddenWindow.xul              (content/hiddenWindow.xul)</span>
<a href="#l7.15"></a><span id="l7.15"> *   content/messenger/hiddenWindow.js               (content/hiddenWindow.js)</span>
<a href="#l7.16"></a><span id="l7.16">     content/messenger/msgHdrViewOverlay.js          (content/msgHdrViewOverlay.js)</span>
<a href="#l7.17"></a><span id="l7.17">     content/messenger/msgHdrViewOverlay.xul         (content/msgHdrViewOverlay.xul)</span>
<a href="#l7.18"></a><span id="l7.18">     content/messenger/msgViewNavigation.js          (content/msgViewNavigation.js)</span>
<a href="#l7.19"></a><span id="l7.19">     content/messenger/mailWidgets.xml               (content/mailWidgets.xml)</span>
<a href="#l7.20"></a><span id="l7.20">     content/messenger/editContactOverlay.js         (content/editContactOverlay.js)</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -91,12 +92,11 @@ messenger.jar:</span>
<a href="#l7.22"></a><span id="l7.22">     content/messenger/glodaFacetBindings.xml        (content/glodaFacetBindings.xml)</span>
<a href="#l7.23"></a><span id="l7.23">     content/messenger/glodaFacetVis.js              (content/glodaFacetVis.js)</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25"> comm.jar:</span>
<a href="#l7.26"></a><span id="l7.26"> % content communicator %content/communicator/ xpcnativewrappers=yes</span>
<a href="#l7.27"></a><span id="l7.27"> *  content/communicator/contentAreaClick.js         (content/contentAreaClick.js)</span>
<a href="#l7.28"></a><span id="l7.28"> *  content/communicator/utilityOverlay.xul          (content/utilityOverlay.xul)</span>
<a href="#l7.29"></a><span id="l7.29"> *  content/communicator/utilityOverlay.js           (content/utilityOverlay.js)</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-*  content/communicator/nsContextMenu.js            (content/nsContextMenu.js)</span>
<a href="#l7.31"></a><span id="l7.31"> </span>
<a href="#l7.32"></a><span id="l7.32"> toolkit.jar:</span>
<a href="#l7.33"></a><span id="l7.33"> % overlay chrome://global/content/customizeToolbar.xul chrome://messenger/content/customizeToolbarOverlay.xul</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

