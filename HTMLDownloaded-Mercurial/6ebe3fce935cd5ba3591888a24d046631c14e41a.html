<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 16018:6ebe3fce935cd5ba3591888a24d046631c14e41a</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 6ebe3fce935cd5ba3591888a24d046631c14e41a" />
<meta property="og:url" content="/comm-central/rev/6ebe3fce935cd5ba3591888a24d046631c14e41a" />
<meta property="og:description" content="Bug 476937 - Support optional default Start and Due dates for Tasks. r=philipp, ui-r=paenglab" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 6ebe3fce935cd5ba3591888a24d046631c14e41a 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/6ebe3fce935cd5ba3591888a24d046631c14e41a">shortlog</a> |
<a href="/comm-central/log/6ebe3fce935cd5ba3591888a24d046631c14e41a">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/6ebe3fce935cd5ba3591888a24d046631c14e41a">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/6ebe3fce935cd5ba3591888a24d046631c14e41a">files</a> |
changeset |
<a href="/comm-central/raw-rev/6ebe3fce935cd5ba3591888a24d046631c14e41a">raw</a>  | <a href="/comm-central/archive/6ebe3fce935cd5ba3591888a24d046631c14e41a.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=476937">Bug 476937</a> - Support optional default Start and Due dates for Tasks. r=philipp, ui-r=paenglab
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#116;&#116;&#104;&#101;&#119;&#32;&#77;&#101;&#99;&#99;&#97;&#32;&#60;&#109;&#97;&#116;&#116;&#104;&#101;&#119;&#46;&#109;&#101;&#99;&#99;&#97;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 19 Mar 2014 23:13:25 +0100</td></tr>

<tr>
 <td>changeset 16018</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/6ebe3fce935cd5ba3591888a24d046631c14e41a">6ebe3fce935cd5ba3591888a24d046631c14e41a</a></td>
</tr>



<tr>
<td>parent 16017</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/93141ad601459764905a098f4e4da44ae6dbc233">93141ad601459764905a098f4e4da44ae6dbc233</a>
</td>
</tr>

<tr>
<td>child 16019</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/386eb4315d1974d0409f8411a521f6f4f425e2f1">386eb4315d1974d0409f8411a521f6f4f425e2f1</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=6ebe3fce935cd5ba3591888a24d046631c14e41a">10029</a></td></tr>
<tr><td>push user</td><td>matthew.mecca@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 13 Apr 2014 19:11:00 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@6ebe3fce935c [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6ebe3fce935cd5ba3591888a24d046631c14e41a">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6ebe3fce935cd5ba3591888a24d046631c14e41a&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6ebe3fce935cd5ba3591888a24d046631c14e41a&newProject=comm-central&newRevision=6ebe3fce935cd5ba3591888a24d046631c14e41a&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6ebe3fce935cd5ba3591888a24d046631c14e41a&newProject=comm-central&newRevision=6ebe3fce935cd5ba3591888a24d046631c14e41a&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6ebe3fce935cd5ba3591888a24d046631c14e41a&newProject=comm-central&newRevision=6ebe3fce935cd5ba3591888a24d046631c14e41a&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28philipp%29&revcount=50">philipp</a>, <a href="/comm-central/log?rev=reviewer%28paenglab%29&revcount=50">paenglab</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=476937">476937</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=476937">Bug 476937</a> - Support optional default Start and Due dates for Tasks. r=philipp, ui-r=paenglab</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-item-editing.js">calendar/base/content/calendar-item-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-item-editing.js">file</a> |
<a href="/comm-central/annotate/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-item-editing.js">annotate</a> |
<a href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-item-editing.js">diff</a> |
<a href="/comm-central/comparison/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-item-editing.js">comparison</a> |
<a href="/comm-central/log/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-item-editing.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-task-editing.js">calendar/base/content/calendar-task-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-task-editing.js">file</a> |
<a href="/comm-central/annotate/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-task-editing.js">annotate</a> |
<a href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-task-editing.js">diff</a> |
<a href="/comm-central/comparison/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-task-editing.js">comparison</a> |
<a href="/comm-central/log/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-task-editing.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/alarms.xul">calendar/base/content/preferences/alarms.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/alarms.xul">file</a> |
<a href="/comm-central/annotate/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/alarms.xul">annotate</a> |
<a href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/alarms.xul">diff</a> |
<a href="/comm-central/comparison/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/alarms.xul">comparison</a> |
<a href="/comm-central/log/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/alarms.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.js">calendar/base/content/preferences/general.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.js">file</a> |
<a href="/comm-central/annotate/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.js">annotate</a> |
<a href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.js">diff</a> |
<a href="/comm-central/comparison/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.js">comparison</a> |
<a href="/comm-central/log/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.xul">calendar/base/content/preferences/general.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.xul">file</a> |
<a href="/comm-central/annotate/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.xul">annotate</a> |
<a href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.xul">diff</a> |
<a href="/comm-central/comparison/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.xul">comparison</a> |
<a href="/comm-central/log/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/base/content/preferences/general.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/lightning/content/lightning.js">calendar/lightning/content/lightning.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/lightning/content/lightning.js">file</a> |
<a href="/comm-central/annotate/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/lightning/content/lightning.js">annotate</a> |
<a href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/lightning/content/lightning.js">diff</a> |
<a href="/comm-central/comparison/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/lightning/content/lightning.js">comparison</a> |
<a href="/comm-central/log/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/lightning/content/lightning.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/alarms.dtd">calendar/locales/en-US/chrome/calendar/preferences/alarms.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/alarms.dtd">file</a> |
<a href="/comm-central/annotate/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/alarms.dtd">annotate</a> |
<a href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/alarms.dtd">diff</a> |
<a href="/comm-central/comparison/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/alarms.dtd">comparison</a> |
<a href="/comm-central/log/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/alarms.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/general.dtd">calendar/locales/en-US/chrome/calendar/preferences/general.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/general.dtd">file</a> |
<a href="/comm-central/annotate/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/general.dtd">annotate</a> |
<a href="/comm-central/diff/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/general.dtd">diff</a> |
<a href="/comm-central/comparison/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/general.dtd">comparison</a> |
<a href="/comm-central/log/6ebe3fce935cd5ba3591888a24d046631c14e41a/calendar/locales/en-US/chrome/calendar/preferences/general.dtd">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-item-editing.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-editing.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -15,16 +15,205 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l1.4"></a><span id="l1.4">  */</span>
<a href="#l1.5"></a><span id="l1.5"> function disposeJob(job) {</span>
<a href="#l1.6"></a><span id="l1.6">     if (job &amp;&amp; job.dispose) {</span>
<a href="#l1.7"></a><span id="l1.7">         job.dispose();</span>
<a href="#l1.8"></a><span id="l1.8">     }</span>
<a href="#l1.9"></a><span id="l1.9"> }</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> /**</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+ * Sets the default values for new items, taking values from either the passed</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+ * parameters or the preferences</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+ *</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+ * @param aItem         The item to set up</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+ * @param aCalendar     (optional) The calendar to apply.</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+ * @param aStartDate    (optional) The start date to set.</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+ * @param aEndDate      (optional) The end date/due date to set.</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+ * @param aInitialDate  (optional) The reference date for the date pickers</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+ * @param aForceAllday  (optional) Force the event/task to be an allday item.</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+ */</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+function setDefaultItemValues(aItem, aCalendar=null, aStartDate=null, aEndDate=null, aInitialDate=null, aForceAllday=false) {</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+    function endOfDay(aDate) {</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+        let eod = aDate ? aDate.clone() : cal.now();</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+        eod.hour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+        eod.minute = 0;</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+        eod.second = 0;</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+        return eod;</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+    }</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+    function startOfDay(aDate) {</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+        let sod = aDate ? aDate.clone() : cal.now();</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+        sod.hour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+        sod.minute = 0;</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+        sod.second = 0;</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+        return sod;</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+    }</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+    let initialDate = aInitialDate ? aInitialDate.clone() : cal.now();</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+    initialDate.isDate = true;</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+    if (cal.isEvent(aItem)) {</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+        if (aStartDate) {</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+            aItem.startDate = aStartDate.clone();</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+            if (aStartDate.isDate &amp;&amp; !aForceAllday) {</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+                // This is a special case where the date is specified, but the</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+                // time is not. To take care, we setup up the time to our</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+                // default event start time.</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+                aItem.startDate = cal.getDefaultStartDate(aItem.startDate);</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+            } else if (aForceAllday) {</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+                // If the event should be forced to be allday, then don't set up</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+                // any default hours and directly make it allday.</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+                aItem.startDate.isDate = true;</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+                aItem.startDate.timezone = cal.floating();</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+            }</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+        } else {</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+            // If no start date was passed, then default to the next full hour</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+            // of today, but with the date of the selected day</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+            aItem.startDate = cal.getDefaultStartDate(initialDate);</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+        }</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+        if (aEndDate) {</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+            aItem.endDate = aEndDate.clone();</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+            if (aForceAllday) {</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+                // XXX it is currently not specified, how callers that force all</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+                // day should pass the end date. Right now, they should make</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+                // sure that the end date is 00:00:00 of the day after.</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+                aItem.endDate.isDate = true;</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+                aItem.endDate.timezone = cal.floating();</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+            }</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+        } else {</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+            aItem.endDate = aItem.startDate.clone();</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+            if (!aForceAllday) {</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+                // If the event is not all day, then add the default event</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+                // length.</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+                aItem.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+            } else {</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+                // All day events need to go to the beginning of the next day.</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+                aItem.endDate.day++;</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+            }</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+        }</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+    } else if (cal.isToDo(aItem)) {</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+        let now = cal.now();</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+        let initDate = initialDate ? initialDate.clone() : now;</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+        initDate.isDate = false;</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+        initDate.hour = now.hour;</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+        initDate.minute = now.minute;</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+        initDate.second = now.second;</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+        if (aStartDate) {</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+            aItem.entryDate = aStartDate.clone();</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+        } else {</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineplus">+            let defaultStart = Preferences.get(&quot;calendar.task.defaultstart&quot;, &quot;none&quot;);</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+            if (Preferences.get(&quot;calendar.alarms.onfortodos&quot;, 0) == 1 &amp;&amp; defaultStart == &quot;none&quot;) {</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+                // start date is required if we want to set an alarm</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+                defaultStart = &quot;offsetcurrent&quot;;</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+            }</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+            let units = Preferences.get(&quot;calendar.task.defaultstartoffsetunits&quot;, &quot;minutes&quot;);</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+            if ([&quot;days&quot;, &quot;hours&quot;, &quot;minutes&quot;].indexOf(units) &lt; 0) {</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+                units = &quot;minutes&quot;;</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+            }</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+            let startOffset = cal.createDuration();</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+            startOffset[units] = Preferences.get(&quot;calendar.task.defaultstartoffset&quot;, 0);</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+            let start;</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineplus">+            switch (defaultStart) {</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+                case &quot;none&quot;:</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+                    break;</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineplus">+                case &quot;startofday&quot;:</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineplus">+                    start = startOfDay(initDate);</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineplus">+                    break;</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineplus">+                case &quot;tomorrow&quot;:</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+                    start = startOfDay(initDate);</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineplus">+                    start.day++;</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineplus">+                    break;</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineplus">+                case &quot;nextweek&quot;:</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+                    start = startOfDay(initDate);</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+                    start.day += 7;</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+                    break;</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+                case &quot;offsetcurrent&quot;:</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineplus">+                    start = initDate.clone();</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+                    start.addDuration(startOffset);</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineplus">+                    break;</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineplus">+                case &quot;offsetnexthour&quot;:</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineplus">+                    start = initDate.clone();</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineplus">+                    start.minute = 0;</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineplus">+                    start.hour++;</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineplus">+                    start.addDuration(startOffset);</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineplus">+                    break;</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineplus">+            }</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineplus">+</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineplus">+            if (start) {</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineplus">+                aItem.entryDate = start;</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineplus">+            }</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineplus">+        }</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineplus">+</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineplus">+        if (aEndDate) {</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineplus">+            aItem.dueDate = aEndDate.clone();</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineplus">+        } else {</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineplus">+            let defaultDue = Preferences.get(&quot;calendar.task.defaultdue&quot;, &quot;none&quot;);</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineplus">+</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineplus">+            let units = Preferences.get(&quot;calendar.task.defaultdueoffsetunits&quot;, &quot;minutes&quot;);</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineplus">+            if ([&quot;days&quot;, &quot;hours&quot;, &quot;minutes&quot;].indexOf(units) &lt; 0) {</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineplus">+                units = &quot;minutes&quot;;</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineplus">+            }</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineplus">+            let dueOffset = cal.createDuration();</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineplus">+            dueOffset[units] = Preferences.get(&quot;calendar.task.defaultdueoffset&quot;, 0);</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineplus">+</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineplus">+            let start = aItem.entryDate ? aItem.entryDate.clone() : initDate.clone();</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineplus">+            let due;</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineplus">+</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineplus">+            switch (defaultDue) {</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineplus">+                case &quot;none&quot;:</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineplus">+                    break;</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineplus">+                case &quot;endofday&quot;:</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineplus">+                    due = endOfDay(start);</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineplus">+                    // go to tomorrow if we're past the end of today</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineplus">+                    if (start.compare(due) &gt; 0) {</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineplus">+                        due.day++;</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineplus">+                    }</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineplus">+                    break;</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineplus">+                case &quot;tomorrow&quot;:</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineplus">+                    due = endOfDay(start);</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineplus">+                    due.day++;</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineplus">+                    break;</span>
<a href="#l1.166"></a><span id="l1.166" class="difflineplus">+                case &quot;nextweek&quot;:</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineplus">+                    due = endOfDay(start);</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineplus">+                    due.day += 7;</span>
<a href="#l1.169"></a><span id="l1.169" class="difflineplus">+                    break;</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineplus">+                case &quot;offsetcurrent&quot;:</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineplus">+                    due = start.clone();</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineplus">+                    due.addDuration(dueOffset);</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineplus">+                    break;</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineplus">+                case &quot;offsetnexthour&quot;:</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineplus">+                    due = start.clone();</span>
<a href="#l1.176"></a><span id="l1.176" class="difflineplus">+                    due.minute = 0;</span>
<a href="#l1.177"></a><span id="l1.177" class="difflineplus">+                    due.hour++;</span>
<a href="#l1.178"></a><span id="l1.178" class="difflineplus">+                    due.addDuration(dueOffset);</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineplus">+                    break;</span>
<a href="#l1.180"></a><span id="l1.180" class="difflineplus">+            }</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineplus">+</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineplus">+            if (aItem.entryDate &amp;&amp; due &amp;&amp; aItem.entryDate.compare(due) &gt; 0) {</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineplus">+                // due can't be earlier than start date.</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineplus">+                due = aItem.entryDate;</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineplus">+            }</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineplus">+</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineplus">+            if (due) {</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineplus">+                aItem.dueDate = due;</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineplus">+            }</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineplus">+        }</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineplus">+    }</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineplus">+</span>
<a href="#l1.193"></a><span id="l1.193" class="difflineplus">+    // Calendar</span>
<a href="#l1.194"></a><span id="l1.194" class="difflineplus">+    aItem.calendar = aCalendar || getSelectedCalendar();</span>
<a href="#l1.195"></a><span id="l1.195" class="difflineplus">+</span>
<a href="#l1.196"></a><span id="l1.196" class="difflineplus">+    // Alarms</span>
<a href="#l1.197"></a><span id="l1.197" class="difflineplus">+    cal.alarms.setDefaultValues(aItem);</span>
<a href="#l1.198"></a><span id="l1.198" class="difflineplus">+}</span>
<a href="#l1.199"></a><span id="l1.199" class="difflineplus">+</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineplus">+/**</span>
<a href="#l1.201"></a><span id="l1.201">  * Creates an event with the calendar event dialog.</span>
<a href="#l1.202"></a><span id="l1.202">  *</span>
<a href="#l1.203"></a><span id="l1.203">  * @param calendar      (optional) The calendar to create the event in</span>
<a href="#l1.204"></a><span id="l1.204">  * @param startDate     (optional) The event's start date.</span>
<a href="#l1.205"></a><span id="l1.205">  * @param endDate       (optional) The event's end date.</span>
<a href="#l1.206"></a><span id="l1.206">  * @param summary       (optional) The event's title.</span>
<a href="#l1.207"></a><span id="l1.207">  * @param event         (optional) A template event to show in the dialog</span>
<a href="#l1.208"></a><span id="l1.208">  * @param aForceAllDay  (optional) Make sure the event shown in the dialog is an</span>
<a href="#l1.209"></a><span id="l1.209" class="difflineat">@@ -62,66 +251,23 @@ function createEventWithDialog(calendar,</span>
<a href="#l1.210"></a><span id="l1.210">                 event.endDate.day++;</span>
<a href="#l1.211"></a><span id="l1.211">             }</span>
<a href="#l1.212"></a><span id="l1.212">         }</span>
<a href="#l1.213"></a><span id="l1.213"> </span>
<a href="#l1.214"></a><span id="l1.214">         if (!event.calendar) {</span>
<a href="#l1.215"></a><span id="l1.215">             event.calendar = calendar || getSelectedCalendar();</span>
<a href="#l1.216"></a><span id="l1.216">         }</span>
<a href="#l1.217"></a><span id="l1.217">     } else {</span>
<a href="#l1.218"></a><span id="l1.218" class="difflineminus">-        event = createEvent();</span>
<a href="#l1.219"></a><span id="l1.219" class="difflineminus">-</span>
<a href="#l1.220"></a><span id="l1.220" class="difflineminus">-        if (startDate) {</span>
<a href="#l1.221"></a><span id="l1.221" class="difflineminus">-            event.startDate = startDate.clone();</span>
<a href="#l1.222"></a><span id="l1.222" class="difflineminus">-            if (startDate.isDate &amp;&amp; !aForceAllday) {</span>
<a href="#l1.223"></a><span id="l1.223" class="difflineminus">-                // This is a special case where the date is specified, but the</span>
<a href="#l1.224"></a><span id="l1.224" class="difflineminus">-                // time is not. To take care, we setup up the time to our</span>
<a href="#l1.225"></a><span id="l1.225" class="difflineminus">-                // default event start time.</span>
<a href="#l1.226"></a><span id="l1.226" class="difflineminus">-                event.startDate = getDefaultStartDate(event.startDate);</span>
<a href="#l1.227"></a><span id="l1.227" class="difflineminus">-            } else if (aForceAllday) {</span>
<a href="#l1.228"></a><span id="l1.228" class="difflineminus">-                // If the event should be forced to be allday, then don't set up</span>
<a href="#l1.229"></a><span id="l1.229" class="difflineminus">-                // any default hours and directly make it allday.</span>
<a href="#l1.230"></a><span id="l1.230" class="difflineminus">-                event.startDate.isDate = true;</span>
<a href="#l1.231"></a><span id="l1.231" class="difflineminus">-                event.startDate.timezone = floating();</span>
<a href="#l1.232"></a><span id="l1.232" class="difflineminus">-            }</span>
<a href="#l1.233"></a><span id="l1.233" class="difflineminus">-        } else {</span>
<a href="#l1.234"></a><span id="l1.234" class="difflineminus">-            // If no start date was passed, then default to the next full hour</span>
<a href="#l1.235"></a><span id="l1.235" class="difflineminus">-            // of today, but with the date of the selected day</span>
<a href="#l1.236"></a><span id="l1.236" class="difflineminus">-            var refDate = currentView().initialized &amp;&amp; currentView().selectedDay.clone();</span>
<a href="#l1.237"></a><span id="l1.237" class="difflineminus">-            event.startDate = getDefaultStartDate(refDate);</span>
<a href="#l1.238"></a><span id="l1.238" class="difflineminus">-        }</span>
<a href="#l1.239"></a><span id="l1.239" class="difflineplus">+        event = cal.createEvent();</span>
<a href="#l1.240"></a><span id="l1.240"> </span>
<a href="#l1.241"></a><span id="l1.241" class="difflineminus">-        if (endDate) {</span>
<a href="#l1.242"></a><span id="l1.242" class="difflineminus">-            event.endDate = endDate.clone();</span>
<a href="#l1.243"></a><span id="l1.243" class="difflineminus">-            if (aForceAllday) {</span>
<a href="#l1.244"></a><span id="l1.244" class="difflineminus">-                // XXX it is currently not specified, how callers that force all</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineminus">-                // day should pass the end date. Right now, they should make</span>
<a href="#l1.246"></a><span id="l1.246" class="difflineminus">-                // sure that the end date is 00:00:00 of the day after.</span>
<a href="#l1.247"></a><span id="l1.247" class="difflineminus">-                event.endDate.isDate = true;</span>
<a href="#l1.248"></a><span id="l1.248" class="difflineminus">-                event.endDate.timezone = floating();</span>
<a href="#l1.249"></a><span id="l1.249" class="difflineminus">-            }</span>
<a href="#l1.250"></a><span id="l1.250" class="difflineminus">-        } else {</span>
<a href="#l1.251"></a><span id="l1.251" class="difflineminus">-            event.endDate = event.startDate.clone();</span>
<a href="#l1.252"></a><span id="l1.252" class="difflineminus">-            if (!aForceAllday) {</span>
<a href="#l1.253"></a><span id="l1.253" class="difflineminus">-                // If the event is not all day, then add the default event</span>
<a href="#l1.254"></a><span id="l1.254" class="difflineminus">-                // length.</span>
<a href="#l1.255"></a><span id="l1.255" class="difflineminus">-                event.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l1.256"></a><span id="l1.256" class="difflineminus">-            } else {</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineminus">-                // All day events need to go to the beginning of the next day.</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineminus">-                event.endDate.day++;</span>
<a href="#l1.259"></a><span id="l1.259" class="difflineminus">-            }</span>
<a href="#l1.260"></a><span id="l1.260" class="difflineminus">-        }</span>
<a href="#l1.261"></a><span id="l1.261" class="difflineminus">-</span>
<a href="#l1.262"></a><span id="l1.262" class="difflineminus">-        event.calendar = calendar || getSelectedCalendar();</span>
<a href="#l1.263"></a><span id="l1.263" class="difflineminus">-</span>
<a href="#l1.264"></a><span id="l1.264" class="difflineplus">+        let refDate = currentView().initialized &amp;&amp; currentView().selectedDay.clone();</span>
<a href="#l1.265"></a><span id="l1.265" class="difflineplus">+        setDefaultItemValues(event, calendar, startDate, endDate, refDate, aForceAllday);</span>
<a href="#l1.266"></a><span id="l1.266">         if (summary) {</span>
<a href="#l1.267"></a><span id="l1.267">             event.title = summary;</span>
<a href="#l1.268"></a><span id="l1.268">         }</span>
<a href="#l1.269"></a><span id="l1.269" class="difflineminus">-</span>
<a href="#l1.270"></a><span id="l1.270" class="difflineminus">-        cal.alarms.setDefaultValues(event);</span>
<a href="#l1.271"></a><span id="l1.271">     }</span>
<a href="#l1.272"></a><span id="l1.272">     openEventDialog(event, calendar, &quot;new&quot;, onNewEvent, null);</span>
<a href="#l1.273"></a><span id="l1.273"> }</span>
<a href="#l1.274"></a><span id="l1.274"> </span>
<a href="#l1.275"></a><span id="l1.275"> /**</span>
<a href="#l1.276"></a><span id="l1.276">  * Creates a task with the calendar event dialog.</span>
<a href="#l1.277"></a><span id="l1.277">  *</span>
<a href="#l1.278"></a><span id="l1.278">  * @param calendar      (optional) The calendar to create the task in</span>
<a href="#l1.279"></a><span id="l1.279" class="difflineat">@@ -152,32 +298,22 @@ function createTodoWithDialog(calendar, </span>
<a href="#l1.280"></a><span id="l1.280">             todo = todo.clone();</span>
<a href="#l1.281"></a><span id="l1.281">             todo.id = null;</span>
<a href="#l1.282"></a><span id="l1.282">         }</span>
<a href="#l1.283"></a><span id="l1.283"> </span>
<a href="#l1.284"></a><span id="l1.284">         if (!todo.calendar) {</span>
<a href="#l1.285"></a><span id="l1.285">             todo.calendar = calendar || getSelectedCalendar();</span>
<a href="#l1.286"></a><span id="l1.286">         }</span>
<a href="#l1.287"></a><span id="l1.287">     } else {</span>
<a href="#l1.288"></a><span id="l1.288" class="difflineminus">-        todo = createTodo();</span>
<a href="#l1.289"></a><span id="l1.289" class="difflineminus">-        todo.calendar = calendar || getSelectedCalendar();</span>
<a href="#l1.290"></a><span id="l1.290" class="difflineminus">-</span>
<a href="#l1.291"></a><span id="l1.291" class="difflineminus">-        if (summary)</span>
<a href="#l1.292"></a><span id="l1.292" class="difflineminus">-            todo.title = summary;</span>
<a href="#l1.293"></a><span id="l1.293" class="difflineplus">+        todo = cal.createTodo();</span>
<a href="#l1.294"></a><span id="l1.294" class="difflineplus">+        setDefaultItemValues(todo, calendar, null, dueDate, initialDate);</span>
<a href="#l1.295"></a><span id="l1.295"> </span>
<a href="#l1.296"></a><span id="l1.296" class="difflineminus">-        if (dueDate)</span>
<a href="#l1.297"></a><span id="l1.297" class="difflineminus">-            todo.dueDate = dueDate;</span>
<a href="#l1.298"></a><span id="l1.298" class="difflineminus">-</span>
<a href="#l1.299"></a><span id="l1.299" class="difflineminus">-        if (Preferences.get(&quot;calendar.alarms.onfortodos&quot;, 0) == 1 &amp;&amp;</span>
<a href="#l1.300"></a><span id="l1.300" class="difflineminus">-            !todo.entryDate) {</span>
<a href="#l1.301"></a><span id="l1.301" class="difflineminus">-            // the todo must have an entry date if we want to set an alarm</span>
<a href="#l1.302"></a><span id="l1.302" class="difflineminus">-            todo.entryDate = initialDate;</span>
<a href="#l1.303"></a><span id="l1.303" class="difflineplus">+        if (summary) {</span>
<a href="#l1.304"></a><span id="l1.304" class="difflineplus">+            todo.title = summary;</span>
<a href="#l1.305"></a><span id="l1.305">         }</span>
<a href="#l1.306"></a><span id="l1.306" class="difflineminus">-</span>
<a href="#l1.307"></a><span id="l1.307" class="difflineminus">-        cal.alarms.setDefaultValues(todo);</span>
<a href="#l1.308"></a><span id="l1.308">     }</span>
<a href="#l1.309"></a><span id="l1.309"> </span>
<a href="#l1.310"></a><span id="l1.310">     openEventDialog(todo, calendar, &quot;new&quot;, onNewItem, null, initialDate);</span>
<a href="#l1.311"></a><span id="l1.311"> }</span>
<a href="#l1.312"></a><span id="l1.312"> </span>
<a href="#l1.313"></a><span id="l1.313"> </span>
<a href="#l1.314"></a><span id="l1.314"> </span>
<a href="#l1.315"></a><span id="l1.315"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-task-editing.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-editing.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -120,23 +120,23 @@ var taskEdit = {</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">     /**</span>
<a href="#l2.6"></a><span id="l2.6">      * Handler function to call on keypress for the quick-add textbox.</span>
<a href="#l2.7"></a><span id="l2.7">      *</span>
<a href="#l2.8"></a><span id="l2.8">      * @param aEvent    The DOM keypress event</span>
<a href="#l2.9"></a><span id="l2.9">      */</span>
<a href="#l2.10"></a><span id="l2.10">     onKeyPress: function tE_onKeyPress(aEvent) {</span>
<a href="#l2.11"></a><span id="l2.11">         if (aEvent.keyCode == Components.interfaces.nsIDOMKeyEvent.DOM_VK_RETURN) {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-            var edit = aEvent.target;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+            let edit = aEvent.target;</span>
<a href="#l2.14"></a><span id="l2.14">             if (edit.value &amp;&amp; edit.value.length &gt; 0) {</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-                var item = createTodo();</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-                item.calendar = getSelectedCalendar();</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+                let item = cal.createTodo();</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+                setDefaultItemValues(item);</span>
<a href="#l2.19"></a><span id="l2.19">                 item.title = edit.value;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+</span>
<a href="#l2.21"></a><span id="l2.21">                 edit.value = &quot;&quot;;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-                cal.alarms.setDefaultValues(item);</span>
<a href="#l2.23"></a><span id="l2.23">                 doTransaction('add', item, item.calendar, null, null);</span>
<a href="#l2.24"></a><span id="l2.24">             }</span>
<a href="#l2.25"></a><span id="l2.25">         }</span>
<a href="#l2.26"></a><span id="l2.26">     },</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">     /**</span>
<a href="#l2.29"></a><span id="l2.29">      * Window load function to set up all quick-add textboxes. The texbox must</span>
<a href="#l2.30"></a><span id="l2.30">      * have the class &quot;task-edit-field&quot;.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -426,19 +426,19 @@ function updateMenuLabels(lengthFieldId,</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">     // figure out whether we should use singular or plural</span>
<a href="#l3.6"></a><span id="l3.6">     var length = field.value;</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">     var newLabelNumber;</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">     // XXX This assumes that &quot;0 days, minutes, etc.&quot; is plural in other languages.</span>
<a href="#l3.11"></a><span id="l3.11">     if ( (Number(length) == 0) || (Number(length) &gt; 1) ) {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-        newLabelNumber = &quot;label2&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+        newLabelNumber = &quot;labelplural&quot;</span>
<a href="#l3.14"></a><span id="l3.14">     } else {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-        newLabelNumber = &quot;label1&quot;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+        newLabelNumber = &quot;labelsingular&quot;</span>
<a href="#l3.17"></a><span id="l3.17">     }</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">     // see what we currently show and change it if required</span>
<a href="#l3.20"></a><span id="l3.20">     var oldLabelNumber = menu.getAttribute(&quot;labelnumber&quot;);</span>
<a href="#l3.21"></a><span id="l3.21"> </span>
<a href="#l3.22"></a><span id="l3.22">     if (newLabelNumber != oldLabelNumber) {</span>
<a href="#l3.23"></a><span id="l3.23">         // remember what we are showing now</span>
<a href="#l3.24"></a><span id="l3.24">         menu.setAttribute(&quot;labelnumber&quot;, newLabelNumber);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/preferences/alarms.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/preferences/alarms.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -49,16 +49,19 @@</span>
<a href="#l4.4"></a><span id="l4.4">                         name=&quot;calendar.alarms.eventalarmunit&quot;</span>
<a href="#l4.5"></a><span id="l4.5">                         type=&quot;string&quot;/&gt;</span>
<a href="#l4.6"></a><span id="l4.6">             &lt;preference id=&quot;calendar.alarms.todoalarmlen&quot;</span>
<a href="#l4.7"></a><span id="l4.7">                         name=&quot;calendar.alarms.todoalarmlen&quot;</span>
<a href="#l4.8"></a><span id="l4.8">                         type=&quot;int&quot;/&gt;</span>
<a href="#l4.9"></a><span id="l4.9">             &lt;preference id=&quot;calendar.alarms.todoalarmunit&quot;</span>
<a href="#l4.10"></a><span id="l4.10">                         name=&quot;calendar.alarms.todoalarmunit&quot;</span>
<a href="#l4.11"></a><span id="l4.11">                         type=&quot;string&quot;/&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+            &lt;preference id=&quot;calendar.alarms.defaultsnoozelength&quot;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                        name=&quot;calendar.alarms.defaultsnoozelength&quot;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+                        type=&quot;int&quot;/&gt;</span>
<a href="#l4.15"></a><span id="l4.15"> &lt;!--</span>
<a href="#l4.16"></a><span id="l4.16">             &lt;preference id=&quot;calendar.alarms.emailaddress&quot;</span>
<a href="#l4.17"></a><span id="l4.17">                         name=&quot;calendar.alarms.emailaddress&quot;</span>
<a href="#l4.18"></a><span id="l4.18">                         type=&quot;string&quot;/&gt;</span>
<a href="#l4.19"></a><span id="l4.19">             &lt;preference id=&quot;calendar.alarms.text&quot;</span>
<a href="#l4.20"></a><span id="l4.20">                         name=&quot;calendar.alarms.text&quot;</span>
<a href="#l4.21"></a><span id="l4.21">                         type=&quot;string&quot;/&gt;</span>
<a href="#l4.22"></a><span id="l4.22"> --&gt;</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineat">@@ -111,16 +114,30 @@</span>
<a href="#l4.24"></a><span id="l4.24">             &lt;caption label=&quot;&amp;pref.calendar.alarms.defaults.label;&quot;/&gt;</span>
<a href="#l4.25"></a><span id="l4.25">             &lt;grid&gt;</span>
<a href="#l4.26"></a><span id="l4.26">                 &lt;columns&gt;</span>
<a href="#l4.27"></a><span id="l4.27">                     &lt;column flex=&quot;1&quot;/&gt;</span>
<a href="#l4.28"></a><span id="l4.28">                     &lt;column/&gt;</span>
<a href="#l4.29"></a><span id="l4.29">                 &lt;/columns&gt;</span>
<a href="#l4.30"></a><span id="l4.30">                 &lt;rows&gt;</span>
<a href="#l4.31"></a><span id="l4.31">                     &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+                        &lt;label value=&quot;&amp;pref.defaultsnoozelength.label;&quot;</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+                               accesskey=&quot;&amp;pref.defaultsnoozelength.accesskey;&quot;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+                               control=&quot;defaultsnoozelength&quot;/&gt;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+                        &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+                            &lt;textbox id=&quot;defaultsnoozelength&quot;</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+                                     preference=&quot;calendar.alarms.defaultsnoozelength&quot;</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+                                     type=&quot;number&quot;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+                                     min=&quot;0&quot;</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+                                     maxlength=&quot;4&quot;</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+                                     size=&quot;3&quot;/&gt;</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+                            &lt;label value=&quot;&amp;calendar.global.units.minutes;&quot;/&gt;</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+                        &lt;/hbox&gt;</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+                    &lt;/row&gt;</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+                    &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l4.46"></a><span id="l4.46">                         &lt;label value=&quot;&amp;pref.defalarm4events.label;&quot;</span>
<a href="#l4.47"></a><span id="l4.47">                                accesskey=&quot;&amp;pref.defalarm4events.accesskey;&quot;</span>
<a href="#l4.48"></a><span id="l4.48">                                control=&quot;eventdefalarm&quot;/&gt;</span>
<a href="#l4.49"></a><span id="l4.49">                         &lt;menulist id=&quot;eventdefalarm&quot;</span>
<a href="#l4.50"></a><span id="l4.50">                                   crop=&quot;none&quot;</span>
<a href="#l4.51"></a><span id="l4.51">                                   preference=&quot;calendar.alarms.onforevents&quot;&gt;</span>
<a href="#l4.52"></a><span id="l4.52">                             &lt;menupopup id=&quot;eventdefalarmpopup&quot;&gt;</span>
<a href="#l4.53"></a><span id="l4.53">                                 &lt;menuitem id=&quot;eventdefalarmon&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/preferences/general.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/preferences/general.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -22,10 +22,32 @@ var gCalendarGeneralPane = {</span>
<a href="#l5.4"></a><span id="l5.4">         // menu items include examples of current date formats.</span>
<a href="#l5.5"></a><span id="l5.5">         document.getElementById(&quot;dateformat-long-menuitem&quot;)</span>
<a href="#l5.6"></a><span id="l5.6">                 .setAttribute(&quot;label&quot;, labelLong + &quot;: &quot; + dateFormattedLong);</span>
<a href="#l5.7"></a><span id="l5.7">         document.getElementById(&quot;dateformat-short-menuitem&quot;)</span>
<a href="#l5.8"></a><span id="l5.8">                 .setAttribute(&quot;label&quot;, labelShort + &quot;: &quot; + dateFormattedShort);</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10">         // deselect and reselect to update visible item title</span>
<a href="#l5.11"></a><span id="l5.11">         updateSelectedLabel(&quot;dateformat&quot;);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+        this.updateDefaultTodoDates();</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    },</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+    updateDefaultTodoDates: function gCGP_updateDefaultTodoDates() {</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+        let defaultDue = document.getElementById(&quot;default_task_due&quot;).value;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+        let defaultStart = document.getElementById(&quot;default_task_start&quot;).value;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+        let offsetValues = [&quot;offsetcurrent&quot;, &quot;offsetnexthour&quot;];</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+        document.getElementById(&quot;default_task_due_offset&quot;)</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+                .style.visibility = offsetValues.indexOf(defaultDue) &gt; -1 ? &quot;&quot; : &quot;hidden&quot;;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+        document.getElementById(&quot;default_task_start_offset&quot;)</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+                .style.visibility = offsetValues.indexOf(defaultStart) &gt; -1 ? &quot;&quot; : &quot;hidden&quot;;</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+        updateMenuLabels(&quot;default_task_start_offset_text&quot;, &quot;default_task_start_offset_units&quot;);</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+        updateMenuLabels(&quot;default_task_due_offset_text&quot;, &quot;default_task_due_offset_units&quot;);</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+    },</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+    updateItemtypeDeck: function() {</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+        let panelId = document.getElementById(&quot;defaults-itemtype-menulist&quot;).value;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+        let panel = document.getElementById(panelId);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+        document.getElementById(&quot;defaults-itemtype-deck&quot;).selectedPanel = panel;</span>
<a href="#l5.33"></a><span id="l5.33">     }</span>
<a href="#l5.34"></a><span id="l5.34"> };</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/preferences/general.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/preferences/general.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,18 +1,20 @@</span>
<a href="#l6.4"></a><span id="l6.4"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a href="#l6.5"></a><span id="l6.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.6"></a><span id="l6.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.7"></a><span id="l6.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> &lt;!DOCTYPE overlay [</span>
<a href="#l6.10"></a><span id="l6.10">     &lt;!ENTITY % generalDTD SYSTEM &quot;chrome://calendar/locale/preferences/general.dtd&quot;&gt;</span>
<a href="#l6.11"></a><span id="l6.11">     &lt;!ENTITY % globalDTD SYSTEM &quot;chrome://calendar/locale/global.dtd&quot;&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+    &lt;!ENTITY % eventDTD SYSTEM &quot;chrome://calendar/locale/calendar-event-dialog.dtd&quot;&gt;</span>
<a href="#l6.13"></a><span id="l6.13">     %generalDTD;</span>
<a href="#l6.14"></a><span id="l6.14">     %globalDTD;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+    %eventDTD;</span>
<a href="#l6.16"></a><span id="l6.16"> ]&gt;</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> &lt;overlay id=&quot;CalendarGeneralPaneOverlay&quot;</span>
<a href="#l6.19"></a><span id="l6.19">          xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">     &lt;vbox id=&quot;calPreferencesBoxGeneral&quot;&gt;</span>
<a href="#l6.22"></a><span id="l6.22">         &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l6.23"></a><span id="l6.23">                 src=&quot;chrome://calendar/content/preferences/general.js&quot;/&gt;</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineat">@@ -27,19 +29,34 @@</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26">         &lt;preferences&gt;</span>
<a href="#l6.27"></a><span id="l6.27">             &lt;preference id=&quot;calendar.date.format&quot;</span>
<a href="#l6.28"></a><span id="l6.28">                         name=&quot;calendar.date.format&quot;</span>
<a href="#l6.29"></a><span id="l6.29">                         type=&quot;int&quot;/&gt;</span>
<a href="#l6.30"></a><span id="l6.30">             &lt;preference id=&quot;calendar.event.defaultlength&quot;</span>
<a href="#l6.31"></a><span id="l6.31">                         name=&quot;calendar.event.defaultlength&quot;</span>
<a href="#l6.32"></a><span id="l6.32">                         type=&quot;int&quot;/&gt;</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-            &lt;preference id=&quot;calendar.alarms.defaultsnoozelength&quot;</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-                        name=&quot;calendar.alarms.defaultsnoozelength&quot;</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+            &lt;preference id=&quot;calendar.task.defaultstart&quot;</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+                        name=&quot;calendar.task.defaultstart&quot;</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+                        type=&quot;string&quot;/&gt;</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+            &lt;preference id=&quot;calendar.task.defaultstartoffset&quot;</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+                        name=&quot;calendar.task.defaultstartoffset&quot;</span>
<a href="#l6.40"></a><span id="l6.40">                         type=&quot;int&quot;/&gt;</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+            &lt;preference id=&quot;calendar.task.defaultstartoffsetunits&quot;</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+                        name=&quot;calendar.task.defaultstartoffsetunits&quot;</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+                        type=&quot;string&quot;/&gt;</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+            &lt;preference id=&quot;calendar.task.defaultdue&quot;</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+                        name=&quot;calendar.task.defaultdue&quot;</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+                        type=&quot;string&quot;/&gt;</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+            &lt;preference id=&quot;calendar.task.defaultdueoffset&quot;</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+                        name=&quot;calendar.task.defaultdueoffset&quot;</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+                        type=&quot;int&quot;/&gt;</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+            &lt;preference id=&quot;calendar.task.defaultdueoffsetunits&quot;</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+                        name=&quot;calendar.task.defaultdueoffsetunits&quot;</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+                        type=&quot;string&quot;/&gt;</span>
<a href="#l6.53"></a><span id="l6.53">             &lt;preference id=&quot;calendar.view.useSystemColors&quot;</span>
<a href="#l6.54"></a><span id="l6.54">                         name=&quot;calendar.view.useSystemColors&quot;</span>
<a href="#l6.55"></a><span id="l6.55">                         type=&quot;bool&quot;/&gt;</span>
<a href="#l6.56"></a><span id="l6.56">         &lt;/preferences&gt;</span>
<a href="#l6.57"></a><span id="l6.57"> </span>
<a href="#l6.58"></a><span id="l6.58">         &lt;groupbox&gt;</span>
<a href="#l6.59"></a><span id="l6.59">             &lt;caption label=&quot;&amp;pref.mainbox.label;&quot;/&gt;</span>
<a href="#l6.60"></a><span id="l6.60">             &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineat">@@ -53,51 +70,194 @@</span>
<a href="#l6.62"></a><span id="l6.62">                                   label=&quot;&amp;pref.dateformat.long;&quot;</span>
<a href="#l6.63"></a><span id="l6.63">                                   value=&quot;0&quot;/&gt;</span>
<a href="#l6.64"></a><span id="l6.64">                         &lt;menuitem id=&quot;dateformat-short-menuitem&quot;</span>
<a href="#l6.65"></a><span id="l6.65">                                   label=&quot;&amp;pref.dateformat.short;&quot;</span>
<a href="#l6.66"></a><span id="l6.66">                                   value=&quot;1&quot;/&gt;</span>
<a href="#l6.67"></a><span id="l6.67">                     &lt;/menupopup&gt;</span>
<a href="#l6.68"></a><span id="l6.68">                 &lt;/menulist&gt;</span>
<a href="#l6.69"></a><span id="l6.69">             &lt;/hbox&gt;</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-            &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-                &lt;label value=&quot;&amp;pref.defaultlength.label;&quot;</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-                       accesskey=&quot;&amp;pref.defaultlength.accesskey;&quot;</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-                       control=&quot;defaultlength&quot;/&gt;</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-                &lt;textbox id=&quot;defaultlength&quot;</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">-                         preference=&quot;calendar.event.defaultlength&quot;</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineminus">-                         type=&quot;number&quot;</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-                         min=&quot;0&quot;</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-                         maxlength=&quot;3&quot;</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-                         size=&quot;3&quot;/&gt;</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-                &lt;label value=&quot;&amp;calendar.global.units.minutes;&quot;/&gt;</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-            &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-                &lt;label value=&quot;&amp;pref.defaultsnoozelength.label;&quot;</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-                       accesskey=&quot;&amp;pref.defaultsnoozelength.accesskey;&quot;</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineminus">-                       control=&quot;defaultsnoozelength&quot;/&gt;</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-                &lt;textbox id=&quot;defaultsnoozelength&quot;</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineminus">-                         preference=&quot;calendar.alarms.defaultsnoozelength&quot;</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineminus">-                         type=&quot;number&quot;</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineminus">-                         min=&quot;0&quot;</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineminus">-                         maxlength=&quot;4&quot;</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-                         size=&quot;3&quot;/&gt;</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-                &lt;label value=&quot;&amp;calendar.global.units.minutes;&quot;/&gt;</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineminus">-</span>
<a href="#l6.97"></a><span id="l6.97">         &lt;/groupbox&gt;</span>
<a href="#l6.98"></a><span id="l6.98"> </span>
<a href="#l6.99"></a><span id="l6.99"> #ifndef XP_MACOSX</span>
<a href="#l6.100"></a><span id="l6.100">         &lt;groupbox&gt;</span>
<a href="#l6.101"></a><span id="l6.101">             &lt;caption label=&quot;&amp;pref.accessibility.label;&quot;/&gt;</span>
<a href="#l6.102"></a><span id="l6.102">             &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l6.103"></a><span id="l6.103">                 &lt;checkbox id=&quot;systemColors&quot; pack=&quot;end&quot;</span>
<a href="#l6.104"></a><span id="l6.104">                           label=&quot;&amp;pref.systemcolors.label;&quot;</span>
<a href="#l6.105"></a><span id="l6.105">                           accesskey=&quot;&amp;pref.systemcolors.accesskey;&quot;</span>
<a href="#l6.106"></a><span id="l6.106">                           preference=&quot;calendar.view.useSystemColors&quot;/&gt;</span>
<a href="#l6.107"></a><span id="l6.107">             &lt;/hbox&gt;</span>
<a href="#l6.108"></a><span id="l6.108">         &lt;/groupbox&gt;</span>
<a href="#l6.109"></a><span id="l6.109"> #endif</span>
<a href="#l6.110"></a><span id="l6.110"> </span>
<a href="#l6.111"></a><span id="l6.111" class="difflineplus">+        &lt;groupbox id=&quot;defaults-itemtype-groupbox&quot;&gt;</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineplus">+            &lt;caption id=&quot;defaults-itemtype-caption&quot; label=&quot;&amp;pref.defaults.label;&quot;/&gt;</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineplus">+            &lt;menulist id=&quot;defaults-itemtype-menulist&quot; oncommand=&quot;gCalendarGeneralPane.updateItemtypeDeck()&quot;&gt;</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineplus">+                &lt;menupopup id=&quot;defaults-itemtype-menupopup&quot;&gt;</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineplus">+                    &lt;menuitem id=&quot;defaults-itemtype-event&quot;</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineplus">+                              label=&quot;&amp;pref.events.label;&quot;</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineplus">+                              value=&quot;defaults-event-grid&quot;/&gt;</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineplus">+                    &lt;menuitem id=&quot;defaults-itemtype-task&quot;</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineplus">+                              label=&quot;&amp;pref.tasks.label;&quot;</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineplus">+                              value=&quot;defaults-task-grid&quot;/&gt;</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineplus">+                &lt;/menupopup&gt;</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineplus">+            &lt;/menulist&gt;</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineplus">+            &lt;deck id=&quot;defaults-itemtype-deck&quot;&gt;</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineplus">+                &lt;grid id=&quot;defaults-event-grid&quot;&gt;</span>
<a href="#l6.125"></a><span id="l6.125" class="difflineplus">+                    &lt;columns id=&quot;defaults-event-grid-columns&quot;&gt;</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineplus">+                        &lt;column id=&quot;defaults-event-grid-label-column&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineplus">+                        &lt;column id=&quot;defaults-event-grid-value-column&quot;/&gt;</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineplus">+                    &lt;/columns&gt;</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineplus">+                    &lt;rows id=&quot;defaults-event-grid-rows&quot;&gt;</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineplus">+                        &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineplus">+                            &lt;label value=&quot;&amp;pref.default_event_length.label;&quot;</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineplus">+                                   accesskey=&quot;&amp;pref.default_event_length.accesskey;&quot;</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineplus">+                                   control=&quot;defaultlength&quot;/&gt;</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineplus">+                            &lt;textbox id=&quot;defaultlength&quot;</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineplus">+                                     preference=&quot;calendar.event.defaultlength&quot;</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineplus">+                                     type=&quot;number&quot;</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineplus">+                                     min=&quot;0&quot;</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineplus">+                                     maxlength=&quot;3&quot;</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineplus">+                                     size=&quot;3&quot;/&gt;</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineplus">+                            &lt;label value=&quot;&amp;calendar.global.units.minutes;&quot;/&gt;</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineplus">+                        &lt;/row&gt;</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineplus">+                    &lt;/rows&gt;</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineplus">+                &lt;/grid&gt;</span>
<a href="#l6.144"></a><span id="l6.144" class="difflineplus">+                &lt;grid id=&quot;defaults-task-grid&quot;&gt;</span>
<a href="#l6.145"></a><span id="l6.145" class="difflineplus">+                    &lt;columns id=&quot;defaults-task-grid-columns&quot;&gt;</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineplus">+                        &lt;column id=&quot;defaults-task-grid-label-column&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineplus">+                        &lt;column id=&quot;defaults-task-grid-value-column&quot;/&gt;</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineplus">+                        &lt;column id=&quot;defaults-task-grid-offset-column&quot;/&gt;</span>
<a href="#l6.149"></a><span id="l6.149" class="difflineplus">+                    &lt;/columns&gt;</span>
<a href="#l6.150"></a><span id="l6.150" class="difflineplus">+                    &lt;rows id=&quot;defaults-task-grid-rows&quot;&gt;</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineplus">+                        &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l6.152"></a><span id="l6.152" class="difflineplus">+                            &lt;label value=&quot;&amp;read.only.task.start.label;&quot;</span>
<a href="#l6.153"></a><span id="l6.153" class="difflineplus">+                                   control=&quot;default_task_start&quot;/&gt;</span>
<a href="#l6.154"></a><span id="l6.154" class="difflineplus">+                            &lt;menulist id=&quot;default_task_start&quot;</span>
<a href="#l6.155"></a><span id="l6.155" class="difflineplus">+                                        crop=&quot;none&quot;</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineplus">+                                        oncommand=&quot;gCalendarGeneralPane.updateDefaultTodoDates()&quot;</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineplus">+                                        preference=&quot;calendar.task.defaultstart&quot;&gt;</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineplus">+                                &lt;menupopup id=&quot;default_task_start_popup&quot;&gt;</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_start_none&quot;</span>
<a href="#l6.160"></a><span id="l6.160" class="difflineplus">+                                                label=&quot;&amp;pref.default_task_none.label;&quot;</span>
<a href="#l6.161"></a><span id="l6.161" class="difflineplus">+                                                value=&quot;none&quot;</span>
<a href="#l6.162"></a><span id="l6.162" class="difflineplus">+                                                selected=&quot;true&quot;/&gt;</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_start_start_of_day&quot;</span>
<a href="#l6.164"></a><span id="l6.164" class="difflineplus">+                                                label=&quot;&amp;pref.default_task_start_of_day.label;&quot;</span>
<a href="#l6.165"></a><span id="l6.165" class="difflineplus">+                                                value=&quot;startofday&quot;/&gt;</span>
<a href="#l6.166"></a><span id="l6.166" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_start_tomorrow&quot;</span>
<a href="#l6.167"></a><span id="l6.167" class="difflineplus">+                                                label=&quot;&amp;pref.default_task_tomorrow.label;&quot;</span>
<a href="#l6.168"></a><span id="l6.168" class="difflineplus">+                                                value=&quot;tomorrow&quot;/&gt;</span>
<a href="#l6.169"></a><span id="l6.169" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_start_next_week&quot;</span>
<a href="#l6.170"></a><span id="l6.170" class="difflineplus">+                                                label=&quot;&amp;pref.default_task_next_week.label;&quot;</span>
<a href="#l6.171"></a><span id="l6.171" class="difflineplus">+                                                value=&quot;nextweek&quot;/&gt;</span>
<a href="#l6.172"></a><span id="l6.172" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_start_offset_current&quot;</span>
<a href="#l6.173"></a><span id="l6.173" class="difflineplus">+                                                label=&quot;&amp;pref.default_task_offset_current.label;&quot;</span>
<a href="#l6.174"></a><span id="l6.174" class="difflineplus">+                                                value=&quot;offsetcurrent&quot;/&gt;</span>
<a href="#l6.175"></a><span id="l6.175" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_start_offset_next_hour&quot;</span>
<a href="#l6.176"></a><span id="l6.176" class="difflineplus">+                                                label=&quot;&amp;pref.default_task_offset_next_hour.label;&quot;</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineplus">+                                                value=&quot;offsetnexthour&quot;/&gt;</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineplus">+                                &lt;/menupopup&gt;</span>
<a href="#l6.179"></a><span id="l6.179" class="difflineplus">+                            &lt;/menulist&gt;</span>
<a href="#l6.180"></a><span id="l6.180" class="difflineplus">+                            &lt;hbox align=&quot;center&quot; id=&quot;default_task_start_offset&quot;&gt;</span>
<a href="#l6.181"></a><span id="l6.181" class="difflineplus">+                                &lt;textbox id=&quot;default_task_start_offset_text&quot;</span>
<a href="#l6.182"></a><span id="l6.182" class="difflineplus">+                                         preference=&quot;calendar.task.defaultstartoffset&quot;</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineplus">+                                         type=&quot;number&quot;</span>
<a href="#l6.184"></a><span id="l6.184" class="difflineplus">+                                         min=&quot;0&quot;</span>
<a href="#l6.185"></a><span id="l6.185" class="difflineplus">+                                         maxlength=&quot;3&quot;</span>
<a href="#l6.186"></a><span id="l6.186" class="difflineplus">+                                         size=&quot;3&quot;</span>
<a href="#l6.187"></a><span id="l6.187" class="difflineplus">+                                         onselect=&quot;updateMenuLabels('default_task_start_offset_text', 'default_task_start_offset_units')&quot;</span>
<a href="#l6.188"></a><span id="l6.188" class="difflineplus">+                                         oninput=&quot;updateMenuLabels('default_task_start_offset_text', 'default_task_start_offset_units')&quot;/&gt;</span>
<a href="#l6.189"></a><span id="l6.189" class="difflineplus">+                                &lt;menulist id=&quot;default_task_start_offset_units&quot;</span>
<a href="#l6.190"></a><span id="l6.190" class="difflineplus">+                                          crop=&quot;none&quot;</span>
<a href="#l6.191"></a><span id="l6.191" class="difflineplus">+                                          preference=&quot;calendar.task.defaultstartoffsetunits&quot;</span>
<a href="#l6.192"></a><span id="l6.192" class="difflineplus">+                                          labelnumber=&quot;labelplural&quot;&gt;</span>
<a href="#l6.193"></a><span id="l6.193" class="difflineplus">+                                    &lt;menupopup id=&quot;default_task_start_offset_units_popup&quot;&gt;</span>
<a href="#l6.194"></a><span id="l6.194" class="difflineplus">+                                        &lt;menuitem id=&quot;default_task_start_offset_units_minutes&quot;</span>
<a href="#l6.195"></a><span id="l6.195" class="difflineplus">+                                                  label=&quot;&amp;calendar.global.units.minutes;&quot;</span>
<a href="#l6.196"></a><span id="l6.196" class="difflineplus">+                                                  labelplural=&quot;&amp;calendar.global.units.minutes;&quot;</span>
<a href="#l6.197"></a><span id="l6.197" class="difflineplus">+                                                  labelsingular=&quot;&amp;calendar.global.units.minute;&quot;</span>
<a href="#l6.198"></a><span id="l6.198" class="difflineplus">+                                                  value=&quot;minutes&quot;</span>
<a href="#l6.199"></a><span id="l6.199" class="difflineplus">+                                                  selected=&quot;true&quot;/&gt;</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineplus">+                                        &lt;menuitem id=&quot;default_task_start_offset_units_hours&quot;</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineplus">+                                                  label=&quot;&amp;calendar.global.units.hours;&quot;</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineplus">+                                                  labelplural=&quot;&amp;calendar.global.units.hours;&quot;</span>
<a href="#l6.203"></a><span id="l6.203" class="difflineplus">+                                                  labelsingular=&quot;&amp;calendar.global.units.hour;&quot;</span>
<a href="#l6.204"></a><span id="l6.204" class="difflineplus">+                                                  value=&quot;hours&quot;/&gt;</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineplus">+                                        &lt;menuitem id=&quot;default_task_start_offset_units_days&quot;</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineplus">+                                                  label=&quot;&amp;calendar.global.units.days;&quot;</span>
<a href="#l6.207"></a><span id="l6.207" class="difflineplus">+                                                  labelplural=&quot;&amp;calendar.global.units.days;&quot;</span>
<a href="#l6.208"></a><span id="l6.208" class="difflineplus">+                                                  labelsingular=&quot;&amp;calendar.global.units.day;&quot;</span>
<a href="#l6.209"></a><span id="l6.209" class="difflineplus">+                                                  value=&quot;days&quot;/&gt;</span>
<a href="#l6.210"></a><span id="l6.210" class="difflineplus">+                                    &lt;/menupopup&gt;</span>
<a href="#l6.211"></a><span id="l6.211" class="difflineplus">+                                &lt;/menulist&gt;</span>
<a href="#l6.212"></a><span id="l6.212" class="difflineplus">+                            &lt;/hbox&gt;</span>
<a href="#l6.213"></a><span id="l6.213" class="difflineplus">+                        &lt;/row&gt;</span>
<a href="#l6.214"></a><span id="l6.214" class="difflineplus">+                        &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l6.215"></a><span id="l6.215" class="difflineplus">+                            &lt;label value=&quot;&amp;read.only.task.due.label;&quot;</span>
<a href="#l6.216"></a><span id="l6.216" class="difflineplus">+                                   control=&quot;default_task_due&quot;/&gt;</span>
<a href="#l6.217"></a><span id="l6.217" class="difflineplus">+                            &lt;menulist id=&quot;default_task_due&quot;</span>
<a href="#l6.218"></a><span id="l6.218" class="difflineplus">+                                      crop=&quot;none&quot;</span>
<a href="#l6.219"></a><span id="l6.219" class="difflineplus">+                                      oncommand=&quot;gCalendarGeneralPane.updateDefaultTodoDates()&quot;</span>
<a href="#l6.220"></a><span id="l6.220" class="difflineplus">+                                      preference=&quot;calendar.task.defaultdue&quot;&gt;</span>
<a href="#l6.221"></a><span id="l6.221" class="difflineplus">+                                &lt;menupopup id=&quot;default_task_due_popup&quot;&gt;</span>
<a href="#l6.222"></a><span id="l6.222" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_due_none&quot;</span>
<a href="#l6.223"></a><span id="l6.223" class="difflineplus">+                                              label=&quot;&amp;pref.default_task_none.label;&quot;</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineplus">+                                              value=&quot;none&quot;</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineplus">+                                              selected=&quot;true&quot;/&gt;</span>
<a href="#l6.226"></a><span id="l6.226" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_due_end_of_day&quot;</span>
<a href="#l6.227"></a><span id="l6.227" class="difflineplus">+                                              label=&quot;&amp;pref.default_task_end_of_day.label;&quot;</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineplus">+                                              value=&quot;endofday&quot;/&gt;</span>
<a href="#l6.229"></a><span id="l6.229" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_due_tomorrow&quot;</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineplus">+                                              label=&quot;&amp;pref.default_task_tomorrow.label;&quot;</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineplus">+                                              value=&quot;tomorrow&quot;/&gt;</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_due_next_week&quot;</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineplus">+                                              label=&quot;&amp;pref.default_task_next_week.label;&quot;</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineplus">+                                              value=&quot;nextweek&quot;/&gt;</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_due_offset_current&quot;</span>
<a href="#l6.236"></a><span id="l6.236" class="difflineplus">+                                              label=&quot;&amp;pref.default_task_offset_start.label;&quot;</span>
<a href="#l6.237"></a><span id="l6.237" class="difflineplus">+                                              value=&quot;offsetcurrent&quot;/&gt;</span>
<a href="#l6.238"></a><span id="l6.238" class="difflineplus">+                                    &lt;menuitem id=&quot;default_task_due_offset_next_hour&quot;</span>
<a href="#l6.239"></a><span id="l6.239" class="difflineplus">+                                              label=&quot;&amp;pref.default_task_offset_next_hour.label;&quot;</span>
<a href="#l6.240"></a><span id="l6.240" class="difflineplus">+                                              value=&quot;offsetnexthour&quot;/&gt;</span>
<a href="#l6.241"></a><span id="l6.241" class="difflineplus">+                                &lt;/menupopup&gt;</span>
<a href="#l6.242"></a><span id="l6.242" class="difflineplus">+                            &lt;/menulist&gt;</span>
<a href="#l6.243"></a><span id="l6.243" class="difflineplus">+                            &lt;hbox align=&quot;center&quot; id=&quot;default_task_due_offset&quot;&gt;</span>
<a href="#l6.244"></a><span id="l6.244" class="difflineplus">+                                &lt;textbox id=&quot;default_task_due_offset_text&quot;</span>
<a href="#l6.245"></a><span id="l6.245" class="difflineplus">+                                         preference=&quot;calendar.task.defaultdueoffset&quot;</span>
<a href="#l6.246"></a><span id="l6.246" class="difflineplus">+                                         type=&quot;number&quot;</span>
<a href="#l6.247"></a><span id="l6.247" class="difflineplus">+                                         min=&quot;0&quot;</span>
<a href="#l6.248"></a><span id="l6.248" class="difflineplus">+                                         maxlength=&quot;3&quot;</span>
<a href="#l6.249"></a><span id="l6.249" class="difflineplus">+                                         size=&quot;3&quot;</span>
<a href="#l6.250"></a><span id="l6.250" class="difflineplus">+                                         onselect=&quot;updateMenuLabels('default_task_due_offset_text', 'default_task_due_offset_units')&quot;</span>
<a href="#l6.251"></a><span id="l6.251" class="difflineplus">+                                         oninput=&quot;updateMenuLabels('default_task_due_offset_text', 'default_task_due_offset_units')&quot;/&gt;</span>
<a href="#l6.252"></a><span id="l6.252" class="difflineplus">+                                &lt;menulist id=&quot;default_task_due_offset_units&quot;</span>
<a href="#l6.253"></a><span id="l6.253" class="difflineplus">+                                          crop=&quot;none&quot;</span>
<a href="#l6.254"></a><span id="l6.254" class="difflineplus">+                                          preference=&quot;calendar.task.defaultdueoffsetunits&quot;</span>
<a href="#l6.255"></a><span id="l6.255" class="difflineplus">+                                          labelnumber=&quot;labelplural&quot;&gt;</span>
<a href="#l6.256"></a><span id="l6.256" class="difflineplus">+                                    &lt;menupopup id=&quot;default_task_due_offset_units_popup&quot;&gt;</span>
<a href="#l6.257"></a><span id="l6.257" class="difflineplus">+                                        &lt;menuitem id=&quot;default_task_due_offset_units_minutes&quot;</span>
<a href="#l6.258"></a><span id="l6.258" class="difflineplus">+                                                  label=&quot;&amp;calendar.global.units.minutes;&quot;</span>
<a href="#l6.259"></a><span id="l6.259" class="difflineplus">+                                                  labelplural=&quot;&amp;calendar.global.units.minutes;&quot;</span>
<a href="#l6.260"></a><span id="l6.260" class="difflineplus">+                                                  labelsingular=&quot;&amp;calendar.global.units.minute;&quot;</span>
<a href="#l6.261"></a><span id="l6.261" class="difflineplus">+                                                  value=&quot;minutes&quot;</span>
<a href="#l6.262"></a><span id="l6.262" class="difflineplus">+                                                  selected=&quot;true&quot;/&gt;</span>
<a href="#l6.263"></a><span id="l6.263" class="difflineplus">+                                        &lt;menuitem id=&quot;default_task_due_offset_units_hours&quot;</span>
<a href="#l6.264"></a><span id="l6.264" class="difflineplus">+                                                  label=&quot;&amp;calendar.global.units.hours;&quot;</span>
<a href="#l6.265"></a><span id="l6.265" class="difflineplus">+                                                  labelplural=&quot;&amp;calendar.global.units.hours;&quot;</span>
<a href="#l6.266"></a><span id="l6.266" class="difflineplus">+                                                  labelsingular=&quot;&amp;calendar.global.units.hour;&quot;</span>
<a href="#l6.267"></a><span id="l6.267" class="difflineplus">+                                                  value=&quot;hours&quot;/&gt;</span>
<a href="#l6.268"></a><span id="l6.268" class="difflineplus">+                                        &lt;menuitem id=&quot;default_task_due_offset_units_days&quot;</span>
<a href="#l6.269"></a><span id="l6.269" class="difflineplus">+                                                  label=&quot;&amp;calendar.global.units.days;&quot;</span>
<a href="#l6.270"></a><span id="l6.270" class="difflineplus">+                                                  labelplural=&quot;&amp;calendar.global.units.days;&quot;</span>
<a href="#l6.271"></a><span id="l6.271" class="difflineplus">+                                                  labelsingular=&quot;&amp;calendar.global.units.day;&quot;</span>
<a href="#l6.272"></a><span id="l6.272" class="difflineplus">+                                                  value=&quot;days&quot;/&gt;</span>
<a href="#l6.273"></a><span id="l6.273" class="difflineplus">+                                    &lt;/menupopup&gt;</span>
<a href="#l6.274"></a><span id="l6.274" class="difflineplus">+                                &lt;/menulist&gt;</span>
<a href="#l6.275"></a><span id="l6.275" class="difflineplus">+                            &lt;/hbox&gt;</span>
<a href="#l6.276"></a><span id="l6.276" class="difflineplus">+                        &lt;/row&gt;</span>
<a href="#l6.277"></a><span id="l6.277" class="difflineplus">+                    &lt;/rows&gt;</span>
<a href="#l6.278"></a><span id="l6.278" class="difflineplus">+                &lt;/grid&gt;</span>
<a href="#l6.279"></a><span id="l6.279" class="difflineplus">+            &lt;/deck&gt;</span>
<a href="#l6.280"></a><span id="l6.280" class="difflineplus">+        &lt;/groupbox&gt;</span>
<a href="#l6.281"></a><span id="l6.281">     &lt;/vbox&gt;</span>
<a href="#l6.282"></a><span id="l6.282"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/lightning/content/lightning.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/lightning/content/lightning.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -15,16 +15,22 @@ pref(&quot;extensions.{e2fda1a4-762b-4020-b5a</span>
<a href="#l7.4"></a><span id="l7.4"> pref(&quot;extensions.{e2fda1a4-762b-4020-b5ad-a41df1933103}.name&quot;,</span>
<a href="#l7.5"></a><span id="l7.5">      &quot;chrome://lightning/locale/lightning.properties&quot;);</span>
<a href="#l7.6"></a><span id="l7.6"> pref(&quot;extensions.{e2fda1a4-762b-4020-b5ad-a41df1933103}.creator&quot;,</span>
<a href="#l7.7"></a><span id="l7.7">      &quot;chrome://lightning/locale/lightning.properties&quot;);</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> // general settings</span>
<a href="#l7.10"></a><span id="l7.10"> pref(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l7.11"></a><span id="l7.11"> pref(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+pref(&quot;calendar.task.defaultstart&quot;, &quot;none&quot;);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+pref(&quot;calendar.task.defaultstartoffset&quot;, 0);</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+pref(&quot;calendar.task.defaultstartoffsetunits&quot;, &quot;minutes&quot;);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+pref(&quot;calendar.task.defaultdue&quot;, &quot;none&quot;);</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+pref(&quot;calendar.task.defaultdueoffset&quot;, 60);</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+pref(&quot;calendar.task.defaultdueoffsetunits&quot;, &quot;minutes&quot;);</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19"> // default transparency of allday items; could be switched to e.g. &quot;OPAQUE&quot;:</span>
<a href="#l7.20"></a><span id="l7.20"> pref(&quot;calendar.allday.defaultTransparency&quot;, &quot;TRANSPARENT&quot;);</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22"> // number of days in &quot;Soon&quot; section</span>
<a href="#l7.23"></a><span id="l7.23"> pref(&quot;calendar.agendaListbox.soondays&quot;, 5);</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25"> // alarm settings</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/locales/en-US/chrome/calendar/preferences/alarms.dtd</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/locales/en-US/chrome/calendar/preferences/alarms.dtd</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -28,8 +28,11 @@</span>
<a href="#l8.4"></a><span id="l8.4"> &lt;!ENTITY pref.alarm.on &quot;On&quot;&gt;</span>
<a href="#l8.5"></a><span id="l8.5"> &lt;!ENTITY pref.alarm.off &quot;Off&quot;&gt;</span>
<a href="#l8.6"></a><span id="l8.6"> &lt;!ENTITY pref.defalarmlen4events.label &quot;Default time a reminder is set before an event:&quot;&gt;</span>
<a href="#l8.7"></a><span id="l8.7"> &lt;!ENTITY pref.defalarmlen4events.accesskey &quot;u&quot;&gt;</span>
<a href="#l8.8"></a><span id="l8.8"> &lt;!ENTITY pref.defalarmlen4todos.label &quot;Default time a reminder is set before a task:&quot;&gt;</span>
<a href="#l8.9"></a><span id="l8.9"> &lt;!ENTITY pref.defalarmlen4todos.accesskey &quot;o&quot;&gt;</span>
<a href="#l8.10"></a><span id="l8.10"> &lt;!ENTITY pref.defaultemail.label &quot;Default address to send reminders to:&quot;&gt;</span>
<a href="#l8.11"></a><span id="l8.11"> &lt;!ENTITY pref.defaulttext.label &quot;Default text for reminders :&quot;&gt;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+&lt;!ENTITY pref.defaultsnoozelength.label &quot;Default Snooze Length:&quot; &gt;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+&lt;!ENTITY pref.defaultsnoozelength.accesskey &quot;S&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/locales/en-US/chrome/calendar/preferences/general.dtd</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/locales/en-US/chrome/calendar/preferences/general.dtd</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -7,16 +7,28 @@</span>
<a href="#l9.4"></a><span id="l9.4">    - your editor isn't using UTF-8 encoding and may munge up the document!</span>
<a href="#l9.5"></a><span id="l9.5">   --&gt;</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> &lt;!ENTITY pref.mainbox.label &quot;General Settings&quot; &gt;</span>
<a href="#l9.8"></a><span id="l9.8"> &lt;!ENTITY pref.dateformat.label &quot;Date Text Format:&quot; &gt;</span>
<a href="#l9.9"></a><span id="l9.9"> &lt;!ENTITY pref.dateformat.accesskey &quot;D&quot;&gt;</span>
<a href="#l9.10"></a><span id="l9.10"> &lt;!ENTITY pref.dateformat.long &quot;Long&quot; &gt;</span>
<a href="#l9.11"></a><span id="l9.11"> &lt;!ENTITY pref.dateformat.short &quot;Short&quot;  &gt;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-&lt;!ENTITY pref.defaultlength.label &quot;Default Event Length:&quot; &gt;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-&lt;!ENTITY pref.defaultlength.accesskey &quot;E&quot;&gt;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-&lt;!ENTITY pref.defaultsnoozelength.label &quot;Default Snooze Length:&quot; &gt;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-&lt;!ENTITY pref.defaultsnoozelength.accesskey &quot;S&quot;&gt;</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+&lt;!ENTITY pref.defaults.label &quot;Default Values for New Items&quot;&gt;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+&lt;!ENTITY pref.events.label &quot;Events&quot;&gt;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+&lt;!ENTITY pref.tasks.label &quot;Tasks&quot;&gt;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+&lt;!ENTITY pref.default_event_length.label &quot;Default Length:&quot; &gt;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+&lt;!ENTITY pref.default_event_length.accesskey &quot;E&quot;&gt;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+&lt;!ENTITY pref.default_task_none.label &quot;None&quot;&gt;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+&lt;!ENTITY pref.default_task_start_of_day.label &quot;Start of Day&quot;&gt;</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+&lt;!ENTITY pref.default_task_end_of_day.label &quot;End of Day&quot;&gt;</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+&lt;!ENTITY pref.default_task_tomorrow.label &quot;Tomorrow&quot;&gt;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+&lt;!ENTITY pref.default_task_next_week.label &quot;Next Week&quot;&gt;</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+&lt;!ENTITY pref.default_task_offset_current.label &quot;Relative to Current Time&quot;&gt;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+&lt;!ENTITY pref.default_task_offset_start.label &quot;Relative to Start&quot;&gt;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+&lt;!ENTITY pref.default_task_offset_next_hour.label &quot;Relative to Next Hour&quot;&gt;</span>
<a href="#l9.32"></a><span id="l9.32"> </span>
<a href="#l9.33"></a><span id="l9.33"> &lt;!ENTITY pref.accessibility.label &quot;Accessibility&quot; &gt;</span>
<a href="#l9.34"></a><span id="l9.34"> &lt;!ENTITY pref.systemcolors.label &quot;Optimize colors for accessibility&quot; &gt;</span>
<a href="#l9.35"></a><span id="l9.35"> &lt;!ENTITY pref.systemcolors.accesskey &quot;c&quot;&gt;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

