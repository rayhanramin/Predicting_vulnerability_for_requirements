<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 11314:65b8e2fa4eba178e960aa0b2125cac986a90c0c3</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 65b8e2fa4eba178e960aa0b2125cac986a90c0c3" />
<meta property="og:url" content="/comm-central/rev/65b8e2fa4eba178e960aa0b2125cac986a90c0c3" />
<meta property="og:description" content="Bug 801383 Fix fallout from bug 779473 - make nsresult an enum class. Fix most of mailnews. Patch started by mconley, completed by irving. r=Standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 65b8e2fa4eba178e960aa0b2125cac986a90c0c3 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/65b8e2fa4eba178e960aa0b2125cac986a90c0c3">shortlog</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/65b8e2fa4eba178e960aa0b2125cac986a90c0c3">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3">files</a> |
changeset |
<a href="/comm-central/raw-rev/65b8e2fa4eba178e960aa0b2125cac986a90c0c3">raw</a>  | <a href="/comm-central/archive/65b8e2fa4eba178e960aa0b2125cac986a90c0c3.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=801383">Bug 801383</a> Fix fallout from <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=779473">bug 779473</a> - make nsresult an enum class. Fix most of mailnews. Patch started by mconley, completed by irving. r=Standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#73;&#114;&#118;&#105;&#110;&#103;&#32;&#82;&#101;&#105;&#100;&#32;&#60;&#105;&#114;&#118;&#105;&#110;&#103;&#64;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 16 Oct 2012 11:21:18 +0100</td></tr>

<tr>
 <td>changeset 11314</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/65b8e2fa4eba178e960aa0b2125cac986a90c0c3">65b8e2fa4eba178e960aa0b2125cac986a90c0c3</a></td>
</tr>



<tr>
<td>parent 11313</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/eac22e3d7ba343ace7a9c4033392e334a5d443be">eac22e3d7ba343ace7a9c4033392e334a5d443be</a>
</td>
</tr>

<tr>
<td>child 11315</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/cc0ff188f5bc5e7e2cd6f37ceb211a460c8e6557">cc0ff188f5bc5e7e2cd6f37ceb211a460c8e6557</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=65b8e2fa4eba178e960aa0b2125cac986a90c0c3">8466</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 16 Oct 2012 10:25:50 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@cc0ff188f5bc [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=cc0ff188f5bc5e7e2cd6f37ceb211a460c8e6557">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=cc0ff188f5bc5e7e2cd6f37ceb211a460c8e6557&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=cc0ff188f5bc5e7e2cd6f37ceb211a460c8e6557&newProject=comm-central&newRevision=65b8e2fa4eba178e960aa0b2125cac986a90c0c3&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=cc0ff188f5bc5e7e2cd6f37ceb211a460c8e6557&newProject=comm-central&newRevision=65b8e2fa4eba178e960aa0b2125cac986a90c0c3&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=cc0ff188f5bc5e7e2cd6f37ceb211a460c8e6557&newProject=comm-central&newRevision=65b8e2fa4eba178e960aa0b2125cac986a90c0c3&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=801383">801383</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=779473">779473</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=801383">Bug 801383</a> Fix fallout from <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=779473">bug 779473</a> - make nsresult an enum class. Fix most of mailnews. Patch started by mconley, completed by irving. r=Standard8</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDIFService.cpp">mailnews/addrbook/src/nsAbLDIFService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDIFService.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDIFService.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDIFService.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDIFService.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAbLDIFService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAddrDatabase.cpp">mailnews/addrbook/src/nsAddrDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAddrDatabase.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAddrDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAddrDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAddrDatabase.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/addrbook/src/nsAddrDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/public/nsIMsgSearchAdapter.idl">mailnews/base/search/public/nsIMsgSearchAdapter.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/public/nsIMsgSearchAdapter.idl">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/public/nsIMsgSearchAdapter.idl">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/public/nsIMsgSearchAdapter.idl">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/public/nsIMsgSearchAdapter.idl">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/public/nsIMsgSearchAdapter.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchAdapter.cpp">mailnews/base/search/src/nsMsgSearchAdapter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchAdapter.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchAdapter.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchAdapter.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchAdapter.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchAdapter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderCache.cpp">mailnews/base/src/nsMsgFolderCache.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderCache.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderCache.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderCache.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderCache.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderCache.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderDataSource.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgKeySet.cpp">mailnews/base/util/nsMsgKeySet.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgKeySet.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgKeySet.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgKeySet.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgKeySet.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgKeySet.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.cpp">mailnews/base/util/nsMsgLineBuffer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.h">mailnews/base/util/nsMsgLineBuffer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.h">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.h">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.h">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.h">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgLineBuffer.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgProtocol.cpp">mailnews/base/util/nsMsgProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgProtocol.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgProtocol.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/base/util/nsMsgProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">mailnews/db/msgdb/src/nsDBFolderInfo.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">mailnews/db/msgdb/src/nsImapMailDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMailDatabase.cpp">mailnews/db/msgdb/src/nsMailDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMailDatabase.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMailDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMailDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMailDatabase.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMailDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapOfflineSync.cpp">mailnews/imap/src/nsImapOfflineSync.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapOfflineSync.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapOfflineSync.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapOfflineSync.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapOfflineSync.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapOfflineSync.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraFilters.cpp">mailnews/import/eudora/src/nsEudoraFilters.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraFilters.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraFilters.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraFilters.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraFilters.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraFilters.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraMac.cpp">mailnews/import/eudora/src/nsEudoraMac.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraMac.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraMac.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraMac.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraMac.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/import/eudora/src/nsEudoraMac.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.cpp">mailnews/local/src/nsMailboxProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.h">mailnews/local/src/nsMailboxProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.h">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.h">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.h">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.h">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsMailboxProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.cpp">mailnews/local/src/nsPop3Protocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.h">mailnews/local/src/nsPop3Protocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.h">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.h">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.h">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.h">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/local/src/nsPop3Protocol.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimedrft.cpp">mailnews/mime/src/mimedrft.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimedrft.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimedrft.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimedrft.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimedrft.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimedrft.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimehdrs.cpp">mailnews/mime/src/mimehdrs.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimehdrs.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimehdrs.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimehdrs.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimehdrs.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimehdrs.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemalt.cpp">mailnews/mime/src/mimemalt.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemalt.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemalt.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemalt.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemalt.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemalt.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemrel.cpp">mailnews/mime/src/mimemrel.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemrel.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemrel.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemrel.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemrel.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimemrel.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimepbuf.cpp">mailnews/mime/src/mimepbuf.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimepbuf.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimepbuf.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimepbuf.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimepbuf.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimepbuf.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpfl.cpp">mailnews/mime/src/mimetpfl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpfl.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpfl.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpfl.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpfl.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpfl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpla.cpp">mailnews/mime/src/mimetpla.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpla.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpla.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpla.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpla.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/mimetpla.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/nsMsgHeaderParser.cpp">mailnews/mime/src/nsMsgHeaderParser.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/nsMsgHeaderParser.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/nsMsgHeaderParser.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/nsMsgHeaderParser.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/nsMsgHeaderParser.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/mime/src/nsMsgHeaderParser.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.h">mailnews/news/src/nsNntpIncomingServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.h">file</a> |
<a href="/comm-central/annotate/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.h">annotate</a> |
<a href="/comm-central/diff/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.h">diff</a> |
<a href="/comm-central/comparison/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.h">comparison</a> |
<a href="/comm-central/log/65b8e2fa4eba178e960aa0b2125cac986a90c0c3/mailnews/news/src/nsNntpIncomingServer.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -214,17 +214,17 @@ nsAbLDAPAutoCompFormatter::FormatExcepti</span>
<a href="#l1.4"></a><span id="l1.4">             return rv;</span>
<a href="#l1.5"></a><span id="l1.5">         }</span>
<a href="#l1.6"></a><span id="l1.6">   </span>
<a href="#l1.7"></a><span id="l1.7">     } else {</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">         // put the entire nsresult in string form</span>
<a href="#l1.10"></a><span id="l1.10">         //</span>
<a href="#l1.11"></a><span id="l1.11">         errCodeNum.AppendLiteral(&quot;0x&quot;);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        errCodeNum.AppendInt(aErrorCode, 16);    </span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+        errCodeNum.AppendInt(static_cast&lt;uint32_t&gt;(aErrorCode), 16);</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15">         // figure out the key to index into the string bundle</span>
<a href="#l1.16"></a><span id="l1.16">         //</span>
<a href="#l1.17"></a><span id="l1.17">         const int32_t HOST_NOT_FOUND_ERROR=5000;</span>
<a href="#l1.18"></a><span id="l1.18">         const int32_t GENERIC_ERROR=9999;</span>
<a href="#l1.19"></a><span id="l1.19">         errorKey = ( (aErrorCode == NS_ERROR_UNKNOWN_HOST) ? </span>
<a href="#l1.20"></a><span id="l1.20">                      HOST_NOT_FOUND_ERROR : GENERIC_ERROR );</span>
<a href="#l1.21"></a><span id="l1.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDIFService.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDIFService.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -365,17 +365,17 @@ void nsAbLDIFService::AddLdifRowToDataba</span>
<a href="#l2.4"></a><span id="l2.4">   char* cursor = ToNewCString(mLdifLine); </span>
<a href="#l2.5"></a><span id="l2.5">   char* saveCursor = cursor;  /* keep for deleting */ </span>
<a href="#l2.6"></a><span id="l2.6">   char* line = 0; </span>
<a href="#l2.7"></a><span id="l2.7">   char* typeSlot = 0; </span>
<a href="#l2.8"></a><span id="l2.8">   char* valueSlot = 0; </span>
<a href="#l2.9"></a><span id="l2.9">   int length = 0;  // the length  of an ldif attribute</span>
<a href="#l2.10"></a><span id="l2.10">   while ( (line = str_getline(&amp;cursor)) != nullptr)</span>
<a href="#l2.11"></a><span id="l2.11">   {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    if ( str_parse_line(line, &amp;typeSlot, &amp;valueSlot, &amp;length) == 0) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    if (NS_SUCCEEDED(str_parse_line(line, &amp;typeSlot, &amp;valueSlot, &amp;length))) {</span>
<a href="#l2.14"></a><span id="l2.14">       AddLdifColToDatabase(aDatabase, newRow, typeSlot, valueSlot, bIsList);</span>
<a href="#l2.15"></a><span id="l2.15">     }</span>
<a href="#l2.16"></a><span id="l2.16">     else</span>
<a href="#l2.17"></a><span id="l2.17">       continue; // parse error: continue with next loop iteration</span>
<a href="#l2.18"></a><span id="l2.18">   }</span>
<a href="#l2.19"></a><span id="l2.19">   nsMemory::Free(saveCursor);</span>
<a href="#l2.20"></a><span id="l2.20">   aDatabase-&gt;AddCardRowToDB(newRow);    </span>
<a href="#l2.21"></a><span id="l2.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -545,17 +545,17 @@ NS_IMETHODIMP nsAddrDatabase::OpenMDB(ns</span>
<a href="#l3.4"></a><span id="l3.4">       ret = mdbFactory-&gt;OpenOldFile(m_mdbEnv, dbHeap, filePath.get(),</span>
<a href="#l3.5"></a><span id="l3.5">                                     dbFrozen, &amp;oldFile);</span>
<a href="#l3.6"></a><span id="l3.6">       if ( oldFile )</span>
<a href="#l3.7"></a><span id="l3.7">       {</span>
<a href="#l3.8"></a><span id="l3.8">         if ( ret == NS_OK )</span>
<a href="#l3.9"></a><span id="l3.9">         {</span>
<a href="#l3.10"></a><span id="l3.10">           ret = mdbFactory-&gt;CanOpenFilePort(m_mdbEnv, oldFile, // the file to investigate</span>
<a href="#l3.11"></a><span id="l3.11">                                             &amp;canOpen, &amp;outFormatVersion);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-          if (ret == 0 &amp;&amp; canOpen)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+          if (NS_SUCCEEDED(ret) &amp;&amp; canOpen)</span>
<a href="#l3.14"></a><span id="l3.14">           {</span>
<a href="#l3.15"></a><span id="l3.15">             inOpenPolicy.mOpenPolicy_ScopePlan.mScopeStringSet_Count = 0;</span>
<a href="#l3.16"></a><span id="l3.16">             inOpenPolicy.mOpenPolicy_MinMemory = 0;</span>
<a href="#l3.17"></a><span id="l3.17">             inOpenPolicy.mOpenPolicy_MaxLazy = 0;</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">             ret = mdbFactory-&gt;OpenFileStore(m_mdbEnv, dbHeap,</span>
<a href="#l3.20"></a><span id="l3.20">               oldFile, &amp;inOpenPolicy, &amp;thumb);</span>
<a href="#l3.21"></a><span id="l3.21">           }</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -572,17 +572,17 @@ NS_IMETHODIMP nsAddrDatabase::OpenMDB(ns</span>
<a href="#l3.23"></a><span id="l3.23">     {</span>
<a href="#l3.24"></a><span id="l3.24">       mdb_count outTotal;    // total somethings to do in operation</span>
<a href="#l3.25"></a><span id="l3.25">       mdb_count outCurrent;  // subportion of total completed so far</span>
<a href="#l3.26"></a><span id="l3.26">       mdb_bool outDone = false;      // is operation finished?</span>
<a href="#l3.27"></a><span id="l3.27">       mdb_bool outBroken;     // is operation irreparably dead and broken?</span>
<a href="#l3.28"></a><span id="l3.28">       do</span>
<a href="#l3.29"></a><span id="l3.29">       {</span>
<a href="#l3.30"></a><span id="l3.30">         ret = thumb-&gt;DoMore(m_mdbEnv, &amp;outTotal, &amp;outCurrent, &amp;outDone, &amp;outBroken);</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-        if (ret != 0)</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+        if (NS_FAILED(ret))</span>
<a href="#l3.33"></a><span id="l3.33">         {</span>
<a href="#l3.34"></a><span id="l3.34">           outDone = true;</span>
<a href="#l3.35"></a><span id="l3.35">           break;</span>
<a href="#l3.36"></a><span id="l3.36">         }</span>
<a href="#l3.37"></a><span id="l3.37">       }</span>
<a href="#l3.38"></a><span id="l3.38">       while (NS_SUCCEEDED(ret) &amp;&amp; !outBroken &amp;&amp; !outDone);</span>
<a href="#l3.39"></a><span id="l3.39">       if (NS_SUCCEEDED(ret) &amp;&amp; outDone)</span>
<a href="#l3.40"></a><span id="l3.40">       {</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineat">@@ -614,19 +614,16 @@ NS_IMETHODIMP nsAddrDatabase::OpenMDB(ns</span>
<a href="#l3.42"></a><span id="l3.42">           if (ret == NS_OK)</span>
<a href="#l3.43"></a><span id="l3.43">             ret = InitNewDB();</span>
<a href="#l3.44"></a><span id="l3.44">         }</span>
<a href="#l3.45"></a><span id="l3.45">         NS_RELEASE(newFile); // always release our file ref, store has own</span>
<a href="#l3.46"></a><span id="l3.46">       }</span>
<a href="#l3.47"></a><span id="l3.47">     }</span>
<a href="#l3.48"></a><span id="l3.48">     NS_IF_RELEASE(thumb);</span>
<a href="#l3.49"></a><span id="l3.49">   }</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-  //Convert the DB error to a valid nsresult error.</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-  if (ret == 1)</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-    ret = NS_ERROR_FAILURE;</span>
<a href="#l3.53"></a><span id="l3.53">   return ret;</span>
<a href="#l3.54"></a><span id="l3.54"> }</span>
<a href="#l3.55"></a><span id="l3.55"> </span>
<a href="#l3.56"></a><span id="l3.56"> NS_IMETHODIMP nsAddrDatabase::CloseMDB(bool commit)</span>
<a href="#l3.57"></a><span id="l3.57"> {</span>
<a href="#l3.58"></a><span id="l3.58">     if (commit)</span>
<a href="#l3.59"></a><span id="l3.59">         Commit(nsAddrDBCommitType::kSessionCommit);</span>
<a href="#l3.60"></a><span id="l3.60"> //???    RemoveFromCache(this);  // if we've closed it, better not leave it in the cache.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgSearchAdapter.idl</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgSearchAdapter.idl</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -9,22 +9,22 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #include &quot;nsIMsgSearchScopeTerm.idl&quot;</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> [ptr] native nsMsgResultElement(nsMsgResultElement);</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> %{C++</span>
<a href="#l4.9"></a><span id="l4.9"> class nsMsgResultElement;</span>
<a href="#l4.10"></a><span id="l4.10"> %}</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-[scriptable, uuid(B9F49D4C-A494-41f6-9D70-AB6CB5670485)]</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+[scriptable, uuid(0b09078b-e0cd-440a-afee-01f45808ee74)]</span>
<a href="#l4.14"></a><span id="l4.14"> interface nsIMsgSearchAdapter : nsISupports {</span>
<a href="#l4.15"></a><span id="l4.15">     void ValidateTerms();</span>
<a href="#l4.16"></a><span id="l4.16">     void Search(out boolean done);</span>
<a href="#l4.17"></a><span id="l4.17">     void SendUrl();</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-    void CurrentUrlDone(in long exitCode);</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+    void CurrentUrlDone(in nsresult exitCode);</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21">     void AddHit(in nsMsgKey key);</span>
<a href="#l4.22"></a><span id="l4.22">     void AddResultElement(in nsIMsgDBHdr aHdr);</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24">     [noscript] void OpenResultElement(in nsMsgResultElement element);</span>
<a href="#l4.25"></a><span id="l4.25">     [noscript] void ModifyResultElement(in nsMsgResultElement element,</span>
<a href="#l4.26"></a><span id="l4.26">                                         in nsMsgSearchValue value);</span>
<a href="#l4.27"></a><span id="l4.27"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -116,18 +116,18 @@ NS_IMETHODIMP nsMsgSearchAdapter::Search</span>
<a href="#l5.4"></a><span id="l5.4">   return NS_OK;</span>
<a href="#l5.5"></a><span id="l5.5"> }</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> NS_IMETHODIMP nsMsgSearchAdapter::SendUrl ()</span>
<a href="#l5.8"></a><span id="l5.8"> {</span>
<a href="#l5.9"></a><span id="l5.9">   return NS_OK;</span>
<a href="#l5.10"></a><span id="l5.10"> }</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-/* void CurrentUrlDone (in long exitCode); */</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-NS_IMETHODIMP nsMsgSearchAdapter::CurrentUrlDone(int32_t exitCode)</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+/* void CurrentUrlDone (in nsresult exitCode); */</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+NS_IMETHODIMP nsMsgSearchAdapter::CurrentUrlDone(nsresult exitCode)</span>
<a href="#l5.16"></a><span id="l5.16"> {</span>
<a href="#l5.17"></a><span id="l5.17">   // base implementation doesn't need to do anything.</span>
<a href="#l5.18"></a><span id="l5.18">   return NS_OK;</span>
<a href="#l5.19"></a><span id="l5.19"> }</span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21"> NS_IMETHODIMP nsMsgSearchAdapter::GetEncoding (char **encoding)</span>
<a href="#l5.22"></a><span id="l5.22"> {</span>
<a href="#l5.23"></a><span id="l5.23">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1635,17 +1635,17 @@ nsresult nsMsgSearchTerm::MatchKeyword(c</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5"> nsresult</span>
<a href="#l6.6"></a><span id="l6.6"> nsMsgSearchTerm::MatchPriority (nsMsgPriorityValue priorityToMatch,</span>
<a href="#l6.7"></a><span id="l6.7">                                 bool *pResult)</span>
<a href="#l6.8"></a><span id="l6.8"> {</span>
<a href="#l6.9"></a><span id="l6.9">   NS_ENSURE_ARG_POINTER(pResult);</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">   nsresult err = NS_OK;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  bool result=NS_OK;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  bool result = false;</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15">   // Use this ugly little hack to get around the fact that enums don't have</span>
<a href="#l6.16"></a><span id="l6.16">   // integer compare operators</span>
<a href="#l6.17"></a><span id="l6.17">   int p1 = (priorityToMatch == nsMsgPriority::none) ? (int) nsMsgPriority::normal : (int) priorityToMatch;</span>
<a href="#l6.18"></a><span id="l6.18">   int p2 = (int) m_value.u.priority;</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20">   switch (m_operator)</span>
<a href="#l6.21"></a><span id="l6.21">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -689,17 +689,17 @@ nsMsgAccountManager::removeListenerFromF</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> NS_IMETHODIMP</span>
<a href="#l7.6"></a><span id="l7.6"> nsMsgAccountManager::RemoveAccount(nsIMsgAccount *aAccount)</span>
<a href="#l7.7"></a><span id="l7.7"> {</span>
<a href="#l7.8"></a><span id="l7.8">   NS_ENSURE_ARG_POINTER(aAccount);</span>
<a href="#l7.9"></a><span id="l7.9">   nsresult rv = LoadAccounts();</span>
<a href="#l7.10"></a><span id="l7.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  bool accountRemoved = m_accounts-&gt;RemoveElement(aAccount);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  bool accountRemoved = NS_SUCCEEDED(m_accounts-&gt;RemoveElement(aAccount));</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15">   rv  = OutputAccountsPref();</span>
<a href="#l7.16"></a><span id="l7.16">   // If we couldn't write out the pref, restore the account.</span>
<a href="#l7.17"></a><span id="l7.17">   if (NS_FAILED(rv) &amp;&amp; accountRemoved)</span>
<a href="#l7.18"></a><span id="l7.18">   {</span>
<a href="#l7.19"></a><span id="l7.19">     m_accounts-&gt;AppendElement(aAccount);</span>
<a href="#l7.20"></a><span id="l7.20">     return rv;</span>
<a href="#l7.21"></a><span id="l7.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -4627,17 +4627,17 @@ nsMsgViewIndex nsMsgDBView::ThreadIndexO</span>
<a href="#l8.4"></a><span id="l8.4">   nsresult rv = m_db-&gt;GetMsgHdrForKey(msgKey, getter_AddRefs(msgHdr));</span>
<a href="#l8.5"></a><span id="l8.5">   NS_ENSURE_SUCCESS(rv, nsMsgViewIndex_None);</span>
<a href="#l8.6"></a><span id="l8.6">   return ThreadIndexOfMsgHdr(msgHdr, msgIndex, pThreadCount, pFlags);</span>
<a href="#l8.7"></a><span id="l8.7"> }</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> nsMsgViewIndex nsMsgDBView::GetThreadIndex(nsMsgViewIndex msgIndex)</span>
<a href="#l8.10"></a><span id="l8.10"> {</span>
<a href="#l8.11"></a><span id="l8.11">   if (!IsValidIndex(msgIndex))</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    return NS_MSG_INVALID_DBVIEW_INDEX;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    return nsMsgViewIndex_None;</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">   // scan up looking for level 0 message.</span>
<a href="#l8.16"></a><span id="l8.16">   while (m_levels[msgIndex] &amp;&amp; msgIndex)</span>
<a href="#l8.17"></a><span id="l8.17">     --msgIndex;</span>
<a href="#l8.18"></a><span id="l8.18">   return msgIndex;</span>
<a href="#l8.19"></a><span id="l8.19"> }</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21"> nsMsgViewIndex</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -6840,17 +6840,19 @@ nsresult nsMsgDBView::ToggleMessageKille</span>
<a href="#l8.23"></a><span id="l8.23"> }</span>
<a href="#l8.24"></a><span id="l8.24"> </span>
<a href="#l8.25"></a><span id="l8.25"> nsMsgViewIndex  nsMsgDBView::GetThreadFromMsgIndex(nsMsgViewIndex index,</span>
<a href="#l8.26"></a><span id="l8.26">                                                    nsIMsgThread **threadHdr)</span>
<a href="#l8.27"></a><span id="l8.27"> {</span>
<a href="#l8.28"></a><span id="l8.28">   nsMsgKey        msgKey = GetAt(index);</span>
<a href="#l8.29"></a><span id="l8.29">   nsMsgViewIndex  threadIndex;</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  NS_ENSURE_ARG(threadHdr);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+  if (threadHdr == nullptr)</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+    return nsMsgViewIndex_None;</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+</span>
<a href="#l8.35"></a><span id="l8.35">   nsresult rv = GetThreadContainingIndex(index, threadHdr);</span>
<a href="#l8.36"></a><span id="l8.36">   NS_ENSURE_SUCCESS(rv,nsMsgViewIndex_None);</span>
<a href="#l8.37"></a><span id="l8.37"> </span>
<a href="#l8.38"></a><span id="l8.38">   if (*threadHdr == nullptr)</span>
<a href="#l8.39"></a><span id="l8.39">     return nsMsgViewIndex_None;</span>
<a href="#l8.40"></a><span id="l8.40"> </span>
<a href="#l8.41"></a><span id="l8.41">   nsMsgKey threadKey;</span>
<a href="#l8.42"></a><span id="l8.42">   (*threadHdr)-&gt;GetThreadKey(&amp;threadKey);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -177,18 +177,18 @@ nsresult nsMsgFolderCache::OpenMDB(const</span>
<a href="#l9.4"></a><span id="l9.4">       {</span>
<a href="#l9.5"></a><span id="l9.5">         mdb_count outTotal;    // total somethings to do in operation</span>
<a href="#l9.6"></a><span id="l9.6">         mdb_count outCurrent;  // subportion of total completed so far</span>
<a href="#l9.7"></a><span id="l9.7">         mdb_bool outDone = false;      // is operation finished?</span>
<a href="#l9.8"></a><span id="l9.8">         mdb_bool outBroken;     // is operation irreparably dead and broken?</span>
<a href="#l9.9"></a><span id="l9.9">         do</span>
<a href="#l9.10"></a><span id="l9.10">         {</span>
<a href="#l9.11"></a><span id="l9.11">           ret = thumb-&gt;DoMore(m_mdbEnv, &amp;outTotal, &amp;outCurrent, &amp;outDone, &amp;outBroken);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-          if (ret != 0)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-          {// mork isn't really doing NS errors yet.</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+          if (NS_FAILED(ret))</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+          {</span>
<a href="#l9.16"></a><span id="l9.16">             outDone = true;</span>
<a href="#l9.17"></a><span id="l9.17">             break;</span>
<a href="#l9.18"></a><span id="l9.18">           }</span>
<a href="#l9.19"></a><span id="l9.19">         }</span>
<a href="#l9.20"></a><span id="l9.20">         while (NS_SUCCEEDED(ret) &amp;&amp; !outBroken &amp;&amp; !outDone);</span>
<a href="#l9.21"></a><span id="l9.21">         // m_mdbEnv-&gt;ClearErrors(); // ### temporary...</span>
<a href="#l9.22"></a><span id="l9.22">         if (NS_SUCCEEDED(ret) &amp;&amp; outDone)</span>
<a href="#l9.23"></a><span id="l9.23">         {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -2396,17 +2396,17 @@ void nsMsgRecentFoldersDataSource::Ensur</span>
<a href="#l10.4"></a><span id="l10.4">             allFolders-&gt;Count(&amp;newLastEntry);</span>
<a href="#l10.5"></a><span id="l10.5">             for (uint32_t newEntryIndex = lastEntry; newEntryIndex &lt; newLastEntry; newEntryIndex++)</span>
<a href="#l10.6"></a><span id="l10.6">             {</span>
<a href="#l10.7"></a><span id="l10.7">               nsCOMPtr &lt;nsIMsgFolder&gt; curFolder = do_QueryElementAt(allFolders, newEntryIndex);</span>
<a href="#l10.8"></a><span id="l10.8">               nsCString dateStr;</span>
<a href="#l10.9"></a><span id="l10.9">               nsresult err;</span>
<a href="#l10.10"></a><span id="l10.10">               curFolder-&gt;GetStringProperty(MRU_TIME_PROPERTY, dateStr);</span>
<a href="#l10.11"></a><span id="l10.11">               uint32_t curFolderDate = (uint32_t) dateStr.ToInteger(&amp;err);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-              if (err)</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+              if (NS_FAILED(err))</span>
<a href="#l10.14"></a><span id="l10.14">                 curFolderDate = 0;</span>
<a href="#l10.15"></a><span id="l10.15">               if (curFolderDate &gt; m_cutOffDate)</span>
<a href="#l10.16"></a><span id="l10.16">               {</span>
<a href="#l10.17"></a><span id="l10.17">                 // if m_folders is &quot;full&quot;, replace oldest folder with this folder,</span>
<a href="#l10.18"></a><span id="l10.18">                 // and adjust m_cutOffDate so that it's the mrutime</span>
<a href="#l10.19"></a><span id="l10.19">                 // of the &quot;new&quot; oldest folder.</span>
<a href="#l10.20"></a><span id="l10.20">                 uint32_t curFaveFoldersCount = m_folders.Count();</span>
<a href="#l10.21"></a><span id="l10.21">                 if (curFaveFoldersCount &gt; m_maxNumFolders)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/util/nsMsgKeySet.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgKeySet.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -704,17 +704,18 @@ nsMsgKeySet::Add(int32_t number)</span>
<a href="#l11.4"></a><span id="l11.4">      avoiding massive duplication of code, simply insert a literal here and</span>
<a href="#l11.5"></a><span id="l11.5">      then run the optimizer.</span>
<a href="#l11.6"></a><span id="l11.6">      */</span>
<a href="#l11.7"></a><span id="l11.7">   int mid = (tail - head); </span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">   if (m_data_size &lt;= m_length + 1) {</span>
<a href="#l11.10"></a><span id="l11.10">     int endo = end - head;</span>
<a href="#l11.11"></a><span id="l11.11">     if (!Grow()) {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-      return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+      // out of memory</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+      return -1;</span>
<a href="#l11.15"></a><span id="l11.15">     }</span>
<a href="#l11.16"></a><span id="l11.16">     head = m_data;</span>
<a href="#l11.17"></a><span id="l11.17">     end = head + endo;</span>
<a href="#l11.18"></a><span id="l11.18">   }</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20">   if (tail == end) {</span>
<a href="#l11.21"></a><span id="l11.21">     /* at the end */</span>
<a href="#l11.22"></a><span id="l11.22">     /* Add a literal to the end. */</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineat">@@ -821,17 +822,19 @@ nsMsgKeySet::Remove(int32_t number)</span>
<a href="#l11.24"></a><span id="l11.24">         return 1;</span>
<a href="#l11.25"></a><span id="l11.25">       } else {</span>
<a href="#l11.26"></a><span id="l11.26">         /* The number being deleted is in the middle of a range which</span>
<a href="#l11.27"></a><span id="l11.27">            must be split. This increases overall length by 2.</span>
<a href="#l11.28"></a><span id="l11.28">            */</span>
<a href="#l11.29"></a><span id="l11.29">         int32_t i;</span>
<a href="#l11.30"></a><span id="l11.30">         int endo = end - head;</span>
<a href="#l11.31"></a><span id="l11.31">         if (m_data_size - m_length &lt;= 2) {</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-          if (!Grow()) return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+          if (!Grow())</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+            // out of memory</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+            return -1;</span>
<a href="#l11.36"></a><span id="l11.36">         }</span>
<a href="#l11.37"></a><span id="l11.37">         head = m_data;</span>
<a href="#l11.38"></a><span id="l11.38">         end = head + endo;</span>
<a href="#l11.39"></a><span id="l11.39"> </span>
<a href="#l11.40"></a><span id="l11.40">         for (i = m_length + 2; i &gt; mid + 2; i--) {</span>
<a href="#l11.41"></a><span id="l11.41">           m_data[i] = m_data[i-2];</span>
<a href="#l11.42"></a><span id="l11.42">         }</span>
<a href="#l11.43"></a><span id="l11.43"> </span>
<a href="#l11.44"></a><span id="l11.44" class="difflineat">@@ -921,17 +924,19 @@ nsMsgKeySet::AddRange(int32_t start, int</span>
<a href="#l11.45"></a><span id="l11.45"> </span>
<a href="#l11.46"></a><span id="l11.46">   if (start == end) {</span>
<a href="#l11.47"></a><span id="l11.47">     return Add(start);</span>
<a href="#l11.48"></a><span id="l11.48">   }</span>
<a href="#l11.49"></a><span id="l11.49"> </span>
<a href="#l11.50"></a><span id="l11.50">   tmplength = m_length + 2;</span>
<a href="#l11.51"></a><span id="l11.51">   tmp = (int32_t*) PR_Malloc(sizeof(int32_t) * tmplength);</span>
<a href="#l11.52"></a><span id="l11.52"> </span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-  if (!tmp) return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+  if (!tmp)</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+    // out of memory</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+    return -1;</span>
<a href="#l11.57"></a><span id="l11.57"> </span>
<a href="#l11.58"></a><span id="l11.58">   in = m_data;</span>
<a href="#l11.59"></a><span id="l11.59">   out = tmp;</span>
<a href="#l11.60"></a><span id="l11.60">   tail = in + m_length;</span>
<a href="#l11.61"></a><span id="l11.61"> </span>
<a href="#l11.62"></a><span id="l11.62"> #define EMIT(x, y) out = msg_emit_range(out, x, y)</span>
<a href="#l11.63"></a><span id="l11.63"> </span>
<a href="#l11.64"></a><span id="l11.64">   while (in &lt; tail) {</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineat">@@ -1347,17 +1352,17 @@ nsMsgKeySet::test_adder (void)</span>
<a href="#l11.66"></a><span id="l11.66">   printf (&quot;%3lu: %s\n\n&quot;, (unsigned long)set-&gt;m_length, s); \</span>
<a href="#l11.67"></a><span id="l11.67">   nsMemory::Free(s);                      \</span>
<a href="#l11.68"></a><span id="l11.68">   delete set;</span>
<a href="#l11.69"></a><span id="l11.69"> </span>
<a href="#l11.70"></a><span id="l11.70"> </span>
<a href="#l11.71"></a><span id="l11.71"> void</span>
<a href="#l11.72"></a><span id="l11.72"> nsMsgKeySet::test_ranges(void)</span>
<a href="#l11.73"></a><span id="l11.73"> {</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineminus">-  char *string;</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+  const char *string;</span>
<a href="#l11.76"></a><span id="l11.76">   nsMsgKeySet *set;</span>
<a href="#l11.77"></a><span id="l11.77">   char *s;</span>
<a href="#l11.78"></a><span id="l11.78">   int32_t i;</span>
<a href="#l11.79"></a><span id="l11.79">   int32_t j;</span>
<a href="#l11.80"></a><span id="l11.80"> </span>
<a href="#l11.81"></a><span id="l11.81">   START(&quot;20-40,72-99,105,107,110-111,117-200&quot;);</span>
<a href="#l11.82"></a><span id="l11.82"> </span>
<a href="#l11.83"></a><span id="l11.83">   FROB(205, 208);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/util/nsMsgLineBuffer.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgLineBuffer.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -90,17 +90,17 @@ nsresult nsMsgLineBuffer::BufferInput(co</span>
<a href="#l12.4"></a><span id="l12.4">     nsresult status = NS_OK;</span>
<a href="#l12.5"></a><span id="l12.5">     if (m_bufferPos &gt; 0 &amp;&amp; m_buffer &amp;&amp; m_buffer[m_bufferPos - 1] == '\r' &amp;&amp;</span>
<a href="#l12.6"></a><span id="l12.6">         net_buffer_size &gt; 0 &amp;&amp; net_buffer[0] != '\n') {</span>
<a href="#l12.7"></a><span id="l12.7">         /* The last buffer ended with a CR.  The new buffer does not start</span>
<a href="#l12.8"></a><span id="l12.8">            with a LF.  This old buffer should be shipped out and discarded. */</span>
<a href="#l12.9"></a><span id="l12.9">         PR_ASSERT(m_bufferSize &gt; m_bufferPos);</span>
<a href="#l12.10"></a><span id="l12.10">         if (m_bufferSize &lt;= m_bufferPos)</span>
<a href="#l12.11"></a><span id="l12.11">           return NS_ERROR_UNEXPECTED;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-        if (ConvertAndSendBuffer() == -1)</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+        if (NS_FAILED(ConvertAndSendBuffer()))</span>
<a href="#l12.14"></a><span id="l12.14">            return NS_ERROR_FAILURE;</span>
<a href="#l12.15"></a><span id="l12.15">         m_bufferPos = 0;</span>
<a href="#l12.16"></a><span id="l12.16">     }</span>
<a href="#l12.17"></a><span id="l12.17">     while (net_buffer_size &gt; 0)</span>
<a href="#l12.18"></a><span id="l12.18">     {</span>
<a href="#l12.19"></a><span id="l12.19">         const char *net_buffer_end = net_buffer + net_buffer_size;</span>
<a href="#l12.20"></a><span id="l12.20">         const char *newline = 0;</span>
<a href="#l12.21"></a><span id="l12.21">         const char *s;</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -162,50 +162,50 @@ nsresult nsMsgLineBuffer::BufferInput(co</span>
<a href="#l12.23"></a><span id="l12.23">            a line as we have read so far.</span>
<a href="#l12.24"></a><span id="l12.24">            </span>
<a href="#l12.25"></a><span id="l12.25">            If we have a line, process it, and then remove it from `m_buffer'.</span>
<a href="#l12.26"></a><span id="l12.26">            Then go around the loop again, until we drain the incoming data.</span>
<a href="#l12.27"></a><span id="l12.27">            */</span>
<a href="#l12.28"></a><span id="l12.28">         if (!newline)</span>
<a href="#l12.29"></a><span id="l12.29">             return NS_OK;</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-        if (ConvertAndSendBuffer() == -1)</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+        if (NS_FAILED(ConvertAndSendBuffer()))</span>
<a href="#l12.33"></a><span id="l12.33">           return NS_ERROR_FAILURE;</span>
<a href="#l12.34"></a><span id="l12.34">         </span>
<a href="#l12.35"></a><span id="l12.35">         net_buffer_size -= (newline - net_buffer);</span>
<a href="#l12.36"></a><span id="l12.36">         net_buffer = newline;</span>
<a href="#l12.37"></a><span id="l12.37">         m_bufferPos = 0;</span>
<a href="#l12.38"></a><span id="l12.38">     }</span>
<a href="#l12.39"></a><span id="l12.39">     return NS_OK;</span>
<a href="#l12.40"></a><span id="l12.40"> }</span>
<a href="#l12.41"></a><span id="l12.41"> </span>
<a href="#l12.42"></a><span id="l12.42"> nsresult nsMsgLineBuffer::HandleLine(char *line, uint32_t line_length)</span>
<a href="#l12.43"></a><span id="l12.43"> {</span>
<a href="#l12.44"></a><span id="l12.44">   NS_ASSERTION(false, &quot;must override this method if you don't provide a handler&quot;);</span>
<a href="#l12.45"></a><span id="l12.45">   return NS_OK;</span>
<a href="#l12.46"></a><span id="l12.46"> }</span>
<a href="#l12.47"></a><span id="l12.47"> </span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-int32_t nsMsgLineBuffer::ConvertAndSendBuffer()</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+nsresult nsMsgLineBuffer::ConvertAndSendBuffer()</span>
<a href="#l12.50"></a><span id="l12.50"> {</span>
<a href="#l12.51"></a><span id="l12.51">     /* Convert the line terminator to the native form.</span>
<a href="#l12.52"></a><span id="l12.52">      */</span>
<a href="#l12.53"></a><span id="l12.53"> </span>
<a href="#l12.54"></a><span id="l12.54">     char *buf = m_buffer;</span>
<a href="#l12.55"></a><span id="l12.55">     int32_t length = m_bufferPos;</span>
<a href="#l12.56"></a><span id="l12.56"> </span>
<a href="#l12.57"></a><span id="l12.57">     char* newline;</span>
<a href="#l12.58"></a><span id="l12.58">     </span>
<a href="#l12.59"></a><span id="l12.59">     PR_ASSERT(buf &amp;&amp; length &gt; 0);</span>
<a href="#l12.60"></a><span id="l12.60">     if (!buf || length &lt;= 0) </span>
<a href="#l12.61"></a><span id="l12.61" class="difflineminus">-        return -1;</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+        return NS_ERROR_FAILURE;</span>
<a href="#l12.63"></a><span id="l12.63">     newline = buf + length;</span>
<a href="#l12.64"></a><span id="l12.64">     </span>
<a href="#l12.65"></a><span id="l12.65">     PR_ASSERT(newline[-1] == '\r' || newline[-1] == '\n');</span>
<a href="#l12.66"></a><span id="l12.66">     if (newline[-1] != '\r' &amp;&amp; newline[-1] != '\n')</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-        return -1;</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+        return NS_ERROR_FAILURE;</span>
<a href="#l12.69"></a><span id="l12.69">     </span>
<a href="#l12.70"></a><span id="l12.70">     if (m_convertNewlinesP)</span>
<a href="#l12.71"></a><span id="l12.71">     {</span>
<a href="#l12.72"></a><span id="l12.72"> #if (MSG_LINEBREAK_LEN == 1)</span>
<a href="#l12.73"></a><span id="l12.73">       if ((newline - buf) &gt;= 2 &amp;&amp;</span>
<a href="#l12.74"></a><span id="l12.74">            newline[-2] == '\r' &amp;&amp;</span>
<a href="#l12.75"></a><span id="l12.75">            newline[-1] == '\n')</span>
<a href="#l12.76"></a><span id="l12.76">       {</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineat">@@ -229,24 +229,24 @@ int32_t nsMsgLineBuffer::ConvertAndSendB</span>
<a href="#l12.78"></a><span id="l12.78">         buf[length - 1] = MSG_LINEBREAK[1];</span>
<a href="#l12.79"></a><span id="l12.79">       }</span>
<a href="#l12.80"></a><span id="l12.80"> #endif</span>
<a href="#l12.81"></a><span id="l12.81">     }    </span>
<a href="#l12.82"></a><span id="l12.82">     return (m_handler) ? m_handler-&gt;HandleLine(buf, length) : HandleLine(buf, length);</span>
<a href="#l12.83"></a><span id="l12.83"> }</span>
<a href="#l12.84"></a><span id="l12.84"> </span>
<a href="#l12.85"></a><span id="l12.85"> // If there's still some data (non CRLF terminated) flush it out</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-int32_t nsMsgLineBuffer::FlushLastLine()</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineplus">+nsresult nsMsgLineBuffer::FlushLastLine()</span>
<a href="#l12.88"></a><span id="l12.88"> {</span>
<a href="#l12.89"></a><span id="l12.89">   char *buf = m_buffer + m_bufferPos;</span>
<a href="#l12.90"></a><span id="l12.90">   int32_t length = m_bufferPos - 1;</span>
<a href="#l12.91"></a><span id="l12.91">   if (length &gt; 0)</span>
<a href="#l12.92"></a><span id="l12.92">     return (m_handler) ? m_handler-&gt;HandleLine(buf, length) : HandleLine(buf, length);</span>
<a href="#l12.93"></a><span id="l12.93">   else</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-    return 0;</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineplus">+    return NS_OK;</span>
<a href="#l12.96"></a><span id="l12.96"> }</span>
<a href="#l12.97"></a><span id="l12.97"> </span>
<a href="#l12.98"></a><span id="l12.98"> ///////////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l12.99"></a><span id="l12.99"> // This is a utility class used to efficiently extract lines from an input stream by buffering</span>
<a href="#l12.100"></a><span id="l12.100"> // read but unprocessed stream data in a buffer. </span>
<a href="#l12.101"></a><span id="l12.101"> ///////////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l12.102"></a><span id="l12.102"> </span>
<a href="#l12.103"></a><span id="l12.103"> nsMsgLineStreamBuffer::nsMsgLineStreamBuffer(uint32_t aBufferSize, bool aAllocateNewLines, bool aEatCRLFs, char aLineToken) </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/util/nsMsgLineBuffer.h</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgLineBuffer.h</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -43,21 +43,21 @@ public:</span>
<a href="#l13.4"></a><span id="l13.4">   </span>
<a href="#l13.5"></a><span id="l13.5">   virtual    ~nsMsgLineBuffer();</span>
<a href="#l13.6"></a><span id="l13.6">   nsresult    BufferInput(const char *net_buffer, int32_t net_buffer_size);</span>
<a href="#l13.7"></a><span id="l13.7">   // Not sure why anyone cares, by NNTPHost seems to want to know the buf pos.</span>
<a href="#l13.8"></a><span id="l13.8">   uint32_t    GetBufferPos() {return m_bufferPos;}</span>
<a href="#l13.9"></a><span id="l13.9">   </span>
<a href="#l13.10"></a><span id="l13.10">   virtual nsresult HandleLine(char *line, uint32_t line_length);</span>
<a href="#l13.11"></a><span id="l13.11">   // flush last line, though it won't be CRLF terminated.</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  virtual int32_t FlushLastLine();</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  virtual nsresult FlushLastLine();</span>
<a href="#l13.14"></a><span id="l13.14"> protected:</span>
<a href="#l13.15"></a><span id="l13.15">   nsMsgLineBuffer(bool convertNewlinesP);</span>
<a href="#l13.16"></a><span id="l13.16">   </span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-  int32_t ConvertAndSendBuffer();</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+  nsresult ConvertAndSendBuffer();</span>
<a href="#l13.19"></a><span id="l13.19">   void SetLookingForCRLF(bool b);</span>
<a href="#l13.20"></a><span id="l13.20">   </span>
<a href="#l13.21"></a><span id="l13.21">   nsMsgLineBufferHandler *m_handler;</span>
<a href="#l13.22"></a><span id="l13.22">   bool        m_convertNewlinesP;</span>
<a href="#l13.23"></a><span id="l13.23">   bool        m_lookingForCRLF; </span>
<a href="#l13.24"></a><span id="l13.24"> };</span>
<a href="#l13.25"></a><span id="l13.25"> </span>
<a href="#l13.26"></a><span id="l13.26"> // I'm adding this utility class here for lack of a better place. This utility class is similar to nsMsgLineBuffer</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -742,18 +742,18 @@ nsMsgProtocol::SetNotificationCallbacks(</span>
<a href="#l14.4"></a><span id="l14.4"> NS_IMETHODIMP</span>
<a href="#l14.5"></a><span id="l14.5"> nsMsgProtocol::OnTransportStatus(nsITransport *transport, nsresult status,</span>
<a href="#l14.6"></a><span id="l14.6">                                  uint64_t progress, uint64_t progressMax)</span>
<a href="#l14.7"></a><span id="l14.7"> {</span>
<a href="#l14.8"></a><span id="l14.8">   if ((mLoadFlags &amp; LOAD_BACKGROUND) || !m_url)</span>
<a href="#l14.9"></a><span id="l14.9">     return NS_OK;</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11">   // these transport events should not generate any status messages</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  if (status == nsISocketTransport::STATUS_RECEIVING_FROM ||</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-      status == nsISocketTransport::STATUS_SENDING_TO)</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+  if (status == NS_NET_STATUS_RECEIVING_FROM ||</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+      status == NS_NET_STATUS_SENDING_TO)</span>
<a href="#l14.16"></a><span id="l14.16">     return NS_OK;</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18">   if (!mProgressEventSink)</span>
<a href="#l14.19"></a><span id="l14.19">   {</span>
<a href="#l14.20"></a><span id="l14.20">     NS_QueryNotificationCallbacks(mCallbacks, m_loadGroup, mProgressEventSink);</span>
<a href="#l14.21"></a><span id="l14.21">     if (!mProgressEventSink)</span>
<a href="#l14.22"></a><span id="l14.22">       return NS_OK;</span>
<a href="#l14.23"></a><span id="l14.23">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsDBFolderInfo.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsDBFolderInfo.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -931,20 +931,20 @@ NS_IMETHODIMP nsDBFolderInfo::GetTransfe</span>
<a href="#l15.4"></a><span id="l15.4">   mdbYarn cellName = { columnName, 0, sizeof(columnName), 0, 0, nullptr };</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6">   NS_ASSERTION(m_mdbRow, &quot;null row in getTransferInfo&quot;);</span>
<a href="#l15.7"></a><span id="l15.7">   m_mdbRow-&gt;GetCount(m_mdb-&gt;GetEnv(), &amp;numCells);</span>
<a href="#l15.8"></a><span id="l15.8">   // iterate over the cells in the dbfolderinfo remembering attribute names and values.</span>
<a href="#l15.9"></a><span id="l15.9">   for (mdb_count cellIndex = 0; cellIndex &lt; numCells; cellIndex++)</span>
<a href="#l15.10"></a><span id="l15.10">   {</span>
<a href="#l15.11"></a><span id="l15.11">     mdb_err err = m_mdbRow-&gt;SeekCellYarn(m_mdb-&gt;GetEnv(), cellIndex, &amp;cellColumn, nullptr);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    if (!err)</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+    if (NS_SUCCEEDED(err))</span>
<a href="#l15.14"></a><span id="l15.14">     {</span>
<a href="#l15.15"></a><span id="l15.15">       err = m_mdbRow-&gt;AliasCellYarn(m_mdb-&gt;GetEnv(), cellColumn, &amp;cellYarn);</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-      if (!err)</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+      if (NS_SUCCEEDED(err))</span>
<a href="#l15.18"></a><span id="l15.18">       {</span>
<a href="#l15.19"></a><span id="l15.19">         m_mdb-&gt;GetStore()-&gt;TokenToString(m_mdb-&gt;GetEnv(), cellColumn, &amp;cellName);</span>
<a href="#l15.20"></a><span id="l15.20">         newInfo-&gt;m_values.AppendElement(Substring((const char *)cellYarn.mYarn_Buf,</span>
<a href="#l15.21"></a><span id="l15.21">                                         (const char *) cellYarn.mYarn_Buf + cellYarn.mYarn_Fill));</span>
<a href="#l15.22"></a><span id="l15.22">         newInfo-&gt;m_properties.AppendElement(Substring((const char *) cellName.mYarn_Buf,</span>
<a href="#l15.23"></a><span id="l15.23">                                             (const char *) cellName.mYarn_Buf + cellName.mYarn_Fill));</span>
<a href="#l15.24"></a><span id="l15.24">       }</span>
<a href="#l15.25"></a><span id="l15.25">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsImapMailDatabase.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsImapMailDatabase.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -139,20 +139,20 @@ NS_IMETHODIMP nsImapMailDatabase::Update</span>
<a href="#l16.4"></a><span id="l16.4">       aNewHdr-&gt;GetFlags(&amp;existingFlags);</span>
<a href="#l16.5"></a><span id="l16.5">       // iterate over the cells in the pending hdr setting properties on the aNewHdr.</span>
<a href="#l16.6"></a><span id="l16.6">       // we skip cell 0, which is the messageId;</span>
<a href="#l16.7"></a><span id="l16.7">       nsMsgHdr* msgHdr = static_cast&lt;nsMsgHdr*&gt;(aNewHdr);      // closed system, cast ok</span>
<a href="#l16.8"></a><span id="l16.8">       nsIMdbRow *row = msgHdr-&gt;GetMDBRow();</span>
<a href="#l16.9"></a><span id="l16.9">       for (mdb_count cellIndex = 1; cellIndex &lt; numCells; cellIndex++)</span>
<a href="#l16.10"></a><span id="l16.10">       {</span>
<a href="#l16.11"></a><span id="l16.11">         mdb_err err = pendingRow-&gt;SeekCellYarn(GetEnv(), cellIndex, &amp;cellColumn, nullptr);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        if (err == 0)</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+        if (NS_SUCCEEDED(err))</span>
<a href="#l16.14"></a><span id="l16.14">         {</span>
<a href="#l16.15"></a><span id="l16.15">           err = pendingRow-&gt;AliasCellYarn(GetEnv(), cellColumn, &amp;cellYarn);</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-          if (err == 0)</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+          if (NS_SUCCEEDED(err))</span>
<a href="#l16.18"></a><span id="l16.18">           {</span>
<a href="#l16.19"></a><span id="l16.19">             if (row)</span>
<a href="#l16.20"></a><span id="l16.20">               row-&gt;AddColumn(GetEnv(), cellColumn, &amp;cellYarn);</span>
<a href="#l16.21"></a><span id="l16.21">           }</span>
<a href="#l16.22"></a><span id="l16.22">         }</span>
<a href="#l16.23"></a><span id="l16.23">       }</span>
<a href="#l16.24"></a><span id="l16.24">       // We might have changed some cached values, so force a refresh.</span>
<a href="#l16.25"></a><span id="l16.25">       msgHdr-&gt;ClearCachedValues();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMailDatabase.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMailDatabase.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -169,17 +169,17 @@ NS_IMETHODIMP nsMailDatabase::GetOffline</span>
<a href="#l17.4"></a><span id="l17.4">       {</span>
<a href="#l17.5"></a><span id="l17.5">         err  = m_mdbStore-&gt;NewRowWithOid(GetEnv(), &amp;rowObjectId, getter_AddRefs(offlineOpRow));</span>
<a href="#l17.6"></a><span id="l17.6">         NS_ENSURE_SUCCESS(err, err);</span>
<a href="#l17.7"></a><span id="l17.7">       }</span>
<a href="#l17.8"></a><span id="l17.8">       if (offlineOpRow &amp;&amp; !hasOid)</span>
<a href="#l17.9"></a><span id="l17.9">         m_mdbAllOfflineOpsTable-&gt;AddRow(GetEnv(), offlineOpRow);</span>
<a href="#l17.10"></a><span id="l17.10">     }</span>
<a href="#l17.11"></a><span id="l17.11">     </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    if (err == NS_OK &amp;&amp; offlineOpRow)</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    if (NS_SUCCEEDED(err) &amp;&amp; offlineOpRow)</span>
<a href="#l17.14"></a><span id="l17.14">     {</span>
<a href="#l17.15"></a><span id="l17.15">       *offlineOp = new nsMsgOfflineImapOperation(this, offlineOpRow);</span>
<a href="#l17.16"></a><span id="l17.16">       if (*offlineOp)</span>
<a href="#l17.17"></a><span id="l17.17">         (*offlineOp)-&gt;SetMessageKey(msgKey);</span>
<a href="#l17.18"></a><span id="l17.18">       NS_IF_ADDREF(*offlineOp);</span>
<a href="#l17.19"></a><span id="l17.19">     }</span>
<a href="#l17.20"></a><span id="l17.20">     if (!hasOid &amp;&amp; m_dbFolderInfo)</span>
<a href="#l17.21"></a><span id="l17.21">     {</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -192,18 +192,17 @@ NS_IMETHODIMP nsMailDatabase::GetOffline</span>
<a href="#l17.23"></a><span id="l17.23">         msgHdr-&gt;GetFlags(&amp;flags);</span>
<a href="#l17.24"></a><span id="l17.24">         (*offlineOp)-&gt;SetNewFlags(flags);</span>
<a href="#l17.25"></a><span id="l17.25">       }</span>
<a href="#l17.26"></a><span id="l17.26">       int32_t newFlags;</span>
<a href="#l17.27"></a><span id="l17.27">       m_dbFolderInfo-&gt;OrFlags(nsMsgFolderFlags::OfflineEvents, &amp;newFlags);</span>
<a href="#l17.28"></a><span id="l17.28">     }</span>
<a href="#l17.29"></a><span id="l17.29">   }</span>
<a href="#l17.30"></a><span id="l17.30">   </span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-  return (err == 0) ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+  return err;</span>
<a href="#l17.34"></a><span id="l17.34"> }</span>
<a href="#l17.35"></a><span id="l17.35"> </span>
<a href="#l17.36"></a><span id="l17.36"> NS_IMETHODIMP nsMailDatabase::EnumerateOfflineOps(nsISimpleEnumerator **enumerator)</span>
<a href="#l17.37"></a><span id="l17.37"> {</span>
<a href="#l17.38"></a><span id="l17.38">   NS_ASSERTION(false, &quot;not impl yet&quot;);</span>
<a href="#l17.39"></a><span id="l17.39">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l17.40"></a><span id="l17.40"> }</span>
<a href="#l17.41"></a><span id="l17.41"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -1257,17 +1257,17 @@ nsresult nsMsgDatabase::OpenMDB(const ch</span>
<a href="#l18.4"></a><span id="l18.4">         ret = mdbFactory-&gt;OpenOldFile(m_mdbEnv, dbHeap, dbName,</span>
<a href="#l18.5"></a><span id="l18.5">           dbFrozen, &amp;oldFile);</span>
<a href="#l18.6"></a><span id="l18.6">         if ( oldFile )</span>
<a href="#l18.7"></a><span id="l18.7">         {</span>
<a href="#l18.8"></a><span id="l18.8">           if ( ret == NS_OK )</span>
<a href="#l18.9"></a><span id="l18.9">           {</span>
<a href="#l18.10"></a><span id="l18.10">             ret = mdbFactory-&gt;CanOpenFilePort(m_mdbEnv, oldFile, // the file to investigate</span>
<a href="#l18.11"></a><span id="l18.11">               &amp;canOpen, &amp;outFormatVersion);</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-            if (ret == 0 &amp;&amp; canOpen)</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+            if (NS_SUCCEEDED(ret) &amp;&amp; canOpen)</span>
<a href="#l18.14"></a><span id="l18.14">             {</span>
<a href="#l18.15"></a><span id="l18.15">               inOpenPolicy.mOpenPolicy_ScopePlan.mScopeStringSet_Count = 0;</span>
<a href="#l18.16"></a><span id="l18.16">               inOpenPolicy.mOpenPolicy_MinMemory = 0;</span>
<a href="#l18.17"></a><span id="l18.17">               inOpenPolicy.mOpenPolicy_MaxLazy = 0;</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19">               ret = mdbFactory-&gt;OpenFileStore(m_mdbEnv, dbHeap,</span>
<a href="#l18.20"></a><span id="l18.20">                 oldFile, &amp;inOpenPolicy, getter_AddRefs(m_thumb));</span>
<a href="#l18.21"></a><span id="l18.21">             }</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -1281,29 +1281,29 @@ nsresult nsMsgDatabase::OpenMDB(const ch</span>
<a href="#l18.23"></a><span id="l18.23">       {</span>
<a href="#l18.24"></a><span id="l18.24">         mdb_count outTotal;    // total somethings to do in operation</span>
<a href="#l18.25"></a><span id="l18.25">         mdb_count outCurrent;  // subportion of total completed so far</span>
<a href="#l18.26"></a><span id="l18.26">         mdb_bool outDone = false;      // is operation finished?</span>
<a href="#l18.27"></a><span id="l18.27">         mdb_bool outBroken;     // is operation irreparably dead and broken?</span>
<a href="#l18.28"></a><span id="l18.28">         do</span>
<a href="#l18.29"></a><span id="l18.29">         {</span>
<a href="#l18.30"></a><span id="l18.30">           ret = m_thumb-&gt;DoMore(m_mdbEnv, &amp;outTotal, &amp;outCurrent, &amp;outDone, &amp;outBroken);</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-          if (ret != 0)</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+          if (NS_FAILED(ret))</span>
<a href="#l18.33"></a><span id="l18.33">           {// mork isn't really doing NS errors yet.</span>
<a href="#l18.34"></a><span id="l18.34">             outDone = true;</span>
<a href="#l18.35"></a><span id="l18.35">             break;</span>
<a href="#l18.36"></a><span id="l18.36">           }</span>
<a href="#l18.37"></a><span id="l18.37">         }</span>
<a href="#l18.38"></a><span id="l18.38">         while (NS_SUCCEEDED(ret) &amp;&amp; !outBroken &amp;&amp; !outDone);</span>
<a href="#l18.39"></a><span id="l18.39">         //        m_mdbEnv-&gt;ClearErrors(); // ### temporary...</span>
<a href="#l18.40"></a><span id="l18.40">         // only 0 is a non-error return.</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">-        if (ret == 0 &amp;&amp; outDone)</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineplus">+        if (NS_SUCCEEDED(ret) &amp;&amp; outDone)</span>
<a href="#l18.43"></a><span id="l18.43">         {</span>
<a href="#l18.44"></a><span id="l18.44">           ret = mdbFactory-&gt;ThumbToOpenStore(m_mdbEnv, m_thumb, &amp;m_mdbStore);</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineminus">-          if (ret == NS_OK)</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineplus">+          if (NS_SUCCEEDED(ret))</span>
<a href="#l18.47"></a><span id="l18.47">             ret = (m_mdbStore) ? InitExistingDB() : NS_ERROR_FAILURE;</span>
<a href="#l18.48"></a><span id="l18.48">         }</span>
<a href="#l18.49"></a><span id="l18.49"> #ifdef DEBUG_bienvenu1</span>
<a href="#l18.50"></a><span id="l18.50">         DumpContents();</span>
<a href="#l18.51"></a><span id="l18.51"> #endif</span>
<a href="#l18.52"></a><span id="l18.52">         m_thumb = nullptr;</span>
<a href="#l18.53"></a><span id="l18.53">       }</span>
<a href="#l18.54"></a><span id="l18.54">       else if (create)  // ### need error code saying why open file store failed</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1073,17 +1073,17 @@ make_multipart_signed_header_string(bool</span>
<a href="#l19.4"></a><span id="l19.4">    it's used to write the encoded representation of the signature.  The only</span>
<a href="#l19.5"></a><span id="l19.5">    difference is which MimeEncoderData object is used.</span>
<a href="#l19.6"></a><span id="l19.6">  */</span>
<a href="#l19.7"></a><span id="l19.7"> static void</span>
<a href="#l19.8"></a><span id="l19.8"> mime_crypto_write_base64 (void *closure, const char *buf, unsigned long size)</span>
<a href="#l19.9"></a><span id="l19.9"> {</span>
<a href="#l19.10"></a><span id="l19.10">   MimeEncoderData *data = (MimeEncoderData *) closure;</span>
<a href="#l19.11"></a><span id="l19.11">   nsresult rv = MIME_EncoderWrite (data, buf, size);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  PR_SetError(NS_FAILED(rv) ? rv : 0, 0);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+  PR_SetError(NS_FAILED(rv) ? static_cast&lt;uint32_t&gt;(rv) : 0, 0);</span>
<a href="#l19.14"></a><span id="l19.14"> }</span>
<a href="#l19.15"></a><span id="l19.15"> </span>
<a href="#l19.16"></a><span id="l19.16"> </span>
<a href="#l19.17"></a><span id="l19.17"> /* Used as the output function of MimeEncoderData -- when we have generated</span>
<a href="#l19.18"></a><span id="l19.18">    the signature for a multipart/signed object, this is used to write the</span>
<a href="#l19.19"></a><span id="l19.19">    base64-encoded representation of the signature to the file.</span>
<a href="#l19.20"></a><span id="l19.20">  */</span>
<a href="#l19.21"></a><span id="l19.21"> int mime_encoder_output_fn(const char *buf, int32_t size, void *closure)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -5018,17 +5018,17 @@ nsresult nsImapMailFolder::GetTrashFolde</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5"> </span>
<a href="#l20.6"></a><span id="l20.6"> // store nsMsgMessageFlags::IMAPDeleted in the specified mailhdr records</span>
<a href="#l20.7"></a><span id="l20.7"> void nsImapMailFolder::SetIMAPDeletedFlag(nsIMsgDatabase *mailDB, const nsTArray&lt;nsMsgKey&gt; &amp;msgids, bool markDeleted)</span>
<a href="#l20.8"></a><span id="l20.8"> {</span>
<a href="#l20.9"></a><span id="l20.9">   nsresult markStatus = NS_OK;</span>
<a href="#l20.10"></a><span id="l20.10">   uint32_t total = msgids.Length();</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  for (uint32_t msgIndex=0; !markStatus &amp;&amp; (msgIndex &lt; total); msgIndex++)</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  for (uint32_t msgIndex=0; NS_SUCCEEDED(markStatus) &amp;&amp; (msgIndex &lt; total); msgIndex++)</span>
<a href="#l20.14"></a><span id="l20.14">     markStatus = mailDB-&gt;MarkImapDeleted(msgids[msgIndex], markDeleted, nullptr);</span>
<a href="#l20.15"></a><span id="l20.15"> }</span>
<a href="#l20.16"></a><span id="l20.16"> </span>
<a href="#l20.17"></a><span id="l20.17"> NS_IMETHODIMP</span>
<a href="#l20.18"></a><span id="l20.18"> nsImapMailFolder::GetMessageSizeFromDB(const char * id, uint32_t *size)</span>
<a href="#l20.19"></a><span id="l20.19"> {</span>
<a href="#l20.20"></a><span id="l20.20">   NS_ENSURE_ARG_POINTER(size);</span>
<a href="#l20.21"></a><span id="l20.21">   nsresult rv;</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -7140,17 +7140,17 @@ nsresult nsImapMailFolder::CopyMessagesO</span>
<a href="#l20.23"></a><span id="l20.23">       nsOfflineImapOperationType deleteOpType = nsIMsgOfflineImapOperation::kDeletedMsg;</span>
<a href="#l20.24"></a><span id="l20.24">       if (!deleteToTrash)</span>
<a href="#l20.25"></a><span id="l20.25">         deleteOpType = nsIMsgOfflineImapOperation::kMsgMarkedDeleted;</span>
<a href="#l20.26"></a><span id="l20.26">       srcFolder-&gt;GetOfflineStoreInputStream(getter_AddRefs(inputStream));</span>
<a href="#l20.27"></a><span id="l20.27">       nsCString messageIds;</span>
<a href="#l20.28"></a><span id="l20.28">       rv = BuildIdsAndKeyArray(messages, messageIds, srcKeyArray);</span>
<a href="#l20.29"></a><span id="l20.29">       // put fake message in destination db, delete source if move</span>
<a href="#l20.30"></a><span id="l20.30">       EnableNotifications(nsIMsgFolder::allMessageCountNotifications, false, false);</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-      for (uint32_t sourceKeyIndex = 0; !stopit &amp;&amp; (sourceKeyIndex &lt; srcCount); sourceKeyIndex++)</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+      for (uint32_t sourceKeyIndex = 0; NS_SUCCEEDED(stopit) &amp;&amp; (sourceKeyIndex &lt; srcCount); sourceKeyIndex++)</span>
<a href="#l20.33"></a><span id="l20.33">       {</span>
<a href="#l20.34"></a><span id="l20.34">         bool messageReturningHome = false;</span>
<a href="#l20.35"></a><span id="l20.35">         nsCString originalSrcFolderURI;</span>
<a href="#l20.36"></a><span id="l20.36">         srcFolder-&gt;GetURI(originalSrcFolderURI);</span>
<a href="#l20.37"></a><span id="l20.37">         nsCOMPtr&lt;nsIMsgDBHdr&gt; message;</span>
<a href="#l20.38"></a><span id="l20.38">         message = do_QueryElementAt(messages, sourceKeyIndex);</span>
<a href="#l20.39"></a><span id="l20.39">         nsMsgKey originalKey;</span>
<a href="#l20.40"></a><span id="l20.40">         if (message)</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineat">@@ -8766,17 +8766,17 @@ NS_IMETHODIMP nsImapMailFolder::RenameSu</span>
<a href="#l20.42"></a><span id="l20.42">   nsCOMPtr&lt;nsISimpleEnumerator&gt; enumerator;</span>
<a href="#l20.43"></a><span id="l20.43">   nsresult rv = oldFolder-&gt;GetSubFolders(getter_AddRefs(enumerator));</span>
<a href="#l20.44"></a><span id="l20.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.45"></a><span id="l20.45"> </span>
<a href="#l20.46"></a><span id="l20.46">   bool hasMore;</span>
<a href="#l20.47"></a><span id="l20.47">   while (NS_SUCCEEDED(enumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l20.48"></a><span id="l20.48">   {</span>
<a href="#l20.49"></a><span id="l20.49">     nsCOMPtr&lt;nsISupports&gt; item;</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-    if (enumerator-&gt;GetNext(getter_AddRefs(item)))</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+    if (NS_FAILED(enumerator-&gt;GetNext(getter_AddRefs(item))))</span>
<a href="#l20.52"></a><span id="l20.52">       continue;</span>
<a href="#l20.53"></a><span id="l20.53"> </span>
<a href="#l20.54"></a><span id="l20.54">     nsCOMPtr&lt;nsIMsgFolder&gt; msgFolder(do_QueryInterface(item, &amp;rv));</span>
<a href="#l20.55"></a><span id="l20.55">     if (NS_FAILED(rv))</span>
<a href="#l20.56"></a><span id="l20.56">       return rv;</span>
<a href="#l20.57"></a><span id="l20.57"> </span>
<a href="#l20.58"></a><span id="l20.58">     nsCOMPtr&lt;nsIMsgImapMailFolder&gt; folder(do_QueryInterface(msgFolder, &amp;rv));</span>
<a href="#l20.59"></a><span id="l20.59">     if (NS_FAILED(rv))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/imap/src/nsImapOfflineSync.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapOfflineSync.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -771,17 +771,17 @@ nsresult nsImapOfflineSync::ProcessNextO</span>
<a href="#l21.4"></a><span id="l21.4">       if (m_currentDB)</span>
<a href="#l21.5"></a><span id="l21.5">         m_currentDB-&gt;AddListener(this);</span>
<a href="#l21.6"></a><span id="l21.6">     }</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8">     if (m_currentDB)</span>
<a href="#l21.9"></a><span id="l21.9">     {</span>
<a href="#l21.10"></a><span id="l21.10">       m_CurrentKeys.Clear();</span>
<a href="#l21.11"></a><span id="l21.11">       m_KeyIndex = 0;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-      if ((m_currentDB-&gt;ListAllOfflineOpIds(&amp;m_CurrentKeys) != 0) || m_CurrentKeys.IsEmpty())</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+      if (NS_FAILED(m_currentDB-&gt;ListAllOfflineOpIds(&amp;m_CurrentKeys)) || m_CurrentKeys.IsEmpty())</span>
<a href="#l21.14"></a><span id="l21.14">       {</span>
<a href="#l21.15"></a><span id="l21.15">         ClearDB();</span>
<a href="#l21.16"></a><span id="l21.16">         folderInfo = nullptr; // can't hold onto folderInfo longer than db</span>
<a href="#l21.17"></a><span id="l21.17">         m_currentFolder-&gt;ClearFlag(nsMsgFolderFlags::OfflineEvents);</span>
<a href="#l21.18"></a><span id="l21.18">       }</span>
<a href="#l21.19"></a><span id="l21.19">       else</span>
<a href="#l21.20"></a><span id="l21.20">       {</span>
<a href="#l21.21"></a><span id="l21.21">         // trash any ghost msgs</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineat">@@ -824,17 +824,17 @@ nsresult nsImapOfflineSync::ProcessNextO</span>
<a href="#l21.23"></a><span id="l21.23">             }</span>
<a href="#l21.24"></a><span id="l21.24">           }</span>
<a href="#l21.25"></a><span id="l21.25">         }</span>
<a href="#l21.26"></a><span id="l21.26">         </span>
<a href="#l21.27"></a><span id="l21.27">         if (deletedGhostMsgs)</span>
<a href="#l21.28"></a><span id="l21.28">           m_currentFolder-&gt;SummaryChanged();</span>
<a href="#l21.29"></a><span id="l21.29">         </span>
<a href="#l21.30"></a><span id="l21.30">         m_CurrentKeys.Clear();</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-        if ( (m_currentDB-&gt;ListAllOfflineOpIds(&amp;m_CurrentKeys) != 0) || m_CurrentKeys.IsEmpty() )</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+        if (NS_FAILED(m_currentDB-&gt;ListAllOfflineOpIds(&amp;m_CurrentKeys)) || m_CurrentKeys.IsEmpty())</span>
<a href="#l21.33"></a><span id="l21.33">         {</span>
<a href="#l21.34"></a><span id="l21.34">           ClearDB();</span>
<a href="#l21.35"></a><span id="l21.35">           if (deletedGhostMsgs)</span>
<a href="#l21.36"></a><span id="l21.36">             deletedAllOfflineEventsInFolder = m_currentFolder;</span>
<a href="#l21.37"></a><span id="l21.37">         }</span>
<a href="#l21.38"></a><span id="l21.38">         else if (folderFlags &amp; nsMsgFolderFlags::ImapBox)</span>
<a href="#l21.39"></a><span id="l21.39">         {</span>
<a href="#l21.40"></a><span id="l21.40">           // if pseudo offline, falls through to playing ops back.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1640,17 +1640,17 @@ bool nsImapProtocol::ProcessCurrentURL()</span>
<a href="#l22.4"></a><span id="l22.4">                     CommitCapability();</span>
<a href="#l22.5"></a><span id="l22.5">                   }</span>
<a href="#l22.6"></a><span id="l22.6">                 }</span>
<a href="#l22.7"></a><span id="l22.7">               }</span>
<a href="#l22.8"></a><span id="l22.8">             }</span>
<a href="#l22.9"></a><span id="l22.9">             if (NS_FAILED(rv))</span>
<a href="#l22.10"></a><span id="l22.10">             {</span>
<a href="#l22.11"></a><span id="l22.11">               nsAutoCString logLine(&quot;STARTTLS negotiation failed. Error 0x&quot;);</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-              logLine.AppendInt(rv, 16);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+              logLine.AppendInt(static_cast&lt;uint32_t&gt;(rv), 16);</span>
<a href="#l22.14"></a><span id="l22.14">               Log(&quot;ProcessCurrentURL&quot;, nullptr, logLine.get());</span>
<a href="#l22.15"></a><span id="l22.15">               if (m_socketType == nsMsgSocketType::alwaysSTARTTLS)</span>
<a href="#l22.16"></a><span id="l22.16">               {</span>
<a href="#l22.17"></a><span id="l22.17">                 SetConnectionStatus(rv);        // stop netlib</span>
<a href="#l22.18"></a><span id="l22.18">                 m_transport-&gt;Close(rv);</span>
<a href="#l22.19"></a><span id="l22.19">               }</span>
<a href="#l22.20"></a><span id="l22.20">               else if (m_socketType == nsMsgSocketType::trySTARTTLS)</span>
<a href="#l22.21"></a><span id="l22.21">                 m_imapServerSink-&gt;UpdateTrySTARTTLSPref(false);</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineat">@@ -2282,21 +2282,20 @@ NS_IMETHODIMP nsImapProtocol::CanHandleU</span>
<a href="#l22.23"></a><span id="l22.23">               {</span>
<a href="#l22.24"></a><span id="l22.24">                 if (isBusy)</span>
<a href="#l22.25"></a><span id="l22.25">                   *hasToWait = true;</span>
<a href="#l22.26"></a><span id="l22.26">                 else</span>
<a href="#l22.27"></a><span id="l22.27">                   *aCanRunUrl = true;</span>
<a href="#l22.28"></a><span id="l22.28">               }</span>
<a href="#l22.29"></a><span id="l22.29">             }</span>
<a href="#l22.30"></a><span id="l22.30">           }</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-#ifdef DEBUG_bienvenu1</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">-          printf(&quot;proposed url = %s folder for connection %s has To Wait = %s can run = %s\n&quot;,</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineminus">-            folderNameForProposedUrl, curUrlFolderName.get(),</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineminus">-            (*hasToWait) ? &quot;TRUE&quot; : &quot;FALSE&quot;, (*aCanRunUrl) ? &quot;TRUE&quot; : &quot;FALSE&quot;);</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineminus">-#endif</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineplus">+          PR_LOG(IMAP, PR_LOG_DEBUG,</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+                 (&quot;proposed url = %s folder for connection %s has To Wait = %s can run = %s&quot;,</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+                  folderNameForProposedUrl, curSelectedUrlFolderName.get(),</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+                  (*hasToWait) ? &quot;TRUE&quot; : &quot;FALSE&quot;, (*aCanRunUrl) ? &quot;TRUE&quot; : &quot;FALSE&quot;));</span>
<a href="#l22.40"></a><span id="l22.40">           PR_FREEIF(folderNameForProposedUrl);</span>
<a href="#l22.41"></a><span id="l22.41">         }</span>
<a href="#l22.42"></a><span id="l22.42">       }</span>
<a href="#l22.43"></a><span id="l22.43">       else // *** jt - an authenticated state url can be run in either</span>
<a href="#l22.44"></a><span id="l22.44">         // authenticated or selected state</span>
<a href="#l22.45"></a><span id="l22.45">       {</span>
<a href="#l22.46"></a><span id="l22.46">         nsImapAction actionForRunningUrl;</span>
<a href="#l22.47"></a><span id="l22.47"> </span>
<a href="#l22.48"></a><span id="l22.48" class="difflineat">@@ -4515,33 +4514,33 @@ uint32_t nsImapProtocol::CountMessagesIn</span>
<a href="#l22.49"></a><span id="l22.49">   return numberOfMessages;</span>
<a href="#l22.50"></a><span id="l22.50"> }</span>
<a href="#l22.51"></a><span id="l22.51"> </span>
<a href="#l22.52"></a><span id="l22.52"> </span>
<a href="#l22.53"></a><span id="l22.53"> // It would be really nice not to have to use this method nearly as much as we did</span>
<a href="#l22.54"></a><span id="l22.54"> // in 4.5 - we need to think about this some. Some of it may just go away in the new world order</span>
<a href="#l22.55"></a><span id="l22.55"> bool nsImapProtocol::DeathSignalReceived()</span>
<a href="#l22.56"></a><span id="l22.56"> {</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineminus">-  nsresult returnValue = NS_OK;</span>
<a href="#l22.58"></a><span id="l22.58">   // ignore mock channel status if we've been pseudo interrupted</span>
<a href="#l22.59"></a><span id="l22.59">   // ### need to make sure we clear pseudo interrupted status appropriately.</span>
<a href="#l22.60"></a><span id="l22.60">   if (!GetPseudoInterrupted() &amp;&amp; m_mockChannel)</span>
<a href="#l22.61"></a><span id="l22.61">   {</span>
<a href="#l22.62"></a><span id="l22.62">     nsCOMPtr&lt;nsIRequest&gt; request = do_QueryInterface(m_mockChannel);</span>
<a href="#l22.63"></a><span id="l22.63">     if (request)</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineplus">+    {</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineplus">+      nsresult returnValue;</span>
<a href="#l22.66"></a><span id="l22.66">       request-&gt;GetStatus(&amp;returnValue);</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineminus">-  }</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineminus">-  if (NS_SUCCEEDED(returnValue)) // check the other way of cancelling.</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineminus">-  {</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineminus">-    ReentrantMonitorAutoEnter threadDeathMon(m_threadDeathMonitor);</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineminus">-    // XXX Casting bool to nsresult</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineminus">-    returnValue = static_cast&lt;nsresult&gt;(m_threadShouldDie);</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineminus">-  }</span>
<a href="#l22.74"></a><span id="l22.74" class="difflineminus">-  // XXX Casting nsresult to bool</span>
<a href="#l22.75"></a><span id="l22.75" class="difflineminus">-  return static_cast&lt;bool&gt;(returnValue);</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineplus">+      if (NS_FAILED(returnValue))</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineplus">+        return false;</span>
<a href="#l22.78"></a><span id="l22.78" class="difflineplus">+    }</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineplus">+  }</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineplus">+</span>
<a href="#l22.81"></a><span id="l22.81" class="difflineplus">+  // Check the other way of cancelling.</span>
<a href="#l22.82"></a><span id="l22.82" class="difflineplus">+  ReentrantMonitorAutoEnter threadDeathMon(m_threadDeathMonitor);</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineplus">+  return m_threadShouldDie;</span>
<a href="#l22.84"></a><span id="l22.84"> }</span>
<a href="#l22.85"></a><span id="l22.85"> </span>
<a href="#l22.86"></a><span id="l22.86"> NS_IMETHODIMP nsImapProtocol::ResetToAuthenticatedState()</span>
<a href="#l22.87"></a><span id="l22.87"> {</span>
<a href="#l22.88"></a><span id="l22.88">     GetServerStateParser().PreauthSetAuthenticatedState();</span>
<a href="#l22.89"></a><span id="l22.89">     return NS_OK;</span>
<a href="#l22.90"></a><span id="l22.90"> }</span>
<a href="#l22.91"></a><span id="l22.91"> </span>
<a href="#l22.92"></a><span id="l22.92" class="difflineat">@@ -4712,17 +4711,17 @@ char* nsImapProtocol::CreateNewLineFromS</span>
<a href="#l22.93"></a><span id="l22.93">             AlertUserEventUsingId(TestFlag(IMAP_RECEIVED_GREETING)</span>
<a href="#l22.94"></a><span id="l22.94">             ? IMAP_SERVER_DISCONNECTED : IMAP_SERVER_DROPPED_CONNECTION);</span>
<a href="#l22.95"></a><span id="l22.95">           break;</span>
<a href="#l22.96"></a><span id="l22.96">         default:</span>
<a href="#l22.97"></a><span id="l22.97">             break;</span>
<a href="#l22.98"></a><span id="l22.98">     }</span>
<a href="#l22.99"></a><span id="l22.99"> </span>
<a href="#l22.100"></a><span id="l22.100">     nsAutoCString logMsg(&quot;clearing IMAP_CONNECTION_IS_OPEN - rv = &quot;);</span>
<a href="#l22.101"></a><span id="l22.101" class="difflineminus">-    logMsg.AppendInt(rv, 16);</span>
<a href="#l22.102"></a><span id="l22.102" class="difflineplus">+    logMsg.AppendInt(static_cast&lt;uint32_t&gt;(rv), 16);</span>
<a href="#l22.103"></a><span id="l22.103">     Log(&quot;CreateNewLineFromSocket&quot;, nullptr, logMsg.get());</span>
<a href="#l22.104"></a><span id="l22.104">     ClearFlag(IMAP_CONNECTION_IS_OPEN);</span>
<a href="#l22.105"></a><span id="l22.105">     TellThreadToDie();</span>
<a href="#l22.106"></a><span id="l22.106">   }</span>
<a href="#l22.107"></a><span id="l22.107">   Log(&quot;CreateNewLineFromSocket&quot;, nullptr, newLine);</span>
<a href="#l22.108"></a><span id="l22.108">   SetConnectionStatus(newLine &amp;&amp; numBytesInLine ? NS_OK : rv); // set &gt; 0 if string is not null or empty</span>
<a href="#l22.109"></a><span id="l22.109">   return newLine;</span>
<a href="#l22.110"></a><span id="l22.110"> }</span>
<a href="#l22.111"></a><span id="l22.111" class="difflineat">@@ -9483,18 +9482,18 @@ nsImapMockChannel::SetNotificationCallba</span>
<a href="#l22.112"></a><span id="l22.112"> NS_IMETHODIMP</span>
<a href="#l22.113"></a><span id="l22.113"> nsImapMockChannel::OnTransportStatus(nsITransport *transport, nsresult status,</span>
<a href="#l22.114"></a><span id="l22.114">                                      uint64_t progress, uint64_t progressMax)</span>
<a href="#l22.115"></a><span id="l22.115"> {</span>
<a href="#l22.116"></a><span id="l22.116">   if (NS_FAILED(m_cancelStatus) || (mLoadFlags &amp; LOAD_BACKGROUND) || !m_url)</span>
<a href="#l22.117"></a><span id="l22.117">     return NS_OK;</span>
<a href="#l22.118"></a><span id="l22.118"> </span>
<a href="#l22.119"></a><span id="l22.119">   // these transport events should not generate any status messages</span>
<a href="#l22.120"></a><span id="l22.120" class="difflineminus">-  if (status == nsISocketTransport::STATUS_RECEIVING_FROM ||</span>
<a href="#l22.121"></a><span id="l22.121" class="difflineminus">-      status == nsISocketTransport::STATUS_SENDING_TO)</span>
<a href="#l22.122"></a><span id="l22.122" class="difflineplus">+  if (status == NS_NET_STATUS_RECEIVING_FROM ||</span>
<a href="#l22.123"></a><span id="l22.123" class="difflineplus">+      status == NS_NET_STATUS_SENDING_TO)</span>
<a href="#l22.124"></a><span id="l22.124">     return NS_OK;</span>
<a href="#l22.125"></a><span id="l22.125"> </span>
<a href="#l22.126"></a><span id="l22.126">   if (!mProgressEventSink)</span>
<a href="#l22.127"></a><span id="l22.127">   {</span>
<a href="#l22.128"></a><span id="l22.128">     NS_QueryNotificationCallbacks(mCallbacks, m_loadGroup, mProgressEventSink);</span>
<a href="#l22.129"></a><span id="l22.129">     if (!mProgressEventSink)</span>
<a href="#l22.130"></a><span id="l22.130">       return NS_OK;</span>
<a href="#l22.131"></a><span id="l22.131">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -155,17 +155,17 @@ bool nsEudoraFilters::RealImport()</span>
<a href="#l23.4"></a><span id="l23.4">   rv = LoadServers();</span>
<a href="#l23.5"></a><span id="l23.5">   if (NS_FAILED(rv))</span>
<a href="#l23.6"></a><span id="l23.6">   {</span>
<a href="#l23.7"></a><span id="l23.7">     IMPORT_LOG0(&quot;*** Error loading servers with filters\n&quot;);</span>
<a href="#l23.8"></a><span id="l23.8">     return false;</span>
<a href="#l23.9"></a><span id="l23.9">   }</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11">   nsCOMPtr&lt;nsILineInputStream&gt; lineStream(do_QueryInterface(inputStream, &amp;rv));</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l23.14"></a><span id="l23.14"> </span>
<a href="#l23.15"></a><span id="l23.15">   nsCString     line;</span>
<a href="#l23.16"></a><span id="l23.16">   bool          more = true;</span>
<a href="#l23.17"></a><span id="l23.17">   nsAutoCString header;</span>
<a href="#l23.18"></a><span id="l23.18">   nsAutoCString verb;</span>
<a href="#l23.19"></a><span id="l23.19">   nsAutoString  name;</span>
<a href="#l23.20"></a><span id="l23.20"> </span>
<a href="#l23.21"></a><span id="l23.21">   // Windows Eudora filters files have a version header as a first line - just skip it</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -127,17 +127,17 @@ bool nsEudoraMac::VerifyEudoraLocation(n</span>
<a href="#l24.4"></a><span id="l24.4"> {</span>
<a href="#l24.5"></a><span id="l24.5">   bool result = false;</span>
<a href="#l24.6"></a><span id="l24.6">   bool foundPref = false;</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9">   bool hasMore;</span>
<a href="#l24.10"></a><span id="l24.10">   nsCOMPtr&lt;nsISimpleEnumerator&gt; directoryEnumerator;</span>
<a href="#l24.11"></a><span id="l24.11">   nsresult rv = (*pFolder)-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l24.14"></a><span id="l24.14"> </span>
<a href="#l24.15"></a><span id="l24.15">   directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l24.16"></a><span id="l24.16">   nsCOMPtr &lt;nsIFile&gt; prefFile;</span>
<a href="#l24.17"></a><span id="l24.17"> </span>
<a href="#l24.18"></a><span id="l24.18">   int count = 0;</span>
<a href="#l24.19"></a><span id="l24.19">   OSType type, creator;</span>
<a href="#l24.20"></a><span id="l24.20">   while (hasMore &amp;&amp; NS_SUCCEEDED(rv) &amp;&amp; count &lt; 2)</span>
<a href="#l24.21"></a><span id="l24.21">   {</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -780,17 +780,17 @@ bool nsEudoraMac::BuildPOPAccount(nsIMsg</span>
<a href="#l24.23"></a><span id="l24.23">       rv = accMgr-&gt;CreateAccount(getter_AddRefs(account));</span>
<a href="#l24.24"></a><span id="l24.24">       if (NS_SUCCEEDED(rv) &amp;&amp; account)</span>
<a href="#l24.25"></a><span id="l24.25">       {</span>
<a href="#l24.26"></a><span id="l24.26">         rv = account-&gt;SetIncomingServer(in);</span>
<a href="#l24.27"></a><span id="l24.27"> </span>
<a href="#l24.28"></a><span id="l24.28">         IMPORT_LOG0(&quot;Created a new account and set the incoming server to the POP3 server.\n&quot;);</span>
<a href="#l24.29"></a><span id="l24.29"> </span>
<a href="#l24.30"></a><span id="l24.30">         nsCOMPtr&lt;nsIPop3IncomingServer&gt; pop3Server = do_QueryInterface(in, &amp;rv);</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-        NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+        NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l24.33"></a><span id="l24.33">         pop3Server-&gt;SetLeaveMessagesOnServer(pStrs[kLeaveOnServerStr]-&gt;First() == 'Y' ? true : false);</span>
<a href="#l24.34"></a><span id="l24.34"> </span>
<a href="#l24.35"></a><span id="l24.35">         // Fiddle with the identities</span>
<a href="#l24.36"></a><span id="l24.36">         SetIdentities(accMgr, account, pStrs[kPopAccountNameStr]-&gt;get(), pStrs[kPopServerStr]-&gt;get(), pStrs);</span>
<a href="#l24.37"></a><span id="l24.37">         result = true;</span>
<a href="#l24.38"></a><span id="l24.38">         if (ppAccount)</span>
<a href="#l24.39"></a><span id="l24.39">           account-&gt;QueryInterface(NS_GET_IID(nsIMsgAccount), (void **)ppAccount);</span>
<a href="#l24.40"></a><span id="l24.40">       }</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineat">@@ -915,18 +915,18 @@ void nsEudoraMac::SetSmtpServer(nsIMsgAc</span>
<a href="#l24.42"></a><span id="l24.42"> </span>
<a href="#l24.43"></a><span id="l24.43"> nsresult nsEudoraMac::GetAttachmentInfo(const char *pFileName, nsIFile *pFile, nsCString&amp; mimeType, nsCString&amp; aAttachment)</span>
<a href="#l24.44"></a><span id="l24.44"> {</span>
<a href="#l24.45"></a><span id="l24.45">   mimeType.Truncate();</span>
<a href="#l24.46"></a><span id="l24.46"> </span>
<a href="#l24.47"></a><span id="l24.47">   // Sample attachment line</span>
<a href="#l24.48"></a><span id="l24.48">   // Internet:sandh.jpg (JPEG/JVWR) (0003C2E8)</span>
<a href="#l24.49"></a><span id="l24.49"> </span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-  OSType    type = '????';</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineminus">-  OSType    creator = '????';</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineplus">+  OSType    type = '?\??\?';</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+  OSType    creator = '?\??\?';</span>
<a href="#l24.54"></a><span id="l24.54">   uint32_t  fNum = 0;</span>
<a href="#l24.55"></a><span id="l24.55">   int      i;</span>
<a href="#l24.56"></a><span id="l24.56">   PRUnichar  c;</span>
<a href="#l24.57"></a><span id="l24.57"> </span>
<a href="#l24.58"></a><span id="l24.58">   nsCString  str(pFileName);</span>
<a href="#l24.59"></a><span id="l24.59">   if (str.Length() &gt; 22)</span>
<a href="#l24.60"></a><span id="l24.60">   {</span>
<a href="#l24.61"></a><span id="l24.61">     // try and extract the mac file info from the attachment line</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -1405,17 +1405,17 @@ nsMsgLocalMailFolder::SortMessagesBasedO</span>
<a href="#l25.4"></a><span id="l25.4"> bool nsMsgLocalMailFolder::CheckIfSpaceForCopy(nsIMsgWindow *msgWindow,</span>
<a href="#l25.5"></a><span id="l25.5">                                                  nsIMsgFolder *srcFolder,</span>
<a href="#l25.6"></a><span id="l25.6">                                                  nsISupports *srcSupports,</span>
<a href="#l25.7"></a><span id="l25.7">                                                  bool isMove,</span>
<a href="#l25.8"></a><span id="l25.8">                                                  int64_t totalMsgSize)</span>
<a href="#l25.9"></a><span id="l25.9"> {</span>
<a href="#l25.10"></a><span id="l25.10">   nsCOMPtr&lt;nsIMsgPluggableStore&gt; msgStore;</span>
<a href="#l25.11"></a><span id="l25.11">   nsresult rv = GetMsgStore(getter_AddRefs(msgStore));</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l25.14"></a><span id="l25.14">   bool spaceAvailable;</span>
<a href="#l25.15"></a><span id="l25.15">   rv = msgStore-&gt;HasSpaceAvailable(this, totalMsgSize, &amp;spaceAvailable);</span>
<a href="#l25.16"></a><span id="l25.16">   if (!spaceAvailable)</span>
<a href="#l25.17"></a><span id="l25.17">   {</span>
<a href="#l25.18"></a><span id="l25.18">     ThrowAlertMsg(&quot;mailboxTooLarge&quot;, msgWindow);</span>
<a href="#l25.19"></a><span id="l25.19">     if (isMove &amp;&amp; srcFolder)</span>
<a href="#l25.20"></a><span id="l25.20">       srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l25.21"></a><span id="l25.21">     OnCopyCompleted(srcSupports, false);</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -3412,17 +3412,17 @@ nsMsgLocalMailFolder::OnMessageClassifie</span>
<a href="#l25.23"></a><span id="l25.23">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l25.24"></a><span id="l25.24"> </span>
<a href="#l25.25"></a><span id="l25.25">         rv = copySvc-&gt;CopyMessages(this, messages, folder, true,</span>
<a href="#l25.26"></a><span id="l25.26">           /*nsIMsgCopyServiceListener* listener*/ nullptr, nullptr, false /*allowUndo*/);</span>
<a href="#l25.27"></a><span id="l25.27">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;CopyMessages failed&quot;);</span>
<a href="#l25.28"></a><span id="l25.28">         if (NS_FAILED(rv))</span>
<a href="#l25.29"></a><span id="l25.29">         {</span>
<a href="#l25.30"></a><span id="l25.30">           nsAutoCString logMsg(&quot;failed to copy junk messages to junk folder rv = &quot;);</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-          logMsg.AppendInt(rv, 16);</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+          logMsg.AppendInt(static_cast&lt;uint32_t&gt;(rv), 16);</span>
<a href="#l25.33"></a><span id="l25.33">           spamSettings-&gt;LogJunkString(logMsg.get());</span>
<a href="#l25.34"></a><span id="l25.34">         }</span>
<a href="#l25.35"></a><span id="l25.35">       }</span>
<a href="#l25.36"></a><span id="l25.36">     }</span>
<a href="#l25.37"></a><span id="l25.37">     int32_t numNewMessages;</span>
<a href="#l25.38"></a><span id="l25.38">     GetNumNewMessages(false, &amp;numNewMessages);</span>
<a href="#l25.39"></a><span id="l25.39">     uint32_t length;</span>
<a href="#l25.40"></a><span id="l25.40">     messages-&gt;GetLength(&amp;length);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxProtocol.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxProtocol.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -392,17 +392,17 @@ NS_IMETHODIMP nsMailboxProtocol::OnStopR</span>
<a href="#l26.4"></a><span id="l26.4">   nsMsgProtocol::OnStopRequest(request, ctxt, aStatus);</span>
<a href="#l26.5"></a><span id="l26.5">   return CloseSocket(); </span>
<a href="#l26.6"></a><span id="l26.6"> }</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8"> /////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l26.9"></a><span id="l26.9"> // End of nsIStreamListenerSupport</span>
<a href="#l26.10"></a><span id="l26.10"> //////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-int32_t nsMailboxProtocol::DoneReadingMessage()</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+nsresult nsMailboxProtocol::DoneReadingMessage()</span>
<a href="#l26.14"></a><span id="l26.14"> {</span>
<a href="#l26.15"></a><span id="l26.15">   nsresult rv = NS_OK;</span>
<a href="#l26.16"></a><span id="l26.16">   // and close the article file if it was open....</span>
<a href="#l26.17"></a><span id="l26.17">   </span>
<a href="#l26.18"></a><span id="l26.18">   if (m_mailboxAction == nsIMailboxUrl::ActionSaveMessageToDisk &amp;&amp; m_msgFileOutputStream)</span>
<a href="#l26.19"></a><span id="l26.19">     rv = m_msgFileOutputStream-&gt;Close();</span>
<a href="#l26.20"></a><span id="l26.20">   </span>
<a href="#l26.21"></a><span id="l26.21">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxProtocol.h</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxProtocol.h</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -103,17 +103,17 @@ private:</span>
<a href="#l27.4"></a><span id="l27.4">   //            designed to re-act to the current &quot;state&quot;. I've attempted to</span>
<a href="#l27.5"></a><span id="l27.5">   //            group them together based on functionality.</span>
<a href="#l27.6"></a><span id="l27.6">   ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8">   // When parsing a mailbox folder in chunks, this protocol state reads in the current chunk</span>
<a href="#l27.9"></a><span id="l27.9">   // and forwards it to the mailbox parser.</span>
<a href="#l27.10"></a><span id="l27.10">   int32_t ReadFolderResponse(nsIInputStream * inputStream, uint64_t sourceOffset, uint32_t length);</span>
<a href="#l27.11"></a><span id="l27.11">   int32_t ReadMessageResponse(nsIInputStream * inputStream, uint64_t sourceOffset, uint32_t length);</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  int32_t DoneReadingMessage();</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  nsresult DoneReadingMessage();</span>
<a href="#l27.14"></a><span id="l27.14"> </span>
<a href="#l27.15"></a><span id="l27.15">   ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l27.16"></a><span id="l27.16">   // End of Protocol Methods</span>
<a href="#l27.17"></a><span id="l27.17">   ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l27.18"></a><span id="l27.18"> };</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20"> #endif  // nsMailboxProtocol_h___</span>
<a href="#l27.21"></a><span id="l27.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1304,57 +1304,55 @@ nsPop3Protocol::Error(int32_t err_code)</span>
<a href="#l28.4"></a><span id="l28.4">             }</span>
<a href="#l28.5"></a><span id="l28.5">         }</span>
<a href="#l28.6"></a><span id="l28.6">     }</span>
<a href="#l28.7"></a><span id="l28.7">     m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l28.8"></a><span id="l28.8">     m_pop3ConData-&gt;pause_for_read = false;</span>
<a href="#l28.9"></a><span id="l28.9">     return -1;</span>
<a href="#l28.10"></a><span id="l28.10"> }</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-nsresult nsPop3Protocol::SendData(const char * dataBuffer, bool aSuppressLogging)</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+int32_t nsPop3Protocol::Pop3SendData(const char * dataBuffer, bool aSuppressLogging)</span>
<a href="#l28.14"></a><span id="l28.14"> {</span>
<a href="#l28.15"></a><span id="l28.15">   // remove any leftover bytes in the line buffer</span>
<a href="#l28.16"></a><span id="l28.16">   // this can happen if the last message line doesn't end with a (CR)LF</span>
<a href="#l28.17"></a><span id="l28.17">   // or a server sent two reply lines</span>
<a href="#l28.18"></a><span id="l28.18">   m_lineStreamBuffer-&gt;ClearBuffer();</span>
<a href="#l28.19"></a><span id="l28.19"> </span>
<a href="#l28.20"></a><span id="l28.20">   nsresult result = nsMsgProtocol::SendData(dataBuffer);</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22">   if (!aSuppressLogging)</span>
<a href="#l28.23"></a><span id="l28.23">       PR_LOG(POP3LOGMODULE, PR_LOG_ALWAYS, (&quot;SEND: %s&quot;, dataBuffer));</span>
<a href="#l28.24"></a><span id="l28.24">   else</span>
<a href="#l28.25"></a><span id="l28.25">       PR_LOG(POP3LOGMODULE, PR_LOG_ALWAYS, (&quot;Logging suppressed for this command (it probably contained authentication information)&quot;));</span>
<a href="#l28.26"></a><span id="l28.26"> </span>
<a href="#l28.27"></a><span id="l28.27" class="difflineminus">-  if (NS_SUCCEEDED(result)) // yeah this sucks...i need an error code....</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineplus">+  if (NS_SUCCEEDED(result))</span>
<a href="#l28.29"></a><span id="l28.29">   {</span>
<a href="#l28.30"></a><span id="l28.30">     m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l28.31"></a><span id="l28.31">     m_pop3ConData-&gt;next_state = POP3_WAIT_FOR_RESPONSE;</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+    return 0;</span>
<a href="#l28.33"></a><span id="l28.33">   }</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineminus">-  else</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineminus">-  {</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineminus">-    m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineminus">-    PR_LOG(POP3LOGMODULE, PR_LOG_ALWAYS, (&quot;SendData faild: %lx&quot;, result));</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineminus">-  }</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineminus">-</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineminus">-  return result;</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineplus">+</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineplus">+  m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineplus">+  PR_LOG(POP3LOGMODULE, PR_LOG_ALWAYS, (&quot;Pop3SendData failed: %lx&quot;, result));</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineplus">+  return -1;</span>
<a href="#l28.45"></a><span id="l28.45"> }</span>
<a href="#l28.46"></a><span id="l28.46"> </span>
<a href="#l28.47"></a><span id="l28.47"> /*</span>
<a href="#l28.48"></a><span id="l28.48">  * POP3 AUTH extension</span>
<a href="#l28.49"></a><span id="l28.49">  */</span>
<a href="#l28.50"></a><span id="l28.50"> </span>
<a href="#l28.51"></a><span id="l28.51"> int32_t nsPop3Protocol::SendAuth()</span>
<a href="#l28.52"></a><span id="l28.52"> {</span>
<a href="#l28.53"></a><span id="l28.53">   if(!m_pop3ConData-&gt;command_succeeded)</span>
<a href="#l28.54"></a><span id="l28.54">     return(Error(POP3_SERVER_ERROR));</span>
<a href="#l28.55"></a><span id="l28.55"> </span>
<a href="#l28.56"></a><span id="l28.56">   nsAutoCString command(&quot;AUTH&quot; CRLF);</span>
<a href="#l28.57"></a><span id="l28.57"> </span>
<a href="#l28.58"></a><span id="l28.58">   m_pop3ConData-&gt;next_state_after_response = POP3_AUTH_RESPONSE;</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineminus">-  return SendData(command.get());</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineplus">+  return Pop3SendData(command.get());</span>
<a href="#l28.61"></a><span id="l28.61"> }</span>
<a href="#l28.62"></a><span id="l28.62"> </span>
<a href="#l28.63"></a><span id="l28.63"> int32_t nsPop3Protocol::AuthResponse(nsIInputStream* inputStream,</span>
<a href="#l28.64"></a><span id="l28.64">                              uint32_t length)</span>
<a href="#l28.65"></a><span id="l28.65"> {</span>
<a href="#l28.66"></a><span id="l28.66">     char * line;</span>
<a href="#l28.67"></a><span id="l28.67">     uint32_t ln = 0;</span>
<a href="#l28.68"></a><span id="l28.68">     nsresult rv;</span>
<a href="#l28.69"></a><span id="l28.69" class="difflineat">@@ -1438,17 +1436,17 @@ int32_t nsPop3Protocol::SendCapa()</span>
<a href="#l28.70"></a><span id="l28.70"> {</span>
<a href="#l28.71"></a><span id="l28.71">     PR_LOG(POP3LOGMODULE, PR_LOG_MAX, (&quot;SendCapa()&quot;));</span>
<a href="#l28.72"></a><span id="l28.72">     if(!m_pop3ConData-&gt;command_succeeded)</span>
<a href="#l28.73"></a><span id="l28.73">         return(Error(POP3_SERVER_ERROR));</span>
<a href="#l28.74"></a><span id="l28.74"> </span>
<a href="#l28.75"></a><span id="l28.75">     nsAutoCString command(&quot;CAPA&quot; CRLF);</span>
<a href="#l28.76"></a><span id="l28.76"> </span>
<a href="#l28.77"></a><span id="l28.77">     m_pop3ConData-&gt;next_state_after_response = POP3_CAPA_RESPONSE;</span>
<a href="#l28.78"></a><span id="l28.78" class="difflineminus">-    return SendData(command.get());</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineplus">+    return Pop3SendData(command.get());</span>
<a href="#l28.80"></a><span id="l28.80"> }</span>
<a href="#l28.81"></a><span id="l28.81"> </span>
<a href="#l28.82"></a><span id="l28.82"> int32_t nsPop3Protocol::CapaResponse(nsIInputStream* inputStream,</span>
<a href="#l28.83"></a><span id="l28.83">                              uint32_t length)</span>
<a href="#l28.84"></a><span id="l28.84"> {</span>
<a href="#l28.85"></a><span id="l28.85">     char * line;</span>
<a href="#l28.86"></a><span id="l28.86">     uint32_t ln = 0;</span>
<a href="#l28.87"></a><span id="l28.87"> </span>
<a href="#l28.88"></a><span id="l28.88" class="difflineat">@@ -1558,17 +1556,18 @@ int32_t nsPop3Protocol::SendTLSResponse(</span>
<a href="#l28.89"></a><span id="l28.89"> {</span>
<a href="#l28.90"></a><span id="l28.90">   // only tear down our existing connection and open a new one if we received</span>
<a href="#l28.91"></a><span id="l28.91">   // a +OK response from the pop server after we issued the STLS command</span>
<a href="#l28.92"></a><span id="l28.92">   nsresult rv = NS_OK;</span>
<a href="#l28.93"></a><span id="l28.93">   if (m_pop3ConData-&gt;command_succeeded)</span>
<a href="#l28.94"></a><span id="l28.94">   {</span>
<a href="#l28.95"></a><span id="l28.95">       nsCOMPtr&lt;nsISupports&gt; secInfo;</span>
<a href="#l28.96"></a><span id="l28.96">       nsCOMPtr&lt;nsISocketTransport&gt; strans = do_QueryInterface(m_transport, &amp;rv);</span>
<a href="#l28.97"></a><span id="l28.97" class="difflineminus">-      if (NS_FAILED(rv)) return rv;</span>
<a href="#l28.98"></a><span id="l28.98" class="difflineplus">+      if (NS_FAILED(rv))</span>
<a href="#l28.99"></a><span id="l28.99" class="difflineplus">+        return -1;</span>
<a href="#l28.100"></a><span id="l28.100"> </span>
<a href="#l28.101"></a><span id="l28.101">       rv = strans-&gt;GetSecurityInfo(getter_AddRefs(secInfo));</span>
<a href="#l28.102"></a><span id="l28.102"> </span>
<a href="#l28.103"></a><span id="l28.103">       if (NS_SUCCEEDED(rv) &amp;&amp; secInfo)</span>
<a href="#l28.104"></a><span id="l28.104">       {</span>
<a href="#l28.105"></a><span id="l28.105">           nsCOMPtr&lt;nsISSLSocketControl&gt; sslControl = do_QueryInterface(secInfo, &amp;rv);</span>
<a href="#l28.106"></a><span id="l28.106"> </span>
<a href="#l28.107"></a><span id="l28.107">           if (NS_SUCCEEDED(rv) &amp;&amp; sslControl)</span>
<a href="#l28.108"></a><span id="l28.108" class="difflineat">@@ -1587,24 +1586,24 @@ int32_t nsPop3Protocol::SendTLSResponse(</span>
<a href="#l28.109"></a><span id="l28.109">         POP3_AUTH_MECH_UNDEFINED |</span>
<a href="#l28.110"></a><span id="l28.110">         POP3_HAS_AUTH_USER |                // should be always there</span>
<a href="#l28.111"></a><span id="l28.111">         POP3_GURL_UNDEFINED |</span>
<a href="#l28.112"></a><span id="l28.112">         POP3_UIDL_UNDEFINED |</span>
<a href="#l28.113"></a><span id="l28.113">         POP3_TOP_UNDEFINED |</span>
<a href="#l28.114"></a><span id="l28.114">         POP3_XTND_XLST_UNDEFINED |</span>
<a href="#l28.115"></a><span id="l28.115">         preservedCapFlags;</span>
<a href="#l28.116"></a><span id="l28.116">       m_pop3Server-&gt;SetPop3CapabilityFlags(m_pop3ConData-&gt;capability_flags);</span>
<a href="#l28.117"></a><span id="l28.117" class="difflineminus">-      return rv;</span>
<a href="#l28.118"></a><span id="l28.118" class="difflineplus">+      return 0;</span>
<a href="#l28.119"></a><span id="l28.119">     }</span>
<a href="#l28.120"></a><span id="l28.120">   }</span>
<a href="#l28.121"></a><span id="l28.121"> </span>
<a href="#l28.122"></a><span id="l28.122">   ClearFlag(POP3_HAS_STLS);</span>
<a href="#l28.123"></a><span id="l28.123">   m_pop3ConData-&gt;next_state = POP3_PROCESS_AUTH;</span>
<a href="#l28.124"></a><span id="l28.124"> </span>
<a href="#l28.125"></a><span id="l28.125" class="difflineminus">-  return rv;</span>
<a href="#l28.126"></a><span id="l28.126" class="difflineplus">+  return (NS_SUCCEEDED(rv) ? 0 : -1);</span>
<a href="#l28.127"></a><span id="l28.127"> }</span>
<a href="#l28.128"></a><span id="l28.128"> </span>
<a href="#l28.129"></a><span id="l28.129"> void nsPop3Protocol::InitPrefAuthMethods(int32_t authMethodPrefValue)</span>
<a href="#l28.130"></a><span id="l28.130"> {</span>
<a href="#l28.131"></a><span id="l28.131">   // for m_prefAuthMethods, using the same flags as server capablities.</span>
<a href="#l28.132"></a><span id="l28.132">   switch (authMethodPrefValue)</span>
<a href="#l28.133"></a><span id="l28.133">   {</span>
<a href="#l28.134"></a><span id="l28.134">     case nsMsgAuthMethod::none:</span>
<a href="#l28.135"></a><span id="l28.135" class="difflineat">@@ -1730,17 +1729,17 @@ int32_t nsPop3Protocol::ProcessAuth()</span>
<a href="#l28.136"></a><span id="l28.136">       if(TestCapFlag(POP3_HAS_STLS))</span>
<a href="#l28.137"></a><span id="l28.137">       {</span>
<a href="#l28.138"></a><span id="l28.138">         if (m_socketType == nsMsgSocketType::trySTARTTLS ||</span>
<a href="#l28.139"></a><span id="l28.139">             m_socketType == nsMsgSocketType::alwaysSTARTTLS)</span>
<a href="#l28.140"></a><span id="l28.140">         {</span>
<a href="#l28.141"></a><span id="l28.141">             nsAutoCString command(&quot;STLS&quot; CRLF);</span>
<a href="#l28.142"></a><span id="l28.142"> </span>
<a href="#l28.143"></a><span id="l28.143">             m_pop3ConData-&gt;next_state_after_response = POP3_TLS_RESPONSE;</span>
<a href="#l28.144"></a><span id="l28.144" class="difflineminus">-            return SendData(command.get());</span>
<a href="#l28.145"></a><span id="l28.145" class="difflineplus">+            return Pop3SendData(command.get());</span>
<a href="#l28.146"></a><span id="l28.146">         }</span>
<a href="#l28.147"></a><span id="l28.147">       }</span>
<a href="#l28.148"></a><span id="l28.148">       else if (m_socketType == nsMsgSocketType::alwaysSTARTTLS)</span>
<a href="#l28.149"></a><span id="l28.149">       {</span>
<a href="#l28.150"></a><span id="l28.150">           m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l28.151"></a><span id="l28.151">           return(Error(NS_ERROR_COULD_NOT_CONNECT_VIA_TLS));</span>
<a href="#l28.152"></a><span id="l28.152">       }</span>
<a href="#l28.153"></a><span id="l28.153">     }</span>
<a href="#l28.154"></a><span id="l28.154" class="difflineat">@@ -1938,17 +1937,17 @@ int32_t nsPop3Protocol::NextAuthStep()</span>
<a href="#l28.155"></a><span id="l28.155"> // so we've to start here and continue in SendUsername if the server</span>
<a href="#l28.156"></a><span id="l28.156"> // responds + to &quot;AUTH LOGIN&quot;</span>
<a href="#l28.157"></a><span id="l28.157"> int32_t nsPop3Protocol::AuthLogin()</span>
<a href="#l28.158"></a><span id="l28.158"> {</span>
<a href="#l28.159"></a><span id="l28.159">     nsAutoCString command(&quot;AUTH LOGIN&quot; CRLF);</span>
<a href="#l28.160"></a><span id="l28.160">     m_pop3ConData-&gt;next_state_after_response = POP3_AUTH_LOGIN_RESPONSE;</span>
<a href="#l28.161"></a><span id="l28.161">     m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l28.162"></a><span id="l28.162"> </span>
<a href="#l28.163"></a><span id="l28.163" class="difflineminus">-    return SendData(command.get());</span>
<a href="#l28.164"></a><span id="l28.164" class="difflineplus">+    return Pop3SendData(command.get());</span>
<a href="#l28.165"></a><span id="l28.165"> }</span>
<a href="#l28.166"></a><span id="l28.166"> </span>
<a href="#l28.167"></a><span id="l28.167"> int32_t nsPop3Protocol::AuthLoginResponse()</span>
<a href="#l28.168"></a><span id="l28.168"> {</span>
<a href="#l28.169"></a><span id="l28.169">     // need the test to be here instead in NextAuthStep() to</span>
<a href="#l28.170"></a><span id="l28.170">     // differentiate between command AUTH LOGIN failed and</span>
<a href="#l28.171"></a><span id="l28.171">     // sending username using LOGIN mechanism failed.</span>
<a href="#l28.172"></a><span id="l28.172">     if (!m_pop3ConData-&gt;command_succeeded)</span>
<a href="#l28.173"></a><span id="l28.173" class="difflineat">@@ -1970,17 +1969,17 @@ int32_t nsPop3Protocol::AuthLoginRespons</span>
<a href="#l28.174"></a><span id="l28.174"> // responds + to &quot;AUTH NTLM&quot;</span>
<a href="#l28.175"></a><span id="l28.175"> int32_t nsPop3Protocol::AuthNtlm()</span>
<a href="#l28.176"></a><span id="l28.176"> {</span>
<a href="#l28.177"></a><span id="l28.177">     nsAutoCString command (m_currentAuthMethod == POP3_HAS_AUTH_MSN</span>
<a href="#l28.178"></a><span id="l28.178">           ? &quot;AUTH MSN&quot; CRLF : &quot;AUTH NTLM&quot; CRLF);</span>
<a href="#l28.179"></a><span id="l28.179">     m_pop3ConData-&gt;next_state_after_response = POP3_AUTH_NTLM_RESPONSE;</span>
<a href="#l28.180"></a><span id="l28.180">     m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l28.181"></a><span id="l28.181"> </span>
<a href="#l28.182"></a><span id="l28.182" class="difflineminus">-    return SendData(command.get());</span>
<a href="#l28.183"></a><span id="l28.183" class="difflineplus">+    return Pop3SendData(command.get());</span>
<a href="#l28.184"></a><span id="l28.184"> }</span>
<a href="#l28.185"></a><span id="l28.185"> </span>
<a href="#l28.186"></a><span id="l28.186"> int32_t nsPop3Protocol::AuthNtlmResponse()</span>
<a href="#l28.187"></a><span id="l28.187"> {</span>
<a href="#l28.188"></a><span id="l28.188">     // need the test to be here instead in NextAuthStep() to</span>
<a href="#l28.189"></a><span id="l28.189">     // differentiate between command AUTH NTLM failed and</span>
<a href="#l28.190"></a><span id="l28.190">     // sending username using NTLM mechanism failed.</span>
<a href="#l28.191"></a><span id="l28.191">     if (!m_pop3ConData-&gt;command_succeeded)</span>
<a href="#l28.192"></a><span id="l28.192" class="difflineat">@@ -2008,63 +2007,63 @@ int32_t nsPop3Protocol::AuthGSSAPI()</span>
<a href="#l28.193"></a><span id="l28.193">         nsresult rv;</span>
<a href="#l28.194"></a><span id="l28.194">         server-&gt;GetRealHostName(hostName);</span>
<a href="#l28.195"></a><span id="l28.195">         service.Append(hostName);</span>
<a href="#l28.196"></a><span id="l28.196">         rv = DoGSSAPIStep1(service.get(), m_username.get(), cmd);</span>
<a href="#l28.197"></a><span id="l28.197">         if (NS_SUCCEEDED(rv)) {</span>
<a href="#l28.198"></a><span id="l28.198">             m_GSSAPICache.Assign(cmd);</span>
<a href="#l28.199"></a><span id="l28.199">             m_pop3ConData-&gt;next_state_after_response = POP3_AUTH_GSSAPI_FIRST;</span>
<a href="#l28.200"></a><span id="l28.200">             m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l28.201"></a><span id="l28.201" class="difflineminus">-            return SendData(&quot;AUTH GSSAPI&quot; CRLF);</span>
<a href="#l28.202"></a><span id="l28.202" class="difflineplus">+            return Pop3SendData(&quot;AUTH GSSAPI&quot; CRLF);</span>
<a href="#l28.203"></a><span id="l28.203">         }</span>
<a href="#l28.204"></a><span id="l28.204">     }</span>
<a href="#l28.205"></a><span id="l28.205"> </span>
<a href="#l28.206"></a><span id="l28.206">     MarkAuthMethodAsFailed(POP3_HAS_AUTH_GSSAPI);</span>
<a href="#l28.207"></a><span id="l28.207">     m_pop3ConData-&gt;next_state = POP3_PROCESS_AUTH;</span>
<a href="#l28.208"></a><span id="l28.208">     m_pop3ConData-&gt;pause_for_read = false;</span>
<a href="#l28.209"></a><span id="l28.209" class="difflineminus">-    return NS_OK;</span>
<a href="#l28.210"></a><span id="l28.210" class="difflineplus">+    return 0;</span>
<a href="#l28.211"></a><span id="l28.211"> }</span>
<a href="#l28.212"></a><span id="l28.212"> </span>
<a href="#l28.213"></a><span id="l28.213"> int32_t nsPop3Protocol::AuthGSSAPIResponse(bool first)</span>
<a href="#l28.214"></a><span id="l28.214"> {</span>
<a href="#l28.215"></a><span id="l28.215">     if (!m_pop3ConData-&gt;command_succeeded)</span>
<a href="#l28.216"></a><span id="l28.216">     {</span>
<a href="#l28.217"></a><span id="l28.217">         if (first)</span>
<a href="#l28.218"></a><span id="l28.218">             m_GSSAPICache.Truncate();</span>
<a href="#l28.219"></a><span id="l28.219">         MarkAuthMethodAsFailed(POP3_HAS_AUTH_GSSAPI);</span>
<a href="#l28.220"></a><span id="l28.220">         m_pop3ConData-&gt;next_state = POP3_PROCESS_AUTH;</span>
<a href="#l28.221"></a><span id="l28.221">         m_pop3ConData-&gt;pause_for_read = false;</span>
<a href="#l28.222"></a><span id="l28.222" class="difflineminus">-        return NS_OK;</span>
<a href="#l28.223"></a><span id="l28.223" class="difflineplus">+        return 0;</span>
<a href="#l28.224"></a><span id="l28.224">     }</span>
<a href="#l28.225"></a><span id="l28.225"> </span>
<a href="#l28.226"></a><span id="l28.226" class="difflineminus">-    nsresult rv;</span>
<a href="#l28.227"></a><span id="l28.227" class="difflineplus">+    int32_t result;</span>
<a href="#l28.228"></a><span id="l28.228"> </span>
<a href="#l28.229"></a><span id="l28.229">     m_pop3ConData-&gt;next_state_after_response = POP3_AUTH_GSSAPI_STEP;</span>
<a href="#l28.230"></a><span id="l28.230">     m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l28.231"></a><span id="l28.231"> </span>
<a href="#l28.232"></a><span id="l28.232">     if (first) {</span>
<a href="#l28.233"></a><span id="l28.233">         m_GSSAPICache += CRLF;</span>
<a href="#l28.234"></a><span id="l28.234" class="difflineminus">-        rv = SendData(m_GSSAPICache.get());</span>
<a href="#l28.235"></a><span id="l28.235" class="difflineplus">+        result = Pop3SendData(m_GSSAPICache.get());</span>
<a href="#l28.236"></a><span id="l28.236">         m_GSSAPICache.Truncate();</span>
<a href="#l28.237"></a><span id="l28.237">     }</span>
<a href="#l28.238"></a><span id="l28.238">     else {</span>
<a href="#l28.239"></a><span id="l28.239">         nsAutoCString cmd;</span>
<a href="#l28.240"></a><span id="l28.240">         PR_LOG(POP3LOGMODULE, PR_LOG_DEBUG, (&quot;GSSAPI step 2&quot;));</span>
<a href="#l28.241"></a><span id="l28.241" class="difflineminus">-        rv = DoGSSAPIStep2(m_commandResponse, cmd);</span>
<a href="#l28.242"></a><span id="l28.242" class="difflineplus">+        nsresult rv = DoGSSAPIStep2(m_commandResponse, cmd);</span>
<a href="#l28.243"></a><span id="l28.243">         if (NS_FAILED(rv))</span>
<a href="#l28.244"></a><span id="l28.244">             cmd = &quot;*&quot;;</span>
<a href="#l28.245"></a><span id="l28.245">         if (rv == NS_SUCCESS_AUTH_FINISHED) {</span>
<a href="#l28.246"></a><span id="l28.246">             m_pop3ConData-&gt;next_state_after_response = POP3_NEXT_AUTH_STEP;</span>
<a href="#l28.247"></a><span id="l28.247">             m_password_already_sent = true;</span>
<a href="#l28.248"></a><span id="l28.248">         }</span>
<a href="#l28.249"></a><span id="l28.249">         cmd += CRLF;</span>
<a href="#l28.250"></a><span id="l28.250" class="difflineminus">-        rv = SendData(cmd.get());</span>
<a href="#l28.251"></a><span id="l28.251" class="difflineplus">+        result = Pop3SendData(cmd.get());</span>
<a href="#l28.252"></a><span id="l28.252">     }</span>
<a href="#l28.253"></a><span id="l28.253"> </span>
<a href="#l28.254"></a><span id="l28.254" class="difflineminus">-    return rv;</span>
<a href="#l28.255"></a><span id="l28.255" class="difflineplus">+    return result;</span>
<a href="#l28.256"></a><span id="l28.256"> }</span>
<a href="#l28.257"></a><span id="l28.257"> </span>
<a href="#l28.258"></a><span id="l28.258"> int32_t nsPop3Protocol::SendUsername()</span>
<a href="#l28.259"></a><span id="l28.259"> {</span>
<a href="#l28.260"></a><span id="l28.260">     PR_LOG(POP3LOGMODULE, PR_LOG_MAX, (&quot;SendUsername()&quot;));</span>
<a href="#l28.261"></a><span id="l28.261">     if(m_username.IsEmpty())</span>
<a href="#l28.262"></a><span id="l28.262">       return(Error(POP3_USERNAME_UNDEFINED));</span>
<a href="#l28.263"></a><span id="l28.263"> </span>
<a href="#l28.264"></a><span id="l28.264" class="difflineat">@@ -2110,17 +2109,17 @@ int32_t nsPop3Protocol::SendUsername()</span>
<a href="#l28.265"></a><span id="l28.265">     }</span>
<a href="#l28.266"></a><span id="l28.266"> </span>
<a href="#l28.267"></a><span id="l28.267">     cmd += CRLF;</span>
<a href="#l28.268"></a><span id="l28.268"> </span>
<a href="#l28.269"></a><span id="l28.269">     m_pop3ConData-&gt;next_state_after_response = POP3_NEXT_AUTH_STEP;</span>
<a href="#l28.270"></a><span id="l28.270"> </span>
<a href="#l28.271"></a><span id="l28.271">     m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l28.272"></a><span id="l28.272"> </span>
<a href="#l28.273"></a><span id="l28.273" class="difflineminus">-    return SendData(cmd.get());</span>
<a href="#l28.274"></a><span id="l28.274" class="difflineplus">+    return Pop3SendData(cmd.get());</span>
<a href="#l28.275"></a><span id="l28.275"> }</span>
<a href="#l28.276"></a><span id="l28.276"> </span>
<a href="#l28.277"></a><span id="l28.277"> int32_t nsPop3Protocol::SendPassword()</span>
<a href="#l28.278"></a><span id="l28.278"> {</span>
<a href="#l28.279"></a><span id="l28.279">   PR_LOG(POP3LOGMODULE, PR_LOG_MAX, (&quot;SendPassword()&quot;));</span>
<a href="#l28.280"></a><span id="l28.280">   if (m_username.IsEmpty())</span>
<a href="#l28.281"></a><span id="l28.281">     return(Error(POP3_USERNAME_UNDEFINED));</span>
<a href="#l28.282"></a><span id="l28.282"> </span>
<a href="#l28.283"></a><span id="l28.283" class="difflineat">@@ -2266,33 +2265,33 @@ int32_t nsPop3Protocol::SendPassword()</span>
<a href="#l28.284"></a><span id="l28.284">   //m_pop3Server-&gt;SetPop3CapabilityFlags(m_pop3ConData-&gt;capability_flags);</span>
<a href="#l28.285"></a><span id="l28.285"> </span>
<a href="#l28.286"></a><span id="l28.286">   m_pop3ConData-&gt;next_state_after_response = POP3_NEXT_AUTH_STEP;</span>
<a href="#l28.287"></a><span id="l28.287"> </span>
<a href="#l28.288"></a><span id="l28.288">   m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l28.289"></a><span id="l28.289"> </span>
<a href="#l28.290"></a><span id="l28.290">   m_password_already_sent = true;</span>
<a href="#l28.291"></a><span id="l28.291">   m_lastPasswordSent = m_passwordResult;</span>
<a href="#l28.292"></a><span id="l28.292" class="difflineminus">-  return SendData(cmd.get(), true);</span>
<a href="#l28.293"></a><span id="l28.293" class="difflineplus">+  return Pop3SendData(cmd.get(), true);</span>
<a href="#l28.294"></a><span id="l28.294"> }</span>
<a href="#l28.295"></a><span id="l28.295"> </span>
<a href="#l28.296"></a><span id="l28.296"> int32_t nsPop3Protocol::SendStatOrGurl(bool sendStat)</span>
<a href="#l28.297"></a><span id="l28.297"> {</span>
<a href="#l28.298"></a><span id="l28.298">   nsAutoCString cmd;</span>
<a href="#l28.299"></a><span id="l28.299">   if (sendStat)</span>
<a href="#l28.300"></a><span id="l28.300">   {</span>
<a href="#l28.301"></a><span id="l28.301">     cmd  = &quot;STAT&quot; CRLF;</span>
<a href="#l28.302"></a><span id="l28.302">     m_pop3ConData-&gt;next_state_after_response = POP3_GET_STAT;</span>
<a href="#l28.303"></a><span id="l28.303">   }</span>
<a href="#l28.304"></a><span id="l28.304">   else</span>
<a href="#l28.305"></a><span id="l28.305">   {</span>
<a href="#l28.306"></a><span id="l28.306">     cmd = &quot;GURL&quot; CRLF;</span>
<a href="#l28.307"></a><span id="l28.307">     m_pop3ConData-&gt;next_state_after_response = POP3_GURL_RESPONSE;</span>
<a href="#l28.308"></a><span id="l28.308">   }</span>
<a href="#l28.309"></a><span id="l28.309" class="difflineminus">-  return SendData(cmd.get());</span>
<a href="#l28.310"></a><span id="l28.310" class="difflineplus">+  return Pop3SendData(cmd.get());</span>
<a href="#l28.311"></a><span id="l28.311"> }</span>
<a href="#l28.312"></a><span id="l28.312"> </span>
<a href="#l28.313"></a><span id="l28.313"> </span>
<a href="#l28.314"></a><span id="l28.314"> int32_t</span>
<a href="#l28.315"></a><span id="l28.315"> nsPop3Protocol::SendStat()</span>
<a href="#l28.316"></a><span id="l28.316"> {</span>
<a href="#l28.317"></a><span id="l28.317">   return SendStatOrGurl(true);</span>
<a href="#l28.318"></a><span id="l28.318"> }</span>
<a href="#l28.319"></a><span id="l28.319" class="difflineat">@@ -2437,17 +2436,17 @@ int32_t nsPop3Protocol::SendList()</span>
<a href="#l28.320"></a><span id="l28.320"> </span>
<a href="#l28.321"></a><span id="l28.321"> </span>
<a href="#l28.322"></a><span id="l28.322">     m_pop3ConData-&gt;msg_info = (Pop3MsgInfo *)</span>
<a href="#l28.323"></a><span id="l28.323">       PR_CALLOC(sizeof(Pop3MsgInfo) * m_pop3ConData-&gt;number_of_messages);</span>
<a href="#l28.324"></a><span id="l28.324">     if (!m_pop3ConData-&gt;msg_info)</span>
<a href="#l28.325"></a><span id="l28.325">         return(MK_OUT_OF_MEMORY);</span>
<a href="#l28.326"></a><span id="l28.326">     m_pop3ConData-&gt;next_state_after_response = POP3_GET_LIST;</span>
<a href="#l28.327"></a><span id="l28.327">     m_listpos = 0;</span>
<a href="#l28.328"></a><span id="l28.328" class="difflineminus">-    return SendData(&quot;LIST&quot; CRLF);</span>
<a href="#l28.329"></a><span id="l28.329" class="difflineplus">+    return Pop3SendData(&quot;LIST&quot; CRLF);</span>
<a href="#l28.330"></a><span id="l28.330"> }</span>
<a href="#l28.331"></a><span id="l28.331"> </span>
<a href="#l28.332"></a><span id="l28.332"> </span>
<a href="#l28.333"></a><span id="l28.333"> </span>
<a href="#l28.334"></a><span id="l28.334"> int32_t</span>
<a href="#l28.335"></a><span id="l28.335"> nsPop3Protocol::GetList(nsIInputStream* inputStream,</span>
<a href="#l28.336"></a><span id="l28.336">                         uint32_t length)</span>
<a href="#l28.337"></a><span id="l28.337"> {</span>
<a href="#l28.338"></a><span id="l28.338" class="difflineat">@@ -2611,17 +2610,17 @@ int32_t nsPop3Protocol::HandleNoUidListA</span>
<a href="#l28.339"></a><span id="l28.339"> */</span>
<a href="#l28.340"></a><span id="l28.340"> int32_t nsPop3Protocol::SendXtndXlstMsgid()</span>
<a href="#l28.341"></a><span id="l28.341"> {</span>
<a href="#l28.342"></a><span id="l28.342">   if (TestCapFlag(POP3_HAS_XTND_XLST | POP3_XTND_XLST_UNDEFINED))</span>
<a href="#l28.343"></a><span id="l28.343">   {</span>
<a href="#l28.344"></a><span id="l28.344">     m_pop3ConData-&gt;next_state_after_response = POP3_GET_XTND_XLST_MSGID;</span>
<a href="#l28.345"></a><span id="l28.345">     m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l28.346"></a><span id="l28.346">     m_listpos = 0;</span>
<a href="#l28.347"></a><span id="l28.347" class="difflineminus">-    return SendData(&quot;XTND XLST Message-Id&quot; CRLF);</span>
<a href="#l28.348"></a><span id="l28.348" class="difflineplus">+    return Pop3SendData(&quot;XTND XLST Message-Id&quot; CRLF);</span>
<a href="#l28.349"></a><span id="l28.349">   }</span>
<a href="#l28.350"></a><span id="l28.350">   else</span>
<a href="#l28.351"></a><span id="l28.351">     return HandleNoUidListAvailable();</span>
<a href="#l28.352"></a><span id="l28.352"> }</span>
<a href="#l28.353"></a><span id="l28.353"> </span>
<a href="#l28.354"></a><span id="l28.354"> </span>
<a href="#l28.355"></a><span id="l28.355"> /* km</span>
<a href="#l28.356"></a><span id="l28.356">  *</span>
<a href="#l28.357"></a><span id="l28.357" class="difflineat">@@ -2694,17 +2693,17 @@ nsPop3Protocol::GetXtndXlstMsgid(nsIInpu</span>
<a href="#l28.358"></a><span id="l28.358">   char *newStr = line;</span>
<a href="#l28.359"></a><span id="l28.359">   char *token = NS_strtok(&quot; &quot;, &amp;newStr);  // msg num</span>
<a href="#l28.360"></a><span id="l28.360">   if (token)</span>
<a href="#l28.361"></a><span id="l28.361">   {</span>
<a href="#l28.362"></a><span id="l28.362">     int32_t msg_num = atol(token);</span>
<a href="#l28.363"></a><span id="l28.363">     if (++m_listpos &lt;= m_pop3ConData-&gt;number_of_messages)</span>
<a href="#l28.364"></a><span id="l28.364">     {</span>
<a href="#l28.365"></a><span id="l28.365">       NS_strtok(&quot; &quot;, &amp;newStr);  // eat message ID token</span>
<a href="#l28.366"></a><span id="l28.366" class="difflineminus">-      char *uid = NS_strtok(&quot; &quot;, &amp;newStr); // not really a UID but a unique token -km</span>
<a href="#l28.367"></a><span id="l28.367" class="difflineplus">+      const char *uid = NS_strtok(&quot; &quot;, &amp;newStr); // not really a UID but a unique token -km</span>
<a href="#l28.368"></a><span id="l28.368">       if (!uid)</span>
<a href="#l28.369"></a><span id="l28.369">         /* This is bad.  The server didn't give us a UIDL for this message.</span>
<a href="#l28.370"></a><span id="l28.370">         I've seen this happen when somehow the mail spool has a message</span>
<a href="#l28.371"></a><span id="l28.371">         that contains a header that reads &quot;X-UIDL: \n&quot;.  But how that got</span>
<a href="#l28.372"></a><span id="l28.372">         there, I have no idea; must be a server bug.  Or something. */</span>
<a href="#l28.373"></a><span id="l28.373">         uid = &quot;&quot;;</span>
<a href="#l28.374"></a><span id="l28.374"> </span>
<a href="#l28.375"></a><span id="l28.375">       // seeking right entry, but try the one that should it be first</span>
<a href="#l28.376"></a><span id="l28.376" class="difflineat">@@ -2737,17 +2736,17 @@ nsPop3Protocol::GetXtndXlstMsgid(nsIInpu</span>
<a href="#l28.377"></a><span id="l28.377"> </span>
<a href="#l28.378"></a><span id="l28.378"> int32_t nsPop3Protocol::SendUidlList()</span>
<a href="#l28.379"></a><span id="l28.379"> {</span>
<a href="#l28.380"></a><span id="l28.380">     if (TestCapFlag(POP3_HAS_UIDL | POP3_UIDL_UNDEFINED))</span>
<a href="#l28.381"></a><span id="l28.381">     {</span>
<a href="#l28.382"></a><span id="l28.382">       m_pop3ConData-&gt;next_state_after_response = POP3_GET_UIDL_LIST;</span>
<a href="#l28.383"></a><span id="l28.383">       m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l28.384"></a><span id="l28.384">       m_listpos = 0;</span>
<a href="#l28.385"></a><span id="l28.385" class="difflineminus">-      return SendData(&quot;UIDL&quot; CRLF);</span>
<a href="#l28.386"></a><span id="l28.386" class="difflineplus">+      return Pop3SendData(&quot;UIDL&quot; CRLF);</span>
<a href="#l28.387"></a><span id="l28.387">     }</span>
<a href="#l28.388"></a><span id="l28.388">     else</span>
<a href="#l28.389"></a><span id="l28.389">       return SendXtndXlstMsgid();</span>
<a href="#l28.390"></a><span id="l28.390"> }</span>
<a href="#l28.391"></a><span id="l28.391"> </span>
<a href="#l28.392"></a><span id="l28.392"> </span>
<a href="#l28.393"></a><span id="l28.393"> int32_t nsPop3Protocol::GetUidlList(nsIInputStream* inputStream,</span>
<a href="#l28.394"></a><span id="l28.394">                             uint32_t length)</span>
<a href="#l28.395"></a><span id="l28.395" class="difflineat">@@ -2809,17 +2808,17 @@ int32_t nsPop3Protocol::GetUidlList(nsII</span>
<a href="#l28.396"></a><span id="l28.396"> </span>
<a href="#l28.397"></a><span id="l28.397">     char *newStr = line;</span>
<a href="#l28.398"></a><span id="l28.398">     char *token = NS_strtok(&quot; &quot;, &amp;newStr);  // msg num</span>
<a href="#l28.399"></a><span id="l28.399">     if (token)</span>
<a href="#l28.400"></a><span id="l28.400">     {</span>
<a href="#l28.401"></a><span id="l28.401">       int32_t msg_num = atol(token);</span>
<a href="#l28.402"></a><span id="l28.402">       if (++m_listpos &lt;= m_pop3ConData-&gt;number_of_messages)</span>
<a href="#l28.403"></a><span id="l28.403">       {</span>
<a href="#l28.404"></a><span id="l28.404" class="difflineminus">-        char *uid = NS_strtok(&quot; &quot;, &amp;newStr); // UID</span>
<a href="#l28.405"></a><span id="l28.405" class="difflineplus">+        const char *uid = NS_strtok(&quot; &quot;, &amp;newStr); // UID</span>
<a href="#l28.406"></a><span id="l28.406">         if (!uid)</span>
<a href="#l28.407"></a><span id="l28.407">           /* This is bad.  The server didn't give us a UIDL for this message.</span>
<a href="#l28.408"></a><span id="l28.408">              I've seen this happen when somehow the mail spool has a message</span>
<a href="#l28.409"></a><span id="l28.409">              that contains a header that reads &quot;X-UIDL: \n&quot;.  But how that got</span>
<a href="#l28.410"></a><span id="l28.410">              there, I have no idea; must be a server bug.  Or something. */</span>
<a href="#l28.411"></a><span id="l28.411">           uid = &quot;&quot;;</span>
<a href="#l28.412"></a><span id="l28.412"> </span>
<a href="#l28.413"></a><span id="l28.413">         // seeking right entry, but try the one that should it be first</span>
<a href="#l28.414"></a><span id="l28.414" class="difflineat">@@ -2968,21 +2967,23 @@ int32_t nsPop3Protocol::GetMsg()</span>
<a href="#l28.415"></a><span id="l28.415">     {</span>
<a href="#l28.416"></a><span id="l28.416">       nsresult rv;</span>
<a href="#l28.417"></a><span id="l28.417">       int64_t mailboxSpaceLeft = 0;</span>
<a href="#l28.418"></a><span id="l28.418">       nsCOMPtr &lt;nsIMsgFolder&gt; folder;</span>
<a href="#l28.419"></a><span id="l28.419">       nsCOMPtr &lt;nsIFile&gt; path;</span>
<a href="#l28.420"></a><span id="l28.420"> </span>
<a href="#l28.421"></a><span id="l28.421">       // Get the path to the current mailbox</span>
<a href="#l28.422"></a><span id="l28.422">       //</span>
<a href="#l28.423"></a><span id="l28.423" class="difflineminus">-      NS_ENSURE_TRUE(m_nsIPop3Sink, NS_ERROR_UNEXPECTED);</span>
<a href="#l28.424"></a><span id="l28.424" class="difflineplus">+      NS_ENSURE_TRUE(m_nsIPop3Sink, -1);</span>
<a href="#l28.425"></a><span id="l28.425">       rv = m_nsIPop3Sink-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l28.426"></a><span id="l28.426" class="difflineminus">-      if (NS_FAILED(rv)) return rv;</span>
<a href="#l28.427"></a><span id="l28.427" class="difflineplus">+      if (NS_FAILED(rv))</span>
<a href="#l28.428"></a><span id="l28.428" class="difflineplus">+        return -1;</span>
<a href="#l28.429"></a><span id="l28.429">       rv = folder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l28.430"></a><span id="l28.430" class="difflineminus">-      if (NS_FAILED(rv)) return rv;</span>
<a href="#l28.431"></a><span id="l28.431" class="difflineplus">+      if (NS_FAILED(rv))</span>
<a href="#l28.432"></a><span id="l28.432" class="difflineplus">+        return -1;</span>
<a href="#l28.433"></a><span id="l28.433"> </span>
<a href="#l28.434"></a><span id="l28.434">       // call GetDiskSpaceAvailable on the directory</span>
<a href="#l28.435"></a><span id="l28.435">       nsCOMPtr &lt;nsIFile&gt; parent;</span>
<a href="#l28.436"></a><span id="l28.436">       path-&gt;GetParent(getter_AddRefs(parent));</span>
<a href="#l28.437"></a><span id="l28.437">       rv = parent-&gt;GetDiskSpaceAvailable(&amp;mailboxSpaceLeft);</span>
<a href="#l28.438"></a><span id="l28.438">       if (NS_FAILED(rv))</span>
<a href="#l28.439"></a><span id="l28.439">       {</span>
<a href="#l28.440"></a><span id="l28.440">         // The call to GetDiskSpaceAvailable FAILED!</span>
<a href="#l28.441"></a><span id="l28.441" class="difflineat">@@ -3148,32 +3149,32 @@ int32_t nsPop3Protocol::SendTop()</span>
<a href="#l28.442"></a><span id="l28.442">    {</span>
<a href="#l28.443"></a><span id="l28.443">      m_pop3ConData-&gt;next_state_after_response = POP3_TOP_RESPONSE;</span>
<a href="#l28.444"></a><span id="l28.444">      m_pop3ConData-&gt;cur_msg_size = -1;</span>
<a href="#l28.445"></a><span id="l28.445"> </span>
<a href="#l28.446"></a><span id="l28.446">      /* zero the bytes received in message in preparation for</span>
<a href="#l28.447"></a><span id="l28.447">      * the next</span>
<a href="#l28.448"></a><span id="l28.448">      */</span>
<a href="#l28.449"></a><span id="l28.449">      m_bytesInMsgReceived = 0;</span>
<a href="#l28.450"></a><span id="l28.450" class="difflineminus">-     status = SendData(cmd);</span>
<a href="#l28.451"></a><span id="l28.451" class="difflineplus">+     status = Pop3SendData(cmd);</span>
<a href="#l28.452"></a><span id="l28.452">    }</span>
<a href="#l28.453"></a><span id="l28.453">    PR_Free(cmd);</span>
<a href="#l28.454"></a><span id="l28.454">    return status;</span>
<a href="#l28.455"></a><span id="l28.455"> }</span>
<a href="#l28.456"></a><span id="l28.456"> </span>
<a href="#l28.457"></a><span id="l28.457"> /* send the xsender command</span>
<a href="#l28.458"></a><span id="l28.458">  */</span>
<a href="#l28.459"></a><span id="l28.459"> int32_t nsPop3Protocol::SendXsender()</span>
<a href="#l28.460"></a><span id="l28.460"> {</span>
<a href="#l28.461"></a><span id="l28.461">   char * cmd = PR_smprintf(&quot;XSENDER %ld&quot; CRLF, m_pop3ConData-&gt;msg_info[m_pop3ConData-&gt;last_accessed_msg].msgnum);</span>
<a href="#l28.462"></a><span id="l28.462">   int32_t status = -1;</span>
<a href="#l28.463"></a><span id="l28.463">   if (cmd)</span>
<a href="#l28.464"></a><span id="l28.464">   {</span>
<a href="#l28.465"></a><span id="l28.465">     m_pop3ConData-&gt;next_state_after_response = POP3_XSENDER_RESPONSE;</span>
<a href="#l28.466"></a><span id="l28.466" class="difflineminus">-    status = SendData(cmd);</span>
<a href="#l28.467"></a><span id="l28.467" class="difflineplus">+    status = Pop3SendData(cmd);</span>
<a href="#l28.468"></a><span id="l28.468">     PR_Free(cmd);</span>
<a href="#l28.469"></a><span id="l28.469">   }</span>
<a href="#l28.470"></a><span id="l28.470">   return status;</span>
<a href="#l28.471"></a><span id="l28.471"> }</span>
<a href="#l28.472"></a><span id="l28.472"> </span>
<a href="#l28.473"></a><span id="l28.473"> int32_t nsPop3Protocol::XsenderResponse()</span>
<a href="#l28.474"></a><span id="l28.474"> {</span>
<a href="#l28.475"></a><span id="l28.475">     m_pop3ConData-&gt;seenFromHeader = false;</span>
<a href="#l28.476"></a><span id="l28.476" class="difflineat">@@ -3229,17 +3230,17 @@ nsPop3Protocol::SendRetr()</span>
<a href="#l28.477"></a><span id="l28.477">                           m_pop3ConData-&gt;really_new_messages,</span>
<a href="#l28.478"></a><span id="l28.478">                           finalString);</span>
<a href="#l28.479"></a><span id="l28.479"> </span>
<a href="#l28.480"></a><span id="l28.480">       NS_ASSERTION(NS_SUCCEEDED(rv), &quot;couldn't format string&quot;);</span>
<a href="#l28.481"></a><span id="l28.481">       if (m_statusFeedback)</span>
<a href="#l28.482"></a><span id="l28.482">         m_statusFeedback-&gt;ShowStatusString(finalString);</span>
<a href="#l28.483"></a><span id="l28.483">     }</span>
<a href="#l28.484"></a><span id="l28.484"> </span>
<a href="#l28.485"></a><span id="l28.485" class="difflineminus">-    status = SendData(cmd);</span>
<a href="#l28.486"></a><span id="l28.486" class="difflineplus">+    status = Pop3SendData(cmd);</span>
<a href="#l28.487"></a><span id="l28.487">   } // if cmd</span>
<a href="#l28.488"></a><span id="l28.488">   PR_Free(cmd);</span>
<a href="#l28.489"></a><span id="l28.489">   return status;</span>
<a href="#l28.490"></a><span id="l28.490"> }</span>
<a href="#l28.491"></a><span id="l28.491"> </span>
<a href="#l28.492"></a><span id="l28.492"> /* digest the message</span>
<a href="#l28.493"></a><span id="l28.493">  */</span>
<a href="#l28.494"></a><span id="l28.494"> int32_t</span>
<a href="#l28.495"></a><span id="l28.495" class="difflineat">@@ -3590,17 +3591,17 @@ int32_t nsPop3Protocol::SendDele()</span>
<a href="#l28.496"></a><span id="l28.496">     /* increment the last accessed message since we have now read it</span>
<a href="#l28.497"></a><span id="l28.497">      */</span>
<a href="#l28.498"></a><span id="l28.498">     char * cmd = PR_smprintf(&quot;DELE %ld&quot; CRLF, m_pop3ConData-&gt;msg_info[m_pop3ConData-&gt;last_accessed_msg].msgnum);</span>
<a href="#l28.499"></a><span id="l28.499">     m_pop3ConData-&gt;last_accessed_msg++;</span>
<a href="#l28.500"></a><span id="l28.500">     int32_t status = -1;</span>
<a href="#l28.501"></a><span id="l28.501">     if (cmd)</span>
<a href="#l28.502"></a><span id="l28.502">     {</span>
<a href="#l28.503"></a><span id="l28.503">       m_pop3ConData-&gt;next_state_after_response = POP3_DELE_RESPONSE;</span>
<a href="#l28.504"></a><span id="l28.504" class="difflineminus">-      status = SendData(cmd);</span>
<a href="#l28.505"></a><span id="l28.505" class="difflineplus">+      status = Pop3SendData(cmd);</span>
<a href="#l28.506"></a><span id="l28.506">     }</span>
<a href="#l28.507"></a><span id="l28.507">     PR_Free(cmd);</span>
<a href="#l28.508"></a><span id="l28.508">     return status;</span>
<a href="#l28.509"></a><span id="l28.509"> }</span>
<a href="#l28.510"></a><span id="l28.510"> </span>
<a href="#l28.511"></a><span id="l28.511"> int32_t nsPop3Protocol::DeleResponse()</span>
<a href="#l28.512"></a><span id="l28.512"> {</span>
<a href="#l28.513"></a><span id="l28.513">   Pop3UidlHost *host = NULL;</span>
<a href="#l28.514"></a><span id="l28.514" class="difflineat">@@ -4009,17 +4010,17 @@ nsresult nsPop3Protocol::ProcessProtocol</span>
<a href="#l28.515"></a><span id="l28.515">                                               m_pop3ConData-&gt;really_new_messages,</span>
<a href="#l28.516"></a><span id="l28.516">                                               statusString);</span>
<a href="#l28.517"></a><span id="l28.517">             if (NS_SUCCEEDED(rv))</span>
<a href="#l28.518"></a><span id="l28.518">               UpdateStatusWithString(statusString.get());</span>
<a href="#l28.519"></a><span id="l28.519">           }</span>
<a href="#l28.520"></a><span id="l28.520">         }</span>
<a href="#l28.521"></a><span id="l28.521">       }</span>
<a href="#l28.522"></a><span id="l28.522"> </span>
<a href="#l28.523"></a><span id="l28.523" class="difflineminus">-      status = SendData(&quot;QUIT&quot; CRLF);</span>
<a href="#l28.524"></a><span id="l28.524" class="difflineplus">+      status = Pop3SendData(&quot;QUIT&quot; CRLF);</span>
<a href="#l28.525"></a><span id="l28.525">       m_pop3ConData-&gt;next_state = POP3_WAIT_FOR_RESPONSE;</span>
<a href="#l28.526"></a><span id="l28.526">       m_pop3ConData-&gt;next_state_after_response = POP3_QUIT_RESPONSE;</span>
<a href="#l28.527"></a><span id="l28.527">       break;</span>
<a href="#l28.528"></a><span id="l28.528"> </span>
<a href="#l28.529"></a><span id="l28.529">     case POP3_QUIT_RESPONSE:</span>
<a href="#l28.530"></a><span id="l28.530">       if(m_pop3ConData-&gt;command_succeeded)</span>
<a href="#l28.531"></a><span id="l28.531">       {</span>
<a href="#l28.532"></a><span id="l28.532">       /*  the QUIT succeeded.  We can now flush the state in popstate.dat which</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -306,17 +306,17 @@ private:</span>
<a href="#l29.4"></a><span id="l29.4">   int32_t  m_totalFolderSize;</span>
<a href="#l29.5"></a><span id="l29.5">   int32_t  m_totalDownloadSize; /* Number of bytes we're going to</span>
<a href="#l29.6"></a><span id="l29.6">                                     download.  Might be much less</span>
<a href="#l29.7"></a><span id="l29.7">                                     than the total_folder_size. */</span>
<a href="#l29.8"></a><span id="l29.8">   int32_t m_totalBytesReceived; // total # bytes received for the connection</span>
<a href="#l29.9"></a><span id="l29.9"> </span>
<a href="#l29.10"></a><span id="l29.10">   virtual nsresult ProcessProtocolState(nsIURI * url, nsIInputStream * inputStream,</span>
<a href="#l29.11"></a><span id="l29.11">                                         uint64_t sourceOffset, uint32_t length);</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  virtual nsresult SendData(const char * dataBuffer, bool aSuppressLogging = false);</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+  virtual int32_t Pop3SendData(const char * dataBuffer, bool aSuppressLogging = false);</span>
<a href="#l29.14"></a><span id="l29.14"> </span>
<a href="#l29.15"></a><span id="l29.15">   virtual const char* GetType() {return &quot;pop3&quot;;}</span>
<a href="#l29.16"></a><span id="l29.16"> </span>
<a href="#l29.17"></a><span id="l29.17">   nsCOMPtr&lt;nsIURI&gt; m_url;</span>
<a href="#l29.18"></a><span id="l29.18">   nsCOMPtr&lt;nsIPop3Sink&gt; m_nsIPop3Sink;</span>
<a href="#l29.19"></a><span id="l29.19">   nsCOMPtr&lt;nsIPop3IncomingServer&gt; m_pop3Server;</span>
<a href="#l29.20"></a><span id="l29.20"> </span>
<a href="#l29.21"></a><span id="l29.21">   nsMsgLineStreamBuffer   * m_lineStreamBuffer; // used to efficiently extract lines from the incoming data stream</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/mime/src/mimedrft.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/mime/src/mimedrft.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -435,17 +435,17 @@ CreateCompositionFields(const char      </span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5">   return rv;</span>
<a href="#l30.6"></a><span id="l30.6"> }</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8"> static int</span>
<a href="#l30.9"></a><span id="l30.9"> dummy_file_write( char *buf, int32_t size, void *fileHandle )</span>
<a href="#l30.10"></a><span id="l30.10"> {</span>
<a href="#l30.11"></a><span id="l30.11">   if (!fileHandle)</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-    return NS_ERROR_FAILURE;</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+    return -1;</span>
<a href="#l30.14"></a><span id="l30.14"> </span>
<a href="#l30.15"></a><span id="l30.15">   nsIOutputStream  *tStream = (nsIOutputStream *) fileHandle;</span>
<a href="#l30.16"></a><span id="l30.16">   uint32_t bytesWritten;</span>
<a href="#l30.17"></a><span id="l30.17">   tStream-&gt;Write(buf, size, &amp;bytesWritten);</span>
<a href="#l30.18"></a><span id="l30.18">   return (int) bytesWritten;</span>
<a href="#l30.19"></a><span id="l30.19"> }</span>
<a href="#l30.20"></a><span id="l30.20"> </span>
<a href="#l30.21"></a><span id="l30.21"> static int</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/mime/src/mimehdrs.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/mime/src/mimehdrs.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -608,20 +608,24 @@ MimeHeaders_write_all_headers (MimeHeade</span>
<a href="#l31.4"></a><span id="l31.4">       nsAutoCString convertedStr;</span>
<a href="#l31.5"></a><span id="l31.5">       if (NS_SUCCEEDED(ConvertFromUnicode(charset, NS_ConvertUTF8toUTF16(hdr_value),</span>
<a href="#l31.6"></a><span id="l31.6">                        convertedStr)))</span>
<a href="#l31.7"></a><span id="l31.7">       {</span>
<a href="#l31.8"></a><span id="l31.8">         hdr_value = convertedStr;</span>
<a href="#l31.9"></a><span id="l31.9">       }</span>
<a href="#l31.10"></a><span id="l31.10">     }</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    if (attachment)</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-      status = mimeEmitterAddAttachmentField(opt, name.get(), hdr_value.get());</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-    else</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-      status = mimeEmitterAddHeaderField(opt, name.get(), hdr_value.get());</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+    if (attachment) {</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+      if (NS_FAILED(mimeEmitterAddAttachmentField(opt, name.get(), hdr_value.get())))</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineplus">+        status = -1;</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineplus">+    }</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineplus">+    else {</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineplus">+      if (NS_FAILED(mimeEmitterAddHeaderField(opt, name.get(), hdr_value.get())))</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineplus">+        status = -1;</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineplus">+    }</span>
<a href="#l31.24"></a><span id="l31.24"> </span>
<a href="#l31.25"></a><span id="l31.25">     if (status &lt; 0) return status;</span>
<a href="#l31.26"></a><span id="l31.26">     if (!wrote_any_p)</span>
<a href="#l31.27"></a><span id="l31.27">       wrote_any_p = (status &gt; 0);</span>
<a href="#l31.28"></a><span id="l31.28">   }</span>
<a href="#l31.29"></a><span id="l31.29">   mimeEmitterAddAllHeaders(opt, hdrs-&gt;all_headers, hdrs-&gt;all_headers_fp);</span>
<a href="#l31.30"></a><span id="l31.30">   PR_FREEIF(charset);</span>
<a href="#l31.31"></a><span id="l31.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/mime/src/mimemalt.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/mime/src/mimemalt.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -188,17 +188,17 @@ MimeMultipartAlternative_flush_children(</span>
<a href="#l32.4"></a><span id="l32.4">     6. Not finished, and the cache contains one non-displayable body:</span>
<a href="#l32.5"></a><span id="l32.5">        create it with output off.</span>
<a href="#l32.6"></a><span id="l32.6">   */</span>
<a href="#l32.7"></a><span id="l32.7">   MimeMultipartAlternative *malt = (MimeMultipartAlternative *) obj;</span>
<a href="#l32.8"></a><span id="l32.8">   bool have_displayable, do_flush, do_display;</span>
<a href="#l32.9"></a><span id="l32.9"> </span>
<a href="#l32.10"></a><span id="l32.10">   /* Case 1 */</span>
<a href="#l32.11"></a><span id="l32.11">   if (! malt-&gt;pending_parts)</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-    return NS_OK;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+    return 0;</span>
<a href="#l32.14"></a><span id="l32.14"> </span>
<a href="#l32.15"></a><span id="l32.15">   have_displayable =</span>
<a href="#l32.16"></a><span id="l32.16">     MimeMultipartAlternative_display_part_p(obj, malt-&gt;buffered_hdrs[0]);</span>
<a href="#l32.17"></a><span id="l32.17">   </span>
<a href="#l32.18"></a><span id="l32.18">   if (finished &amp;&amp; have_displayable) {</span>
<a href="#l32.19"></a><span id="l32.19">     /* Case 2 */</span>
<a href="#l32.20"></a><span id="l32.20">     do_flush = true;</span>
<a href="#l32.21"></a><span id="l32.21">     do_display = true;</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineat">@@ -220,32 +220,32 @@ MimeMultipartAlternative_flush_children(</span>
<a href="#l32.23"></a><span id="l32.23">   }</span>
<a href="#l32.24"></a><span id="l32.24">   else if (! finished &amp;&amp; ! have_displayable) {</span>
<a href="#l32.25"></a><span id="l32.25">     /* Case 6 */</span>
<a href="#l32.26"></a><span id="l32.26">     do_flush = true;</span>
<a href="#l32.27"></a><span id="l32.27">     do_display = false;</span>
<a href="#l32.28"></a><span id="l32.28">   }</span>
<a href="#l32.29"></a><span id="l32.29">   else {</span>
<a href="#l32.30"></a><span id="l32.30">     NS_ERROR(&quot;mimemalt.cpp: logic error in flush_children&quot;);</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-    return NS_ERROR_FAILURE;</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+    return -1;</span>
<a href="#l32.33"></a><span id="l32.33">   }</span>
<a href="#l32.34"></a><span id="l32.34">   </span>
<a href="#l32.35"></a><span id="l32.35">   if (do_flush) {</span>
<a href="#l32.36"></a><span id="l32.36">     int32_t i;</span>
<a href="#l32.37"></a><span id="l32.37">     for (i = 0; i &lt; malt-&gt;pending_parts; i++) {</span>
<a href="#l32.38"></a><span id="l32.38">       MimeMultipartAlternative_display_cached_part(obj,</span>
<a href="#l32.39"></a><span id="l32.39">                                                    malt-&gt;buffered_hdrs[i],</span>
<a href="#l32.40"></a><span id="l32.40">                                                    malt-&gt;part_buffers[i],</span>
<a href="#l32.41"></a><span id="l32.41">                                                    do_display &amp;&amp; (i == 0));</span>
<a href="#l32.42"></a><span id="l32.42">       MimeHeaders_free(malt-&gt;buffered_hdrs[i]);</span>
<a href="#l32.43"></a><span id="l32.43">       MimePartBufferDestroy(malt-&gt;part_buffers[i]);</span>
<a href="#l32.44"></a><span id="l32.44">     }</span>
<a href="#l32.45"></a><span id="l32.45">     malt-&gt;pending_parts = 0;</span>
<a href="#l32.46"></a><span id="l32.46">   }</span>
<a href="#l32.47"></a><span id="l32.47" class="difflineminus">-  return NS_OK;</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineplus">+  return 0;</span>
<a href="#l32.49"></a><span id="l32.49"> }</span>
<a href="#l32.50"></a><span id="l32.50"> </span>
<a href="#l32.51"></a><span id="l32.51"> static int</span>
<a href="#l32.52"></a><span id="l32.52"> MimeMultipartAlternative_parse_eof (MimeObject *obj, bool abort_p)</span>
<a href="#l32.53"></a><span id="l32.53"> {</span>
<a href="#l32.54"></a><span id="l32.54">   int status = 0;</span>
<a href="#l32.55"></a><span id="l32.55"> </span>
<a href="#l32.56"></a><span id="l32.56">   if (obj-&gt;closed_p) return 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/mime/src/mimemrel.cpp</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/mime/src/mimemrel.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -387,28 +387,28 @@ MakeAbsoluteURL(char *base_url, char *re</span>
<a href="#l33.4"></a><span id="l33.4">     if (!relative_url)</span>
<a href="#l33.5"></a><span id="l33.5">       return nullptr;</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7">     NS_MsgSACopy(&amp;retString, relative_url);</span>
<a href="#l33.8"></a><span id="l33.8">     return retString;</span>
<a href="#l33.9"></a><span id="l33.9">   }</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11">   nsresult err = nsMimeNewURI(&amp;base, base_url, nullptr);</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  if (err != NS_OK)</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+  if (NS_FAILED(err))</span>
<a href="#l33.14"></a><span id="l33.14">     return nullptr;</span>
<a href="#l33.15"></a><span id="l33.15"> </span>
<a href="#l33.16"></a><span id="l33.16">   nsAutoCString spec;</span>
<a href="#l33.17"></a><span id="l33.17"> </span>
<a href="#l33.18"></a><span id="l33.18">   nsIURI    *url = nullptr;</span>
<a href="#l33.19"></a><span id="l33.19">   err = nsMimeNewURI(&amp;url, relative_url, base);</span>
<a href="#l33.20"></a><span id="l33.20" class="difflineminus">-  if (err != NS_OK)</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineplus">+  if (NS_FAILED(err))</span>
<a href="#l33.22"></a><span id="l33.22">     goto done;</span>
<a href="#l33.23"></a><span id="l33.23"> </span>
<a href="#l33.24"></a><span id="l33.24">   err = url-&gt;GetSpec(spec);</span>
<a href="#l33.25"></a><span id="l33.25" class="difflineminus">-  if (err)</span>
<a href="#l33.26"></a><span id="l33.26" class="difflineplus">+  if (NS_FAILED(err))</span>
<a href="#l33.27"></a><span id="l33.27">   {</span>
<a href="#l33.28"></a><span id="l33.28">     retString = nullptr;</span>
<a href="#l33.29"></a><span id="l33.29">     goto done;</span>
<a href="#l33.30"></a><span id="l33.30">   }</span>
<a href="#l33.31"></a><span id="l33.31">   retString = ToNewCString(spec);</span>
<a href="#l33.32"></a><span id="l33.32"> </span>
<a href="#l33.33"></a><span id="l33.33"> done:</span>
<a href="#l33.34"></a><span id="l33.34">   NS_IF_RELEASE(url);</span>
<a href="#l33.35"></a><span id="l33.35" class="difflineat">@@ -652,21 +652,21 @@ MimeMultipartRelated_parse_child_line (M</span>
<a href="#l33.36"></a><span id="l33.36"> </span>
<a href="#l33.37"></a><span id="l33.37">   nsresult rv;</span>
<a href="#l33.38"></a><span id="l33.38">   /* Ok, if at this point we still don't have either kind of buffer, try and</span>
<a href="#l33.39"></a><span id="l33.39">      make a file buffer. */</span>
<a href="#l33.40"></a><span id="l33.40">   if (!relobj-&gt;head_buffer &amp;&amp; !relobj-&gt;file_buffer)</span>
<a href="#l33.41"></a><span id="l33.41">   {</span>
<a href="#l33.42"></a><span id="l33.42">     nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l33.43"></a><span id="l33.43">     rv = nsMsgCreateTempFile(&quot;nsma&quot;, getter_AddRefs(file));</span>
<a href="#l33.44"></a><span id="l33.44" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.45"></a><span id="l33.45" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l33.46"></a><span id="l33.46">     relobj-&gt;file_buffer = do_QueryInterface(file);</span>
<a href="#l33.47"></a><span id="l33.47"> </span>
<a href="#l33.48"></a><span id="l33.48">     rv = MsgNewBufferedFileOutputStream(getter_AddRefs(relobj-&gt;output_file_stream), relobj-&gt;file_buffer, PR_WRONLY | PR_CREATE_FILE, 00600);</span>
<a href="#l33.49"></a><span id="l33.49" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l33.51"></a><span id="l33.51">   }</span>
<a href="#l33.52"></a><span id="l33.52"> </span>
<a href="#l33.53"></a><span id="l33.53">   PR_ASSERT(relobj-&gt;head_buffer || relobj-&gt;output_file_stream);</span>
<a href="#l33.54"></a><span id="l33.54"> </span>
<a href="#l33.55"></a><span id="l33.55"> </span>
<a href="#l33.56"></a><span id="l33.56">   /* If this line will fit in the memory buffer, put it there.</span>
<a href="#l33.57"></a><span id="l33.57">    */</span>
<a href="#l33.58"></a><span id="l33.58">   if (relobj-&gt;head_buffer &amp;&amp;</span>
<a href="#l33.59"></a><span id="l33.59" class="difflineat">@@ -679,30 +679,28 @@ MimeMultipartRelated_parse_child_line (M</span>
<a href="#l33.60"></a><span id="l33.60">     /* If the file isn't open yet, open it, and dump the memory buffer</span>
<a href="#l33.61"></a><span id="l33.61">        to it. */</span>
<a href="#l33.62"></a><span id="l33.62">     if (!relobj-&gt;output_file_stream)</span>
<a href="#l33.63"></a><span id="l33.63">     {</span>
<a href="#l33.64"></a><span id="l33.64">       if (!relobj-&gt;file_buffer)</span>
<a href="#l33.65"></a><span id="l33.65">       {</span>
<a href="#l33.66"></a><span id="l33.66">         nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l33.67"></a><span id="l33.67">         rv = nsMsgCreateTempFile(&quot;nsma&quot;, getter_AddRefs(file));</span>
<a href="#l33.68"></a><span id="l33.68" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.69"></a><span id="l33.69" class="difflineplus">+        NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l33.70"></a><span id="l33.70">         relobj-&gt;file_buffer = do_QueryInterface(file);</span>
<a href="#l33.71"></a><span id="l33.71">       }</span>
<a href="#l33.72"></a><span id="l33.72"> </span>
<a href="#l33.73"></a><span id="l33.73">       nsresult rv = MsgNewBufferedFileOutputStream(getter_AddRefs(relobj-&gt;output_file_stream), relobj-&gt;file_buffer, PR_WRONLY | PR_CREATE_FILE, 00600);</span>
<a href="#l33.74"></a><span id="l33.74" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.75"></a><span id="l33.75" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l33.76"></a><span id="l33.76"> </span>
<a href="#l33.77"></a><span id="l33.77">       if (relobj-&gt;head_buffer &amp;&amp; relobj-&gt;head_buffer_fp)</span>
<a href="#l33.78"></a><span id="l33.78">       {</span>
<a href="#l33.79"></a><span id="l33.79">         uint32_t bytesWritten;</span>
<a href="#l33.80"></a><span id="l33.80" class="difflineminus">-        status = relobj-&gt;output_file_stream-&gt;Write(relobj-&gt;head_buffer,</span>
<a href="#l33.81"></a><span id="l33.81" class="difflineminus">-                                                   relobj-&gt;head_buffer_fp,</span>
<a href="#l33.82"></a><span id="l33.82" class="difflineminus">-                                                   &amp;bytesWritten);</span>
<a href="#l33.83"></a><span id="l33.83" class="difflineminus">-        if (bytesWritten &lt; relobj-&gt;head_buffer_fp)</span>
<a href="#l33.84"></a><span id="l33.84" class="difflineplus">+        rv = relobj-&gt;output_file_stream-&gt;Write(relobj-&gt;head_buffer, relobj-&gt;head_buffer_fp, &amp;bytesWritten);</span>
<a href="#l33.85"></a><span id="l33.85" class="difflineplus">+        if (NS_FAILED(rv) || (bytesWritten &lt; relobj-&gt;head_buffer_fp))</span>
<a href="#l33.86"></a><span id="l33.86">           return MIME_UNABLE_TO_OPEN_TMP_FILE;</span>
<a href="#l33.87"></a><span id="l33.87">       }</span>
<a href="#l33.88"></a><span id="l33.88"> </span>
<a href="#l33.89"></a><span id="l33.89">       PR_FREEIF(relobj-&gt;head_buffer);</span>
<a href="#l33.90"></a><span id="l33.90">       relobj-&gt;head_buffer_fp = 0;</span>
<a href="#l33.91"></a><span id="l33.91">       relobj-&gt;head_buffer_size = 0;</span>
<a href="#l33.92"></a><span id="l33.92">     }</span>
<a href="#l33.93"></a><span id="l33.93"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/mime/src/mimepbuf.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/mime/src/mimepbuf.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -166,17 +166,17 @@ MimePartBufferWrite (MimePartBufferData </span>
<a href="#l34.4"></a><span id="l34.4">   if (!data-&gt;part_buffer &amp;&amp; !data-&gt;file_buffer)</span>
<a href="#l34.5"></a><span id="l34.5">   {</span>
<a href="#l34.6"></a><span id="l34.6">     nsCOMPtr &lt;nsIFile&gt; tmpFile;</span>
<a href="#l34.7"></a><span id="l34.7">     nsresult rv = nsMsgCreateTempFile(&quot;nsma&quot;, getter_AddRefs(tmpFile));</span>
<a href="#l34.8"></a><span id="l34.8">     NS_ENSURE_SUCCESS(rv, MIME_UNABLE_TO_OPEN_TMP_FILE);</span>
<a href="#l34.9"></a><span id="l34.9">     data-&gt;file_buffer = do_QueryInterface(tmpFile);</span>
<a href="#l34.10"></a><span id="l34.10"> </span>
<a href="#l34.11"></a><span id="l34.11">     rv = MsgNewBufferedFileOutputStream(getter_AddRefs(data-&gt;output_file_stream), data-&gt;file_buffer, PR_WRONLY | PR_CREATE_FILE, 00600);</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, MIME_UNABLE_TO_OPEN_TMP_FILE);</span>
<a href="#l34.14"></a><span id="l34.14">   }</span>
<a href="#l34.15"></a><span id="l34.15"> </span>
<a href="#l34.16"></a><span id="l34.16">   NS_ASSERTION(data-&gt;part_buffer || data-&gt;output_file_stream, &quot;no part_buffer or file_stream&quot;);</span>
<a href="#l34.17"></a><span id="l34.17"> </span>
<a href="#l34.18"></a><span id="l34.18">   /* If this buf will fit in the memory buffer, put it there.</span>
<a href="#l34.19"></a><span id="l34.19">     */</span>
<a href="#l34.20"></a><span id="l34.20">   if (data-&gt;part_buffer &amp;&amp;</span>
<a href="#l34.21"></a><span id="l34.21">       data-&gt;part_buffer_fp + size &lt; data-&gt;part_buffer_size)</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineat">@@ -206,17 +206,17 @@ MimePartBufferWrite (MimePartBufferData </span>
<a href="#l34.23"></a><span id="l34.23">       rv = MsgNewBufferedFileOutputStream(getter_AddRefs(data-&gt;output_file_stream), data-&gt;file_buffer, PR_WRONLY | PR_CREATE_FILE, 00600);</span>
<a href="#l34.24"></a><span id="l34.24">       NS_ENSURE_SUCCESS(rv, MIME_UNABLE_TO_OPEN_TMP_FILE);</span>
<a href="#l34.25"></a><span id="l34.25"> </span>
<a href="#l34.26"></a><span id="l34.26">       if (data-&gt;part_buffer &amp;&amp; data-&gt;part_buffer_fp)</span>
<a href="#l34.27"></a><span id="l34.27">       {</span>
<a href="#l34.28"></a><span id="l34.28">         uint32_t bytesWritten;</span>
<a href="#l34.29"></a><span id="l34.29">         nsresult rv = data-&gt;output_file_stream-&gt;Write(data-&gt;part_buffer,</span>
<a href="#l34.30"></a><span id="l34.30">                                                  data-&gt;part_buffer_fp, &amp;bytesWritten);</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+        NS_ENSURE_SUCCESS(rv, MIME_ERROR_WRITING_FILE);</span>
<a href="#l34.33"></a><span id="l34.33">       }</span>
<a href="#l34.34"></a><span id="l34.34"> </span>
<a href="#l34.35"></a><span id="l34.35">       PR_FREEIF(data-&gt;part_buffer);</span>
<a href="#l34.36"></a><span id="l34.36">       data-&gt;part_buffer_fp = 0;</span>
<a href="#l34.37"></a><span id="l34.37">       data-&gt;part_buffer_size = 0;</span>
<a href="#l34.38"></a><span id="l34.38">     }</span>
<a href="#l34.39"></a><span id="l34.39"> </span>
<a href="#l34.40"></a><span id="l34.40">     /* Dump this buf to the file. */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/mime/src/mimetpfl.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpfl.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -375,17 +375,17 @@ MimeInlineTextPlainFlowed_parse_line (co</span>
<a href="#l35.4"></a><span id="l35.4">       // escaping (very important), eventually recognizing etc.</span>
<a href="#l35.5"></a><span id="l35.5">       rv = conv-&gt;ScanTXT(lineSource.get(), whattodo, getter_Copies(lineResult));</span>
<a href="#l35.6"></a><span id="l35.6">       NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l35.7"></a><span id="l35.7">     }</span>
<a href="#l35.8"></a><span id="l35.8">   }</span>
<a href="#l35.9"></a><span id="l35.9">   else</span>
<a href="#l35.10"></a><span id="l35.10">   {</span>
<a href="#l35.11"></a><span id="l35.11">     CopyUTF8toUTF16(nsDependentCString(line, length), lineResult);</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-    status = NS_OK;</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+    status = 0;</span>
<a href="#l35.14"></a><span id="l35.14">   }</span>
<a href="#l35.15"></a><span id="l35.15"> </span>
<a href="#l35.16"></a><span id="l35.16">   nsAutoCString preface;</span>
<a href="#l35.17"></a><span id="l35.17"> </span>
<a href="#l35.18"></a><span id="l35.18">   /* Correct number of blockquotes */</span>
<a href="#l35.19"></a><span id="l35.19">   int32 quoteleveldiff=linequotelevel - exdata-&gt;quotelevel;</span>
<a href="#l35.20"></a><span id="l35.20">   if((quoteleveldiff != 0) &amp;&amp; flowed &amp;&amp; exdata-&gt;inflow) {</span>
<a href="#l35.21"></a><span id="l35.21">     // From RFC 2646 4.5</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -462,17 +462,17 @@ MimeInlineTextPlainFlowed_parse_line (co</span>
<a href="#l35.23"></a><span id="l35.23">     { // convert back to mailCharset before writing.</span>
<a href="#l35.24"></a><span id="l35.24">       rv = nsMsgI18NConvertFromUnicode(mailCharset, lineResult2, outString);</span>
<a href="#l35.25"></a><span id="l35.25">       NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l35.26"></a><span id="l35.26">     }</span>
<a href="#l35.27"></a><span id="l35.27">     status = MimeObject_write(obj, outString.get(), outString.Length(), true);</span>
<a href="#l35.28"></a><span id="l35.28">     return status;</span>
<a href="#l35.29"></a><span id="l35.29">   }</span>
<a href="#l35.30"></a><span id="l35.30">   else</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-    return NS_OK;</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+    return 0;</span>
<a href="#l35.33"></a><span id="l35.33"> }</span>
<a href="#l35.34"></a><span id="l35.34"> </span>
<a href="#l35.35"></a><span id="l35.35"> </span>
<a href="#l35.36"></a><span id="l35.36"> /**</span>
<a href="#l35.37"></a><span id="l35.37">  * Maintains a small state machine with three states. &quot;Not in tag&quot;,</span>
<a href="#l35.38"></a><span id="l35.38">  * &quot;In tag, but not in quote&quot; and &quot;In quote inside a tag&quot;. It also</span>
<a href="#l35.39"></a><span id="l35.39">  * remembers what character started the quote (&quot; or '). The state</span>
<a href="#l35.40"></a><span id="l35.40">  * variables are kept outside this function and are included as</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/mime/src/mimetpla.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpla.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -431,17 +431,17 @@ MimeInlineTextPlain_parse_line (const ch</span>
<a href="#l36.4"></a><span id="l36.4">                                          lineResultUnichar, outString);</span>
<a href="#l36.5"></a><span id="l36.5">         NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l36.6"></a><span id="l36.6">       }</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8">       status = MimeObject_write(obj, outString.get(), outString.Length(), true);</span>
<a href="#l36.9"></a><span id="l36.9">     }</span>
<a href="#l36.10"></a><span id="l36.10">     else</span>
<a href="#l36.11"></a><span id="l36.11">     {</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-      status = NS_OK;</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+      status = 0;</span>
<a href="#l36.14"></a><span id="l36.14">     }</span>
<a href="#l36.15"></a><span id="l36.15">   }</span>
<a href="#l36.16"></a><span id="l36.16">   else</span>
<a href="#l36.17"></a><span id="l36.17">   {</span>
<a href="#l36.18"></a><span id="l36.18">     status = MimeObject_write(obj, line, length, true);</span>
<a href="#l36.19"></a><span id="l36.19">   }</span>
<a href="#l36.20"></a><span id="l36.20"> </span>
<a href="#l36.21"></a><span id="l36.21">   return status;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/mime/src/nsMsgHeaderParser.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/mime/src/nsMsgHeaderParser.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -398,23 +398,23 @@ static int msg_parse_Header_addresses (c</span>
<a href="#l37.4"></a><span id="l37.4">   if (!line)</span>
<a href="#l37.5"></a><span id="l37.5">     return -1;</span>
<a href="#l37.6"></a><span id="l37.6">   line_length = strlen(line);</span>
<a href="#l37.7"></a><span id="l37.7">   if (line_length == 0)</span>
<a href="#l37.8"></a><span id="l37.8">     return 0;</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10">   name_buf = (char *)PR_Malloc(line_length * 2 + 10);</span>
<a href="#l37.11"></a><span id="l37.11">   if (!name_buf)</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+    return -1;</span>
<a href="#l37.14"></a><span id="l37.14"> </span>
<a href="#l37.15"></a><span id="l37.15">   addr_buf = (char *)PR_Malloc(line_length * 2 + 10);</span>
<a href="#l37.16"></a><span id="l37.16">   if (!addr_buf)</span>
<a href="#l37.17"></a><span id="l37.17">   {</span>
<a href="#l37.18"></a><span id="l37.18">     FREEIF(name_buf);</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l37.20"></a><span id="l37.20" class="difflineplus">+    return -1;</span>
<a href="#l37.21"></a><span id="l37.21">   }</span>
<a href="#l37.22"></a><span id="l37.22"> </span>
<a href="#l37.23"></a><span id="l37.23">   line_end = line;</span>
<a href="#l37.24"></a><span id="l37.24">   addr_out = addr_buf;</span>
<a href="#l37.25"></a><span id="l37.25">   name_out = name_buf;</span>
<a href="#l37.26"></a><span id="l37.26">   name_start = name_buf;</span>
<a href="#l37.27"></a><span id="l37.27">   addr_start = addr_buf;</span>
<a href="#l37.28"></a><span id="l37.28">   this_start = line;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1199,24 +1199,26 @@ nsNntpIncomingServer::Unsubscribe(const </span>
<a href="#l38.4"></a><span id="l38.4">   // since we've unsubscribed to a newsgroup, the newsrc needs to be written out</span>
<a href="#l38.5"></a><span id="l38.5">   rv = SetNewsrcHasChanged(true);</span>
<a href="#l38.6"></a><span id="l38.6">   if (NS_FAILED(rv))</span>
<a href="#l38.7"></a><span id="l38.7">     return rv;</span>
<a href="#l38.8"></a><span id="l38.8"> </span>
<a href="#l38.9"></a><span id="l38.9">   return NS_OK;</span>
<a href="#l38.10"></a><span id="l38.10"> }</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-int32_t</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+nsresult</span>
<a href="#l38.14"></a><span id="l38.14"> nsNntpIncomingServer::HandleLine(const char* line, uint32_t line_size)</span>
<a href="#l38.15"></a><span id="l38.15"> {</span>
<a href="#l38.16"></a><span id="l38.16">   NS_ASSERTION(line, &quot;line is null&quot;);</span>
<a href="#l38.17"></a><span id="l38.17" class="difflineminus">-  if (!line) return 0;</span>
<a href="#l38.18"></a><span id="l38.18" class="difflineplus">+  if (!line)</span>
<a href="#l38.19"></a><span id="l38.19" class="difflineplus">+    return NS_OK;</span>
<a href="#l38.20"></a><span id="l38.20"> </span>
<a href="#l38.21"></a><span id="l38.21">   // skip blank lines and comments</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineminus">-  if (line[0] == '#' || line[0] == '\0') return 0;</span>
<a href="#l38.23"></a><span id="l38.23" class="difflineplus">+  if (line[0] == '#' || line[0] == '\0')</span>
<a href="#l38.24"></a><span id="l38.24" class="difflineplus">+    return NS_OK;</span>
<a href="#l38.25"></a><span id="l38.25">   // ###TODO - make this truly const, maybe pass in an nsCString &amp;</span>
<a href="#l38.26"></a><span id="l38.26"> </span>
<a href="#l38.27"></a><span id="l38.27">   if (mHasSeenBeginGroups) {</span>
<a href="#l38.28"></a><span id="l38.28">     // v1 hostinfo files had additional data fields delimited by commas.</span>
<a href="#l38.29"></a><span id="l38.29">     // with v2 hostinfo files, the additional data fields are removed.</span>
<a href="#l38.30"></a><span id="l38.30">     char *commaPos = (char *) PL_strchr(line,',');</span>
<a href="#l38.31"></a><span id="l38.31">     if (commaPos) *commaPos = 0;</span>
<a href="#l38.32"></a><span id="l38.32"> </span>
<a href="#l38.33"></a><span id="l38.33" class="difflineat">@@ -1246,17 +1248,17 @@ nsNntpIncomingServer::HandleLine(const c</span>
<a href="#l38.34"></a><span id="l38.34">       } else if (PL_strcmp(line, &quot;uniqueid&quot;) == 0) {</span>
<a href="#l38.35"></a><span id="l38.35">         mUniqueId = strtol(equalPos, nullptr, 16);</span>
<a href="#l38.36"></a><span id="l38.36">       } else if (PL_strcmp(line, &quot;version&quot;) == 0) {</span>
<a href="#l38.37"></a><span id="l38.37">         mVersion = strtol(equalPos, nullptr, 16);</span>
<a href="#l38.38"></a><span id="l38.38">       }</span>
<a href="#l38.39"></a><span id="l38.39">     }</span>
<a href="#l38.40"></a><span id="l38.40">   }</span>
<a href="#l38.41"></a><span id="l38.41"> </span>
<a href="#l38.42"></a><span id="l38.42" class="difflineminus">-  return 0;</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineplus">+  return NS_OK;</span>
<a href="#l38.44"></a><span id="l38.44"> }</span>
<a href="#l38.45"></a><span id="l38.45"> </span>
<a href="#l38.46"></a><span id="l38.46"> nsresult</span>
<a href="#l38.47"></a><span id="l38.47"> nsNntpIncomingServer::AddGroupOnServer(const nsACString &amp;aName)</span>
<a href="#l38.48"></a><span id="l38.48"> {</span>
<a href="#l38.49"></a><span id="l38.49">   mGroupsOnServer.AppendElement(aName);</span>
<a href="#l38.50"></a><span id="l38.50">   return NS_OK;</span>
<a href="#l38.51"></a><span id="l38.51"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.h</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.h</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -53,17 +53,17 @@ public:</span>
<a href="#l39.4"></a><span id="l39.4">     NS_IMETHOD CloseCachedConnections();</span>
<a href="#l39.5"></a><span id="l39.5">     NS_IMETHOD PerformBiff(nsIMsgWindow *aMsgWindow);</span>
<a href="#l39.6"></a><span id="l39.6">     NS_IMETHOD PerformExpand(nsIMsgWindow *aMsgWindow);</span>
<a href="#l39.7"></a><span id="l39.7">     NS_IMETHOD OnUserOrHostNameChanged(const nsACString&amp; oldName,</span>
<a href="#l39.8"></a><span id="l39.8">                                        const nsACString&amp; newName,</span>
<a href="#l39.9"></a><span id="l39.9">                                        bool hostnameChanged);</span>
<a href="#l39.10"></a><span id="l39.10"> </span>
<a href="#l39.11"></a><span id="l39.11">     // for nsMsgLineBuffer</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-    virtual int32_t HandleLine(const char *line, uint32_t line_size);</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+    virtual nsresult HandleLine(const char *line, uint32_t line_size);</span>
<a href="#l39.14"></a><span id="l39.14"> </span>
<a href="#l39.15"></a><span id="l39.15">     // override to clear all passwords associated with server</span>
<a href="#l39.16"></a><span id="l39.16">     NS_IMETHODIMP ForgetPassword();</span>
<a href="#l39.17"></a><span id="l39.17">     NS_IMETHOD GetCanSearchMessages(bool *canSearchMessages);</span>
<a href="#l39.18"></a><span id="l39.18">     NS_IMETHOD GetOfflineSupportLevel(int32_t *aSupportLevel);</span>
<a href="#l39.19"></a><span id="l39.19">     NS_IMETHOD GetDefaultCopiesAndFoldersPrefsToServer(bool *aCopiesAndFoldersOnServer);</span>
<a href="#l39.20"></a><span id="l39.20">     NS_IMETHOD GetCanCreateFoldersOnServer(bool *aCanCreateFoldersOnServer);</span>
<a href="#l39.21"></a><span id="l39.21">     NS_IMETHOD GetCanFileMessagesOnServer(bool *aCanFileMessagesOnServer);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

