<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26020:6329bd856957630c38562298cd379dfff91e5e9f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 6329bd856957630c38562298cd379dfff91e5e9f" />
<meta property="og:url" content="/comm-central/rev/6329bd856957630c38562298cd379dfff91e5e9f" />
<meta property="og:description" content="Bug 1530532 - Minimise uses of Preferences.jsm; r=Fallen DONTBUILD" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 6329bd856957630c38562298cd379dfff91e5e9f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/6329bd856957630c38562298cd379dfff91e5e9f">shortlog</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/6329bd856957630c38562298cd379dfff91e5e9f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f">files</a> |
changeset |
<a href="/comm-central/raw-rev/6329bd856957630c38562298cd379dfff91e5e9f">raw</a>  | <a href="/comm-central/archive/6329bd856957630c38562298cd379dfff91e5e9f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1530532">Bug 1530532</a> - Minimise uses of Preferences.jsm; r=Fallen DONTBUILD
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 05 Mar 2019 21:58:09 +1300</td></tr>

<tr>
 <td>changeset 26020</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/6329bd856957630c38562298cd379dfff91e5e9f">6329bd856957630c38562298cd379dfff91e5e9f</a></td>
</tr>



<tr>
<td>parent 26019</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0663b659b91cd893dab25beccc72f3e29adaede4">0663b659b91cd893dab25beccc72f3e29adaede4</a>
</td>
</tr>

<tr>
<td>child 26021</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/92aaaaf8c66c6869e44f96bb21f7f9757fa4f552">92aaaaf8c66c6869e44f96bb21f7f9757fa4f552</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=6329bd856957630c38562298cd379dfff91e5e9f">15613</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Tue, 05 Mar 2019 09:01:09 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@6329bd856957 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6329bd856957630c38562298cd379dfff91e5e9f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6329bd856957630c38562298cd379dfff91e5e9f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6329bd856957630c38562298cd379dfff91e5e9f&newProject=comm-central&newRevision=6329bd856957630c38562298cd379dfff91e5e9f&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6329bd856957630c38562298cd379dfff91e5e9f&newProject=comm-central&newRevision=6329bd856957630c38562298cd379dfff91e5e9f&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6329bd856957630c38562298cd379dfff91e5e9f&newProject=comm-central&newRevision=6329bd856957630c38562298cd379dfff91e5e9f&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Fallen%29&revcount=50">Fallen</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1530532">1530532</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1530532">Bug 1530532</a> - Minimise uses of Preferences.jsm; r=Fallen DONTBUILD</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/backend/calBackendLoader.js">calendar/base/backend/calBackendLoader.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/backend/calBackendLoader.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/backend/calBackendLoader.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/backend/calBackendLoader.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/backend/calBackendLoader.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/backend/calBackendLoader.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-chrome-startup.js">calendar/base/content/calendar-chrome-startup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-chrome-startup.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-chrome-startup.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-chrome-startup.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-chrome-startup.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-chrome-startup.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-clipboard.js">calendar/base/content/calendar-clipboard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-clipboard.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-clipboard.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-clipboard.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-clipboard.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-clipboard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-dnd-listener.js">calendar/base/content/calendar-dnd-listener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-dnd-listener.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-dnd-listener.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-dnd-listener.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-dnd-listener.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-dnd-listener.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-extract.js">calendar/base/content/calendar-extract.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-extract.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-extract.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-extract.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-extract.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-extract.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-invitations-manager.js">calendar/base/content/calendar-invitations-manager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-invitations-manager.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-invitations-manager.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-invitations-manager.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-invitations-manager.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-invitations-manager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-item-editing.js">calendar/base/content/calendar-item-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-item-editing.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-item-editing.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-item-editing.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-item-editing.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-item-editing.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-management.js">calendar/base/content/calendar-management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-management.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-management.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-management.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-management.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-management.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-month-view.xml">calendar/base/content/calendar-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-month-view.xml">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-month-view.xml">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-month-view.xml">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-month-view.xml">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-view-core.xml">calendar/base/content/calendar-view-core.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-view-core.xml">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-view-core.xml">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-view-core.xml">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-view-core.xml">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-view-core.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.xml">calendar/base/content/calendar-views.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.xml">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.xml">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.xml">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.xml">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/calendar-views.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-alarm-dialog.js">calendar/base/content/dialogs/calendar-alarm-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-alarm-dialog.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-alarm-dialog.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-alarm-dialog.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-alarm-dialog.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-alarm-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">calendar/base/content/dialogs/calendar-event-dialog-attendees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">calendar/base/content/dialogs/calendar-event-dialog-reminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-migration-dialog.js">calendar/base/content/dialogs/calendar-migration-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-migration-dialog.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-migration-dialog.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-migration-dialog.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-migration-dialog.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/dialogs/calendar-migration-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/today-pane.js">calendar/base/content/today-pane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/today-pane.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/today-pane.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/today-pane.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/today-pane.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/today-pane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/calendar-alarm-widget.xml">calendar/base/content/widgets/calendar-alarm-widget.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/calendar-alarm-widget.xml">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/calendar-alarm-widget.xml">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/calendar-alarm-widget.xml">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/calendar-alarm-widget.xml">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/calendar-alarm-widget.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calExtract.jsm">calendar/base/modules/calExtract.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calExtract.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calExtract.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calExtract.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calExtract.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calExtract.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calUtils.jsm">calendar/base/modules/calUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/calUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAlarmUtils.jsm">calendar/base/modules/utils/calAlarmUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAlarmUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAlarmUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAlarmUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAlarmUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAlarmUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAuthUtils.jsm">calendar/base/modules/utils/calAuthUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAuthUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAuthUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAuthUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAuthUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calAuthUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calCategoryUtils.jsm">calendar/base/modules/utils/calCategoryUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calCategoryUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calCategoryUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calCategoryUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calCategoryUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calCategoryUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calDateTimeUtils.jsm">calendar/base/modules/utils/calDateTimeUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calDateTimeUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calDateTimeUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calDateTimeUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calDateTimeUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calDateTimeUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItemUtils.jsm">calendar/base/modules/utils/calItemUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItemUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItemUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItemUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItemUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItemUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calIteratorUtils.jsm">calendar/base/modules/utils/calIteratorUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calIteratorUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calIteratorUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calIteratorUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calIteratorUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calIteratorUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItipUtils.jsm">calendar/base/modules/utils/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calPrintUtils.jsm">calendar/base/modules/utils/calPrintUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calPrintUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calPrintUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calPrintUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calPrintUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calPrintUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calProviderUtils.jsm">calendar/base/modules/utils/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/modules/utils/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmMonitor.js">calendar/base/src/calAlarmMonitor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmMonitor.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmMonitor.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmMonitor.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmMonitor.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmMonitor.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmService.js">calendar/base/src/calAlarmService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmService.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmService.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmService.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmService.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calAlarmService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCachedCalendar.js">calendar/base/src/calCachedCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCachedCalendar.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCachedCalendar.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCachedCalendar.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCachedCalendar.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCachedCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calDateTimeFormatter.js">calendar/base/src/calDateTimeFormatter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calDateTimeFormatter.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calDateTimeFormatter.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calDateTimeFormatter.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calDateTimeFormatter.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calDateTimeFormatter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calWeekInfoService.js">calendar/base/src/calWeekInfoService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calWeekInfoService.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calWeekInfoService.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calWeekInfoService.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calWeekInfoService.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/base/src/calWeekInfoService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calMonthGridPrinter.js">calendar/import-export/calMonthGridPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calMonthGridPrinter.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calMonthGridPrinter.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calMonthGridPrinter.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calMonthGridPrinter.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calMonthGridPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calWeekPrinter.js">calendar/import-export/calWeekPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calWeekPrinter.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calWeekPrinter.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calWeekPrinter.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calWeekPrinter.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/import-export/calWeekPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/itip/calItipEmailTransport.js">calendar/itip/calItipEmailTransport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/itip/calItipEmailTransport.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/itip/calItipEmailTransport.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/itip/calItipEmailTransport.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/itip/calItipEmailTransport.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/itip/calItipEmailTransport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/imip-bar.js">calendar/lightning/content/imip-bar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/imip-bar.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/imip-bar.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/imip-bar.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/imip-bar.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/imip-bar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/messenger-overlay-sidebar.js">calendar/lightning/content/messenger-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/messenger-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/messenger-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/messenger-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/messenger-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/content/messenger-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/modules/ltnInvitationUtils.jsm">calendar/lightning/modules/ltnInvitationUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/modules/ltnInvitationUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/modules/ltnInvitationUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/modules/ltnInvitationUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/modules/ltnInvitationUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/lightning/modules/ltnInvitationUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavRequestHandlers.js">calendar/providers/caldav/calDavRequestHandlers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavRequestHandlers.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavRequestHandlers.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavRequestHandlers.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavRequestHandlers.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/caldav/calDavRequestHandlers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/components/calGoogleCalendar.js">calendar/providers/gdata/components/calGoogleCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/components/calGoogleCalendar.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/components/calGoogleCalendar.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/components/calGoogleCalendar.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/components/calGoogleCalendar.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/components/calGoogleCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-event-dialog-reminder.js">calendar/providers/gdata/content/gdata-event-dialog-reminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-event-dialog-reminder.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-event-dialog-reminder.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-event-dialog-reminder.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-event-dialog-reminder.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-event-dialog-reminder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-migration.js">calendar/providers/gdata/content/gdata-migration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-migration.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-migration.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-migration.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-migration.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/content/gdata-migration.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataLogging.jsm">calendar/providers/gdata/modules/gdataLogging.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataLogging.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataLogging.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataLogging.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataLogging.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataLogging.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataRequest.jsm">calendar/providers/gdata/modules/gdataRequest.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataRequest.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataRequest.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataRequest.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataRequest.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataRequest.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataSession.jsm">calendar/providers/gdata/modules/gdataSession.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataSession.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataSession.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataSession.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataSession.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataSession.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataUtils.jsm">calendar/providers/gdata/modules/gdataUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/gdata/modules/gdataUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapCalendarModule.js">calendar/providers/wcap/calWcapCalendarModule.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapCalendarModule.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapCalendarModule.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapCalendarModule.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapCalendarModule.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapCalendarModule.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/eventDialog/testUTF8.js">calendar/test/mozmill/eventDialog/testUTF8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/eventDialog/testUTF8.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/eventDialog/testUTF8.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/eventDialog/testUTF8.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/eventDialog/testUTF8.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/eventDialog/testUTF8.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testAlarmDefaultValue.js">calendar/test/mozmill/testAlarmDefaultValue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testAlarmDefaultValue.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testAlarmDefaultValue.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testAlarmDefaultValue.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testAlarmDefaultValue.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testAlarmDefaultValue.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testTimezones.js">calendar/test/mozmill/testTimezones.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testTimezones.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testTimezones.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testTimezones.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testTimezones.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/mozmill/testTimezones.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_consts.js">calendar/test/unit/head_consts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_consts.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_consts.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_consts.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_consts.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_consts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_icaljs.js">calendar/test/unit/head_icaljs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_icaljs.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_icaljs.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_icaljs.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_icaljs.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_icaljs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_libical.js">calendar/test/unit/head_libical.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_libical.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_libical.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_libical.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_libical.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/head_libical.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_alarmutils.js">calendar/test/unit/test_alarmutils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_alarmutils.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_alarmutils.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_alarmutils.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_alarmutils.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_alarmutils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_datetimeformatter.js">calendar/test/unit/test_datetimeformatter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_datetimeformatter.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_datetimeformatter.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_datetimeformatter.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_datetimeformatter.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_datetimeformatter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_extract.js">calendar/test/unit/test_extract.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_extract.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_extract.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_extract.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_extract.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_extract.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_freebusy.js">calendar/test/unit/test_freebusy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_freebusy.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_freebusy.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_freebusy.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_freebusy.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_freebusy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_gdata_provider.js">calendar/test/unit/test_gdata_provider.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_gdata_provider.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_gdata_provider.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_gdata_provider.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_gdata_provider.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_gdata_provider.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_parser.js">calendar/test/unit/test_ics_parser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_parser.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_parser.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_parser.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_parser.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_parser.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_service.js">calendar/test/unit/test_ics_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_service.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_service.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_service.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_service.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ics_service.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_imip.js">calendar/test/unit/test_imip.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_imip.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_imip.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_imip.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_imip.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_imip.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_l10n_utils.js">calendar/test/unit/test_l10n_utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_l10n_utils.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_l10n_utils.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_l10n_utils.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_l10n_utils.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_l10n_utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ltninvitationutils.js">calendar/test/unit/test_ltninvitationutils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ltninvitationutils.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ltninvitationutils.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ltninvitationutils.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ltninvitationutils.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_ltninvitationutils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_utils.js">calendar/test/unit/test_utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_utils.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_utils.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_utils.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_utils.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_weekinfo_service.js">calendar/test/unit/test_weekinfo_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_weekinfo_service.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_weekinfo_service.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_weekinfo_service.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_weekinfo_service.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/calendar/test/unit/test_weekinfo_service.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/mail/components/addrbook/content/addressbook.js">mail/components/addrbook/content/addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/mail/components/addrbook/content/addressbook.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/mail/components/addrbook/content/addressbook.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/mail/components/addrbook/content/addressbook.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/mail/components/addrbook/content/addressbook.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/mail/components/addrbook/content/addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/base/src/msgOAuth2Module.js">mailnews/base/src/msgOAuth2Module.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/base/src/msgOAuth2Module.js">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/base/src/msgOAuth2Module.js">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/base/src/msgOAuth2Module.js">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/base/src/msgOAuth2Module.js">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/base/src/msgOAuth2Module.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/jsaccount/modules/JSAccountUtils.jsm">mailnews/jsaccount/modules/JSAccountUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/jsaccount/modules/JSAccountUtils.jsm">file</a> |
<a href="/comm-central/annotate/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/jsaccount/modules/JSAccountUtils.jsm">annotate</a> |
<a href="/comm-central/diff/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/jsaccount/modules/JSAccountUtils.jsm">diff</a> |
<a href="/comm-central/comparison/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/jsaccount/modules/JSAccountUtils.jsm">comparison</a> |
<a href="/comm-central/log/6329bd856957630c38562298cd379dfff91e5e9f/mailnews/jsaccount/modules/JSAccountUtils.jsm">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/backend/calBackendLoader.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/backend/calBackendLoader.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.5"></a><span id="l1.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.6"></a><span id="l1.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l1.9"></a><span id="l1.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12"> function calBackendLoader() {</span>
<a href="#l1.13"></a><span id="l1.13">     this.wrappedJSObject = this;</span>
<a href="#l1.14"></a><span id="l1.14">     try {</span>
<a href="#l1.15"></a><span id="l1.15">         this.loadBackend();</span>
<a href="#l1.16"></a><span id="l1.16">     } catch (e) {</span>
<a href="#l1.17"></a><span id="l1.17">         dump(`### Error loading backend:${e.filename || e.fileName}:${e.lineNumber}: ${e}\n`);</span>
<a href="#l1.18"></a><span id="l1.18">     }</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineat">@@ -25,17 +24,17 @@ calBackendLoader.prototype = {</span>
<a href="#l1.20"></a><span id="l1.20">         // Nothing to do here, just need the entry so this is instanciated</span>
<a href="#l1.21"></a><span id="l1.21">     },</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23">     loadBackend: function() {</span>
<a href="#l1.24"></a><span id="l1.24">         if (this.loaded) {</span>
<a href="#l1.25"></a><span id="l1.25">             return;</span>
<a href="#l1.26"></a><span id="l1.26">         }</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-        if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+        if (Services.prefs.getBoolPref(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l1.30"></a><span id="l1.30">             let contracts = {</span>
<a href="#l1.31"></a><span id="l1.31">                 &quot;@mozilla.org/calendar/datetime;1&quot;: &quot;{36783242-ec94-4d8a-9248-d2679edd55b9}&quot;,</span>
<a href="#l1.32"></a><span id="l1.32">                 &quot;@mozilla.org/calendar/ics-service;1&quot;: &quot;{c61cb903-4408-41b3-bc22-da0b27efdfe1}&quot;,</span>
<a href="#l1.33"></a><span id="l1.33">                 &quot;@mozilla.org/calendar/period;1&quot;: &quot;{394a281f-7299-45f7-8b1f-cce21258972f}&quot;,</span>
<a href="#l1.34"></a><span id="l1.34">                 &quot;@mozilla.org/calendar/recurrence-rule;1&quot;: &quot;{df19281a-5389-4146-b941-798cb93a7f0d}&quot;,</span>
<a href="#l1.35"></a><span id="l1.35">                 &quot;@mozilla.org/calendar/duration;1&quot;: &quot;{7436f480-c6fc-4085-9655-330b1ee22288}&quot;,</span>
<a href="#l1.36"></a><span id="l1.36">             };</span>
<a href="#l1.37"></a><span id="l1.37"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,14 +1,13 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.5"></a><span id="l2.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.6"></a><span id="l2.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l2.12"></a><span id="l2.12"> </span>
<a href="#l2.13"></a><span id="l2.13"> function Synthetic(aHeader, aDuration, aMultiday) {</span>
<a href="#l2.14"></a><span id="l2.14">     this.open = aHeader.getAttribute(&quot;checked&quot;) == &quot;true&quot;;</span>
<a href="#l2.15"></a><span id="l2.15">     this.duration = aDuration;</span>
<a href="#l2.16"></a><span id="l2.16">     this.multiday = aMultiday;</span>
<a href="#l2.17"></a><span id="l2.17"> }</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineat">@@ -1121,22 +1120,22 @@ function scheduleNextCurrentEventUpdate(</span>
<a href="#l2.19"></a><span id="l2.19"> }</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21"> /**</span>
<a href="#l2.22"></a><span id="l2.22">  * Gets a right value for calendar.agendaListbox.soondays preference, avoid</span>
<a href="#l2.23"></a><span id="l2.23">  * erroneus values edited in the lightning.js preference file</span>
<a href="#l2.24"></a><span id="l2.24">  **/</span>
<a href="#l2.25"></a><span id="l2.25"> function getSoondaysPreference() {</span>
<a href="#l2.26"></a><span id="l2.26">     let prefName = &quot;calendar.agendaListbox.soondays&quot;;</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">-    let soonpref = Preferences.get(prefName, 5);</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+    let soonpref = Services.prefs.getIntPref(prefName, 5);</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30">     if (soonpref &gt; 0 &amp;&amp; soonpref &lt;= 28) {</span>
<a href="#l2.31"></a><span id="l2.31">         if (soonpref % 7 != 0) {</span>
<a href="#l2.32"></a><span id="l2.32">             let intSoonpref = Math.floor(soonpref / 7) * 7;</span>
<a href="#l2.33"></a><span id="l2.33">             soonpref = (intSoonpref == 0 ? soonpref : intSoonpref);</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-            Preferences.set(prefName, soonpref, &quot;INT&quot;);</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+            Services.prefs.setIntPref(prefName, soonpref);</span>
<a href="#l2.36"></a><span id="l2.36">         }</span>
<a href="#l2.37"></a><span id="l2.37">     } else {</span>
<a href="#l2.38"></a><span id="l2.38">         soonpref = soonpref &gt; 28 ? 28 : 1;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-        Preferences.set(prefName, soonpref, &quot;INT&quot;);</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+        Services.prefs.setIntPref(prefName, soonpref);</span>
<a href="#l2.41"></a><span id="l2.41">     }</span>
<a href="#l2.42"></a><span id="l2.42">     return soonpref;</span>
<a href="#l2.43"></a><span id="l2.43"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -165,17 +165,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">                   }</span>
<a href="#l3.5"></a><span id="l3.5">               },</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7">               onError: function(aCalendar, aErrNo, aMessage) { },</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">               onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l3.10"></a><span id="l3.10">                   switch (aName) {</span>
<a href="#l3.11"></a><span id="l3.11">                       case &quot;suppressAlarms&quot;:</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-                          if (!Preferences.get(&quot;calendar.alarms.indicator.show&quot;, true) ||</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+                          if (!Services.prefs.getBoolPref(&quot;calendar.alarms.indicator.show&quot;, true) ||</span>
<a href="#l3.14"></a><span id="l3.14">                               aCalendar.getProperty(&quot;capabilities.alarms.popup.supported&quot;) === false) {</span>
<a href="#l3.15"></a><span id="l3.15">                               break;</span>
<a href="#l3.16"></a><span id="l3.16">                           }</span>
<a href="#l3.17"></a><span id="l3.17">                           // else fall through</span>
<a href="#l3.18"></a><span id="l3.18">                       case &quot;readOnly&quot;:</span>
<a href="#l3.19"></a><span id="l3.19">                       case &quot;disabled&quot;:</span>
<a href="#l3.20"></a><span id="l3.20">                           // XXXvv we can be smarter about how we handle this stuff</span>
<a href="#l3.21"></a><span id="l3.21">                           this.calView.refresh();</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -231,17 +231,16 @@</span>
<a href="#l3.23"></a><span id="l3.23">               onDefaultCalendarChanged: function(aNewDefaultCalendar) {</span>
<a href="#l3.24"></a><span id="l3.24">                   // don't care, for now</span>
<a href="#l3.25"></a><span id="l3.25">               }</span>
<a href="#l3.26"></a><span id="l3.26">           })</span>
<a href="#l3.27"></a><span id="l3.27">       ]]&gt;&lt;/field&gt;</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l3.30"></a><span id="l3.30">           const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-          const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l3.32"></a><span id="l3.32">           const { Log4Moz } = ChromeUtils.import(&quot;resource:///modules/gloda/log4moz.js&quot;);</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34">           const kWorkdaysCommand = &quot;calendar_toggle_workdays_only_command&quot;;</span>
<a href="#l3.35"></a><span id="l3.35">           const kTasksInViewCommand = &quot;calendar_toggle_tasks_in_view_command&quot;;</span>
<a href="#l3.36"></a><span id="l3.36">           const kShowCompleted = &quot;calendar_toggle_show_completed_in_view_command&quot;;</span>
<a href="#l3.37"></a><span id="l3.37">           const kOrientation = &quot;calendar_toggle_orientation_command&quot;;</span>
<a href="#l3.38"></a><span id="l3.38"> </span>
<a href="#l3.39"></a><span id="l3.39">           this.workdaysOnly = (document.getElementById(kWorkdaysCommand)</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineat">@@ -260,17 +259,17 @@</span>
<a href="#l3.41"></a><span id="l3.41">           this.setAttribute(&quot;type&quot;, this.type);</span>
<a href="#l3.42"></a><span id="l3.42">           this.mResizeHandler = () =&gt; {</span>
<a href="#l3.43"></a><span id="l3.43">               this.onResize(this);</span>
<a href="#l3.44"></a><span id="l3.44">           };</span>
<a href="#l3.45"></a><span id="l3.45">           this.viewBroadcaster.addEventListener(this.getAttribute(&quot;type&quot;) + &quot;viewresized&quot;, this.mResizeHandler, true);</span>
<a href="#l3.46"></a><span id="l3.46">           // add a preference observer to monitor changes</span>
<a href="#l3.47"></a><span id="l3.47">           Services.prefs.addObserver(&quot;calendar.&quot;, this.mPrefObserver);</span>
<a href="#l3.48"></a><span id="l3.48">           Services.obs.addObserver(this.mTimezoneObserver, &quot;defaultTimezoneChanged&quot;);</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-          this.weekStartOffset = Preferences.get(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+          this.weekStartOffset = Services.prefs.getIntPref(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l3.51"></a><span id="l3.51">           this.updateDaysOffPrefs();</span>
<a href="#l3.52"></a><span id="l3.52">           this.mPendingRefreshJobs = new Map();</span>
<a href="#l3.53"></a><span id="l3.53">           this.mLog = Log4Moz.getConfiguredLogger(&quot;calBaseView&quot;);</span>
<a href="#l3.54"></a><span id="l3.54">           this.mFlashingEvents = {};</span>
<a href="#l3.55"></a><span id="l3.55">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l3.56"></a><span id="l3.56"> </span>
<a href="#l3.57"></a><span id="l3.57">       &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l3.58"></a><span id="l3.58">           const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineat">@@ -671,17 +670,17 @@</span>
<a href="#l3.60"></a><span id="l3.60">                 &quot;d3wednesdaysoff&quot;, &quot;d4thursdaysoff&quot;, &quot;d5fridaysoff&quot;,</span>
<a href="#l3.61"></a><span id="l3.61">                 &quot;d6saturdaysoff&quot;</span>
<a href="#l3.62"></a><span id="l3.62">             ];</span>
<a href="#l3.63"></a><span id="l3.63">             const defaults = [</span>
<a href="#l3.64"></a><span id="l3.64">                 &quot;true&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;, &quot;true&quot;</span>
<a href="#l3.65"></a><span id="l3.65">             ];</span>
<a href="#l3.66"></a><span id="l3.66">             let daysOff = [];</span>
<a href="#l3.67"></a><span id="l3.67">             for (let i in prefNames) {</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-                if (Preferences.get(weekPrefix + prefNames[i], defaults[i])) {</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+                if (Services.prefs.getBoolPref(weekPrefix + prefNames[i], defaults[i])) {</span>
<a href="#l3.70"></a><span id="l3.70">                     daysOff.push(Number(i));</span>
<a href="#l3.71"></a><span id="l3.71">                 }</span>
<a href="#l3.72"></a><span id="l3.72">             }</span>
<a href="#l3.73"></a><span id="l3.73">             this.daysOffArray = daysOff;</span>
<a href="#l3.74"></a><span id="l3.74">         ]]&gt;&lt;/body&gt;</span>
<a href="#l3.75"></a><span id="l3.75">       &lt;/method&gt;</span>
<a href="#l3.76"></a><span id="l3.76"> </span>
<a href="#l3.77"></a><span id="l3.77">       &lt;method name=&quot;refreshView&quot;&gt;</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineat">@@ -783,17 +782,17 @@</span>
<a href="#l3.79"></a><span id="l3.79">                   break;</span>
<a href="#l3.80"></a><span id="l3.80">               case &quot;PageDown&quot;:</span>
<a href="#l3.81"></a><span id="l3.81">                   this.moveView(1);</span>
<a href="#l3.82"></a><span id="l3.82">                   break;</span>
<a href="#l3.83"></a><span id="l3.83">           }</span>
<a href="#l3.84"></a><span id="l3.84">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l3.85"></a><span id="l3.85">       &lt;handler event=&quot;wheel&quot;&gt;&lt;![CDATA[</span>
<a href="#l3.86"></a><span id="l3.86">           const pixelThreshold = 150;</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-          if (event.shiftKey &amp;&amp; Preferences.get(&quot;calendar.view.mousescroll&quot;, true)) {</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+          if (event.shiftKey &amp;&amp; Services.prefs.getBoolPref(&quot;calendar.view.mousescroll&quot;, true)) {</span>
<a href="#l3.89"></a><span id="l3.89">               if (event.deltaMode == event.DOM_DELTA_LINE) {</span>
<a href="#l3.90"></a><span id="l3.90">                   if (event.deltaY != 0) {</span>
<a href="#l3.91"></a><span id="l3.91">                       deltaView = event.deltaY &lt; 0 ? -1 : 1;</span>
<a href="#l3.92"></a><span id="l3.92">                   }</span>
<a href="#l3.93"></a><span id="l3.93">               } else if (event.deltaMode == event.DOM_DELTA_PIXEL) {</span>
<a href="#l3.94"></a><span id="l3.94">                   this.mPixelScrollDelta += event.deltaY;</span>
<a href="#l3.95"></a><span id="l3.95">                   if (this.mPixelScrollDelta &gt; pixelThreshold) {</span>
<a href="#l3.96"></a><span id="l3.96">                       deltaView = 1;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-chrome-startup.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-chrome-startup.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.6"></a><span id="l4.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> var { fixIterator } = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l4.9"></a><span id="l4.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l4.11"></a><span id="l4.11"> var { AppConstants } = ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l4.12"></a><span id="l4.12"> </span>
<a href="#l4.13"></a><span id="l4.13"> /* exported commonInitCalendar, commonFinishCalendar */</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15"> /**</span>
<a href="#l4.16"></a><span id="l4.16">  * Common initialization steps for calendar chrome windows.</span>
<a href="#l4.17"></a><span id="l4.17">  */</span>
<a href="#l4.18"></a><span id="l4.18"> async function commonInitCalendar() {</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineat">@@ -131,40 +130,40 @@ var calendarWindowPrefs = {</span>
<a href="#l4.20"></a><span id="l4.20">      * Observer function called when a pref has changed</span>
<a href="#l4.21"></a><span id="l4.21">      *</span>
<a href="#l4.22"></a><span id="l4.22">      * @see nsIObserver</span>
<a href="#l4.23"></a><span id="l4.23">      */</span>
<a href="#l4.24"></a><span id="l4.24">     observe: function(aSubject, aTopic, aData) {</span>
<a href="#l4.25"></a><span id="l4.25">         if (aTopic == &quot;nsPref:changed&quot;) {</span>
<a href="#l4.26"></a><span id="l4.26">             switch (aData) {</span>
<a href="#l4.27"></a><span id="l4.27">                 case &quot;calendar.view.useSystemColors&quot;: {</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-                    let attributeValue = Preferences.get(&quot;calendar.view.useSystemColors&quot;, false) &amp;&amp; &quot;true&quot;;</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+                    let attributeValue = Services.prefs.getBoolPref(&quot;calendar.view.useSystemColors&quot;, false) &amp;&amp; &quot;true&quot;;</span>
<a href="#l4.30"></a><span id="l4.30">                     for (let win of fixIterator(Services.ww.getWindowEnumerator())) {</span>
<a href="#l4.31"></a><span id="l4.31">                         setElementValue(win.document.documentElement, attributeValue, &quot;systemcolors&quot;);</span>
<a href="#l4.32"></a><span id="l4.32">                     }</span>
<a href="#l4.33"></a><span id="l4.33">                     break;</span>
<a href="#l4.34"></a><span id="l4.34">                 }</span>
<a href="#l4.35"></a><span id="l4.35">             }</span>
<a href="#l4.36"></a><span id="l4.36">         } else if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l4.37"></a><span id="l4.37">             let win = aSubject.QueryInterface(Ci.nsIDOMWindow);</span>
<a href="#l4.38"></a><span id="l4.38">             win.addEventListener(&quot;load&quot;, () =&gt; {</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-                let attributeValue = Preferences.get(&quot;calendar.view.useSystemColors&quot;, false) &amp;&amp; &quot;true&quot;;</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+                let attributeValue = Services.prefs.getBoolPref(&quot;calendar.view.useSystemColors&quot;, false) &amp;&amp; &quot;true&quot;;</span>
<a href="#l4.41"></a><span id="l4.41">                 setElementValue(win.document.documentElement, attributeValue, &quot;systemcolors&quot;);</span>
<a href="#l4.42"></a><span id="l4.42">             });</span>
<a href="#l4.43"></a><span id="l4.43">         }</span>
<a href="#l4.44"></a><span id="l4.44">     }</span>
<a href="#l4.45"></a><span id="l4.45"> };</span>
<a href="#l4.46"></a><span id="l4.46"> </span>
<a href="#l4.47"></a><span id="l4.47"> /**</span>
<a href="#l4.48"></a><span id="l4.48">  * Migrate calendar UI. This function is called at each startup and can be used</span>
<a href="#l4.49"></a><span id="l4.49">  * to change UI items that require js code intervention</span>
<a href="#l4.50"></a><span id="l4.50">  */</span>
<a href="#l4.51"></a><span id="l4.51"> function migrateCalendarUI() {</span>
<a href="#l4.52"></a><span id="l4.52">     const UI_VERSION = 3;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-    let currentUIVersion = Preferences.get(&quot;calendar.ui.version&quot;);</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+    let currentUIVersion = Services.prefs.getIntPref(&quot;calendar.ui.version&quot;, 0);</span>
<a href="#l4.55"></a><span id="l4.55">     if (currentUIVersion &gt;= UI_VERSION) {</span>
<a href="#l4.56"></a><span id="l4.56">         return;</span>
<a href="#l4.57"></a><span id="l4.57">     }</span>
<a href="#l4.58"></a><span id="l4.58"> </span>
<a href="#l4.59"></a><span id="l4.59">     try {</span>
<a href="#l4.60"></a><span id="l4.60">         if (currentUIVersion &lt; 1) {</span>
<a href="#l4.61"></a><span id="l4.61">             let calbar = document.getElementById(&quot;calendar-toolbar2&quot;);</span>
<a href="#l4.62"></a><span id="l4.62">             calbar.insertItem(&quot;calendar-appmenu-button&quot;);</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineat">@@ -213,17 +212,17 @@ function migrateCalendarUI() {</span>
<a href="#l4.64"></a><span id="l4.64">                 let newSet = tabSet.replace(&quot;button-save&quot;, &quot;button-saveandclose&quot;);</span>
<a href="#l4.65"></a><span id="l4.65">                 xulStore.setValue(tabUri, &quot;event-tab-toolbar&quot;, &quot;currentset&quot;, newSet);</span>
<a href="#l4.66"></a><span id="l4.66"> </span>
<a href="#l4.67"></a><span id="l4.67">                 let tabBar = document.getElementById(&quot;event-tab-toolbar&quot;);</span>
<a href="#l4.68"></a><span id="l4.68">                 tabBar.currentSet = newSet;</span>
<a href="#l4.69"></a><span id="l4.69">                 tabBar.setAttribute(&quot;currentset&quot;, newSet);</span>
<a href="#l4.70"></a><span id="l4.70">             }</span>
<a href="#l4.71"></a><span id="l4.71">         }</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-        Preferences.set(&quot;calendar.ui.version&quot;, UI_VERSION);</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+        Services.prefs.setIntPref(&quot;calendar.ui.version&quot;, UI_VERSION);</span>
<a href="#l4.74"></a><span id="l4.74">     } catch (e) {</span>
<a href="#l4.75"></a><span id="l4.75">         cal.ERROR(&quot;Error upgrading UI from &quot; + currentUIVersion + &quot; to &quot; +</span>
<a href="#l4.76"></a><span id="l4.76">                   UI_VERSION + &quot;: &quot; + e);</span>
<a href="#l4.77"></a><span id="l4.77">     }</span>
<a href="#l4.78"></a><span id="l4.78"> }</span>
<a href="#l4.79"></a><span id="l4.79"> </span>
<a href="#l4.80"></a><span id="l4.80"> function setLocaleDefaultPreferences() {</span>
<a href="#l4.81"></a><span id="l4.81">     function setDefaultLocaleValue(aName) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-clipboard.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-clipboard.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,27 +1,26 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.5"></a><span id="l5.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.6"></a><span id="l5.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l5.9"></a><span id="l5.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l5.10"></a><span id="l5.10"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12"> /* exported cutToClipboard, pasteFromClipboard */</span>
<a href="#l5.13"></a><span id="l5.13"> </span>
<a href="#l5.14"></a><span id="l5.14"> /**</span>
<a href="#l5.15"></a><span id="l5.15">  * Test if a writable calendar is selected, and if the clipboard has items that</span>
<a href="#l5.16"></a><span id="l5.16">  * can be pasted into Calendar. The data must be of type &quot;text/calendar&quot; or</span>
<a href="#l5.17"></a><span id="l5.17">  * &quot;text/unicode&quot;.</span>
<a href="#l5.18"></a><span id="l5.18">  *</span>
<a href="#l5.19"></a><span id="l5.19">  * @return          If true, pasting is currently possible.</span>
<a href="#l5.20"></a><span id="l5.20">  */</span>
<a href="#l5.21"></a><span id="l5.21"> function canPaste() {</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-    if (Preferences.get(&quot;calendar.paste.intoSelectedCalendar&quot;, false)) {</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;calendar.paste.intoSelectedCalendar&quot;, false)) {</span>
<a href="#l5.24"></a><span id="l5.24">         let selectedCal = getSelectedCalendar();</span>
<a href="#l5.25"></a><span id="l5.25">         if (!selectedCal ||</span>
<a href="#l5.26"></a><span id="l5.26">             !cal.acl.isCalendarWritable(selectedCal) ||</span>
<a href="#l5.27"></a><span id="l5.27">             !cal.acl.userCanAddItemsToCalendar(selectedCal)) {</span>
<a href="#l5.28"></a><span id="l5.28">             return false;</span>
<a href="#l5.29"></a><span id="l5.29">         }</span>
<a href="#l5.30"></a><span id="l5.30">     } else {</span>
<a href="#l5.31"></a><span id="l5.31">         let calendars = cal.getCalendarManager().getCalendars({})</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineat">@@ -210,17 +209,17 @@ function pasteFromClipboard() {</span>
<a href="#l5.33"></a><span id="l5.33">             }</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35">             // we only will need to ask whether to send notifications, if there</span>
<a href="#l5.36"></a><span id="l5.36">             // are attendees at all</span>
<a href="#l5.37"></a><span id="l5.37">             let withAttendees = items.filter(aItem =&gt; aItem.getAttendees({}).length &gt; 0);</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">             let notify = Ci.calIItipItem.USER;</span>
<a href="#l5.40"></a><span id="l5.40">             let destCal = null;</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-            if (Preferences.get(&quot;calendar.paste.intoSelectedCalendar&quot;, false)) {</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+            if (Services.prefs.getBoolPref(&quot;calendar.paste.intoSelectedCalendar&quot;, false)) {</span>
<a href="#l5.43"></a><span id="l5.43">                 destCal = getSelectedCalendar();</span>
<a href="#l5.44"></a><span id="l5.44">             } else {</span>
<a href="#l5.45"></a><span id="l5.45">                 let pasteText = &quot;paste&quot;;</span>
<a href="#l5.46"></a><span id="l5.46">                 if (withAttendees.length) {</span>
<a href="#l5.47"></a><span id="l5.47">                     if (withAttendees.every(cal.item.isEvent)) {</span>
<a href="#l5.48"></a><span id="l5.48">                         pasteText += &quot;Event&quot;;</span>
<a href="#l5.49"></a><span id="l5.49">                     } else if (withAttendees.every(cal.item.isToDo)) {</span>
<a href="#l5.50"></a><span id="l5.50">                         pasteText += &quot;Task&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.5"></a><span id="l6.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.6"></a><span id="l6.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l6.9"></a><span id="l6.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l6.11"></a><span id="l6.11"> var { AppConstants } = ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l6.12"></a><span id="l6.12"> </span>
<a href="#l6.13"></a><span id="l6.13"> /* exported invokeEventDragSession, calendarViewDNDObserver,</span>
<a href="#l6.14"></a><span id="l6.14">  *          calendarMailButtonDNDObserver, calendarCalendarButtonDNDObserver,</span>
<a href="#l6.15"></a><span id="l6.15">  *          calendarTaskButtonDNDObserver</span>
<a href="#l6.16"></a><span id="l6.16">  */</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> var itemConversion = {</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineat">@@ -145,28 +144,28 @@ var itemConversion = {</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">         this.copyItemBase(aTask, item);</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23">         // Dates and alarms</span>
<a href="#l6.24"></a><span id="l6.24">         item.startDate = aTask.entryDate;</span>
<a href="#l6.25"></a><span id="l6.25">         if (!item.startDate) {</span>
<a href="#l6.26"></a><span id="l6.26">             if (aTask.dueDate) {</span>
<a href="#l6.27"></a><span id="l6.27">                 item.startDate = aTask.dueDate.clone();</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-                item.startDate.minute -= Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+                item.startDate.minute -= Services.prefs.getIntPref(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l6.30"></a><span id="l6.30">             } else {</span>
<a href="#l6.31"></a><span id="l6.31">                 item.startDate = cal.dtz.getDefaultStartDate();</span>
<a href="#l6.32"></a><span id="l6.32">             }</span>
<a href="#l6.33"></a><span id="l6.33">         }</span>
<a href="#l6.34"></a><span id="l6.34"> </span>
<a href="#l6.35"></a><span id="l6.35">         item.endDate = aTask.dueDate;</span>
<a href="#l6.36"></a><span id="l6.36">         if (!item.endDate) {</span>
<a href="#l6.37"></a><span id="l6.37">             // Make the event be the default event length if no due date was</span>
<a href="#l6.38"></a><span id="l6.38">             // specified.</span>
<a href="#l6.39"></a><span id="l6.39">             item.endDate = item.startDate.clone();</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-            item.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+            item.endDate.minute += Services.prefs.getIntPref(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l6.42"></a><span id="l6.42">         }</span>
<a href="#l6.43"></a><span id="l6.43"> </span>
<a href="#l6.44"></a><span id="l6.44">         // Alarms</span>
<a href="#l6.45"></a><span id="l6.45">         for (let alarm of aTask.getAlarms({})) {</span>
<a href="#l6.46"></a><span id="l6.46">             item.addAlarm(alarm.clone());</span>
<a href="#l6.47"></a><span id="l6.47">         }</span>
<a href="#l6.48"></a><span id="l6.48">         item.alarmLastAck = aTask.alarmLastAck</span>
<a href="#l6.49"></a><span id="l6.49">                             ? aTask.alarmLastAck.clone()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-extract.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-extract.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.5"></a><span id="l7.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.6"></a><span id="l7.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> var { Extractor } = ChromeUtils.import(&quot;resource://calendar/modules/calExtract.jsm&quot;);</span>
<a href="#l7.9"></a><span id="l7.9"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l7.11"></a><span id="l7.11"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l7.12"></a><span id="l7.12"> </span>
<a href="#l7.13"></a><span id="l7.13"> var calendarExtract = {</span>
<a href="#l7.14"></a><span id="l7.14">     onShowLocaleMenu: function(target) {</span>
<a href="#l7.15"></a><span id="l7.15">         let localeList = document.getElementById(target.id);</span>
<a href="#l7.16"></a><span id="l7.16">         let langs = [];</span>
<a href="#l7.17"></a><span id="l7.17">         let chrome = Cc[&quot;@mozilla.org/chrome/chrome-registry;1&quot;]</span>
<a href="#l7.18"></a><span id="l7.18">                        .getService(Ci.nsIXULChromeRegistry)</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineat">@@ -32,17 +31,17 @@ var calendarExtract = {</span>
<a href="#l7.20"></a><span id="l7.20">                 label = cal.l10n.getCalString(&quot;extractUsingRegion&quot;, [langName, localeParts[3]]);</span>
<a href="#l7.21"></a><span id="l7.21">             }</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23">             langs.push([label, localeParts[1]]);</span>
<a href="#l7.24"></a><span id="l7.24">         }</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26">         // sort</span>
<a href="#l7.27"></a><span id="l7.27">         let pref = &quot;calendar.patterns.last.used.languages&quot;;</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-        let lastUsedLangs = Preferences.get(pref, &quot;&quot;);</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+        let lastUsedLangs = Services.prefs.getStringPref(pref, &quot;&quot;);</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31">         langs.sort((a, b) =&gt; {</span>
<a href="#l7.32"></a><span id="l7.32">             let idx_a = lastUsedLangs.indexOf(a[1]);</span>
<a href="#l7.33"></a><span id="l7.33">             let idx_b = lastUsedLangs.indexOf(b[1]);</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35">             if (idx_a == -1 &amp;&amp; idx_b == -1) {</span>
<a href="#l7.36"></a><span id="l7.36">                 return a[0].localeCompare(b[0]);</span>
<a href="#l7.37"></a><span id="l7.37">             } else if (idx_a != -1 &amp;&amp; idx_b != -1) {</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineat">@@ -85,17 +84,17 @@ var calendarExtract = {</span>
<a href="#l7.39"></a><span id="l7.39">                                                   false,</span>
<a href="#l7.40"></a><span id="l7.40">                                                   true,</span>
<a href="#l7.41"></a><span id="l7.41">                                                   { });</span>
<a href="#l7.42"></a><span id="l7.42">         cal.LOG(&quot;[calExtract] Original email content: \n&quot; + title + &quot;\r\n&quot; + content);</span>
<a href="#l7.43"></a><span id="l7.43">         let date = new Date(message.date / 1000);</span>
<a href="#l7.44"></a><span id="l7.44">         let time = (new Date()).getTime();</span>
<a href="#l7.45"></a><span id="l7.45"> </span>
<a href="#l7.46"></a><span id="l7.46">         let locale = Services.locale.requestedLocale;</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineminus">-        let dayStart = Preferences.get(&quot;calendar.view.daystarthour&quot;, 6);</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+        let dayStart = Services.prefs.getIntPref(&quot;calendar.view.daystarthour&quot;, 6);</span>
<a href="#l7.49"></a><span id="l7.49">         let extractor;</span>
<a href="#l7.50"></a><span id="l7.50"> </span>
<a href="#l7.51"></a><span id="l7.51">         if (fixedLang) {</span>
<a href="#l7.52"></a><span id="l7.52">             extractor = new Extractor(fixedLocale, dayStart);</span>
<a href="#l7.53"></a><span id="l7.53">         } else {</span>
<a href="#l7.54"></a><span id="l7.54">             extractor = new Extractor(locale, dayStart, false);</span>
<a href="#l7.55"></a><span id="l7.55">         }</span>
<a href="#l7.56"></a><span id="l7.56"> </span>
<a href="#l7.57"></a><span id="l7.57" class="difflineat">@@ -142,17 +141,17 @@ var calendarExtract = {</span>
<a href="#l7.58"></a><span id="l7.58">                 if (guessed.hour != null) {</span>
<a href="#l7.59"></a><span id="l7.59">                     item.startDate.hour = guessed.hour;</span>
<a href="#l7.60"></a><span id="l7.60">                 }</span>
<a href="#l7.61"></a><span id="l7.61">                 if (guessed.minute != null) {</span>
<a href="#l7.62"></a><span id="l7.62">                     item.startDate.minute = guessed.minute;</span>
<a href="#l7.63"></a><span id="l7.63">                 }</span>
<a href="#l7.64"></a><span id="l7.64"> </span>
<a href="#l7.65"></a><span id="l7.65">                 item.endDate = item.startDate.clone();</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-                item.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+                item.endDate.minute += Services.prefs.getIntPref(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l7.68"></a><span id="l7.68"> </span>
<a href="#l7.69"></a><span id="l7.69">                 if (endGuess.year != null) {</span>
<a href="#l7.70"></a><span id="l7.70">                     item.endDate.year = endGuess.year;</span>
<a href="#l7.71"></a><span id="l7.71">                 }</span>
<a href="#l7.72"></a><span id="l7.72">                 if (endGuess.month != null) {</span>
<a href="#l7.73"></a><span id="l7.73">                     item.endDate.month = endGuess.month - 1;</span>
<a href="#l7.74"></a><span id="l7.74">                 }</span>
<a href="#l7.75"></a><span id="l7.75">                 if (endGuess.day != null) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l8.4"></a><span id="l8.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.5"></a><span id="l8.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.6"></a><span id="l8.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12"> /* exported getInvitationsManager */</span>
<a href="#l8.13"></a><span id="l8.13"> </span>
<a href="#l8.14"></a><span id="l8.14"> /**</span>
<a href="#l8.15"></a><span id="l8.15">  * This object contains functions to take care of manipulating requests.</span>
<a href="#l8.16"></a><span id="l8.16">  */</span>
<a href="#l8.17"></a><span id="l8.17"> var gInvitationsRequestManager = {</span>
<a href="#l8.18"></a><span id="l8.18">     mRequestStatusList: {},</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineat">@@ -83,20 +83,20 @@ InvitationsManager.prototype = {</span>
<a href="#l8.20"></a><span id="l8.20">      *</span>
<a href="#l8.21"></a><span id="l8.21">      * @param firstDelay          The timeout before the operation should start.</span>
<a href="#l8.22"></a><span id="l8.22">      * @param operationListener   The calIGenericOperationListener to notify.</span>
<a href="#l8.23"></a><span id="l8.23">      */</span>
<a href="#l8.24"></a><span id="l8.24">     scheduleInvitationsUpdate: function(firstDelay, operationListener) {</span>
<a href="#l8.25"></a><span id="l8.25">         this.cancelInvitationsUpdate();</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27">         this.mTimer = setTimeout(() =&gt; {</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">-            if (Preferences.get(&quot;calendar.invitations.autorefresh.enabled&quot;, true)) {</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+            if (Services.prefs.getBoolPref(&quot;calendar.invitations.autorefresh.enabled&quot;, true)) {</span>
<a href="#l8.30"></a><span id="l8.30">                 this.mTimer = setInterval(() =&gt; {</span>
<a href="#l8.31"></a><span id="l8.31">                     this.getInvitations(operationListener);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-                }, Preferences.get(&quot;calendar.invitations.autorefresh.timeout&quot;, 3) * 60000);</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+                }, Services.prefs.getIntPref(&quot;calendar.invitations.autorefresh.timeout&quot;, 3) * 60000);</span>
<a href="#l8.34"></a><span id="l8.34">             }</span>
<a href="#l8.35"></a><span id="l8.35">             this.getInvitations(operationListener);</span>
<a href="#l8.36"></a><span id="l8.36">         }, firstDelay);</span>
<a href="#l8.37"></a><span id="l8.37">     },</span>
<a href="#l8.38"></a><span id="l8.38"> </span>
<a href="#l8.39"></a><span id="l8.39">     /**</span>
<a href="#l8.40"></a><span id="l8.40">      * Cancel pending any pending invitations update.</span>
<a href="#l8.41"></a><span id="l8.41">      */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-item-editing.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-editing.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.5"></a><span id="l9.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.6"></a><span id="l9.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l9.9"></a><span id="l9.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12"> /* exported modifyEventWithDialog, undo, redo, setContextPartstat */</span>
<a href="#l9.13"></a><span id="l9.13"> </span>
<a href="#l9.14"></a><span id="l9.14"> /**</span>
<a href="#l9.15"></a><span id="l9.15">  * Takes a job and makes sure the dispose function on it is called. If there is</span>
<a href="#l9.16"></a><span id="l9.16">  * no dispose function or the job is null, ignore it.</span>
<a href="#l9.17"></a><span id="l9.17">  *</span>
<a href="#l9.18"></a><span id="l9.18">  * @param job       The job to dispose.</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineat">@@ -29,24 +28,24 @@ function disposeJob(job) {</span>
<a href="#l9.20"></a><span id="l9.20">  * @param aStartDate    (optional) The start date to set.</span>
<a href="#l9.21"></a><span id="l9.21">  * @param aEndDate      (optional) The end date/due date to set.</span>
<a href="#l9.22"></a><span id="l9.22">  * @param aInitialDate  (optional) The reference date for the date pickers</span>
<a href="#l9.23"></a><span id="l9.23">  * @param aForceAllday  (optional) Force the event/task to be an allday item.</span>
<a href="#l9.24"></a><span id="l9.24">  */</span>
<a href="#l9.25"></a><span id="l9.25"> function setDefaultItemValues(aItem, aCalendar=null, aStartDate=null, aEndDate=null, aInitialDate=null, aForceAllday=false) {</span>
<a href="#l9.26"></a><span id="l9.26">     function endOfDay(aDate) {</span>
<a href="#l9.27"></a><span id="l9.27">         let eod = aDate ? aDate.clone() : cal.dtz.now();</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-        eod.hour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+        eod.hour = Services.prefs.getIntPref(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l9.30"></a><span id="l9.30">         eod.minute = 0;</span>
<a href="#l9.31"></a><span id="l9.31">         eod.second = 0;</span>
<a href="#l9.32"></a><span id="l9.32">         return eod;</span>
<a href="#l9.33"></a><span id="l9.33">     }</span>
<a href="#l9.34"></a><span id="l9.34">     function startOfDay(aDate) {</span>
<a href="#l9.35"></a><span id="l9.35">         let sod = aDate ? aDate.clone() : cal.dtz.now();</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-        sod.hour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+        sod.hour = Services.prefs.getIntPref(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l9.38"></a><span id="l9.38">         sod.minute = 0;</span>
<a href="#l9.39"></a><span id="l9.39">         sod.second = 0;</span>
<a href="#l9.40"></a><span id="l9.40">         return sod;</span>
<a href="#l9.41"></a><span id="l9.41">     }</span>
<a href="#l9.42"></a><span id="l9.42"> </span>
<a href="#l9.43"></a><span id="l9.43">     let initialDate = aInitialDate ? aInitialDate.clone() : cal.dtz.now();</span>
<a href="#l9.44"></a><span id="l9.44">     initialDate.isDate = true;</span>
<a href="#l9.45"></a><span id="l9.45"> </span>
<a href="#l9.46"></a><span id="l9.46" class="difflineat">@@ -82,45 +81,45 @@ function setDefaultItemValues(aItem, aCa</span>
<a href="#l9.47"></a><span id="l9.47">         } else {</span>
<a href="#l9.48"></a><span id="l9.48">             aItem.endDate = aItem.startDate.clone();</span>
<a href="#l9.49"></a><span id="l9.49">             if (aForceAllday) {</span>
<a href="#l9.50"></a><span id="l9.50">                 // All day events need to go to the beginning of the next day.</span>
<a href="#l9.51"></a><span id="l9.51">                 aItem.endDate.day++;</span>
<a href="#l9.52"></a><span id="l9.52">             } else {</span>
<a href="#l9.53"></a><span id="l9.53">                 // If the event is not all day, then add the default event</span>
<a href="#l9.54"></a><span id="l9.54">                 // length.</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-                aItem.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+                aItem.endDate.minute += Services.prefs.getIntPref(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l9.57"></a><span id="l9.57">             }</span>
<a href="#l9.58"></a><span id="l9.58">         }</span>
<a href="#l9.59"></a><span id="l9.59"> </span>
<a href="#l9.60"></a><span id="l9.60">         // Free/busy status is only valid for events, must not be set for tasks.</span>
<a href="#l9.61"></a><span id="l9.61">         aItem.setProperty(&quot;TRANSP&quot;, cal.item.getEventDefaultTransparency(aForceAllday));</span>
<a href="#l9.62"></a><span id="l9.62">     } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l9.63"></a><span id="l9.63">         let now = cal.dtz.now();</span>
<a href="#l9.64"></a><span id="l9.64">         let initDate = initialDate ? initialDate.clone() : now;</span>
<a href="#l9.65"></a><span id="l9.65">         initDate.isDate = false;</span>
<a href="#l9.66"></a><span id="l9.66">         initDate.hour = now.hour;</span>
<a href="#l9.67"></a><span id="l9.67">         initDate.minute = now.minute;</span>
<a href="#l9.68"></a><span id="l9.68">         initDate.second = now.second;</span>
<a href="#l9.69"></a><span id="l9.69"> </span>
<a href="#l9.70"></a><span id="l9.70">         if (aStartDate) {</span>
<a href="#l9.71"></a><span id="l9.71">             aItem.entryDate = aStartDate.clone();</span>
<a href="#l9.72"></a><span id="l9.72">         } else {</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineminus">-            let defaultStart = Preferences.get(&quot;calendar.task.defaultstart&quot;, &quot;none&quot;);</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-            if (Preferences.get(&quot;calendar.alarms.onfortodos&quot;, 0) == 1 &amp;&amp; defaultStart == &quot;none&quot;) {</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+            let defaultStart = Services.prefs.getStringPref(&quot;calendar.task.defaultstart&quot;, &quot;none&quot;);</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+            if (Services.prefs.getIntPref(&quot;calendar.alarms.onfortodos&quot;, 0) == 1 &amp;&amp; defaultStart == &quot;none&quot;) {</span>
<a href="#l9.77"></a><span id="l9.77">                 // start date is required if we want to set an alarm</span>
<a href="#l9.78"></a><span id="l9.78">                 defaultStart = &quot;offsetcurrent&quot;;</span>
<a href="#l9.79"></a><span id="l9.79">             }</span>
<a href="#l9.80"></a><span id="l9.80"> </span>
<a href="#l9.81"></a><span id="l9.81" class="difflineminus">-            let units = Preferences.get(&quot;calendar.task.defaultstartoffsetunits&quot;, &quot;minutes&quot;);</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+            let units = Services.prefs.getStringPref(&quot;calendar.task.defaultstartoffsetunits&quot;, &quot;minutes&quot;);</span>
<a href="#l9.83"></a><span id="l9.83">             if (![&quot;days&quot;, &quot;hours&quot;, &quot;minutes&quot;].includes(units)) {</span>
<a href="#l9.84"></a><span id="l9.84">                 units = &quot;minutes&quot;;</span>
<a href="#l9.85"></a><span id="l9.85">             }</span>
<a href="#l9.86"></a><span id="l9.86">             let startOffset = cal.createDuration();</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineminus">-            startOffset[units] = Preferences.get(&quot;calendar.task.defaultstartoffset&quot;, 0);</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+            startOffset[units] = Services.prefs.getIntPref(&quot;calendar.task.defaultstartoffset&quot;, 0);</span>
<a href="#l9.89"></a><span id="l9.89">             let start;</span>
<a href="#l9.90"></a><span id="l9.90"> </span>
<a href="#l9.91"></a><span id="l9.91">             switch (defaultStart) {</span>
<a href="#l9.92"></a><span id="l9.92">                 case &quot;none&quot;:</span>
<a href="#l9.93"></a><span id="l9.93">                     break;</span>
<a href="#l9.94"></a><span id="l9.94">                 case &quot;startofday&quot;:</span>
<a href="#l9.95"></a><span id="l9.95">                     start = startOfDay(initDate);</span>
<a href="#l9.96"></a><span id="l9.96">                     break;</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineat">@@ -148,24 +147,24 @@ function setDefaultItemValues(aItem, aCa</span>
<a href="#l9.98"></a><span id="l9.98">             if (start) {</span>
<a href="#l9.99"></a><span id="l9.99">                 aItem.entryDate = start;</span>
<a href="#l9.100"></a><span id="l9.100">             }</span>
<a href="#l9.101"></a><span id="l9.101">         }</span>
<a href="#l9.102"></a><span id="l9.102"> </span>
<a href="#l9.103"></a><span id="l9.103">         if (aEndDate) {</span>
<a href="#l9.104"></a><span id="l9.104">             aItem.dueDate = aEndDate.clone();</span>
<a href="#l9.105"></a><span id="l9.105">         } else {</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineminus">-            let defaultDue = Preferences.get(&quot;calendar.task.defaultdue&quot;, &quot;none&quot;);</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+            let defaultDue = Services.prefs.getStringPref(&quot;calendar.task.defaultdue&quot;, &quot;none&quot;);</span>
<a href="#l9.108"></a><span id="l9.108"> </span>
<a href="#l9.109"></a><span id="l9.109" class="difflineminus">-            let units = Preferences.get(&quot;calendar.task.defaultdueoffsetunits&quot;, &quot;minutes&quot;);</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineplus">+            let units = Services.prefs.getStringPref(&quot;calendar.task.defaultdueoffsetunits&quot;, &quot;minutes&quot;);</span>
<a href="#l9.111"></a><span id="l9.111">             if (![&quot;days&quot;, &quot;hours&quot;, &quot;minutes&quot;].includes(units)) {</span>
<a href="#l9.112"></a><span id="l9.112">                 units = &quot;minutes&quot;;</span>
<a href="#l9.113"></a><span id="l9.113">             }</span>
<a href="#l9.114"></a><span id="l9.114">             let dueOffset = cal.createDuration();</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineminus">-            dueOffset[units] = Preferences.get(&quot;calendar.task.defaultdueoffset&quot;, 0);</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineplus">+            dueOffset[units] = Services.prefs.getIntPref(&quot;calendar.task.defaultdueoffset&quot;, 0);</span>
<a href="#l9.117"></a><span id="l9.117"> </span>
<a href="#l9.118"></a><span id="l9.118">             let start = aItem.entryDate ? aItem.entryDate.clone() : initDate.clone();</span>
<a href="#l9.119"></a><span id="l9.119">             let due;</span>
<a href="#l9.120"></a><span id="l9.120"> </span>
<a href="#l9.121"></a><span id="l9.121">             switch (defaultDue) {</span>
<a href="#l9.122"></a><span id="l9.122">                 case &quot;none&quot;:</span>
<a href="#l9.123"></a><span id="l9.123">                     break;</span>
<a href="#l9.124"></a><span id="l9.124">                 case &quot;endofday&quot;:</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineat">@@ -449,18 +448,18 @@ function openEventDialog(calendarItem, c</span>
<a href="#l9.126"></a><span id="l9.126">     let args = {};</span>
<a href="#l9.127"></a><span id="l9.127">     args.calendarEvent = calendarItem;</span>
<a href="#l9.128"></a><span id="l9.128">     args.calendar = calendar;</span>
<a href="#l9.129"></a><span id="l9.129">     args.mode = mode;</span>
<a href="#l9.130"></a><span id="l9.130">     args.onOk = callback;</span>
<a href="#l9.131"></a><span id="l9.131">     args.job = job;</span>
<a href="#l9.132"></a><span id="l9.132">     args.initialStartDateValue = initialDate || cal.dtz.getDefaultStartDate();</span>
<a href="#l9.133"></a><span id="l9.133">     args.counterProposal = counterProposal;</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineminus">-    args.inTab = Preferences.get(&quot;calendar.item.editInTab&quot;, false);</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineminus">-    args.useNewItemUI = Preferences.get(&quot;calendar.item.useNewItemUI&quot;, false);</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineplus">+    args.inTab = Services.prefs.getBoolPref(&quot;calendar.item.editInTab&quot;, false);</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineplus">+    args.useNewItemUI = Services.prefs.getBoolPref(&quot;calendar.item.useNewItemUI&quot;, false);</span>
<a href="#l9.138"></a><span id="l9.138"> </span>
<a href="#l9.139"></a><span id="l9.139">     // this will be called if file-&gt;new has been selected from within the dialog</span>
<a href="#l9.140"></a><span id="l9.140">     args.onNewEvent = function(opcalendar) {</span>
<a href="#l9.141"></a><span id="l9.141">         createEventWithDialog(opcalendar, null, null);</span>
<a href="#l9.142"></a><span id="l9.142">     };</span>
<a href="#l9.143"></a><span id="l9.143">     args.onNewTodo = function(opcalendar) {</span>
<a href="#l9.144"></a><span id="l9.144">         createTodoWithDialog(opcalendar);</span>
<a href="#l9.145"></a><span id="l9.145">     };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-management.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-management.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -6,17 +6,16 @@</span>
<a href="#l10.4"></a><span id="l10.4">  *         updateSortOrderPref, calendarListTooltipShowing,</span>
<a href="#l10.5"></a><span id="l10.5">  *         calendarListSetupContextMenu, ensureCalendarVisible, toggleCalendarVisible,</span>
<a href="#l10.6"></a><span id="l10.6">  *         showAllCalendars, showOnlyCalendar, openCalendarSubscriptionsDialog,</span>
<a href="#l10.7"></a><span id="l10.7">  *         calendarOfflineManager</span>
<a href="#l10.8"></a><span id="l10.8">  */</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l10.11"></a><span id="l10.11"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l10.13"></a><span id="l10.13"> </span>
<a href="#l10.14"></a><span id="l10.14"> /**</span>
<a href="#l10.15"></a><span id="l10.15">  * Get this window's currently selected calendar.</span>
<a href="#l10.16"></a><span id="l10.16">  *</span>
<a href="#l10.17"></a><span id="l10.17">  * @return      The currently selected calendar.</span>
<a href="#l10.18"></a><span id="l10.18">  */</span>
<a href="#l10.19"></a><span id="l10.19"> function getSelectedCalendar() {</span>
<a href="#l10.20"></a><span id="l10.20">     return cal.view.getCompositeCalendar(window).defaultCalendar;</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -116,22 +115,22 @@ async function loadCalendarManager() {</span>
<a href="#l10.22"></a><span id="l10.22">  */</span>
<a href="#l10.23"></a><span id="l10.23"> function initHomeCalendar() {</span>
<a href="#l10.24"></a><span id="l10.24">     let calMgr = cal.getCalendarManager();</span>
<a href="#l10.25"></a><span id="l10.25">     let composite = cal.view.getCompositeCalendar(window);</span>
<a href="#l10.26"></a><span id="l10.26">     let url = Services.io.newURI(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l10.27"></a><span id="l10.27">     let homeCalendar = calMgr.createCalendar(&quot;storage&quot;, url);</span>
<a href="#l10.28"></a><span id="l10.28">     homeCalendar.name = cal.l10n.getCalString(&quot;homeCalendarName&quot;);</span>
<a href="#l10.29"></a><span id="l10.29">     calMgr.registerCalendar(homeCalendar);</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-    Preferences.set(&quot;calendar.list.sortOrder&quot;, homeCalendar.id);</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.list.sortOrder&quot;, homeCalendar.id);</span>
<a href="#l10.32"></a><span id="l10.32">     composite.addCalendar(homeCalendar);</span>
<a href="#l10.33"></a><span id="l10.33"> </span>
<a href="#l10.34"></a><span id="l10.34">     // Wrapping this in a try/catch block, as if any of the migration code</span>
<a href="#l10.35"></a><span id="l10.35">     // fails, the app may not load.</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-    if (Preferences.get(&quot;calendar.migrator.enabled&quot;, true)) {</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;calendar.migrator.enabled&quot;, true)) {</span>
<a href="#l10.38"></a><span id="l10.38">         try {</span>
<a href="#l10.39"></a><span id="l10.39">             gDataMigrator.checkAndMigrate();</span>
<a href="#l10.40"></a><span id="l10.40">         } catch (e) {</span>
<a href="#l10.41"></a><span id="l10.41">             Cu.reportError(&quot;Migrator error: &quot; + e);</span>
<a href="#l10.42"></a><span id="l10.42">         }</span>
<a href="#l10.43"></a><span id="l10.43">     }</span>
<a href="#l10.44"></a><span id="l10.44"> </span>
<a href="#l10.45"></a><span id="l10.45">     return homeCalendar;</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineat">@@ -150,17 +149,17 @@ function unloadCalendarManager() {</span>
<a href="#l10.47"></a><span id="l10.47">  * Updates the sort order preference based on the given event. The event is a</span>
<a href="#l10.48"></a><span id="l10.48">  * &quot;SortOrderChanged&quot; event, emitted from the calendar-list-tree binding. You</span>
<a href="#l10.49"></a><span id="l10.49">  * can also pass in an object like { sortOrder: &quot;Space separated calendar ids&quot; }</span>
<a href="#l10.50"></a><span id="l10.50">  *</span>
<a href="#l10.51"></a><span id="l10.51">  * @param event     The SortOrderChanged event described above.</span>
<a href="#l10.52"></a><span id="l10.52">  */</span>
<a href="#l10.53"></a><span id="l10.53"> function updateSortOrderPref(event) {</span>
<a href="#l10.54"></a><span id="l10.54">     let sortOrderString = event.sortOrder.join(&quot; &quot;);</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-    Preferences.set(&quot;calendar.list.sortOrder&quot;, sortOrderString);</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.list.sortOrder&quot;, sortOrderString);</span>
<a href="#l10.57"></a><span id="l10.57">     try {</span>
<a href="#l10.58"></a><span id="l10.58">         Services.prefs.savePrefFile(null);</span>
<a href="#l10.59"></a><span id="l10.59">     } catch (e) {</span>
<a href="#l10.60"></a><span id="l10.60">         cal.ERROR(e);</span>
<a href="#l10.61"></a><span id="l10.61">     }</span>
<a href="#l10.62"></a><span id="l10.62"> }</span>
<a href="#l10.63"></a><span id="l10.63"> </span>
<a href="#l10.64"></a><span id="l10.64"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -411,30 +411,30 @@</span>
<a href="#l11.4"></a><span id="l11.4">             &lt;/xul:row&gt;</span>
<a href="#l11.5"></a><span id="l11.5">           &lt;/xul:rows&gt;</span>
<a href="#l11.6"></a><span id="l11.6">         &lt;/xul:grid&gt;</span>
<a href="#l11.7"></a><span id="l11.7">       &lt;/xul:vbox&gt;</span>
<a href="#l11.8"></a><span id="l11.8">     &lt;/content&gt;</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10">     &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l11.11"></a><span id="l11.11">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-          const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+          const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15">           // Set the preference for the default start of the week</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-          this.weekStartOffset = Preferences.get(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+          this.weekStartOffset = Services.prefs.getIntPref(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19">           for (let i = 0; i &lt; 7; i++) {</span>
<a href="#l11.20"></a><span id="l11.20">               let hdr = document.createXULElement(&quot;calendar-day-label&quot;);</span>
<a href="#l11.21"></a><span id="l11.21">               this.labeldaybox.appendChild(hdr);</span>
<a href="#l11.22"></a><span id="l11.22">               hdr.weekDay = (i + this.mWeekStartOffset) % 7;</span>
<a href="#l11.23"></a><span id="l11.23">               hdr.shortWeekNames = false;</span>
<a href="#l11.24"></a><span id="l11.24">           }</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26">           // Set the preference for displaying the week number</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-          this.mShowWeekNumber = Preferences.get(&quot;calendar.view-minimonth.showWeekNumber&quot;, true);</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+          this.mShowWeekNumber = Services.prefs.getBoolPref(&quot;calendar.view-minimonth.showWeekNumber&quot;, true);</span>
<a href="#l11.29"></a><span id="l11.29">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l11.30"></a><span id="l11.30"> </span>
<a href="#l11.31"></a><span id="l11.31">       &lt;!-- fields --&gt;</span>
<a href="#l11.32"></a><span id="l11.32">       &lt;field name=&quot;mDateBoxes&quot;&gt;null&lt;/field&gt;</span>
<a href="#l11.33"></a><span id="l11.33">       &lt;field name=&quot;mSelectedDayBox&quot;&gt;null&lt;/field&gt;</span>
<a href="#l11.34"></a><span id="l11.34"> </span>
<a href="#l11.35"></a><span id="l11.35">       &lt;field name=&quot;mShowDaysOutsideMonth&quot;&gt;true&lt;/field&gt;</span>
<a href="#l11.36"></a><span id="l11.36">       &lt;field name=&quot;mShowFullMonth&quot;&gt;true&lt;/field&gt;</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineat">@@ -1072,18 +1072,18 @@</span>
<a href="#l11.38"></a><span id="l11.38">             }</span>
<a href="#l11.39"></a><span id="l11.39">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.40"></a><span id="l11.40">       &lt;/method&gt;</span>
<a href="#l11.41"></a><span id="l11.41"> </span>
<a href="#l11.42"></a><span id="l11.42">       &lt;method name=&quot;flashAlarm&quot;&gt;</span>
<a href="#l11.43"></a><span id="l11.43">         &lt;parameter name=&quot;aAlarmItem&quot;/&gt;</span>
<a href="#l11.44"></a><span id="l11.44">         &lt;parameter name=&quot;aStop&quot;/&gt;</span>
<a href="#l11.45"></a><span id="l11.45">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineminus">-            let showIndicator = Preferences.get(&quot;calendar.alarms.indicator.show&quot;, true);</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-            let totaltime = Preferences.get(&quot;calendar.alarms.indicator.totaltime&quot;, 3600);</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+            let showIndicator = Services.prefs.getBoolPref(&quot;calendar.alarms.indicator.show&quot;, true);</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+            let totaltime = Services.prefs.getIntPref(&quot;calendar.alarms.indicator.totaltime&quot;, 3600);</span>
<a href="#l11.50"></a><span id="l11.50"> </span>
<a href="#l11.51"></a><span id="l11.51">             if (!aStop &amp;&amp; (!showIndicator || totaltime &lt; 1)) {</span>
<a href="#l11.52"></a><span id="l11.52">                 // No need to animate if the indicator should not be shown.</span>
<a href="#l11.53"></a><span id="l11.53">                 return;</span>
<a href="#l11.54"></a><span id="l11.54">             }</span>
<a href="#l11.55"></a><span id="l11.55"> </span>
<a href="#l11.56"></a><span id="l11.56">             // Make sure the flashing attribute is set or reset on all visible</span>
<a href="#l11.57"></a><span id="l11.57">             // boxes.</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineat">@@ -1111,17 +1111,17 @@</span>
<a href="#l11.59"></a><span id="l11.59">             }</span>
<a href="#l11.60"></a><span id="l11.60">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.61"></a><span id="l11.61">       &lt;/method&gt;</span>
<a href="#l11.62"></a><span id="l11.62">     &lt;/implementation&gt;</span>
<a href="#l11.63"></a><span id="l11.63"> </span>
<a href="#l11.64"></a><span id="l11.64">     &lt;handlers&gt;</span>
<a href="#l11.65"></a><span id="l11.65">       &lt;handler event=&quot;wheel&quot;&gt;&lt;![CDATA[</span>
<a href="#l11.66"></a><span id="l11.66">           const pixelThreshold = 150;</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-          let scrollEnabled = Preferences.get(&quot;calendar.view.mousescroll&quot;, true);</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineplus">+          let scrollEnabled = Services.prefs.getBoolPref(&quot;calendar.view.mousescroll&quot;, true);</span>
<a href="#l11.69"></a><span id="l11.69">           if (!event.ctrlKey &amp;&amp; !event.shiftKey &amp;&amp;</span>
<a href="#l11.70"></a><span id="l11.70">               !event.altKey &amp;&amp; !event.metaKey &amp;&amp; scrollEnabled) {</span>
<a href="#l11.71"></a><span id="l11.71">               // In the month view, the only thing that can be scrolled</span>
<a href="#l11.72"></a><span id="l11.72">               // is the month the user is in. calendar-base-view takes care</span>
<a href="#l11.73"></a><span id="l11.73">               // of the shift key, so only move the view when no modifier</span>
<a href="#l11.74"></a><span id="l11.74">               // is pressed.</span>
<a href="#l11.75"></a><span id="l11.75">               let deltaView = 0;</span>
<a href="#l11.76"></a><span id="l11.76">               if (event.deltaMode == event.DOM_DELTA_LINE) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -2505,31 +2505,29 @@</span>
<a href="#l12.4"></a><span id="l12.4">           &lt;xul:box anonid=&quot;daybox&quot; class=&quot;multiday-view-day-box&quot; flex=&quot;1&quot;</span>
<a href="#l12.5"></a><span id="l12.5">                    equalsize=&quot;always&quot;/&gt;</span>
<a href="#l12.6"></a><span id="l12.6">         &lt;/xul:scrollbox&gt;</span>
<a href="#l12.7"></a><span id="l12.7">       &lt;/xul:box&gt;</span>
<a href="#l12.8"></a><span id="l12.8">     &lt;/content&gt;</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10">     &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l12.11"></a><span id="l12.11">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-          const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-</span>
<a href="#l12.14"></a><span id="l12.14">           // get day start/end hour from prefs and set on the view</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-          this.setDayStartEndMinutes(Preferences.get(&quot;calendar.view.daystarthour&quot;, 8) * 60,</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-                                     Preferences.get(&quot;calendar.view.dayendhour&quot;, 17) * 60);</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+          this.setDayStartEndMinutes(Services.prefs.getIntPref(&quot;calendar.view.daystarthour&quot;, 8) * 60,</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+                                     Services.prefs.getIntPref(&quot;calendar.view.dayendhour&quot;, 17) * 60);</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20">           // initially scroll to the day start hour in the view</span>
<a href="#l12.21"></a><span id="l12.21">           this.scrollToMinute(this.mDayStartMin);</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23">           // get visible hours from prefs and set on the view</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-          let visibleMinutes = Preferences.get(&quot;calendar.view.visiblehours&quot;, 9) * 60;</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+          let visibleMinutes = Services.prefs.getIntPref(&quot;calendar.view.visiblehours&quot;, 9) * 60;</span>
<a href="#l12.26"></a><span id="l12.26">           this.setVisibleMinutes(visibleMinutes);</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">           // set the time interval for the time indicator timer</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-          this.setTimeIndicatorInterval(Preferences.get(&quot;calendar.view.timeIndicatorInterval&quot;, 15));</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+          this.setTimeIndicatorInterval(Services.prefs.getIntPref(&quot;calendar.view.timeIndicatorInterval&quot;, 15));</span>
<a href="#l12.31"></a><span id="l12.31">           this.enableTimeIndicator();</span>
<a href="#l12.32"></a><span id="l12.32"> </span>
<a href="#l12.33"></a><span id="l12.33">           this.reorient();</span>
<a href="#l12.34"></a><span id="l12.34">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l12.35"></a><span id="l12.35"> </span>
<a href="#l12.36"></a><span id="l12.36">       &lt;property name=&quot;daysInView&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l12.37"></a><span id="l12.37">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.38"></a><span id="l12.38">             return this.labeldaybox.childNodes &amp;&amp; this.labeldaybox.childNodes.length;</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineat">@@ -2543,17 +2541,17 @@</span>
<a href="#l12.40"></a><span id="l12.40"> </span>
<a href="#l12.41"></a><span id="l12.41">       &lt;method name=&quot;setTimeIndicatorInterval&quot;&gt;</span>
<a href="#l12.42"></a><span id="l12.42">         &lt;parameter name=&quot;aPrefInterval&quot;/&gt;</span>
<a href="#l12.43"></a><span id="l12.43">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.44"></a><span id="l12.44">             // If the preference just edited by the user is outside the valid</span>
<a href="#l12.45"></a><span id="l12.45">             // range [0, 1440], we change it into the nearest limit (0 or 1440).</span>
<a href="#l12.46"></a><span id="l12.46">             let newTimeInterval = Math.max(0, Math.min(1440, aPrefInterval));</span>
<a href="#l12.47"></a><span id="l12.47">             if (newTimeInterval != aPrefInterval) {</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-                Preferences.set(&quot;calendar.view.timeIndicatorInterval&quot;, newTimeInterval);</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+                Services.prefs.setIntPref(&quot;calendar.view.timeIndicatorInterval&quot;, newTimeInterval);</span>
<a href="#l12.50"></a><span id="l12.50">             }</span>
<a href="#l12.51"></a><span id="l12.51"> </span>
<a href="#l12.52"></a><span id="l12.52">             if (newTimeInterval != this.mTimeIndicatorInterval) {</span>
<a href="#l12.53"></a><span id="l12.53">                 this.mTimeIndicatorInterval = newTimeInterval;</span>
<a href="#l12.54"></a><span id="l12.54">             }</span>
<a href="#l12.55"></a><span id="l12.55">             if (this.mTimeIndicatorInterval == 0) {</span>
<a href="#l12.56"></a><span id="l12.56">                 timeIndicator.cancel();</span>
<a href="#l12.57"></a><span id="l12.57">             }</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineat">@@ -2743,18 +2741,18 @@</span>
<a href="#l12.59"></a><span id="l12.59">             function setFlashingAttribute(aBox) {</span>
<a href="#l12.60"></a><span id="l12.60">                 if (aStop) {</span>
<a href="#l12.61"></a><span id="l12.61">                     aBox.removeAttribute(&quot;flashing&quot;);</span>
<a href="#l12.62"></a><span id="l12.62">                 } else {</span>
<a href="#l12.63"></a><span id="l12.63">                     aBox.setAttribute(&quot;flashing&quot;, &quot;true&quot;);</span>
<a href="#l12.64"></a><span id="l12.64">                 }</span>
<a href="#l12.65"></a><span id="l12.65">             }</span>
<a href="#l12.66"></a><span id="l12.66"> </span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-            let showIndicator = Preferences.get(&quot;calendar.alarms.indicator.show&quot;, true);</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-            let totaltime = Preferences.get(&quot;calendar.alarms.indicator.totaltime&quot;, 3600);</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+            let showIndicator = Services.prefs.getBoolPref(&quot;calendar.alarms.indicator.show&quot;, true);</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+            let totaltime = Services.prefs.getIntPref(&quot;calendar.alarms.indicator.totaltime&quot;, 3600);</span>
<a href="#l12.71"></a><span id="l12.71"> </span>
<a href="#l12.72"></a><span id="l12.72">             if (!aStop &amp;&amp; (!showIndicator || totaltime &lt; 1)) {</span>
<a href="#l12.73"></a><span id="l12.73">                 // No need to animate if the indicator should not be shown.</span>
<a href="#l12.74"></a><span id="l12.74">                 return;</span>
<a href="#l12.75"></a><span id="l12.75">             }</span>
<a href="#l12.76"></a><span id="l12.76"> </span>
<a href="#l12.77"></a><span id="l12.77"> </span>
<a href="#l12.78"></a><span id="l12.78">             // Make sure the flashing attribute is set or reset on all visible</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineat">@@ -3813,34 +3811,34 @@</span>
<a href="#l12.80"></a><span id="l12.80">             }</span>
<a href="#l12.81"></a><span id="l12.81">             return this.mVisibleMinutes;</span>
<a href="#l12.82"></a><span id="l12.82">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.83"></a><span id="l12.83">       &lt;/method&gt;</span>
<a href="#l12.84"></a><span id="l12.84"> </span>
<a href="#l12.85"></a><span id="l12.85">       &lt;method name=&quot;zoomIn&quot;&gt;</span>
<a href="#l12.86"></a><span id="l12.86">         &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l12.87"></a><span id="l12.87">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-            let visibleHours = Preferences.get(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+            let visibleHours = Services.prefs.getIntPref(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l12.90"></a><span id="l12.90">             visibleHours += (aLevel || 1);</span>
<a href="#l12.91"></a><span id="l12.91"> </span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-            Preferences.set(&quot;calendar.view.visiblehours&quot;, Math.min(visibleHours, 24));</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineplus">+            Services.prefs.setIntPref(&quot;calendar.view.visiblehours&quot;, Math.min(visibleHours, 24));</span>
<a href="#l12.94"></a><span id="l12.94">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.95"></a><span id="l12.95">       &lt;/method&gt;</span>
<a href="#l12.96"></a><span id="l12.96">       &lt;method name=&quot;zoomOut&quot;&gt;</span>
<a href="#l12.97"></a><span id="l12.97">         &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l12.98"></a><span id="l12.98">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-            let visibleHours = Preferences.get(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineplus">+            let visibleHours = Services.prefs.getIntPref(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l12.101"></a><span id="l12.101">             visibleHours -= (aLevel || 1);</span>
<a href="#l12.102"></a><span id="l12.102"> </span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-            Preferences.set(&quot;calendar.view.visiblehours&quot;, Math.max(1, visibleHours));</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineplus">+            Services.prefs.setIntPref(&quot;calendar.view.visiblehours&quot;, Math.max(1, visibleHours));</span>
<a href="#l12.105"></a><span id="l12.105">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.106"></a><span id="l12.106">       &lt;/method&gt;</span>
<a href="#l12.107"></a><span id="l12.107">       &lt;method name=&quot;zoomReset&quot;&gt;</span>
<a href="#l12.108"></a><span id="l12.108">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineminus">-            Preferences.set(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineplus">+            Services.prefs.setIntPref(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l12.111"></a><span id="l12.111">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.112"></a><span id="l12.112">       &lt;/method&gt;</span>
<a href="#l12.113"></a><span id="l12.113">     &lt;/implementation&gt;</span>
<a href="#l12.114"></a><span id="l12.114"> </span>
<a href="#l12.115"></a><span id="l12.115">     &lt;handlers&gt;</span>
<a href="#l12.116"></a><span id="l12.116">       &lt;handler event=&quot;click&quot; button=&quot;2&quot;&gt;&lt;![CDATA[</span>
<a href="#l12.117"></a><span id="l12.117">           this.selectedDateTime = null;</span>
<a href="#l12.118"></a><span id="l12.118">       ]]&gt;&lt;/handler&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -235,22 +235,19 @@ function removeChildren(aElement) {</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5"> /**</span>
<a href="#l13.6"></a><span id="l13.6">  * Sorts a sorted array of calendars by pref |calendar.list.sortOrder|.</span>
<a href="#l13.7"></a><span id="l13.7">  * Repairs that pref if dangling entries exist.</span>
<a href="#l13.8"></a><span id="l13.8">  *</span>
<a href="#l13.9"></a><span id="l13.9">  * @param calendars     An array of calendars to sort.</span>
<a href="#l13.10"></a><span id="l13.10">  */</span>
<a href="#l13.11"></a><span id="l13.11"> function sortCalendarArray(calendars) {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    // Be careful not to pollute the window object, as things break.</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-    let { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-</span>
<a href="#l13.15"></a><span id="l13.15">     let ret = calendars.concat([]);</span>
<a href="#l13.16"></a><span id="l13.16">     let sortOrder = {};</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-    let sortOrderPref = Preferences.get(&quot;calendar.list.sortOrder&quot;, &quot;&quot;).split(&quot; &quot;);</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+    let sortOrderPref = Services.prefs.getStringPref(&quot;calendar.list.sortOrder&quot;, &quot;&quot;).split(&quot; &quot;);</span>
<a href="#l13.19"></a><span id="l13.19">     for (let i = 0; i &lt; sortOrderPref.length; ++i) {</span>
<a href="#l13.20"></a><span id="l13.20">         sortOrder[sortOrderPref[i]] = i;</span>
<a href="#l13.21"></a><span id="l13.21">     }</span>
<a href="#l13.22"></a><span id="l13.22">     function sortFunc(cal1, cal2) {</span>
<a href="#l13.23"></a><span id="l13.23">         let orderIdx1 = sortOrder[cal1.id] || -1;</span>
<a href="#l13.24"></a><span id="l13.24">         let orderIdx2 = sortOrder[cal2.id] || -1;</span>
<a href="#l13.25"></a><span id="l13.25">         if (orderIdx1 &lt; orderIdx2) {</span>
<a href="#l13.26"></a><span id="l13.26">             return -1;</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineat">@@ -258,21 +255,21 @@ function sortCalendarArray(calendars) {</span>
<a href="#l13.28"></a><span id="l13.28">         if (orderIdx1 &gt; orderIdx2) {</span>
<a href="#l13.29"></a><span id="l13.29">             return 1;</span>
<a href="#l13.30"></a><span id="l13.30">         }</span>
<a href="#l13.31"></a><span id="l13.31">         return 0;</span>
<a href="#l13.32"></a><span id="l13.32">     }</span>
<a href="#l13.33"></a><span id="l13.33">     ret.sort(sortFunc);</span>
<a href="#l13.34"></a><span id="l13.34"> </span>
<a href="#l13.35"></a><span id="l13.35">     // check and repair pref when an array of all calendars has been passed:</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-    let sortOrderString = Preferences.get(&quot;calendar.list.sortOrder&quot;, &quot;&quot;);</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+    let sortOrderString = Services.prefs.getStringPref(&quot;calendar.list.sortOrder&quot;, &quot;&quot;);</span>
<a href="#l13.38"></a><span id="l13.38">     let wantedOrderString = ret.map(calendar =&gt; calendar.id).join(&quot; &quot;);</span>
<a href="#l13.39"></a><span id="l13.39">     if (wantedOrderString != sortOrderString &amp;&amp;</span>
<a href="#l13.40"></a><span id="l13.40">         cal.getCalendarManager().getCalendars({}).length == ret.length) {</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-        Preferences.set(&quot;calendar.list.sortOrder&quot;, wantedOrderString);</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+        Services.prefs.setStringPref(&quot;calendar.list.sortOrder&quot;, wantedOrderString);</span>
<a href="#l13.43"></a><span id="l13.43">     }</span>
<a href="#l13.44"></a><span id="l13.44"> </span>
<a href="#l13.45"></a><span id="l13.45">     return ret;</span>
<a href="#l13.46"></a><span id="l13.46"> }</span>
<a href="#l13.47"></a><span id="l13.47"> </span>
<a href="#l13.48"></a><span id="l13.48"> /**</span>
<a href="#l13.49"></a><span id="l13.49"> * Fills up a menu - either a menupopup or a menulist - with menuitems that refer</span>
<a href="#l13.50"></a><span id="l13.50"> * to calendars.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/calendar-view-core.xml</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/calendar-view-core.xml</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -144,43 +144,39 @@</span>
<a href="#l14.4"></a><span id="l14.4">             let item = this.mOccurrence;</span>
<a href="#l14.5"></a><span id="l14.5">             evl.value = (item.title ? item.title.replace(/\n/g, &quot; &quot;)</span>
<a href="#l14.6"></a><span id="l14.6">                                     : cal.l10n.getCalString(&quot;eventUntitled&quot;));</span>
<a href="#l14.7"></a><span id="l14.7">         ]]&gt;&lt;/body&gt;</span>
<a href="#l14.8"></a><span id="l14.8">       &lt;/method&gt;</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10">       &lt;method name=&quot;setLocationLabel&quot;&gt;</span>
<a href="#l14.11"></a><span id="l14.11">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-            const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-</span>
<a href="#l14.14"></a><span id="l14.14">             let locationLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;event-location&quot;);</span>
<a href="#l14.15"></a><span id="l14.15">             let location = this.mOccurrence.getProperty(&quot;LOCATION&quot;);</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-            let showLocation = Preferences.get(&quot;calendar.view.showLocation&quot;, false);</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+            let showLocation = Services.prefs.getBoolPref(&quot;calendar.view.showLocation&quot;, false);</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19">             locationLabel.value = showLocation &amp;&amp; location ? location : &quot;&quot;;</span>
<a href="#l14.20"></a><span id="l14.20">             setBooleanAttribute(locationLabel, &quot;hidden&quot;, !showLocation || !location);</span>
<a href="#l14.21"></a><span id="l14.21">         ]]&gt;&lt;/body&gt;</span>
<a href="#l14.22"></a><span id="l14.22">       &lt;/method&gt;</span>
<a href="#l14.23"></a><span id="l14.23"> </span>
<a href="#l14.24"></a><span id="l14.24">       &lt;method name=&quot;setCSSClasses&quot;&gt;</span>
<a href="#l14.25"></a><span id="l14.25">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">-            const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-</span>
<a href="#l14.28"></a><span id="l14.28">             let item = this.mOccurrence;</span>
<a href="#l14.29"></a><span id="l14.29">             this.setAttribute(&quot;calendar-uri&quot;, item.calendar.uri.spec);</span>
<a href="#l14.30"></a><span id="l14.30">             this.setAttribute(&quot;calendar-id&quot;, item.calendar.id);</span>
<a href="#l14.31"></a><span id="l14.31">             let categoriesArray = item.getCategories({});</span>
<a href="#l14.32"></a><span id="l14.32">             if (categoriesArray.length &gt; 0) {</span>
<a href="#l14.33"></a><span id="l14.33">                 let cssClassesArray = categoriesArray.map(cal.view.formatStringForCSSRule);</span>
<a href="#l14.34"></a><span id="l14.34">                 this.setAttribute(&quot;categories&quot;, cssClassesArray.join(&quot; &quot;));</span>
<a href="#l14.35"></a><span id="l14.35">             }</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37">             // Add alarm icons as needed.</span>
<a href="#l14.38"></a><span id="l14.38">             let alarms = item.getAlarms({});</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-            if (alarms.length &amp;&amp; Preferences.get(&quot;calendar.alarms.indicator.show&quot;, true)) {</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+            if (alarms.length &amp;&amp; Services.prefs.getBoolPref(&quot;calendar.alarms.indicator.show&quot;, true)) {</span>
<a href="#l14.41"></a><span id="l14.41">                 let iconsBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;alarm-icons-box&quot;);</span>
<a href="#l14.42"></a><span id="l14.42">                 cal.alarms.addReminderImages(iconsBox, alarms);</span>
<a href="#l14.43"></a><span id="l14.43"> </span>
<a href="#l14.44"></a><span id="l14.44">                 // Set suppressed status on the icons box</span>
<a href="#l14.45"></a><span id="l14.45">                 setElementValue(iconsBox,</span>
<a href="#l14.46"></a><span id="l14.46">                                 item.calendar.getProperty(&quot;suppressAlarms&quot;) || false,</span>
<a href="#l14.47"></a><span id="l14.47">                                 &quot;suppressed&quot;);</span>
<a href="#l14.48"></a><span id="l14.48">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -7,17 +7,16 @@</span>
<a href="#l15.4"></a><span id="l15.4">  *          toggleWorkdaysOnly, toggleTasksInView, toggleShowCompletedInView,</span>
<a href="#l15.5"></a><span id="l15.5">  *          goToDate, getLastCalendarView, deleteSelectedEvents,</span>
<a href="#l15.6"></a><span id="l15.6">  *          editSelectedEvents, selectAllEvents</span>
<a href="#l15.7"></a><span id="l15.7">  */</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l15.10"></a><span id="l15.10"> var { countOccurrences } = ChromeUtils.import(&quot;resource://calendar/modules/calRecurrenceUtils.jsm&quot;);</span>
<a href="#l15.11"></a><span id="l15.11"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l15.13"></a><span id="l15.13"> </span>
<a href="#l15.14"></a><span id="l15.14"> /**</span>
<a href="#l15.15"></a><span id="l15.15">  * Controller for the views</span>
<a href="#l15.16"></a><span id="l15.16">  * @see calIcalendarViewController</span>
<a href="#l15.17"></a><span id="l15.17">  */</span>
<a href="#l15.18"></a><span id="l15.18"> var calendarViewController = {</span>
<a href="#l15.19"></a><span id="l15.19">     QueryInterface: ChromeUtils.generateQI([Ci.calICalendarViewController]),</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21" class="difflineat">@@ -491,17 +490,17 @@ var categoryManagement = {</span>
<a href="#l15.22"></a><span id="l15.22">             } catch (ex) {</span>
<a href="#l15.23"></a><span id="l15.23">                 sheet.ownerNode.addEventListener(&quot;load&quot;,</span>
<a href="#l15.24"></a><span id="l15.24">                                                  () =&gt; this.updateStyleSheetForCategory(aCatName),</span>
<a href="#l15.25"></a><span id="l15.25">                                                  { once: true });</span>
<a href="#l15.26"></a><span id="l15.26">                 return;</span>
<a href="#l15.27"></a><span id="l15.27">             }</span>
<a href="#l15.28"></a><span id="l15.28">         }</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-        let color = Preferences.get(&quot;calendar.category.color.&quot; + aCatName) || &quot;&quot;;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+        let color = Services.prefs.getStringPref(&quot;calendar.category.color.&quot; + aCatName, &quot;&quot;);</span>
<a href="#l15.32"></a><span id="l15.32">         this.categoryStyleCache[aCatName].style.backgroundColor = color;</span>
<a href="#l15.33"></a><span id="l15.33">     }</span>
<a href="#l15.34"></a><span id="l15.34"> };</span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36"> /**</span>
<a href="#l15.37"></a><span id="l15.37">  * Handler function to set the selected day in the minimonth to the currently</span>
<a href="#l15.38"></a><span id="l15.38">  * selected day in the current view.</span>
<a href="#l15.39"></a><span id="l15.39">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/calendar-views.xml</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.xml</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -112,60 +112,59 @@</span>
<a href="#l16.4"></a><span id="l16.4">         ]]&gt;&lt;/body&gt;</span>
<a href="#l16.5"></a><span id="l16.5">       &lt;/method&gt;</span>
<a href="#l16.6"></a><span id="l16.6">     &lt;/implementation&gt;</span>
<a href="#l16.7"></a><span id="l16.7">   &lt;/binding&gt;</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9">   &lt;binding id=&quot;calendar-multiweek-view&quot; extends=&quot;chrome://calendar/content/calendar-month-view.xml#calendar-month-base-view&quot;&gt;</span>
<a href="#l16.10"></a><span id="l16.10">     &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l16.11"></a><span id="l16.11">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-          const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-          this.mWeeksInView = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+          this.mWeeksInView = Services.prefs.getIntPref(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l16.15"></a><span id="l16.15">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17">       &lt;field name=&quot;mWeeksInView&quot;&gt;4&lt;/field&gt;</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">       &lt;property name=&quot;weeksInView&quot;&gt;</span>
<a href="#l16.20"></a><span id="l16.20">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l16.21"></a><span id="l16.21">             return this.mWeeksInView;</span>
<a href="#l16.22"></a><span id="l16.22">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l16.23"></a><span id="l16.23">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l16.24"></a><span id="l16.24">             this.mWeeksInView = val;</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-            Preferences.set(&quot;calendar.weeks.inview&quot;, Number(val));</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+            Services.prefs.setIntPref(&quot;calendar.weeks.inview&quot;, Number(val));</span>
<a href="#l16.27"></a><span id="l16.27">             this.refreshView();</span>
<a href="#l16.28"></a><span id="l16.28">             return val;</span>
<a href="#l16.29"></a><span id="l16.29">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l16.30"></a><span id="l16.30">       &lt;/property&gt;</span>
<a href="#l16.31"></a><span id="l16.31"> </span>
<a href="#l16.32"></a><span id="l16.32">       &lt;property name=&quot;supportsZoom&quot; readonly=&quot;true&quot;</span>
<a href="#l16.33"></a><span id="l16.33">                 onget=&quot;return true;&quot;/&gt;</span>
<a href="#l16.34"></a><span id="l16.34"> </span>
<a href="#l16.35"></a><span id="l16.35">       &lt;method name=&quot;zoomIn&quot;&gt;</span>
<a href="#l16.36"></a><span id="l16.36">         &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l16.37"></a><span id="l16.37">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-            let visibleWeeks = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+            let visibleWeeks = Services.prefs.getIntPref(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l16.40"></a><span id="l16.40">             visibleWeeks += (aLevel || 1);</span>
<a href="#l16.41"></a><span id="l16.41"> </span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-            Preferences.set(&quot;calendar.weeks.inview&quot;, Math.min(visibleWeeks, 6));</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineplus">+            Services.prefs.setIntPref(&quot;calendar.weeks.inview&quot;, Math.min(visibleWeeks, 6));</span>
<a href="#l16.44"></a><span id="l16.44">         ]]&gt;&lt;/body&gt;</span>
<a href="#l16.45"></a><span id="l16.45">       &lt;/method&gt;</span>
<a href="#l16.46"></a><span id="l16.46"> </span>
<a href="#l16.47"></a><span id="l16.47">       &lt;method name=&quot;zoomOut&quot;&gt;</span>
<a href="#l16.48"></a><span id="l16.48">         &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l16.49"></a><span id="l16.49">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-            let visibleWeeks = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+            let visibleWeeks = Services.prefs.getIntPref(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l16.52"></a><span id="l16.52">             visibleWeeks -= aLevel || 1;</span>
<a href="#l16.53"></a><span id="l16.53"> </span>
<a href="#l16.54"></a><span id="l16.54" class="difflineminus">-            Preferences.set(&quot;calendar.weeks.inview&quot;, Math.max(visibleWeeks, 2));</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+            Services.prefs.setIntPref(&quot;calendar.weeks.inview&quot;, Math.max(visibleWeeks, 2));</span>
<a href="#l16.56"></a><span id="l16.56">         ]]&gt;&lt;/body&gt;</span>
<a href="#l16.57"></a><span id="l16.57">       &lt;/method&gt;</span>
<a href="#l16.58"></a><span id="l16.58"> </span>
<a href="#l16.59"></a><span id="l16.59">       &lt;method name=&quot;zoomReset&quot;&gt;</span>
<a href="#l16.60"></a><span id="l16.60">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineminus">-            Preferences.set(&quot;calendar.view.visiblehours&quot;, 4);</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineplus">+            Services.prefs.setIntPref(&quot;calendar.view.visiblehours&quot;, 4);</span>
<a href="#l16.63"></a><span id="l16.63">         ]]&gt;&lt;/body&gt;</span>
<a href="#l16.64"></a><span id="l16.64">       &lt;/method&gt;</span>
<a href="#l16.65"></a><span id="l16.65"> </span>
<a href="#l16.66"></a><span id="l16.66">       &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l16.67"></a><span id="l16.67">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l16.68"></a><span id="l16.68">             return &quot;multiweek-view-observer&quot;;</span>
<a href="#l16.69"></a><span id="l16.69">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l16.70"></a><span id="l16.70">       &lt;/property&gt;</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineat">@@ -181,17 +180,17 @@</span>
<a href="#l16.72"></a><span id="l16.72">             // without changing the start and end of the view.</span>
<a href="#l16.73"></a><span id="l16.73">             if (aDate) {</span>
<a href="#l16.74"></a><span id="l16.74">                 aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l16.75"></a><span id="l16.75">                 // Get the first date that should be shown. This is the</span>
<a href="#l16.76"></a><span id="l16.76">                 // start of the week of the day that we're centering around</span>
<a href="#l16.77"></a><span id="l16.77">                 // adjusted for the day the week starts on and the number</span>
<a href="#l16.78"></a><span id="l16.78">                 // of previous weeks we're supposed to display.</span>
<a href="#l16.79"></a><span id="l16.79">                 let dayStart = cal.getWeekInfoService().getStartOfWeek(aDate);</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineminus">-                dayStart.day -= 7 * Preferences.get(&quot;calendar.previousweeks.inview&quot;, 0);</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineplus">+                dayStart.day -= 7 * Services.prefs.getIntPref(&quot;calendar.previousweeks.inview&quot;, 0);</span>
<a href="#l16.82"></a><span id="l16.82">                 // The last day we're supposed to show</span>
<a href="#l16.83"></a><span id="l16.83">                 let dayEnd = dayStart.clone();</span>
<a href="#l16.84"></a><span id="l16.84">                 dayEnd.day += (7 * this.mWeeksInView) - 1;</span>
<a href="#l16.85"></a><span id="l16.85">                 this.setDateRange(dayStart, dayEnd);</span>
<a href="#l16.86"></a><span id="l16.86">                 this.selectedDay = aDate;</span>
<a href="#l16.87"></a><span id="l16.87">             } else {</span>
<a href="#l16.88"></a><span id="l16.88">                 this.refresh();</span>
<a href="#l16.89"></a><span id="l16.89">             }</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineat">@@ -201,17 +200,17 @@</span>
<a href="#l16.91"></a><span id="l16.91">       &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l16.92"></a><span id="l16.92">         &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l16.93"></a><span id="l16.93">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.94"></a><span id="l16.94">             if (aNumber) {</span>
<a href="#l16.95"></a><span id="l16.95">                 let date = this.startDay.clone();</span>
<a href="#l16.96"></a><span id="l16.96">                 let savedSelectedDay = this.selectedDay.clone();</span>
<a href="#l16.97"></a><span id="l16.97">                 // aNumber only corresponds to the number of weeks to move</span>
<a href="#l16.98"></a><span id="l16.98">                 // make sure to compensate for previous weeks in view too</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineminus">-                date.day += 7 * (aNumber + Preferences.get(&quot;calendar.previousweeks.inview&quot;, 4));</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineplus">+                date.day += 7 * (aNumber + Services.prefs.getIntPref(&quot;calendar.previousweeks.inview&quot;, 4));</span>
<a href="#l16.101"></a><span id="l16.101">                 this.goToDay(date);</span>
<a href="#l16.102"></a><span id="l16.102">                 savedSelectedDay.day += 7 * aNumber;</span>
<a href="#l16.103"></a><span id="l16.103">                 this.selectedDay = savedSelectedDay;</span>
<a href="#l16.104"></a><span id="l16.104">             } else {</span>
<a href="#l16.105"></a><span id="l16.105">                 let date = cal.dtz.now();</span>
<a href="#l16.106"></a><span id="l16.106">                 this.goToDay(date);</span>
<a href="#l16.107"></a><span id="l16.107">                 this.selectedDay = date;</span>
<a href="#l16.108"></a><span id="l16.108">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-alarm-dialog.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-alarm-dialog.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -3,17 +3,17 @@</span>
<a href="#l17.4"></a><span id="l17.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6"> /* exported onDismissAllAlarms, setupWindow, finishWindow, addWidgetFor,</span>
<a href="#l17.7"></a><span id="l17.7">  *         removeWidgetFor, onSelectAlarm, ensureCalendarVisible</span>
<a href="#l17.8"></a><span id="l17.8">  */</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10"> var { PluralForm } = ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l17.11"></a><span id="l17.11"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15"> addEventListener(&quot;DOMContentLoaded&quot;, () =&gt; {</span>
<a href="#l17.16"></a><span id="l17.16">     document.getElementById(&quot;alarm-snooze-all-popup&quot;).addEventListener(&quot;snooze&quot;, (event) =&gt; {</span>
<a href="#l17.17"></a><span id="l17.17">         snoozeAllItems(event.detail);</span>
<a href="#l17.18"></a><span id="l17.18">     });</span>
<a href="#l17.19"></a><span id="l17.19"> });</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21"> /**</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -125,17 +125,17 @@ function setupWindow() {</span>
<a href="#l17.23"></a><span id="l17.23"> function finishWindow() {</span>
<a href="#l17.24"></a><span id="l17.24">     let alarmRichlist = document.getElementById(&quot;alarm-richlist&quot;);</span>
<a href="#l17.25"></a><span id="l17.25"> </span>
<a href="#l17.26"></a><span id="l17.26">     if (alarmRichlist.childNodes.length &gt; 0) {</span>
<a href="#l17.27"></a><span id="l17.27">         // If there are still items, the window wasn't closed using dismiss</span>
<a href="#l17.28"></a><span id="l17.28">         // all/snooze all. This can happen when the closer is clicked or escape</span>
<a href="#l17.29"></a><span id="l17.29">         // is pressed. Snooze all remaining items using the default snooze</span>
<a href="#l17.30"></a><span id="l17.30">         // property.</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-        let snoozePref = Preferences.get(&quot;calendar.alarms.defaultsnoozelength&quot;, 0);</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+        let snoozePref = Services.prefs.getIntPref(&quot;calendar.alarms.defaultsnoozelength&quot;, 0);</span>
<a href="#l17.33"></a><span id="l17.33">         if (snoozePref &lt;= 0) {</span>
<a href="#l17.34"></a><span id="l17.34">             snoozePref = 5;</span>
<a href="#l17.35"></a><span id="l17.35">         }</span>
<a href="#l17.36"></a><span id="l17.36">         snoozeAllItems(snoozePref);</span>
<a href="#l17.37"></a><span id="l17.37">     }</span>
<a href="#l17.38"></a><span id="l17.38"> </span>
<a href="#l17.39"></a><span id="l17.39">     // Stop updating the relative time</span>
<a href="#l17.40"></a><span id="l17.40">     clearTimeout(gRelativeDateUpdateTimer);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -5,17 +5,16 @@</span>
<a href="#l18.4"></a><span id="l18.4"> /* exported onLoad, onAccept, onCancel, zoomWithButtons, updateStartTime,</span>
<a href="#l18.5"></a><span id="l18.5">  *          endWidget, updateEndTime, editStartTimezone, editEndTimezone,</span>
<a href="#l18.6"></a><span id="l18.6">  *          changeAllDay, onNextSlot, onPreviousSlot, onFreebusyTimebarInit,</span>
<a href="#l18.7"></a><span id="l18.7">  *          setFreebusyTimebarTime</span>
<a href="#l18.8"></a><span id="l18.8">  */</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l18.11"></a><span id="l18.11"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l18.13"></a><span id="l18.13"> </span>
<a href="#l18.14"></a><span id="l18.14"> var gStartDate = null;</span>
<a href="#l18.15"></a><span id="l18.15"> var gEndDate = null;</span>
<a href="#l18.16"></a><span id="l18.16"> var gStartTimezone = null;</span>
<a href="#l18.17"></a><span id="l18.17"> var gEndTimezone = null;</span>
<a href="#l18.18"></a><span id="l18.18"> var gDuration = null;</span>
<a href="#l18.19"></a><span id="l18.19"> var gStartHour = 0;</span>
<a href="#l18.20"></a><span id="l18.20"> var gEndHour = 24;</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineat">@@ -826,18 +825,18 @@ function setForce24Hours(aValue) {</span>
<a href="#l18.22"></a><span id="l18.22">  * Initialize the time range, setting the start and end hours from the prefs, or</span>
<a href="#l18.23"></a><span id="l18.23">  * to 24 hrs if gForce24Hours is set.</span>
<a href="#l18.24"></a><span id="l18.24">  */</span>
<a href="#l18.25"></a><span id="l18.25"> function initTimeRange() {</span>
<a href="#l18.26"></a><span id="l18.26">     if (gForce24Hours) {</span>
<a href="#l18.27"></a><span id="l18.27">         gStartHour = 0;</span>
<a href="#l18.28"></a><span id="l18.28">         gEndHour = 24;</span>
<a href="#l18.29"></a><span id="l18.29">     } else {</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-        gStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-        gEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+        gStartHour = Services.prefs.getIntPref(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+        gEndHour = Services.prefs.getIntPref(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l18.34"></a><span id="l18.34">     }</span>
<a href="#l18.35"></a><span id="l18.35"> }</span>
<a href="#l18.36"></a><span id="l18.36"> </span>
<a href="#l18.37"></a><span id="l18.37"> /**</span>
<a href="#l18.38"></a><span id="l18.38">  * Handler function for the &quot;modify&quot; event, emitted from the attendees-list</span>
<a href="#l18.39"></a><span id="l18.39">  * binding. event.details is an array of objects containing the user's email</span>
<a href="#l18.40"></a><span id="l18.40">  * (calid) and a flag that tells if the user has entered text before the last</span>
<a href="#l18.41"></a><span id="l18.41">  * onModify was called (dirty).</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1291,18 +1291,18 @@</span>
<a href="#l19.4"></a><span id="l19.4">       &lt;/method&gt;</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l19.7"></a><span id="l19.7">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l19.8"></a><span id="l19.8">             if (this.force24Hours) {</span>
<a href="#l19.9"></a><span id="l19.9">                 this.mStartHour = 0;</span>
<a href="#l19.10"></a><span id="l19.10">                 this.mEndHour = 24;</span>
<a href="#l19.11"></a><span id="l19.11">             } else {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-                this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-                this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+                this.mStartHour = Services.prefs.getIntPref(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+                this.mEndHour = Services.prefs.getIntPref(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l19.16"></a><span id="l19.16">             }</span>
<a href="#l19.17"></a><span id="l19.17">         ]]&gt;&lt;/body&gt;</span>
<a href="#l19.18"></a><span id="l19.18">       &lt;/method&gt;</span>
<a href="#l19.19"></a><span id="l19.19"> </span>
<a href="#l19.20"></a><span id="l19.20">       &lt;method name=&quot;moveTime&quot;&gt;</span>
<a href="#l19.21"></a><span id="l19.21">         &lt;parameter name=&quot;time&quot;/&gt;</span>
<a href="#l19.22"></a><span id="l19.22">         &lt;parameter name=&quot;delta&quot;/&gt;</span>
<a href="#l19.23"></a><span id="l19.23">         &lt;parameter name=&quot;doclip&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -116,20 +116,20 @@</span>
<a href="#l20.4"></a><span id="l20.4">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l20.5"></a><span id="l20.5"> </span>
<a href="#l20.6"></a><span id="l20.6">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l20.7"></a><span id="l20.7">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l20.8"></a><span id="l20.8">             if (this.force24Hours) {</span>
<a href="#l20.9"></a><span id="l20.9">                 this.mStartHour = 0;</span>
<a href="#l20.10"></a><span id="l20.10">                 this.mEndHour = 24;</span>
<a href="#l20.11"></a><span id="l20.11">             } else {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-                const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+                const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l20.14"></a><span id="l20.14"> </span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-                this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-                this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+                this.mStartHour = Services.prefs.getIntPref(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+                this.mEndHour = Services.prefs.getIntPref(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l20.19"></a><span id="l20.19">             }</span>
<a href="#l20.20"></a><span id="l20.20">         ]]&gt;&lt;/body&gt;</span>
<a href="#l20.21"></a><span id="l20.21">       &lt;/method&gt;</span>
<a href="#l20.22"></a><span id="l20.22"> </span>
<a href="#l20.23"></a><span id="l20.23">       &lt;property name=&quot;startDate&quot;&gt;</span>
<a href="#l20.24"></a><span id="l20.24">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l20.25"></a><span id="l20.25">             this.mStartDate = val.clone();</span>
<a href="#l20.26"></a><span id="l20.26">             this.mStartDate.minute = 0;</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineat">@@ -602,20 +602,20 @@</span>
<a href="#l20.28"></a><span id="l20.28">       &lt;/method&gt;</span>
<a href="#l20.29"></a><span id="l20.29"> </span>
<a href="#l20.30"></a><span id="l20.30">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l20.31"></a><span id="l20.31">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l20.32"></a><span id="l20.32">             if (this.force24Hours) {</span>
<a href="#l20.33"></a><span id="l20.33">                 this.mStartHour = 0;</span>
<a href="#l20.34"></a><span id="l20.34">                 this.mEndHour = 24;</span>
<a href="#l20.35"></a><span id="l20.35">             } else {</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-                const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineplus">+                const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l20.38"></a><span id="l20.38"> </span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-                this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">-                this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineplus">+                this.mStartHour = Services.prefs.getIntPref(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineplus">+                this.mEndHour = Services.prefs.getIntPref(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l20.43"></a><span id="l20.43">             }</span>
<a href="#l20.44"></a><span id="l20.44">         ]]&gt;&lt;/body&gt;</span>
<a href="#l20.45"></a><span id="l20.45">       &lt;/method&gt;</span>
<a href="#l20.46"></a><span id="l20.46">     &lt;/implementation&gt;</span>
<a href="#l20.47"></a><span id="l20.47">   &lt;/binding&gt;</span>
<a href="#l20.48"></a><span id="l20.48"> </span>
<a href="#l20.49"></a><span id="l20.49">   &lt;binding id=&quot;freebusy-grid&quot; extends=&quot;chrome://messenger/content/richlistbox.xml#xbl-richlistbox&quot;&gt;</span>
<a href="#l20.50"></a><span id="l20.50">     &lt;implementation&gt;</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineat">@@ -1112,18 +1112,18 @@</span>
<a href="#l20.52"></a><span id="l20.52">       &lt;/method&gt;</span>
<a href="#l20.53"></a><span id="l20.53"> </span>
<a href="#l20.54"></a><span id="l20.54">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l20.55"></a><span id="l20.55">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l20.56"></a><span id="l20.56">             if (this.force24Hours) {</span>
<a href="#l20.57"></a><span id="l20.57">                 this.mStartHour = 0;</span>
<a href="#l20.58"></a><span id="l20.58">                 this.mEndHour = 24;</span>
<a href="#l20.59"></a><span id="l20.59">             } else {</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineminus">-                const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+                const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l20.62"></a><span id="l20.62"> </span>
<a href="#l20.63"></a><span id="l20.63" class="difflineminus">-                this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineminus">-                this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineplus">+                this.mStartHour = Services.prefs.getIntPref(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineplus">+                this.mEndHour = Services.prefs.getIntPref(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l20.67"></a><span id="l20.67">             }</span>
<a href="#l20.68"></a><span id="l20.68">         ]]&gt;&lt;/body&gt;</span>
<a href="#l20.69"></a><span id="l20.69">       &lt;/method&gt;</span>
<a href="#l20.70"></a><span id="l20.70">     &lt;/implementation&gt;</span>
<a href="#l20.71"></a><span id="l20.71">   &lt;/binding&gt;</span>
<a href="#l20.72"></a><span id="l20.72"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l21.4"></a><span id="l21.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.5"></a><span id="l21.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7"> /* exported onLoad, onReminderSelected, updateReminder, onNewReminder,</span>
<a href="#l21.8"></a><span id="l21.8">  *          onRemoveReminder, onAccept, onCancel</span>
<a href="#l21.9"></a><span id="l21.9">  */</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11"> var { PluralForm } = ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l21.14"></a><span id="l21.14"> </span>
<a href="#l21.15"></a><span id="l21.15"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17"> var allowedActionsMap = {};</span>
<a href="#l21.18"></a><span id="l21.18"> var suppressListUpdate = false;</span>
<a href="#l21.19"></a><span id="l21.19"> </span>
<a href="#l21.20"></a><span id="l21.20"> /**</span>
<a href="#l21.21"></a><span id="l21.21">  * Sets up the reminder dialog.</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineat">@@ -387,18 +387,18 @@ function getItemBundleStringName(aPrefix</span>
<a href="#l21.23"></a><span id="l21.23">  * Handler function to be called when the &quot;new&quot; button is pressed, to create a</span>
<a href="#l21.24"></a><span id="l21.24">  * new reminder item.</span>
<a href="#l21.25"></a><span id="l21.25">  */</span>
<a href="#l21.26"></a><span id="l21.26"> function onNewReminder() {</span>
<a href="#l21.27"></a><span id="l21.27">     let itemType = (cal.item.isEvent(window.arguments[0].item) ? &quot;event&quot; : &quot;todo&quot;);</span>
<a href="#l21.28"></a><span id="l21.28">     let listbox = document.getElementById(&quot;reminder-listbox&quot;);</span>
<a href="#l21.29"></a><span id="l21.29"> </span>
<a href="#l21.30"></a><span id="l21.30">     let reminder = cal.createAlarm();</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-    let alarmlen = Preferences.get(&quot;calendar.alarms.&quot; + itemType + &quot;alarmlen&quot;, 15);</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-    let alarmunit = Preferences.get(&quot;calendar.alarms.&quot; + itemType + &quot;alarmunit&quot;, 15);</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+    let alarmlen = Services.prefs.getIntPref(&quot;calendar.alarms.&quot; + itemType + &quot;alarmlen&quot;, 15);</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+    let alarmunit = Services.prefs.getStringPref(&quot;calendar.alarms.&quot; + itemType + &quot;alarmunit&quot;, &quot;minutes&quot;);</span>
<a href="#l21.35"></a><span id="l21.35"> </span>
<a href="#l21.36"></a><span id="l21.36">     // Default is a relative DISPLAY alarm, |alarmlen| minutes before the event.</span>
<a href="#l21.37"></a><span id="l21.37">     // If DISPLAY is not supported by the provider, then pick the provider's</span>
<a href="#l21.38"></a><span id="l21.38">     // first alarm type.</span>
<a href="#l21.39"></a><span id="l21.39">     let offset = cal.createDuration();</span>
<a href="#l21.40"></a><span id="l21.40">     if (alarmunit == &quot;days&quot;) {</span>
<a href="#l21.41"></a><span id="l21.41">         offset.days = alarmlen;</span>
<a href="#l21.42"></a><span id="l21.42">     } else if (alarmunit == &quot;hours&quot;) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1,17 +1,16 @@</span>
<a href="#l22.4"></a><span id="l22.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.5"></a><span id="l22.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.6"></a><span id="l22.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8"> var FIREFOX_UID = &quot;{ec8030f7-c20a-464f-9b0e-13a3a9e97384}&quot;;</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l22.11"></a><span id="l22.11"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l22.13"></a><span id="l22.13"> var { AppConstants } = ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l22.14"></a><span id="l22.14"> </span>
<a href="#l22.15"></a><span id="l22.15"> //</span>
<a href="#l22.16"></a><span id="l22.16"> // The front-end wizard bits.</span>
<a href="#l22.17"></a><span id="l22.17"> //</span>
<a href="#l22.18"></a><span id="l22.18"> var gMigrateWizard = {</span>
<a href="#l22.19"></a><span id="l22.19">     /**</span>
<a href="#l22.20"></a><span id="l22.20">      * Called from onload of the migrator window.  Takes all of the migrators</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineat">@@ -643,14 +642,14 @@ var gDataMigrator = {</span>
<a href="#l22.22"></a><span id="l22.22">  * logs to system and error console, depending on the calendar.migration.log</span>
<a href="#l22.23"></a><span id="l22.23">  * preference.</span>
<a href="#l22.24"></a><span id="l22.24">  *</span>
<a href="#l22.25"></a><span id="l22.25">  * XXX Use log4moz instead.</span>
<a href="#l22.26"></a><span id="l22.26">  *</span>
<a href="#l22.27"></a><span id="l22.27">  * @param aString   The string to log</span>
<a href="#l22.28"></a><span id="l22.28">  */</span>
<a href="#l22.29"></a><span id="l22.29"> function migLOG(aString) {</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineminus">-    if (!Preferences.get(&quot;calendar.migration.log&quot;, false)) {</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineplus">+    if (!Services.prefs.getBoolPref(&quot;calendar.migration.log&quot;, false)) {</span>
<a href="#l22.32"></a><span id="l22.32">         return;</span>
<a href="#l22.33"></a><span id="l22.33">     }</span>
<a href="#l22.34"></a><span id="l22.34">     Services.console.logStringMessage(aString);</span>
<a href="#l22.35"></a><span id="l22.35">     dump(aString+&quot;\n&quot;);</span>
<a href="#l22.36"></a><span id="l22.36"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/content/today-pane.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/content/today-pane.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -444,15 +444,15 @@ var TodayPane = {</span>
<a href="#l23.4"></a><span id="l23.4">             document.getElementById(&quot;calendar_toggle_todaypane_command&quot;).doCommand();</span>
<a href="#l23.5"></a><span id="l23.5">         }</span>
<a href="#l23.6"></a><span id="l23.6">     },</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8">     /**</span>
<a href="#l23.9"></a><span id="l23.9">      * Checks if the todayPaneStatusLabel should be hidden.</span>
<a href="#l23.10"></a><span id="l23.10">      */</span>
<a href="#l23.11"></a><span id="l23.11">     showTodayPaneStatusLabel: function() {</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-        let attributeValue = Preferences.get(&quot;calendar.view.showTodayPaneStatusLabel&quot;, true) &amp;&amp; &quot;false&quot;;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+        let attributeValue = Services.prefs.getBoolPref(&quot;calendar.view.showTodayPaneStatusLabel&quot;, true) &amp;&amp; &quot;false&quot;;</span>
<a href="#l23.14"></a><span id="l23.14">         setElementValue(document.getElementById(&quot;calendar-status-todaypane-button&quot;), !attributeValue, &quot;hideLabel&quot;);</span>
<a href="#l23.15"></a><span id="l23.15">     }</span>
<a href="#l23.16"></a><span id="l23.16"> };</span>
<a href="#l23.17"></a><span id="l23.17"> </span>
<a href="#l23.18"></a><span id="l23.18"> window.addEventListener(&quot;load&quot;, TodayPane.onLoad, { capture: false, once: true });</span>
<a href="#l23.19"></a><span id="l23.19"> window.addEventListener(&quot;unload&quot;, TodayPane.onUnload, { capture: false, once: true });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-alarm-widget.xml</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-alarm-widget.xml</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -250,19 +250,19 @@</span>
<a href="#l24.4"></a><span id="l24.4">         &lt;xul:toolbarbutton anonid=&quot;snooze-popup-cancel&quot;</span>
<a href="#l24.5"></a><span id="l24.5">                            class=&quot;snooze-popup-button snooze-popup-cancel-button&quot;</span>
<a href="#l24.6"></a><span id="l24.6">                            aria-label=&quot;&amp;calendar.alarm.snooze.cancel;&quot;</span>
<a href="#l24.7"></a><span id="l24.7">                            oncommand=&quot;snoozeCancel()&quot;/&gt;</span>
<a href="#l24.8"></a><span id="l24.8">       &lt;/xul:hbox&gt;</span>
<a href="#l24.9"></a><span id="l24.9">     &lt;/content&gt;</span>
<a href="#l24.10"></a><span id="l24.10">     &lt;implementation&gt;</span>
<a href="#l24.11"></a><span id="l24.11">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-          const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+          const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l24.14"></a><span id="l24.14"> </span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-          let snoozePref = Preferences.get(&quot;calendar.alarms.defaultsnoozelength&quot;, 0);</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+          let snoozePref = Services.prefs.getIntPref(&quot;calendar.alarms.defaultsnoozelength&quot;, 0);</span>
<a href="#l24.17"></a><span id="l24.17">           if (snoozePref &lt;= 0) {</span>
<a href="#l24.18"></a><span id="l24.18">               snoozePref = 5;</span>
<a href="#l24.19"></a><span id="l24.19">           }</span>
<a href="#l24.20"></a><span id="l24.20"> </span>
<a href="#l24.21"></a><span id="l24.21">           let unitList = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;snooze-unit-menulist&quot;);</span>
<a href="#l24.22"></a><span id="l24.22">           let unitValue = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;snooze-value-textbox&quot;);</span>
<a href="#l24.23"></a><span id="l24.23"> </span>
<a href="#l24.24"></a><span id="l24.24">           let selectedIndex = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -207,32 +207,31 @@</span>
<a href="#l25.4"></a><span id="l25.4">       &lt;field name=&quot;mExtraDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l25.5"></a><span id="l25.5">       &lt;field name=&quot;mPixelScrollDelta&quot;&gt;0&lt;/field&gt;</span>
<a href="#l25.6"></a><span id="l25.6">       &lt;field name=&quot;mIsReadOnly&quot;&gt;false&lt;/field&gt;</span>
<a href="#l25.7"></a><span id="l25.7">       &lt;field name=&quot;mObservesComposite&quot;&gt;false&lt;/field&gt;</span>
<a href="#l25.8"></a><span id="l25.8">       &lt;field name=&quot;mShowWeekNumber&quot;&gt;true&lt;/field&gt;</span>
<a href="#l25.9"></a><span id="l25.9"> </span>
<a href="#l25.10"></a><span id="l25.10">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l25.11"></a><span id="l25.11">           const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-          const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l25.13"></a><span id="l25.13"> </span>
<a href="#l25.14"></a><span id="l25.14">           this.mToday = false;</span>
<a href="#l25.15"></a><span id="l25.15">           this.mSelected = false;</span>
<a href="#l25.16"></a><span id="l25.16">           this.mExtra = false;</span>
<a href="#l25.17"></a><span id="l25.17">           this.mValue = new Date(); // Default to &quot;today&quot;</span>
<a href="#l25.18"></a><span id="l25.18">           this.mFocused = null;</span>
<a href="#l25.19"></a><span id="l25.19">           // save references for convenience</span>
<a href="#l25.20"></a><span id="l25.20">           if (this.hasAttribute(&quot;readonly&quot;)) {</span>
<a href="#l25.21"></a><span id="l25.21">               this.mIsReadOnly = this.getAttribute(&quot;readonly&quot;) == &quot;true&quot;;</span>
<a href="#l25.22"></a><span id="l25.22">           }</span>
<a href="#l25.23"></a><span id="l25.23">           this.refreshDisplay();</span>
<a href="#l25.24"></a><span id="l25.24">           if (this.hasAttribute(&quot;freebusy&quot;)) {</span>
<a href="#l25.25"></a><span id="l25.25">               this._setFreeBusy(this.getAttribute(&quot;freebusy&quot;) == &quot;true&quot;);</span>
<a href="#l25.26"></a><span id="l25.26">           }</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineminus">-          this.mShowWeekNumber = Preferences.get(&quot;calendar.view-minimonth.showWeekNumber&quot;, true);</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineplus">+          this.mShowWeekNumber = Services.prefs.getBoolPref(&quot;calendar.view-minimonth.showWeekNumber&quot;, true);</span>
<a href="#l25.29"></a><span id="l25.29"> </span>
<a href="#l25.30"></a><span id="l25.30">           // Add pref observer</span>
<a href="#l25.31"></a><span id="l25.31">           let branch = Services.prefs.getBranch(&quot;&quot;);</span>
<a href="#l25.32"></a><span id="l25.32">           branch.addObserver(&quot;calendar.&quot;, this);</span>
<a href="#l25.33"></a><span id="l25.33">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l25.34"></a><span id="l25.34"> </span>
<a href="#l25.35"></a><span id="l25.35">       &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l25.36"></a><span id="l25.36">           const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineat">@@ -489,21 +488,21 @@</span>
<a href="#l25.38"></a><span id="l25.38">                     this.refreshDisplay();</span>
<a href="#l25.39"></a><span id="l25.39">                     break;</span>
<a href="#l25.40"></a><span id="l25.40">             }</span>
<a href="#l25.41"></a><span id="l25.41">         ]]&gt;&lt;/body&gt;</span>
<a href="#l25.42"></a><span id="l25.42">       &lt;/method&gt;</span>
<a href="#l25.43"></a><span id="l25.43"> </span>
<a href="#l25.44"></a><span id="l25.44">       &lt;method name=&quot;refreshDisplay&quot;&gt;</span>
<a href="#l25.45"></a><span id="l25.45">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineminus">-            const { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineplus">+            const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l25.48"></a><span id="l25.48"> </span>
<a href="#l25.49"></a><span id="l25.49">             // Find out which should be the first day of the week</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineminus">-            this.weekStart = Preferences.get(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineminus">-            this.mShowWeekNumber = Preferences.get(&quot;calendar.view-minimonth.showWeekNumber&quot;, true);</span>
<a href="#l25.52"></a><span id="l25.52" class="difflineplus">+            this.weekStart = Services.prefs.getIntPref(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineplus">+            this.mShowWeekNumber = Services.prefs.getBoolPref(&quot;calendar.view-minimonth.showWeekNumber&quot;, true);</span>
<a href="#l25.54"></a><span id="l25.54">             if (!this.mValue) {</span>
<a href="#l25.55"></a><span id="l25.55">                 this.mValue = new Date();</span>
<a href="#l25.56"></a><span id="l25.56">             }</span>
<a href="#l25.57"></a><span id="l25.57">             this.setHeader();</span>
<a href="#l25.58"></a><span id="l25.58">             this.showMonth(this.mValue);</span>
<a href="#l25.59"></a><span id="l25.59">             this.updateAccessibleLabel();</span>
<a href="#l25.60"></a><span id="l25.60">         ]]&gt;&lt;/body&gt;</span>
<a href="#l25.61"></a><span id="l25.61">       &lt;/method&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/modules/calExtract.jsm</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/modules/calExtract.jsm</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -1,16 +1,15 @@</span>
<a href="#l26.4"></a><span id="l26.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l26.5"></a><span id="l26.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l26.6"></a><span id="l26.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8"> this.EXPORTED_SYMBOLS = [&quot;Extractor&quot;];</span>
<a href="#l26.9"></a><span id="l26.9"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l26.10"></a><span id="l26.10"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l26.12"></a><span id="l26.12"> </span>
<a href="#l26.13"></a><span id="l26.13"> /**</span>
<a href="#l26.14"></a><span id="l26.14"> * Initializes extraction</span>
<a href="#l26.15"></a><span id="l26.15"> *</span>
<a href="#l26.16"></a><span id="l26.16"> * @param fallbackLocale  locale to use when others are not found or</span>
<a href="#l26.17"></a><span id="l26.17"> *                            detection is disabled</span>
<a href="#l26.18"></a><span id="l26.18"> * @param dayStart        ambiguous hours earlier than this are considered to</span>
<a href="#l26.19"></a><span id="l26.19"> *                            be in the afternoon, when null then by default</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineat">@@ -123,27 +122,27 @@ Extractor.prototype = {</span>
<a href="#l26.21"></a><span id="l26.21">                 cal.LOG(&quot;[calExtract] &quot; + this.fallbackLocale +</span>
<a href="#l26.22"></a><span id="l26.22">                         &quot; patterns were not found. Using en-US instead&quot;);</span>
<a href="#l26.23"></a><span id="l26.23">                 this.fallbackLocale = &quot;en-US&quot;;</span>
<a href="#l26.24"></a><span id="l26.24">             }</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26">             path = this.bundleUrl.replace(/LOCALE/g, this.fallbackLocale);</span>
<a href="#l26.27"></a><span id="l26.27"> </span>
<a href="#l26.28"></a><span id="l26.28">             let pref = &quot;calendar.patterns.last.used.languages&quot;;</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineminus">-            let lastUsedLangs = Preferences.get(pref, &quot;&quot;);</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineplus">+            let lastUsedLangs = Services.prefs.getStringPref(pref, &quot;&quot;);</span>
<a href="#l26.31"></a><span id="l26.31">             if (lastUsedLangs == &quot;&quot;) {</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">-                Preferences.set(pref, this.fallbackLocale);</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+                Services.prefs.setStringPref(pref, this.fallbackLocale);</span>
<a href="#l26.34"></a><span id="l26.34">             } else {</span>
<a href="#l26.35"></a><span id="l26.35">                 let langs = lastUsedLangs.split(&quot;,&quot;);</span>
<a href="#l26.36"></a><span id="l26.36">                 let idx = langs.indexOf(this.fallbackLocale);</span>
<a href="#l26.37"></a><span id="l26.37">                 if (idx == -1) {</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineminus">-                    Preferences.set(pref, this.fallbackLocale + &quot;,&quot; + lastUsedLangs);</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineplus">+                    Services.prefs.setStringPref(pref, this.fallbackLocale + &quot;,&quot; + lastUsedLangs);</span>
<a href="#l26.40"></a><span id="l26.40">                 } else {</span>
<a href="#l26.41"></a><span id="l26.41">                     langs.splice(idx, 1);</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-                    Preferences.set(pref, this.fallbackLocale + &quot;,&quot; + langs.join(&quot;,&quot;));</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+                    Services.prefs.setStringPref(pref, this.fallbackLocale + &quot;,&quot; + langs.join(&quot;,&quot;));</span>
<a href="#l26.44"></a><span id="l26.44">                 }</span>
<a href="#l26.45"></a><span id="l26.45">             }</span>
<a href="#l26.46"></a><span id="l26.46">         } else {</span>
<a href="#l26.47"></a><span id="l26.47">             let spellchecker = Cc[&quot;@mozilla.org/spellchecker/engine;1&quot;]</span>
<a href="#l26.48"></a><span id="l26.48">                                  .getService(Ci.mozISpellCheckingEngine);</span>
<a href="#l26.49"></a><span id="l26.49"> </span>
<a href="#l26.50"></a><span id="l26.50">             let arr = {};</span>
<a href="#l26.51"></a><span id="l26.51">             let cnt = {};</span>
<a href="#l26.52"></a><span id="l26.52" class="difflineat">@@ -276,17 +275,17 @@ Extractor.prototype = {</span>
<a href="#l26.53"></a><span id="l26.53">             hour: initial.hour,</span>
<a href="#l26.54"></a><span id="l26.54">             minute: initial.minute,</span>
<a href="#l26.55"></a><span id="l26.55">             relation: &quot;start&quot;</span>
<a href="#l26.56"></a><span id="l26.56">         });</span>
<a href="#l26.57"></a><span id="l26.57"> </span>
<a href="#l26.58"></a><span id="l26.58">         this.cleanup();</span>
<a href="#l26.59"></a><span id="l26.59">         cal.LOG(&quot;[calExtract] Email after processing for extraction: \n&quot; + this.email);</span>
<a href="#l26.60"></a><span id="l26.60"> </span>
<a href="#l26.61"></a><span id="l26.61" class="difflineminus">-        this.overrides = JSON.parse(Preferences.get(&quot;calendar.patterns.override&quot;, &quot;{}&quot;));</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineplus">+        this.overrides = JSON.parse(Services.prefs.getStringPref(&quot;calendar.patterns.override&quot;, &quot;{}&quot;));</span>
<a href="#l26.63"></a><span id="l26.63">         this.setLanguage();</span>
<a href="#l26.64"></a><span id="l26.64"> </span>
<a href="#l26.65"></a><span id="l26.65">         for (let i = 0; i &lt;= 31; i++) {</span>
<a href="#l26.66"></a><span id="l26.66">             this.numbers[i] = this.getPatterns(&quot;number.&quot; + i);</span>
<a href="#l26.67"></a><span id="l26.67">         }</span>
<a href="#l26.68"></a><span id="l26.68">         this.dailyNumbers = this.numbers.join(this.marker);</span>
<a href="#l26.69"></a><span id="l26.69"> </span>
<a href="#l26.70"></a><span id="l26.70">         this.hourlyNumbers = this.numbers[0] + this.marker;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/modules/calUtils.jsm</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/modules/calUtils.jsm</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1,27 +1,26 @@</span>
<a href="#l27.4"></a><span id="l27.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l27.5"></a><span id="l27.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l27.6"></a><span id="l27.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l27.9"></a><span id="l27.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l27.10"></a><span id="l27.10"> var { ConsoleAPI } = ChromeUtils.import(&quot;resource://gre/modules/Console.jsm&quot;);</span>
<a href="#l27.11"></a><span id="l27.11" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l27.12"></a><span id="l27.12"> </span>
<a href="#l27.13"></a><span id="l27.13"> // Usually the backend loader gets loaded via profile-after-change, but in case</span>
<a href="#l27.14"></a><span id="l27.14"> // a calendar component hooks in earlier, its very likely it will use calUtils.</span>
<a href="#l27.15"></a><span id="l27.15"> // Getting the service here will load if its not already loaded</span>
<a href="#l27.16"></a><span id="l27.16"> Cc[&quot;@mozilla.org/calendar/backend-loader;1&quot;].getService();</span>
<a href="#l27.17"></a><span id="l27.17"> </span>
<a href="#l27.18"></a><span id="l27.18"> // The calendar console instance</span>
<a href="#l27.19"></a><span id="l27.19"> var gCalendarConsole = new ConsoleAPI({</span>
<a href="#l27.20"></a><span id="l27.20">     prefix: &quot;Lightning&quot;,</span>
<a href="#l27.21"></a><span id="l27.21">     consoleID: &quot;calendar&quot;,</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineminus">-    maxLogLevel: Preferences.get(&quot;calendar.debug.log&quot;, false) ? &quot;all&quot; : &quot;warn&quot;</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineplus">+    maxLogLevel: Services.prefs.getBoolPref(&quot;calendar.debug.log&quot;, false) ? &quot;all&quot; : &quot;warn&quot;</span>
<a href="#l27.24"></a><span id="l27.24"> });</span>
<a href="#l27.25"></a><span id="l27.25"> </span>
<a href="#l27.26"></a><span id="l27.26"> this.EXPORTED_SYMBOLS = [&quot;cal&quot;];</span>
<a href="#l27.27"></a><span id="l27.27"> var cal = {</span>
<a href="#l27.28"></a><span id="l27.28">     // These functions exist to reduce boilerplate code for creating instances</span>
<a href="#l27.29"></a><span id="l27.29">     // as well as getting services and other (cached) objects.</span>
<a href="#l27.30"></a><span id="l27.30">     createEvent: _instance(&quot;@mozilla.org/calendar/event;1&quot;,</span>
<a href="#l27.31"></a><span id="l27.31">                            Ci.calIEvent,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/modules/utils/calAlarmUtils.jsm</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/modules/utils/calAlarmUtils.jsm</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l28.4"></a><span id="l28.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l28.5"></a><span id="l28.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l28.6"></a><span id="l28.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l28.9"></a><span id="l28.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l28.10"></a><span id="l28.10"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12"> XPCOMUtils.defineLazyModuleGetter(this, &quot;cal&quot;, &quot;resource://calendar/modules/calUtils.jsm&quot;, &quot;cal&quot;);</span>
<a href="#l28.13"></a><span id="l28.13"> </span>
<a href="#l28.14"></a><span id="l28.14"> /*</span>
<a href="#l28.15"></a><span id="l28.15">  * Helpers for manipulating calendar alarms</span>
<a href="#l28.16"></a><span id="l28.16">  */</span>
<a href="#l28.17"></a><span id="l28.17"> </span>
<a href="#l28.18"></a><span id="l28.18" class="difflineat">@@ -21,27 +21,27 @@ var calalarms = {</span>
<a href="#l28.19"></a><span id="l28.19">      * Read default alarm settings from user preferences and apply them to the</span>
<a href="#l28.20"></a><span id="l28.20">      * event/todo passed in. The item's calendar should be set to ensure the</span>
<a href="#l28.21"></a><span id="l28.21">      * correct alarm type is set.</span>
<a href="#l28.22"></a><span id="l28.22">      *</span>
<a href="#l28.23"></a><span id="l28.23">      * @param aItem     The item to apply the default alarm values to.</span>
<a href="#l28.24"></a><span id="l28.24">      */</span>
<a href="#l28.25"></a><span id="l28.25">     setDefaultValues: function(aItem) {</span>
<a href="#l28.26"></a><span id="l28.26">         let type = cal.item.isEvent(aItem) ? &quot;event&quot; : &quot;todo&quot;;</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineminus">-        if (Preferences.get(&quot;calendar.alarms.onfor&quot; + type + &quot;s&quot;, 0) == 1) {</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineplus">+        if (Services.prefs.getIntPref(&quot;calendar.alarms.onfor&quot; + type + &quot;s&quot;, 0) == 1) {</span>
<a href="#l28.29"></a><span id="l28.29">             let alarmOffset = cal.createDuration();</span>
<a href="#l28.30"></a><span id="l28.30">             let alarm = cal.createAlarm();</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-            let units = Preferences.get(&quot;calendar.alarms.&quot; + type + &quot;alarmunit&quot;, &quot;minutes&quot;);</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+            let units = Services.prefs.getStringPref(&quot;calendar.alarms.&quot; + type + &quot;alarmunit&quot;, &quot;minutes&quot;);</span>
<a href="#l28.33"></a><span id="l28.33"> </span>
<a href="#l28.34"></a><span id="l28.34">             // Make sure the alarm pref is valid, default to minutes otherwise</span>
<a href="#l28.35"></a><span id="l28.35">             if (![&quot;weeks&quot;, &quot;days&quot;, &quot;hours&quot;, &quot;minutes&quot;, &quot;seconds&quot;].includes(units)) {</span>
<a href="#l28.36"></a><span id="l28.36">                 units = &quot;minutes&quot;;</span>
<a href="#l28.37"></a><span id="l28.37">             }</span>
<a href="#l28.38"></a><span id="l28.38"> </span>
<a href="#l28.39"></a><span id="l28.39" class="difflineminus">-            alarmOffset[units] = Preferences.get(&quot;calendar.alarms.&quot; + type + &quot;alarmlen&quot;, 0);</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineplus">+            alarmOffset[units] = Services.prefs.getIntPref(&quot;calendar.alarms.&quot; + type + &quot;alarmlen&quot;, 0);</span>
<a href="#l28.41"></a><span id="l28.41">             alarmOffset.normalize();</span>
<a href="#l28.42"></a><span id="l28.42">             alarmOffset.isNegative = true;</span>
<a href="#l28.43"></a><span id="l28.43">             if (type == &quot;todo&quot; &amp;&amp; !aItem.entryDate) {</span>
<a href="#l28.44"></a><span id="l28.44">                 // You can't have an alarm if the entryDate doesn't exist.</span>
<a href="#l28.45"></a><span id="l28.45">                 aItem.entryDate = cal.dtz.now();</span>
<a href="#l28.46"></a><span id="l28.46">             }</span>
<a href="#l28.47"></a><span id="l28.47">             alarm.related = Ci.calIAlarm.ALARM_RELATED_START;</span>
<a href="#l28.48"></a><span id="l28.48">             alarm.offset = alarmOffset;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/modules/utils/calAuthUtils.jsm</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/modules/utils/calAuthUtils.jsm</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -1,13 +1,12 @@</span>
<a href="#l29.4"></a><span id="l29.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l29.5"></a><span id="l29.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l29.6"></a><span id="l29.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l29.7"></a><span id="l29.7"> </span>
<a href="#l29.8"></a><span id="l29.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l29.9"></a><span id="l29.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l29.10"></a><span id="l29.10"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12"> XPCOMUtils.defineLazyModuleGetter(this, &quot;cal&quot;, &quot;resource://calendar/modules/calUtils.jsm&quot;, &quot;cal&quot;);</span>
<a href="#l29.13"></a><span id="l29.13"> </span>
<a href="#l29.14"></a><span id="l29.14"> /*</span>
<a href="#l29.15"></a><span id="l29.15">  * Authentication tools and prompts, mostly for providers</span>
<a href="#l29.16"></a><span id="l29.16">  */</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineat">@@ -100,17 +99,17 @@ var calauth = {</span>
<a href="#l29.18"></a><span id="l29.18"> </span>
<a href="#l29.19"></a><span id="l29.19">             let pwInfo = this.getPasswordInfo(hostRealm);</span>
<a href="#l29.20"></a><span id="l29.20">             aAuthInfo.username = pwInfo.username;</span>
<a href="#l29.21"></a><span id="l29.21">             if (pwInfo &amp;&amp; pwInfo.found) {</span>
<a href="#l29.22"></a><span id="l29.22">                 aAuthInfo.password = pwInfo.password;</span>
<a href="#l29.23"></a><span id="l29.23">                 return true;</span>
<a href="#l29.24"></a><span id="l29.24">             } else {</span>
<a href="#l29.25"></a><span id="l29.25">                 let savePasswordLabel = null;</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineminus">-                if (Preferences.get(&quot;signon.rememberSignons&quot;, true)) {</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineplus">+                if (Services.prefs.getBoolPref(&quot;signon.rememberSignons&quot;, true)) {</span>
<a href="#l29.28"></a><span id="l29.28">                     savePasswordLabel = cal.l10n.getAnyString(&quot;passwordmgr&quot;,</span>
<a href="#l29.29"></a><span id="l29.29">                                                               &quot;passwordmgr&quot;,</span>
<a href="#l29.30"></a><span id="l29.30">                                                               &quot;rememberPassword&quot;);</span>
<a href="#l29.31"></a><span id="l29.31">                 }</span>
<a href="#l29.32"></a><span id="l29.32">                 let savePassword = {};</span>
<a href="#l29.33"></a><span id="l29.33">                 let returnValue = Services.prompt.promptAuth(null, aChannel, aLevel, aAuthInfo,</span>
<a href="#l29.34"></a><span id="l29.34">                                                              savePasswordLabel, savePassword);</span>
<a href="#l29.35"></a><span id="l29.35">                 if (savePassword.value) {</span>
<a href="#l29.36"></a><span id="l29.36" class="difflineat">@@ -201,17 +200,17 @@ var calauth = {</span>
<a href="#l29.37"></a><span id="l29.37">             typeof aSavePassword != &quot;object&quot;) {</span>
<a href="#l29.38"></a><span id="l29.38">             throw new Components.Exception(&quot;&quot;, Cr.NS_ERROR_XPC_NEED_OUT_OBJECT);</span>
<a href="#l29.39"></a><span id="l29.39">         }</span>
<a href="#l29.40"></a><span id="l29.40"> </span>
<a href="#l29.41"></a><span id="l29.41">         let prompter = Services.ww.getNewPrompter(null);</span>
<a href="#l29.42"></a><span id="l29.42"> </span>
<a href="#l29.43"></a><span id="l29.43">         // Only show the save password box if we are supposed to.</span>
<a href="#l29.44"></a><span id="l29.44">         let savepassword = null;</span>
<a href="#l29.45"></a><span id="l29.45" class="difflineminus">-        if (Preferences.get(&quot;signon.rememberSignons&quot;, true)) {</span>
<a href="#l29.46"></a><span id="l29.46" class="difflineplus">+        if (Services.prefs.getBoolPref(&quot;signon.rememberSignons&quot;, true)) {</span>
<a href="#l29.47"></a><span id="l29.47">             savepassword = cal.l10n.getAnyString(&quot;passwordmgr&quot;, &quot;passwordmgr&quot;, &quot;rememberPassword&quot;);</span>
<a href="#l29.48"></a><span id="l29.48">         }</span>
<a href="#l29.49"></a><span id="l29.49"> </span>
<a href="#l29.50"></a><span id="l29.50">         let aText;</span>
<a href="#l29.51"></a><span id="l29.51">         if (aFixedUsername) {</span>
<a href="#l29.52"></a><span id="l29.52">             aText = cal.l10n.getAnyString(&quot;global&quot;, &quot;commonDialogs&quot;, &quot;EnterPasswordFor&quot;, [aUsername.value, aCalendarName]);</span>
<a href="#l29.53"></a><span id="l29.53">             return prompter.promptPassword(aTitle,</span>
<a href="#l29.54"></a><span id="l29.54">                                            aText,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/modules/utils/calCategoryUtils.jsm</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/modules/utils/calCategoryUtils.jsm</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l30.4"></a><span id="l30.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l30.5"></a><span id="l30.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l30.6"></a><span id="l30.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l30.9"></a><span id="l30.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l30.10"></a><span id="l30.10"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12"> XPCOMUtils.defineLazyModuleGetter(this, &quot;cal&quot;, &quot;resource://calendar/modules/calUtils.jsm&quot;, &quot;cal&quot;);</span>
<a href="#l30.13"></a><span id="l30.13"> </span>
<a href="#l30.14"></a><span id="l30.14"> /*</span>
<a href="#l30.15"></a><span id="l30.15">  * Helpers for reading and writing calendar categories</span>
<a href="#l30.16"></a><span id="l30.16">  */</span>
<a href="#l30.17"></a><span id="l30.17"> </span>
<a href="#l30.18"></a><span id="l30.18" class="difflineat">@@ -20,38 +20,38 @@ var calcategory = {</span>
<a href="#l30.19"></a><span id="l30.19">     /**</span>
<a href="#l30.20"></a><span id="l30.20">      * Sets up the default categories from the localized string</span>
<a href="#l30.21"></a><span id="l30.21">      *</span>
<a href="#l30.22"></a><span id="l30.22">      * @return      The default set of categories as a comma separated string.</span>
<a href="#l30.23"></a><span id="l30.23">      */</span>
<a href="#l30.24"></a><span id="l30.24">     setupDefaultCategories: function() {</span>
<a href="#l30.25"></a><span id="l30.25">         // First, set up the category names</span>
<a href="#l30.26"></a><span id="l30.26">         let categories = cal.l10n.getString(&quot;categories&quot;, &quot;categories2&quot;);</span>
<a href="#l30.27"></a><span id="l30.27" class="difflineminus">-        Preferences.set(&quot;calendar.categories.names&quot;, categories);</span>
<a href="#l30.28"></a><span id="l30.28" class="difflineplus">+        Services.prefs.setStringPref(&quot;calendar.categories.names&quot;, categories);</span>
<a href="#l30.29"></a><span id="l30.29"> </span>
<a href="#l30.30"></a><span id="l30.30">         // Now, initialize the category default colors</span>
<a href="#l30.31"></a><span id="l30.31">         let categoryArray = calcategory.stringToArray(categories);</span>
<a href="#l30.32"></a><span id="l30.32">         for (let category of categoryArray) {</span>
<a href="#l30.33"></a><span id="l30.33">             let prefName = cal.view.formatStringForCSSRule(category);</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineminus">-            Preferences.set(&quot;calendar.category.color.&quot; + prefName,</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineminus">-                            cal.view.hashColor(category));</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineplus">+            Services.prefs.setStringPref(&quot;calendar.category.color.&quot; + prefName,</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineplus">+                                         cal.view.hashColor(category));</span>
<a href="#l30.38"></a><span id="l30.38">         }</span>
<a href="#l30.39"></a><span id="l30.39"> </span>
<a href="#l30.40"></a><span id="l30.40">         // Return the list of categories for further processing</span>
<a href="#l30.41"></a><span id="l30.41">         return categories;</span>
<a href="#l30.42"></a><span id="l30.42">     },</span>
<a href="#l30.43"></a><span id="l30.43"> </span>
<a href="#l30.44"></a><span id="l30.44">     /**</span>
<a href="#l30.45"></a><span id="l30.45">      * Get array of category names from preferences or locale default,</span>
<a href="#l30.46"></a><span id="l30.46">      * unescaping any commas in each category name.</span>
<a href="#l30.47"></a><span id="l30.47">      *</span>
<a href="#l30.48"></a><span id="l30.48">      * @return                      array of category names</span>
<a href="#l30.49"></a><span id="l30.49">      */</span>
<a href="#l30.50"></a><span id="l30.50">     fromPrefs: function() {</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineminus">-        let categories = Preferences.get(&quot;calendar.categories.names&quot;, null);</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineplus">+        let categories = Services.prefs.getStringPref(&quot;calendar.categories.names&quot;, null);</span>
<a href="#l30.53"></a><span id="l30.53"> </span>
<a href="#l30.54"></a><span id="l30.54">         // If no categories are configured load a default set from properties file</span>
<a href="#l30.55"></a><span id="l30.55">         if (!categories) {</span>
<a href="#l30.56"></a><span id="l30.56">             categories = calcategory.setupDefaultCategories();</span>
<a href="#l30.57"></a><span id="l30.57">         }</span>
<a href="#l30.58"></a><span id="l30.58">         return calcategory.stringToArray(categories);</span>
<a href="#l30.59"></a><span id="l30.59">     },</span>
<a href="#l30.60"></a><span id="l30.60"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/base/modules/utils/calDateTimeUtils.jsm</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/base/modules/utils/calDateTimeUtils.jsm</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l31.4"></a><span id="l31.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l31.5"></a><span id="l31.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l31.6"></a><span id="l31.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l31.9"></a><span id="l31.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l31.10"></a><span id="l31.10"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12"> XPCOMUtils.defineLazyModuleGetter(this, &quot;cal&quot;, &quot;resource://calendar/modules/calUtils.jsm&quot;, &quot;cal&quot;);</span>
<a href="#l31.13"></a><span id="l31.13"> </span>
<a href="#l31.14"></a><span id="l31.14"> /*</span>
<a href="#l31.15"></a><span id="l31.15">  * Date, time and timezone related functions</span>
<a href="#l31.16"></a><span id="l31.16">  */</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18" class="difflineat">@@ -47,17 +47,17 @@ var caldtz = {</span>
<a href="#l31.19"></a><span id="l31.19">         let recentTimezones = caldtz.getRecentTimezones();</span>
<a href="#l31.20"></a><span id="l31.20">         const MAX_RECENT_TIMEZONES = 5; // We don't need a pref for *everything*.</span>
<a href="#l31.21"></a><span id="l31.21"> </span>
<a href="#l31.22"></a><span id="l31.22">         if (aTzid != caldtz.defaultTimezone.tzid &amp;&amp;</span>
<a href="#l31.23"></a><span id="l31.23">             !recentTimezones.includes(aTzid)) {</span>
<a href="#l31.24"></a><span id="l31.24">             // Add the timezone if its not already the default timezone</span>
<a href="#l31.25"></a><span id="l31.25">             recentTimezones.unshift(aTzid);</span>
<a href="#l31.26"></a><span id="l31.26">             recentTimezones.splice(MAX_RECENT_TIMEZONES);</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineminus">-            Preferences.set(&quot;calendar.timezone.recent&quot;, JSON.stringify(recentTimezones));</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineplus">+            Services.prefs.setStringPref(&quot;calendar.timezone.recent&quot;, JSON.stringify(recentTimezones));</span>
<a href="#l31.29"></a><span id="l31.29">         }</span>
<a href="#l31.30"></a><span id="l31.30">     },</span>
<a href="#l31.31"></a><span id="l31.31"> </span>
<a href="#l31.32"></a><span id="l31.32">     /**</span>
<a href="#l31.33"></a><span id="l31.33">      * Returns a calIDateTime that corresponds to the current time in the user's</span>
<a href="#l31.34"></a><span id="l31.34">      * default timezone.</span>
<a href="#l31.35"></a><span id="l31.35">      */</span>
<a href="#l31.36"></a><span id="l31.36">     now: function() {</span>
<a href="#l31.37"></a><span id="l31.37" class="difflineat">@@ -100,17 +100,17 @@ var caldtz = {</span>
<a href="#l31.38"></a><span id="l31.38">      * @param aReferenceDate    If passed, the time of this date will be modified,</span>
<a href="#l31.39"></a><span id="l31.39">      *                            keeping the date and timezone intact.</span>
<a href="#l31.40"></a><span id="l31.40">      */</span>
<a href="#l31.41"></a><span id="l31.41">     setDefaultStartEndHour: function(aItem, aReferenceDate) {</span>
<a href="#l31.42"></a><span id="l31.42">         aItem[caldtz.startDateProp(aItem)] = caldtz.getDefaultStartDate(aReferenceDate);</span>
<a href="#l31.43"></a><span id="l31.43"> </span>
<a href="#l31.44"></a><span id="l31.44">         if (cal.item.isEvent(aItem)) {</span>
<a href="#l31.45"></a><span id="l31.45">             aItem.endDate = aItem.startDate.clone();</span>
<a href="#l31.46"></a><span id="l31.46" class="difflineminus">-            aItem.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l31.47"></a><span id="l31.47" class="difflineplus">+            aItem.endDate.minute += Services.prefs.getIntPref(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l31.48"></a><span id="l31.48">         }</span>
<a href="#l31.49"></a><span id="l31.49">     },</span>
<a href="#l31.50"></a><span id="l31.50"> </span>
<a href="#l31.51"></a><span id="l31.51">     /**</span>
<a href="#l31.52"></a><span id="l31.52">      * Returns the property name used for the start date of an item, ie either an</span>
<a href="#l31.53"></a><span id="l31.53">      * event's start date or a task's entry date.</span>
<a href="#l31.54"></a><span id="l31.54">      */</span>
<a href="#l31.55"></a><span id="l31.55">     startDateProp: function(aItem) {</span>
<a href="#l31.56"></a><span id="l31.56" class="difflineat">@@ -342,17 +342,17 @@ var caldtz = {</span>
<a href="#l31.57"></a><span id="l31.57">     /**</span>
<a href="#l31.58"></a><span id="l31.58">      * Gets the list of recent timezones. Optionally retuns the list as</span>
<a href="#l31.59"></a><span id="l31.59">      * calITimezones.</span>
<a href="#l31.60"></a><span id="l31.60">      *</span>
<a href="#l31.61"></a><span id="l31.61">      * @param aConvertZones     (optional) If true, return calITimezones instead</span>
<a href="#l31.62"></a><span id="l31.62">      * @return                  An array of timezone ids or calITimezones.</span>
<a href="#l31.63"></a><span id="l31.63">      */</span>
<a href="#l31.64"></a><span id="l31.64">     getRecentTimezones: function(aConvertZones) {</span>
<a href="#l31.65"></a><span id="l31.65" class="difflineminus">-        let recentTimezones = JSON.parse(Preferences.get(&quot;calendar.timezone.recent&quot;, &quot;[]&quot;) || &quot;[]&quot;);</span>
<a href="#l31.66"></a><span id="l31.66" class="difflineplus">+        let recentTimezones = JSON.parse(Services.prefs.getStringPref(&quot;calendar.timezone.recent&quot;, &quot;[]&quot;) || &quot;[]&quot;);</span>
<a href="#l31.67"></a><span id="l31.67">         if (!Array.isArray(recentTimezones)) {</span>
<a href="#l31.68"></a><span id="l31.68">             recentTimezones = [];</span>
<a href="#l31.69"></a><span id="l31.69">         }</span>
<a href="#l31.70"></a><span id="l31.70"> </span>
<a href="#l31.71"></a><span id="l31.71">         let tzService = cal.getTimezoneService();</span>
<a href="#l31.72"></a><span id="l31.72">         if (aConvertZones) {</span>
<a href="#l31.73"></a><span id="l31.73">             let oldZonesLength = recentTimezones.length;</span>
<a href="#l31.74"></a><span id="l31.74">             for (let i = 0; i &lt; recentTimezones.length; i++) {</span>
<a href="#l31.75"></a><span id="l31.75" class="difflineat">@@ -365,17 +365,17 @@ var caldtz = {</span>
<a href="#l31.76"></a><span id="l31.76">                     recentTimezones.splice(i, 1);</span>
<a href="#l31.77"></a><span id="l31.77">                     i--;</span>
<a href="#l31.78"></a><span id="l31.78">                 }</span>
<a href="#l31.79"></a><span id="l31.79">             }</span>
<a href="#l31.80"></a><span id="l31.80"> </span>
<a href="#l31.81"></a><span id="l31.81">             if (oldZonesLength != recentTimezones.length) {</span>
<a href="#l31.82"></a><span id="l31.82">                 // Looks like the one or other timezone dropped out. Go ahead and</span>
<a href="#l31.83"></a><span id="l31.83">                 // modify the pref.</span>
<a href="#l31.84"></a><span id="l31.84" class="difflineminus">-                Preferences.set(</span>
<a href="#l31.85"></a><span id="l31.85" class="difflineplus">+                Services.prefs.setStringPref(</span>
<a href="#l31.86"></a><span id="l31.86">                     &quot;calendar.timezone.recent&quot;,</span>
<a href="#l31.87"></a><span id="l31.87">                     JSON.stringify(recentTimezones.map(zone =&gt; zone.tzid))</span>
<a href="#l31.88"></a><span id="l31.88">                 );</span>
<a href="#l31.89"></a><span id="l31.89">             }</span>
<a href="#l31.90"></a><span id="l31.90">         }</span>
<a href="#l31.91"></a><span id="l31.91">         return recentTimezones;</span>
<a href="#l31.92"></a><span id="l31.92">     }</span>
<a href="#l31.93"></a><span id="l31.93"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/base/modules/utils/calItemUtils.jsm</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/base/modules/utils/calItemUtils.jsm</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -1,14 +1,13 @@</span>
<a href="#l32.4"></a><span id="l32.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l32.5"></a><span id="l32.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l32.6"></a><span id="l32.6">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8"> var { Deprecated } = ChromeUtils.import(&quot;resource://gre/modules/Deprecated.jsm&quot;);</span>
<a href="#l32.9"></a><span id="l32.9" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l32.10"></a><span id="l32.10"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l32.11"></a><span id="l32.11"> </span>
<a href="#l32.12"></a><span id="l32.12"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calHashedArray.jsm&quot;);</span>
<a href="#l32.13"></a><span id="l32.13"> </span>
<a href="#l32.14"></a><span id="l32.14"> /*</span>
<a href="#l32.15"></a><span id="l32.15">  * Calendar item related functions</span>
<a href="#l32.16"></a><span id="l32.16">  */</span>
<a href="#l32.17"></a><span id="l32.17"> </span>
<a href="#l32.18"></a><span id="l32.18" class="difflineat">@@ -380,21 +379,21 @@ var calitem = {</span>
<a href="#l32.19"></a><span id="l32.19">     /**</span>
<a href="#l32.20"></a><span id="l32.20">      * Returns the default transparency to apply for an event depending on whether its an all-day event</span>
<a href="#l32.21"></a><span id="l32.21">      *</span>
<a href="#l32.22"></a><span id="l32.22">      * @param aIsAllDay      If true, the default transparency for all-day events is returned</span>
<a href="#l32.23"></a><span id="l32.23">      */</span>
<a href="#l32.24"></a><span id="l32.24">     getEventDefaultTransparency: function(aIsAllDay) {</span>
<a href="#l32.25"></a><span id="l32.25">         let transp = null;</span>
<a href="#l32.26"></a><span id="l32.26">         if (aIsAllDay) {</span>
<a href="#l32.27"></a><span id="l32.27" class="difflineminus">-            transp = Preferences.get(&quot;calendar.events.defaultTransparency.allday.transparent&quot;, false)</span>
<a href="#l32.28"></a><span id="l32.28" class="difflineplus">+            transp = Services.prefs.getBoolPref(&quot;calendar.events.defaultTransparency.allday.transparent&quot;, false)</span>
<a href="#l32.29"></a><span id="l32.29">                      ? &quot;TRANSPARENT&quot;</span>
<a href="#l32.30"></a><span id="l32.30">                      : &quot;OPAQUE&quot;;</span>
<a href="#l32.31"></a><span id="l32.31">         } else {</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineminus">-            transp = Preferences.get(&quot;calendar.events.defaultTransparency.standard.transparent&quot;, false)</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineplus">+            transp = Services.prefs.getBoolPref(&quot;calendar.events.defaultTransparency.standard.transparent&quot;, false)</span>
<a href="#l32.34"></a><span id="l32.34">                      ? &quot;TRANSPARENT&quot;</span>
<a href="#l32.35"></a><span id="l32.35">                      : &quot;OPAQUE&quot;;</span>
<a href="#l32.36"></a><span id="l32.36">         }</span>
<a href="#l32.37"></a><span id="l32.37">         return transp;</span>
<a href="#l32.38"></a><span id="l32.38">     },</span>
<a href="#l32.39"></a><span id="l32.39"> </span>
<a href="#l32.40"></a><span id="l32.40"> </span>
<a href="#l32.41"></a><span id="l32.41">     /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/base/modules/utils/calIteratorUtils.jsm</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/base/modules/utils/calIteratorUtils.jsm</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -1,13 +1,12 @@</span>
<a href="#l33.4"></a><span id="l33.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l33.5"></a><span id="l33.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l33.6"></a><span id="l33.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l33.7"></a><span id="l33.7"> </span>
<a href="#l33.8"></a><span id="l33.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l33.9"></a><span id="l33.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l33.10"></a><span id="l33.10"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l33.11"></a><span id="l33.11"> </span>
<a href="#l33.12"></a><span id="l33.12"> XPCOMUtils.defineLazyModuleGetter(this, &quot;cal&quot;, &quot;resource://calendar/modules/calUtils.jsm&quot;, &quot;cal&quot;);</span>
<a href="#l33.13"></a><span id="l33.13"> </span>
<a href="#l33.14"></a><span id="l33.14"> /*</span>
<a href="#l33.15"></a><span id="l33.15">  * Iterators for various data structures</span>
<a href="#l33.16"></a><span id="l33.16">  */</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineat">@@ -54,17 +53,17 @@ var caliterate = {</span>
<a href="#l33.18"></a><span id="l33.18">      *                                    single item from the iterator.</span>
<a href="#l33.19"></a><span id="l33.19">      * @param {?Function} completed     [optional] The function called after the loop completes.</span>
<a href="#l33.20"></a><span id="l33.20">      */</span>
<a href="#l33.21"></a><span id="l33.21">     forEach: (() =&gt; {</span>
<a href="#l33.22"></a><span id="l33.22">         // eslint-disable-next-line require-jsdoc</span>
<a href="#l33.23"></a><span id="l33.23">         function forEach(iterable, body, completed=null) {</span>
<a href="#l33.24"></a><span id="l33.24">             // This should be a const one day, lets keep it a pref for now though until we</span>
<a href="#l33.25"></a><span id="l33.25">             // find a sane value.</span>
<a href="#l33.26"></a><span id="l33.26" class="difflineminus">-            let LATENCY = Preferences.get(&quot;calendar.threading.latency&quot;, 250);</span>
<a href="#l33.27"></a><span id="l33.27" class="difflineplus">+            let LATENCY = Services.prefs.getIntPref(&quot;calendar.threading.latency&quot;, 250);</span>
<a href="#l33.28"></a><span id="l33.28"> </span>
<a href="#l33.29"></a><span id="l33.29">             if (typeof iterable == &quot;object&quot; &amp;&amp; !iterable[Symbol.iterator]) {</span>
<a href="#l33.30"></a><span id="l33.30">                 iterable = Object.entries(iterable);</span>
<a href="#l33.31"></a><span id="l33.31">             }</span>
<a href="#l33.32"></a><span id="l33.32"> </span>
<a href="#l33.33"></a><span id="l33.33">             let ourIter = iterable[Symbol.iterator]();</span>
<a href="#l33.34"></a><span id="l33.34">             let currentThread = Services.tm.currentThread;</span>
<a href="#l33.35"></a><span id="l33.35"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/base/modules/utils/calItipUtils.jsm</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/base/modules/utils/calItipUtils.jsm</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l34.4"></a><span id="l34.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l34.5"></a><span id="l34.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l34.6"></a><span id="l34.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l34.9"></a><span id="l34.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l34.10"></a><span id="l34.10"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12"> var { MailServices } = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l34.13"></a><span id="l34.13"> </span>
<a href="#l34.14"></a><span id="l34.14"> XPCOMUtils.defineLazyModuleGetter(this, &quot;cal&quot;, &quot;resource://calendar/modules/calUtils.jsm&quot;, &quot;cal&quot;);</span>
<a href="#l34.15"></a><span id="l34.15"> </span>
<a href="#l34.16"></a><span id="l34.16"> /*</span>
<a href="#l34.17"></a><span id="l34.17">  * Scheduling and iTIP helper code</span>
<a href="#l34.18"></a><span id="l34.18" class="difflineat">@@ -276,17 +276,17 @@ var calitip = {</span>
<a href="#l34.19"></a><span id="l34.19">      * @return {Object}                     Return information about the options</span>
<a href="#l34.20"></a><span id="l34.20">      */</span>
<a href="#l34.21"></a><span id="l34.21">     getOptionsText: function(itipItem, rc, actionFunc, foundItems) {</span>
<a href="#l34.22"></a><span id="l34.22">         let imipLabel = null;</span>
<a href="#l34.23"></a><span id="l34.23">         if (itipItem.receivedMethod) {</span>
<a href="#l34.24"></a><span id="l34.24">             imipLabel = calitip.getMethodText(itipItem.receivedMethod);</span>
<a href="#l34.25"></a><span id="l34.25">         }</span>
<a href="#l34.26"></a><span id="l34.26">         let data = { label: imipLabel, showItems: [], hideItems: [] };</span>
<a href="#l34.27"></a><span id="l34.27" class="difflineminus">-        let separateButtons = Preferences.get(&quot;calendar.itip.separateInvitationButtons&quot;, false);</span>
<a href="#l34.28"></a><span id="l34.28" class="difflineplus">+        let separateButtons = Services.prefs.getBoolPref(&quot;calendar.itip.separateInvitationButtons&quot;, false);</span>
<a href="#l34.29"></a><span id="l34.29"> </span>
<a href="#l34.30"></a><span id="l34.30">         let disallowedCounter = false;</span>
<a href="#l34.31"></a><span id="l34.31">         if (foundItems &amp;&amp; foundItems.length) {</span>
<a href="#l34.32"></a><span id="l34.32">             let disallow = foundItems[0].getProperty(&quot;X-MICROSOFT-DISALLOW-COUNTER&quot;);</span>
<a href="#l34.33"></a><span id="l34.33">             disallowedCounter = disallow &amp;&amp; disallow == &quot;TRUE&quot;;</span>
<a href="#l34.34"></a><span id="l34.34">         }</span>
<a href="#l34.35"></a><span id="l34.35">         if (rc == Ci.calIErrors.CAL_IS_READONLY) {</span>
<a href="#l34.36"></a><span id="l34.36">             // No writable calendars, tell the user about it</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineat">@@ -807,17 +807,17 @@ var calitip = {</span>
<a href="#l34.38"></a><span id="l34.38">                     if (aItem.hasProperty(&quot;X-MS-OLK-SENDER&quot;)) {</span>
<a href="#l34.39"></a><span id="l34.39">                         aItem.deleteProperty(&quot;X-MS-OLK-SENDER&quot;);</span>
<a href="#l34.40"></a><span id="l34.40">                     }</span>
<a href="#l34.41"></a><span id="l34.41">                     // if the event was delegated to the replying attendee, we may also notify also</span>
<a href="#l34.42"></a><span id="l34.42">                     // the delegator due to chapter 3.2.2.3. of RfC 5546</span>
<a href="#l34.43"></a><span id="l34.43">                     let replyTo = [];</span>
<a href="#l34.44"></a><span id="l34.44">                     let delegatorIds = invitedAttendee.getProperty(&quot;DELEGATED-FROM&quot;);</span>
<a href="#l34.45"></a><span id="l34.45">                     if (delegatorIds &amp;&amp;</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineminus">-                        Preferences.get(&quot;calendar.itip.notifyDelegatorOnReply&quot;, false)) {</span>
<a href="#l34.47"></a><span id="l34.47" class="difflineplus">+                        Services.prefs.getBoolPref(&quot;calendar.itip.notifyDelegatorOnReply&quot;, false)) {</span>
<a href="#l34.48"></a><span id="l34.48">                         let getDelegator = function(aDelegatorId) {</span>
<a href="#l34.49"></a><span id="l34.49">                             let delegator = aOriginalItem.getAttendeeById(aDelegatorId);</span>
<a href="#l34.50"></a><span id="l34.50">                             if (delegator) {</span>
<a href="#l34.51"></a><span id="l34.51">                                 replyTo.push(delegator);</span>
<a href="#l34.52"></a><span id="l34.52">                             }</span>
<a href="#l34.53"></a><span id="l34.53">                         };</span>
<a href="#l34.54"></a><span id="l34.54">                         // Our backends currently do not support multi-value params. libical just</span>
<a href="#l34.55"></a><span id="l34.55">                         // swallows any value but the first, while ical.js fails to parse the item</span>
<a href="#l34.56"></a><span id="l34.56" class="difflineat">@@ -925,17 +925,17 @@ var calitip = {</span>
<a href="#l34.57"></a><span id="l34.57"> </span>
<a href="#l34.58"></a><span id="l34.58">                 // if send out should be limited to newly added attendees and no major</span>
<a href="#l34.59"></a><span id="l34.59">                 // props (attendee is not such) have changed, only the respective attendee</span>
<a href="#l34.60"></a><span id="l34.60">                 // is added to the recipient list while the attendee information in the</span>
<a href="#l34.61"></a><span id="l34.61">                 // ical is left to enable the new attendee to see who else is attending</span>
<a href="#l34.62"></a><span id="l34.62">                 // the event (if not prevented otherwise)</span>
<a href="#l34.63"></a><span id="l34.63">                 if (isMinorUpdate &amp;&amp;</span>
<a href="#l34.64"></a><span id="l34.64">                     addedAttendees.length &gt; 0 &amp;&amp;</span>
<a href="#l34.65"></a><span id="l34.65" class="difflineminus">-                    Preferences.get(&quot;calendar.itip.updateInvitationForNewAttendeesOnly&quot;, false)) {</span>
<a href="#l34.66"></a><span id="l34.66" class="difflineplus">+                    Services.prefs.getBoolPref(&quot;calendar.itip.updateInvitationForNewAttendeesOnly&quot;, false)) {</span>
<a href="#l34.67"></a><span id="l34.67">                     recipients = addedAttendees;</span>
<a href="#l34.68"></a><span id="l34.68">                 }</span>
<a href="#l34.69"></a><span id="l34.69"> </span>
<a href="#l34.70"></a><span id="l34.70">                 if (recipients.length &gt; 0) {</span>
<a href="#l34.71"></a><span id="l34.71">                     sendOut = sendMessage(requestItem, &quot;REQUEST&quot;, recipients, autoResponse);</span>
<a href="#l34.72"></a><span id="l34.72">                 }</span>
<a href="#l34.73"></a><span id="l34.73">             }</span>
<a href="#l34.74"></a><span id="l34.74">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/base/modules/utils/calPrintUtils.jsm</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/base/modules/utils/calPrintUtils.jsm</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l35.4"></a><span id="l35.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l35.5"></a><span id="l35.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l35.6"></a><span id="l35.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l35.7"></a><span id="l35.7"> </span>
<a href="#l35.8"></a><span id="l35.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l35.9"></a><span id="l35.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l35.10"></a><span id="l35.10"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l35.11"></a><span id="l35.11"> </span>
<a href="#l35.12"></a><span id="l35.12"> XPCOMUtils.defineLazyModuleGetter(this, &quot;cal&quot;, &quot;resource://calendar/modules/calUtils.jsm&quot;, &quot;cal&quot;);</span>
<a href="#l35.13"></a><span id="l35.13"> </span>
<a href="#l35.14"></a><span id="l35.14"> /*</span>
<a href="#l35.15"></a><span id="l35.15">  * Helpers for printing and print preparation</span>
<a href="#l35.16"></a><span id="l35.16">  */</span>
<a href="#l35.17"></a><span id="l35.17"> </span>
<a href="#l35.18"></a><span id="l35.18" class="difflineat">@@ -38,17 +38,17 @@ var calprint = {</span>
<a href="#l35.19"></a><span id="l35.19">      * @param categories    Array of categories to insert rules for.</span>
<a href="#l35.20"></a><span id="l35.20">      */</span>
<a href="#l35.21"></a><span id="l35.21">     insertCategoryRules: function(document, categories) {</span>
<a href="#l35.22"></a><span id="l35.22">         let sheet = document.getElementById(&quot;sheet&quot;);</span>
<a href="#l35.23"></a><span id="l35.23">         sheet.insertedCategoryRules = sheet.insertedCategoryRules || {};</span>
<a href="#l35.24"></a><span id="l35.24"> </span>
<a href="#l35.25"></a><span id="l35.25">         for (let category of categories) {</span>
<a href="#l35.26"></a><span id="l35.26">             let prefName = cal.view.formatStringForCSSRule(category);</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineminus">-            let color = Preferences.get(&quot;calendar.category.color.&quot; + prefName) || &quot;transparent&quot;;</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineplus">+            let color = Services.prefs.getStringPref(&quot;calendar.category.color.&quot; + prefName, &quot;transparent&quot;);</span>
<a href="#l35.29"></a><span id="l35.29">             if (!(prefName in sheet.insertedCategoryRules)) {</span>
<a href="#l35.30"></a><span id="l35.30">                 sheet.insertedCategoryRules[prefName] = true;</span>
<a href="#l35.31"></a><span id="l35.31">                 let ruleAdd = ' .category-color-box[categories~=&quot;' + prefName + '&quot;] { ' +</span>
<a href="#l35.32"></a><span id="l35.32">                               &quot; border: 2px solid &quot; + color + &quot;; }\n&quot;;</span>
<a href="#l35.33"></a><span id="l35.33">                 sheet.textContent += ruleAdd;</span>
<a href="#l35.34"></a><span id="l35.34">             }</span>
<a href="#l35.35"></a><span id="l35.35">         }</span>
<a href="#l35.36"></a><span id="l35.36">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/base/modules/utils/calProviderUtils.jsm</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/base/modules/utils/calProviderUtils.jsm</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -1,16 +1,15 @@</span>
<a href="#l36.4"></a><span id="l36.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l36.5"></a><span id="l36.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l36.6"></a><span id="l36.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8"> var { MailServices } = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l36.9"></a><span id="l36.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l36.10"></a><span id="l36.10"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l36.11"></a><span id="l36.11" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l36.12"></a><span id="l36.12"> var { fixIterator } = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l36.13"></a><span id="l36.13"> </span>
<a href="#l36.14"></a><span id="l36.14"> XPCOMUtils.defineLazyModuleGetter(this, &quot;cal&quot;, &quot;resource://calendar/modules/calUtils.jsm&quot;, &quot;cal&quot;);</span>
<a href="#l36.15"></a><span id="l36.15"> ChromeUtils.defineModuleGetter(this, &quot;Deprecated&quot;, &quot;resource://gre/modules/Deprecated.jsm&quot;);</span>
<a href="#l36.16"></a><span id="l36.16"> </span>
<a href="#l36.17"></a><span id="l36.17"> /*</span>
<a href="#l36.18"></a><span id="l36.18">  * Helpers and base class for calendar providers</span>
<a href="#l36.19"></a><span id="l36.19">  */</span>
<a href="#l36.20"></a><span id="l36.20" class="difflineat">@@ -589,17 +588,17 @@ var calprovider = {</span>
<a href="#l36.21"></a><span id="l36.21">         }</span>
<a href="#l36.22"></a><span id="l36.22"> </span>
<a href="#l36.23"></a><span id="l36.23">         // nsIVariant getProperty(in AUTF8String aName);</span>
<a href="#l36.24"></a><span id="l36.24">         getProperty(aName) {</span>
<a href="#l36.25"></a><span id="l36.25">             switch (aName) {</span>
<a href="#l36.26"></a><span id="l36.26">                 case &quot;itip.transport&quot;: // iTIP/iMIP default:</span>
<a href="#l36.27"></a><span id="l36.27">                     return calprovider.getImipTransport(this);</span>
<a href="#l36.28"></a><span id="l36.28">                 case &quot;itip.notify-replies&quot;: // iTIP/iMIP default:</span>
<a href="#l36.29"></a><span id="l36.29" class="difflineminus">-                    return Preferences.get(&quot;calendar.itip.notify-replies&quot;, false);</span>
<a href="#l36.30"></a><span id="l36.30" class="difflineplus">+                    return Services.prefs.getBoolPref(&quot;calendar.itip.notify-replies&quot;, false);</span>
<a href="#l36.31"></a><span id="l36.31">                 // temporary hack to get the uncached calendar instance:</span>
<a href="#l36.32"></a><span id="l36.32">                 case &quot;cache.uncachedCalendar&quot;:</span>
<a href="#l36.33"></a><span id="l36.33">                     return this;</span>
<a href="#l36.34"></a><span id="l36.34">             }</span>
<a href="#l36.35"></a><span id="l36.35"> </span>
<a href="#l36.36"></a><span id="l36.36">             let ret = this.mProperties[aName];</span>
<a href="#l36.37"></a><span id="l36.37">             if (ret === undefined) {</span>
<a href="#l36.38"></a><span id="l36.38">                 ret = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l37.4"></a><span id="l37.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l37.5"></a><span id="l37.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l37.6"></a><span id="l37.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l37.7"></a><span id="l37.7"> </span>
<a href="#l37.8"></a><span id="l37.8"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l37.9"></a><span id="l37.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l37.10"></a><span id="l37.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12"> function peekAlarmWindow() {</span>
<a href="#l37.13"></a><span id="l37.13">     return Services.wm.getMostRecentWindow(&quot;Calendar:AlarmWindow&quot;);</span>
<a href="#l37.14"></a><span id="l37.14"> }</span>
<a href="#l37.15"></a><span id="l37.15"> </span>
<a href="#l37.16"></a><span id="l37.16"> /**</span>
<a href="#l37.17"></a><span id="l37.17">  * The alarm monitor takes care of playing the alarm sound and opening one copy</span>
<a href="#l37.18"></a><span id="l37.18">  * of the calendar-alarm-dialog. Both depend on their respective prefs to be</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineat">@@ -70,53 +69,53 @@ calAlarmMonitor.prototype = {</span>
<a href="#l37.20"></a><span id="l37.20">     onAlarm: function(aItem, aAlarm) {</span>
<a href="#l37.21"></a><span id="l37.21">         if (aAlarm.action != &quot;DISPLAY&quot;) {</span>
<a href="#l37.22"></a><span id="l37.22">             // This monitor only looks for DISPLAY alarms.</span>
<a href="#l37.23"></a><span id="l37.23">             return;</span>
<a href="#l37.24"></a><span id="l37.24">         }</span>
<a href="#l37.25"></a><span id="l37.25"> </span>
<a href="#l37.26"></a><span id="l37.26">         this.mAlarms.push([aItem, aAlarm]);</span>
<a href="#l37.27"></a><span id="l37.27"> </span>
<a href="#l37.28"></a><span id="l37.28" class="difflineminus">-        if (Preferences.get(&quot;calendar.alarms.playsound&quot;, true)) {</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineplus">+        if (Services.prefs.getBoolPref(&quot;calendar.alarms.playsound&quot;, true)) {</span>
<a href="#l37.30"></a><span id="l37.30">             // We want to make sure the user isn't flooded with alarms so we</span>
<a href="#l37.31"></a><span id="l37.31">             // limit this using a preference. For example, if the user has 20</span>
<a href="#l37.32"></a><span id="l37.32">             // events that fire an alarm in the same minute, then the alarm</span>
<a href="#l37.33"></a><span id="l37.33">             // sound will only play 5 times. All alarms will be shown in the</span>
<a href="#l37.34"></a><span id="l37.34">             // dialog nevertheless.</span>
<a href="#l37.35"></a><span id="l37.35" class="difflineminus">-            let maxAlarmSoundCount = Preferences.get(&quot;calendar.alarms.maxsoundsperminute&quot;, 5);</span>
<a href="#l37.36"></a><span id="l37.36" class="difflineplus">+            let maxAlarmSoundCount = Services.prefs.getIntPref(&quot;calendar.alarms.maxsoundsperminute&quot;, 5);</span>
<a href="#l37.37"></a><span id="l37.37">             let now = new Date();</span>
<a href="#l37.38"></a><span id="l37.38"> </span>
<a href="#l37.39"></a><span id="l37.39">             if (!this.mLastAlarmSoundDate ||</span>
<a href="#l37.40"></a><span id="l37.40">                 (now - this.mLastAlarmSoundDate &gt;= 60000)) {</span>
<a href="#l37.41"></a><span id="l37.41">                 // Last alarm was long enough ago, reset counters. Note</span>
<a href="#l37.42"></a><span id="l37.42">                 // subtracting JSDate results in microseconds.</span>
<a href="#l37.43"></a><span id="l37.43">                 this.mAlarmSoundCount = 0;</span>
<a href="#l37.44"></a><span id="l37.44">                 this.mLastAlarmSoundDate = now;</span>
<a href="#l37.45"></a><span id="l37.45">             } else {</span>
<a href="#l37.46"></a><span id="l37.46">                 // Otherwise increase the counter</span>
<a href="#l37.47"></a><span id="l37.47">                 this.mAlarmSoundCount++;</span>
<a href="#l37.48"></a><span id="l37.48">             }</span>
<a href="#l37.49"></a><span id="l37.49"> </span>
<a href="#l37.50"></a><span id="l37.50">             if (maxAlarmSoundCount &gt; this.mAlarmSoundCount) {</span>
<a href="#l37.51"></a><span id="l37.51">                 // Only ring the alarm sound if we haven't hit the max count.</span>
<a href="#l37.52"></a><span id="l37.52">                 try {</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineminus">-                    let soundURL = Preferences.get(&quot;calendar.alarms.soundURL&quot;, null);</span>
<a href="#l37.54"></a><span id="l37.54" class="difflineplus">+                    let soundURL = Services.prefs.getStringPref(&quot;calendar.alarms.soundURL&quot;, null);</span>
<a href="#l37.55"></a><span id="l37.55">                     if (soundURL &amp;&amp; soundURL.length &gt; 0) {</span>
<a href="#l37.56"></a><span id="l37.56">                         soundURL = Services.io.newURI(soundURL);</span>
<a href="#l37.57"></a><span id="l37.57">                         this.mSound.play(soundURL);</span>
<a href="#l37.58"></a><span id="l37.58">                     } else {</span>
<a href="#l37.59"></a><span id="l37.59">                         this.mSound.beep();</span>
<a href="#l37.60"></a><span id="l37.60">                     }</span>
<a href="#l37.61"></a><span id="l37.61">                 } catch (exc) {</span>
<a href="#l37.62"></a><span id="l37.62">                     cal.ERROR(&quot;Error playing alarm sound: &quot; + exc);</span>
<a href="#l37.63"></a><span id="l37.63">                 }</span>
<a href="#l37.64"></a><span id="l37.64">             }</span>
<a href="#l37.65"></a><span id="l37.65">         }</span>
<a href="#l37.66"></a><span id="l37.66"> </span>
<a href="#l37.67"></a><span id="l37.67" class="difflineminus">-        if (!Preferences.get(&quot;calendar.alarms.show&quot;, true)) {</span>
<a href="#l37.68"></a><span id="l37.68" class="difflineplus">+        if (!Services.prefs.getBoolPref(&quot;calendar.alarms.show&quot;, true)) {</span>
<a href="#l37.69"></a><span id="l37.69">             return;</span>
<a href="#l37.70"></a><span id="l37.70">         }</span>
<a href="#l37.71"></a><span id="l37.71"> </span>
<a href="#l37.72"></a><span id="l37.72">         let calAlarmWindow = peekAlarmWindow();</span>
<a href="#l37.73"></a><span id="l37.73">         if (!calAlarmWindow &amp;&amp; (!this.mWindowOpening ||</span>
<a href="#l37.74"></a><span id="l37.74">                                  this.mWindowOpening.closed)) {</span>
<a href="#l37.75"></a><span id="l37.75">             this.mWindowOpening = Services.ww.openWindow(</span>
<a href="#l37.76"></a><span id="l37.76">                 null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/base/src/calAlarmService.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/base/src/calAlarmService.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l38.4"></a><span id="l38.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l38.5"></a><span id="l38.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l38.6"></a><span id="l38.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l38.7"></a><span id="l38.7"> </span>
<a href="#l38.8"></a><span id="l38.8"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l38.9"></a><span id="l38.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l38.10"></a><span id="l38.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l38.11"></a><span id="l38.11"> var { PromiseUtils } = ChromeUtils.import(&quot;resource://gre/modules/PromiseUtils.jsm&quot;);</span>
<a href="#l38.12"></a><span id="l38.12"> </span>
<a href="#l38.13"></a><span id="l38.13"> var kHoursBetweenUpdates = 6;</span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15"> function nowUTC() {</span>
<a href="#l38.16"></a><span id="l38.16">     return cal.dtz.jsDateToDateTime(new Date()).getInTimezone(cal.dtz.UTC);</span>
<a href="#l38.17"></a><span id="l38.17"> }</span>
<a href="#l38.18"></a><span id="l38.18"> </span>
<a href="#l38.19"></a><span id="l38.19" class="difflineat">@@ -312,17 +311,17 @@ calAlarmService.prototype = {</span>
<a href="#l38.20"></a><span id="l38.20">     },</span>
<a href="#l38.21"></a><span id="l38.21"> </span>
<a href="#l38.22"></a><span id="l38.22">     addAlarmsForItem: function(aItem) {</span>
<a href="#l38.23"></a><span id="l38.23">         if (cal.item.isToDo(aItem) &amp;&amp; aItem.isCompleted) {</span>
<a href="#l38.24"></a><span id="l38.24">             // If this is a task and it is completed, don't add the alarm.</span>
<a href="#l38.25"></a><span id="l38.25">             return;</span>
<a href="#l38.26"></a><span id="l38.26">         }</span>
<a href="#l38.27"></a><span id="l38.27"> </span>
<a href="#l38.28"></a><span id="l38.28" class="difflineminus">-        let showMissed = Preferences.get(&quot;calendar.alarms.showmissed&quot;, true);</span>
<a href="#l38.29"></a><span id="l38.29" class="difflineplus">+        let showMissed = Services.prefs.getBoolPref(&quot;calendar.alarms.showmissed&quot;, true);</span>
<a href="#l38.30"></a><span id="l38.30"> </span>
<a href="#l38.31"></a><span id="l38.31">         let alarms = aItem.getAlarms({});</span>
<a href="#l38.32"></a><span id="l38.32">         for (let alarm of alarms) {</span>
<a href="#l38.33"></a><span id="l38.33">             let alarmDate = cal.alarms.calculateAlarmDate(aItem, alarm);</span>
<a href="#l38.34"></a><span id="l38.34"> </span>
<a href="#l38.35"></a><span id="l38.35">             if (!alarmDate || alarm.action != &quot;DISPLAY&quot;) {</span>
<a href="#l38.36"></a><span id="l38.36">                 // Only take care of DISPLAY alarms with an alarm date.</span>
<a href="#l38.37"></a><span id="l38.37">                 continue;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l39.4"></a><span id="l39.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l39.5"></a><span id="l39.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l39.6"></a><span id="l39.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l39.7"></a><span id="l39.7"> </span>
<a href="#l39.8"></a><span id="l39.8"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l39.9"></a><span id="l39.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l39.10"></a><span id="l39.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12"> var calICalendar = Ci.calICalendar;</span>
<a href="#l39.13"></a><span id="l39.13"> var cICL = Ci.calIChangeLog;</span>
<a href="#l39.14"></a><span id="l39.14"> var cIOL = Ci.calIOperationListener;</span>
<a href="#l39.15"></a><span id="l39.15"> </span>
<a href="#l39.16"></a><span id="l39.16"> var gNoOpListener = {</span>
<a href="#l39.17"></a><span id="l39.17">     QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l39.18"></a><span id="l39.18">     onGetResult: function(calendar, status, itemType, detail, count, items) {</span>
<a href="#l39.19"></a><span id="l39.19" class="difflineat">@@ -181,17 +180,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l39.20"></a><span id="l39.20">                 // afterwards.</span>
<a href="#l39.21"></a><span id="l39.21">                 this.mCachedCalendar.QueryInterface(Ci.calICalendarProvider)</span>
<a href="#l39.22"></a><span id="l39.22">                                     .deleteCalendar(this.mCachedCalendar, null);</span>
<a href="#l39.23"></a><span id="l39.23">                 if (this.supportsChangeLog) {</span>
<a href="#l39.24"></a><span id="l39.24">                     // start with full sync:</span>
<a href="#l39.25"></a><span id="l39.25">                     this.mUncachedCalendar.resetLog();</span>
<a href="#l39.26"></a><span id="l39.26">                 }</span>
<a href="#l39.27"></a><span id="l39.27">             } else {</span>
<a href="#l39.28"></a><span id="l39.28" class="difflineminus">-                let calType = Preferences.get(&quot;calendar.cache.type&quot;, &quot;storage&quot;);</span>
<a href="#l39.29"></a><span id="l39.29" class="difflineplus">+                let calType = Services.prefs.getStringPref(&quot;calendar.cache.type&quot;, &quot;storage&quot;);</span>
<a href="#l39.30"></a><span id="l39.30">                 // While technically, the above deleteCalendar should delete the</span>
<a href="#l39.31"></a><span id="l39.31">                 // whole calendar, this is nothing more than deleting all events</span>
<a href="#l39.32"></a><span id="l39.32">                 // todos and properties. Therefore the initialization can be</span>
<a href="#l39.33"></a><span id="l39.33">                 // skipped.</span>
<a href="#l39.34"></a><span id="l39.34">                 let cachedCalendar = Cc[&quot;@mozilla.org/calendar/calendar;1?type=&quot; + calType]</span>
<a href="#l39.35"></a><span id="l39.35">                                        .createInstance(Ci.calICalendar);</span>
<a href="#l39.36"></a><span id="l39.36">                 switch (calType) {</span>
<a href="#l39.37"></a><span id="l39.37">                     case &quot;memory&quot;: {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -46,17 +46,17 @@ calCalendarManager.prototype = {</span>
<a href="#l40.4"></a><span id="l40.4">         this.mNetworkCalendarCount = 0;</span>
<a href="#l40.5"></a><span id="l40.5">         this.mReadonlyCalendarCount = 0;</span>
<a href="#l40.6"></a><span id="l40.6">         this.mCalendarCount = 0;</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8">         Services.obs.addObserver(this, &quot;http-on-modify-request&quot;);</span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10">         // We only add the observer if the pref is set and only check for the</span>
<a href="#l40.11"></a><span id="l40.11">         // pref on startup to avoid checking for every http request</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-        if (Preferences.get(&quot;calendar.network.multirealm&quot;, false)) {</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+        if (Services.prefs.getBoolPref(&quot;calendar.network.multirealm&quot;, false)) {</span>
<a href="#l40.14"></a><span id="l40.14">             Services.obs.addObserver(this, &quot;http-on-examine-response&quot;);</span>
<a href="#l40.15"></a><span id="l40.15">         }</span>
<a href="#l40.16"></a><span id="l40.16"> </span>
<a href="#l40.17"></a><span id="l40.17">         aCompleteListener.onResult(null, Cr.NS_OK);</span>
<a href="#l40.18"></a><span id="l40.18">     },</span>
<a href="#l40.19"></a><span id="l40.19"> </span>
<a href="#l40.20"></a><span id="l40.20">     shutdown: function(aCompleteListener) {</span>
<a href="#l40.21"></a><span id="l40.21">         for (let id in this.mCache) {</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineat">@@ -68,17 +68,17 @@ calCalendarManager.prototype = {</span>
<a href="#l40.23"></a><span id="l40.23"> </span>
<a href="#l40.24"></a><span id="l40.24">         Services.obs.removeObserver(this, &quot;http-on-modify-request&quot;);</span>
<a href="#l40.25"></a><span id="l40.25"> </span>
<a href="#l40.26"></a><span id="l40.26">         AddonManager.removeAddonListener(gCalendarManagerAddonListener);</span>
<a href="#l40.27"></a><span id="l40.27"> </span>
<a href="#l40.28"></a><span id="l40.28">         // Remove the observer if the pref is set. This might fail when the</span>
<a href="#l40.29"></a><span id="l40.29">         // user flips the pref, but we assume he is going to restart anyway</span>
<a href="#l40.30"></a><span id="l40.30">         // afterwards.</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineminus">-        if (Preferences.get(&quot;calendar.network.multirealm&quot;, false)) {</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+        if (Services.prefs.getBoolPref(&quot;calendar.network.multirealm&quot;, false)) {</span>
<a href="#l40.33"></a><span id="l40.33">             Services.obs.removeObserver(this, &quot;http-on-examine-response&quot;);</span>
<a href="#l40.34"></a><span id="l40.34">         }</span>
<a href="#l40.35"></a><span id="l40.35"> </span>
<a href="#l40.36"></a><span id="l40.36">         aCompleteListener.onResult(null, Cr.NS_OK);</span>
<a href="#l40.37"></a><span id="l40.37">     },</span>
<a href="#l40.38"></a><span id="l40.38"> </span>
<a href="#l40.39"></a><span id="l40.39"> </span>
<a href="#l40.40"></a><span id="l40.40">     setupOfflineObservers: function() {</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineat">@@ -146,17 +146,17 @@ calCalendarManager.prototype = {</span>
<a href="#l40.42"></a><span id="l40.42">                 // been removed. Calendar servers might still want to know what</span>
<a href="#l40.43"></a><span id="l40.43">                 // client is used for access, so add our UA String to each</span>
<a href="#l40.44"></a><span id="l40.44">                 // request.</span>
<a href="#l40.45"></a><span id="l40.45">                 let httpChannel = aSubject.QueryInterface(Ci.nsIHttpChannel);</span>
<a href="#l40.46"></a><span id="l40.46">                 try {</span>
<a href="#l40.47"></a><span id="l40.47">                     // NOTE: For some reason, this observer call doesn't have</span>
<a href="#l40.48"></a><span id="l40.48">                     // the &quot;cal&quot; namespace defined</span>
<a href="#l40.49"></a><span id="l40.49">                     let userAgent = httpChannel.getRequestHeader(&quot;User-Agent&quot;);</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineminus">-                    let calUAString = Preferences.get(&quot;calendar.useragent.extra&quot;, &quot;&quot;).trim();</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineplus">+                    let calUAString = Services.prefs.getStringPref(&quot;calendar.useragent.extra&quot;, &quot;&quot;).trim();</span>
<a href="#l40.52"></a><span id="l40.52"> </span>
<a href="#l40.53"></a><span id="l40.53">                     // Don't add an empty string or an already included token.</span>
<a href="#l40.54"></a><span id="l40.54">                     if (calUAString &amp;&amp; !userAgent.includes(calUAString)) {</span>
<a href="#l40.55"></a><span id="l40.55">                         // User-Agent is not a mergeable header. We need to</span>
<a href="#l40.56"></a><span id="l40.56">                         // merge the user agent ourselves.</span>
<a href="#l40.57"></a><span id="l40.57">                         httpChannel.setRequestHeader(&quot;User-Agent&quot;,</span>
<a href="#l40.58"></a><span id="l40.58">                                                      userAgent + &quot; &quot; + calUAString,</span>
<a href="#l40.59"></a><span id="l40.59">                                                      false);</span>
<a href="#l40.60"></a><span id="l40.60" class="difflineat">@@ -254,61 +254,61 @@ calCalendarManager.prototype = {</span>
<a href="#l40.61"></a><span id="l40.61">     migrateDB: function(db) {</span>
<a href="#l40.62"></a><span id="l40.62">         let selectCalendars = db.createStatement(&quot;SELECT * FROM cal_calendars&quot;);</span>
<a href="#l40.63"></a><span id="l40.63">         let selectPrefs = db.createStatement(&quot;SELECT name, value FROM cal_calendars_prefs WHERE calendar = :calendar&quot;);</span>
<a href="#l40.64"></a><span id="l40.64">         try {</span>
<a href="#l40.65"></a><span id="l40.65">             let sortOrder = {};</span>
<a href="#l40.66"></a><span id="l40.66"> </span>
<a href="#l40.67"></a><span id="l40.67">             while (selectCalendars.executeStep()) {</span>
<a href="#l40.68"></a><span id="l40.68">                 let id = cal.getUUID(); // use fresh uuids</span>
<a href="#l40.69"></a><span id="l40.69" class="difflineminus">-                Preferences.set(getPrefBranchFor(id) + &quot;type&quot;, selectCalendars.row.type);</span>
<a href="#l40.70"></a><span id="l40.70" class="difflineminus">-                Preferences.set(getPrefBranchFor(id) + &quot;uri&quot;, selectCalendars.row.uri);</span>
<a href="#l40.71"></a><span id="l40.71" class="difflineplus">+                Services.prefs.setCharPref(getPrefBranchFor(id) + &quot;type&quot;, selectCalendars.row.type);</span>
<a href="#l40.72"></a><span id="l40.72" class="difflineplus">+                Services.prefs.setCharPref(getPrefBranchFor(id) + &quot;uri&quot;, selectCalendars.row.uri);</span>
<a href="#l40.73"></a><span id="l40.73">                 // the former id served as sort position:</span>
<a href="#l40.74"></a><span id="l40.74">                 sortOrder[selectCalendars.row.id] = id;</span>
<a href="#l40.75"></a><span id="l40.75">                 // move over prefs:</span>
<a href="#l40.76"></a><span id="l40.76">                 selectPrefs.params.calendar = selectCalendars.row.id;</span>
<a href="#l40.77"></a><span id="l40.77">                 while (selectPrefs.executeStep()) {</span>
<a href="#l40.78"></a><span id="l40.78">                     let name = selectPrefs.row.name.toLowerCase(); // may come lower case, so force it to be</span>
<a href="#l40.79"></a><span id="l40.79">                     let value = selectPrefs.row.value;</span>
<a href="#l40.80"></a><span id="l40.80">                     switch (name) {</span>
<a href="#l40.81"></a><span id="l40.81">                         case &quot;readonly&quot;:</span>
<a href="#l40.82"></a><span id="l40.82" class="difflineminus">-                            Preferences.set(getPrefBranchFor(id) + &quot;readOnly&quot;, value == &quot;true&quot;);</span>
<a href="#l40.83"></a><span id="l40.83" class="difflineplus">+                            Services.prefs.setBoolPref(getPrefBranchFor(id) + &quot;readOnly&quot;, value == &quot;true&quot;);</span>
<a href="#l40.84"></a><span id="l40.84">                             break;</span>
<a href="#l40.85"></a><span id="l40.85">                         case &quot;relaxedmode&quot;:</span>
<a href="#l40.86"></a><span id="l40.86" class="difflineminus">-                            Preferences.set(getPrefBranchFor(id) + &quot;relaxedMode&quot;, value == &quot;true&quot;);</span>
<a href="#l40.87"></a><span id="l40.87" class="difflineplus">+                            Services.prefs.setBoolPref(getPrefBranchFor(id) + &quot;relaxedMode&quot;, value == &quot;true&quot;);</span>
<a href="#l40.88"></a><span id="l40.88">                             break;</span>
<a href="#l40.89"></a><span id="l40.89">                         case &quot;suppressalarms&quot;:</span>
<a href="#l40.90"></a><span id="l40.90" class="difflineminus">-                            Preferences.set(getPrefBranchFor(id) + &quot;suppressAlarms&quot;, value == &quot;true&quot;);</span>
<a href="#l40.91"></a><span id="l40.91" class="difflineplus">+                            Services.prefs.setBoolPref(getPrefBranchFor(id) + &quot;suppressAlarms&quot;, value == &quot;true&quot;);</span>
<a href="#l40.92"></a><span id="l40.92">                             break;</span>
<a href="#l40.93"></a><span id="l40.93">                         case &quot;disabled&quot;:</span>
<a href="#l40.94"></a><span id="l40.94">                         case &quot;cache.supported&quot;:</span>
<a href="#l40.95"></a><span id="l40.95">                         case &quot;auto-enabled&quot;:</span>
<a href="#l40.96"></a><span id="l40.96">                         case &quot;cache.enabled&quot;:</span>
<a href="#l40.97"></a><span id="l40.97">                         case &quot;calendar-main-in-composite&quot;:</span>
<a href="#l40.98"></a><span id="l40.98">                         case &quot;calendar-main-default&quot;:</span>
<a href="#l40.99"></a><span id="l40.99" class="difflineminus">-                            Preferences.set(getPrefBranchFor(id) + name, value == &quot;true&quot;);</span>
<a href="#l40.100"></a><span id="l40.100" class="difflineplus">+                            Services.prefs.setBoolPref(getPrefBranchFor(id) + name, value == &quot;true&quot;);</span>
<a href="#l40.101"></a><span id="l40.101">                             break;</span>
<a href="#l40.102"></a><span id="l40.102">                         case &quot;backup-time&quot;:</span>
<a href="#l40.103"></a><span id="l40.103">                         case &quot;uniquenum&quot;:</span>
<a href="#l40.104"></a><span id="l40.104">                             // These preference names were migrated due to bug 979262.</span>
<a href="#l40.105"></a><span id="l40.105" class="difflineminus">-                            Preferences.set(getPrefBranchFor(id) + name + &quot;2&quot;, &quot;bignum:&quot; + value);</span>
<a href="#l40.106"></a><span id="l40.106" class="difflineplus">+                            Services.prefs.setStringPref(getPrefBranchFor(id) + name + &quot;2&quot;, &quot;bignum:&quot; + value);</span>
<a href="#l40.107"></a><span id="l40.107">                             break;</span>
<a href="#l40.108"></a><span id="l40.108">                         default: // keep as string</span>
<a href="#l40.109"></a><span id="l40.109" class="difflineminus">-                            Preferences.set(getPrefBranchFor(id) + name, value);</span>
<a href="#l40.110"></a><span id="l40.110" class="difflineplus">+                            Services.prefs.setStringPref(getPrefBranchFor(id) + name, value);</span>
<a href="#l40.111"></a><span id="l40.111">                             break;</span>
<a href="#l40.112"></a><span id="l40.112">                     }</span>
<a href="#l40.113"></a><span id="l40.113">                 }</span>
<a href="#l40.114"></a><span id="l40.114">                 selectPrefs.reset();</span>
<a href="#l40.115"></a><span id="l40.115">             }</span>
<a href="#l40.116"></a><span id="l40.116"> </span>
<a href="#l40.117"></a><span id="l40.117">             let sortOrderAr = [];</span>
<a href="#l40.118"></a><span id="l40.118">             for (let id in sortOrder) {</span>
<a href="#l40.119"></a><span id="l40.119">                 sortOrderAr.push(sortOrder[id]);</span>
<a href="#l40.120"></a><span id="l40.120">             }</span>
<a href="#l40.121"></a><span id="l40.121" class="difflineminus">-            Preferences.set(&quot;calendar.list.sortOrder&quot;, sortOrderAr.join(&quot; &quot;));</span>
<a href="#l40.122"></a><span id="l40.122" class="difflineplus">+            Services.prefs.setStringPref(&quot;calendar.list.sortOrder&quot;, sortOrderAr.join(&quot; &quot;));</span>
<a href="#l40.123"></a><span id="l40.123">             flushPrefs();</span>
<a href="#l40.124"></a><span id="l40.124">         } finally {</span>
<a href="#l40.125"></a><span id="l40.125">             selectPrefs.reset();</span>
<a href="#l40.126"></a><span id="l40.126">             selectCalendars.reset();</span>
<a href="#l40.127"></a><span id="l40.127">         }</span>
<a href="#l40.128"></a><span id="l40.128">     },</span>
<a href="#l40.129"></a><span id="l40.129"> </span>
<a href="#l40.130"></a><span id="l40.130">     checkAndMigrateDB: function() {</span>
<a href="#l40.131"></a><span id="l40.131" class="difflineat">@@ -485,18 +485,18 @@ calCalendarManager.prototype = {</span>
<a href="#l40.132"></a><span id="l40.132">         cal.ASSERT(!calendar.id || !(calendar.id in this.mCache),</span>
<a href="#l40.133"></a><span id="l40.133">                    &quot;[calCalendarManager::registerCalendar] calendar already registered!&quot;,</span>
<a href="#l40.134"></a><span id="l40.134">                    true);</span>
<a href="#l40.135"></a><span id="l40.135"> </span>
<a href="#l40.136"></a><span id="l40.136">         if (!calendar.id) {</span>
<a href="#l40.137"></a><span id="l40.137">             calendar.id = cal.getUUID();</span>
<a href="#l40.138"></a><span id="l40.138">         }</span>
<a href="#l40.139"></a><span id="l40.139"> </span>
<a href="#l40.140"></a><span id="l40.140" class="difflineminus">-        Preferences.set(getPrefBranchFor(calendar.id) + &quot;type&quot;, calendar.type);</span>
<a href="#l40.141"></a><span id="l40.141" class="difflineminus">-        Preferences.set(getPrefBranchFor(calendar.id) + &quot;uri&quot;, calendar.uri.spec);</span>
<a href="#l40.142"></a><span id="l40.142" class="difflineplus">+        Services.prefs.setStringPref(getPrefBranchFor(calendar.id) + &quot;type&quot;, calendar.type);</span>
<a href="#l40.143"></a><span id="l40.143" class="difflineplus">+        Services.prefs.setStringPref(getPrefBranchFor(calendar.id) + &quot;uri&quot;, calendar.uri.spec);</span>
<a href="#l40.144"></a><span id="l40.144"> </span>
<a href="#l40.145"></a><span id="l40.145">         if ((calendar.getProperty(&quot;cache.supported&quot;) !== false) &amp;&amp;</span>
<a href="#l40.146"></a><span id="l40.146">             (calendar.getProperty(&quot;cache.enabled&quot;) ||</span>
<a href="#l40.147"></a><span id="l40.147">              calendar.getProperty(&quot;cache.always&quot;))) {</span>
<a href="#l40.148"></a><span id="l40.148">             calendar = new calCachedCalendar(calendar);</span>
<a href="#l40.149"></a><span id="l40.149">         }</span>
<a href="#l40.150"></a><span id="l40.150"> </span>
<a href="#l40.151"></a><span id="l40.151">         this.setupCalendar(calendar);</span>
<a href="#l40.152"></a><span id="l40.152" class="difflineat">@@ -644,18 +644,18 @@ calCalendarManager.prototype = {</span>
<a href="#l40.153"></a><span id="l40.153"> </span>
<a href="#l40.154"></a><span id="l40.154">             let allCals = {};</span>
<a href="#l40.155"></a><span id="l40.155">             for (let key of Services.prefs.getChildList(REGISTRY_BRANCH)) { // merge down all keys</span>
<a href="#l40.156"></a><span id="l40.156">                 allCals[key.substring(0, key.indexOf(&quot;.&quot;, REGISTRY_BRANCH.length))] = true;</span>
<a href="#l40.157"></a><span id="l40.157">             }</span>
<a href="#l40.158"></a><span id="l40.158"> </span>
<a href="#l40.159"></a><span id="l40.159">             for (let calBranch in allCals) {</span>
<a href="#l40.160"></a><span id="l40.160">                 let id = calBranch.substring(REGISTRY_BRANCH.length);</span>
<a href="#l40.161"></a><span id="l40.161" class="difflineminus">-                let ctype = Preferences.get(calBranch + &quot;.type&quot;, null);</span>
<a href="#l40.162"></a><span id="l40.162" class="difflineminus">-                let curi = Preferences.get(calBranch + &quot;.uri&quot;, null);</span>
<a href="#l40.163"></a><span id="l40.163" class="difflineplus">+                let ctype = Services.prefs.getStringPref(calBranch + &quot;.type&quot;, null);</span>
<a href="#l40.164"></a><span id="l40.164" class="difflineplus">+                let curi = Services.prefs.getStringPref(calBranch + &quot;.uri&quot;, null);</span>
<a href="#l40.165"></a><span id="l40.165"> </span>
<a href="#l40.166"></a><span id="l40.166">                 try {</span>
<a href="#l40.167"></a><span id="l40.167">                     if (!ctype || !curi) { // sanity check</span>
<a href="#l40.168"></a><span id="l40.168">                         Services.prefs.deleteBranch(calBranch + &quot;.&quot;);</span>
<a href="#l40.169"></a><span id="l40.169">                         continue;</span>
<a href="#l40.170"></a><span id="l40.170">                     }</span>
<a href="#l40.171"></a><span id="l40.171"> </span>
<a href="#l40.172"></a><span id="l40.172">                     let uri = Services.io.newURI(curi);</span>
<a href="#l40.173"></a><span id="l40.173" class="difflineat">@@ -840,17 +840,17 @@ calMgrCalendarObserver.prototype = {</span>
<a href="#l40.174"></a><span id="l40.174">             if (aCalendar.getProperty(&quot;cache.enabled&quot;) === true) {</span>
<a href="#l40.175"></a><span id="l40.175">                 aCalendar.deleteProperty(&quot;cache.enabled&quot;);</span>
<a href="#l40.176"></a><span id="l40.176">             }</span>
<a href="#l40.177"></a><span id="l40.177">             return;</span>
<a href="#l40.178"></a><span id="l40.178">         }</span>
<a href="#l40.179"></a><span id="l40.179"> </span>
<a href="#l40.180"></a><span id="l40.180">         if (aOldValue != aValue) {</span>
<a href="#l40.181"></a><span id="l40.181">             // Try to find the current sort order</span>
<a href="#l40.182"></a><span id="l40.182" class="difflineminus">-            let sortOrderPref = Preferences.get(&quot;calendar.list.sortOrder&quot;, &quot;&quot;).split(&quot; &quot;);</span>
<a href="#l40.183"></a><span id="l40.183" class="difflineplus">+            let sortOrderPref = Services.prefs.getStringPref(&quot;calendar.list.sortOrder&quot;, &quot;&quot;).split(&quot; &quot;);</span>
<a href="#l40.184"></a><span id="l40.184">             let initialSortOrderPos = null;</span>
<a href="#l40.185"></a><span id="l40.185">             for (let i = 0; i &lt; sortOrderPref.length; ++i) {</span>
<a href="#l40.186"></a><span id="l40.186">                 if (sortOrderPref[i] == aCalendar.id) {</span>
<a href="#l40.187"></a><span id="l40.187">                     initialSortOrderPos = i;</span>
<a href="#l40.188"></a><span id="l40.188">                 }</span>
<a href="#l40.189"></a><span id="l40.189">             }</span>
<a href="#l40.190"></a><span id="l40.190">             // Enabling or disabling cache on a calendar re-creates</span>
<a href="#l40.191"></a><span id="l40.191">             // it so the registerCalendar call can wrap/unwrap the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -1,27 +1,26 @@</span>
<a href="#l41.4"></a><span id="l41.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l41.5"></a><span id="l41.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l41.6"></a><span id="l41.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l41.7"></a><span id="l41.7"> </span>
<a href="#l41.8"></a><span id="l41.8"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l41.9"></a><span id="l41.9" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l41.10"></a><span id="l41.10"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l41.11"></a><span id="l41.11"> </span>
<a href="#l41.12"></a><span id="l41.12"> function calDateTimeFormatter() {</span>
<a href="#l41.13"></a><span id="l41.13">     this.wrappedJSObject = this;</span>
<a href="#l41.14"></a><span id="l41.14">     this.mDateStringBundle = Services.strings.createBundle(&quot;chrome://calendar/locale/dateFormat.properties&quot;);</span>
<a href="#l41.15"></a><span id="l41.15"> }</span>
<a href="#l41.16"></a><span id="l41.16"> calDateTimeFormatter.prototype = {</span>
<a href="#l41.17"></a><span id="l41.17">     QueryInterface: ChromeUtils.generateQI([Ci.calIDateTimeFormatter]),</span>
<a href="#l41.18"></a><span id="l41.18">     classID: Components.ID(&quot;{4123da9a-f047-42da-a7d0-cc4175b9f36a}&quot;),</span>
<a href="#l41.19"></a><span id="l41.19"> </span>
<a href="#l41.20"></a><span id="l41.20">     formatDate: function(aDate) {</span>
<a href="#l41.21"></a><span id="l41.21">         // Format the date using user's format preference (long or short)</span>
<a href="#l41.22"></a><span id="l41.22" class="difflineminus">-        let format = Preferences.get(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l41.23"></a><span id="l41.23" class="difflineplus">+        let format = Services.prefs.getIntPref(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l41.24"></a><span id="l41.24">         return (format == 0 ? this.formatDateLong(aDate) : this.formatDateShort(aDate));</span>
<a href="#l41.25"></a><span id="l41.25">     },</span>
<a href="#l41.26"></a><span id="l41.26"> </span>
<a href="#l41.27"></a><span id="l41.27">     formatDateShort: function(aDate) {</span>
<a href="#l41.28"></a><span id="l41.28">         return this._inTimezone(aDate, { dateStyle: &quot;short&quot; });</span>
<a href="#l41.29"></a><span id="l41.29">     },</span>
<a href="#l41.30"></a><span id="l41.30"> </span>
<a href="#l41.31"></a><span id="l41.31">     formatDateLong: function(aDate) {</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineat">@@ -40,17 +39,17 @@ calDateTimeFormatter.prototype = {</span>
<a href="#l41.33"></a><span id="l41.33"> </span>
<a href="#l41.34"></a><span id="l41.34">         return this._inTimezone(aDate, { timeStyle: &quot;short&quot; });</span>
<a href="#l41.35"></a><span id="l41.35">     },</span>
<a href="#l41.36"></a><span id="l41.36"> </span>
<a href="#l41.37"></a><span id="l41.37">     formatDateTime: function(aDate) {</span>
<a href="#l41.38"></a><span id="l41.38">         let formattedDate = this.formatDate(aDate);</span>
<a href="#l41.39"></a><span id="l41.39">         let formattedTime = this.formatTime(aDate);</span>
<a href="#l41.40"></a><span id="l41.40"> </span>
<a href="#l41.41"></a><span id="l41.41" class="difflineminus">-        let timeBeforeDate = Preferences.get(&quot;calendar.date.formatTimeBeforeDate&quot;, false);</span>
<a href="#l41.42"></a><span id="l41.42" class="difflineplus">+        let timeBeforeDate = Services.prefs.getBoolPref(&quot;calendar.date.formatTimeBeforeDate&quot;, false);</span>
<a href="#l41.43"></a><span id="l41.43">         if (timeBeforeDate) {</span>
<a href="#l41.44"></a><span id="l41.44">             return formattedTime + &quot; &quot; + formattedDate;</span>
<a href="#l41.45"></a><span id="l41.45">         } else {</span>
<a href="#l41.46"></a><span id="l41.46">             return formattedDate + &quot; &quot; + formattedTime;</span>
<a href="#l41.47"></a><span id="l41.47">         }</span>
<a href="#l41.48"></a><span id="l41.48">     },</span>
<a href="#l41.49"></a><span id="l41.49"> </span>
<a href="#l41.50"></a><span id="l41.50">     /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l42.4"></a><span id="l42.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l42.5"></a><span id="l42.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l42.6"></a><span id="l42.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l42.7"></a><span id="l42.7"> </span>
<a href="#l42.8"></a><span id="l42.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l42.9"></a><span id="l42.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l42.10"></a><span id="l42.10"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l42.11"></a><span id="l42.11"> </span>
<a href="#l42.12"></a><span id="l42.12"> /**</span>
<a href="#l42.13"></a><span id="l42.13">  * Object that contains a set of filter properties that may be used by a calFilter object</span>
<a href="#l42.14"></a><span id="l42.14">  * to filter a set of items.</span>
<a href="#l42.15"></a><span id="l42.15">  * Supported filter properties:</span>
<a href="#l42.16"></a><span id="l42.16">  *   start, end:   Specifies the relative date range to use when calculating the filter date</span>
<a href="#l42.17"></a><span id="l42.17">  *               range. The relative date range may relative to the current date and time, the</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineat">@@ -157,17 +157,17 @@ calFilterProperties.prototype = {</span>
<a href="#l42.19"></a><span id="l42.19">  * Object that allows filtering of a set of items using a set of filter properties. A set</span>
<a href="#l42.20"></a><span id="l42.20">  * of property filters may be defined by a filter name, which may then be used to apply</span>
<a href="#l42.21"></a><span id="l42.21">  * the defined filter properties. A set of commonly used property filters are predefined.</span>
<a href="#l42.22"></a><span id="l42.22">  */</span>
<a href="#l42.23"></a><span id="l42.23"> function calFilter() {</span>
<a href="#l42.24"></a><span id="l42.24">     this.wrappedJSObject = this;</span>
<a href="#l42.25"></a><span id="l42.25">     this.mFilterProperties = new calFilterProperties();</span>
<a href="#l42.26"></a><span id="l42.26">     this.initDefinedFilters();</span>
<a href="#l42.27"></a><span id="l42.27" class="difflineminus">-    this.mMaxIterations = Preferences.get(&quot;calendar.filter.maxiterations&quot;, 50);</span>
<a href="#l42.28"></a><span id="l42.28" class="difflineplus">+    this.mMaxIterations = Services.prefs.getIntPref(&quot;calendar.filter.maxiterations&quot;, 50);</span>
<a href="#l42.29"></a><span id="l42.29"> }</span>
<a href="#l42.30"></a><span id="l42.30"> </span>
<a href="#l42.31"></a><span id="l42.31"> calFilter.prototype = {</span>
<a href="#l42.32"></a><span id="l42.32">     mStartDate: null,</span>
<a href="#l42.33"></a><span id="l42.33">     mEndDate: null,</span>
<a href="#l42.34"></a><span id="l42.34">     mSelectedDate: null,</span>
<a href="#l42.35"></a><span id="l42.35">     mFilterText: &quot;&quot;,</span>
<a href="#l42.36"></a><span id="l42.36">     mDefinedFilters: {},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -1,14 +1,13 @@</span>
<a href="#l43.4"></a><span id="l43.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l43.5"></a><span id="l43.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l43.6"></a><span id="l43.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l43.7"></a><span id="l43.7"> </span>
<a href="#l43.8"></a><span id="l43.8"> var { NetUtil } = ChromeUtils.import(&quot;resource://gre/modules/NetUtil.jsm&quot;);</span>
<a href="#l43.9"></a><span id="l43.9" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l43.10"></a><span id="l43.10"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l43.11"></a><span id="l43.11"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l43.12"></a><span id="l43.12"> </span>
<a href="#l43.13"></a><span id="l43.13"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l43.14"></a><span id="l43.14"> var { ICAL, unwrapSingle } = ChromeUtils.import(&quot;resource://calendar/modules/ical.js&quot;);</span>
<a href="#l43.15"></a><span id="l43.15"> </span>
<a href="#l43.16"></a><span id="l43.16"> function calStringEnumerator(stringArray) {</span>
<a href="#l43.17"></a><span id="l43.17">     this.mIndex = 0;</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineat">@@ -144,33 +143,33 @@ calTimezoneService.prototype = {</span>
<a href="#l43.19"></a><span id="l43.19">     shutdown: function(aCompleteListener) {</span>
<a href="#l43.20"></a><span id="l43.20">         Services.prefs.removeObserver(&quot;calendar.timezone.local&quot;, this);</span>
<a href="#l43.21"></a><span id="l43.21">         aCompleteListener.onResult(null, Cr.NS_OK);</span>
<a href="#l43.22"></a><span id="l43.22">     },</span>
<a href="#l43.23"></a><span id="l43.23"> </span>
<a href="#l43.24"></a><span id="l43.24">     get UTC() {</span>
<a href="#l43.25"></a><span id="l43.25">         if (!this.mZones.has(&quot;UTC&quot;)) {</span>
<a href="#l43.26"></a><span id="l43.26">             let utc;</span>
<a href="#l43.27"></a><span id="l43.27" class="difflineminus">-            if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l43.28"></a><span id="l43.28" class="difflineplus">+            if (Services.prefs.getBoolPref(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l43.29"></a><span id="l43.29">                 utc = new calICALJSTimezone(ICAL.Timezone.utcTimezone);</span>
<a href="#l43.30"></a><span id="l43.30">             } else {</span>
<a href="#l43.31"></a><span id="l43.31">                 utc = new calLibicalTimezone(&quot;UTC&quot;, null, &quot;&quot;, &quot;&quot;);</span>
<a href="#l43.32"></a><span id="l43.32">                 utc.mUTC = true;</span>
<a href="#l43.33"></a><span id="l43.33">             }</span>
<a href="#l43.34"></a><span id="l43.34"> </span>
<a href="#l43.35"></a><span id="l43.35">             this.mZones.set(&quot;UTC&quot;, { zone: utc });</span>
<a href="#l43.36"></a><span id="l43.36">         }</span>
<a href="#l43.37"></a><span id="l43.37"> </span>
<a href="#l43.38"></a><span id="l43.38">         return this.mZones.get(&quot;UTC&quot;).zone;</span>
<a href="#l43.39"></a><span id="l43.39">     },</span>
<a href="#l43.40"></a><span id="l43.40"> </span>
<a href="#l43.41"></a><span id="l43.41">     get floating() {</span>
<a href="#l43.42"></a><span id="l43.42">         if (!this.mZones.has(&quot;floating&quot;)) {</span>
<a href="#l43.43"></a><span id="l43.43">             let floating;</span>
<a href="#l43.44"></a><span id="l43.44" class="difflineminus">-            if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l43.45"></a><span id="l43.45" class="difflineplus">+            if (Services.prefs.getBoolPref(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l43.46"></a><span id="l43.46">                 floating = new calICALJSTimezone(ICAL.Timezone.localTimezone);</span>
<a href="#l43.47"></a><span id="l43.47">             } else {</span>
<a href="#l43.48"></a><span id="l43.48">                 floating = new calLibicalTimezone(&quot;floating&quot;, null, &quot;&quot;, &quot;&quot;);</span>
<a href="#l43.49"></a><span id="l43.49">                 floating.isFloating = true;</span>
<a href="#l43.50"></a><span id="l43.50">             }</span>
<a href="#l43.51"></a><span id="l43.51">             this.mZones.set(&quot;floating&quot;, { zone: floating });</span>
<a href="#l43.52"></a><span id="l43.52">         }</span>
<a href="#l43.53"></a><span id="l43.53"> </span>
<a href="#l43.54"></a><span id="l43.54" class="difflineat">@@ -195,17 +194,17 @@ calTimezoneService.prototype = {</span>
<a href="#l43.55"></a><span id="l43.55">         if (!timezone) {</span>
<a href="#l43.56"></a><span id="l43.56">             cal.ERROR(&quot;Couldn't find &quot; + tzid);</span>
<a href="#l43.57"></a><span id="l43.57">             return null;</span>
<a href="#l43.58"></a><span id="l43.58">         }</span>
<a href="#l43.59"></a><span id="l43.59">         if (!timezone.zone) {</span>
<a href="#l43.60"></a><span id="l43.60">             if (timezone.aliasTo) {</span>
<a href="#l43.61"></a><span id="l43.61">                 // This zone is an alias.</span>
<a href="#l43.62"></a><span id="l43.62">                 timezone.zone = this.getTimezone(timezone.aliasTo);</span>
<a href="#l43.63"></a><span id="l43.63" class="difflineminus">-            } else if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l43.64"></a><span id="l43.64" class="difflineplus">+            } else if (Services.prefs.getBoolPref(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l43.65"></a><span id="l43.65">                 let parsedComp = ICAL.parse(&quot;BEGIN:VCALENDAR\r\n&quot; + timezone.ics + &quot;\r\nEND:VCALENDAR&quot;);</span>
<a href="#l43.66"></a><span id="l43.66">                 let icalComp = new ICAL.Component(parsedComp);</span>
<a href="#l43.67"></a><span id="l43.67">                 let tzComp = icalComp.getFirstSubcomponent(&quot;vtimezone&quot;);</span>
<a href="#l43.68"></a><span id="l43.68">                 timezone.zone = new calICALJSTimezone(ICAL.Timezone.fromData({</span>
<a href="#l43.69"></a><span id="l43.69">                     tzid: tzid,</span>
<a href="#l43.70"></a><span id="l43.70">                     component: tzComp,</span>
<a href="#l43.71"></a><span id="l43.71">                     latitude: timezone.latitude,</span>
<a href="#l43.72"></a><span id="l43.72">                     longitude: timezone.longitude</span>
<a href="#l43.73"></a><span id="l43.73" class="difflineat">@@ -238,31 +237,31 @@ calTimezoneService.prototype = {</span>
<a href="#l43.74"></a><span id="l43.74">     },</span>
<a href="#l43.75"></a><span id="l43.75"> </span>
<a href="#l43.76"></a><span id="l43.76">     get version() {</span>
<a href="#l43.77"></a><span id="l43.77">         return this.mVersion;</span>
<a href="#l43.78"></a><span id="l43.78">     },</span>
<a href="#l43.79"></a><span id="l43.79"> </span>
<a href="#l43.80"></a><span id="l43.80">     get defaultTimezone() {</span>
<a href="#l43.81"></a><span id="l43.81">         if (!this.mDefaultTimezone) {</span>
<a href="#l43.82"></a><span id="l43.82" class="difflineminus">-            let prefTzid = Preferences.get(&quot;calendar.timezone.local&quot;, null);</span>
<a href="#l43.83"></a><span id="l43.83" class="difflineplus">+            let prefTzid = Services.prefs.getStringPref(&quot;calendar.timezone.local&quot;, null);</span>
<a href="#l43.84"></a><span id="l43.84">             let tzid = prefTzid;</span>
<a href="#l43.85"></a><span id="l43.85">             if (!tzid) {</span>
<a href="#l43.86"></a><span id="l43.86">                 try {</span>
<a href="#l43.87"></a><span id="l43.87">                     tzid = guessSystemTimezone();</span>
<a href="#l43.88"></a><span id="l43.88">                 } catch (e) {</span>
<a href="#l43.89"></a><span id="l43.89">                     cal.WARN(&quot;An exception occurred guessing the system timezone, trying UTC. Exception: &quot; + e);</span>
<a href="#l43.90"></a><span id="l43.90">                     tzid = &quot;UTC&quot;;</span>
<a href="#l43.91"></a><span id="l43.91">                 }</span>
<a href="#l43.92"></a><span id="l43.92">             }</span>
<a href="#l43.93"></a><span id="l43.93">             this.mDefaultTimezone = this.getTimezone(tzid);</span>
<a href="#l43.94"></a><span id="l43.94">             cal.ASSERT(this.mDefaultTimezone, &quot;Timezone not found: &quot; + tzid);</span>
<a href="#l43.95"></a><span id="l43.95">             // Update prefs if necessary:</span>
<a href="#l43.96"></a><span id="l43.96">             if (this.mDefaultTimezone &amp;&amp; this.mDefaultTimezone.tzid != prefTzid) {</span>
<a href="#l43.97"></a><span id="l43.97" class="difflineminus">-                Preferences.set(&quot;calendar.timezone.local&quot;, this.mDefaultTimezone.tzid);</span>
<a href="#l43.98"></a><span id="l43.98" class="difflineplus">+                Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, this.mDefaultTimezone.tzid);</span>
<a href="#l43.99"></a><span id="l43.99">             }</span>
<a href="#l43.100"></a><span id="l43.100"> </span>
<a href="#l43.101"></a><span id="l43.101">             // We need to observe the timezone preference to update the default</span>
<a href="#l43.102"></a><span id="l43.102">             // timezone if needed.</span>
<a href="#l43.103"></a><span id="l43.103">             this.setupObservers();</span>
<a href="#l43.104"></a><span id="l43.104">         }</span>
<a href="#l43.105"></a><span id="l43.105">         return this.mDefaultTimezone;</span>
<a href="#l43.106"></a><span id="l43.106">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/base/src/calWeekInfoService.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/base/src/calWeekInfoService.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l44.4"></a><span id="l44.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l44.5"></a><span id="l44.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l44.6"></a><span id="l44.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l44.7"></a><span id="l44.7"> </span>
<a href="#l44.8"></a><span id="l44.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l44.9"></a><span id="l44.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l44.10"></a><span id="l44.10"> </span>
<a href="#l44.11"></a><span id="l44.11"> function calWeekInfoService() {</span>
<a href="#l44.12"></a><span id="l44.12">     this.wrappedJSObject = this;</span>
<a href="#l44.13"></a><span id="l44.13"> }</span>
<a href="#l44.14"></a><span id="l44.14"> calWeekInfoService.prototype = {</span>
<a href="#l44.15"></a><span id="l44.15">     QueryInterface: ChromeUtils.generateQI([Ci.calIWeekInfoService]),</span>
<a href="#l44.16"></a><span id="l44.16">     classID: Components.ID(&quot;{6877bbdd-f336-46f5-98ce-fe86d0285cc1}&quot;),</span>
<a href="#l44.17"></a><span id="l44.17"> </span>
<a href="#l44.18"></a><span id="l44.18" class="difflineat">@@ -40,17 +40,17 @@ calWeekInfoService.prototype = {</span>
<a href="#l44.19"></a><span id="l44.19">         // which may be part of first/last week in the other year.)</span>
<a href="#l44.20"></a><span id="l44.20">         // The Thursday of a week is the Thursday that follows the first day</span>
<a href="#l44.21"></a><span id="l44.21">         // of the week.</span>
<a href="#l44.22"></a><span id="l44.22">         // The week number of a day is the same as the week number of the first</span>
<a href="#l44.23"></a><span id="l44.23">         // day of the week. (This takes care of days near the start of the year,</span>
<a href="#l44.24"></a><span id="l44.24">         // which may be part of the week counted in the previous year.) So we</span>
<a href="#l44.25"></a><span id="l44.25">         // need the startWeekday.</span>
<a href="#l44.26"></a><span id="l44.26">         const SUNDAY = 0;</span>
<a href="#l44.27"></a><span id="l44.27" class="difflineminus">-        let startWeekday = Preferences.get(&quot;calendar.week.start&quot;, SUNDAY); // default to monday per ISO8601 standard.</span>
<a href="#l44.28"></a><span id="l44.28" class="difflineplus">+        let startWeekday = Services.prefs.getIntPref(&quot;calendar.week.start&quot;, SUNDAY); // default to monday per ISO8601 standard.</span>
<a href="#l44.29"></a><span id="l44.29"> </span>
<a href="#l44.30"></a><span id="l44.30">         // The number of days since the start of the week.</span>
<a href="#l44.31"></a><span id="l44.31">         // Notice that the result of the substraction might be negative.</span>
<a href="#l44.32"></a><span id="l44.32">         // We correct for that by adding 7, and then using the remainder operator.</span>
<a href="#l44.33"></a><span id="l44.33">         let sinceStartOfWeek = (aDateTime.weekday - startWeekday + 7) % 7;</span>
<a href="#l44.34"></a><span id="l44.34"> </span>
<a href="#l44.35"></a><span id="l44.35">         // The number of days to Thursday is the difference between Thursday</span>
<a href="#l44.36"></a><span id="l44.36">         // and the start-day of the week (again corrected for negative values).</span>
<a href="#l44.37"></a><span id="l44.37" class="difflineat">@@ -79,17 +79,17 @@ calWeekInfoService.prototype = {</span>
<a href="#l44.38"></a><span id="l44.38">      * of the preference setting &quot;calendar.week.start&quot;</span>
<a href="#l44.39"></a><span id="l44.39">      *</span>
<a href="#l44.40"></a><span id="l44.40">      * @param aDate     a date time object</span>
<a href="#l44.41"></a><span id="l44.41">      * @return          a dateTime-object denoting the first day of the week</span>
<a href="#l44.42"></a><span id="l44.42">      */</span>
<a href="#l44.43"></a><span id="l44.43">     getStartOfWeek: function(aDate) {</span>
<a href="#l44.44"></a><span id="l44.44">         let date = aDate.clone();</span>
<a href="#l44.45"></a><span id="l44.45">         date.isDate = true;</span>
<a href="#l44.46"></a><span id="l44.46" class="difflineminus">-        let offset = Preferences.get(&quot;calendar.week.start&quot;, 0) - aDate.weekday;</span>
<a href="#l44.47"></a><span id="l44.47" class="difflineplus">+        let offset = Services.prefs.getIntPref(&quot;calendar.week.start&quot;, 0) - aDate.weekday;</span>
<a href="#l44.48"></a><span id="l44.48">         date.day += offset;</span>
<a href="#l44.49"></a><span id="l44.49">         if (offset &gt; 0) {</span>
<a href="#l44.50"></a><span id="l44.50">             date.day -= 7;</span>
<a href="#l44.51"></a><span id="l44.51">         }</span>
<a href="#l44.52"></a><span id="l44.52">         return date;</span>
<a href="#l44.53"></a><span id="l44.53">     },</span>
<a href="#l44.54"></a><span id="l44.54"> </span>
<a href="#l44.55"></a><span id="l44.55">     /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l45.4"></a><span id="l45.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l45.5"></a><span id="l45.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l45.6"></a><span id="l45.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l45.7"></a><span id="l45.7"> </span>
<a href="#l45.8"></a><span id="l45.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l45.9"></a><span id="l45.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l45.10"></a><span id="l45.10"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l45.11"></a><span id="l45.11"> </span>
<a href="#l45.12"></a><span id="l45.12"> /**</span>
<a href="#l45.13"></a><span id="l45.13">  * Prints a rough month-grid of events/tasks</span>
<a href="#l45.14"></a><span id="l45.14">  */</span>
<a href="#l45.15"></a><span id="l45.15"> function calMonthPrinter() {</span>
<a href="#l45.16"></a><span id="l45.16">     this.wrappedJSObject = this;</span>
<a href="#l45.17"></a><span id="l45.17"> }</span>
<a href="#l45.18"></a><span id="l45.18" class="difflineat">@@ -141,17 +141,17 @@ calMonthPrinter.prototype = {</span>
<a href="#l45.19"></a><span id="l45.19">         currentMonth.item = startOfMonth.clone();</span>
<a href="#l45.20"></a><span id="l45.20"> </span>
<a href="#l45.21"></a><span id="l45.21">         // Set up the month title</span>
<a href="#l45.22"></a><span id="l45.22">         let monthName = cal.l10n.formatMonth(startOfMonth.month + 1, &quot;calendar&quot;, &quot;monthInYear&quot;);</span>
<a href="#l45.23"></a><span id="l45.23">         let monthTitle = cal.l10n.getCalString(&quot;monthInYear&quot;, [monthName, startOfMonth.year]);</span>
<a href="#l45.24"></a><span id="l45.24">         currentMonth.querySelector(&quot;.month-name&quot;).textContent = monthTitle;</span>
<a href="#l45.25"></a><span id="l45.25"> </span>
<a href="#l45.26"></a><span id="l45.26">         // Set up the weekday titles</span>
<a href="#l45.27"></a><span id="l45.27" class="difflineminus">-        let wkst = Preferences.get(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l45.28"></a><span id="l45.28" class="difflineplus">+        let wkst = Services.prefs.getIntPref(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l45.29"></a><span id="l45.29">         for (let i = 1; i &lt;= 7; i++) {</span>
<a href="#l45.30"></a><span id="l45.30">             let dayNumber = ((i + wkst - 1) % 7) + 1;</span>
<a href="#l45.31"></a><span id="l45.31">             let dayTitle = currentMonth.querySelector(`.day${i}-title`);</span>
<a href="#l45.32"></a><span id="l45.32">             dayTitle.textContent = cal.l10n.getDateFmtString(`day.${dayNumber}.Mmm`);</span>
<a href="#l45.33"></a><span id="l45.33">         }</span>
<a href="#l45.34"></a><span id="l45.34"> </span>
<a href="#l45.35"></a><span id="l45.35">         // Set up each week</span>
<a href="#l45.36"></a><span id="l45.36">         let weekInfoService = cal.getWeekInfoService();</span>
<a href="#l45.37"></a><span id="l45.37" class="difflineat">@@ -198,17 +198,17 @@ calMonthPrinter.prototype = {</span>
<a href="#l45.38"></a><span id="l45.38">                     dayTable[dateKey] = [dayTable[dateKey], dayContainer];</span>
<a href="#l45.39"></a><span id="l45.39">                 }</span>
<a href="#l45.40"></a><span id="l45.40">             } else {</span>
<a href="#l45.41"></a><span id="l45.41">                 dayTable[dateKey] = dayContainer;</span>
<a href="#l45.42"></a><span id="l45.42">             }</span>
<a href="#l45.43"></a><span id="l45.43"> </span>
<a href="#l45.44"></a><span id="l45.44">             let weekDay = currentDate.weekday;</span>
<a href="#l45.45"></a><span id="l45.45">             let dayOffPrefName = &quot;calendar.week.d&quot; + weekDay + weekdayMap[weekDay] + &quot;soff&quot;;</span>
<a href="#l45.46"></a><span id="l45.46" class="difflineminus">-            if (Preferences.get(dayOffPrefName, false)) {</span>
<a href="#l45.47"></a><span id="l45.47" class="difflineplus">+            if (Services.prefs.getBoolPref(dayOffPrefName, false)) {</span>
<a href="#l45.48"></a><span id="l45.48">                 dayBox.className += &quot; day-off&quot;;</span>
<a href="#l45.49"></a><span id="l45.49">             }</span>
<a href="#l45.50"></a><span id="l45.50"> </span>
<a href="#l45.51"></a><span id="l45.51">             if (currentDate.month != mainMonth) {</span>
<a href="#l45.52"></a><span id="l45.52">                 dayBox.className += &quot; out-of-month&quot;;</span>
<a href="#l45.53"></a><span id="l45.53">             }</span>
<a href="#l45.54"></a><span id="l45.54">             currentDate.day++;</span>
<a href="#l45.55"></a><span id="l45.55">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l46.4"></a><span id="l46.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l46.5"></a><span id="l46.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l46.6"></a><span id="l46.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l46.7"></a><span id="l46.7"> </span>
<a href="#l46.8"></a><span id="l46.8"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l46.9"></a><span id="l46.9" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l46.10"></a><span id="l46.10" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l46.11"></a><span id="l46.11"> </span>
<a href="#l46.12"></a><span id="l46.12"> var localeEn = {</span>
<a href="#l46.13"></a><span id="l46.13">     headTitle:       &quot;Subject&quot;,</span>
<a href="#l46.14"></a><span id="l46.14">     headStartDate:   &quot;Start Date&quot;,</span>
<a href="#l46.15"></a><span id="l46.15">     headStartTime:   &quot;Start Time&quot;,</span>
<a href="#l46.16"></a><span id="l46.16">     headEndDate:     &quot;End Date&quot;,</span>
<a href="#l46.17"></a><span id="l46.17">     headEndTime:     &quot;End Time&quot;,</span>
<a href="#l46.18"></a><span id="l46.18">     headAllDayEvent: &quot;All day event&quot;,</span>
<a href="#l46.19"></a><span id="l46.19" class="difflineat">@@ -260,17 +260,17 @@ calOutlookCSVImporter.prototype = {</span>
<a href="#l46.20"></a><span id="l46.20">                 if (!eDate) {</span>
<a href="#l46.21"></a><span id="l46.21">                     // No endDate was found. All day events last one day and</span>
<a href="#l46.22"></a><span id="l46.22">                     // timed events last the default length.</span>
<a href="#l46.23"></a><span id="l46.23">                     eDate = sDate.clone();</span>
<a href="#l46.24"></a><span id="l46.24">                     if (sDate.isDate) {</span>
<a href="#l46.25"></a><span id="l46.25">                         // end date is exclusive, so set to next day after start.</span>
<a href="#l46.26"></a><span id="l46.26">                         eDate.day += 1;</span>
<a href="#l46.27"></a><span id="l46.27">                     } else {</span>
<a href="#l46.28"></a><span id="l46.28" class="difflineminus">-                        eDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l46.29"></a><span id="l46.29" class="difflineplus">+                        eDate.minute += Services.prefs.getIntPref(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l46.30"></a><span id="l46.30">                     }</span>
<a href="#l46.31"></a><span id="l46.31">                 } else if (sDate.isDate) {</span>
<a href="#l46.32"></a><span id="l46.32">                     // A time part for the startDate is missing or was</span>
<a href="#l46.33"></a><span id="l46.33">                     // not recognized. We have to throw away the endDates</span>
<a href="#l46.34"></a><span id="l46.34">                     // time part too for obtaining a valid event.</span>
<a href="#l46.35"></a><span id="l46.35">                     eDate.isDate = true;</span>
<a href="#l46.36"></a><span id="l46.36">                     // Correct the eDate if duration is less than one day.</span>
<a href="#l46.37"></a><span id="l46.37">                     if (eDate.subtractDate(sDate).days &lt; 1) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/import-export/calWeekPrinter.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/import-export/calWeekPrinter.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l47.4"></a><span id="l47.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l47.5"></a><span id="l47.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l47.6"></a><span id="l47.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l47.7"></a><span id="l47.7"> </span>
<a href="#l47.8"></a><span id="l47.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l47.9"></a><span id="l47.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l47.10"></a><span id="l47.10"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l47.11"></a><span id="l47.11"> </span>
<a href="#l47.12"></a><span id="l47.12"> /**</span>
<a href="#l47.13"></a><span id="l47.13">  * Prints a two column view of a week of events, much like a paper day-planner</span>
<a href="#l47.14"></a><span id="l47.14">  */</span>
<a href="#l47.15"></a><span id="l47.15"> function calWeekPrinter() {</span>
<a href="#l47.16"></a><span id="l47.16">     this.wrappedJSObject = this;</span>
<a href="#l47.17"></a><span id="l47.17"> }</span>
<a href="#l47.18"></a><span id="l47.18" class="difflineat">@@ -106,17 +106,17 @@ calWeekPrinter.prototype = {</span>
<a href="#l47.19"></a><span id="l47.19">             let weekday = currentDate.weekday;</span>
<a href="#l47.20"></a><span id="l47.20">             let weekdayName = weekdayMap[weekday];</span>
<a href="#l47.21"></a><span id="l47.21">             let dayOffPrefName = &quot;calendar.week.d&quot; + weekday + weekdayName + &quot;soff&quot;;</span>
<a href="#l47.22"></a><span id="l47.22">             dayTable[cal.print.getDateKey(currentDate)] = currentPage.querySelector(&quot;.&quot; + weekdayName + &quot;-container&quot;);</span>
<a href="#l47.23"></a><span id="l47.23"> </span>
<a href="#l47.24"></a><span id="l47.24">             let titleNode = currentPage.querySelector(&quot;.&quot; + weekdayName + &quot;-title&quot;);</span>
<a href="#l47.25"></a><span id="l47.25">             titleNode.textContent = dateFormatter.formatDateLong(currentDate.getInTimezone(defaultTimezone));</span>
<a href="#l47.26"></a><span id="l47.26"> </span>
<a href="#l47.27"></a><span id="l47.27" class="difflineminus">-            if (Preferences.get(dayOffPrefName, false)) {</span>
<a href="#l47.28"></a><span id="l47.28" class="difflineplus">+            if (Services.prefs.getBoolPref(dayOffPrefName, false)) {</span>
<a href="#l47.29"></a><span id="l47.29">                 let daysOffNode = currentPage.querySelector(&quot;.&quot; + weekdayName + &quot;-box&quot;);</span>
<a href="#l47.30"></a><span id="l47.30">                 daysOffNode.className += &quot; day-off&quot;;</span>
<a href="#l47.31"></a><span id="l47.31">             }</span>
<a href="#l47.32"></a><span id="l47.32">         }</span>
<a href="#l47.33"></a><span id="l47.33"> </span>
<a href="#l47.34"></a><span id="l47.34">         // Now insert the week into the week container, sorting by date (and therefore week number)</span>
<a href="#l47.35"></a><span id="l47.35">         function compareDates(a, b) {</span>
<a href="#l47.36"></a><span id="l47.36">             return !a || !b ? -1 : a.compare(b);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/itip/calItipEmailTransport.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/itip/calItipEmailTransport.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -1,17 +1,16 @@</span>
<a href="#l48.4"></a><span id="l48.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l48.5"></a><span id="l48.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l48.6"></a><span id="l48.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l48.7"></a><span id="l48.7"> </span>
<a href="#l48.8"></a><span id="l48.8"> var { MailServices } = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l48.9"></a><span id="l48.9"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l48.10"></a><span id="l48.10"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l48.11"></a><span id="l48.11"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l48.13"></a><span id="l48.13"> var { ltn } = ChromeUtils.import(&quot;resource://calendar/modules/ltnInvitationUtils.jsm&quot;);</span>
<a href="#l48.14"></a><span id="l48.14"> </span>
<a href="#l48.15"></a><span id="l48.15"> /**</span>
<a href="#l48.16"></a><span id="l48.16">  * Constructor of calItipEmailTransport object</span>
<a href="#l48.17"></a><span id="l48.17">  */</span>
<a href="#l48.18"></a><span id="l48.18"> function calItipEmailTransport() {</span>
<a href="#l48.19"></a><span id="l48.19">     this.wrappedJSObject = this;</span>
<a href="#l48.20"></a><span id="l48.20">     this._initEmailTransport();</span>
<a href="#l48.21"></a><span id="l48.21" class="difflineat">@@ -58,17 +57,17 @@ calItipEmailTransport.prototype = {</span>
<a href="#l48.22"></a><span id="l48.22">         // We'll need a way to configure the Common Name attribute and we should</span>
<a href="#l48.23"></a><span id="l48.23">         // use it here rather than the email address</span>
<a href="#l48.24"></a><span id="l48.24"> </span>
<a href="#l48.25"></a><span id="l48.25">         let summary = item.getProperty(&quot;SUMMARY&quot;) || &quot;&quot;;</span>
<a href="#l48.26"></a><span id="l48.26">         let subject = &quot;&quot;;</span>
<a href="#l48.27"></a><span id="l48.27">         let body = &quot;&quot;;</span>
<a href="#l48.28"></a><span id="l48.28">         switch (aItipItem.responseMethod) {</span>
<a href="#l48.29"></a><span id="l48.29">             case &quot;REQUEST&quot;: {</span>
<a href="#l48.30"></a><span id="l48.30" class="difflineminus">-                let usePrefixes = Preferences.get(</span>
<a href="#l48.31"></a><span id="l48.31" class="difflineplus">+                let usePrefixes = Services.prefs.getBoolPref(</span>
<a href="#l48.32"></a><span id="l48.32">                     &quot;calendar.itip.useInvitationSubjectPrefixes&quot;,</span>
<a href="#l48.33"></a><span id="l48.33">                     true</span>
<a href="#l48.34"></a><span id="l48.34">                 );</span>
<a href="#l48.35"></a><span id="l48.35">                 if (usePrefixes) {</span>
<a href="#l48.36"></a><span id="l48.36">                     let seq = item.getProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l48.37"></a><span id="l48.37">                     let subjectKey = seq &amp;&amp; seq &gt; 0</span>
<a href="#l48.38"></a><span id="l48.38">                         ? &quot;itipRequestUpdatedSubject2&quot;</span>
<a href="#l48.39"></a><span id="l48.39">                         : &quot;itipRequestSubject2&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/lightning/content/imip-bar.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/lightning/content/imip-bar.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l49.4"></a><span id="l49.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l49.5"></a><span id="l49.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l49.6"></a><span id="l49.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l49.7"></a><span id="l49.7"> </span>
<a href="#l49.8"></a><span id="l49.8"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l49.9"></a><span id="l49.9"> var { ltn } = ChromeUtils.import(&quot;resource://calendar/modules/ltnInvitationUtils.jsm&quot;);</span>
<a href="#l49.10"></a><span id="l49.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l49.11"></a><span id="l49.11" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l49.12"></a><span id="l49.12"> </span>
<a href="#l49.13"></a><span id="l49.13"> /**</span>
<a href="#l49.14"></a><span id="l49.14">  * Provides shortcuts to set label and collapsed attribute of imip-bar node.</span>
<a href="#l49.15"></a><span id="l49.15">  */</span>
<a href="#l49.16"></a><span id="l49.16"> const imipBar = {</span>
<a href="#l49.17"></a><span id="l49.17">     get bar() {</span>
<a href="#l49.18"></a><span id="l49.18">         return document.querySelector(&quot;.lightning-notification-bar&quot;);</span>
<a href="#l49.19"></a><span id="l49.19">     },</span>
<a href="#l49.20"></a><span id="l49.20" class="difflineat">@@ -267,17 +267,17 @@ var ltnImipBar = {</span>
<a href="#l49.21"></a><span id="l49.21">             !ltnImipBar.foundItems[0] || !ltnImipBar.itipItem) {</span>
<a href="#l49.22"></a><span id="l49.22">             return;</span>
<a href="#l49.23"></a><span id="l49.23">         }</span>
<a href="#l49.24"></a><span id="l49.24"> </span>
<a href="#l49.25"></a><span id="l49.25">         let msgOverlay = ltnImipBar.msgOverlay;</span>
<a href="#l49.26"></a><span id="l49.26">         let diff = cal.itip.compare(ltnImipBar.itipItem.getItemList({})[0], ltnImipBar.foundItems[0]);</span>
<a href="#l49.27"></a><span id="l49.27">         // displaying chnages is only needed if that is enabled, an item already exists and there are</span>
<a href="#l49.28"></a><span id="l49.28">         // differences</span>
<a href="#l49.29"></a><span id="l49.29" class="difflineminus">-        if (diff != 0 &amp;&amp; Preferences.get(&quot;calendar.itip.displayInvitationChanges&quot;, false)) {</span>
<a href="#l49.30"></a><span id="l49.30" class="difflineplus">+        if (diff != 0 &amp;&amp; Services.prefs.getBoolPref(&quot;calendar.itip.displayInvitationChanges&quot;, false)) {</span>
<a href="#l49.31"></a><span id="l49.31">             let foundOverlay = ltn.invitation.createInvitationOverlay(ltnImipBar.foundItems[0],</span>
<a href="#l49.32"></a><span id="l49.32">                                                                       ltnImipBar.itipItem);</span>
<a href="#l49.33"></a><span id="l49.33">             let serializedOverlay = cal.xml.serializeDOM(foundOverlay);</span>
<a href="#l49.34"></a><span id="l49.34">             let organizerId = ltnImipBar.itipItem.targetCalendar.getProperty(&quot;organizerId&quot;);</span>
<a href="#l49.35"></a><span id="l49.35">             if (diff == 1) {</span>
<a href="#l49.36"></a><span id="l49.36">                 // this is an update to previously accepted invitation</span>
<a href="#l49.37"></a><span id="l49.37">                 msgOverlay = ltn.invitation.compareInvitationOverlay(serializedOverlay, msgOverlay,</span>
<a href="#l49.38"></a><span id="l49.38">                                                                      organizerId);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -18,29 +18,28 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l50.4"></a><span id="l50.4"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l50.5"></a><span id="l50.5"> var {</span>
<a href="#l50.6"></a><span id="l50.6">     recurrenceRule2String,</span>
<a href="#l50.7"></a><span id="l50.7">     splitRecurrenceRules,</span>
<a href="#l50.8"></a><span id="l50.8">     checkRecurrenceRule,</span>
<a href="#l50.9"></a><span id="l50.9">     countOccurrences</span>
<a href="#l50.10"></a><span id="l50.10"> } = ChromeUtils.import(&quot;resource://calendar/modules/calRecurrenceUtils.jsm&quot;);</span>
<a href="#l50.11"></a><span id="l50.11"> var { PluralForm } = ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l50.13"></a><span id="l50.13"> </span>
<a href="#l50.14"></a><span id="l50.14"> var cloudFileAccounts;</span>
<a href="#l50.15"></a><span id="l50.15"> try {</span>
<a href="#l50.16"></a><span id="l50.16">     let temp = ChromeUtils.import(&quot;resource:///modules/cloudFileAccounts.js&quot;);</span>
<a href="#l50.17"></a><span id="l50.17">     cloudFileAccounts = temp.cloudFileAccounts;</span>
<a href="#l50.18"></a><span id="l50.18"> } catch (e) {</span>
<a href="#l50.19"></a><span id="l50.19">     // This will fail on Seamonkey, but thats ok since the pref for cloudfiles</span>
<a href="#l50.20"></a><span id="l50.20">     // is false, which means the UI will not be shown</span>
<a href="#l50.21"></a><span id="l50.21"> }</span>
<a href="#l50.22"></a><span id="l50.22"> </span>
<a href="#l50.23"></a><span id="l50.23"> // Flag for using new item UI code (HTML/React.js).</span>
<a href="#l50.24"></a><span id="l50.24" class="difflineminus">-const gNewItemUI = Preferences.get(&quot;calendar.item.useNewItemUI&quot;, false);</span>
<a href="#l50.25"></a><span id="l50.25" class="difflineplus">+const gNewItemUI = Services.prefs.getBoolPref(&quot;calendar.item.useNewItemUI&quot;, false);</span>
<a href="#l50.26"></a><span id="l50.26"> </span>
<a href="#l50.27"></a><span id="l50.27"> // the following variables are constructed if the jsContext this file</span>
<a href="#l50.28"></a><span id="l50.28"> // belongs to gets constructed. all those variables are meant to be accessed</span>
<a href="#l50.29"></a><span id="l50.29"> // from within this file only.</span>
<a href="#l50.30"></a><span id="l50.30"> var gStartTime = null;</span>
<a href="#l50.31"></a><span id="l50.31"> var gEndTime = null;</span>
<a href="#l50.32"></a><span id="l50.32"> var gItemDuration = null;</span>
<a href="#l50.33"></a><span id="l50.33"> var gStartTimezone = null;</span>
<a href="#l50.34"></a><span id="l50.34" class="difflineat">@@ -749,17 +748,17 @@ function loadDialog(aItem) {</span>
<a href="#l50.35"></a><span id="l50.35">             // visualize that the server will send out mail:</span>
<a href="#l50.36"></a><span id="l50.36">             notifyCheckbox.checked = true;</span>
<a href="#l50.37"></a><span id="l50.37">             // hide these controls as this a client only feature</span>
<a href="#l50.38"></a><span id="l50.38">             undiscloseCheckbox.disabled = true;</span>
<a href="#l50.39"></a><span id="l50.39">         } else {</span>
<a href="#l50.40"></a><span id="l50.40">             let itemProp = aItem.getProperty(&quot;X-MOZ-SEND-INVITATIONS&quot;);</span>
<a href="#l50.41"></a><span id="l50.41">             notifyCheckbox.checked = (aItem.calendar.getProperty(&quot;imip.identity&quot;) &amp;&amp;</span>
<a href="#l50.42"></a><span id="l50.42">                                       ((itemProp === null)</span>
<a href="#l50.43"></a><span id="l50.43" class="difflineminus">-                                       ? Preferences.get(&quot;calendar.itip.notify&quot;, true)</span>
<a href="#l50.44"></a><span id="l50.44" class="difflineplus">+                                       ? Services.prefs.getBoolPref(&quot;calendar.itip.notify&quot;, true)</span>
<a href="#l50.45"></a><span id="l50.45">                                        : (itemProp == &quot;TRUE&quot;)));</span>
<a href="#l50.46"></a><span id="l50.46">             let undiscloseProp = aItem.getProperty(&quot;X-MOZ-SEND-INVITATIONS-UNDISCLOSED&quot;);</span>
<a href="#l50.47"></a><span id="l50.47">             undiscloseCheckbox.checked = (undiscloseProp === null)</span>
<a href="#l50.48"></a><span id="l50.48">                                          ? false // default value as most common within organizations</span>
<a href="#l50.49"></a><span id="l50.49">                                          : (undiscloseProp == &quot;TRUE&quot;);</span>
<a href="#l50.50"></a><span id="l50.50">             // disable checkbox, if notifyCheckbox is not checked</span>
<a href="#l50.51"></a><span id="l50.51">             undiscloseCheckbox.disabled = !notifyCheckbox.checked;</span>
<a href="#l50.52"></a><span id="l50.52">         }</span>
<a href="#l50.53"></a><span id="l50.53" class="difflineat">@@ -1795,17 +1794,17 @@ function onUpdateAllDay() {</span>
<a href="#l50.54"></a><span id="l50.54">     } else {</span>
<a href="#l50.55"></a><span id="l50.55">         gStartTime.isDate = false;</span>
<a href="#l50.56"></a><span id="l50.56">         gEndTime.isDate = false;</span>
<a href="#l50.57"></a><span id="l50.57">         if (!gOldStartTime &amp;&amp; !gOldEndTime) {</span>
<a href="#l50.58"></a><span id="l50.58">             // The checkbox has been unchecked for the first time, the event</span>
<a href="#l50.59"></a><span id="l50.59">             // was an &quot;All day&quot; type, so we have to set default values.</span>
<a href="#l50.60"></a><span id="l50.60">             gStartTime.hour = cal.dtz.getDefaultStartDate(window.initialStartDateValue).hour;</span>
<a href="#l50.61"></a><span id="l50.61">             gEndTime.hour = gStartTime.hour;</span>
<a href="#l50.62"></a><span id="l50.62" class="difflineminus">-            gEndTime.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l50.63"></a><span id="l50.63" class="difflineplus">+            gEndTime.minute += Services.prefs.getIntPref(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l50.64"></a><span id="l50.64">             gOldStartTimezone = kDefaultTimezone;</span>
<a href="#l50.65"></a><span id="l50.65">             gOldEndTimezone = kDefaultTimezone;</span>
<a href="#l50.66"></a><span id="l50.66">         } else {</span>
<a href="#l50.67"></a><span id="l50.67">             // Restore date-times previously stored.</span>
<a href="#l50.68"></a><span id="l50.68">             gStartTime.hour = gOldStartTime.hour;</span>
<a href="#l50.69"></a><span id="l50.69">             gStartTime.minute = gOldStartTime.minute;</span>
<a href="#l50.70"></a><span id="l50.70">             gEndTime.hour = gOldEndTime.hour;</span>
<a href="#l50.71"></a><span id="l50.71">             gEndTime.minute = gOldEndTime.minute;</span>
<a href="#l50.72"></a><span id="l50.72" class="difflineat">@@ -2012,17 +2011,17 @@ function updateConfigState(aArg) {</span>
<a href="#l50.73"></a><span id="l50.73"> </span>
<a href="#l50.74"></a><span id="l50.74">     sendMessage({ command: &quot;updateConfigState&quot;, argument: aArg });</span>
<a href="#l50.75"></a><span id="l50.75"> }</span>
<a href="#l50.76"></a><span id="l50.76"> </span>
<a href="#l50.77"></a><span id="l50.77"> /**</span>
<a href="#l50.78"></a><span id="l50.78">  * Add menu items to the UI for attaching files using cloud providers.</span>
<a href="#l50.79"></a><span id="l50.79">  */</span>
<a href="#l50.80"></a><span id="l50.80"> function loadCloudProviders() {</span>
<a href="#l50.81"></a><span id="l50.81" class="difflineminus">-    let cloudFileEnabled = Preferences.get(&quot;mail.cloud_files.enabled&quot;, false);</span>
<a href="#l50.82"></a><span id="l50.82" class="difflineplus">+    let cloudFileEnabled = Services.prefs.getBoolPref(&quot;mail.cloud_files.enabled&quot;, false);</span>
<a href="#l50.83"></a><span id="l50.83">     let cmd = document.getElementById(&quot;cmd_attach_cloud&quot;);</span>
<a href="#l50.84"></a><span id="l50.84">     let message = {</span>
<a href="#l50.85"></a><span id="l50.85">         command: &quot;setElementAttribute&quot;,</span>
<a href="#l50.86"></a><span id="l50.86">         argument: { id: &quot;cmd_attach_cloud&quot;, attribute: &quot;hidden&quot;, value: null }</span>
<a href="#l50.87"></a><span id="l50.87">     };</span>
<a href="#l50.88"></a><span id="l50.88"> </span>
<a href="#l50.89"></a><span id="l50.89">     if (!cloudFileEnabled) {</span>
<a href="#l50.90"></a><span id="l50.90">         // If cloud file support is disabled, just hide the attach item</span>
<a href="#l50.91"></a><span id="l50.91" class="difflineat">@@ -2298,17 +2297,17 @@ function addAttachment(attachment, cloud</span>
<a href="#l50.92"></a><span id="l50.92">                     listItem.setAttribute(&quot;label&quot;, leafName);</span>
<a href="#l50.93"></a><span id="l50.93">                 }</span>
<a href="#l50.94"></a><span id="l50.94">             }</span>
<a href="#l50.95"></a><span id="l50.95">         } else if (attachment.uri.schemeIs(&quot;file&quot;)) {</span>
<a href="#l50.96"></a><span id="l50.96">             image.setAttribute(&quot;src&quot;, &quot;moz-icon://&quot; + attachment.uri.spec);</span>
<a href="#l50.97"></a><span id="l50.97">         } else {</span>
<a href="#l50.98"></a><span id="l50.98">             let leafName = attachment.getParameter(&quot;FILENAME&quot;);</span>
<a href="#l50.99"></a><span id="l50.99">             let providerType = attachment.getParameter(&quot;PROVIDER&quot;);</span>
<a href="#l50.100"></a><span id="l50.100" class="difflineminus">-            let cloudFileEnabled = Preferences.get(&quot;mail.cloud_files.enabled&quot;, false);</span>
<a href="#l50.101"></a><span id="l50.101" class="difflineplus">+            let cloudFileEnabled = Services.prefs.getBoolPref(&quot;mail.cloud_files.enabled&quot;, false);</span>
<a href="#l50.102"></a><span id="l50.102"> </span>
<a href="#l50.103"></a><span id="l50.103">             if (leafName) {</span>
<a href="#l50.104"></a><span id="l50.104">                 // TODO security issues?</span>
<a href="#l50.105"></a><span id="l50.105">                 listItem.setAttribute(&quot;label&quot;, leafName);</span>
<a href="#l50.106"></a><span id="l50.106">             }</span>
<a href="#l50.107"></a><span id="l50.107">             if (providerType &amp;&amp; cloudFileEnabled) {</span>
<a href="#l50.108"></a><span id="l50.108">                 let provider = cloudFileAccounts.getProviderForType(providerType);</span>
<a href="#l50.109"></a><span id="l50.109">                 image.setAttribute(&quot;src&quot;, provider.iconClass);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -777,17 +777,17 @@ function moveEventToolbox(aDestination) </span>
<a href="#l51.4"></a><span id="l51.4"> </span>
<a href="#l51.5"></a><span id="l51.5"> /**</span>
<a href="#l51.6"></a><span id="l51.6">  * Checks if Lightning's binary component was successfully loaded.</span>
<a href="#l51.7"></a><span id="l51.7">  */</span>
<a href="#l51.8"></a><span id="l51.8"> function checkCalendarBinaryComponent() {</span>
<a href="#l51.9"></a><span id="l51.9">     // Don't even get started if we are running ical.js or the binary component</span>
<a href="#l51.10"></a><span id="l51.10">     // was successfully loaded.</span>
<a href="#l51.11"></a><span id="l51.11">     if (&quot;@mozilla.org/calendar/datetime;1&quot; in Cc ||</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-        Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+        Services.prefs.getBoolPref(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l51.14"></a><span id="l51.14">         return;</span>
<a href="#l51.15"></a><span id="l51.15">     }</span>
<a href="#l51.16"></a><span id="l51.16"> </span>
<a href="#l51.17"></a><span id="l51.17">     const THUNDERBIRD_GUID = &quot;{3550f703-e582-4d05-9a08-453d09bdfdc6}&quot;;</span>
<a href="#l51.18"></a><span id="l51.18">     const SEAMONKEY_GUID = &quot;{92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a}&quot;;</span>
<a href="#l51.19"></a><span id="l51.19">     const LIGHTNING_GUID = &quot;{e2fda1a4-762b-4020-b5ad-a41df1933103}&quot;;</span>
<a href="#l51.20"></a><span id="l51.20"> </span>
<a href="#l51.21"></a><span id="l51.21">     AddonManager.getAddonByID(LIGHTNING_GUID, (ext) =&gt; {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l52.4"></a><span id="l52.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l52.5"></a><span id="l52.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l52.6"></a><span id="l52.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l52.7"></a><span id="l52.7"> </span>
<a href="#l52.8"></a><span id="l52.8"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l52.9"></a><span id="l52.9"> var { recurrenceRule2String } = ChromeUtils.import(&quot;resource://calendar/modules/calRecurrenceUtils.jsm&quot;);</span>
<a href="#l52.10"></a><span id="l52.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l52.11"></a><span id="l52.11" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l52.12"></a><span id="l52.12"> var { MailServices } = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l52.13"></a><span id="l52.13"> </span>
<a href="#l52.14"></a><span id="l52.14"> this.EXPORTED_SYMBOLS = [&quot;ltn&quot;]; /* exported ltn */</span>
<a href="#l52.15"></a><span id="l52.15"> var ltn = {};</span>
<a href="#l52.16"></a><span id="l52.16"> </span>
<a href="#l52.17"></a><span id="l52.17"> ltn.invitation = {</span>
<a href="#l52.18"></a><span id="l52.18">     /**</span>
<a href="#l52.19"></a><span id="l52.19">      * Returns a header title for an ITIP item depending on the response method</span>
<a href="#l52.20"></a><span id="l52.20" class="difflineat">@@ -301,17 +301,17 @@ ltn.invitation = {</span>
<a href="#l52.21"></a><span id="l52.21">                 aToNode.firstChild.remove();</span>
<a href="#l52.22"></a><span id="l52.22">             }</span>
<a href="#l52.23"></a><span id="l52.23">             let n = nodeDoc.createElement(aType.toLowerCase() == &quot;newline&quot; ? &quot;br&quot; : &quot;span&quot;);</span>
<a href="#l52.24"></a><span id="l52.24">             switch (aType) {</span>
<a href="#l52.25"></a><span id="l52.25">                 case &quot;added&quot;:</span>
<a href="#l52.26"></a><span id="l52.26">                 case &quot;modified&quot;:</span>
<a href="#l52.27"></a><span id="l52.27">                 case &quot;removed&quot;:</span>
<a href="#l52.28"></a><span id="l52.28">                     n.className = aType;</span>
<a href="#l52.29"></a><span id="l52.29" class="difflineminus">-                    if (Preferences.get(&quot;calendar.view.useSystemColors&quot;, false)) {</span>
<a href="#l52.30"></a><span id="l52.30" class="difflineplus">+                    if (Services.prefs.getBoolPref(&quot;calendar.view.useSystemColors&quot;, false)) {</span>
<a href="#l52.31"></a><span id="l52.31">                         n.setAttribute(&quot;systemcolors&quot;, true);</span>
<a href="#l52.32"></a><span id="l52.32">                     }</span>
<a href="#l52.33"></a><span id="l52.33">                     break;</span>
<a href="#l52.34"></a><span id="l52.34">             }</span>
<a href="#l52.35"></a><span id="l52.35">             n.textContent = aText;</span>
<a href="#l52.36"></a><span id="l52.36">             aToNode.appendChild(n);</span>
<a href="#l52.37"></a><span id="l52.37">         }</span>
<a href="#l52.38"></a><span id="l52.38">         /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -1,16 +1,15 @@</span>
<a href="#l53.4"></a><span id="l53.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l53.5"></a><span id="l53.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l53.6"></a><span id="l53.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l53.7"></a><span id="l53.7"> </span>
<a href="#l53.8"></a><span id="l53.8"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l53.9"></a><span id="l53.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l53.10"></a><span id="l53.10"> var { setTimeout } = ChromeUtils.import(&quot;resource://gre/modules/Timer.jsm&quot;);</span>
<a href="#l53.11"></a><span id="l53.11" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l53.12"></a><span id="l53.12"> </span>
<a href="#l53.13"></a><span id="l53.13"> var { OAuth2 } = ChromeUtils.import(&quot;resource:///modules/OAuth2.jsm&quot;);</span>
<a href="#l53.14"></a><span id="l53.14"> </span>
<a href="#l53.15"></a><span id="l53.15"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l53.16"></a><span id="l53.16"> </span>
<a href="#l53.17"></a><span id="l53.17"> //</span>
<a href="#l53.18"></a><span id="l53.18"> // calDavCalendar.js</span>
<a href="#l53.19"></a><span id="l53.19"> //</span>
<a href="#l53.20"></a><span id="l53.20" class="difflineat">@@ -468,17 +467,17 @@ calDavCalendar.prototype = {</span>
<a href="#l53.21"></a><span id="l53.21">     },</span>
<a href="#l53.22"></a><span id="l53.22"> </span>
<a href="#l53.23"></a><span id="l53.23">     mHaveScheduling: false,</span>
<a href="#l53.24"></a><span id="l53.24">     mShouldPollInbox: true,</span>
<a href="#l53.25"></a><span id="l53.25">     get hasScheduling() { // Whether to use inbox/outbox scheduling</span>
<a href="#l53.26"></a><span id="l53.26">         return this.mHaveScheduling;</span>
<a href="#l53.27"></a><span id="l53.27">     },</span>
<a href="#l53.28"></a><span id="l53.28">     set hasScheduling(value) {</span>
<a href="#l53.29"></a><span id="l53.29" class="difflineminus">-        return (this.mHaveScheduling = (Preferences.get(&quot;calendar.caldav.sched.enabled&quot;, false) &amp;&amp; value));</span>
<a href="#l53.30"></a><span id="l53.30" class="difflineplus">+        return (this.mHaveScheduling = (Services.prefs.getBoolPref(&quot;calendar.caldav.sched.enabled&quot;, false) &amp;&amp; value));</span>
<a href="#l53.31"></a><span id="l53.31">     },</span>
<a href="#l53.32"></a><span id="l53.32">     mHasAutoScheduling: false, // Whether server automatically takes care of scheduling</span>
<a href="#l53.33"></a><span id="l53.33">     get hasAutoScheduling() {</span>
<a href="#l53.34"></a><span id="l53.34">         return this.mHasAutoScheduling;</span>
<a href="#l53.35"></a><span id="l53.35">     },</span>
<a href="#l53.36"></a><span id="l53.36"> </span>
<a href="#l53.37"></a><span id="l53.37">     hasFreebusy: false,</span>
<a href="#l53.38"></a><span id="l53.38"> </span>
<a href="#l53.39"></a><span id="l53.39" class="difflineat">@@ -2875,17 +2874,17 @@ calDavCalendar.prototype = {</span>
<a href="#l53.40"></a><span id="l53.40">             });</span>
<a href="#l53.41"></a><span id="l53.41">         }</span>
<a href="#l53.42"></a><span id="l53.42">         return true;</span>
<a href="#l53.43"></a><span id="l53.43">     },</span>
<a href="#l53.44"></a><span id="l53.44"> </span>
<a href="#l53.45"></a><span id="l53.45">     mVerboseLogging: undefined,</span>
<a href="#l53.46"></a><span id="l53.46">     verboseLogging: function() {</span>
<a href="#l53.47"></a><span id="l53.47">         if (this.mVerboseLogging === undefined) {</span>
<a href="#l53.48"></a><span id="l53.48" class="difflineminus">-            this.mVerboseLogging = Preferences.get(&quot;calendar.debug.log.verbose&quot;, false);</span>
<a href="#l53.49"></a><span id="l53.49" class="difflineplus">+            this.mVerboseLogging = Services.prefs.getBoolPref(&quot;calendar.debug.log.verbose&quot;, false);</span>
<a href="#l53.50"></a><span id="l53.50">         }</span>
<a href="#l53.51"></a><span id="l53.51">         return this.mVerboseLogging;</span>
<a href="#l53.52"></a><span id="l53.52">     },</span>
<a href="#l53.53"></a><span id="l53.53"> </span>
<a href="#l53.54"></a><span id="l53.54">     getSerializedItem: function(aItem) {</span>
<a href="#l53.55"></a><span id="l53.55">         let serializer = Cc[&quot;@mozilla.org/calendar/ics-serializer;1&quot;]</span>
<a href="#l53.56"></a><span id="l53.56">                            .createInstance(Ci.calIIcsSerializer);</span>
<a href="#l53.57"></a><span id="l53.57">         serializer.addItems([aItem], 1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l54.4"></a><span id="l54.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l54.5"></a><span id="l54.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l54.6"></a><span id="l54.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l54.7"></a><span id="l54.7"> </span>
<a href="#l54.8"></a><span id="l54.8"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l54.9"></a><span id="l54.9"> var { setTimeout } = ChromeUtils.import(&quot;resource://gre/modules/Timer.jsm&quot;);</span>
<a href="#l54.10"></a><span id="l54.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l54.11"></a><span id="l54.11"> </span>
<a href="#l54.12"></a><span id="l54.12"> var xmlHeader = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n';</span>
<a href="#l54.13"></a><span id="l54.13"> var MIME_TEXT_XML = &quot;text/xml; charset=utf-8&quot;;</span>
<a href="#l54.14"></a><span id="l54.14"> </span>
<a href="#l54.15"></a><span id="l54.15"> /**</span>
<a href="#l54.16"></a><span id="l54.16">  * This is a handler for the etag request in calDavCalendar.js' getUpdatedItem.</span>
<a href="#l54.17"></a><span id="l54.17">  * It uses the SAX parser to incrementally parse the items and compose the</span>
<a href="#l54.18"></a><span id="l54.18">  * resulting multiget.</span>
<a href="#l54.19"></a><span id="l54.19" class="difflineat">@@ -674,17 +673,17 @@ multigetSyncHandler.prototype = {</span>
<a href="#l54.20"></a><span id="l54.20"> </span>
<a href="#l54.21"></a><span id="l54.21">     doMultiGet: function() {</span>
<a href="#l54.22"></a><span id="l54.22">         if (this.calendar.mDisabled) {</span>
<a href="#l54.23"></a><span id="l54.23">             // check if maybe our calendar has become available</span>
<a href="#l54.24"></a><span id="l54.24">             this.calendar.setupAuthentication(this.changeLogListener);</span>
<a href="#l54.25"></a><span id="l54.25">             return;</span>
<a href="#l54.26"></a><span id="l54.26">         }</span>
<a href="#l54.27"></a><span id="l54.27"> </span>
<a href="#l54.28"></a><span id="l54.28" class="difflineminus">-        let batchSize = Preferences.get(&quot;calendar.caldav.multigetBatchSize&quot;, 100);</span>
<a href="#l54.29"></a><span id="l54.29" class="difflineplus">+        let batchSize = Services.prefs.getIntPref(&quot;calendar.caldav.multigetBatchSize&quot;, 100);</span>
<a href="#l54.30"></a><span id="l54.30">         let hrefString = &quot;&quot;;</span>
<a href="#l54.31"></a><span id="l54.31">         while (this.itemsNeedFetching.length &amp;&amp; batchSize &gt; 0) {</span>
<a href="#l54.32"></a><span id="l54.32">             batchSize--;</span>
<a href="#l54.33"></a><span id="l54.33">             // ensureEncodedPath extracts only the path component of the item and</span>
<a href="#l54.34"></a><span id="l54.34">             // encodes it before it is sent to the server</span>
<a href="#l54.35"></a><span id="l54.35">             let locpath = this.calendar.ensureEncodedPath(this.itemsNeedFetching.pop());</span>
<a href="#l54.36"></a><span id="l54.36">             hrefString += &quot;&lt;D:href&gt;&quot; + cal.xml.escapeString(locpath) + &quot;&lt;/D:href&gt;&quot;;</span>
<a href="#l54.37"></a><span id="l54.37">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/calendar/providers/gdata/components/calGoogleCalendar.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/calendar/providers/gdata/components/calGoogleCalendar.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -1,13 +1,12 @@</span>
<a href="#l55.4"></a><span id="l55.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l55.5"></a><span id="l55.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l55.6"></a><span id="l55.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l55.7"></a><span id="l55.7"> </span>
<a href="#l55.8"></a><span id="l55.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l55.9"></a><span id="l55.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l55.10"></a><span id="l55.10"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l55.11"></a><span id="l55.11"> </span>
<a href="#l55.12"></a><span id="l55.12"> // Backwards compatibility with Thunderbird &lt;60.</span>
<a href="#l55.13"></a><span id="l55.13"> if (!(&quot;Cc&quot; in this)) {</span>
<a href="#l55.14"></a><span id="l55.14">     // eslint-disable-next-line mozilla/no-define-cc-etc, no-unused-vars</span>
<a href="#l55.15"></a><span id="l55.15">     const { classes: Cc, interfaces: Ci, results: Cr } = Components;</span>
<a href="#l55.16"></a><span id="l55.16"> }</span>
<a href="#l55.17"></a><span id="l55.17" class="difflineat">@@ -147,17 +146,17 @@ calGoogleCalendar.prototype = {</span>
<a href="#l55.18"></a><span id="l55.18">             } else {</span>
<a href="#l55.19"></a><span id="l55.19">                 this.mCalendarName = parameters.get(&quot;calendar&quot;);</span>
<a href="#l55.20"></a><span id="l55.20">                 this.mTasklistName = parameters.get(&quot;tasks&quot;);</span>
<a href="#l55.21"></a><span id="l55.21">             }</span>
<a href="#l55.22"></a><span id="l55.22"> </span>
<a href="#l55.23"></a><span id="l55.23">             // Users that installed 1.0 had an issue where secondary calendars</span>
<a href="#l55.24"></a><span id="l55.24">             // were migrated to their own session. This code fixes that and</span>
<a href="#l55.25"></a><span id="l55.25">             // should be removed once 1.0.1 has been out for a while.</span>
<a href="#l55.26"></a><span id="l55.26" class="difflineminus">-            let googleUser = Preferences.get(&quot;calendar.google.calPrefs.&quot; + fullUser + &quot;.googleUser&quot;);</span>
<a href="#l55.27"></a><span id="l55.27" class="difflineplus">+            let googleUser = Services.prefs.getStringPref(&quot;calendar.google.calPrefs.&quot; + fullUser + &quot;.googleUser&quot;, null);</span>
<a href="#l55.28"></a><span id="l55.28">             if (googleUser &amp;&amp; googleUser != fullUser) {</span>
<a href="#l55.29"></a><span id="l55.29">                 let newUri = &quot;googleapi://&quot; + googleUser + &quot;/&quot; + path;</span>
<a href="#l55.30"></a><span id="l55.30">                 cal.LOG(&quot;[calGoogleCalendar] Migrating url format from &quot; + aUri.spec + &quot; to &quot; + newUri);</span>
<a href="#l55.31"></a><span id="l55.31">                 this.setProperty(&quot;uri&quot;, newUri);</span>
<a href="#l55.32"></a><span id="l55.32">                 this.mUri = Services.io.newURI(newUri);</span>
<a href="#l55.33"></a><span id="l55.33">             }</span>
<a href="#l55.34"></a><span id="l55.34"> </span>
<a href="#l55.35"></a><span id="l55.35">             // Unit tests will use a local uri, if the magic parameter is passed.</span>
<a href="#l55.36"></a><span id="l55.36" class="difflineat">@@ -173,17 +172,17 @@ calGoogleCalendar.prototype = {</span>
<a href="#l55.37"></a><span id="l55.37">             let re = new RegExp(&quot;/calendar/(feeds|ical)/&quot; +</span>
<a href="#l55.38"></a><span id="l55.38">                                 &quot;([^/]+)/(public|private|free-busy)-?([^/]+)?/&quot; +</span>
<a href="#l55.39"></a><span id="l55.39">                                 &quot;(full|basic)(.ics)?$&quot;);</span>
<a href="#l55.40"></a><span id="l55.40"> </span>
<a href="#l55.41"></a><span id="l55.41">             let matches = aUri.pathQueryRef.match(re);</span>
<a href="#l55.42"></a><span id="l55.42">             if (matches) {</span>
<a href="#l55.43"></a><span id="l55.43">                 this.mCalendarName = decodeURIComponent(matches[2]);</span>
<a href="#l55.44"></a><span id="l55.44"> </span>
<a href="#l55.45"></a><span id="l55.45" class="difflineminus">-                let googleUser = Preferences.get(&quot;calendar.google.calPrefs.&quot; + this.mCalendarName + &quot;.googleUser&quot;);</span>
<a href="#l55.46"></a><span id="l55.46" class="difflineplus">+                let googleUser = Services.prefs.getStringPref(&quot;calendar.google.calPrefs.&quot; + this.mCalendarName + &quot;.googleUser&quot;, null);</span>
<a href="#l55.47"></a><span id="l55.47">                 let newUri = &quot;googleapi://&quot; + (googleUser || this.mCalendarName) + &quot;/?calendar=&quot; + matches[2];</span>
<a href="#l55.48"></a><span id="l55.48"> </span>
<a href="#l55.49"></a><span id="l55.49">                 // Use the default task list, but only if this is the primary account.</span>
<a href="#l55.50"></a><span id="l55.50">                 if (googleUser &amp;&amp; googleUser == this.mCalendarName) {</span>
<a href="#l55.51"></a><span id="l55.51">                     this.mTasklistName = &quot;@default&quot;;</span>
<a href="#l55.52"></a><span id="l55.52">                     newUri += &quot;&amp;tasks=%40default&quot;;</span>
<a href="#l55.53"></a><span id="l55.53">                 }</span>
<a href="#l55.54"></a><span id="l55.54"> </span>
<a href="#l55.55"></a><span id="l55.55" class="difflineat">@@ -280,17 +279,17 @@ calGoogleCalendar.prototype = {</span>
<a href="#l55.56"></a><span id="l55.56">             case &quot;capabilities.priority.supported&quot;:</span>
<a href="#l55.57"></a><span id="l55.57">                 return false;</span>
<a href="#l55.58"></a><span id="l55.58">             case &quot;capabilities.privacy.values&quot;:</span>
<a href="#l55.59"></a><span id="l55.59">                 return [&quot;DEFAULT&quot;, &quot;PUBLIC&quot;, &quot;PRIVATE&quot;];</span>
<a href="#l55.60"></a><span id="l55.60">             case &quot;capabilities.alarms.maxCount&quot;:</span>
<a href="#l55.61"></a><span id="l55.61">                 return 5;</span>
<a href="#l55.62"></a><span id="l55.62">             case &quot;capabilities.alarms.actionValues&quot;: {</span>
<a href="#l55.63"></a><span id="l55.63">                 let actionValues = [&quot;DISPLAY&quot;, &quot;EMAIL&quot;];</span>
<a href="#l55.64"></a><span id="l55.64" class="difflineminus">-                if (Preferences.get(&quot;calendar.google.enableSMSReminders&quot;, false)) {</span>
<a href="#l55.65"></a><span id="l55.65" class="difflineplus">+                if (Services.prefs.getBoolPref(&quot;calendar.google.enableSMSReminders&quot;, false)) {</span>
<a href="#l55.66"></a><span id="l55.66">                     actionValues.push(&quot;SMS&quot;);</span>
<a href="#l55.67"></a><span id="l55.67">                 }</span>
<a href="#l55.68"></a><span id="l55.68">                 return actionValues;</span>
<a href="#l55.69"></a><span id="l55.69">             }</span>
<a href="#l55.70"></a><span id="l55.70">             case &quot;capabilities.tasks.supported&quot;:</span>
<a href="#l55.71"></a><span id="l55.71">                 return !!this.mTasklistName;</span>
<a href="#l55.72"></a><span id="l55.72">             case &quot;capabilities.events.supported&quot;:</span>
<a href="#l55.73"></a><span id="l55.73">                 return !!this.mCalendarName;</span>
<a href="#l55.74"></a><span id="l55.74" class="difflineat">@@ -304,30 +303,30 @@ calGoogleCalendar.prototype = {</span>
<a href="#l55.75"></a><span id="l55.75">                 }</span>
<a href="#l55.76"></a><span id="l55.76">                 // Otherwise fall through</span>
<a href="#l55.77"></a><span id="l55.77">                 break;</span>
<a href="#l55.78"></a><span id="l55.78">             }</span>
<a href="#l55.79"></a><span id="l55.79">             case &quot;organizerId&quot;:</span>
<a href="#l55.80"></a><span id="l55.80">                 return &quot;mailto:&quot; + this.mCalendarName;</span>
<a href="#l55.81"></a><span id="l55.81">             case &quot;itip.transport&quot;:</span>
<a href="#l55.82"></a><span id="l55.82">                 if (!this.isDefaultCalendar ||</span>
<a href="#l55.83"></a><span id="l55.83" class="difflineminus">-                    !Preferences.get(&quot;calendar.google.enableEmailInvitations&quot;, false)) {</span>
<a href="#l55.84"></a><span id="l55.84" class="difflineplus">+                    !Services.prefs.getBoolPref(&quot;calendar.google.enableEmailInvitations&quot;, false)) {</span>
<a href="#l55.85"></a><span id="l55.85">                     // If we explicitly return null here, then these calendars</span>
<a href="#l55.86"></a><span id="l55.86">                     // will not be included in the list of calendars to accept</span>
<a href="#l55.87"></a><span id="l55.87">                     // invitations to and imip will effectively be disabled.</span>
<a href="#l55.88"></a><span id="l55.88">                     return null;</span>
<a href="#l55.89"></a><span id="l55.89">                 }</span>
<a href="#l55.90"></a><span id="l55.90">                 break;</span>
<a href="#l55.91"></a><span id="l55.91">             case &quot;imip.identity.disabled&quot;:</span>
<a href="#l55.92"></a><span id="l55.92">                 // Disabling this hides the picker for identities in the new</span>
<a href="#l55.93"></a><span id="l55.93">                 // calendar wizard and calendar properties dialog. This should</span>
<a href="#l55.94"></a><span id="l55.94">                 // be done for all secondary calendars as they cannot accept</span>
<a href="#l55.95"></a><span id="l55.95">                 // invitations and if email invitations are generally disabled.</span>
<a href="#l55.96"></a><span id="l55.96">                 if (!this.isDefaultCalendar ||</span>
<a href="#l55.97"></a><span id="l55.97" class="difflineminus">-                    !Preferences.get(&quot;calendar.google.enableEmailInvitations&quot;, false)) {</span>
<a href="#l55.98"></a><span id="l55.98" class="difflineplus">+                    !Services.prefs.getBoolPref(&quot;calendar.google.enableEmailInvitations&quot;, false)) {</span>
<a href="#l55.99"></a><span id="l55.99">                     return true;</span>
<a href="#l55.100"></a><span id="l55.100">                 }</span>
<a href="#l55.101"></a><span id="l55.101">                 break;</span>
<a href="#l55.102"></a><span id="l55.102">         }</span>
<a href="#l55.103"></a><span id="l55.103"> </span>
<a href="#l55.104"></a><span id="l55.104">         return this.__proto__.__proto__.getProperty.apply(this, arguments);</span>
<a href="#l55.105"></a><span id="l55.105">     },</span>
<a href="#l55.106"></a><span id="l55.106"> </span>
<a href="#l55.107"></a><span id="l55.107" class="difflineat">@@ -379,17 +378,17 @@ calGoogleCalendar.prototype = {</span>
<a href="#l55.108"></a><span id="l55.108">                 if (isImport) {</span>
<a href="#l55.109"></a><span id="l55.109">                     cal.LOG(&quot;[calGoogleCalendar] Adding invitation event &quot; + aItem.title);</span>
<a href="#l55.110"></a><span id="l55.110">                     request.uri = this.createEventsURI(&quot;events&quot;, &quot;import&quot;);</span>
<a href="#l55.111"></a><span id="l55.111">                 } else {</span>
<a href="#l55.112"></a><span id="l55.112">                     cal.LOG(&quot;[calGoogleCalendar] Adding regular event &quot; + aItem.title);</span>
<a href="#l55.113"></a><span id="l55.113">                     request.uri = this.createEventsURI(&quot;events&quot;);</span>
<a href="#l55.114"></a><span id="l55.114">                 }</span>
<a href="#l55.115"></a><span id="l55.115"> </span>
<a href="#l55.116"></a><span id="l55.116" class="difflineminus">-                if (Preferences.get(&quot;calendar.google.sendEventNotifications&quot;, false)) {</span>
<a href="#l55.117"></a><span id="l55.117" class="difflineplus">+                if (Services.prefs.getBoolPref(&quot;calendar.google.sendEventNotifications&quot;, false)) {</span>
<a href="#l55.118"></a><span id="l55.118">                     request.addQueryParameter(&quot;sendNotifications&quot;, &quot;true&quot;);</span>
<a href="#l55.119"></a><span id="l55.119">                 }</span>
<a href="#l55.120"></a><span id="l55.120">             } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l55.121"></a><span id="l55.121">                 cal.LOG(&quot;[calGoogleCalendar] Adding task &quot; + aItem.title);</span>
<a href="#l55.122"></a><span id="l55.122">                 request.uri = this.createTasksURI(&quot;tasks&quot;);</span>
<a href="#l55.123"></a><span id="l55.123">                 // Tasks sent with an id will cause a bad request</span>
<a href="#l55.124"></a><span id="l55.124">                 delete itemData.id;</span>
<a href="#l55.125"></a><span id="l55.125">             }</span>
<a href="#l55.126"></a><span id="l55.126" class="difflineat">@@ -453,17 +452,17 @@ calGoogleCalendar.prototype = {</span>
<a href="#l55.127"></a><span id="l55.127"> </span>
<a href="#l55.128"></a><span id="l55.128">                 // Updating invitations often causes a forbidden error becase</span>
<a href="#l55.129"></a><span id="l55.129">                 // some parts are not writable. Using PATCH ignores anything</span>
<a href="#l55.130"></a><span id="l55.130">                 // that isn't allowed.</span>
<a href="#l55.131"></a><span id="l55.131">                 if (cal.itip.isInvitation(aNewItem)) {</span>
<a href="#l55.132"></a><span id="l55.132">                     request.type = request.PATCH;</span>
<a href="#l55.133"></a><span id="l55.133">                 }</span>
<a href="#l55.134"></a><span id="l55.134"> </span>
<a href="#l55.135"></a><span id="l55.135" class="difflineminus">-                if (Preferences.get(&quot;calendar.google.sendEventNotifications&quot;, false)) {</span>
<a href="#l55.136"></a><span id="l55.136" class="difflineplus">+                if (Services.prefs.getBoolPref(&quot;calendar.google.sendEventNotifications&quot;, false)) {</span>
<a href="#l55.137"></a><span id="l55.137">                     request.addQueryParameter(&quot;sendNotifications&quot;, &quot;true&quot;);</span>
<a href="#l55.138"></a><span id="l55.138">                 }</span>
<a href="#l55.139"></a><span id="l55.139">             } else if (cal.item.isToDo(aNewItem)) {</span>
<a href="#l55.140"></a><span id="l55.140">                 request.uri = this.createTasksURI(&quot;tasks&quot;, aNewItem.id);</span>
<a href="#l55.141"></a><span id="l55.141">             }</span>
<a href="#l55.142"></a><span id="l55.142"> </span>
<a href="#l55.143"></a><span id="l55.143">             if (!request.uri) {</span>
<a href="#l55.144"></a><span id="l55.144">                 throw Components.Exception(&quot;Item type not supported&quot;,</span>
<a href="#l55.145"></a><span id="l55.145" class="difflineat">@@ -543,17 +542,17 @@ calGoogleCalendar.prototype = {</span>
<a href="#l55.146"></a><span id="l55.146">         cal.LOG(&quot;[calGoogleCalendar] Deleting item &quot; + aItem.title + &quot;(&quot; + aItem.id + &quot;)&quot;);</span>
<a href="#l55.147"></a><span id="l55.147"> </span>
<a href="#l55.148"></a><span id="l55.148">         let request = new calGoogleRequest();</span>
<a href="#l55.149"></a><span id="l55.149">         (async () =&gt; {</span>
<a href="#l55.150"></a><span id="l55.150">             request.type = request.DELETE;</span>
<a href="#l55.151"></a><span id="l55.151">             request.calendar = this;</span>
<a href="#l55.152"></a><span id="l55.152">             if (cal.item.isEvent(aItem)) {</span>
<a href="#l55.153"></a><span id="l55.153">                 request.uri = this.createEventsURI(&quot;events&quot;, getGoogleId(aItem, this.offlineStorage));</span>
<a href="#l55.154"></a><span id="l55.154" class="difflineminus">-                if (Preferences.get(&quot;calendar.google.sendEventNotifications&quot;, false)) {</span>
<a href="#l55.155"></a><span id="l55.155" class="difflineplus">+                if (Services.prefs.getBoolPref(&quot;calendar.google.sendEventNotifications&quot;, false)) {</span>
<a href="#l55.156"></a><span id="l55.156">                     request.addQueryParameter(&quot;sendNotifications&quot;, &quot;true&quot;);</span>
<a href="#l55.157"></a><span id="l55.157">                 }</span>
<a href="#l55.158"></a><span id="l55.158">             } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l55.159"></a><span id="l55.159">                 request.uri = this.createTasksURI(&quot;tasks&quot;, aItem.id);</span>
<a href="#l55.160"></a><span id="l55.160">             }</span>
<a href="#l55.161"></a><span id="l55.161"> </span>
<a href="#l55.162"></a><span id="l55.162">             if (!request.uri) {</span>
<a href="#l55.163"></a><span id="l55.163">                 throw Components.Exception(&quot;Item type not supported&quot;,</span>
<a href="#l55.164"></a><span id="l55.164" class="difflineat">@@ -684,26 +683,26 @@ calGoogleCalendar.prototype = {</span>
<a href="#l55.165"></a><span id="l55.165">             this.mOfflineStorage.QueryInterface(Ci.calICalendarProvider)</span>
<a href="#l55.166"></a><span id="l55.166">                                 .deleteCalendar(this.mOfflineStorage, listener);</span>
<a href="#l55.167"></a><span id="l55.167">         });</span>
<a href="#l55.168"></a><span id="l55.168">     },</span>
<a href="#l55.169"></a><span id="l55.169"> </span>
<a href="#l55.170"></a><span id="l55.170">     replayChangesOn: function(aListener) {</span>
<a href="#l55.171"></a><span id="l55.171">         // Figure out if the user is idle, no need to synchronize if so.</span>
<a href="#l55.172"></a><span id="l55.172">         let idleTime = Cc[&quot;@mozilla.org/widget/idleservice;1&quot;].getService(Ci.nsIIdleService).idleTime;</span>
<a href="#l55.173"></a><span id="l55.173" class="difflineminus">-        let maxIdleTime = Preferences.get(&quot;calendar.google.idleTime&quot;, 300) * 1000;</span>
<a href="#l55.174"></a><span id="l55.174" class="difflineplus">+        let maxIdleTime = Services.prefs.getIntPref(&quot;calendar.google.idleTime&quot;, 300) * 1000;</span>
<a href="#l55.175"></a><span id="l55.175"> </span>
<a href="#l55.176"></a><span id="l55.176">         if (maxIdleTime != 0 &amp;&amp; idleTime &gt; maxIdleTime) {</span>
<a href="#l55.177"></a><span id="l55.177">             cal.LOG(&quot;[calGoogleCalendar] Skipping refresh since user is idle&quot;);</span>
<a href="#l55.178"></a><span id="l55.178">             aListener.onResult({ status: Cr.NS_OK }, null);</span>
<a href="#l55.179"></a><span id="l55.179">             return Promise.resolve();</span>
<a href="#l55.180"></a><span id="l55.180">         }</span>
<a href="#l55.181"></a><span id="l55.181"> </span>
<a href="#l55.182"></a><span id="l55.182">         // Now that we've determined we are not idle we can continue with the sync.</span>
<a href="#l55.183"></a><span id="l55.183" class="difflineminus">-        let maxResults = Preferences.get(&quot;calendar.google.maxResultsPerRequest&quot;, null);</span>
<a href="#l55.184"></a><span id="l55.184" class="difflineplus">+        let maxResults = Services.prefs.getIntPref(&quot;calendar.google.maxResultsPerRequest&quot;, null);</span>
<a href="#l55.185"></a><span id="l55.185"> </span>
<a href="#l55.186"></a><span id="l55.186">         // We are going to be making potentially lots of changes to the offline</span>
<a href="#l55.187"></a><span id="l55.187">         // storage, start a batch operation.</span>
<a href="#l55.188"></a><span id="l55.188">         this.mOfflineStorage.startBatch();</span>
<a href="#l55.189"></a><span id="l55.189"> </span>
<a href="#l55.190"></a><span id="l55.190">         // Update the calendar settings</span>
<a href="#l55.191"></a><span id="l55.191">         let calendarPromise = Promise.resolve();</span>
<a href="#l55.192"></a><span id="l55.192">         if (this.mCalendarName &amp;&amp; this.checkThrottle(&quot;calendarList&quot;)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/calendar/providers/gdata/content/gdata-event-dialog-reminder.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/calendar/providers/gdata/content/gdata-event-dialog-reminder.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -61,17 +61,17 @@</span>
<a href="#l56.4"></a><span id="l56.4">         document.getElementById(&quot;reminder-after-end-menuitem&quot;).hidden = true;</span>
<a href="#l56.5"></a><span id="l56.5">     }</span>
<a href="#l56.6"></a><span id="l56.6"> </span>
<a href="#l56.7"></a><span id="l56.7">     /**</span>
<a href="#l56.8"></a><span id="l56.8">      * SMS Reminders are only supported for Google Apps for Work, Education,</span>
<a href="#l56.9"></a><span id="l56.9">      * and Government. hide the menuitem if SMS reminders are not supported</span>
<a href="#l56.10"></a><span id="l56.10">      */</span>
<a href="#l56.11"></a><span id="l56.11">     function hideSMSReminders() {</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-        if (!Preferences.get(&quot;calendar.google.enableSMSReminders&quot;, false)) {</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+        if (!Services.prefs.getBoolPref(&quot;calendar.google.enableSMSReminders&quot;, false)) {</span>
<a href="#l56.14"></a><span id="l56.14">             document.getElementById(&quot;reminder-action-SMS&quot;).hidden = true;</span>
<a href="#l56.15"></a><span id="l56.15">         }</span>
<a href="#l56.16"></a><span id="l56.16">     }</span>
<a href="#l56.17"></a><span id="l56.17"> </span>
<a href="#l56.18"></a><span id="l56.18">     monkeyPatch(window, &quot;updateReminder&quot;, function(protofunc, event) {</span>
<a href="#l56.19"></a><span id="l56.19">         let rv = protofunc.apply(this, Array.from(arguments).slice(1));</span>
<a href="#l56.20"></a><span id="l56.20">         if (event.explicitOriginalTarget.localName == &quot;listitem&quot; ||</span>
<a href="#l56.21"></a><span id="l56.21">             event.explicitOriginalTarget.id == &quot;reminder-remove-button&quot; ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/calendar/providers/gdata/content/gdata-migration.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/calendar/providers/gdata/content/gdata-migration.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l57.4"></a><span id="l57.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l57.5"></a><span id="l57.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l57.6"></a><span id="l57.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l57.7"></a><span id="l57.7"> </span>
<a href="#l57.8"></a><span id="l57.8"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l57.9"></a><span id="l57.9" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l57.10"></a><span id="l57.10" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l57.11"></a><span id="l57.11"> </span>
<a href="#l57.12"></a><span id="l57.12"> /* exported migrateSelectedCalendars */</span>
<a href="#l57.13"></a><span id="l57.13"> </span>
<a href="#l57.14"></a><span id="l57.14"> /**</span>
<a href="#l57.15"></a><span id="l57.15">  * Migrate the calendar selected in the wizard from ics to gdata.</span>
<a href="#l57.16"></a><span id="l57.16">  */</span>
<a href="#l57.17"></a><span id="l57.17"> function migrateSelectedCalendars() {</span>
<a href="#l57.18"></a><span id="l57.18">     let listbox = document.getElementById(&quot;calendars-listbox&quot;);</span>
<a href="#l57.19"></a><span id="l57.19" class="difflineat">@@ -36,18 +36,18 @@ function migrateSelectedCalendars() {</span>
<a href="#l57.20"></a><span id="l57.20">             newCal.setProperty(&quot;calendar-main-default&quot;,</span>
<a href="#l57.21"></a><span id="l57.21">                                item.calendar.getProperty(&quot;calendar-main-default&quot;));</span>
<a href="#l57.22"></a><span id="l57.22"> </span>
<a href="#l57.23"></a><span id="l57.23">             calmgr.registerCalendar(newCal);</span>
<a href="#l57.24"></a><span id="l57.24">         }</span>
<a href="#l57.25"></a><span id="l57.25">     }</span>
<a href="#l57.26"></a><span id="l57.26"> </span>
<a href="#l57.27"></a><span id="l57.27">     // Only bring up the dialog on the next startup if the user wants us to.</span>
<a href="#l57.28"></a><span id="l57.28" class="difflineminus">-    Preferences.set(&quot;calendar.google.migrate&quot;,</span>
<a href="#l57.29"></a><span id="l57.29" class="difflineminus">-                    document.getElementById(&quot;showagain-checkbox&quot;).checked);</span>
<a href="#l57.30"></a><span id="l57.30" class="difflineplus">+    Services.prefs.setBoolPref(&quot;calendar.google.migrate&quot;,</span>
<a href="#l57.31"></a><span id="l57.31" class="difflineplus">+                               document.getElementById(&quot;showagain-checkbox&quot;).checked);</span>
<a href="#l57.32"></a><span id="l57.32"> }</span>
<a href="#l57.33"></a><span id="l57.33"> </span>
<a href="#l57.34"></a><span id="l57.34"> /**</span>
<a href="#l57.35"></a><span id="l57.35">  * Get all calendars that are ics and point to a google calendar</span>
<a href="#l57.36"></a><span id="l57.36">  *</span>
<a href="#l57.37"></a><span id="l57.37">  * @return An array of calendars that are migratable</span>
<a href="#l57.38"></a><span id="l57.38">  */</span>
<a href="#l57.39"></a><span id="l57.39"> function getMigratableCalendars() {</span>
<a href="#l57.40"></a><span id="l57.40" class="difflineat">@@ -75,18 +75,18 @@ function gdata_migration_loader() {</span>
<a href="#l57.41"></a><span id="l57.41">             item.setAttribute(&quot;label&quot;, calendar.name);</span>
<a href="#l57.42"></a><span id="l57.42">             item.setAttribute(&quot;value&quot;, calendar.id);</span>
<a href="#l57.43"></a><span id="l57.43">             item.calendar = calendar;</span>
<a href="#l57.44"></a><span id="l57.44">             listbox.appendChild(item);</span>
<a href="#l57.45"></a><span id="l57.45">         }</span>
<a href="#l57.46"></a><span id="l57.46"> </span>
<a href="#l57.47"></a><span id="l57.47">         // Set up the &quot;always check&quot; field</span>
<a href="#l57.48"></a><span id="l57.48">         document.getElementById(&quot;showagain-checkbox&quot;).checked =</span>
<a href="#l57.49"></a><span id="l57.49" class="difflineminus">-            Preferences.get(&quot;calendar.google.migrate&quot;, true);</span>
<a href="#l57.50"></a><span id="l57.50" class="difflineminus">-    } else if (Preferences.get(&quot;calendar.google.migrate&quot;, true) &amp;&amp;</span>
<a href="#l57.51"></a><span id="l57.51" class="difflineplus">+            Services.prefs.getBoolPref(&quot;calendar.google.migrate&quot;, true);</span>
<a href="#l57.52"></a><span id="l57.52" class="difflineplus">+    } else if (Services.prefs.getBoolPref(&quot;calendar.google.migrate&quot;, true) &amp;&amp;</span>
<a href="#l57.53"></a><span id="l57.53">                getMigratableCalendars().length &gt; 0) {</span>
<a href="#l57.54"></a><span id="l57.54">         // This is not the migration wizard, so it must be a main window. Check</span>
<a href="#l57.55"></a><span id="l57.55">         // if the migration wizard needs to be shown and calendars are worth</span>
<a href="#l57.56"></a><span id="l57.56">         // migrating.</span>
<a href="#l57.57"></a><span id="l57.57"> </span>
<a href="#l57.58"></a><span id="l57.58">         // Do this after load, so the calendar window appears before the</span>
<a href="#l57.59"></a><span id="l57.59">         // wizard is opened.</span>
<a href="#l57.60"></a><span id="l57.60">         // XXX Waiting a second gives the views enough time to display</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/calendar/providers/gdata/modules/gdataLogging.jsm</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/calendar/providers/gdata/modules/gdataLogging.jsm</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -6,20 +6,20 @@ var EXPORTED_SYMBOLS = [&quot;LOGitem&quot;, &quot;LOGv</span>
<a href="#l58.4"></a><span id="l58.4"> </span>
<a href="#l58.5"></a><span id="l58.5"> // Backwards compatibility with Thunderbird &lt;60.</span>
<a href="#l58.6"></a><span id="l58.6"> if (!(&quot;Cc&quot; in this)) {</span>
<a href="#l58.7"></a><span id="l58.7">     // eslint-disable-next-line mozilla/no-define-cc-etc, no-unused-vars</span>
<a href="#l58.8"></a><span id="l58.8">     const { interfaces: Ci } = Components;</span>
<a href="#l58.9"></a><span id="l58.9"> }</span>
<a href="#l58.10"></a><span id="l58.10"> </span>
<a href="#l58.11"></a><span id="l58.11"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l58.14"></a><span id="l58.14"> </span>
<a href="#l58.15"></a><span id="l58.15"> function LOGverbose(aStr) {</span>
<a href="#l58.16"></a><span id="l58.16" class="difflineminus">-    if (Preferences.get(&quot;calendar.debug.log.verbose&quot;, false)) {</span>
<a href="#l58.17"></a><span id="l58.17" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;calendar.debug.log.verbose&quot;, false)) {</span>
<a href="#l58.18"></a><span id="l58.18">         cal.LOG(aStr);</span>
<a href="#l58.19"></a><span id="l58.19">     }</span>
<a href="#l58.20"></a><span id="l58.20"> }</span>
<a href="#l58.21"></a><span id="l58.21"> </span>
<a href="#l58.22"></a><span id="l58.22"> function stringException(e) {</span>
<a href="#l58.23"></a><span id="l58.23">     if (&quot;fileName&quot; in e &amp;&amp; &quot;lineNumber&quot; in e) {</span>
<a href="#l58.24"></a><span id="l58.24">         return &quot; (&quot; + e.fileName + &quot;:&quot; + e.lineNumber + &quot;):&quot; + e;</span>
<a href="#l58.25"></a><span id="l58.25">     } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/calendar/providers/gdata/modules/gdataRequest.jsm</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/calendar/providers/gdata/modules/gdataRequest.jsm</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -5,17 +5,16 @@</span>
<a href="#l59.4"></a><span id="l59.4"> // Backwards compatibility with Thunderbird &lt;60.</span>
<a href="#l59.5"></a><span id="l59.5"> if (!(&quot;Cc&quot; in this)) {</span>
<a href="#l59.6"></a><span id="l59.6">     // eslint-disable-next-line mozilla/no-define-cc-etc, no-unused-vars</span>
<a href="#l59.7"></a><span id="l59.7">     const { classes: Cc, interfaces: Ci, results: Cr } = Components;</span>
<a href="#l59.8"></a><span id="l59.8"> }</span>
<a href="#l59.9"></a><span id="l59.9"> </span>
<a href="#l59.10"></a><span id="l59.10"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l59.11"></a><span id="l59.11"> var { PromiseUtils } = ChromeUtils.import(&quot;resource://gre/modules/PromiseUtils.jsm&quot;);</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l59.13"></a><span id="l59.13"> </span>
<a href="#l59.14"></a><span id="l59.14"> var { cal } = ChromeUtils.import(&quot;resource://gdata-provider/modules/calUtilsShim.jsm&quot;);</span>
<a href="#l59.15"></a><span id="l59.15"> </span>
<a href="#l59.16"></a><span id="l59.16"> var API_BASE = {</span>
<a href="#l59.17"></a><span id="l59.17">     EVENTS: &quot;https://www.googleapis.com/calendar/v3/&quot;,</span>
<a href="#l59.18"></a><span id="l59.18">     TASKS: &quot;https://www.googleapis.com/tasks/v1/&quot;</span>
<a href="#l59.19"></a><span id="l59.19"> };</span>
<a href="#l59.20"></a><span id="l59.20"> </span>
<a href="#l59.21"></a><span id="l59.21" class="difflineat">@@ -285,17 +284,17 @@ calGoogleRequest.prototype = {</span>
<a href="#l59.22"></a><span id="l59.22">             cal.LOG(&quot;[calGoogleCalendar] Setting Upload Data (&quot; +</span>
<a href="#l59.23"></a><span id="l59.23">                     this.mUploadContent + &quot;):\n&quot; + this.mUploadData);</span>
<a href="#l59.24"></a><span id="l59.24">         }</span>
<a href="#l59.25"></a><span id="l59.25"> </span>
<a href="#l59.26"></a><span id="l59.26">         aChannel = aChannel.QueryInterface(Ci.nsIHttpChannel);</span>
<a href="#l59.27"></a><span id="l59.27"> </span>
<a href="#l59.28"></a><span id="l59.28">         // Depending on the preference, we will use X-HTTP-Method-Override to</span>
<a href="#l59.29"></a><span id="l59.29">         // get around some proxies. This will default to true.</span>
<a href="#l59.30"></a><span id="l59.30" class="difflineminus">-        if (Preferences.get(&quot;calendar.google.useHTTPMethodOverride&quot;, true) &amp;&amp;</span>
<a href="#l59.31"></a><span id="l59.31" class="difflineplus">+        if (Services.prefs.getBoolPref(&quot;calendar.google.useHTTPMethodOverride&quot;, true) &amp;&amp;</span>
<a href="#l59.32"></a><span id="l59.32">             (this.method == &quot;PUT&quot; || this.method == &quot;DELETE&quot;)) {</span>
<a href="#l59.33"></a><span id="l59.33">             aChannel.requestMethod = &quot;POST&quot;;</span>
<a href="#l59.34"></a><span id="l59.34">             aChannel.setRequestHeader(&quot;X-HTTP-Method-Override&quot;,</span>
<a href="#l59.35"></a><span id="l59.35">                                       this.method,</span>
<a href="#l59.36"></a><span id="l59.36">                                       false);</span>
<a href="#l59.37"></a><span id="l59.37">             if (this.method == &quot;DELETE&quot;) {</span>
<a href="#l59.38"></a><span id="l59.38">                 // DELETE has no body, set an empty one so that Google accepts</span>
<a href="#l59.39"></a><span id="l59.39">                 // the request.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/calendar/providers/gdata/modules/gdataSession.jsm</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/calendar/providers/gdata/modules/gdataSession.jsm</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -11,17 +11,16 @@ if (!(&quot;Cc&quot; in this)) {</span>
<a href="#l60.4"></a><span id="l60.4"> var { OAuth2 } = ChromeUtils.import(&quot;resource://gdata-provider/modules/OAuth2.jsm&quot;);</span>
<a href="#l60.5"></a><span id="l60.5"> var { getProviderString } = ChromeUtils.import(&quot;resource://gdata-provider/modules/gdataUtils.jsm&quot;);</span>
<a href="#l60.6"></a><span id="l60.6"> var { LOGinterval } = ChromeUtils.import(&quot;resource://gdata-provider/modules/gdataLogging.jsm&quot;);</span>
<a href="#l60.7"></a><span id="l60.7"> var {</span>
<a href="#l60.8"></a><span id="l60.8">     calGoogleRequest,</span>
<a href="#l60.9"></a><span id="l60.9">     API_BASE</span>
<a href="#l60.10"></a><span id="l60.10"> } = ChromeUtils.import(&quot;resource://gdata-provider/modules/gdataRequest.jsm&quot;);</span>
<a href="#l60.11"></a><span id="l60.11"> </span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l60.13"></a><span id="l60.13"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l60.14"></a><span id="l60.14"> var { PromiseUtils } = ChromeUtils.import(&quot;resource://gre/modules/PromiseUtils.jsm&quot;);</span>
<a href="#l60.15"></a><span id="l60.15"> var { setTimeout } = ChromeUtils.import(&quot;resource://gre/modules/Timer.jsm&quot;);</span>
<a href="#l60.16"></a><span id="l60.16"> </span>
<a href="#l60.17"></a><span id="l60.17"> var { fixIterator } = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l60.18"></a><span id="l60.18"> </span>
<a href="#l60.19"></a><span id="l60.19"> var { cal } = ChromeUtils.import(&quot;resource://gdata-provider/modules/calUtilsShim.jsm&quot;);</span>
<a href="#l60.20"></a><span id="l60.20"> </span>
<a href="#l60.21"></a><span id="l60.21" class="difflineat">@@ -59,17 +58,17 @@ var calGoogleSessionManager = {</span>
<a href="#l60.22"></a><span id="l60.22">             return null;</span>
<a href="#l60.23"></a><span id="l60.23">         }</span>
<a href="#l60.24"></a><span id="l60.24"> </span>
<a href="#l60.25"></a><span id="l60.25">         if (uri.schemeIs(&quot;googleapi&quot;)) {</span>
<a href="#l60.26"></a><span id="l60.26">             let parts = uri.pathQueryRef.substr(2).split(&quot;/&quot;, 2);</span>
<a href="#l60.27"></a><span id="l60.27">             id = parts[0] || cal.getUUID();</span>
<a href="#l60.28"></a><span id="l60.28">         } else if (host == &quot;www.google.com&quot; &amp;&amp; uri.pathQueryRef.startsWith(&quot;/calendar/feeds&quot;) &amp;&amp; protocols.some(scheme =&gt; uri.schemeIs(scheme))) {</span>
<a href="#l60.29"></a><span id="l60.29">             let googleCalendarName = aCalendar.getProperty(&quot;googleCalendarName&quot;);</span>
<a href="#l60.30"></a><span id="l60.30" class="difflineminus">-            let googleUser = Preferences.get(&quot;calendar.google.calPrefs.&quot; + googleCalendarName + &quot;.googleUser&quot;);</span>
<a href="#l60.31"></a><span id="l60.31" class="difflineplus">+            let googleUser = Services.prefs.getStringPref(&quot;calendar.google.calPrefs.&quot; + googleCalendarName + &quot;.googleUser&quot;, null);</span>
<a href="#l60.32"></a><span id="l60.32">             id = googleUser || googleCalendarName || cal.getUUID();</span>
<a href="#l60.33"></a><span id="l60.33">         }</span>
<a href="#l60.34"></a><span id="l60.34"> </span>
<a href="#l60.35"></a><span id="l60.35">         return id ? this.getSessionById(id, aCreate) : null;</span>
<a href="#l60.36"></a><span id="l60.36">     },</span>
<a href="#l60.37"></a><span id="l60.37"> </span>
<a href="#l60.38"></a><span id="l60.38">     getSessionById: function(aSessionId, aCreate) {</span>
<a href="#l60.39"></a><span id="l60.39">         // Check if the session exists</span>
<a href="#l60.40"></a><span id="l60.40" class="difflineat">@@ -193,17 +192,17 @@ calGoogleSession.prototype = {</span>
<a href="#l60.41"></a><span id="l60.41">                 return (this.mRefreshToken = val);</span>
<a href="#l60.42"></a><span id="l60.42">             },</span>
<a href="#l60.43"></a><span id="l60.43">             enumerable: true</span>
<a href="#l60.44"></a><span id="l60.44">         });</span>
<a href="#l60.45"></a><span id="l60.45"> </span>
<a href="#l60.46"></a><span id="l60.46">         // If the user has disabled cookies, we need to add an exception for</span>
<a href="#l60.47"></a><span id="l60.47">         // Google so authentication works. If the user has explicitly blocked</span>
<a href="#l60.48"></a><span id="l60.48">         // google.com then we won't overwrite the rule though.</span>
<a href="#l60.49"></a><span id="l60.49" class="difflineminus">-        if (Preferences.get(&quot;network.cookie.cookieBehavior&quot;) == 2) {</span>
<a href="#l60.50"></a><span id="l60.50" class="difflineplus">+        if (Services.prefs.getIntPref(&quot;network.cookie.cookieBehavior&quot;) == 2) {</span>
<a href="#l60.51"></a><span id="l60.51">             let found = null;</span>
<a href="#l60.52"></a><span id="l60.52">             for (let perm of fixIterator(Services.perms.enumerator, Ci.nsIPermission)) {</span>
<a href="#l60.53"></a><span id="l60.53">                 if (perm.type == &quot;cookie&quot; &amp;&amp; perm.host == &quot;google.com&quot;) {</span>
<a href="#l60.54"></a><span id="l60.54">                     found = perm;</span>
<a href="#l60.55"></a><span id="l60.55">                     break;</span>
<a href="#l60.56"></a><span id="l60.56">                 }</span>
<a href="#l60.57"></a><span id="l60.57">             }</span>
<a href="#l60.58"></a><span id="l60.58"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/calendar/providers/gdata/modules/gdataUtils.jsm</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/calendar/providers/gdata/modules/gdataUtils.jsm</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -12,17 +12,16 @@ var {</span>
<a href="#l61.4"></a><span id="l61.4">     LOGitem,</span>
<a href="#l61.5"></a><span id="l61.5">     LOGverbose,</span>
<a href="#l61.6"></a><span id="l61.6">     stringException</span>
<a href="#l61.7"></a><span id="l61.7"> } = ChromeUtils.import(&quot;resource://gdata-provider/modules/gdataLogging.jsm&quot;);</span>
<a href="#l61.8"></a><span id="l61.8"> var { calGoogleRequest } = ChromeUtils.import(&quot;resource://gdata-provider/modules/gdataRequest.jsm&quot;);</span>
<a href="#l61.9"></a><span id="l61.9"> var { windowsTimezoneMap } = ChromeUtils.import(&quot;resource://gdata-provider/modules/timezoneMap.jsm&quot;);</span>
<a href="#l61.10"></a><span id="l61.10"> </span>
<a href="#l61.11"></a><span id="l61.11"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l61.13"></a><span id="l61.13"> var { PromiseUtils } = ChromeUtils.import(&quot;resource://gre/modules/PromiseUtils.jsm&quot;);</span>
<a href="#l61.14"></a><span id="l61.14"> </span>
<a href="#l61.15"></a><span id="l61.15"> var { cal } = ChromeUtils.import(&quot;resource://gdata-provider/modules/calUtilsShim.jsm&quot;);</span>
<a href="#l61.16"></a><span id="l61.16"> </span>
<a href="#l61.17"></a><span id="l61.17"> var FOUR_WEEKS_IN_MINUTES = 40320;</span>
<a href="#l61.18"></a><span id="l61.18"> </span>
<a href="#l61.19"></a><span id="l61.19"> var EXPORTED_SYMBOLS = [</span>
<a href="#l61.20"></a><span id="l61.20">     &quot;ItemToJSON&quot;, &quot;JSONToItem&quot;, &quot;ItemSaver&quot;,</span>
<a href="#l61.21"></a><span id="l61.21" class="difflineat">@@ -340,17 +339,17 @@ function EventToJSON(aItem, aOfflineStor</span>
<a href="#l61.22"></a><span id="l61.22">     setIf(itemData, &quot;status&quot;, status);</span>
<a href="#l61.23"></a><span id="l61.23"> </span>
<a href="#l61.24"></a><span id="l61.24">     // Google does not support categories natively, but allows us to store data</span>
<a href="#l61.25"></a><span id="l61.25">     // as an &quot;extendedProperty&quot;, so we do here</span>
<a href="#l61.26"></a><span id="l61.26">     let categories = cal.category.arrayToString(aItem.getCategories({}));</span>
<a href="#l61.27"></a><span id="l61.27">     addExtendedProperty(&quot;X-MOZ-CATEGORIES&quot;, categories);</span>
<a href="#l61.28"></a><span id="l61.28"> </span>
<a href="#l61.29"></a><span id="l61.29">     // Only parse attendees if they are enabled, due to bug 407961</span>
<a href="#l61.30"></a><span id="l61.30" class="difflineminus">-    if (Preferences.get(&quot;calendar.google.enableAttendees&quot;, false)) {</span>
<a href="#l61.31"></a><span id="l61.31" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;calendar.google.enableAttendees&quot;, false)) {</span>
<a href="#l61.32"></a><span id="l61.32">         let createAttendee = function(attendee) {</span>
<a href="#l61.33"></a><span id="l61.33">             const statusMap = {</span>
<a href="#l61.34"></a><span id="l61.34">                 &quot;NEEDS-ACTION&quot;: &quot;needsAction&quot;,</span>
<a href="#l61.35"></a><span id="l61.35">                 &quot;DECLINED&quot;: &quot;declined&quot;,</span>
<a href="#l61.36"></a><span id="l61.36">                 &quot;TENTATIVE&quot;: &quot;tentative&quot;,</span>
<a href="#l61.37"></a><span id="l61.37">                 &quot;ACCEPTED&quot;: &quot;accepted&quot;</span>
<a href="#l61.38"></a><span id="l61.38">             };</span>
<a href="#l61.39"></a><span id="l61.39"> </span>
<a href="#l61.40"></a><span id="l61.40" class="difflineat">@@ -1352,17 +1351,17 @@ function monkeyPatch(obj, x, func) {</span>
<a href="#l61.41"></a><span id="l61.41">     };</span>
<a href="#l61.42"></a><span id="l61.42"> }</span>
<a href="#l61.43"></a><span id="l61.43"> </span>
<a href="#l61.44"></a><span id="l61.44"> /**</span>
<a href="#l61.45"></a><span id="l61.45">  * Returns a promise that resolves after pending events have been processed.</span>
<a href="#l61.46"></a><span id="l61.46">  */</span>
<a href="#l61.47"></a><span id="l61.47"> function spinEventLoop() {</span>
<a href="#l61.48"></a><span id="l61.48">     let diff = new Date() - spinEventLoop.lastSpin;</span>
<a href="#l61.49"></a><span id="l61.49" class="difflineminus">-    if (diff &lt; Preferences.get(&quot;calendar.threading.latency&quot;, 250)) {</span>
<a href="#l61.50"></a><span id="l61.50" class="difflineplus">+    if (diff &lt; Services.prefs.getIntPref(&quot;calendar.threading.latency&quot;, 250)) {</span>
<a href="#l61.51"></a><span id="l61.51">         return Promise.resolve(false);</span>
<a href="#l61.52"></a><span id="l61.52">     }</span>
<a href="#l61.53"></a><span id="l61.53">     spinEventLoop.lastSpin = new Date();</span>
<a href="#l61.54"></a><span id="l61.54"> </span>
<a href="#l61.55"></a><span id="l61.55">     let deferred = PromiseUtils.defer();</span>
<a href="#l61.56"></a><span id="l61.56">     Services.tm.currentThread.dispatch({ run: function() { return deferred.resolve(true); } }, 0);</span>
<a href="#l61.57"></a><span id="l61.57">     return deferred.promise;</span>
<a href="#l61.58"></a><span id="l61.58"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l62.4"></a><span id="l62.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l62.5"></a><span id="l62.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l62.6"></a><span id="l62.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l62.7"></a><span id="l62.7"> </span>
<a href="#l62.8"></a><span id="l62.8"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l62.9"></a><span id="l62.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l62.10"></a><span id="l62.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l62.11"></a><span id="l62.11"> </span>
<a href="#l62.12"></a><span id="l62.12"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l62.13"></a><span id="l62.13"> </span>
<a href="#l62.14"></a><span id="l62.14"> //</span>
<a href="#l62.15"></a><span id="l62.15"> // calICSCalendar.js</span>
<a href="#l62.16"></a><span id="l62.16"> //</span>
<a href="#l62.17"></a><span id="l62.17"> // This is a non-sync ics file. It reads the file pointer to by uri when set,</span>
<a href="#l62.18"></a><span id="l62.18"> // then writes it on updates. External changes to the file will be</span>
<a href="#l62.19"></a><span id="l62.19" class="difflineat">@@ -702,18 +701,18 @@ calICSCalendar.prototype = {</span>
<a href="#l62.20"></a><span id="l62.20">                 oldFile.copyTo(newParentDir, newName);</span>
<a href="#l62.21"></a><span id="l62.21">             } catch (e) {</span>
<a href="#l62.22"></a><span id="l62.22">                 cal.ERROR(&quot;[calICSCalendar] Backup failed, no copy: &quot; + e);</span>
<a href="#l62.23"></a><span id="l62.23">                 // Error in making a daily/initial backup.</span>
<a href="#l62.24"></a><span id="l62.24">                 // not fatal, so just continue</span>
<a href="#l62.25"></a><span id="l62.25">             }</span>
<a href="#l62.26"></a><span id="l62.26">         }</span>
<a href="#l62.27"></a><span id="l62.27"> </span>
<a href="#l62.28"></a><span id="l62.28" class="difflineminus">-        let backupDays = Preferences.get(&quot;calendar.backup.days&quot;, 1);</span>
<a href="#l62.29"></a><span id="l62.29" class="difflineminus">-        let numBackupFiles = Preferences.get(&quot;calendar.backup.filenum&quot;, 3);</span>
<a href="#l62.30"></a><span id="l62.30" class="difflineplus">+        let backupDays = Services.prefs.getIntPref(&quot;calendar.backup.days&quot;, 1);</span>
<a href="#l62.31"></a><span id="l62.31" class="difflineplus">+        let numBackupFiles = Services.prefs.getIntPref(&quot;calendar.backup.filenum&quot;, 3);</span>
<a href="#l62.32"></a><span id="l62.32"> </span>
<a href="#l62.33"></a><span id="l62.33">         let backupDir;</span>
<a href="#l62.34"></a><span id="l62.34">         try {</span>
<a href="#l62.35"></a><span id="l62.35">             backupDir = cal.provider.getCalendarDirectory();</span>
<a href="#l62.36"></a><span id="l62.36">             backupDir.append(&quot;backup&quot;);</span>
<a href="#l62.37"></a><span id="l62.37">             if (!backupDir.exists()) {</span>
<a href="#l62.38"></a><span id="l62.38">                 backupDir.create(Ci.nsIFile.DIRECTORY_TYPE, parseInt(&quot;0755&quot;, 8));</span>
<a href="#l62.39"></a><span id="l62.39">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarModule.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarModule.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -7,17 +7,16 @@</span>
<a href="#l63.4"></a><span id="l63.4">  *          calIOperationListener, calIFreeBusyProvider, calIFreeBusyInterval,</span>
<a href="#l63.5"></a><span id="l63.5">  *          calICalendarSearchProvider, calIErrors, g_privateItemTitle,</span>
<a href="#l63.6"></a><span id="l63.6">  *          g_confidentialItemTitle, g_busyItemTitle,</span>
<a href="#l63.7"></a><span id="l63.7">  *          g_busyPhantomItemUuidPrefix, CACHE_LAST_RESULTS,</span>
<a href="#l63.8"></a><span id="l63.8">  *          CACHE_LAST_RESULTS_INVALIDATE, LOG_LEVEL</span>
<a href="#l63.9"></a><span id="l63.9">  */</span>
<a href="#l63.10"></a><span id="l63.10"> </span>
<a href="#l63.11"></a><span id="l63.11"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l63.13"></a><span id="l63.13"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l63.14"></a><span id="l63.14"> </span>
<a href="#l63.15"></a><span id="l63.15"> //</span>
<a href="#l63.16"></a><span id="l63.16"> // init code for globals, prefs:</span>
<a href="#l63.17"></a><span id="l63.17"> //</span>
<a href="#l63.18"></a><span id="l63.18"> </span>
<a href="#l63.19"></a><span id="l63.19"> // constants:</span>
<a href="#l63.20"></a><span id="l63.20"> var NS_OK = Cr.NS_OK;</span>
<a href="#l63.21"></a><span id="l63.21" class="difflineat">@@ -55,18 +54,18 @@ function initWcapProvider() {</span>
<a href="#l63.22"></a><span id="l63.22">         initLogging();</span>
<a href="#l63.23"></a><span id="l63.23"> </span>
<a href="#l63.24"></a><span id="l63.24">         // some string resources:</span>
<a href="#l63.25"></a><span id="l63.25">         g_privateItemTitle = getWcapString(&quot;privateItem.title.text&quot;);</span>
<a href="#l63.26"></a><span id="l63.26">         g_confidentialItemTitle = getWcapString(&quot;confidentialItem.title.text&quot;);</span>
<a href="#l63.27"></a><span id="l63.27">         g_busyItemTitle = getWcapString(&quot;busyItem.title.text&quot;);</span>
<a href="#l63.28"></a><span id="l63.28">         g_busyPhantomItemUuidPrefix = &quot;PHANTOM_uuid_&quot; + cal.getUUID();</span>
<a href="#l63.29"></a><span id="l63.29"> </span>
<a href="#l63.30"></a><span id="l63.30" class="difflineminus">-        CACHE_LAST_RESULTS = Preferences.get(&quot;calendar.wcap.cache_last_results&quot;, 4);</span>
<a href="#l63.31"></a><span id="l63.31" class="difflineminus">-        CACHE_LAST_RESULTS_INVALIDATE = Preferences.get(&quot;calendar.wcap.cache_last_results_invalidate&quot;, 120);</span>
<a href="#l63.32"></a><span id="l63.32" class="difflineplus">+        CACHE_LAST_RESULTS = Services.prefs.getIntPref(&quot;calendar.wcap.cache_last_results&quot;, 4);</span>
<a href="#l63.33"></a><span id="l63.33" class="difflineplus">+        CACHE_LAST_RESULTS_INVALIDATE = Services.prefs.getIntPref(&quot;calendar.wcap.cache_last_results_invalidate&quot;, 120);</span>
<a href="#l63.34"></a><span id="l63.34">     } catch (exc) {</span>
<a href="#l63.35"></a><span id="l63.35">         logError(exc, &quot;error in init sequence&quot;);</span>
<a href="#l63.36"></a><span id="l63.36">     }</span>
<a href="#l63.37"></a><span id="l63.37"> }</span>
<a href="#l63.38"></a><span id="l63.38"> </span>
<a href="#l63.39"></a><span id="l63.39"> /** Module Registration */</span>
<a href="#l63.40"></a><span id="l63.40"> this.NSGetFactory = (cid) =&gt; {</span>
<a href="#l63.41"></a><span id="l63.41">     let scriptLoadOrder = [</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l64.4"></a><span id="l64.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l64.5"></a><span id="l64.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l64.6"></a><span id="l64.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l64.7"></a><span id="l64.7"> </span>
<a href="#l64.8"></a><span id="l64.8"> /* exported getWcapSessionFor */</span>
<a href="#l64.9"></a><span id="l64.9"> </span>
<a href="#l64.10"></a><span id="l64.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l64.11"></a><span id="l64.11"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l64.12"></a><span id="l64.12"> </span>
<a href="#l64.13"></a><span id="l64.13"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l64.14"></a><span id="l64.14"> </span>
<a href="#l64.15"></a><span id="l64.15"> function calWcapTimezone(tzProvider, tzid_, component_) {</span>
<a href="#l64.16"></a><span id="l64.16">     this.wrappedJSObject = this;</span>
<a href="#l64.17"></a><span id="l64.17">     this.provider = tzProvider;</span>
<a href="#l64.18"></a><span id="l64.18">     this.icalComponent = component_;</span>
<a href="#l64.19"></a><span id="l64.19" class="difflineat">@@ -1133,17 +1132,17 @@ function confirmInsecureLogin(uri) {</span>
<a href="#l64.20"></a><span id="l64.20">             // save decision for all running calendars and</span>
<a href="#l64.21"></a><span id="l64.21">             // all future confirmations:</span>
<a href="#l64.22"></a><span id="l64.22">             let newConfirmedLogins = getPref(&quot;calendar.wcap.confirmed_http_logins&quot;, &quot;&quot;);</span>
<a href="#l64.23"></a><span id="l64.23">             if (newConfirmedLogins.length &gt; 0) {</span>
<a href="#l64.24"></a><span id="l64.24">                 newConfirmedLogins += &quot;,&quot;;</span>
<a href="#l64.25"></a><span id="l64.25">             }</span>
<a href="#l64.26"></a><span id="l64.26">             confirmedEntry = (bConfirmed ? &quot;1&quot; : &quot;0&quot;);</span>
<a href="#l64.27"></a><span id="l64.27">             newConfirmedLogins += encodedHost + &quot;:&quot; + confirmedEntry;</span>
<a href="#l64.28"></a><span id="l64.28" class="difflineminus">-            Preferences.set(&quot;calendar.wcap.confirmed_http_logins&quot;, newConfirmedLogins);</span>
<a href="#l64.29"></a><span id="l64.29" class="difflineplus">+            Services.prefs.setStringPref(&quot;calendar.wcap.confirmed_http_logins&quot;, newConfirmedLogins);</span>
<a href="#l64.30"></a><span id="l64.30">             getPref(&quot;calendar.wcap.confirmed_http_logins&quot;); // log written entry</span>
<a href="#l64.31"></a><span id="l64.31">             confirmInsecureLogin.m_confirmedHttpLogins[encodedHost] = confirmedEntry;</span>
<a href="#l64.32"></a><span id="l64.32">         }</span>
<a href="#l64.33"></a><span id="l64.33">     }</span>
<a href="#l64.34"></a><span id="l64.34"> </span>
<a href="#l64.35"></a><span id="l64.35">     log(&quot;returned: &quot; + bConfirmed, &quot;confirmInsecureLogin(&quot; + host + &quot;)&quot;);</span>
<a href="#l64.36"></a><span id="l64.36">     return bConfirmed;</span>
<a href="#l64.37"></a><span id="l64.37"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l65.4"></a><span id="l65.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l65.5"></a><span id="l65.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l65.6"></a><span id="l65.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l65.7"></a><span id="l65.7"> </span>
<a href="#l65.8"></a><span id="l65.8"> var MODULE_NAME = &quot;testUTF8&quot;;</span>
<a href="#l65.9"></a><span id="l65.9"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l65.10"></a><span id="l65.10"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;item-editing-helpers&quot;];</span>
<a href="#l65.11"></a><span id="l65.11"> </span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l65.14"></a><span id="l65.14"> </span>
<a href="#l65.15"></a><span id="l65.15"> var EVENT_BOX, CANVAS_BOX;</span>
<a href="#l65.16"></a><span id="l65.16"> var helpersForController, invokeEventDialog, closeAllEventDialogs, createCalendar, deleteCalendars;</span>
<a href="#l65.17"></a><span id="l65.17"> var setData;</span>
<a href="#l65.18"></a><span id="l65.18"> </span>
<a href="#l65.19"></a><span id="l65.19"> var UTF8STRING = &quot;      &quot;;</span>
<a href="#l65.20"></a><span id="l65.20"> </span>
<a href="#l65.21"></a><span id="l65.21"> function setupModule(module) {</span>
<a href="#l65.22"></a><span id="l65.22" class="difflineat">@@ -27,17 +27,17 @@ function setupModule(module) {</span>
<a href="#l65.23"></a><span id="l65.23">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l65.24"></a><span id="l65.24">     collector.getModule(&quot;calendar-utils&quot;).setupModule(controller);</span>
<a href="#l65.25"></a><span id="l65.25">     Object.assign(module, helpersForController(controller));</span>
<a href="#l65.26"></a><span id="l65.26"> </span>
<a href="#l65.27"></a><span id="l65.27">     ({ setData } = collector.getModule(&quot;item-editing-helpers&quot;));</span>
<a href="#l65.28"></a><span id="l65.28">     collector.getModule(&quot;item-editing-helpers&quot;).setupModule(module);</span>
<a href="#l65.29"></a><span id="l65.29"> </span>
<a href="#l65.30"></a><span id="l65.30">     createCalendar(controller, UTF8STRING);</span>
<a href="#l65.31"></a><span id="l65.31" class="difflineminus">-    Preferences.set(&quot;calendar.categories.names&quot;, UTF8STRING);</span>
<a href="#l65.32"></a><span id="l65.32" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.categories.names&quot;, UTF8STRING);</span>
<a href="#l65.33"></a><span id="l65.33"> }</span>
<a href="#l65.34"></a><span id="l65.34"> </span>
<a href="#l65.35"></a><span id="l65.35"> function testUTF8() {</span>
<a href="#l65.36"></a><span id="l65.36">     // Create new event.</span>
<a href="#l65.37"></a><span id="l65.37">     let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, 8);</span>
<a href="#l65.38"></a><span id="l65.38">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l65.39"></a><span id="l65.39">         let { eid: eventid } = helpersForController(event);</span>
<a href="#l65.40"></a><span id="l65.40"> </span>
<a href="#l65.41"></a><span id="l65.41" class="difflineat">@@ -70,11 +70,11 @@ function testUTF8() {</span>
<a href="#l65.42"></a><span id="l65.42">         // Escape the event window.</span>
<a href="#l65.43"></a><span id="l65.43">         event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l65.44"></a><span id="l65.44">     });</span>
<a href="#l65.45"></a><span id="l65.45"> }</span>
<a href="#l65.46"></a><span id="l65.46"> testUTF8.EXCLUDED_PLATFORMS = [&quot;darwin&quot;];</span>
<a href="#l65.47"></a><span id="l65.47"> </span>
<a href="#l65.48"></a><span id="l65.48"> function teardownTest(module) {</span>
<a href="#l65.49"></a><span id="l65.49">     deleteCalendars(controller, UTF8STRING);</span>
<a href="#l65.50"></a><span id="l65.50" class="difflineminus">-    Preferences.reset(&quot;calendar.categories.names&quot;);</span>
<a href="#l65.51"></a><span id="l65.51" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.categories.names&quot;);</span>
<a href="#l65.52"></a><span id="l65.52">     closeAllEventDialogs();</span>
<a href="#l65.53"></a><span id="l65.53"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/calendar/test/mozmill/testAlarmDefaultValue.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/calendar/test/mozmill/testAlarmDefaultValue.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -7,17 +7,17 @@</span>
<a href="#l66.4"></a><span id="l66.4">  */</span>
<a href="#l66.5"></a><span id="l66.5"> </span>
<a href="#l66.6"></a><span id="l66.6"> var MODULE_NAME = &quot;testAlarmDefaultValue&quot;;</span>
<a href="#l66.7"></a><span id="l66.7"> var RELATIVE_ROOT = &quot;./shared-modules&quot;;</span>
<a href="#l66.8"></a><span id="l66.8"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;content-tab-helpers&quot;];</span>
<a href="#l66.9"></a><span id="l66.9"> </span>
<a href="#l66.10"></a><span id="l66.10"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l66.11"></a><span id="l66.11"> var { PluralForm } = ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l66.14"></a><span id="l66.14"> </span>
<a href="#l66.15"></a><span id="l66.15"> const DEFVALUE = 43;</span>
<a href="#l66.16"></a><span id="l66.16"> </span>
<a href="#l66.17"></a><span id="l66.17"> var helpersForController, invokeEventDialog, openLightningPrefs, menulistSelect;</span>
<a href="#l66.18"></a><span id="l66.18"> var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l66.19"></a><span id="l66.19"> </span>
<a href="#l66.20"></a><span id="l66.20"> function setupModule(module) {</span>
<a href="#l66.21"></a><span id="l66.21">     controller = mozmill.getMail3PaneController();</span>
<a href="#l66.22"></a><span id="l66.22" class="difflineat">@@ -132,10 +132,13 @@ function handleReminderDialog(reminders)</span>
<a href="#l66.23"></a><span id="l66.23">     reminders.waitFor(() =&gt; listboxElement.selectedIndex == 0);</span>
<a href="#l66.24"></a><span id="l66.24"> </span>
<a href="#l66.25"></a><span id="l66.25">     reminders.assert(() =&gt; listboxElement.selectedItem.reminder.offset.days == DEFVALUE);</span>
<a href="#l66.26"></a><span id="l66.26"> </span>
<a href="#l66.27"></a><span id="l66.27">     reminders.window.close();</span>
<a href="#l66.28"></a><span id="l66.28"> }</span>
<a href="#l66.29"></a><span id="l66.29"> </span>
<a href="#l66.30"></a><span id="l66.30"> function teardownTest(module) {</span>
<a href="#l66.31"></a><span id="l66.31" class="difflineminus">-    Preferences.resetBranch(&quot;calendar.alarms&quot;);</span>
<a href="#l66.32"></a><span id="l66.32" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.eventalarmlen&quot;);</span>
<a href="#l66.33"></a><span id="l66.33" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.eventalarmunit&quot;);</span>
<a href="#l66.34"></a><span id="l66.34" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.todoalarmlen&quot;);</span>
<a href="#l66.35"></a><span id="l66.35" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.todoalarmunit&quot;);</span>
<a href="#l66.36"></a><span id="l66.36"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/calendar/test/mozmill/testTimezones.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/calendar/test/mozmill/testTimezones.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -16,17 +16,17 @@ var DATES = [</span>
<a href="#l67.4"></a><span id="l67.4">     [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]</span>
<a href="#l67.5"></a><span id="l67.5"> ];</span>
<a href="#l67.6"></a><span id="l67.6"> </span>
<a href="#l67.7"></a><span id="l67.7"> var TIMEZONES = [</span>
<a href="#l67.8"></a><span id="l67.8">     &quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l67.9"></a><span id="l67.9">     &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;</span>
<a href="#l67.10"></a><span id="l67.10"> ];</span>
<a href="#l67.11"></a><span id="l67.11"> </span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l67.14"></a><span id="l67.14"> </span>
<a href="#l67.15"></a><span id="l67.15"> function setupModule(module) {</span>
<a href="#l67.16"></a><span id="l67.16">     controller = mozmill.getMail3PaneController();</span>
<a href="#l67.17"></a><span id="l67.17">     ({</span>
<a href="#l67.18"></a><span id="l67.18">         CANVAS_BOX,</span>
<a href="#l67.19"></a><span id="l67.19">         DAY_VIEW,</span>
<a href="#l67.20"></a><span id="l67.20">         helpersForController,</span>
<a href="#l67.21"></a><span id="l67.21">         invokeEventDialog,</span>
<a href="#l67.22"></a><span id="l67.22" class="difflineat">@@ -39,17 +39,17 @@ function setupModule(module) {</span>
<a href="#l67.23"></a><span id="l67.23">     collector.getModule(&quot;calendar-utils&quot;).setupModule(controller);</span>
<a href="#l67.24"></a><span id="l67.24">     Object.assign(module, helpersForController(controller));</span>
<a href="#l67.25"></a><span id="l67.25"> </span>
<a href="#l67.26"></a><span id="l67.26">     ({ setData } = collector.getModule(&quot;item-editing-helpers&quot;));</span>
<a href="#l67.27"></a><span id="l67.27">     collector.getModule(&quot;item-editing-helpers&quot;).setupModule(module);</span>
<a href="#l67.28"></a><span id="l67.28"> }</span>
<a href="#l67.29"></a><span id="l67.29"> </span>
<a href="#l67.30"></a><span id="l67.30"> function testTimezones1_SetGMT() {</span>
<a href="#l67.31"></a><span id="l67.31" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Europe/London&quot;);</span>
<a href="#l67.32"></a><span id="l67.32" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;Europe/London&quot;);</span>
<a href="#l67.33"></a><span id="l67.33"> }</span>
<a href="#l67.34"></a><span id="l67.34"> </span>
<a href="#l67.35"></a><span id="l67.35"> function testTimezones2_CreateEvents() {</span>
<a href="#l67.36"></a><span id="l67.36">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l67.37"></a><span id="l67.37"> </span>
<a href="#l67.38"></a><span id="l67.38">     // Create weekly recurring events in all TIMEZONES.</span>
<a href="#l67.39"></a><span id="l67.39">     let times = [[4, 30], [5, 0], [3, 0], [3, 0], [9, 0], [14, 0], [19, 45], [1, 30]];</span>
<a href="#l67.40"></a><span id="l67.40">     let time = new Date();</span>
<a href="#l67.41"></a><span id="l67.41" class="difflineat">@@ -70,17 +70,17 @@ function testTimezones2_CreateEvents() {</span>
<a href="#l67.42"></a><span id="l67.42">             // save</span>
<a href="#l67.43"></a><span id="l67.43">             let { eid: eventid } = helpersForController(event);</span>
<a href="#l67.44"></a><span id="l67.44">             event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l67.45"></a><span id="l67.45">         });</span>
<a href="#l67.46"></a><span id="l67.46">     }</span>
<a href="#l67.47"></a><span id="l67.47"> }</span>
<a href="#l67.48"></a><span id="l67.48"> </span>
<a href="#l67.49"></a><span id="l67.49"> function testTimezones3_checkStJohns() {</span>
<a href="#l67.50"></a><span id="l67.50" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;America/St_Johns&quot;);</span>
<a href="#l67.51"></a><span id="l67.51" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;America/St_Johns&quot;);</span>
<a href="#l67.52"></a><span id="l67.52">     let times = [</span>
<a href="#l67.53"></a><span id="l67.53">         [[4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30], [11, 30]],</span>
<a href="#l67.54"></a><span id="l67.54">         [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [12, 30]],</span>
<a href="#l67.55"></a><span id="l67.55">         [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l67.56"></a><span id="l67.56">         [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l67.57"></a><span id="l67.57">         [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l67.58"></a><span id="l67.58">         [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [12, 30]],</span>
<a href="#l67.59"></a><span id="l67.59">         [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [10, 30], [11, 30], [12, 30]],</span>
<a href="#l67.60"></a><span id="l67.60" class="difflineat">@@ -89,17 +89,17 @@ function testTimezones3_checkStJohns() {</span>
<a href="#l67.61"></a><span id="l67.61">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l67.62"></a><span id="l67.62">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l67.63"></a><span id="l67.63">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l67.64"></a><span id="l67.64"> </span>
<a href="#l67.65"></a><span id="l67.65">     verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l67.66"></a><span id="l67.66"> }</span>
<a href="#l67.67"></a><span id="l67.67"> </span>
<a href="#l67.68"></a><span id="l67.68"> function testTimezones4_checkCaracas() {</span>
<a href="#l67.69"></a><span id="l67.69" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;America/Caracas&quot;);</span>
<a href="#l67.70"></a><span id="l67.70" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;America/Caracas&quot;);</span>
<a href="#l67.71"></a><span id="l67.71">     // This is actually incorrect. Venezuela shifted clocks forward 30 minutes</span>
<a href="#l67.72"></a><span id="l67.72">     // in 2016, but our code doesn't handle historical timezones.</span>
<a href="#l67.73"></a><span id="l67.73">     let times = [</span>
<a href="#l67.74"></a><span id="l67.74">         [[4, 0], [5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0]],</span>
<a href="#l67.75"></a><span id="l67.75">         [[3, 0], [5, 0], [6, 0], [6, 0], [8, 0], [8, 0], [10, 0], [11, 0]],</span>
<a href="#l67.76"></a><span id="l67.76">         [[3, 0], [5, 0], [6, 0], [6, 0], [8, 0], [8, 0], [10, 0], [12, 0]],</span>
<a href="#l67.77"></a><span id="l67.77">         [[3, 0], [5, 0], [6, 0], [6, 0], [8, 0], [8, 0], [10, 0], [12, 0]],</span>
<a href="#l67.78"></a><span id="l67.78">         [[3, 0], [5, 0], [6, 0], [6, 0], [8, 0], [8, 0], [10, 0], [12, 0]],</span>
<a href="#l67.79"></a><span id="l67.79" class="difflineat">@@ -110,17 +110,17 @@ function testTimezones4_checkCaracas() {</span>
<a href="#l67.80"></a><span id="l67.80">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l67.81"></a><span id="l67.81">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l67.82"></a><span id="l67.82">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l67.83"></a><span id="l67.83"> </span>
<a href="#l67.84"></a><span id="l67.84">     verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l67.85"></a><span id="l67.85"> }</span>
<a href="#l67.86"></a><span id="l67.86"> </span>
<a href="#l67.87"></a><span id="l67.87"> function testTimezones5_checkPhoenix() {</span>
<a href="#l67.88"></a><span id="l67.88" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;America/Phoenix&quot;);</span>
<a href="#l67.89"></a><span id="l67.89" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;America/Phoenix&quot;);</span>
<a href="#l67.90"></a><span id="l67.90">     let times = [</span>
<a href="#l67.91"></a><span id="l67.91">         [[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l67.92"></a><span id="l67.92">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l67.93"></a><span id="l67.93">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l67.94"></a><span id="l67.94">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l67.95"></a><span id="l67.95">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l67.96"></a><span id="l67.96">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l67.97"></a><span id="l67.97">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l67.98"></a><span id="l67.98" class="difflineat">@@ -129,17 +129,17 @@ function testTimezones5_checkPhoenix() {</span>
<a href="#l67.99"></a><span id="l67.99">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l67.100"></a><span id="l67.100">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l67.101"></a><span id="l67.101">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l67.102"></a><span id="l67.102"> </span>
<a href="#l67.103"></a><span id="l67.103">     verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l67.104"></a><span id="l67.104"> }</span>
<a href="#l67.105"></a><span id="l67.105"> </span>
<a href="#l67.106"></a><span id="l67.106"> function testTimezones6_checkLosAngeles() {</span>
<a href="#l67.107"></a><span id="l67.107" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;America/Los_Angeles&quot;);</span>
<a href="#l67.108"></a><span id="l67.108" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;America/Los_Angeles&quot;);</span>
<a href="#l67.109"></a><span id="l67.109">     let times = [</span>
<a href="#l67.110"></a><span id="l67.110">         [[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]],</span>
<a href="#l67.111"></a><span id="l67.111">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l67.112"></a><span id="l67.112">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l67.113"></a><span id="l67.113">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l67.114"></a><span id="l67.114">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l67.115"></a><span id="l67.115">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l67.116"></a><span id="l67.116">         [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l67.117"></a><span id="l67.117" class="difflineat">@@ -148,17 +148,17 @@ function testTimezones6_checkLosAngeles(</span>
<a href="#l67.118"></a><span id="l67.118">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l67.119"></a><span id="l67.119">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l67.120"></a><span id="l67.120">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l67.121"></a><span id="l67.121"> </span>
<a href="#l67.122"></a><span id="l67.122">     verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l67.123"></a><span id="l67.123"> }</span>
<a href="#l67.124"></a><span id="l67.124"> </span>
<a href="#l67.125"></a><span id="l67.125"> function testTimezones7_checkBuenosAires() {</span>
<a href="#l67.126"></a><span id="l67.126" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;America/Argentina/Buenos_Aires&quot;);</span>
<a href="#l67.127"></a><span id="l67.127" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;America/Argentina/Buenos_Aires&quot;);</span>
<a href="#l67.128"></a><span id="l67.128">     let times = [</span>
<a href="#l67.129"></a><span id="l67.129">         [[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l67.130"></a><span id="l67.130">         [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [12, 0]],</span>
<a href="#l67.131"></a><span id="l67.131">         [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l67.132"></a><span id="l67.132">         [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l67.133"></a><span id="l67.133">         [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l67.134"></a><span id="l67.134">         [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [12, 0]],</span>
<a href="#l67.135"></a><span id="l67.135">         [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l67.136"></a><span id="l67.136" class="difflineat">@@ -167,17 +167,17 @@ function testTimezones7_checkBuenosAires</span>
<a href="#l67.137"></a><span id="l67.137">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l67.138"></a><span id="l67.138">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l67.139"></a><span id="l67.139">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l67.140"></a><span id="l67.140"> </span>
<a href="#l67.141"></a><span id="l67.141">     verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l67.142"></a><span id="l67.142"> }</span>
<a href="#l67.143"></a><span id="l67.143"> </span>
<a href="#l67.144"></a><span id="l67.144"> function testTimezones8_checkParis() {</span>
<a href="#l67.145"></a><span id="l67.145" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Europe/Paris&quot;);</span>
<a href="#l67.146"></a><span id="l67.146" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;Europe/Paris&quot;);</span>
<a href="#l67.147"></a><span id="l67.147">     let times = [</span>
<a href="#l67.148"></a><span id="l67.148">         [[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l67.149"></a><span id="l67.149">         [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l67.150"></a><span id="l67.150">         [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l67.151"></a><span id="l67.151">         [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l67.152"></a><span id="l67.152">         [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l67.153"></a><span id="l67.153">         [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l67.154"></a><span id="l67.154">         [[8, 0], [10, 0], [11, 0], [11, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l67.155"></a><span id="l67.155" class="difflineat">@@ -186,17 +186,17 @@ function testTimezones8_checkParis() {</span>
<a href="#l67.156"></a><span id="l67.156">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l67.157"></a><span id="l67.157">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l67.158"></a><span id="l67.158">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l67.159"></a><span id="l67.159"> </span>
<a href="#l67.160"></a><span id="l67.160">     verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l67.161"></a><span id="l67.161"> }</span>
<a href="#l67.162"></a><span id="l67.162"> </span>
<a href="#l67.163"></a><span id="l67.163"> function testTimezones9_checkKathmandu() {</span>
<a href="#l67.164"></a><span id="l67.164" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Asia/Kathmandu&quot;);</span>
<a href="#l67.165"></a><span id="l67.165" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;Asia/Kathmandu&quot;);</span>
<a href="#l67.166"></a><span id="l67.166">     let times = [</span>
<a href="#l67.167"></a><span id="l67.167">         [[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l67.168"></a><span id="l67.168">         [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l67.169"></a><span id="l67.169">         [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l67.170"></a><span id="l67.170">         [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l67.171"></a><span id="l67.171">         [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l67.172"></a><span id="l67.172">         [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l67.173"></a><span id="l67.173">         [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l67.174"></a><span id="l67.174" class="difflineat">@@ -205,17 +205,17 @@ function testTimezones9_checkKathmandu()</span>
<a href="#l67.175"></a><span id="l67.175">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l67.176"></a><span id="l67.176">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l67.177"></a><span id="l67.177">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l67.178"></a><span id="l67.178"> </span>
<a href="#l67.179"></a><span id="l67.179">     verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l67.180"></a><span id="l67.180"> }</span>
<a href="#l67.181"></a><span id="l67.181"> </span>
<a href="#l67.182"></a><span id="l67.182"> function testTimezones10_checkAdelaide() {</span>
<a href="#l67.183"></a><span id="l67.183" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Australia/Adelaide&quot;);</span>
<a href="#l67.184"></a><span id="l67.184" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;Australia/Adelaide&quot;);</span>
<a href="#l67.185"></a><span id="l67.185">     let times = [</span>
<a href="#l67.186"></a><span id="l67.186">         [[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l67.187"></a><span id="l67.187">         [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l67.188"></a><span id="l67.188">         [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l67.189"></a><span id="l67.189">         [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l67.190"></a><span id="l67.190">         [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l67.191"></a><span id="l67.191">         [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l67.192"></a><span id="l67.192">         [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/calendar/test/unit/head_consts.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/calendar/test/unit/head_consts.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -4,17 +4,16 @@</span>
<a href="#l68.4"></a><span id="l68.4"> </span>
<a href="#l68.5"></a><span id="l68.5"> /* exported do_calendar_startup, do_load_calmgr, do_load_timezoneservice, readJSONFile,</span>
<a href="#l68.6"></a><span id="l68.6">  *          ics_unfoldline, dedent, compareItemsSpecific, getStorageCal, getMemoryCal,</span>
<a href="#l68.7"></a><span id="l68.7">  *          createTodoFromIcalString, createEventFromIcalString, createDate, Cc, Ci, Cr, Cu</span>
<a href="#l68.8"></a><span id="l68.8">  */</span>
<a href="#l68.9"></a><span id="l68.9"> </span>
<a href="#l68.10"></a><span id="l68.10"> var { AppConstants } = ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l68.11"></a><span id="l68.11"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l68.13"></a><span id="l68.13"> var { FileUtils } = ChromeUtils.import(&quot;resource://gre/modules/FileUtils.jsm&quot;);</span>
<a href="#l68.14"></a><span id="l68.14"> var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l68.15"></a><span id="l68.15"> </span>
<a href="#l68.16"></a><span id="l68.16"> var { getAppInfo, newAppInfo, updateAppInfo } = ChromeUtils.import(&quot;resource://testing-common/AppInfo.jsm&quot;);</span>
<a href="#l68.17"></a><span id="l68.17"> </span>
<a href="#l68.18"></a><span id="l68.18"> ChromeUtils.defineModuleGetter(this, &quot;NetUtil&quot;, &quot;resource://gre/modules/NetUtil.jsm&quot;);</span>
<a href="#l68.19"></a><span id="l68.19"> </span>
<a href="#l68.20"></a><span id="l68.20"> updateAppInfo();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/calendar/test/unit/head_icaljs.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/calendar/test/unit/head_icaljs.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -1,6 +1,6 @@</span>
<a href="#l69.4"></a><span id="l69.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l69.5"></a><span id="l69.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l69.6"></a><span id="l69.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l69.7"></a><span id="l69.7"> </span>
<a href="#l69.8"></a><span id="l69.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l69.9"></a><span id="l69.9" class="difflineminus">-Preferences.set(&quot;calendar.icaljs&quot;, true);</span>
<a href="#l69.10"></a><span id="l69.10" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l69.11"></a><span id="l69.11" class="difflineplus">+Services.prefs.setBoolPref(&quot;calendar.icaljs&quot;, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/calendar/test/unit/head_libical.js</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/calendar/test/unit/head_libical.js</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -1,6 +1,6 @@</span>
<a href="#l70.4"></a><span id="l70.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l70.5"></a><span id="l70.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l70.6"></a><span id="l70.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l70.7"></a><span id="l70.7"> </span>
<a href="#l70.8"></a><span id="l70.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l70.9"></a><span id="l70.9" class="difflineminus">-Preferences.set(&quot;calendar.icaljs&quot;, false);</span>
<a href="#l70.10"></a><span id="l70.10" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l70.11"></a><span id="l70.11" class="difflineplus">+Services.prefs.setBoolPref(&quot;calendar.icaljs&quot;, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/calendar/test/unit/test_alarmutils.js</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/calendar/test/unit/test_alarmutils.js</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -1,130 +1,130 @@</span>
<a href="#l71.4"></a><span id="l71.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l71.5"></a><span id="l71.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l71.6"></a><span id="l71.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l71.7"></a><span id="l71.7"> </span>
<a href="#l71.8"></a><span id="l71.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l71.9"></a><span id="l71.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l71.10"></a><span id="l71.10"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l71.11"></a><span id="l71.11"> </span>
<a href="#l71.12"></a><span id="l71.12"> function run_test() {</span>
<a href="#l71.13"></a><span id="l71.13">     do_calendar_startup(run_next_test);</span>
<a href="#l71.14"></a><span id="l71.14"> }</span>
<a href="#l71.15"></a><span id="l71.15"> </span>
<a href="#l71.16"></a><span id="l71.16"> add_task(async function test_setDefaultValues_events() {</span>
<a href="#l71.17"></a><span id="l71.17">     let item, alarm;</span>
<a href="#l71.18"></a><span id="l71.18"> </span>
<a href="#l71.19"></a><span id="l71.19" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.onforevents&quot;, 1);</span>
<a href="#l71.20"></a><span id="l71.20" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.eventalarmunit&quot;, &quot;hours&quot;);</span>
<a href="#l71.21"></a><span id="l71.21" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.eventalarmlen&quot;, 60);</span>
<a href="#l71.22"></a><span id="l71.22" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.onforevents&quot;, 1);</span>
<a href="#l71.23"></a><span id="l71.23" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.alarms.eventalarmunit&quot;, &quot;hours&quot;);</span>
<a href="#l71.24"></a><span id="l71.24" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.eventalarmlen&quot;, 60);</span>
<a href="#l71.25"></a><span id="l71.25">     item = cal.createEvent();</span>
<a href="#l71.26"></a><span id="l71.26">     cal.alarms.setDefaultValues(item);</span>
<a href="#l71.27"></a><span id="l71.27">     alarm = item.getAlarms({})[0];</span>
<a href="#l71.28"></a><span id="l71.28">     ok(alarm);</span>
<a href="#l71.29"></a><span id="l71.29">     equal(alarm.related, alarm.ALARM_RELATED_START);</span>
<a href="#l71.30"></a><span id="l71.30">     equal(alarm.action, &quot;DISPLAY&quot;);</span>
<a href="#l71.31"></a><span id="l71.31">     equal(alarm.offset.icalString, &quot;-P2DT12H&quot;);</span>
<a href="#l71.32"></a><span id="l71.32"> </span>
<a href="#l71.33"></a><span id="l71.33" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.onforevents&quot;, 1);</span>
<a href="#l71.34"></a><span id="l71.34" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.eventalarmunit&quot;, &quot;yards&quot;);</span>
<a href="#l71.35"></a><span id="l71.35" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.eventalarmlen&quot;, 20);</span>
<a href="#l71.36"></a><span id="l71.36" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.onforevents&quot;, 1);</span>
<a href="#l71.37"></a><span id="l71.37" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.alarms.eventalarmunit&quot;, &quot;yards&quot;);</span>
<a href="#l71.38"></a><span id="l71.38" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.eventalarmlen&quot;, 20);</span>
<a href="#l71.39"></a><span id="l71.39">     item = cal.createEvent();</span>
<a href="#l71.40"></a><span id="l71.40">     cal.alarms.setDefaultValues(item);</span>
<a href="#l71.41"></a><span id="l71.41">     alarm = item.getAlarms({})[0];</span>
<a href="#l71.42"></a><span id="l71.42">     ok(alarm);</span>
<a href="#l71.43"></a><span id="l71.43">     equal(alarm.related, alarm.ALARM_RELATED_START);</span>
<a href="#l71.44"></a><span id="l71.44">     equal(alarm.action, &quot;DISPLAY&quot;);</span>
<a href="#l71.45"></a><span id="l71.45">     equal(alarm.offset.icalString, &quot;-PT20M&quot;);</span>
<a href="#l71.46"></a><span id="l71.46"> </span>
<a href="#l71.47"></a><span id="l71.47" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.onforevents&quot;, 0);</span>
<a href="#l71.48"></a><span id="l71.48" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.onforevents&quot;, 0);</span>
<a href="#l71.49"></a><span id="l71.49">     item = cal.createEvent();</span>
<a href="#l71.50"></a><span id="l71.50">     cal.alarms.setDefaultValues(item);</span>
<a href="#l71.51"></a><span id="l71.51">     equal(item.getAlarms({}).length, 0);</span>
<a href="#l71.52"></a><span id="l71.52"> </span>
<a href="#l71.53"></a><span id="l71.53">     let mockCalendar = {</span>
<a href="#l71.54"></a><span id="l71.54">         getProperty: function() {</span>
<a href="#l71.55"></a><span id="l71.55">             return [&quot;SHOUT&quot;];</span>
<a href="#l71.56"></a><span id="l71.56">         }</span>
<a href="#l71.57"></a><span id="l71.57">     };</span>
<a href="#l71.58"></a><span id="l71.58"> </span>
<a href="#l71.59"></a><span id="l71.59" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.onforevents&quot;, 1);</span>
<a href="#l71.60"></a><span id="l71.60" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.eventalarmunit&quot;, &quot;hours&quot;);</span>
<a href="#l71.61"></a><span id="l71.61" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.eventalarmlen&quot;, 60);</span>
<a href="#l71.62"></a><span id="l71.62" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.onforevents&quot;, 1);</span>
<a href="#l71.63"></a><span id="l71.63" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.alarms.eventalarmunit&quot;, &quot;hours&quot;);</span>
<a href="#l71.64"></a><span id="l71.64" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.eventalarmlen&quot;, 60);</span>
<a href="#l71.65"></a><span id="l71.65">     item = cal.createEvent();</span>
<a href="#l71.66"></a><span id="l71.66">     item.calendar = mockCalendar;</span>
<a href="#l71.67"></a><span id="l71.67">     cal.alarms.setDefaultValues(item);</span>
<a href="#l71.68"></a><span id="l71.68">     alarm = item.getAlarms({})[0];</span>
<a href="#l71.69"></a><span id="l71.69">     ok(alarm);</span>
<a href="#l71.70"></a><span id="l71.70">     equal(alarm.related, alarm.ALARM_RELATED_START);</span>
<a href="#l71.71"></a><span id="l71.71">     equal(alarm.action, &quot;SHOUT&quot;);</span>
<a href="#l71.72"></a><span id="l71.72">     equal(alarm.offset.icalString, &quot;-P2DT12H&quot;);</span>
<a href="#l71.73"></a><span id="l71.73"> </span>
<a href="#l71.74"></a><span id="l71.74" class="difflineminus">-    Preferences.reset(&quot;calendar.alarms.onforevents&quot;);</span>
<a href="#l71.75"></a><span id="l71.75" class="difflineminus">-    Preferences.reset(&quot;calendar.alarms.eventalarmunit&quot;);</span>
<a href="#l71.76"></a><span id="l71.76" class="difflineminus">-    Preferences.reset(&quot;calendar.alarms.eventalarmlen&quot;);</span>
<a href="#l71.77"></a><span id="l71.77" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.onforevents&quot;);</span>
<a href="#l71.78"></a><span id="l71.78" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.eventalarmunit&quot;);</span>
<a href="#l71.79"></a><span id="l71.79" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.eventalarmlen&quot;);</span>
<a href="#l71.80"></a><span id="l71.80"> });</span>
<a href="#l71.81"></a><span id="l71.81"> </span>
<a href="#l71.82"></a><span id="l71.82"> add_task(async function test_setDefaultValues_tasks() {</span>
<a href="#l71.83"></a><span id="l71.83">     let item, alarm;</span>
<a href="#l71.84"></a><span id="l71.84">     let calnow = cal.dtz.now;</span>
<a href="#l71.85"></a><span id="l71.85">     let nowDate = cal.createDateTime(&quot;20150815T120000&quot;);</span>
<a href="#l71.86"></a><span id="l71.86">     cal.dtz.now = function() {</span>
<a href="#l71.87"></a><span id="l71.87">         return nowDate;</span>
<a href="#l71.88"></a><span id="l71.88">     };</span>
<a href="#l71.89"></a><span id="l71.89"> </span>
<a href="#l71.90"></a><span id="l71.90" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.onfortodos&quot;, 1);</span>
<a href="#l71.91"></a><span id="l71.91" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.todoalarmunit&quot;, &quot;hours&quot;);</span>
<a href="#l71.92"></a><span id="l71.92" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.todoalarmlen&quot;, 60);</span>
<a href="#l71.93"></a><span id="l71.93" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.onfortodos&quot;, 1);</span>
<a href="#l71.94"></a><span id="l71.94" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.alarms.todoalarmunit&quot;, &quot;hours&quot;);</span>
<a href="#l71.95"></a><span id="l71.95" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.todoalarmlen&quot;, 60);</span>
<a href="#l71.96"></a><span id="l71.96">     item = cal.createTodo();</span>
<a href="#l71.97"></a><span id="l71.97">     equal(item.entryDate, null);</span>
<a href="#l71.98"></a><span id="l71.98">     cal.alarms.setDefaultValues(item);</span>
<a href="#l71.99"></a><span id="l71.99">     alarm = item.getAlarms({})[0];</span>
<a href="#l71.100"></a><span id="l71.100">     ok(alarm);</span>
<a href="#l71.101"></a><span id="l71.101">     equal(alarm.related, alarm.ALARM_RELATED_START);</span>
<a href="#l71.102"></a><span id="l71.102">     equal(alarm.action, &quot;DISPLAY&quot;);</span>
<a href="#l71.103"></a><span id="l71.103">     equal(alarm.offset.icalString, &quot;-P2DT12H&quot;);</span>
<a href="#l71.104"></a><span id="l71.104">     equal(item.entryDate, nowDate);</span>
<a href="#l71.105"></a><span id="l71.105"> </span>
<a href="#l71.106"></a><span id="l71.106" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.onfortodos&quot;, 1);</span>
<a href="#l71.107"></a><span id="l71.107" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.todoalarmunit&quot;, &quot;yards&quot;);</span>
<a href="#l71.108"></a><span id="l71.108" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.todoalarmlen&quot;, 20);</span>
<a href="#l71.109"></a><span id="l71.109" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.onfortodos&quot;, 1);</span>
<a href="#l71.110"></a><span id="l71.110" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.alarms.todoalarmunit&quot;, &quot;yards&quot;);</span>
<a href="#l71.111"></a><span id="l71.111" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.todoalarmlen&quot;, 20);</span>
<a href="#l71.112"></a><span id="l71.112">     item = cal.createTodo();</span>
<a href="#l71.113"></a><span id="l71.113">     cal.alarms.setDefaultValues(item);</span>
<a href="#l71.114"></a><span id="l71.114">     alarm = item.getAlarms({})[0];</span>
<a href="#l71.115"></a><span id="l71.115">     ok(alarm);</span>
<a href="#l71.116"></a><span id="l71.116">     equal(alarm.related, alarm.ALARM_RELATED_START);</span>
<a href="#l71.117"></a><span id="l71.117">     equal(alarm.action, &quot;DISPLAY&quot;);</span>
<a href="#l71.118"></a><span id="l71.118">     equal(alarm.offset.icalString, &quot;-PT20M&quot;);</span>
<a href="#l71.119"></a><span id="l71.119"> </span>
<a href="#l71.120"></a><span id="l71.120" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.onfortodos&quot;, 0);</span>
<a href="#l71.121"></a><span id="l71.121" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.onfortodos&quot;, 0);</span>
<a href="#l71.122"></a><span id="l71.122">     item = cal.createTodo();</span>
<a href="#l71.123"></a><span id="l71.123">     cal.alarms.setDefaultValues(item);</span>
<a href="#l71.124"></a><span id="l71.124">     equal(item.getAlarms({}).length, 0);</span>
<a href="#l71.125"></a><span id="l71.125"> </span>
<a href="#l71.126"></a><span id="l71.126">     let mockCalendar = {</span>
<a href="#l71.127"></a><span id="l71.127">         getProperty: function() {</span>
<a href="#l71.128"></a><span id="l71.128">             return [&quot;SHOUT&quot;];</span>
<a href="#l71.129"></a><span id="l71.129">         }</span>
<a href="#l71.130"></a><span id="l71.130">     };</span>
<a href="#l71.131"></a><span id="l71.131"> </span>
<a href="#l71.132"></a><span id="l71.132" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.onfortodos&quot;, 1);</span>
<a href="#l71.133"></a><span id="l71.133" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.todoalarmunit&quot;, &quot;hours&quot;);</span>
<a href="#l71.134"></a><span id="l71.134" class="difflineminus">-    Preferences.set(&quot;calendar.alarms.todoalarmlen&quot;, 60);</span>
<a href="#l71.135"></a><span id="l71.135" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.onfortodos&quot;, 1);</span>
<a href="#l71.136"></a><span id="l71.136" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.alarms.todoalarmunit&quot;, &quot;hours&quot;);</span>
<a href="#l71.137"></a><span id="l71.137" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.alarms.todoalarmlen&quot;, 60);</span>
<a href="#l71.138"></a><span id="l71.138">     item = cal.createTodo();</span>
<a href="#l71.139"></a><span id="l71.139">     item.calendar = mockCalendar;</span>
<a href="#l71.140"></a><span id="l71.140">     cal.alarms.setDefaultValues(item);</span>
<a href="#l71.141"></a><span id="l71.141">     alarm = item.getAlarms({})[0];</span>
<a href="#l71.142"></a><span id="l71.142">     ok(alarm);</span>
<a href="#l71.143"></a><span id="l71.143">     equal(alarm.related, alarm.ALARM_RELATED_START);</span>
<a href="#l71.144"></a><span id="l71.144">     equal(alarm.action, &quot;SHOUT&quot;);</span>
<a href="#l71.145"></a><span id="l71.145">     equal(alarm.offset.icalString, &quot;-P2DT12H&quot;);</span>
<a href="#l71.146"></a><span id="l71.146"> </span>
<a href="#l71.147"></a><span id="l71.147" class="difflineminus">-    Preferences.reset(&quot;calendar.alarms.onfortodos&quot;);</span>
<a href="#l71.148"></a><span id="l71.148" class="difflineminus">-    Preferences.reset(&quot;calendar.alarms.todoalarmunit&quot;);</span>
<a href="#l71.149"></a><span id="l71.149" class="difflineminus">-    Preferences.reset(&quot;calendar.alarms.todoalarmlen&quot;);</span>
<a href="#l71.150"></a><span id="l71.150" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.onfortodos&quot;);</span>
<a href="#l71.151"></a><span id="l71.151" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.todoalarmunit&quot;);</span>
<a href="#l71.152"></a><span id="l71.152" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.todoalarmlen&quot;);</span>
<a href="#l71.153"></a><span id="l71.153">     cal.dtz.now = calnow;</span>
<a href="#l71.154"></a><span id="l71.154"> });</span>
<a href="#l71.155"></a><span id="l71.155"> </span>
<a href="#l71.156"></a><span id="l71.156"> add_task(async function test_calculateAlarmDate() {</span>
<a href="#l71.157"></a><span id="l71.157">     let item = cal.createEvent();</span>
<a href="#l71.158"></a><span id="l71.158">     item.startDate = cal.createDateTime(&quot;20150815T120000&quot;);</span>
<a href="#l71.159"></a><span id="l71.159">     item.endDate = cal.createDateTime(&quot;20150815T130000&quot;);</span>
<a href="#l71.160"></a><span id="l71.160"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/calendar/test/unit/test_datetimeformatter.js</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/calendar/test/unit/test_datetimeformatter.js</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l72.4"></a><span id="l72.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l72.5"></a><span id="l72.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l72.6"></a><span id="l72.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l72.7"></a><span id="l72.7"> </span>
<a href="#l72.8"></a><span id="l72.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l72.9"></a><span id="l72.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l72.10"></a><span id="l72.10"> </span>
<a href="#l72.11"></a><span id="l72.11"> function run_test() {</span>
<a href="#l72.12"></a><span id="l72.12">     do_calendar_startup(run_next_test);</span>
<a href="#l72.13"></a><span id="l72.13"> }</span>
<a href="#l72.14"></a><span id="l72.14"> </span>
<a href="#l72.15"></a><span id="l72.15"> // This test assumes the timezone of your system is not set to Pacific/Fakaofo or equivalent.</span>
<a href="#l72.16"></a><span id="l72.16"> </span>
<a href="#l72.17"></a><span id="l72.17"> // Time format is platform dependent, so we use alternative result sets here in 'expected'.</span>
<a href="#l72.18"></a><span id="l72.18" class="difflineat">@@ -27,44 +27,44 @@ add_task(async function formatDate_test(</span>
<a href="#l72.19"></a><span id="l72.19">         input: {</span>
<a href="#l72.20"></a><span id="l72.20">             datetime: &quot;20170401T180000&quot;,</span>
<a href="#l72.21"></a><span id="l72.21">             timezone: &quot;Pacific/Fakaofo&quot;,</span>
<a href="#l72.22"></a><span id="l72.22">             dateformat: 1 // short</span>
<a href="#l72.23"></a><span id="l72.23">         },</span>
<a href="#l72.24"></a><span id="l72.24">         expected: [&quot;4/1/2017&quot;, &quot;4/1/17&quot;]</span>
<a href="#l72.25"></a><span id="l72.25">     }];</span>
<a href="#l72.26"></a><span id="l72.26"> </span>
<a href="#l72.27"></a><span id="l72.27" class="difflineminus">-    let dateformat = Preferences.get(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l72.28"></a><span id="l72.28" class="difflineminus">-    let tzlocal = Preferences.get(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.29"></a><span id="l72.29" class="difflineminus">-    let useOsLocale = Preferences.get(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.30"></a><span id="l72.30" class="difflineplus">+    let dateformat = Services.prefs.getIntPref(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l72.31"></a><span id="l72.31" class="difflineplus">+    let tzlocal = Services.prefs.getStringPref(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.32"></a><span id="l72.32" class="difflineplus">+    let useOsLocale = Services.prefs.getBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.33"></a><span id="l72.33">     // make sure to use the app locale to avoid test failures when running</span>
<a href="#l72.34"></a><span id="l72.34">     // locally on an OS with a regional setting other than en-US</span>
<a href="#l72.35"></a><span id="l72.35" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.36"></a><span id="l72.36" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.37"></a><span id="l72.37" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.38"></a><span id="l72.38" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.39"></a><span id="l72.39"> </span>
<a href="#l72.40"></a><span id="l72.40">     let tzs = cal.getTimezoneService();</span>
<a href="#l72.41"></a><span id="l72.41"> </span>
<a href="#l72.42"></a><span id="l72.42">     let i = 0;</span>
<a href="#l72.43"></a><span id="l72.43">     for (let test of data) {</span>
<a href="#l72.44"></a><span id="l72.44">         i++;</span>
<a href="#l72.45"></a><span id="l72.45" class="difflineminus">-        Preferences.set(&quot;calendar.date.format&quot;, test.input.dateformat);</span>
<a href="#l72.46"></a><span id="l72.46" class="difflineplus">+        Services.prefs.setIntPref(&quot;calendar.date.format&quot;, test.input.dateformat);</span>
<a href="#l72.47"></a><span id="l72.47">         let zone = (test.input.timezone == &quot;floating&quot;) ? cal.dtz.floating : tzs.getTimezone(test.input.timezone);</span>
<a href="#l72.48"></a><span id="l72.48">         let date = cal.createDateTime(test.input.datetime).getInTimezone(zone);</span>
<a href="#l72.49"></a><span id="l72.49"> </span>
<a href="#l72.50"></a><span id="l72.50">         let dtFormatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(Ci.calIDateTimeFormatter);</span>
<a href="#l72.51"></a><span id="l72.51">         let formatted = dtFormatter.formatDate(date);</span>
<a href="#l72.52"></a><span id="l72.52">         ok(</span>
<a href="#l72.53"></a><span id="l72.53">             test.expected.includes(formatted),</span>
<a href="#l72.54"></a><span id="l72.54">             &quot;(test #&quot; + i + &quot;: result '&quot; + formatted + &quot;', expected '&quot; + test.expected + &quot;')&quot;</span>
<a href="#l72.55"></a><span id="l72.55">         );</span>
<a href="#l72.56"></a><span id="l72.56">     }</span>
<a href="#l72.57"></a><span id="l72.57">     // let's reset the preferences</span>
<a href="#l72.58"></a><span id="l72.58" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l72.59"></a><span id="l72.59" class="difflineminus">-    Preferences.set(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l72.60"></a><span id="l72.60" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l72.61"></a><span id="l72.61" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l72.62"></a><span id="l72.62" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l72.63"></a><span id="l72.63" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l72.64"></a><span id="l72.64"> });</span>
<a href="#l72.65"></a><span id="l72.65"> </span>
<a href="#l72.66"></a><span id="l72.66"> add_task(async function formatDateShort_test() {</span>
<a href="#l72.67"></a><span id="l72.67">     let data = [{</span>
<a href="#l72.68"></a><span id="l72.68">         input: {</span>
<a href="#l72.69"></a><span id="l72.69">             datetime: &quot;20170401T180000&quot;,</span>
<a href="#l72.70"></a><span id="l72.70">             timezone: &quot;Pacific/Fakaofo&quot;</span>
<a href="#l72.71"></a><span id="l72.71">         },</span>
<a href="#l72.72"></a><span id="l72.72" class="difflineat">@@ -108,25 +108,25 @@ add_task(async function formatDateShort_</span>
<a href="#l72.73"></a><span id="l72.73">     }, {</span>
<a href="#l72.74"></a><span id="l72.74">         input: {</span>
<a href="#l72.75"></a><span id="l72.75">             datetime: &quot;20170401&quot;,</span>
<a href="#l72.76"></a><span id="l72.76">             timezone: &quot;floating&quot;</span>
<a href="#l72.77"></a><span id="l72.77">         },</span>
<a href="#l72.78"></a><span id="l72.78">         expected: [&quot;4/1/2017&quot;, &quot;4/1/17&quot;]</span>
<a href="#l72.79"></a><span id="l72.79">     }];</span>
<a href="#l72.80"></a><span id="l72.80"> </span>
<a href="#l72.81"></a><span id="l72.81" class="difflineminus">-    let dateformat = Preferences.get(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l72.82"></a><span id="l72.82" class="difflineminus">-    let tzlocal = Preferences.get(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.83"></a><span id="l72.83" class="difflineminus">-    let useOsLocale = Preferences.get(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.84"></a><span id="l72.84" class="difflineplus">+    let dateformat = Services.prefs.getIntPref(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l72.85"></a><span id="l72.85" class="difflineplus">+    let tzlocal = Services.prefs.getStringPref(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.86"></a><span id="l72.86" class="difflineplus">+    let useOsLocale = Services.prefs.getBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.87"></a><span id="l72.87">     // make sure to use the app locale to avoid test failures when running</span>
<a href="#l72.88"></a><span id="l72.88">     // locally on an OS with a regional setting other than en-US</span>
<a href="#l72.89"></a><span id="l72.89" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.90"></a><span id="l72.90" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.91"></a><span id="l72.91" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.92"></a><span id="l72.92" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.93"></a><span id="l72.93">     // we make sure to have set long format</span>
<a href="#l72.94"></a><span id="l72.94" class="difflineminus">-    Preferences.set(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l72.95"></a><span id="l72.95" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l72.96"></a><span id="l72.96"> </span>
<a href="#l72.97"></a><span id="l72.97">     let tzs = cal.getTimezoneService();</span>
<a href="#l72.98"></a><span id="l72.98"> </span>
<a href="#l72.99"></a><span id="l72.99">     let i = 0;</span>
<a href="#l72.100"></a><span id="l72.100">     for (let test of data) {</span>
<a href="#l72.101"></a><span id="l72.101">         i++;</span>
<a href="#l72.102"></a><span id="l72.102"> </span>
<a href="#l72.103"></a><span id="l72.103">         let zone = (test.input.timezone == &quot;floating&quot;) ? cal.dtz.floating : tzs.getTimezone(test.input.timezone);</span>
<a href="#l72.104"></a><span id="l72.104" class="difflineat">@@ -136,19 +136,19 @@ add_task(async function formatDateShort_</span>
<a href="#l72.105"></a><span id="l72.105"> </span>
<a href="#l72.106"></a><span id="l72.106">         let formatted = dtFormatter.formatDateShort(date);</span>
<a href="#l72.107"></a><span id="l72.107">         ok(</span>
<a href="#l72.108"></a><span id="l72.108">             test.expected.includes(formatted),</span>
<a href="#l72.109"></a><span id="l72.109">             &quot;(test #&quot; + i + &quot;: result '&quot; + formatted + &quot;', expected '&quot; + test.expected + &quot;')&quot;</span>
<a href="#l72.110"></a><span id="l72.110">         );</span>
<a href="#l72.111"></a><span id="l72.111">     }</span>
<a href="#l72.112"></a><span id="l72.112">     // let's reset the preferences</span>
<a href="#l72.113"></a><span id="l72.113" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l72.114"></a><span id="l72.114" class="difflineminus">-    Preferences.set(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l72.115"></a><span id="l72.115" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l72.116"></a><span id="l72.116" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l72.117"></a><span id="l72.117" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l72.118"></a><span id="l72.118" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l72.119"></a><span id="l72.119"> });</span>
<a href="#l72.120"></a><span id="l72.120"> </span>
<a href="#l72.121"></a><span id="l72.121"> add_task(async function formatDateLong_test() {</span>
<a href="#l72.122"></a><span id="l72.122">     let data = [{</span>
<a href="#l72.123"></a><span id="l72.123">         input: {</span>
<a href="#l72.124"></a><span id="l72.124">             datetime: &quot;20170401T180000&quot;,</span>
<a href="#l72.125"></a><span id="l72.125">             timezone: &quot;Pacific/Fakaofo&quot;</span>
<a href="#l72.126"></a><span id="l72.126">         },</span>
<a href="#l72.127"></a><span id="l72.127" class="difflineat">@@ -192,25 +192,25 @@ add_task(async function formatDateLong_t</span>
<a href="#l72.128"></a><span id="l72.128">     }, {</span>
<a href="#l72.129"></a><span id="l72.129">         input: {</span>
<a href="#l72.130"></a><span id="l72.130">             datetime: &quot;20170401&quot;,</span>
<a href="#l72.131"></a><span id="l72.131">             timezone: &quot;floating&quot;</span>
<a href="#l72.132"></a><span id="l72.132">         },</span>
<a href="#l72.133"></a><span id="l72.133">         expected: [&quot;Saturday, April 01, 2017&quot;, &quot;Saturday, April 1, 2017&quot;]</span>
<a href="#l72.134"></a><span id="l72.134">     }];</span>
<a href="#l72.135"></a><span id="l72.135"> </span>
<a href="#l72.136"></a><span id="l72.136" class="difflineminus">-    let dateformat = Preferences.get(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l72.137"></a><span id="l72.137" class="difflineminus">-    let tzlocal = Preferences.get(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.138"></a><span id="l72.138" class="difflineminus">-    let useOsLocale = Preferences.get(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.139"></a><span id="l72.139" class="difflineplus">+    let dateformat = Services.prefs.getIntPref(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l72.140"></a><span id="l72.140" class="difflineplus">+    let tzlocal = Services.prefs.getStringPref(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.141"></a><span id="l72.141" class="difflineplus">+    let useOsLocale = Services.prefs.getBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.142"></a><span id="l72.142">     // make sure to use the app locale to avoid test failures when running</span>
<a href="#l72.143"></a><span id="l72.143">     // locally on an OS with a regional setting other than en-US</span>
<a href="#l72.144"></a><span id="l72.144" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.145"></a><span id="l72.145" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.146"></a><span id="l72.146" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.147"></a><span id="l72.147" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.148"></a><span id="l72.148">     // we make sure to have set short format</span>
<a href="#l72.149"></a><span id="l72.149" class="difflineminus">-    Preferences.set(&quot;calendar.date.format&quot;, 1);</span>
<a href="#l72.150"></a><span id="l72.150" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.date.format&quot;, 1);</span>
<a href="#l72.151"></a><span id="l72.151"> </span>
<a href="#l72.152"></a><span id="l72.152">     let tzs = cal.getTimezoneService();</span>
<a href="#l72.153"></a><span id="l72.153"> </span>
<a href="#l72.154"></a><span id="l72.154">     let i = 0;</span>
<a href="#l72.155"></a><span id="l72.155">     for (let test of data) {</span>
<a href="#l72.156"></a><span id="l72.156">         i++;</span>
<a href="#l72.157"></a><span id="l72.157"> </span>
<a href="#l72.158"></a><span id="l72.158">         let zone = (test.input.timezone == &quot;floating&quot;) ? cal.dtz.floating : tzs.getTimezone(test.input.timezone);</span>
<a href="#l72.159"></a><span id="l72.159" class="difflineat">@@ -220,19 +220,19 @@ add_task(async function formatDateLong_t</span>
<a href="#l72.160"></a><span id="l72.160"> </span>
<a href="#l72.161"></a><span id="l72.161">         let formatted = dtFormatter.formatDateLong(date);</span>
<a href="#l72.162"></a><span id="l72.162">         ok(</span>
<a href="#l72.163"></a><span id="l72.163">             test.expected.includes(formatted),</span>
<a href="#l72.164"></a><span id="l72.164">             &quot;(test #&quot; + i + &quot;: result '&quot; + formatted + &quot;', expected '&quot; + test.expected + &quot;')&quot;</span>
<a href="#l72.165"></a><span id="l72.165">         );</span>
<a href="#l72.166"></a><span id="l72.166">     }</span>
<a href="#l72.167"></a><span id="l72.167">     // let's reset the preferences</span>
<a href="#l72.168"></a><span id="l72.168" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l72.169"></a><span id="l72.169" class="difflineminus">-    Preferences.set(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l72.170"></a><span id="l72.170" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l72.171"></a><span id="l72.171" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l72.172"></a><span id="l72.172" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l72.173"></a><span id="l72.173" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l72.174"></a><span id="l72.174"> });</span>
<a href="#l72.175"></a><span id="l72.175"> </span>
<a href="#l72.176"></a><span id="l72.176"> add_task(async function formatDateWithoutYear_test() {</span>
<a href="#l72.177"></a><span id="l72.177">     let data = [{</span>
<a href="#l72.178"></a><span id="l72.178">         input: {</span>
<a href="#l72.179"></a><span id="l72.179">             datetime: &quot;20170401T180000&quot;,</span>
<a href="#l72.180"></a><span id="l72.180">             timezone: &quot;Pacific/Fakaofo&quot;</span>
<a href="#l72.181"></a><span id="l72.181">         },</span>
<a href="#l72.182"></a><span id="l72.182" class="difflineat">@@ -276,43 +276,43 @@ add_task(async function formatDateWithou</span>
<a href="#l72.183"></a><span id="l72.183">     }, {</span>
<a href="#l72.184"></a><span id="l72.184">         input: {</span>
<a href="#l72.185"></a><span id="l72.185">             datetime: &quot;20170401&quot;,</span>
<a href="#l72.186"></a><span id="l72.186">             timezone: &quot;floating&quot;</span>
<a href="#l72.187"></a><span id="l72.187">         },</span>
<a href="#l72.188"></a><span id="l72.188">         expected: &quot;Apr 1&quot;</span>
<a href="#l72.189"></a><span id="l72.189">     }];</span>
<a href="#l72.190"></a><span id="l72.190"> </span>
<a href="#l72.191"></a><span id="l72.191" class="difflineminus">-    let dateformat = Preferences.get(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l72.192"></a><span id="l72.192" class="difflineminus">-    let tzlocal = Preferences.get(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.193"></a><span id="l72.193" class="difflineminus">-    let useOsLocale = Preferences.get(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.194"></a><span id="l72.194" class="difflineplus">+    let dateformat = Services.prefs.getIntPref(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l72.195"></a><span id="l72.195" class="difflineplus">+    let tzlocal = Services.prefs.getStringPref(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.196"></a><span id="l72.196" class="difflineplus">+    let useOsLocale = Services.prefs.getBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.197"></a><span id="l72.197">     // make sure to use the app locale to avoid test failures when running</span>
<a href="#l72.198"></a><span id="l72.198">     // locally on an OS with a regional setting other than en-US</span>
<a href="#l72.199"></a><span id="l72.199" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.200"></a><span id="l72.200" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.201"></a><span id="l72.201" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.202"></a><span id="l72.202" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.203"></a><span id="l72.203">     // we make sure to have set short format</span>
<a href="#l72.204"></a><span id="l72.204" class="difflineminus">-    Preferences.set(&quot;calendar.date.format&quot;, 1);</span>
<a href="#l72.205"></a><span id="l72.205" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.date.format&quot;, 1);</span>
<a href="#l72.206"></a><span id="l72.206"> </span>
<a href="#l72.207"></a><span id="l72.207">     let tzs = cal.getTimezoneService();</span>
<a href="#l72.208"></a><span id="l72.208"> </span>
<a href="#l72.209"></a><span id="l72.209">     let i = 0;</span>
<a href="#l72.210"></a><span id="l72.210">     for (let test of data) {</span>
<a href="#l72.211"></a><span id="l72.211">         i++;</span>
<a href="#l72.212"></a><span id="l72.212"> </span>
<a href="#l72.213"></a><span id="l72.213">         let zone = (test.input.timezone == &quot;floating&quot;) ? cal.dtz.floating : tzs.getTimezone(test.input.timezone);</span>
<a href="#l72.214"></a><span id="l72.214">         let date = cal.createDateTime(test.input.datetime).getInTimezone(zone);</span>
<a href="#l72.215"></a><span id="l72.215"> </span>
<a href="#l72.216"></a><span id="l72.216">         let dtFormatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(Ci.calIDateTimeFormatter);</span>
<a href="#l72.217"></a><span id="l72.217"> </span>
<a href="#l72.218"></a><span id="l72.218">         equal(dtFormatter.formatDateWithoutYear(date), test.expected, &quot;(test #&quot; + i + &quot;)&quot;);</span>
<a href="#l72.219"></a><span id="l72.219">     }</span>
<a href="#l72.220"></a><span id="l72.220">     // let's reset the preferences</span>
<a href="#l72.221"></a><span id="l72.221" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l72.222"></a><span id="l72.222" class="difflineminus">-    Preferences.set(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l72.223"></a><span id="l72.223" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l72.224"></a><span id="l72.224" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l72.225"></a><span id="l72.225" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l72.226"></a><span id="l72.226" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l72.227"></a><span id="l72.227"> });</span>
<a href="#l72.228"></a><span id="l72.228"> </span>
<a href="#l72.229"></a><span id="l72.229"> add_task(async function formatTime_test() {</span>
<a href="#l72.230"></a><span id="l72.230">     let data = [{</span>
<a href="#l72.231"></a><span id="l72.231">         input: {</span>
<a href="#l72.232"></a><span id="l72.232">             datetime: &quot;20170401T090000&quot;,</span>
<a href="#l72.233"></a><span id="l72.233">             timezone: &quot;Pacific/Fakaofo&quot;</span>
<a href="#l72.234"></a><span id="l72.234">         },</span>
<a href="#l72.235"></a><span id="l72.235" class="difflineat">@@ -338,22 +338,22 @@ add_task(async function formatTime_test(</span>
<a href="#l72.236"></a><span id="l72.236">     }, {</span>
<a href="#l72.237"></a><span id="l72.237">         input: {</span>
<a href="#l72.238"></a><span id="l72.238">             datetime: &quot;20170401&quot;,</span>
<a href="#l72.239"></a><span id="l72.239">             timezone: &quot;Pacific/Fakaofo&quot;</span>
<a href="#l72.240"></a><span id="l72.240">         },</span>
<a href="#l72.241"></a><span id="l72.241">         expected: &quot;All Day&quot;</span>
<a href="#l72.242"></a><span id="l72.242">     }];</span>
<a href="#l72.243"></a><span id="l72.243"> </span>
<a href="#l72.244"></a><span id="l72.244" class="difflineminus">-    let tzlocal = Preferences.get(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.245"></a><span id="l72.245" class="difflineminus">-    let useOsLocale = Preferences.get(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.246"></a><span id="l72.246" class="difflineplus">+    let tzlocal = Services.prefs.getStringPref(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.247"></a><span id="l72.247" class="difflineplus">+    let useOsLocale = Services.prefs.getBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.248"></a><span id="l72.248">     // make sure to use the app locale to avoid test failures when running</span>
<a href="#l72.249"></a><span id="l72.249">     // locally on an OS with a regional setting other than en-US</span>
<a href="#l72.250"></a><span id="l72.250" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.251"></a><span id="l72.251" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.252"></a><span id="l72.252" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l72.253"></a><span id="l72.253" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;Pacific/Fakaofo&quot;);</span>
<a href="#l72.254"></a><span id="l72.254"> </span>
<a href="#l72.255"></a><span id="l72.255">     let tzs = cal.getTimezoneService();</span>
<a href="#l72.256"></a><span id="l72.256"> </span>
<a href="#l72.257"></a><span id="l72.257">     let i = 0;</span>
<a href="#l72.258"></a><span id="l72.258">     for (let test of data) {</span>
<a href="#l72.259"></a><span id="l72.259">         i++;</span>
<a href="#l72.260"></a><span id="l72.260"> </span>
<a href="#l72.261"></a><span id="l72.261">         let zone = (test.input.timezone == &quot;floating&quot;) ? cal.dtz.floating : tzs.getTimezone(test.input.timezone);</span>
<a href="#l72.262"></a><span id="l72.262" class="difflineat">@@ -363,11 +363,11 @@ add_task(async function formatTime_test(</span>
<a href="#l72.263"></a><span id="l72.263"> </span>
<a href="#l72.264"></a><span id="l72.264">         let formatted = dtFormatter.formatTime(date);</span>
<a href="#l72.265"></a><span id="l72.265">         ok(</span>
<a href="#l72.266"></a><span id="l72.266">             test.expected.includes(formatted),</span>
<a href="#l72.267"></a><span id="l72.267">             &quot;(test #&quot; + i + &quot;: result '&quot; + formatted + &quot;', expected '&quot; + test.expected + &quot;')&quot;</span>
<a href="#l72.268"></a><span id="l72.268">         );</span>
<a href="#l72.269"></a><span id="l72.269">     }</span>
<a href="#l72.270"></a><span id="l72.270">     // let's reset the preferences</span>
<a href="#l72.271"></a><span id="l72.271" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l72.272"></a><span id="l72.272" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l72.273"></a><span id="l72.273" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l72.274"></a><span id="l72.274" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l72.275"></a><span id="l72.275"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/calendar/test/unit/test_extract.js</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/calendar/test/unit/test_extract.js</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -1,14 +1,13 @@</span>
<a href="#l73.4"></a><span id="l73.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l73.5"></a><span id="l73.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l73.6"></a><span id="l73.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l73.7"></a><span id="l73.7"> </span>
<a href="#l73.8"></a><span id="l73.8"> var { Extractor } = ChromeUtils.import(&quot;resource://calendar/modules/calExtract.jsm&quot;);</span>
<a href="#l73.9"></a><span id="l73.9" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l73.10"></a><span id="l73.10"> </span>
<a href="#l73.11"></a><span id="l73.11"> var extractor = new Extractor(&quot;en-US&quot;, 8);</span>
<a href="#l73.12"></a><span id="l73.12"> </span>
<a href="#l73.13"></a><span id="l73.13"> function run_test() {</span>
<a href="#l73.14"></a><span id="l73.14">     // Sanity check to make sure the base url is still right. If this fails,</span>
<a href="#l73.15"></a><span id="l73.15">     // don't forget to also fix the url in base/content/calendar-extract.js.</span>
<a href="#l73.16"></a><span id="l73.16">     ok(extractor.checkBundle(&quot;en-US&quot;));</span>
<a href="#l73.17"></a><span id="l73.17"> </span>
<a href="#l73.18"></a><span id="l73.18" class="difflineat">@@ -176,17 +175,17 @@ function test_overrides() {</span>
<a href="#l73.19"></a><span id="l73.19">     equal(endGuess.minute, undefined);</span>
<a href="#l73.20"></a><span id="l73.20"> </span>
<a href="#l73.21"></a><span id="l73.21">     // recognize a custom &quot;tomorrow&quot; and hour.minutes pattern</span>
<a href="#l73.22"></a><span id="l73.22">     let overrides = {</span>
<a href="#l73.23"></a><span id="l73.23">         &quot;from.hour.minutes&quot;: { add: &quot;#2:#1&quot;, remove: &quot;#1:#2&quot; },</span>
<a href="#l73.24"></a><span id="l73.24">         &quot;from.tomorrow&quot;: { add: &quot;worromot&quot; }</span>
<a href="#l73.25"></a><span id="l73.25">     };</span>
<a href="#l73.26"></a><span id="l73.26"> </span>
<a href="#l73.27"></a><span id="l73.27" class="difflineminus">-    Preferences.set(&quot;calendar.patterns.override&quot;, JSON.stringify(overrides));</span>
<a href="#l73.28"></a><span id="l73.28" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.patterns.override&quot;, JSON.stringify(overrides));</span>
<a href="#l73.29"></a><span id="l73.29"> </span>
<a href="#l73.30"></a><span id="l73.30">     collected = extractor.extract(title, content, date, undefined);</span>
<a href="#l73.31"></a><span id="l73.31">     guessed = extractor.guessStart(false);</span>
<a href="#l73.32"></a><span id="l73.32">     endGuess = extractor.guessEnd(guessed, true);</span>
<a href="#l73.33"></a><span id="l73.33"> </span>
<a href="#l73.34"></a><span id="l73.34">     equal(guessed.year, 2012);</span>
<a href="#l73.35"></a><span id="l73.35">     equal(guessed.month, 10);</span>
<a href="#l73.36"></a><span id="l73.36">     equal(guessed.day, 2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/calendar/test/unit/test_freebusy.js</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/calendar/test/unit/test_freebusy.js</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -47,17 +47,17 @@ function test_period() {</span>
<a href="#l74.4"></a><span id="l74.4">     equal(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l74.5"></a><span id="l74.5"> </span>
<a href="#l74.6"></a><span id="l74.6">     period.icalString = &quot;20120101T010105/PT1S&quot;;</span>
<a href="#l74.7"></a><span id="l74.7">     equal(period.start.icalString, &quot;20120101T010105&quot;);</span>
<a href="#l74.8"></a><span id="l74.8">     equal(period.end.icalString, &quot;20120101T010106&quot;);</span>
<a href="#l74.9"></a><span id="l74.9">     equal(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l74.10"></a><span id="l74.10"> </span>
<a href="#l74.11"></a><span id="l74.11">     period.makeImmutable();</span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-    if (!Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineplus">+    if (!Services.prefs.getBoolPref(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l74.14"></a><span id="l74.14">         // ical.js doesn't support immutability yet</span>
<a href="#l74.15"></a><span id="l74.15">         throws(() =&gt; {</span>
<a href="#l74.16"></a><span id="l74.16">             period.start = cal.createDateTime(&quot;20120202T020202&quot;);</span>
<a href="#l74.17"></a><span id="l74.17">         }, /0x80460002/, &quot;Object is Immutable&quot;);</span>
<a href="#l74.18"></a><span id="l74.18">         throws(() =&gt; {</span>
<a href="#l74.19"></a><span id="l74.19">             period.end = cal.createDateTime(&quot;20120202T020202&quot;);</span>
<a href="#l74.20"></a><span id="l74.20">         }, /0x80460002/, &quot;Object is Immutable&quot;);</span>
<a href="#l74.21"></a><span id="l74.21">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -22,17 +22,16 @@</span>
<a href="#l75.4"></a><span id="l75.4"> </span>
<a href="#l75.5"></a><span id="l75.5">     dump(&quot;Loading &quot; + xpiFile.path + &quot;\n&quot;);</span>
<a href="#l75.6"></a><span id="l75.6">     let manager = Cc[&quot;@mozilla.org/component-manager-extra;1&quot;].getService(Ci.nsIComponentManagerExtra);</span>
<a href="#l75.7"></a><span id="l75.7">     manager.addLegacyExtensionManifestLocation(xpiFile);</span>
<a href="#l75.8"></a><span id="l75.8"> })();</span>
<a href="#l75.9"></a><span id="l75.9"> </span>
<a href="#l75.10"></a><span id="l75.10"> var { HttpServer } = ChromeUtils.import(&quot;resource://testing-common/httpd.js&quot;);</span>
<a href="#l75.11"></a><span id="l75.11"> var { NetUtil } = ChromeUtils.import(&quot;resource://gre/modules/NetUtil.jsm&quot;);</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l75.13"></a><span id="l75.13"> </span>
<a href="#l75.14"></a><span id="l75.14"> var { getGoogleSessionManager } = ChromeUtils.import(&quot;resource://gdata-provider/modules/gdataSession.jsm&quot;);</span>
<a href="#l75.15"></a><span id="l75.15"> var {</span>
<a href="#l75.16"></a><span id="l75.16">     dateToJSON,</span>
<a href="#l75.17"></a><span id="l75.17">     JSONToDate,</span>
<a href="#l75.18"></a><span id="l75.18">     monkeyPatch</span>
<a href="#l75.19"></a><span id="l75.19"> } = ChromeUtils.import(&quot;resource://gdata-provider/modules/gdataUtils.jsm&quot;);</span>
<a href="#l75.20"></a><span id="l75.20"> var { MockRegistrar } = ChromeUtils.import(&quot;resource://testing-common/MockRegistrar.jsm&quot;);</span>
<a href="#l75.21"></a><span id="l75.21" class="difflineat">@@ -568,17 +567,17 @@ add_test(function test_migrate_uri() {</span>
<a href="#l75.22"></a><span id="l75.22">     }</span>
<a href="#l75.23"></a><span id="l75.23"> </span>
<a href="#l75.24"></a><span id="l75.24">     checkMigrate(&quot;http://www.google.com/calendar/feeds/example%40example.com/public/full&quot;,</span>
<a href="#l75.25"></a><span id="l75.25">                  &quot;example@example.com&quot;, &quot;example@example.com&quot;, null);</span>
<a href="#l75.26"></a><span id="l75.26"> </span>
<a href="#l75.27"></a><span id="l75.27">     checkMigrate(&quot;webcal://www.google.com/calendar/feeds/example%40example.com/public/full&quot;,</span>
<a href="#l75.28"></a><span id="l75.28">                  &quot;example@example.com&quot;, &quot;example@example.com&quot;, null);</span>
<a href="#l75.29"></a><span id="l75.29"> </span>
<a href="#l75.30"></a><span id="l75.30" class="difflineminus">-    Preferences.set(&quot;calendar.google.calPrefs.example@example.com.googleUser&quot;, &quot;example@example.com&quot;);</span>
<a href="#l75.31"></a><span id="l75.31" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.google.calPrefs.example@example.com.googleUser&quot;, &quot;example@example.com&quot;);</span>
<a href="#l75.32"></a><span id="l75.32">     checkMigrate(&quot;http://www.google.com/calendar/feeds/example%40example.com/public/full&quot;,</span>
<a href="#l75.33"></a><span id="l75.33">                  &quot;example@example.com&quot;, &quot;example@example.com&quot;, &quot;@default&quot;);</span>
<a href="#l75.34"></a><span id="l75.34"> </span>
<a href="#l75.35"></a><span id="l75.35">     checkMigrate(&quot;ehmwtf://www.google.com/calendar/feeds/example%40example.com/public/full&quot;);</span>
<a href="#l75.36"></a><span id="l75.36">     checkMigrate(&quot;googleapi://session/?calendar=calendarId&amp;tasksId=tasksId&quot;);</span>
<a href="#l75.37"></a><span id="l75.37"> </span>
<a href="#l75.38"></a><span id="l75.38">     run_next_test();</span>
<a href="#l75.39"></a><span id="l75.39"> });</span>
<a href="#l75.40"></a><span id="l75.40" class="difflineat">@@ -631,17 +630,17 @@ add_task(async function test_dateToJSON(</span>
<a href="#l75.41"></a><span id="l75.41">     date = _createDateTime(&quot;America/New_York&quot;);</span>
<a href="#l75.42"></a><span id="l75.42">     deepEqual(dateToJSON(date), { dateTime: &quot;2015-01-30T12:00:00&quot;, timeZone: &quot;America/New_York&quot; });</span>
<a href="#l75.43"></a><span id="l75.43"> </span>
<a href="#l75.44"></a><span id="l75.44">     // valid continent/region/city Olson tz</span>
<a href="#l75.45"></a><span id="l75.45">     date = _createDateTime(&quot;America/Argentina/Buenos_Aires&quot;);</span>
<a href="#l75.46"></a><span id="l75.46">     deepEqual(dateToJSON(date), { dateTime: &quot;2015-01-30T12:00:00&quot;, timeZone: &quot;America/Argentina/Buenos_Aires&quot; });</span>
<a href="#l75.47"></a><span id="l75.47"> </span>
<a href="#l75.48"></a><span id="l75.48">     // ical.js and libical currently have slightly different timezone handling.</span>
<a href="#l75.49"></a><span id="l75.49" class="difflineminus">-    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l75.50"></a><span id="l75.50" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l75.51"></a><span id="l75.51">         // unknown but formal valid Olson tz. ical.js assumes floating</span>
<a href="#l75.52"></a><span id="l75.52">         date = _createDateTime(&quot;Unknown/Olson/Timezone&quot;);</span>
<a href="#l75.53"></a><span id="l75.53">         deepEqual(dateToJSON(date), { dateTime: &quot;2015-01-30T12:00:00-00:00&quot; });</span>
<a href="#l75.54"></a><span id="l75.54"> </span>
<a href="#l75.55"></a><span id="l75.55">         // Etc with offset. ical.js doesn't understand third party zones and uses floating</span>
<a href="#l75.56"></a><span id="l75.56">         date = _createDateTime(&quot;ThirdPartyZone&quot;, 5);</span>
<a href="#l75.57"></a><span id="l75.57">         deepEqual(dateToJSON(date), { dateTime: &quot;2015-01-30T12:00:00-00:00&quot; });</span>
<a href="#l75.58"></a><span id="l75.58"> </span>
<a href="#l75.59"></a><span id="l75.59" class="difflineat">@@ -1218,17 +1217,17 @@ add_task(async function test_recurring_c</span>
<a href="#l75.60"></a><span id="l75.60"> </span>
<a href="#l75.61"></a><span id="l75.61">     let items = await pclient.getAllItems();</span>
<a href="#l75.62"></a><span id="l75.62">     equal(items.length, 0);</span>
<a href="#l75.63"></a><span id="l75.63"> </span>
<a href="#l75.64"></a><span id="l75.64">     gServer.resetClient(client);</span>
<a href="#l75.65"></a><span id="l75.65"> });</span>
<a href="#l75.66"></a><span id="l75.66"> </span>
<a href="#l75.67"></a><span id="l75.67"> add_task(async function test_import_invitation() {</span>
<a href="#l75.68"></a><span id="l75.68" class="difflineminus">-    Preferences.set(&quot;calendar.google.enableAttendees&quot;, true);</span>
<a href="#l75.69"></a><span id="l75.69" class="difflineplus">+    Services.prefs.setBoolPref(&quot;calendar.google.enableAttendees&quot;, true);</span>
<a href="#l75.70"></a><span id="l75.70">     let client = await gServer.getClient();</span>
<a href="#l75.71"></a><span id="l75.71">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l75.72"></a><span id="l75.72">     let event = cal.createEvent([</span>
<a href="#l75.73"></a><span id="l75.73">         &quot;BEGIN:VEVENT&quot;,</span>
<a href="#l75.74"></a><span id="l75.74">         &quot;UID:xpcshell-import&quot;,</span>
<a href="#l75.75"></a><span id="l75.75">         &quot;CREATED:20060608T210452Z&quot;,</span>
<a href="#l75.76"></a><span id="l75.76">         &quot;LAST-MODIFIED:20060608T210549Z&quot;,</span>
<a href="#l75.77"></a><span id="l75.77">         &quot;DTSTAMP:20060608T210549Z&quot;,</span>
<a href="#l75.78"></a><span id="l75.78" class="difflineat">@@ -1244,21 +1243,21 @@ add_task(async function test_import_invi</span>
<a href="#l75.79"></a><span id="l75.79">         &quot;SEQUENCE:1&quot;,</span>
<a href="#l75.80"></a><span id="l75.80">         &quot;END:VEVENT&quot;</span>
<a href="#l75.81"></a><span id="l75.81">     ].join(&quot;\r\n&quot;));</span>
<a href="#l75.82"></a><span id="l75.82"> </span>
<a href="#l75.83"></a><span id="l75.83">     let addedItem = await pclient.adoptItem(event);</span>
<a href="#l75.84"></a><span id="l75.84">     equal(gServer.events.length, 1);</span>
<a href="#l75.85"></a><span id="l75.85">     equal(addedItem.icalString, event.icalString);</span>
<a href="#l75.86"></a><span id="l75.86">     gServer.resetClient(client);</span>
<a href="#l75.87"></a><span id="l75.87" class="difflineminus">-    Preferences.set(&quot;calendar.google.enableAttendees&quot;, false);</span>
<a href="#l75.88"></a><span id="l75.88" class="difflineplus">+    Services.prefs.setBoolPref(&quot;calendar.google.enableAttendees&quot;, false);</span>
<a href="#l75.89"></a><span id="l75.89"> });</span>
<a href="#l75.90"></a><span id="l75.90"> </span>
<a href="#l75.91"></a><span id="l75.91"> add_task(async function test_modify_invitation() {</span>
<a href="#l75.92"></a><span id="l75.92" class="difflineminus">-    Preferences.set(&quot;calendar.google.enableAttendees&quot;, true);</span>
<a href="#l75.93"></a><span id="l75.93" class="difflineplus">+    Services.prefs.setBoolPref(&quot;calendar.google.enableAttendees&quot;, true);</span>
<a href="#l75.94"></a><span id="l75.94">     let organizer = {</span>
<a href="#l75.95"></a><span id="l75.95">         displayName: &quot;organizer name&quot;,</span>
<a href="#l75.96"></a><span id="l75.96">         email: &quot;organizer@example.com&quot;,</span>
<a href="#l75.97"></a><span id="l75.97">         organizer: true,</span>
<a href="#l75.98"></a><span id="l75.98">         responseStatus: &quot;tentative&quot;</span>
<a href="#l75.99"></a><span id="l75.99">     };</span>
<a href="#l75.100"></a><span id="l75.100">     let attendee = Object.assign({}, gServer.creator);</span>
<a href="#l75.101"></a><span id="l75.101">     attendee.responseStatus = &quot;needsAction&quot;;</span>
<a href="#l75.102"></a><span id="l75.102" class="difflineat">@@ -1875,33 +1874,33 @@ add_task(async function test_paginate() </span>
<a href="#l75.103"></a><span id="l75.103">         etag: &quot;\&quot;Lck7VNWFJuXdzMtOmrYPx0KFV2s/LTQyNTY0MjUwOQ\&quot;&quot;,</span>
<a href="#l75.104"></a><span id="l75.104">         title: &quot;New Task 2&quot;,</span>
<a href="#l75.105"></a><span id="l75.105">         updated: &quot;2014-09-08T16:30:27.000Z&quot;,</span>
<a href="#l75.106"></a><span id="l75.106">         selfLink: gServer.baseUri + &quot;/tasks/v1/lists/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDow/tasks/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo5OTU0Mjk2MzQ&quot;,</span>
<a href="#l75.107"></a><span id="l75.107">         position: &quot;00000000000000130993&quot;,</span>
<a href="#l75.108"></a><span id="l75.108">         status: &quot;needsAction&quot;</span>
<a href="#l75.109"></a><span id="l75.109">     }];</span>
<a href="#l75.110"></a><span id="l75.110"> </span>
<a href="#l75.111"></a><span id="l75.111" class="difflineminus">-    Preferences.set(&quot;calendar.google.maxResultsPerRequest&quot;, 1);</span>
<a href="#l75.112"></a><span id="l75.112" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.google.maxResultsPerRequest&quot;, 1);</span>
<a href="#l75.113"></a><span id="l75.113"> </span>
<a href="#l75.114"></a><span id="l75.114">     let client = await gServer.getClient();</span>
<a href="#l75.115"></a><span id="l75.115">     let pclient = cal.async.promisifyCalendar(client);</span>
<a href="#l75.116"></a><span id="l75.116"> </span>
<a href="#l75.117"></a><span id="l75.117">     // Make sure all pages were requested</span>
<a href="#l75.118"></a><span id="l75.118">     equal(gServer.eventsData.nextPageToken, null);</span>
<a href="#l75.119"></a><span id="l75.119">     equal(gServer.tasksData.nextPageToken, null);</span>
<a href="#l75.120"></a><span id="l75.120"> </span>
<a href="#l75.121"></a><span id="l75.121">     // ...and we have all items. Not checking props</span>
<a href="#l75.122"></a><span id="l75.122">     // because the other tests do this sufficiently.</span>
<a href="#l75.123"></a><span id="l75.123">     let items = await pclient.getAllItems();</span>
<a href="#l75.124"></a><span id="l75.124">     equal(items.length, 4);</span>
<a href="#l75.125"></a><span id="l75.125"> </span>
<a href="#l75.126"></a><span id="l75.126">     equal(client.getProperty(&quot;syncToken.events&quot;), &quot;next-sync-token&quot;);</span>
<a href="#l75.127"></a><span id="l75.127"> </span>
<a href="#l75.128"></a><span id="l75.128" class="difflineminus">-    Preferences.reset(&quot;calendar.google.maxResultsPerRequest&quot;);</span>
<a href="#l75.129"></a><span id="l75.129" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.google.maxResultsPerRequest&quot;);</span>
<a href="#l75.130"></a><span id="l75.130">     gServer.resetClient(client);</span>
<a href="#l75.131"></a><span id="l75.131"> });</span>
<a href="#l75.132"></a><span id="l75.132"> </span>
<a href="#l75.133"></a><span id="l75.133"> add_task(async function test_incremental_reset() {</span>
<a href="#l75.134"></a><span id="l75.134">     gServer.syncs = [{</span>
<a href="#l75.135"></a><span id="l75.135">         token: &quot;1&quot;,</span>
<a href="#l75.136"></a><span id="l75.136">         events: [{</span>
<a href="#l75.137"></a><span id="l75.137">             kind: &quot;calendar#event&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/calendar/test/unit/test_ics_parser.js</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_parser.js</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -4,17 +4,17 @@</span>
<a href="#l76.4"></a><span id="l76.4"> </span>
<a href="#l76.5"></a><span id="l76.5"> function run_test() {</span>
<a href="#l76.6"></a><span id="l76.6">     do_calendar_startup(really_run_test);</span>
<a href="#l76.7"></a><span id="l76.7"> }</span>
<a href="#l76.8"></a><span id="l76.8"> </span>
<a href="#l76.9"></a><span id="l76.9"> function really_run_test() {</span>
<a href="#l76.10"></a><span id="l76.10">     test_roundtrip();</span>
<a href="#l76.11"></a><span id="l76.11">     test_async();</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineminus">-    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l76.13"></a><span id="l76.13" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l76.14"></a><span id="l76.14">         test_failures();</span>
<a href="#l76.15"></a><span id="l76.15">     }</span>
<a href="#l76.16"></a><span id="l76.16">     test_fake_parent();</span>
<a href="#l76.17"></a><span id="l76.17">     test_props_comps();</span>
<a href="#l76.18"></a><span id="l76.18">     test_timezone();</span>
<a href="#l76.19"></a><span id="l76.19"> }</span>
<a href="#l76.20"></a><span id="l76.20"> </span>
<a href="#l76.21"></a><span id="l76.21"> function test_props_comps() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/calendar/test/unit/test_ics_service.js</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_service.js</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -9,17 +9,17 @@ function run_test() {</span>
<a href="#l77.4"></a><span id="l77.4"> function really_run_test() {</span>
<a href="#l77.5"></a><span id="l77.5">     test_iterator();</span>
<a href="#l77.6"></a><span id="l77.6">     test_icalcomponent();</span>
<a href="#l77.7"></a><span id="l77.7">     test_icsservice();</span>
<a href="#l77.8"></a><span id="l77.8">     test_icalstring();</span>
<a href="#l77.9"></a><span id="l77.9">     test_param();</span>
<a href="#l77.10"></a><span id="l77.10"> </span>
<a href="#l77.11"></a><span id="l77.11">     // Only supported with ical.js</span>
<a href="#l77.12"></a><span id="l77.12" class="difflineminus">-    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l77.13"></a><span id="l77.13" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l77.14"></a><span id="l77.14">         test_icalproperty();</span>
<a href="#l77.15"></a><span id="l77.15">     }</span>
<a href="#l77.16"></a><span id="l77.16"> }</span>
<a href="#l77.17"></a><span id="l77.17"> </span>
<a href="#l77.18"></a><span id="l77.18"> function test_icalstring() {</span>
<a href="#l77.19"></a><span id="l77.19">     function checkComp(createFunc, icalString, members, properties) {</span>
<a href="#l77.20"></a><span id="l77.20">         let thing = createFunc(icalString);</span>
<a href="#l77.21"></a><span id="l77.21">         equal(ics_unfoldline(thing.icalString), icalString + &quot;\r\n&quot;);</span>
<a href="#l77.22"></a><span id="l77.22" class="difflineat">@@ -70,17 +70,17 @@ function test_icalstring() {</span>
<a href="#l77.23"></a><span id="l77.23">     );</span>
<a href="#l77.24"></a><span id="l77.24"> </span>
<a href="#l77.25"></a><span id="l77.25">     let rrule = checkComp(cal.createRecurrenceRule.bind(cal),</span>
<a href="#l77.26"></a><span id="l77.26">         &quot;RRULE:FREQ=WEEKLY;COUNT=5;INTERVAL=2;BYDAY=MO&quot;,</span>
<a href="#l77.27"></a><span id="l77.27">         { count: 5, isByCount: true, type: &quot;WEEKLY&quot;, interval: 2 }</span>
<a href="#l77.28"></a><span id="l77.28">     );</span>
<a href="#l77.29"></a><span id="l77.29">     equal(rrule.getComponent(&quot;BYDAY&quot;, {}).toString(), [2].toString());</span>
<a href="#l77.30"></a><span id="l77.30"> </span>
<a href="#l77.31"></a><span id="l77.31" class="difflineminus">-    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l77.32"></a><span id="l77.32" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l77.33"></a><span id="l77.33">         let rdate = checkComp(cal.createRecurrenceDate.bind(cal),</span>
<a href="#l77.34"></a><span id="l77.34">                               &quot;RDATE:20120101T000000&quot;,</span>
<a href="#l77.35"></a><span id="l77.35">                               { isNegative: false });</span>
<a href="#l77.36"></a><span id="l77.36">         equal(rdate.date.compare(cal.createDateTime(&quot;20120101T000000&quot;)), 0);</span>
<a href="#l77.37"></a><span id="l77.37">     } else {</span>
<a href="#l77.38"></a><span id="l77.38">         let rdate = checkComp(cal.createRecurrenceDate.bind(cal),</span>
<a href="#l77.39"></a><span id="l77.39">                               &quot;RDATE;VALUE=DATE-TIME:20120101T000000&quot;,</span>
<a href="#l77.40"></a><span id="l77.40">                               { isNegative: false });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/calendar/test/unit/test_imip.js</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/calendar/test/unit/test_imip.js</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -1,13 +1,12 @@</span>
<a href="#l78.4"></a><span id="l78.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l78.5"></a><span id="l78.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l78.6"></a><span id="l78.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l78.7"></a><span id="l78.7"> </span>
<a href="#l78.8"></a><span id="l78.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l78.9"></a><span id="l78.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l78.10"></a><span id="l78.10"> var calItipEmailTransport = {};</span>
<a href="#l78.11"></a><span id="l78.11"> Services.scriptloader.loadSubScript(</span>
<a href="#l78.12"></a><span id="l78.12">     &quot;resource://calendar/components/calItipEmailTransport.js&quot;,</span>
<a href="#l78.13"></a><span id="l78.13">     calItipEmailTransport);</span>
<a href="#l78.14"></a><span id="l78.14"> </span>
<a href="#l78.15"></a><span id="l78.15"> function itipItemForTest(title, seq) {</span>
<a href="#l78.16"></a><span id="l78.16">     let itipItem = Cc[&quot;@mozilla.org/calendar/itip-item;1&quot;].createInstance(Ci.calIItipItem);</span>
<a href="#l78.17"></a><span id="l78.17" class="difflineat">@@ -21,30 +20,30 @@ function itipItemForTest(title, seq) {</span>
<a href="#l78.18"></a><span id="l78.18">         &quot;END:VCALENDAR&quot;</span>
<a href="#l78.19"></a><span id="l78.19">     ].join(&quot;\r\n&quot;));</span>
<a href="#l78.20"></a><span id="l78.20">     return itipItem;</span>
<a href="#l78.21"></a><span id="l78.21"> }</span>
<a href="#l78.22"></a><span id="l78.22"> </span>
<a href="#l78.23"></a><span id="l78.23"> let transport = new calItipEmailTransport.calItipEmailTransport();</span>
<a href="#l78.24"></a><span id="l78.24"> </span>
<a href="#l78.25"></a><span id="l78.25"> add_task(function test_title_in_subject() {</span>
<a href="#l78.26"></a><span id="l78.26" class="difflineminus">-    Preferences.set(&quot;calendar.itip.useInvitationSubjectPrefixes&quot;, false);</span>
<a href="#l78.27"></a><span id="l78.27" class="difflineplus">+    Services.prefs.setBoolPref(&quot;calendar.itip.useInvitationSubjectPrefixes&quot;, false);</span>
<a href="#l78.28"></a><span id="l78.28">     let items = transport._prepareItems(itipItemForTest(&quot;foo&quot;));</span>
<a href="#l78.29"></a><span id="l78.29">     equal(items.subject, &quot;foo&quot;);</span>
<a href="#l78.30"></a><span id="l78.30"> });</span>
<a href="#l78.31"></a><span id="l78.31"> </span>
<a href="#l78.32"></a><span id="l78.32"> add_task(function test_title_in_summary() {</span>
<a href="#l78.33"></a><span id="l78.33" class="difflineminus">-    Preferences.set(&quot;calendar.itip.useInvitationSubjectPrefixes&quot;, true);</span>
<a href="#l78.34"></a><span id="l78.34" class="difflineplus">+    Services.prefs.setBoolPref(&quot;calendar.itip.useInvitationSubjectPrefixes&quot;, true);</span>
<a href="#l78.35"></a><span id="l78.35">     let items = transport._prepareItems(itipItemForTest(&quot;bar&quot;));</span>
<a href="#l78.36"></a><span id="l78.36">     equal(items.subject, &quot;Invitation: bar&quot;);</span>
<a href="#l78.37"></a><span id="l78.37"> });</span>
<a href="#l78.38"></a><span id="l78.38"> </span>
<a href="#l78.39"></a><span id="l78.39"> add_task(function test_updated_title_in_subject() {</span>
<a href="#l78.40"></a><span id="l78.40" class="difflineminus">-    Preferences.set(&quot;calendar.itip.useInvitationSubjectPrefixes&quot;, false);</span>
<a href="#l78.41"></a><span id="l78.41" class="difflineplus">+    Services.prefs.setBoolPref(&quot;calendar.itip.useInvitationSubjectPrefixes&quot;, false);</span>
<a href="#l78.42"></a><span id="l78.42">     let items = transport._prepareItems(itipItemForTest(&quot;foo&quot;, 2));</span>
<a href="#l78.43"></a><span id="l78.43">     equal(items.subject, &quot;foo&quot;);</span>
<a href="#l78.44"></a><span id="l78.44"> });</span>
<a href="#l78.45"></a><span id="l78.45"> </span>
<a href="#l78.46"></a><span id="l78.46"> add_task(function test_updated_title_in_summary() {</span>
<a href="#l78.47"></a><span id="l78.47" class="difflineminus">-    Preferences.set(&quot;calendar.itip.useInvitationSubjectPrefixes&quot;, true);</span>
<a href="#l78.48"></a><span id="l78.48" class="difflineplus">+    Services.prefs.setBoolPref(&quot;calendar.itip.useInvitationSubjectPrefixes&quot;, true);</span>
<a href="#l78.49"></a><span id="l78.49">     let items = transport._prepareItems(itipItemForTest(&quot;bar&quot;, 2));</span>
<a href="#l78.50"></a><span id="l78.50">     equal(items.subject, &quot;Updated: bar&quot;);</span>
<a href="#l78.51"></a><span id="l78.51"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/calendar/test/unit/test_l10n_utils.js</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/calendar/test/unit/test_l10n_utils.js</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -1,13 +1,12 @@</span>
<a href="#l79.4"></a><span id="l79.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l79.5"></a><span id="l79.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l79.6"></a><span id="l79.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l79.7"></a><span id="l79.7"> </span>
<a href="#l79.8"></a><span id="l79.8" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l79.9"></a><span id="l79.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l79.10"></a><span id="l79.10"> </span>
<a href="#l79.11"></a><span id="l79.11"> function run_test() {</span>
<a href="#l79.12"></a><span id="l79.12">     do_calendar_startup(run_next_test);</span>
<a href="#l79.13"></a><span id="l79.13"> }</span>
<a href="#l79.14"></a><span id="l79.14"> </span>
<a href="#l79.15"></a><span id="l79.15"> // tests for calL10NUtils.jsm</span>
<a href="#l79.16"></a><span id="l79.16"> /* Incomplete - still missing test coverage for:</span>
<a href="#l79.17"></a><span id="l79.17" class="difflineat">@@ -49,17 +48,17 @@ add_task(async function calendarInfo_tes</span>
<a href="#l79.18"></a><span id="l79.18">         input: { locale: null }, // this also would trigger caching tests</span>
<a href="#l79.19"></a><span id="l79.19">         expected: {</span>
<a href="#l79.20"></a><span id="l79.20">             properties: [</span>
<a href="#l79.21"></a><span id="l79.21">                 &quot;firstDayOfWeek&quot;, &quot;minDays&quot;, &quot;weekendStart&quot;, &quot;weekendEnd&quot;,</span>
<a href="#l79.22"></a><span id="l79.22">                 &quot;calendar&quot;, &quot;locale&quot;</span>
<a href="#l79.23"></a><span id="l79.23">             ]</span>
<a href="#l79.24"></a><span id="l79.24">         }</span>
<a href="#l79.25"></a><span id="l79.25">     }];</span>
<a href="#l79.26"></a><span id="l79.26" class="difflineminus">-    let useOSLocaleFormat = Preferences.get(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l79.27"></a><span id="l79.27" class="difflineplus">+    let useOSLocaleFormat = Services.prefs.getBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l79.28"></a><span id="l79.28">     let osprefs = Cc[&quot;@mozilla.org/intl/ospreferences;1&quot;].getService(Ci.mozIOSPreferences);</span>
<a href="#l79.29"></a><span id="l79.29">     let appLocale = Services.locale.appLocalesAsBCP47[0];</span>
<a href="#l79.30"></a><span id="l79.30">     let rsLocale = osprefs.regionalPrefsLocales[0];</span>
<a href="#l79.31"></a><span id="l79.31"> </span>
<a href="#l79.32"></a><span id="l79.32">     let i = 0;</span>
<a href="#l79.33"></a><span id="l79.33">     for (let test of data) {</span>
<a href="#l79.34"></a><span id="l79.34">         i++;</span>
<a href="#l79.35"></a><span id="l79.35">         let info = cal.l10n.calendarInfo(test.input.locale);</span>
<a href="#l79.36"></a><span id="l79.36" class="difflineat">@@ -71,17 +70,17 @@ add_task(async function calendarInfo_tes</span>
<a href="#l79.37"></a><span id="l79.37">         for (let prop of test.expected.properties) {</span>
<a href="#l79.38"></a><span id="l79.38">             ok(prop in info, prop + &quot; exists (test #&quot; + i + &quot;)&quot;);</span>
<a href="#l79.39"></a><span id="l79.39">         }</span>
<a href="#l79.40"></a><span id="l79.40"> </span>
<a href="#l79.41"></a><span id="l79.41">         if (!test.input.locale &amp;&amp; appLocale != rsLocale) {</span>
<a href="#l79.42"></a><span id="l79.42">             // if aLocale is null we test with the current date and time formatting setting</span>
<a href="#l79.43"></a><span id="l79.43">             // let's test the caching mechanism - this test section is pointless if app and</span>
<a href="#l79.44"></a><span id="l79.44">             // OS locale are the same like probably on automation</span>
<a href="#l79.45"></a><span id="l79.45" class="difflineminus">-            Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, !useOSLocaleFormat);</span>
<a href="#l79.46"></a><span id="l79.46" class="difflineplus">+            Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, !useOSLocaleFormat);</span>
<a href="#l79.47"></a><span id="l79.47">             let info2 = cal.l10n.calendarInfo();</span>
<a href="#l79.48"></a><span id="l79.48">             equal(</span>
<a href="#l79.49"></a><span id="l79.49">                 Object.keys(info).length,</span>
<a href="#l79.50"></a><span id="l79.50">                 test.expected.properties.length,</span>
<a href="#l79.51"></a><span id="l79.51">                 &quot;caching test - equal number of properties (test #&quot; + i + &quot;)&quot;</span>
<a href="#l79.52"></a><span id="l79.52">             );</span>
<a href="#l79.53"></a><span id="l79.53">             for (let prop of Object.keys(info)) {</span>
<a href="#l79.54"></a><span id="l79.54">                 ok(prop in info2,</span>
<a href="#l79.55"></a><span id="l79.55" class="difflineat">@@ -90,17 +89,17 @@ add_task(async function calendarInfo_tes</span>
<a href="#l79.56"></a><span id="l79.56">                     info2[prop],</span>
<a href="#l79.57"></a><span id="l79.57">                     info[prop],</span>
<a href="#l79.58"></a><span id="l79.58">                     &quot;caching test - value for &quot; + prop + &quot; is equal in both objects (test #&quot; + i + &quot;)&quot;</span>
<a href="#l79.59"></a><span id="l79.59">                 );</span>
<a href="#l79.60"></a><span id="l79.60">             }</span>
<a href="#l79.61"></a><span id="l79.61">             // we reset the cache and test again - it's suffient here to find one changed property,</span>
<a href="#l79.62"></a><span id="l79.62">             // so we use locale since that must change always in that scenario</span>
<a href="#l79.63"></a><span id="l79.63">             // info2 = cal.l10n.calendarInfo(null, true);</span>
<a href="#l79.64"></a><span id="l79.64" class="difflineminus">-            Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, useOSLocaleFormat);</span>
<a href="#l79.65"></a><span id="l79.65" class="difflineplus">+            Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, useOSLocaleFormat);</span>
<a href="#l79.66"></a><span id="l79.66">             // This is currently disabled since the code actually doesn't reset the cache anyway.</span>
<a href="#l79.67"></a><span id="l79.67">             // When re-enabling, be aware that macOS returns just &quot;en&quot; for rsLocale while other</span>
<a href="#l79.68"></a><span id="l79.68">             // OS provide &quot;en-US&quot;.</span>
<a href="#l79.69"></a><span id="l79.69">             /*</span>
<a href="#l79.70"></a><span id="l79.70">             notEqual(</span>
<a href="#l79.71"></a><span id="l79.71">                 info2.locale,</span>
<a href="#l79.72"></a><span id="l79.72">                 info.locale,</span>
<a href="#l79.73"></a><span id="l79.73">                 &quot;caching retest - value for locale is different in both objects (test #&quot; + i + &quot;)&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/calendar/test/unit/test_ltninvitationutils.js</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/calendar/test/unit/test_ltninvitationutils.js</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l80.4"></a><span id="l80.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l80.5"></a><span id="l80.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l80.6"></a><span id="l80.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l80.7"></a><span id="l80.7"> </span>
<a href="#l80.8"></a><span id="l80.8"> var { ltn } = ChromeUtils.import(&quot;resource://calendar/modules/ltnInvitationUtils.jsm&quot;);</span>
<a href="#l80.9"></a><span id="l80.9"> var { MailServices } = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l80.10"></a><span id="l80.10" class="difflineminus">-var { Preferences } = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l80.11"></a><span id="l80.11" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l80.12"></a><span id="l80.12"> </span>
<a href="#l80.13"></a><span id="l80.13"> function run_test() {</span>
<a href="#l80.14"></a><span id="l80.14">     do_calendar_startup(run_next_test);</span>
<a href="#l80.15"></a><span id="l80.15"> }</span>
<a href="#l80.16"></a><span id="l80.16"> </span>
<a href="#l80.17"></a><span id="l80.17"> // tests for ltnInvitationUtils.jsm</span>
<a href="#l80.18"></a><span id="l80.18"> </span>
<a href="#l80.19"></a><span id="l80.19"> function getIcs(aAsArray=false) {</span>
<a href="#l80.20"></a><span id="l80.20" class="difflineat">@@ -503,22 +503,22 @@ add_task(async function compareInvitatio</span>
<a href="#l80.21"></a><span id="l80.21">                 &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;attendee4@example.net&lt;/span&gt;&quot;,</span>
<a href="#l80.22"></a><span id="l80.22">                 &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;attendee1@example.net&lt;/span&gt;&quot;</span>
<a href="#l80.23"></a><span id="l80.23">             ]</span>
<a href="#l80.24"></a><span id="l80.24">         }</span>
<a href="#l80.25"></a><span id="l80.25">     }];</span>
<a href="#l80.26"></a><span id="l80.26">     // make sure that the Europe/Berlin timezone and long datetime format is set</span>
<a href="#l80.27"></a><span id="l80.27">     // and to use the app locale to avoid test failures when running locally on</span>
<a href="#l80.28"></a><span id="l80.28">     // an OS with a regional setting other than en-US</span>
<a href="#l80.29"></a><span id="l80.29" class="difflineminus">-    let dateformat = Preferences.get(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l80.30"></a><span id="l80.30" class="difflineminus">-    let tzlocal = Preferences.get(&quot;calendar.timezone.local&quot;, &quot;Europe/Berlin&quot;);</span>
<a href="#l80.31"></a><span id="l80.31" class="difflineminus">-    let useOsLocale = Preferences.get(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l80.32"></a><span id="l80.32" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l80.33"></a><span id="l80.33" class="difflineminus">-    Preferences.set(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l80.34"></a><span id="l80.34" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Europe/Berlin&quot;);</span>
<a href="#l80.35"></a><span id="l80.35" class="difflineplus">+    let dateformat = Services.prefs.getIntPref(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l80.36"></a><span id="l80.36" class="difflineplus">+    let tzlocal = Services.prefs.getStringPref(&quot;calendar.timezone.local&quot;, &quot;Europe/Berlin&quot;);</span>
<a href="#l80.37"></a><span id="l80.37" class="difflineplus">+    let useOsLocale = Services.prefs.getBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l80.38"></a><span id="l80.38" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l80.39"></a><span id="l80.39" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l80.40"></a><span id="l80.40" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;Europe/Berlin&quot;);</span>
<a href="#l80.41"></a><span id="l80.41">     let i = 0;</span>
<a href="#l80.42"></a><span id="l80.42">     for (let test of data) {</span>
<a href="#l80.43"></a><span id="l80.43">         i++;</span>
<a href="#l80.44"></a><span id="l80.44">         let dom1 = getDom(test.input.previous);</span>
<a href="#l80.45"></a><span id="l80.45">         let dom2 = getDom(test.input.current);</span>
<a href="#l80.46"></a><span id="l80.46">         let result = ltn.invitation.compareInvitationOverlay(dom1, dom2, test.input.ignore);</span>
<a href="#l80.47"></a><span id="l80.47">         let dom = cal.xml.parseString(result);</span>
<a href="#l80.48"></a><span id="l80.48">         if (test.expected.node.startsWith(&quot;imipHtml&quot;)) {</span>
<a href="#l80.49"></a><span id="l80.49" class="difflineat">@@ -541,19 +541,19 @@ add_task(async function compareInvitatio</span>
<a href="#l80.50"></a><span id="l80.50">                           test.expected.node + &quot;(entry #&quot; + j + &quot;)&quot;);</span>
<a href="#l80.51"></a><span id="l80.51">                 }</span>
<a href="#l80.52"></a><span id="l80.52">             }</span>
<a href="#l80.53"></a><span id="l80.53">             equal(test.expected.each.length, j,</span>
<a href="#l80.54"></a><span id="l80.54">                   &quot;(test #&quot; + i + &quot;): completeness check &quot; + test.expected.node);</span>
<a href="#l80.55"></a><span id="l80.55">         }</span>
<a href="#l80.56"></a><span id="l80.56">     }</span>
<a href="#l80.57"></a><span id="l80.57">     // let's reset setting</span>
<a href="#l80.58"></a><span id="l80.58" class="difflineminus">-    Preferences.set(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l80.59"></a><span id="l80.59" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l80.60"></a><span id="l80.60" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l80.61"></a><span id="l80.61" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l80.62"></a><span id="l80.62" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l80.63"></a><span id="l80.63" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l80.64"></a><span id="l80.64"> });</span>
<a href="#l80.65"></a><span id="l80.65"> </span>
<a href="#l80.66"></a><span id="l80.66"> add_task(async function getHeaderSection_test() {</span>
<a href="#l80.67"></a><span id="l80.67">     let data = [{</span>
<a href="#l80.68"></a><span id="l80.68">         input: {</span>
<a href="#l80.69"></a><span id="l80.69">             toList: &quot;recipient@example.net&quot;,</span>
<a href="#l80.70"></a><span id="l80.70">             subject: &quot;Invitation: test subject&quot;,</span>
<a href="#l80.71"></a><span id="l80.71">             identity: {</span>
<a href="#l80.72"></a><span id="l80.72" class="difflineat">@@ -772,29 +772,29 @@ add_task(async function getRfc5322Format</span>
<a href="#l80.73"></a><span id="l80.73">         }, {</span>
<a href="#l80.74"></a><span id="l80.74">             date: &quot;Sat, 24 Jan 2015 09:24:49&quot;,</span>
<a href="#l80.75"></a><span id="l80.75">             timezone: &quot;floating&quot;</span>
<a href="#l80.76"></a><span id="l80.76">         }],</span>
<a href="#l80.77"></a><span id="l80.77">         expected: /^\w{3}, \d{2} \w{3} \d{4} \d{2}:\d{2}:\d{2} [+-]\d{4}$/</span>
<a href="#l80.78"></a><span id="l80.78">     };</span>
<a href="#l80.79"></a><span id="l80.79"> </span>
<a href="#l80.80"></a><span id="l80.80">     let i = 0;</span>
<a href="#l80.81"></a><span id="l80.81" class="difflineminus">-    let timezone = Preferences.get(&quot;calendar.timezone.local&quot;, null);</span>
<a href="#l80.82"></a><span id="l80.82" class="difflineplus">+    let timezone = Services.prefs.getStringPref(&quot;calendar.timezone.local&quot;, null);</span>
<a href="#l80.83"></a><span id="l80.83">     for (let test of data.input) {</span>
<a href="#l80.84"></a><span id="l80.84">         i++;</span>
<a href="#l80.85"></a><span id="l80.85">         if (test.timezone) {</span>
<a href="#l80.86"></a><span id="l80.86" class="difflineminus">-            Preferences.set(&quot;calendar.timezone.local&quot;, test.timezone);</span>
<a href="#l80.87"></a><span id="l80.87" class="difflineplus">+            Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, test.timezone);</span>
<a href="#l80.88"></a><span id="l80.88">         } else {</span>
<a href="#l80.89"></a><span id="l80.89" class="difflineminus">-            Preferences.reset(&quot;calendar.timezone.local&quot;);</span>
<a href="#l80.90"></a><span id="l80.90" class="difflineplus">+            Services.prefs.clearUserPref(&quot;calendar.timezone.local&quot;);</span>
<a href="#l80.91"></a><span id="l80.91">         }</span>
<a href="#l80.92"></a><span id="l80.92">         let date = test.date ? new Date(test.date) : null;</span>
<a href="#l80.93"></a><span id="l80.93">         let re = new RegExp(data.expected);</span>
<a href="#l80.94"></a><span id="l80.94">         ok(re.test(ltn.invitation.getRfc5322FormattedDate(date)), &quot;(test #&quot; + i + &quot;)&quot;);</span>
<a href="#l80.95"></a><span id="l80.95">     }</span>
<a href="#l80.96"></a><span id="l80.96" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, timezone);</span>
<a href="#l80.97"></a><span id="l80.97" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, timezone);</span>
<a href="#l80.98"></a><span id="l80.98"> });</span>
<a href="#l80.99"></a><span id="l80.99"> </span>
<a href="#l80.100"></a><span id="l80.100"> add_task(async function parseCounter_test() {</span>
<a href="#l80.101"></a><span id="l80.101">     // We are disabling this rule for a more consistent display of this data</span>
<a href="#l80.102"></a><span id="l80.102">     /* eslint-disable object-curly-newline */</span>
<a href="#l80.103"></a><span id="l80.103">     let data = [{</span>
<a href="#l80.104"></a><span id="l80.104">         // #1: basic test to check all currently supported properties</span>
<a href="#l80.105"></a><span id="l80.105">         input: {</span>
<a href="#l80.106"></a><span id="l80.106" class="difflineat">@@ -1026,18 +1026,18 @@ add_task(async function parseCounter_tes</span>
<a href="#l80.107"></a><span id="l80.107">             },</span>
<a href="#l80.108"></a><span id="l80.108">             differences: []</span>
<a href="#l80.109"></a><span id="l80.109">         }</span>
<a href="#l80.110"></a><span id="l80.110">     }];</span>
<a href="#l80.111"></a><span id="l80.111">     /* eslint-enable object-curly-newline */</span>
<a href="#l80.112"></a><span id="l80.112"> </span>
<a href="#l80.113"></a><span id="l80.113">     // make sure to use the app locale to avoid test failures when running</span>
<a href="#l80.114"></a><span id="l80.114">     // locally on an OS with a regional setting other than en-US</span>
<a href="#l80.115"></a><span id="l80.115" class="difflineminus">-    let useOsLocale = Preferences.get(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l80.116"></a><span id="l80.116" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l80.117"></a><span id="l80.117" class="difflineplus">+    let useOsLocale = Services.prefs.getBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l80.118"></a><span id="l80.118" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, false);</span>
<a href="#l80.119"></a><span id="l80.119"> </span>
<a href="#l80.120"></a><span id="l80.120">     let getItem = function(aProperties) {</span>
<a href="#l80.121"></a><span id="l80.121">         let item = getIcs(true);</span>
<a href="#l80.122"></a><span id="l80.122"> </span>
<a href="#l80.123"></a><span id="l80.123">         let modifyProperty = function(aRegex, aReplacement, aInVevent) {</span>
<a href="#l80.124"></a><span id="l80.124">             let inVevent = false;</span>
<a href="#l80.125"></a><span id="l80.125">             let i = 0;</span>
<a href="#l80.126"></a><span id="l80.126">             item.forEach(aProp =&gt; {</span>
<a href="#l80.127"></a><span id="l80.127" class="difflineat">@@ -1137,10 +1137,10 @@ add_task(async function parseCounter_tes</span>
<a href="#l80.128"></a><span id="l80.128">             }</span>
<a href="#l80.129"></a><span id="l80.129">         });</span>
<a href="#l80.130"></a><span id="l80.130">         ok(additionalProps.length == 0, &quot;(test #&quot; + i + &quot;: differences: check for unexpectedly &quot;+</span>
<a href="#l80.131"></a><span id="l80.131">                                         &quot;occurring additional properties &quot; + additionalProps + &quot;)&quot;);</span>
<a href="#l80.132"></a><span id="l80.132">         ok(missingProps.length == 0, &quot;(test #&quot; + i + &quot;: differences: check for unexpectedly &quot; +</span>
<a href="#l80.133"></a><span id="l80.133">                                      &quot;missing properties &quot; + missingProps + &quot;)&quot;);</span>
<a href="#l80.134"></a><span id="l80.134">     }</span>
<a href="#l80.135"></a><span id="l80.135"> </span>
<a href="#l80.136"></a><span id="l80.136" class="difflineminus">-    Preferences.set(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l80.137"></a><span id="l80.137" class="difflineplus">+    Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l80.138"></a><span id="l80.138"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/calendar/test/unit/test_utils.js</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/calendar/test/unit/test_utils.js</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -12,18 +12,18 @@ function really_run_test() {</span>
<a href="#l81.4"></a><span id="l81.4">     test_getDefaultStartDate();</span>
<a href="#l81.5"></a><span id="l81.5">     test_getStartEndProps();</span>
<a href="#l81.6"></a><span id="l81.6">     test_OperationGroup();</span>
<a href="#l81.7"></a><span id="l81.7">     test_sameDay();</span>
<a href="#l81.8"></a><span id="l81.8">     test_binarySearch();</span>
<a href="#l81.9"></a><span id="l81.9"> }</span>
<a href="#l81.10"></a><span id="l81.10"> </span>
<a href="#l81.11"></a><span id="l81.11"> function test_recentzones() {</span>
<a href="#l81.12"></a><span id="l81.12" class="difflineminus">-    let oldDefaultTz = Preferences.get(&quot;calendar.timezone.local&quot;, &quot;&quot;);</span>
<a href="#l81.13"></a><span id="l81.13" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;floating&quot;);</span>
<a href="#l81.14"></a><span id="l81.14" class="difflineplus">+    let oldDefaultTz = Services.prefs.getStringPref(&quot;calendar.timezone.local&quot;, &quot;&quot;);</span>
<a href="#l81.15"></a><span id="l81.15" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;floating&quot;);</span>
<a href="#l81.16"></a><span id="l81.16"> </span>
<a href="#l81.17"></a><span id="l81.17">     equal(cal.dtz.getRecentTimezones().length, 0);</span>
<a href="#l81.18"></a><span id="l81.18">     equal(cal.dtz.getRecentTimezones(true).length, 0);</span>
<a href="#l81.19"></a><span id="l81.19"> </span>
<a href="#l81.20"></a><span id="l81.20">     cal.dtz.saveRecentTimezone(&quot;Europe/Berlin&quot;);</span>
<a href="#l81.21"></a><span id="l81.21"> </span>
<a href="#l81.22"></a><span id="l81.22">     let zones = cal.dtz.getRecentTimezones();</span>
<a href="#l81.23"></a><span id="l81.23">     equal(zones.length, 1);</span>
<a href="#l81.24"></a><span id="l81.24" class="difflineat">@@ -43,17 +43,17 @@ function test_recentzones() {</span>
<a href="#l81.25"></a><span id="l81.25">     cal.dtz.saveRecentTimezone(&quot;America/New_York&quot;);</span>
<a href="#l81.26"></a><span id="l81.26">     equal(cal.dtz.getRecentTimezones().length, 2);</span>
<a href="#l81.27"></a><span id="l81.27">     equal(cal.dtz.getRecentTimezones(true).length, 2);</span>
<a href="#l81.28"></a><span id="l81.28"> </span>
<a href="#l81.29"></a><span id="l81.29">     cal.dtz.saveRecentTimezone(&quot;Unknown&quot;);</span>
<a href="#l81.30"></a><span id="l81.30">     equal(cal.dtz.getRecentTimezones().length, 3);</span>
<a href="#l81.31"></a><span id="l81.31">     equal(cal.dtz.getRecentTimezones(true).length, 2);</span>
<a href="#l81.32"></a><span id="l81.32"> </span>
<a href="#l81.33"></a><span id="l81.33" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, oldDefaultTz);</span>
<a href="#l81.34"></a><span id="l81.34" class="difflineplus">+    Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, oldDefaultTz);</span>
<a href="#l81.35"></a><span id="l81.35"> }</span>
<a href="#l81.36"></a><span id="l81.36"> </span>
<a href="#l81.37"></a><span id="l81.37"> function test_formatcss() {</span>
<a href="#l81.38"></a><span id="l81.38">     equal(cal.view.formatStringForCSSRule(&quot; &quot;), &quot;_&quot;);</span>
<a href="#l81.39"></a><span id="l81.39">     equal(cal.view.formatStringForCSSRule(&quot;&quot;), &quot;-uxfc-&quot;);</span>
<a href="#l81.40"></a><span id="l81.40">     equal(cal.view.formatStringForCSSRule(&quot;a&quot;), &quot;a&quot;);</span>
<a href="#l81.41"></a><span id="l81.41"> }</span>
<a href="#l81.42"></a><span id="l81.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l82.1"></a><span id="l82.1" class="difflineminus">--- a/calendar/test/unit/test_weekinfo_service.js</span>
<a href="#l82.2"></a><span id="l82.2" class="difflineplus">+++ b/calendar/test/unit/test_weekinfo_service.js</span>
<a href="#l82.3"></a><span id="l82.3" class="difflineat">@@ -14,19 +14,19 @@ function run_test() {</span>
<a href="#l82.4"></a><span id="l82.4">         [0, 1, &quot;20170101T000000Z&quot;],    // Year that starts on Sunday ...</span>
<a href="#l82.5"></a><span id="l82.5">         [3, 52, &quot;20180101T000000Z&quot;],   // ... Monday</span>
<a href="#l82.6"></a><span id="l82.6">         [0, 1, &quot;20190101T000000Z&quot;],    // ... Tuesday</span>
<a href="#l82.7"></a><span id="l82.7">         [4, 52, &quot;20200101T000000Z&quot;],   // ... Wednesday</span>
<a href="#l82.8"></a><span id="l82.8">         [0, 1, &quot;20260101T000000Z&quot;],    // ... Thursday</span>
<a href="#l82.9"></a><span id="l82.9">         [0, 53, &quot;20270101T000000Z&quot;],   // ... Friday</span>
<a href="#l82.10"></a><span id="l82.10">         [0, 52, &quot;20280101T000000Z&quot;]];  // ... Saturday</span>
<a href="#l82.11"></a><span id="l82.11"> </span>
<a href="#l82.12"></a><span id="l82.12" class="difflineminus">-    let savedWeekStart = Preferences.get(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l82.13"></a><span id="l82.13" class="difflineplus">+    let savedWeekStart = Services.prefs.getIntPref(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l82.14"></a><span id="l82.14">     for (let [weekStart, weekNumber, dateString] of wkst_wknum_date) {</span>
<a href="#l82.15"></a><span id="l82.15" class="difflineminus">-        Preferences.set(&quot;calendar.week.start&quot;, weekStart);</span>
<a href="#l82.16"></a><span id="l82.16" class="difflineplus">+        Services.prefs.setIntPref(&quot;calendar.week.start&quot;, weekStart);</span>
<a href="#l82.17"></a><span id="l82.17">         let date = cal.createDateTime(dateString);</span>
<a href="#l82.18"></a><span id="l82.18">         date.isDate = true;</span>
<a href="#l82.19"></a><span id="l82.19">         let week = cal.getWeekInfoService().getWeekTitle(date);</span>
<a href="#l82.20"></a><span id="l82.20"> </span>
<a href="#l82.21"></a><span id="l82.21">         equal(week, weekNumber, &quot;Week number matches for &quot; + dateString);</span>
<a href="#l82.22"></a><span id="l82.22">     }</span>
<a href="#l82.23"></a><span id="l82.23" class="difflineminus">-    Preferences.set(&quot;calendar.week.start&quot;, savedWeekStart);</span>
<a href="#l82.24"></a><span id="l82.24" class="difflineplus">+    Services.prefs.setIntPref(&quot;calendar.week.start&quot;, savedWeekStart);</span>
<a href="#l82.25"></a><span id="l82.25"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l83.1"></a><span id="l83.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.js</span>
<a href="#l83.2"></a><span id="l83.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.js</span>
<a href="#l83.3"></a><span id="l83.3" class="difflineat">@@ -14,17 +14,16 @@</span>
<a href="#l83.4"></a><span id="l83.4"> ChromeUtils.import(&quot;resource:///modules/activity/activityModules.jsm&quot;);</span>
<a href="#l83.5"></a><span id="l83.5"> var {</span>
<a href="#l83.6"></a><span id="l83.6">   getSearchTokens,</span>
<a href="#l83.7"></a><span id="l83.7">   getModelQuery,</span>
<a href="#l83.8"></a><span id="l83.8">   generateQueryURI,</span>
<a href="#l83.9"></a><span id="l83.9"> } = ChromeUtils.import(&quot;resource:///modules/ABQueryUtils.jsm&quot;);</span>
<a href="#l83.10"></a><span id="l83.10"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l83.11"></a><span id="l83.11"> var {PluralForm} = ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l83.12"></a><span id="l83.12" class="difflineminus">-var {Preferences} = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l83.13"></a><span id="l83.13"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l83.14"></a><span id="l83.14"> var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l83.15"></a><span id="l83.15"> </span>
<a href="#l83.16"></a><span id="l83.16"> XPCOMUtils.defineLazyModuleGetters(this, {</span>
<a href="#l83.17"></a><span id="l83.17">   LightweightThemeManager: &quot;resource://gre/modules/LightweightThemeManager.jsm&quot;,</span>
<a href="#l83.18"></a><span id="l83.18"> });</span>
<a href="#l83.19"></a><span id="l83.19"> </span>
<a href="#l83.20"></a><span id="l83.20"> var nsIAbListener = Ci.nsIAbListener;</span>
<a href="#l83.21"></a><span id="l83.21" class="difflineat">@@ -755,18 +754,18 @@ function getMailToolbox() {</span>
<a href="#l83.22"></a><span id="l83.22"> var kOSXDirectoryURI = &quot;moz-abosxdirectory:///&quot;;</span>
<a href="#l83.23"></a><span id="l83.23"> var kOSXPrefBase = &quot;ldap_2.servers.osx&quot;;</span>
<a href="#l83.24"></a><span id="l83.24"> </span>
<a href="#l83.25"></a><span id="l83.25"> function AbOSXAddressBookExists() {</span>
<a href="#l83.26"></a><span id="l83.26">   // I hate doing it this way - until we redo how we manage address books</span>
<a href="#l83.27"></a><span id="l83.27">   // I can't think of a better way though.</span>
<a href="#l83.28"></a><span id="l83.28"> </span>
<a href="#l83.29"></a><span id="l83.29">   // See if the pref exists, if so, then we need to delete the address book</span>
<a href="#l83.30"></a><span id="l83.30" class="difflineminus">-  var uriPresent = Preferences.get(kOSXPrefBase + &quot;.uri&quot;, null) == kOSXDirectoryURI;</span>
<a href="#l83.31"></a><span id="l83.31" class="difflineminus">-  var position = Preferences.get(kOSXPrefBase + &quot;.position&quot;, 1);</span>
<a href="#l83.32"></a><span id="l83.32" class="difflineplus">+  var uriPresent = Services.prefs.getStringPref(kOSXPrefBase + &quot;.uri&quot;, null) == kOSXDirectoryURI;</span>
<a href="#l83.33"></a><span id="l83.33" class="difflineplus">+  var position = Services.prefs.getIntPref(kOSXPrefBase + &quot;.position&quot;, 1);</span>
<a href="#l83.34"></a><span id="l83.34"> </span>
<a href="#l83.35"></a><span id="l83.35">   // Address book exists if the uri is correct and the position is not zero.</span>
<a href="#l83.36"></a><span id="l83.36">   return uriPresent &amp;&amp; position != 0;</span>
<a href="#l83.37"></a><span id="l83.37"> }</span>
<a href="#l83.38"></a><span id="l83.38"> </span>
<a href="#l83.39"></a><span id="l83.39"> function AbShowHideOSXAddressBook() {</span>
<a href="#l83.40"></a><span id="l83.40">   if (AbOSXAddressBookExists()) {</span>
<a href="#l83.41"></a><span id="l83.41">     MailServices.ab.deleteAddressBook(kOSXDirectoryURI);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l84.1"></a><span id="l84.1" class="difflineminus">--- a/mailnews/base/src/msgOAuth2Module.js</span>
<a href="#l84.2"></a><span id="l84.2" class="difflineplus">+++ b/mailnews/base/src/msgOAuth2Module.js</span>
<a href="#l84.3"></a><span id="l84.3" class="difflineat">@@ -1,17 +1,16 @@</span>
<a href="#l84.4"></a><span id="l84.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l84.5"></a><span id="l84.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l84.6"></a><span id="l84.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l84.7"></a><span id="l84.7"> </span>
<a href="#l84.8"></a><span id="l84.8"> &quot;use strict&quot;;</span>
<a href="#l84.9"></a><span id="l84.9"> </span>
<a href="#l84.10"></a><span id="l84.10"> var {OAuth2} = ChromeUtils.import(&quot;resource:///modules/OAuth2.jsm&quot;);</span>
<a href="#l84.11"></a><span id="l84.11"> var {OAuth2Providers} = ChromeUtils.import(&quot;resource:///modules/OAuth2Providers.jsm&quot;);</span>
<a href="#l84.12"></a><span id="l84.12" class="difflineminus">-var {Preferences} = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l84.13"></a><span id="l84.13"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l84.14"></a><span id="l84.14"> var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l84.15"></a><span id="l84.15"> </span>
<a href="#l84.16"></a><span id="l84.16"> function OAuth2Module() {</span>
<a href="#l84.17"></a><span id="l84.17">   this._refreshToken = '';</span>
<a href="#l84.18"></a><span id="l84.18"> }</span>
<a href="#l84.19"></a><span id="l84.19"> OAuth2Module.prototype = {</span>
<a href="#l84.20"></a><span id="l84.20">   // XPCOM registration stuff</span>
<a href="#l84.21"></a><span id="l84.21" class="difflineat">@@ -30,29 +29,29 @@ OAuth2Module.prototype = {</span>
<a href="#l84.22"></a><span id="l84.22">       aServer.username, aServer.hostname);</span>
<a href="#l84.23"></a><span id="l84.23">   },</span>
<a href="#l84.24"></a><span id="l84.24">   initFromMail(aServer) {</span>
<a href="#l84.25"></a><span id="l84.25">     return this._initPrefs(&quot;mail.server.&quot; + aServer.key + &quot;.&quot;,</span>
<a href="#l84.26"></a><span id="l84.26">       aServer.username, aServer.realHostName);</span>
<a href="#l84.27"></a><span id="l84.27">   },</span>
<a href="#l84.28"></a><span id="l84.28">   _initPrefs(root, aUsername, aHostname) {</span>
<a href="#l84.29"></a><span id="l84.29">     // Load all of the parameters from preferences.</span>
<a href="#l84.30"></a><span id="l84.30" class="difflineminus">-    let issuer = Preferences.get(root + &quot;oauth2.issuer&quot;, &quot;&quot;);</span>
<a href="#l84.31"></a><span id="l84.31" class="difflineminus">-    let scope = Preferences.get(root + &quot;oauth2.scope&quot;, &quot;&quot;);</span>
<a href="#l84.32"></a><span id="l84.32" class="difflineplus">+    let issuer = Services.prefs.getStringPref(root + &quot;oauth2.issuer&quot;, &quot;&quot;);</span>
<a href="#l84.33"></a><span id="l84.33" class="difflineplus">+    let scope = Services.prefs.getStringPref(root + &quot;oauth2.scope&quot;, &quot;&quot;);</span>
<a href="#l84.34"></a><span id="l84.34"> </span>
<a href="#l84.35"></a><span id="l84.35">     // These properties are absolutely essential to OAuth2 support. If we don't</span>
<a href="#l84.36"></a><span id="l84.36">     // have them, we don't support OAuth2.</span>
<a href="#l84.37"></a><span id="l84.37">     if (!issuer || !scope) {</span>
<a href="#l84.38"></a><span id="l84.38">       // Since we currently only support gmail, init values if server matches.</span>
<a href="#l84.39"></a><span id="l84.39">       let details = OAuth2Providers.getHostnameDetails(aHostname);</span>
<a href="#l84.40"></a><span id="l84.40">       if (details)</span>
<a href="#l84.41"></a><span id="l84.41">       {</span>
<a href="#l84.42"></a><span id="l84.42">         [issuer, scope] = details;</span>
<a href="#l84.43"></a><span id="l84.43" class="difflineminus">-        Preferences.set(root + &quot;oauth2.issuer&quot;, issuer);</span>
<a href="#l84.44"></a><span id="l84.44" class="difflineminus">-        Preferences.set(root + &quot;oauth2.scope&quot;, scope);</span>
<a href="#l84.45"></a><span id="l84.45" class="difflineplus">+        Services.prefs.setStringPref(root + &quot;oauth2.issuer&quot;, issuer);</span>
<a href="#l84.46"></a><span id="l84.46" class="difflineplus">+        Services.prefs.setStringPref(root + &quot;oauth2.scope&quot;, scope);</span>
<a href="#l84.47"></a><span id="l84.47">       }</span>
<a href="#l84.48"></a><span id="l84.48">       else</span>
<a href="#l84.49"></a><span id="l84.49">         return false;</span>
<a href="#l84.50"></a><span id="l84.50">     }</span>
<a href="#l84.51"></a><span id="l84.51"> </span>
<a href="#l84.52"></a><span id="l84.52">     // Find the app key we need for the OAuth2 string. Eventually, this should</span>
<a href="#l84.53"></a><span id="l84.53">     // be using dynamic client registration, but there are no current</span>
<a href="#l84.54"></a><span id="l84.54">     // implementations that we can test this with.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l85.1"></a><span id="l85.1" class="difflineminus">--- a/mailnews/jsaccount/modules/JSAccountUtils.jsm</span>
<a href="#l85.2"></a><span id="l85.2" class="difflineplus">+++ b/mailnews/jsaccount/modules/JSAccountUtils.jsm</span>
<a href="#l85.3"></a><span id="l85.3" class="difflineat">@@ -29,17 +29,17 @@</span>
<a href="#l85.4"></a><span id="l85.4">  *</span>
<a href="#l85.5"></a><span id="l85.5">  * Examples of use can be found in the test files for jsaccount stuff.</span>
<a href="#l85.6"></a><span id="l85.6">  */</span>
<a href="#l85.7"></a><span id="l85.7"> </span>
<a href="#l85.8"></a><span id="l85.8"> const EXPORTED_SYMBOLS = [&quot;JSAccountUtils&quot;];</span>
<a href="#l85.9"></a><span id="l85.9"> var JSAccountUtils = {};</span>
<a href="#l85.10"></a><span id="l85.10"> </span>
<a href="#l85.11"></a><span id="l85.11"> const {Log} = ChromeUtils.import(&quot;resource://gre/modules/Log.jsm&quot;);</span>
<a href="#l85.12"></a><span id="l85.12" class="difflineminus">-const {Preferences} = ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l85.13"></a><span id="l85.13" class="difflineplus">+const {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l85.14"></a><span id="l85.14"> var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l85.15"></a><span id="l85.15"> </span>
<a href="#l85.16"></a><span id="l85.16"> // Logger definitions.</span>
<a href="#l85.17"></a><span id="l85.17"> const LOGGER_NAME = &quot;JsAccount&quot;;</span>
<a href="#l85.18"></a><span id="l85.18"> const PREF_BRANCH_LOG = &quot;mailnews.jsaccount.log.&quot;;</span>
<a href="#l85.19"></a><span id="l85.19"> const PREF_LOG_LEVEL = PREF_BRANCH_LOG + &quot;level&quot;;</span>
<a href="#l85.20"></a><span id="l85.20"> const PREF_LOG_DUMP = PREF_BRANCH_LOG + &quot;dump&quot;;</span>
<a href="#l85.21"></a><span id="l85.21"> </span>
<a href="#l85.22"></a><span id="l85.22" class="difflineat">@@ -263,18 +263,18 @@ function configureLogging()</span>
<a href="#l85.23"></a><span id="l85.23"> {</span>
<a href="#l85.24"></a><span id="l85.24">   let log = Log.repository.getLogger(LOGGER_NAME);</span>
<a href="#l85.25"></a><span id="l85.25"> </span>
<a href="#l85.26"></a><span id="l85.26">   // Log messages need to go to the browser console.</span>
<a href="#l85.27"></a><span id="l85.27">   let consoleAppender = new Log.ConsoleAppender(new Log.BasicFormatter());</span>
<a href="#l85.28"></a><span id="l85.28">   log.addAppender(consoleAppender);</span>
<a href="#l85.29"></a><span id="l85.29"> </span>
<a href="#l85.30"></a><span id="l85.30">   // Make sure the logger keeps up with the logging level preference.</span>
<a href="#l85.31"></a><span id="l85.31" class="difflineminus">-  log.level = Log.Level[Preferences.get(PREF_LOG_LEVEL, LOG_LEVEL_DEFAULT)];</span>
<a href="#l85.32"></a><span id="l85.32" class="difflineplus">+  log.level = Log.Level[Services.prefs.getStringPref(PREF_LOG_LEVEL, LOG_LEVEL_DEFAULT)];</span>
<a href="#l85.33"></a><span id="l85.33"> </span>
<a href="#l85.34"></a><span id="l85.34">   // If enabled in the preferences, add a dump appender.</span>
<a href="#l85.35"></a><span id="l85.35" class="difflineminus">-  let logDumping = Preferences.get(PREF_LOG_DUMP, LOG_DUMP_DEFAULT);</span>
<a href="#l85.36"></a><span id="l85.36" class="difflineplus">+  let logDumping = Services.prefs.getBoolPref(PREF_LOG_DUMP, LOG_DUMP_DEFAULT);</span>
<a href="#l85.37"></a><span id="l85.37">   if (logDumping) {</span>
<a href="#l85.38"></a><span id="l85.38">     let dumpAppender = new Log.DumpAppender(new Log.BasicFormatter());</span>
<a href="#l85.39"></a><span id="l85.39">     log.addAppender(dumpAppender);</span>
<a href="#l85.40"></a><span id="l85.40">   }</span>
<a href="#l85.41"></a><span id="l85.41">   return log;</span>
<a href="#l85.42"></a><span id="l85.42"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

