<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 22297:076da1348bcce4fc0b579531505709fb0601b790</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 076da1348bcce4fc0b579531505709fb0601b790" />
<meta property="og:url" content="/comm-central/rev/076da1348bcce4fc0b579531505709fb0601b790" />
<meta property="og:description" content="Bug 1346797 - Fix calendar eslint issues. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 076da1348bcce4fc0b579531505709fb0601b790 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/076da1348bcce4fc0b579531505709fb0601b790">shortlog</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/076da1348bcce4fc0b579531505709fb0601b790">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790">files</a> |
changeset |
<a href="/comm-central/raw-rev/076da1348bcce4fc0b579531505709fb0601b790">raw</a>  | <a href="/comm-central/archive/076da1348bcce4fc0b579531505709fb0601b790.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1346797">Bug 1346797</a> - Fix calendar eslint issues. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 13 Mar 2017 15:30:50 +0100</td></tr>

<tr>
 <td>changeset 22297</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/076da1348bcce4fc0b579531505709fb0601b790">076da1348bcce4fc0b579531505709fb0601b790</a></td>
</tr>



<tr>
<td>parent 22296</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9c0e3022858b6fc0f25c4b9f32563ee143075467">9c0e3022858b6fc0f25c4b9f32563ee143075467</a>
</td>
</tr>

<tr>
<td>child 22298</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/69ed6b20f6f2955a848a1cc750762834b857c482">69ed6b20f6f2955a848a1cc750762834b857c482</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=076da1348bcce4fc0b579531505709fb0601b790">13598</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 08 Oct 2017 20:54:24 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@86066f04ca11 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=86066f04ca118895773fe5787d8cf7e569f4c393">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=86066f04ca118895773fe5787d8cf7e569f4c393&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=86066f04ca118895773fe5787d8cf7e569f4c393&newProject=comm-central&newRevision=076da1348bcce4fc0b579531505709fb0601b790&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=86066f04ca118895773fe5787d8cf7e569f4c393&newProject=comm-central&newRevision=076da1348bcce4fc0b579531505709fb0601b790&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=86066f04ca118895773fe5787d8cf7e569f4c393&newProject=comm-central&newRevision=076da1348bcce4fc0b579531505709fb0601b790&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1346797">1346797</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1346797">Bug 1346797</a> - Fix calendar eslint issues. r=MakeMyDay

MozReview-Commit-ID: AdhLRaAKMQs</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/.eslintrc.js">.eslintrc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/.eslintrc.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/.eslintrc.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/.eslintrc.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/.eslintrc.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/.eslintrc.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/.eslintrc.js">calendar/.eslintrc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/.eslintrc.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/.eslintrc.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/.eslintrc.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/.eslintrc.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/.eslintrc.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-chrome-startup.js">calendar/base/content/calendar-chrome-startup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-chrome-startup.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-chrome-startup.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-chrome-startup.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-chrome-startup.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-chrome-startup.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-common-sets.js">calendar/base/content/calendar-common-sets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-common-sets.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-common-sets.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-common-sets.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-common-sets.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-common-sets.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-daypicker.xml">calendar/base/content/calendar-daypicker.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-daypicker.xml">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-daypicker.xml">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-daypicker.xml">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-daypicker.xml">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-daypicker.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-extract.js">calendar/base/content/calendar-extract.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-extract.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-extract.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-extract.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-extract.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-extract.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-invitations-manager.js">calendar/base/content/calendar-invitations-manager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-invitations-manager.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-invitations-manager.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-invitations-manager.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-invitations-manager.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-invitations-manager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-bindings.xml">calendar/base/content/calendar-item-bindings.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-bindings.xml">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-bindings.xml">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-bindings.xml">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-bindings.xml">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-bindings.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-editing.js">calendar/base/content/calendar-item-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-editing.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-editing.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-editing.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-editing.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-item-editing.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-management.js">calendar/base/content/calendar-management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-management.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-management.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-management.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-management.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-management.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-month-view.xml">calendar/base/content/calendar-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-month-view.xml">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-month-view.xml">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-month-view.xml">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-month-view.xml">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.js">calendar/base/content/calendar-task-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-view.js">calendar/base/content/calendar-task-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-view.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-view.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-view.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-view.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-task-view.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder-todo.js">calendar/base/content/calendar-unifinder-todo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder-todo.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder-todo.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder-todo.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder-todo.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder-todo.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-view-core.xml">calendar/base/content/calendar-view-core.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-view-core.xml">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-view-core.xml">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-view-core.xml">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-view-core.xml">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-view-core.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-alarm-dialog.js">calendar/base/content/dialogs/calendar-alarm-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-alarm-dialog.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-alarm-dialog.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-alarm-dialog.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-alarm-dialog.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-alarm-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">calendar/base/content/dialogs/calendar-event-dialog-attendees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-summary-dialog.js">calendar/base/content/dialogs/calendar-summary-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-summary-dialog.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-summary-dialog.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-summary-dialog.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-summary-dialog.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/dialogs/calendar-summary-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/import-export.js">calendar/base/content/import-export.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/import-export.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/import-export.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/import-export.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/import-export.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/import-export.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/preferences/alarms.js">calendar/base/content/preferences/alarms.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/preferences/alarms.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/preferences/alarms.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/preferences/alarms.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/preferences/alarms.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/preferences/alarms.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/today-pane.js">calendar/base/content/today-pane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/today-pane.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/today-pane.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/today-pane.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/today-pane.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/today-pane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/calendar-list-tree.xml">calendar/base/content/widgets/calendar-list-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/calendar-list-tree.xml">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/calendar-list-tree.xml">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/calendar-list-tree.xml">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/calendar-list-tree.xml">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/calendar-list-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calAlarmUtils.jsm">calendar/base/modules/calAlarmUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calAlarmUtils.jsm">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calAlarmUtils.jsm">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calAlarmUtils.jsm">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calAlarmUtils.jsm">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calAlarmUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calExtract.jsm">calendar/base/modules/calExtract.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calExtract.jsm">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calExtract.jsm">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calExtract.jsm">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calExtract.jsm">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calExtract.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calRecurrenceUtils.jsm">calendar/base/modules/calRecurrenceUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calRecurrenceUtils.jsm">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calRecurrenceUtils.jsm">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calRecurrenceUtils.jsm">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calRecurrenceUtils.jsm">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calRecurrenceUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calUtils.jsm">calendar/base/modules/calUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calUtils.jsm">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calUtils.jsm">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calUtils.jsm">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calUtils.jsm">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/modules/calUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAlarm.js">calendar/base/src/calAlarm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAlarm.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAlarm.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAlarm.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAlarm.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAlarm.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAttendee.js">calendar/base/src/calAttendee.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAttendee.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAttendee.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAttendee.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAttendee.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calAttendee.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calCachedCalendar.js">calendar/base/src/calCachedCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calCachedCalendar.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calCachedCalendar.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calCachedCalendar.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calCachedCalendar.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calCachedCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calItemBase.js">calendar/base/src/calItemBase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calItemBase.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calItemBase.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calItemBase.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calItemBase.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calItemBase.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-panel.js">calendar/lightning/content/lightning-item-panel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-panel.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-panel.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-panel.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-panel.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/lightning-item-panel.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/messenger-overlay-sidebar.js">calendar/lightning/content/messenger-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/messenger-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/messenger-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/messenger-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/messenger-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/content/messenger-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/modules/ltnInvitationUtils.jsm">calendar/lightning/modules/ltnInvitationUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/modules/ltnInvitationUtils.jsm">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/modules/ltnInvitationUtils.jsm">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/modules/ltnInvitationUtils.jsm">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/modules/ltnInvitationUtils.jsm">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/lightning/modules/ltnInvitationUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageUpgrade.jsm">calendar/providers/storage/calStorageUpgrade.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageUpgrade.jsm">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageUpgrade.jsm">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageUpgrade.jsm">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageUpgrade.jsm">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/storage/calStorageUpgrade.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/publish.js">calendar/resources/content/publish.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/publish.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/publish.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/publish.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/publish.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/resources/content/publish.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/.eslintrc.js">calendar/test/mozmill/.eslintrc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/.eslintrc.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/.eslintrc.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/.eslintrc.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/.eslintrc.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/.eslintrc.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/eventDialog/testEventDialog.js">calendar/test/mozmill/eventDialog/testEventDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/eventDialog/testEventDialog.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/eventDialog/testEventDialog.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/eventDialog/testEventDialog.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/eventDialog/testEventDialog.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/eventDialog/testEventDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/invitations/test-imip-bar-eml.js">calendar/test/mozmill/invitations/test-imip-bar-eml.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/invitations/test-imip-bar-eml.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/invitations/test-imip-bar-eml.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/invitations/test-imip-bar-eml.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/invitations/test-imip-bar-eml.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/invitations/test-imip-bar-eml.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/shared-modules/test-calendar-utils.js">calendar/test/mozmill/shared-modules/test-calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/shared-modules/test-calendar-utils.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/shared-modules/test-calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/shared-modules/test-calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/shared-modules/test-calendar-utils.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/shared-modules/test-calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/views/testTaskView.js">calendar/test/mozmill/views/testTaskView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/views/testTaskView.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/views/testTaskView.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/views/testTaskView.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/views/testTaskView.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/mozmill/views/testTaskView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/head_consts.js">calendar/test/unit/head_consts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/head_consts.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/head_consts.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/head_consts.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/head_consts.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/head_consts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_alarmservice.js">calendar/test/unit/test_alarmservice.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_alarmservice.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_alarmservice.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_alarmservice.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_alarmservice.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_alarmservice.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_attendee.js">calendar/test/unit/test_attendee.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_attendee.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_attendee.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_attendee.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_attendee.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_attendee.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug1199942.js">calendar/test/unit/test_bug1199942.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug1199942.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug1199942.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug1199942.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug1199942.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug1199942.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug759324.js">calendar/test/unit/test_bug759324.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug759324.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug759324.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug759324.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug759324.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_bug759324.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_calitiputils.js">calendar/test/unit/test_calitiputils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_calitiputils.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_calitiputils.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_calitiputils.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_calitiputils.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_calitiputils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_ltninvitationutils.js">calendar/test/unit/test_ltninvitationutils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_ltninvitationutils.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_ltninvitationutils.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_ltninvitationutils.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_ltninvitationutils.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_ltninvitationutils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_recur.js">calendar/test/unit/test_recur.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_recur.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_recur.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_recur.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_recur.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_recur.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_storage.js">calendar/test/unit/test_storage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_storage.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_storage.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_storage.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_storage.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_storage.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_timezone.js">calendar/test/unit/test_timezone.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_timezone.js">file</a> |
<a href="/comm-central/annotate/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_timezone.js">annotate</a> |
<a href="/comm-central/diff/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_timezone.js">diff</a> |
<a href="/comm-central/comparison/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_timezone.js">comparison</a> |
<a href="/comm-central/log/076da1348bcce4fc0b579531505709fb0601b790/calendar/test/unit/test_timezone.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.eslintrc.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.eslintrc.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,14 +1,23 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &quot;use strict&quot;;</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> module.exports = {</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineplus">+  &quot;root&quot;: true,</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineplus">+</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineplus">+  // We would like the same base rules as provided by</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineplus">+  // mozilla/tools/lint/eslint/eslint-plugin-mozilla/lib/configs/recommended.js</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+  &quot;extends&quot;: [</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    &quot;plugin:mozilla/recommended&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  ],</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15">   // When adding items to this file please check for effects on sub-directories.</span>
<a href="#l1.16"></a><span id="l1.16">   &quot;plugins&quot;: [</span>
<a href="#l1.17"></a><span id="l1.17">     &quot;mozilla&quot;</span>
<a href="#l1.18"></a><span id="l1.18">   ],</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-  &quot;rules&quot;: {</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-    &quot;mozilla/import-globals&quot;: 1,</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-  },</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-  &quot;env&quot;: {</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-    &quot;es6&quot;: true</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+  // The html plugin is enabled via a command line option on eslint. To avoid</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+  // bad interactions with the xml preprocessor in eslint-plugin-mozilla, we</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+  // turn off processing of the html plugin for .xml files.</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+  &quot;settings&quot;: {</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+    &quot;html/xml-extensions&quot;: [ &quot;.xhtml&quot; ]</span>
<a href="#l1.30"></a><span id="l1.30">   },</span>
<a href="#l1.31"></a><span id="l1.31"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/.eslintrc.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/.eslintrc.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,14 +1,11 @@</span>
<a href="#l2.4"></a><span id="l2.4"> &quot;use strict&quot;;</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6"> module.exports = {</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineminus">-    &quot;extends&quot;: [</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineminus">-        &quot;../mozilla/toolkit/.eslintrc.js&quot;</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineminus">-    ],</span>
<a href="#l2.10"></a><span id="l2.10">     &quot;rules&quot;: {</span>
<a href="#l2.11"></a><span id="l2.11">         // Enforce one true brace style (opening brace on the same line)</span>
<a href="#l2.12"></a><span id="l2.12">         // Allow single line (for now) because of the vast number of changes needed</span>
<a href="#l2.13"></a><span id="l2.13">         &quot;brace-style&quot;: [2, &quot;1tbs&quot;, { allowSingleLine: true }],</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15">         // Enforce newline at the end of file, with no multiple empty lines.</span>
<a href="#l2.16"></a><span id="l2.16">         &quot;eol-last&quot;: 2,</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18" class="difflineat">@@ -20,16 +17,19 @@ module.exports = {</span>
<a href="#l2.19"></a><span id="l2.19">         &quot;comma-dangle&quot;: 0,</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">         // Enforce spacing before and after comma</span>
<a href="#l2.22"></a><span id="l2.22">         &quot;comma-spacing&quot;: [2, { before: false, after: true }],</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24">         // Enforce one true comma style.</span>
<a href="#l2.25"></a><span id="l2.25">         &quot;comma-style&quot;: [2, &quot;last&quot;],</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+        // We should get better at complexity, but at the moment it is what it is</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+        &quot;complexity&quot;: [2, 81],</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+</span>
<a href="#l2.30"></a><span id="l2.30">         // Enforce curly brace conventions for all control statements.</span>
<a href="#l2.31"></a><span id="l2.31">         &quot;curly&quot;: 2,</span>
<a href="#l2.32"></a><span id="l2.32"> </span>
<a href="#l2.33"></a><span id="l2.33">         // Enforce the spacing around the * in generator functions.</span>
<a href="#l2.34"></a><span id="l2.34">         &quot;generator-star-spacing&quot;: [2, &quot;after&quot;],</span>
<a href="#l2.35"></a><span id="l2.35"> </span>
<a href="#l2.36"></a><span id="l2.36">         // Require space before/after arrow function's arrow</span>
<a href="#l2.37"></a><span id="l2.37">         &quot;arrow-spacing&quot;: [2, { before: true, after: true }],</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineat">@@ -152,16 +152,17 @@ module.exports = {</span>
<a href="#l2.39"></a><span id="l2.39">         // Disallow use of multiple spaces (sometimes used to align const values,</span>
<a href="#l2.40"></a><span id="l2.40">         // array or object items, etc.). It's hard to maintain and doesn't add that</span>
<a href="#l2.41"></a><span id="l2.41">         // much benefit.</span>
<a href="#l2.42"></a><span id="l2.42">         &quot;no-multi-spaces&quot;: 2,</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44">         // Require spaces around operators, except for a|0.</span>
<a href="#l2.45"></a><span id="l2.45">         // Disabled for now given eslint doesn't support default args yet</span>
<a href="#l2.46"></a><span id="l2.46">         // &quot;space-infix-ops&quot;: [2, { &quot;int32Hint&quot;: true }],</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+        &quot;space-infix-ops&quot;: 0,</span>
<a href="#l2.48"></a><span id="l2.48"> </span>
<a href="#l2.49"></a><span id="l2.49">         // Require a space around all keywords.</span>
<a href="#l2.50"></a><span id="l2.50">         &quot;keyword-spacing&quot;: 2,</span>
<a href="#l2.51"></a><span id="l2.51"> </span>
<a href="#l2.52"></a><span id="l2.52">         // Disallow space between function identifier and application.</span>
<a href="#l2.53"></a><span id="l2.53">         &quot;no-spaced-func&quot;: 2,</span>
<a href="#l2.54"></a><span id="l2.54"> </span>
<a href="#l2.55"></a><span id="l2.55">         // Disallow shadowing of names such as arguments.</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineat">@@ -286,16 +287,19 @@ module.exports = {</span>
<a href="#l2.57"></a><span id="l2.57">         &quot;no-multi-str&quot;: 2,</span>
<a href="#l2.58"></a><span id="l2.58"> </span>
<a href="#l2.59"></a><span id="l2.59">         // Disallow Symbol Constructor</span>
<a href="#l2.60"></a><span id="l2.60">         &quot;no-new-symbol&quot;: 2,</span>
<a href="#l2.61"></a><span id="l2.61"> </span>
<a href="#l2.62"></a><span id="l2.62">         // Disallow Initializing to undefined</span>
<a href="#l2.63"></a><span id="l2.63">         &quot;no-undef-init&quot;: 2,</span>
<a href="#l2.64"></a><span id="l2.64"> </span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+        // Don't Disallow Undeclared Variables (for now)</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+        &quot;no-undef&quot;: 0,</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+</span>
<a href="#l2.68"></a><span id="l2.68">         // Disallow control flow statements in finally blocks</span>
<a href="#l2.69"></a><span id="l2.69">         &quot;no-unsafe-finally&quot;: 2,</span>
<a href="#l2.70"></a><span id="l2.70"> </span>
<a href="#l2.71"></a><span id="l2.71">         // Disallow Unused Labels</span>
<a href="#l2.72"></a><span id="l2.72">         &quot;no-unused-labels&quot;: 2,</span>
<a href="#l2.73"></a><span id="l2.73"> </span>
<a href="#l2.74"></a><span id="l2.74">         // Disallow unnecessary computed property keys on objects</span>
<a href="#l2.75"></a><span id="l2.75">         &quot;no-useless-computed-key&quot;: 2,</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineat">@@ -397,16 +401,19 @@ module.exports = {</span>
<a href="#l2.77"></a><span id="l2.77">         &quot;func-names&quot;: [2, &quot;never&quot;],</span>
<a href="#l2.78"></a><span id="l2.78"> </span>
<a href="#l2.79"></a><span id="l2.79">         // Enforce placing object properties on separate lines</span>
<a href="#l2.80"></a><span id="l2.80">         &quot;object-property-newline&quot;: [2, { allowMultiplePropertiesPerLine: true }],</span>
<a href="#l2.81"></a><span id="l2.81"> </span>
<a href="#l2.82"></a><span id="l2.82">         // Enforce consistent line breaks inside braces</span>
<a href="#l2.83"></a><span id="l2.83">         &quot;object-curly-newline&quot;: [2, { multiline: true }],</span>
<a href="#l2.84"></a><span id="l2.84"> </span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+        // Require Object Literal Shorthand Syntax (consistent for now)</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+        &quot;object-shorthand&quot;: [2, &quot;consistent&quot;],</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+</span>
<a href="#l2.88"></a><span id="l2.88">         // Disallow whitespace before properties</span>
<a href="#l2.89"></a><span id="l2.89">         &quot;no-whitespace-before-property&quot;: 2,</span>
<a href="#l2.90"></a><span id="l2.90"> </span>
<a href="#l2.91"></a><span id="l2.91">         // Disallow unnecessary escape usage</span>
<a href="#l2.92"></a><span id="l2.92">         &quot;no-useless-escape&quot;: 2,</span>
<a href="#l2.93"></a><span id="l2.93"> </span>
<a href="#l2.94"></a><span id="l2.94">         // Disallow mixes of different operators, but allow simple math operations.</span>
<a href="#l2.95"></a><span id="l2.95">         &quot;no-mixed-operators&quot;: [2, {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -50,17 +50,17 @@ agendaListbox.init = function() {</span>
<a href="#l3.4"></a><span id="l3.4">         }</span>
<a href="#l3.5"></a><span id="l3.5">     };</span>
<a href="#l3.6"></a><span id="l3.6">     Services.prefs.addObserver(&quot;calendar.agendaListbox&quot;, prefObserver, false);</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">     // Make sure the agenda listbox is unloaded</span>
<a href="#l3.9"></a><span id="l3.9">     window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l3.10"></a><span id="l3.10">         Services.prefs.removeObserver(&quot;calendar.agendaListbox&quot;, prefObserver);</span>
<a href="#l3.11"></a><span id="l3.11">         this.uninit();</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    }, false);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    });</span>
<a href="#l3.14"></a><span id="l3.14"> };</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> /**</span>
<a href="#l3.17"></a><span id="l3.17">  * Clean up the agenda listbox, used on window unload.</span>
<a href="#l3.18"></a><span id="l3.18">  */</span>
<a href="#l3.19"></a><span id="l3.19"> agendaListbox.uninit = function() {</span>
<a href="#l3.20"></a><span id="l3.20">     if (this.calendar) {</span>
<a href="#l3.21"></a><span id="l3.21">         this.calendar.removeObserver(this.calendarObserver);</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -1097,17 +1097,17 @@ function scheduleNextCurrentEventUpdate(</span>
<a href="#l3.23"></a><span id="l3.23">             }</span>
<a href="#l3.24"></a><span id="l3.24">         };</span>
<a href="#l3.25"></a><span id="l3.25">         // Add observer</span>
<a href="#l3.26"></a><span id="l3.26">         Services.obs.addObserver(wakeObserver, &quot;wake_notification&quot;, false);</span>
<a href="#l3.27"></a><span id="l3.27"> </span>
<a href="#l3.28"></a><span id="l3.28">         // Remove observer on unload</span>
<a href="#l3.29"></a><span id="l3.29">         window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l3.30"></a><span id="l3.30">             Services.obs.removeObserver(wakeObserver, &quot;wake_notification&quot;);</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-        }, false);</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+        });</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34">         gEventTimer = Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l3.35"></a><span id="l3.35">                                    .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l3.36"></a><span id="l3.36">     }</span>
<a href="#l3.37"></a><span id="l3.37">     gEventTimer.initWithCallback(udCallback, aMsUntil, gEventTimer.TYPE_ONE_SHOT);</span>
<a href="#l3.38"></a><span id="l3.38"> }</span>
<a href="#l3.39"></a><span id="l3.39"> </span>
<a href="#l3.40"></a><span id="l3.40"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -49,17 +49,16 @@</span>
<a href="#l4.4"></a><span id="l4.4">       })</span>
<a href="#l4.5"></a><span id="l4.5">       ]]&gt;&lt;/field&gt;</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7">       &lt;field name=&quot;mPrefObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.8"></a><span id="l4.8">       ({</span>
<a href="#l4.9"></a><span id="l4.9">           calView: this,</span>
<a href="#l4.10"></a><span id="l4.10">           observe: function(subj, topic, pref) {</span>
<a href="#l4.11"></a><span id="l4.11">               this.calView.handlePreference(subj, topic, pref);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-              return;</span>
<a href="#l4.13"></a><span id="l4.13">           }</span>
<a href="#l4.14"></a><span id="l4.14">       })</span>
<a href="#l4.15"></a><span id="l4.15">       ]]&gt;&lt;/field&gt;</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">       &lt;field name=&quot;mObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.18"></a><span id="l4.18">         // the calIObserver, calICompositeObserver, and calIAlarmServiceObserver</span>
<a href="#l4.19"></a><span id="l4.19">         ({</span>
<a href="#l4.20"></a><span id="l4.20">             QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -93,17 +92,16 @@</span>
<a href="#l4.22"></a><span id="l4.22">                 }</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24">                 let occs = aItem.getOccurrencesBetween(this.calView.startDate,</span>
<a href="#l4.25"></a><span id="l4.25">                                                        this.calView.queryEndDate,</span>
<a href="#l4.26"></a><span id="l4.26">                                                        {});</span>
<a href="#l4.27"></a><span id="l4.27">                 for (let occ of occs) {</span>
<a href="#l4.28"></a><span id="l4.28">                     this.calView.doAddItem(occ);</span>
<a href="#l4.29"></a><span id="l4.29">                 }</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-                return;</span>
<a href="#l4.31"></a><span id="l4.31">             },</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33">             onModifyItem: function(aNewItem, aOldItem) {</span>
<a href="#l4.34"></a><span id="l4.34">                 if (cal.isToDo(aNewItem) &amp;&amp; cal.isToDo(aOldItem) &amp;&amp;</span>
<a href="#l4.35"></a><span id="l4.35">                     !this.calView.mTasksInView) {</span>
<a href="#l4.36"></a><span id="l4.36">                     return;</span>
<a href="#l4.37"></a><span id="l4.37">                 }</span>
<a href="#l4.38"></a><span id="l4.38">                 let occs;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineat">@@ -652,21 +650,24 @@</span>
<a href="#l4.40"></a><span id="l4.40">           }</span>
<a href="#l4.41"></a><span id="l4.41">           this.refreshView();</span>
<a href="#l4.42"></a><span id="l4.42">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.43"></a><span id="l4.43">       &lt;/method&gt;</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45">       &lt;method name=&quot;updateDaysOffPrefs&quot;&gt;</span>
<a href="#l4.46"></a><span id="l4.46">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.47"></a><span id="l4.47">           const weekPrefix = &quot;calendar.week.&quot;;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-          const prefNames = [&quot;d0sundaysoff&quot;, &quot;d1mondaysoff&quot;, &quot;d2tuesdaysoff&quot;,</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-                             &quot;d3wednesdaysoff&quot;, &quot;d4thursdaysoff&quot;,</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-                             &quot;d5fridaysoff&quot;, &quot;d6saturdaysoff&quot;];</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-          const defaults = [&quot;true&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-                            &quot;false&quot;, &quot;false&quot;, &quot;true&quot;];</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+          const prefNames = [</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+              &quot;d0sundaysoff&quot;, &quot;d1mondaysoff&quot;, &quot;d2tuesdaysoff&quot;,</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+              &quot;d3wednesdaysoff&quot;, &quot;d4thursdaysoff&quot;, &quot;d5fridaysoff&quot;,</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+              &quot;d6saturdaysoff&quot;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+          ];</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+          const defaults = [</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+              &quot;true&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;, &quot;true&quot;</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+          ];</span>
<a href="#l4.61"></a><span id="l4.61">           let daysOff = [];</span>
<a href="#l4.62"></a><span id="l4.62">           for (let i in prefNames) {</span>
<a href="#l4.63"></a><span id="l4.63">               if (Preferences.get(weekPrefix + prefNames[i], defaults[i])) {</span>
<a href="#l4.64"></a><span id="l4.64">                   daysOff.push(Number(i));</span>
<a href="#l4.65"></a><span id="l4.65">               }</span>
<a href="#l4.66"></a><span id="l4.66">           }</span>
<a href="#l4.67"></a><span id="l4.67">           this.daysOffArray = daysOff;</span>
<a href="#l4.68"></a><span id="l4.68">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineat">@@ -873,23 +874,25 @@</span>
<a href="#l4.70"></a><span id="l4.70"> </span>
<a href="#l4.71"></a><span id="l4.71">       &lt;property name=&quot;date&quot;&gt;</span>
<a href="#l4.72"></a><span id="l4.72">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.73"></a><span id="l4.73">           return this.mDate;</span>
<a href="#l4.74"></a><span id="l4.74">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.75"></a><span id="l4.75">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.76"></a><span id="l4.76">           this.mDate = val;</span>
<a href="#l4.77"></a><span id="l4.77">           let dateFormatter = cal.getDateFormatter();</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-          let label = cal.calGetString(&quot;calendar&quot;, &quot;dayHeaderLabel&quot;,</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-                                       [dateFormatter.shortDayName(val.weekday),</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-                                        dateFormatter.formatDateWithoutYear(val)]);</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+          let label = cal.calGetString(&quot;calendar&quot;, &quot;dayHeaderLabel&quot;, [</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+              dateFormatter.shortDayName(val.weekday),</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+              dateFormatter.formatDateWithoutYear(val)</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+          ]);</span>
<a href="#l4.85"></a><span id="l4.85">           this.shortName.setAttribute(&quot;value&quot;, label);</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-          label = cal.calGetString(&quot;calendar&quot;, &quot;dayHeaderLabel&quot;,</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineminus">-                                   [dateFormatter.dayName(val.weekday),</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-                                    dateFormatter.formatDateWithoutYear(val)]);</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+          label = cal.calGetString(&quot;calendar&quot;, &quot;dayHeaderLabel&quot;, [</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+              dateFormatter.dayName(val.weekday),</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+              dateFormatter.formatDateWithoutYear(val)</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+          ]);</span>
<a href="#l4.93"></a><span id="l4.93">           this.longName.setAttribute(&quot;value&quot;, label);</span>
<a href="#l4.94"></a><span id="l4.94">           return val;</span>
<a href="#l4.95"></a><span id="l4.95">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.96"></a><span id="l4.96">       &lt;/property&gt;</span>
<a href="#l4.97"></a><span id="l4.97"> </span>
<a href="#l4.98"></a><span id="l4.98">       &lt;property name=&quot;shortWeekNames&quot;&gt;</span>
<a href="#l4.99"></a><span id="l4.99">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.100"></a><span id="l4.100">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineat">@@ -904,18 +907,19 @@</span>
<a href="#l4.102"></a><span id="l4.102"> </span>
<a href="#l4.103"></a><span id="l4.103">       &lt;method name=&quot;getLongWeekdayPixels&quot;&gt;</span>
<a href="#l4.104"></a><span id="l4.104">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.105"></a><span id="l4.105">           // Only do this if the long weekdays are visible and we haven't already cached.</span>
<a href="#l4.106"></a><span id="l4.106">           let longNameWidth = this.longName.boxObject.width;</span>
<a href="#l4.107"></a><span id="l4.107">           if (longNameWidth &gt; 0) {</span>
<a href="#l4.108"></a><span id="l4.108">               this.longWeekdayPixels = longNameWidth +</span>
<a href="#l4.109"></a><span id="l4.109">                                        getSummarizedStyleValues(this.longName, [&quot;margin-left&quot;, &quot;margin-right&quot;]);</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineminus">-              this.longWeekdayPixels += getSummarizedStyleValues(this, [&quot;border-left-width&quot;,</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineminus">-                                                                        &quot;padding-left&quot;, &quot;padding-right&quot;]);</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineplus">+              this.longWeekdayPixels += getSummarizedStyleValues(this, [</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+                  &quot;border-left-width&quot;, &quot;padding-left&quot;, &quot;padding-right&quot;</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineplus">+              ]);</span>
<a href="#l4.115"></a><span id="l4.115">               return this.longWeekdayPixels;</span>
<a href="#l4.116"></a><span id="l4.116">           } else {</span>
<a href="#l4.117"></a><span id="l4.117">               // in this case the weekdaypixels have not yet been layouted;</span>
<a href="#l4.118"></a><span id="l4.118">               // by definition 0 is returned</span>
<a href="#l4.119"></a><span id="l4.119">               return 0;</span>
<a href="#l4.120"></a><span id="l4.120">           }</span>
<a href="#l4.121"></a><span id="l4.121">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.122"></a><span id="l4.122">       &lt;/method&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-chrome-startup.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-chrome-startup.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -27,24 +27,24 @@ function commonInitCalendar() {</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">     // Make sure we update ourselves if the program stays open over midnight</span>
<a href="#l5.6"></a><span id="l5.6">     scheduleMidnightUpdate(refreshUIBits);</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">     // Set up the command controller from calendar-common-sets.js</span>
<a href="#l5.9"></a><span id="l5.9">     injectCalendarCommandController();</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">     // Set up item and day selection listeners</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    getViewDeck().addEventListener(&quot;dayselect&quot;, observeViewDaySelect, false);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    getViewDeck().addEventListener(&quot;dayselect&quot;, observeViewDaySelect);</span>
<a href="#l5.14"></a><span id="l5.14">     getViewDeck().addEventListener(&quot;itemselect&quot;, calendarController.onSelectionChanged, true);</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16">     // Start alarm service</span>
<a href="#l5.17"></a><span id="l5.17">     Components.classes[&quot;@mozilla.org/calendar/alarm-service;1&quot;]</span>
<a href="#l5.18"></a><span id="l5.18">               .getService(Components.interfaces.calIAlarmService)</span>
<a href="#l5.19"></a><span id="l5.19">               .startup();</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-    document.getElementById(&quot;calsidebar_splitter&quot;).addEventListener(&quot;command&quot;, onCalendarViewResize, false);</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+    document.getElementById(&quot;calsidebar_splitter&quot;).addEventListener(&quot;command&quot;, onCalendarViewResize);</span>
<a href="#l5.22"></a><span id="l5.22">     window.addEventListener(&quot;resize&quot;, onCalendarViewResize, true);</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">     // Set up the category colors</span>
<a href="#l5.25"></a><span id="l5.25">     categoryManagement.initCategories();</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27">     // Set up window pref observers</span>
<a href="#l5.28"></a><span id="l5.28">     calendarWindowPrefs.init();</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30" class="difflineat">@@ -76,17 +76,17 @@ function commonFinishCalendar() {</span>
<a href="#l5.31"></a><span id="l5.31">     unloadCalendarManager();</span>
<a href="#l5.32"></a><span id="l5.32"> </span>
<a href="#l5.33"></a><span id="l5.33">     // clean up the unifinder</span>
<a href="#l5.34"></a><span id="l5.34">     finishCalendarToDoUnifinder();</span>
<a href="#l5.35"></a><span id="l5.35"> </span>
<a href="#l5.36"></a><span id="l5.36">     // Remove the command controller</span>
<a href="#l5.37"></a><span id="l5.37">     removeCalendarCommandController();</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-    document.getElementById(&quot;calsidebar_splitter&quot;).removeEventListener(&quot;command&quot;, onCalendarViewResize, false);</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+    document.getElementById(&quot;calsidebar_splitter&quot;).removeEventListener(&quot;command&quot;, onCalendarViewResize);</span>
<a href="#l5.41"></a><span id="l5.41">     window.removeEventListener(&quot;resize&quot;, onCalendarViewResize, true);</span>
<a href="#l5.42"></a><span id="l5.42"> </span>
<a href="#l5.43"></a><span id="l5.43">     // Clean up the category colors</span>
<a href="#l5.44"></a><span id="l5.44">     categoryManagement.cleanupCategories();</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46">     // Clean up window pref observers</span>
<a href="#l5.47"></a><span id="l5.47">     calendarWindowPrefs.cleanup();</span>
<a href="#l5.48"></a><span id="l5.48"> }</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineat">@@ -145,17 +145,17 @@ var calendarWindowPrefs = {</span>
<a href="#l5.50"></a><span id="l5.50">                     break;</span>
<a href="#l5.51"></a><span id="l5.51">                 }</span>
<a href="#l5.52"></a><span id="l5.52">             }</span>
<a href="#l5.53"></a><span id="l5.53">         } else if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l5.54"></a><span id="l5.54">             let win = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l5.55"></a><span id="l5.55">             win.addEventListener(&quot;load&quot;, () =&gt; {</span>
<a href="#l5.56"></a><span id="l5.56">                 let attributeValue = Preferences.get(&quot;calendar.view.useSystemColors&quot;, false) &amp;&amp; &quot;true&quot;;</span>
<a href="#l5.57"></a><span id="l5.57">                 setElementValue(win.document.documentElement, attributeValue, &quot;systemcolors&quot;);</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-            }, false);</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+            });</span>
<a href="#l5.60"></a><span id="l5.60">         }</span>
<a href="#l5.61"></a><span id="l5.61">     }</span>
<a href="#l5.62"></a><span id="l5.62"> };</span>
<a href="#l5.63"></a><span id="l5.63"> </span>
<a href="#l5.64"></a><span id="l5.64"> /**</span>
<a href="#l5.65"></a><span id="l5.65">  * Migrate calendar UI. This function is called at each startup and can be used</span>
<a href="#l5.66"></a><span id="l5.66">  * to change UI items that require js code intervention</span>
<a href="#l5.67"></a><span id="l5.67">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-common-sets.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-common-sets.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -431,21 +431,19 @@ var calendarController = {</span>
<a href="#l6.4"></a><span id="l6.4">                 }</span>
<a href="#l6.5"></a><span id="l6.5">                 break;</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">             default:</span>
<a href="#l6.8"></a><span id="l6.8">                 if (this.defaultController &amp;&amp; !this.isCalendarInForeground()) {</span>
<a href="#l6.9"></a><span id="l6.9">                     // If calendar is not in foreground, let the default controller take</span>
<a href="#l6.10"></a><span id="l6.10">                     // care. If we don't have a default controller, just continue.</span>
<a href="#l6.11"></a><span id="l6.11">                     this.defaultController.doCommand(aCommand);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                    return;</span>
<a href="#l6.13"></a><span id="l6.13">                 }</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15">         }</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-        return;</span>
<a href="#l6.17"></a><span id="l6.17">     },</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19">     onEvent: function(aEvent) {</span>
<a href="#l6.20"></a><span id="l6.20">     },</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22">     isCalendarInForeground: function() {</span>
<a href="#l6.23"></a><span id="l6.23">         return gCurrentMode &amp;&amp; gCurrentMode != &quot;mail&quot;;</span>
<a href="#l6.24"></a><span id="l6.24">     },</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineat">@@ -895,21 +893,25 @@ function deleteSelectedItems() {</span>
<a href="#l6.26"></a><span id="l6.26"> }</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28"> function calendarUpdateNewItemsCommand() {</span>
<a href="#l6.29"></a><span id="l6.29">     // keep current current status</span>
<a href="#l6.30"></a><span id="l6.30">     let oldEventValue = CalendarNewEventsCommandEnabled;</span>
<a href="#l6.31"></a><span id="l6.31">     let oldTaskValue = CalendarNewTasksCommandEnabled;</span>
<a href="#l6.32"></a><span id="l6.32"> </span>
<a href="#l6.33"></a><span id="l6.33">     // define command set to update</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-    let eventCommands = [&quot;calendar_new_event_command&quot;,</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-                         &quot;calendar_new_event_context_command&quot;];</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-    let taskCommands = [&quot;calendar_new_todo_command&quot;,</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-                        &quot;calendar_new_todo_context_command&quot;,</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-                        &quot;calendar_new_todo_todaypane_command&quot;];</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+    let eventCommands = [</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+        &quot;calendar_new_event_command&quot;,</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+        &quot;calendar_new_event_context_command&quot;</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+    ];</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+    let taskCommands = [</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+        &quot;calendar_new_todo_command&quot;,</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+        &quot;calendar_new_todo_context_command&quot;,</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+        &quot;calendar_new_todo_todaypane_command&quot;</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+    ];</span>
<a href="#l6.48"></a><span id="l6.48"> </span>
<a href="#l6.49"></a><span id="l6.49">     // re-calculate command status</span>
<a href="#l6.50"></a><span id="l6.50">     CalendarNewEventsCommandEnabled = false;</span>
<a href="#l6.51"></a><span id="l6.51">     CalendarNewTasksCommandEnabled = false;</span>
<a href="#l6.52"></a><span id="l6.52">     let calendars = cal.getCalendarManager().getCalendars({}).filter(cal.isCalendarWritable).filter(cal.userCanAddItemsToCalendar);</span>
<a href="#l6.53"></a><span id="l6.53">     if (calendars.some(cal.isEventCalendar)) {</span>
<a href="#l6.54"></a><span id="l6.54">         CalendarNewEventsCommandEnabled = true;</span>
<a href="#l6.55"></a><span id="l6.55">     }</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineat">@@ -934,18 +936,20 @@ function calendarUpdateDeleteCommand(sel</span>
<a href="#l6.57"></a><span id="l6.57">     for (let item of selectedItems) {</span>
<a href="#l6.58"></a><span id="l6.58">         if (!cal.userCanDeleteItemsFromCalendar(item.calendar)) {</span>
<a href="#l6.59"></a><span id="l6.59">             CalendarDeleteCommandEnabled = false;</span>
<a href="#l6.60"></a><span id="l6.60">             break;</span>
<a href="#l6.61"></a><span id="l6.61">         }</span>
<a href="#l6.62"></a><span id="l6.62">     }</span>
<a href="#l6.63"></a><span id="l6.63"> </span>
<a href="#l6.64"></a><span id="l6.64">     if (CalendarDeleteCommandEnabled != oldValue) {</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-        let commands = [&quot;calendar_delete_event_command&quot;,</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-                        &quot;calendar_delete_todo_command&quot;,</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-                        &quot;calendar_delete_focused_item_command&quot;,</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-                        &quot;button_delete&quot;,</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-                        &quot;cmd_delete&quot;];</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+        let commands = [</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+            &quot;calendar_delete_event_command&quot;,</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+            &quot;calendar_delete_todo_command&quot;,</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+            &quot;calendar_delete_focused_item_command&quot;,</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineplus">+            &quot;button_delete&quot;,</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+            &quot;cmd_delete&quot;</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+        ];</span>
<a href="#l6.77"></a><span id="l6.77">         for (let command of commands) {</span>
<a href="#l6.78"></a><span id="l6.78">             goUpdateCommand(command);</span>
<a href="#l6.79"></a><span id="l6.79">         }</span>
<a href="#l6.80"></a><span id="l6.80">     }</span>
<a href="#l6.81"></a><span id="l6.81"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-daypicker.xml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-daypicker.xml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -35,17 +35,17 @@</span>
<a href="#l7.4"></a><span id="l7.4">               event.initEvent(&quot;select&quot;, true, true);</span>
<a href="#l7.5"></a><span id="l7.5">               this.calendar.dispatchEvent(event);</span>
<a href="#l7.6"></a><span id="l7.6">           }</span>
<a href="#l7.7"></a><span id="l7.7">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.8"></a><span id="l7.8">       &lt;/method&gt;</span>
<a href="#l7.9"></a><span id="l7.9">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l7.10"></a><span id="l7.10">         this.setAttribute(&quot;autoCheck&quot;, &quot;true&quot;);</span>
<a href="#l7.11"></a><span id="l7.11">         this.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-        this.addEventListener(&quot;DOMAttrModified&quot;, this.onmodified, false);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+        this.addEventListener(&quot;DOMAttrModified&quot;, this.onmodified);</span>
<a href="#l7.14"></a><span id="l7.14">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l7.15"></a><span id="l7.15">     &lt;/implementation&gt;</span>
<a href="#l7.16"></a><span id="l7.16">   &lt;/binding&gt;</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18">   &lt;!--</span>
<a href="#l7.19"></a><span id="l7.19">   ########################################################################</span>
<a href="#l7.20"></a><span id="l7.20">   ## daypicker-weekday</span>
<a href="#l7.21"></a><span id="l7.21">   ########################################################################</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-extract.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-extract.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -208,26 +208,26 @@ var calendarExtract = {</span>
<a href="#l8.4"></a><span id="l8.4">         let timeSpent = (new Date()).getTime() - time;</span>
<a href="#l8.5"></a><span id="l8.5">         cal.LOG(&quot;[calExtract] Total time spent for conversion (including loading of dictionaries): &quot; + timeSpent + &quot;ms&quot;);</span>
<a href="#l8.6"></a><span id="l8.6">     },</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">     addListeners: function() {</span>
<a href="#l8.9"></a><span id="l8.9">         if (window.top.document.location == &quot;chrome://messenger/content/messenger.xul&quot;) {</span>
<a href="#l8.10"></a><span id="l8.10">             // covers initial load and folder change</span>
<a href="#l8.11"></a><span id="l8.11">             let folderTree = document.getElementById(&quot;folderTree&quot;);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-            folderTree.addEventListener(&quot;select&quot;, this.setState, false);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+            folderTree.addEventListener(&quot;select&quot;, this.setState);</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">             // covers selection change in a folder</span>
<a href="#l8.16"></a><span id="l8.16">             let msgTree = window.top.GetThreadTree();</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-            msgTree.addEventListener(&quot;select&quot;, this.setState, false);</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+            msgTree.addEventListener(&quot;select&quot;, this.setState);</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">             window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-                folderTree.removeEventListener(&quot;select&quot;, this.setState, false);</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-                msgTree.removeEventListener(&quot;select&quot;, this.setState, false);</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-            }, false);</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+                folderTree.removeEventListener(&quot;select&quot;, this.setState);</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+                msgTree.removeEventListener(&quot;select&quot;, this.setState);</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+            });</span>
<a href="#l8.27"></a><span id="l8.27">         }</span>
<a href="#l8.28"></a><span id="l8.28">     },</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30">     setState: function() {</span>
<a href="#l8.31"></a><span id="l8.31">         let eventButton = document.getElementById(&quot;extractEventButton&quot;);</span>
<a href="#l8.32"></a><span id="l8.32">         let taskButton = document.getElementById(&quot;extractTaskButton&quot;);</span>
<a href="#l8.33"></a><span id="l8.33">         let hdrEventButton = document.getElementById(&quot;hdrExtractEventButton&quot;);</span>
<a href="#l8.34"></a><span id="l8.34">         let hdrTaskButton = document.getElementById(&quot;hdrExtractTaskButton&quot;);</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineat">@@ -266,9 +266,9 @@ var calendarExtract = {</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37">         contextMenuEvent.disabled = contextEventDisabled;</span>
<a href="#l8.38"></a><span id="l8.38">         contextMenuTask.disabled = contextTaskDisabled;</span>
<a href="#l8.39"></a><span id="l8.39"> </span>
<a href="#l8.40"></a><span id="l8.40">         contextMenu.disabled = contextEventDisabled &amp;&amp; contextTaskDisabled;</span>
<a href="#l8.41"></a><span id="l8.41">     }</span>
<a href="#l8.42"></a><span id="l8.42"> };</span>
<a href="#l8.43"></a><span id="l8.43"> </span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-window.addEventListener(&quot;load&quot;, calendarExtract.addListeners.bind(calendarExtract), false);</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+window.addEventListener(&quot;load&quot;, calendarExtract.addListeners.bind(calendarExtract));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -66,17 +66,17 @@ function InvitationsManager() {</span>
<a href="#l9.4"></a><span id="l9.4">     this.mItemList = [];</span>
<a href="#l9.5"></a><span id="l9.5">     this.mStartDate = null;</span>
<a href="#l9.6"></a><span id="l9.6">     this.mJobsPending = 0;</span>
<a href="#l9.7"></a><span id="l9.7">     this.mTimer = null;</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">     window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l9.10"></a><span id="l9.10">         // Unload handlers get removed automatically</span>
<a href="#l9.11"></a><span id="l9.11">         this.cancelInvitationsUpdate();</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    }, false);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    });</span>
<a href="#l9.14"></a><span id="l9.14"> }</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16"> InvitationsManager.prototype = {</span>
<a href="#l9.17"></a><span id="l9.17">     mItemList: null,</span>
<a href="#l9.18"></a><span id="l9.18">     mStartDate: null,</span>
<a href="#l9.19"></a><span id="l9.19">     mJobsPending: 0,</span>
<a href="#l9.20"></a><span id="l9.20">     mTimer: null,</span>
<a href="#l9.21"></a><span id="l9.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-item-bindings.xml</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-bindings.xml</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -82,20 +82,20 @@</span>
<a href="#l10.4"></a><span id="l10.4">               this.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l10.5"></a><span id="l10.5">           } else {</span>
<a href="#l10.6"></a><span id="l10.6">               const kDefaultTimezone = cal.calendarDefaultTimezone();</span>
<a href="#l10.7"></a><span id="l10.7">               let localTime = date.getInTimezone(kDefaultTimezone);</span>
<a href="#l10.8"></a><span id="l10.8">               let formatter = cal.getDateFormatter();</span>
<a href="#l10.9"></a><span id="l10.9">               itemDateTimeLabel.value = formatter.formatDateTime(localTime);</span>
<a href="#l10.10"></a><span id="l10.10">               if (!date.timezone.isFloating &amp;&amp; date.timezone.tzid != kDefaultTimezone.tzid) {</span>
<a href="#l10.11"></a><span id="l10.11">                   // we additionally display the original datetime with timezone</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-                  let orgTime = cal.calGetString(&quot;calendar&quot;,</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-                                                 &quot;datetimeWithTimezone&quot;,</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-                                                 [formatter.formatDateTime(date),</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-                                                  date.timezone.tzid]);</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+                  let orgTime = cal.calGetString(&quot;calendar&quot;, &quot;datetimeWithTimezone&quot;, [</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+                      formatter.formatDateTime(date),</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+                      date.timezone.tzid</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+                  ]);</span>
<a href="#l10.20"></a><span id="l10.20">                   itemDateTimeLabel.value += &quot; (&quot; + orgTime + &quot;)&quot;;</span>
<a href="#l10.21"></a><span id="l10.21">               }</span>
<a href="#l10.22"></a><span id="l10.22">               this.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l10.23"></a><span id="l10.23">           }</span>
<a href="#l10.24"></a><span id="l10.24">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l10.25"></a><span id="l10.25">       &lt;/property&gt;</span>
<a href="#l10.26"></a><span id="l10.26">     &lt;/implementation&gt;</span>
<a href="#l10.27"></a><span id="l10.27">   &lt;/binding&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-item-editing.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-editing.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -326,17 +326,17 @@ function createTodoWithDialog(calendar, </span>
<a href="#l11.4"></a><span id="l11.4">  * @param aPromptOccurrence     If the user should be prompted to select if the</span>
<a href="#l11.5"></a><span id="l11.5">  *                                parent item or occurrence should be modified.</span>
<a href="#l11.6"></a><span id="l11.6">  * @param initialDate           (optional) The initial date for new task datepickers</span>
<a href="#l11.7"></a><span id="l11.7">  * @param aCounterProposal      (optional) An object representing the counterproposal</span>
<a href="#l11.8"></a><span id="l11.8">  *        {</span>
<a href="#l11.9"></a><span id="l11.9">  *            {JsObject} result: {</span>
<a href="#l11.10"></a><span id="l11.10">  *                type: {String} &quot;OK&quot;|&quot;OUTDATED&quot;|&quot;NOTLATESTUPDATE&quot;|&quot;ERROR&quot;|&quot;NODIFF&quot;</span>
<a href="#l11.11"></a><span id="l11.11">  *                descr: {String} a technical description of the problem if type is ERROR or NODIFF,</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">- *                                otherwise an empty string </span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+ *                                otherwise an empty string</span>
<a href="#l11.14"></a><span id="l11.14">  *            },</span>
<a href="#l11.15"></a><span id="l11.15">  *            (empty if result.type = &quot;ERROR&quot;|&quot;NODIFF&quot;){Array} differences: [{</span>
<a href="#l11.16"></a><span id="l11.16">  *                property: {String} a property that is subject to the proposal</span>
<a href="#l11.17"></a><span id="l11.17">  *                proposed: {String} the proposed value</span>
<a href="#l11.18"></a><span id="l11.18">  *                original: {String} the original value</span>
<a href="#l11.19"></a><span id="l11.19">  *            }]</span>
<a href="#l11.20"></a><span id="l11.20">  *        }</span>
<a href="#l11.21"></a><span id="l11.21">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/calendar-management.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/calendar-management.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -345,18 +345,20 @@ function showOnlyCalendar(aCalendar) {</span>
<a href="#l12.4"></a><span id="l12.4">             composite.removeCalendar(calendar);</span>
<a href="#l12.5"></a><span id="l12.5">         }</span>
<a href="#l12.6"></a><span id="l12.6">     }</span>
<a href="#l12.7"></a><span id="l12.7">     composite.addCalendar(aCalendar);</span>
<a href="#l12.8"></a><span id="l12.8">     composite.endBatch();</span>
<a href="#l12.9"></a><span id="l12.9"> }</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11"> var compositeObserver = {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIObserver,</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-                                           Components.interfaces.calICompositeObserver]),</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+        Components.interfaces.calIObserver,</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+        Components.interfaces.calICompositeObserver</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+    ]),</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19">     onStartBatch: function() {},</span>
<a href="#l12.20"></a><span id="l12.20">     onEndBatch: function() {},</span>
<a href="#l12.21"></a><span id="l12.21">     onAddItem: function() {},</span>
<a href="#l12.22"></a><span id="l12.22">     onModifyItem: function() {},</span>
<a href="#l12.23"></a><span id="l12.23">     onDeleteItem: function() {},</span>
<a href="#l12.24"></a><span id="l12.24">     onError: function() {},</span>
<a href="#l12.25"></a><span id="l12.25">     onPropertyChanged: function() {},</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineat">@@ -415,17 +417,17 @@ var calendarOfflineManager = {</span>
<a href="#l12.27"></a><span id="l12.27">         this.updateOfflineUI(!this.isOnline());</span>
<a href="#l12.28"></a><span id="l12.28">         this.initialized = true;</span>
<a href="#l12.29"></a><span id="l12.29">     },</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31">     uninit: function() {</span>
<a href="#l12.32"></a><span id="l12.32">         if (!this.initialized) {</span>
<a href="#l12.33"></a><span id="l12.33">             throw Components.results.NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l12.34"></a><span id="l12.34">         }</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-        Services.obs.removeObserver(this, &quot;network:offline-status-changed&quot;, false);</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+        Services.obs.removeObserver(this, &quot;network:offline-status-changed&quot;);</span>
<a href="#l12.37"></a><span id="l12.37">         this.initialized = false;</span>
<a href="#l12.38"></a><span id="l12.38">     },</span>
<a href="#l12.39"></a><span id="l12.39"> </span>
<a href="#l12.40"></a><span id="l12.40">     isOnline: function() {</span>
<a href="#l12.41"></a><span id="l12.41">         return !Services.io.offline;</span>
<a href="#l12.42"></a><span id="l12.42">     },</span>
<a href="#l12.43"></a><span id="l12.43"> </span>
<a href="#l12.44"></a><span id="l12.44">     updateOfflineUI: function(aIsOffline) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -526,17 +526,16 @@</span>
<a href="#l13.4"></a><span id="l13.4">                       this.hideWeekNumbers();</span>
<a href="#l13.5"></a><span id="l13.5">                   }</span>
<a href="#l13.6"></a><span id="l13.6">                   break;</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8">               default:</span>
<a href="#l13.9"></a><span id="l13.9">                   this.handleCommonPreference(aSubject, aTopic, aPreference);</span>
<a href="#l13.10"></a><span id="l13.10">                   break;</span>
<a href="#l13.11"></a><span id="l13.11">           }</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-          return;</span>
<a href="#l13.13"></a><span id="l13.13">         ]]&gt;&lt;/body&gt;</span>
<a href="#l13.14"></a><span id="l13.14">       &lt;/method&gt;</span>
<a href="#l13.15"></a><span id="l13.15"> </span>
<a href="#l13.16"></a><span id="l13.16">       &lt;method name=&quot;getSelectedItems&quot;&gt;</span>
<a href="#l13.17"></a><span id="l13.17">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l13.18"></a><span id="l13.18">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l13.19"></a><span id="l13.19">           aCount.value = this.mSelectedItems.length;</span>
<a href="#l13.20"></a><span id="l13.20">           return this.mSelectedItems;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1343,19 +1343,19 @@</span>
<a href="#l14.4"></a><span id="l14.4">         ]]&gt;&lt;/body&gt;</span>
<a href="#l14.5"></a><span id="l14.5">       &lt;/method&gt;</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7">       &lt;method name=&quot;onEventSweepKeypress&quot;&gt;</span>
<a href="#l14.8"></a><span id="l14.8">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l14.9"></a><span id="l14.9">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.10"></a><span id="l14.10">           let col = document.calendarEventColumnDragging;</span>
<a href="#l14.11"></a><span id="l14.11">           if (col &amp;&amp; event.keyCode == event.DOM_VK_ESCAPE) {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-              window.removeEventListener(&quot;mousemove&quot;, col.onEventSweepMouseMove, false);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-              window.removeEventListener(&quot;mouseup&quot;, col.onEventSweepMouseUp, false);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-              window.removeEventListener(&quot;keypress&quot;, col.onEventSweepKeypress, false);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+              window.removeEventListener(&quot;mousemove&quot;, col.onEventSweepMouseMove);</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+              window.removeEventListener(&quot;mouseup&quot;, col.onEventSweepMouseUp);</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+              window.removeEventListener(&quot;keypress&quot;, col.onEventSweepKeypress);</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19">               let lateralColumns = col.firstLastShadowColumns();</span>
<a href="#l14.20"></a><span id="l14.20">               let column = lateralColumns.firstCol;</span>
<a href="#l14.21"></a><span id="l14.21">               let index = lateralColumns.firstIndex;</span>
<a href="#l14.22"></a><span id="l14.22">               while (column &amp;&amp; index &lt; col.mDragState.shadows) {</span>
<a href="#l14.23"></a><span id="l14.23">                   column.fgboxes.dragbox.removeAttribute(&quot;dragging&quot;);</span>
<a href="#l14.24"></a><span id="l14.24">                   column.fgboxes.box.removeAttribute(&quot;dragging&quot;);</span>
<a href="#l14.25"></a><span id="l14.25">                   column = column.nextSibling;</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineat">@@ -1452,19 +1452,19 @@</span>
<a href="#l14.27"></a><span id="l14.27">               // Remove the drag state</span>
<a href="#l14.28"></a><span id="l14.28">               for (let column = firstCol, i = firstIndex;</span>
<a href="#l14.29"></a><span id="l14.29">                    column &amp;&amp; i &lt; col.mDragState.shadows;</span>
<a href="#l14.30"></a><span id="l14.30">                    column = column.nextSibling, i++) {</span>
<a href="#l14.31"></a><span id="l14.31">                   column.fgboxes.dragbox.removeAttribute(&quot;dragging&quot;);</span>
<a href="#l14.32"></a><span id="l14.32">                   column.fgboxes.box.removeAttribute(&quot;dragging&quot;);</span>
<a href="#l14.33"></a><span id="l14.33">               }</span>
<a href="#l14.34"></a><span id="l14.34"> </span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-              window.removeEventListener(&quot;mousemove&quot;, col.onEventSweepMouseMove, false);</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-              window.removeEventListener(&quot;mouseup&quot;, col.onEventSweepMouseUp, false);</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">-              window.removeEventListener(&quot;keypress&quot;, col.onEventSweepKeypress, false);</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+              window.removeEventListener(&quot;mousemove&quot;, col.onEventSweepMouseMove);</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+              window.removeEventListener(&quot;mouseup&quot;, col.onEventSweepMouseUp);</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+              window.removeEventListener(&quot;keypress&quot;, col.onEventSweepKeypress);</span>
<a href="#l14.41"></a><span id="l14.41">               document.calendarEventColumnDragging = null;</span>
<a href="#l14.42"></a><span id="l14.42">               col.mDragState = null;</span>
<a href="#l14.43"></a><span id="l14.43"> </span>
<a href="#l14.44"></a><span id="l14.44">               // the multiday view currently exhibits a less than optimal strategy</span>
<a href="#l14.45"></a><span id="l14.45">               // in terms of item selection. items don't get automatically selected</span>
<a href="#l14.46"></a><span id="l14.46">               // when clicked and dragged, as to differentiate inline editing from</span>
<a href="#l14.47"></a><span id="l14.47">               // the act of selecting an event. but the application internal drop</span>
<a href="#l14.48"></a><span id="l14.48">               // targets will ask for selected items in order to pull the data from</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineat">@@ -1635,19 +1635,19 @@</span>
<a href="#l14.50"></a><span id="l14.50">               column.fgboxes.dragbox.removeAttribute(&quot;dragging&quot;);</span>
<a href="#l14.51"></a><span id="l14.51">               column.fgboxes.box.removeAttribute(&quot;dragging&quot;);</span>
<a href="#l14.52"></a><span id="l14.52">               column = column.nextSibling;</span>
<a href="#l14.53"></a><span id="l14.53">               index++;</span>
<a href="#l14.54"></a><span id="l14.54">           }</span>
<a href="#l14.55"></a><span id="l14.55"> </span>
<a href="#l14.56"></a><span id="l14.56">           col.clearMagicScroll();</span>
<a href="#l14.57"></a><span id="l14.57"> </span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-          window.removeEventListener(&quot;mousemove&quot;, col.onEventSweepMouseMove, false);</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">-          window.removeEventListener(&quot;mouseup&quot;, col.onEventSweepMouseUp, false);</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineminus">-          window.removeEventListener(&quot;keypress&quot;, col.onEventSweepKeypress, false);</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+          window.removeEventListener(&quot;mousemove&quot;, col.onEventSweepMouseMove);</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+          window.removeEventListener(&quot;mouseup&quot;, col.onEventSweepMouseUp);</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+          window.removeEventListener(&quot;keypress&quot;, col.onEventSweepKeypress);</span>
<a href="#l14.64"></a><span id="l14.64"> </span>
<a href="#l14.65"></a><span id="l14.65">           document.calendarEventColumnDragging = null;</span>
<a href="#l14.66"></a><span id="l14.66"> </span>
<a href="#l14.67"></a><span id="l14.67">           // if the user didn't sweep out at least a few pixels, ignore</span>
<a href="#l14.68"></a><span id="l14.68">           // unless we're in a different column</span>
<a href="#l14.69"></a><span id="l14.69">           if (dragState.origColumn == col) {</span>
<a href="#l14.70"></a><span id="l14.70">               let ignore = false;</span>
<a href="#l14.71"></a><span id="l14.71">               let orient = col.getAttribute(&quot;orient&quot;);</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineat">@@ -1909,19 +1909,19 @@</span>
<a href="#l14.73"></a><span id="l14.73">                   }</span>
<a href="#l14.74"></a><span id="l14.74">               }</span>
<a href="#l14.75"></a><span id="l14.75">           } else {</span>
<a href="#l14.76"></a><span id="l14.76">               // Invalid grabbed element.</span>
<a href="#l14.77"></a><span id="l14.77">           }</span>
<a href="#l14.78"></a><span id="l14.78"> </span>
<a href="#l14.79"></a><span id="l14.79">           document.calendarEventColumnDragging = this;</span>
<a href="#l14.80"></a><span id="l14.80"> </span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-          window.addEventListener(&quot;mousemove&quot;, this.onEventSweepMouseMove, false);</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineminus">-          window.addEventListener(&quot;mouseup&quot;, this.onEventSweepMouseUp, false);</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineminus">-          window.addEventListener(&quot;keypress&quot;, this.onEventSweepKeypress, false);</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+          window.addEventListener(&quot;mousemove&quot;, this.onEventSweepMouseMove);</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+          window.addEventListener(&quot;mouseup&quot;, this.onEventSweepMouseUp);</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+          window.addEventListener(&quot;keypress&quot;, this.onEventSweepKeypress);</span>
<a href="#l14.87"></a><span id="l14.87">         ]]&gt;&lt;/body&gt;</span>
<a href="#l14.88"></a><span id="l14.88">       &lt;/method&gt;</span>
<a href="#l14.89"></a><span id="l14.89"> </span>
<a href="#l14.90"></a><span id="l14.90">       &lt;!-- called by sibling columns to tell us to take over the sweeping</span>
<a href="#l14.91"></a><span id="l14.91">          - of an event.</span>
<a href="#l14.92"></a><span id="l14.92">         --&gt;</span>
<a href="#l14.93"></a><span id="l14.93">       &lt;method name=&quot;acceptInProgressSweep&quot;&gt;</span>
<a href="#l14.94"></a><span id="l14.94">         &lt;parameter name=&quot;aDragState&quot;/&gt;</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineat">@@ -2084,19 +2084,19 @@</span>
<a href="#l14.96"></a><span id="l14.96">         } else {</span>
<a href="#l14.97"></a><span id="l14.97">             this.mDragState.origLoc = event.screenX;</span>
<a href="#l14.98"></a><span id="l14.98">             this.mDragState.origMin = Math.floor((event.screenX - this.parentNode.boxObject.screenX) / interval) * snapIntMin;</span>
<a href="#l14.99"></a><span id="l14.99">             this.fgboxes.dragspacer.setAttribute(&quot;width&quot;, this.mDragState.origMin * this.mPixPerMin);</span>
<a href="#l14.100"></a><span id="l14.100">         }</span>
<a href="#l14.101"></a><span id="l14.101"> </span>
<a href="#l14.102"></a><span id="l14.102">         document.calendarEventColumnDragging = this;</span>
<a href="#l14.103"></a><span id="l14.103"> </span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-        window.addEventListener(&quot;mousemove&quot;, this.onEventSweepMouseMove, false);</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-        window.addEventListener(&quot;mouseup&quot;, this.onEventSweepMouseUp, false);</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-        window.addEventListener(&quot;keypress&quot;, this.onEventSweepKeypress, false);</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineplus">+        window.addEventListener(&quot;mousemove&quot;, this.onEventSweepMouseMove);</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineplus">+        window.addEventListener(&quot;mouseup&quot;, this.onEventSweepMouseUp);</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineplus">+        window.addEventListener(&quot;keypress&quot;, this.onEventSweepKeypress);</span>
<a href="#l14.110"></a><span id="l14.110">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l14.111"></a><span id="l14.111">     &lt;/handlers&gt;</span>
<a href="#l14.112"></a><span id="l14.112">   &lt;/binding&gt;</span>
<a href="#l14.113"></a><span id="l14.113"> </span>
<a href="#l14.114"></a><span id="l14.114">   &lt;binding id=&quot;calendar-header-container&quot; extends=&quot;chrome://calendar/content/widgets/calendar-widgets.xml#dragndropContainer&quot;&gt;</span>
<a href="#l14.115"></a><span id="l14.115">     &lt;content xbl:inherits=&quot;selected&quot; flex=&quot;1&quot; class=&quot;calendar-event-column-header&quot;&gt;</span>
<a href="#l14.116"></a><span id="l14.116">       &lt;children/&gt;</span>
<a href="#l14.117"></a><span id="l14.117">     &lt;/content&gt;</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineat">@@ -2427,17 +2427,16 @@</span>
<a href="#l14.119"></a><span id="l14.119">             // start edge resize drag</span>
<a href="#l14.120"></a><span id="l14.120">             this.parentColumn.startSweepingToModifyEvent(this, this.mOccurrence, whichside,</span>
<a href="#l14.121"></a><span id="l14.121">                                                          event.screenX, event.screenY,</span>
<a href="#l14.122"></a><span id="l14.122">                                                          snapIntMin);</span>
<a href="#l14.123"></a><span id="l14.123">         } else {</span>
<a href="#l14.124"></a><span id="l14.124">             // may be click or drag,</span>
<a href="#l14.125"></a><span id="l14.125">             // so wait for mousemove (or mouseout if fast) to start item move drag</span>
<a href="#l14.126"></a><span id="l14.126">             this.mInMouseDown = true;</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineminus">-            return;</span>
<a href="#l14.128"></a><span id="l14.128">         }</span>
<a href="#l14.129"></a><span id="l14.129">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l14.130"></a><span id="l14.130"> </span>
<a href="#l14.131"></a><span id="l14.131">       &lt;handler event=&quot;mousemove&quot;&gt;&lt;![CDATA[</span>
<a href="#l14.132"></a><span id="l14.132">         if (!this.mInMouseDown) {</span>
<a href="#l14.133"></a><span id="l14.133">             return;</span>
<a href="#l14.134"></a><span id="l14.134">         }</span>
<a href="#l14.135"></a><span id="l14.135"> </span>
<a href="#l14.136"></a><span id="l14.136" class="difflineat">@@ -2682,17 +2681,16 @@</span>
<a href="#l14.137"></a><span id="l14.137">                     this.setTimeIndicatorInterval(aSubject.getIntPref(aPreference));</span>
<a href="#l14.138"></a><span id="l14.138">                     this.enableTimeIndicator();</span>
<a href="#l14.139"></a><span id="l14.139">                     break;</span>
<a href="#l14.140"></a><span id="l14.140"> </span>
<a href="#l14.141"></a><span id="l14.141">                 default:</span>
<a href="#l14.142"></a><span id="l14.142">                     this.handleCommonPreference(aSubject, aTopic, aPreference);</span>
<a href="#l14.143"></a><span id="l14.143">                     break;</span>
<a href="#l14.144"></a><span id="l14.144">             }</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineminus">-            return;</span>
<a href="#l14.146"></a><span id="l14.146">         ]]&gt;&lt;/body&gt;</span>
<a href="#l14.147"></a><span id="l14.147">       &lt;/method&gt;</span>
<a href="#l14.148"></a><span id="l14.148"> </span>
<a href="#l14.149"></a><span id="l14.149">       &lt;method name=&quot;onResize&quot;&gt;</span>
<a href="#l14.150"></a><span id="l14.150">         &lt;parameter name=&quot;aRealSelf&quot;/&gt;</span>
<a href="#l14.151"></a><span id="l14.151">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.152"></a><span id="l14.152">           let self = aRealSelf || this; // eslint-disable-line consistent-this</span>
<a href="#l14.153"></a><span id="l14.153">           let isARelayout = !aRealSelf;</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineat">@@ -3228,18 +3226,20 @@</span>
<a href="#l14.155"></a><span id="l14.155"> </span>
<a href="#l14.156"></a><span id="l14.156">           if (orient == &quot;horizontal&quot;) {</span>
<a href="#l14.157"></a><span id="l14.157">               this.pixelsPerMinute = 1.5;</span>
<a href="#l14.158"></a><span id="l14.158">           } else {</span>
<a href="#l14.159"></a><span id="l14.159">               this.pixelsPerMinute = 0.6;</span>
<a href="#l14.160"></a><span id="l14.160">           }</span>
<a href="#l14.161"></a><span id="l14.161"> </span>
<a href="#l14.162"></a><span id="l14.162">           let normalelems = [&quot;mainbox&quot;, &quot;timebar&quot;];</span>
<a href="#l14.163"></a><span id="l14.163" class="difflineminus">-          let otherelems = [&quot;labelbox&quot;, &quot;labeldaybox&quot;, &quot;headertimespacer&quot;,</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineminus">-                            &quot;headerbox&quot;, &quot;headerdaybox&quot;, &quot;scrollbox&quot;, &quot;daybox&quot;];</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineplus">+          let otherelems = [</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineplus">+              &quot;labelbox&quot;, &quot;labeldaybox&quot;, &quot;headertimespacer&quot;, &quot;headerbox&quot;,</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineplus">+              &quot;headerdaybox&quot;, &quot;scrollbox&quot;, &quot;daybox&quot;</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineplus">+          ];</span>
<a href="#l14.169"></a><span id="l14.169"> </span>
<a href="#l14.170"></a><span id="l14.170">           for (let id of normalelems) {</span>
<a href="#l14.171"></a><span id="l14.171">               document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, id).setAttribute(&quot;orient&quot;, orient);</span>
<a href="#l14.172"></a><span id="l14.172">           }</span>
<a href="#l14.173"></a><span id="l14.173">           for (let id of otherelems) {</span>
<a href="#l14.174"></a><span id="l14.174">               document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, id).setAttribute(&quot;orient&quot;, otherorient);</span>
<a href="#l14.175"></a><span id="l14.175">           }</span>
<a href="#l14.176"></a><span id="l14.176"> </span>
<a href="#l14.177"></a><span id="l14.177" class="difflineat">@@ -3722,17 +3722,17 @@</span>
<a href="#l14.178"></a><span id="l14.178">                          this, &quot;anonid&quot;, &quot;scrollbox&quot;);</span>
<a href="#l14.179"></a><span id="l14.179">           let propertyValue = scrollbox.boxObject.firstChild.boxObject[propertyName];</span>
<a href="#l14.180"></a><span id="l14.180">           // Check if we need to show the headerScrollbarSpacer at all</span>
<a href="#l14.181"></a><span id="l14.181">           let headerPropertyValue = propertyValue;</span>
<a href="#l14.182"></a><span id="l14.182">           let headerDayBox = document.getAnonymousElementByAttribute(</span>
<a href="#l14.183"></a><span id="l14.183">                              this, &quot;anonid&quot;, &quot;headerdaybox&quot;);</span>
<a href="#l14.184"></a><span id="l14.184">           if (headerDayBox) {</span>
<a href="#l14.185"></a><span id="l14.185">               // Only do this when there are multiple days</span>
<a href="#l14.186"></a><span id="l14.186" class="difflineminus">-              let headerDayBoxMaxHeight = parseInt(document.defaultView.getComputedStyle(headerDayBox, null)</span>
<a href="#l14.187"></a><span id="l14.187" class="difflineplus">+              let headerDayBoxMaxHeight = parseInt(document.defaultView.getComputedStyle(headerDayBox)</span>
<a href="#l14.188"></a><span id="l14.188">                                                            .getPropertyValue(&quot;max-height&quot;), 10);</span>
<a href="#l14.189"></a><span id="l14.189">               if (this.getAttribute(&quot;orient&quot;) == &quot;vertical&quot; &amp;&amp;</span>
<a href="#l14.190"></a><span id="l14.190">                   headerDayBox.boxObject.height &gt;= headerDayBoxMaxHeight) {</span>
<a href="#l14.191"></a><span id="l14.191">                   // If the headerDayBox is just as high as the max-height, then</span>
<a href="#l14.192"></a><span id="l14.192">                   // there is already a scrollbar and we don't need to show the</span>
<a href="#l14.193"></a><span id="l14.193">                   // headerScrollbarSpacer. This is only valid for the non-rotated</span>
<a href="#l14.194"></a><span id="l14.194">                   // view.</span>
<a href="#l14.195"></a><span id="l14.195">                   headerPropertyValue = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -98,21 +98,24 @@ function handleTaskContextMenuStateChang</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5"> /**</span>
<a href="#l15.6"></a><span id="l15.6">  * Change the opening menu for the selected tasks.</span>
<a href="#l15.7"></a><span id="l15.7">  *</span>
<a href="#l15.8"></a><span id="l15.8">  * @param aEvent    The popupshowing event of the opening menu.</span>
<a href="#l15.9"></a><span id="l15.9">  */</span>
<a href="#l15.10"></a><span id="l15.10"> function changeMenuForTask(aEvent) {</span>
<a href="#l15.11"></a><span id="l15.11">     // Make sure to update the status of some commands.</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    [&quot;calendar_delete_todo_command&quot;,</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-     &quot;calendar_toggle_completed_command&quot;,</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-     &quot;calendar_general-progress_command&quot;,</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-     &quot;calendar_general-priority_command&quot;,</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-     &quot;calendar_general-postpone_command&quot;].forEach(goUpdateCommand);</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+    let commands = [</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+        &quot;calendar_delete_todo_command&quot;,</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+        &quot;calendar_toggle_completed_command&quot;,</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+        &quot;calendar_general-progress_command&quot;,</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+        &quot;calendar_general-priority_command&quot;,</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+        &quot;calendar_general-postpone_command&quot;</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+    ];</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+    commands.forEach(goUpdateCommand);</span>
<a href="#l15.25"></a><span id="l15.25"> </span>
<a href="#l15.26"></a><span id="l15.26">     let tasks = getSelectedTasks(aEvent);</span>
<a href="#l15.27"></a><span id="l15.27">     let tasksSelected = (tasks.length &gt; 0);</span>
<a href="#l15.28"></a><span id="l15.28">     if (tasksSelected) {</span>
<a href="#l15.29"></a><span id="l15.29">         let cmd = document.getElementById(&quot;calendar_toggle_completed_command&quot;);</span>
<a href="#l15.30"></a><span id="l15.30">         if (cal.isPropertyValueSame(tasks, &quot;isCompleted&quot;)) {</span>
<a href="#l15.31"></a><span id="l15.31">             setBooleanAttribute(cmd, &quot;checked&quot;, tasks[0].isCompleted);</span>
<a href="#l15.32"></a><span id="l15.32">         } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -174,17 +174,17 @@</span>
<a href="#l16.4"></a><span id="l16.4">         Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6">         // remove composite calendar observer</span>
<a href="#l16.7"></a><span id="l16.7">         let composite = cal.getCompositeCalendar(window);</span>
<a href="#l16.8"></a><span id="l16.8">         composite.removeObserver(this.mTaskTreeObserver);</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10">         // remove the preference observer</span>
<a href="#l16.11"></a><span id="l16.11">         let branch = Services.prefs.getBranch(&quot;&quot;);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        branch.removeObserver(&quot;calendar.&quot;, this, false);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+        branch.removeObserver(&quot;calendar.&quot;, this);</span>
<a href="#l16.14"></a><span id="l16.14"> </span>
<a href="#l16.15"></a><span id="l16.15">         let widths = &quot;&quot;;</span>
<a href="#l16.16"></a><span id="l16.16">         let ordinals = &quot;&quot;;</span>
<a href="#l16.17"></a><span id="l16.17">         let visible = &quot;&quot;;</span>
<a href="#l16.18"></a><span id="l16.18">         let sorted = this.mTreeView.selectedColumn;</span>
<a href="#l16.19"></a><span id="l16.19">         let tree = document.getAnonymousNodes(this)[0];</span>
<a href="#l16.20"></a><span id="l16.20">         let treecols = tree.getElementsByTagNameNS(tree.namespaceURI, &quot;treecol&quot;);</span>
<a href="#l16.21"></a><span id="l16.21">         for (let i = 0; i &lt; treecols.length; i++) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/calendar-task-view.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-view.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -293,9 +293,9 @@ function taskViewCopyLink(linkNode) {</span>
<a href="#l17.4"></a><span id="l17.4">     if (linkNode) {</span>
<a href="#l17.5"></a><span id="l17.5">         let linkAddress = linkNode.value;</span>
<a href="#l17.6"></a><span id="l17.6">         let clipboard = Components.classes[&quot;@mozilla.org/widget/clipboardhelper;1&quot;]</span>
<a href="#l17.7"></a><span id="l17.7">                                   .getService(Components.interfaces.nsIClipboardHelper);</span>
<a href="#l17.8"></a><span id="l17.8">         clipboard.copyString(linkAddress);</span>
<a href="#l17.9"></a><span id="l17.9">     }</span>
<a href="#l17.10"></a><span id="l17.10"> }</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-window.addEventListener(&quot;load&quot;, taskViewOnLoad, false);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+window.addEventListener(&quot;load&quot;, taskViewOnLoad);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -536,55 +536,55 @@ function createXULElement(elem) {</span>
<a href="#l18.4"></a><span id="l18.4">  * http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSview-getComputedStyle</span>
<a href="#l18.5"></a><span id="l18.5">  * @param aXULElement   The xul element to be inspected.</span>
<a href="#l18.6"></a><span id="l18.6">  * @param aStyleProps   The css style properties for which values are to be retrieved</span>
<a href="#l18.7"></a><span id="l18.7">  *                        e.g. 'font-size', 'min-width&quot; etc.</span>
<a href="#l18.8"></a><span id="l18.8">  * @return              An integer value denoting the optimal minimum width</span>
<a href="#l18.9"></a><span id="l18.9">  */</span>
<a href="#l18.10"></a><span id="l18.10"> function getSummarizedStyleValues(aXULElement, aStyleProps) {</span>
<a href="#l18.11"></a><span id="l18.11">     let retValue = 0;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    let cssStyleDeclares = document.defaultView.getComputedStyle(aXULElement, null);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    let cssStyleDeclares = document.defaultView.getComputedStyle(aXULElement);</span>
<a href="#l18.14"></a><span id="l18.14">     for (let prop of aStyleProps) {</span>
<a href="#l18.15"></a><span id="l18.15">         retValue += parseInt(cssStyleDeclares.getPropertyValue(prop), 10);</span>
<a href="#l18.16"></a><span id="l18.16">     }</span>
<a href="#l18.17"></a><span id="l18.17">     return retValue;</span>
<a href="#l18.18"></a><span id="l18.18"> }</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20"> /**</span>
<a href="#l18.21"></a><span id="l18.21">  * Calculates the optimal minimum width based on the set css style-rules</span>
<a href="#l18.22"></a><span id="l18.22">  * by considering the css rules for the min-width, padding, border, margin</span>
<a href="#l18.23"></a><span id="l18.23">  * and border of the box.</span>
<a href="#l18.24"></a><span id="l18.24">  *</span>
<a href="#l18.25"></a><span id="l18.25">  * @param aXULElement   The xul element to be inspected.</span>
<a href="#l18.26"></a><span id="l18.26">  * @return              An integer value denoting the optimal minimum width</span>
<a href="#l18.27"></a><span id="l18.27">  */</span>
<a href="#l18.28"></a><span id="l18.28"> function getOptimalMinimumWidth(aXULElement) {</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineminus">-    return getSummarizedStyleValues(aXULElement, [&quot;min-width&quot;,</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-                                                  &quot;padding-left&quot;, &quot;padding-right&quot;,</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-                                                  &quot;margin-left&quot;, &quot;margin-top&quot;,</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-                                                  &quot;border-left-width&quot;, &quot;border-right-width&quot;]);</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+    return getSummarizedStyleValues(aXULElement, [</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+        &quot;min-width&quot;, &quot;padding-left&quot;, &quot;padding-right&quot;, &quot;margin-left&quot;,</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+        &quot;margin-top&quot;, &quot;border-left-width&quot;, &quot;border-right-width&quot;</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineplus">+    ]);</span>
<a href="#l18.37"></a><span id="l18.37"> }</span>
<a href="#l18.38"></a><span id="l18.38"> </span>
<a href="#l18.39"></a><span id="l18.39"> /**</span>
<a href="#l18.40"></a><span id="l18.40">  * Calculates the optimal minimum height based on the set css style-rules</span>
<a href="#l18.41"></a><span id="l18.41">  * by considering the css rules for the font-size, padding, border, margin</span>
<a href="#l18.42"></a><span id="l18.42">  * and border of the box. In its current state the line-height is considered</span>
<a href="#l18.43"></a><span id="l18.43">  * by assuming that it's size is about one third of the size of the font-size</span>
<a href="#l18.44"></a><span id="l18.44">  *</span>
<a href="#l18.45"></a><span id="l18.45">  * @param aXULElement   The xul-element to be inspected.</span>
<a href="#l18.46"></a><span id="l18.46">  * @return              An integer value denoting the optimal minimum height</span>
<a href="#l18.47"></a><span id="l18.47">  */</span>
<a href="#l18.48"></a><span id="l18.48"> function getOptimalMinimumHeight(aXULElement) {</span>
<a href="#l18.49"></a><span id="l18.49">     // the following line of code presumes that the line-height is set to &quot;normal&quot;</span>
<a href="#l18.50"></a><span id="l18.50">     // which is supposed to be a &quot;reasonable distance&quot; between the lines</span>
<a href="#l18.51"></a><span id="l18.51">     let firstEntity = parseInt(1.35 * getSummarizedStyleValues(aXULElement, [&quot;font-size&quot;]), 10);</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineminus">-    let secondEntity = getSummarizedStyleValues(aXULElement,</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineminus">-                                                [&quot;padding-bottom&quot;, &quot;padding-top&quot;,</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineminus">-                                                &quot;margin-bottom&quot;, &quot;margin-top&quot;,</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineminus">-                                                &quot;border-bottom-width&quot;, &quot;border-top-width&quot;]);</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineplus">+    let secondEntity = getSummarizedStyleValues(aXULElement, [</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineplus">+        &quot;padding-bottom&quot;, &quot;padding-top&quot;, &quot;margin-bottom&quot;, &quot;margin-top&quot;,</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineplus">+        &quot;border-bottom-width&quot;, &quot;border-top-width&quot;</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineplus">+    ]);</span>
<a href="#l18.60"></a><span id="l18.60">     return (firstEntity + secondEntity);</span>
<a href="#l18.61"></a><span id="l18.61"> }</span>
<a href="#l18.62"></a><span id="l18.62"> </span>
<a href="#l18.63"></a><span id="l18.63"> /**</span>
<a href="#l18.64"></a><span id="l18.64">  * Gets the &quot;other&quot; orientation value, i.e if &quot;horizontal&quot; is passed, &quot;vertical&quot;</span>
<a href="#l18.65"></a><span id="l18.65">  * is returned and vice versa.</span>
<a href="#l18.66"></a><span id="l18.66">  *</span>
<a href="#l18.67"></a><span id="l18.67">  * @param aOrientation    The orientation value to turn around.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder-todo.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder-todo.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -4,17 +4,17 @@</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5"> /* exported prepareCalendarToDoUnifinder, finishCalendarToDoUnifinder */</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> /**</span>
<a href="#l19.8"></a><span id="l19.8">  * Called when the window is loaded to set up the unifinder-todo.</span>
<a href="#l19.9"></a><span id="l19.9">  */</span>
<a href="#l19.10"></a><span id="l19.10"> function prepareCalendarToDoUnifinder() {</span>
<a href="#l19.11"></a><span id="l19.11">     // add listener to update the date filters</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    getViewDeck().addEventListener(&quot;dayselect&quot;, updateCalendarToDoUnifinder, false);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    getViewDeck().addEventListener(&quot;dayselect&quot;, updateCalendarToDoUnifinder);</span>
<a href="#l19.14"></a><span id="l19.14"> </span>
<a href="#l19.15"></a><span id="l19.15">     updateCalendarToDoUnifinder();</span>
<a href="#l19.16"></a><span id="l19.16"> }</span>
<a href="#l19.17"></a><span id="l19.17"> </span>
<a href="#l19.18"></a><span id="l19.18"> /**</span>
<a href="#l19.19"></a><span id="l19.19">  * Updates the applied filter and show completed view of the unifinder todo.</span>
<a href="#l19.20"></a><span id="l19.20">  *</span>
<a href="#l19.21"></a><span id="l19.21">  * @param aFilter        The filter name to set.</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -51,10 +51,10 @@ function updateCalendarToDoUnifinder(aFi</span>
<a href="#l19.23"></a><span id="l19.23">     tree.updateFilter(filter);</span>
<a href="#l19.24"></a><span id="l19.24"> }</span>
<a href="#l19.25"></a><span id="l19.25"> </span>
<a href="#l19.26"></a><span id="l19.26"> /**</span>
<a href="#l19.27"></a><span id="l19.27">  * Called when the window is unloaded to clean up the unifinder-todo.</span>
<a href="#l19.28"></a><span id="l19.28">  */</span>
<a href="#l19.29"></a><span id="l19.29"> function finishCalendarToDoUnifinder() {</span>
<a href="#l19.30"></a><span id="l19.30">     // remove listeners</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-    getViewDeck().removeEventListener(&quot;dayselect&quot;, updateCalendarToDoUnifinder, false);</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+    getViewDeck().removeEventListener(&quot;dayselect&quot;, updateCalendarToDoUnifinder);</span>
<a href="#l19.33"></a><span id="l19.33"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -180,17 +180,17 @@ var unifinderObserver = {</span>
<a href="#l20.4"></a><span id="l20.4"> };</span>
<a href="#l20.5"></a><span id="l20.5"> </span>
<a href="#l20.6"></a><span id="l20.6"> /**</span>
<a href="#l20.7"></a><span id="l20.7">  * Called when the window is loaded to prepare the unifinder. This function is</span>
<a href="#l20.8"></a><span id="l20.8">  * used to add observers, event listeners, etc.</span>
<a href="#l20.9"></a><span id="l20.9">  */</span>
<a href="#l20.10"></a><span id="l20.10"> function prepareCalendarUnifinder() {</span>
<a href="#l20.11"></a><span id="l20.11">     // Only load once</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    window.removeEventListener(&quot;load&quot;, prepareCalendarUnifinder, false);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+    window.removeEventListener(&quot;load&quot;, prepareCalendarUnifinder);</span>
<a href="#l20.14"></a><span id="l20.14">     let unifinderTree = document.getElementById(&quot;unifinder-search-results-tree&quot;);</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16">     // Add pref observer</span>
<a href="#l20.17"></a><span id="l20.17">     let branch = Services.prefs.getBranch(&quot;&quot;);</span>
<a href="#l20.18"></a><span id="l20.18">     branch.addObserver(&quot;calendar.&quot;, unifinderObserver, false);</span>
<a href="#l20.19"></a><span id="l20.19"> </span>
<a href="#l20.20"></a><span id="l20.20">     // Check if this is not the hidden window, which has no UI elements</span>
<a href="#l20.21"></a><span id="l20.21">     if (unifinderTree) {</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -204,17 +204,17 @@ function prepareCalendarUnifinder() {</span>
<a href="#l20.23"></a><span id="l20.23">         unifinderTreeView.mFilter = new calFilter();</span>
<a href="#l20.24"></a><span id="l20.24"> </span>
<a href="#l20.25"></a><span id="l20.25">         // Set up the unifinder views.</span>
<a href="#l20.26"></a><span id="l20.26">         unifinderTreeView.treeElement = unifinderTree;</span>
<a href="#l20.27"></a><span id="l20.27">         unifinderTree.view = unifinderTreeView;</span>
<a href="#l20.28"></a><span id="l20.28"> </span>
<a href="#l20.29"></a><span id="l20.29">         // Listen for changes in the selected day, so we can update if need be</span>
<a href="#l20.30"></a><span id="l20.30">         let viewDeck = getViewDeck();</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-        viewDeck.addEventListener(&quot;dayselect&quot;, unifinderDaySelect, false);</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+        viewDeck.addEventListener(&quot;dayselect&quot;, unifinderDaySelect);</span>
<a href="#l20.33"></a><span id="l20.33">         viewDeck.addEventListener(&quot;itemselect&quot;, unifinderItemSelect, true);</span>
<a href="#l20.34"></a><span id="l20.34"> </span>
<a href="#l20.35"></a><span id="l20.35">         // Set up sortDirection and sortActive, in case it persisted</span>
<a href="#l20.36"></a><span id="l20.36">         let sorted = unifinderTree.getAttribute(&quot;sort-active&quot;);</span>
<a href="#l20.37"></a><span id="l20.37">         let sortDirection = unifinderTree.getAttribute(&quot;sort-direction&quot;);</span>
<a href="#l20.38"></a><span id="l20.38">         if (!sortDirection || sortDirection == &quot;undefined&quot;) {</span>
<a href="#l20.39"></a><span id="l20.39">             sortDirection = &quot;ascending&quot;;</span>
<a href="#l20.40"></a><span id="l20.40">         }</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineat">@@ -244,21 +244,21 @@ function prepareCalendarUnifinder() {</span>
<a href="#l20.42"></a><span id="l20.42">  * added.</span>
<a href="#l20.43"></a><span id="l20.43">  */</span>
<a href="#l20.44"></a><span id="l20.44"> function finishCalendarUnifinder() {</span>
<a href="#l20.45"></a><span id="l20.45">     let ccalendar = cal.getCompositeCalendar(window);</span>
<a href="#l20.46"></a><span id="l20.46">     ccalendar.removeObserver(unifinderObserver);</span>
<a href="#l20.47"></a><span id="l20.47"> </span>
<a href="#l20.48"></a><span id="l20.48">     // Remove pref observer</span>
<a href="#l20.49"></a><span id="l20.49">     let branch = Services.prefs.getBranch(&quot;&quot;);</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-    branch.removeObserver(&quot;calendar.&quot;, unifinderObserver, false);</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+    branch.removeObserver(&quot;calendar.&quot;, unifinderObserver);</span>
<a href="#l20.52"></a><span id="l20.52"> </span>
<a href="#l20.53"></a><span id="l20.53">     let viewDeck = getViewDeck();</span>
<a href="#l20.54"></a><span id="l20.54">     if (viewDeck) {</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineminus">-        viewDeck.removeEventListener(&quot;dayselect&quot;, unifinderDaySelect, false);</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineplus">+        viewDeck.removeEventListener(&quot;dayselect&quot;, unifinderDaySelect);</span>
<a href="#l20.57"></a><span id="l20.57">         viewDeck.removeEventListener(&quot;itemselect&quot;, unifinderItemSelect, true);</span>
<a href="#l20.58"></a><span id="l20.58">     }</span>
<a href="#l20.59"></a><span id="l20.59"> </span>
<a href="#l20.60"></a><span id="l20.60">     // Persist the sort</span>
<a href="#l20.61"></a><span id="l20.61">     let unifinderTree = document.getElementById(&quot;unifinder-search-results-tree&quot;);</span>
<a href="#l20.62"></a><span id="l20.62">     let sorted = unifinderTreeView.selectedColumn;</span>
<a href="#l20.63"></a><span id="l20.63">     if (sorted) {</span>
<a href="#l20.64"></a><span id="l20.64">         unifinderTree.setAttribute(&quot;sort-active&quot;, sorted.getAttribute(&quot;itemproperty&quot;));</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineat">@@ -950,10 +950,10 @@ function toggleUnifinder() {</span>
<a href="#l20.66"></a><span id="l20.66"> </span>
<a href="#l20.67"></a><span id="l20.67">     // Make sure the selection is correct</span>
<a href="#l20.68"></a><span id="l20.68">     if (unifinderTreeView.doingSelection) {</span>
<a href="#l20.69"></a><span id="l20.69">         unifinderTreeView.resetAllowSelection();</span>
<a href="#l20.70"></a><span id="l20.70">     }</span>
<a href="#l20.71"></a><span id="l20.71">     unifinderTreeView.setSelectedItems();</span>
<a href="#l20.72"></a><span id="l20.72"> }</span>
<a href="#l20.73"></a><span id="l20.73"> </span>
<a href="#l20.74"></a><span id="l20.74" class="difflineminus">-window.addEventListener(&quot;load&quot;, prepareCalendarUnifinder, false);</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineminus">-window.addEventListener(&quot;unload&quot;, finishCalendarUnifinder, false);</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineplus">+window.addEventListener(&quot;load&quot;, prepareCalendarUnifinder);</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineplus">+window.addEventListener(&quot;unload&quot;, finishCalendarUnifinder);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/content/calendar-view-core.xml</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/content/calendar-view-core.xml</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -294,17 +294,16 @@</span>
<a href="#l21.4"></a><span id="l21.4">               // Note that as soon as we do the modifyItem, this element ceases to exist,</span>
<a href="#l21.5"></a><span id="l21.5">               // so don't bother trying to modify anything further here! ('this' exists,</span>
<a href="#l21.6"></a><span id="l21.6">               // because it's being kept alive, but our child content etc. is all gone)</span>
<a href="#l21.7"></a><span id="l21.7">               return;</span>
<a href="#l21.8"></a><span id="l21.8">           }</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10">           this.eventNameTextbox.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l21.11"></a><span id="l21.11">           this.eventNameLabel.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-          return;</span>
<a href="#l21.13"></a><span id="l21.13">         ]]&gt;&lt;/body&gt;</span>
<a href="#l21.14"></a><span id="l21.14">       &lt;/method&gt;</span>
<a href="#l21.15"></a><span id="l21.15">     &lt;/implementation&gt;</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17">     &lt;handlers&gt;</span>
<a href="#l21.18"></a><span id="l21.18">       &lt;handler event=&quot;contextmenu&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l21.19"></a><span id="l21.19">         // If the middle/right button was used for click just select the item.</span>
<a href="#l21.20"></a><span id="l21.20">         if (!this.selected) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -208,30 +208,36 @@ function switchToView(aViewType) {</span>
<a href="#l22.4"></a><span id="l22.4">                 node.setAttribute(attr, node.getAttribute(attr + &quot;-&quot; + aViewType));</span>
<a href="#l22.5"></a><span id="l22.5">             } else {</span>
<a href="#l22.6"></a><span id="l22.6">                 node.setAttribute(attr, node.getAttribute(attr + &quot;-all&quot;));</span>
<a href="#l22.7"></a><span id="l22.7">             }</span>
<a href="#l22.8"></a><span id="l22.8">         }</span>
<a href="#l22.9"></a><span id="l22.9">     }</span>
<a href="#l22.10"></a><span id="l22.10"> </span>
<a href="#l22.11"></a><span id="l22.11">     // Set up the labels and accesskeys for the context menu</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    [&quot;calendar-view-context-menu-next&quot;,</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-     &quot;calendar-view-context-menu-previous&quot;,</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-     &quot;calendar-go-menu-next&quot;,</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-     &quot;calendar-go-menu-previous&quot;,</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-     &quot;appmenu_calendar-go-menu-next&quot;,</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-     &quot;appmenu_calendar-go-menu-previous&quot;].forEach((x) =&gt; {</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-         setupViewNode(x, &quot;label&quot;);</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-         setupViewNode(x, &quot;accesskey&quot;);</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-     });</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+    let ids = [</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineplus">+        &quot;calendar-view-context-menu-next&quot;,</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineplus">+        &quot;calendar-view-context-menu-previous&quot;,</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineplus">+        &quot;calendar-go-menu-next&quot;,</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+        &quot;calendar-go-menu-previous&quot;,</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+        &quot;appmenu_calendar-go-menu-next&quot;,</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineplus">+        &quot;appmenu_calendar-go-menu-previous&quot;</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineplus">+    ];</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineplus">+    ids.forEach((x) =&gt; {</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineplus">+        setupViewNode(x, &quot;label&quot;);</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineplus">+        setupViewNode(x, &quot;accesskey&quot;);</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+    });</span>
<a href="#l22.33"></a><span id="l22.33"> </span>
<a href="#l22.34"></a><span id="l22.34">     // Set up the labels for the view navigation</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineminus">-    [&quot;previous-view-button&quot;,</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineminus">-     &quot;today-view-button&quot;,</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineminus">-     &quot;next-view-button&quot;].forEach(x =&gt; setupViewNode(x, &quot;tooltiptext&quot;));</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+    ids = [</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+        &quot;previous-view-button&quot;,</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+        &quot;today-view-button&quot;,</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+        &quot;next-view-button&quot;</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineplus">+    ];</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineplus">+    ids.forEach(x =&gt; setupViewNode(x, &quot;tooltiptext&quot;));</span>
<a href="#l22.44"></a><span id="l22.44"> </span>
<a href="#l22.45"></a><span id="l22.45">     try {</span>
<a href="#l22.46"></a><span id="l22.46">         selectedDay = viewDeck.selectedPanel.selectedDay;</span>
<a href="#l22.47"></a><span id="l22.47">         currentSelection = viewDeck.selectedPanel.getSelectedItems({});</span>
<a href="#l22.48"></a><span id="l22.48">     } catch (ex) {</span>
<a href="#l22.49"></a><span id="l22.49">         // This dies if no view has even been chosen this session, but that's</span>
<a href="#l22.50"></a><span id="l22.50">         // ok because we'll just use cal.now() below.</span>
<a href="#l22.51"></a><span id="l22.51">     }</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineat">@@ -335,17 +341,17 @@ function scheduleMidnightUpdate(aRefresh</span>
<a href="#l22.53"></a><span id="l22.53">         };</span>
<a href="#l22.54"></a><span id="l22.54"> </span>
<a href="#l22.55"></a><span id="l22.55">         // Add observer</span>
<a href="#l22.56"></a><span id="l22.56">         Services.obs.addObserver(wakeObserver, &quot;wake_notification&quot;, false);</span>
<a href="#l22.57"></a><span id="l22.57"> </span>
<a href="#l22.58"></a><span id="l22.58">         // Remove observer on unload</span>
<a href="#l22.59"></a><span id="l22.59">         window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l22.60"></a><span id="l22.60">             Services.obs.removeObserver(wakeObserver, &quot;wake_notification&quot;);</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineminus">-        }, false);</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineplus">+        });</span>
<a href="#l22.63"></a><span id="l22.63">         gMidnightTimer = Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l22.64"></a><span id="l22.64">                                    .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l22.65"></a><span id="l22.65">     }</span>
<a href="#l22.66"></a><span id="l22.66">     gMidnightTimer.initWithCallback(udCallback, msUntilTomorrow, gMidnightTimer.TYPE_ONE_SHOT);</span>
<a href="#l22.67"></a><span id="l22.67"> }</span>
<a href="#l22.68"></a><span id="l22.68"> </span>
<a href="#l22.69"></a><span id="l22.69"> /**</span>
<a href="#l22.70"></a><span id="l22.70">  * Retuns a cached copy of the view stylesheet.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-alarm-dialog.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-alarm-dialog.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -266,19 +266,19 @@ function addWidgetFor(aItem, aAlarm) {</span>
<a href="#l23.4"></a><span id="l23.4">     let widget = document.createElement(&quot;calendar-alarm-widget&quot;);</span>
<a href="#l23.5"></a><span id="l23.5">     let alarmRichlist = document.getElementById(&quot;alarm-richlist&quot;);</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7">     // Add widgets sorted by start date ascending</span>
<a href="#l23.8"></a><span id="l23.8">     cal.binaryInsertNode(alarmRichlist, widget, aItem, widgetAlarmComptor, false);</span>
<a href="#l23.9"></a><span id="l23.9"> </span>
<a href="#l23.10"></a><span id="l23.10">     widget.item = aItem;</span>
<a href="#l23.11"></a><span id="l23.11">     widget.alarm = aAlarm;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    widget.addEventListener(&quot;snooze&quot;, onSnoozeAlarm, false);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-    widget.addEventListener(&quot;dismiss&quot;, onDismissAlarm, false);</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-    widget.addEventListener(&quot;itemdetails&quot;, onItemDetails, false);</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+    widget.addEventListener(&quot;snooze&quot;, onSnoozeAlarm);</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+    widget.addEventListener(&quot;dismiss&quot;, onDismissAlarm);</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineplus">+    widget.addEventListener(&quot;itemdetails&quot;, onItemDetails);</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19">     setupTitle();</span>
<a href="#l23.20"></a><span id="l23.20"> </span>
<a href="#l23.21"></a><span id="l23.21">     if (!alarmRichlist.userSelectedWidget) {</span>
<a href="#l23.22"></a><span id="l23.22">         // Always select first widget of the list.</span>
<a href="#l23.23"></a><span id="l23.23">         // Since the onselect event causes scrolling,</span>
<a href="#l23.24"></a><span id="l23.24">         // we don't want to process the event when adding widgets.</span>
<a href="#l23.25"></a><span id="l23.25">         alarmRichlist.suppressOnSelect = true;</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineat">@@ -306,19 +306,19 @@ function removeWidgetFor(aItem, aAlarm) </span>
<a href="#l23.27"></a><span id="l23.27">         if (widget.item &amp;&amp; widget.item.hashId == hashId &amp;&amp;</span>
<a href="#l23.28"></a><span id="l23.28">             widget.alarm &amp;&amp; widget.alarm.icalString == aAlarm.icalString) {</span>
<a href="#l23.29"></a><span id="l23.29">             if (widget.selected) {</span>
<a href="#l23.30"></a><span id="l23.30">                 // Advance selection if needed</span>
<a href="#l23.31"></a><span id="l23.31">                 widget.control.selectedItem = widget.previousSibling ||</span>
<a href="#l23.32"></a><span id="l23.32">                                               widget.nextSibling;</span>
<a href="#l23.33"></a><span id="l23.33">             }</span>
<a href="#l23.34"></a><span id="l23.34"> </span>
<a href="#l23.35"></a><span id="l23.35" class="difflineminus">-            widget.removeEventListener(&quot;snooze&quot;, onSnoozeAlarm, false);</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineminus">-            widget.removeEventListener(&quot;dismiss&quot;, onDismissAlarm, false);</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineminus">-            widget.removeEventListener(&quot;itemdetails&quot;, onItemDetails, false);</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineplus">+            widget.removeEventListener(&quot;snooze&quot;, onSnoozeAlarm);</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineplus">+            widget.removeEventListener(&quot;dismiss&quot;, onDismissAlarm);</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineplus">+            widget.removeEventListener(&quot;itemdetails&quot;, onItemDetails);</span>
<a href="#l23.41"></a><span id="l23.41"> </span>
<a href="#l23.42"></a><span id="l23.42">             widget.remove();</span>
<a href="#l23.43"></a><span id="l23.43">             closeIfEmpty();</span>
<a href="#l23.44"></a><span id="l23.44">             notfound = false;</span>
<a href="#l23.45"></a><span id="l23.45">         }</span>
<a href="#l23.46"></a><span id="l23.46">     }</span>
<a href="#l23.47"></a><span id="l23.47"> </span>
<a href="#l23.48"></a><span id="l23.48">     // Update the title</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -117,17 +117,17 @@ function onLoad() {</span>
<a href="#l24.4"></a><span id="l24.4">                     propagateDateTime();</span>
<a href="#l24.5"></a><span id="l24.5">                     break;</span>
<a href="#l24.6"></a><span id="l24.6">             }</span>
<a href="#l24.7"></a><span id="l24.7">         }</span>
<a href="#l24.8"></a><span id="l24.8">     };</span>
<a href="#l24.9"></a><span id="l24.9">     Services.prefs.addObserver(&quot;calendar.&quot;, prefObserver, false);</span>
<a href="#l24.10"></a><span id="l24.10">     window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l24.11"></a><span id="l24.11">         Services.prefs.removeObserver(&quot;calendar.&quot;, prefObserver);</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-    }, false);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+    });</span>
<a href="#l24.14"></a><span id="l24.14"> </span>
<a href="#l24.15"></a><span id="l24.15">     opener.setCursor(&quot;auto&quot;);</span>
<a href="#l24.16"></a><span id="l24.16">     self.focus();</span>
<a href="#l24.17"></a><span id="l24.17"> }</span>
<a href="#l24.18"></a><span id="l24.18"> </span>
<a href="#l24.19"></a><span id="l24.19"> /**</span>
<a href="#l24.20"></a><span id="l24.20">  * This function should be called when the accept button was pressed on the</span>
<a href="#l24.21"></a><span id="l24.21">  * attendee dialog. Calls the accept function specified in the window arguments.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -1064,18 +1064,20 @@</span>
<a href="#l25.4"></a><span id="l25.4">         function cycle(values, current) {</span>
<a href="#l25.5"></a><span id="l25.5">             let nextIndex = (values.indexOf(current) + 1) % values.length;</span>
<a href="#l25.6"></a><span id="l25.6">             return values[nextIndex];</span>
<a href="#l25.7"></a><span id="l25.7">         }</span>
<a href="#l25.8"></a><span id="l25.8"> </span>
<a href="#l25.9"></a><span id="l25.9">         let target = event.originalTarget;</span>
<a href="#l25.10"></a><span id="l25.10">         if (target.className == &quot;role-icon&quot;) {</span>
<a href="#l25.11"></a><span id="l25.11">             if (target.getAttribute(&quot;disabled&quot;) != &quot;true&quot;) {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-                const roleCycle = [&quot;REQ-PARTICIPANT&quot;, &quot;OPT-PARTICIPANT&quot;,</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-                                   &quot;NON-PARTICIPANT&quot;, &quot;CHAIR&quot;];</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+                const roleCycle = [</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+                    &quot;REQ-PARTICIPANT&quot;, &quot;OPT-PARTICIPANT&quot;,</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+                    &quot;NON-PARTICIPANT&quot;, &quot;CHAIR&quot;</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+                ];</span>
<a href="#l25.18"></a><span id="l25.18"> </span>
<a href="#l25.19"></a><span id="l25.19">                 let nextValue = cycle(roleCycle, target.getAttribute(&quot;role&quot;));</span>
<a href="#l25.20"></a><span id="l25.20">                 target.setAttribute(&quot;role&quot;, nextValue);</span>
<a href="#l25.21"></a><span id="l25.21">                 this.updateTooltip(target);</span>
<a href="#l25.22"></a><span id="l25.22">             }</span>
<a href="#l25.23"></a><span id="l25.23">         } else if (target.className == &quot;status-icon&quot;) {</span>
<a href="#l25.24"></a><span id="l25.24">             if (target.getAttribute(&quot;disabled&quot;) != &quot;true&quot;) {</span>
<a href="#l25.25"></a><span id="l25.25">                 const statusCycle = [&quot;ACCEPTED&quot;, &quot;DECLINED&quot;, &quot;TENTATIVE&quot;];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -773,32 +773,35 @@ function changeOrderForElements(aPropKey</span>
<a href="#l26.4"></a><span id="l26.4">         Components.utils.reportError(msg + &quot; &quot; + ex);</span>
<a href="#l26.5"></a><span id="l26.5">         return;</span>
<a href="#l26.6"></a><span id="l26.6">     }</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8">     // Add elements in the right order, removing them from their old parent</span>
<a href="#l26.9"></a><span id="l26.9">     for (let i = 0; i &lt; aPropParams.length; i++) {</span>
<a href="#l26.10"></a><span id="l26.10">         let newEl = document.getElementById(localeOrder[i]);</span>
<a href="#l26.11"></a><span id="l26.11">         if (newEl) {</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-            parents[i].appendChild(newEl.parentNode.removeChild(newEl));</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+            parents[i].appendChild(newEl);</span>
<a href="#l26.14"></a><span id="l26.14">         } else {</span>
<a href="#l26.15"></a><span id="l26.15">             cal.ERROR(&quot;Localization error, could not find node '&quot; + localeOrder[i] + &quot;'. Please have your localizer check the string '&quot; + aPropKey + &quot;'&quot;);</span>
<a href="#l26.16"></a><span id="l26.16">         }</span>
<a href="#l26.17"></a><span id="l26.17">     }</span>
<a href="#l26.18"></a><span id="l26.18"> }</span>
<a href="#l26.19"></a><span id="l26.19"> </span>
<a href="#l26.20"></a><span id="l26.20"> /**</span>
<a href="#l26.21"></a><span id="l26.21">  * Change locale-specific widget order for Edit Recurrence window</span>
<a href="#l26.22"></a><span id="l26.22">  */</span>
<a href="#l26.23"></a><span id="l26.23"> function changeWidgetsOrder() {</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineminus">-    changeOrderForElements(&quot;monthlyOrder&quot;,</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineminus">-                           [&quot;monthly-ordinal&quot;,</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineminus">-                            &quot;monthly-weekday&quot;]);</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineminus">-    changeOrderForElements(&quot;yearlyOrder&quot;,</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineminus">-                           [&quot;yearly-days&quot;,</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineminus">-                            &quot;yearly-period-of-month-label&quot;,</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-                            &quot;yearly-month-ordinal&quot;]);</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-    changeOrderForElements(&quot;yearlyOrder2&quot;,</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">-                           [&quot;yearly-ordinal&quot;,</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">-                            &quot;yearly-weekday&quot;,</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineminus">-                            &quot;yearly-period-of-label&quot;,</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">-                            &quot;yearly-month-rule&quot;]);</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+    changeOrderForElements(&quot;monthlyOrder&quot;, [</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineplus">+        &quot;monthly-ordinal&quot;,</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineplus">+        &quot;monthly-weekday&quot;</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineplus">+    ]);</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineplus">+    changeOrderForElements(&quot;yearlyOrder&quot;, [</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineplus">+        &quot;yearly-days&quot;,</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineplus">+        &quot;yearly-period-of-month-label&quot;,</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+        &quot;yearly-month-ordinal&quot;</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineplus">+    ]);</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineplus">+    changeOrderForElements(&quot;yearlyOrder2&quot;, [</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineplus">+        &quot;yearly-ordinal&quot;,</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineplus">+        &quot;yearly-weekday&quot;,</span>
<a href="#l26.48"></a><span id="l26.48" class="difflineplus">+        &quot;yearly-period-of-label&quot;,</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineplus">+        &quot;yearly-month-rule&quot;</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineplus">+    ]);</span>
<a href="#l26.51"></a><span id="l26.51"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-summary-dialog.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-summary-dialog.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l27.4"></a><span id="l27.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l27.5"></a><span id="l27.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l27.6"></a><span id="l27.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> /* exported onLoad, onAccept, onCancel, updatePartStat, browseDocument,</span>
<a href="#l27.9"></a><span id="l27.9" class="difflineminus">- *          sendMailToOrganizer</span>
<a href="#l27.10"></a><span id="l27.10" class="difflineplus">+ *          sendMailToOrganizer, openAttachment</span>
<a href="#l27.11"></a><span id="l27.11">  */</span>
<a href="#l27.12"></a><span id="l27.12"> </span>
<a href="#l27.13"></a><span id="l27.13"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l27.14"></a><span id="l27.14"> Components.utils.import(&quot;resource://calendar/modules/calItipUtils.jsm&quot;);</span>
<a href="#l27.15"></a><span id="l27.15"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l27.16"></a><span id="l27.16"> Components.utils.import(&quot;resource://calendar/modules/calRecurrenceUtils.jsm&quot;);</span>
<a href="#l27.17"></a><span id="l27.17"> </span>
<a href="#l27.18"></a><span id="l27.18"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/content/import-export.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/content/import-export.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -108,24 +108,21 @@ function loadEventsFromFile(aCalendar) {</span>
<a href="#l28.4"></a><span id="l28.4">         if (aCalendar) {</span>
<a href="#l28.5"></a><span id="l28.5">             putItemsIntoCal(aCalendar, items);</span>
<a href="#l28.6"></a><span id="l28.6">             return;</span>
<a href="#l28.7"></a><span id="l28.7">         }</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9">         let calendars = cal.getCalendarManager().getCalendars({});</span>
<a href="#l28.10"></a><span id="l28.10">         calendars = calendars.filter(cal.isCalendarWritable);</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-        if (calendars.length &lt; 1) {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-            // XXX alert something?</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-            return;</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineminus">-        } else if (calendars.length == 1) {</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineplus">+        if (calendars.length == 1) {</span>
<a href="#l28.17"></a><span id="l28.17">             // There's only one calendar, so it's silly to ask what calendar</span>
<a href="#l28.18"></a><span id="l28.18">             // the user wants to import into.</span>
<a href="#l28.19"></a><span id="l28.19">             putItemsIntoCal(calendars[0], items, filePath);</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineminus">-        } else {</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineplus">+        } else if (calendars.length &gt; 1) {</span>
<a href="#l28.22"></a><span id="l28.22">             // Ask what calendar to import into</span>
<a href="#l28.23"></a><span id="l28.23">             let args = {};</span>
<a href="#l28.24"></a><span id="l28.24">             args.onOk = (aCal) =&gt; { putItemsIntoCal(aCal, items, filePath); };</span>
<a href="#l28.25"></a><span id="l28.25">             args.calendars = calendars;</span>
<a href="#l28.26"></a><span id="l28.26">             args.promptText = cal.calGetString(&quot;calendar&quot;, &quot;importPrompt&quot;);</span>
<a href="#l28.27"></a><span id="l28.27">             openDialog(&quot;chrome://calendar/content/chooseCalendarDialog.xul&quot;,</span>
<a href="#l28.28"></a><span id="l28.28">                        &quot;_blank&quot;, &quot;chrome,titlebar,modal,resizable&quot;, args);</span>
<a href="#l28.29"></a><span id="l28.29">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/content/preferences/alarms.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/content/preferences/alarms.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -118,21 +118,22 @@ var gAlarmsPane = {</span>
<a href="#l29.4"></a><span id="l29.4">     },</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6">     /**</span>
<a href="#l29.7"></a><span id="l29.7">      * Handler function to call when the calendar.alarms.playsound preference</span>
<a href="#l29.8"></a><span id="l29.8">      * has been changed. Updates the disabled state of fields that depend on</span>
<a href="#l29.9"></a><span id="l29.9">      * playing a sound.</span>
<a href="#l29.10"></a><span id="l29.10">      */</span>
<a href="#l29.11"></a><span id="l29.11">     alarmsPlaySoundPrefChanged: function() {</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-        let alarmsPlaySoundPref =</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-            document.getElementById(&quot;calendar.alarms.playsound&quot;);</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+        let alarmsPlaySoundPref = document.getElementById(&quot;calendar.alarms.playsound&quot;);</span>
<a href="#l29.15"></a><span id="l29.15"> </span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">-        let items = [document.getElementById(&quot;alarmSoundFileField&quot;),</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineminus">-                     document.getElementById(&quot;calendar.prefs.alarm.sound.useDefault&quot;),</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineminus">-                     document.getElementById(&quot;calendar.prefs.alarm.sound.browse&quot;),</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineminus">-                     document.getElementById(&quot;calendar.prefs.alarm.sound.play&quot;)];</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineplus">+        let items = [</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineplus">+            document.getElementById(&quot;alarmSoundFileField&quot;),</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineplus">+            document.getElementById(&quot;calendar.prefs.alarm.sound.useDefault&quot;),</span>
<a href="#l29.23"></a><span id="l29.23" class="difflineplus">+            document.getElementById(&quot;calendar.prefs.alarm.sound.browse&quot;),</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineplus">+            document.getElementById(&quot;calendar.prefs.alarm.sound.play&quot;)</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineplus">+        ];</span>
<a href="#l29.26"></a><span id="l29.26"> </span>
<a href="#l29.27"></a><span id="l29.27" class="difflineminus">-        for (let i = 0; i &lt; items.length; i++) {</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineminus">-            items[i].disabled = !alarmsPlaySoundPref.value;</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineplus">+        for (let item of items) {</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineplus">+            item.disabled = !alarmsPlaySoundPref.value;</span>
<a href="#l29.31"></a><span id="l29.31">         }</span>
<a href="#l29.32"></a><span id="l29.32">     }</span>
<a href="#l29.33"></a><span id="l29.33"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/content/today-pane.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/content/today-pane.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -20,42 +20,44 @@ var TodayPane = {</span>
<a href="#l30.4"></a><span id="l30.4">         distance: 0,</span>
<a href="#l30.5"></a><span id="l30.5">         session: false</span>
<a href="#l30.6"></a><span id="l30.6">     },</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8">     /**</span>
<a href="#l30.9"></a><span id="l30.9">      * Load Handler, sets up the today pane controls.</span>
<a href="#l30.10"></a><span id="l30.10">      */</span>
<a href="#l30.11"></a><span id="l30.11">     onLoad: function() {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-        TodayPane.paneViews = [cal.calGetString(&quot;calendar&quot;, &quot;eventsandtasks&quot;),</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-                               cal.calGetString(&quot;calendar&quot;, &quot;tasksonly&quot;),</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineminus">-                               cal.calGetString(&quot;calendar&quot;, &quot;eventsonly&quot;)];</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+        TodayPane.paneViews = [</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineplus">+            cal.calGetString(&quot;calendar&quot;, &quot;eventsandtasks&quot;),</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+            cal.calGetString(&quot;calendar&quot;, &quot;tasksonly&quot;),</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineplus">+            cal.calGetString(&quot;calendar&quot;, &quot;eventsonly&quot;)</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+        ];</span>
<a href="#l30.20"></a><span id="l30.20">         agendaListbox.setupCalendar();</span>
<a href="#l30.21"></a><span id="l30.21">         TodayPane.initializeMiniday();</span>
<a href="#l30.22"></a><span id="l30.22">         TodayPane.setShortWeekdays();</span>
<a href="#l30.23"></a><span id="l30.23"> </span>
<a href="#l30.24"></a><span id="l30.24" class="difflineminus">-        document.getElementById(&quot;modeBroadcaster&quot;).addEventListener(&quot;DOMAttrModified&quot;, TodayPane.onModeModified, false);</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineplus">+        document.getElementById(&quot;modeBroadcaster&quot;).addEventListener(&quot;DOMAttrModified&quot;, TodayPane.onModeModified);</span>
<a href="#l30.26"></a><span id="l30.26">         TodayPane.setTodayHeader();</span>
<a href="#l30.27"></a><span id="l30.27"> </span>
<a href="#l30.28"></a><span id="l30.28" class="difflineminus">-        document.getElementById(&quot;today-splitter&quot;).addEventListener(&quot;command&quot;, onCalendarViewResize, false);</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineplus">+        document.getElementById(&quot;today-splitter&quot;).addEventListener(&quot;command&quot;, onCalendarViewResize);</span>
<a href="#l30.30"></a><span id="l30.30">         TodayPane.updateSplitterState();</span>
<a href="#l30.31"></a><span id="l30.31">         TodayPane.previousMode = document.getElementById(&quot;modeBroadcaster&quot;).getAttribute(&quot;mode&quot;);</span>
<a href="#l30.32"></a><span id="l30.32">         TodayPane.showTodayPaneStatusLabel();</span>
<a href="#l30.33"></a><span id="l30.33">         // Workaround for bug 1360914. For unknown reasons, setTodayHeader() sets</span>
<a href="#l30.34"></a><span id="l30.34">         // the selectedIndex of the &quot;monthNameContainer&quot; deck to a wrong value so</span>
<a href="#l30.35"></a><span id="l30.35">         // the miniday needs to be initialized again.</span>
<a href="#l30.36"></a><span id="l30.36">         TodayPane.initializeMiniday();</span>
<a href="#l30.37"></a><span id="l30.37">     },</span>
<a href="#l30.38"></a><span id="l30.38"> </span>
<a href="#l30.39"></a><span id="l30.39">     /**</span>
<a href="#l30.40"></a><span id="l30.40">      * Unload handler, cleans up the today pane on window unload.</span>
<a href="#l30.41"></a><span id="l30.41">      */</span>
<a href="#l30.42"></a><span id="l30.42">     onUnload: function() {</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineminus">-        document.getElementById(&quot;modeBroadcaster&quot;).removeEventListener(&quot;DOMAttrModified&quot;, TodayPane.onModeModified, false);</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineminus">-        document.getElementById(&quot;today-splitter&quot;).removeEventListener(&quot;command&quot;, onCalendarViewResize, false);</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineplus">+        document.getElementById(&quot;modeBroadcaster&quot;).removeEventListener(&quot;DOMAttrModified&quot;, TodayPane.onModeModified);</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineplus">+        document.getElementById(&quot;today-splitter&quot;).removeEventListener(&quot;command&quot;, onCalendarViewResize);</span>
<a href="#l30.47"></a><span id="l30.47">     },</span>
<a href="#l30.48"></a><span id="l30.48"> </span>
<a href="#l30.49"></a><span id="l30.49">     /**</span>
<a href="#l30.50"></a><span id="l30.50">      * Sets up the label for the switcher that allows switching between today pane</span>
<a href="#l30.51"></a><span id="l30.51">      * views. (event+task, task only, event only)</span>
<a href="#l30.52"></a><span id="l30.52">      */</span>
<a href="#l30.53"></a><span id="l30.53">     setTodayHeader: function() {</span>
<a href="#l30.54"></a><span id="l30.54">         let currentMode = document.getElementById(&quot;modeBroadcaster&quot;).getAttribute(&quot;mode&quot;);</span>
<a href="#l30.55"></a><span id="l30.55" class="difflineat">@@ -145,23 +147,23 @@ var TodayPane = {</span>
<a href="#l30.56"></a><span id="l30.56">     onMousedown: function(aEvent, aDir) {</span>
<a href="#l30.57"></a><span id="l30.57">         if (aEvent.button != 0) {</span>
<a href="#l30.58"></a><span id="l30.58">             return;</span>
<a href="#l30.59"></a><span id="l30.59">         }</span>
<a href="#l30.60"></a><span id="l30.60">         let element = aEvent.target;</span>
<a href="#l30.61"></a><span id="l30.61">         if (element.id == &quot;previous-day-button&quot; ||</span>
<a href="#l30.62"></a><span id="l30.62">              element.id == &quot;next-day-button&quot;) {</span>
<a href="#l30.63"></a><span id="l30.63">             // Start switching days by pressing, without release, the navigation buttons</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineminus">-            element.addEventListener(&quot;mouseout&quot;, TodayPane.stopSwitching, false);</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineminus">-            element.addEventListener(&quot;mouseup&quot;, TodayPane.stopSwitching, false);</span>
<a href="#l30.66"></a><span id="l30.66" class="difflineplus">+            element.addEventListener(&quot;mouseout&quot;, TodayPane.stopSwitching);</span>
<a href="#l30.67"></a><span id="l30.67" class="difflineplus">+            element.addEventListener(&quot;mouseup&quot;, TodayPane.stopSwitching);</span>
<a href="#l30.68"></a><span id="l30.68">             TodayPane.minidayTimer = setTimeout(TodayPane.updateAdvanceTimer.bind(TodayPane, Event, aDir), 500);</span>
<a href="#l30.69"></a><span id="l30.69">         } else if (element.id == &quot;datevalue-label&quot;) {</span>
<a href="#l30.70"></a><span id="l30.70">             // Start switching days by dragging the mouse with a starting point on the day label</span>
<a href="#l30.71"></a><span id="l30.71" class="difflineminus">-            window.addEventListener(&quot;mousemove&quot;, TodayPane.onMousemove, false);</span>
<a href="#l30.72"></a><span id="l30.72" class="difflineminus">-            window.addEventListener(&quot;mouseup&quot;, TodayPane.stopSwitching, false);</span>
<a href="#l30.73"></a><span id="l30.73" class="difflineplus">+            window.addEventListener(&quot;mousemove&quot;, TodayPane.onMousemove);</span>
<a href="#l30.74"></a><span id="l30.74" class="difflineplus">+            window.addEventListener(&quot;mouseup&quot;, TodayPane.stopSwitching);</span>
<a href="#l30.75"></a><span id="l30.75">             TodayPane.minidayDrag.startX = aEvent.clientX;</span>
<a href="#l30.76"></a><span id="l30.76">             TodayPane.minidayDrag.startY = aEvent.clientY;</span>
<a href="#l30.77"></a><span id="l30.77">         }</span>
<a href="#l30.78"></a><span id="l30.78">     },</span>
<a href="#l30.79"></a><span id="l30.79"> </span>
<a href="#l30.80"></a><span id="l30.80">     /**</span>
<a href="#l30.81"></a><span id="l30.81">      * Figure out the mouse distance from the center of the day's label</span>
<a href="#l30.82"></a><span id="l30.82">      * to the current position.</span>
<a href="#l30.83"></a><span id="l30.83" class="difflineat">@@ -177,17 +179,17 @@ var TodayPane = {</span>
<a href="#l30.84"></a><span id="l30.84">                 let distance = Math.floor(Math.sqrt(x * x + y * y) - Math.sqrt(MIN_DRAG_DISTANCE_SQ));</span>
<a href="#l30.85"></a><span id="l30.85">                 // Dragging on the left/right side, the day date decrease/increase</span>
<a href="#l30.86"></a><span id="l30.86">                 TodayPane.minidayDrag.distance = (x &gt; 0) ? distance : -distance;</span>
<a href="#l30.87"></a><span id="l30.87">             } else {</span>
<a href="#l30.88"></a><span id="l30.88">                 TodayPane.minidayDrag.distance = 0;</span>
<a href="#l30.89"></a><span id="l30.89">             }</span>
<a href="#l30.90"></a><span id="l30.90">         } else if (x * x + y * y &gt; 9) {</span>
<a href="#l30.91"></a><span id="l30.91">             // move the mouse a bit before starting the drag session</span>
<a href="#l30.92"></a><span id="l30.92" class="difflineminus">-            window.addEventListener(&quot;mouseout&quot;, TodayPane.stopSwitching, false);</span>
<a href="#l30.93"></a><span id="l30.93" class="difflineplus">+            window.addEventListener(&quot;mouseout&quot;, TodayPane.stopSwitching);</span>
<a href="#l30.94"></a><span id="l30.94">             TodayPane.minidayDrag.session = true;</span>
<a href="#l30.95"></a><span id="l30.95">             let dragCenterImage = document.getElementById(&quot;dragCenter-image&quot;);</span>
<a href="#l30.96"></a><span id="l30.96">             dragCenterImage.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l30.97"></a><span id="l30.97">             // Move the starting point in the center so we have a fixed</span>
<a href="#l30.98"></a><span id="l30.98">             // point where stopping the day switching while still dragging</span>
<a href="#l30.99"></a><span id="l30.99">             let centerObj = dragCenterImage.boxObject;</span>
<a href="#l30.100"></a><span id="l30.100">             TodayPane.minidayDrag.startX = Math.floor(centerObj.x + centerObj.width / 2);</span>
<a href="#l30.101"></a><span id="l30.101">             TodayPane.minidayDrag.startY = Math.floor(centerObj.y + centerObj.height / 2);</span>
<a href="#l30.102"></a><span id="l30.102" class="difflineat">@@ -249,26 +251,26 @@ var TodayPane = {</span>
<a href="#l30.103"></a><span id="l30.103">                 let dir = element.getAttribute(&quot;dir&quot;);</span>
<a href="#l30.104"></a><span id="l30.104">                 TodayPane.advance(parseInt(dir, 10));</span>
<a href="#l30.105"></a><span id="l30.105">             }</span>
<a href="#l30.106"></a><span id="l30.106">         }</span>
<a href="#l30.107"></a><span id="l30.107">         if (element.id == &quot;previous-day-button&quot; ||</span>
<a href="#l30.108"></a><span id="l30.108">              element.id == &quot;next-day-button&quot;) {</span>
<a href="#l30.109"></a><span id="l30.109">             TodayPane.switchCounter = 0;</span>
<a href="#l30.110"></a><span id="l30.110">             let button = document.getElementById(element.id);</span>
<a href="#l30.111"></a><span id="l30.111" class="difflineminus">-            button.removeEventListener(&quot;mouseout&quot;, TodayPane.stopSwitching, false);</span>
<a href="#l30.112"></a><span id="l30.112" class="difflineplus">+            button.removeEventListener(&quot;mouseout&quot;, TodayPane.stopSwitching);</span>
<a href="#l30.113"></a><span id="l30.113">         }</span>
<a href="#l30.114"></a><span id="l30.114">         if (TodayPane.minidayDrag.session) {</span>
<a href="#l30.115"></a><span id="l30.115" class="difflineminus">-            window.removeEventListener(&quot;mouseout&quot;, TodayPane.stopSwitching, false);</span>
<a href="#l30.116"></a><span id="l30.116" class="difflineplus">+            window.removeEventListener(&quot;mouseout&quot;, TodayPane.stopSwitching);</span>
<a href="#l30.117"></a><span id="l30.117">             TodayPane.minidayDrag.distance = 0;</span>
<a href="#l30.118"></a><span id="l30.118">             document.getElementById(&quot;dragCenter-image&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l30.119"></a><span id="l30.119">             TodayPane.minidayDrag.session = false;</span>
<a href="#l30.120"></a><span id="l30.120">         }</span>
<a href="#l30.121"></a><span id="l30.121" class="difflineminus">-        window.removeEventListener(&quot;mousemove&quot;, TodayPane.onMousemove, false);</span>
<a href="#l30.122"></a><span id="l30.122" class="difflineminus">-        window.removeEventListener(&quot;mouseup&quot;, TodayPane.stopSwitching, false);</span>
<a href="#l30.123"></a><span id="l30.123" class="difflineplus">+        window.removeEventListener(&quot;mousemove&quot;, TodayPane.onMousemove);</span>
<a href="#l30.124"></a><span id="l30.124" class="difflineplus">+        window.removeEventListener(&quot;mouseup&quot;, TodayPane.stopSwitching);</span>
<a href="#l30.125"></a><span id="l30.125">     },</span>
<a href="#l30.126"></a><span id="l30.126"> </span>
<a href="#l30.127"></a><span id="l30.127">     /**</span>
<a href="#l30.128"></a><span id="l30.128">      * Helper function to set the month description on the today pane header.</span>
<a href="#l30.129"></a><span id="l30.129">      *</span>
<a href="#l30.130"></a><span id="l30.130">      * @param aMonthLabel       The XUL node to set the month label on.</span>
<a href="#l30.131"></a><span id="l30.131">      * @param aIndex            The month number, 0-based.</span>
<a href="#l30.132"></a><span id="l30.132">      * @param aYear             The year this month should be displayed with</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -90,18 +90,20 @@</span>
<a href="#l31.4"></a><span id="l31.4">               // enabled/disabled.</span>
<a href="#l31.5"></a><span id="l31.5">               document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l31.6"></a><span id="l31.6">           }</span>
<a href="#l31.7"></a><span id="l31.7">       })</span>
<a href="#l31.8"></a><span id="l31.8">       ]]&gt;&lt;/field&gt;</span>
<a href="#l31.9"></a><span id="l31.9">       &lt;field name=&quot;compositeObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l31.10"></a><span id="l31.10">       ({</span>
<a href="#l31.11"></a><span id="l31.11">           listTree: this,</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-          QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICompositeObserver,</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-                                                 Components.interfaces.calIObserver]),</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+          QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+              Components.interfaces.calICompositeObserver,</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+              Components.interfaces.calIObserver</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+          ]),</span>
<a href="#l31.18"></a><span id="l31.18"> </span>
<a href="#l31.19"></a><span id="l31.19">           // calICompositeObserver</span>
<a href="#l31.20"></a><span id="l31.20">           onCalendarAdded: function(aCalendar) {</span>
<a href="#l31.21"></a><span id="l31.21">               // Make sure the checkbox state is updated</span>
<a href="#l31.22"></a><span id="l31.22">               this.listTree.updateCalendar(aCalendar);</span>
<a href="#l31.23"></a><span id="l31.23">           },</span>
<a href="#l31.24"></a><span id="l31.24"> </span>
<a href="#l31.25"></a><span id="l31.25">           onCalendarRemoved: function(aCalendar) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -467,17 +467,17 @@</span>
<a href="#l32.4"></a><span id="l32.4">         Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l32.5"></a><span id="l32.5"> </span>
<a href="#l32.6"></a><span id="l32.6">         if (this.mObservesComposite == true) {</span>
<a href="#l32.7"></a><span id="l32.7">             cal.getCompositeCalendar(window).removeObserver(this);</span>
<a href="#l32.8"></a><span id="l32.8">         }</span>
<a href="#l32.9"></a><span id="l32.9"> </span>
<a href="#l32.10"></a><span id="l32.10">         // Remove pref observer</span>
<a href="#l32.11"></a><span id="l32.11">         let branch = Services.prefs.getBranch(&quot;&quot;);</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-        branch.removeObserver(&quot;calendar.&quot;, this, false);</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+        branch.removeObserver(&quot;calendar.&quot;, this);</span>
<a href="#l32.14"></a><span id="l32.14">       ]]&gt;&lt;/destructor&gt;</span>
<a href="#l32.15"></a><span id="l32.15"> </span>
<a href="#l32.16"></a><span id="l32.16">       &lt;!-- calIOperationListener methods --&gt;</span>
<a href="#l32.17"></a><span id="l32.17">       &lt;method name=&quot;onOperationComplete&quot;&gt;</span>
<a href="#l32.18"></a><span id="l32.18">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l32.19"></a><span id="l32.19">         &lt;parameter name=&quot;aStatus&quot;/&gt;</span>
<a href="#l32.20"></a><span id="l32.20">         &lt;parameter name=&quot;aOperationType&quot;/&gt;</span>
<a href="#l32.21"></a><span id="l32.21">         &lt;parameter name=&quot;aId&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/base/modules/calAlarmUtils.jsm</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/base/modules/calAlarmUtils.jsm</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -69,24 +69,22 @@ cal.alarms = {</span>
<a href="#l33.4"></a><span id="l33.4">                 // Handle all day events.  This is kinda weird, because they don't</span>
<a href="#l33.5"></a><span id="l33.5">                 // have a well defined startTime.  We just consider the start/end</span>
<a href="#l33.6"></a><span id="l33.6">                 // to be midnight in the user's timezone.</span>
<a href="#l33.7"></a><span id="l33.7">                 if (returnDate.isDate) {</span>
<a href="#l33.8"></a><span id="l33.8">                     let timezone = cal.calendarDefaultTimezone();</span>
<a href="#l33.9"></a><span id="l33.9">                     // This returns a copy, so no extra cloning needed.</span>
<a href="#l33.10"></a><span id="l33.10">                     returnDate = returnDate.getInTimezone(timezone);</span>
<a href="#l33.11"></a><span id="l33.11">                     returnDate.isDate = false;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+                } else if (returnDate.timezone.tzid == &quot;floating&quot;) {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+                    let timezone = cal.calendarDefaultTimezone();</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineplus">+                    returnDate = returnDate.getInTimezone(timezone);</span>
<a href="#l33.15"></a><span id="l33.15">                 } else {</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineminus">-                    if (returnDate.timezone.tzid == &quot;floating&quot;) {</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineminus">-                        let timezone = cal.calendarDefaultTimezone();</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineminus">-                        returnDate = returnDate.getInTimezone(timezone);</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineminus">-                    } else {</span>
<a href="#l33.20"></a><span id="l33.20" class="difflineminus">-                        // Clone the date to correctly add the duration.</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineminus">-                        returnDate = returnDate.clone();</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineminus">-                    }</span>
<a href="#l33.23"></a><span id="l33.23" class="difflineplus">+                    // Clone the date to correctly add the duration.</span>
<a href="#l33.24"></a><span id="l33.24" class="difflineplus">+                    returnDate = returnDate.clone();</span>
<a href="#l33.25"></a><span id="l33.25">                 }</span>
<a href="#l33.26"></a><span id="l33.26"> </span>
<a href="#l33.27"></a><span id="l33.27">                 returnDate.addDuration(aAlarm.offset);</span>
<a href="#l33.28"></a><span id="l33.28">                 return returnDate;</span>
<a href="#l33.29"></a><span id="l33.29">             }</span>
<a href="#l33.30"></a><span id="l33.30">         }</span>
<a href="#l33.31"></a><span id="l33.31">         return null;</span>
<a href="#l33.32"></a><span id="l33.32">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/base/modules/calExtract.jsm</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/base/modules/calExtract.jsm</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -183,17 +183,17 @@ Extractor.prototype = {</span>
<a href="#l34.4"></a><span id="l34.4">                 } else {</span>
<a href="#l34.5"></a><span id="l34.5">                     cal.LOG(&quot;[calExtract] Dictionary present, rules missing: &quot; + dicts[dict]);</span>
<a href="#l34.6"></a><span id="l34.6">                     continue;</span>
<a href="#l34.7"></a><span id="l34.7">                 }</span>
<a href="#l34.8"></a><span id="l34.8"> </span>
<a href="#l34.9"></a><span id="l34.9">                 let correct = 0;</span>
<a href="#l34.10"></a><span id="l34.10">                 let total = 0;</span>
<a href="#l34.11"></a><span id="l34.11">                 for (let word in words) {</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-                    words[word] = words[word].replace(/[()\d,;:?!#\.]/g, &quot;&quot;);</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+                    words[word] = words[word].replace(/[()\d,;:?!#.]/g, &quot;&quot;);</span>
<a href="#l34.14"></a><span id="l34.14">                     if (words[word].length &gt;= 2) {</span>
<a href="#l34.15"></a><span id="l34.15">                         total++;</span>
<a href="#l34.16"></a><span id="l34.16">                         if (spellchecker.check(words[word])) {</span>
<a href="#l34.17"></a><span id="l34.17">                             correct++;</span>
<a href="#l34.18"></a><span id="l34.18">                         }</span>
<a href="#l34.19"></a><span id="l34.19">                     }</span>
<a href="#l34.20"></a><span id="l34.20">                 }</span>
<a href="#l34.21"></a><span id="l34.21"> </span>
<a href="#l34.22"></a><span id="l34.22" class="difflineat">@@ -356,18 +356,18 @@ Extractor.prototype = {</span>
<a href="#l34.23"></a><span id="l34.23">         }</span>
<a href="#l34.24"></a><span id="l34.24">         this.markContained();</span>
<a href="#l34.25"></a><span id="l34.25">         this.collected = this.collected.sort(this.sort);</span>
<a href="#l34.26"></a><span id="l34.26"> </span>
<a href="#l34.27"></a><span id="l34.27">         return this.collected;</span>
<a href="#l34.28"></a><span id="l34.28">     },</span>
<a href="#l34.29"></a><span id="l34.29"> </span>
<a href="#l34.30"></a><span id="l34.30">     extractDayMonthYear: function(pattern, relation) {</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-        let alts = this.getRepPatterns(pattern, [&quot;(\\d{1,2})&quot;, &quot;(\\d{1,2})&quot;,</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineminus">-                                                 &quot;(\\d{2,4})&quot;]);</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineplus">+        let alts = this.getRepPatterns(pattern, [&quot;(\\d{1,2})&quot;, &quot;(\\d{1,2})&quot;, &quot;(\\d{2,4})&quot;]);</span>
<a href="#l34.34"></a><span id="l34.34" class="difflineplus">+</span>
<a href="#l34.35"></a><span id="l34.35">         let res;</span>
<a href="#l34.36"></a><span id="l34.36">         for (let alt in alts) {</span>
<a href="#l34.37"></a><span id="l34.37">             let positions = alts[alt].positions;</span>
<a href="#l34.38"></a><span id="l34.38">             let re = new RegExp(alts[alt].pattern, &quot;ig&quot;);</span>
<a href="#l34.39"></a><span id="l34.39"> </span>
<a href="#l34.40"></a><span id="l34.40">             while ((res = re.exec(this.email)) != null) {</span>
<a href="#l34.41"></a><span id="l34.41">                 if (!this.limitNums(res, this.email) &amp;&amp; !this.limitChars(res, this.email)) {</span>
<a href="#l34.42"></a><span id="l34.42">                     let day = parseInt(res[positions[1]], 10);</span>
<a href="#l34.43"></a><span id="l34.43" class="difflineat">@@ -381,19 +381,20 @@ Extractor.prototype = {</span>
<a href="#l34.44"></a><span id="l34.44">                                    rev.start, rev.end, rev.pattern, rev.relation, pattern);</span>
<a href="#l34.45"></a><span id="l34.45">                     }</span>
<a href="#l34.46"></a><span id="l34.46">                 }</span>
<a href="#l34.47"></a><span id="l34.47">             }</span>
<a href="#l34.48"></a><span id="l34.48">         }</span>
<a href="#l34.49"></a><span id="l34.49">     },</span>
<a href="#l34.50"></a><span id="l34.50"> </span>
<a href="#l34.51"></a><span id="l34.51">     extractDayMonthNameYear: function(pattern, relation) {</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineminus">-        let alts = this.getRepPatterns(pattern, [&quot;(\\d{1,2})&quot;,</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineminus">-                                                 &quot;(&quot; + this.allMonths + &quot;)&quot;,</span>
<a href="#l34.54"></a><span id="l34.54" class="difflineminus">-                                                 &quot;(\\d{2,4})&quot;]);</span>
<a href="#l34.55"></a><span id="l34.55" class="difflineplus">+        let alts = this.getRepPatterns(pattern, [</span>
<a href="#l34.56"></a><span id="l34.56" class="difflineplus">+            &quot;(\\d{1,2})&quot;, &quot;(&quot; + this.allMonths + &quot;)&quot;, &quot;(\\d{2,4})&quot;</span>
<a href="#l34.57"></a><span id="l34.57" class="difflineplus">+        ]);</span>
<a href="#l34.58"></a><span id="l34.58" class="difflineplus">+</span>
<a href="#l34.59"></a><span id="l34.59">         let res;</span>
<a href="#l34.60"></a><span id="l34.60">         for (let alt in alts) {</span>
<a href="#l34.61"></a><span id="l34.61">             let exp = alts[alt].pattern.split(this.marker).join(&quot;|&quot;);</span>
<a href="#l34.62"></a><span id="l34.62">             let positions = alts[alt].positions;</span>
<a href="#l34.63"></a><span id="l34.63">             let re = new RegExp(exp, &quot;ig&quot;);</span>
<a href="#l34.64"></a><span id="l34.64"> </span>
<a href="#l34.65"></a><span id="l34.65">             while ((res = re.exec(this.email)) != null) {</span>
<a href="#l34.66"></a><span id="l34.66">                 if (!this.limitNums(res, this.email) &amp;&amp; !this.limitChars(res, this.email)) {</span>
<a href="#l34.67"></a><span id="l34.67" class="difflineat">@@ -426,19 +427,20 @@ Extractor.prototype = {</span>
<a href="#l34.68"></a><span id="l34.68">                 this.guess(item.getFullYear(), item.getMonth() + 1, item.getDate(),</span>
<a href="#l34.69"></a><span id="l34.69">                            null, null,</span>
<a href="#l34.70"></a><span id="l34.70">                            rev.start, rev.end, rev.pattern, rev.relation, pattern);</span>
<a href="#l34.71"></a><span id="l34.71">             }</span>
<a href="#l34.72"></a><span id="l34.72">         }</span>
<a href="#l34.73"></a><span id="l34.73">     },</span>
<a href="#l34.74"></a><span id="l34.74"> </span>
<a href="#l34.75"></a><span id="l34.75">     extractDayMonthName: function(pattern, relation) {</span>
<a href="#l34.76"></a><span id="l34.76" class="difflineminus">-        let alts = this.getRepPatterns(pattern,</span>
<a href="#l34.77"></a><span id="l34.77" class="difflineminus">-                                       [&quot;(\\d{1,2}&quot; + this.marker + this.dailyNumbers + &quot;)&quot;,</span>
<a href="#l34.78"></a><span id="l34.78" class="difflineminus">-                                       &quot;(&quot; + this.allMonths + &quot;)&quot;]);</span>
<a href="#l34.79"></a><span id="l34.79" class="difflineplus">+        let alts = this.getRepPatterns(pattern, [</span>
<a href="#l34.80"></a><span id="l34.80" class="difflineplus">+            &quot;(\\d{1,2}&quot; + this.marker + this.dailyNumbers + &quot;)&quot;,</span>
<a href="#l34.81"></a><span id="l34.81" class="difflineplus">+            &quot;(&quot; + this.allMonths + &quot;)&quot;</span>
<a href="#l34.82"></a><span id="l34.82" class="difflineplus">+        ]);</span>
<a href="#l34.83"></a><span id="l34.83">         let res;</span>
<a href="#l34.84"></a><span id="l34.84">         for (let alt in alts) {</span>
<a href="#l34.85"></a><span id="l34.85">             let exp = alts[alt].pattern.split(this.marker).join(&quot;|&quot;);</span>
<a href="#l34.86"></a><span id="l34.86">             let positions = alts[alt].positions;</span>
<a href="#l34.87"></a><span id="l34.87">             let re = new RegExp(exp, &quot;ig&quot;);</span>
<a href="#l34.88"></a><span id="l34.88"> </span>
<a href="#l34.89"></a><span id="l34.89">             while ((res = re.exec(this.email)) != null) {</span>
<a href="#l34.90"></a><span id="l34.90">                 if (!this.limitNums(res, this.email) &amp;&amp; !this.limitChars(res, this.email)) {</span>
<a href="#l34.91"></a><span id="l34.91" class="difflineat">@@ -1286,11 +1288,11 @@ Extractor.prototype = {</span>
<a href="#l34.92"></a><span id="l34.92">         this.collected.push(dateGuess);</span>
<a href="#l34.93"></a><span id="l34.93">     },</span>
<a href="#l34.94"></a><span id="l34.94"> </span>
<a href="#l34.95"></a><span id="l34.95">     sanitize: function(str) {</span>
<a href="#l34.96"></a><span id="l34.96">         return str.replace(/[-[\]{}()*+?.,\\^$]/g, &quot;\\$&amp;&quot;);</span>
<a href="#l34.97"></a><span id="l34.97">     },</span>
<a href="#l34.98"></a><span id="l34.98"> </span>
<a href="#l34.99"></a><span id="l34.99">     unescape: function(str) {</span>
<a href="#l34.100"></a><span id="l34.100" class="difflineminus">-        return str.replace(/\\([\.])/g, &quot;$1&quot;);</span>
<a href="#l34.101"></a><span id="l34.101" class="difflineplus">+        return str.replace(/\\([.])/g, &quot;$1&quot;);</span>
<a href="#l34.102"></a><span id="l34.102">     }</span>
<a href="#l34.103"></a><span id="l34.103"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -274,18 +274,18 @@ cal.itip = {</span>
<a href="#l35.4"></a><span id="l35.4">         let imipLabel = null;</span>
<a href="#l35.5"></a><span id="l35.5">         if (itipItem.receivedMethod) {</span>
<a href="#l35.6"></a><span id="l35.6">             imipLabel = cal.itip.getMethodText(itipItem.receivedMethod);</span>
<a href="#l35.7"></a><span id="l35.7">         }</span>
<a href="#l35.8"></a><span id="l35.8">         let data = { label: imipLabel, buttons: [], hideMenuItems: [] };</span>
<a href="#l35.9"></a><span id="l35.9"> </span>
<a href="#l35.10"></a><span id="l35.10">         let disallowedCounter = false;</span>
<a href="#l35.11"></a><span id="l35.11">         if (foundItems &amp;&amp; foundItems.length) {</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-             let disallow = foundItems[0].getProperty(&quot;X-MICROSOFT-DISALLOW-COUNTER&quot;);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">-             disallowedCounter = disallow &amp;&amp; disallow == &quot;TRUE&quot;;</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+            let disallow = foundItems[0].getProperty(&quot;X-MICROSOFT-DISALLOW-COUNTER&quot;);</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+            disallowedCounter = disallow &amp;&amp; disallow == &quot;TRUE&quot;;</span>
<a href="#l35.16"></a><span id="l35.16">         }</span>
<a href="#l35.17"></a><span id="l35.17">         if (rc == Components.interfaces.calIErrors.CAL_IS_READONLY) {</span>
<a href="#l35.18"></a><span id="l35.18">             // No writable calendars, tell the user about it</span>
<a href="#l35.19"></a><span id="l35.19">             data.label = _gs(&quot;imipBarNotWritable&quot;);</span>
<a href="#l35.20"></a><span id="l35.20">         } else if (Components.isSuccessCode(rc) &amp;&amp; !actionFunc) {</span>
<a href="#l35.21"></a><span id="l35.21">             // This case, they clicked on an old message that has already been</span>
<a href="#l35.22"></a><span id="l35.22">             // added/updated, we want to tell them that.</span>
<a href="#l35.23"></a><span id="l35.23">             data.label = _gs(&quot;imipBarAlreadyProcessedText&quot;);</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineat">@@ -297,17 +297,16 @@ cal.itip = {</span>
<a href="#l35.25"></a><span id="l35.25">                     } else {</span>
<a href="#l35.26"></a><span id="l35.26">                         let comparison;</span>
<a href="#l35.27"></a><span id="l35.27">                         for (let item of itipItem.getItemList({})) {</span>
<a href="#l35.28"></a><span id="l35.28">                             let attendees = cal.getAttendeesBySender(</span>
<a href="#l35.29"></a><span id="l35.29">                                     item.getAttendees({}),</span>
<a href="#l35.30"></a><span id="l35.30">                                     itipItem.sender</span>
<a href="#l35.31"></a><span id="l35.31">                             );</span>
<a href="#l35.32"></a><span id="l35.32">                             if (attendees.length == 1) {</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineminus">-                                let replyer = foundItems[0].getAttendeeById(attendees[0].id);</span>
<a href="#l35.34"></a><span id="l35.34">                                 comparison = cal.itip.compareSequence(item, foundItems[0]);</span>
<a href="#l35.35"></a><span id="l35.35">                                 if (comparison == 1) {</span>
<a href="#l35.36"></a><span id="l35.36">                                     data.label = _gs(&quot;imipBarCounterErrorText&quot;);</span>
<a href="#l35.37"></a><span id="l35.37">                                     break;</span>
<a href="#l35.38"></a><span id="l35.38">                                 } else if (comparison == -1) {</span>
<a href="#l35.39"></a><span id="l35.39">                                     data.label = _gs(&quot;imipBarCounterPreviousVersionText&quot;);</span>
<a href="#l35.40"></a><span id="l35.40">                                 }</span>
<a href="#l35.41"></a><span id="l35.41">                             }</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineat">@@ -959,16 +958,17 @@ cal.itip = {</span>
<a href="#l35.43"></a><span id="l35.43">      * @param aMethod iTIP method</span>
<a href="#l35.44"></a><span id="l35.44">      * @param aRecipientsList an array of calIAttendee objects the message should be sent to</span>
<a href="#l35.45"></a><span id="l35.45">      * @param aAutoResponse an inout object whether the transport should ask before sending</span>
<a href="#l35.46"></a><span id="l35.46">      */</span>
<a href="#l35.47"></a><span id="l35.47">     sendDeclineCounterMessage: function(aItem, aMethod, aRecipientsList, aAutoResponse) {</span>
<a href="#l35.48"></a><span id="l35.48">         if (aMethod == &quot;DECLINECOUNTER&quot;) {</span>
<a href="#l35.49"></a><span id="l35.49">             return sendMessage(aItem, aMethod, aRecipientsList, aAutoResponse);</span>
<a href="#l35.50"></a><span id="l35.50">         }</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineplus">+        return false;</span>
<a href="#l35.52"></a><span id="l35.52">     }</span>
<a href="#l35.53"></a><span id="l35.53"> };</span>
<a href="#l35.54"></a><span id="l35.54"> </span>
<a href="#l35.55"></a><span id="l35.55"> /** local to this module file</span>
<a href="#l35.56"></a><span id="l35.56">  * Sets the received info either on the passed attendee or item object.</span>
<a href="#l35.57"></a><span id="l35.57">  *</span>
<a href="#l35.58"></a><span id="l35.58">  * @param item either  calIAttendee or calIItemBase</span>
<a href="#l35.59"></a><span id="l35.59">  * @param itipItemItem received iTIP item</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -49,26 +49,22 @@ function recurrenceRule2String(recurrenc</span>
<a href="#l36.4"></a><span id="l36.4">     // Retrieve a valid recurrence rule from the currently</span>
<a href="#l36.5"></a><span id="l36.5">     // set recurrence info. Bail out if there's more</span>
<a href="#l36.6"></a><span id="l36.6">     // than a single rule or something other than a rule.</span>
<a href="#l36.7"></a><span id="l36.7">     recurrenceInfo = recurrenceInfo.clone();</span>
<a href="#l36.8"></a><span id="l36.8">     let rrules = splitRecurrenceRules(recurrenceInfo);</span>
<a href="#l36.9"></a><span id="l36.9">     if (rrules[0].length == 1) {</span>
<a href="#l36.10"></a><span id="l36.10">         let rule = cal.wrapInstance(rrules[0][0], Components.interfaces.calIRecurrenceRule);</span>
<a href="#l36.11"></a><span id="l36.11">         // Currently we allow only for BYDAY, BYMONTHDAY, BYMONTH rules.</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-        if (rule &amp;&amp;</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-            !checkRecurrenceRule(rule, [&quot;BYSECOND&quot;,</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-                                        &quot;BYMINUTE&quot;,</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineminus">-                                        // &quot;BYDAY&quot;,</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineminus">-                                        &quot;BYHOUR&quot;,</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineminus">-                                        // &quot;BYMONTHDAY&quot;,</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineminus">-                                        &quot;BYYEARDAY&quot;,</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineminus">-                                        &quot;BYWEEKNO&quot;,</span>
<a href="#l36.20"></a><span id="l36.20" class="difflineminus">-                                        // &quot;BYMONTH&quot;,</span>
<a href="#l36.21"></a><span id="l36.21" class="difflineminus">-                                        &quot;BYSETPOS&quot;])) {</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineplus">+        let byparts = [</span>
<a href="#l36.23"></a><span id="l36.23" class="difflineplus">+            &quot;BYSECOND&quot;, &quot;BYMINUTE&quot;, /* &quot;BYDAY&quot;, */ &quot;BYHOUR&quot;, /* &quot;BYMONTHDAY&quot;, */</span>
<a href="#l36.24"></a><span id="l36.24" class="difflineplus">+            &quot;BYYEARDAY&quot;, &quot;BYWEEKNO&quot;, /* &quot;BYMONTH&quot;, */ &quot;BYSETPOS&quot;</span>
<a href="#l36.25"></a><span id="l36.25" class="difflineplus">+        ];</span>
<a href="#l36.26"></a><span id="l36.26" class="difflineplus">+</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineplus">+        if (rule &amp;&amp; !checkRecurrenceRule(rule, byparts)) {</span>
<a href="#l36.28"></a><span id="l36.28">             let dateFormatter = cal.getDateFormatter();</span>
<a href="#l36.29"></a><span id="l36.29">             let ruleString;</span>
<a href="#l36.30"></a><span id="l36.30">             if (rule.type == &quot;DAILY&quot;) {</span>
<a href="#l36.31"></a><span id="l36.31">                 if (checkRecurrenceRule(rule, [&quot;BYDAY&quot;])) {</span>
<a href="#l36.32"></a><span id="l36.32">                     let days = rule.getComponent(&quot;BYDAY&quot;, {});</span>
<a href="#l36.33"></a><span id="l36.33">                     let weekdays = [2, 3, 4, 5, 6];</span>
<a href="#l36.34"></a><span id="l36.34">                     if (weekdays.length == days.length) {</span>
<a href="#l36.35"></a><span id="l36.35">                         let i;</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineat">@@ -312,57 +308,64 @@ function recurrenceRule2String(recurrenc</span>
<a href="#l36.37"></a><span id="l36.37">             }</span>
<a href="#l36.38"></a><span id="l36.38"> </span>
<a href="#l36.39"></a><span id="l36.39">             let kDefaultTimezone = cal.calendarDefaultTimezone();</span>
<a href="#l36.40"></a><span id="l36.40"> </span>
<a href="#l36.41"></a><span id="l36.41">             let detailsString;</span>
<a href="#l36.42"></a><span id="l36.42">             if (!endDate || allDay) {</span>
<a href="#l36.43"></a><span id="l36.43">                 if (rule.isFinite) {</span>
<a href="#l36.44"></a><span id="l36.44">                     if (rule.isByCount) {</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineminus">-                        let countString = getRString(&quot;repeatCountAllDay&quot;,</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineminus">-                            [ruleString,</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineminus">-                             dateFormatter.formatDateShort(startDate)]);</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineplus">+                        let countString = getRString(&quot;repeatCountAllDay&quot;, [</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineplus">+                            ruleString,</span>
<a href="#l36.50"></a><span id="l36.50" class="difflineplus">+                            dateFormatter.formatDateShort(startDate)</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineplus">+                        ]);</span>
<a href="#l36.52"></a><span id="l36.52" class="difflineplus">+</span>
<a href="#l36.53"></a><span id="l36.53">                         detailsString = PluralForm.get(rule.count, countString)</span>
<a href="#l36.54"></a><span id="l36.54">                                                   .replace(&quot;#3&quot;, rule.count);</span>
<a href="#l36.55"></a><span id="l36.55">                     } else {</span>
<a href="#l36.56"></a><span id="l36.56">                         let untilDate = rule.untilDate.getInTimezone(kDefaultTimezone);</span>
<a href="#l36.57"></a><span id="l36.57" class="difflineminus">-                        detailsString = getRString(&quot;repeatDetailsUntilAllDay&quot;,</span>
<a href="#l36.58"></a><span id="l36.58" class="difflineminus">-                            [ruleString,</span>
<a href="#l36.59"></a><span id="l36.59" class="difflineminus">-                             dateFormatter.formatDateShort(startDate),</span>
<a href="#l36.60"></a><span id="l36.60" class="difflineminus">-                             dateFormatter.formatDateShort(untilDate)]);</span>
<a href="#l36.61"></a><span id="l36.61" class="difflineplus">+                        detailsString = getRString(&quot;repeatDetailsUntilAllDay&quot;, [</span>
<a href="#l36.62"></a><span id="l36.62" class="difflineplus">+                            ruleString,</span>
<a href="#l36.63"></a><span id="l36.63" class="difflineplus">+                            dateFormatter.formatDateShort(startDate),</span>
<a href="#l36.64"></a><span id="l36.64" class="difflineplus">+                            dateFormatter.formatDateShort(untilDate)</span>
<a href="#l36.65"></a><span id="l36.65" class="difflineplus">+                        ]);</span>
<a href="#l36.66"></a><span id="l36.66">                     }</span>
<a href="#l36.67"></a><span id="l36.67">                 } else {</span>
<a href="#l36.68"></a><span id="l36.68" class="difflineminus">-                    detailsString = getRString(&quot;repeatDetailsInfiniteAllDay&quot;,</span>
<a href="#l36.69"></a><span id="l36.69" class="difflineminus">-                                               [ruleString,</span>
<a href="#l36.70"></a><span id="l36.70" class="difflineminus">-                                                dateFormatter.formatDateShort(startDate)]);</span>
<a href="#l36.71"></a><span id="l36.71" class="difflineplus">+                    detailsString = getRString(&quot;repeatDetailsInfiniteAllDay&quot;, [</span>
<a href="#l36.72"></a><span id="l36.72" class="difflineplus">+                        ruleString,</span>
<a href="#l36.73"></a><span id="l36.73" class="difflineplus">+                        dateFormatter.formatDateShort(startDate)</span>
<a href="#l36.74"></a><span id="l36.74" class="difflineplus">+                    ]);</span>
<a href="#l36.75"></a><span id="l36.75">                 }</span>
<a href="#l36.76"></a><span id="l36.76">             } else if (rule.isFinite) {</span>
<a href="#l36.77"></a><span id="l36.77">                 if (rule.isByCount) {</span>
<a href="#l36.78"></a><span id="l36.78" class="difflineminus">-                    let countString = getRString(&quot;repeatCount&quot;,</span>
<a href="#l36.79"></a><span id="l36.79" class="difflineminus">-                        [ruleString,</span>
<a href="#l36.80"></a><span id="l36.80" class="difflineminus">-                         dateFormatter.formatDateShort(startDate),</span>
<a href="#l36.81"></a><span id="l36.81" class="difflineminus">-                         dateFormatter.formatTime(startDate),</span>
<a href="#l36.82"></a><span id="l36.82" class="difflineminus">-                         dateFormatter.formatTime(endDate)]);</span>
<a href="#l36.83"></a><span id="l36.83" class="difflineplus">+                    let countString = getRString(&quot;repeatCount&quot;, [</span>
<a href="#l36.84"></a><span id="l36.84" class="difflineplus">+                        ruleString,</span>
<a href="#l36.85"></a><span id="l36.85" class="difflineplus">+                        dateFormatter.formatDateShort(startDate),</span>
<a href="#l36.86"></a><span id="l36.86" class="difflineplus">+                        dateFormatter.formatTime(startDate),</span>
<a href="#l36.87"></a><span id="l36.87" class="difflineplus">+                        dateFormatter.formatTime(endDate)</span>
<a href="#l36.88"></a><span id="l36.88" class="difflineplus">+                    ]);</span>
<a href="#l36.89"></a><span id="l36.89">                     detailsString = PluralForm.get(rule.count, countString)</span>
<a href="#l36.90"></a><span id="l36.90">                                               .replace(&quot;#5&quot;, rule.count);</span>
<a href="#l36.91"></a><span id="l36.91">                 } else {</span>
<a href="#l36.92"></a><span id="l36.92">                     let untilDate = rule.untilDate.getInTimezone(kDefaultTimezone);</span>
<a href="#l36.93"></a><span id="l36.93" class="difflineminus">-                    detailsString = getRString(&quot;repeatDetailsUntil&quot;,</span>
<a href="#l36.94"></a><span id="l36.94" class="difflineminus">-                        [ruleString,</span>
<a href="#l36.95"></a><span id="l36.95" class="difflineminus">-                         dateFormatter.formatDateShort(startDate),</span>
<a href="#l36.96"></a><span id="l36.96" class="difflineminus">-                         dateFormatter.formatDateShort(untilDate),</span>
<a href="#l36.97"></a><span id="l36.97" class="difflineminus">-                         dateFormatter.formatTime(startDate),</span>
<a href="#l36.98"></a><span id="l36.98" class="difflineminus">-                         dateFormatter.formatTime(endDate)]);</span>
<a href="#l36.99"></a><span id="l36.99" class="difflineplus">+                    detailsString = getRString(&quot;repeatDetailsUntil&quot;, [</span>
<a href="#l36.100"></a><span id="l36.100" class="difflineplus">+                        ruleString,</span>
<a href="#l36.101"></a><span id="l36.101" class="difflineplus">+                        dateFormatter.formatDateShort(startDate),</span>
<a href="#l36.102"></a><span id="l36.102" class="difflineplus">+                        dateFormatter.formatDateShort(untilDate),</span>
<a href="#l36.103"></a><span id="l36.103" class="difflineplus">+                        dateFormatter.formatTime(startDate),</span>
<a href="#l36.104"></a><span id="l36.104" class="difflineplus">+                        dateFormatter.formatTime(endDate)</span>
<a href="#l36.105"></a><span id="l36.105" class="difflineplus">+                    ]);</span>
<a href="#l36.106"></a><span id="l36.106">                 }</span>
<a href="#l36.107"></a><span id="l36.107">             } else {</span>
<a href="#l36.108"></a><span id="l36.108" class="difflineminus">-                detailsString = getRString(&quot;repeatDetailsInfinite&quot;,</span>
<a href="#l36.109"></a><span id="l36.109" class="difflineminus">-                    [ruleString,</span>
<a href="#l36.110"></a><span id="l36.110" class="difflineminus">-                     dateFormatter.formatDateShort(startDate),</span>
<a href="#l36.111"></a><span id="l36.111" class="difflineminus">-                     dateFormatter.formatTime(startDate),</span>
<a href="#l36.112"></a><span id="l36.112" class="difflineminus">-                     dateFormatter.formatTime(endDate)]);</span>
<a href="#l36.113"></a><span id="l36.113" class="difflineplus">+                detailsString = getRString(&quot;repeatDetailsInfinite&quot;, [</span>
<a href="#l36.114"></a><span id="l36.114" class="difflineplus">+                    ruleString,</span>
<a href="#l36.115"></a><span id="l36.115" class="difflineplus">+                    dateFormatter.formatDateShort(startDate),</span>
<a href="#l36.116"></a><span id="l36.116" class="difflineplus">+                    dateFormatter.formatTime(startDate),</span>
<a href="#l36.117"></a><span id="l36.117" class="difflineplus">+                    dateFormatter.formatTime(endDate)</span>
<a href="#l36.118"></a><span id="l36.118" class="difflineplus">+                ]);</span>
<a href="#l36.119"></a><span id="l36.119">             }</span>
<a href="#l36.120"></a><span id="l36.120">             return detailsString;</span>
<a href="#l36.121"></a><span id="l36.121">         }</span>
<a href="#l36.122"></a><span id="l36.122">     }</span>
<a href="#l36.123"></a><span id="l36.123">     return null;</span>
<a href="#l36.124"></a><span id="l36.124"> }</span>
<a href="#l36.125"></a><span id="l36.125"> </span>
<a href="#l36.126"></a><span id="l36.126"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/base/modules/calUtils.jsm</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/base/modules/calUtils.jsm</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -144,30 +144,36 @@ var cal = {</span>
<a href="#l37.4"></a><span id="l37.4">      *  - calIOperationListener</span>
<a href="#l37.5"></a><span id="l37.5">      *  - calICompositeObserver</span>
<a href="#l37.6"></a><span id="l37.6">      */</span>
<a href="#l37.7"></a><span id="l37.7">     createAdapter: function(iface, template) {</span>
<a href="#l37.8"></a><span id="l37.8">         let methods;</span>
<a href="#l37.9"></a><span id="l37.9">         let adapter = template || {};</span>
<a href="#l37.10"></a><span id="l37.10">         switch (iface.name || iface) {</span>
<a href="#l37.11"></a><span id="l37.11">             case &quot;calIObserver&quot;:</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-                methods = [&quot;onStartBatch&quot;, &quot;onEndBatch&quot;, &quot;onLoad&quot;, &quot;onAddItem&quot;,</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-                           &quot;onModifyItem&quot;, &quot;onDeleteItem&quot;, &quot;onError&quot;,</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">-                           &quot;onPropertyChanged&quot;, &quot;onPropertyDeleting&quot;];</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineplus">+                methods = [</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineplus">+                    &quot;onStartBatch&quot;, &quot;onEndBatch&quot;, &quot;onLoad&quot;, &quot;onAddItem&quot;,</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineplus">+                    &quot;onModifyItem&quot;, &quot;onDeleteItem&quot;, &quot;onError&quot;,</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineplus">+                    &quot;onPropertyChanged&quot;, &quot;onPropertyDeleting&quot;</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineplus">+                ];</span>
<a href="#l37.20"></a><span id="l37.20">                 break;</span>
<a href="#l37.21"></a><span id="l37.21">             case &quot;calICalendarManagerObserver&quot;:</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineminus">-                methods = [&quot;onCalendarRegistered&quot;, &quot;onCalendarUnregistering&quot;,</span>
<a href="#l37.23"></a><span id="l37.23" class="difflineminus">-                           &quot;onCalendarDeleting&quot;];</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineplus">+                methods = [</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineplus">+                    &quot;onCalendarRegistered&quot;, &quot;onCalendarUnregistering&quot;,</span>
<a href="#l37.26"></a><span id="l37.26" class="difflineplus">+                    &quot;onCalendarDeleting&quot;</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineplus">+                ];</span>
<a href="#l37.28"></a><span id="l37.28">                 break;</span>
<a href="#l37.29"></a><span id="l37.29">             case &quot;calIOperationListener&quot;:</span>
<a href="#l37.30"></a><span id="l37.30">                 methods = [&quot;onGetResult&quot;, &quot;onOperationComplete&quot;];</span>
<a href="#l37.31"></a><span id="l37.31">                 break;</span>
<a href="#l37.32"></a><span id="l37.32">             case &quot;calICompositeObserver&quot;:</span>
<a href="#l37.33"></a><span id="l37.33" class="difflineminus">-                methods = [&quot;onCalendarAdded&quot;, &quot;onCalendarRemoved&quot;,</span>
<a href="#l37.34"></a><span id="l37.34" class="difflineminus">-                           &quot;onDefaultCalendarChanged&quot;];</span>
<a href="#l37.35"></a><span id="l37.35" class="difflineplus">+                methods = [</span>
<a href="#l37.36"></a><span id="l37.36" class="difflineplus">+                    &quot;onCalendarAdded&quot;, &quot;onCalendarRemoved&quot;,</span>
<a href="#l37.37"></a><span id="l37.37" class="difflineplus">+                    &quot;onDefaultCalendarChanged&quot;</span>
<a href="#l37.38"></a><span id="l37.38" class="difflineplus">+                ];</span>
<a href="#l37.39"></a><span id="l37.39">                 break;</span>
<a href="#l37.40"></a><span id="l37.40">             default:</span>
<a href="#l37.41"></a><span id="l37.41">                 methods = [];</span>
<a href="#l37.42"></a><span id="l37.42">                 break;</span>
<a href="#l37.43"></a><span id="l37.43">         }</span>
<a href="#l37.44"></a><span id="l37.44"> </span>
<a href="#l37.45"></a><span id="l37.45">         for (let method of methods) {</span>
<a href="#l37.46"></a><span id="l37.46">             if (!(method in template)) {</span>
<a href="#l37.47"></a><span id="l37.47" class="difflineat">@@ -329,17 +335,17 @@ var cal = {</span>
<a href="#l37.48"></a><span id="l37.48">                 if (parts[2] == &quot; &lt;&gt;&quot;) {</span>
<a href="#l37.49"></a><span id="l37.49">                     // CN but no email address - we keep the CN part to prefix the next member's CN</span>
<a href="#l37.50"></a><span id="l37.50">                     prefix = parts[1];</span>
<a href="#l37.51"></a><span id="l37.51">                 } else {</span>
<a href="#l37.52"></a><span id="l37.52">                     // CN with email address</span>
<a href="#l37.53"></a><span id="l37.53">                     let commonName = parts[1].trim();</span>
<a href="#l37.54"></a><span id="l37.54">                     // in case of any special characters in the CN string, we make sure to enclose</span>
<a href="#l37.55"></a><span id="l37.55">                     // it with dquotes - simple spaces don't require dquotes</span>
<a href="#l37.56"></a><span id="l37.56" class="difflineminus">-                    if (commonName.match(/[\-\[\]{}()*+?.,;\\\^$|#\f\n\r\t\v]/)) {</span>
<a href="#l37.57"></a><span id="l37.57" class="difflineplus">+                    if (commonName.match(/[-[\]{}()*+?.,;\\^$|#\f\n\r\t\v]/)) {</span>
<a href="#l37.58"></a><span id="l37.58">                         commonName = '&quot;' + commonName.replace(/\\&quot;|&quot;/, &quot;&quot;).trim() + '&quot;';</span>
<a href="#l37.59"></a><span id="l37.59">                     }</span>
<a href="#l37.60"></a><span id="l37.60">                     list.push(commonName + parts[2]);</span>
<a href="#l37.61"></a><span id="l37.61">                     prefix = &quot;&quot;;</span>
<a href="#l37.62"></a><span id="l37.62">                 }</span>
<a href="#l37.63"></a><span id="l37.63">             } else if (member.length) {</span>
<a href="#l37.64"></a><span id="l37.64">                 // email address only</span>
<a href="#l37.65"></a><span id="l37.65">                 list.push(member);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/base/src/calAlarm.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/base/src/calAlarm.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -60,20 +60,22 @@ calAlarm.prototype = {</span>
<a href="#l38.4"></a><span id="l38.4">         return !this.mImmutable;</span>
<a href="#l38.5"></a><span id="l38.5">     },</span>
<a href="#l38.6"></a><span id="l38.6"> </span>
<a href="#l38.7"></a><span id="l38.7">     makeImmutable: function() {</span>
<a href="#l38.8"></a><span id="l38.8">         if (this.mImmutable) {</span>
<a href="#l38.9"></a><span id="l38.9">             return;</span>
<a href="#l38.10"></a><span id="l38.10">         }</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-        const objectMembers = [&quot;mAbsoluteDate&quot;,</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineminus">-                               &quot;mOffset&quot;,</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineminus">-                               &quot;mDuration&quot;,</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineminus">-                               &quot;mLastAck&quot;];</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineplus">+        const objectMembers = [</span>
<a href="#l38.17"></a><span id="l38.17" class="difflineplus">+            &quot;mAbsoluteDate&quot;,</span>
<a href="#l38.18"></a><span id="l38.18" class="difflineplus">+            &quot;mOffset&quot;,</span>
<a href="#l38.19"></a><span id="l38.19" class="difflineplus">+            &quot;mDuration&quot;,</span>
<a href="#l38.20"></a><span id="l38.20" class="difflineplus">+            &quot;mLastAck&quot;</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineplus">+        ];</span>
<a href="#l38.22"></a><span id="l38.22">         for (let member of objectMembers) {</span>
<a href="#l38.23"></a><span id="l38.23">             if (this[member] &amp;&amp; this[member].isMutable) {</span>
<a href="#l38.24"></a><span id="l38.24">                 this[member].makeImmutable();</span>
<a href="#l38.25"></a><span id="l38.25">             }</span>
<a href="#l38.26"></a><span id="l38.26">         }</span>
<a href="#l38.27"></a><span id="l38.27"> </span>
<a href="#l38.28"></a><span id="l38.28">         // Properties</span>
<a href="#l38.29"></a><span id="l38.29">         let e = this.mProperties.enumerator;</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineat">@@ -90,29 +92,32 @@ calAlarm.prototype = {</span>
<a href="#l38.31"></a><span id="l38.31">         this.mImmutable = true;</span>
<a href="#l38.32"></a><span id="l38.32">     },</span>
<a href="#l38.33"></a><span id="l38.33"> </span>
<a href="#l38.34"></a><span id="l38.34">     clone: function() {</span>
<a href="#l38.35"></a><span id="l38.35">         let cloned = new calAlarm();</span>
<a href="#l38.36"></a><span id="l38.36"> </span>
<a href="#l38.37"></a><span id="l38.37">         cloned.mImmutable = false;</span>
<a href="#l38.38"></a><span id="l38.38"> </span>
<a href="#l38.39"></a><span id="l38.39" class="difflineminus">-        const simpleMembers = [&quot;mAction&quot;,</span>
<a href="#l38.40"></a><span id="l38.40" class="difflineminus">-                               &quot;mSummary&quot;,</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineminus">-                               &quot;mDescription&quot;,</span>
<a href="#l38.42"></a><span id="l38.42" class="difflineminus">-                               &quot;mRelated&quot;,</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineminus">-                               &quot;mRepeat&quot;];</span>
<a href="#l38.44"></a><span id="l38.44" class="difflineplus">+        const simpleMembers = [</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineplus">+            &quot;mAction&quot;,</span>
<a href="#l38.46"></a><span id="l38.46" class="difflineplus">+            &quot;mSummary&quot;,</span>
<a href="#l38.47"></a><span id="l38.47" class="difflineplus">+            &quot;mDescription&quot;,</span>
<a href="#l38.48"></a><span id="l38.48" class="difflineplus">+            &quot;mRelated&quot;,</span>
<a href="#l38.49"></a><span id="l38.49" class="difflineplus">+            &quot;mRepeat&quot;</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineplus">+        ];</span>
<a href="#l38.51"></a><span id="l38.51"> </span>
<a href="#l38.52"></a><span id="l38.52" class="difflineminus">-        const arrayMembers = [&quot;mAttendees&quot;,</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineminus">-                              &quot;mAttachments&quot;];</span>
<a href="#l38.54"></a><span id="l38.54" class="difflineplus">+        const arrayMembers = [&quot;mAttendees&quot;, &quot;mAttachments&quot;];</span>
<a href="#l38.55"></a><span id="l38.55"> </span>
<a href="#l38.56"></a><span id="l38.56" class="difflineminus">-        const objectMembers = [&quot;mAbsoluteDate&quot;,</span>
<a href="#l38.57"></a><span id="l38.57" class="difflineminus">-                               &quot;mOffset&quot;,</span>
<a href="#l38.58"></a><span id="l38.58" class="difflineminus">-                               &quot;mDuration&quot;,</span>
<a href="#l38.59"></a><span id="l38.59" class="difflineminus">-                               &quot;mLastAck&quot;];</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineplus">+        const objectMembers = [</span>
<a href="#l38.61"></a><span id="l38.61" class="difflineplus">+            &quot;mAbsoluteDate&quot;,</span>
<a href="#l38.62"></a><span id="l38.62" class="difflineplus">+            &quot;mOffset&quot;,</span>
<a href="#l38.63"></a><span id="l38.63" class="difflineplus">+            &quot;mDuration&quot;,</span>
<a href="#l38.64"></a><span id="l38.64" class="difflineplus">+            &quot;mLastAck&quot;</span>
<a href="#l38.65"></a><span id="l38.65" class="difflineplus">+        ];</span>
<a href="#l38.66"></a><span id="l38.66"> </span>
<a href="#l38.67"></a><span id="l38.67">         for (let member of simpleMembers) {</span>
<a href="#l38.68"></a><span id="l38.68">             cloned[member] = this[member];</span>
<a href="#l38.69"></a><span id="l38.69">         }</span>
<a href="#l38.70"></a><span id="l38.70"> </span>
<a href="#l38.71"></a><span id="l38.71">         for (let member of arrayMembers) {</span>
<a href="#l38.72"></a><span id="l38.72">             let newArray = [];</span>
<a href="#l38.73"></a><span id="l38.73">             for (let oldElem of this[member]) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/base/src/calAttendee.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/base/src/calAttendee.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -38,18 +38,20 @@ calAttendee.prototype = {</span>
<a href="#l39.4"></a><span id="l39.4"> </span>
<a href="#l39.5"></a><span id="l39.5">     clone: function() {</span>
<a href="#l39.6"></a><span id="l39.6">         let a = new calAttendee();</span>
<a href="#l39.7"></a><span id="l39.7"> </span>
<a href="#l39.8"></a><span id="l39.8">         if (this.mIsOrganizer) {</span>
<a href="#l39.9"></a><span id="l39.9">             a.isOrganizer = true;</span>
<a href="#l39.10"></a><span id="l39.10">         }</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-        const allProps = [&quot;id&quot;, &quot;commonName&quot;, &quot;rsvp&quot;, &quot;role&quot;,</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineminus">-                          &quot;participationStatus&quot;, &quot;userType&quot;];</span>
<a href="#l39.14"></a><span id="l39.14" class="difflineplus">+        const allProps = [</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineplus">+            &quot;id&quot;, &quot;commonName&quot;, &quot;rsvp&quot;, &quot;role&quot;,</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineplus">+            &quot;participationStatus&quot;, &quot;userType&quot;</span>
<a href="#l39.17"></a><span id="l39.17" class="difflineplus">+        ];</span>
<a href="#l39.18"></a><span id="l39.18">         for (let prop of allProps) {</span>
<a href="#l39.19"></a><span id="l39.19">             a[prop] = this[prop];</span>
<a href="#l39.20"></a><span id="l39.20">         }</span>
<a href="#l39.21"></a><span id="l39.21"> </span>
<a href="#l39.22"></a><span id="l39.22">         for (let [key, value] of this.mProperties) {</span>
<a href="#l39.23"></a><span id="l39.23">             a.setProperty(key, value);</span>
<a href="#l39.24"></a><span id="l39.24">         }</span>
<a href="#l39.25"></a><span id="l39.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -871,15 +871,14 @@ calCachedCalendar.prototype = {</span>
<a href="#l40.4"></a><span id="l40.4">             };</span>
<a href="#l40.5"></a><span id="l40.5">         }</span>
<a href="#l40.6"></a><span id="l40.6">         functions.forEach(defineForwardFunction);</span>
<a href="#l40.7"></a><span id="l40.7">         getters.forEach(defineForwardGetter);</span>
<a href="#l40.8"></a><span id="l40.8">         gettersAndSetters.forEach(defineForwardGetterAndSetter);</span>
<a href="#l40.9"></a><span id="l40.9">     }</span>
<a href="#l40.10"></a><span id="l40.10"> </span>
<a href="#l40.11"></a><span id="l40.11">     defineForwards(calCachedCalendar.prototype, &quot;mUncachedCalendar&quot;,</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-                   [&quot;setProperty&quot;, &quot;deleteProperty&quot;,</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-                    &quot;isInvitation&quot;, &quot;getInvitedAttendee&quot;, &quot;canNotify&quot;],</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineplus">+                   [&quot;setProperty&quot;, &quot;deleteProperty&quot;, &quot;isInvitation&quot;, &quot;getInvitedAttendee&quot;, &quot;canNotify&quot;],</span>
<a href="#l40.15"></a><span id="l40.15">                    [&quot;type&quot;, &quot;aclManager&quot;, &quot;aclEntry&quot;],</span>
<a href="#l40.16"></a><span id="l40.16">                    [&quot;id&quot;, &quot;name&quot;, &quot;uri&quot;, &quot;readOnly&quot;]);</span>
<a href="#l40.17"></a><span id="l40.17">     defineForwards(calCachedCalendar.prototype, &quot;mCachedCalendar&quot;,</span>
<a href="#l40.18"></a><span id="l40.18">                    [&quot;getItem&quot;, &quot;getItems&quot;, &quot;startBatch&quot;, &quot;endBatch&quot;], [], []);</span>
<a href="#l40.19"></a><span id="l40.19"> })();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -176,19 +176,21 @@ calFilter.prototype = {</span>
<a href="#l41.4"></a><span id="l41.4">     mToday: null,</span>
<a href="#l41.5"></a><span id="l41.5">     mTomorrow: null,</span>
<a href="#l41.6"></a><span id="l41.6">     mMaxIterations: 50,</span>
<a href="#l41.7"></a><span id="l41.7"> </span>
<a href="#l41.8"></a><span id="l41.8">     /**</span>
<a href="#l41.9"></a><span id="l41.9">      * Initializes the predefined filters.</span>
<a href="#l41.10"></a><span id="l41.10">      */</span>
<a href="#l41.11"></a><span id="l41.11">     initDefinedFilters: function() {</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-        let filters = [&quot;all&quot;, &quot;notstarted&quot;, &quot;overdue&quot;, &quot;open&quot;, &quot;completed&quot;, &quot;throughcurrent&quot;,</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineminus">-                       &quot;throughtoday&quot;, &quot;throughsevendays&quot;, &quot;today&quot;, &quot;thisCalendarMonth&quot;,</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineminus">-                       &quot;future&quot;, &quot;current&quot;, &quot;currentview&quot;];</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineplus">+        let filters = [</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineplus">+            &quot;all&quot;, &quot;notstarted&quot;, &quot;overdue&quot;, &quot;open&quot;, &quot;completed&quot;,</span>
<a href="#l41.17"></a><span id="l41.17" class="difflineplus">+            &quot;throughcurrent&quot;, &quot;throughtoday&quot;, &quot;throughsevendays&quot;, &quot;today&quot;,</span>
<a href="#l41.18"></a><span id="l41.18" class="difflineplus">+            &quot;thisCalendarMonth&quot;, &quot;future&quot;, &quot;current&quot;, &quot;currentview&quot;</span>
<a href="#l41.19"></a><span id="l41.19" class="difflineplus">+        ];</span>
<a href="#l41.20"></a><span id="l41.20">         filters.forEach(function(filter) {</span>
<a href="#l41.21"></a><span id="l41.21">             if (!(filter in this.mDefinedFilters)) {</span>
<a href="#l41.22"></a><span id="l41.22">                 this.defineFilter(filter, this.getPreDefinedFilterProperties(filter));</span>
<a href="#l41.23"></a><span id="l41.23">             }</span>
<a href="#l41.24"></a><span id="l41.24">         }, this);</span>
<a href="#l41.25"></a><span id="l41.25">     },</span>
<a href="#l41.26"></a><span id="l41.26"> </span>
<a href="#l41.27"></a><span id="l41.27">     /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/base/src/calItemBase.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/base/src/calItemBase.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -76,19 +76,21 @@ calItemBase.prototype = {</span>
<a href="#l42.4"></a><span id="l42.4">     },</span>
<a href="#l42.5"></a><span id="l42.5"> </span>
<a href="#l42.6"></a><span id="l42.6">     // readonly attribute AUTF8String hashId;</span>
<a href="#l42.7"></a><span id="l42.7">     get hashId() {</span>
<a href="#l42.8"></a><span id="l42.8">         if (this.mHashId === null) {</span>
<a href="#l42.9"></a><span id="l42.9">             let rid = this.recurrenceId;</span>
<a href="#l42.10"></a><span id="l42.10">             let calendar = this.calendar;</span>
<a href="#l42.11"></a><span id="l42.11">             // some unused delim character:</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-            this.mHashId = [encodeURIComponent(this.id),</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineminus">-                            rid ? rid.getInTimezone(cal.UTC()).icalString : &quot;&quot;,</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineminus">-                            calendar ? encodeURIComponent(calendar.id) : &quot;&quot;].join(&quot;#&quot;);</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineplus">+            this.mHashId = [</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineplus">+                encodeURIComponent(this.id),</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineplus">+                rid ? rid.getInTimezone(cal.UTC()).icalString : &quot;&quot;,</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineplus">+                calendar ? encodeURIComponent(calendar.id) : &quot;&quot;</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineplus">+            ].join(&quot;#&quot;);</span>
<a href="#l42.20"></a><span id="l42.20">         }</span>
<a href="#l42.21"></a><span id="l42.21">         return this.mHashId;</span>
<a href="#l42.22"></a><span id="l42.22">     },</span>
<a href="#l42.23"></a><span id="l42.23"> </span>
<a href="#l42.24"></a><span id="l42.24">     // attribute AUTF8String id;</span>
<a href="#l42.25"></a><span id="l42.25">     get id() {</span>
<a href="#l42.26"></a><span id="l42.26">         return this.getProperty(&quot;UID&quot;);</span>
<a href="#l42.27"></a><span id="l42.27">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -392,30 +392,32 @@ function setupDefaultCategories() {</span>
<a href="#l43.4"></a><span id="l43.4">  *</span>
<a href="#l43.5"></a><span id="l43.5">  * @param str           The string to hash into a color.</span>
<a href="#l43.6"></a><span id="l43.6">  * @return              The hashed color.</span>
<a href="#l43.7"></a><span id="l43.7">  */</span>
<a href="#l43.8"></a><span id="l43.8"> function hashColor(str) {</span>
<a href="#l43.9"></a><span id="l43.9">     // This is the palette of colors in the current colorpicker implementation.</span>
<a href="#l43.10"></a><span id="l43.10">     // Unfortunately, there is no easy way to extract these colors from the</span>
<a href="#l43.11"></a><span id="l43.11">     // binding directly.</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-    const colorPalette = [&quot;#FFFFFF&quot;, &quot;#FFCCCC&quot;, &quot;#FFCC99&quot;, &quot;#FFFF99&quot;, &quot;#FFFFCC&quot;,</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineminus">-                          &quot;#99FF99&quot;, &quot;#99FFFF&quot;, &quot;#CCFFFF&quot;, &quot;#CCCCFF&quot;, &quot;#FFCCFF&quot;,</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineminus">-                          &quot;#CCCCCC&quot;, &quot;#FF6666&quot;, &quot;#FF9966&quot;, &quot;#FFFF66&quot;, &quot;#FFFF33&quot;,</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineminus">-                          &quot;#66FF99&quot;, &quot;#33FFFF&quot;, &quot;#66FFFF&quot;, &quot;#9999FF&quot;, &quot;#FF99FF&quot;,</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineminus">-                          &quot;#C0C0C0&quot;, &quot;#FF0000&quot;, &quot;#FF9900&quot;, &quot;#FFCC66&quot;, &quot;#FFFF00&quot;,</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineminus">-                          &quot;#33FF33&quot;, &quot;#66CCCC&quot;, &quot;#33CCFF&quot;, &quot;#6666CC&quot;, &quot;#CC66CC&quot;,</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineminus">-                          &quot;#999999&quot;, &quot;#CC0000&quot;, &quot;#FF6600&quot;, &quot;#FFCC33&quot;, &quot;#FFCC00&quot;,</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineminus">-                          &quot;#33CC00&quot;, &quot;#00CCCC&quot;, &quot;#3366FF&quot;, &quot;#6633FF&quot;, &quot;#CC33CC&quot;,</span>
<a href="#l43.20"></a><span id="l43.20" class="difflineminus">-                          &quot;#666666&quot;, &quot;#990000&quot;, &quot;#CC6600&quot;, &quot;#CC9933&quot;, &quot;#999900&quot;,</span>
<a href="#l43.21"></a><span id="l43.21" class="difflineminus">-                          &quot;#009900&quot;, &quot;#339999&quot;, &quot;#3333FF&quot;, &quot;#6600CC&quot;, &quot;#993399&quot;,</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineminus">-                          &quot;#333333&quot;, &quot;#660000&quot;, &quot;#993300&quot;, &quot;#996633&quot;, &quot;#666600&quot;,</span>
<a href="#l43.23"></a><span id="l43.23" class="difflineminus">-                          &quot;#006600&quot;, &quot;#336666&quot;, &quot;#000099&quot;, &quot;#333399&quot;, &quot;#663366&quot;,</span>
<a href="#l43.24"></a><span id="l43.24" class="difflineminus">-                          &quot;#000000&quot;, &quot;#330000&quot;, &quot;#663300&quot;, &quot;#663333&quot;, &quot;#333300&quot;,</span>
<a href="#l43.25"></a><span id="l43.25" class="difflineminus">-                          &quot;#003300&quot;, &quot;#003333&quot;, &quot;#000066&quot;, &quot;#330099&quot;, &quot;#330033&quot;];</span>
<a href="#l43.26"></a><span id="l43.26" class="difflineplus">+    const colorPalette = [</span>
<a href="#l43.27"></a><span id="l43.27" class="difflineplus">+        &quot;#FFFFFF&quot;, &quot;#FFCCCC&quot;, &quot;#FFCC99&quot;, &quot;#FFFF99&quot;, &quot;#FFFFCC&quot;,</span>
<a href="#l43.28"></a><span id="l43.28" class="difflineplus">+        &quot;#99FF99&quot;, &quot;#99FFFF&quot;, &quot;#CCFFFF&quot;, &quot;#CCCCFF&quot;, &quot;#FFCCFF&quot;,</span>
<a href="#l43.29"></a><span id="l43.29" class="difflineplus">+        &quot;#CCCCCC&quot;, &quot;#FF6666&quot;, &quot;#FF9966&quot;, &quot;#FFFF66&quot;, &quot;#FFFF33&quot;,</span>
<a href="#l43.30"></a><span id="l43.30" class="difflineplus">+        &quot;#66FF99&quot;, &quot;#33FFFF&quot;, &quot;#66FFFF&quot;, &quot;#9999FF&quot;, &quot;#FF99FF&quot;,</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineplus">+        &quot;#C0C0C0&quot;, &quot;#FF0000&quot;, &quot;#FF9900&quot;, &quot;#FFCC66&quot;, &quot;#FFFF00&quot;,</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+        &quot;#33FF33&quot;, &quot;#66CCCC&quot;, &quot;#33CCFF&quot;, &quot;#6666CC&quot;, &quot;#CC66CC&quot;,</span>
<a href="#l43.33"></a><span id="l43.33" class="difflineplus">+        &quot;#999999&quot;, &quot;#CC0000&quot;, &quot;#FF6600&quot;, &quot;#FFCC33&quot;, &quot;#FFCC00&quot;,</span>
<a href="#l43.34"></a><span id="l43.34" class="difflineplus">+        &quot;#33CC00&quot;, &quot;#00CCCC&quot;, &quot;#3366FF&quot;, &quot;#6633FF&quot;, &quot;#CC33CC&quot;,</span>
<a href="#l43.35"></a><span id="l43.35" class="difflineplus">+        &quot;#666666&quot;, &quot;#990000&quot;, &quot;#CC6600&quot;, &quot;#CC9933&quot;, &quot;#999900&quot;,</span>
<a href="#l43.36"></a><span id="l43.36" class="difflineplus">+        &quot;#009900&quot;, &quot;#339999&quot;, &quot;#3333FF&quot;, &quot;#6600CC&quot;, &quot;#993399&quot;,</span>
<a href="#l43.37"></a><span id="l43.37" class="difflineplus">+        &quot;#333333&quot;, &quot;#660000&quot;, &quot;#993300&quot;, &quot;#996633&quot;, &quot;#666600&quot;,</span>
<a href="#l43.38"></a><span id="l43.38" class="difflineplus">+        &quot;#006600&quot;, &quot;#336666&quot;, &quot;#000099&quot;, &quot;#333399&quot;, &quot;#663366&quot;,</span>
<a href="#l43.39"></a><span id="l43.39" class="difflineplus">+        &quot;#000000&quot;, &quot;#330000&quot;, &quot;#663300&quot;, &quot;#663333&quot;, &quot;#333300&quot;,</span>
<a href="#l43.40"></a><span id="l43.40" class="difflineplus">+        &quot;#003300&quot;, &quot;#003333&quot;, &quot;#000066&quot;, &quot;#330099&quot;, &quot;#330033&quot;</span>
<a href="#l43.41"></a><span id="l43.41" class="difflineplus">+    ];</span>
<a href="#l43.42"></a><span id="l43.42"> </span>
<a href="#l43.43"></a><span id="l43.43">     let sum = Array.from(str || &quot; &quot;, e =&gt; e.charCodeAt(0)).reduce((a, b) =&gt; a + b);</span>
<a href="#l43.44"></a><span id="l43.44">     return colorPalette[sum % colorPalette.length];</span>
<a href="#l43.45"></a><span id="l43.45"> }</span>
<a href="#l43.46"></a><span id="l43.46"> </span>
<a href="#l43.47"></a><span id="l43.47"> /**</span>
<a href="#l43.48"></a><span id="l43.48">  * Convert categories string to list of category names.</span>
<a href="#l43.49"></a><span id="l43.49">  *</span>
<a href="#l43.50"></a><span id="l43.50" class="difflineat">@@ -1420,19 +1422,20 @@ function calIterateEmailIdentities(func)</span>
<a href="#l43.51"></a><span id="l43.51">  * @param aFirstItem        The item to compare.</span>
<a href="#l43.52"></a><span id="l43.52">  * @param aSecondItem       The item to compare to.</span>
<a href="#l43.53"></a><span id="l43.53">  * @param aIgnoreProps      (optional) An array of parameters to ignore.</span>
<a href="#l43.54"></a><span id="l43.54">  * @param aIgnoreParams     (optional) An object describing which parameters to</span>
<a href="#l43.55"></a><span id="l43.55">  *                                     ignore.</span>
<a href="#l43.56"></a><span id="l43.56">  * @return                  True, if items match.</span>
<a href="#l43.57"></a><span id="l43.57">  */</span>
<a href="#l43.58"></a><span id="l43.58"> function compareItemContent(aFirstItem, aSecondItem, aIgnoreProps, aIgnoreParams) {</span>
<a href="#l43.59"></a><span id="l43.59" class="difflineminus">-    let ignoreProps = arr2hash(aIgnoreProps ||</span>
<a href="#l43.60"></a><span id="l43.60" class="difflineminus">-        [&quot;SEQUENCE&quot;, &quot;DTSTAMP&quot;, &quot;LAST-MODIFIED&quot;, &quot;X-MOZ-GENERATION&quot;, &quot;X-MICROSOFT-DISALLOW-COUNTER&quot;,</span>
<a href="#l43.61"></a><span id="l43.61" class="difflineminus">-         &quot;X-MOZ-SEND-INVITATIONS&quot;, &quot;X-MOZ-SEND-INVITATIONS-UNDISCLOSED&quot;]);</span>
<a href="#l43.62"></a><span id="l43.62" class="difflineplus">+    let ignoreProps = arr2hash(aIgnoreProps || [</span>
<a href="#l43.63"></a><span id="l43.63" class="difflineplus">+        &quot;SEQUENCE&quot;, &quot;DTSTAMP&quot;, &quot;LAST-MODIFIED&quot;, &quot;X-MOZ-GENERATION&quot;, &quot;X-MICROSOFT-DISALLOW-COUNTER&quot;,</span>
<a href="#l43.64"></a><span id="l43.64" class="difflineplus">+        &quot;X-MOZ-SEND-INVITATIONS&quot;, &quot;X-MOZ-SEND-INVITATIONS-UNDISCLOSED&quot;</span>
<a href="#l43.65"></a><span id="l43.65" class="difflineplus">+    ]);</span>
<a href="#l43.66"></a><span id="l43.66"> </span>
<a href="#l43.67"></a><span id="l43.67">     let ignoreParams = aIgnoreParams ||</span>
<a href="#l43.68"></a><span id="l43.68">         { ATTENDEE: [&quot;CN&quot;], ORGANIZER: [&quot;CN&quot;] };</span>
<a href="#l43.69"></a><span id="l43.69">     for (let x in ignoreParams) {</span>
<a href="#l43.70"></a><span id="l43.70">         ignoreParams[x] = arr2hash(ignoreParams[x]);</span>
<a href="#l43.71"></a><span id="l43.71">     }</span>
<a href="#l43.72"></a><span id="l43.72"> </span>
<a href="#l43.73"></a><span id="l43.73">     function arr2hash(arr) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -4,17 +4,18 @@</span>
<a href="#l44.4"></a><span id="l44.4"> </span>
<a href="#l44.5"></a><span id="l44.5"> /* exported onEventDialogUnload, changeUndiscloseCheckboxStatus,</span>
<a href="#l44.6"></a><span id="l44.6">  *          toggleKeepDuration, dateTimeControls2State, onUpdateAllDay,</span>
<a href="#l44.7"></a><span id="l44.7">  *          openNewEvent, openNewTask, openNewMessage, openNewCardDialog,</span>
<a href="#l44.8"></a><span id="l44.8">  *          deleteAllAttachments, copyAttachment, attachmentLinkKeyPress,</span>
<a href="#l44.9"></a><span id="l44.9">  *          attachmentDblClick, attachmentClick, notifyUser,</span>
<a href="#l44.10"></a><span id="l44.10">  *          removeNotification, chooseRecentTimezone, showTimezonePopup,</span>
<a href="#l44.11"></a><span id="l44.11">  *          attendeeDblClick, attendeeClick, removeAttendee,</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">- *          removeAllAttendees, sendMailToUndecidedAttendees, checkUntilDate</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+ *          removeAllAttendees, sendMailToUndecidedAttendees, checkUntilDate,</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineplus">+ *          applyValues</span>
<a href="#l44.15"></a><span id="l44.15">  */</span>
<a href="#l44.16"></a><span id="l44.16"> </span>
<a href="#l44.17"></a><span id="l44.17"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l44.18"></a><span id="l44.18"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l44.19"></a><span id="l44.19"> Components.utils.import(&quot;resource://calendar/modules/calRecurrenceUtils.jsm&quot;);</span>
<a href="#l44.20"></a><span id="l44.20"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l44.21"></a><span id="l44.21"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l44.22"></a><span id="l44.22"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l44.23"></a><span id="l44.23" class="difflineat">@@ -251,17 +252,17 @@ function receiveMessage(aEvent) {</span>
<a href="#l44.24"></a><span id="l44.24">     }</span>
<a href="#l44.25"></a><span id="l44.25"> }</span>
<a href="#l44.26"></a><span id="l44.26"> </span>
<a href="#l44.27"></a><span id="l44.27"> /**</span>
<a href="#l44.28"></a><span id="l44.28">  * Sets up the event dialog from the window arguments, also setting up all</span>
<a href="#l44.29"></a><span id="l44.29">  * dialog controls from the window's item.</span>
<a href="#l44.30"></a><span id="l44.30">  */</span>
<a href="#l44.31"></a><span id="l44.31"> function onLoad() {</span>
<a href="#l44.32"></a><span id="l44.32" class="difflineminus">-    window.addEventListener(&quot;message&quot;, receiveMessage, false);</span>
<a href="#l44.33"></a><span id="l44.33" class="difflineplus">+    window.addEventListener(&quot;message&quot;, receiveMessage);</span>
<a href="#l44.34"></a><span id="l44.34"> </span>
<a href="#l44.35"></a><span id="l44.35">     // first of all retrieve the array of</span>
<a href="#l44.36"></a><span id="l44.36">     // arguments this window has been called with.</span>
<a href="#l44.37"></a><span id="l44.37">     let args = window.arguments[0];</span>
<a href="#l44.38"></a><span id="l44.38"> </span>
<a href="#l44.39"></a><span id="l44.39">     intializeTabOrWindowVariables();</span>
<a href="#l44.40"></a><span id="l44.40"> </span>
<a href="#l44.41"></a><span id="l44.41">     // Needed so we can call switchToTab for the prompt about saving</span>
<a href="#l44.42"></a><span id="l44.42" class="difflineat">@@ -1253,25 +1254,22 @@ function getRepeatTypeAndUntilDate(aItem</span>
<a href="#l44.43"></a><span id="l44.43">             } else {</span>
<a href="#l44.44"></a><span id="l44.44">                 rules.push(ritem);</span>
<a href="#l44.45"></a><span id="l44.45">             }</span>
<a href="#l44.46"></a><span id="l44.46">         }</span>
<a href="#l44.47"></a><span id="l44.47">         if (rules.length == 1) {</span>
<a href="#l44.48"></a><span id="l44.48">             let rule = cal.wrapInstance(rules[0], Components.interfaces.calIRecurrenceRule);</span>
<a href="#l44.49"></a><span id="l44.49">             if (rule) {</span>
<a href="#l44.50"></a><span id="l44.50">                 switch (rule.type) {</span>
<a href="#l44.51"></a><span id="l44.51" class="difflineminus">-                    case &quot;DAILY&quot;:</span>
<a href="#l44.52"></a><span id="l44.52" class="difflineminus">-                        if (!checkRecurrenceRule(rule, [&quot;BYSECOND&quot;,</span>
<a href="#l44.53"></a><span id="l44.53" class="difflineminus">-                                                        &quot;BYMINUTE&quot;,</span>
<a href="#l44.54"></a><span id="l44.54" class="difflineminus">-                                                        &quot;BYHOUR&quot;,</span>
<a href="#l44.55"></a><span id="l44.55" class="difflineminus">-                                                        &quot;BYMONTHDAY&quot;,</span>
<a href="#l44.56"></a><span id="l44.56" class="difflineminus">-                                                        &quot;BYYEARDAY&quot;,</span>
<a href="#l44.57"></a><span id="l44.57" class="difflineminus">-                                                        &quot;BYWEEKNO&quot;,</span>
<a href="#l44.58"></a><span id="l44.58" class="difflineminus">-                                                        &quot;BYMONTH&quot;,</span>
<a href="#l44.59"></a><span id="l44.59" class="difflineminus">-                                                        &quot;BYSETPOS&quot;])) {</span>
<a href="#l44.60"></a><span id="l44.60" class="difflineplus">+                    case &quot;DAILY&quot;: {</span>
<a href="#l44.61"></a><span id="l44.61" class="difflineplus">+                        let byparts = [</span>
<a href="#l44.62"></a><span id="l44.62" class="difflineplus">+                            &quot;BYSECOND&quot;, &quot;BYMINUTE&quot;, &quot;BYHOUR&quot;, &quot;BYMONTHDAY&quot;,</span>
<a href="#l44.63"></a><span id="l44.63" class="difflineplus">+                            &quot;BYYEARDAY&quot;, &quot;BYWEEKNO&quot;, &quot;BYMONTH&quot;, &quot;BYSETPOS&quot;</span>
<a href="#l44.64"></a><span id="l44.64" class="difflineplus">+                        ];</span>
<a href="#l44.65"></a><span id="l44.65" class="difflineplus">+                        if (!checkRecurrenceRule(rule, byparts)) {</span>
<a href="#l44.66"></a><span id="l44.66">                             let ruleComp = rule.getComponent(&quot;BYDAY&quot;, {});</span>
<a href="#l44.67"></a><span id="l44.67">                             if (rule.interval == 1) {</span>
<a href="#l44.68"></a><span id="l44.68">                                 if (ruleComp.length &gt; 0) {</span>
<a href="#l44.69"></a><span id="l44.69">                                     if (ruleComp.length == 5) {</span>
<a href="#l44.70"></a><span id="l44.70">                                         let found = false;</span>
<a href="#l44.71"></a><span id="l44.71">                                         for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l44.72"></a><span id="l44.72">                                             if (ruleComp[i] != i + 2) {</span>
<a href="#l44.73"></a><span id="l44.73">                                                 found = true;</span>
<a href="#l44.74"></a><span id="l44.74" class="difflineat">@@ -1285,66 +1283,61 @@ function getRepeatTypeAndUntilDate(aItem</span>
<a href="#l44.75"></a><span id="l44.75">                                     }</span>
<a href="#l44.76"></a><span id="l44.76">                                 } else if (!rule.isFinite || !rule.isByCount) {</span>
<a href="#l44.77"></a><span id="l44.77">                                     repeatType = &quot;daily&quot;;</span>
<a href="#l44.78"></a><span id="l44.78">                                     updateUntilDate(rule);</span>
<a href="#l44.79"></a><span id="l44.79">                                 }</span>
<a href="#l44.80"></a><span id="l44.80">                             }</span>
<a href="#l44.81"></a><span id="l44.81">                         }</span>
<a href="#l44.82"></a><span id="l44.82">                         break;</span>
<a href="#l44.83"></a><span id="l44.83" class="difflineminus">-                    case &quot;WEEKLY&quot;:</span>
<a href="#l44.84"></a><span id="l44.84" class="difflineminus">-                        if (!checkRecurrenceRule(rule, [&quot;BYSECOND&quot;,</span>
<a href="#l44.85"></a><span id="l44.85" class="difflineminus">-                                                        &quot;BYMINUTE&quot;,</span>
<a href="#l44.86"></a><span id="l44.86" class="difflineminus">-                                                        &quot;BYDAY&quot;,</span>
<a href="#l44.87"></a><span id="l44.87" class="difflineminus">-                                                        &quot;BYHOUR&quot;,</span>
<a href="#l44.88"></a><span id="l44.88" class="difflineminus">-                                                        &quot;BYMONTHDAY&quot;,</span>
<a href="#l44.89"></a><span id="l44.89" class="difflineminus">-                                                        &quot;BYYEARDAY&quot;,</span>
<a href="#l44.90"></a><span id="l44.90" class="difflineminus">-                                                        &quot;BYWEEKNO&quot;,</span>
<a href="#l44.91"></a><span id="l44.91" class="difflineminus">-                                                        &quot;BYMONTH&quot;,</span>
<a href="#l44.92"></a><span id="l44.92" class="difflineminus">-                                                        &quot;BYSETPOS&quot;])) {</span>
<a href="#l44.93"></a><span id="l44.93" class="difflineminus">-                            let weekType=[&quot;weekly&quot;, &quot;bi.weekly&quot;];</span>
<a href="#l44.94"></a><span id="l44.94" class="difflineplus">+                    }</span>
<a href="#l44.95"></a><span id="l44.95" class="difflineplus">+                    case &quot;WEEKLY&quot;: {</span>
<a href="#l44.96"></a><span id="l44.96" class="difflineplus">+                        let byparts = [</span>
<a href="#l44.97"></a><span id="l44.97" class="difflineplus">+                            &quot;BYSECOND&quot;, &quot;BYMINUTE&quot;, &quot;BYDAY&quot;, &quot;BYHOUR&quot;,</span>
<a href="#l44.98"></a><span id="l44.98" class="difflineplus">+                            &quot;BYMONTHDAY&quot;, &quot;BYYEARDAY&quot;, &quot;BYWEEKNO&quot;, &quot;BYMONTH&quot;,</span>
<a href="#l44.99"></a><span id="l44.99" class="difflineplus">+                            &quot;BYSETPOS&quot;</span>
<a href="#l44.100"></a><span id="l44.100" class="difflineplus">+                        ];</span>
<a href="#l44.101"></a><span id="l44.101" class="difflineplus">+                        if (!checkRecurrenceRule(rule, byparts)) {</span>
<a href="#l44.102"></a><span id="l44.102" class="difflineplus">+                            let weekType = [&quot;weekly&quot;, &quot;bi.weekly&quot;];</span>
<a href="#l44.103"></a><span id="l44.103">                             if ((rule.interval == 1 || rule.interval == 2) &amp;&amp;</span>
<a href="#l44.104"></a><span id="l44.104">                                 (!rule.isFinite || !rule.isByCount)) {</span>
<a href="#l44.105"></a><span id="l44.105">                                 repeatType = weekType[rule.interval - 1];</span>
<a href="#l44.106"></a><span id="l44.106">                                 updateUntilDate(rule);</span>
<a href="#l44.107"></a><span id="l44.107">                             }</span>
<a href="#l44.108"></a><span id="l44.108">                         }</span>
<a href="#l44.109"></a><span id="l44.109">                         break;</span>
<a href="#l44.110"></a><span id="l44.110" class="difflineminus">-                    case &quot;MONTHLY&quot;:</span>
<a href="#l44.111"></a><span id="l44.111" class="difflineminus">-                        if (!checkRecurrenceRule(rule, [&quot;BYSECOND&quot;,</span>
<a href="#l44.112"></a><span id="l44.112" class="difflineminus">-                                                        &quot;BYMINUTE&quot;,</span>
<a href="#l44.113"></a><span id="l44.113" class="difflineminus">-                                                        &quot;BYDAY&quot;,</span>
<a href="#l44.114"></a><span id="l44.114" class="difflineminus">-                                                        &quot;BYHOUR&quot;,</span>
<a href="#l44.115"></a><span id="l44.115" class="difflineminus">-                                                        &quot;BYMONTHDAY&quot;,</span>
<a href="#l44.116"></a><span id="l44.116" class="difflineminus">-                                                        &quot;BYYEARDAY&quot;,</span>
<a href="#l44.117"></a><span id="l44.117" class="difflineminus">-                                                        &quot;BYWEEKNO&quot;,</span>
<a href="#l44.118"></a><span id="l44.118" class="difflineminus">-                                                        &quot;BYMONTH&quot;,</span>
<a href="#l44.119"></a><span id="l44.119" class="difflineminus">-                                                        &quot;BYSETPOS&quot;])) {</span>
<a href="#l44.120"></a><span id="l44.120" class="difflineplus">+                    }</span>
<a href="#l44.121"></a><span id="l44.121" class="difflineplus">+                    case &quot;MONTHLY&quot;: {</span>
<a href="#l44.122"></a><span id="l44.122" class="difflineplus">+                        let byparts = [</span>
<a href="#l44.123"></a><span id="l44.123" class="difflineplus">+                            &quot;BYSECOND&quot;, &quot;BYMINUTE&quot;, &quot;BYDAY&quot;, &quot;BYHOUR&quot;,</span>
<a href="#l44.124"></a><span id="l44.124" class="difflineplus">+                            &quot;BYMONTHDAY&quot;, &quot;BYYEARDAY&quot;, &quot;BYWEEKNO&quot;, &quot;BYMONTH&quot;,</span>
<a href="#l44.125"></a><span id="l44.125" class="difflineplus">+                            &quot;BYSETPOS&quot;</span>
<a href="#l44.126"></a><span id="l44.126" class="difflineplus">+                        ];</span>
<a href="#l44.127"></a><span id="l44.127" class="difflineplus">+                        if (!checkRecurrenceRule(rule, byparts)) {</span>
<a href="#l44.128"></a><span id="l44.128">                             if (rule.interval == 1 &amp;&amp; (!rule.isFinite || !rule.isByCount)) {</span>
<a href="#l44.129"></a><span id="l44.129">                                 repeatType = &quot;monthly&quot;;</span>
<a href="#l44.130"></a><span id="l44.130">                                 updateUntilDate(rule);</span>
<a href="#l44.131"></a><span id="l44.131">                             }</span>
<a href="#l44.132"></a><span id="l44.132">                         }</span>
<a href="#l44.133"></a><span id="l44.133">                         break;</span>
<a href="#l44.134"></a><span id="l44.134" class="difflineminus">-                    case &quot;YEARLY&quot;:</span>
<a href="#l44.135"></a><span id="l44.135" class="difflineminus">-                        if (!checkRecurrenceRule(rule, [&quot;BYSECOND&quot;,</span>
<a href="#l44.136"></a><span id="l44.136" class="difflineminus">-                                                        &quot;BYMINUTE&quot;,</span>
<a href="#l44.137"></a><span id="l44.137" class="difflineminus">-                                                        &quot;BYDAY&quot;,</span>
<a href="#l44.138"></a><span id="l44.138" class="difflineminus">-                                                        &quot;BYHOUR&quot;,</span>
<a href="#l44.139"></a><span id="l44.139" class="difflineminus">-                                                        &quot;BYMONTHDAY&quot;,</span>
<a href="#l44.140"></a><span id="l44.140" class="difflineminus">-                                                        &quot;BYYEARDAY&quot;,</span>
<a href="#l44.141"></a><span id="l44.141" class="difflineminus">-                                                        &quot;BYWEEKNO&quot;,</span>
<a href="#l44.142"></a><span id="l44.142" class="difflineminus">-                                                        &quot;BYMONTH&quot;,</span>
<a href="#l44.143"></a><span id="l44.143" class="difflineminus">-                                                        &quot;BYSETPOS&quot;])) {</span>
<a href="#l44.144"></a><span id="l44.144" class="difflineplus">+                    }</span>
<a href="#l44.145"></a><span id="l44.145" class="difflineplus">+                    case &quot;YEARLY&quot;: {</span>
<a href="#l44.146"></a><span id="l44.146" class="difflineplus">+                        let byparts = [</span>
<a href="#l44.147"></a><span id="l44.147" class="difflineplus">+                            &quot;BYSECOND&quot;, &quot;BYMINUTE&quot;, &quot;BYDAY&quot;, &quot;BYHOUR&quot;,</span>
<a href="#l44.148"></a><span id="l44.148" class="difflineplus">+                            &quot;BYMONTHDAY&quot;, &quot;BYYEARDAY&quot;, &quot;BYWEEKNO&quot;, &quot;BYMONTH&quot;,</span>
<a href="#l44.149"></a><span id="l44.149" class="difflineplus">+                            &quot;BYSETPOS&quot;</span>
<a href="#l44.150"></a><span id="l44.150" class="difflineplus">+                        ];</span>
<a href="#l44.151"></a><span id="l44.151" class="difflineplus">+                        if (!checkRecurrenceRule(rule, byparts)) {</span>
<a href="#l44.152"></a><span id="l44.152">                             if (rule.interval == 1 &amp;&amp; (!rule.isFinite || !rule.isByCount)) {</span>
<a href="#l44.153"></a><span id="l44.153">                                 repeatType = &quot;yearly&quot;;</span>
<a href="#l44.154"></a><span id="l44.154">                                 updateUntilDate(rule);</span>
<a href="#l44.155"></a><span id="l44.155">                             }</span>
<a href="#l44.156"></a><span id="l44.156">                         }</span>
<a href="#l44.157"></a><span id="l44.157">                         break;</span>
<a href="#l44.158"></a><span id="l44.158" class="difflineplus">+                    }</span>
<a href="#l44.159"></a><span id="l44.159">                 }</span>
<a href="#l44.160"></a><span id="l44.160">             }</span>
<a href="#l44.161"></a><span id="l44.161">         }</span>
<a href="#l44.162"></a><span id="l44.162">     }</span>
<a href="#l44.163"></a><span id="l44.163">     return [repeatType, untilDate];</span>
<a href="#l44.164"></a><span id="l44.164"> }</span>
<a href="#l44.165"></a><span id="l44.165"> </span>
<a href="#l44.166"></a><span id="l44.166"> /**</span>
<a href="#l44.167"></a><span id="l44.167" class="difflineat">@@ -3644,17 +3637,16 @@ function isAttendeeUndecided(aAttendee) </span>
<a href="#l44.168"></a><span id="l44.168">  *</span>
<a href="#l44.169"></a><span id="l44.169">  * @param aEvent         The popupshowing event</span>
<a href="#l44.170"></a><span id="l44.170">  */</span>
<a href="#l44.171"></a><span id="l44.171"> function attendeeDblClick(aEvent) {</span>
<a href="#l44.172"></a><span id="l44.172">     // left mouse button</span>
<a href="#l44.173"></a><span id="l44.173">     if (aEvent.button == 0) {</span>
<a href="#l44.174"></a><span id="l44.174">         editAttendees();</span>
<a href="#l44.175"></a><span id="l44.175">     }</span>
<a href="#l44.176"></a><span id="l44.176" class="difflineminus">-    return;</span>
<a href="#l44.177"></a><span id="l44.177"> }</span>
<a href="#l44.178"></a><span id="l44.178"> </span>
<a href="#l44.179"></a><span id="l44.179"> /**</span>
<a href="#l44.180"></a><span id="l44.180">  * Event handler to set up the attendee-popup. This builds the popup menuitems.</span>
<a href="#l44.181"></a><span id="l44.181">  *</span>
<a href="#l44.182"></a><span id="l44.182">  * @param aEvent         The popupshowing event</span>
<a href="#l44.183"></a><span id="l44.183">  */</span>
<a href="#l44.184"></a><span id="l44.184"> function attendeeClick(aEvent) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-panel.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-panel.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -3,16 +3,18 @@</span>
<a href="#l45.4"></a><span id="l45.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l45.5"></a><span id="l45.5"> </span>
<a href="#l45.6"></a><span id="l45.6"> /* exported onLoadLightningItemPanel, onAccept, onCancel, onCommandSave,</span>
<a href="#l45.7"></a><span id="l45.7">  *          onCommandDeleteItem, editAttendees, rotatePrivacy, editPrivacy,</span>
<a href="#l45.8"></a><span id="l45.8">  *          rotatePriority, editPriority, rotateStatus, editStatus,</span>
<a href="#l45.9"></a><span id="l45.9">  *          rotateShowTimeAs, editShowTimeAs, updateShowTimeAs, editToDoStatus,</span>
<a href="#l45.10"></a><span id="l45.10">  *          postponeTask, toggleTimezoneLinks, toggleLink, attachURL,</span>
<a href="#l45.11"></a><span id="l45.11">  *          onCommandViewToolbar, onCommandCustomize, attachFileByAccountKey,</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineplus">+ *          onUnloadLightningItemPanel, openNewEvent, openNewTask,</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+ *          openNewMessage, openNewCardDialog</span>
<a href="#l45.14"></a><span id="l45.14">  */</span>
<a href="#l45.15"></a><span id="l45.15"> </span>
<a href="#l45.16"></a><span id="l45.16"> // XXX Need to determine which of these we really need here.</span>
<a href="#l45.17"></a><span id="l45.17"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l45.18"></a><span id="l45.18"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l45.19"></a><span id="l45.19"> Components.utils.import(&quot;resource://calendar/modules/calRecurrenceUtils.jsm&quot;);</span>
<a href="#l45.20"></a><span id="l45.20"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l45.21"></a><span id="l45.21"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineat">@@ -146,17 +148,17 @@ function receiveMessage(aEvent) {</span>
<a href="#l45.23"></a><span id="l45.23">             break;</span>
<a href="#l45.24"></a><span id="l45.24">         }</span>
<a href="#l45.25"></a><span id="l45.25">         case &quot;loadCloudProviders&quot;:</span>
<a href="#l45.26"></a><span id="l45.26">             loadCloudProviders(aEvent.data.items);</span>
<a href="#l45.27"></a><span id="l45.27">             break;</span>
<a href="#l45.28"></a><span id="l45.28">     }</span>
<a href="#l45.29"></a><span id="l45.29"> }</span>
<a href="#l45.30"></a><span id="l45.30"> </span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-window.addEventListener(&quot;message&quot;, receiveMessage, false);</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineplus">+window.addEventListener(&quot;message&quot;, receiveMessage);</span>
<a href="#l45.33"></a><span id="l45.33"> </span>
<a href="#l45.34"></a><span id="l45.34"> /**</span>
<a href="#l45.35"></a><span id="l45.35">  * Send an asynchronous message to an iframe.  Additional properties of</span>
<a href="#l45.36"></a><span id="l45.36">  * aMessage are generally arguments that will be passed to the function</span>
<a href="#l45.37"></a><span id="l45.37">  * named in aMessage.command.  If aIframeId is omitted, the message will</span>
<a href="#l45.38"></a><span id="l45.38">  * be sent to the iframe of the current tab.</span>
<a href="#l45.39"></a><span id="l45.39">  *</span>
<a href="#l45.40"></a><span id="l45.40">  * @param {Object} aMessage          Contains the message being sent</span>
<a href="#l45.41"></a><span id="l45.41" class="difflineat">@@ -176,24 +178,23 @@ function sendMessage(aMessage, aIframeId</span>
<a href="#l45.42"></a><span id="l45.42">  * window, or not if 'cancel' was clicked.  Requires sending and receiving</span>
<a href="#l45.43"></a><span id="l45.43">  * async messages from the iframes of all open item tabs.</span>
<a href="#l45.44"></a><span id="l45.44">  *</span>
<a href="#l45.45"></a><span id="l45.45">  * @param {boolean} aResponse  The response from the tab's iframe</span>
<a href="#l45.46"></a><span id="l45.46">  */</span>
<a href="#l45.47"></a><span id="l45.47"> function handleWindowClose(aResponse) {</span>
<a href="#l45.48"></a><span id="l45.48">     if (!aResponse) {</span>
<a href="#l45.49"></a><span id="l45.49">         // Cancel was clicked, just leave the window open. We're done.</span>
<a href="#l45.50"></a><span id="l45.50" class="difflineminus">-        return;</span>
<a href="#l45.51"></a><span id="l45.51">     } else if (gItemTabIdsCopy.length &gt; 0) {</span>
<a href="#l45.52"></a><span id="l45.52">         // There are more unsaved changes in tabs to prompt the user about.</span>
<a href="#l45.53"></a><span id="l45.53">         let nextId = gItemTabIdsCopy.shift();</span>
<a href="#l45.54"></a><span id="l45.54">         sendMessage({ command: &quot;closingWindowWithTabs&quot;, id: nextId }, nextId);</span>
<a href="#l45.55"></a><span id="l45.55">     } else {</span>
<a href="#l45.56"></a><span id="l45.56">         // Close the window, there are no more unsaved changes in tabs.</span>
<a href="#l45.57"></a><span id="l45.57" class="difflineminus">-        window.removeEventListener(&quot;close&quot;, windowCloseListener, false);</span>
<a href="#l45.58"></a><span id="l45.58" class="difflineplus">+        window.removeEventListener(&quot;close&quot;, windowCloseListener);</span>
<a href="#l45.59"></a><span id="l45.59">         window.close();</span>
<a href="#l45.60"></a><span id="l45.60">     }</span>
<a href="#l45.61"></a><span id="l45.61"> }</span>
<a href="#l45.62"></a><span id="l45.62"> </span>
<a href="#l45.63"></a><span id="l45.63"> /**</span>
<a href="#l45.64"></a><span id="l45.64">  * Listener function for window close.  We prevent the window from</span>
<a href="#l45.65"></a><span id="l45.65">  * closing, then for each open tab we prompt the user to save any</span>
<a href="#l45.66"></a><span id="l45.66">  * unsaved changes with handleWindowClose.</span>
<a href="#l45.67"></a><span id="l45.67" class="difflineat">@@ -221,17 +222,17 @@ function onLoadLightningItemPanel(aIfram</span>
<a href="#l45.68"></a><span id="l45.68">     }</span>
<a href="#l45.69"></a><span id="l45.69">     if (gTabmail) {</span>
<a href="#l45.70"></a><span id="l45.70">         // tab case</span>
<a href="#l45.71"></a><span id="l45.71">         let iframeId = aIframeId || gTabmail.currentTabInfo.iframe.id;</span>
<a href="#l45.72"></a><span id="l45.72">         iframe = document.getElementById(iframeId);</span>
<a href="#l45.73"></a><span id="l45.73">         iframeSrc = aUrl;</span>
<a href="#l45.74"></a><span id="l45.74"> </span>
<a href="#l45.75"></a><span id="l45.75">         // Add a listener to detect close events, prompt user about saving changes.</span>
<a href="#l45.76"></a><span id="l45.76" class="difflineminus">-        window.addEventListener(&quot;close&quot;, windowCloseListener, false);</span>
<a href="#l45.77"></a><span id="l45.77" class="difflineplus">+        window.addEventListener(&quot;close&quot;, windowCloseListener);</span>
<a href="#l45.78"></a><span id="l45.78">     } else {</span>
<a href="#l45.79"></a><span id="l45.79">         // window dialog case</span>
<a href="#l45.80"></a><span id="l45.80">         iframe = document.createElement(&quot;iframe&quot;);</span>
<a href="#l45.81"></a><span id="l45.81">         iframeSrc = window.arguments[0].useNewItemUI</span>
<a href="#l45.82"></a><span id="l45.82">             ? &quot;chrome://lightning/content/html-item-editing/lightning-item-iframe.html&quot;</span>
<a href="#l45.83"></a><span id="l45.83">             : &quot;chrome://lightning/content/lightning-item-iframe.xul&quot;;</span>
<a href="#l45.84"></a><span id="l45.84"> </span>
<a href="#l45.85"></a><span id="l45.85">         iframe.setAttribute(&quot;id&quot;, &quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l45.86"></a><span id="l45.86" class="difflineat">@@ -730,23 +731,27 @@ function editStatus(aTarget) {</span>
<a href="#l45.87"></a><span id="l45.87"> </span>
<a href="#l45.88"></a><span id="l45.88"> /**</span>
<a href="#l45.89"></a><span id="l45.89">  * Update the dialog controls related to status.</span>
<a href="#l45.90"></a><span id="l45.90">  *</span>
<a href="#l45.91"></a><span id="l45.91">  * @param {Object} aArg         Contains the new status value</span>
<a href="#l45.92"></a><span id="l45.92">  * @param {string} aArg.status  The new status value</span>
<a href="#l45.93"></a><span id="l45.93">  */</span>
<a href="#l45.94"></a><span id="l45.94"> function updateStatus(aArg) {</span>
<a href="#l45.95"></a><span id="l45.95" class="difflineminus">-    const statusLabels = [&quot;status-status-tentative-label&quot;,</span>
<a href="#l45.96"></a><span id="l45.96" class="difflineminus">-                          &quot;status-status-confirmed-label&quot;,</span>
<a href="#l45.97"></a><span id="l45.97" class="difflineminus">-                          &quot;status-status-cancelled-label&quot;];</span>
<a href="#l45.98"></a><span id="l45.98" class="difflineminus">-    const commands = [&quot;cmd_status_none&quot;,</span>
<a href="#l45.99"></a><span id="l45.99" class="difflineminus">-                      &quot;cmd_status_tentative&quot;,</span>
<a href="#l45.100"></a><span id="l45.100" class="difflineminus">-                      &quot;cmd_status_confirmed&quot;,</span>
<a href="#l45.101"></a><span id="l45.101" class="difflineminus">-                      &quot;cmd_status_cancelled&quot;];</span>
<a href="#l45.102"></a><span id="l45.102" class="difflineplus">+    const statusLabels = [</span>
<a href="#l45.103"></a><span id="l45.103" class="difflineplus">+        &quot;status-status-tentative-label&quot;,</span>
<a href="#l45.104"></a><span id="l45.104" class="difflineplus">+        &quot;status-status-confirmed-label&quot;,</span>
<a href="#l45.105"></a><span id="l45.105" class="difflineplus">+        &quot;status-status-cancelled-label&quot;</span>
<a href="#l45.106"></a><span id="l45.106" class="difflineplus">+    ];</span>
<a href="#l45.107"></a><span id="l45.107" class="difflineplus">+    const commands = [</span>
<a href="#l45.108"></a><span id="l45.108" class="difflineplus">+        &quot;cmd_status_none&quot;,</span>
<a href="#l45.109"></a><span id="l45.109" class="difflineplus">+        &quot;cmd_status_tentative&quot;,</span>
<a href="#l45.110"></a><span id="l45.110" class="difflineplus">+        &quot;cmd_status_confirmed&quot;,</span>
<a href="#l45.111"></a><span id="l45.111" class="difflineplus">+        &quot;cmd_status_cancelled&quot;</span>
<a href="#l45.112"></a><span id="l45.112" class="difflineplus">+    ];</span>
<a href="#l45.113"></a><span id="l45.113">     let found = false;</span>
<a href="#l45.114"></a><span id="l45.114">     setBooleanAttribute(&quot;status-status&quot;, &quot;collapsed&quot;, true);</span>
<a href="#l45.115"></a><span id="l45.115">     commands.forEach((aElement, aIndex, aArray) =&gt; {</span>
<a href="#l45.116"></a><span id="l45.116">         let node = document.getElementById(aElement);</span>
<a href="#l45.117"></a><span id="l45.117">         let matches = (node.getAttribute(&quot;value&quot;) == aArg.status);</span>
<a href="#l45.118"></a><span id="l45.118">         found = found || matches;</span>
<a href="#l45.119"></a><span id="l45.119"> </span>
<a href="#l45.120"></a><span id="l45.120">         node.setAttribute(&quot;checked&quot;, matches ? &quot;true&quot; : &quot;false&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -352,45 +352,44 @@ var calendarItemTabType = {</span>
<a href="#l46.4"></a><span id="l46.4">     }</span>
<a href="#l46.5"></a><span id="l46.5"> };</span>
<a href="#l46.6"></a><span id="l46.6"> </span>
<a href="#l46.7"></a><span id="l46.7"> window.addEventListener(&quot;load&quot;, (e) =&gt; {</span>
<a href="#l46.8"></a><span id="l46.8">     let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l46.9"></a><span id="l46.9">     tabmail.registerTabType(calendarTabType);</span>
<a href="#l46.10"></a><span id="l46.10">     tabmail.registerTabType(calendarItemTabType);</span>
<a href="#l46.11"></a><span id="l46.11">     tabmail.registerTabMonitor(calendarTabMonitor);</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-}, false);</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+});</span>
<a href="#l46.14"></a><span id="l46.14"> </span>
<a href="#l46.15"></a><span id="l46.15"> </span>
<a href="#l46.16"></a><span id="l46.16"> function ltnOnLoad(event) {</span>
<a href="#l46.17"></a><span id="l46.17">     // Check if the binary component was loaded</span>
<a href="#l46.18"></a><span id="l46.18">     checkCalendarBinaryComponent();</span>
<a href="#l46.19"></a><span id="l46.19"> </span>
<a href="#l46.20"></a><span id="l46.20">     document.getElementById(&quot;calendarDisplayDeck&quot;)</span>
<a href="#l46.21"></a><span id="l46.21">             .addEventListener(&quot;select&quot;, LtnObserveDisplayDeckChange, true);</span>
<a href="#l46.22"></a><span id="l46.22"> </span>
<a href="#l46.23"></a><span id="l46.23">     // Take care of common initialization</span>
<a href="#l46.24"></a><span id="l46.24">     commonInitCalendar();</span>
<a href="#l46.25"></a><span id="l46.25"> </span>
<a href="#l46.26"></a><span id="l46.26">     // Add an unload function to the window so we don't leak any listeners</span>
<a href="#l46.27"></a><span id="l46.27" class="difflineminus">-    window.addEventListener(&quot;unload&quot;, ltnFinish, false);</span>
<a href="#l46.28"></a><span id="l46.28" class="difflineplus">+    window.addEventListener(&quot;unload&quot;, ltnFinish);</span>
<a href="#l46.29"></a><span id="l46.29"> </span>
<a href="#l46.30"></a><span id="l46.30">     // Set up invitations manager</span>
<a href="#l46.31"></a><span id="l46.31">     scheduleInvitationsUpdate(FIRST_DELAY_STARTUP);</span>
<a href="#l46.32"></a><span id="l46.32">     cal.getCalendarManager().addObserver(gInvitationsCalendarManagerObserver);</span>
<a href="#l46.33"></a><span id="l46.33"> </span>
<a href="#l46.34"></a><span id="l46.34">     let filter = document.getElementById(&quot;task-tree-filtergroup&quot;);</span>
<a href="#l46.35"></a><span id="l46.35">     filter.value = filter.value || &quot;all&quot;;</span>
<a href="#l46.36"></a><span id="l46.36">     document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);</span>
<a href="#l46.37"></a><span id="l46.37">     document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l46.38"></a><span id="l46.38"> </span>
<a href="#l46.39"></a><span id="l46.39">     let mailContextPopup = document.getElementById(&quot;mailContext&quot;);</span>
<a href="#l46.40"></a><span id="l46.40">     if (mailContextPopup) {</span>
<a href="#l46.41"></a><span id="l46.41" class="difflineminus">-        mailContextPopup.addEventListener(&quot;popupshowing&quot;,</span>
<a href="#l46.42"></a><span id="l46.42" class="difflineminus">-                                          gCalSetupMailContext.popup, false);</span>
<a href="#l46.43"></a><span id="l46.43" class="difflineplus">+        mailContextPopup.addEventListener(&quot;popupshowing&quot;, gCalSetupMailContext.popup);</span>
<a href="#l46.44"></a><span id="l46.44">     }</span>
<a href="#l46.45"></a><span id="l46.45"> </span>
<a href="#l46.46"></a><span id="l46.46">     // Setup customizeDone handlers for our toolbars</span>
<a href="#l46.47"></a><span id="l46.47">     let toolbox = document.getElementById(&quot;calendar-toolbox&quot;);</span>
<a href="#l46.48"></a><span id="l46.48">     toolbox.customizeDone = function(aEvent) {</span>
<a href="#l46.49"></a><span id="l46.49">         MailToolboxCustomizeDone(aEvent, &quot;CustomizeCalendarToolbar&quot;);</span>
<a href="#l46.50"></a><span id="l46.50">     };</span>
<a href="#l46.51"></a><span id="l46.51">     toolbox = document.getElementById(&quot;task-toolbox&quot;);</span>
<a href="#l46.52"></a><span id="l46.52" class="difflineat">@@ -538,24 +537,27 @@ function ltnIntegrationCheck() {</span>
<a href="#l46.53"></a><span id="l46.53"> function refreshUIBits() {</span>
<a href="#l46.54"></a><span id="l46.54">     try {</span>
<a href="#l46.55"></a><span id="l46.55">         getMinimonth().refreshDisplay();</span>
<a href="#l46.56"></a><span id="l46.56"> </span>
<a href="#l46.57"></a><span id="l46.57">         // Refresh the current view and just allow the refresh for the others</span>
<a href="#l46.58"></a><span id="l46.58">         // views when will be displayed.</span>
<a href="#l46.59"></a><span id="l46.59">         let currView = currentView();</span>
<a href="#l46.60"></a><span id="l46.60">         currView.goToDay();</span>
<a href="#l46.61"></a><span id="l46.61" class="difflineminus">-        [&quot;day-view&quot;,</span>
<a href="#l46.62"></a><span id="l46.62" class="difflineminus">-         &quot;week-view&quot;,</span>
<a href="#l46.63"></a><span id="l46.63" class="difflineminus">-         &quot;multiweek-view&quot;,</span>
<a href="#l46.64"></a><span id="l46.64" class="difflineminus">-         &quot;month-view&quot;].forEach((view) =&gt; {</span>
<a href="#l46.65"></a><span id="l46.65" class="difflineminus">-             if (view != currView.id) {</span>
<a href="#l46.66"></a><span id="l46.66" class="difflineminus">-                 document.getElementById(view).mToggleStatus = -1;</span>
<a href="#l46.67"></a><span id="l46.67" class="difflineminus">-             }</span>
<a href="#l46.68"></a><span id="l46.68" class="difflineminus">-         });</span>
<a href="#l46.69"></a><span id="l46.69" class="difflineplus">+        let views = [</span>
<a href="#l46.70"></a><span id="l46.70" class="difflineplus">+            &quot;day-view&quot;,</span>
<a href="#l46.71"></a><span id="l46.71" class="difflineplus">+            &quot;week-view&quot;,</span>
<a href="#l46.72"></a><span id="l46.72" class="difflineplus">+            &quot;multiweek-view&quot;,</span>
<a href="#l46.73"></a><span id="l46.73" class="difflineplus">+            &quot;month-view&quot;</span>
<a href="#l46.74"></a><span id="l46.74" class="difflineplus">+        ];</span>
<a href="#l46.75"></a><span id="l46.75" class="difflineplus">+        for (let view of views) {</span>
<a href="#l46.76"></a><span id="l46.76" class="difflineplus">+            if (view != currView.id) {</span>
<a href="#l46.77"></a><span id="l46.77" class="difflineplus">+                document.getElementById(view).mToggleStatus = -1;</span>
<a href="#l46.78"></a><span id="l46.78" class="difflineplus">+            }</span>
<a href="#l46.79"></a><span id="l46.79" class="difflineplus">+        }</span>
<a href="#l46.80"></a><span id="l46.80"> </span>
<a href="#l46.81"></a><span id="l46.81">         if (!TodayPane.showsToday()) {</span>
<a href="#l46.82"></a><span id="l46.82">             TodayPane.setDay(cal.now());</span>
<a href="#l46.83"></a><span id="l46.83">         }</span>
<a href="#l46.84"></a><span id="l46.84"> </span>
<a href="#l46.85"></a><span id="l46.85">         // update the unifinder</span>
<a href="#l46.86"></a><span id="l46.86">         refreshEventTree();</span>
<a href="#l46.87"></a><span id="l46.87"> </span>
<a href="#l46.88"></a><span id="l46.88" class="difflineat">@@ -625,18 +627,17 @@ function LtnObserveDisplayDeckChange(eve</span>
<a href="#l46.89"></a><span id="l46.89"> }</span>
<a href="#l46.90"></a><span id="l46.90"> </span>
<a href="#l46.91"></a><span id="l46.91"> function ltnFinish() {</span>
<a href="#l46.92"></a><span id="l46.92">     cal.getCalendarManager().removeObserver(gInvitationsCalendarManagerObserver);</span>
<a href="#l46.93"></a><span id="l46.93"> </span>
<a href="#l46.94"></a><span id="l46.94">     // Remove listener for mailContext.</span>
<a href="#l46.95"></a><span id="l46.95">     let mailContextPopup = document.getElementById(&quot;mailContext&quot;);</span>
<a href="#l46.96"></a><span id="l46.96">     if (mailContextPopup) {</span>
<a href="#l46.97"></a><span id="l46.97" class="difflineminus">-        mailContextPopup.removeEventListener(&quot;popupshowing&quot;,</span>
<a href="#l46.98"></a><span id="l46.98" class="difflineminus">-                                             gCalSetupMailContext.popup, false);</span>
<a href="#l46.99"></a><span id="l46.99" class="difflineplus">+        mailContextPopup.removeEventListener(&quot;popupshowing&quot;, gCalSetupMailContext.popup);</span>
<a href="#l46.100"></a><span id="l46.100">     }</span>
<a href="#l46.101"></a><span id="l46.101"> </span>
<a href="#l46.102"></a><span id="l46.102">     // Common finish steps</span>
<a href="#l46.103"></a><span id="l46.103">     commonFinishCalendar();</span>
<a href="#l46.104"></a><span id="l46.104"> }</span>
<a href="#l46.105"></a><span id="l46.105"> </span>
<a href="#l46.106"></a><span id="l46.106"> // == invitations link</span>
<a href="#l46.107"></a><span id="l46.107"> var FIRST_DELAY_STARTUP = 100;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -34,17 +34,17 @@ ltn.invitation = {</span>
<a href="#l47.4"></a><span id="l47.4">                     break;</span>
<a href="#l47.5"></a><span id="l47.5">                 case &quot;CANCEL&quot;:</span>
<a href="#l47.6"></a><span id="l47.6">                     header = ltn.getString(&quot;lightning&quot;,</span>
<a href="#l47.7"></a><span id="l47.7">                                            &quot;itipCancelBody&quot;,</span>
<a href="#l47.8"></a><span id="l47.8">                                            [organizerString, summary]);</span>
<a href="#l47.9"></a><span id="l47.9">                     break;</span>
<a href="#l47.10"></a><span id="l47.10">                 case &quot;COUNTER&quot;:</span>
<a href="#l47.11"></a><span id="l47.11">                     // falls through</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-                case &quot;REPLY&quot;:</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+                case &quot;REPLY&quot;: {</span>
<a href="#l47.14"></a><span id="l47.14">                     let attendees = item.getAttendees({});</span>
<a href="#l47.15"></a><span id="l47.15">                     let sender = cal.getAttendeesBySender(attendees, aItipItem.sender);</span>
<a href="#l47.16"></a><span id="l47.16">                     if (sender.length == 1) {</span>
<a href="#l47.17"></a><span id="l47.17">                         if (aItipItem.responseMethod == &quot;COUNTER&quot;) {</span>
<a href="#l47.18"></a><span id="l47.18">                             header = cal.calGetString(&quot;lightning&quot;,</span>
<a href="#l47.19"></a><span id="l47.19">                                                       &quot;itipCounterBody&quot;,</span>
<a href="#l47.20"></a><span id="l47.20">                                                       [sender[0].toString(), summary],</span>
<a href="#l47.21"></a><span id="l47.21">                                                       &quot;lightning&quot;);</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineat">@@ -55,16 +55,17 @@ ltn.invitation = {</span>
<a href="#l47.23"></a><span id="l47.23">                                                       statusString,</span>
<a href="#l47.24"></a><span id="l47.24">                                                       [sender[0].toString()],</span>
<a href="#l47.25"></a><span id="l47.25">                                                       &quot;lightning&quot;);</span>
<a href="#l47.26"></a><span id="l47.26">                         }</span>
<a href="#l47.27"></a><span id="l47.27">                     } else {</span>
<a href="#l47.28"></a><span id="l47.28">                         header = &quot;&quot;;</span>
<a href="#l47.29"></a><span id="l47.29">                     }</span>
<a href="#l47.30"></a><span id="l47.30">                     break;</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineplus">+                }</span>
<a href="#l47.32"></a><span id="l47.32">                 case &quot;DECLINECOUNTER&quot;:</span>
<a href="#l47.33"></a><span id="l47.33">                     header = ltn.getString(&quot;lightning&quot;,</span>
<a href="#l47.34"></a><span id="l47.34">                                            &quot;itipDeclineCounterBody&quot;,</span>
<a href="#l47.35"></a><span id="l47.35">                                            [organizerString, summary]);</span>
<a href="#l47.36"></a><span id="l47.36">                     break;</span>
<a href="#l47.37"></a><span id="l47.37">             }</span>
<a href="#l47.38"></a><span id="l47.38">         }</span>
<a href="#l47.39"></a><span id="l47.39"> </span>
<a href="#l47.40"></a><span id="l47.40" class="difflineat">@@ -406,18 +407,21 @@ ltn.invitation = {</span>
<a href="#l47.41"></a><span id="l47.41">                     }</span>
<a href="#l47.42"></a><span id="l47.42">                 }</span>
<a href="#l47.43"></a><span id="l47.43">             }</span>
<a href="#l47.44"></a><span id="l47.44">         }</span>
<a href="#l47.45"></a><span id="l47.45">         aOldDoc = cal.xml.parseString(aOldDoc);</span>
<a href="#l47.46"></a><span id="l47.46">         aNewDoc = cal.xml.parseString(aNewDoc);</span>
<a href="#l47.47"></a><span id="l47.47">         let doc = aNewDoc.cloneNode(true);</span>
<a href="#l47.48"></a><span id="l47.48">         // elements to consider for comparison</span>
<a href="#l47.49"></a><span id="l47.49" class="difflineminus">-        [&quot;summary&quot;, &quot;location&quot;, &quot;when&quot;, &quot;canceledOccurrences&quot;,</span>
<a href="#l47.50"></a><span id="l47.50" class="difflineminus">-         &quot;modifiedOccurrences&quot;, &quot;organizer&quot;, &quot;attendee&quot;].forEach(_compareElement);</span>
<a href="#l47.51"></a><span id="l47.51" class="difflineplus">+        let elements = [</span>
<a href="#l47.52"></a><span id="l47.52" class="difflineplus">+            &quot;summary&quot;, &quot;location&quot;, &quot;when&quot;, &quot;canceledOccurrences&quot;,</span>
<a href="#l47.53"></a><span id="l47.53" class="difflineplus">+            &quot;modifiedOccurrences&quot;, &quot;organizer&quot;, &quot;attendee&quot;</span>
<a href="#l47.54"></a><span id="l47.54" class="difflineplus">+        ];</span>
<a href="#l47.55"></a><span id="l47.55" class="difflineplus">+        elements.forEach(_compareElement);</span>
<a href="#l47.56"></a><span id="l47.56">         return cal.xml.serializeDOM(doc);</span>
<a href="#l47.57"></a><span id="l47.57">     },</span>
<a href="#l47.58"></a><span id="l47.58"> </span>
<a href="#l47.59"></a><span id="l47.59">     /**</span>
<a href="#l47.60"></a><span id="l47.60">      * Returns the header section for an invitation email.</span>
<a href="#l47.61"></a><span id="l47.61">      * @param   {String}         aMessageId  the message id to use for that email</span>
<a href="#l47.62"></a><span id="l47.62">      * @param   {nsIMsgIdentity} aIdentity   the identity to use for that email</span>
<a href="#l47.63"></a><span id="l47.63">      * @returns {String}                     the source code of the header section of the email</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -187,21 +187,23 @@ calDavCalendar.prototype = {</span>
<a href="#l48.4"></a><span id="l48.4">                 }</span>
<a href="#l48.5"></a><span id="l48.5">             } finally {</span>
<a href="#l48.6"></a><span id="l48.6">                 this.mOfflineStorage.endBatch();</span>
<a href="#l48.7"></a><span id="l48.7">             }</span>
<a href="#l48.8"></a><span id="l48.8">         }</span>
<a href="#l48.9"></a><span id="l48.9">     },</span>
<a href="#l48.10"></a><span id="l48.10"> </span>
<a href="#l48.11"></a><span id="l48.11">     get offlineCachedProperties() {</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-        return [&quot;mAuthScheme&quot;, &quot;mAuthRealm&quot;, &quot;mHasWebdavSyncSupport&quot;,</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineminus">-                &quot;mCtag&quot;, &quot;mWebdavSyncToken&quot;, &quot;mSupportedItemTypes&quot;,</span>
<a href="#l48.14"></a><span id="l48.14" class="difflineminus">-                &quot;mPrincipalUrl&quot;, &quot;mCalHomeSet&quot;,</span>
<a href="#l48.15"></a><span id="l48.15" class="difflineminus">-                &quot;mShouldPollInbox&quot;, &quot;hasAutoScheduling&quot;, &quot;mHaveScheduling&quot;,</span>
<a href="#l48.16"></a><span id="l48.16" class="difflineminus">-                &quot;mCalendarUserAddress&quot;, &quot;mOutboxUrl&quot;, &quot;hasFreeBusy&quot;];</span>
<a href="#l48.17"></a><span id="l48.17" class="difflineplus">+        return [</span>
<a href="#l48.18"></a><span id="l48.18" class="difflineplus">+            &quot;mAuthScheme&quot;, &quot;mAuthRealm&quot;, &quot;mHasWebdavSyncSupport&quot;, &quot;mCtag&quot;,</span>
<a href="#l48.19"></a><span id="l48.19" class="difflineplus">+            &quot;mWebdavSyncToken&quot;, &quot;mSupportedItemTypes&quot;, &quot;mPrincipalUrl&quot;,</span>
<a href="#l48.20"></a><span id="l48.20" class="difflineplus">+            &quot;mCalHomeSet&quot;, &quot;mShouldPollInbox&quot;, &quot;hasAutoScheduling&quot;,</span>
<a href="#l48.21"></a><span id="l48.21" class="difflineplus">+            &quot;mHaveScheduling&quot;, &quot;mCalendarUserAddress&quot;, &quot;mOutboxUrl&quot;,</span>
<a href="#l48.22"></a><span id="l48.22" class="difflineplus">+            &quot;hasFreeBusy&quot;</span>
<a href="#l48.23"></a><span id="l48.23" class="difflineplus">+        ];</span>
<a href="#l48.24"></a><span id="l48.24">     },</span>
<a href="#l48.25"></a><span id="l48.25"> </span>
<a href="#l48.26"></a><span id="l48.26">     get checkedServerInfo() {</span>
<a href="#l48.27"></a><span id="l48.27">         if (Services.io.offline) {</span>
<a href="#l48.28"></a><span id="l48.28">             return true;</span>
<a href="#l48.29"></a><span id="l48.29">         } else {</span>
<a href="#l48.30"></a><span id="l48.30">             return this.mCheckedServerInfo;</span>
<a href="#l48.31"></a><span id="l48.31">         }</span>
<a href="#l48.32"></a><span id="l48.32" class="difflineat">@@ -2157,17 +2159,17 @@ calDavCalendar.prototype = {</span>
<a href="#l48.33"></a><span id="l48.33">                         &quot;&lt;C:schedule-outbox-URL/&gt;&quot; +</span>
<a href="#l48.34"></a><span id="l48.34">                     &quot;&lt;/D:prop&gt;&quot; +</span>
<a href="#l48.35"></a><span id="l48.35">                 &quot;&lt;/D:principal-property-search&gt;&quot;;</span>
<a href="#l48.36"></a><span id="l48.36">             queryMethod = &quot;REPORT&quot;;</span>
<a href="#l48.37"></a><span id="l48.37">             queryDepth = 1;</span>
<a href="#l48.38"></a><span id="l48.38">         }</span>
<a href="#l48.39"></a><span id="l48.39"> </span>
<a href="#l48.40"></a><span id="l48.40">         // We want a trailing slash, ensure it.</span>
<a href="#l48.41"></a><span id="l48.41" class="difflineminus">-        let nextNS = aNameSpaceList.pop().replace(/([^\/])$/, &quot;$1/&quot;);</span>
<a href="#l48.42"></a><span id="l48.42" class="difflineplus">+        let nextNS = aNameSpaceList.pop().replace(/([^\/])$/, &quot;$1/&quot;); // eslint-disable-line no-useless-escape</span>
<a href="#l48.43"></a><span id="l48.43">         let requestUri = Services.io.newURI(this.calendarUri.prePath + this.ensureEncodedPath(nextNS));</span>
<a href="#l48.44"></a><span id="l48.44"> </span>
<a href="#l48.45"></a><span id="l48.45">         if (this.verboseLogging()) {</span>
<a href="#l48.46"></a><span id="l48.46">             cal.LOG(&quot;CalDAV: send: &quot; + queryMethod + &quot; &quot; + requestUri.spec + &quot;\n&quot; + queryXml);</span>
<a href="#l48.47"></a><span id="l48.47">         }</span>
<a href="#l48.48"></a><span id="l48.48"> </span>
<a href="#l48.49"></a><span id="l48.49">         let streamListener = {};</span>
<a href="#l48.50"></a><span id="l48.50">         streamListener.onStreamComplete = function(aLoader, aContext, aStatus, aResultLength, aResult) {</span>
<a href="#l48.51"></a><span id="l48.51" class="difflineat">@@ -2194,17 +2196,17 @@ calDavCalendar.prototype = {</span>
<a href="#l48.52"></a><span id="l48.52">             } catch (ex) {</span>
<a href="#l48.53"></a><span id="l48.53">                 cal.LOG(&quot;CalDAV: Could not parse multistatus response: &quot; + ex + &quot;\n&quot; + str);</span>
<a href="#l48.54"></a><span id="l48.54">                 doesntSupportScheduling();</span>
<a href="#l48.55"></a><span id="l48.55">                 return;</span>
<a href="#l48.56"></a><span id="l48.56">             }</span>
<a href="#l48.57"></a><span id="l48.57"> </span>
<a href="#l48.58"></a><span id="l48.58">             let homeSets = caldavXPath(multistatus, &quot;/D:multistatus/D:response/D:propstat/D:prop/C:calendar-home-set/D:href/text()&quot;);</span>
<a href="#l48.59"></a><span id="l48.59">             function homeSetMatches(homeSet) {</span>
<a href="#l48.60"></a><span id="l48.60" class="difflineminus">-                let normalized = homeSet.replace(/([^\/])$/, &quot;$1/&quot;);</span>
<a href="#l48.61"></a><span id="l48.61" class="difflineplus">+                let normalized = homeSet.replace(/([^\/])$/, &quot;$1/&quot;); // eslint-disable-line no-useless-escape</span>
<a href="#l48.62"></a><span id="l48.62">                 let chs = self.mCalHomeSet;</span>
<a href="#l48.63"></a><span id="l48.63">                 return normalized == chs.path || normalized == chs.spec;</span>
<a href="#l48.64"></a><span id="l48.64">             }</span>
<a href="#l48.65"></a><span id="l48.65">             function createBoxUrl(path) {</span>
<a href="#l48.66"></a><span id="l48.66">                 let url = self.mUri.clone();</span>
<a href="#l48.67"></a><span id="l48.67">                 url.pathQueryRef = self.ensureDecodedPath(path);</span>
<a href="#l48.68"></a><span id="l48.68">                 // Make sure the uri has a / at the end, as we do with the calendarUri.</span>
<a href="#l48.69"></a><span id="l48.69">                 if (url.pathQueryRef.charAt(url.pathQueryRef.length - 1) != &quot;/&quot;) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -681,17 +681,16 @@ calICSCalendar.prototype = {</span>
<a href="#l49.4"></a><span id="l49.4">                 try {</span>
<a href="#l49.5"></a><span id="l49.5">                     file.remove(false);</span>
<a href="#l49.6"></a><span id="l49.6">                 } catch (ex) {</span>
<a href="#l49.7"></a><span id="l49.7">                     // This can fail because of some crappy code in</span>
<a href="#l49.8"></a><span id="l49.8">                     // nsIFile.  That's not the end of the world.  We can</span>
<a href="#l49.9"></a><span id="l49.9">                     // try to remove the file the next time around.</span>
<a href="#l49.10"></a><span id="l49.10">                 }</span>
<a href="#l49.11"></a><span id="l49.11">             }</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-            return;</span>
<a href="#l49.13"></a><span id="l49.13">         }</span>
<a href="#l49.14"></a><span id="l49.14"> </span>
<a href="#l49.15"></a><span id="l49.15">         function purgeOldBackups() {</span>
<a href="#l49.16"></a><span id="l49.16">             // Enumerate files in the backupdir for expiry of old backups</span>
<a href="#l49.17"></a><span id="l49.17">             let dirEnum = backupDir.directoryEntries;</span>
<a href="#l49.18"></a><span id="l49.18">             let files = [];</span>
<a href="#l49.19"></a><span id="l49.19">             while (dirEnum.hasMoreElements()) {</span>
<a href="#l49.20"></a><span id="l49.20">                 let file = dirEnum.getNext().QueryInterface(Ci.nsIFile);</span>
<a href="#l49.21"></a><span id="l49.21" class="difflineat">@@ -700,18 +699,16 @@ calICSCalendar.prototype = {</span>
<a href="#l49.22"></a><span id="l49.22">                 }</span>
<a href="#l49.23"></a><span id="l49.23">             }</span>
<a href="#l49.24"></a><span id="l49.24"> </span>
<a href="#l49.25"></a><span id="l49.25">             if (doDailyBackup) {</span>
<a href="#l49.26"></a><span id="l49.26">                 purgeBackupsByType(files, &quot;day&quot;);</span>
<a href="#l49.27"></a><span id="l49.27">             } else {</span>
<a href="#l49.28"></a><span id="l49.28">                 purgeBackupsByType(files, &quot;edit&quot;);</span>
<a href="#l49.29"></a><span id="l49.29">             }</span>
<a href="#l49.30"></a><span id="l49.30" class="difflineminus">-</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineminus">-            return;</span>
<a href="#l49.32"></a><span id="l49.32">         }</span>
<a href="#l49.33"></a><span id="l49.33"> </span>
<a href="#l49.34"></a><span id="l49.34">         function copyToOverwriting(oldFile, newParentDir, newName) {</span>
<a href="#l49.35"></a><span id="l49.35">             try {</span>
<a href="#l49.36"></a><span id="l49.36">                 let newFile = newParentDir.clone();</span>
<a href="#l49.37"></a><span id="l49.37">                 newFile.append(newName);</span>
<a href="#l49.38"></a><span id="l49.38"> </span>
<a href="#l49.39"></a><span id="l49.39">                 if (newFile.exists()) {</span>
<a href="#l49.40"></a><span id="l49.40" class="difflineat">@@ -815,20 +812,17 @@ calICSCalendar.prototype = {</span>
<a href="#l49.41"></a><span id="l49.41">         downloader.init(listener, backupFile);</span>
<a href="#l49.42"></a><span id="l49.42">         try {</span>
<a href="#l49.43"></a><span id="l49.43">             channel.asyncOpen(downloader, null);</span>
<a href="#l49.44"></a><span id="l49.44">         } catch (e) {</span>
<a href="#l49.45"></a><span id="l49.45">             // For local files, asyncOpen throws on new (calendar) files</span>
<a href="#l49.46"></a><span id="l49.46">             // No problem, go and upload something</span>
<a href="#l49.47"></a><span id="l49.47">             cal.ERROR(&quot;[calICSCalendar] Backup failed in asyncOpen:&quot; + e);</span>
<a href="#l49.48"></a><span id="l49.48">             aCallback.call(this);</span>
<a href="#l49.49"></a><span id="l49.49" class="difflineminus">-            return;</span>
<a href="#l49.50"></a><span id="l49.50">         }</span>
<a href="#l49.51"></a><span id="l49.51" class="difflineminus">-</span>
<a href="#l49.52"></a><span id="l49.52" class="difflineminus">-        return;</span>
<a href="#l49.53"></a><span id="l49.53">     }</span>
<a href="#l49.54"></a><span id="l49.54"> };</span>
<a href="#l49.55"></a><span id="l49.55"> </span>
<a href="#l49.56"></a><span id="l49.56"> function calICSObserver(aCalendar) {</span>
<a href="#l49.57"></a><span id="l49.57">     this.mCalendar = aCalendar;</span>
<a href="#l49.58"></a><span id="l49.58"> }</span>
<a href="#l49.59"></a><span id="l49.59"> </span>
<a href="#l49.60"></a><span id="l49.60"> calICSObserver.prototype = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -277,21 +277,22 @@ calStorageCalendar.prototype = {</span>
<a href="#l50.4"></a><span id="l50.4">                 /**</span>
<a href="#l50.5"></a><span id="l50.5">                  * Helper function to migrate all tables from one id to the next</span>
<a href="#l50.6"></a><span id="l50.6">                  *</span>
<a href="#l50.7"></a><span id="l50.7">                  * @param db        The database to use</span>
<a href="#l50.8"></a><span id="l50.8">                  * @param newCalId  The new calendar id to set</span>
<a href="#l50.9"></a><span id="l50.9">                  * @param oldCalId  The old calendar id to look for</span>
<a href="#l50.10"></a><span id="l50.10">                  */</span>
<a href="#l50.11"></a><span id="l50.11">                 let migrateTables = function(db, newCalId, oldCalId) {</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-                    for (let tbl of [&quot;cal_alarms&quot;, &quot;cal_attachments&quot;,</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineminus">-                                     &quot;cal_attendees&quot;, &quot;cal_events&quot;,</span>
<a href="#l50.14"></a><span id="l50.14" class="difflineminus">-                                     &quot;cal_metadata&quot;, &quot;cal_properties&quot;,</span>
<a href="#l50.15"></a><span id="l50.15" class="difflineminus">-                                     &quot;cal_recurrence&quot;, &quot;cal_relations&quot;,</span>
<a href="#l50.16"></a><span id="l50.16" class="difflineminus">-                                     &quot;cal_todos&quot;]) {</span>
<a href="#l50.17"></a><span id="l50.17" class="difflineplus">+                    let tables = [</span>
<a href="#l50.18"></a><span id="l50.18" class="difflineplus">+                        &quot;cal_alarms&quot;, &quot;cal_attachments&quot;, &quot;cal_attendees&quot;,</span>
<a href="#l50.19"></a><span id="l50.19" class="difflineplus">+                        &quot;cal_events&quot;, &quot;cal_metadata&quot;, &quot;cal_properties&quot;,</span>
<a href="#l50.20"></a><span id="l50.20" class="difflineplus">+                        &quot;cal_recurrence&quot;, &quot;cal_relations&quot;, &quot;cal_todos&quot;</span>
<a href="#l50.21"></a><span id="l50.21" class="difflineplus">+                    ];</span>
<a href="#l50.22"></a><span id="l50.22" class="difflineplus">+                    for (let tbl of tables) {</span>
<a href="#l50.23"></a><span id="l50.23">                         let stmt;</span>
<a href="#l50.24"></a><span id="l50.24">                         try {</span>
<a href="#l50.25"></a><span id="l50.25">                             stmt = db.createStatement(&quot;UPDATE &quot; + tbl +</span>
<a href="#l50.26"></a><span id="l50.26">                                                       &quot;   SET cal_id = :cal_id&quot; +</span>
<a href="#l50.27"></a><span id="l50.27">                                                       &quot; WHERE cal_id = :old_cal_id&quot;);</span>
<a href="#l50.28"></a><span id="l50.28">                             stmt.params.cal_id = newCalId;</span>
<a href="#l50.29"></a><span id="l50.29">                             stmt.params.old_cal_id = oldCalId;</span>
<a href="#l50.30"></a><span id="l50.30">                             stmt.executeStep();</span>
<a href="#l50.31"></a><span id="l50.31" class="difflineat">@@ -1384,20 +1385,21 @@ calStorageCalendar.prototype = {</span>
<a href="#l50.32"></a><span id="l50.32">             this.mDeleteMetaData = this.mDB.createStatement(</span>
<a href="#l50.33"></a><span id="l50.33">                 &quot;DELETE FROM cal_metadata WHERE item_id = :item_id AND cal_id = :cal_id&quot;</span>
<a href="#l50.34"></a><span id="l50.34">                 );</span>
<a href="#l50.35"></a><span id="l50.35">             this.mDeleteAlarms = this.mDB.createStatement(</span>
<a href="#l50.36"></a><span id="l50.36">                 &quot;DELETE FROM cal_alarms WHERE item_id = :item_id AND cal_id = :cal_id&quot;</span>
<a href="#l50.37"></a><span id="l50.37">                 );</span>
<a href="#l50.38"></a><span id="l50.38"> </span>
<a href="#l50.39"></a><span id="l50.39">             // These are only used when deleting an entire calendar</span>
<a href="#l50.40"></a><span id="l50.40" class="difflineminus">-            let extrasTables = [&quot;cal_attendees&quot;, &quot;cal_properties&quot;,</span>
<a href="#l50.41"></a><span id="l50.41" class="difflineminus">-                                &quot;cal_recurrence&quot;, &quot;cal_attachments&quot;,</span>
<a href="#l50.42"></a><span id="l50.42" class="difflineminus">-                                &quot;cal_metadata&quot;, &quot;cal_relations&quot;,</span>
<a href="#l50.43"></a><span id="l50.43" class="difflineminus">-                                &quot;cal_alarms&quot;];</span>
<a href="#l50.44"></a><span id="l50.44" class="difflineplus">+            let extrasTables = [</span>
<a href="#l50.45"></a><span id="l50.45" class="difflineplus">+                &quot;cal_attendees&quot;, &quot;cal_properties&quot;, &quot;cal_recurrence&quot;,</span>
<a href="#l50.46"></a><span id="l50.46" class="difflineplus">+                &quot;cal_attachments&quot;, &quot;cal_metadata&quot;, &quot;cal_relations&quot;,</span>
<a href="#l50.47"></a><span id="l50.47" class="difflineplus">+                &quot;cal_alarms&quot;</span>
<a href="#l50.48"></a><span id="l50.48" class="difflineplus">+            ];</span>
<a href="#l50.49"></a><span id="l50.49"> </span>
<a href="#l50.50"></a><span id="l50.50">             this.mDeleteEventExtras = [];</span>
<a href="#l50.51"></a><span id="l50.51">             this.mDeleteTodoExtras = [];</span>
<a href="#l50.52"></a><span id="l50.52"> </span>
<a href="#l50.53"></a><span id="l50.53">             for (let table in extrasTables) {</span>
<a href="#l50.54"></a><span id="l50.54">                 this.mDeleteEventExtras[table] = this.mDB.createStatement(</span>
<a href="#l50.55"></a><span id="l50.55">                     &quot;DELETE FROM &quot; + extrasTables[table] + &quot; WHERE item_id IN&quot; +</span>
<a href="#l50.56"></a><span id="l50.56">                     &quot;  (SELECT id FROM cal_events WHERE cal_id = :cal_id)&quot; +</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -744,35 +744,39 @@ upgrade.v3 = function(db, version) { // </span>
<a href="#l51.4"></a><span id="l51.4"> </span>
<a href="#l51.5"></a><span id="l51.5">     beginTransaction(db);</span>
<a href="#l51.6"></a><span id="l51.6">     try {</span>
<a href="#l51.7"></a><span id="l51.7">         copyTable(tbl, &quot;cal_items&quot;, &quot;cal_events&quot;, db, &quot;item_type = 0&quot;);</span>
<a href="#l51.8"></a><span id="l51.8">         copyTable(tbl, &quot;cal_items&quot;, &quot;cal_todos&quot;, db, &quot;item_type = 1&quot;);</span>
<a href="#l51.9"></a><span id="l51.9"> </span>
<a href="#l51.10"></a><span id="l51.10">         dropTable(tbl, &quot;cal_items&quot;, db);</span>
<a href="#l51.11"></a><span id="l51.11"> </span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-        let removeEventCols = [&quot;item_type&quot;,</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineminus">-                               &quot;item_type&quot;,</span>
<a href="#l51.14"></a><span id="l51.14" class="difflineminus">-                               &quot;todo_entry&quot;,</span>
<a href="#l51.15"></a><span id="l51.15" class="difflineminus">-                               &quot;todo_due&quot;,</span>
<a href="#l51.16"></a><span id="l51.16" class="difflineminus">-                               &quot;todo_completed&quot;,</span>
<a href="#l51.17"></a><span id="l51.17" class="difflineminus">-                               &quot;todo_complete&quot;,</span>
<a href="#l51.18"></a><span id="l51.18" class="difflineminus">-                               &quot;alarm_id&quot;];</span>
<a href="#l51.19"></a><span id="l51.19" class="difflineplus">+        let removeEventCols = [</span>
<a href="#l51.20"></a><span id="l51.20" class="difflineplus">+            &quot;item_type&quot;,</span>
<a href="#l51.21"></a><span id="l51.21" class="difflineplus">+            &quot;item_type&quot;,</span>
<a href="#l51.22"></a><span id="l51.22" class="difflineplus">+            &quot;todo_entry&quot;,</span>
<a href="#l51.23"></a><span id="l51.23" class="difflineplus">+            &quot;todo_due&quot;,</span>
<a href="#l51.24"></a><span id="l51.24" class="difflineplus">+            &quot;todo_completed&quot;,</span>
<a href="#l51.25"></a><span id="l51.25" class="difflineplus">+            &quot;todo_complete&quot;,</span>
<a href="#l51.26"></a><span id="l51.26" class="difflineplus">+            &quot;alarm_id&quot;</span>
<a href="#l51.27"></a><span id="l51.27" class="difflineplus">+        ];</span>
<a href="#l51.28"></a><span id="l51.28">         deleteColumns(tbl, &quot;cal_events&quot;, removeEventCols, db);</span>
<a href="#l51.29"></a><span id="l51.29"> </span>
<a href="#l51.30"></a><span id="l51.30">         addColumn(tbl, &quot;cal_events&quot;, &quot;event_start_tz&quot;, &quot;VARCHAR&quot;, db);</span>
<a href="#l51.31"></a><span id="l51.31">         addColumn(tbl, &quot;cal_events&quot;, &quot;event_end_tz&quot;, &quot;VARCHAR&quot;, db);</span>
<a href="#l51.32"></a><span id="l51.32">         addColumn(tbl, &quot;cal_events&quot;, &quot;alarm_time&quot;, &quot;INTEGER&quot;, db);</span>
<a href="#l51.33"></a><span id="l51.33">         addColumn(tbl, &quot;cal_events&quot;, &quot;alarm_time_tz&quot;, &quot;VARCHAR&quot;, db);</span>
<a href="#l51.34"></a><span id="l51.34"> </span>
<a href="#l51.35"></a><span id="l51.35" class="difflineminus">-        let removeTodoCols = [&quot;item_type&quot;,</span>
<a href="#l51.36"></a><span id="l51.36" class="difflineminus">-                              &quot;event_start&quot;,</span>
<a href="#l51.37"></a><span id="l51.37" class="difflineminus">-                              &quot;event_end&quot;,</span>
<a href="#l51.38"></a><span id="l51.38" class="difflineminus">-                              &quot;event_stamp&quot;,</span>
<a href="#l51.39"></a><span id="l51.39" class="difflineminus">-                              &quot;alarm_id&quot;];</span>
<a href="#l51.40"></a><span id="l51.40" class="difflineplus">+        let removeTodoCols = [</span>
<a href="#l51.41"></a><span id="l51.41" class="difflineplus">+            &quot;item_type&quot;,</span>
<a href="#l51.42"></a><span id="l51.42" class="difflineplus">+            &quot;event_start&quot;,</span>
<a href="#l51.43"></a><span id="l51.43" class="difflineplus">+            &quot;event_end&quot;,</span>
<a href="#l51.44"></a><span id="l51.44" class="difflineplus">+            &quot;event_stamp&quot;,</span>
<a href="#l51.45"></a><span id="l51.45" class="difflineplus">+            &quot;alarm_id&quot;</span>
<a href="#l51.46"></a><span id="l51.46" class="difflineplus">+        ];</span>
<a href="#l51.47"></a><span id="l51.47">         deleteColumns(tbl, &quot;cal_todos&quot;, removeTodoCols, db);</span>
<a href="#l51.48"></a><span id="l51.48"> </span>
<a href="#l51.49"></a><span id="l51.49">         addColumn(tbl, &quot;cal_todos&quot;, &quot;todo_entry_tz&quot;, &quot;VARCHAR&quot;, db);</span>
<a href="#l51.50"></a><span id="l51.50">         addColumn(tbl, &quot;cal_todos&quot;, &quot;todo_due_tz&quot;, &quot;VARCHAR&quot;, db);</span>
<a href="#l51.51"></a><span id="l51.51">         addColumn(tbl, &quot;cal_todos&quot;, &quot;todo_completed_tz&quot;, &quot;VARCHAR&quot;, db);</span>
<a href="#l51.52"></a><span id="l51.52">         addColumn(tbl, &quot;cal_todos&quot;, &quot;alarm_time&quot;, &quot;INTEGER&quot;, db);</span>
<a href="#l51.53"></a><span id="l51.53">         addColumn(tbl, &quot;cal_todos&quot;, &quot;alarm_time_tz&quot;, &quot;VARCHAR&quot;, db);</span>
<a href="#l51.54"></a><span id="l51.54"> </span>
<a href="#l51.55"></a><span id="l51.55" class="difflineat">@@ -851,34 +855,39 @@ upgrade.v5 = function(db, version) { // </span>
<a href="#l51.56"></a><span id="l51.56">  * r=ctalbert,jminta p=lilmatt</span>
<a href="#l51.57"></a><span id="l51.57">  */</span>
<a href="#l51.58"></a><span id="l51.58"> upgrade.v6 = function(db, version) { // eslint-disable-line id-length</span>
<a href="#l51.59"></a><span id="l51.59">     let tbl = upgrade.v5(version &lt; 5 &amp;&amp; db, version);</span>
<a href="#l51.60"></a><span id="l51.60">     LOGdb(db, &quot;Storage: Upgrading to v6&quot;);</span>
<a href="#l51.61"></a><span id="l51.61"> </span>
<a href="#l51.62"></a><span id="l51.62">     beginTransaction(db);</span>
<a href="#l51.63"></a><span id="l51.63">     try {</span>
<a href="#l51.64"></a><span id="l51.64" class="difflineminus">-        let eventCols = [&quot;id&quot;, &quot;title&quot;, &quot;privacy&quot;, &quot;ical_status&quot;,</span>
<a href="#l51.65"></a><span id="l51.65" class="difflineminus">-                         &quot;recurrence_id_tz&quot;, &quot;event_start_tz&quot;,</span>
<a href="#l51.66"></a><span id="l51.66" class="difflineminus">-                         &quot;event_end_tz&quot;, &quot;alarm_time_tz&quot;];</span>
<a href="#l51.67"></a><span id="l51.67" class="difflineplus">+        let eventCols = [</span>
<a href="#l51.68"></a><span id="l51.68" class="difflineplus">+            &quot;id&quot;, &quot;title&quot;, &quot;privacy&quot;, &quot;ical_status&quot;, &quot;recurrence_id_tz&quot;,</span>
<a href="#l51.69"></a><span id="l51.69" class="difflineplus">+            &quot;event_start_tz&quot;, &quot;event_end_tz&quot;, &quot;alarm_time_tz&quot;</span>
<a href="#l51.70"></a><span id="l51.70" class="difflineplus">+        ];</span>
<a href="#l51.71"></a><span id="l51.71">         alterTypes(tbl, &quot;cal_events&quot;, eventCols, &quot;TEXT&quot;, db);</span>
<a href="#l51.72"></a><span id="l51.72"> </span>
<a href="#l51.73"></a><span id="l51.73" class="difflineminus">-        let todoCols = [&quot;id&quot;, &quot;title&quot;, &quot;privacy&quot;, &quot;ical_status&quot;,</span>
<a href="#l51.74"></a><span id="l51.74" class="difflineminus">-                         &quot;recurrence_id_tz&quot;, &quot;todo_entry_tz&quot;,</span>
<a href="#l51.75"></a><span id="l51.75" class="difflineminus">-                         &quot;todo_due_tz&quot;, &quot;todo_completed_tz&quot;,</span>
<a href="#l51.76"></a><span id="l51.76" class="difflineminus">-                         &quot;alarm_time_tz&quot;];</span>
<a href="#l51.77"></a><span id="l51.77" class="difflineplus">+        let todoCols = [</span>
<a href="#l51.78"></a><span id="l51.78" class="difflineplus">+            &quot;id&quot;, &quot;title&quot;, &quot;privacy&quot;, &quot;ical_status&quot;, &quot;recurrence_id_tz&quot;,</span>
<a href="#l51.79"></a><span id="l51.79" class="difflineplus">+            &quot;todo_entry_tz&quot;, &quot;todo_due_tz&quot;, &quot;todo_completed_tz&quot;,</span>
<a href="#l51.80"></a><span id="l51.80" class="difflineplus">+            &quot;alarm_time_tz&quot;</span>
<a href="#l51.81"></a><span id="l51.81" class="difflineplus">+        ];</span>
<a href="#l51.82"></a><span id="l51.82">         alterTypes(tbl, &quot;cal_todos&quot;, todoCols, &quot;TEXT&quot;, db);</span>
<a href="#l51.83"></a><span id="l51.83"> </span>
<a href="#l51.84"></a><span id="l51.84" class="difflineminus">-        let attendeeCols = [&quot;item_id&quot;, &quot;recurrence_id_tz&quot;, &quot;attendee_id&quot;,</span>
<a href="#l51.85"></a><span id="l51.85" class="difflineminus">-                            &quot;common_name&quot;, &quot;role&quot;, &quot;status&quot;, &quot;type&quot;];</span>
<a href="#l51.86"></a><span id="l51.86" class="difflineplus">+        let attendeeCols = [</span>
<a href="#l51.87"></a><span id="l51.87" class="difflineplus">+            &quot;item_id&quot;, &quot;recurrence_id_tz&quot;, &quot;attendee_id&quot;, &quot;common_name&quot;,</span>
<a href="#l51.88"></a><span id="l51.88" class="difflineplus">+            &quot;role&quot;, &quot;status&quot;, &quot;type&quot;</span>
<a href="#l51.89"></a><span id="l51.89" class="difflineplus">+        ];</span>
<a href="#l51.90"></a><span id="l51.90">         alterTypes(tbl, &quot;cal_attendees&quot;, attendeeCols, &quot;TEXT&quot;, db);</span>
<a href="#l51.91"></a><span id="l51.91"> </span>
<a href="#l51.92"></a><span id="l51.92" class="difflineminus">-        let recurrenceCols = [&quot;item_id&quot;, &quot;recur_type&quot;, &quot;dates&quot;, &quot;second&quot;,</span>
<a href="#l51.93"></a><span id="l51.93" class="difflineminus">-                              &quot;minute&quot;, &quot;hour&quot;, &quot;day&quot;, &quot;monthday&quot;, &quot;yearday&quot;,</span>
<a href="#l51.94"></a><span id="l51.94" class="difflineminus">-                              &quot;weekno&quot;, &quot;month&quot;, &quot;setpos&quot;];</span>
<a href="#l51.95"></a><span id="l51.95" class="difflineplus">+        let recurrenceCols = [</span>
<a href="#l51.96"></a><span id="l51.96" class="difflineplus">+            &quot;item_id&quot;, &quot;recur_type&quot;, &quot;dates&quot;, &quot;second&quot;, &quot;minute&quot;, &quot;hour&quot;,</span>
<a href="#l51.97"></a><span id="l51.97" class="difflineplus">+            &quot;day&quot;, &quot;monthday&quot;, &quot;yearday&quot;, &quot;weekno&quot;, &quot;month&quot;, &quot;setpos&quot;</span>
<a href="#l51.98"></a><span id="l51.98" class="difflineplus">+        ];</span>
<a href="#l51.99"></a><span id="l51.99">         alterTypes(tbl, &quot;cal_recurrence&quot;, recurrenceCols, &quot;TEXT&quot;, db);</span>
<a href="#l51.100"></a><span id="l51.100"> </span>
<a href="#l51.101"></a><span id="l51.101">         let propertyCols = [&quot;item_id&quot;, &quot;recurrence_id_tz&quot;, &quot;key&quot;];</span>
<a href="#l51.102"></a><span id="l51.102">         alterTypes(tbl, &quot;cal_properties&quot;, propertyCols, &quot;TEXT&quot;, db);</span>
<a href="#l51.103"></a><span id="l51.103">         setDbVersionAndCommit(db, 6);</span>
<a href="#l51.104"></a><span id="l51.104">     } catch (e) {</span>
<a href="#l51.105"></a><span id="l51.105">         throw reportErrorAndRollback(db, e);</span>
<a href="#l51.106"></a><span id="l51.106">     }</span>
<a href="#l51.107"></a><span id="l51.107" class="difflineat">@@ -1010,19 +1019,18 @@ upgrade.v13 = function(db, version) {</span>
<a href="#l51.108"></a><span id="l51.108">                     while (stmt.executeStep()) {</span>
<a href="#l51.109"></a><span id="l51.109">                         calIds[stmt.row.id] = stmt.row.cal_id;</span>
<a href="#l51.110"></a><span id="l51.110">                     }</span>
<a href="#l51.111"></a><span id="l51.111">                 } finally {</span>
<a href="#l51.112"></a><span id="l51.112">                     stmt.finalize();</span>
<a href="#l51.113"></a><span id="l51.113">                 }</span>
<a href="#l51.114"></a><span id="l51.114">             }</span>
<a href="#l51.115"></a><span id="l51.115">         }</span>
<a href="#l51.116"></a><span id="l51.116" class="difflineminus">-</span>
<a href="#l51.117"></a><span id="l51.117" class="difflineminus">-        for (let tblid of [&quot;attendees&quot;, &quot;recurrence&quot;, &quot;properties&quot;,</span>
<a href="#l51.118"></a><span id="l51.118" class="difflineminus">-                           &quot;attachments&quot;]) {</span>
<a href="#l51.119"></a><span id="l51.119" class="difflineplus">+        let tables = [&quot;attendees&quot;, &quot;recurrence&quot;, &quot;properties&quot;, &quot;attachments&quot;];</span>
<a href="#l51.120"></a><span id="l51.120" class="difflineplus">+        for (let tblid of tables) {</span>
<a href="#l51.121"></a><span id="l51.121">             addColumn(tbl, &quot;cal_&quot; + tblid, &quot;cal_id&quot;, &quot;INTEGER&quot;, db);</span>
<a href="#l51.122"></a><span id="l51.122"> </span>
<a href="#l51.123"></a><span id="l51.123">             for (let itemId in calIds) {</span>
<a href="#l51.124"></a><span id="l51.124">                 executeSimpleSQL(db, &quot;UPDATE cal_&quot; + tblid +</span>
<a href="#l51.125"></a><span id="l51.125">                                      &quot;   SET cal_id = &quot; + calIds[itemId] +</span>
<a href="#l51.126"></a><span id="l51.126">                                      &quot; WHERE item_id = '&quot; + itemId + &quot;'&quot;);</span>
<a href="#l51.127"></a><span id="l51.127">             }</span>
<a href="#l51.128"></a><span id="l51.128">         }</span>
<a href="#l51.129"></a><span id="l51.129" class="difflineat">@@ -1174,20 +1182,22 @@ upgrade.v16 = function(db, version) {</span>
<a href="#l51.130"></a><span id="l51.130">         executeSimpleSQL(db, &quot;UPDATE cal_todos &quot; +</span>
<a href="#l51.131"></a><span id="l51.131">                              &quot;   SET flags = flags | &quot; + CAL_ITEM_FLAG.HAS_ALARMS +</span>
<a href="#l51.132"></a><span id="l51.132">                              &quot; WHERE id IN&quot; +</span>
<a href="#l51.133"></a><span id="l51.133">                              &quot;  (SELECT item_id &quot; +</span>
<a href="#l51.134"></a><span id="l51.134">                              &quot;     FROM cal_alarms &quot; +</span>
<a href="#l51.135"></a><span id="l51.135">                              &quot;     WHERE cal_alarms.cal_id = cal_todos.cal_id)&quot;);</span>
<a href="#l51.136"></a><span id="l51.136"> </span>
<a href="#l51.137"></a><span id="l51.137">         // Remote obsolete columns</span>
<a href="#l51.138"></a><span id="l51.138" class="difflineminus">-        let cols = [&quot;alarm_time&quot;,</span>
<a href="#l51.139"></a><span id="l51.139" class="difflineminus">-                    &quot;alarm_time_tz&quot;,</span>
<a href="#l51.140"></a><span id="l51.140" class="difflineminus">-                    &quot;alarm_offset&quot;,</span>
<a href="#l51.141"></a><span id="l51.141" class="difflineminus">-                    &quot;alarm_related&quot;];</span>
<a href="#l51.142"></a><span id="l51.142" class="difflineplus">+        let cols = [</span>
<a href="#l51.143"></a><span id="l51.143" class="difflineplus">+            &quot;alarm_time&quot;,</span>
<a href="#l51.144"></a><span id="l51.144" class="difflineplus">+            &quot;alarm_time_tz&quot;,</span>
<a href="#l51.145"></a><span id="l51.145" class="difflineplus">+            &quot;alarm_offset&quot;,</span>
<a href="#l51.146"></a><span id="l51.146" class="difflineplus">+            &quot;alarm_related&quot;</span>
<a href="#l51.147"></a><span id="l51.147" class="difflineplus">+        ];</span>
<a href="#l51.148"></a><span id="l51.148">         for (let tblid of [&quot;events&quot;, &quot;todos&quot;]) {</span>
<a href="#l51.149"></a><span id="l51.149">             deleteColumns(tbl, &quot;cal_&quot; + tblid, cols, db);</span>
<a href="#l51.150"></a><span id="l51.150">         }</span>
<a href="#l51.151"></a><span id="l51.151"> </span>
<a href="#l51.152"></a><span id="l51.152">         setDbVersionAndCommit(db, 16);</span>
<a href="#l51.153"></a><span id="l51.153">     } catch (e) {</span>
<a href="#l51.154"></a><span id="l51.154">         throw reportErrorAndRollback(db, e);</span>
<a href="#l51.155"></a><span id="l51.155">     }</span>
<a href="#l51.156"></a><span id="l51.156" class="difflineat">@@ -1314,22 +1324,23 @@ upgrade.v18 = function(db, version) {</span>
<a href="#l51.157"></a><span id="l51.157">  * events to be shown for multiple cached calendars</span>
<a href="#l51.158"></a><span id="l51.158">  * r=simon.at.orcl, p=philipp,dbo</span>
<a href="#l51.159"></a><span id="l51.159">  */</span>
<a href="#l51.160"></a><span id="l51.160"> upgrade.v19 = function(db, version) {</span>
<a href="#l51.161"></a><span id="l51.161">     let tbl = upgrade.v18(version &lt; 18 &amp;&amp; db, version);</span>
<a href="#l51.162"></a><span id="l51.162">     LOGdb(db, &quot;Storage: Upgrading to v19&quot;);</span>
<a href="#l51.163"></a><span id="l51.163">     beginTransaction(db);</span>
<a href="#l51.164"></a><span id="l51.164">     try {</span>
<a href="#l51.165"></a><span id="l51.165" class="difflineplus">+        let tables = [</span>
<a href="#l51.166"></a><span id="l51.166" class="difflineplus">+            &quot;cal_alarms&quot;, &quot;cal_attachments&quot;, &quot;cal_attendees&quot;, &quot;cal_events&quot;,</span>
<a href="#l51.167"></a><span id="l51.167" class="difflineplus">+            &quot;cal_metadata&quot;, &quot;cal_properties&quot;, &quot;cal_recurrence&quot;,</span>
<a href="#l51.168"></a><span id="l51.168" class="difflineplus">+            &quot;cal_relations&quot;, &quot;cal_todos&quot;</span>
<a href="#l51.169"></a><span id="l51.169" class="difflineplus">+        ];</span>
<a href="#l51.170"></a><span id="l51.170">         // Change types of column to TEXT.</span>
<a href="#l51.171"></a><span id="l51.171" class="difflineminus">-        for (let tblName of [&quot;cal_alarms&quot;, &quot;cal_attachments&quot;,</span>
<a href="#l51.172"></a><span id="l51.172" class="difflineminus">-                             &quot;cal_attendees&quot;, &quot;cal_events&quot;,</span>
<a href="#l51.173"></a><span id="l51.173" class="difflineminus">-                             &quot;cal_metadata&quot;, &quot;cal_properties&quot;,</span>
<a href="#l51.174"></a><span id="l51.174" class="difflineminus">-                             &quot;cal_recurrence&quot;, &quot;cal_relations&quot;,</span>
<a href="#l51.175"></a><span id="l51.175" class="difflineminus">-                             &quot;cal_todos&quot;]) {</span>
<a href="#l51.176"></a><span id="l51.176" class="difflineplus">+        for (let tblName of tables) {</span>
<a href="#l51.177"></a><span id="l51.177">             alterTypes(tbl, tblName, [&quot;cal_id&quot;], &quot;TEXT&quot;, db);</span>
<a href="#l51.178"></a><span id="l51.178">         }</span>
<a href="#l51.179"></a><span id="l51.179">         setDbVersionAndCommit(db, 19);</span>
<a href="#l51.180"></a><span id="l51.180">     } catch (e) {</span>
<a href="#l51.181"></a><span id="l51.181">         throw reportErrorAndRollback(db, e);</span>
<a href="#l51.182"></a><span id="l51.182">     }</span>
<a href="#l51.183"></a><span id="l51.183"> </span>
<a href="#l51.184"></a><span id="l51.184">     return tbl;</span>
<a href="#l51.185"></a><span id="l51.185" class="difflineat">@@ -1512,19 +1523,20 @@ upgrade.v22 = function(db, version) {</span>
<a href="#l51.186"></a><span id="l51.186">                 } catch (e) {</span>
<a href="#l51.187"></a><span id="l51.187">                     // There are some attendees with a null ID. We are taking</span>
<a href="#l51.188"></a><span id="l51.188">                     // the opportunity to remove them here.</span>
<a href="#l51.189"></a><span id="l51.189">                     cal.ERROR(&quot;Error converting attendee, removing: &quot; + e);</span>
<a href="#l51.190"></a><span id="l51.190">                     return null;</span>
<a href="#l51.191"></a><span id="l51.191">                 }</span>
<a href="#l51.192"></a><span id="l51.192">             }</span>
<a href="#l51.193"></a><span id="l51.193">         });</span>
<a href="#l51.194"></a><span id="l51.194" class="difflineminus">-        migrateToIcalString(tbl, &quot;cal_attendees&quot;, &quot;translateAttendee&quot;,</span>
<a href="#l51.195"></a><span id="l51.195" class="difflineminus">-                            [&quot;attendee_id&quot;, &quot;common_name&quot;, &quot;rsvp&quot;, &quot;role&quot;,</span>
<a href="#l51.196"></a><span id="l51.196" class="difflineminus">-                             &quot;status&quot;, &quot;type&quot;, &quot;is_organizer&quot;, &quot;properties&quot;], db);</span>
<a href="#l51.197"></a><span id="l51.197" class="difflineplus">+        migrateToIcalString(tbl, &quot;cal_attendees&quot;, &quot;translateAttendee&quot;, [</span>
<a href="#l51.198"></a><span id="l51.198" class="difflineplus">+            &quot;attendee_id&quot;, &quot;common_name&quot;, &quot;rsvp&quot;, &quot;role&quot;, &quot;status&quot;, &quot;type&quot;,</span>
<a href="#l51.199"></a><span id="l51.199" class="difflineplus">+            &quot;is_organizer&quot;, &quot;properties&quot;</span>
<a href="#l51.200"></a><span id="l51.200" class="difflineplus">+        ], db);</span>
<a href="#l51.201"></a><span id="l51.201"> </span>
<a href="#l51.202"></a><span id="l51.202">         // Update recurrence table to using icalString directly</span>
<a href="#l51.203"></a><span id="l51.203">         createFunction(db, &quot;translateRecurrence&quot;, 17, {</span>
<a href="#l51.204"></a><span id="l51.204">             onFunctionCall: function(storArgs) {</span>
<a href="#l51.205"></a><span id="l51.205">                 function parseInt10(x) { return parseInt(x, 10); }</span>
<a href="#l51.206"></a><span id="l51.206">                 try {</span>
<a href="#l51.207"></a><span id="l51.207">                     // eslint-disable-next-line no-unused-vars</span>
<a href="#l51.208"></a><span id="l51.208">                     let [aIndex, aType, aIsNegative, aDates, aCount,</span>
<a href="#l51.209"></a><span id="l51.209" class="difflineat">@@ -1605,20 +1617,20 @@ upgrade.v22 = function(db, version) {</span>
<a href="#l51.210"></a><span id="l51.210">                                  &quot;WHERE e.id = cal_recurrence.item_id &quot; +</span>
<a href="#l51.211"></a><span id="l51.211">                                    &quot;AND e.cal_id = cal_recurrence.cal_id &quot; +</span>
<a href="#l51.212"></a><span id="l51.212">                                  &quot;UNION &quot; +</span>
<a href="#l51.213"></a><span id="l51.213">                                 &quot;SELECT t.flags &quot; +</span>
<a href="#l51.214"></a><span id="l51.214">                                   &quot;FROM cal_todos AS t &quot; +</span>
<a href="#l51.215"></a><span id="l51.215">                                  &quot;WHERE t.id = cal_recurrence.item_id &quot; +</span>
<a href="#l51.216"></a><span id="l51.216">                                    &quot;AND t.cal_id = cal_recurrence.cal_id)&quot;);</span>
<a href="#l51.217"></a><span id="l51.217"> </span>
<a href="#l51.218"></a><span id="l51.218" class="difflineminus">-        migrateToIcalString(tbl, &quot;cal_recurrence&quot;, &quot;translateRecurrence&quot;,</span>
<a href="#l51.219"></a><span id="l51.219" class="difflineminus">-                            [&quot;recur_index&quot;, &quot;recur_type&quot;, &quot;is_negative&quot;,</span>
<a href="#l51.220"></a><span id="l51.220" class="difflineminus">-                             &quot;dates&quot;, &quot;count&quot;, &quot;end_date&quot;, &quot;interval&quot;, &quot;second&quot;,</span>
<a href="#l51.221"></a><span id="l51.221" class="difflineminus">-                             &quot;minute&quot;, &quot;hour&quot;, &quot;day&quot;, &quot;monthday&quot;, &quot;yearday&quot;,</span>
<a href="#l51.222"></a><span id="l51.222" class="difflineminus">-                             &quot;weekno&quot;, &quot;month&quot;, &quot;setpos&quot;, &quot;tmp_date_tz&quot;], db);</span>
<a href="#l51.223"></a><span id="l51.223" class="difflineplus">+        migrateToIcalString(tbl, &quot;cal_recurrence&quot;, &quot;translateRecurrence&quot;, [</span>
<a href="#l51.224"></a><span id="l51.224" class="difflineplus">+            &quot;recur_index&quot;, &quot;recur_type&quot;, &quot;is_negative&quot;, &quot;dates&quot;, &quot;count&quot;,</span>
<a href="#l51.225"></a><span id="l51.225" class="difflineplus">+            &quot;end_date&quot;, &quot;interval&quot;, &quot;second&quot;, &quot;minute&quot;, &quot;hour&quot;, &quot;day&quot;,</span>
<a href="#l51.226"></a><span id="l51.226" class="difflineplus">+            &quot;monthday&quot;, &quot;yearday&quot;, &quot;weekno&quot;, &quot;month&quot;, &quot;setpos&quot;, &quot;tmp_date_tz&quot;</span>
<a href="#l51.227"></a><span id="l51.227" class="difflineplus">+        ], db);</span>
<a href="#l51.228"></a><span id="l51.228"> </span>
<a href="#l51.229"></a><span id="l51.229">         setDbVersionAndCommit(db, 22);</span>
<a href="#l51.230"></a><span id="l51.230">     } catch (e) {</span>
<a href="#l51.231"></a><span id="l51.231">         throw reportErrorAndRollback(db, e);</span>
<a href="#l51.232"></a><span id="l51.232">     }</span>
<a href="#l51.233"></a><span id="l51.233">     return tbl;</span>
<a href="#l51.234"></a><span id="l51.234"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -834,17 +834,17 @@ calWcapSession.prototype = {</span>
<a href="#l52.4"></a><span id="l52.4">         return alarmStart;</span>
<a href="#l52.5"></a><span id="l52.5">     },</span>
<a href="#l52.6"></a><span id="l52.6"> </span>
<a href="#l52.7"></a><span id="l52.7">     getDefaultAlarmEmails: function(out_count) {</span>
<a href="#l52.8"></a><span id="l52.8">         let ret = [];</span>
<a href="#l52.9"></a><span id="l52.9">         let alarmEmails = this.getUserPreferences(&quot;X-NSCP-WCAP-PREF-ceDefaultAlarmEmail&quot;);</span>
<a href="#l52.10"></a><span id="l52.10">         if (alarmEmails.length &gt; 0 &amp;&amp; alarmEmails[0].length &gt; 0) {</span>
<a href="#l52.11"></a><span id="l52.11">             for (let email of alarmEmails) {</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-                ret = ret.concat(email.split(/[;,]/).map(email =&gt; email.trim()));</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+                ret = ret.concat(email.split(/[;,]/).map(mail =&gt; mail.trim()));</span>
<a href="#l52.14"></a><span id="l52.14">             }</span>
<a href="#l52.15"></a><span id="l52.15">         }</span>
<a href="#l52.16"></a><span id="l52.16">         out_count.value = ret.length;</span>
<a href="#l52.17"></a><span id="l52.17">         return ret;</span>
<a href="#l52.18"></a><span id="l52.18">     },</span>
<a href="#l52.19"></a><span id="l52.19"> </span>
<a href="#l52.20"></a><span id="l52.20">     // calICalendarSearchProvider:</span>
<a href="#l52.21"></a><span id="l52.21">     searchForCalendars: function(searchString, hints, maxResults, listener) {</span>
<a href="#l52.22"></a><span id="l52.22" class="difflineat">@@ -1037,29 +1037,31 @@ calWcapSession.prototype = {</span>
<a href="#l52.23"></a><span id="l52.23">         }</span>
<a href="#l52.24"></a><span id="l52.24"> </span>
<a href="#l52.25"></a><span id="l52.25">         try {</span>
<a href="#l52.26"></a><span id="l52.26">             // make sure the calendar belongs to this session:</span>
<a href="#l52.27"></a><span id="l52.27">             if (this.belongsTo(aCalendar)) {</span>
<a href="#l52.28"></a><span id="l52.28">                 assureDefault(&quot;shared_context&quot;, this.m_contextId);</span>
<a href="#l52.29"></a><span id="l52.29">                 assureDefault(&quot;name&quot;, aCalendar.name);</span>
<a href="#l52.30"></a><span id="l52.30"> </span>
<a href="#l52.31"></a><span id="l52.31" class="difflineminus">-                const s_colors = [&quot;#FFCCCC&quot;, &quot;#FFCC99&quot;, &quot;#FFFF99&quot;, &quot;#FFFFCC&quot;, &quot;#99FF99&quot;,</span>
<a href="#l52.32"></a><span id="l52.32" class="difflineminus">-                                  &quot;#99FFFF&quot;, &quot;#CCFFFF&quot;, &quot;#CCCCFF&quot;, &quot;#FFCCFF&quot;, &quot;#FF6666&quot;,</span>
<a href="#l52.33"></a><span id="l52.33" class="difflineminus">-                                  &quot;#FF9966&quot;, &quot;#FFFF66&quot;, &quot;#FFFF33&quot;, &quot;#66FF99&quot;, &quot;#33FFFF&quot;,</span>
<a href="#l52.34"></a><span id="l52.34" class="difflineminus">-                                  &quot;#66FFFF&quot;, &quot;#9999FF&quot;, &quot;#FF99FF&quot;, &quot;#FF0000&quot;, &quot;#FF9900&quot;,</span>
<a href="#l52.35"></a><span id="l52.35" class="difflineminus">-                                  &quot;#FFCC66&quot;, &quot;#FFFF00&quot;, &quot;#33FF33&quot;, &quot;#66CCCC&quot;, &quot;#33CCFF&quot;,</span>
<a href="#l52.36"></a><span id="l52.36" class="difflineminus">-                                  &quot;#6666CC&quot;, &quot;#CC66CC&quot;, &quot;#CC0000&quot;, &quot;#FF6600&quot;, &quot;#FFCC33&quot;,</span>
<a href="#l52.37"></a><span id="l52.37" class="difflineminus">-                                  &quot;#FFCC00&quot;, &quot;#33CC00&quot;, &quot;#00CCCC&quot;, &quot;#3366FF&quot;, &quot;#6633FF&quot;,</span>
<a href="#l52.38"></a><span id="l52.38" class="difflineminus">-                                  &quot;#CC33CC&quot;, &quot;#990000&quot;, &quot;#CC6600&quot;, &quot;#CC9933&quot;, &quot;#999900&quot;,</span>
<a href="#l52.39"></a><span id="l52.39" class="difflineminus">-                                  &quot;#009900&quot;, &quot;#339999&quot;, &quot;#3333FF&quot;, &quot;#6600CC&quot;, &quot;#993399&quot;,</span>
<a href="#l52.40"></a><span id="l52.40" class="difflineminus">-                                  &quot;#660000&quot;, &quot;#993300&quot;, &quot;#996633&quot;, &quot;#666600&quot;, &quot;#006600&quot;,</span>
<a href="#l52.41"></a><span id="l52.41" class="difflineminus">-                                  &quot;#336666&quot;, &quot;#000099&quot;, &quot;#333399&quot;, &quot;#663366&quot;, &quot;#330000&quot;,</span>
<a href="#l52.42"></a><span id="l52.42" class="difflineminus">-                                  &quot;#663300&quot;, &quot;#663333&quot;, &quot;#333300&quot;, &quot;#003300&quot;, &quot;#003333&quot;,</span>
<a href="#l52.43"></a><span id="l52.43" class="difflineminus">-                                  &quot;#000066&quot;, &quot;#330099&quot;, &quot;#330033&quot;];</span>
<a href="#l52.44"></a><span id="l52.44" class="difflineplus">+                const s_colors = [</span>
<a href="#l52.45"></a><span id="l52.45" class="difflineplus">+                    &quot;#FFCCCC&quot;, &quot;#FFCC99&quot;, &quot;#FFFF99&quot;, &quot;#FFFFCC&quot;, &quot;#99FF99&quot;,</span>
<a href="#l52.46"></a><span id="l52.46" class="difflineplus">+                    &quot;#99FFFF&quot;, &quot;#CCFFFF&quot;, &quot;#CCCCFF&quot;, &quot;#FFCCFF&quot;, &quot;#FF6666&quot;,</span>
<a href="#l52.47"></a><span id="l52.47" class="difflineplus">+                    &quot;#FF9966&quot;, &quot;#FFFF66&quot;, &quot;#FFFF33&quot;, &quot;#66FF99&quot;, &quot;#33FFFF&quot;,</span>
<a href="#l52.48"></a><span id="l52.48" class="difflineplus">+                    &quot;#66FFFF&quot;, &quot;#9999FF&quot;, &quot;#FF99FF&quot;, &quot;#FF0000&quot;, &quot;#FF9900&quot;,</span>
<a href="#l52.49"></a><span id="l52.49" class="difflineplus">+                    &quot;#FFCC66&quot;, &quot;#FFFF00&quot;, &quot;#33FF33&quot;, &quot;#66CCCC&quot;, &quot;#33CCFF&quot;,</span>
<a href="#l52.50"></a><span id="l52.50" class="difflineplus">+                    &quot;#6666CC&quot;, &quot;#CC66CC&quot;, &quot;#CC0000&quot;, &quot;#FF6600&quot;, &quot;#FFCC33&quot;,</span>
<a href="#l52.51"></a><span id="l52.51" class="difflineplus">+                    &quot;#FFCC00&quot;, &quot;#33CC00&quot;, &quot;#00CCCC&quot;, &quot;#3366FF&quot;, &quot;#6633FF&quot;,</span>
<a href="#l52.52"></a><span id="l52.52" class="difflineplus">+                    &quot;#CC33CC&quot;, &quot;#990000&quot;, &quot;#CC6600&quot;, &quot;#CC9933&quot;, &quot;#999900&quot;,</span>
<a href="#l52.53"></a><span id="l52.53" class="difflineplus">+                    &quot;#009900&quot;, &quot;#339999&quot;, &quot;#3333FF&quot;, &quot;#6600CC&quot;, &quot;#993399&quot;,</span>
<a href="#l52.54"></a><span id="l52.54" class="difflineplus">+                    &quot;#660000&quot;, &quot;#993300&quot;, &quot;#996633&quot;, &quot;#666600&quot;, &quot;#006600&quot;,</span>
<a href="#l52.55"></a><span id="l52.55" class="difflineplus">+                    &quot;#336666&quot;, &quot;#000099&quot;, &quot;#333399&quot;, &quot;#663366&quot;, &quot;#330000&quot;,</span>
<a href="#l52.56"></a><span id="l52.56" class="difflineplus">+                    &quot;#663300&quot;, &quot;#663333&quot;, &quot;#333300&quot;, &quot;#003300&quot;, &quot;#003333&quot;,</span>
<a href="#l52.57"></a><span id="l52.57" class="difflineplus">+                    &quot;#000066&quot;, &quot;#330099&quot;, &quot;#330033&quot;</span>
<a href="#l52.58"></a><span id="l52.58" class="difflineplus">+                ];</span>
<a href="#l52.59"></a><span id="l52.59">                 assureDefault(&quot;color&quot;, s_colors[(new Date()).getUTCMilliseconds() % s_colors.length]);</span>
<a href="#l52.60"></a><span id="l52.60">             }</span>
<a href="#l52.61"></a><span id="l52.61">         } catch (exc) { // never break the listener chain</span>
<a href="#l52.62"></a><span id="l52.62">             this.notifyError(exc);</span>
<a href="#l52.63"></a><span id="l52.63">         }</span>
<a href="#l52.64"></a><span id="l52.64">     },</span>
<a href="#l52.65"></a><span id="l52.65"> </span>
<a href="#l52.66"></a><span id="l52.66">     // called before the unregister actually takes place</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -119,17 +119,16 @@</span>
<a href="#l53.4"></a><span id="l53.4">               } catch (ex) {</span>
<a href="#l53.5"></a><span id="l53.5">                   // Don't fail if date formatting fails.</span>
<a href="#l53.6"></a><span id="l53.6">               }</span>
<a href="#l53.7"></a><span id="l53.7">           }</span>
<a href="#l53.8"></a><span id="l53.8">           if (date &amp;&amp; prettyDate) {</span>
<a href="#l53.9"></a><span id="l53.9">               this.mValue = date;</span>
<a href="#l53.10"></a><span id="l53.10">               text.value = prettyDate;</span>
<a href="#l53.11"></a><span id="l53.11">               this.fireEvent(&quot;command&quot;, date);</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-              return;</span>
<a href="#l53.13"></a><span id="l53.13">           }</span>
<a href="#l53.14"></a><span id="l53.14">         ]]&gt;&lt;/body&gt;</span>
<a href="#l53.15"></a><span id="l53.15">       &lt;/method&gt;</span>
<a href="#l53.16"></a><span id="l53.16"> </span>
<a href="#l53.17"></a><span id="l53.17">       &lt;!-- This function will take written (with words) dates and, if</span>
<a href="#l53.18"></a><span id="l53.18">          - possible, return a Date() object described by the words.  Note</span>
<a href="#l53.19"></a><span id="l53.19">          - that this function will not parse explicit dates, like 1/1/06,</span>
<a href="#l53.20"></a><span id="l53.20">          - you should use parseDateTime for that.</span>
<a href="#l53.21"></a><span id="l53.21" class="difflineat">@@ -279,21 +278,21 @@</span>
<a href="#l53.22"></a><span id="l53.22">         } else {</span>
<a href="#l53.23"></a><span id="l53.23">             this.value = new Date();</span>
<a href="#l53.24"></a><span id="l53.24">         }</span>
<a href="#l53.25"></a><span id="l53.25"> </span>
<a href="#l53.26"></a><span id="l53.26">         this.kTextBox.kDatePicker = this; // enable call back to method in Moz1.7</span>
<a href="#l53.27"></a><span id="l53.27">         this.kTextBox.firstChild.kDatePicker = this;</span>
<a href="#l53.28"></a><span id="l53.28">         this.kMinimonth = this.kTextBox.firstChild.firstChild;</span>
<a href="#l53.29"></a><span id="l53.29">         this.mInPopup = false;</span>
<a href="#l53.30"></a><span id="l53.30" class="difflineminus">-        this.kMinimonth.addEventListener(&quot;select&quot;, this.clickDate, false);</span>
<a href="#l53.31"></a><span id="l53.31" class="difflineplus">+        this.kMinimonth.addEventListener(&quot;select&quot;, this.clickDate);</span>
<a href="#l53.32"></a><span id="l53.32">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l53.33"></a><span id="l53.33"> </span>
<a href="#l53.34"></a><span id="l53.34">       &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l53.35"></a><span id="l53.35" class="difflineminus">-          this.kMinimonth.removeEventListener(&quot;select&quot;, this.clickDate, false);</span>
<a href="#l53.36"></a><span id="l53.36" class="difflineplus">+          this.kMinimonth.removeEventListener(&quot;select&quot;, this.clickDate);</span>
<a href="#l53.37"></a><span id="l53.37">       ]]&gt;&lt;/destructor&gt;</span>
<a href="#l53.38"></a><span id="l53.38"> </span>
<a href="#l53.39"></a><span id="l53.39">       &lt;!-- This property will be overlayed in some extended binding --&gt;</span>
<a href="#l53.40"></a><span id="l53.40">       &lt;property name=&quot;valueValid&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l53.41"></a><span id="l53.41">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l53.42"></a><span id="l53.42">             return (this.mValue != null);</span>
<a href="#l53.43"></a><span id="l53.43">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l53.44"></a><span id="l53.44">       &lt;/property&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/calendar/resources/content/publish.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/calendar/resources/content/publish.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -73,18 +73,16 @@ function publishEntireCalendar(aCalendar</span>
<a href="#l54.4"></a><span id="l54.4">     let remotePath = aCalendar.getProperty(&quot;remote-ics-path&quot;);</span>
<a href="#l54.5"></a><span id="l54.5">     if (remotePath &amp;&amp; remotePath.length &amp;&amp; remotePath.length &gt; 0) {</span>
<a href="#l54.6"></a><span id="l54.6">         publishObject.remotePath = remotePath;</span>
<a href="#l54.7"></a><span id="l54.7">     }</span>
<a href="#l54.8"></a><span id="l54.8"> </span>
<a href="#l54.9"></a><span id="l54.9">     args.publishObject = publishObject;</span>
<a href="#l54.10"></a><span id="l54.10">     openDialog(&quot;chrome://calendar/content/publishDialog.xul&quot;, &quot;caPublishEvents&quot;,</span>
<a href="#l54.11"></a><span id="l54.11">                &quot;chrome,titlebar,modal,resizable&quot;, args);</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineminus">-    return;</span>
<a href="#l54.14"></a><span id="l54.14"> }</span>
<a href="#l54.15"></a><span id="l54.15"> </span>
<a href="#l54.16"></a><span id="l54.16"> /**</span>
<a href="#l54.17"></a><span id="l54.17">  * publishEntireCalendarDialogResponse</span>
<a href="#l54.18"></a><span id="l54.18">  * Callback method for publishEntireCalendar() that is called when the user</span>
<a href="#l54.19"></a><span id="l54.19">  * presses the OK button in the publish dialog.</span>
<a href="#l54.20"></a><span id="l54.20">  */</span>
<a href="#l54.21"></a><span id="l54.21"> function publishEntireCalendarDialogResponse(CalendarPublishObject, aProgressDialog) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/calendar/test/mozmill/.eslintrc.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/calendar/test/mozmill/.eslintrc.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -10,12 +10,12 @@ module.exports = {</span>
<a href="#l55.4"></a><span id="l55.4">         exports: true,</span>
<a href="#l55.5"></a><span id="l55.5">         module: true</span>
<a href="#l55.6"></a><span id="l55.6">     },</span>
<a href="#l55.7"></a><span id="l55.7">     rules: {</span>
<a href="#l55.8"></a><span id="l55.8">         // Allow mozmill test methods to be used without warning</span>
<a href="#l55.9"></a><span id="l55.9">         &quot;no-unused-vars&quot;: [2, {</span>
<a href="#l55.10"></a><span id="l55.10">             vars: &quot;all&quot;,</span>
<a href="#l55.11"></a><span id="l55.11">             args: &quot;none&quot;,</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-            varsIgnorePattern: &quot;(MODULE_NAME|MODULE_REQUIRES|RELATIVE_ROOT|setupModule|installInto|teardownTest|^test[A-Z].*)&quot;</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+            varsIgnorePattern: &quot;(MODULE_NAME|MODULE_REQUIRES|RELATIVE_ROOT|setupModule|installInto|teardownTest|^test[A-Z_].*)&quot;</span>
<a href="#l55.14"></a><span id="l55.14">         }]</span>
<a href="#l55.15"></a><span id="l55.15">     }</span>
<a href="#l55.16"></a><span id="l55.16"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -169,17 +169,17 @@ function testEventDialog() {</span>
<a href="#l56.4"></a><span id="l56.4">         event.click(eventid(&quot;button-attendees&quot;));</span>
<a href="#l56.5"></a><span id="l56.5">         wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l56.6"></a><span id="l56.6">         event.assertValue(eventid(&quot;attendee-list&quot;), eventAttendee);</span>
<a href="#l56.7"></a><span id="l56.7"> </span>
<a href="#l56.8"></a><span id="l56.8">         // make it private and verify label visible</span>
<a href="#l56.9"></a><span id="l56.9">         event.click(eventid(&quot;button-privacy&quot;));</span>
<a href="#l56.10"></a><span id="l56.10">         event.click(eventid(&quot;event-privacy-private-menuitem&quot;));</span>
<a href="#l56.11"></a><span id="l56.11">         let label = eventid(&quot;status-privacy-private-box&quot;);</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-        event.assertJS(event.window.getComputedStyle(label.getNode(), null).getPropertyValue(&quot;visibility&quot;) == &quot;visible&quot;);</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+        event.assertJS(event.window.getComputedStyle(label.getNode()).getPropertyValue(&quot;visibility&quot;) == &quot;visible&quot;);</span>
<a href="#l56.14"></a><span id="l56.14"> </span>
<a href="#l56.15"></a><span id="l56.15">         // add attachment and verify added</span>
<a href="#l56.16"></a><span id="l56.16">         handleAddingAttachment(event, eventUrl);</span>
<a href="#l56.17"></a><span id="l56.17">         event.click(eventid(&quot;button-url&quot;));</span>
<a href="#l56.18"></a><span id="l56.18">         event.assertNode(eventlookup(`</span>
<a href="#l56.19"></a><span id="l56.19">             ${eventDialog}/id(&quot;event-grid-attachment-row&quot;)/</span>
<a href="#l56.20"></a><span id="l56.20">             id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;mozilla.org&quot;}</span>
<a href="#l56.21"></a><span id="l56.21">         `));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/calendar/test/mozmill/invitations/test-imip-bar-eml.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/calendar/test/mozmill/invitations/test-imip-bar-eml.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -13,17 +13,17 @@ var MODULE_NAME = &quot;invitations&quot;;</span>
<a href="#l57.4"></a><span id="l57.4"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l57.5"></a><span id="l57.5"> var MODULE_REQUIRES = [</span>
<a href="#l57.6"></a><span id="l57.6">     &quot;folder-display-helpers&quot;,</span>
<a href="#l57.7"></a><span id="l57.7">     &quot;window-helpers&quot;,</span>
<a href="#l57.8"></a><span id="l57.8">     &quot;notificationbox-helpers&quot;</span>
<a href="#l57.9"></a><span id="l57.9"> ];</span>
<a href="#l57.10"></a><span id="l57.10"> </span>
<a href="#l57.11"></a><span id="l57.11"> var os = {};</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-Components.utils.import('resource://mozmill/stdlib/os.js', os);</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+Components.utils.import(&quot;resource://mozmill/stdlib/os.js&quot;, os);</span>
<a href="#l57.14"></a><span id="l57.14"> </span>
<a href="#l57.15"></a><span id="l57.15"> function setupModule(module) {</span>
<a href="#l57.16"></a><span id="l57.16">     for (let dep of MODULE_REQUIRES) {</span>
<a href="#l57.17"></a><span id="l57.17">         collector.getModule(dep).installInto(module);</span>
<a href="#l57.18"></a><span id="l57.18">     }</span>
<a href="#l57.19"></a><span id="l57.19"> }</span>
<a href="#l57.20"></a><span id="l57.20"> </span>
<a href="#l57.21"></a><span id="l57.21"> /**</span>
<a href="#l57.22"></a><span id="l57.22" class="difflineat">@@ -31,18 +31,17 @@ function setupModule(module) {</span>
<a href="#l57.23"></a><span id="l57.23">  */</span>
<a href="#l57.24"></a><span id="l57.24"> function test_event_from_eml() {</span>
<a href="#l57.25"></a><span id="l57.25">     let thisFilePath = os.getFileForPath(__file__);</span>
<a href="#l57.26"></a><span id="l57.26">     let file = os.getFileForPath(os.abspath(&quot;./message-containing-event.eml&quot;, thisFilePath));</span>
<a href="#l57.27"></a><span id="l57.27"> </span>
<a href="#l57.28"></a><span id="l57.28">     let msgc = open_message_from_file(file);</span>
<a href="#l57.29"></a><span id="l57.29"> </span>
<a href="#l57.30"></a><span id="l57.30">     msgc.waitFor(() =&gt; {</span>
<a href="#l57.31"></a><span id="l57.31" class="difflineminus">-        let nb = msgc.window.document.getElementById(&quot;imip-bar&quot;);</span>
<a href="#l57.32"></a><span id="l57.32" class="difflineminus">-        if (!nb) {</span>
<a href="#l57.33"></a><span id="l57.33" class="difflineplus">+        let bar = msgc.window.document.getElementById(&quot;imip-bar&quot;);</span>
<a href="#l57.34"></a><span id="l57.34" class="difflineplus">+        if (!bar) {</span>
<a href="#l57.35"></a><span id="l57.35">             throw new Error(&quot;Couldn't find imip-bar in DOM.&quot;);</span>
<a href="#l57.36"></a><span id="l57.36">         }</span>
<a href="#l57.37"></a><span id="l57.37" class="difflineminus">-        return (nb.collapsed === false);</span>
<a href="#l57.38"></a><span id="l57.38" class="difflineplus">+        return (bar.collapsed === false);</span>
<a href="#l57.39"></a><span id="l57.39">     }, &quot;Timed out waiting for IMIP bar to show&quot;);</span>
<a href="#l57.40"></a><span id="l57.40"> </span>
<a href="#l57.41"></a><span id="l57.41">     close_window(msgc);</span>
<a href="#l57.42"></a><span id="l57.42"> }</span>
<a href="#l57.43"></a><span id="l57.43" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -430,18 +430,18 @@ function viewBack(controller, n) {</span>
<a href="#l58.4"></a><span id="l58.4">  * Deletes all calendars with given name</span>
<a href="#l58.5"></a><span id="l58.5">  *</span>
<a href="#l58.6"></a><span id="l58.6">  * @param controller    Mozmill window controller</span>
<a href="#l58.7"></a><span id="l58.7">  * @param name          calendar name</span>
<a href="#l58.8"></a><span id="l58.8">  */</span>
<a href="#l58.9"></a><span id="l58.9"> function deleteCalendars(controller, name) {</span>
<a href="#l58.10"></a><span id="l58.10">     let { eid } = helpersForController(controller);</span>
<a href="#l58.11"></a><span id="l58.11"> </span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-    let defaultView = eid(&quot;messengerWindow&quot;).getNode().ownerDocument.defaultView;</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineminus">-    let manager = defaultView.cal.getCalendarManager();</span>
<a href="#l58.14"></a><span id="l58.14" class="difflineplus">+    let win = eid(&quot;messengerWindow&quot;).getNode().ownerGlobal;</span>
<a href="#l58.15"></a><span id="l58.15" class="difflineplus">+    let manager = win.cal.getCalendarManager();</span>
<a href="#l58.16"></a><span id="l58.16"> </span>
<a href="#l58.17"></a><span id="l58.17">     for (let calendar of manager.getCalendars({})) {</span>
<a href="#l58.18"></a><span id="l58.18">         if (calendar.name == name) {</span>
<a href="#l58.19"></a><span id="l58.19">             manager.removeCalendar(calendar);</span>
<a href="#l58.20"></a><span id="l58.20">         }</span>
<a href="#l58.21"></a><span id="l58.21">     }</span>
<a href="#l58.22"></a><span id="l58.22"> }</span>
<a href="#l58.23"></a><span id="l58.23"> </span>
<a href="#l58.24"></a><span id="l58.24" class="difflineat">@@ -449,18 +449,18 @@ function deleteCalendars(controller, nam</span>
<a href="#l58.25"></a><span id="l58.25">  * Creates local calendar with given name and select it in calendars list</span>
<a href="#l58.26"></a><span id="l58.26">  *</span>
<a href="#l58.27"></a><span id="l58.27">  * @param controller    Mozmill window controller</span>
<a href="#l58.28"></a><span id="l58.28">  * @param name          calendar name</span>
<a href="#l58.29"></a><span id="l58.29">  */</span>
<a href="#l58.30"></a><span id="l58.30"> function createCalendar(controller, name) {</span>
<a href="#l58.31"></a><span id="l58.31">     let { lookup, eid } = helpersForController(controller);</span>
<a href="#l58.32"></a><span id="l58.32"> </span>
<a href="#l58.33"></a><span id="l58.33" class="difflineminus">-    let defaultView = eid(&quot;messengerWindow&quot;).getNode().ownerDocument.defaultView;</span>
<a href="#l58.34"></a><span id="l58.34" class="difflineminus">-    let manager = defaultView.cal.getCalendarManager();</span>
<a href="#l58.35"></a><span id="l58.35" class="difflineplus">+    let win = eid(&quot;messengerWindow&quot;).getNode().ownerGlobal;</span>
<a href="#l58.36"></a><span id="l58.36" class="difflineplus">+    let manager = win.cal.getCalendarManager();</span>
<a href="#l58.37"></a><span id="l58.37"> </span>
<a href="#l58.38"></a><span id="l58.38">     let url = Services.io.newURI(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l58.39"></a><span id="l58.39">     let calendar = manager.createCalendar(&quot;storage&quot;, url);</span>
<a href="#l58.40"></a><span id="l58.40">     calendar.name = name;</span>
<a href="#l58.41"></a><span id="l58.41">     manager.registerCalendar(calendar);</span>
<a href="#l58.42"></a><span id="l58.42"> </span>
<a href="#l58.43"></a><span id="l58.43">     let calendarTree = lookup(`</span>
<a href="#l58.44"></a><span id="l58.44">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -144,17 +144,17 @@ function testTaskView() {</span>
<a href="#l59.4"></a><span id="l59.4">     sleep();</span>
<a href="#l59.5"></a><span id="l59.5">     controller.click(eid(&quot;priority-1-menuitem&quot;));</span>
<a href="#l59.6"></a><span id="l59.6">     sleep();</span>
<a href="#l59.7"></a><span id="l59.7">     let priorityNode = eid(&quot;calendar-task-details-priority-high&quot;);</span>
<a href="#l59.8"></a><span id="l59.8">     controller.assertNotDOMProperty(priorityNode, &quot;hidden&quot;);</span>
<a href="#l59.9"></a><span id="l59.9"> </span>
<a href="#l59.10"></a><span id="l59.10">     // verify that tooltip shows status, priority and percent complete</span>
<a href="#l59.11"></a><span id="l59.11">     let toolTipNode = lookup(toolTip).getNode();</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-    toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+    toolTipNode.ownerGlobal.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l59.14"></a><span id="l59.14"> </span>
<a href="#l59.15"></a><span id="l59.15">     let toolTipName = lookup(toolTipGrid + &quot;[1]/[0]/[1]&quot;);</span>
<a href="#l59.16"></a><span id="l59.16">     let toolTipCalendar = lookup(toolTipGrid + &quot;[1]/[1]/[1]&quot;);</span>
<a href="#l59.17"></a><span id="l59.17">     let toolTipPriority = lookup(toolTipGrid + &quot;[1]/[2]/[1]&quot;);</span>
<a href="#l59.18"></a><span id="l59.18">     let toolTipStatus = lookup(toolTipGrid + &quot;[1]/[3]/[1]&quot;);</span>
<a href="#l59.19"></a><span id="l59.19">     let toolTipComplete = lookup(toolTipGrid + &quot;[1]/[4]/[1]&quot;);</span>
<a href="#l59.20"></a><span id="l59.20">     let priority = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;, &quot;highPriority&quot;);</span>
<a href="#l59.21"></a><span id="l59.21"> </span>
<a href="#l59.22"></a><span id="l59.22" class="difflineat">@@ -164,17 +164,17 @@ function testTaskView() {</span>
<a href="#l59.23"></a><span id="l59.23">     controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l59.24"></a><span id="l59.24">     controller.assertJSProperty(toolTipComplete, &quot;textContent&quot;, percentComplete + &quot;%&quot;);</span>
<a href="#l59.25"></a><span id="l59.25"> </span>
<a href="#l59.26"></a><span id="l59.26">     // mark completed, verify</span>
<a href="#l59.27"></a><span id="l59.27">     controller.click(eid(&quot;task-actions-markcompleted&quot;));</span>
<a href="#l59.28"></a><span id="l59.28">     sleep();</span>
<a href="#l59.29"></a><span id="l59.29"> </span>
<a href="#l59.30"></a><span id="l59.30">     status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;, &quot;taskDetailsStatusCompleted&quot;);</span>
<a href="#l59.31"></a><span id="l59.31" class="difflineminus">-    toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l59.32"></a><span id="l59.32" class="difflineplus">+    toolTipNode.ownerGlobal.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l59.33"></a><span id="l59.33">     controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l59.34"></a><span id="l59.34"> </span>
<a href="#l59.35"></a><span id="l59.35">     // delete task, verify</span>
<a href="#l59.36"></a><span id="l59.36">     controller.click(eid(&quot;task-context-menu-delete&quot;));</span>
<a href="#l59.37"></a><span id="l59.37">     controller.click(eid(&quot;calendar-delete-task-button&quot;));</span>
<a href="#l59.38"></a><span id="l59.38">     let countAfterDelete = taskTreeNode.mTaskArray.length;</span>
<a href="#l59.39"></a><span id="l59.39">     controller.assertJS(countAfter - 1 == countAfterDelete);</span>
<a href="#l59.40"></a><span id="l59.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/calendar/test/unit/head_consts.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/calendar/test/unit/head_consts.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -159,20 +159,20 @@ function getProps(aItem, aProp) {</span>
<a href="#l60.4"></a><span id="l60.4">         return null;</span>
<a href="#l60.5"></a><span id="l60.5">     }</span>
<a href="#l60.6"></a><span id="l60.6"> }</span>
<a href="#l60.7"></a><span id="l60.7"> </span>
<a href="#l60.8"></a><span id="l60.8"> function compareItemsSpecific(aLeftItem, aRightItem, aPropArray) {</span>
<a href="#l60.9"></a><span id="l60.9">     if (!aPropArray) {</span>
<a href="#l60.10"></a><span id="l60.10">         // left out:  &quot;id&quot;, &quot;calendar&quot;, &quot;lastModifiedTime&quot;, &quot;generation&quot;,</span>
<a href="#l60.11"></a><span id="l60.11">         // &quot;stampTime&quot; as these are expected to change</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-        aPropArray = [&quot;start&quot;, &quot;end&quot;, &quot;duration&quot;,</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineminus">-                      &quot;title&quot;, &quot;priority&quot;, &quot;privacy&quot;, &quot;creationDate&quot;,</span>
<a href="#l60.14"></a><span id="l60.14" class="difflineminus">-                      &quot;status&quot;, &quot;alarmLastAck&quot;,</span>
<a href="#l60.15"></a><span id="l60.15" class="difflineminus">-                      &quot;recurrenceStartDate&quot;];</span>
<a href="#l60.16"></a><span id="l60.16" class="difflineplus">+        aPropArray = [</span>
<a href="#l60.17"></a><span id="l60.17" class="difflineplus">+            &quot;start&quot;, &quot;end&quot;, &quot;duration&quot;, &quot;title&quot;, &quot;priority&quot;, &quot;privacy&quot;,</span>
<a href="#l60.18"></a><span id="l60.18" class="difflineplus">+            &quot;creationDate&quot;, &quot;status&quot;, &quot;alarmLastAck&quot;, &quot;recurrenceStartDate&quot;</span>
<a href="#l60.19"></a><span id="l60.19" class="difflineplus">+        ];</span>
<a href="#l60.20"></a><span id="l60.20">     }</span>
<a href="#l60.21"></a><span id="l60.21">     for (let i = 0; i &lt; aPropArray.length; i++) {</span>
<a href="#l60.22"></a><span id="l60.22">         equal(getProps(aLeftItem, aPropArray[i]),</span>
<a href="#l60.23"></a><span id="l60.23">               getProps(aRightItem, aPropArray[i]),</span>
<a href="#l60.24"></a><span id="l60.24">               Components.stack.caller);</span>
<a href="#l60.25"></a><span id="l60.25">     }</span>
<a href="#l60.26"></a><span id="l60.26"> }</span>
<a href="#l60.27"></a><span id="l60.27"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/calendar/test/unit/test_alarmservice.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/calendar/test/unit/test_alarmservice.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -246,19 +246,19 @@ function addTestItems(aCalendar) {</span>
<a href="#l61.4"></a><span id="l61.4"> </span>
<a href="#l61.5"></a><span id="l61.5"> </span>
<a href="#l61.6"></a><span id="l61.6">     // daily repeating event starting almost 2 full days ago. The alarms on the first 2 occurrences</span>
<a href="#l61.7"></a><span id="l61.7">     // should fire, and a timer should be set for the next occurrence only</span>
<a href="#l61.8"></a><span id="l61.8">     date = cal.now();</span>
<a href="#l61.9"></a><span id="l61.9">     date.hour -= 47;</span>
<a href="#l61.10"></a><span id="l61.10">     [item, alarm] = createEventWithAlarm(aCalendar, date, date, &quot;-PT15M&quot;, &quot;RRULE:FREQ=DAILY&quot;);</span>
<a href="#l61.11"></a><span id="l61.11">     item.title=&quot;addTestItems Test 7&quot;;</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-    alarmObserver.expectOccurrences(aCalendar, item, alarm,</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineminus">-                                   [EXPECT_FIRED, EXPECT_FIRED, EXPECT_TIMER,</span>
<a href="#l61.14"></a><span id="l61.14" class="difflineminus">-                                    EXPECT_NONE, EXPECT_NONE]);</span>
<a href="#l61.15"></a><span id="l61.15" class="difflineplus">+    alarmObserver.expectOccurrences(aCalendar, item, alarm, [</span>
<a href="#l61.16"></a><span id="l61.16" class="difflineplus">+        EXPECT_FIRED, EXPECT_FIRED, EXPECT_TIMER, EXPECT_NONE, EXPECT_NONE</span>
<a href="#l61.17"></a><span id="l61.17" class="difflineplus">+    ]);</span>
<a href="#l61.18"></a><span id="l61.18">     aCalendar.addItem(item, null);</span>
<a href="#l61.19"></a><span id="l61.19"> </span>
<a href="#l61.20"></a><span id="l61.20">     // monthly repeating event starting 2 months and a day ago. The alarms on the first 2 occurrences</span>
<a href="#l61.21"></a><span id="l61.21">     // should be ignored, the alarm on the next occurrence only should fire.</span>
<a href="#l61.22"></a><span id="l61.22">     // Missing recurrences of the event in particular days of the year generate exceptions to the</span>
<a href="#l61.23"></a><span id="l61.23">     // regular sequence of alarms.</span>
<a href="#l61.24"></a><span id="l61.24">     date = cal.now();</span>
<a href="#l61.25"></a><span id="l61.25">     let statusAlarmSequences = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/calendar/test/unit/test_attendee.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/calendar/test/unit/test_attendee.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -45,18 +45,19 @@ function test_values() {</span>
<a href="#l62.4"></a><span id="l62.4"> </span>
<a href="#l62.5"></a><span id="l62.5">             equal(a[properties[i]], old);</span>
<a href="#l62.6"></a><span id="l62.6">         }</span>
<a href="#l62.7"></a><span id="l62.7">     }</span>
<a href="#l62.8"></a><span id="l62.8"> </span>
<a href="#l62.9"></a><span id="l62.9">     // Create Attendee</span>
<a href="#l62.10"></a><span id="l62.10">     let attendee1 = cal.createAttendee();</span>
<a href="#l62.11"></a><span id="l62.11">     // Testing attendee set/get.</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-    let properties = [&quot;id&quot;, &quot;commonName&quot;, &quot;rsvp&quot;, &quot;role&quot;, &quot;participationStatus&quot;,</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineminus">-                      &quot;userType&quot;];</span>
<a href="#l62.14"></a><span id="l62.14" class="difflineplus">+    let properties = [</span>
<a href="#l62.15"></a><span id="l62.15" class="difflineplus">+        &quot;id&quot;, &quot;commonName&quot;, &quot;rsvp&quot;, &quot;role&quot;, &quot;participationStatus&quot;, &quot;userType&quot;</span>
<a href="#l62.16"></a><span id="l62.16" class="difflineplus">+    ];</span>
<a href="#l62.17"></a><span id="l62.17">     let values = [&quot;myid&quot;, &quot;mycn&quot;, &quot;TRUE&quot;, &quot;CHAIR&quot;, &quot;DECLINED&quot;, &quot;RESOURCE&quot;];</span>
<a href="#l62.18"></a><span id="l62.18">     // Make sure test is valid</span>
<a href="#l62.19"></a><span id="l62.19">     equal(properties.length, values.length);</span>
<a href="#l62.20"></a><span id="l62.20"> </span>
<a href="#l62.21"></a><span id="l62.21">     for (let i = 0; i &lt; properties.length; i++) {</span>
<a href="#l62.22"></a><span id="l62.22">         attendee1[properties[i]] = values[i];</span>
<a href="#l62.23"></a><span id="l62.23">         equal(attendee1[properties[i]], values[i]);</span>
<a href="#l62.24"></a><span id="l62.24">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/calendar/test/unit/test_bug1199942.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/calendar/test/unit/test_bug1199942.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -41,20 +41,20 @@ function serializeEvent_test() {</span>
<a href="#l63.4"></a><span id="l63.4">               &quot;ATTENDEE;RSVP=TRUE;PARTSTAT=NEEDS-ACTION;ROLE=REQ-PARTICIPANT:user4@example.net\n&quot; +</span>
<a href="#l63.5"></a><span id="l63.5">               &quot;ATTENDEE;RSVP=TRUE;PARTSTAT=NEEDS-ACTION;ROLE=REQ-PARTICIPANT:urn:uuid:user5\n&quot; +</span>
<a href="#l63.6"></a><span id="l63.6">               &quot;DTSTART:20150729T103000Z\n&quot; +</span>
<a href="#l63.7"></a><span id="l63.7">               &quot;DTEND:20150729T113000Z\n&quot; +</span>
<a href="#l63.8"></a><span id="l63.8">               &quot;TRANSP:OPAQUE\n&quot; +</span>
<a href="#l63.9"></a><span id="l63.9">               &quot;END:VEVENT\n&quot; +</span>
<a href="#l63.10"></a><span id="l63.10">               &quot;END:VCALENDAR\n&quot;;</span>
<a href="#l63.11"></a><span id="l63.11"> </span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-    let expectedIds = [&quot;mailto:user2@example.net&quot;,</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineminus">-                       &quot;mailto:user3@example.net&quot;,</span>
<a href="#l63.14"></a><span id="l63.14" class="difflineminus">-                       &quot;mailto:user4@example.net&quot;,</span>
<a href="#l63.15"></a><span id="l63.15" class="difflineminus">-                       &quot;urn:uuid:user5&quot;];</span>
<a href="#l63.16"></a><span id="l63.16" class="difflineplus">+    let expectedIds = [</span>
<a href="#l63.17"></a><span id="l63.17" class="difflineplus">+        &quot;mailto:user2@example.net&quot;, &quot;mailto:user3@example.net&quot;,</span>
<a href="#l63.18"></a><span id="l63.18" class="difflineplus">+        &quot;mailto:user4@example.net&quot;, &quot;urn:uuid:user5&quot;</span>
<a href="#l63.19"></a><span id="l63.19" class="difflineplus">+    ];</span>
<a href="#l63.20"></a><span id="l63.20">     let event = createEventFromIcalString(ics);</span>
<a href="#l63.21"></a><span id="l63.21">     let attendees = event.getAttendees({});</span>
<a href="#l63.22"></a><span id="l63.22"> </span>
<a href="#l63.23"></a><span id="l63.23">     // check whether all attendees get returned with expected id</span>
<a href="#l63.24"></a><span id="l63.24">     for (let attendee of attendees) {</span>
<a href="#l63.25"></a><span id="l63.25">         ok(expectedIds.includes(attendee.id));</span>
<a href="#l63.26"></a><span id="l63.26">     }</span>
<a href="#l63.27"></a><span id="l63.27"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/calendar/test/unit/test_bug759324.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/calendar/test/unit/test_bug759324.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -6,22 +6,24 @@</span>
<a href="#l64.4"></a><span id="l64.4">  * Checks if the capabilities.propagate-sequence feature of the storage calendar</span>
<a href="#l64.5"></a><span id="l64.5">  * still works</span>
<a href="#l64.6"></a><span id="l64.6">  */</span>
<a href="#l64.7"></a><span id="l64.7"> function run_test() {</span>
<a href="#l64.8"></a><span id="l64.8">     let storage = getStorageCal();</span>
<a href="#l64.9"></a><span id="l64.9"> </span>
<a href="#l64.10"></a><span id="l64.10">     storage.setProperty(&quot;capabilities.propagate-sequence&quot;, &quot;true&quot;);</span>
<a href="#l64.11"></a><span id="l64.11"> </span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-    let str = [&quot;BEGIN:VEVENT&quot;,</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineminus">-               &quot;UID:recItem&quot;,</span>
<a href="#l64.14"></a><span id="l64.14" class="difflineminus">-               &quot;SEQUENCE:3&quot;,</span>
<a href="#l64.15"></a><span id="l64.15" class="difflineminus">-               &quot;RRULE:FREQ=WEEKLY&quot;,</span>
<a href="#l64.16"></a><span id="l64.16" class="difflineminus">-               &quot;DTSTART:20120101T010101Z&quot;,</span>
<a href="#l64.17"></a><span id="l64.17" class="difflineminus">-               &quot;END:VEVENT&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l64.18"></a><span id="l64.18" class="difflineplus">+    let str = [</span>
<a href="#l64.19"></a><span id="l64.19" class="difflineplus">+        &quot;BEGIN:VEVENT&quot;,</span>
<a href="#l64.20"></a><span id="l64.20" class="difflineplus">+        &quot;UID:recItem&quot;,</span>
<a href="#l64.21"></a><span id="l64.21" class="difflineplus">+        &quot;SEQUENCE:3&quot;,</span>
<a href="#l64.22"></a><span id="l64.22" class="difflineplus">+        &quot;RRULE:FREQ=WEEKLY&quot;,</span>
<a href="#l64.23"></a><span id="l64.23" class="difflineplus">+        &quot;DTSTART:20120101T010101Z&quot;,</span>
<a href="#l64.24"></a><span id="l64.24" class="difflineplus">+        &quot;END:VEVENT&quot;</span>
<a href="#l64.25"></a><span id="l64.25" class="difflineplus">+    ].join(&quot;\r\n&quot;);</span>
<a href="#l64.26"></a><span id="l64.26"> </span>
<a href="#l64.27"></a><span id="l64.27">     let item = createEventFromIcalString(str);</span>
<a href="#l64.28"></a><span id="l64.28">     let rid = cal.createDateTime(&quot;20120101T010101Z&quot;);</span>
<a href="#l64.29"></a><span id="l64.29">     let rec = item.recurrenceInfo.getOccurrenceFor(rid);</span>
<a href="#l64.30"></a><span id="l64.30">     rec.title = &quot;changed&quot;;</span>
<a href="#l64.31"></a><span id="l64.31">     item.recurrenceInfo.modifyException(rec, true);</span>
<a href="#l64.32"></a><span id="l64.32"> </span>
<a href="#l64.33"></a><span id="l64.33">     do_test_pending();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/calendar/test/unit/test_calitiputils.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/calendar/test/unit/test_calitiputils.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -112,18 +112,20 @@ function getSeqStampTestItems(aTest) {</span>
<a href="#l65.4"></a><span id="l65.4">             if (&quot;xMozReceivedStamp&quot; in input.item &amp;&amp; input.item.xMozReceivedStamp.length) {</span>
<a href="#l65.5"></a><span id="l65.5">                 xMozReceivedStamp = &quot;X-MOZ-RECEIVED-DTSTAMP:&quot; + input.item.xMozReceivedStamp;</span>
<a href="#l65.6"></a><span id="l65.6">             }</span>
<a href="#l65.7"></a><span id="l65.7">             let xMsAptSeq = &quot;&quot;;</span>
<a href="#l65.8"></a><span id="l65.8">             if (&quot;xMsAptSeq&quot; in input.item &amp;&amp; input.item.xMsAptSeq.length) {</span>
<a href="#l65.9"></a><span id="l65.9">                 xMsAptSeq = &quot;X-MICROSOFT-CDO-APPT-SEQUENCE:&quot; + input.item.xMsAptSeq;</span>
<a href="#l65.10"></a><span id="l65.10">             }</span>
<a href="#l65.11"></a><span id="l65.11">             let testItem = cal.createEvent();</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-            testItem.icalString = getSeqStampTestIcs([attendee, sequence, dtStamp, xMozReceivedSeq,</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineminus">-                                                      xMozReceivedStamp, xMsAptSeq]);</span>
<a href="#l65.14"></a><span id="l65.14" class="difflineplus">+            testItem.icalString = getSeqStampTestIcs([</span>
<a href="#l65.15"></a><span id="l65.15" class="difflineplus">+                attendee, sequence, dtStamp, xMozReceivedSeq,</span>
<a href="#l65.16"></a><span id="l65.16" class="difflineplus">+                xMozReceivedStamp, xMsAptSeq</span>
<a href="#l65.17"></a><span id="l65.17" class="difflineplus">+            ]);</span>
<a href="#l65.18"></a><span id="l65.18">             items.push(testItem);</span>
<a href="#l65.19"></a><span id="l65.19">         } else {</span>
<a href="#l65.20"></a><span id="l65.20">             // in this case, we need to return an attendee</span>
<a href="#l65.21"></a><span id="l65.21">             let att = cal.createAttendee();</span>
<a href="#l65.22"></a><span id="l65.22">             att.id = input.attendee.id || &quot;mailto:otherattendee@example.net&quot;;</span>
<a href="#l65.23"></a><span id="l65.23">             if (input.attendee.receivedSeq &amp;&amp; input.attendee.receivedSeq.length) {</span>
<a href="#l65.24"></a><span id="l65.24">                 att.setProperty(&quot;RECEIVED-SEQUENCE&quot;, input.attendee.receivedSeq);</span>
<a href="#l65.25"></a><span id="l65.25">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/calendar/test/unit/test_ltninvitationutils.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/calendar/test/unit/test_ltninvitationutils.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -108,20 +108,22 @@ add_task(function* getItipHeader_test() </span>
<a href="#l66.4"></a><span id="l66.4">             method: &quot;METHOD:REPLY\r\n&quot;,</span>
<a href="#l66.5"></a><span id="l66.5">             attendees: [&quot;ATTENDEE;RSVP=TRUE;CN=Attendee1;PARTSTAT=DECLINED;&quot; +</span>
<a href="#l66.6"></a><span id="l66.6">                         &quot;ROLE=REQ-PARTICIPANT:mailto:attendee1@example.net&quot;]</span>
<a href="#l66.7"></a><span id="l66.7">         },</span>
<a href="#l66.8"></a><span id="l66.8">         expected: &quot;Attendee1 &lt;attendee1@example.net&gt; has declined your event invitation.&quot;</span>
<a href="#l66.9"></a><span id="l66.9">     }, {</span>
<a href="#l66.10"></a><span id="l66.10">         input: {</span>
<a href="#l66.11"></a><span id="l66.11">             method: &quot;METHOD:REPLY\r\n&quot;,</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-            attendees: [&quot;ATTENDEE;RSVP=TRUE;CN=Attendee1;PARTSTAT=ACCEPTED;&quot; +</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineminus">-                        &quot;ROLE=REQ-PARTICIPANT:mailto:attendee1@example.net&quot;,</span>
<a href="#l66.14"></a><span id="l66.14" class="difflineminus">-                        &quot;ATTENDEE;RSVP=TRUE;CN=Attendee2;PARTSTAT=DECLINED;&quot; +</span>
<a href="#l66.15"></a><span id="l66.15" class="difflineminus">-                        &quot;ROLE=REQ-PARTICIPANT:mailto:attendee2@example.net&quot;]</span>
<a href="#l66.16"></a><span id="l66.16" class="difflineplus">+            attendees: [</span>
<a href="#l66.17"></a><span id="l66.17" class="difflineplus">+                &quot;ATTENDEE;RSVP=TRUE;CN=Attendee1;PARTSTAT=ACCEPTED;&quot; +</span>
<a href="#l66.18"></a><span id="l66.18" class="difflineplus">+                &quot;ROLE=REQ-PARTICIPANT:mailto:attendee1@example.net&quot;,</span>
<a href="#l66.19"></a><span id="l66.19" class="difflineplus">+                &quot;ATTENDEE;RSVP=TRUE;CN=Attendee2;PARTSTAT=DECLINED;&quot; +</span>
<a href="#l66.20"></a><span id="l66.20" class="difflineplus">+                &quot;ROLE=REQ-PARTICIPANT:mailto:attendee2@example.net&quot;</span>
<a href="#l66.21"></a><span id="l66.21" class="difflineplus">+            ]</span>
<a href="#l66.22"></a><span id="l66.22">         },</span>
<a href="#l66.23"></a><span id="l66.23">         expected: &quot;Attendee1 &lt;attendee1@example.net&gt; has accepted your event invitation.&quot;</span>
<a href="#l66.24"></a><span id="l66.24">     }, {</span>
<a href="#l66.25"></a><span id="l66.25">         input: {</span>
<a href="#l66.26"></a><span id="l66.26">             method: &quot;METHOD:UNSUPPORTED\r\n&quot;,</span>
<a href="#l66.27"></a><span id="l66.27">             attendees: [null]</span>
<a href="#l66.28"></a><span id="l66.28">         },</span>
<a href="#l66.29"></a><span id="l66.29">         expected: &quot;Event Invitation&quot;</span>
<a href="#l66.30"></a><span id="l66.30" class="difflineat">@@ -210,22 +212,22 @@ add_task(function* createInvitationOverl</span>
<a href="#l66.31"></a><span id="l66.31">             node: &quot;imipHtml-description-content&quot;,</span>
<a href="#l66.32"></a><span id="l66.32">             value: &quot;Let's see how evil we can be: &amp;lt;script language=\&quot;JavaScript\&quot;&amp;gt;document.&quot; +</span>
<a href="#l66.33"></a><span id="l66.33">                    &quot;getElementById(\&quot;imipHtml-description-content\&quot;).write(\&quot;Script embedded!\&quot;)&amp;&quot; +</span>
<a href="#l66.34"></a><span id="l66.34">                    &quot;lt;/script&amp;gt;&quot;</span>
<a href="#l66.35"></a><span id="l66.35">         }</span>
<a href="#l66.36"></a><span id="l66.36">     }, {</span>
<a href="#l66.37"></a><span id="l66.37">         input: {</span>
<a href="#l66.38"></a><span id="l66.38">             description: &quot;DESCRIPTION:Or we can try: &lt;img src=\&quot;document.getElementById(\&quot;imipHtm&quot; +</span>
<a href="#l66.39"></a><span id="l66.39" class="difflineminus">-                         &quot;l-description-descr\&quot;).innerText\&quot; \&gt;\r\n&quot;</span>
<a href="#l66.40"></a><span id="l66.40" class="difflineplus">+                         &quot;l-description-descr\&quot;).innerText\&quot; &gt;\r\n&quot;</span>
<a href="#l66.41"></a><span id="l66.41">         },</span>
<a href="#l66.42"></a><span id="l66.42">         expected: {</span>
<a href="#l66.43"></a><span id="l66.43">             node: &quot;imipHtml-description-content&quot;,</span>
<a href="#l66.44"></a><span id="l66.44">             value: &quot;Or we can try: &amp;lt;img src=\&quot;document.getElementById(\&quot;imipHtml-description-d&quot; +</span>
<a href="#l66.45"></a><span id="l66.45" class="difflineminus">-                   &quot;escr\&quot;).innerText\&quot; \&amp;gt;&quot;</span>
<a href="#l66.46"></a><span id="l66.46" class="difflineplus">+                   &quot;escr\&quot;).innerText\&quot; &amp;gt;&quot;</span>
<a href="#l66.47"></a><span id="l66.47">         }</span>
<a href="#l66.48"></a><span id="l66.48">     }, {</span>
<a href="#l66.49"></a><span id="l66.49">         input: { url: &quot;URL:http://www.example.org/event.ics\r\n&quot; },</span>
<a href="#l66.50"></a><span id="l66.50">         expected: {</span>
<a href="#l66.51"></a><span id="l66.51">             node: &quot;imipHtml-url-content&quot;,</span>
<a href="#l66.52"></a><span id="l66.52">             value: &quot;&lt;a xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot; class=\&quot;moz-txt-link-freetext\&quot; hre&quot; +</span>
<a href="#l66.53"></a><span id="l66.53">                    &quot;f=\&quot;http://www.example.org/event.ics\&quot;&gt;http://www.example.org/event.ics&lt;/a&gt;&quot;</span>
<a href="#l66.54"></a><span id="l66.54">         }</span>
<a href="#l66.55"></a><span id="l66.55" class="difflineat">@@ -468,18 +470,20 @@ add_task(function* compareInvitationOver</span>
<a href="#l66.56"></a><span id="l66.56">     }, {</span>
<a href="#l66.57"></a><span id="l66.57">         input: {</span>
<a href="#l66.58"></a><span id="l66.58">             previous: { organizer: &quot;ORGANIZER:mailto:organizer1@example.net\r\n&quot; },</span>
<a href="#l66.59"></a><span id="l66.59">             current: { organizer: &quot;ORGANIZER:mailto:organizer2@example.net\r\n&quot; },</span>
<a href="#l66.60"></a><span id="l66.60">             ignore: &quot;&quot;</span>
<a href="#l66.61"></a><span id="l66.61">         },</span>
<a href="#l66.62"></a><span id="l66.62">         expected: {</span>
<a href="#l66.63"></a><span id="l66.63">             node: &quot;organizer-table&quot;,</span>
<a href="#l66.64"></a><span id="l66.64" class="difflineminus">-            each: [&quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;organizer2@example.net&lt;/span&gt;&quot;,</span>
<a href="#l66.65"></a><span id="l66.65" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;organizer1@example.net&lt;/span&gt;&quot;]</span>
<a href="#l66.66"></a><span id="l66.66" class="difflineplus">+            each: [</span>
<a href="#l66.67"></a><span id="l66.67" class="difflineplus">+                &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;organizer2@example.net&lt;/span&gt;&quot;,</span>
<a href="#l66.68"></a><span id="l66.68" class="difflineplus">+                &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;organizer1@example.net&lt;/span&gt;&quot;</span>
<a href="#l66.69"></a><span id="l66.69" class="difflineplus">+            ]</span>
<a href="#l66.70"></a><span id="l66.70">         }</span>
<a href="#l66.71"></a><span id="l66.71">     }, {</span>
<a href="#l66.72"></a><span id="l66.72">         input: {</span>
<a href="#l66.73"></a><span id="l66.73">             previous: {</span>
<a href="#l66.74"></a><span id="l66.74">                 attendee: &quot;ATTENDEE;RSVP=TRUE;CUTYPE=INDIVIDUAL;PARTSTAT=NEEDS-ACTION:&quot; +</span>
<a href="#l66.75"></a><span id="l66.75">                           &quot;mailto:attendee1@example.net\r\n&quot; +</span>
<a href="#l66.76"></a><span id="l66.76">                           &quot;ATTENDEE;RSVP=TRUE;CUTYPE=INDIVIDUAL;PARTSTAT=NEEDS-ACTION:&quot; +</span>
<a href="#l66.77"></a><span id="l66.77">                           &quot;mailto:attendee2@example.net\r\n&quot; +</span>
<a href="#l66.78"></a><span id="l66.78" class="difflineat">@@ -493,20 +497,22 @@ add_task(function* compareInvitationOver</span>
<a href="#l66.79"></a><span id="l66.79">                           &quot;mailto:attendee3@example.net\r\n&quot; +</span>
<a href="#l66.80"></a><span id="l66.80">                           &quot;ATTENDEE;RSVP=TRUE;CUTYPE=INDIVIDUAL;PARTSTAT=NEEDS-ACTION:&quot; +</span>
<a href="#l66.81"></a><span id="l66.81">                           &quot;mailto:attendee4@example.net\r\n&quot;</span>
<a href="#l66.82"></a><span id="l66.82">             },</span>
<a href="#l66.83"></a><span id="l66.83">             ignore: &quot;&quot;</span>
<a href="#l66.84"></a><span id="l66.84">         },</span>
<a href="#l66.85"></a><span id="l66.85">         expected: {</span>
<a href="#l66.86"></a><span id="l66.86">             node: &quot;attendee-table&quot;,</span>
<a href="#l66.87"></a><span id="l66.87" class="difflineminus">-            each: [&quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;modified\&quot;&gt;attendee2@example.net&lt;/span&gt;&quot;,</span>
<a href="#l66.88"></a><span id="l66.88" class="difflineminus">-                   &quot;attendee3@example.net&quot;,</span>
<a href="#l66.89"></a><span id="l66.89" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;attendee4@example.net&lt;/span&gt;&quot;,</span>
<a href="#l66.90"></a><span id="l66.90" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;attendee1@example.net&lt;/span&gt;&quot;]</span>
<a href="#l66.91"></a><span id="l66.91" class="difflineplus">+            each: [</span>
<a href="#l66.92"></a><span id="l66.92" class="difflineplus">+                &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;modified\&quot;&gt;attendee2@example.net&lt;/span&gt;&quot;,</span>
<a href="#l66.93"></a><span id="l66.93" class="difflineplus">+                &quot;attendee3@example.net&quot;,</span>
<a href="#l66.94"></a><span id="l66.94" class="difflineplus">+                &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;attendee4@example.net&lt;/span&gt;&quot;,</span>
<a href="#l66.95"></a><span id="l66.95" class="difflineplus">+                &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;attendee1@example.net&lt;/span&gt;&quot;</span>
<a href="#l66.96"></a><span id="l66.96" class="difflineplus">+            ]</span>
<a href="#l66.97"></a><span id="l66.97">         }</span>
<a href="#l66.98"></a><span id="l66.98">     }];</span>
<a href="#l66.99"></a><span id="l66.99">     // we make sure that the Europe/Berlin timezone and long datetime format is set</span>
<a href="#l66.100"></a><span id="l66.100">     let dateformat = Preferences.get(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l66.101"></a><span id="l66.101">     let tzlocal = Preferences.get(&quot;calendar.timezone.local&quot;, &quot;Europe/Berlin&quot;);</span>
<a href="#l66.102"></a><span id="l66.102">     Preferences.set(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l66.103"></a><span id="l66.103">     Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Europe/Berlin&quot;);</span>
<a href="#l66.104"></a><span id="l66.104">     let i = 0;</span>
<a href="#l66.105"></a><span id="l66.105" class="difflineat">@@ -783,16 +789,18 @@ add_task(function* getRfc5322FormattedDa</span>
<a href="#l66.106"></a><span id="l66.106">         let date = test.date ? new Date(test.date) : null;</span>
<a href="#l66.107"></a><span id="l66.107">         let re = new RegExp(data.expected);</span>
<a href="#l66.108"></a><span id="l66.108">         ok(re.test(ltn.invitation.getRfc5322FormattedDate(date)), &quot;(test #&quot; + i + &quot;)&quot;);</span>
<a href="#l66.109"></a><span id="l66.109">     }</span>
<a href="#l66.110"></a><span id="l66.110">     Preferences.set(&quot;calendar.timezone.local&quot;, timezone);</span>
<a href="#l66.111"></a><span id="l66.111"> });</span>
<a href="#l66.112"></a><span id="l66.112"> </span>
<a href="#l66.113"></a><span id="l66.113"> add_task(function* parseCounter_test() {</span>
<a href="#l66.114"></a><span id="l66.114" class="difflineplus">+    // We are disabling this rule for a more consistent display of this data</span>
<a href="#l66.115"></a><span id="l66.115" class="difflineplus">+    /* eslint-disable object-curly-newline */</span>
<a href="#l66.116"></a><span id="l66.116">     let data = [{</span>
<a href="#l66.117"></a><span id="l66.117">         // #1: basic test to check all currently supported properties</span>
<a href="#l66.118"></a><span id="l66.118">         input: {</span>
<a href="#l66.119"></a><span id="l66.119">             existing: [],</span>
<a href="#l66.120"></a><span id="l66.120">             proposed: [</span>
<a href="#l66.121"></a><span id="l66.121">                 {</span>
<a href="#l66.122"></a><span id="l66.122">                     method: &quot;METHOD:COUNTER&quot;</span>
<a href="#l66.123"></a><span id="l66.123">                 }, {</span>
<a href="#l66.124"></a><span id="l66.124" class="difflineat">@@ -804,17 +812,17 @@ add_task(function* parseCounter_test() {</span>
<a href="#l66.125"></a><span id="l66.125">                 }, {</span>
<a href="#l66.126"></a><span id="l66.126">                     summary: &quot;SUMMARY:Test Event 2&quot;</span>
<a href="#l66.127"></a><span id="l66.127">                 }, {</span>
<a href="#l66.128"></a><span id="l66.128">                     attendee: &quot;ATTENDEE;CN=Attendee;PARTSTAT=DECLINED;ROLE=REQ-PARTICIPANT:&quot; +</span>
<a href="#l66.129"></a><span id="l66.129">                               &quot;mailto:attendee@example.net&quot;</span>
<a href="#l66.130"></a><span id="l66.130">                 }, {</span>
<a href="#l66.131"></a><span id="l66.131">                     dtStamp: &quot;DTSTAMP:20150909T182048Z&quot;</span>
<a href="#l66.132"></a><span id="l66.132">                 }, {</span>
<a href="#l66.133"></a><span id="l66.133" class="difflineminus">-                    attach: &quot;COMMENT:Sorry\, I cannot make it that time.&quot;</span>
<a href="#l66.134"></a><span id="l66.134" class="difflineplus">+                    attach: &quot;COMMENT:Sorry, I cannot make it that time.&quot;</span>
<a href="#l66.135"></a><span id="l66.135">                 }</span>
<a href="#l66.136"></a><span id="l66.136">             ]</span>
<a href="#l66.137"></a><span id="l66.137">         },</span>
<a href="#l66.138"></a><span id="l66.138">         expected: {</span>
<a href="#l66.139"></a><span id="l66.139">             // Time format is platform dependent, so we use alternative result sets here.</span>
<a href="#l66.140"></a><span id="l66.140">             // The first two are configurations running for automated tests.</span>
<a href="#l66.141"></a><span id="l66.141">             // If you get a failure for this test, add your pattern here.</span>
<a href="#l66.142"></a><span id="l66.142">             result: { descr: &quot;&quot;, type: &quot;OK&quot; },</span>
<a href="#l66.143"></a><span id="l66.143" class="difflineat">@@ -839,17 +847,17 @@ add_task(function* parseCounter_test() {</span>
<a href="#l66.144"></a><span id="l66.144">                 proposed: [&quot;Thursday, September 10, 2015 10:00 PM Europe/Berlin&quot;,</span>
<a href="#l66.145"></a><span id="l66.145">                            &quot;Thursday, September 10, 2015 22:00 Europe/Berlin&quot;],</span>
<a href="#l66.146"></a><span id="l66.146">                 original: [&quot;Wednesday, September 09, 2015 10:00 PM Europe/Berlin&quot;, // Windows</span>
<a href="#l66.147"></a><span id="l66.147">                            &quot;Wednesday, September 09, 2015 22:00 Europe/Berlin&quot;,</span>
<a href="#l66.148"></a><span id="l66.148">                            &quot;Wednesday, September 9, 2015 10:00 PM Europe/Berlin&quot;,  // Linux and Mac</span>
<a href="#l66.149"></a><span id="l66.149">                            &quot;Wednesday, September 9, 2015 22:00 Europe/Berlin&quot;]</span>
<a href="#l66.150"></a><span id="l66.150">             }, {</span>
<a href="#l66.151"></a><span id="l66.151">                 property: &quot;COMMENT&quot;,</span>
<a href="#l66.152"></a><span id="l66.152" class="difflineminus">-                proposed: &quot;Sorry\, I cannot make it that time.&quot;,</span>
<a href="#l66.153"></a><span id="l66.153" class="difflineplus">+                proposed: &quot;Sorry, I cannot make it that time.&quot;,</span>
<a href="#l66.154"></a><span id="l66.154">                 original: null</span>
<a href="#l66.155"></a><span id="l66.155">             }]</span>
<a href="#l66.156"></a><span id="l66.156">         }</span>
<a href="#l66.157"></a><span id="l66.157">     }, {</span>
<a href="#l66.158"></a><span id="l66.158">         // #2: test with an unsupported property has been changed</span>
<a href="#l66.159"></a><span id="l66.159">         input: {</span>
<a href="#l66.160"></a><span id="l66.160">             existing: [],</span>
<a href="#l66.161"></a><span id="l66.161">             proposed: [</span>
<a href="#l66.162"></a><span id="l66.162" class="difflineat">@@ -857,19 +865,20 @@ add_task(function* parseCounter_test() {</span>
<a href="#l66.163"></a><span id="l66.163">                     method: &quot;METHOD:COUNTER&quot;</span>
<a href="#l66.164"></a><span id="l66.164">                 }, {</span>
<a href="#l66.165"></a><span id="l66.165">                     attendee: &quot;ATTENDEE;CN=Attendee;PARTSTAT=NEEDS-ACTION;ROLE=REQ-PARTICIPANT:&quot; +</span>
<a href="#l66.166"></a><span id="l66.166">                               &quot;mailto:attendee@example.net&quot;</span>
<a href="#l66.167"></a><span id="l66.167">                 }, {</span>
<a href="#l66.168"></a><span id="l66.168">                     location: &quot;LOCATION:Room 2&quot;</span>
<a href="#l66.169"></a><span id="l66.169">                 }, {</span>
<a href="#l66.170"></a><span id="l66.170">                     attach: &quot;ATTACH:http://www.example2.com&quot;</span>
<a href="#l66.171"></a><span id="l66.171" class="difflineminus">-                } ,{</span>
<a href="#l66.172"></a><span id="l66.172" class="difflineplus">+                }, {</span>
<a href="#l66.173"></a><span id="l66.173">                     dtStamp: &quot;DTSTAMP:20150909T182048Z&quot;</span>
<a href="#l66.174"></a><span id="l66.174" class="difflineminus">-                }]</span>
<a href="#l66.175"></a><span id="l66.175" class="difflineplus">+                }</span>
<a href="#l66.176"></a><span id="l66.176" class="difflineplus">+            ]</span>
<a href="#l66.177"></a><span id="l66.177">         },</span>
<a href="#l66.178"></a><span id="l66.178">         expected: {</span>
<a href="#l66.179"></a><span id="l66.179">             result: { descr: &quot;&quot;, type: &quot;OK&quot; },</span>
<a href="#l66.180"></a><span id="l66.180">             differences: [{ property: &quot;LOCATION&quot;, proposed: &quot;Room 2&quot;, original: &quot;Room 1&quot; }]</span>
<a href="#l66.181"></a><span id="l66.181">         }</span>
<a href="#l66.182"></a><span id="l66.182">     }, {</span>
<a href="#l66.183"></a><span id="l66.183">         // #3: proposed change not based on the latest update of the invitation</span>
<a href="#l66.184"></a><span id="l66.184">         input: {</span>
<a href="#l66.185"></a><span id="l66.185" class="difflineat">@@ -996,25 +1005,27 @@ add_task(function* parseCounter_test() {</span>
<a href="#l66.186"></a><span id="l66.186">                 type: &quot;ERROR&quot;</span>
<a href="#l66.187"></a><span id="l66.187">             },</span>
<a href="#l66.188"></a><span id="l66.188">             differences: []</span>
<a href="#l66.189"></a><span id="l66.189">         }</span>
<a href="#l66.190"></a><span id="l66.190">     }, {</span>
<a href="#l66.191"></a><span id="l66.191">         // #8:counterproposal without any difference</span>
<a href="#l66.192"></a><span id="l66.192">         input: {</span>
<a href="#l66.193"></a><span id="l66.193">             existing: [],</span>
<a href="#l66.194"></a><span id="l66.194" class="difflineminus">-            proposed: [{ method: &quot;METHOD:COUNTER&quot; }] },</span>
<a href="#l66.195"></a><span id="l66.195" class="difflineplus">+            proposed: [{ method: &quot;METHOD:COUNTER&quot; }]</span>
<a href="#l66.196"></a><span id="l66.196" class="difflineplus">+        },</span>
<a href="#l66.197"></a><span id="l66.197">         expected: {</span>
<a href="#l66.198"></a><span id="l66.198">             result: {</span>
<a href="#l66.199"></a><span id="l66.199">                 descr: &quot;No difference in counterproposal detected.&quot;,</span>
<a href="#l66.200"></a><span id="l66.200">                 type: &quot;NODIFF&quot;</span>
<a href="#l66.201"></a><span id="l66.201">             },</span>
<a href="#l66.202"></a><span id="l66.202">             differences: []</span>
<a href="#l66.203"></a><span id="l66.203">         }</span>
<a href="#l66.204"></a><span id="l66.204">     }];</span>
<a href="#l66.205"></a><span id="l66.205" class="difflineplus">+    /* eslint-enable object-curly-newline */</span>
<a href="#l66.206"></a><span id="l66.206"> </span>
<a href="#l66.207"></a><span id="l66.207">     let getItem = function(aProperties) {</span>
<a href="#l66.208"></a><span id="l66.208">         let item = getIcs(true);</span>
<a href="#l66.209"></a><span id="l66.209"> </span>
<a href="#l66.210"></a><span id="l66.210">         let modifyProperty = function(aRegex, aReplacement, aInVevent) {</span>
<a href="#l66.211"></a><span id="l66.211">             let inVevent = false;</span>
<a href="#l66.212"></a><span id="l66.212">             let i = 0;</span>
<a href="#l66.213"></a><span id="l66.213">             item.forEach(aProp =&gt; {</span>
<a href="#l66.214"></a><span id="l66.214" class="difflineat">@@ -1058,17 +1069,17 @@ add_task(function* parseCounter_test() {</span>
<a href="#l66.215"></a><span id="l66.215">             });</span>
<a href="#l66.216"></a><span id="l66.216">         }</span>
<a href="#l66.217"></a><span id="l66.217">         item = item.join(&quot;\r\n&quot;);</span>
<a href="#l66.218"></a><span id="l66.218">         return createEventFromIcalString(item);</span>
<a href="#l66.219"></a><span id="l66.219">     };</span>
<a href="#l66.220"></a><span id="l66.220"> </span>
<a href="#l66.221"></a><span id="l66.221">     let formatDt = function (aDateTime) {</span>
<a href="#l66.222"></a><span id="l66.222">         let datetime = cal.getDateFormatter().formatDateTime(aDateTime);</span>
<a href="#l66.223"></a><span id="l66.223" class="difflineminus">-        return datetime += &quot; &quot; + aDateTime.timezone.displayName;</span>
<a href="#l66.224"></a><span id="l66.224" class="difflineplus">+        return datetime + &quot; &quot; + aDateTime.timezone.displayName;</span>
<a href="#l66.225"></a><span id="l66.225">     };</span>
<a href="#l66.226"></a><span id="l66.226"> </span>
<a href="#l66.227"></a><span id="l66.227">     for (let i = 1; i &lt;= data.length; i++) {</span>
<a href="#l66.228"></a><span id="l66.228">         let test = data[i - 1];</span>
<a href="#l66.229"></a><span id="l66.229">         let existingItem = getItem(test.input.existing);</span>
<a href="#l66.230"></a><span id="l66.230">         let proposedItem = getItem(test.input.proposed);</span>
<a href="#l66.231"></a><span id="l66.231">         let parsed = ltn.invitation.parseCounter(proposedItem, existingItem);</span>
<a href="#l66.232"></a><span id="l66.232"> </span>
<a href="#l66.233"></a><span id="l66.233" class="difflineat">@@ -1081,17 +1092,17 @@ add_task(function* parseCounter_test() {</span>
<a href="#l66.234"></a><span id="l66.234">             let expected = test.expected.differences.filter(bDiff =&gt; bDiff.property == aDiff.property);</span>
<a href="#l66.235"></a><span id="l66.235">             if (expected.length == 1) {</span>
<a href="#l66.236"></a><span id="l66.236">                 if ([&quot;DTSTART&quot;, &quot;DTEND&quot;].includes(aDiff.property)) {</span>
<a href="#l66.237"></a><span id="l66.237">                     let prop = aDiff.proposed ? formatDt(aDiff.proposed) : null;</span>
<a href="#l66.238"></a><span id="l66.238">                     ok(</span>
<a href="#l66.239"></a><span id="l66.239">                         prop &amp;&amp; expected[0].proposed.includes(prop),</span>
<a href="#l66.240"></a><span id="l66.240">                         &quot;(test #&quot; + i + &quot;: difference &quot; + aDiff.property + &quot;: proposed '&quot; + prop + &quot;')&quot;</span>
<a href="#l66.241"></a><span id="l66.241">                     );</span>
<a href="#l66.242"></a><span id="l66.242" class="difflineminus">-                    prop = aDiff.original ? formatDt(aDiff.original) : null</span>
<a href="#l66.243"></a><span id="l66.243" class="difflineplus">+                    prop = aDiff.original ? formatDt(aDiff.original) : null;</span>
<a href="#l66.244"></a><span id="l66.244">                     ok(</span>
<a href="#l66.245"></a><span id="l66.245">                         prop &amp;&amp; expected[0].original.includes(prop),</span>
<a href="#l66.246"></a><span id="l66.246">                         &quot;(test #&quot; + i + &quot;: difference &quot; + aDiff.property + &quot;: original '&quot; + prop + &quot;')&quot;</span>
<a href="#l66.247"></a><span id="l66.247">                     );</span>
<a href="#l66.248"></a><span id="l66.248">                 } else {</span>
<a href="#l66.249"></a><span id="l66.249">                     equal(</span>
<a href="#l66.250"></a><span id="l66.250">                         aDiff.proposed,</span>
<a href="#l66.251"></a><span id="l66.251">                         expected[0].proposed,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/calendar/test/unit/test_recur.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/calendar/test/unit/test_recur.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -81,39 +81,43 @@ function test_rules() {</span>
<a href="#l67.4"></a><span id="l67.4">         test_clone(event);</span>
<a href="#l67.5"></a><span id="l67.5">     }</span>
<a href="#l67.6"></a><span id="l67.6"> </span>
<a href="#l67.7"></a><span id="l67.7">     // Test specific items/rules</span>
<a href="#l67.8"></a><span id="l67.8">     check_recur(makeEvent(&quot;DESCRIPTION:Repeat every tuesday and wednesday starting &quot; +</span>
<a href="#l67.9"></a><span id="l67.9">                                      &quot;Tue 2nd April 2002\n&quot; +</span>
<a href="#l67.10"></a><span id="l67.10">                          &quot;RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=6;BYDAY=TU,WE\n&quot; +</span>
<a href="#l67.11"></a><span id="l67.11">                          &quot;DTSTART:20020402T114500\n&quot; +</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-                         &quot;DTEND:20020402T124500\n&quot;),</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineminus">-                         [&quot;20020402T114500&quot;, &quot;20020403T114500&quot;, &quot;20020409T114500&quot;,</span>
<a href="#l67.14"></a><span id="l67.14" class="difflineminus">-                          &quot;20020410T114500&quot;, &quot;20020416T114500&quot;, &quot;20020417T114500&quot;]);</span>
<a href="#l67.15"></a><span id="l67.15" class="difflineplus">+                         &quot;DTEND:20020402T124500\n&quot;), [</span>
<a href="#l67.16"></a><span id="l67.16" class="difflineplus">+                             &quot;20020402T114500&quot;, &quot;20020403T114500&quot;,</span>
<a href="#l67.17"></a><span id="l67.17" class="difflineplus">+                             &quot;20020409T114500&quot;, &quot;20020410T114500&quot;,</span>
<a href="#l67.18"></a><span id="l67.18" class="difflineplus">+                             &quot;20020416T114500&quot;, &quot;20020417T114500&quot;]);</span>
<a href="#l67.19"></a><span id="l67.19" class="difflineplus">+</span>
<a href="#l67.20"></a><span id="l67.20">     check_recur(makeEvent(&quot;DESCRIPTION:Repeat every thursday starting Tue 2nd April 2002\n&quot; +</span>
<a href="#l67.21"></a><span id="l67.21">                          &quot;RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=6;BYDAY=TH\n&quot; +</span>
<a href="#l67.22"></a><span id="l67.22">                          &quot;DTSTART:20020402T114500\n&quot; +</span>
<a href="#l67.23"></a><span id="l67.23" class="difflineminus">-                         &quot;DTEND:20020402T124500\n&quot;),</span>
<a href="#l67.24"></a><span id="l67.24" class="difflineminus">-                         [&quot;20020402T114500&quot;, // DTSTART part of the resulting set</span>
<a href="#l67.25"></a><span id="l67.25" class="difflineminus">-                          &quot;20020404T114500&quot;, &quot;20020411T114500&quot;, &quot;20020418T114500&quot;,</span>
<a href="#l67.26"></a><span id="l67.26" class="difflineminus">-                          &quot;20020425T114500&quot;, &quot;20020502T114500&quot;, &quot;20020509T114500&quot;]);</span>
<a href="#l67.27"></a><span id="l67.27" class="difflineplus">+                         &quot;DTEND:20020402T124500\n&quot;), [</span>
<a href="#l67.28"></a><span id="l67.28" class="difflineplus">+                             &quot;20020402T114500&quot;, // DTSTART part of the resulting set</span>
<a href="#l67.29"></a><span id="l67.29" class="difflineplus">+                             &quot;20020404T114500&quot;, &quot;20020411T114500&quot;, &quot;20020418T114500&quot;,</span>
<a href="#l67.30"></a><span id="l67.30" class="difflineplus">+                             &quot;20020425T114500&quot;, &quot;20020502T114500&quot;, &quot;20020509T114500&quot;]);</span>
<a href="#l67.31"></a><span id="l67.31" class="difflineplus">+</span>
<a href="#l67.32"></a><span id="l67.32">     // Bug 469840 -  Recurring Sundays incorrect</span>
<a href="#l67.33"></a><span id="l67.33">     check_recur(makeEvent(&quot;DESCRIPTION:RRULE:FREQ=WEEKLY;INTERVAL=2;COUNT=6;BYDAY=WE,SA,SU with DTSTART:20081217T133000\n&quot; +</span>
<a href="#l67.34"></a><span id="l67.34">                          &quot;RRULE:FREQ=WEEKLY;INTERVAL=2;COUNT=6;BYDAY=WE,SA,SU\n&quot; +</span>
<a href="#l67.35"></a><span id="l67.35">                          &quot;DTSTART:20081217T133000\n&quot; +</span>
<a href="#l67.36"></a><span id="l67.36" class="difflineminus">-                         &quot;DTEND:20081217T143000\n&quot;),</span>
<a href="#l67.37"></a><span id="l67.37" class="difflineminus">-               [&quot;20081217T133000&quot;, &quot;20081220T133000&quot;, &quot;20081221T133000&quot;,</span>
<a href="#l67.38"></a><span id="l67.38" class="difflineminus">-                &quot;20081231T133000&quot;, &quot;20090103T133000&quot;, &quot;20090104T133000&quot;]);</span>
<a href="#l67.39"></a><span id="l67.39" class="difflineplus">+                         &quot;DTEND:20081217T143000\n&quot;), [</span>
<a href="#l67.40"></a><span id="l67.40" class="difflineplus">+                             &quot;20081217T133000&quot;, &quot;20081220T133000&quot;, &quot;20081221T133000&quot;,</span>
<a href="#l67.41"></a><span id="l67.41" class="difflineplus">+                             &quot;20081231T133000&quot;, &quot;20090103T133000&quot;, &quot;20090104T133000&quot;]);</span>
<a href="#l67.42"></a><span id="l67.42" class="difflineplus">+</span>
<a href="#l67.43"></a><span id="l67.43">     check_recur(makeEvent(&quot;DESCRIPTION:RRULE:FREQ=WEEKLY;INTERVAL=2;COUNT=6;WKST=SU;BYDAY=WE,SA,SU with DTSTART:20081217T133000\n&quot; +</span>
<a href="#l67.44"></a><span id="l67.44">                          &quot;RRULE:FREQ=WEEKLY;INTERVAL=2;COUNT=6;WKST=SU;BYDAY=WE,SA,SU\n&quot; +</span>
<a href="#l67.45"></a><span id="l67.45">                          &quot;DTSTART:20081217T133000\n&quot; +</span>
<a href="#l67.46"></a><span id="l67.46" class="difflineminus">-                         &quot;DTEND:20081217T143000\n&quot;),</span>
<a href="#l67.47"></a><span id="l67.47" class="difflineminus">-               [&quot;20081217T133000&quot;, &quot;20081220T133000&quot;, &quot;20081228T133000&quot;,</span>
<a href="#l67.48"></a><span id="l67.48" class="difflineminus">-                &quot;20081231T133000&quot;, &quot;20090103T133000&quot;, &quot;20090111T133000&quot;]);</span>
<a href="#l67.49"></a><span id="l67.49" class="difflineplus">+                         &quot;DTEND:20081217T143000\n&quot;), [</span>
<a href="#l67.50"></a><span id="l67.50" class="difflineplus">+                             &quot;20081217T133000&quot;, &quot;20081220T133000&quot;, &quot;20081228T133000&quot;,</span>
<a href="#l67.51"></a><span id="l67.51" class="difflineplus">+                             &quot;20081231T133000&quot;, &quot;20090103T133000&quot;, &quot;20090111T133000&quot;]);</span>
<a href="#l67.52"></a><span id="l67.52"> </span>
<a href="#l67.53"></a><span id="l67.53">     // bug 353797: occurrences for repeating all day events should stay &quot;all-day&quot;</span>
<a href="#l67.54"></a><span id="l67.54">     check_recur(makeEvent(&quot;DESCRIPTION:Allday repeat every thursday starting Tue 2nd April 2002\n&quot; +</span>
<a href="#l67.55"></a><span id="l67.55">                          &quot;RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=3;BYDAY=TH\n&quot; +</span>
<a href="#l67.56"></a><span id="l67.56">                          &quot;DTSTART;VALUE=DATE:20020404\n&quot; +</span>
<a href="#l67.57"></a><span id="l67.57">                          &quot;DTEND;VALUE=DATE:20020405\n&quot;),</span>
<a href="#l67.58"></a><span id="l67.58">                          [&quot;20020404&quot;, &quot;20020411&quot;, &quot;20020418&quot;]);</span>
<a href="#l67.59"></a><span id="l67.59"> </span>
<a href="#l67.60"></a><span id="l67.60" class="difflineat">@@ -124,27 +128,27 @@ function test_rules() {</span>
<a href="#l67.61"></a><span id="l67.61">                          [&quot;19970512T090000&quot;, &quot;19980511T090000&quot;, &quot;19990517T090000&quot; +</span>
<a href="#l67.62"></a><span id="l67.62">                           &quot;20000515T090000&quot;, &quot;20010514T090000&quot;, &quot;20020513T090000&quot;]);</span>
<a href="#l67.63"></a><span id="l67.63">     */</span>
<a href="#l67.64"></a><span id="l67.64"> </span>
<a href="#l67.65"></a><span id="l67.65">     // bug 899326: Recurrences with BYMONTHDAY=X,X,31 don't show at all in months with less than 31 days</span>
<a href="#l67.66"></a><span id="l67.66">     check_recur(makeEvent(&quot;DESCRIPTION:Every 11th &amp; 31st of every Month\n&quot; +</span>
<a href="#l67.67"></a><span id="l67.67">                 &quot;RRULE:FREQ=MONTHLY;COUNT=6;BYMONTHDAY=11,31\n&quot; +</span>
<a href="#l67.68"></a><span id="l67.68">                 &quot;DTSTART:20130731T160000\n&quot; +</span>
<a href="#l67.69"></a><span id="l67.69" class="difflineminus">-                &quot;DTEND:20130731T170000)\n&quot;),</span>
<a href="#l67.70"></a><span id="l67.70" class="difflineminus">-                [&quot;20130731T160000&quot;, &quot;20130811T160000&quot;, &quot;20130831T160000&quot;,</span>
<a href="#l67.71"></a><span id="l67.71" class="difflineminus">-                 &quot;20130911T160000&quot;, &quot;20131011T160000&quot;, &quot;20131031T160000&quot;]);</span>
<a href="#l67.72"></a><span id="l67.72" class="difflineplus">+                &quot;DTEND:20130731T170000)\n&quot;), [</span>
<a href="#l67.73"></a><span id="l67.73" class="difflineplus">+                    &quot;20130731T160000&quot;, &quot;20130811T160000&quot;, &quot;20130831T160000&quot;,</span>
<a href="#l67.74"></a><span id="l67.74" class="difflineplus">+                    &quot;20130911T160000&quot;, &quot;20131011T160000&quot;, &quot;20131031T160000&quot;]);</span>
<a href="#l67.75"></a><span id="l67.75"> </span>
<a href="#l67.76"></a><span id="l67.76">     // bug 899770: Monthly Recurrences with BYDAY and BYMONTHDAY with more than 2 dates are not working</span>
<a href="#l67.77"></a><span id="l67.77">     check_recur(makeEvent(&quot;DESCRIPTION:Every WE &amp; SA the 6th, 20th &amp; 31st\n&quot; +</span>
<a href="#l67.78"></a><span id="l67.78">                 &quot;RRULE:FREQ=MONTHLY;COUNT=6;BYDAY=WE,SA;BYMONTHDAY=6,20,31\n&quot; +</span>
<a href="#l67.79"></a><span id="l67.79">                 &quot;DTSTART:20130706T160000\n&quot; +</span>
<a href="#l67.80"></a><span id="l67.80" class="difflineminus">-                &quot;DTEND:20130706T170000)\n&quot;),</span>
<a href="#l67.81"></a><span id="l67.81" class="difflineminus">-                [&quot;20130706T160000&quot;, &quot;20130720T160000&quot;, &quot;20130731T160000&quot;,</span>
<a href="#l67.82"></a><span id="l67.82" class="difflineminus">-                 &quot;20130831T160000&quot;, &quot;20131106T160000&quot;, &quot;20131120T160000&quot;]);</span>
<a href="#l67.83"></a><span id="l67.83" class="difflineplus">+                &quot;DTEND:20130706T170000)\n&quot;), [</span>
<a href="#l67.84"></a><span id="l67.84" class="difflineplus">+                    &quot;20130706T160000&quot;, &quot;20130720T160000&quot;, &quot;20130731T160000&quot;,</span>
<a href="#l67.85"></a><span id="l67.85" class="difflineplus">+                    &quot;20130831T160000&quot;, &quot;20131106T160000&quot;, &quot;20131120T160000&quot;]);</span>
<a href="#l67.86"></a><span id="l67.86"> </span>
<a href="#l67.87"></a><span id="l67.87">     check_recur(makeEvent(&quot;DESCRIPTION:Every day, use exdate to exclude the second day\n&quot; +</span>
<a href="#l67.88"></a><span id="l67.88">                          &quot;RRULE:FREQ=DAILY;COUNT=3\n&quot; +</span>
<a href="#l67.89"></a><span id="l67.89">                          &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l67.90"></a><span id="l67.90">                          &quot;EXDATE:20020403T114500Z\n&quot;),</span>
<a href="#l67.91"></a><span id="l67.91">                          [&quot;20020402T114500Z&quot;, &quot;20020404T114500Z&quot;]);</span>
<a href="#l67.92"></a><span id="l67.92"> </span>
<a href="#l67.93"></a><span id="l67.93">     // test for issue 734245</span>
<a href="#l67.94"></a><span id="l67.94" class="difflineat">@@ -171,87 +175,114 @@ function test_rules() {</span>
<a href="#l67.95"></a><span id="l67.95">                                          &quot;DTSTART:20020403T114500Z\n&quot; +</span>
<a href="#l67.96"></a><span id="l67.96">                                          &quot;UID:123\n&quot; +</span>
<a href="#l67.97"></a><span id="l67.97">                                          &quot;RECURRENCE-ID:20020404T114500Z\n&quot; +</span>
<a href="#l67.98"></a><span id="l67.98">                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.99"></a><span id="l67.99">                [&quot;20020402T114500Z&quot;, &quot;20020403T114500Z&quot;],</span>
<a href="#l67.100"></a><span id="l67.100">                true); // ignore next occ check, bug 455490</span>
<a href="#l67.101"></a><span id="l67.101"> </span>
<a href="#l67.102"></a><span id="l67.102">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.103"></a><span id="l67.103" class="difflineminus">-                                         &quot;UID:123\n&quot; +</span>
<a href="#l67.104"></a><span id="l67.104" class="difflineminus">-                                         &quot;DESCRIPTION:Every day, exception put on exdated start day\n&quot; +</span>
<a href="#l67.105"></a><span id="l67.105" class="difflineminus">-                                         &quot;RRULE:FREQ=DAILY;COUNT=3\n&quot; +</span>
<a href="#l67.106"></a><span id="l67.106" class="difflineminus">-                                         &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l67.107"></a><span id="l67.107" class="difflineminus">-                                         &quot;EXDATE:20020402T114500Z\n&quot; +</span>
<a href="#l67.108"></a><span id="l67.108" class="difflineminus">-                                         &quot;END:VEVENT\n&quot; +</span>
<a href="#l67.109"></a><span id="l67.109" class="difflineminus">-                                         &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l67.110"></a><span id="l67.110" class="difflineminus">-                                         &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l67.111"></a><span id="l67.111" class="difflineminus">-                                         &quot;UID:123\n&quot; +</span>
<a href="#l67.112"></a><span id="l67.112" class="difflineminus">-                                         &quot;RECURRENCE-ID:20020404T114500Z\n&quot; +</span>
<a href="#l67.113"></a><span id="l67.113" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.114"></a><span id="l67.114" class="difflineplus">+                                          &quot;UID:123\n&quot; +</span>
<a href="#l67.115"></a><span id="l67.115" class="difflineplus">+                                          &quot;DESCRIPTION:Every day, exception put on exdated start day\n&quot; +</span>
<a href="#l67.116"></a><span id="l67.116" class="difflineplus">+                                          &quot;RRULE:FREQ=DAILY;COUNT=3\n&quot; +</span>
<a href="#l67.117"></a><span id="l67.117" class="difflineplus">+                                          &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l67.118"></a><span id="l67.118" class="difflineplus">+                                          &quot;EXDATE:20020402T114500Z\n&quot; +</span>
<a href="#l67.119"></a><span id="l67.119" class="difflineplus">+                                          &quot;END:VEVENT\n&quot; +</span>
<a href="#l67.120"></a><span id="l67.120" class="difflineplus">+                                          &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l67.121"></a><span id="l67.121" class="difflineplus">+                                          &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l67.122"></a><span id="l67.122" class="difflineplus">+                                          &quot;UID:123\n&quot; +</span>
<a href="#l67.123"></a><span id="l67.123" class="difflineplus">+                                          &quot;RECURRENCE-ID:20020404T114500Z\n&quot; +</span>
<a href="#l67.124"></a><span id="l67.124" class="difflineplus">+                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.125"></a><span id="l67.125">                [&quot;20020402T114500Z&quot;, &quot;20020403T114500Z&quot;],</span>
<a href="#l67.126"></a><span id="l67.126">                true /* ignore next occ check, bug 455490 */);</span>
<a href="#l67.127"></a><span id="l67.127"> </span>
<a href="#l67.128"></a><span id="l67.128">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.129"></a><span id="l67.129" class="difflineminus">-                                         &quot;DESCRIPTION:Repeat Daily on weekdays with UNTIL\n&quot; +</span>
<a href="#l67.130"></a><span id="l67.130" class="difflineminus">-                                         &quot;RRULE:FREQ=DAILY;UNTIL=20111217T220000Z;BYDAY=MO,TU,WE,TH,FR\n&quot; +</span>
<a href="#l67.131"></a><span id="l67.131" class="difflineminus">-                                         &quot;DTSTART:20111212T220000Z\n&quot; +</span>
<a href="#l67.132"></a><span id="l67.132" class="difflineminus">-                                         &quot;DTEND:20111212T230000Z\n&quot; +</span>
<a href="#l67.133"></a><span id="l67.133" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.134"></a><span id="l67.134" class="difflineminus">-               [&quot;20111212T220000Z&quot;, &quot;20111213T220000Z&quot;, &quot;20111214T220000Z&quot;, &quot;20111215T220000Z&quot;,</span>
<a href="#l67.135"></a><span id="l67.135" class="difflineminus">-                &quot;20111216T220000Z&quot;],</span>
<a href="#l67.136"></a><span id="l67.136" class="difflineminus">-               false);</span>
<a href="#l67.137"></a><span id="l67.137" class="difflineplus">+                                          &quot;DESCRIPTION:Repeat Daily on weekdays with UNTIL\n&quot; +</span>
<a href="#l67.138"></a><span id="l67.138" class="difflineplus">+                                          &quot;RRULE:FREQ=DAILY;UNTIL=20111217T220000Z;BYDAY=MO,TU,WE,TH,FR\n&quot; +</span>
<a href="#l67.139"></a><span id="l67.139" class="difflineplus">+                                          &quot;DTSTART:20111212T220000Z\n&quot; +</span>
<a href="#l67.140"></a><span id="l67.140" class="difflineplus">+                                          &quot;DTEND:20111212T230000Z\n&quot; +</span>
<a href="#l67.141"></a><span id="l67.141" class="difflineplus">+                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.142"></a><span id="l67.142" class="difflineplus">+                                              &quot;20111212T220000Z&quot;,</span>
<a href="#l67.143"></a><span id="l67.143" class="difflineplus">+                                              &quot;20111213T220000Z&quot;,</span>
<a href="#l67.144"></a><span id="l67.144" class="difflineplus">+                                              &quot;20111214T220000Z&quot;,</span>
<a href="#l67.145"></a><span id="l67.145" class="difflineplus">+                                              &quot;20111215T220000Z&quot;,</span>
<a href="#l67.146"></a><span id="l67.146" class="difflineplus">+                                              &quot;20111216T220000Z&quot;</span>
<a href="#l67.147"></a><span id="l67.147" class="difflineplus">+                                          ], false);</span>
<a href="#l67.148"></a><span id="l67.148"> </span>
<a href="#l67.149"></a><span id="l67.149">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.150"></a><span id="l67.150">                                          &quot;DESCRIPTION:Repeat Daily on weekdays with UNTIL and exception\n&quot; +</span>
<a href="#l67.151"></a><span id="l67.151">                                          &quot;RRULE:FREQ=DAILY;UNTIL=20111217T220000Z;BYDAY=MO,TU,WE,TH,FR\n&quot; +</span>
<a href="#l67.152"></a><span id="l67.152">                                          &quot;EXDATE:20111214T220000Z\n&quot; +</span>
<a href="#l67.153"></a><span id="l67.153">                                          &quot;DTSTART:20111212T220000Z\n&quot; +</span>
<a href="#l67.154"></a><span id="l67.154">                                          &quot;DTEND:20111212T230000Z\n&quot; +</span>
<a href="#l67.155"></a><span id="l67.155" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.156"></a><span id="l67.156" class="difflineminus">-               [&quot;20111212T220000Z&quot;, &quot;20111213T220000Z&quot;, &quot;20111215T220000Z&quot;, &quot;20111216T220000Z&quot;],</span>
<a href="#l67.157"></a><span id="l67.157" class="difflineminus">-               false);</span>
<a href="#l67.158"></a><span id="l67.158" class="difflineplus">+                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.159"></a><span id="l67.159" class="difflineplus">+                                             &quot;20111212T220000Z&quot;,</span>
<a href="#l67.160"></a><span id="l67.160" class="difflineplus">+                                             &quot;20111213T220000Z&quot;,</span>
<a href="#l67.161"></a><span id="l67.161" class="difflineplus">+                                             &quot;20111215T220000Z&quot;,</span>
<a href="#l67.162"></a><span id="l67.162" class="difflineplus">+                                             &quot;20111216T220000Z&quot;</span>
<a href="#l67.163"></a><span id="l67.163" class="difflineplus">+                                         ], false);</span>
<a href="#l67.164"></a><span id="l67.164"> </span>
<a href="#l67.165"></a><span id="l67.165">     // Bug 958978: Yearly recurrence, the last day of a specified month.</span>
<a href="#l67.166"></a><span id="l67.166">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.167"></a><span id="l67.167">                                           &quot;DESCRIPTION:Repeat Yearly the last day of February\n&quot; +</span>
<a href="#l67.168"></a><span id="l67.168">                                           &quot;RRULE:FREQ=YEARLY;COUNT=6;BYMONTHDAY=-1;BYMONTH=2\n&quot; +</span>
<a href="#l67.169"></a><span id="l67.169">                                           &quot;DTSTART:20140228T220000Z\n&quot; +</span>
<a href="#l67.170"></a><span id="l67.170">                                           &quot;DTEND:20140228T230000Z\n&quot; +</span>
<a href="#l67.171"></a><span id="l67.171" class="difflineminus">-                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.172"></a><span id="l67.172" class="difflineminus">-                [&quot;20140228T220000Z&quot;, &quot;20150228T220000Z&quot;, &quot;20160229T220000Z&quot;,</span>
<a href="#l67.173"></a><span id="l67.173" class="difflineminus">-                 &quot;20170228T220000Z&quot;, &quot;20180228T220000Z&quot;, &quot;20190228T220000Z&quot;],</span>
<a href="#l67.174"></a><span id="l67.174" class="difflineminus">-                false);</span>
<a href="#l67.175"></a><span id="l67.175" class="difflineplus">+                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.176"></a><span id="l67.176" class="difflineplus">+                                              &quot;20140228T220000Z&quot;,</span>
<a href="#l67.177"></a><span id="l67.177" class="difflineplus">+                                              &quot;20150228T220000Z&quot;,</span>
<a href="#l67.178"></a><span id="l67.178" class="difflineplus">+                                              &quot;20160229T220000Z&quot;,</span>
<a href="#l67.179"></a><span id="l67.179" class="difflineplus">+                                              &quot;20170228T220000Z&quot;,</span>
<a href="#l67.180"></a><span id="l67.180" class="difflineplus">+                                              &quot;20180228T220000Z&quot;,</span>
<a href="#l67.181"></a><span id="l67.181" class="difflineplus">+                                              &quot;20190228T220000Z&quot;</span>
<a href="#l67.182"></a><span id="l67.182" class="difflineplus">+                                          ], false);</span>
<a href="#l67.183"></a><span id="l67.183"> </span>
<a href="#l67.184"></a><span id="l67.184">     // Bug 958978: Yearly recurrence, the last day of a not specified month.</span>
<a href="#l67.185"></a><span id="l67.185">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.186"></a><span id="l67.186">                                           &quot;DESCRIPTION:Repeat Yearly the last day of April without BYMONTH=4 in the rule\n&quot; +</span>
<a href="#l67.187"></a><span id="l67.187">                                           &quot;RRULE:FREQ=YEARLY;COUNT=6;BYMONTHDAY=-1\n&quot; +</span>
<a href="#l67.188"></a><span id="l67.188">                                           &quot;DTSTART:20140430T220000Z\n&quot; +</span>
<a href="#l67.189"></a><span id="l67.189">                                           &quot;DTEND:20140430T230000Z\n&quot; +</span>
<a href="#l67.190"></a><span id="l67.190" class="difflineminus">-                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.191"></a><span id="l67.191" class="difflineminus">-                [&quot;20140430T220000Z&quot;, &quot;20150430T220000Z&quot;, &quot;20160430T220000Z&quot;,</span>
<a href="#l67.192"></a><span id="l67.192" class="difflineminus">-                 &quot;20170430T220000Z&quot;, &quot;20180430T220000Z&quot;, &quot;20190430T220000Z&quot;],</span>
<a href="#l67.193"></a><span id="l67.193" class="difflineminus">-                false);</span>
<a href="#l67.194"></a><span id="l67.194" class="difflineplus">+                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.195"></a><span id="l67.195" class="difflineplus">+                                              &quot;20140430T220000Z&quot;,</span>
<a href="#l67.196"></a><span id="l67.196" class="difflineplus">+                                              &quot;20150430T220000Z&quot;,</span>
<a href="#l67.197"></a><span id="l67.197" class="difflineplus">+                                              &quot;20160430T220000Z&quot;,</span>
<a href="#l67.198"></a><span id="l67.198" class="difflineplus">+                                              &quot;20170430T220000Z&quot;,</span>
<a href="#l67.199"></a><span id="l67.199" class="difflineplus">+                                              &quot;20180430T220000Z&quot;,</span>
<a href="#l67.200"></a><span id="l67.200" class="difflineplus">+                                              &quot;20190430T220000Z&quot;</span>
<a href="#l67.201"></a><span id="l67.201" class="difflineplus">+                                          ], false);</span>
<a href="#l67.202"></a><span id="l67.202"> </span>
<a href="#l67.203"></a><span id="l67.203">     // Bug 958978 - Check a yearly recurrence on every WE and FR of January and March</span>
<a href="#l67.204"></a><span id="l67.204">     //              (more BYMONTH and more BYDAY).</span>
<a href="#l67.205"></a><span id="l67.205">     // Check for the occurrences in the first year.</span>
<a href="#l67.206"></a><span id="l67.206">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.207"></a><span id="l67.207">                                          &quot;DESCRIPTION:Repeat Yearly every WE and FR of January and March (more BYMONTH and more BYDAY)\n&quot; +</span>
<a href="#l67.208"></a><span id="l67.208">                                          &quot;RRULE:FREQ=YEARLY;COUNT=18;BYMONTH=1,3;BYDAY=WE,FR\n&quot; +</span>
<a href="#l67.209"></a><span id="l67.209">                                          &quot;DTSTART:20140101T150000Z\n&quot; +</span>
<a href="#l67.210"></a><span id="l67.210">                                          &quot;DTEND:20140101T160000Z\n&quot; +</span>
<a href="#l67.211"></a><span id="l67.211" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.212"></a><span id="l67.212" class="difflineminus">-               [&quot;20140101T150000Z&quot;, &quot;20140103T150000Z&quot;, &quot;20140108T150000Z&quot;, &quot;20140110T150000Z&quot;,</span>
<a href="#l67.213"></a><span id="l67.213" class="difflineminus">-                &quot;20140115T150000Z&quot;, &quot;20140117T150000Z&quot;, &quot;20140122T150000Z&quot;, &quot;20140124T150000Z&quot;,</span>
<a href="#l67.214"></a><span id="l67.214" class="difflineminus">-                &quot;20140129T150000Z&quot;, &quot;20140131T150000Z&quot;,</span>
<a href="#l67.215"></a><span id="l67.215" class="difflineminus">-                &quot;20140305T150000Z&quot;, &quot;20140307T150000Z&quot;, &quot;20140312T150000Z&quot;, &quot;20140314T150000Z&quot;,</span>
<a href="#l67.216"></a><span id="l67.216" class="difflineminus">-                &quot;20140319T150000Z&quot;, &quot;20140321T150000Z&quot;, &quot;20140326T150000Z&quot;, &quot;20140328T150000Z&quot;],</span>
<a href="#l67.217"></a><span id="l67.217" class="difflineminus">-               false);</span>
<a href="#l67.218"></a><span id="l67.218" class="difflineplus">+                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.219"></a><span id="l67.219" class="difflineplus">+                                             &quot;20140101T150000Z&quot;,</span>
<a href="#l67.220"></a><span id="l67.220" class="difflineplus">+                                             &quot;20140103T150000Z&quot;,</span>
<a href="#l67.221"></a><span id="l67.221" class="difflineplus">+                                             &quot;20140108T150000Z&quot;,</span>
<a href="#l67.222"></a><span id="l67.222" class="difflineplus">+                                             &quot;20140110T150000Z&quot;,</span>
<a href="#l67.223"></a><span id="l67.223" class="difflineplus">+                                             &quot;20140115T150000Z&quot;,</span>
<a href="#l67.224"></a><span id="l67.224" class="difflineplus">+                                             &quot;20140117T150000Z&quot;,</span>
<a href="#l67.225"></a><span id="l67.225" class="difflineplus">+                                             &quot;20140122T150000Z&quot;,</span>
<a href="#l67.226"></a><span id="l67.226" class="difflineplus">+                                             &quot;20140124T150000Z&quot;,</span>
<a href="#l67.227"></a><span id="l67.227" class="difflineplus">+                                             &quot;20140129T150000Z&quot;,</span>
<a href="#l67.228"></a><span id="l67.228" class="difflineplus">+                                             &quot;20140131T150000Z&quot;,</span>
<a href="#l67.229"></a><span id="l67.229" class="difflineplus">+                                             &quot;20140305T150000Z&quot;,</span>
<a href="#l67.230"></a><span id="l67.230" class="difflineplus">+                                             &quot;20140307T150000Z&quot;,</span>
<a href="#l67.231"></a><span id="l67.231" class="difflineplus">+                                             &quot;20140312T150000Z&quot;,</span>
<a href="#l67.232"></a><span id="l67.232" class="difflineplus">+                                             &quot;20140314T150000Z&quot;,</span>
<a href="#l67.233"></a><span id="l67.233" class="difflineplus">+                                             &quot;20140319T150000Z&quot;,</span>
<a href="#l67.234"></a><span id="l67.234" class="difflineplus">+                                             &quot;20140321T150000Z&quot;,</span>
<a href="#l67.235"></a><span id="l67.235" class="difflineplus">+                                             &quot;20140326T150000Z&quot;,</span>
<a href="#l67.236"></a><span id="l67.236" class="difflineplus">+                                             &quot;20140328T150000Z&quot;</span>
<a href="#l67.237"></a><span id="l67.237" class="difflineplus">+                                         ], false);</span>
<a href="#l67.238"></a><span id="l67.238"> </span>
<a href="#l67.239"></a><span id="l67.239">     // Bug 958978 - Check a yearly recurrence every day of January (BYMONTH and more BYDAY).</span>
<a href="#l67.240"></a><span id="l67.240">     // Check for all the occurrences in the first year.</span>
<a href="#l67.241"></a><span id="l67.241">     let expectedDates = [];</span>
<a href="#l67.242"></a><span id="l67.242">     for (let i = 1; i &lt; 32; i++) {</span>
<a href="#l67.243"></a><span id="l67.243">         expectedDates.push(&quot;201401&quot; + (i &lt; 10 ? &quot;0&quot; + i : i) + &quot;T150000Z&quot;);</span>
<a href="#l67.244"></a><span id="l67.244">     }</span>
<a href="#l67.245"></a><span id="l67.245">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.246"></a><span id="l67.246" class="difflineat">@@ -265,148 +296,154 @@ function test_rules() {</span>
<a href="#l67.247"></a><span id="l67.247"> </span>
<a href="#l67.248"></a><span id="l67.248">     // Bug 958974 - Monthly recurrence every WE, FR and the third MO (monthly with more bydays).</span>
<a href="#l67.249"></a><span id="l67.249">     // Check the occurrences in the first month until the week with the first monday of the rule.</span>
<a href="#l67.250"></a><span id="l67.250">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.251"></a><span id="l67.251">                                          &quot;DESCRIPTION:Repeat Monthly every Wednesday, Friday and the third Monday\n&quot; +</span>
<a href="#l67.252"></a><span id="l67.252">                                          &quot;RRULE:FREQ=MONTHLY;COUNT=8;BYDAY=3MO,WE,FR\n&quot; +</span>
<a href="#l67.253"></a><span id="l67.253">                                          &quot;DTSTART:20150102T080000Z\n&quot; +</span>
<a href="#l67.254"></a><span id="l67.254">                                          &quot;DTEND:20150102T090000Z\n&quot; +</span>
<a href="#l67.255"></a><span id="l67.255" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.256"></a><span id="l67.256" class="difflineminus">-               [&quot;20150102T080000Z&quot;, &quot;20150107T080000Z&quot;, &quot;20150109T080000Z&quot;,</span>
<a href="#l67.257"></a><span id="l67.257" class="difflineminus">-                &quot;20150114T080000Z&quot;, &quot;20150116T080000Z&quot;, &quot;20150119T080000Z&quot;,</span>
<a href="#l67.258"></a><span id="l67.258" class="difflineminus">-                &quot;20150121T080000Z&quot;, &quot;20150123T080000Z&quot;],</span>
<a href="#l67.259"></a><span id="l67.259" class="difflineminus">-               false);</span>
<a href="#l67.260"></a><span id="l67.260" class="difflineplus">+                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.261"></a><span id="l67.261" class="difflineplus">+                                             &quot;20150102T080000Z&quot;,</span>
<a href="#l67.262"></a><span id="l67.262" class="difflineplus">+                                             &quot;20150107T080000Z&quot;,</span>
<a href="#l67.263"></a><span id="l67.263" class="difflineplus">+                                             &quot;20150109T080000Z&quot;,</span>
<a href="#l67.264"></a><span id="l67.264" class="difflineplus">+                                             &quot;20150114T080000Z&quot;,</span>
<a href="#l67.265"></a><span id="l67.265" class="difflineplus">+                                             &quot;20150116T080000Z&quot;,</span>
<a href="#l67.266"></a><span id="l67.266" class="difflineplus">+                                             &quot;20150119T080000Z&quot;,</span>
<a href="#l67.267"></a><span id="l67.267" class="difflineplus">+                                             &quot;20150121T080000Z&quot;,</span>
<a href="#l67.268"></a><span id="l67.268" class="difflineplus">+                                             &quot;20150123T080000Z&quot;</span>
<a href="#l67.269"></a><span id="l67.269" class="difflineplus">+                                         ], false);</span>
<a href="#l67.270"></a><span id="l67.270"> </span>
<a href="#l67.271"></a><span id="l67.271">     // Bug 419490 - Monthly recurrence, the fifth Saturday starting from February.</span>
<a href="#l67.272"></a><span id="l67.272">     // Check a monthly rule that specifies a day that is not part of the month</span>
<a href="#l67.273"></a><span id="l67.273">     // the events starts in.</span>
<a href="#l67.274"></a><span id="l67.274">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.275"></a><span id="l67.275">                                          &quot;DESCRIPTION:Repeat Monthly the fifth Saturday\n&quot; +</span>
<a href="#l67.276"></a><span id="l67.276">                                          &quot;RRULE:FREQ=MONTHLY;COUNT=6;BYDAY=5SA\n&quot; +</span>
<a href="#l67.277"></a><span id="l67.277">                                          &quot;DTSTART:20150202T080000Z\n&quot; +</span>
<a href="#l67.278"></a><span id="l67.278">                                          &quot;DTEND:20150202T090000Z\n&quot; +</span>
<a href="#l67.279"></a><span id="l67.279" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.280"></a><span id="l67.280" class="difflineminus">-               [&quot;20150202T080000Z&quot;,</span>
<a href="#l67.281"></a><span id="l67.281" class="difflineminus">-                &quot;20150530T080000Z&quot;, &quot;20150829T080000Z&quot;, &quot;20151031T080000Z&quot;,</span>
<a href="#l67.282"></a><span id="l67.282" class="difflineminus">-                &quot;20160130T080000Z&quot;, &quot;20160430T080000Z&quot;, &quot;20160730T080000Z&quot;],</span>
<a href="#l67.283"></a><span id="l67.283" class="difflineminus">-               false);</span>
<a href="#l67.284"></a><span id="l67.284" class="difflineplus">+                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.285"></a><span id="l67.285" class="difflineplus">+                                             &quot;20150202T080000Z&quot;, &quot;20150530T080000Z&quot;, &quot;20150829T080000Z&quot;,</span>
<a href="#l67.286"></a><span id="l67.286" class="difflineplus">+                                             &quot;20151031T080000Z&quot;, &quot;20160130T080000Z&quot;, &quot;20160430T080000Z&quot;,</span>
<a href="#l67.287"></a><span id="l67.287" class="difflineplus">+                                             &quot;20160730T080000Z&quot;</span>
<a href="#l67.288"></a><span id="l67.288" class="difflineplus">+                                         ], false);</span>
<a href="#l67.289"></a><span id="l67.289"> </span>
<a href="#l67.290"></a><span id="l67.290">     // Bug 419490 - Monthly recurrence, the fifth Wednesday every two months starting from February.</span>
<a href="#l67.291"></a><span id="l67.291">     // Check a monthly rule that specifies a day that is not part of the month</span>
<a href="#l67.292"></a><span id="l67.292">     // the events starts in.</span>
<a href="#l67.293"></a><span id="l67.293">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.294"></a><span id="l67.294">                                          &quot;DESCRIPTION:Repeat Monthly the fifth Friday every two months\n&quot; +</span>
<a href="#l67.295"></a><span id="l67.295">                                          &quot;RRULE:FREQ=MONTHLY;INTERVAL=2;COUNT=6;BYDAY=5FR\n&quot; +</span>
<a href="#l67.296"></a><span id="l67.296">                                          &quot;DTSTART:20150202T080000Z\n&quot; +</span>
<a href="#l67.297"></a><span id="l67.297">                                          &quot;DTEND:20150202T090000Z\n&quot; +</span>
<a href="#l67.298"></a><span id="l67.298" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.299"></a><span id="l67.299" class="difflineminus">-               [&quot;20150202T080000Z&quot;,</span>
<a href="#l67.300"></a><span id="l67.300" class="difflineminus">-                &quot;20151030T080000Z&quot;, &quot;20160429T080000Z&quot;, &quot;20161230T080000Z&quot;,</span>
<a href="#l67.301"></a><span id="l67.301" class="difflineminus">-                &quot;20170630T080000Z&quot;, &quot;20171229T080000Z&quot;, &quot;20180629T080000Z&quot;],</span>
<a href="#l67.302"></a><span id="l67.302" class="difflineminus">-               false);</span>
<a href="#l67.303"></a><span id="l67.303" class="difflineplus">+                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.304"></a><span id="l67.304" class="difflineplus">+                                             &quot;20150202T080000Z&quot;, &quot;20151030T080000Z&quot;, &quot;20160429T080000Z&quot;,</span>
<a href="#l67.305"></a><span id="l67.305" class="difflineplus">+                                             &quot;20161230T080000Z&quot;, &quot;20170630T080000Z&quot;, &quot;20171229T080000Z&quot;,</span>
<a href="#l67.306"></a><span id="l67.306" class="difflineplus">+                                             &quot;20180629T080000Z&quot;</span>
<a href="#l67.307"></a><span id="l67.307" class="difflineplus">+                                         ], false);</span>
<a href="#l67.308"></a><span id="l67.308"> </span>
<a href="#l67.309"></a><span id="l67.309">     // Bugs 419490, 958974 - Monthly recurrence, the 2nd Monday, 5th Wednesday and the 5th to last Saturday every month starting from February.</span>
<a href="#l67.310"></a><span id="l67.310">     // Check a monthly rule that specifies a day that is not part of the month</span>
<a href="#l67.311"></a><span id="l67.311">     // the events starts in with positive and negative position along with other byday.</span>
<a href="#l67.312"></a><span id="l67.312">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.313"></a><span id="l67.313">                                          &quot;DESCRIPTION:Repeat Monthly the 2nd Monday, 5th Wednesday and the 5th to last Saturday every month\n&quot; +</span>
<a href="#l67.314"></a><span id="l67.314">                                          &quot;RRULE:FREQ=MONTHLY;COUNT=7;BYDAY=2MO,-5WE,5SA\n&quot; +</span>
<a href="#l67.315"></a><span id="l67.315">                                          &quot;DTSTART:20150401T080000Z\n&quot; +</span>
<a href="#l67.316"></a><span id="l67.316">                                          &quot;DTEND:20150401T090000Z\n&quot; +</span>
<a href="#l67.317"></a><span id="l67.317" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.318"></a><span id="l67.318" class="difflineminus">-               [&quot;20150401T080000Z&quot;,</span>
<a href="#l67.319"></a><span id="l67.319" class="difflineminus">-                &quot;20150413T080000Z&quot;, &quot;20150511T080000Z&quot;, &quot;20150530T080000Z&quot;,</span>
<a href="#l67.320"></a><span id="l67.320" class="difflineminus">-                &quot;20150608T080000Z&quot;, &quot;20150701T080000Z&quot;, &quot;20150713T080000Z&quot;],</span>
<a href="#l67.321"></a><span id="l67.321" class="difflineminus">-               false);</span>
<a href="#l67.322"></a><span id="l67.322" class="difflineplus">+                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.323"></a><span id="l67.323" class="difflineplus">+                                             &quot;20150401T080000Z&quot;, &quot;20150413T080000Z&quot;, &quot;20150511T080000Z&quot;,</span>
<a href="#l67.324"></a><span id="l67.324" class="difflineplus">+                                             &quot;20150530T080000Z&quot;, &quot;20150608T080000Z&quot;, &quot;20150701T080000Z&quot;,</span>
<a href="#l67.325"></a><span id="l67.325" class="difflineplus">+                                             &quot;20150713T080000Z&quot;</span>
<a href="#l67.326"></a><span id="l67.326" class="difflineplus">+                                         ], false);</span>
<a href="#l67.327"></a><span id="l67.327"> </span>
<a href="#l67.328"></a><span id="l67.328">     // Bug 1146500 - Monthly recurrence, every MO and FR when are odd days starting from the 1st of March.</span>
<a href="#l67.329"></a><span id="l67.329">     // Check the first occurrence when we have BYDAY along with BYMONTHDAY.</span>
<a href="#l67.330"></a><span id="l67.330">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.331"></a><span id="l67.331">                                          &quot;DESCRIPTION:Monthly recurrence, every MO and FR when are odd days starting from the 1st of March\n&quot; +</span>
<a href="#l67.332"></a><span id="l67.332">                                          &quot;RRULE:FREQ=MONTHLY;BYDAY=MO,FR;BYMONTHDAY=1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;COUNT=4\n&quot; +</span>
<a href="#l67.333"></a><span id="l67.333">                                          &quot;DTSTART:20150301T080000Z\n&quot; +</span>
<a href="#l67.334"></a><span id="l67.334">                                          &quot;DTEND:20150301T090000Z\n&quot; +</span>
<a href="#l67.335"></a><span id="l67.335" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.336"></a><span id="l67.336" class="difflineminus">-               [&quot;20150301T080000Z&quot;,</span>
<a href="#l67.337"></a><span id="l67.337" class="difflineminus">-                &quot;20150309T080000Z&quot;, &quot;20150313T080000Z&quot;, &quot;20150323T080000Z&quot;, &quot;20150327T080000Z&quot;],</span>
<a href="#l67.338"></a><span id="l67.338" class="difflineminus">-               false);</span>
<a href="#l67.339"></a><span id="l67.339" class="difflineplus">+                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.340"></a><span id="l67.340" class="difflineplus">+                                             &quot;20150301T080000Z&quot;, &quot;20150309T080000Z&quot;, &quot;20150313T080000Z&quot;,</span>
<a href="#l67.341"></a><span id="l67.341" class="difflineplus">+                                             &quot;20150323T080000Z&quot;, &quot;20150327T080000Z&quot;</span>
<a href="#l67.342"></a><span id="l67.342" class="difflineplus">+                                         ], false);</span>
<a href="#l67.343"></a><span id="l67.343"> </span>
<a href="#l67.344"></a><span id="l67.344">     // Bug 1146500 - Monthly recurrence, every MO and FR when are odd days starting from the 1st of April.</span>
<a href="#l67.345"></a><span id="l67.345">     // Check the first occurrence when we have BYDAY along with BYMONTHDAY.</span>
<a href="#l67.346"></a><span id="l67.346">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.347"></a><span id="l67.347">                                          &quot;DESCRIPTION:Monthly recurrence, every MO and FR when are odd days starting from the 1st of March\n&quot; +</span>
<a href="#l67.348"></a><span id="l67.348">                                          &quot;RRULE:FREQ=MONTHLY;BYDAY=MO,FR;BYMONTHDAY=1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;COUNT=4\n&quot; +</span>
<a href="#l67.349"></a><span id="l67.349">                                          &quot;DTSTART:20150401T080000Z\n&quot; +</span>
<a href="#l67.350"></a><span id="l67.350">                                          &quot;DTEND:20150401T090000Z\n&quot; +</span>
<a href="#l67.351"></a><span id="l67.351" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.352"></a><span id="l67.352" class="difflineminus">-               [&quot;20150401T080000Z&quot;,</span>
<a href="#l67.353"></a><span id="l67.353" class="difflineminus">-                &quot;20150403T080000Z&quot;, &quot;20150413T080000Z&quot;, &quot;20150417T080000Z&quot;, &quot;20150427T080000Z&quot;],</span>
<a href="#l67.354"></a><span id="l67.354" class="difflineminus">-               false);</span>
<a href="#l67.355"></a><span id="l67.355" class="difflineplus">+                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.356"></a><span id="l67.356" class="difflineplus">+                                             &quot;20150401T080000Z&quot;, &quot;20150403T080000Z&quot;, &quot;20150413T080000Z&quot;,</span>
<a href="#l67.357"></a><span id="l67.357" class="difflineplus">+                                             &quot;20150417T080000Z&quot;, &quot;20150427T080000Z&quot;</span>
<a href="#l67.358"></a><span id="l67.358" class="difflineplus">+                                         ], false);</span>
<a href="#l67.359"></a><span id="l67.359"> </span>
<a href="#l67.360"></a><span id="l67.360">     // Bug 1146500 - Monthly recurrence, every MO and FR when are odd days starting from the 1st of April.</span>
<a href="#l67.361"></a><span id="l67.361">     // Check the first occurrence when we have BYDAY along with BYMONTHDAY.</span>
<a href="#l67.362"></a><span id="l67.362">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.363"></a><span id="l67.363">                                          &quot;DESCRIPTION:Monthly recurrence, every MO and FR when are odd days starting from the 1st of March\n&quot; +</span>
<a href="#l67.364"></a><span id="l67.364">                                          &quot;RRULE:FREQ=MONTHLY;BYDAY=MO,SA;BYMONTHDAY=1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;COUNT=4\n&quot; +</span>
<a href="#l67.365"></a><span id="l67.365">                                          &quot;DTSTART:20150401T080000Z\n&quot; +</span>
<a href="#l67.366"></a><span id="l67.366">                                          &quot;DTEND:20150401T090000Z\n&quot; +</span>
<a href="#l67.367"></a><span id="l67.367" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.368"></a><span id="l67.368" class="difflineminus">-               [&quot;20150401T080000Z&quot;,</span>
<a href="#l67.369"></a><span id="l67.369" class="difflineminus">-                &quot;20150411T080000Z&quot;, &quot;20150413T080000Z&quot;, &quot;20150425T080000Z&quot;, &quot;20150427T080000Z&quot;],</span>
<a href="#l67.370"></a><span id="l67.370" class="difflineminus">-               false);</span>
<a href="#l67.371"></a><span id="l67.371" class="difflineplus">+                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.372"></a><span id="l67.372" class="difflineplus">+                                             &quot;20150401T080000Z&quot;, &quot;20150411T080000Z&quot;, &quot;20150413T080000Z&quot;,</span>
<a href="#l67.373"></a><span id="l67.373" class="difflineplus">+                                             &quot;20150425T080000Z&quot;, &quot;20150427T080000Z&quot;</span>
<a href="#l67.374"></a><span id="l67.374" class="difflineplus">+                                         ], false);</span>
<a href="#l67.375"></a><span id="l67.375"> </span>
<a href="#l67.376"></a><span id="l67.376">     // Bug 1146500 - Monthly every SU and FR when are odd days starting from 28 of February (BYDAY and BYMONTHDAY).</span>
<a href="#l67.377"></a><span id="l67.377">     // Check the first occurrence when we have BYDAY along with BYMONTHDAY.</span>
<a href="#l67.378"></a><span id="l67.378">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.379"></a><span id="l67.379">                                          &quot;DESCRIPTION:Monthly recurrence, every SU and FR when are odd days starting from the 1st of March\n&quot; +</span>
<a href="#l67.380"></a><span id="l67.380">                                          &quot;RRULE:FREQ=MONTHLY;BYDAY=SU,FR;BYMONTHDAY=1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;COUNT=9\n&quot; +</span>
<a href="#l67.381"></a><span id="l67.381">                                          &quot;DTSTART:20150228T080000Z\n&quot; +</span>
<a href="#l67.382"></a><span id="l67.382">                                          &quot;DTEND:20150228T090000Z\n&quot; +</span>
<a href="#l67.383"></a><span id="l67.383" class="difflineminus">-                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.384"></a><span id="l67.384" class="difflineminus">-               [&quot;20150228T080000Z&quot;,</span>
<a href="#l67.385"></a><span id="l67.385" class="difflineminus">-                &quot;20150301T080000Z&quot;, &quot;20150313T080000Z&quot;, &quot;20150315T080000Z&quot;, &quot;20150327T080000Z&quot;,</span>
<a href="#l67.386"></a><span id="l67.386" class="difflineminus">-                &quot;20150329T080000Z&quot;, &quot;20150403T080000Z&quot;, &quot;20150405T080000Z&quot;, &quot;20150417T080000Z&quot;,</span>
<a href="#l67.387"></a><span id="l67.387" class="difflineminus">-                &quot;20150419T080000Z&quot;],</span>
<a href="#l67.388"></a><span id="l67.388" class="difflineminus">-               false);</span>
<a href="#l67.389"></a><span id="l67.389" class="difflineplus">+                                         &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.390"></a><span id="l67.390" class="difflineplus">+                                             &quot;20150228T080000Z&quot;, &quot;20150301T080000Z&quot;, &quot;20150313T080000Z&quot;,</span>
<a href="#l67.391"></a><span id="l67.391" class="difflineplus">+                                             &quot;20150315T080000Z&quot;, &quot;20150327T080000Z&quot;, &quot;20150329T080000Z&quot;,</span>
<a href="#l67.392"></a><span id="l67.392" class="difflineplus">+                                             &quot;20150403T080000Z&quot;, &quot;20150405T080000Z&quot;, &quot;20150417T080000Z&quot;,</span>
<a href="#l67.393"></a><span id="l67.393" class="difflineplus">+                                             &quot;20150419T080000Z&quot;</span>
<a href="#l67.394"></a><span id="l67.394" class="difflineplus">+                                         ], false);</span>
<a href="#l67.395"></a><span id="l67.395"> </span>
<a href="#l67.396"></a><span id="l67.396">     // Bug 1103187 - Monthly recurrence with only MONTHLY tag in the rule. Recurrence day taken</span>
<a href="#l67.397"></a><span id="l67.397">     // from the start date. Check four occurrences.</span>
<a href="#l67.398"></a><span id="l67.398">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.399"></a><span id="l67.399">                                           &quot;DESCRIPTION:Only Monthly recurrence\n&quot; +</span>
<a href="#l67.400"></a><span id="l67.400">                                           &quot;RRULE:FREQ=MONTHLY;COUNT=4\n&quot; +</span>
<a href="#l67.401"></a><span id="l67.401">                                           &quot;DTSTART:20160404T080000Z\n&quot; +</span>
<a href="#l67.402"></a><span id="l67.402">                                           &quot;DTEND:20160404T090000Z\n&quot; +</span>
<a href="#l67.403"></a><span id="l67.403" class="difflineminus">-                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.404"></a><span id="l67.404" class="difflineminus">-               [&quot;20160404T080000Z&quot;, &quot;20160504T080000Z&quot;, &quot;20160604T080000Z&quot;, &quot;20160704T080000Z&quot;],</span>
<a href="#l67.405"></a><span id="l67.405" class="difflineminus">-               false);</span>
<a href="#l67.406"></a><span id="l67.406" class="difflineplus">+                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.407"></a><span id="l67.407" class="difflineplus">+                                              &quot;20160404T080000Z&quot;, &quot;20160504T080000Z&quot;, &quot;20160604T080000Z&quot;,</span>
<a href="#l67.408"></a><span id="l67.408" class="difflineplus">+                                              &quot;20160704T080000Z&quot;</span>
<a href="#l67.409"></a><span id="l67.409" class="difflineplus">+                                          ], false);</span>
<a href="#l67.410"></a><span id="l67.410"> </span>
<a href="#l67.411"></a><span id="l67.411">     // Bug 1265554 - Monthly recurrence with only MONTHLY tag in the rule. Recurrence on the 31st</span>
<a href="#l67.412"></a><span id="l67.412">     // of the month. Check for 6 occurrences.</span>
<a href="#l67.413"></a><span id="l67.413">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.414"></a><span id="l67.414">                                           &quot;DESCRIPTION:Only Monthly recurrence, the 31st\n&quot; +</span>
<a href="#l67.415"></a><span id="l67.415">                                           &quot;RRULE:FREQ=MONTHLY;COUNT=6\n&quot; +</span>
<a href="#l67.416"></a><span id="l67.416">                                           &quot;DTSTART:20160131T150000Z\n&quot; +</span>
<a href="#l67.417"></a><span id="l67.417">                                           &quot;DTEND:20160131T160000Z\n&quot; +</span>
<a href="#l67.418"></a><span id="l67.418" class="difflineminus">-                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.419"></a><span id="l67.419" class="difflineminus">-               [&quot;20160131T150000Z&quot;, &quot;20160331T150000Z&quot;, &quot;20160531T150000Z&quot;,</span>
<a href="#l67.420"></a><span id="l67.420" class="difflineminus">-                &quot;20160731T150000Z&quot;, &quot;20160831T150000Z&quot;, &quot;20161031T150000Z&quot;],</span>
<a href="#l67.421"></a><span id="l67.421" class="difflineminus">-               false);</span>
<a href="#l67.422"></a><span id="l67.422" class="difflineplus">+                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.423"></a><span id="l67.423" class="difflineplus">+                                              &quot;20160131T150000Z&quot;, &quot;20160331T150000Z&quot;, &quot;20160531T150000Z&quot;,</span>
<a href="#l67.424"></a><span id="l67.424" class="difflineplus">+                                              &quot;20160731T150000Z&quot;, &quot;20160831T150000Z&quot;, &quot;20161031T150000Z&quot;</span>
<a href="#l67.425"></a><span id="l67.425" class="difflineplus">+                                          ], false);</span>
<a href="#l67.426"></a><span id="l67.426"> </span>
<a href="#l67.427"></a><span id="l67.427">     // Bug 1265554 - Monthly recurrence with only MONTHLY tag in the rule. Recurrence on the 31st</span>
<a href="#l67.428"></a><span id="l67.428">     // of the month every two months. Check for 6 occurrences.</span>
<a href="#l67.429"></a><span id="l67.429">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l67.430"></a><span id="l67.430">                                           &quot;DESCRIPTION:Only Monthly recurrence, the 31st every 2 months\n&quot; +</span>
<a href="#l67.431"></a><span id="l67.431">                                           &quot;RRULE:FREQ=MONTHLY;INTERVAL=2;COUNT=6\n&quot; +</span>
<a href="#l67.432"></a><span id="l67.432">                                           &quot;DTSTART:20151231T150000Z\n&quot; +</span>
<a href="#l67.433"></a><span id="l67.433">                                           &quot;DTEND:20151231T160000Z\n&quot; +</span>
<a href="#l67.434"></a><span id="l67.434" class="difflineminus">-                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l67.435"></a><span id="l67.435" class="difflineminus">-               [&quot;20151231T150000Z&quot;, &quot;20160831T150000Z&quot;, &quot;20161031T150000Z&quot;,</span>
<a href="#l67.436"></a><span id="l67.436" class="difflineminus">-                &quot;20161231T150000Z&quot;, &quot;20170831T150000Z&quot;, &quot;20171031T150000Z&quot;],</span>
<a href="#l67.437"></a><span id="l67.437" class="difflineminus">-               false);</span>
<a href="#l67.438"></a><span id="l67.438" class="difflineplus">+                                          &quot;END:VEVENT\nEND:VCALENDAR\n&quot;), [</span>
<a href="#l67.439"></a><span id="l67.439" class="difflineplus">+                                              &quot;20151231T150000Z&quot;, &quot;20160831T150000Z&quot;, &quot;20161031T150000Z&quot;,</span>
<a href="#l67.440"></a><span id="l67.440" class="difflineplus">+                                              &quot;20161231T150000Z&quot;, &quot;20170831T150000Z&quot;, &quot;20171031T150000Z&quot;</span>
<a href="#l67.441"></a><span id="l67.441" class="difflineplus">+                                          ], false);</span>
<a href="#l67.442"></a><span id="l67.442"> </span>
<a href="#l67.443"></a><span id="l67.443">     let item, occ1;</span>
<a href="#l67.444"></a><span id="l67.444">     item = makeEvent(&quot;DESCRIPTION:occurrence on day 1 moved between the occurrences &quot; +</span>
<a href="#l67.445"></a><span id="l67.445">                                      &quot;on days 2 and 3\n&quot; +</span>
<a href="#l67.446"></a><span id="l67.446">                          &quot;RRULE:FREQ=DAILY;COUNT=3\n&quot; +</span>
<a href="#l67.447"></a><span id="l67.447">                          &quot;DTSTART:20020402T114500Z\n&quot;);</span>
<a href="#l67.448"></a><span id="l67.448">     occ1 = item.recurrenceInfo.getOccurrenceFor(createDate(2002, 3, 2, true, 11, 45, 0));</span>
<a href="#l67.449"></a><span id="l67.449">     occ1.startDate = createDate(2002, 3, 3, true, 12, 0, 0);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/calendar/test/unit/test_storage.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/calendar/test/unit/test_storage.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -3,26 +3,28 @@</span>
<a href="#l68.4"></a><span id="l68.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l68.5"></a><span id="l68.5"> </span>
<a href="#l68.6"></a><span id="l68.6"> function run_test() {</span>
<a href="#l68.7"></a><span id="l68.7">     do_calendar_startup(testAttachRoundtrip);</span>
<a href="#l68.8"></a><span id="l68.8"> }</span>
<a href="#l68.9"></a><span id="l68.9"> </span>
<a href="#l68.10"></a><span id="l68.10"> function testAttachRoundtrip() {</span>
<a href="#l68.11"></a><span id="l68.11">     let storage = getStorageCal();</span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-    let str = [&quot;BEGIN:VEVENT&quot;,</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineminus">-               &quot;UID:attachItem&quot;,</span>
<a href="#l68.14"></a><span id="l68.14" class="difflineminus">-               &quot;DTSTART:20120101T010101Z&quot;,</span>
<a href="#l68.15"></a><span id="l68.15" class="difflineminus">-               &quot;ATTACH;FMTTYPE=text/calendar;ENCODING=BASE64;FILENAME=test.ics:http://example.com/test.ics&quot;,</span>
<a href="#l68.16"></a><span id="l68.16" class="difflineminus">-               &quot;ATTENDEE;RSVP=TRUE;CUTYPE=INDIVIDUAL;CN=Name;PARTSTAT=ACCEPTED;ROLE=REQ-PARTICIPANT;X-THING=BAR:mailto:test@example.com&quot;,</span>
<a href="#l68.17"></a><span id="l68.17" class="difflineminus">-               &quot;RELATED-TO;RELTYPE=SIBLING;FOO=BAR:VALUE&quot;,</span>
<a href="#l68.18"></a><span id="l68.18" class="difflineminus">-               &quot;RRULE:FREQ=MONTHLY;INTERVAL=2;COUNT=5;BYDAY=MO&quot;,</span>
<a href="#l68.19"></a><span id="l68.19" class="difflineminus">-               &quot;RDATE:20120201T010101Z&quot;,</span>
<a href="#l68.20"></a><span id="l68.20" class="difflineminus">-               &quot;EXDATE:20120301T010101Z&quot;,</span>
<a href="#l68.21"></a><span id="l68.21" class="difflineminus">-               &quot;END:VEVENT&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l68.22"></a><span id="l68.22" class="difflineplus">+    let str = [</span>
<a href="#l68.23"></a><span id="l68.23" class="difflineplus">+        &quot;BEGIN:VEVENT&quot;,</span>
<a href="#l68.24"></a><span id="l68.24" class="difflineplus">+        &quot;UID:attachItem&quot;,</span>
<a href="#l68.25"></a><span id="l68.25" class="difflineplus">+        &quot;DTSTART:20120101T010101Z&quot;,</span>
<a href="#l68.26"></a><span id="l68.26" class="difflineplus">+        &quot;ATTACH;FMTTYPE=text/calendar;ENCODING=BASE64;FILENAME=test.ics:http://example.com/test.ics&quot;,</span>
<a href="#l68.27"></a><span id="l68.27" class="difflineplus">+        &quot;ATTENDEE;RSVP=TRUE;CUTYPE=INDIVIDUAL;CN=Name;PARTSTAT=ACCEPTED;ROLE=REQ-PARTICIPANT;X-THING=BAR:mailto:test@example.com&quot;,</span>
<a href="#l68.28"></a><span id="l68.28" class="difflineplus">+        &quot;RELATED-TO;RELTYPE=SIBLING;FOO=BAR:VALUE&quot;,</span>
<a href="#l68.29"></a><span id="l68.29" class="difflineplus">+        &quot;RRULE:FREQ=MONTHLY;INTERVAL=2;COUNT=5;BYDAY=MO&quot;,</span>
<a href="#l68.30"></a><span id="l68.30" class="difflineplus">+        &quot;RDATE:20120201T010101Z&quot;,</span>
<a href="#l68.31"></a><span id="l68.31" class="difflineplus">+        &quot;EXDATE:20120301T010101Z&quot;,</span>
<a href="#l68.32"></a><span id="l68.32" class="difflineplus">+        &quot;END:VEVENT&quot;</span>
<a href="#l68.33"></a><span id="l68.33" class="difflineplus">+    ].join(&quot;\r\n&quot;);</span>
<a href="#l68.34"></a><span id="l68.34"> </span>
<a href="#l68.35"></a><span id="l68.35">     let storageItem = createEventFromIcalString(str);</span>
<a href="#l68.36"></a><span id="l68.36"> </span>
<a href="#l68.37"></a><span id="l68.37">     do_test_pending();</span>
<a href="#l68.38"></a><span id="l68.38">     storage.addItem(storageItem, {</span>
<a href="#l68.39"></a><span id="l68.39">         onOperationComplete: function(calendar, status, opType, id, addedItem) {</span>
<a href="#l68.40"></a><span id="l68.40">             do_execute_soon(() =&gt; {</span>
<a href="#l68.41"></a><span id="l68.41">                 // Make sure the cache is cleared, otherwise we'll get the cached item.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/calendar/test/unit/test_timezone.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/calendar/test/unit/test_timezone.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -10,70 +10,72 @@ function run_test() {</span>
<a href="#l69.4"></a><span id="l69.4">             do_test_finished();</span>
<a href="#l69.5"></a><span id="l69.5">         }</span>
<a href="#l69.6"></a><span id="l69.6">     });</span>
<a href="#l69.7"></a><span id="l69.7"> }</span>
<a href="#l69.8"></a><span id="l69.8"> </span>
<a href="#l69.9"></a><span id="l69.9"> function really_run_test() {</span>
<a href="#l69.10"></a><span id="l69.10">     let event = cal.createEvent();</span>
<a href="#l69.11"></a><span id="l69.11"> </span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-    let str =</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineminus">-         [&quot;BEGIN:VCALENDAR&quot;,</span>
<a href="#l69.14"></a><span id="l69.14" class="difflineminus">-          &quot;PRODID:-//RDU Software//NONSGML HandCal//EN&quot;,</span>
<a href="#l69.15"></a><span id="l69.15" class="difflineminus">-          &quot;VERSION:2.0&quot;,</span>
<a href="#l69.16"></a><span id="l69.16" class="difflineminus">-          &quot;BEGIN:VTIMEZONE&quot;,</span>
<a href="#l69.17"></a><span id="l69.17" class="difflineminus">-          &quot;TZID:America/New_York&quot;,</span>
<a href="#l69.18"></a><span id="l69.18" class="difflineminus">-          &quot;BEGIN:STANDARD&quot;,</span>
<a href="#l69.19"></a><span id="l69.19" class="difflineminus">-          &quot;DTSTART:19981025T020000&quot;,</span>
<a href="#l69.20"></a><span id="l69.20" class="difflineminus">-          &quot;TZOFFSETFROM:-0400&quot;,</span>
<a href="#l69.21"></a><span id="l69.21" class="difflineminus">-          &quot;TZOFFSETTO:-0500&quot;,</span>
<a href="#l69.22"></a><span id="l69.22" class="difflineminus">-          &quot;TZNAME:EST&quot;,</span>
<a href="#l69.23"></a><span id="l69.23" class="difflineminus">-          &quot;END:STANDARD&quot;,</span>
<a href="#l69.24"></a><span id="l69.24" class="difflineminus">-          &quot;BEGIN:DAYLIGHT&quot;,</span>
<a href="#l69.25"></a><span id="l69.25" class="difflineminus">-          &quot;DTSTART:19990404T020000&quot;,</span>
<a href="#l69.26"></a><span id="l69.26" class="difflineminus">-          &quot;TZOFFSETFROM:-0500&quot;,</span>
<a href="#l69.27"></a><span id="l69.27" class="difflineminus">-          &quot;TZOFFSETTO:-0400&quot;,</span>
<a href="#l69.28"></a><span id="l69.28" class="difflineminus">-          &quot;TZNAME:EDT&quot;,</span>
<a href="#l69.29"></a><span id="l69.29" class="difflineminus">-          &quot;END:DAYLIGHT&quot;,</span>
<a href="#l69.30"></a><span id="l69.30" class="difflineminus">-          &quot;END:VTIMEZONE&quot;,</span>
<a href="#l69.31"></a><span id="l69.31" class="difflineminus">-          &quot;BEGIN:VEVENT&quot;,</span>
<a href="#l69.32"></a><span id="l69.32" class="difflineminus">-          &quot;DTSTAMP:19980309T231000Z&quot;,</span>
<a href="#l69.33"></a><span id="l69.33" class="difflineminus">-          &quot;UID:guid-1.example.com&quot;,</span>
<a href="#l69.34"></a><span id="l69.34" class="difflineminus">-          &quot;ORGANIZER:mailto:mrbig@example.com&quot;,</span>
<a href="#l69.35"></a><span id="l69.35" class="difflineminus">-          &quot;ATTENDEE;RSVP=TRUE;ROLE=REQ-PARTICIPANT;CUTYPE=GROUP:&quot;,</span>
<a href="#l69.36"></a><span id="l69.36" class="difflineminus">-          &quot; mailto:employee-A@example.com&quot;,</span>
<a href="#l69.37"></a><span id="l69.37" class="difflineminus">-          &quot;DESCRIPTION:Project XYZ Review Meeting&quot;,</span>
<a href="#l69.38"></a><span id="l69.38" class="difflineminus">-          &quot;CATEGORIES:MEETING&quot;,</span>
<a href="#l69.39"></a><span id="l69.39" class="difflineminus">-          &quot;CLASS:PUBLIC&quot;,</span>
<a href="#l69.40"></a><span id="l69.40" class="difflineminus">-          &quot;CREATED:19980309T130000Z&quot;,</span>
<a href="#l69.41"></a><span id="l69.41" class="difflineminus">-          &quot;SUMMARY:XYZ Project Review&quot;,</span>
<a href="#l69.42"></a><span id="l69.42" class="difflineminus">-          &quot;DTSTART;TZID=America/New_York:19980312T083000&quot;,</span>
<a href="#l69.43"></a><span id="l69.43" class="difflineminus">-          &quot;DTEND;TZID=America/New_York:19980312T093000&quot;,</span>
<a href="#l69.44"></a><span id="l69.44" class="difflineminus">-          &quot;LOCATION:1CP Conference Room 4350&quot;,</span>
<a href="#l69.45"></a><span id="l69.45" class="difflineminus">-          &quot;END:VEVENT&quot;,</span>
<a href="#l69.46"></a><span id="l69.46" class="difflineminus">-          &quot;END:VCALENDAR&quot;,</span>
<a href="#l69.47"></a><span id="l69.47" class="difflineminus">-          &quot;&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l69.48"></a><span id="l69.48" class="difflineplus">+    let str = [</span>
<a href="#l69.49"></a><span id="l69.49" class="difflineplus">+        &quot;BEGIN:VCALENDAR&quot;,</span>
<a href="#l69.50"></a><span id="l69.50" class="difflineplus">+        &quot;PRODID:-//RDU Software//NONSGML HandCal//EN&quot;,</span>
<a href="#l69.51"></a><span id="l69.51" class="difflineplus">+        &quot;VERSION:2.0&quot;,</span>
<a href="#l69.52"></a><span id="l69.52" class="difflineplus">+        &quot;BEGIN:VTIMEZONE&quot;,</span>
<a href="#l69.53"></a><span id="l69.53" class="difflineplus">+        &quot;TZID:America/New_York&quot;,</span>
<a href="#l69.54"></a><span id="l69.54" class="difflineplus">+        &quot;BEGIN:STANDARD&quot;,</span>
<a href="#l69.55"></a><span id="l69.55" class="difflineplus">+        &quot;DTSTART:19981025T020000&quot;,</span>
<a href="#l69.56"></a><span id="l69.56" class="difflineplus">+        &quot;TZOFFSETFROM:-0400&quot;,</span>
<a href="#l69.57"></a><span id="l69.57" class="difflineplus">+        &quot;TZOFFSETTO:-0500&quot;,</span>
<a href="#l69.58"></a><span id="l69.58" class="difflineplus">+        &quot;TZNAME:EST&quot;,</span>
<a href="#l69.59"></a><span id="l69.59" class="difflineplus">+        &quot;END:STANDARD&quot;,</span>
<a href="#l69.60"></a><span id="l69.60" class="difflineplus">+        &quot;BEGIN:DAYLIGHT&quot;,</span>
<a href="#l69.61"></a><span id="l69.61" class="difflineplus">+        &quot;DTSTART:19990404T020000&quot;,</span>
<a href="#l69.62"></a><span id="l69.62" class="difflineplus">+        &quot;TZOFFSETFROM:-0500&quot;,</span>
<a href="#l69.63"></a><span id="l69.63" class="difflineplus">+        &quot;TZOFFSETTO:-0400&quot;,</span>
<a href="#l69.64"></a><span id="l69.64" class="difflineplus">+        &quot;TZNAME:EDT&quot;,</span>
<a href="#l69.65"></a><span id="l69.65" class="difflineplus">+        &quot;END:DAYLIGHT&quot;,</span>
<a href="#l69.66"></a><span id="l69.66" class="difflineplus">+        &quot;END:VTIMEZONE&quot;,</span>
<a href="#l69.67"></a><span id="l69.67" class="difflineplus">+        &quot;BEGIN:VEVENT&quot;,</span>
<a href="#l69.68"></a><span id="l69.68" class="difflineplus">+        &quot;DTSTAMP:19980309T231000Z&quot;,</span>
<a href="#l69.69"></a><span id="l69.69" class="difflineplus">+        &quot;UID:guid-1.example.com&quot;,</span>
<a href="#l69.70"></a><span id="l69.70" class="difflineplus">+        &quot;ORGANIZER:mailto:mrbig@example.com&quot;,</span>
<a href="#l69.71"></a><span id="l69.71" class="difflineplus">+        &quot;ATTENDEE;RSVP=TRUE;ROLE=REQ-PARTICIPANT;CUTYPE=GROUP:&quot;,</span>
<a href="#l69.72"></a><span id="l69.72" class="difflineplus">+        &quot; mailto:employee-A@example.com&quot;,</span>
<a href="#l69.73"></a><span id="l69.73" class="difflineplus">+        &quot;DESCRIPTION:Project XYZ Review Meeting&quot;,</span>
<a href="#l69.74"></a><span id="l69.74" class="difflineplus">+        &quot;CATEGORIES:MEETING&quot;,</span>
<a href="#l69.75"></a><span id="l69.75" class="difflineplus">+        &quot;CLASS:PUBLIC&quot;,</span>
<a href="#l69.76"></a><span id="l69.76" class="difflineplus">+        &quot;CREATED:19980309T130000Z&quot;,</span>
<a href="#l69.77"></a><span id="l69.77" class="difflineplus">+        &quot;SUMMARY:XYZ Project Review&quot;,</span>
<a href="#l69.78"></a><span id="l69.78" class="difflineplus">+        &quot;DTSTART;TZID=America/New_York:19980312T083000&quot;,</span>
<a href="#l69.79"></a><span id="l69.79" class="difflineplus">+        &quot;DTEND;TZID=America/New_York:19980312T093000&quot;,</span>
<a href="#l69.80"></a><span id="l69.80" class="difflineplus">+        &quot;LOCATION:1CP Conference Room 4350&quot;,</span>
<a href="#l69.81"></a><span id="l69.81" class="difflineplus">+        &quot;END:VEVENT&quot;,</span>
<a href="#l69.82"></a><span id="l69.82" class="difflineplus">+        &quot;END:VCALENDAR&quot;,</span>
<a href="#l69.83"></a><span id="l69.83" class="difflineplus">+        &quot;&quot;</span>
<a href="#l69.84"></a><span id="l69.84" class="difflineplus">+    ].join(&quot;\r\n&quot;);</span>
<a href="#l69.85"></a><span id="l69.85"> </span>
<a href="#l69.86"></a><span id="l69.86" class="difflineminus">-    let strTz =</span>
<a href="#l69.87"></a><span id="l69.87" class="difflineminus">-         [&quot;BEGIN:VTIMEZONE&quot;,</span>
<a href="#l69.88"></a><span id="l69.88" class="difflineminus">-          &quot;TZID:America/New_York&quot;,</span>
<a href="#l69.89"></a><span id="l69.89" class="difflineminus">-          &quot;BEGIN:STANDARD&quot;,</span>
<a href="#l69.90"></a><span id="l69.90" class="difflineminus">-          &quot;DTSTART:19981025T020000&quot;,</span>
<a href="#l69.91"></a><span id="l69.91" class="difflineminus">-          &quot;TZOFFSETFROM:-0400&quot;,</span>
<a href="#l69.92"></a><span id="l69.92" class="difflineminus">-          &quot;TZOFFSETTO:-0500&quot;,</span>
<a href="#l69.93"></a><span id="l69.93" class="difflineminus">-          &quot;TZNAME:EST&quot;,</span>
<a href="#l69.94"></a><span id="l69.94" class="difflineminus">-          &quot;END:STANDARD&quot;,</span>
<a href="#l69.95"></a><span id="l69.95" class="difflineminus">-          &quot;BEGIN:DAYLIGHT&quot;,</span>
<a href="#l69.96"></a><span id="l69.96" class="difflineminus">-          &quot;DTSTART:19990404T020000&quot;,</span>
<a href="#l69.97"></a><span id="l69.97" class="difflineminus">-          &quot;TZOFFSETFROM:-0500&quot;,</span>
<a href="#l69.98"></a><span id="l69.98" class="difflineminus">-          &quot;TZOFFSETTO:-0400&quot;,</span>
<a href="#l69.99"></a><span id="l69.99" class="difflineminus">-          &quot;TZNAME:EDT&quot;,</span>
<a href="#l69.100"></a><span id="l69.100" class="difflineminus">-          &quot;END:DAYLIGHT&quot;,</span>
<a href="#l69.101"></a><span id="l69.101" class="difflineminus">-          &quot;END:VTIMEZONE&quot;,</span>
<a href="#l69.102"></a><span id="l69.102" class="difflineminus">-          &quot;&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l69.103"></a><span id="l69.103" class="difflineplus">+    let strTz = [</span>
<a href="#l69.104"></a><span id="l69.104" class="difflineplus">+        &quot;BEGIN:VTIMEZONE&quot;,</span>
<a href="#l69.105"></a><span id="l69.105" class="difflineplus">+        &quot;TZID:America/New_York&quot;,</span>
<a href="#l69.106"></a><span id="l69.106" class="difflineplus">+        &quot;BEGIN:STANDARD&quot;,</span>
<a href="#l69.107"></a><span id="l69.107" class="difflineplus">+        &quot;DTSTART:19981025T020000&quot;,</span>
<a href="#l69.108"></a><span id="l69.108" class="difflineplus">+        &quot;TZOFFSETFROM:-0400&quot;,</span>
<a href="#l69.109"></a><span id="l69.109" class="difflineplus">+        &quot;TZOFFSETTO:-0500&quot;,</span>
<a href="#l69.110"></a><span id="l69.110" class="difflineplus">+        &quot;TZNAME:EST&quot;,</span>
<a href="#l69.111"></a><span id="l69.111" class="difflineplus">+        &quot;END:STANDARD&quot;,</span>
<a href="#l69.112"></a><span id="l69.112" class="difflineplus">+        &quot;BEGIN:DAYLIGHT&quot;,</span>
<a href="#l69.113"></a><span id="l69.113" class="difflineplus">+        &quot;DTSTART:19990404T020000&quot;,</span>
<a href="#l69.114"></a><span id="l69.114" class="difflineplus">+        &quot;TZOFFSETFROM:-0500&quot;,</span>
<a href="#l69.115"></a><span id="l69.115" class="difflineplus">+        &quot;TZOFFSETTO:-0400&quot;,</span>
<a href="#l69.116"></a><span id="l69.116" class="difflineplus">+        &quot;TZNAME:EDT&quot;,</span>
<a href="#l69.117"></a><span id="l69.117" class="difflineplus">+        &quot;END:DAYLIGHT&quot;,</span>
<a href="#l69.118"></a><span id="l69.118" class="difflineplus">+        &quot;END:VTIMEZONE&quot;,</span>
<a href="#l69.119"></a><span id="l69.119" class="difflineplus">+        &quot;&quot;</span>
<a href="#l69.120"></a><span id="l69.120" class="difflineplus">+    ].join(&quot;\r\n&quot;);</span>
<a href="#l69.121"></a><span id="l69.121"> </span>
<a href="#l69.122"></a><span id="l69.122">     let tzs = cal.getTimezoneService();</span>
<a href="#l69.123"></a><span id="l69.123"> </span>
<a href="#l69.124"></a><span id="l69.124">     event.icalString = str;</span>
<a href="#l69.125"></a><span id="l69.125"> </span>
<a href="#l69.126"></a><span id="l69.126">     let startDate = event.startDate;</span>
<a href="#l69.127"></a><span id="l69.127">     let endDate = event.endDate;</span>
<a href="#l69.128"></a><span id="l69.128"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

