<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 8045:2ffa1a8f346375e9f23d798f7707023748e8e585</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 2ffa1a8f346375e9f23d798f7707023748e8e585" />
<meta property="og:url" content="/comm-central/rev/2ffa1a8f346375e9f23d798f7707023748e8e585" />
<meta property="og:description" content="[Bug 669077] Cleanup sessionstore tests suite. Ports bug 667202 and syncs head.js with FF. r+=Neil" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 2ffa1a8f346375e9f23d798f7707023748e8e585 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/2ffa1a8f346375e9f23d798f7707023748e8e585">shortlog</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/2ffa1a8f346375e9f23d798f7707023748e8e585">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585">files</a> |
changeset |
<a href="/comm-central/raw-rev/2ffa1a8f346375e9f23d798f7707023748e8e585">raw</a>  | <a href="/comm-central/archive/2ffa1a8f346375e9f23d798f7707023748e8e585.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
[<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=669077">Bug 669077</a>] Cleanup sessionstore tests suite. Ports <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=667202">bug 667202</a> and syncs head.js with FF. r+=Neil
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#105;&#115;&#97;&#107;&#32;&#75;&#104;&#97;&#99;&#104;&#97;&#116;&#114;&#121;&#97;&#110;&#32;&#60;&#109;&#105;&#115;&#97;&#107;&#46;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 05 Jul 2011 14:56:25 +0500</td></tr>

<tr>
 <td>changeset 8045</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/2ffa1a8f346375e9f23d798f7707023748e8e585">2ffa1a8f346375e9f23d798f7707023748e8e585</a></td>
</tr>



<tr>
<td>parent 8044</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57">ae84f8b74c90e52908360b1fd5cc7077b3b0ad57</a>
</td>
</tr>

<tr>
<td>child 8046</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1a874442f742fb67a484a2be2b267f79ea17815d">1a874442f742fb67a484a2be2b267f79ea17815d</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=2ffa1a8f346375e9f23d798f7707023748e8e585">6191</a></td></tr>
<tr><td>push user</td><td>misak.bugzilla@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 05 Jul 2011 10:00:22 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@2ffa1a8f3463 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2ffa1a8f346375e9f23d798f7707023748e8e585">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2ffa1a8f346375e9f23d798f7707023748e8e585&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2ffa1a8f346375e9f23d798f7707023748e8e585&newProject=comm-central&newRevision=2ffa1a8f346375e9f23d798f7707023748e8e585&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2ffa1a8f346375e9f23d798f7707023748e8e585&newProject=comm-central&newRevision=2ffa1a8f346375e9f23d798f7707023748e8e585&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2ffa1a8f346375e9f23d798f7707023748e8e585&newProject=comm-central&newRevision=2ffa1a8f346375e9f23d798f7707023748e8e585&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=669077">669077</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=667202">667202</a></td></tr>




</table></div>

<div class="page_body description">[<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=669077">Bug 669077</a>] Cleanup sessionstore tests suite. Ports <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=667202">bug 667202</a> and syncs head.js with FF. r+=Neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_339445.js">suite/common/tests/browser/browser_339445.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_339445.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_339445.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_339445.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_339445.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_339445.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_345898.js">suite/common/tests/browser/browser_345898.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_345898.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_345898.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_345898.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_345898.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_345898.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_346337.js">suite/common/tests/browser/browser_346337.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_346337.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_346337.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_346337.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_346337.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_346337.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_350525.js">suite/common/tests/browser/browser_350525.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_350525.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_350525.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_350525.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_350525.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_350525.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_367052.js">suite/common/tests/browser/browser_367052.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_367052.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_367052.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_367052.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_367052.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_367052.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_393716.js">suite/common/tests/browser/browser_393716.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_393716.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_393716.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_393716.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_393716.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_393716.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_408470.js">suite/common/tests/browser/browser_408470.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_408470.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_408470.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_408470.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_408470.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_408470.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_423132.js">suite/common/tests/browser/browser_423132.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_423132.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_423132.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_423132.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_423132.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_423132.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_447951.js">suite/common/tests/browser/browser_447951.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_447951.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_447951.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_447951.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_447951.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_447951.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_448741.js">suite/common/tests/browser/browser_448741.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_448741.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_448741.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_448741.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_448741.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_448741.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_454908.js">suite/common/tests/browser/browser_454908.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_454908.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_454908.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_454908.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_454908.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_454908.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_456342.js">suite/common/tests/browser/browser_456342.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_456342.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_456342.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_456342.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_456342.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_456342.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_461634.js">suite/common/tests/browser/browser_461634.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_461634.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_461634.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_461634.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_461634.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_461634.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_463206.js">suite/common/tests/browser/browser_463206.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_463206.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_463206.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_463206.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_463206.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_463206.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465215.js">suite/common/tests/browser/browser_465215.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465215.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465215.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465215.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465215.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465215.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465223.js">suite/common/tests/browser/browser_465223.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465223.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465223.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465223.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465223.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_465223.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_466937.js">suite/common/tests/browser/browser_466937.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_466937.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_466937.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_466937.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_466937.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_466937.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_476161.js">suite/common/tests/browser/browser_476161.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_476161.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_476161.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_476161.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_476161.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_476161.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_477657.js">suite/common/tests/browser/browser_477657.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_477657.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_477657.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_477657.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_477657.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_477657.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_480893.js">suite/common/tests/browser/browser_480893.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_480893.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_480893.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_480893.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_480893.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_480893.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_483330.js">suite/common/tests/browser/browser_483330.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_483330.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_483330.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_483330.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_483330.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_483330.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_485482.js">suite/common/tests/browser/browser_485482.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_485482.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_485482.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_485482.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_485482.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_485482.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_490040.js">suite/common/tests/browser/browser_490040.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_490040.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_490040.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_490040.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_490040.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_490040.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_491168.js">suite/common/tests/browser/browser_491168.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_491168.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_491168.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_491168.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_491168.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_491168.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_493467.js">suite/common/tests/browser/browser_493467.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_493467.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_493467.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_493467.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_493467.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_493467.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_500328.js">suite/common/tests/browser/browser_500328.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_500328.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_500328.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_500328.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_500328.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_500328.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_514751.js">suite/common/tests/browser/browser_514751.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_514751.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_514751.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_514751.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_514751.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_514751.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_522545.js">suite/common/tests/browser/browser_522545.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_522545.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_522545.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_522545.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_522545.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_522545.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_524745.js">suite/common/tests/browser/browser_524745.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_524745.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_524745.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_524745.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_524745.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_524745.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_526613.js">suite/common/tests/browser/browser_526613.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_526613.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_526613.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_526613.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_526613.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_526613.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_528776.js">suite/common/tests/browser/browser_528776.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_528776.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_528776.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_528776.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_528776.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_528776.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_581937.js">suite/common/tests/browser/browser_581937.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_581937.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_581937.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_581937.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_581937.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_581937.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_586068-cascaded_restore.js">suite/common/tests/browser/browser_586068-cascaded_restore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_586068-cascaded_restore.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_586068-cascaded_restore.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_586068-cascaded_restore.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_586068-cascaded_restore.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_586068-cascaded_restore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_597315.js">suite/common/tests/browser/browser_597315.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_597315.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_597315.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_597315.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_597315.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_597315.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_607016.js">suite/common/tests/browser/browser_607016.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_607016.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_607016.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_607016.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_607016.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_607016.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_615394-SSWindowState_events.js">suite/common/tests/browser/browser_615394-SSWindowState_events.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_615394-SSWindowState_events.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_615394-SSWindowState_events.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_615394-SSWindowState_events.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_615394-SSWindowState_events.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_615394-SSWindowState_events.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_625257.js">suite/common/tests/browser/browser_625257.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_625257.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_625257.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_625257.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_625257.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_625257.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug431826.js">suite/common/tests/browser/browser_bug431826.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug431826.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug431826.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug431826.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug431826.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug431826.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug510890.js">suite/common/tests/browser/browser_bug510890.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug510890.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug510890.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug510890.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug510890.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/browser_bug510890.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/head.js">suite/common/tests/browser/head.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/head.js">file</a> |
<a href="/comm-central/annotate/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/head.js">annotate</a> |
<a href="/comm-central/diff/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/head.js">diff</a> |
<a href="/comm-central/comparison/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/head.js">comparison</a> |
<a href="/comm-central/log/2ffa1a8f346375e9f23d798f7707023748e8e585/suite/common/tests/browser/head.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/common/tests/browser/browser_339445.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_339445.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -32,21 +32,16 @@</span>
<a href="#l1.4"></a><span id="l1.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l1.5"></a><span id="l1.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l1.6"></a><span id="l1.6">  *</span>
<a href="#l1.7"></a><span id="l1.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> function test() {</span>
<a href="#l1.10"></a><span id="l1.10">   /** Test for Bug 339445 **/</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  try {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-    var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-                       .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-  }</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-  catch (ex) { }</span>
<a href="#l1.17"></a><span id="l1.17">   waitForExplicitFinish();</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19">   let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l1.20"></a><span id="l1.20">     &quot;suite/common/tests/browser/browser_339445_sample.html&quot;;</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l1.23"></a><span id="l1.23">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.24"></a><span id="l1.24">     tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineat">@@ -57,15 +52,15 @@ function test() {</span>
<a href="#l1.26"></a><span id="l1.26">     let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l1.27"></a><span id="l1.27">     tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.28"></a><span id="l1.28">       this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.29"></a><span id="l1.29">       let doc2 = tab2.linkedBrowser.contentDocument;</span>
<a href="#l1.30"></a><span id="l1.30">       is(doc2.getElementById(&quot;storageTestItem&quot;).textContent, &quot;SUCCESS&quot;,</span>
<a href="#l1.31"></a><span id="l1.31">          &quot;sessionStorage value has been duplicated&quot;);</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33">       // clean up</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-      gBrowser.removeTab(tab2);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-      gBrowser.removeTab(tab);</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+      getBrowser().removeTab(tab2);</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+      getBrowser().removeTab(tab);</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">       finish();</span>
<a href="#l1.40"></a><span id="l1.40">     }, true);</span>
<a href="#l1.41"></a><span id="l1.41">   }, true);</span>
<a href="#l1.42"></a><span id="l1.42"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/common/tests/browser/browser_345898.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_345898.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -42,18 +42,16 @@ function test() {</span>
<a href="#l2.4"></a><span id="l2.4">       aLambda();</span>
<a href="#l2.5"></a><span id="l2.5">       return false;</span>
<a href="#l2.6"></a><span id="l2.6">     }</span>
<a href="#l2.7"></a><span id="l2.7">     catch (ex) {</span>
<a href="#l2.8"></a><span id="l2.8">       return ex.name == &quot;NS_ERROR_ILLEGAL_VALUE&quot;;</span>
<a href="#l2.9"></a><span id="l2.9">     }</span>
<a href="#l2.10"></a><span id="l2.10">   }</span>
<a href="#l2.11"></a><span id="l2.11">   </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-  </span>
<a href="#l2.14"></a><span id="l2.14">   // all of the following calls with illegal arguments should throw NS_ERROR_ILLEGAL_VALUE</span>
<a href="#l2.15"></a><span id="l2.15">   ok(test(function() ss.getWindowState({})),</span>
<a href="#l2.16"></a><span id="l2.16">      &quot;Invalid window for getWindowState throws&quot;);</span>
<a href="#l2.17"></a><span id="l2.17">   ok(test(function() ss.setWindowState({}, &quot;&quot;, false)),</span>
<a href="#l2.18"></a><span id="l2.18">      &quot;Invalid window for setWindowState throws&quot;);</span>
<a href="#l2.19"></a><span id="l2.19">   ok(test(function() ss.getTabState({})),</span>
<a href="#l2.20"></a><span id="l2.20">      &quot;Invalid tab for getTabState throws&quot;);</span>
<a href="#l2.21"></a><span id="l2.21">   ok(test(function() ss.setTabState({}, &quot;{}&quot;)),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/common/tests/browser/browser_346337.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_346337.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -32,22 +32,16 @@</span>
<a href="#l3.4"></a><span id="l3.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l3.5"></a><span id="l3.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l3.6"></a><span id="l3.6">  *</span>
<a href="#l3.7"></a><span id="l3.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> function test() {</span>
<a href="#l3.10"></a><span id="l3.10">   /** Test for Bug 346337 **/</span>
<a href="#l3.11"></a><span id="l3.11">   </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  try {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-    var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                       .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-  }</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-  catch (ex) { }</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-</span>
<a href="#l3.18"></a><span id="l3.18">   var file = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l3.19"></a><span id="l3.19">                .getService(Components.interfaces.nsIProperties)</span>
<a href="#l3.20"></a><span id="l3.20">                .get(&quot;TmpD&quot;, Components.interfaces.nsILocalFile);</span>
<a href="#l3.21"></a><span id="l3.21">   file.append(&quot;346337_test1.file&quot;);</span>
<a href="#l3.22"></a><span id="l3.22">   filePath1 = file.path;</span>
<a href="#l3.23"></a><span id="l3.23">   file = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l3.24"></a><span id="l3.24">              .getService(Components.interfaces.nsIProperties)</span>
<a href="#l3.25"></a><span id="l3.25">              .get(&quot;TmpD&quot;, Components.interfaces.nsILocalFile);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/common/tests/browser/browser_350525.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_350525.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -4,28 +4,18 @@ function test() {</span>
<a href="#l4.4"></a><span id="l4.4">   function test(aLambda) {</span>
<a href="#l4.5"></a><span id="l4.5">     try {</span>
<a href="#l4.6"></a><span id="l4.6">       return aLambda() || true;</span>
<a href="#l4.7"></a><span id="l4.7">     }</span>
<a href="#l4.8"></a><span id="l4.8">     catch (ex) { }</span>
<a href="#l4.9"></a><span id="l4.9">     return false;</span>
<a href="#l4.10"></a><span id="l4.10">   }</span>
<a href="#l4.11"></a><span id="l4.11">   </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  // test setup</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-  let tabbrowser = getBrowser();</span>
<a href="#l4.14"></a><span id="l4.14">   waitForExplicitFinish();</span>
<a href="#l4.15"></a><span id="l4.15">   </span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-  // component</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-  let ssComponent = test(function() Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]);</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-  ok(ssComponent, &quot;reference the sessionstore component&quot;);</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-  </span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-  // service</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-  let ss = test(function() ssComponent.getService(Components.interfaces.nsISessionStore));</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-  ok(ss, &quot;reference the sessionstore service&quot;);</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-  </span>
<a href="#l4.24"></a><span id="l4.24">   ////////////////////////////</span>
<a href="#l4.25"></a><span id="l4.25">   // setWindowValue, et al. //</span>
<a href="#l4.26"></a><span id="l4.26">   ////////////////////////////</span>
<a href="#l4.27"></a><span id="l4.27">   let key = &quot;Unique name: &quot; + Date.now();</span>
<a href="#l4.28"></a><span id="l4.28">   let value = &quot;Unique value: &quot; + Math.random();</span>
<a href="#l4.29"></a><span id="l4.29">   </span>
<a href="#l4.30"></a><span id="l4.30">   // test adding</span>
<a href="#l4.31"></a><span id="l4.31">   ok(test(function() ss.setWindowValue(window, key, value)), &quot;set a window value&quot;);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineat">@@ -39,69 +29,69 @@ function test() {</span>
<a href="#l4.33"></a><span id="l4.33">   // value should not exist post-delete</span>
<a href="#l4.34"></a><span id="l4.34">   is(ss.getWindowValue(window, key), &quot;&quot;, &quot;window value was deleted&quot;);</span>
<a href="#l4.35"></a><span id="l4.35">   </span>
<a href="#l4.36"></a><span id="l4.36">   /////////////////////////</span>
<a href="#l4.37"></a><span id="l4.37">   // setTabValue, et al. //</span>
<a href="#l4.38"></a><span id="l4.38">   /////////////////////////</span>
<a href="#l4.39"></a><span id="l4.39">   key = &quot;Unique name: &quot; + Math.random();</span>
<a href="#l4.40"></a><span id="l4.40">   value = &quot;Unique value: &quot; + Date.now();</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-  let tab = tabbrowser.addTab();</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+  let tab = getBrowser().addTab();</span>
<a href="#l4.43"></a><span id="l4.43">   tab.linkedBrowser.stop();</span>
<a href="#l4.44"></a><span id="l4.44">   </span>
<a href="#l4.45"></a><span id="l4.45">   // test adding</span>
<a href="#l4.46"></a><span id="l4.46">   ok(test(function() ss.setTabValue(tab, key, value)), &quot;store a tab value&quot;);</span>
<a href="#l4.47"></a><span id="l4.47">   </span>
<a href="#l4.48"></a><span id="l4.48">   // test retrieving</span>
<a href="#l4.49"></a><span id="l4.49">   is(ss.getTabValue(tab, key), value, &quot;stored tab value match original&quot;);</span>
<a href="#l4.50"></a><span id="l4.50">   </span>
<a href="#l4.51"></a><span id="l4.51">   // test deleting </span>
<a href="#l4.52"></a><span id="l4.52">   ok(test(function() ss.deleteTabValue(tab, key)), &quot;delete the tab value&quot;);</span>
<a href="#l4.53"></a><span id="l4.53">   // value should not exist post-delete</span>
<a href="#l4.54"></a><span id="l4.54">   is(ss.getTabValue(tab, key), &quot;&quot;, &quot;tab value was deleted&quot;);</span>
<a href="#l4.55"></a><span id="l4.55">   </span>
<a href="#l4.56"></a><span id="l4.56">   // clean up</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-  tabbrowser.removeTab(tab);</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+  getBrowser().removeTab(tab);</span>
<a href="#l4.59"></a><span id="l4.59">   </span>
<a href="#l4.60"></a><span id="l4.60">   /////////////////////////////////////</span>
<a href="#l4.61"></a><span id="l4.61">   // getClosedTabCount, undoCloseTab //</span>
<a href="#l4.62"></a><span id="l4.62">   /////////////////////////////////////</span>
<a href="#l4.63"></a><span id="l4.63">   </span>
<a href="#l4.64"></a><span id="l4.64">   // get closed tab count</span>
<a href="#l4.65"></a><span id="l4.65">   var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l4.66"></a><span id="l4.66">                                .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l4.67"></a><span id="l4.67"> </span>
<a href="#l4.68"></a><span id="l4.68">   let count = ss.getClosedTabCount(window);</span>
<a href="#l4.69"></a><span id="l4.69">   let max_tabs_undo = gPrefService.getIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l4.70"></a><span id="l4.70">   ok(0 &lt;= count &amp;&amp; count &lt;= max_tabs_undo,</span>
<a href="#l4.71"></a><span id="l4.71">      &quot;getClosedTabCount returns zero or at most max_tabs_undo&quot;);</span>
<a href="#l4.72"></a><span id="l4.72">   </span>
<a href="#l4.73"></a><span id="l4.73">   // create a new tab</span>
<a href="#l4.74"></a><span id="l4.74">   let testURL = &quot;about:&quot;;</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-  tab = tabbrowser.addTab(testURL);</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineplus">+  tab = getBrowser().addTab(testURL);</span>
<a href="#l4.77"></a><span id="l4.77">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l4.78"></a><span id="l4.78">     this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l4.79"></a><span id="l4.79">     // make sure that the next closed tab will increase getClosedTabCount</span>
<a href="#l4.80"></a><span id="l4.80">     gPrefService.setIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;, max_tabs_undo + 1);</span>
<a href="#l4.81"></a><span id="l4.81">     </span>
<a href="#l4.82"></a><span id="l4.82">     // remove tab</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-    tabbrowser.removeTab(tab);</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+    getBrowser().removeTab(tab);</span>
<a href="#l4.85"></a><span id="l4.85">     </span>
<a href="#l4.86"></a><span id="l4.86">     // getClosedTabCount</span>
<a href="#l4.87"></a><span id="l4.87">     var newcount = ss.getClosedTabCount(window);</span>
<a href="#l4.88"></a><span id="l4.88">     ok(newcount &gt; count, &quot;after closing a tab, getClosedTabCount has been incremented&quot;);</span>
<a href="#l4.89"></a><span id="l4.89">     </span>
<a href="#l4.90"></a><span id="l4.90">     // undoCloseTab</span>
<a href="#l4.91"></a><span id="l4.91">     tab = test(function() ss.undoCloseTab(window, 0));</span>
<a href="#l4.92"></a><span id="l4.92">     ok(tab, &quot;undoCloseTab doesn't throw&quot;)</span>
<a href="#l4.93"></a><span id="l4.93">     </span>
<a href="#l4.94"></a><span id="l4.94">     tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l4.95"></a><span id="l4.95">       this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l4.96"></a><span id="l4.96">       is(this.currentURI.spec, testURL, &quot;correct tab was reopened&quot;);</span>
<a href="#l4.97"></a><span id="l4.97">       </span>
<a href="#l4.98"></a><span id="l4.98">       // clean up</span>
<a href="#l4.99"></a><span id="l4.99">       if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.max_tabs_undo&quot;))</span>
<a href="#l4.100"></a><span id="l4.100">         gPrefService.clearUserPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-      tabbrowser.removeTab(tab);</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+      getBrowser().removeTab(tab);</span>
<a href="#l4.103"></a><span id="l4.103">       finish();</span>
<a href="#l4.104"></a><span id="l4.104">     }, true);</span>
<a href="#l4.105"></a><span id="l4.105">   }, true);</span>
<a href="#l4.106"></a><span id="l4.106"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/common/tests/browser/browser_367052.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_367052.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -32,46 +32,40 @@</span>
<a href="#l5.4"></a><span id="l5.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.5"></a><span id="l5.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.6"></a><span id="l5.6">  *</span>
<a href="#l5.7"></a><span id="l5.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> function test() {</span>
<a href="#l5.10"></a><span id="l5.10">   /** Test for Bug 367052 **/</span>
<a href="#l5.11"></a><span id="l5.11">   </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  // test setup</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-  let tabbrowser = gBrowser;</span>
<a href="#l5.15"></a><span id="l5.15">   waitForExplicitFinish();</span>
<a href="#l5.16"></a><span id="l5.16">   </span>
<a href="#l5.17"></a><span id="l5.17">   // make sure that the next closed tab will increase getClosedTabCount</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-                        .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-  let max_tabs_undo = gPrefService.getIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-  gPrefService.setIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;, max_tabs_undo + 1);</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+  let max_tabs_undo = Services.prefs.getIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+  Services.prefs.setIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;, max_tabs_undo + 1);</span>
<a href="#l5.25"></a><span id="l5.25">   let closedTabCount = ss.getClosedTabCount(window);</span>
<a href="#l5.26"></a><span id="l5.26">   </span>
<a href="#l5.27"></a><span id="l5.27">   // restore a blank tab</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-  let tab = tabbrowser.addTab(&quot;about:&quot;);</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+  let tab = getBrowser().addTab(&quot;about:&quot;);</span>
<a href="#l5.30"></a><span id="l5.30">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l5.31"></a><span id="l5.31">     this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l5.32"></a><span id="l5.32">     </span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-    let browser = tabbrowser.getBrowserForTab(tab);</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+    let browser = getBrowser().getBrowserForTab(tab);</span>
<a href="#l5.35"></a><span id="l5.35">     let history = browser.webNavigation.sessionHistory;</span>
<a href="#l5.36"></a><span id="l5.36">     ok(history.count &gt;= 1, &quot;the new tab does have at least one history entry&quot;);</span>
<a href="#l5.37"></a><span id="l5.37">     </span>
<a href="#l5.38"></a><span id="l5.38">     ss.setTabState(tab, '{ &quot;entries&quot;: [] }');</span>
<a href="#l5.39"></a><span id="l5.39">     tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l5.40"></a><span id="l5.40">       this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l5.41"></a><span id="l5.41">       ok(history.count == 0, &quot;the tab was restored without any history whatsoever&quot;);</span>
<a href="#l5.42"></a><span id="l5.42">       </span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-      tabbrowser.removeTab(tab);</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+      getBrowser().removeTab(tab);</span>
<a href="#l5.45"></a><span id="l5.45">       ok(ss.getClosedTabCount(window) == closedTabCount,</span>
<a href="#l5.46"></a><span id="l5.46">          &quot;The closed blank tab wasn't added to Recently Closed Tabs&quot;);</span>
<a href="#l5.47"></a><span id="l5.47">       </span>
<a href="#l5.48"></a><span id="l5.48">       // clean up</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-      if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.max_tabs_undo&quot;))</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-        gPrefService.clearUserPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+      if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.max_tabs_undo&quot;))</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+        Services.prefs.clearUserPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l5.53"></a><span id="l5.53">       finish();</span>
<a href="#l5.54"></a><span id="l5.54">     }, true);</span>
<a href="#l5.55"></a><span id="l5.55">   }, true);</span>
<a href="#l5.56"></a><span id="l5.56"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/common/tests/browser/browser_393716.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_393716.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,29 +1,22 @@</span>
<a href="#l6.4"></a><span id="l6.4"> function test() {</span>
<a href="#l6.5"></a><span id="l6.5">   /** Test for Bug 393716 **/</span>
<a href="#l6.6"></a><span id="l6.6">   </span>
<a href="#l6.7"></a><span id="l6.7" class="difflineminus">-  // set up the basics (SessionStore service, tabbrowser)</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">-  try {</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">-    var ss = Cc[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-  }</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">-  catch (ex) { }</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  ok(ss, &quot;SessionStore service is available&quot;);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-  let tabbrowser = getBrowser();</span>
<a href="#l6.14"></a><span id="l6.14">   waitForExplicitFinish();</span>
<a href="#l6.15"></a><span id="l6.15">   </span>
<a href="#l6.16"></a><span id="l6.16">   /////////////////</span>
<a href="#l6.17"></a><span id="l6.17">   // getTabState //</span>
<a href="#l6.18"></a><span id="l6.18">   /////////////////</span>
<a href="#l6.19"></a><span id="l6.19">   let key = &quot;Unique key: &quot; + Date.now();</span>
<a href="#l6.20"></a><span id="l6.20">   let value = &quot;Unique value: &quot; + Math.random();</span>
<a href="#l6.21"></a><span id="l6.21">   let testURL = &quot;about:config&quot;;</span>
<a href="#l6.22"></a><span id="l6.22">   </span>
<a href="#l6.23"></a><span id="l6.23">   // create a new tab</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-  let tab = tabbrowser.addTab(testURL);</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+  let tab = getBrowser().addTab(testURL);</span>
<a href="#l6.26"></a><span id="l6.26">   ss.setTabValue(tab, key, value);</span>
<a href="#l6.27"></a><span id="l6.27">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l6.28"></a><span id="l6.28">     this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l6.29"></a><span id="l6.29">     // get the tab's state</span>
<a href="#l6.30"></a><span id="l6.30">     let state = ss.getTabState(tab);</span>
<a href="#l6.31"></a><span id="l6.31">     ok(state, &quot;get the tab's state&quot;);</span>
<a href="#l6.32"></a><span id="l6.32">     </span>
<a href="#l6.33"></a><span id="l6.33">     // verify the tab state's integrity</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineat">@@ -31,51 +24,51 @@ function test() {</span>
<a href="#l6.35"></a><span id="l6.35">     ok(state instanceof Object &amp;&amp; state.entries instanceof Array &amp;&amp; state.entries.length &gt; 0,</span>
<a href="#l6.36"></a><span id="l6.36">        &quot;state object seems valid&quot;);</span>
<a href="#l6.37"></a><span id="l6.37">     ok(state.entries.length == 1 &amp;&amp; state.entries[0].url == testURL,</span>
<a href="#l6.38"></a><span id="l6.38">        &quot;Got the expected state object (test URL)&quot;);</span>
<a href="#l6.39"></a><span id="l6.39">     ok(state.extData &amp;&amp; state.extData[key] == value,</span>
<a href="#l6.40"></a><span id="l6.40">        &quot;Got the expected state object (test manually set tab value)&quot;);</span>
<a href="#l6.41"></a><span id="l6.41">     </span>
<a href="#l6.42"></a><span id="l6.42">     // clean up</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-    tabbrowser.removeTab(tab);</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+    getBrowser().removeTab(tab);</span>
<a href="#l6.45"></a><span id="l6.45">   }, true);</span>
<a href="#l6.46"></a><span id="l6.46">   </span>
<a href="#l6.47"></a><span id="l6.47">   //////////////////////////////////</span>
<a href="#l6.48"></a><span id="l6.48">   // setTabState and duplicateTab //</span>
<a href="#l6.49"></a><span id="l6.49">   //////////////////////////////////</span>
<a href="#l6.50"></a><span id="l6.50">   let key2 = &quot;key2&quot;;</span>
<a href="#l6.51"></a><span id="l6.51">   let value2 = &quot;Value &quot; + Math.random();</span>
<a href="#l6.52"></a><span id="l6.52">   let value3 = &quot;Another value: &quot; + Date.now();</span>
<a href="#l6.53"></a><span id="l6.53">   let state = { entries: [{ url: testURL }], extData: { key2: value2 } };</span>
<a href="#l6.54"></a><span id="l6.54">   </span>
<a href="#l6.55"></a><span id="l6.55">   // create a new tab</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-  let tab2 = tabbrowser.addTab();</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+  let tab2 = getBrowser().addTab();</span>
<a href="#l6.58"></a><span id="l6.58">   // set the tab's state</span>
<a href="#l6.59"></a><span id="l6.59">   ss.setTabState(tab2, JSON.stringify(state));</span>
<a href="#l6.60"></a><span id="l6.60">   tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l6.61"></a><span id="l6.61">     this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l6.62"></a><span id="l6.62">    // verify the correctness of the restored tab</span>
<a href="#l6.63"></a><span id="l6.63">     ok(ss.getTabValue(tab2, key2) == value2 &amp;&amp; this.currentURI.spec == testURL,</span>
<a href="#l6.64"></a><span id="l6.64">        &quot;the tab's state was correctly restored&quot;);</span>
<a href="#l6.65"></a><span id="l6.65">     </span>
<a href="#l6.66"></a><span id="l6.66">     // add text data</span>
<a href="#l6.67"></a><span id="l6.67">     let textbox = this.contentDocument.getElementById(&quot;textbox&quot;);</span>
<a href="#l6.68"></a><span id="l6.68">     textbox.value = value3;</span>
<a href="#l6.69"></a><span id="l6.69">     </span>
<a href="#l6.70"></a><span id="l6.70">     // duplicate the tab</span>
<a href="#l6.71"></a><span id="l6.71">     let duplicateTab = ss.duplicateTab(window, tab2);</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-    tabbrowser.removeTab(tab2);</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+    getBrowser().removeTab(tab2);</span>
<a href="#l6.74"></a><span id="l6.74">     </span>
<a href="#l6.75"></a><span id="l6.75">     duplicateTab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l6.76"></a><span id="l6.76">       this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l6.77"></a><span id="l6.77">       // verify the correctness of the duplicated tab</span>
<a href="#l6.78"></a><span id="l6.78">       ok(ss.getTabValue(duplicateTab, key2) == value2 &amp;&amp; this.currentURI.spec == testURL,</span>
<a href="#l6.79"></a><span id="l6.79">          &quot;correctly duplicated the tab's state&quot;);</span>
<a href="#l6.80"></a><span id="l6.80">       let textbox = this.contentDocument.getElementById(&quot;textbox&quot;);</span>
<a href="#l6.81"></a><span id="l6.81">       is(textbox.value, value3, &quot;also duplicated text data&quot;);</span>
<a href="#l6.82"></a><span id="l6.82">       </span>
<a href="#l6.83"></a><span id="l6.83">       // clean up</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-      tabbrowser.removeTab(duplicateTab);</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+      getBrowser().removeTab(duplicateTab);</span>
<a href="#l6.86"></a><span id="l6.86">       finish();</span>
<a href="#l6.87"></a><span id="l6.87">     }, true);</span>
<a href="#l6.88"></a><span id="l6.88">   }, true);</span>
<a href="#l6.89"></a><span id="l6.89"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/common/tests/browser/browser_408470.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_408470.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -32,26 +32,22 @@</span>
<a href="#l7.4"></a><span id="l7.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l7.5"></a><span id="l7.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l7.6"></a><span id="l7.6">  *</span>
<a href="#l7.7"></a><span id="l7.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> function test() {</span>
<a href="#l7.10"></a><span id="l7.10">   /** Test for Bug 408470 **/</span>
<a href="#l7.11"></a><span id="l7.11">   </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  try {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-    var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-  }</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-  catch (ex) { }</span>
<a href="#l7.16"></a><span id="l7.16">   waitForExplicitFinish();</span>
<a href="#l7.17"></a><span id="l7.17">   </span>
<a href="#l7.18"></a><span id="l7.18">   let pendingCount = 1;</span>
<a href="#l7.19"></a><span id="l7.19">   let rootDir = getRootDirectory(gTestPath);</span>
<a href="#l7.20"></a><span id="l7.20">   let testURL = rootDir + &quot;browser_408470_sample.html&quot;;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-  let tab = gBrowser.addTab(testURL);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+  let tab = getBrowser().addTab(testURL);</span>
<a href="#l7.23"></a><span id="l7.23">   let window = tab.ownerDocument.defaultView;</span>
<a href="#l7.24"></a><span id="l7.24">   </span>
<a href="#l7.25"></a><span id="l7.25">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l7.26"></a><span id="l7.26">     tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l7.27"></a><span id="l7.27">     // enable all stylesheets and verify that they're correctly persisted</span>
<a href="#l7.28"></a><span id="l7.28">     Array.forEach(tab.linkedBrowser.contentDocument.styleSheets, function(aSS, aIx) {</span>
<a href="#l7.29"></a><span id="l7.29">       pendingCount++;</span>
<a href="#l7.30"></a><span id="l7.30">       let ssTitle = aSS.title;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineat">@@ -64,30 +60,30 @@ function test() {</span>
<a href="#l7.32"></a><span id="l7.32">                                function(aSS) !aSS.disabled);</span>
<a href="#l7.33"></a><span id="l7.33">         let correct = states.indexOf(true) == aIx &amp;&amp; states.indexOf(true, aIx + 1) == -1;</span>
<a href="#l7.34"></a><span id="l7.34">         </span>
<a href="#l7.35"></a><span id="l7.35">         if (/^fail_/.test(ssTitle))</span>
<a href="#l7.36"></a><span id="l7.36">           ok(!correct, &quot;didn't restore stylesheet &quot; + ssTitle);</span>
<a href="#l7.37"></a><span id="l7.37">         else</span>
<a href="#l7.38"></a><span id="l7.38">           ok(correct, &quot;restored stylesheet &quot; + ssTitle);</span>
<a href="#l7.39"></a><span id="l7.39">         </span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-        gBrowser.removeTab(newTab);</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+        getBrowser().removeTab(newTab);</span>
<a href="#l7.42"></a><span id="l7.42">         if (--pendingCount == 0)</span>
<a href="#l7.43"></a><span id="l7.43">           finish();</span>
<a href="#l7.44"></a><span id="l7.44">       }, true);</span>
<a href="#l7.45"></a><span id="l7.45">     });</span>
<a href="#l7.46"></a><span id="l7.46">     </span>
<a href="#l7.47"></a><span id="l7.47">     // disable all styles and verify that this is correctly persisted</span>
<a href="#l7.48"></a><span id="l7.48">     tab.linkedBrowser.markupDocumentViewer.authorStyleDisabled = true;</span>
<a href="#l7.49"></a><span id="l7.49">     let newTab = ss.duplicateTab(window,tab);</span>
<a href="#l7.50"></a><span id="l7.50">     newTab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l7.51"></a><span id="l7.51">       tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l7.52"></a><span id="l7.52">       is(newTab.linkedBrowser.markupDocumentViewer.authorStyleDisabled, true,</span>
<a href="#l7.53"></a><span id="l7.53">          &quot;disabled all stylesheets&quot;);</span>
<a href="#l7.54"></a><span id="l7.54">       </span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-      gBrowser.removeTab(newTab);</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+      getBrowser().removeTab(newTab);</span>
<a href="#l7.57"></a><span id="l7.57">       if (--pendingCount == 0)</span>
<a href="#l7.58"></a><span id="l7.58">         finish();</span>
<a href="#l7.59"></a><span id="l7.59">     }, true);</span>
<a href="#l7.60"></a><span id="l7.60">     </span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-    gBrowser.removeTab(tab);</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+    getBrowser().removeTab(tab);</span>
<a href="#l7.63"></a><span id="l7.63">   }, true);</span>
<a href="#l7.64"></a><span id="l7.64"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/common/tests/browser/browser_423132.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_423132.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -46,30 +46,24 @@ function browserWindowsCount() {</span>
<a href="#l8.4"></a><span id="l8.4">   return count;</span>
<a href="#l8.5"></a><span id="l8.5"> }</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> function test() {</span>
<a href="#l8.8"></a><span id="l8.8">   // test that cookies are stored and restored correctly by sessionstore,</span>
<a href="#l8.9"></a><span id="l8.9">   // bug 423132, ported by bug 524371.</span>
<a href="#l8.10"></a><span id="l8.10">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  // test setup</span>
<a href="#l8.13"></a><span id="l8.13">   waitForExplicitFinish();</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">   let cs = Components.classes[&quot;@mozilla.org/cookiemanager;1&quot;].getService(Components.interfaces.nsICookieManager2);</span>
<a href="#l8.16"></a><span id="l8.16">   cs.removeAll();</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-</span>
<a href="#l8.23"></a><span id="l8.23">   // make sure that sessionstore.js can be forced to be created by setting</span>
<a href="#l8.24"></a><span id="l8.24">   // the interval pref to 0</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-  gPrefService.setIntPref(&quot;browser.sessionstore.interval&quot;, 0);</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+  Services.prefs.setIntPref(&quot;browser.sessionstore.interval&quot;, 0);</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28">   const testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l8.29"></a><span id="l8.29">     &quot;suite/common/tests/browser/browser_423132_sample.html&quot;;</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31">   // open a new window</span>
<a href="#l8.32"></a><span id="l8.32">   let newWin = openDialog(location, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;, &quot;about:blank&quot;);</span>
<a href="#l8.33"></a><span id="l8.33"> </span>
<a href="#l8.34"></a><span id="l8.34">   // make sure sessionstore saves the cookie data, then close the window</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineat">@@ -108,17 +102,17 @@ function test() {</span>
<a href="#l8.36"></a><span id="l8.36">         if (cookie.name == cookie2.name)</span>
<a href="#l8.37"></a><span id="l8.37">           break;</span>
<a href="#l8.38"></a><span id="l8.38">       }</span>
<a href="#l8.39"></a><span id="l8.39">       is(cookie.name, cookie2.name, &quot;cookie name successfully restored&quot;);</span>
<a href="#l8.40"></a><span id="l8.40">       is(cookie.value, cookie2.value, &quot;cookie value successfully restored&quot;);</span>
<a href="#l8.41"></a><span id="l8.41">       is(cookie.path, cookie2.path, &quot;cookie path successfully restored&quot;);</span>
<a href="#l8.42"></a><span id="l8.42"> </span>
<a href="#l8.43"></a><span id="l8.43">       // clean up</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-      if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.interval&quot;))</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-        gPrefService.clearUserPref(&quot;browser.sessionstore.interval&quot;);</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+      if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.interval&quot;))</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+        Services.prefs.clearUserPref(&quot;browser.sessionstore.interval&quot;);</span>
<a href="#l8.48"></a><span id="l8.48">       cs.removeAll();</span>
<a href="#l8.49"></a><span id="l8.49">       newWin.close();</span>
<a href="#l8.50"></a><span id="l8.50">       is(browserWindowsCount(), 1, &quot;Only one browser window should be open eventually&quot;);</span>
<a href="#l8.51"></a><span id="l8.51">       finish();</span>
<a href="#l8.52"></a><span id="l8.52">     }, true);</span>
<a href="#l8.53"></a><span id="l8.53">   }, false);</span>
<a href="#l8.54"></a><span id="l8.54"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/common/tests/browser/browser_447951.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_447951.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -32,32 +32,26 @@</span>
<a href="#l9.4"></a><span id="l9.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.5"></a><span id="l9.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.6"></a><span id="l9.6">  *</span>
<a href="#l9.7"></a><span id="l9.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> function test() {</span>
<a href="#l9.10"></a><span id="l9.10">   /** Test for Bug 447951 **/</span>
<a href="#l9.11"></a><span id="l9.11">   </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  // test setup</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l9.15"></a><span id="l9.15">   waitForExplicitFinish();</span>
<a href="#l9.16"></a><span id="l9.16">   const baseURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l9.17"></a><span id="l9.17">     &quot;suite/common/tests/browser/browser_447951_sample.html#&quot;;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-    </span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22">   let tab = getBrowser().addTab();</span>
<a href="#l9.23"></a><span id="l9.23">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l9.24"></a><span id="l9.24">     tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l9.25"></a><span id="l9.25">     </span>
<a href="#l9.26"></a><span id="l9.26">     let tabState = { entries: [] };</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">-    let max_entries = gPrefService.getIntPref(&quot;browser.sessionhistory.max_entries&quot;);</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+    let max_entries = Services.prefs.getIntPref(&quot;browser.sessionhistory.max_entries&quot;);</span>
<a href="#l9.29"></a><span id="l9.29">     for (let i = 0; i &lt; max_entries; i++)</span>
<a href="#l9.30"></a><span id="l9.30">       tabState.entries.push({ url: baseURL + i });</span>
<a href="#l9.31"></a><span id="l9.31">     </span>
<a href="#l9.32"></a><span id="l9.32">     ss.setTabState(tab, JSON.stringify(tabState));</span>
<a href="#l9.33"></a><span id="l9.33">     tab.addEventListener(&quot;SSTabRestored&quot;, function(aEvent) {</span>
<a href="#l9.34"></a><span id="l9.34">       tab.removeEventListener(&quot;SSTabRestored&quot;, arguments.callee, false);</span>
<a href="#l9.35"></a><span id="l9.35">       tabState = JSON.parse(ss.getTabState(tab));</span>
<a href="#l9.36"></a><span id="l9.36">       is(tabState.entries.length, max_entries, &quot;session history filled to the limit&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/common/tests/browser/browser_448741.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_448741.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -32,24 +32,16 @@</span>
<a href="#l10.4"></a><span id="l10.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l10.5"></a><span id="l10.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l10.6"></a><span id="l10.6">  *</span>
<a href="#l10.7"></a><span id="l10.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> function test() {</span>
<a href="#l10.10"></a><span id="l10.10">   /** Test for Bug 448741 **/</span>
<a href="#l10.11"></a><span id="l10.11">   </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  // test setup</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-  let os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-                     .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">-                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineminus">-</span>
<a href="#l10.20"></a><span id="l10.20">   waitForExplicitFinish();</span>
<a href="#l10.21"></a><span id="l10.21">   </span>
<a href="#l10.22"></a><span id="l10.22">   let uniqueName = &quot;bug 448741&quot;;</span>
<a href="#l10.23"></a><span id="l10.23">   let uniqueValue = &quot;as good as unique: &quot; + Date.now();</span>
<a href="#l10.24"></a><span id="l10.24">   </span>
<a href="#l10.25"></a><span id="l10.25">   // set a unique value on a new, blank tab</span>
<a href="#l10.26"></a><span id="l10.26">   var tab = getBrowser().addTab();</span>
<a href="#l10.27"></a><span id="l10.27">   tab.linkedBrowser.stop();</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineat">@@ -71,32 +63,32 @@ function test() {</span>
<a href="#l10.29"></a><span id="l10.29">           delete tabData.extData[uniqueName];</span>
<a href="#l10.30"></a><span id="l10.30">           valueWasCleaned = true;</span>
<a href="#l10.31"></a><span id="l10.31">         }</span>
<a href="#l10.32"></a><span id="l10.32">       });</span>
<a href="#l10.33"></a><span id="l10.33">     });</span>
<a href="#l10.34"></a><span id="l10.34"> </span>
<a href="#l10.35"></a><span id="l10.35">     ok(valueWasCleaned, &quot;found and removed the specific tab value&quot;);</span>
<a href="#l10.36"></a><span id="l10.36">     aSubject.data = JSON.stringify(state);</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">-    os.removeObserver(cleaningObserver, aTopic, false);</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+    Services.obs.removeObserver(cleaningObserver, aTopic, false);</span>
<a href="#l10.39"></a><span id="l10.39">   }</span>
<a href="#l10.40"></a><span id="l10.40">   </span>
<a href="#l10.41"></a><span id="l10.41">   // make sure that all later observers don't see that value any longer</span>
<a href="#l10.42"></a><span id="l10.42">   function checkingObserver(aSubject, aTopic, aData) {</span>
<a href="#l10.43"></a><span id="l10.43">     ok(valueWasCleaned &amp;&amp; aSubject instanceof Ci.nsISupportsString,</span>
<a href="#l10.44"></a><span id="l10.44">        &quot;ready to check the cleaned state?&quot;);</span>
<a href="#l10.45"></a><span id="l10.45">     ok(aSubject.data.indexOf(uniqueValue) == -1, &quot;data no longer contains our value?&quot;);</span>
<a href="#l10.46"></a><span id="l10.46"> </span>
<a href="#l10.47"></a><span id="l10.47">     // clean up</span>
<a href="#l10.48"></a><span id="l10.48">     getBrowser().removeTab(tab);</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-    os.removeObserver(checkingObserver, aTopic, false);</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-    if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.interval&quot;))</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-      gPrefService.clearUserPref(&quot;browser.sessionstore.interval&quot;);</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+    Services.obs.removeObserver(checkingObserver, aTopic, false);</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+    if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.interval&quot;))</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+      Services.prefs.clearUserPref(&quot;browser.sessionstore.interval&quot;);</span>
<a href="#l10.55"></a><span id="l10.55">     finish();</span>
<a href="#l10.56"></a><span id="l10.56">   }</span>
<a href="#l10.57"></a><span id="l10.57">   </span>
<a href="#l10.58"></a><span id="l10.58">   // last added observers are invoked first</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-  os.addObserver(checkingObserver, &quot;sessionstore-state-write&quot;, false);</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineminus">-  os.addObserver(cleaningObserver, &quot;sessionstore-state-write&quot;, false);</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+  Services.obs.addObserver(checkingObserver, &quot;sessionstore-state-write&quot;, false);</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+  Services.obs.addObserver(cleaningObserver, &quot;sessionstore-state-write&quot;, false);</span>
<a href="#l10.63"></a><span id="l10.63">   </span>
<a href="#l10.64"></a><span id="l10.64">   // trigger an immediate save operation</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">-  gPrefService.setIntPref(&quot;browser.sessionstore.interval&quot;, 0);</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+  Services.prefs.setIntPref(&quot;browser.sessionstore.interval&quot;, 0);</span>
<a href="#l10.67"></a><span id="l10.67"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/common/tests/browser/browser_454908.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_454908.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -40,20 +40,17 @@ function test() {</span>
<a href="#l11.4"></a><span id="l11.4">   waitForExplicitFinish();</span>
<a href="#l11.5"></a><span id="l11.5">   </span>
<a href="#l11.6"></a><span id="l11.6">   let fieldValues = {</span>
<a href="#l11.7"></a><span id="l11.7">     username: &quot;User &quot; + Math.random(),</span>
<a href="#l11.8"></a><span id="l11.8">     passwd:   &quot;pwd&quot; + Date.now()</span>
<a href="#l11.9"></a><span id="l11.9">   };</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">   // make sure we do save form data</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-                        .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-  gPrefService.setIntPref(&quot;browser.sessionstore.privacy_level&quot;, 0);</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+  Services.prefs.setIntPref(&quot;browser.sessionstore.privacy_level&quot;, 0);</span>
<a href="#l11.17"></a><span id="l11.17">   </span>
<a href="#l11.18"></a><span id="l11.18">   let rootDir = getRootDirectory(gTestPath);</span>
<a href="#l11.19"></a><span id="l11.19">   let testURL = rootDir + &quot;browser_454908_sample.html&quot;;</span>
<a href="#l11.20"></a><span id="l11.20">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l11.21"></a><span id="l11.21">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l11.22"></a><span id="l11.22">     tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l11.23"></a><span id="l11.23">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l11.24"></a><span id="l11.24">     for (let id in fieldValues)</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineat">@@ -69,18 +66,18 @@ function test() {</span>
<a href="#l11.26"></a><span id="l11.26">         let node = doc.getElementById(id);</span>
<a href="#l11.27"></a><span id="l11.27">         if (node.type == &quot;password&quot;)</span>
<a href="#l11.28"></a><span id="l11.28">           is(node.value, &quot;&quot;, &quot;password wasn't saved/restored&quot;);</span>
<a href="#l11.29"></a><span id="l11.29">         else</span>
<a href="#l11.30"></a><span id="l11.30">           is(node.value, fieldValues[id], &quot;username was saved/restored&quot;);</span>
<a href="#l11.31"></a><span id="l11.31">       }</span>
<a href="#l11.32"></a><span id="l11.32">       </span>
<a href="#l11.33"></a><span id="l11.33">       // clean up</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-      if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.privacy_level&quot;))</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-        gPrefService.clearUserPref(&quot;browser.sessionstore.privacy_level&quot;);</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+      if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.privacy_level&quot;))</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+        Services.prefs.clearUserPref(&quot;browser.sessionstore.privacy_level&quot;);</span>
<a href="#l11.38"></a><span id="l11.38">       // undoCloseTab can reuse a single blank tab, so we have to</span>
<a href="#l11.39"></a><span id="l11.39">       // make sure not to close the window when closing our last tab</span>
<a href="#l11.40"></a><span id="l11.40">       if (gBrowser.tabContainer.childNodes.length == 1)</span>
<a href="#l11.41"></a><span id="l11.41">         gBrowser.addTab();</span>
<a href="#l11.42"></a><span id="l11.42">       gBrowser.removeTab(tab);</span>
<a href="#l11.43"></a><span id="l11.43">       finish();</span>
<a href="#l11.44"></a><span id="l11.44">     }, true);</span>
<a href="#l11.45"></a><span id="l11.45">   }, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/common/tests/browser/browser_456342.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_456342.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -35,23 +35,17 @@</span>
<a href="#l12.4"></a><span id="l12.4">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> function test() {</span>
<a href="#l12.7"></a><span id="l12.7">   /** Test for Bug 456342 **/</span>
<a href="#l12.8"></a><span id="l12.8">   </span>
<a href="#l12.9"></a><span id="l12.9">   waitForExplicitFinish();</span>
<a href="#l12.10"></a><span id="l12.10">   </span>
<a href="#l12.11"></a><span id="l12.11">   // make sure we do save form data</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-  var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-  gPrefService.setIntPref(&quot;browser.sessionstore.privacy_level&quot;, 0);</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+  Services.prefs.setIntPref(&quot;browser.sessionstore.privacy_level&quot;, 0);</span>
<a href="#l12.20"></a><span id="l12.20">   </span>
<a href="#l12.21"></a><span id="l12.21">   let rootDir = getRootDirectory(gTestPath);</span>
<a href="#l12.22"></a><span id="l12.22">   let testURL = rootDir + &quot;browser_456342_sample.xhtml&quot;;</span>
<a href="#l12.23"></a><span id="l12.23">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l12.24"></a><span id="l12.24">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l12.25"></a><span id="l12.25">     this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27">     let expectedValue = &quot;try to save me&quot;;</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineat">@@ -73,13 +67,13 @@ function test() {</span>
<a href="#l12.29"></a><span id="l12.29">       else</span>
<a href="#l12.30"></a><span id="l12.30">         countBad++;</span>
<a href="#l12.31"></a><span id="l12.31">     }</span>
<a href="#l12.32"></a><span id="l12.32">     </span>
<a href="#l12.33"></a><span id="l12.33">     is(countGood, 4, &quot;Saved text for non-standard input fields&quot;);</span>
<a href="#l12.34"></a><span id="l12.34">     is(countBad,  0, &quot;Didn't save text for ignored field types&quot;);</span>
<a href="#l12.35"></a><span id="l12.35">     </span>
<a href="#l12.36"></a><span id="l12.36">     // clean up</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-    if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.privacy_level&quot;))</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-      gPrefService.clearUserPref(&quot;browser.sessionstore.privacy_level&quot;);</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+    if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.privacy_level&quot;))</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+      Services.prefs.clearUserPref(&quot;browser.sessionstore.privacy_level&quot;);</span>
<a href="#l12.41"></a><span id="l12.41">     finish();</span>
<a href="#l12.42"></a><span id="l12.42">   }, true);</span>
<a href="#l12.43"></a><span id="l12.43"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/suite/common/tests/browser/browser_461634.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_461634.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -44,20 +44,16 @@ function browserWindowsCount() {</span>
<a href="#l13.4"></a><span id="l13.4">   }</span>
<a href="#l13.5"></a><span id="l13.5">   return count;</span>
<a href="#l13.6"></a><span id="l13.6"> }</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> function test() {</span>
<a href="#l13.9"></a><span id="l13.9">   /** Test for Bug 461634, ported by Bug 524345 **/</span>
<a href="#l13.10"></a><span id="l13.10">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  // test setup</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l13.16"></a><span id="l13.16">   waitForExplicitFinish();</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18">   const REMEMBER = Date.now(), FORGET = Math.random();</span>
<a href="#l13.19"></a><span id="l13.19">   let test_state = { windows: [{ &quot;tabs&quot;: [{ &quot;entries&quot;: [] }], _closedTabs: [</span>
<a href="#l13.20"></a><span id="l13.20">     { state: { entries: [{ url: &quot;http://www.example.net/&quot; }] }, title: FORGET },</span>
<a href="#l13.21"></a><span id="l13.21">     { state: { entries: [{ url: &quot;http://www.example.net/&quot; }] }, title: REMEMBER },</span>
<a href="#l13.22"></a><span id="l13.22">     { state: { entries: [{ url: &quot;http://www.example.net/&quot; }] }, title: FORGET },</span>
<a href="#l13.23"></a><span id="l13.23">     { state: { entries: [{ url: &quot;http://www.example.net/&quot; }] }, title: REMEMBER },</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineat">@@ -75,18 +71,18 @@ function test() {</span>
<a href="#l13.25"></a><span id="l13.25">     catch (ex) {</span>
<a href="#l13.26"></a><span id="l13.26">       return ex.name == &quot;NS_ERROR_ILLEGAL_VALUE&quot;;</span>
<a href="#l13.27"></a><span id="l13.27">     }</span>
<a href="#l13.28"></a><span id="l13.28">   }</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30">   // open a window and add the above closed tab list</span>
<a href="#l13.31"></a><span id="l13.31">   let newWin = openDialog(location, &quot;&quot;, &quot;chrome,all,dialog=no&quot;);</span>
<a href="#l13.32"></a><span id="l13.32">   newWin.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-    gPrefService.setIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;,</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-                            test_state.windows[0]._closedTabs.length);</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+    Services.prefs.setIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;,</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+                              test_state.windows[0]._closedTabs.length);</span>
<a href="#l13.37"></a><span id="l13.37">     ss.setWindowState(newWin, JSON.stringify(test_state), true);</span>
<a href="#l13.38"></a><span id="l13.38"> </span>
<a href="#l13.39"></a><span id="l13.39">     let closedTabs = JSON.parse(ss.getClosedTabData(newWin));</span>
<a href="#l13.40"></a><span id="l13.40">     is(closedTabs.length, test_state.windows[0]._closedTabs.length,</span>
<a href="#l13.41"></a><span id="l13.41">        &quot;Closed tab list has the expected length&quot;);</span>
<a href="#l13.42"></a><span id="l13.42">     is(countByTitle(closedTabs, FORGET),</span>
<a href="#l13.43"></a><span id="l13.43">        test_state.windows[0]._closedTabs.length - remember_count,</span>
<a href="#l13.44"></a><span id="l13.44">        &quot;The correct amout of tabs are to be forgotten&quot;);</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineat">@@ -111,12 +107,12 @@ function test() {</span>
<a href="#l13.46"></a><span id="l13.46">     is(countByTitle(closedTabs, FORGET), 0,</span>
<a href="#l13.47"></a><span id="l13.47">        &quot;All tabs specifically forgotten were indeed removed&quot;);</span>
<a href="#l13.48"></a><span id="l13.48">     is(countByTitle(closedTabs, REMEMBER), remember_count,</span>
<a href="#l13.49"></a><span id="l13.49">        &quot;... and tabs not specifically forgetten weren't.&quot;);</span>
<a href="#l13.50"></a><span id="l13.50">  </span>
<a href="#l13.51"></a><span id="l13.51">     // clean up</span>
<a href="#l13.52"></a><span id="l13.52">     newWin.close();</span>
<a href="#l13.53"></a><span id="l13.53">     is(browserWindowsCount(), 1, &quot;Only one browser window should be open eventually&quot;);</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-    gPrefService.clearUserPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+    Services.prefs.clearUserPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l13.56"></a><span id="l13.56">     finish();</span>
<a href="#l13.57"></a><span id="l13.57">   }, false);</span>
<a href="#l13.58"></a><span id="l13.58"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/suite/common/tests/browser/browser_463206.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_463206.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -32,21 +32,16 @@</span>
<a href="#l14.4"></a><span id="l14.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.5"></a><span id="l14.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.6"></a><span id="l14.6">  *</span>
<a href="#l14.7"></a><span id="l14.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9"> function test() {</span>
<a href="#l14.10"></a><span id="l14.10">   /** Test for Bug 463206 **/</span>
<a href="#l14.11"></a><span id="l14.11">   </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  try {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-    var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-                       .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-  }</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-  catch (ex) { }</span>
<a href="#l14.17"></a><span id="l14.17">   waitForExplicitFinish();</span>
<a href="#l14.18"></a><span id="l14.18">   </span>
<a href="#l14.19"></a><span id="l14.19">   let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l14.20"></a><span id="l14.20">     &quot;suite/common/tests/browser/browser_463206_sample.html&quot;;</span>
<a href="#l14.21"></a><span id="l14.21">   </span>
<a href="#l14.22"></a><span id="l14.22">   var frameCount = 0;</span>
<a href="#l14.23"></a><span id="l14.23">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l14.24"></a><span id="l14.24">   let window = tab.ownerDocument.defaultView;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/common/tests/browser/browser_465215.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_465215.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -32,17 +32,16 @@</span>
<a href="#l15.4"></a><span id="l15.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l15.5"></a><span id="l15.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l15.6"></a><span id="l15.6">  *</span>
<a href="#l15.7"></a><span id="l15.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9"> function test() {</span>
<a href="#l15.10"></a><span id="l15.10">   /** Test for Bug 465215 **/</span>
<a href="#l15.11"></a><span id="l15.11">   </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  let ss = Cc[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Ci.nsISessionStore);</span>
<a href="#l15.13"></a><span id="l15.13">   waitForExplicitFinish();</span>
<a href="#l15.14"></a><span id="l15.14">   </span>
<a href="#l15.15"></a><span id="l15.15">   let uniqueName = &quot;bug 465215&quot;;</span>
<a href="#l15.16"></a><span id="l15.16">   let uniqueValue1 = &quot;as good as unique: &quot; + Date.now();</span>
<a href="#l15.17"></a><span id="l15.17">   let uniqueValue2 = &quot;as good as unique: &quot; + Math.random();</span>
<a href="#l15.18"></a><span id="l15.18">   </span>
<a href="#l15.19"></a><span id="l15.19">   // set a unique value on a new, blank tab</span>
<a href="#l15.20"></a><span id="l15.20">   let tab1 = gBrowser.addTab();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/common/tests/browser/browser_465223.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_465223.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -45,18 +45,16 @@ function browserWindowsCount() {</span>
<a href="#l16.4"></a><span id="l16.4">   }</span>
<a href="#l16.5"></a><span id="l16.5">   return count;</span>
<a href="#l16.6"></a><span id="l16.6"> }</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> function test() {</span>
<a href="#l16.9"></a><span id="l16.9">   /** Test for Bug 465223 **/</span>
<a href="#l16.10"></a><span id="l16.10">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l16.11"></a><span id="l16.11">   </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  // test setup</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-  let ss = Cc[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Ci.nsISessionStore);</span>
<a href="#l16.14"></a><span id="l16.14">   waitForExplicitFinish();</span>
<a href="#l16.15"></a><span id="l16.15">   </span>
<a href="#l16.16"></a><span id="l16.16">   let uniqueKey1 = &quot;bug 465223.1&quot;;</span>
<a href="#l16.17"></a><span id="l16.17">   let uniqueKey2 = &quot;bug 465223.2&quot;;</span>
<a href="#l16.18"></a><span id="l16.18">   let uniqueValue1 = &quot;unik&quot; + Date.now();</span>
<a href="#l16.19"></a><span id="l16.19">   let uniqueValue2 = &quot;pi != &quot; + Math.random();</span>
<a href="#l16.20"></a><span id="l16.20">   </span>
<a href="#l16.21"></a><span id="l16.21">   // open a window and set a value on it</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/suite/common/tests/browser/browser_466937.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_466937.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -32,21 +32,16 @@</span>
<a href="#l17.4"></a><span id="l17.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l17.5"></a><span id="l17.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l17.6"></a><span id="l17.6">  *</span>
<a href="#l17.7"></a><span id="l17.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9"> function test() {</span>
<a href="#l17.10"></a><span id="l17.10">   /** Test for Bug 466937 **/</span>
<a href="#l17.11"></a><span id="l17.11">   </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  try {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-    var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-                       .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-  }</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-  catch (ex) { }</span>
<a href="#l17.17"></a><span id="l17.17">   waitForExplicitFinish();</span>
<a href="#l17.18"></a><span id="l17.18">   </span>
<a href="#l17.19"></a><span id="l17.19">   var file = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l17.20"></a><span id="l17.20">              .getService(Components.interfaces.nsIProperties)</span>
<a href="#l17.21"></a><span id="l17.21">              .get(&quot;TmpD&quot;, Components.interfaces.nsILocalFile);</span>
<a href="#l17.22"></a><span id="l17.22">   file.append(&quot;466937_test.file&quot;);</span>
<a href="#l17.23"></a><span id="l17.23">   let testPath = file.path;</span>
<a href="#l17.24"></a><span id="l17.24">   </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/suite/common/tests/browser/browser_476161.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_476161.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -34,18 +34,16 @@</span>
<a href="#l18.4"></a><span id="l18.4">  *</span>
<a href="#l18.5"></a><span id="l18.5">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7"> function test() {</span>
<a href="#l18.8"></a><span id="l18.8">   /** Test for Bug 476161 **/</span>
<a href="#l18.9"></a><span id="l18.9">   </span>
<a href="#l18.10"></a><span id="l18.10">   waitForExplicitFinish();</span>
<a href="#l18.11"></a><span id="l18.11">   </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l18.14"></a><span id="l18.14">   let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l18.15"></a><span id="l18.15">     &quot;suite/common/tests/browser/browser_476161_sample.html&quot;;</span>
<a href="#l18.16"></a><span id="l18.16">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l18.17"></a><span id="l18.17">   let window = tab.ownerDocument.defaultView;</span>
<a href="#l18.18"></a><span id="l18.18">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l18.19"></a><span id="l18.19">     tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l18.20"></a><span id="l18.20">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l18.21"></a><span id="l18.21">     </span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -57,15 +55,15 @@ function test() {</span>
<a href="#l18.23"></a><span id="l18.23">       tab2.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l18.24"></a><span id="l18.24">       let doc = tab2.linkedBrowser.contentDocument;</span>
<a href="#l18.25"></a><span id="l18.25">       let changed = doc.getElementById(&quot;changed&quot;).textContent.trim().split();</span>
<a href="#l18.26"></a><span id="l18.26">       </span>
<a href="#l18.27"></a><span id="l18.27">       is(changed.sort().join(&quot; &quot;), &quot;modify1 modify2&quot;,</span>
<a href="#l18.28"></a><span id="l18.28">          &quot;input events were only dispatched for modified text fields&quot;);</span>
<a href="#l18.29"></a><span id="l18.29">       </span>
<a href="#l18.30"></a><span id="l18.30">       // clean up</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-      gBrowser.removeTab(tab2);</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-      gBrowser.removeTab(tab);</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+      getBrowser().removeTab(tab2);</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+      getBrowser().removeTab(tab);</span>
<a href="#l18.35"></a><span id="l18.35"> </span>
<a href="#l18.36"></a><span id="l18.36">       finish();</span>
<a href="#l18.37"></a><span id="l18.37">     }, true);</span>
<a href="#l18.38"></a><span id="l18.38">   }, true);</span>
<a href="#l18.39"></a><span id="l18.39"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/common/tests/browser/browser_477657.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_477657.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -47,19 +47,16 @@ function browserWindowsCount() {</span>
<a href="#l19.4"></a><span id="l19.4"> function test() {</span>
<a href="#l19.5"></a><span id="l19.5">   /** Test for Bug 477657 **/</span>
<a href="#l19.6"></a><span id="l19.6">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l19.7"></a><span id="l19.7">   </span>
<a href="#l19.8"></a><span id="l19.8">   // Test fails randomly on OS X (bug 482975)</span>
<a href="#l19.9"></a><span id="l19.9">   if (&quot;nsILocalFileMac&quot; in Components.interfaces)</span>
<a href="#l19.10"></a><span id="l19.10">     return;</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  // test setup</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l19.15"></a><span id="l19.15">   waitForExplicitFinish();</span>
<a href="#l19.16"></a><span id="l19.16">   </span>
<a href="#l19.17"></a><span id="l19.17">   let newWin = openDialog(location, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;);</span>
<a href="#l19.18"></a><span id="l19.18">   newWin.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l19.19"></a><span id="l19.19">     let newState = { windows: [{</span>
<a href="#l19.20"></a><span id="l19.20">       tabs: [{ entries: [] }],</span>
<a href="#l19.21"></a><span id="l19.21">       _closedTabs: [{</span>
<a href="#l19.22"></a><span id="l19.22">         state: { entries: [{ url: &quot;about:&quot; }]},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/suite/common/tests/browser/browser_480893.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_480893.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -34,22 +34,19 @@</span>
<a href="#l20.4"></a><span id="l20.4">  *</span>
<a href="#l20.5"></a><span id="l20.5">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> function test() {</span>
<a href="#l20.8"></a><span id="l20.8">   /** Test for Bug 480893 **/</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10">   waitForExplicitFinish();</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-</span>
<a href="#l20.15"></a><span id="l20.15">   // Test that starting a new session loads a blank page if Firefox is</span>
<a href="#l20.16"></a><span id="l20.16">   // configured to display a blank page at startup (browser.startup.page = 0)</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-  gPrefService.setIntPref(&quot;browser.startup.page&quot;, 0);</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+  Services.prefs.setIntPref(&quot;browser.startup.page&quot;, 0);</span>
<a href="#l20.19"></a><span id="l20.19">   let tab = getBrowser().addTab(&quot;about:sessionrestore&quot;);</span>
<a href="#l20.20"></a><span id="l20.20">   getBrowser().selectedTab = tab;</span>
<a href="#l20.21"></a><span id="l20.21">   let browser = tab.linkedBrowser;</span>
<a href="#l20.22"></a><span id="l20.22">   browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l20.23"></a><span id="l20.23">     browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l20.24"></a><span id="l20.24">     let doc = browser.contentDocument;</span>
<a href="#l20.25"></a><span id="l20.25"> </span>
<a href="#l20.26"></a><span id="l20.26">     // click on the &quot;Start New Session&quot; button after about:sessionrestore is loaded</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineat">@@ -58,18 +55,18 @@ function test() {</span>
<a href="#l20.28"></a><span id="l20.28">       browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l20.29"></a><span id="l20.29">       let doc = browser.contentDocument;</span>
<a href="#l20.30"></a><span id="l20.30"> </span>
<a href="#l20.31"></a><span id="l20.31">       is(doc.URL, &quot;about:blank&quot;, &quot;loaded page is about:blank&quot;);</span>
<a href="#l20.32"></a><span id="l20.32"> </span>
<a href="#l20.33"></a><span id="l20.33">       // Test that starting a new session loads the homepage (set to http://mochi.test:8888)</span>
<a href="#l20.34"></a><span id="l20.34">       // if Firefox is configured to display a homepage at startup (browser.startup.page = 1)</span>
<a href="#l20.35"></a><span id="l20.35">       let homepage = &quot;http://mochi.test:8888/&quot;;</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-      gPrefService.setCharPref(&quot;browser.startup.homepage&quot;, homepage);</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-      gPrefService.setIntPref(&quot;browser.startup.page&quot;, 1);</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+      Services.prefs.setCharPref(&quot;browser.startup.homepage&quot;, homepage);</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineplus">+      Services.prefs.setIntPref(&quot;browser.startup.page&quot;, 1);</span>
<a href="#l20.40"></a><span id="l20.40">       getBrowser().loadURI(&quot;about:sessionrestore&quot;);</span>
<a href="#l20.41"></a><span id="l20.41">       browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l20.42"></a><span id="l20.42">         browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l20.43"></a><span id="l20.43">         let doc = browser.contentDocument;</span>
<a href="#l20.44"></a><span id="l20.44"> </span>
<a href="#l20.45"></a><span id="l20.45">         // click on the &quot;Start New Session&quot; button after about:sessionrestore is loaded</span>
<a href="#l20.46"></a><span id="l20.46">         doc.getElementById(&quot;errorCancel&quot;).click();</span>
<a href="#l20.47"></a><span id="l20.47">         browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineat">@@ -77,17 +74,17 @@ function test() {</span>
<a href="#l20.49"></a><span id="l20.49">           let doc = browser.contentDocument;</span>
<a href="#l20.50"></a><span id="l20.50"> </span>
<a href="#l20.51"></a><span id="l20.51">           is(doc.URL, homepage, &quot;loaded page is the homepage&quot;);</span>
<a href="#l20.52"></a><span id="l20.52"> </span>
<a href="#l20.53"></a><span id="l20.53">           // close tab, restore default values and finish the test</span>
<a href="#l20.54"></a><span id="l20.54">           getBrowser().removeTab(tab);</span>
<a href="#l20.55"></a><span id="l20.55">           // we need this if-statement because if there is no user set value, </span>
<a href="#l20.56"></a><span id="l20.56">           // clearUserPref throws a uncatched exception and finish is not called</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineminus">-          if (gPrefService.prefHasUserValue(&quot;browser.startup.page&quot;))</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineminus">-            gPrefService.clearUserPref(&quot;browser.startup.page&quot;);</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineminus">-          gPrefService.clearUserPref(&quot;browser.startup.homepage&quot;);</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineplus">+          if (Services.prefs.prefHasUserValue(&quot;browser.startup.page&quot;))</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+            Services.prefs.clearUserPref(&quot;browser.startup.page&quot;);</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineplus">+          Services.prefs.clearUserPref(&quot;browser.startup.homepage&quot;);</span>
<a href="#l20.63"></a><span id="l20.63">           finish();</span>
<a href="#l20.64"></a><span id="l20.64">         }, true);</span>
<a href="#l20.65"></a><span id="l20.65">       }, true);</span>
<a href="#l20.66"></a><span id="l20.66">     }, true);</span>
<a href="#l20.67"></a><span id="l20.67">   }, true);</span>
<a href="#l20.68"></a><span id="l20.68"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/suite/common/tests/browser/browser_483330.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_483330.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,14 +1,11 @@</span>
<a href="#l21.4"></a><span id="l21.4"> function test() {</span>
<a href="#l21.5"></a><span id="l21.5">   /** Test for Bug 483330 **/</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7" class="difflineminus">-  // test setup</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l21.10"></a><span id="l21.10">   waitForExplicitFinish();</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12">   let tab = getBrowser().addTab();</span>
<a href="#l21.13"></a><span id="l21.13">   getBrowser().selectedTab = tab;</span>
<a href="#l21.14"></a><span id="l21.14"> </span>
<a href="#l21.15"></a><span id="l21.15">   let browser = tab.linkedBrowser;</span>
<a href="#l21.16"></a><span id="l21.16">   browser.addEventListener(&quot;load&quot;, function loadListener(e) {</span>
<a href="#l21.17"></a><span id="l21.17">     browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/suite/common/tests/browser/browser_485482.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_485482.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -32,19 +32,16 @@</span>
<a href="#l22.4"></a><span id="l22.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l22.5"></a><span id="l22.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l22.6"></a><span id="l22.6">  *</span>
<a href="#l22.7"></a><span id="l22.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9"> function test() {</span>
<a href="#l22.10"></a><span id="l22.10">   /** Test for Bug 485482, ported by Bug 487922 **/</span>
<a href="#l22.11"></a><span id="l22.11">   </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-</span>
<a href="#l22.15"></a><span id="l22.15">   waitForExplicitFinish();</span>
<a href="#l22.16"></a><span id="l22.16">   </span>
<a href="#l22.17"></a><span id="l22.17">   let uniqueValue = Math.random();</span>
<a href="#l22.18"></a><span id="l22.18"> </span>
<a href="#l22.19"></a><span id="l22.19">   let rootDir = getRootDirectory(gTestPath);</span>
<a href="#l22.20"></a><span id="l22.20">   let testURL = rootDir + &quot;browser_485482_sample.html&quot;;</span>
<a href="#l22.21"></a><span id="l22.21">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l22.22"></a><span id="l22.22">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/suite/common/tests/browser/browser_490040.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_490040.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -46,33 +46,23 @@ function browserWindowsCount() {</span>
<a href="#l23.4"></a><span id="l23.4">   }</span>
<a href="#l23.5"></a><span id="l23.5">   return count;</span>
<a href="#l23.6"></a><span id="l23.6"> }</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8"> function test() {</span>
<a href="#l23.9"></a><span id="l23.9">   /** Test for Bug 490040, ported by Bug 511640 **/</span>
<a href="#l23.10"></a><span id="l23.10">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-  let os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-                     .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineminus">-  let ww = Components.classes[&quot;@mozilla.org/embedcomp/window-watcher;1&quot;]</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineminus">-                     .getService(Components.interfaces.nsIWindowWatcher);</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineminus">-</span>
<a href="#l23.19"></a><span id="l23.19">   waitForExplicitFinish();</span>
<a href="#l23.20"></a><span id="l23.20"> </span>
<a href="#l23.21"></a><span id="l23.21" class="difflineminus">-  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineminus">-                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineminus">-</span>
<a href="#l23.24"></a><span id="l23.24">   function testWithState(aState) {</span>
<a href="#l23.25"></a><span id="l23.25">     // Ensure we can store the window if needed.</span>
<a href="#l23.26"></a><span id="l23.26">     let curClosedWindowCount = ss.getClosedWindowCount();</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineminus">-    gPrefService.setIntPref(&quot;browser.sessionstore.max_windows_undo&quot;,</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineminus">-                            curClosedWindowCount + 1);</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineplus">+    Services.prefs.setIntPref(&quot;browser.sessionstore.max_windows_undo&quot;,</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineplus">+                              curClosedWindowCount + 1);</span>
<a href="#l23.31"></a><span id="l23.31"> </span>
<a href="#l23.32"></a><span id="l23.32">     var origWin;</span>
<a href="#l23.33"></a><span id="l23.33">     function windowObserver(aSubject, aTopic, aData) {</span>
<a href="#l23.34"></a><span id="l23.34">       let theWin = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l23.35"></a><span id="l23.35">       if (origWin &amp;&amp; theWin != origWin)</span>
<a href="#l23.36"></a><span id="l23.36">         return;</span>
<a href="#l23.37"></a><span id="l23.37"> </span>
<a href="#l23.38"></a><span id="l23.38">       switch (aTopic) {</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineat">@@ -96,34 +86,34 @@ function test() {</span>
<a href="#l23.40"></a><span id="l23.40">               }</span>
<a href="#l23.41"></a><span id="l23.41">               ss.setWindowState(theWin, JSON.stringify(aState.windowState),</span>
<a href="#l23.42"></a><span id="l23.42">                                 true);</span>
<a href="#l23.43"></a><span id="l23.43">             });</span>
<a href="#l23.44"></a><span id="l23.44">           }, false);</span>
<a href="#l23.45"></a><span id="l23.45">           break;</span>
<a href="#l23.46"></a><span id="l23.46"> </span>
<a href="#l23.47"></a><span id="l23.47">         case &quot;domwindowclosed&quot;:</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineminus">-          ww.unregisterNotification(windowObserver);</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineplus">+          Services.ww.unregisterNotification(windowObserver);</span>
<a href="#l23.50"></a><span id="l23.50">           // Use executeSoon to ensure this happens after SS observer.</span>
<a href="#l23.51"></a><span id="l23.51">           executeSoon(function () {</span>
<a href="#l23.52"></a><span id="l23.52">             is(ss.getClosedWindowCount(),</span>
<a href="#l23.53"></a><span id="l23.53">                curClosedWindowCount + (aState.shouldBeAdded ? 1 : 0),</span>
<a href="#l23.54"></a><span id="l23.54">                &quot;That window should &quot; + (aState.shouldBeAdded ? &quot;&quot; : &quot;not &quot;) +</span>
<a href="#l23.55"></a><span id="l23.55">                &quot;be restorable&quot;);</span>
<a href="#l23.56"></a><span id="l23.56">             executeSoon(runNextTest);</span>
<a href="#l23.57"></a><span id="l23.57">           });</span>
<a href="#l23.58"></a><span id="l23.58">           break;</span>
<a href="#l23.59"></a><span id="l23.59">       }</span>
<a href="#l23.60"></a><span id="l23.60">     }</span>
<a href="#l23.61"></a><span id="l23.61" class="difflineminus">-    ww.registerNotification(windowObserver);</span>
<a href="#l23.62"></a><span id="l23.62" class="difflineminus">-    ww.openWindow(null,</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineminus">-                  location,</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineminus">-                  &quot;_blank&quot;,</span>
<a href="#l23.65"></a><span id="l23.65" class="difflineminus">-                  &quot;chrome,all,dialog=no&quot;,</span>
<a href="#l23.66"></a><span id="l23.66" class="difflineminus">-                  null);</span>
<a href="#l23.67"></a><span id="l23.67" class="difflineplus">+    Services.ww.registerNotification(windowObserver);</span>
<a href="#l23.68"></a><span id="l23.68" class="difflineplus">+    Services.ww.openWindow(null,</span>
<a href="#l23.69"></a><span id="l23.69" class="difflineplus">+                           location,</span>
<a href="#l23.70"></a><span id="l23.70" class="difflineplus">+                           &quot;_blank&quot;,</span>
<a href="#l23.71"></a><span id="l23.71" class="difflineplus">+                           &quot;chrome,all,dialog=no&quot;,</span>
<a href="#l23.72"></a><span id="l23.72" class="difflineplus">+                           null);</span>
<a href="#l23.73"></a><span id="l23.73">   }</span>
<a href="#l23.74"></a><span id="l23.74"> </span>
<a href="#l23.75"></a><span id="l23.75">   // Only windows with open tabs are restorable. Windows where a lone tab is</span>
<a href="#l23.76"></a><span id="l23.76">   // detached may have _closedTabs, but is left with just an empty tab.</span>
<a href="#l23.77"></a><span id="l23.77">   let states = [</span>
<a href="#l23.78"></a><span id="l23.78">     {</span>
<a href="#l23.79"></a><span id="l23.79">       shouldBeAdded: true,</span>
<a href="#l23.80"></a><span id="l23.80">       windowState: {</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineat">@@ -165,17 +155,17 @@ function test() {</span>
<a href="#l23.82"></a><span id="l23.82">   ];</span>
<a href="#l23.83"></a><span id="l23.83"> </span>
<a href="#l23.84"></a><span id="l23.84">   function runNextTest() {</span>
<a href="#l23.85"></a><span id="l23.85">     if (states.length) {</span>
<a href="#l23.86"></a><span id="l23.86">       let state = states.shift();</span>
<a href="#l23.87"></a><span id="l23.87">       testWithState(state);</span>
<a href="#l23.88"></a><span id="l23.88">     }</span>
<a href="#l23.89"></a><span id="l23.89">     else {</span>
<a href="#l23.90"></a><span id="l23.90" class="difflineminus">-      if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.max_windows_undo&quot;))</span>
<a href="#l23.91"></a><span id="l23.91" class="difflineminus">-        gPrefService.clearUserPref(&quot;browser.sessionstore.max_windows_undo&quot;);</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineplus">+      if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.max_windows_undo&quot;))</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineplus">+        Services.prefs.clearUserPref(&quot;browser.sessionstore.max_windows_undo&quot;);</span>
<a href="#l23.94"></a><span id="l23.94">       is(browserWindowsCount(), 1, &quot;Only one browser window should be open eventually&quot;);</span>
<a href="#l23.95"></a><span id="l23.95">       finish();</span>
<a href="#l23.96"></a><span id="l23.96">     }</span>
<a href="#l23.97"></a><span id="l23.97">   }</span>
<a href="#l23.98"></a><span id="l23.98">   runNextTest();</span>
<a href="#l23.99"></a><span id="l23.99"> }</span>
<a href="#l23.100"></a><span id="l23.100"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/suite/common/tests/browser/browser_491168.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_491168.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -31,40 +31,31 @@</span>
<a href="#l24.4"></a><span id="l24.4">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l24.5"></a><span id="l24.5">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l24.6"></a><span id="l24.6">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l24.7"></a><span id="l24.7">  *</span>
<a href="#l24.8"></a><span id="l24.8">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10"> function browserWindowsCount() {</span>
<a href="#l24.11"></a><span id="l24.11">   let count = 0;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  let e = Cc[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-            .getService(Ci.nsIWindowMediator)</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-            .getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+  let e = Services.wm.getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l24.16"></a><span id="l24.16">   while (e.hasMoreElements()) {</span>
<a href="#l24.17"></a><span id="l24.17">     if (!e.getNext().closed)</span>
<a href="#l24.18"></a><span id="l24.18">       ++count;</span>
<a href="#l24.19"></a><span id="l24.19">   }</span>
<a href="#l24.20"></a><span id="l24.20">   return count;</span>
<a href="#l24.21"></a><span id="l24.21"> }</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23"> function test() {</span>
<a href="#l24.24"></a><span id="l24.24">   // make sure we use sessionstore for undoClosetab</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineminus">-  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">-                        .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">-  gPrefService.setIntPref(&quot;browser.tabs.max_tabs_undo&quot;, 0);</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineplus">+  Services.prefs.setIntPref(&quot;browser.tabs.max_tabs_undo&quot;, 0);</span>
<a href="#l24.30"></a><span id="l24.30"> </span>
<a href="#l24.31"></a><span id="l24.31">   /** Test for Bug 491168, ported by Bug 524369 **/</span>
<a href="#l24.32"></a><span id="l24.32">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l24.33"></a><span id="l24.33"> </span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-  // test setup</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-  let ioService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;].getService(Components.interfaces.nsIIOService);</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-</span>
<a href="#l24.38"></a><span id="l24.38">   waitForExplicitFinish();</span>
<a href="#l24.39"></a><span id="l24.39"> </span>
<a href="#l24.40"></a><span id="l24.40">   const REFERRER1 = &quot;http://example.org/?&quot; + Date.now();</span>
<a href="#l24.41"></a><span id="l24.41">   const REFERRER2 = &quot;http://example.org/?&quot; + Math.random();</span>
<a href="#l24.42"></a><span id="l24.42"> </span>
<a href="#l24.43"></a><span id="l24.43">   let tab = getBrowser().addTab();</span>
<a href="#l24.44"></a><span id="l24.44">   getBrowser().selectedTab = tab;</span>
<a href="#l24.45"></a><span id="l24.45"> </span>
<a href="#l24.46"></a><span id="l24.46" class="difflineat">@@ -88,18 +79,18 @@ function test() {</span>
<a href="#l24.47"></a><span id="l24.47">       newTab.addEventListener(&quot;SSTabRestored&quot;, function() {</span>
<a href="#l24.48"></a><span id="l24.48">         newTab.removeEventListener(&quot;SSTabRestored&quot;, arguments.callee, true);</span>
<a href="#l24.49"></a><span id="l24.49"> </span>
<a href="#l24.50"></a><span id="l24.50">         is(window.content.document.referrer, REFERRER2, &quot;document.referrer is still correct after closing and reopening the tab.&quot;);</span>
<a href="#l24.51"></a><span id="l24.51">         getBrowser().removeTab(newTab);</span>
<a href="#l24.52"></a><span id="l24.52"> </span>
<a href="#l24.53"></a><span id="l24.53">         is(browserWindowsCount(), 1, &quot;Only one browser window should be open eventually&quot;);</span>
<a href="#l24.54"></a><span id="l24.54">         // clean up</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineminus">-        if (gPrefService.prefHasUserValue(&quot;browser.tabs.max_tabs_undo&quot;))</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineminus">-          gPrefService.clearUserPref(&quot;browser.tabs.max_tabs_undo&quot;);</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+        if (Services.prefs.prefHasUserValue(&quot;browser.tabs.max_tabs_undo&quot;))</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+          Services.prefs.clearUserPref(&quot;browser.tabs.max_tabs_undo&quot;);</span>
<a href="#l24.59"></a><span id="l24.59">         finish();</span>
<a href="#l24.60"></a><span id="l24.60">       }, true);</span>
<a href="#l24.61"></a><span id="l24.61">     }, true);</span>
<a href="#l24.62"></a><span id="l24.62">   },true);</span>
<a href="#l24.63"></a><span id="l24.63"> </span>
<a href="#l24.64"></a><span id="l24.64" class="difflineminus">-  let referrerURI = ioService.newURI(REFERRER1, null, null);</span>
<a href="#l24.65"></a><span id="l24.65" class="difflineplus">+  let referrerURI = Services.io.newURI(REFERRER1, null, null);</span>
<a href="#l24.66"></a><span id="l24.66">   browser.loadURI(&quot;http://example.org&quot;, referrerURI, null);</span>
<a href="#l24.67"></a><span id="l24.67"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/suite/common/tests/browser/browser_493467.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_493467.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -31,34 +31,29 @@</span>
<a href="#l25.4"></a><span id="l25.4">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l25.5"></a><span id="l25.5">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l25.6"></a><span id="l25.6">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l25.7"></a><span id="l25.7">  *</span>
<a href="#l25.8"></a><span id="l25.8">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l25.9"></a><span id="l25.9"> </span>
<a href="#l25.10"></a><span id="l25.10"> function browserWindowsCount() {</span>
<a href="#l25.11"></a><span id="l25.11">   let count = 0;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  let e = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-                    .getService(Components.interfaces.nsIWindowMediator)</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-                    .getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+  let e = Services.wm.getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l25.16"></a><span id="l25.16">   while (e.hasMoreElements()) {</span>
<a href="#l25.17"></a><span id="l25.17">     if (!e.getNext().closed)</span>
<a href="#l25.18"></a><span id="l25.18">       ++count;</span>
<a href="#l25.19"></a><span id="l25.19">   }</span>
<a href="#l25.20"></a><span id="l25.20">   return count;</span>
<a href="#l25.21"></a><span id="l25.21"> }</span>
<a href="#l25.22"></a><span id="l25.22"> </span>
<a href="#l25.23"></a><span id="l25.23"> function test() {</span>
<a href="#l25.24"></a><span id="l25.24">   /** Test for Bug 493467, ported by Bug 524365 **/</span>
<a href="#l25.25"></a><span id="l25.25"> </span>
<a href="#l25.26"></a><span id="l25.26">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l25.27"></a><span id="l25.27"> </span>
<a href="#l25.28"></a><span id="l25.28" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineminus">-</span>
<a href="#l25.31"></a><span id="l25.31">   let tab = getBrowser().addTab();</span>
<a href="#l25.32"></a><span id="l25.32">   tab.linkedBrowser.stop();</span>
<a href="#l25.33"></a><span id="l25.33">   let tabState = JSON.parse(ss.getTabState(tab));</span>
<a href="#l25.34"></a><span id="l25.34">   is(tabState.disallow || &quot;&quot;, &quot;&quot;, &quot;Everything is allowed per default&quot;);</span>
<a href="#l25.35"></a><span id="l25.35"> </span>
<a href="#l25.36"></a><span id="l25.36">   // collect all permissions that can be set on a docShell (i.e. all</span>
<a href="#l25.37"></a><span id="l25.37">   // attributes starting with &quot;allow&quot; such as &quot;allowJavascript&quot;) and</span>
<a href="#l25.38"></a><span id="l25.38">   // disallow them all, as SessionStore only remembers disallowed ones</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/suite/common/tests/browser/browser_500328.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_500328.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -89,18 +89,16 @@ function checkState(tab) {</span>
<a href="#l26.4"></a><span id="l26.4"> </span>
<a href="#l26.5"></a><span id="l26.5">   tab.linkedBrowser.contentWindow.history.back();</span>
<a href="#l26.6"></a><span id="l26.6"> }</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8"> function test() {</span>
<a href="#l26.9"></a><span id="l26.9">   // Tests session restore functionality of history.pushState and</span>
<a href="#l26.10"></a><span id="l26.10">   // history.replaceState().  (Bug 500328)</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l26.14"></a><span id="l26.14">   waitForExplicitFinish();</span>
<a href="#l26.15"></a><span id="l26.15"> </span>
<a href="#l26.16"></a><span id="l26.16">   // We open a new blank window, let it load, and then load in</span>
<a href="#l26.17"></a><span id="l26.17">   // http://example.com.  We need to load the blank window first, otherwise the</span>
<a href="#l26.18"></a><span id="l26.18">   // docshell gets confused and doesn't have a current history entry.</span>
<a href="#l26.19"></a><span id="l26.19">   let tab = getBrowser().addTab(&quot;about:blank&quot;);</span>
<a href="#l26.20"></a><span id="l26.20">   let tabBrowser = tab.linkedBrowser;</span>
<a href="#l26.21"></a><span id="l26.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/suite/common/tests/browser/browser_514751.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_514751.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -33,21 +33,16 @@</span>
<a href="#l27.4"></a><span id="l27.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l27.5"></a><span id="l27.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l27.6"></a><span id="l27.6">  *</span>
<a href="#l27.7"></a><span id="l27.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l27.8"></a><span id="l27.8"> </span>
<a href="#l27.9"></a><span id="l27.9"> function test() {</span>
<a href="#l27.10"></a><span id="l27.10">   /** Test for Bug 509315 (Wallpaper) **/</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">-  let ww = Components.classes[&quot;@mozilla.org/embedcomp/window-watcher;1&quot;]</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineminus">-                     .getService(Components.interfaces.nsIWindowWatcher);</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineminus">-</span>
<a href="#l27.17"></a><span id="l27.17">   waitForExplicitFinish();</span>
<a href="#l27.18"></a><span id="l27.18"> </span>
<a href="#l27.19"></a><span id="l27.19">   let state = {</span>
<a href="#l27.20"></a><span id="l27.20">     windows: [{</span>
<a href="#l27.21"></a><span id="l27.21">       tabs: [{</span>
<a href="#l27.22"></a><span id="l27.22">         entries: [</span>
<a href="#l27.23"></a><span id="l27.23">           { url: &quot;http://www.mozilla.org/projects/minefield/&quot;, title: &quot;Minefield Start Page&quot; },</span>
<a href="#l27.24"></a><span id="l27.24">           {}</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineat">@@ -76,22 +71,22 @@ function test() {</span>
<a href="#l27.26"></a><span id="l27.26">               executeSoon(function() {</span>
<a href="#l27.27"></a><span id="l27.27">                 theWin.close();</span>
<a href="#l27.28"></a><span id="l27.28">               });</span>
<a href="#l27.29"></a><span id="l27.29">             });</span>
<a href="#l27.30"></a><span id="l27.30">           }, false);</span>
<a href="#l27.31"></a><span id="l27.31">           break;</span>
<a href="#l27.32"></a><span id="l27.32"> </span>
<a href="#l27.33"></a><span id="l27.33">         case &quot;domwindowclosed&quot;:</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineminus">-          ww.unregisterNotification(this);</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineplus">+          Services.ww.unregisterNotification(this);</span>
<a href="#l27.36"></a><span id="l27.36">           finish();</span>
<a href="#l27.37"></a><span id="l27.37">           break;</span>
<a href="#l27.38"></a><span id="l27.38">       }</span>
<a href="#l27.39"></a><span id="l27.39">     }</span>
<a href="#l27.40"></a><span id="l27.40">   }</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineminus">-  ww.registerNotification(windowObserver);</span>
<a href="#l27.42"></a><span id="l27.42" class="difflineminus">-  ww.openWindow(null,</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineminus">-                location,</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineminus">-                &quot;_blank&quot;,</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineminus">-                &quot;chrome,all,dialog=no&quot;,</span>
<a href="#l27.46"></a><span id="l27.46" class="difflineminus">-                null);</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineplus">+  Services.ww.registerNotification(windowObserver);</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineplus">+  Services.ww.openWindow(null,</span>
<a href="#l27.49"></a><span id="l27.49" class="difflineplus">+                         location,</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineplus">+                         &quot;_blank&quot;,</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineplus">+                         &quot;chrome,all,dialog=no&quot;,</span>
<a href="#l27.52"></a><span id="l27.52" class="difflineplus">+                         null);</span>
<a href="#l27.53"></a><span id="l27.53"> </span>
<a href="#l27.54"></a><span id="l27.54"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/suite/common/tests/browser/browser_522545.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_522545.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -47,19 +47,16 @@ function browserWindowsCount() {</span>
<a href="#l28.4"></a><span id="l28.4"> </span>
<a href="#l28.5"></a><span id="l28.5"> function test() {</span>
<a href="#l28.6"></a><span id="l28.6">   /** Test for Bug 522545 **/</span>
<a href="#l28.7"></a><span id="l28.7">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9">   waitForExplicitFinish();</span>
<a href="#l28.10"></a><span id="l28.10">   requestLongerTimeout(2);</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-</span>
<a href="#l28.15"></a><span id="l28.15">   // This tests the following use case:</span>
<a href="#l28.16"></a><span id="l28.16">   // User opens a new tab which gets focus. The user types something into the</span>
<a href="#l28.17"></a><span id="l28.17">   // address bar, then crashes or quits.</span>
<a href="#l28.18"></a><span id="l28.18">   function test_newTabFocused() {</span>
<a href="#l28.19"></a><span id="l28.19">     let state = {</span>
<a href="#l28.20"></a><span id="l28.20">       windows: [{</span>
<a href="#l28.21"></a><span id="l28.21">         tabs: [</span>
<a href="#l28.22"></a><span id="l28.22">           { entries: [{ url: &quot;about:mozilla&quot; }] },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/suite/common/tests/browser/browser_524745.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_524745.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -44,18 +44,16 @@ function browserWindowsCount() {</span>
<a href="#l29.4"></a><span id="l29.4">   }</span>
<a href="#l29.5"></a><span id="l29.5">   return count;</span>
<a href="#l29.6"></a><span id="l29.6"> }</span>
<a href="#l29.7"></a><span id="l29.7"> </span>
<a href="#l29.8"></a><span id="l29.8"> function test() {</span>
<a href="#l29.9"></a><span id="l29.9">   /** Test for Bug 524745, ported by bug 558638 **/</span>
<a href="#l29.10"></a><span id="l29.10">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l29.14"></a><span id="l29.14">   let uniqKey = &quot;bug524745&quot;;</span>
<a href="#l29.15"></a><span id="l29.15">   let uniqVal = Date.now();</span>
<a href="#l29.16"></a><span id="l29.16"> </span>
<a href="#l29.17"></a><span id="l29.17">   waitForExplicitFinish();</span>
<a href="#l29.18"></a><span id="l29.18"> </span>
<a href="#l29.19"></a><span id="l29.19">   let window_B = openDialog(location, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;);</span>
<a href="#l29.20"></a><span id="l29.20">   window_B.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l29.21"></a><span id="l29.21">     window_B.removeEventListener(&quot;load&quot;, arguments.callee, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/suite/common/tests/browser/browser_526613.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_526613.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -33,28 +33,23 @@</span>
<a href="#l30.4"></a><span id="l30.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l30.5"></a><span id="l30.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l30.6"></a><span id="l30.6">  *</span>
<a href="#l30.7"></a><span id="l30.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l30.8"></a><span id="l30.8"> </span>
<a href="#l30.9"></a><span id="l30.9"> function test() {</span>
<a href="#l30.10"></a><span id="l30.10">   /** Test for Bug 526613, porting done in Bug 548211 **/</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  // test setup</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l30.15"></a><span id="l30.15">   let os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l30.16"></a><span id="l30.16">                      .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineminus">-  let wm = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineminus">-                     .getService(Components.interfaces.nsIWindowMediator);</span>
<a href="#l30.19"></a><span id="l30.19">   waitForExplicitFinish();</span>
<a href="#l30.20"></a><span id="l30.20"> </span>
<a href="#l30.21"></a><span id="l30.21">   function browserWindowsCount(expected) {</span>
<a href="#l30.22"></a><span id="l30.22">     let count = 0;</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineminus">-    let e = wm.getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineplus">+    let e = Services.wm.getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l30.25"></a><span id="l30.25">     while (e.hasMoreElements()) {</span>
<a href="#l30.26"></a><span id="l30.26">       if (!e.getNext().closed)</span>
<a href="#l30.27"></a><span id="l30.27">         ++count;</span>
<a href="#l30.28"></a><span id="l30.28">     }</span>
<a href="#l30.29"></a><span id="l30.29">     is(count, expected,</span>
<a href="#l30.30"></a><span id="l30.30">        &quot;number of open browser windows according to nsIWindowMediator&quot;);</span>
<a href="#l30.31"></a><span id="l30.31">     let state = ss.getBrowserState();</span>
<a href="#l30.32"></a><span id="l30.32">     info(state);</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineat">@@ -82,30 +77,30 @@ function test() {</span>
<a href="#l30.34"></a><span id="l30.34">       is(aTopic, &quot;sessionstore-browser-state-restored&quot;,</span>
<a href="#l30.35"></a><span id="l30.35">          &quot;The sessionstore-browser-state-restored notification was observed&quot;);</span>
<a href="#l30.36"></a><span id="l30.36"> </span>
<a href="#l30.37"></a><span id="l30.37">     if (pass++ == 1) {</span>
<a href="#l30.38"></a><span id="l30.38">       browserWindowsCount(2);</span>
<a href="#l30.39"></a><span id="l30.39"> </span>
<a href="#l30.40"></a><span id="l30.40">       // let the first window be focused (see above)</span>
<a href="#l30.41"></a><span id="l30.41">       function pollMostRecentWindow() {</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineminus">-        if (wm.getMostRecentWindow(&quot;navigator:browser&quot;) == window) {</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineplus">+        if (Services.wm.getMostRecentWindow(&quot;navigator:browser&quot;) == window) {</span>
<a href="#l30.44"></a><span id="l30.44">           ss.setBrowserState(oldState);</span>
<a href="#l30.45"></a><span id="l30.45">         } else {</span>
<a href="#l30.46"></a><span id="l30.46">           info(&quot;waiting for the current window to become active&quot;);</span>
<a href="#l30.47"></a><span id="l30.47">           setTimeout(pollMostRecentWindow, 0);</span>
<a href="#l30.48"></a><span id="l30.48">           window.focus(); //XXX Why is this needed?</span>
<a href="#l30.49"></a><span id="l30.49">         }</span>
<a href="#l30.50"></a><span id="l30.50">       }</span>
<a href="#l30.51"></a><span id="l30.51">       pollMostRecentWindow();</span>
<a href="#l30.52"></a><span id="l30.52">     }</span>
<a href="#l30.53"></a><span id="l30.53">     else {</span>
<a href="#l30.54"></a><span id="l30.54">       browserWindowsCount(1);</span>
<a href="#l30.55"></a><span id="l30.55">       ok(!window.closed, &quot;Restoring the old state should have left this window open&quot;);</span>
<a href="#l30.56"></a><span id="l30.56" class="difflineminus">-      os.removeObserver(observer, &quot;sessionstore-browser-state-restored&quot;);</span>
<a href="#l30.57"></a><span id="l30.57" class="difflineplus">+      Services.obs.removeObserver(observer, &quot;sessionstore-browser-state-restored&quot;);</span>
<a href="#l30.58"></a><span id="l30.58">         finish();</span>
<a href="#l30.59"></a><span id="l30.59">       }</span>
<a href="#l30.60"></a><span id="l30.60">     }</span>
<a href="#l30.61"></a><span id="l30.61" class="difflineminus">-  os.addObserver(observer, &quot;sessionstore-browser-state-restored&quot;, false);</span>
<a href="#l30.62"></a><span id="l30.62" class="difflineplus">+  Services.obs.addObserver(observer, &quot;sessionstore-browser-state-restored&quot;, false);</span>
<a href="#l30.63"></a><span id="l30.63"> </span>
<a href="#l30.64"></a><span id="l30.64">   // set browser to test state</span>
<a href="#l30.65"></a><span id="l30.65">   ss.setBrowserState(JSON.stringify(testState));</span>
<a href="#l30.66"></a><span id="l30.66"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/suite/common/tests/browser/browser_528776.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_528776.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -1,16 +1,11 @@</span>
<a href="#l31.4"></a><span id="l31.4" class="difflineminus">-var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l31.5"></a><span id="l31.5" class="difflineminus">-                   .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l31.6"></a><span id="l31.6" class="difflineminus">-var wm = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l31.7"></a><span id="l31.7" class="difflineminus">-                   .getService(Components.interfaces.nsIWindowMediator);</span>
<a href="#l31.8"></a><span id="l31.8" class="difflineminus">-</span>
<a href="#l31.9"></a><span id="l31.9"> function browserWindowsCount(expected) {</span>
<a href="#l31.10"></a><span id="l31.10">   var count = 0;</span>
<a href="#l31.11"></a><span id="l31.11" class="difflineminus">-  var e = wm.getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+  var e = Services.wm.getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l31.13"></a><span id="l31.13">   while (e.hasMoreElements()) {</span>
<a href="#l31.14"></a><span id="l31.14">     if (!e.getNext().closed)</span>
<a href="#l31.15"></a><span id="l31.15">       ++count;</span>
<a href="#l31.16"></a><span id="l31.16">   }</span>
<a href="#l31.17"></a><span id="l31.17">   is(count, expected,</span>
<a href="#l31.18"></a><span id="l31.18">      &quot;number of open browser windows according to nsIWindowMediator&quot;);</span>
<a href="#l31.19"></a><span id="l31.19">   is(JSON.parse(ss.getBrowserState()).windows.length, expected,</span>
<a href="#l31.20"></a><span id="l31.20">      &quot;number of open browser windows according to getBrowserState&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/suite/common/tests/browser/browser_581937.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_581937.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -33,19 +33,16 @@</span>
<a href="#l32.4"></a><span id="l32.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l32.5"></a><span id="l32.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l32.6"></a><span id="l32.6">  *</span>
<a href="#l32.7"></a><span id="l32.7">  * ***** END LICENSE BLOCK *****/</span>
<a href="#l32.8"></a><span id="l32.8"> </span>
<a href="#l32.9"></a><span id="l32.9">  // Tests that an about:blank tab with no history will not be saved into</span>
<a href="#l32.10"></a><span id="l32.10">  // session store and thus, it will not show up in Recently Closed Tabs.</span>
<a href="#l32.11"></a><span id="l32.11"> </span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">- let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineminus">-</span>
<a href="#l32.15"></a><span id="l32.15"> let tab;</span>
<a href="#l32.16"></a><span id="l32.16"> function test() {</span>
<a href="#l32.17"></a><span id="l32.17">   waitForExplicitFinish();</span>
<a href="#l32.18"></a><span id="l32.18"> </span>
<a href="#l32.19"></a><span id="l32.19">   Services.prefs.setIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;, 0);</span>
<a href="#l32.20"></a><span id="l32.20">   Services.prefs.setIntPref(&quot;browser.tabs.max_tabs_undo&quot;, 0);</span>
<a href="#l32.21"></a><span id="l32.21">   Services.prefs.clearUserPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l32.22"></a><span id="l32.22"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/suite/common/tests/browser/browser_586068-cascaded_restore.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_586068-cascaded_restore.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -30,20 +30,16 @@</span>
<a href="#l33.4"></a><span id="l33.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l33.5"></a><span id="l33.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l33.6"></a><span id="l33.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l33.7"></a><span id="l33.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l33.8"></a><span id="l33.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l33.9"></a><span id="l33.9">  *</span>
<a href="#l33.10"></a><span id="l33.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l33.11"></a><span id="l33.11"> </span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineminus">-var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineminus">-                   .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineminus">-</span>
<a href="#l33.16"></a><span id="l33.16"> let stateBackup = ss.getBrowserState();</span>
<a href="#l33.17"></a><span id="l33.17"> </span>
<a href="#l33.18"></a><span id="l33.18"> const TAB_STATE_NEEDS_RESTORE = 1;</span>
<a href="#l33.19"></a><span id="l33.19"> const TAB_STATE_RESTORING = 2;</span>
<a href="#l33.20"></a><span id="l33.20"> </span>
<a href="#l33.21"></a><span id="l33.21"> function test() {</span>
<a href="#l33.22"></a><span id="l33.22">   /** Test for Bug 586068 - Cascade page loads when restoring **/</span>
<a href="#l33.23"></a><span id="l33.23">   waitForExplicitFinish();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/suite/common/tests/browser/browser_597315.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_597315.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -30,19 +30,16 @@</span>
<a href="#l34.4"></a><span id="l34.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l34.5"></a><span id="l34.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l34.6"></a><span id="l34.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l34.7"></a><span id="l34.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l34.8"></a><span id="l34.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l34.9"></a><span id="l34.9">  *</span>
<a href="#l34.10"></a><span id="l34.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-</span>
<a href="#l34.15"></a><span id="l34.15"> let stateBackup = ss.getBrowserState();</span>
<a href="#l34.16"></a><span id="l34.16"> </span>
<a href="#l34.17"></a><span id="l34.17"> function test() {</span>
<a href="#l34.18"></a><span id="l34.18">   /** Test for Bug 597315 - Frameset history does not work properly when restoring a tab **/</span>
<a href="#l34.19"></a><span id="l34.19">   waitForExplicitFinish();</span>
<a href="#l34.20"></a><span id="l34.20"> </span>
<a href="#l34.21"></a><span id="l34.21">   Services.prefs.setIntPref(&quot;browser.tabs.max_tabs_undo&quot;, 0);</span>
<a href="#l34.22"></a><span id="l34.22"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/suite/common/tests/browser/browser_607016.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_607016.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -33,20 +33,16 @@</span>
<a href="#l35.4"></a><span id="l35.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l35.5"></a><span id="l35.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l35.6"></a><span id="l35.6">  *</span>
<a href="#l35.7"></a><span id="l35.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l35.8"></a><span id="l35.8"> </span>
<a href="#l35.9"></a><span id="l35.9"> const TAB_STATE_NEEDS_RESTORE = 1;</span>
<a href="#l35.10"></a><span id="l35.10"> const TAB_STATE_RESTORING = 2;</span>
<a href="#l35.11"></a><span id="l35.11"> </span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">-var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineminus">-                   .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineminus">-</span>
<a href="#l35.16"></a><span id="l35.16"> let stateBackup = ss.getBrowserState();</span>
<a href="#l35.17"></a><span id="l35.17"> </span>
<a href="#l35.18"></a><span id="l35.18"> function cleanup() {</span>
<a href="#l35.19"></a><span id="l35.19">   // Reset the pref</span>
<a href="#l35.20"></a><span id="l35.20">   try {</span>
<a href="#l35.21"></a><span id="l35.21">     Services.prefs.clearUserPref(&quot;browser.sessionstore.max_concurrent_tabs&quot;);</span>
<a href="#l35.22"></a><span id="l35.22">   } catch (e) {}</span>
<a href="#l35.23"></a><span id="l35.23">   ss.setBrowserState(stateBackup);</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineat">@@ -55,16 +51,17 @@ function cleanup() {</span>
<a href="#l35.25"></a><span id="l35.25"> </span>
<a href="#l35.26"></a><span id="l35.26"> function test() {</span>
<a href="#l35.27"></a><span id="l35.27">   /** Bug 607016 - If a tab is never restored, attributes (eg. hidden) aren't updated correctly **/</span>
<a href="#l35.28"></a><span id="l35.28">   waitForExplicitFinish();</span>
<a href="#l35.29"></a><span id="l35.29"> </span>
<a href="#l35.30"></a><span id="l35.30">   // Set the pref to 0 so we know exactly how many tabs should be restoring at</span>
<a href="#l35.31"></a><span id="l35.31">   // any given time. This guarantees that a finishing load won't start another.</span>
<a href="#l35.32"></a><span id="l35.32">   Services.prefs.setIntPref(&quot;browser.sessionstore.max_concurrent_tabs&quot;, 0);</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+  Services.prefs.setIntPref(&quot;browser.tabs.max_tabs_undo&quot;, 0);</span>
<a href="#l35.34"></a><span id="l35.34"> </span>
<a href="#l35.35"></a><span id="l35.35">   // We have our own progress listener for this test, which we'll attach before our state is set</span>
<a href="#l35.36"></a><span id="l35.36">   let progressListener = {</span>
<a href="#l35.37"></a><span id="l35.37">     onStateChange: function (aBrowser, aWebProgress, aRequest, aStateFlags, aStatus) {</span>
<a href="#l35.38"></a><span id="l35.38">       if (aBrowser.__SS_restoreState == TAB_STATE_RESTORING &amp;&amp;</span>
<a href="#l35.39"></a><span id="l35.39">           aStateFlags &amp; Components.interfaces.nsIWebProgressListener.STATE_STOP &amp;&amp;</span>
<a href="#l35.40"></a><span id="l35.40">           aStateFlags &amp; Components.interfaces.nsIWebProgressListener.STATE_IS_NETWORK &amp;&amp;</span>
<a href="#l35.41"></a><span id="l35.41">           aStateFlags &amp; Components.interfaces.nsIWebProgressListener.STATE_IS_WINDOW)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/suite/common/tests/browser/browser_615394-SSWindowState_events.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_615394-SSWindowState_events.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -30,20 +30,16 @@</span>
<a href="#l36.4"></a><span id="l36.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l36.5"></a><span id="l36.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l36.6"></a><span id="l36.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l36.7"></a><span id="l36.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l36.8"></a><span id="l36.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l36.9"></a><span id="l36.9">  *</span>
<a href="#l36.10"></a><span id="l36.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l36.11"></a><span id="l36.11"> </span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-const ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineminus">-</span>
<a href="#l36.16"></a><span id="l36.16"> const stateBackup = ss.getBrowserState();</span>
<a href="#l36.17"></a><span id="l36.17"> const testState = {</span>
<a href="#l36.18"></a><span id="l36.18">   windows: [{</span>
<a href="#l36.19"></a><span id="l36.19">     tabs: [</span>
<a href="#l36.20"></a><span id="l36.20">       { entries: [{ url: &quot;about:blank&quot; }] },</span>
<a href="#l36.21"></a><span id="l36.21">       { entries: [{ url: &quot;about:logo&quot; }] }</span>
<a href="#l36.22"></a><span id="l36.22">     ]</span>
<a href="#l36.23"></a><span id="l36.23">   }]</span>
<a href="#l36.24"></a><span id="l36.24" class="difflineat">@@ -285,26 +281,28 @@ function test_setWindowState() {</span>
<a href="#l36.25"></a><span id="l36.25"> </span>
<a href="#l36.26"></a><span id="l36.26">   ss.setWindowState(window, JSON.stringify(testState), true);</span>
<a href="#l36.27"></a><span id="l36.27"> }</span>
<a href="#l36.28"></a><span id="l36.28"> </span>
<a href="#l36.29"></a><span id="l36.29"> </span>
<a href="#l36.30"></a><span id="l36.30"> function test_setBrowserState() {</span>
<a href="#l36.31"></a><span id="l36.31">   // We'll track events per window so we are sure that they are each happening once</span>
<a href="#l36.32"></a><span id="l36.32">   // pre window.</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineplus">+  let newWindow;</span>
<a href="#l36.34"></a><span id="l36.34">   let windowEvents = {};</span>
<a href="#l36.35"></a><span id="l36.35">   windowEvents[getOuterWindowID(window)] = { busyEventCount: 0, readyEventCount: 0 };</span>
<a href="#l36.36"></a><span id="l36.36"> </span>
<a href="#l36.37"></a><span id="l36.37">   // waitForBrowserState does it's own observing for windows, but doesn't attach</span>
<a href="#l36.38"></a><span id="l36.38">   // the listeners we want here, so do it ourselves.</span>
<a href="#l36.39"></a><span id="l36.39">   function windowObserver(aSubject, aTopic, aData) {</span>
<a href="#l36.40"></a><span id="l36.40">     if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l36.41"></a><span id="l36.41" class="difflineminus">-      let newWindow = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineplus">+      newWindow = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l36.43"></a><span id="l36.43">       newWindow.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l36.44"></a><span id="l36.44">         newWindow.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineplus">+</span>
<a href="#l36.46"></a><span id="l36.46">         Services.ww.unregisterNotification(windowObserver);</span>
<a href="#l36.47"></a><span id="l36.47"> </span>
<a href="#l36.48"></a><span id="l36.48">         windowEvents[getOuterWindowID(newWindow)] = { busyEventCount: 0, readyEventCount: 0 };</span>
<a href="#l36.49"></a><span id="l36.49"> </span>
<a href="#l36.50"></a><span id="l36.50">         newWindow.addEventListener(&quot;SSWindowStateBusy&quot;, onSSWindowStateBusy, false);</span>
<a href="#l36.51"></a><span id="l36.51">         newWindow.addEventListener(&quot;SSWindowStateReady&quot;, onSSWindowStateReady, false);</span>
<a href="#l36.52"></a><span id="l36.52">       }, false);</span>
<a href="#l36.53"></a><span id="l36.53">     }</span>
<a href="#l36.54"></a><span id="l36.54" class="difflineat">@@ -330,41 +328,44 @@ function test_setBrowserState() {</span>
<a href="#l36.55"></a><span id="l36.55">       is(winEvents.readyEventCount, 1,</span>
<a href="#l36.56"></a><span id="l36.56">          &quot;[test_setBrowserState] window&quot; + id + &quot; ready event count correct&quot;);</span>
<a href="#l36.57"></a><span id="l36.57">       checkedWindows++;</span>
<a href="#l36.58"></a><span id="l36.58">     }</span>
<a href="#l36.59"></a><span id="l36.59">     is(checkedWindows, 2,</span>
<a href="#l36.60"></a><span id="l36.60">        &quot;[test_setBrowserState] checked 2 windows&quot;);</span>
<a href="#l36.61"></a><span id="l36.61">     window.removeEventListener(&quot;SSWindowStateBusy&quot;, onSSWindowStateBusy, false);</span>
<a href="#l36.62"></a><span id="l36.62">     window.removeEventListener(&quot;SSWindowStateReady&quot;, onSSWindowStateReady, false);</span>
<a href="#l36.63"></a><span id="l36.63" class="difflineplus">+    newWindow.removeEventListener(&quot;SSWindowStateBusy&quot;, onSSWindowStateBusy, false);</span>
<a href="#l36.64"></a><span id="l36.64" class="difflineplus">+    newWindow.removeEventListener(&quot;SSWindowStateReady&quot;, onSSWindowStateReady, false);</span>
<a href="#l36.65"></a><span id="l36.65">     runNextTest();</span>
<a href="#l36.66"></a><span id="l36.66">   });</span>
<a href="#l36.67"></a><span id="l36.67"> }</span>
<a href="#l36.68"></a><span id="l36.68"> </span>
<a href="#l36.69"></a><span id="l36.69"> </span>
<a href="#l36.70"></a><span id="l36.70"> function test_undoCloseWindow() {</span>
<a href="#l36.71"></a><span id="l36.71">   let newWindow, reopenedWindow;</span>
<a href="#l36.72"></a><span id="l36.72"> </span>
<a href="#l36.73"></a><span id="l36.73">   function firstWindowObserver(aSubject, aTopic, aData) {</span>
<a href="#l36.74"></a><span id="l36.74">     if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l36.75"></a><span id="l36.75">       newWindow = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l36.76"></a><span id="l36.76" class="difflineminus">-      Services.ww.unregisterNotification(windowObserver);</span>
<a href="#l36.77"></a><span id="l36.77" class="difflineplus">+      Services.ww.unregisterNotification(firstWindowObserver);</span>
<a href="#l36.78"></a><span id="l36.78">     }</span>
<a href="#l36.79"></a><span id="l36.79">   }</span>
<a href="#l36.80"></a><span id="l36.80">   Services.ww.registerNotification(firstWindowObserver);</span>
<a href="#l36.81"></a><span id="l36.81"> </span>
<a href="#l36.82"></a><span id="l36.82">   waitForBrowserState(lameMultiWindowState, function() {</span>
<a href="#l36.83"></a><span id="l36.83">     // Close the window which isn't window</span>
<a href="#l36.84"></a><span id="l36.84">     newWindow.close();</span>
<a href="#l36.85"></a><span id="l36.85">     reopenedWindow = ss.undoCloseWindow(0);</span>
<a href="#l36.86"></a><span id="l36.86">     reopenedWindow.addEventListener(&quot;SSWindowStateBusy&quot;, onSSWindowStateBusy, false);</span>
<a href="#l36.87"></a><span id="l36.87">     reopenedWindow.addEventListener(&quot;SSWindowStateReady&quot;, onSSWindowStateReady, false);</span>
<a href="#l36.88"></a><span id="l36.88"> </span>
<a href="#l36.89"></a><span id="l36.89">     reopenedWindow.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l36.90"></a><span id="l36.90">       reopenedWindow.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l36.91"></a><span id="l36.91" class="difflineplus">+</span>
<a href="#l36.92"></a><span id="l36.92">       reopenedWindow.getBrowser().tabContainer.addEventListener(&quot;SSTabRestored&quot;, onSSTabRestored, false);</span>
<a href="#l36.93"></a><span id="l36.93">     }, false);</span>
<a href="#l36.94"></a><span id="l36.94">   });</span>
<a href="#l36.95"></a><span id="l36.95"> </span>
<a href="#l36.96"></a><span id="l36.96">   let busyEventCount = 0,</span>
<a href="#l36.97"></a><span id="l36.97">       readyEventCount = 0,</span>
<a href="#l36.98"></a><span id="l36.98">       tabRestoredCount = 0;</span>
<a href="#l36.99"></a><span id="l36.99">   // These will listen to the reopened closed window...</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/suite/common/tests/browser/browser_625257.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_625257.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -34,19 +34,16 @@</span>
<a href="#l37.4"></a><span id="l37.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l37.5"></a><span id="l37.5">  *</span>
<a href="#l37.6"></a><span id="l37.6">  * ***** END LICENSE BLOCK *****/</span>
<a href="#l37.7"></a><span id="l37.7"> </span>
<a href="#l37.8"></a><span id="l37.8"> // This tests that a tab which is closed while loading is not lost.</span>
<a href="#l37.9"></a><span id="l37.9"> // Specifically, that session store does not rely on an invalid cache when</span>
<a href="#l37.10"></a><span id="l37.10"> // constructing data for a tab which is loading.</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-                   .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">-</span>
<a href="#l37.15"></a><span id="l37.15"> // The newly created tab which we load a URL into and try closing/undoing.</span>
<a href="#l37.16"></a><span id="l37.16"> let tab;</span>
<a href="#l37.17"></a><span id="l37.17"> </span>
<a href="#l37.18"></a><span id="l37.18"> // This test steps through the following parts:</span>
<a href="#l37.19"></a><span id="l37.19"> //  1. Tab has been created is loading URI_TO_LOAD.</span>
<a href="#l37.20"></a><span id="l37.20"> //  2. Before URI_TO_LOAD finishes loading, browser.currentURI has changed and</span>
<a href="#l37.21"></a><span id="l37.21"> //     tab is scheduled to be removed.</span>
<a href="#l37.22"></a><span id="l37.22"> //  3. After the tab has been closed, undoCloseTab() has been called and the tab</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/suite/common/tests/browser/browser_bug431826.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug431826.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1,16 +1,12 @@</span>
<a href="#l38.4"></a><span id="l38.4" class="difflineminus">-// Workaround until Application.prefs can be used safely. (Bug 534647)</span>
<a href="#l38.5"></a><span id="l38.5" class="difflineminus">-var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l38.6"></a><span id="l38.6" class="difflineminus">-                             .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l38.7"></a><span id="l38.7" class="difflineminus">-</span>
<a href="#l38.8"></a><span id="l38.8"> function test() {</span>
<a href="#l38.9"></a><span id="l38.9">   waitForExplicitFinish();</span>
<a href="#l38.10"></a><span id="l38.10"> </span>
<a href="#l38.11"></a><span id="l38.11" class="difflineminus">-  gBrowser.selectedTab = gBrowser.addTab();</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineplus">+  getBrowser().selectedTab = gBrowser.addTab();</span>
<a href="#l38.13"></a><span id="l38.13"> </span>
<a href="#l38.14"></a><span id="l38.14">   // Navigate to a site with a broken cert</span>
<a href="#l38.15"></a><span id="l38.15">   window.addEventListener(&quot;DOMContentLoaded&quot;, testBrokenCert, true);</span>
<a href="#l38.16"></a><span id="l38.16">   content.location = &quot;https://nocert.example.com/&quot;;</span>
<a href="#l38.17"></a><span id="l38.17"> }</span>
<a href="#l38.18"></a><span id="l38.18"> </span>
<a href="#l38.19"></a><span id="l38.19"> function testBrokenCert() {</span>
<a href="#l38.20"></a><span id="l38.20">   window.removeEventListener(&quot;DOMContentLoaded&quot;, testBrokenCert, true);</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineat">@@ -19,30 +15,30 @@ function testBrokenCert() {</span>
<a href="#l38.22"></a><span id="l38.22">   ok(/^about:certerror/.test(gBrowser.contentDocument.documentURI), &quot;Broken page should go to about:certerror, not about:neterror&quot;);</span>
<a href="#l38.23"></a><span id="l38.23"> </span>
<a href="#l38.24"></a><span id="l38.24">   // Confirm that the expert section is collapsed</span>
<a href="#l38.25"></a><span id="l38.25">   var expertDiv = gBrowser.contentDocument.getElementById(&quot;expertContent&quot;);</span>
<a href="#l38.26"></a><span id="l38.26">   ok(expertDiv, &quot;Expert content div should exist&quot;);</span>
<a href="#l38.27"></a><span id="l38.27">   ok(expertDiv.hasAttribute(&quot;collapsed&quot;), &quot;Expert content should be collapsed by default&quot;);</span>
<a href="#l38.28"></a><span id="l38.28"> </span>
<a href="#l38.29"></a><span id="l38.29">   // Tweak the expert mode pref</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineminus">-  gPrefService.setBoolPref(&quot;browser.xul.error_pages.expert_bad_cert&quot;, true);</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineplus">+  Services.prefs.setBoolPref(&quot;browser.xul.error_pages.expert_bad_cert&quot;, true);</span>
<a href="#l38.32"></a><span id="l38.32">   // Application.prefs.setValue(&quot;browser.xul.error_pages.expert_bad_cert&quot;, true);</span>
<a href="#l38.33"></a><span id="l38.33"> </span>
<a href="#l38.34"></a><span id="l38.34">   window.addEventListener(&quot;DOMContentLoaded&quot;, testExpertPref, true);</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineminus">-  gBrowser.reload();</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineplus">+  getBrowser().reload();</span>
<a href="#l38.37"></a><span id="l38.37"> }</span>
<a href="#l38.38"></a><span id="l38.38"> </span>
<a href="#l38.39"></a><span id="l38.39"> function testExpertPref() {</span>
<a href="#l38.40"></a><span id="l38.40">   window.removeEventListener(&quot;DOMContentLoaded&quot;, testExpertPref, true);</span>
<a href="#l38.41"></a><span id="l38.41"> </span>
<a href="#l38.42"></a><span id="l38.42">   var expertDiv = gBrowser.contentDocument.getElementById(&quot;expertContent&quot;);</span>
<a href="#l38.43"></a><span id="l38.43">   var technicalDiv = gBrowser.contentDocument.getElementById(&quot;technicalContent&quot;);</span>
<a href="#l38.44"></a><span id="l38.44">   ok(!expertDiv.hasAttribute(&quot;collapsed&quot;), &quot;Expert content should not be collapsed with the expert mode pref set&quot;);</span>
<a href="#l38.45"></a><span id="l38.45">   ok(!technicalDiv.hasAttribute(&quot;collapsed&quot;), &quot;Technical content should not be collapsed with the expert mode pref set&quot;);</span>
<a href="#l38.46"></a><span id="l38.46"> </span>
<a href="#l38.47"></a><span id="l38.47">   // Clean up</span>
<a href="#l38.48"></a><span id="l38.48" class="difflineminus">-  gBrowser.removeCurrentTab();</span>
<a href="#l38.49"></a><span id="l38.49" class="difflineminus">-  if (gPrefService.prefHasUserValue(&quot;browser.xul.error_pages.expert_bad_cert&quot;))</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-    gPrefService.clearUserPref(&quot;browser.xul.error_pages.expert_bad_cert&quot;);</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineplus">+  getBrowser().removeCurrentTab();</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineplus">+  if (Services.prefs.prefHasUserValue(&quot;browser.xul.error_pages.expert_bad_cert&quot;))</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineplus">+    Services.prefs.clearUserPref(&quot;browser.xul.error_pages.expert_bad_cert&quot;);</span>
<a href="#l38.54"></a><span id="l38.54">   // Application.prefs.get(&quot;browser.xul.error_pages.expert_bad_cert&quot;).reset();</span>
<a href="#l38.55"></a><span id="l38.55">   finish();</span>
<a href="#l38.56"></a><span id="l38.56"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/suite/common/tests/browser/browser_bug510890.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug510890.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -47,18 +47,16 @@ function browserWindowsCount() {</span>
<a href="#l39.4"></a><span id="l39.4"> </span>
<a href="#l39.5"></a><span id="l39.5"> function test() {</span>
<a href="#l39.6"></a><span id="l39.6">   /** Test for Bug 510890 **/</span>
<a href="#l39.7"></a><span id="l39.7">   // This test takes quite some time, and timeouts frequently, so we require</span>
<a href="#l39.8"></a><span id="l39.8">   // more time to run.</span>
<a href="#l39.9"></a><span id="l39.9">   // See Bug 518970.</span>
<a href="#l39.10"></a><span id="l39.10">   requestLongerTimeout(2);</span>
<a href="#l39.11"></a><span id="l39.11">   </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-  // test setup</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineminus">-  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l39.14"></a><span id="l39.14">   waitForExplicitFinish();</span>
<a href="#l39.15"></a><span id="l39.15">   </span>
<a href="#l39.16"></a><span id="l39.16">   function test_basic(callback) {</span>
<a href="#l39.17"></a><span id="l39.17">   </span>
<a href="#l39.18"></a><span id="l39.18">     let testURL = &quot;about:config&quot;;</span>
<a href="#l39.19"></a><span id="l39.19">     let uniqueKey = &quot;bug 510890&quot;;</span>
<a href="#l39.20"></a><span id="l39.20">     let uniqueValue = &quot;unik&quot; + Date.now();</span>
<a href="#l39.21"></a><span id="l39.21">     let uniqueText = &quot;pi != &quot; + Math.random();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/suite/common/tests/browser/head.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/suite/common/tests/browser/head.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -30,66 +30,124 @@</span>
<a href="#l40.4"></a><span id="l40.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l40.5"></a><span id="l40.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l40.6"></a><span id="l40.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l40.7"></a><span id="l40.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l40.8"></a><span id="l40.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l40.9"></a><span id="l40.9">  *</span>
<a href="#l40.10"></a><span id="l40.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l40.11"></a><span id="l40.11"> </span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-const SS_SVC = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineminus">-                         .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l40.16"></a><span id="l40.16" class="difflineplus">+                   .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l40.17"></a><span id="l40.17"> </span>
<a href="#l40.18"></a><span id="l40.18"> // This assumes that tests will at least have some state/entries</span>
<a href="#l40.19"></a><span id="l40.19"> function waitForBrowserState(aState, aSetStateCallback) {</span>
<a href="#l40.20"></a><span id="l40.20">   let windows = [window];</span>
<a href="#l40.21"></a><span id="l40.21">   let tabsRestored = 0;</span>
<a href="#l40.22"></a><span id="l40.22">   let expectedTabsRestored = 0;</span>
<a href="#l40.23"></a><span id="l40.23">   let expectedWindows = aState.windows.length;</span>
<a href="#l40.24"></a><span id="l40.24">   let windowsOpen = 1;</span>
<a href="#l40.25"></a><span id="l40.25" class="difflineplus">+  let listening = false;</span>
<a href="#l40.26"></a><span id="l40.26" class="difflineplus">+  let windowObserving = false;</span>
<a href="#l40.27"></a><span id="l40.27"> </span>
<a href="#l40.28"></a><span id="l40.28">   aState.windows.forEach(function(winState) expectedTabsRestored += winState.tabs.length);</span>
<a href="#l40.29"></a><span id="l40.29"> </span>
<a href="#l40.30"></a><span id="l40.30">   function onSSTabRestored(aEvent) {</span>
<a href="#l40.31"></a><span id="l40.31">     if (++tabsRestored == expectedTabsRestored) {</span>
<a href="#l40.32"></a><span id="l40.32">       // Remove the event listener from each window</span>
<a href="#l40.33"></a><span id="l40.33">       windows.forEach(function(win) {</span>
<a href="#l40.34"></a><span id="l40.34">         win.getBrowser().tabContainer.removeEventListener(&quot;SSTabRestored&quot;, onSSTabRestored, true);</span>
<a href="#l40.35"></a><span id="l40.35">       });</span>
<a href="#l40.36"></a><span id="l40.36" class="difflineplus">+      listening = false;</span>
<a href="#l40.37"></a><span id="l40.37">       info(&quot;running &quot; + aSetStateCallback.name);</span>
<a href="#l40.38"></a><span id="l40.38">       executeSoon(aSetStateCallback);</span>
<a href="#l40.39"></a><span id="l40.39">     }</span>
<a href="#l40.40"></a><span id="l40.40">   }</span>
<a href="#l40.41"></a><span id="l40.41"> </span>
<a href="#l40.42"></a><span id="l40.42">   // Used to add our listener to further windows so we can catch SSTabRestored</span>
<a href="#l40.43"></a><span id="l40.43">   // coming from them when creating a multi-window state.</span>
<a href="#l40.44"></a><span id="l40.44">   function windowObserver(aSubject, aTopic, aData) {</span>
<a href="#l40.45"></a><span id="l40.45">     if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l40.46"></a><span id="l40.46">       let newWindow = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l40.47"></a><span id="l40.47">       newWindow.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l40.48"></a><span id="l40.48">         newWindow.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l40.49"></a><span id="l40.49"> </span>
<a href="#l40.50"></a><span id="l40.50" class="difflineminus">-        if (++windowsOpen == expectedWindows)</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineplus">+        if (++windowsOpen == expectedWindows) {</span>
<a href="#l40.52"></a><span id="l40.52">           Services.ww.unregisterNotification(windowObserver);</span>
<a href="#l40.53"></a><span id="l40.53" class="difflineplus">+          windowObserving = false;</span>
<a href="#l40.54"></a><span id="l40.54" class="difflineplus">+        }</span>
<a href="#l40.55"></a><span id="l40.55"> </span>
<a href="#l40.56"></a><span id="l40.56">         // Track this window so we can remove the progress listener later</span>
<a href="#l40.57"></a><span id="l40.57">         windows.push(newWindow);</span>
<a href="#l40.58"></a><span id="l40.58">         // Add the progress listener</span>
<a href="#l40.59"></a><span id="l40.59">         newWindow.getBrowser().tabContainer.addEventListener(&quot;SSTabRestored&quot;, onSSTabRestored, true);</span>
<a href="#l40.60"></a><span id="l40.60">       }, false);</span>
<a href="#l40.61"></a><span id="l40.61">     }</span>
<a href="#l40.62"></a><span id="l40.62">   }</span>
<a href="#l40.63"></a><span id="l40.63"> </span>
<a href="#l40.64"></a><span id="l40.64">   // We only want to register the notification if we expect more than 1 window</span>
<a href="#l40.65"></a><span id="l40.65" class="difflineminus">-  if (expectedWindows &gt; 1)</span>
<a href="#l40.66"></a><span id="l40.66" class="difflineplus">+  if (expectedWindows &gt; 1) {</span>
<a href="#l40.67"></a><span id="l40.67" class="difflineplus">+    registerCleanupFunction(function() {</span>
<a href="#l40.68"></a><span id="l40.68" class="difflineplus">+      if (windowObserving) {</span>
<a href="#l40.69"></a><span id="l40.69" class="difflineplus">+        Services.ww.unregisterNotification(windowObserver);</span>
<a href="#l40.70"></a><span id="l40.70" class="difflineplus">+      }</span>
<a href="#l40.71"></a><span id="l40.71" class="difflineplus">+    });</span>
<a href="#l40.72"></a><span id="l40.72" class="difflineplus">+    windowObserving = true;</span>
<a href="#l40.73"></a><span id="l40.73">     Services.ww.registerNotification(windowObserver);</span>
<a href="#l40.74"></a><span id="l40.74" class="difflineplus">+  }</span>
<a href="#l40.75"></a><span id="l40.75"> </span>
<a href="#l40.76"></a><span id="l40.76" class="difflineplus">+  registerCleanupFunction(function() {</span>
<a href="#l40.77"></a><span id="l40.77" class="difflineplus">+    if (listening) {</span>
<a href="#l40.78"></a><span id="l40.78" class="difflineplus">+      windows.forEach(function(win) {</span>
<a href="#l40.79"></a><span id="l40.79" class="difflineplus">+        win.getBrowser().tabContainer.removeEventListener(&quot;SSTabRestored&quot;, onSSTabRestored, true);</span>
<a href="#l40.80"></a><span id="l40.80" class="difflineplus">+      });</span>
<a href="#l40.81"></a><span id="l40.81" class="difflineplus">+    }</span>
<a href="#l40.82"></a><span id="l40.82" class="difflineplus">+  });</span>
<a href="#l40.83"></a><span id="l40.83">   // Add the event listener for this window as well.</span>
<a href="#l40.84"></a><span id="l40.84" class="difflineplus">+  listening = true;</span>
<a href="#l40.85"></a><span id="l40.85">   getBrowser().tabContainer.addEventListener(&quot;SSTabRestored&quot;, onSSTabRestored, true);</span>
<a href="#l40.86"></a><span id="l40.86"> </span>
<a href="#l40.87"></a><span id="l40.87">   // Finally, call setBrowserState</span>
<a href="#l40.88"></a><span id="l40.88" class="difflineminus">-  SS_SVC.setBrowserState(JSON.stringify(aState));</span>
<a href="#l40.89"></a><span id="l40.89" class="difflineplus">+  ss.setBrowserState(JSON.stringify(aState));</span>
<a href="#l40.90"></a><span id="l40.90"> }</span>
<a href="#l40.91"></a><span id="l40.91"> </span>
<a href="#l40.92"></a><span id="l40.92" class="difflineplus">+// waitForSaveState waits for a state write but not necessarily for the state to</span>
<a href="#l40.93"></a><span id="l40.93" class="difflineplus">+// turn dirty.</span>
<a href="#l40.94"></a><span id="l40.94" class="difflineplus">+function waitForSaveState(aSaveStateCallback) {</span>
<a href="#l40.95"></a><span id="l40.95" class="difflineplus">+  let observing = false;</span>
<a href="#l40.96"></a><span id="l40.96" class="difflineplus">+  let topic = &quot;sessionstore-state-write&quot;;</span>
<a href="#l40.97"></a><span id="l40.97" class="difflineplus">+</span>
<a href="#l40.98"></a><span id="l40.98" class="difflineplus">+  let sessionSaveTimeout = 1000 +</span>
<a href="#l40.99"></a><span id="l40.99" class="difflineplus">+    Services.prefs.getIntPref(&quot;browser.sessionstore.interval&quot;);</span>
<a href="#l40.100"></a><span id="l40.100" class="difflineplus">+</span>
<a href="#l40.101"></a><span id="l40.101" class="difflineplus">+  function removeObserver() {</span>
<a href="#l40.102"></a><span id="l40.102" class="difflineplus">+    if (!observing)</span>
<a href="#l40.103"></a><span id="l40.103" class="difflineplus">+      return;</span>
<a href="#l40.104"></a><span id="l40.104" class="difflineplus">+    Services.obs.removeObserver(observer, topic, false);</span>
<a href="#l40.105"></a><span id="l40.105" class="difflineplus">+    observing = false;</span>
<a href="#l40.106"></a><span id="l40.106" class="difflineplus">+  }</span>
<a href="#l40.107"></a><span id="l40.107" class="difflineplus">+</span>
<a href="#l40.108"></a><span id="l40.108" class="difflineplus">+  let timeout = setTimeout(function () {</span>
<a href="#l40.109"></a><span id="l40.109" class="difflineplus">+    removeObserver();</span>
<a href="#l40.110"></a><span id="l40.110" class="difflineplus">+    aSaveStateCallback();</span>
<a href="#l40.111"></a><span id="l40.111" class="difflineplus">+  }, sessionSaveTimeout);</span>
<a href="#l40.112"></a><span id="l40.112" class="difflineplus">+</span>
<a href="#l40.113"></a><span id="l40.113" class="difflineplus">+  function observer(aSubject, aTopic, aData) {</span>
<a href="#l40.114"></a><span id="l40.114" class="difflineplus">+    removeObserver();</span>
<a href="#l40.115"></a><span id="l40.115" class="difflineplus">+    timeout = clearTimeout(timeout);</span>
<a href="#l40.116"></a><span id="l40.116" class="difflineplus">+    executeSoon(aSaveStateCallback);</span>
<a href="#l40.117"></a><span id="l40.117" class="difflineplus">+  }</span>
<a href="#l40.118"></a><span id="l40.118" class="difflineplus">+</span>
<a href="#l40.119"></a><span id="l40.119" class="difflineplus">+  registerCleanupFunction(function() {</span>
<a href="#l40.120"></a><span id="l40.120" class="difflineplus">+    removeObserver();</span>
<a href="#l40.121"></a><span id="l40.121" class="difflineplus">+    if (timeout) {</span>
<a href="#l40.122"></a><span id="l40.122" class="difflineplus">+      clearTimeout(timeout);</span>
<a href="#l40.123"></a><span id="l40.123" class="difflineplus">+    }</span>
<a href="#l40.124"></a><span id="l40.124" class="difflineplus">+  });</span>
<a href="#l40.125"></a><span id="l40.125" class="difflineplus">+</span>
<a href="#l40.126"></a><span id="l40.126" class="difflineplus">+  observing = true;</span>
<a href="#l40.127"></a><span id="l40.127" class="difflineplus">+  Services.obs.addObserver(observer, topic, false);</span>
<a href="#l40.128"></a><span id="l40.128" class="difflineplus">+};</span>
<a href="#l40.129"></a><span id="l40.129" class="difflineplus">+</span>
<a href="#l40.130"></a><span id="l40.130" class="difflineplus">+var gUniqueCounter = 0;</span>
<a href="#l40.131"></a><span id="l40.131"> function r() {</span>
<a href="#l40.132"></a><span id="l40.132" class="difflineminus">-  return Date.now() + Math.random();</span>
<a href="#l40.133"></a><span id="l40.133" class="difflineplus">+  return Date.now() + &quot;-&quot; + (++gUniqueCounter);</span>
<a href="#l40.134"></a><span id="l40.134"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

