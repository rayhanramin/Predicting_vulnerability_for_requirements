<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 18930:989a9aad4e24d78fa90fb219f7b2358d13dea06c</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 989a9aad4e24d78fa90fb219f7b2358d13dea06c" />
<meta property="og:url" content="/comm-central/rev/989a9aad4e24d78fa90fb219f7b2358d13dea06c" />
<meta property="og:description" content="Bug 1243760 - Replace nsPIDOMWindow with nsPIDOMWindowInner/Outer in C-C due to bug 1241764. r=mkmelin CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 989a9aad4e24d78fa90fb219f7b2358d13dea06c 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/989a9aad4e24d78fa90fb219f7b2358d13dea06c">shortlog</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/989a9aad4e24d78fa90fb219f7b2358d13dea06c">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c">files</a> |
changeset |
<a href="/comm-central/raw-rev/989a9aad4e24d78fa90fb219f7b2358d13dea06c">raw</a>  | <a href="/comm-central/archive/989a9aad4e24d78fa90fb219f7b2358d13dea06c.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1243760">Bug 1243760</a> - Replace nsPIDOMWindow with nsPIDOMWindowInner/Outer in C-C due to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1241764">bug 1241764</a>. r=mkmelin CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#32;&#67;&#104;&#101;&#101;</td></tr>
<tr><td></td><td class="date age">Thu, 04 Feb 2016 11:39:46 +0100</td></tr>

<tr>
 <td>changeset 18930</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/989a9aad4e24d78fa90fb219f7b2358d13dea06c">989a9aad4e24d78fa90fb219f7b2358d13dea06c</a></td>
</tr>



<tr>
<td>parent 18929</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4f1b3e5af8efdae0712600fe10017f7355cd6eaa">4f1b3e5af8efdae0712600fe10017f7355cd6eaa</a>
</td>
</tr>

<tr>
<td>child 18931</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/bb1364708cceef43055182c414b1c769dd2c631d">bb1364708cceef43055182c414b1c769dd2c631d</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=989a9aad4e24d78fa90fb219f7b2358d13dea06c">11608</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 04 Feb 2016 10:41:29 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@989a9aad4e24 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=989a9aad4e24d78fa90fb219f7b2358d13dea06c">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=989a9aad4e24d78fa90fb219f7b2358d13dea06c&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=989a9aad4e24d78fa90fb219f7b2358d13dea06c&newProject=comm-central&newRevision=989a9aad4e24d78fa90fb219f7b2358d13dea06c&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=989a9aad4e24d78fa90fb219f7b2358d13dea06c&newProject=comm-central&newRevision=989a9aad4e24d78fa90fb219f7b2358d13dea06c&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=989a9aad4e24d78fa90fb219f7b2358d13dea06c&newProject=comm-central&newRevision=989a9aad4e24d78fa90fb219f7b2358d13dea06c&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1243760">1243760</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1241764">1241764</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1243760">Bug 1243760</a> - Replace nsPIDOMWindow with nsPIDOMWindowInner/Outer in C-C due to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1241764">bug 1241764</a>. r=mkmelin CLOSED TREE</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mail/components/migration/src/nsProfileMigrator.cpp">mail/components/migration/src/nsProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mail/components/migration/src/nsProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mail/components/migration/src/nsProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mail/components/migration/src/nsProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mail/components/migration/src/nsProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mail/components/migration/src/nsProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/public/nsIAbManager.idl">mailnews/addrbook/public/nsIAbManager.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/public/nsIAbManager.idl">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/public/nsIAbManager.idl">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/public/nsIAbManager.idl">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/public/nsIAbManager.idl">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/public/nsIAbManager.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbContentHandler.cpp">mailnews/addrbook/src/nsAbContentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbContentHandler.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbContentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbContentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbContentHandler.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbContentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbManager.cpp">mailnews/addrbook/src/nsAbManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbManager.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbManager.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbManager.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbManager.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/addrbook/src/nsAbManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMapiRegistry.idl">mailnews/base/public/nsIMapiRegistry.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMapiRegistry.idl">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMapiRegistry.idl">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMapiRegistry.idl">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMapiRegistry.idl">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMapiRegistry.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMessenger.idl">mailnews/base/public/nsIMessenger.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMessenger.idl">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMessenger.idl">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMessenger.idl">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMessenger.idl">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMessenger.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgPrintEngine.idl">mailnews/base/public/nsIMsgPrintEngine.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgPrintEngine.idl">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgPrintEngine.idl">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgPrintEngine.idl">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgPrintEngine.idl">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgPrintEngine.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgProgress.idl">mailnews/base/public/nsIMsgProgress.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgProgress.idl">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgProgress.idl">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgProgress.idl">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgProgress.idl">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgProgress.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgWindow.idl">mailnews/base/public/nsIMsgWindow.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgWindow.idl">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgWindow.idl">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgWindow.idl">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgWindow.idl">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/public/nsIMsgWindow.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.h">mailnews/base/src/nsMessenger.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.h">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.h">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.h">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.h">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessenger.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerBootstrap.cpp">mailnews/base/src/nsMessengerBootstrap.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerBootstrap.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerBootstrap.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerBootstrap.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerBootstrap.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerBootstrap.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerContentHandler.cpp">mailnews/base/src/nsMessengerContentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerContentHandler.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerContentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerContentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerContentHandler.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerContentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerOSXIntegration.mm">mailnews/base/src/nsMessengerOSXIntegration.mm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerOSXIntegration.mm">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerOSXIntegration.mm">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerOSXIntegration.mm">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerOSXIntegration.mm">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerOSXIntegration.mm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerUnixIntegration.cpp">mailnews/base/src/nsMessengerUnixIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerUnixIntegration.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerUnixIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerUnixIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerUnixIntegration.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerUnixIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerWinIntegration.cpp">mailnews/base/src/nsMessengerWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMessengerWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgMailSession.cpp">mailnews/base/src/nsMsgMailSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgMailSession.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgMailSession.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgMailSession.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgMailSession.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgMailSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.cpp">mailnews/base/src/nsMsgPrintEngine.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.h">mailnews/base/src/nsMsgPrintEngine.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.h">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.h">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.h">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.h">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgPrintEngine.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgProgress.cpp">mailnews/base/src/nsMsgProgress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgProgress.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgProgress.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgProgress.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgProgress.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgProgress.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgWindow.cpp">mailnews/base/src/nsMsgWindow.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgWindow.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgWindow.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgWindow.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgWindow.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/base/src/nsMsgWindow.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgCompose.idl">mailnews/compose/public/nsIMsgCompose.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgCompose.idl">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgCompose.idl">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgCompose.idl">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgCompose.idl">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgCompose.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgComposeService.idl">mailnews/compose/public/nsIMsgComposeService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgComposeService.idl">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgComposeService.idl">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgComposeService.idl">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgComposeService.idl">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgComposeService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgSend.idl">mailnews/compose/public/nsIMsgSend.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgSend.idl">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgSend.idl">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgSend.idl">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgSend.idl">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/public/nsIMsgSend.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.h">mailnews/compose/src/nsMsgCompose.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.h">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.h">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.h">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.h">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgCompose.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeContentHandler.cpp">mailnews/compose/src/nsMsgComposeContentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeContentHandler.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeContentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeContentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeContentHandler.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeContentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.cpp">mailnews/compose/src/nsMsgComposeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.h">mailnews/compose/src/nsMsgComposeService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.h">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.h">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.h">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.h">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgComposeService.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.h">mailnews/compose/src/nsMsgSend.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.h">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.h">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.h">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.h">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/compose/src/nsMsgSend.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/local/src/nsPop3Sink.cpp">mailnews/local/src/nsPop3Sink.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/local/src/nsPop3Sink.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/local/src/nsPop3Sink.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/local/src/nsPop3Sink.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/local/src/nsPop3Sink.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/local/src/nsPop3Sink.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/mapi/mapihook/src/msgMapiHook.cpp">mailnews/mapi/mapihook/src/msgMapiHook.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/mapi/mapihook/src/msgMapiHook.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/mapi/mapihook/src/msgMapiHook.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/mapi/mapihook/src/msgMapiHook.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/mapi/mapihook/src/msgMapiHook.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/mapi/mapihook/src/msgMapiHook.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNNTPNewsgroupList.cpp">mailnews/news/src/nsNNTPNewsgroupList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNNTPNewsgroupList.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNNTPNewsgroupList.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNNTPNewsgroupList.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNNTPNewsgroupList.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNNTPNewsgroupList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNntpService.cpp">mailnews/news/src/nsNntpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNntpService.cpp">file</a> |
<a href="/comm-central/annotate/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNntpService.cpp">annotate</a> |
<a href="/comm-central/diff/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNntpService.cpp">diff</a> |
<a href="/comm-central/comparison/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNntpService.cpp">comparison</a> |
<a href="/comm-central/log/989a9aad4e24d78fa90fb219f7b2358d13dea06c/mailnews/news/src/nsNntpService.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/migration/src/nsProfileMigrator.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/migration/src/nsProfileMigrator.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l1.5"></a><span id="l1.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.6"></a><span id="l1.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.7"></a><span id="l1.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> #include &quot;nsIFile.h&quot;</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l1.12"></a><span id="l1.12"> #include &quot;nsIProfileMigrator.h&quot;</span>
<a href="#l1.13"></a><span id="l1.13"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l1.14"></a><span id="l1.14"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l1.15"></a><span id="l1.15"> #include &quot;nsIToolkitProfile.h&quot;</span>
<a href="#l1.16"></a><span id="l1.16"> #include &quot;nsIToolkitProfileService.h&quot;</span>
<a href="#l1.17"></a><span id="l1.17"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l1.18"></a><span id="l1.18"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l1.19"></a><span id="l1.19"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineat">@@ -48,17 +48,17 @@ nsProfileMigrator::Migrate(nsIProfileSta</span>
<a href="#l1.21"></a><span id="l1.21">   nsCOMPtr&lt;nsIWindowWatcher&gt; ww (do_GetService(NS_WINDOWWATCHER_CONTRACTID));</span>
<a href="#l1.22"></a><span id="l1.22">   nsCOMPtr&lt;nsIMutableArray&gt; params (do_CreateInstance(NS_ARRAY_CONTRACTID));</span>
<a href="#l1.23"></a><span id="l1.23">   if (!ww || !params) return NS_ERROR_FAILURE;</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">   params-&gt;AppendElement(cstr, false);</span>
<a href="#l1.26"></a><span id="l1.26">   params-&gt;AppendElement(mailMigrator, false);</span>
<a href="#l1.27"></a><span id="l1.27">   params-&gt;AppendElement(aStartup, false);</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; migrateWizard;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; migrateWizard;</span>
<a href="#l1.31"></a><span id="l1.31">   return ww-&gt;OpenWindow(nullptr,</span>
<a href="#l1.32"></a><span id="l1.32">                         MIGRATION_WIZARD_FE_URL,</span>
<a href="#l1.33"></a><span id="l1.33">                         &quot;_blank&quot;,</span>
<a href="#l1.34"></a><span id="l1.34">                         MIGRATION_WIZARD_FE_FEATURES,</span>
<a href="#l1.35"></a><span id="l1.35">                         params,</span>
<a href="#l1.36"></a><span id="l1.36">                         getter_AddRefs(migrateWizard));</span>
<a href="#l1.37"></a><span id="l1.37"> }</span>
<a href="#l1.38"></a><span id="l1.38"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/public/nsIAbManager.idl</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/public/nsIAbManager.idl</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,32 +1,32 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* -*- Mode: IDL; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l2.5"></a><span id="l2.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.6"></a><span id="l2.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.7"></a><span id="l2.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> #include &quot;nsIAbListener.idl&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-interface nsIDOMWindow;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+interface mozIDOMWindowProxy;</span>
<a href="#l2.14"></a><span id="l2.14"> interface nsIAbDirectory;</span>
<a href="#l2.15"></a><span id="l2.15"> interface nsIAbCard;</span>
<a href="#l2.16"></a><span id="l2.16"> interface nsIAbDirectoryProperties;</span>
<a href="#l2.17"></a><span id="l2.17"> interface nsIFile;</span>
<a href="#l2.18"></a><span id="l2.18"> interface nsISimpleEnumerator;</span>
<a href="#l2.19"></a><span id="l2.19"> interface nsIAbBooleanExpression;</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21"> /**</span>
<a href="#l2.22"></a><span id="l2.22">  * nsIAbManager is an interface to the main address book mananger</span>
<a href="#l2.23"></a><span id="l2.23">  * via the contract id &quot;@mozilla.org/abmanager;1&quot;</span>
<a href="#l2.24"></a><span id="l2.24">  *</span>
<a href="#l2.25"></a><span id="l2.25">  * It contains the main functions to create and delete address books as well</span>
<a href="#l2.26"></a><span id="l2.26">  * as some helper functions.</span>
<a href="#l2.27"></a><span id="l2.27">  */</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">-[scriptable, uuid(4271daa0-de0b-48ed-9c2b-934dc895383d)]</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+[scriptable, uuid(ea0d8b3d-a549-4874-82d8-3a82cee2a3f1)]</span>
<a href="#l2.30"></a><span id="l2.30"> interface nsIAbManager : nsISupports </span>
<a href="#l2.31"></a><span id="l2.31"> {</span>
<a href="#l2.32"></a><span id="l2.32">   /**</span>
<a href="#l2.33"></a><span id="l2.33">    * Returns an enumerator containing all the top-level directories</span>
<a href="#l2.34"></a><span id="l2.34">    * (non-recursive)</span>
<a href="#l2.35"></a><span id="l2.35">    */</span>
<a href="#l2.36"></a><span id="l2.36">   readonly attribute nsISimpleEnumerator directories;</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38" class="difflineat">@@ -70,17 +70,17 @@ interface nsIAbManager : nsISupports</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40">   /**</span>
<a href="#l2.41"></a><span id="l2.41">    * Exports an address book, it will provide a dialog to the user for the</span>
<a href="#l2.42"></a><span id="l2.42">    * location to save the file to and will then save the address book to media.</span>
<a href="#l2.43"></a><span id="l2.43">    *</span>
<a href="#l2.44"></a><span id="l2.44">    * @param  aParentWin Parent Window for the file save dialog to use.</span>
<a href="#l2.45"></a><span id="l2.45">    * @param  aDirectory The directory to export.</span>
<a href="#l2.46"></a><span id="l2.46">    */</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-  void exportAddressBook(in nsIDOMWindow aParentWin, in nsIAbDirectory aDirectory);</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+  void exportAddressBook(in mozIDOMWindowProxy aParentWin, in nsIAbDirectory aDirectory);</span>
<a href="#l2.49"></a><span id="l2.49"> </span>
<a href="#l2.50"></a><span id="l2.50">   /**</span>
<a href="#l2.51"></a><span id="l2.51">    * Adds a nsIAbListener to receive notifications of address book updates</span>
<a href="#l2.52"></a><span id="l2.52">    * according to the specified notifyFlags.</span>
<a href="#l2.53"></a><span id="l2.53">    *</span>
<a href="#l2.54"></a><span id="l2.54">    * @param  aListener      The listener that is to receive updates.</span>
<a href="#l2.55"></a><span id="l2.55">    * @param  aNotifyFlags   A bitwise-or of abListenerNotifyFlagValue items</span>
<a href="#l2.56"></a><span id="l2.56">    *                        specifying which notifications to receive. See</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbContentHandler.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbContentHandler.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -7,17 +7,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> #include &quot;nsNullPrincipal.h&quot;</span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;plstr.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l3.14"></a><span id="l3.14"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l3.15"></a><span id="l3.15"> #include &quot;nsIMsgVCardService.h&quot;</span>
<a href="#l3.16"></a><span id="l3.16"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l3.17"></a><span id="l3.17"> #include &quot;nsIAbManager.h&quot;</span>
<a href="#l3.18"></a><span id="l3.18"> #include &quot;nsVCard.h&quot;</span>
<a href="#l3.19"></a><span id="l3.19"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l3.20"></a><span id="l3.20"> //</span>
<a href="#l3.21"></a><span id="l3.21"> // nsAbContentHandler</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -62,20 +62,19 @@ nsAbContentHandler::HandleContent(const </span>
<a href="#l3.23"></a><span id="l3.23">             </span>
<a href="#l3.24"></a><span id="l3.24">             // XXX todo, explain why we is escaped twice</span>
<a href="#l3.25"></a><span id="l3.25">             MsgUnescapeString(nsDependentCString(startOfVCard + strlen(&quot;add?vcard=&quot;)), </span>
<a href="#l3.26"></a><span id="l3.26">                                                  0, unescapedData);</span>
<a href="#l3.27"></a><span id="l3.27"> </span>
<a href="#l3.28"></a><span id="l3.28">             if (!aWindowContext)</span>
<a href="#l3.29"></a><span id="l3.29">                 return NS_ERROR_FAILURE;</span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-            nsCOMPtr&lt;nsIDOMWindow&gt; domWindow = do_GetInterface(aWindowContext);</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-            nsCOMPtr&lt;nsPIDOMWindow&gt; parentWindow = do_QueryInterface(domWindow);</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-            if (!parentWindow)</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-                return NS_ERROR_FAILURE;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+            nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow = do_GetInterface(aWindowContext);</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+            NS_ENSURE_TRUE(domWindow, NS_ERROR_FAILURE);</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+            nsCOMPtr&lt;nsPIDOMWindowOuter&gt; parentWindow = nsPIDOMWindowOuter::From(domWindow);</span>
<a href="#l3.38"></a><span id="l3.38">             parentWindow = parentWindow-&gt;GetOuterWindow();</span>
<a href="#l3.39"></a><span id="l3.39">             NS_ENSURE_ARG_POINTER(parentWindow);</span>
<a href="#l3.40"></a><span id="l3.40"> </span>
<a href="#l3.41"></a><span id="l3.41">             nsCOMPtr&lt;nsIAbManager&gt; ab =</span>
<a href="#l3.42"></a><span id="l3.42">               do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l3.43"></a><span id="l3.43">             NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.44"></a><span id="l3.44"> </span>
<a href="#l3.45"></a><span id="l3.45">             nsCOMPtr &lt;nsIAbCard&gt; cardFromVCard;</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineat">@@ -85,17 +84,17 @@ nsAbContentHandler::HandleContent(const </span>
<a href="#l3.47"></a><span id="l3.47"> </span>
<a href="#l3.48"></a><span id="l3.48">             nsCOMPtr&lt;nsISupportsInterfacePointer&gt; ifptr =</span>
<a href="#l3.49"></a><span id="l3.49">                 do_CreateInstance(NS_SUPPORTS_INTERFACE_POINTER_CONTRACTID, &amp;rv);</span>
<a href="#l3.50"></a><span id="l3.50">             NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.51"></a><span id="l3.51"> </span>
<a href="#l3.52"></a><span id="l3.52">             ifptr-&gt;SetData(cardFromVCard);</span>
<a href="#l3.53"></a><span id="l3.53">             ifptr-&gt;SetDataIID(&amp;NS_GET_IID(nsIAbCard));</span>
<a href="#l3.54"></a><span id="l3.54"> </span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-            nsCOMPtr&lt;nsIDOMWindow&gt; dialogWindow;</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+            nsCOMPtr&lt;nsPIDOMWindowOuter&gt; dialogWindow;</span>
<a href="#l3.57"></a><span id="l3.57"> </span>
<a href="#l3.58"></a><span id="l3.58">             rv = parentWindow-&gt;OpenDialog(</span>
<a href="#l3.59"></a><span id="l3.59">                 NS_LITERAL_STRING(&quot;chrome://messenger/content/addressbook/abNewCardDialog.xul&quot;),</span>
<a href="#l3.60"></a><span id="l3.60">                 EmptyString(),</span>
<a href="#l3.61"></a><span id="l3.61">                 NS_LITERAL_STRING(&quot;chrome,resizable=no,titlebar,modal,centerscreen&quot;),</span>
<a href="#l3.62"></a><span id="l3.62">                 ifptr, getter_AddRefs(dialogWindow));</span>
<a href="#l3.63"></a><span id="l3.63">             NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.64"></a><span id="l3.64">         }</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineat">@@ -161,23 +160,23 @@ nsAbContentHandler::OnStreamComplete(nsI</span>
<a href="#l3.66"></a><span id="l3.66">         do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l3.67"></a><span id="l3.67">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.68"></a><span id="l3.68"> </span>
<a href="#l3.69"></a><span id="l3.69">       nsCOMPtr &lt;nsIAbCard&gt; cardFromVCard;</span>
<a href="#l3.70"></a><span id="l3.70">       rv = ab-&gt;EscapedVCardToAbCard(vCard.get(),</span>
<a href="#l3.71"></a><span id="l3.71">                                     getter_AddRefs(cardFromVCard));</span>
<a href="#l3.72"></a><span id="l3.72">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.73"></a><span id="l3.73"> </span>
<a href="#l3.74"></a><span id="l3.74" class="difflineminus">-      nsCOMPtr&lt;nsIDOMWindow&gt; domWindow = do_GetInterface(aContext);</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineminus">-      nsCOMPtr&lt;nsPIDOMWindow&gt; parentWindow = do_QueryInterface(domWindow);</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineminus">-      NS_ENSURE_TRUE(parentWindow, NS_ERROR_FAILURE);</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+      nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow = do_GetInterface(aContext);</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+      NS_ENSURE_TRUE(domWindow, NS_ERROR_FAILURE);</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+      nsCOMPtr&lt;nsPIDOMWindowOuter&gt; parentWindow = nsPIDOMWindowOuter::From(domWindow);</span>
<a href="#l3.80"></a><span id="l3.80">       parentWindow = parentWindow-&gt;GetOuterWindow();</span>
<a href="#l3.81"></a><span id="l3.81">       NS_ENSURE_ARG_POINTER(parentWindow);</span>
<a href="#l3.82"></a><span id="l3.82"> </span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-      nsCOMPtr&lt;nsIDOMWindow&gt; dialogWindow;</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+      nsCOMPtr&lt;nsPIDOMWindowOuter&gt; dialogWindow;</span>
<a href="#l3.85"></a><span id="l3.85">       rv = parentWindow-&gt;OpenDialog(</span>
<a href="#l3.86"></a><span id="l3.86">            NS_LITERAL_STRING(&quot;chrome://messenger/content/addressbook/abNewCardDialog.xul&quot;),</span>
<a href="#l3.87"></a><span id="l3.87">            EmptyString(),</span>
<a href="#l3.88"></a><span id="l3.88">            NS_LITERAL_STRING(&quot;chrome,resizable=no,titlebar,modal,centerscreen&quot;),</span>
<a href="#l3.89"></a><span id="l3.89">            cardFromVCard, getter_AddRefs(dialogWindow));</span>
<a href="#l3.90"></a><span id="l3.90">     }</span>
<a href="#l3.91"></a><span id="l3.91">   }</span>
<a href="#l3.92"></a><span id="l3.92"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l4.5"></a><span id="l4.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.6"></a><span id="l4.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.7"></a><span id="l4.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9"> #include &quot;nsAbLDAPListenerBase.h&quot;</span>
<a href="#l4.10"></a><span id="l4.10"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l4.11"></a><span id="l4.11"> #include &quot;nsIWindowMediator.h&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l4.14"></a><span id="l4.14"> #include &quot;nsIAuthPrompt.h&quot;</span>
<a href="#l4.15"></a><span id="l4.15"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l4.16"></a><span id="l4.16"> #include &quot;nsILDAPMessage.h&quot;</span>
<a href="#l4.17"></a><span id="l4.17"> #include &quot;nsILDAPErrors.h&quot;</span>
<a href="#l4.18"></a><span id="l4.18"> #include &quot;nsILoginManager.h&quot;</span>
<a href="#l4.19"></a><span id="l4.19"> #include &quot;nsILoginInfo.h&quot;</span>
<a href="#l4.20"></a><span id="l4.20"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l4.21"></a><span id="l4.21"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -156,19 +156,19 @@ NS_IMETHODIMP nsAbLDAPListenerBase::OnLD</span>
<a href="#l4.23"></a><span id="l4.23">                &quot; couldn't get window mediator service.&quot;);</span>
<a href="#l4.24"></a><span id="l4.24">       InitFailed();</span>
<a href="#l4.25"></a><span id="l4.25">       return rv;</span>
<a href="#l4.26"></a><span id="l4.26">     }</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">     // get the addressbook window, as it will be used to parent the auth</span>
<a href="#l4.29"></a><span id="l4.29">     // prompter dialog</span>
<a href="#l4.30"></a><span id="l4.30">     //</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    nsCOMPtr&lt;nsIDOMWindow&gt; window;</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+    nsCOMPtr&lt;mozIDOMWindowProxy&gt; window;</span>
<a href="#l4.33"></a><span id="l4.33">     rv = windowMediator-&gt;GetMostRecentWindow(nullptr,</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-                                               getter_AddRefs(window));</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+                                             getter_AddRefs(window));</span>
<a href="#l4.36"></a><span id="l4.36">     if (NS_FAILED(rv))</span>
<a href="#l4.37"></a><span id="l4.37">     {</span>
<a href="#l4.38"></a><span id="l4.38">       NS_ERROR(&quot;nsAbLDAPListenerBase::OnLDAPInit():&quot;</span>
<a href="#l4.39"></a><span id="l4.39">                &quot; error getting most recent window&quot;);</span>
<a href="#l4.40"></a><span id="l4.40">       InitFailed();</span>
<a href="#l4.41"></a><span id="l4.41">       return rv;</span>
<a href="#l4.42"></a><span id="l4.42">     }</span>
<a href="#l4.43"></a><span id="l4.43"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -11,17 +11,17 @@</span>
<a href="#l5.4"></a><span id="l5.4"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l5.5"></a><span id="l5.5"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l5.6"></a><span id="l5.6"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l5.7"></a><span id="l5.7"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l5.8"></a><span id="l5.8"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l5.9"></a><span id="l5.9"> #include &quot;plstr.h&quot;</span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;prmem.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l5.14"></a><span id="l5.14"> #include &quot;nsIFilePicker.h&quot;</span>
<a href="#l5.15"></a><span id="l5.15"> #include &quot;plbase64.h&quot;</span>
<a href="#l5.16"></a><span id="l5.16"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l5.17"></a><span id="l5.17"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l5.18"></a><span id="l5.18"> #include &quot;nsVCard.h&quot;</span>
<a href="#l5.19"></a><span id="l5.19"> #include &quot;nsVCardObj.h&quot;</span>
<a href="#l5.20"></a><span id="l5.20"> #include &quot;nsIAbLDAPAttributeMap.h&quot;</span>
<a href="#l5.21"></a><span id="l5.21"> #include &quot;nsICommandLine.h&quot;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -525,17 +525,17 @@ enum ADDRESSBOOK_EXPORT_FILE_TYPE</span>
<a href="#l5.23"></a><span id="l5.23">  CSV_EXPORT_TYPE      = 0,</span>
<a href="#l5.24"></a><span id="l5.24">  CSV_EXPORT_TYPE_UTF8 = 1,</span>
<a href="#l5.25"></a><span id="l5.25">  TAB_EXPORT_TYPE      = 2,</span>
<a href="#l5.26"></a><span id="l5.26">  TAB_EXPORT_TYPE_UTF8 = 3,</span>
<a href="#l5.27"></a><span id="l5.27">  VCF_EXPORT_TYPE      = 4,</span>
<a href="#l5.28"></a><span id="l5.28">  LDIF_EXPORT_TYPE     = 5,</span>
<a href="#l5.29"></a><span id="l5.29"> };</span>
<a href="#l5.30"></a><span id="l5.30"> </span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-NS_IMETHODIMP nsAbManager::ExportAddressBook(nsIDOMWindow *aParentWin, nsIAbDirectory *aDirectory)</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+NS_IMETHODIMP nsAbManager::ExportAddressBook(mozIDOMWindowProxy *aParentWin, nsIAbDirectory *aDirectory)</span>
<a href="#l5.33"></a><span id="l5.33"> {</span>
<a href="#l5.34"></a><span id="l5.34">   NS_ENSURE_ARG_POINTER(aParentWin);</span>
<a href="#l5.35"></a><span id="l5.35"> </span>
<a href="#l5.36"></a><span id="l5.36">   nsresult rv;</span>
<a href="#l5.37"></a><span id="l5.37">   nsCOMPtr&lt;nsIFilePicker&gt; filePicker = do_CreateInstance(&quot;@mozilla.org/filepicker;1&quot;, &amp;rv);</span>
<a href="#l5.38"></a><span id="l5.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.39"></a><span id="l5.39"> </span>
<a href="#l5.40"></a><span id="l5.40">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineat">@@ -1379,19 +1379,22 @@ nsAbManager::Handle(nsICommandLine* aCmd</span>
<a href="#l5.42"></a><span id="l5.42">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.43"></a><span id="l5.43"> </span>
<a href="#l5.44"></a><span id="l5.44">   if (!found)</span>
<a href="#l5.45"></a><span id="l5.45">     return NS_OK;</span>
<a href="#l5.46"></a><span id="l5.46"> </span>
<a href="#l5.47"></a><span id="l5.47">   nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch (do_GetService(NS_WINDOWWATCHER_CONTRACTID));</span>
<a href="#l5.48"></a><span id="l5.48">   NS_ENSURE_TRUE(wwatch, NS_ERROR_FAILURE);</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; opened;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-  wwatch-&gt;OpenWindow(nullptr, &quot;chrome://messenger/content/addressbook/addressbook.xul&quot;,</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-                     &quot;_blank&quot;, &quot;chrome,extrachrome,menubar,resizable,scrollbars,status,toolbar&quot;, nullptr, getter_AddRefs(opened));</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; opened;</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+  wwatch-&gt;OpenWindow(nullptr,</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+                     &quot;chrome://messenger/content/addressbook/addressbook.xul&quot;,</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+                     &quot;_blank&quot;,</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+                     &quot;chrome,extrachrome,menubar,resizable,scrollbars,status,toolbar&quot;,</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+                     nullptr, getter_AddRefs(opened));</span>
<a href="#l5.59"></a><span id="l5.59">   aCmdLine-&gt;SetPreventDefault(true);</span>
<a href="#l5.60"></a><span id="l5.60">   return NS_OK;</span>
<a href="#l5.61"></a><span id="l5.61"> }</span>
<a href="#l5.62"></a><span id="l5.62"> </span>
<a href="#l5.63"></a><span id="l5.63"> NS_IMETHODIMP</span>
<a href="#l5.64"></a><span id="l5.64"> nsAbManager::GetHelpInfo(nsACString&amp; aResult)</span>
<a href="#l5.65"></a><span id="l5.65"> {</span>
<a href="#l5.66"></a><span id="l5.66">   aResult.Assign(NS_LITERAL_CSTRING(&quot;  -addressbook       Open the address book at startup.\n&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/public/nsIMapiRegistry.idl</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/public/nsIMapiRegistry.idl</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,24 +1,24 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.5"></a><span id="l6.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.6"></a><span id="l6.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-interface nsIDOMWindow;</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+interface mozIDOMWindowProxy;</span>
<a href="#l6.12"></a><span id="l6.12"> </span>
<a href="#l6.13"></a><span id="l6.13"> /**</span>
<a href="#l6.14"></a><span id="l6.14">  * This interface provides support for registering Mozilla as the default</span>
<a href="#l6.15"></a><span id="l6.15">  * Mail Client. This interface can also be used to get/set the user preference</span>
<a href="#l6.16"></a><span id="l6.16">  * for the default Mail Client.</span>
<a href="#l6.17"></a><span id="l6.17">  * </span>
<a href="#l6.18"></a><span id="l6.18">  */</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-[scriptable, uuid(B0342CA7-CB85-4d13-AD18-BD431F2086EA)]</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+[scriptable, uuid(47D707C3-4369-46A6-A053-5118E12579D6)]</span>
<a href="#l6.22"></a><span id="l6.22"> interface nsIMapiRegistry: nsISupports {</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24">    /** This is set to TRUE if Mozilla is the default mail application</span>
<a href="#l6.25"></a><span id="l6.25">     */</span>
<a href="#l6.26"></a><span id="l6.26">    attribute boolean isDefaultMailClient;</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28">    /* Set to TRUE if Mozilla is the default news application */</span>
<a href="#l6.29"></a><span id="l6.29">    attribute boolean isDefaultNewsClient;</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineat">@@ -29,17 +29,17 @@ interface nsIMapiRegistry: nsISupports {</span>
<a href="#l6.31"></a><span id="l6.31">    /** This is set TRUE only once per session.</span>
<a href="#l6.32"></a><span id="l6.32">     */</span>
<a href="#l6.33"></a><span id="l6.33">    readonly attribute boolean showDialog;</span>
<a href="#l6.34"></a><span id="l6.34"> </span>
<a href="#l6.35"></a><span id="l6.35">    /** This will bring the dialog asking the user if he/she wants to set</span>
<a href="#l6.36"></a><span id="l6.36">     * Mozilla as default Mail Client.</span>
<a href="#l6.37"></a><span id="l6.37">     * Call this only if Mozilla is not the default Mail client</span>
<a href="#l6.38"></a><span id="l6.38">     */</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-   void showMailIntegrationDialog(in nsIDOMWindow parentWindow);</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+   void showMailIntegrationDialog(in mozIDOMWindowProxy parentWindow);</span>
<a href="#l6.41"></a><span id="l6.41"> </span>
<a href="#l6.42"></a><span id="l6.42">    /* After being installed, when we first launch, make sure we add the correct</span>
<a href="#l6.43"></a><span id="l6.43">     OS registry entries to make us show up as regsitered mail and news client</span>
<a href="#l6.44"></a><span id="l6.44">     in the OS</span>
<a href="#l6.45"></a><span id="l6.45">    */</span>
<a href="#l6.46"></a><span id="l6.46">    </span>
<a href="#l6.47"></a><span id="l6.47">    void registerMailAndNewsClient();</span>
<a href="#l6.48"></a><span id="l6.48"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/public/nsIMessenger.idl</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/public/nsIMessenger.idl</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -5,42 +5,43 @@</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l7.6"></a><span id="l7.6"> #include &quot;nsrootidl.idl&quot;</span>
<a href="#l7.7"></a><span id="l7.7"> #include &quot;nsIMsgWindow.idl&quot;</span>
<a href="#l7.8"></a><span id="l7.8"> #include &quot;nsIMsgIdentity.idl&quot;</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10"> interface nsIMsgDBHdr;</span>
<a href="#l7.11"></a><span id="l7.11"> interface nsIDOMWindow;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+interface mozIDOMWindowProxy;</span>
<a href="#l7.13"></a><span id="l7.13"> interface nsITransactionManager;</span>
<a href="#l7.14"></a><span id="l7.14"> interface nsIMsgMessageService;</span>
<a href="#l7.15"></a><span id="l7.15"> interface nsIFile;</span>
<a href="#l7.16"></a><span id="l7.16"> interface nsIUrlListener;</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-[scriptable, uuid(4e36968b-b476-4f3e-b170-c19fe3d48d0b)]</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+[scriptable, uuid(01b967c8-b289-4e32-ad46-6eb7c89d4106)]</span>
<a href="#l7.20"></a><span id="l7.20"> interface nsIMessenger : nsISupports {</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22">     const long eUnknown = 0;</span>
<a href="#l7.23"></a><span id="l7.23">     const long eDeleteMsg = 1;</span>
<a href="#l7.24"></a><span id="l7.24">     const long eMoveMsg = 2;</span>
<a href="#l7.25"></a><span id="l7.25">     const long eCopyMsg = 3;</span>
<a href="#l7.26"></a><span id="l7.26">     const long eMarkAllMsg = 4;</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28">     void setDisplayCharset(in ACString aCharset);</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30">     readonly attribute nsITransactionManager transactionManager;</span>
<a href="#l7.31"></a><span id="l7.31"> </span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-    void setWindow(in nsIDOMWindow ptr, in nsIMsgWindow msgWindow);</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+    void setWindow(in mozIDOMWindowProxy ptr, in nsIMsgWindow msgWindow);</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35">     void addMsgUrlToNavigateHistory(in ACString aURL);</span>
<a href="#l7.36"></a><span id="l7.36">     void openURL(in ACString aURL);</span>
<a href="#l7.37"></a><span id="l7.37"> </span>
<a href="#l7.38"></a><span id="l7.38">     /** load a custom message by url, e.g load a attachment as a email</span>
<a href="#l7.39"></a><span id="l7.39">       */</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-    void loadURL(in nsIDOMWindow ptr, in ACString aURL); </span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+    void loadURL(in mozIDOMWindowProxy ptr, in ACString aURL);</span>
<a href="#l7.42"></a><span id="l7.42"> </span>
<a href="#l7.43"></a><span id="l7.43">     void launchExternalURL(in ACString aURL);</span>
<a href="#l7.44"></a><span id="l7.44"> </span>
<a href="#l7.45"></a><span id="l7.45">     boolean canUndo();</span>
<a href="#l7.46"></a><span id="l7.46">     boolean canRedo();</span>
<a href="#l7.47"></a><span id="l7.47">     unsigned long getUndoTransactionType();</span>
<a href="#l7.48"></a><span id="l7.48">     unsigned long getRedoTransactionType();</span>
<a href="#l7.49"></a><span id="l7.49">     void undo(in nsIMsgWindow msgWindow);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgPrintEngine.idl</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgPrintEngine.idl</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,36 +1,36 @@</span>
<a href="#l8.4"></a><span id="l8.4"> /* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l8.5"></a><span id="l8.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.6"></a><span id="l8.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.7"></a><span id="l8.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> #include &quot;nsrootidl.idl&quot;</span>
<a href="#l8.10"></a><span id="l8.10"> #include &quot;nsIMsgStatusFeedback.idl&quot;</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-interface nsIDOMWindow;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+interface mozIDOMWindowProxy;</span>
<a href="#l8.14"></a><span id="l8.14"> interface nsIPrintSettings;</span>
<a href="#l8.15"></a><span id="l8.15"> interface nsIObserver;</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-[scriptable, uuid(e5f5e4a2-9d74-46b3-ade7-25e1a1ddf54e)]</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+[scriptable, uuid(9bdd0812-dd48-4f04-87a9-74dcfc3abadc)]</span>
<a href="#l8.19"></a><span id="l8.19"> interface nsIMsgPrintEngine : nsISupports {</span>
<a href="#l8.20"></a><span id="l8.20">     /**</span>
<a href="#l8.21"></a><span id="l8.21">      * Print/PrintPreview Msg Type</span>
<a href="#l8.22"></a><span id="l8.22">      */</span>
<a href="#l8.23"></a><span id="l8.23">     const short MNAB_START                 = 0;</span>
<a href="#l8.24"></a><span id="l8.24">     const short MNAB_PRINT_MSG             = 0;</span>
<a href="#l8.25"></a><span id="l8.25">     const short MNAB_PRINTPREVIEW_MSG      = 1;</span>
<a href="#l8.26"></a><span id="l8.26">     const short MNAB_PRINT_AB_CARD         = 2;</span>
<a href="#l8.27"></a><span id="l8.27">     const short MNAB_PRINTPREVIEW_AB_CARD  = 3;</span>
<a href="#l8.28"></a><span id="l8.28">     const short MNAB_PRINT_ADDRBOOK        = 4;</span>
<a href="#l8.29"></a><span id="l8.29">     const short MNAB_PRINTPREVIEW_ADDRBOOK = 5;</span>
<a href="#l8.30"></a><span id="l8.30">     const short MNAB_END                   = 6;</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-    void setWindow(in nsIDOMWindow ptr);</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-    void setParentWindow(in nsIDOMWindow ptr);</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+    void setWindow(in mozIDOMWindowProxy ptr);</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+    void setParentWindow(in mozIDOMWindowProxy ptr);</span>
<a href="#l8.36"></a><span id="l8.36">     void showWindow(in boolean aShow);</span>
<a href="#l8.37"></a><span id="l8.37">     void setStatusFeedback(in nsIMsgStatusFeedback feedback);</span>
<a href="#l8.38"></a><span id="l8.38">     void setPrintURICount(in int32_t aCount);</span>
<a href="#l8.39"></a><span id="l8.39">     void addPrintURI(in wstring aURI);</span>
<a href="#l8.40"></a><span id="l8.40">     void startPrintOperation(in nsIPrintSettings aPS);</span>
<a href="#l8.41"></a><span id="l8.41">     void setStartupPPObserver(in nsIObserver startupPPObs);</span>
<a href="#l8.42"></a><span id="l8.42">     void setMsgType(in long aMsgType);</span>
<a href="#l8.43"></a><span id="l8.43"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgProgress.idl</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgProgress.idl</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -2,28 +2,28 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.5"></a><span id="l9.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.6"></a><span id="l9.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.7"></a><span id="l9.7"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l9.8"></a><span id="l9.8"> #include &quot;domstubs.idl&quot;</span>
<a href="#l9.9"></a><span id="l9.9"> #include &quot;nsIPrompt.idl&quot;</span>
<a href="#l9.10"></a><span id="l9.10"> #include &quot;nsIWebProgressListener.idl&quot;</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-interface nsIDOMWindow;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+interface mozIDOMWindowProxy;</span>
<a href="#l9.14"></a><span id="l9.14"> interface nsIMsgWindow;</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-[scriptable, uuid(5aae7f1b-95f1-422e-86d5-2b1d599e2ccf)]</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+[scriptable, uuid(6d6fe91d-7f9a-4552-9737-9f74b0e75538)]</span>
<a href="#l9.18"></a><span id="l9.18"> interface nsIMsgProgress: nsIWebProgressListener {</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20">   /** </span>
<a href="#l9.21"></a><span id="l9.21">    * Open the progress dialog, you can specify parameters through an xpcom object</span>
<a href="#l9.22"></a><span id="l9.22">    */</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-  void openProgressDialog(in nsIDOMWindow parent, </span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-                          in nsIMsgWindow aMsgWindow, </span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-                          in string dialogURL, </span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  void openProgressDialog(in mozIDOMWindowProxy parent,</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+                          in nsIMsgWindow aMsgWindow,</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+                          in string dialogURL,</span>
<a href="#l9.29"></a><span id="l9.29">                           in boolean inDisplayModal,</span>
<a href="#l9.30"></a><span id="l9.30">                           in nsISupports parameters);</span>
<a href="#l9.31"></a><span id="l9.31"> </span>
<a href="#l9.32"></a><span id="l9.32">   /* Close the progress dialog */</span>
<a href="#l9.33"></a><span id="l9.33">   void closeProgressDialog(in boolean forceClose);</span>
<a href="#l9.34"></a><span id="l9.34">   </span>
<a href="#l9.35"></a><span id="l9.35">   /* Register a Web Progress Listener */</span>
<a href="#l9.36"></a><span id="l9.36">   void registerListener(in nsIWebProgressListener listener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgWindow.idl</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgWindow.idl</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -4,30 +4,30 @@</span>
<a href="#l10.4"></a><span id="l10.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> interface nsIMsgStatusFeedback;</span>
<a href="#l10.9"></a><span id="l10.9"> interface nsIMsgFolder;</span>
<a href="#l10.10"></a><span id="l10.10"> interface nsITransactionManager;</span>
<a href="#l10.11"></a><span id="l10.11"> interface nsIDocShell;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-interface nsIDOMWindow;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+interface mozIDOMWindowProxy;</span>
<a href="#l10.14"></a><span id="l10.14"> interface nsIMsgHeaderSink;</span>
<a href="#l10.15"></a><span id="l10.15"> interface nsIPrompt;</span>
<a href="#l10.16"></a><span id="l10.16"> interface nsIInterfaceRequestor;</span>
<a href="#l10.17"></a><span id="l10.17"> interface nsIAuthPrompt;</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19"> [scriptable, uuid(7B8F4A65-CFC4-4b3f-BF5C-152AA8D5CD10)]</span>
<a href="#l10.20"></a><span id="l10.20"> interface nsIMsgWindowCommands : nsISupports {</span>
<a href="#l10.21"></a><span id="l10.21">   void selectFolder(in ACString folderUri);</span>
<a href="#l10.22"></a><span id="l10.22">   void selectMessage(in ACString messageUri);</span>
<a href="#l10.23"></a><span id="l10.23">   void clearMsgPane();</span>
<a href="#l10.24"></a><span id="l10.24"> };</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">-[scriptable, uuid(8ad06f07-2230-4917-968c-2269588dbf7d)]</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+[scriptable, uuid(a846fe48-4022-4296-a1c4-1dcd7eaecfe5)]</span>
<a href="#l10.28"></a><span id="l10.28"> interface nsIMsgWindow : nsISupports {</span>
<a href="#l10.29"></a><span id="l10.29">   attribute nsIMsgStatusFeedback statusFeedback;</span>
<a href="#l10.30"></a><span id="l10.30">   attribute nsIMsgWindowCommands windowCommands;</span>
<a href="#l10.31"></a><span id="l10.31">   attribute nsIMsgHeaderSink msgHeaderSink;</span>
<a href="#l10.32"></a><span id="l10.32">   attribute nsITransactionManager transactionManager;</span>
<a href="#l10.33"></a><span id="l10.33">   attribute nsIMsgFolder openFolder;</span>
<a href="#l10.34"></a><span id="l10.34">   </span>
<a href="#l10.35"></a><span id="l10.35">   /**</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineat">@@ -69,17 +69,17 @@ interface nsIMsgWindow : nsISupports {</span>
<a href="#l10.37"></a><span id="l10.37"> </span>
<a href="#l10.38"></a><span id="l10.38">   /**</span>
<a href="#l10.39"></a><span id="l10.39">     Has a running url been stopped? If you care about checking</span>
<a href="#l10.40"></a><span id="l10.40">     this flag, you need to clear it before you start your operation since</span>
<a href="#l10.41"></a><span id="l10.41">     there's no convenient place to clear it.</span>
<a href="#l10.42"></a><span id="l10.42">   */</span>
<a href="#l10.43"></a><span id="l10.43">   attribute boolean stopped;</span>
<a href="#l10.44"></a><span id="l10.44"> </span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-  attribute nsIDOMWindow domWindow;</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+  attribute mozIDOMWindowProxy domWindow;</span>
<a href="#l10.47"></a><span id="l10.47"> </span>
<a href="#l10.48"></a><span id="l10.48">   void StopUrls();</span>
<a href="#l10.49"></a><span id="l10.49"> </span>
<a href="#l10.50"></a><span id="l10.50">   /**</span>
<a href="#l10.51"></a><span id="l10.51">     when the msg window is being unloaded from the content window,</span>
<a href="#l10.52"></a><span id="l10.52">     we can use this notification to force a flush on anything the</span>
<a href="#l10.53"></a><span id="l10.53">     msg window hangs on too. For some reason xpconnect is still hanging</span>
<a href="#l10.54"></a><span id="l10.54">     onto the msg window even though all of our objects have let go of it</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -221,34 +221,34 @@ nsMessenger::nsMessenger()</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5"> nsMessenger::~nsMessenger()</span>
<a href="#l11.6"></a><span id="l11.6"> {</span>
<a href="#l11.7"></a><span id="l11.7"> }</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10"> NS_IMPL_ISUPPORTS(nsMessenger, nsIMessenger, nsISupportsWeakReference, nsIFolderListener)</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-NS_IMETHODIMP nsMessenger::SetWindow(nsIDOMWindow *aWin, nsIMsgWindow *aMsgWindow)</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+NS_IMETHODIMP nsMessenger::SetWindow(mozIDOMWindowProxy *aWin, nsIMsgWindow *aMsgWindow)</span>
<a href="#l11.14"></a><span id="l11.14"> {</span>
<a href="#l11.15"></a><span id="l11.15">   nsresult rv;</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">   nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession =</span>
<a href="#l11.18"></a><span id="l11.18">     do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l11.19"></a><span id="l11.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21">   if (aWin)</span>
<a href="#l11.22"></a><span id="l11.22">   {</span>
<a href="#l11.23"></a><span id="l11.23">     mMsgWindow = aMsgWindow;</span>
<a href="#l11.24"></a><span id="l11.24">     mWindow = aWin;</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26">     rv = mailSession-&gt;AddFolderListener(this, nsIFolderListener::removed);</span>
<a href="#l11.27"></a><span id="l11.27">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.28"></a><span id="l11.28"> </span>
<a href="#l11.29"></a><span id="l11.29" class="difflineminus">-    nsCOMPtr&lt;nsPIDOMWindow&gt; win( do_QueryInterface(aWin) );</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-    NS_ENSURE_TRUE(win, NS_ERROR_FAILURE);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+    NS_ENSURE_TRUE(aWin, NS_ERROR_FAILURE);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+    nsCOMPtr&lt;nsPIDOMWindowOuter&gt; win = nsPIDOMWindowOuter::From(aWin);</span>
<a href="#l11.33"></a><span id="l11.33"> </span>
<a href="#l11.34"></a><span id="l11.34">     nsIDocShell *docShell = win-&gt;GetDocShell();</span>
<a href="#l11.35"></a><span id="l11.35">     nsCOMPtr&lt;nsIDocShellTreeItem&gt; docShellAsItem(do_QueryInterface(docShell));</span>
<a href="#l11.36"></a><span id="l11.36">     NS_ENSURE_TRUE(docShellAsItem, NS_ERROR_FAILURE);</span>
<a href="#l11.37"></a><span id="l11.37"> </span>
<a href="#l11.38"></a><span id="l11.38">     nsCOMPtr&lt;nsIDocShellTreeItem&gt; rootDocShellAsItem;</span>
<a href="#l11.39"></a><span id="l11.39">     docShellAsItem-&gt;GetSameTypeRootTreeItem(getter_AddRefs(rootDocShellAsItem));</span>
<a href="#l11.40"></a><span id="l11.40"> </span>
<a href="#l11.41"></a><span id="l11.41" class="difflineat">@@ -465,17 +465,17 @@ NS_IMETHODIMP nsMessenger::LaunchExterna</span>
<a href="#l11.42"></a><span id="l11.42">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.43"></a><span id="l11.43"> </span>
<a href="#l11.44"></a><span id="l11.44">   nsCOMPtr&lt;nsIExternalProtocolService&gt; extProtService = do_GetService(NS_EXTERNALPROTOCOLSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l11.45"></a><span id="l11.45">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l11.46"></a><span id="l11.46">   return extProtService-&gt;LoadUrl(uri);</span>
<a href="#l11.47"></a><span id="l11.47"> }</span>
<a href="#l11.48"></a><span id="l11.48"> </span>
<a href="#l11.49"></a><span id="l11.49"> NS_IMETHODIMP</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-nsMessenger::LoadURL(nsIDOMWindow *aWin, const nsACString&amp; aURL)</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+nsMessenger::LoadURL(mozIDOMWindowProxy *aWin, const nsACString&amp; aURL)</span>
<a href="#l11.52"></a><span id="l11.52"> {</span>
<a href="#l11.53"></a><span id="l11.53">   nsresult rv;</span>
<a href="#l11.54"></a><span id="l11.54"> </span>
<a href="#l11.55"></a><span id="l11.55">   SetDisplayCharset(NS_LITERAL_CSTRING(&quot;UTF-8&quot;));</span>
<a href="#l11.56"></a><span id="l11.56"> </span>
<a href="#l11.57"></a><span id="l11.57">   NS_ConvertASCIItoUTF16 uriString(aURL);</span>
<a href="#l11.58"></a><span id="l11.58">   // Cleanup the empty spaces that might be on each end.</span>
<a href="#l11.59"></a><span id="l11.59">   uriString.Trim(&quot; &quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.h</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.h</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -10,17 +10,17 @@</span>
<a href="#l12.4"></a><span id="l12.4"> #include &quot;nsIMessenger.h&quot;</span>
<a href="#l12.5"></a><span id="l12.5"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l12.6"></a><span id="l12.6"> #include &quot;nsITransactionManager.h&quot;</span>
<a href="#l12.7"></a><span id="l12.7"> #include &quot;nsIFile.h&quot;</span>
<a href="#l12.8"></a><span id="l12.8"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l12.9"></a><span id="l12.9"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l12.10"></a><span id="l12.10"> #include &quot;nsIFile.h&quot;</span>
<a href="#l12.11"></a><span id="l12.11"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l12.14"></a><span id="l12.14"> #include &quot;nsTArray.h&quot;</span>
<a href="#l12.15"></a><span id="l12.15"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17"> class nsMessenger : public nsIMessenger, public nsSupportsWeakReference, public nsIFolderListener</span>
<a href="#l12.18"></a><span id="l12.18"> {</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20"> public:</span>
<a href="#l12.21"></a><span id="l12.21">   nsMessenger();</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -72,19 +72,19 @@ private:</span>
<a href="#l12.23"></a><span id="l12.23">                          nsIFile **aSaveAsFile);</span>
<a href="#l12.24"></a><span id="l12.24"> </span>
<a href="#l12.25"></a><span id="l12.25">   nsresult GetSaveToDir(nsIFile **aSaveToDir);</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27">   nsString mId;</span>
<a href="#l12.28"></a><span id="l12.28">   nsCOMPtr&lt;nsITransactionManager&gt; mTxnMgr;</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30">   /* rhp - need this to drive message display */</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt;    mWindow;</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-  nsCOMPtr&lt;nsIMsgWindow&gt;    mMsgWindow;</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-  nsCOMPtr&lt;nsIDocShell&gt;     mDocShell;</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; mWindow;</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+  nsCOMPtr&lt;nsIMsgWindow&gt;       mMsgWindow;</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+  nsCOMPtr&lt;nsIDocShell&gt;        mDocShell;</span>
<a href="#l12.37"></a><span id="l12.37"> </span>
<a href="#l12.38"></a><span id="l12.38">   // String bundles...</span>
<a href="#l12.39"></a><span id="l12.39">   nsCOMPtr&lt;nsIStringBundle&gt;   mStringBundle;</span>
<a href="#l12.40"></a><span id="l12.40"> </span>
<a href="#l12.41"></a><span id="l12.41">   nsCString mCurrentDisplayCharset;</span>
<a href="#l12.42"></a><span id="l12.42"> </span>
<a href="#l12.43"></a><span id="l12.43">   nsCOMPtr&lt;nsISupports&gt;  mSearchContext;</span>
<a href="#l12.44"></a><span id="l12.44">   nsCString   mLastDisplayURI; // this used when the user attempts to force a charset reload of a message...we need to get the last displayed</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerBootstrap.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerBootstrap.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l13.4"></a><span id="l13.4"> #include &quot;nsMessengerBootstrap.h&quot;</span>
<a href="#l13.5"></a><span id="l13.5"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l13.8"></a><span id="l13.8"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l13.9"></a><span id="l13.9"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l13.10"></a><span id="l13.10"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l13.11"></a><span id="l13.11"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l13.14"></a><span id="l13.14"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l13.15"></a><span id="l13.15"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17"> NS_IMPL_ISUPPORTS(nsMessengerBootstrap, nsIMessengerWindowService)</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19"> nsMessengerBootstrap::nsMessengerBootstrap()</span>
<a href="#l13.20"></a><span id="l13.20"> {</span>
<a href="#l13.21"></a><span id="l13.21"> }</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -71,13 +71,13 @@ NS_IMETHODIMP nsMessengerBootstrap::Open</span>
<a href="#l13.23"></a><span id="l13.23">     }</span>
<a href="#l13.24"></a><span id="l13.24">   }</span>
<a href="#l13.25"></a><span id="l13.25">   </span>
<a href="#l13.26"></a><span id="l13.26">   nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch(do_GetService(NS_WINDOWWATCHER_CONTRACTID, &amp;rv));</span>
<a href="#l13.27"></a><span id="l13.27">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.28"></a><span id="l13.28"> </span>
<a href="#l13.29"></a><span id="l13.29">   // we need to use the &quot;mailnews.reuse_thread_window2&quot; pref</span>
<a href="#l13.30"></a><span id="l13.30">   // to determine if we should open a new window, or use an existing one.</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; newWindow;</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; newWindow;</span>
<a href="#l13.33"></a><span id="l13.33">   return wwatch-&gt;OpenWindow(0, chromeUrl.get(), &quot;_blank&quot;,</span>
<a href="#l13.34"></a><span id="l13.34">                             &quot;chrome,all,dialog=no&quot;, argsArray,</span>
<a href="#l13.35"></a><span id="l13.35">                              getter_AddRefs(newWindow));</span>
<a href="#l13.36"></a><span id="l13.36"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerContentHandler.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerContentHandler.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -69,13 +69,13 @@ NS_IMETHODIMP nsMessengerContentHandler:</span>
<a href="#l14.4"></a><span id="l14.4"> nsresult nsMessengerContentHandler::OpenWindow(nsIURI* aURI)</span>
<a href="#l14.5"></a><span id="l14.5"> {</span>
<a href="#l14.6"></a><span id="l14.6">   NS_ENSURE_ARG_POINTER(aURI);</span>
<a href="#l14.7"></a><span id="l14.7">   </span>
<a href="#l14.8"></a><span id="l14.8">   nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch = do_GetService(&quot;@mozilla.org/embedcomp/window-watcher;1&quot;);</span>
<a href="#l14.9"></a><span id="l14.9">   if (!wwatch)</span>
<a href="#l14.10"></a><span id="l14.10">     return NS_ERROR_FAILURE;</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; newWindow;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; newWindow;</span>
<a href="#l14.14"></a><span id="l14.14">   return wwatch-&gt;OpenWindow(0, &quot;chrome://messenger/content/messageWindow.xul&quot;,</span>
<a href="#l14.15"></a><span id="l14.15">                  &quot;_blank&quot;, &quot;all,chrome,dialog=no,status,toolbar&quot;, aURI,</span>
<a href="#l14.16"></a><span id="l14.16">                  getter_AddRefs(newWindow));</span>
<a href="#l14.17"></a><span id="l14.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -15,17 +15,17 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l15.6"></a><span id="l15.6"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l15.8"></a><span id="l15.8"> #include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l15.9"></a><span id="l15.9"> #include &quot;MailNewsTypes.h&quot;</span>
<a href="#l15.10"></a><span id="l15.10"> #include &quot;nsIWindowMediator.h&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> #include &quot;nsIDOMChromeWindow.h&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l15.14"></a><span id="l15.14"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l15.15"></a><span id="l15.15"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l15.16"></a><span id="l15.16"> #include &quot;nsIBaseWindow.h&quot;</span>
<a href="#l15.17"></a><span id="l15.17"> #include &quot;nsIWidget.h&quot;</span>
<a href="#l15.18"></a><span id="l15.18"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l15.19"></a><span id="l15.19"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l15.20"></a><span id="l15.20"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l15.21"></a><span id="l15.21"> #include &quot;nsIMessengerWindowService.h&quot;</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -103,51 +103,52 @@ static void openMailWindow(const nsCStri</span>
<a href="#l15.23"></a><span id="l15.23">         nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch(do_GetService(NS_WINDOWWATCHER_CONTRACTID, &amp;rv));</span>
<a href="#l15.24"></a><span id="l15.24">         if (NS_FAILED(rv))</span>
<a href="#l15.25"></a><span id="l15.25">           return;</span>
<a href="#l15.26"></a><span id="l15.26"> </span>
<a href="#l15.27"></a><span id="l15.27">         // SeaMonkey only supports message uris, whereas Thunderbird only</span>
<a href="#l15.28"></a><span id="l15.28">         // supports message headers. This should be simplified/removed when</span>
<a href="#l15.29"></a><span id="l15.29">         // bug 507593 is implemented.</span>
<a href="#l15.30"></a><span id="l15.30"> #ifdef MOZ_SUITE</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-        nsCOMPtr&lt;nsIDOMWindow&gt; newWindow;</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+        nsCOMPtr&lt;mozIDOMWindowProxy&gt; newWindow;</span>
<a href="#l15.33"></a><span id="l15.33">         wwatch-&gt;OpenWindow(0, &quot;chrome://messenger/content/messageWindow.xul&quot;,</span>
<a href="#l15.34"></a><span id="l15.34">                            &quot;_blank&quot;, &quot;all,chrome,dialog=no,status,toolbar&quot;, msgUri,</span>
<a href="#l15.35"></a><span id="l15.35">                            getter_AddRefs(newWindow));</span>
<a href="#l15.36"></a><span id="l15.36"> #else</span>
<a href="#l15.37"></a><span id="l15.37">         nsCOMPtr&lt;nsIMessenger&gt; messenger(do_CreateInstance(NS_MESSENGER_CONTRACTID, &amp;rv));</span>
<a href="#l15.38"></a><span id="l15.38">         if (NS_FAILED(rv))</span>
<a href="#l15.39"></a><span id="l15.39">           return;</span>
<a href="#l15.40"></a><span id="l15.40"> </span>
<a href="#l15.41"></a><span id="l15.41">         nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr; </span>
<a href="#l15.42"></a><span id="l15.42">         messenger-&gt;MsgHdrFromURI(aUri, getter_AddRefs(msgHdr));</span>
<a href="#l15.43"></a><span id="l15.43">         if (msgHdr)</span>
<a href="#l15.44"></a><span id="l15.44">         {</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-          nsCOMPtr&lt;nsIDOMWindow&gt; newWindow;</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+          nsCOMPtr&lt;mozIDOMWindowProxy&gt; newWindow;</span>
<a href="#l15.47"></a><span id="l15.47">           wwatch-&gt;OpenWindow(0, &quot;chrome://messenger/content/messageWindow.xul&quot;,</span>
<a href="#l15.48"></a><span id="l15.48">                              &quot;_blank&quot;, &quot;all,chrome,dialog=no,status,toolbar&quot;, msgHdr,</span>
<a href="#l15.49"></a><span id="l15.49">                              getter_AddRefs(newWindow));</span>
<a href="#l15.50"></a><span id="l15.50">         }</span>
<a href="#l15.51"></a><span id="l15.51"> #endif</span>
<a href="#l15.52"></a><span id="l15.52">       }</span>
<a href="#l15.53"></a><span id="l15.53">       else</span>
<a href="#l15.54"></a><span id="l15.54">       {</span>
<a href="#l15.55"></a><span id="l15.55">         nsCOMPtr&lt;nsIMsgWindowCommands&gt; windowCommands;</span>
<a href="#l15.56"></a><span id="l15.56">         topMostMsgWindow-&gt;GetWindowCommands(getter_AddRefs(windowCommands));</span>
<a href="#l15.57"></a><span id="l15.57">         if (windowCommands)</span>
<a href="#l15.58"></a><span id="l15.58">           windowCommands-&gt;SelectFolder(aUri);</span>
<a href="#l15.59"></a><span id="l15.59">       }</span>
<a href="#l15.60"></a><span id="l15.60">     }</span>
<a href="#l15.61"></a><span id="l15.61"> </span>
<a href="#l15.62"></a><span id="l15.62">     FocusAppNative();</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-    nsCOMPtr&lt;nsIDOMWindow&gt; domWindow;</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineplus">+    nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow;</span>
<a href="#l15.65"></a><span id="l15.65">     topMostMsgWindow-&gt;GetDomWindow(getter_AddRefs(domWindow));</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-    nsCOMPtr&lt;nsPIDOMWindow&gt; privateWindow(do_QueryInterface(domWindow));</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-    if (privateWindow)</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineplus">+    if (domWindow) {</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineplus">+      nsCOMPtr&lt;nsPIDOMWindowOuter&gt; privateWindow = nsPIDOMWindowOuter::From(domWindow);</span>
<a href="#l15.70"></a><span id="l15.70">       privateWindow-&gt;Focus();</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineplus">+    }</span>
<a href="#l15.72"></a><span id="l15.72">   }</span>
<a href="#l15.73"></a><span id="l15.73">   else</span>
<a href="#l15.74"></a><span id="l15.74">   {</span>
<a href="#l15.75"></a><span id="l15.75">     // the user doesn't have a mail window open already so open one for them...</span>
<a href="#l15.76"></a><span id="l15.76">     nsCOMPtr&lt;nsIMessengerWindowService&gt; messengerWindowService =</span>
<a href="#l15.77"></a><span id="l15.77">       do_GetService(NS_MESSENGERWINDOWSERVICE_CONTRACTID);</span>
<a href="#l15.78"></a><span id="l15.78">     // if we want to preselect the first account with new mail,</span>
<a href="#l15.79"></a><span id="l15.79">     // here is where we would try to generate a uri to pass in</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineat">@@ -489,17 +490,17 @@ nsMessengerOSXIntegration::BounceDockIco</span>
<a href="#l15.81"></a><span id="l15.81">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.82"></a><span id="l15.82"> </span>
<a href="#l15.83"></a><span id="l15.83">   if (!bounceDockIcon)</span>
<a href="#l15.84"></a><span id="l15.84">     return NS_OK;</span>
<a href="#l15.85"></a><span id="l15.85"> </span>
<a href="#l15.86"></a><span id="l15.86">   nsCOMPtr&lt;nsIWindowMediator&gt; mediator(do_GetService(NS_WINDOWMEDIATOR_CONTRACTID));</span>
<a href="#l15.87"></a><span id="l15.87">   if (mediator)</span>
<a href="#l15.88"></a><span id="l15.88">   {</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-    nsCOMPtr&lt;nsIDOMWindow&gt; domWindow;</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+    nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow;</span>
<a href="#l15.91"></a><span id="l15.91">     mediator-&gt;GetMostRecentWindow(MOZ_UTF16(&quot;mail:3pane&quot;), getter_AddRefs(domWindow));</span>
<a href="#l15.92"></a><span id="l15.92">     if (domWindow)</span>
<a href="#l15.93"></a><span id="l15.93">     {</span>
<a href="#l15.94"></a><span id="l15.94">       nsCOMPtr&lt;nsIDOMChromeWindow&gt; chromeWindow(do_QueryInterface(domWindow));</span>
<a href="#l15.95"></a><span id="l15.95">       chromeWindow-&gt;GetAttention();</span>
<a href="#l15.96"></a><span id="l15.96">     }</span>
<a href="#l15.97"></a><span id="l15.97">   }</span>
<a href="#l15.98"></a><span id="l15.98">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -14,17 +14,17 @@</span>
<a href="#l16.4"></a><span id="l16.4"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l16.5"></a><span id="l16.5"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l16.6"></a><span id="l16.6"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l16.7"></a><span id="l16.7"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l16.8"></a><span id="l16.8"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l16.9"></a><span id="l16.9"> #include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l16.10"></a><span id="l16.10"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l16.11"></a><span id="l16.11"> #include &quot;nsIWindowMediator.h&quot;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l16.14"></a><span id="l16.14"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l16.15"></a><span id="l16.15"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l16.16"></a><span id="l16.16"> #include &quot;nsIBaseWindow.h&quot;</span>
<a href="#l16.17"></a><span id="l16.17"> #include &quot;MailNewsTypes.h&quot;</span>
<a href="#l16.18"></a><span id="l16.18"> #include &quot;nsIMessengerWindowService.h&quot;</span>
<a href="#l16.19"></a><span id="l16.19"> #include &quot;prprf.h&quot;</span>
<a href="#l16.20"></a><span id="l16.20"> #include &quot;nsIWeakReference.h&quot;</span>
<a href="#l16.21"></a><span id="l16.21"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -77,20 +77,22 @@ static void openMailWindow(const nsACStr</span>
<a href="#l16.23"></a><span id="l16.23">     if (!aFolderUri.IsEmpty())</span>
<a href="#l16.24"></a><span id="l16.24">     {</span>
<a href="#l16.25"></a><span id="l16.25">       nsCOMPtr&lt;nsIMsgWindowCommands&gt; windowCommands;</span>
<a href="#l16.26"></a><span id="l16.26">       topMostMsgWindow-&gt;GetWindowCommands(getter_AddRefs(windowCommands));</span>
<a href="#l16.27"></a><span id="l16.27">       if (windowCommands)</span>
<a href="#l16.28"></a><span id="l16.28">         windowCommands-&gt;SelectFolder(aFolderUri);</span>
<a href="#l16.29"></a><span id="l16.29">     }</span>
<a href="#l16.30"></a><span id="l16.30"> </span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-    nsCOMPtr&lt;nsIDOMWindow&gt; domWindow;</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+    nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow;</span>
<a href="#l16.33"></a><span id="l16.33">     topMostMsgWindow-&gt;GetDomWindow(getter_AddRefs(domWindow));</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-    nsCOMPtr&lt;nsPIDOMWindow&gt; privateWindow(do_QueryInterface(domWindow));</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-    privateWindow-&gt;Focus();</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+    if (domWindow) {</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+      nsCOMPtr&lt;nsPIDOMWindowOuter&gt; privateWindow = nsPIDOMWindowOuter::From(domWindow);</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+      privateWindow-&gt;Focus();</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+    }</span>
<a href="#l16.40"></a><span id="l16.40">   }</span>
<a href="#l16.41"></a><span id="l16.41">   else</span>
<a href="#l16.42"></a><span id="l16.42">   {</span>
<a href="#l16.43"></a><span id="l16.43">     // the user doesn't have a mail window open already so open one for them...</span>
<a href="#l16.44"></a><span id="l16.44">     nsCOMPtr&lt;nsIMessengerWindowService&gt; messengerWindowService =</span>
<a href="#l16.45"></a><span id="l16.45">       do_GetService(NS_MESSENGERWINDOWSERVICE_CONTRACTID);</span>
<a href="#l16.46"></a><span id="l16.46">     // if we want to preselect the first account with new mail,</span>
<a href="#l16.47"></a><span id="l16.47">     // here is where we would try to generate a uri to pass in</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineat">@@ -394,17 +396,17 @@ nsresult nsMessengerUnixIntegration::Sho</span>
<a href="#l16.49"></a><span id="l16.49"> </span>
<a href="#l16.50"></a><span id="l16.50">   // pass in the animation flag</span>
<a href="#l16.51"></a><span id="l16.51">   nsCOMPtr&lt;nsISupportsPRBool&gt; scriptableUserInitiated (do_CreateInstance(NS_SUPPORTS_PRBOOL_CONTRACTID, &amp;rv));</span>
<a href="#l16.52"></a><span id="l16.52">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.53"></a><span id="l16.53">   scriptableUserInitiated-&gt;SetData(aUserInitiated);</span>
<a href="#l16.54"></a><span id="l16.54">   argsArray-&gt;AppendElement(scriptableUserInitiated, false);</span>
<a href="#l16.55"></a><span id="l16.55"> </span>
<a href="#l16.56"></a><span id="l16.56">   nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch(do_GetService(NS_WINDOWWATCHER_CONTRACTID));</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; newWindow;</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; newWindow;</span>
<a href="#l16.59"></a><span id="l16.59"> </span>
<a href="#l16.60"></a><span id="l16.60">   mAlertInProgress = true;</span>
<a href="#l16.61"></a><span id="l16.61">   rv = wwatch-&gt;OpenWindow(0, ALERT_CHROME_URL, &quot;_blank&quot;,</span>
<a href="#l16.62"></a><span id="l16.62">                           &quot;chrome,dialog=yes,titlebar=no,popup=yes&quot;, argsArray,</span>
<a href="#l16.63"></a><span id="l16.63">                           getter_AddRefs(newWindow));</span>
<a href="#l16.64"></a><span id="l16.64"> </span>
<a href="#l16.65"></a><span id="l16.65">   if (NS_FAILED(rv))</span>
<a href="#l16.66"></a><span id="l16.66">     AlertFinished();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -17,17 +17,17 @@</span>
<a href="#l17.4"></a><span id="l17.4"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l17.5"></a><span id="l17.5"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l17.6"></a><span id="l17.6"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l17.7"></a><span id="l17.7"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l17.8"></a><span id="l17.8"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l17.9"></a><span id="l17.9"> #include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l17.10"></a><span id="l17.10"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l17.11"></a><span id="l17.11"> #include &quot;nsIWindowMediator.h&quot;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l17.14"></a><span id="l17.14"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l17.15"></a><span id="l17.15"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l17.16"></a><span id="l17.16"> #include &quot;nsIBaseWindow.h&quot;</span>
<a href="#l17.17"></a><span id="l17.17"> #include &quot;nsIWidget.h&quot;</span>
<a href="#l17.18"></a><span id="l17.18"> #include &quot;nsWidgetsCID.h&quot;</span>
<a href="#l17.19"></a><span id="l17.19"> #include &quot;MailNewsTypes.h&quot;</span>
<a href="#l17.20"></a><span id="l17.20"> #include &quot;nsIMessengerWindowService.h&quot;</span>
<a href="#l17.21"></a><span id="l17.21"> #include &quot;prprf.h&quot;</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -91,63 +91,65 @@</span>
<a href="#l17.23"></a><span id="l17.23"> #define NS_ALERT_HORIZONTAL 1</span>
<a href="#l17.24"></a><span id="l17.24"> #define NS_ALERT_LEFT       2</span>
<a href="#l17.25"></a><span id="l17.25"> #define NS_ALERT_TOP        4</span>
<a href="#l17.26"></a><span id="l17.26"> #endif</span>
<a href="#l17.27"></a><span id="l17.27"> </span>
<a href="#l17.28"></a><span id="l17.28"> using namespace mozilla;</span>
<a href="#l17.29"></a><span id="l17.29"> </span>
<a href="#l17.30"></a><span id="l17.30"> // begin shameless copying from nsNativeAppSupportWin</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-HWND hwndForDOMWindow( nsISupports *window )</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+HWND hwndForDOMWindow( mozIDOMWindowProxy *window )</span>
<a href="#l17.33"></a><span id="l17.33"> {</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">-  nsCOMPtr&lt;nsPIDOMWindow&gt; win( do_QueryInterface(window) );</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-  if ( !win )</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-      return 0;</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+  if ( !window ) {</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+    return 0;</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+  }</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; pidomwindow = nsPIDOMWindowOuter::From(window);</span>
<a href="#l17.41"></a><span id="l17.41"> </span>
<a href="#l17.42"></a><span id="l17.42">   nsCOMPtr&lt;nsIBaseWindow&gt; ppBaseWindow =</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-      do_QueryInterface( win-&gt;GetDocShell() );</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-  if (!ppBaseWindow) return 0;</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+    do_QueryInterface( pidomwindow-&gt;GetDocShell() );</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+  if (!ppBaseWindow)</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+    return 0;</span>
<a href="#l17.48"></a><span id="l17.48"> </span>
<a href="#l17.49"></a><span id="l17.49">   nsCOMPtr&lt;nsIWidget&gt; ppWidget;</span>
<a href="#l17.50"></a><span id="l17.50">   ppBaseWindow-&gt;GetMainWidget( getter_AddRefs( ppWidget ) );</span>
<a href="#l17.51"></a><span id="l17.51"> </span>
<a href="#l17.52"></a><span id="l17.52">   return (HWND)( ppWidget-&gt;GetNativeData( NS_NATIVE_WIDGET ) );</span>
<a href="#l17.53"></a><span id="l17.53"> }</span>
<a href="#l17.54"></a><span id="l17.54"> </span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-static void activateWindow( nsIDOMWindow *win )</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+static void activateWindow( mozIDOMWindowProxy *win )</span>
<a href="#l17.57"></a><span id="l17.57"> {</span>
<a href="#l17.58"></a><span id="l17.58">   // Try to get native window handle.</span>
<a href="#l17.59"></a><span id="l17.59">   HWND hwnd = hwndForDOMWindow( win );</span>
<a href="#l17.60"></a><span id="l17.60">   if ( hwnd )</span>
<a href="#l17.61"></a><span id="l17.61">   {</span>
<a href="#l17.62"></a><span id="l17.62">     // Restore the window if it is minimized.</span>
<a href="#l17.63"></a><span id="l17.63">     if ( ::IsIconic( hwnd ) )</span>
<a href="#l17.64"></a><span id="l17.64">       ::ShowWindow( hwnd, SW_RESTORE );</span>
<a href="#l17.65"></a><span id="l17.65">     // Use the OS call, if possible.</span>
<a href="#l17.66"></a><span id="l17.66">     ::SetForegroundWindow( hwnd );</span>
<a href="#l17.67"></a><span id="l17.67">   } else {</span>
<a href="#l17.68"></a><span id="l17.68">     // Use internal method.</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineminus">-    nsCOMPtr&lt;nsPIDOMWindow&gt; privateWindow(do_QueryInterface(win));</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+    nsCOMPtr&lt;nsPIDOMWindowOuter&gt; privateWindow = nsPIDOMWindowOuter::From(win);</span>
<a href="#l17.71"></a><span id="l17.71">     privateWindow-&gt;Focus();</span>
<a href="#l17.72"></a><span id="l17.72">   }</span>
<a href="#l17.73"></a><span id="l17.73"> }</span>
<a href="#l17.74"></a><span id="l17.74"> // end shameless copying from nsNativeAppWinSupport.cpp</span>
<a href="#l17.75"></a><span id="l17.75"> </span>
<a href="#l17.76"></a><span id="l17.76"> static void openMailWindow(const nsACString&amp; aFolderUri)</span>
<a href="#l17.77"></a><span id="l17.77"> {</span>
<a href="#l17.78"></a><span id="l17.78">   nsresult rv;</span>
<a href="#l17.79"></a><span id="l17.79">   nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession ( do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv));</span>
<a href="#l17.80"></a><span id="l17.80">   if (NS_FAILED(rv))</span>
<a href="#l17.81"></a><span id="l17.81">     return;</span>
<a href="#l17.82"></a><span id="l17.82"> </span>
<a href="#l17.83"></a><span id="l17.83">   nsCOMPtr&lt;nsIMsgWindow&gt; topMostMsgWindow;</span>
<a href="#l17.84"></a><span id="l17.84">   rv = mailSession-&gt;GetTopmostMsgWindow(getter_AddRefs(topMostMsgWindow));</span>
<a href="#l17.85"></a><span id="l17.85">   if (topMostMsgWindow)</span>
<a href="#l17.86"></a><span id="l17.86">   {</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineminus">-    nsCOMPtr&lt;nsIDOMWindow&gt; domWindow;</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+    nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow;</span>
<a href="#l17.89"></a><span id="l17.89">     topMostMsgWindow-&gt;GetDomWindow(getter_AddRefs(domWindow));</span>
<a href="#l17.90"></a><span id="l17.90">     if (domWindow)</span>
<a href="#l17.91"></a><span id="l17.91">     {</span>
<a href="#l17.92"></a><span id="l17.92">       if (!aFolderUri.IsEmpty())</span>
<a href="#l17.93"></a><span id="l17.93">       {</span>
<a href="#l17.94"></a><span id="l17.94">         nsCOMPtr&lt;nsIMsgWindowCommands&gt; windowCommands;</span>
<a href="#l17.95"></a><span id="l17.95">         topMostMsgWindow-&gt;GetWindowCommands(getter_AddRefs(windowCommands));</span>
<a href="#l17.96"></a><span id="l17.96">         if (windowCommands)</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineat">@@ -572,17 +574,17 @@ nsresult nsMessengerWinIntegration::Show</span>
<a href="#l17.98"></a><span id="l17.98">     }</span>
<a href="#l17.99"></a><span id="l17.99"> #endif</span>
<a href="#l17.100"></a><span id="l17.100">     scriptableOrigin-&gt;SetData(origin);</span>
<a href="#l17.101"></a><span id="l17.101"> </span>
<a href="#l17.102"></a><span id="l17.102">     rv = argsArray-&gt;AppendElement(scriptableOrigin, false);</span>
<a href="#l17.103"></a><span id="l17.103">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.104"></a><span id="l17.104"> </span>
<a href="#l17.105"></a><span id="l17.105">     nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch(do_GetService(NS_WINDOWWATCHER_CONTRACTID));</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineminus">-    nsCOMPtr&lt;nsIDOMWindow&gt; newWindow;</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineplus">+    nsCOMPtr&lt;mozIDOMWindowProxy&gt; newWindow;</span>
<a href="#l17.108"></a><span id="l17.108">     rv = wwatch-&gt;OpenWindow(0, ALERT_CHROME_URL, &quot;_blank&quot;,</span>
<a href="#l17.109"></a><span id="l17.109">                 &quot;chrome,dialog=yes,titlebar=no,popup=yes&quot;, argsArray,</span>
<a href="#l17.110"></a><span id="l17.110">                  getter_AddRefs(newWindow));</span>
<a href="#l17.111"></a><span id="l17.111"> </span>
<a href="#l17.112"></a><span id="l17.112">     mAlertInProgress = true;</span>
<a href="#l17.113"></a><span id="l17.113">   }</span>
<a href="#l17.114"></a><span id="l17.114"> </span>
<a href="#l17.115"></a><span id="l17.115">   // if the user has turned off the mail alert, or  openWindow generated an error,</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineat">@@ -618,17 +620,17 @@ nsresult nsMessengerWinIntegration::Aler</span>
<a href="#l17.117"></a><span id="l17.117"> {</span>
<a href="#l17.118"></a><span id="l17.118">   nsresult rv;</span>
<a href="#l17.119"></a><span id="l17.119">   nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l17.120"></a><span id="l17.120">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l17.121"></a><span id="l17.121">   nsCOMPtr&lt;nsIMsgWindow&gt; topMostMsgWindow;</span>
<a href="#l17.122"></a><span id="l17.122">   rv = mailSession-&gt;GetTopmostMsgWindow(getter_AddRefs(topMostMsgWindow));</span>
<a href="#l17.123"></a><span id="l17.123">   if (topMostMsgWindow)</span>
<a href="#l17.124"></a><span id="l17.124">   {</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineminus">-    nsCOMPtr&lt;nsIDOMWindow&gt; domWindow;</span>
<a href="#l17.126"></a><span id="l17.126" class="difflineplus">+    nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow;</span>
<a href="#l17.127"></a><span id="l17.127">     topMostMsgWindow-&gt;GetDomWindow(getter_AddRefs(domWindow));</span>
<a href="#l17.128"></a><span id="l17.128">     if (domWindow)</span>
<a href="#l17.129"></a><span id="l17.129">     {</span>
<a href="#l17.130"></a><span id="l17.130">       activateWindow(domWindow);</span>
<a href="#l17.131"></a><span id="l17.131">       return NS_OK;</span>
<a href="#l17.132"></a><span id="l17.132">     }</span>
<a href="#l17.133"></a><span id="l17.133">   }</span>
<a href="#l17.134"></a><span id="l17.134">   // make sure we don't insert the icon in the system tray since the user clicked on the alert.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -273,17 +273,17 @@ nsresult nsMsgMailSession::GetTopmostMsg</span>
<a href="#l18.4"></a><span id="l18.4"> #else</span>
<a href="#l18.5"></a><span id="l18.5">     rv = windowMediator-&gt;GetZOrderDOMWindowEnumerator(nullptr, true,</span>
<a href="#l18.6"></a><span id="l18.6">                                                       getter_AddRefs(windowEnum));</span>
<a href="#l18.7"></a><span id="l18.7"> #endif</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">     nsCOMPtr&lt;nsISupports&gt; windowSupports;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    nsCOMPtr&lt;nsPIDOMWindow&gt; topMostWindow;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    nsCOMPtr&lt;nsPIDOMWindowOuter&gt; topMostWindow;</span>
<a href="#l18.14"></a><span id="l18.14">     nsCOMPtr&lt;nsIDOMDocument&gt; domDocument;</span>
<a href="#l18.15"></a><span id="l18.15">     nsCOMPtr&lt;nsIDOMElement&gt; domElement;</span>
<a href="#l18.16"></a><span id="l18.16">     nsAutoString windowType;</span>
<a href="#l18.17"></a><span id="l18.17">     bool more;</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19">     // loop to get the top most with attibute &quot;mail:3pane&quot; or &quot;mail:messageWindow&quot;</span>
<a href="#l18.20"></a><span id="l18.20">     windowEnum-&gt;HasMoreElements(&amp;more);</span>
<a href="#l18.21"></a><span id="l18.21">     while (more)</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -655,17 +655,17 @@ NS_IMETHODIMP nsMsgShutdownService::Obse</span>
<a href="#l18.23"></a><span id="l18.23">     NS_ENSURE_TRUE(mMsgProgress, NS_ERROR_FAILURE);</span>
<a href="#l18.24"></a><span id="l18.24">     </span>
<a href="#l18.25"></a><span id="l18.25">     nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = do_GetService(NS_MSGMAILSESSION_CONTRACTID);</span>
<a href="#l18.26"></a><span id="l18.26">     NS_ENSURE_TRUE(mailSession, NS_ERROR_FAILURE);</span>
<a href="#l18.27"></a><span id="l18.27"> </span>
<a href="#l18.28"></a><span id="l18.28">     nsCOMPtr&lt;nsIMsgWindow&gt; topMsgWindow;</span>
<a href="#l18.29"></a><span id="l18.29">     mailSession-&gt;GetTopmostMsgWindow(getter_AddRefs(topMsgWindow));</span>
<a href="#l18.30"></a><span id="l18.30">     </span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-    nsCOMPtr&lt;nsIDOMWindow&gt; internalDomWin;</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+    nsCOMPtr&lt;mozIDOMWindowProxy&gt; internalDomWin;</span>
<a href="#l18.33"></a><span id="l18.33">     if (topMsgWindow)</span>
<a href="#l18.34"></a><span id="l18.34">       topMsgWindow-&gt;GetDomWindow(getter_AddRefs(internalDomWin));</span>
<a href="#l18.35"></a><span id="l18.35">     </span>
<a href="#l18.36"></a><span id="l18.36">     if (!internalDomWin)</span>
<a href="#l18.37"></a><span id="l18.37">     {</span>
<a href="#l18.38"></a><span id="l18.38">       // First see if there is a window open. </span>
<a href="#l18.39"></a><span id="l18.39">       nsCOMPtr&lt;nsIWindowMediator&gt; winMed = do_GetService(NS_WINDOWMEDIATOR_CONTRACTID);</span>
<a href="#l18.40"></a><span id="l18.40">       winMed-&gt;GetMostRecentWindow(nullptr, getter_AddRefs(internalDomWin));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -11,16 +11,17 @@</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> #include &quot;nsISupports.h&quot;</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9"> #include &quot;nsIURI.h&quot;</span>
<a href="#l19.10"></a><span id="l19.10"> </span>
<a href="#l19.11"></a><span id="l19.11"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l19.13"></a><span id="l19.13"> #include &quot;nsIContentViewer.h&quot;</span>
<a href="#l19.14"></a><span id="l19.14"> #include &quot;nsIMsgMessageService.h&quot;</span>
<a href="#l19.15"></a><span id="l19.15"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l19.16"></a><span id="l19.16"> #include &quot;nsIWebProgress.h&quot;</span>
<a href="#l19.17"></a><span id="l19.17"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l19.18"></a><span id="l19.18"> #include &quot;nsMsgPrintEngine.h&quot;</span>
<a href="#l19.19"></a><span id="l19.19"> #include &quot;nsIDocumentLoader.h&quot;</span>
<a href="#l19.20"></a><span id="l19.20"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineat">@@ -87,17 +88,17 @@ nsMsgPrintEngine::OnStateChange(nsIWebPr</span>
<a href="#l19.22"></a><span id="l19.22">       {</span>
<a href="#l19.23"></a><span id="l19.23">         // Check to see if the document DOMWin that is finished loading is the same</span>
<a href="#l19.24"></a><span id="l19.24">         // one as the mail msg that we started to load.</span>
<a href="#l19.25"></a><span id="l19.25">         // We only want to print when the entire msg and all of its attachments</span>
<a href="#l19.26"></a><span id="l19.26">         // have finished loading.</span>
<a href="#l19.27"></a><span id="l19.27">         // The mail msg doc is the last one to receive the STATE_STOP notification</span>
<a href="#l19.28"></a><span id="l19.28">         nsCOMPtr&lt;nsISupports&gt; container;</span>
<a href="#l19.29"></a><span id="l19.29">         docLoader-&gt;GetContainer(getter_AddRefs(container));</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-        nsCOMPtr&lt;nsIDOMWindow&gt; domWindow(do_GetInterface(container));</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineplus">+        nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow(do_GetInterface(container));</span>
<a href="#l19.32"></a><span id="l19.32">         if (domWindow.get() != mMsgDOMWin.get()) {</span>
<a href="#l19.33"></a><span id="l19.33">           return NS_OK;</span>
<a href="#l19.34"></a><span id="l19.34">         }</span>
<a href="#l19.35"></a><span id="l19.35">       }</span>
<a href="#l19.36"></a><span id="l19.36">       nsCOMPtr&lt;nsIWebProgressListener&gt; wpl(do_QueryInterface(mPrintPromptService));</span>
<a href="#l19.37"></a><span id="l19.37">       if (wpl) {</span>
<a href="#l19.38"></a><span id="l19.38">         wpl-&gt;OnStateChange(nullptr, nullptr, nsIWebProgressListener::STATE_STOP|nsIWebProgressListener::STATE_IS_DOCUMENT, NS_OK);</span>
<a href="#l19.39"></a><span id="l19.39">         mPrintProgressListener = nullptr;</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineat">@@ -155,17 +156,19 @@ nsMsgPrintEngine::OnStateChange(nsIWebPr</span>
<a href="#l19.41"></a><span id="l19.41">           }</span>
<a href="#l19.42"></a><span id="l19.42">         } else {</span>
<a href="#l19.43"></a><span id="l19.43">           FireStartNextEvent();</span>
<a href="#l19.44"></a><span id="l19.44">           rv = NS_OK;</span>
<a href="#l19.45"></a><span id="l19.45">         }</span>
<a href="#l19.46"></a><span id="l19.46">       } </span>
<a href="#l19.47"></a><span id="l19.47">       else </span>
<a href="#l19.48"></a><span id="l19.48">       {</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineminus">-        mWindow-&gt;Close();</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+        if (mWindow) {</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+          nsPIDOMWindowOuter::From(mWindow)-&gt;Close();</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineplus">+        }</span>
<a href="#l19.53"></a><span id="l19.53">       }</span>
<a href="#l19.54"></a><span id="l19.54">     }</span>
<a href="#l19.55"></a><span id="l19.55">   }</span>
<a href="#l19.56"></a><span id="l19.56"> </span>
<a href="#l19.57"></a><span id="l19.57">   return rv;</span>
<a href="#l19.58"></a><span id="l19.58"> }</span>
<a href="#l19.59"></a><span id="l19.59"> </span>
<a href="#l19.60"></a><span id="l19.60"> NS_IMETHODIMP</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineat">@@ -205,32 +208,34 @@ nsMsgPrintEngine::OnSecurityChange(nsIWe</span>
<a href="#l19.62"></a><span id="l19.62">                       nsIRequest *aRequest, </span>
<a href="#l19.63"></a><span id="l19.63">                       uint32_t state)</span>
<a href="#l19.64"></a><span id="l19.64"> {</span>
<a href="#l19.65"></a><span id="l19.65">     NS_NOTREACHED(&quot;notification excluded in AddProgressListener(...)&quot;);</span>
<a href="#l19.66"></a><span id="l19.66">     return NS_OK;</span>
<a href="#l19.67"></a><span id="l19.67"> }</span>
<a href="#l19.68"></a><span id="l19.68"> </span>
<a href="#l19.69"></a><span id="l19.69"> NS_IMETHODIMP    </span>
<a href="#l19.70"></a><span id="l19.70" class="difflineminus">-nsMsgPrintEngine::SetWindow(nsIDOMWindow *aWin)</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineplus">+nsMsgPrintEngine::SetWindow(mozIDOMWindowProxy *aWin)</span>
<a href="#l19.72"></a><span id="l19.72"> {</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineminus">-	if (!aWin)</span>
<a href="#l19.74"></a><span id="l19.74" class="difflineplus">+  if (!aWin)</span>
<a href="#l19.75"></a><span id="l19.75">   {</span>
<a href="#l19.76"></a><span id="l19.76">     // It isn't an error to pass in null for aWin, in fact it means we are shutting</span>
<a href="#l19.77"></a><span id="l19.77">     // down and we should start cleaning things up...</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineminus">-		return NS_OK;</span>
<a href="#l19.79"></a><span id="l19.79" class="difflineplus">+    return NS_OK;</span>
<a href="#l19.80"></a><span id="l19.80">   }</span>
<a href="#l19.81"></a><span id="l19.81"> </span>
<a href="#l19.82"></a><span id="l19.82" class="difflineminus">-  mWindow = do_QueryInterface(aWin);</span>
<a href="#l19.83"></a><span id="l19.83" class="difflineplus">+  mWindow = aWin;</span>
<a href="#l19.84"></a><span id="l19.84" class="difflineplus">+</span>
<a href="#l19.85"></a><span id="l19.85">   NS_ENSURE_TRUE(mWindow, NS_ERROR_FAILURE);</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; window = nsPIDOMWindowOuter::From(mWindow);</span>
<a href="#l19.87"></a><span id="l19.87"> </span>
<a href="#l19.88"></a><span id="l19.88" class="difflineminus">-  mWindow-&gt;GetDocShell()-&gt;SetAppType(nsIDocShell::APP_TYPE_MAIL);</span>
<a href="#l19.89"></a><span id="l19.89" class="difflineplus">+  window-&gt;GetDocShell()-&gt;SetAppType(nsIDocShell::APP_TYPE_MAIL);</span>
<a href="#l19.90"></a><span id="l19.90"> </span>
<a href="#l19.91"></a><span id="l19.91">   nsCOMPtr&lt;nsIDocShellTreeItem&gt; docShellAsItem =</span>
<a href="#l19.92"></a><span id="l19.92" class="difflineminus">-    do_QueryInterface(mWindow-&gt;GetDocShell());</span>
<a href="#l19.93"></a><span id="l19.93" class="difflineplus">+    do_QueryInterface(window-&gt;GetDocShell());</span>
<a href="#l19.94"></a><span id="l19.94">   NS_ENSURE_TRUE(docShellAsItem, NS_ERROR_FAILURE);</span>
<a href="#l19.95"></a><span id="l19.95"> </span>
<a href="#l19.96"></a><span id="l19.96">   nsCOMPtr&lt;nsIDocShellTreeItem&gt; rootAsItem;</span>
<a href="#l19.97"></a><span id="l19.97">   docShellAsItem-&gt;GetSameTypeRootTreeItem(getter_AddRefs(rootAsItem));</span>
<a href="#l19.98"></a><span id="l19.98"> </span>
<a href="#l19.99"></a><span id="l19.99">   nsCOMPtr&lt;nsIDocShellTreeItem&gt; childItem;</span>
<a href="#l19.100"></a><span id="l19.100">   rootAsItem-&gt;FindChildWithName(MOZ_UTF16(&quot;content&quot;), true,</span>
<a href="#l19.101"></a><span id="l19.101"> 				false, nullptr, nullptr,</span>
<a href="#l19.102"></a><span id="l19.102" class="difflineat">@@ -239,33 +244,34 @@ nsMsgPrintEngine::SetWindow(nsIDOMWindow</span>
<a href="#l19.103"></a><span id="l19.103">   mDocShell = do_QueryInterface(childItem);</span>
<a href="#l19.104"></a><span id="l19.104"> </span>
<a href="#l19.105"></a><span id="l19.105">   if(mDocShell)</span>
<a href="#l19.106"></a><span id="l19.106">     SetupObserver();</span>
<a href="#l19.107"></a><span id="l19.107"> </span>
<a href="#l19.108"></a><span id="l19.108">   return NS_OK;</span>
<a href="#l19.109"></a><span id="l19.109"> }</span>
<a href="#l19.110"></a><span id="l19.110"> </span>
<a href="#l19.111"></a><span id="l19.111" class="difflineminus">-/* void setParentWindow (in nsIDOMWindow ptr); */</span>
<a href="#l19.112"></a><span id="l19.112" class="difflineminus">-NS_IMETHODIMP nsMsgPrintEngine::SetParentWindow(nsIDOMWindow *ptr)</span>
<a href="#l19.113"></a><span id="l19.113" class="difflineplus">+/* void setParentWindow (in mozIDOMWindowProxy ptr); */</span>
<a href="#l19.114"></a><span id="l19.114" class="difflineplus">+NS_IMETHODIMP nsMsgPrintEngine::SetParentWindow(mozIDOMWindowProxy *ptr)</span>
<a href="#l19.115"></a><span id="l19.115"> {</span>
<a href="#l19.116"></a><span id="l19.116">   mParentWindow = ptr;</span>
<a href="#l19.117"></a><span id="l19.117">   return NS_OK;</span>
<a href="#l19.118"></a><span id="l19.118"> }</span>
<a href="#l19.119"></a><span id="l19.119"> </span>
<a href="#l19.120"></a><span id="l19.120"> </span>
<a href="#l19.121"></a><span id="l19.121"> NS_IMETHODIMP</span>
<a href="#l19.122"></a><span id="l19.122"> nsMsgPrintEngine::ShowWindow(bool aShow)</span>
<a href="#l19.123"></a><span id="l19.123"> {</span>
<a href="#l19.124"></a><span id="l19.124">   nsresult rv;</span>
<a href="#l19.125"></a><span id="l19.125"> </span>
<a href="#l19.126"></a><span id="l19.126">   NS_ENSURE_TRUE(mWindow, NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l19.127"></a><span id="l19.127"> </span>
<a href="#l19.128"></a><span id="l19.128" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; window = nsPIDOMWindowOuter::From(mWindow);</span>
<a href="#l19.129"></a><span id="l19.129">   nsCOMPtr &lt;nsIDocShellTreeItem&gt; treeItem =</span>
<a href="#l19.130"></a><span id="l19.130" class="difflineminus">-    do_QueryInterface(mWindow-&gt;GetDocShell(), &amp;rv);</span>
<a href="#l19.131"></a><span id="l19.131" class="difflineplus">+    do_QueryInterface(window-&gt;GetDocShell(), &amp;rv);</span>
<a href="#l19.132"></a><span id="l19.132">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l19.133"></a><span id="l19.133"> </span>
<a href="#l19.134"></a><span id="l19.134">   nsCOMPtr &lt;nsIDocShellTreeOwner&gt; treeOwner;</span>
<a href="#l19.135"></a><span id="l19.135">   rv = treeItem-&gt;GetTreeOwner(getter_AddRefs(treeOwner));</span>
<a href="#l19.136"></a><span id="l19.136">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l19.137"></a><span id="l19.137">   </span>
<a href="#l19.138"></a><span id="l19.138">   if (treeOwner) {</span>
<a href="#l19.139"></a><span id="l19.139">     // disable (enable) the window</span>
<a href="#l19.140"></a><span id="l19.140" class="difflineat">@@ -345,17 +351,17 @@ nsMsgPrintEngine::ShowProgressDialog(boo</span>
<a href="#l19.141"></a><span id="l19.141">   // If we don't get a service, that's ok, then just don't show progress</span>
<a href="#l19.142"></a><span id="l19.142">   if (showProgressDialog) {</span>
<a href="#l19.143"></a><span id="l19.143">     if (!mPrintPromptService) </span>
<a href="#l19.144"></a><span id="l19.144">     {</span>
<a href="#l19.145"></a><span id="l19.145">       mPrintPromptService = do_GetService(kPrintingPromptService);</span>
<a href="#l19.146"></a><span id="l19.146">     }</span>
<a href="#l19.147"></a><span id="l19.147">     if (mPrintPromptService) </span>
<a href="#l19.148"></a><span id="l19.148">     {</span>
<a href="#l19.149"></a><span id="l19.149" class="difflineminus">-      nsCOMPtr&lt;nsIDOMWindow&gt; domWin(do_QueryInterface(mParentWindow));</span>
<a href="#l19.150"></a><span id="l19.150" class="difflineplus">+      nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWin(do_QueryInterface(mParentWindow));</span>
<a href="#l19.151"></a><span id="l19.151">       if (!domWin) </span>
<a href="#l19.152"></a><span id="l19.152">       {</span>
<a href="#l19.153"></a><span id="l19.153">         domWin = mWindow;</span>
<a href="#l19.154"></a><span id="l19.154">       }</span>
<a href="#l19.155"></a><span id="l19.155"> </span>
<a href="#l19.156"></a><span id="l19.156">       rv = mPrintPromptService-&gt;ShowProgress(domWin, mWebBrowserPrint, mPrintSettings, this, aIsForPrinting,</span>
<a href="#l19.157"></a><span id="l19.157">                                             getter_AddRefs(mPrintProgressListener), </span>
<a href="#l19.158"></a><span id="l19.158">                                             getter_AddRefs(mPrintProgressParams), </span>
<a href="#l19.159"></a><span id="l19.159" class="difflineat">@@ -395,17 +401,18 @@ nsMsgPrintEngine::StartNextPrintOperatio</span>
<a href="#l19.160"></a><span id="l19.160">     InitializeDisplayCharset();</span>
<a href="#l19.161"></a><span id="l19.161"> </span>
<a href="#l19.162"></a><span id="l19.162">   mCurrentlyPrintingURI++;</span>
<a href="#l19.163"></a><span id="l19.163"> </span>
<a href="#l19.164"></a><span id="l19.164">   // First, check if we are at the end of this stuff!</span>
<a href="#l19.165"></a><span id="l19.165">   if (mCurrentlyPrintingURI &gt;= (int32_t)mURIArray.Length())</span>
<a href="#l19.166"></a><span id="l19.166">   {</span>
<a href="#l19.167"></a><span id="l19.167">     // This is the end...dum, dum, dum....my only friend...the end</span>
<a href="#l19.168"></a><span id="l19.168" class="difflineminus">-    mWindow-&gt;Close();</span>
<a href="#l19.169"></a><span id="l19.169" class="difflineplus">+    NS_ENSURE_TRUE(mWindow, NS_ERROR_FAILURE);</span>
<a href="#l19.170"></a><span id="l19.170" class="difflineplus">+    nsPIDOMWindowOuter::From(mWindow)-&gt;Close();</span>
<a href="#l19.171"></a><span id="l19.171"> </span>
<a href="#l19.172"></a><span id="l19.172">     // Tell the user we are done...</span>
<a href="#l19.173"></a><span id="l19.173">     nsString msg;</span>
<a href="#l19.174"></a><span id="l19.174">     GetString(MOZ_UTF16(&quot;PrintingComplete&quot;), msg);</span>
<a href="#l19.175"></a><span id="l19.175">     SetStatusMessage(msg);</span>
<a href="#l19.176"></a><span id="l19.176">     return NS_OK;</span>
<a href="#l19.177"></a><span id="l19.177">   }</span>
<a href="#l19.178"></a><span id="l19.178"> </span>
<a href="#l19.179"></a><span id="l19.179" class="difflineat">@@ -617,17 +624,19 @@ nsMsgPrintEngine::PrintMsgWindow()</span>
<a href="#l19.180"></a><span id="l19.180">           mPrintSettings-&gt;GetIsCancelled(&amp;isPrintingCancelled);</span>
<a href="#l19.181"></a><span id="l19.181">         }</span>
<a href="#l19.182"></a><span id="l19.182">         if (!isPrintingCancelled) </span>
<a href="#l19.183"></a><span id="l19.183">         {</span>
<a href="#l19.184"></a><span id="l19.184">           StartNextPrintOperation();</span>
<a href="#l19.185"></a><span id="l19.185">         } </span>
<a href="#l19.186"></a><span id="l19.186">         else </span>
<a href="#l19.187"></a><span id="l19.187">         {</span>
<a href="#l19.188"></a><span id="l19.188" class="difflineminus">-          mWindow-&gt;Close();</span>
<a href="#l19.189"></a><span id="l19.189" class="difflineplus">+          if (mWindow) {</span>
<a href="#l19.190"></a><span id="l19.190" class="difflineplus">+            nsPIDOMWindowOuter::From(mWindow)-&gt;Close();</span>
<a href="#l19.191"></a><span id="l19.191" class="difflineplus">+          }</span>
<a href="#l19.192"></a><span id="l19.192">         }</span>
<a href="#l19.193"></a><span id="l19.193">       }</span>
<a href="#l19.194"></a><span id="l19.194">       else</span>
<a href="#l19.195"></a><span id="l19.195">       {</span>
<a href="#l19.196"></a><span id="l19.196">         // Tell the user we started printing...</span>
<a href="#l19.197"></a><span id="l19.197">         nsString msg;</span>
<a href="#l19.198"></a><span id="l19.198">         GetString(NS_ConvertASCIItoUTF16(kMsgKeys[mMsgInx]).get(), msg);</span>
<a href="#l19.199"></a><span id="l19.199">         SetStatusMessage(msg);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPrintEngine.h</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPrintEngine.h</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -60,28 +60,28 @@ protected:</span>
<a href="#l20.4"></a><span id="l20.4">   nsresult    FireThatLoadOperation(const nsString&amp; uri);</span>
<a href="#l20.5"></a><span id="l20.5">   void        InitializeDisplayCharset();</span>
<a href="#l20.6"></a><span id="l20.6">   void        SetupObserver();</span>
<a href="#l20.7"></a><span id="l20.7">   nsresult    SetStatusMessage(const nsString&amp; aMsgString);</span>
<a href="#l20.8"></a><span id="l20.8">   void GetString(const char16_t *aStringName, nsString&amp; aOutString);</span>
<a href="#l20.9"></a><span id="l20.9">   nsresult    ShowProgressDialog(bool aIsForPrinting, bool&amp; aDoNotify);</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">   nsCOMPtr&lt;nsIDocShell&gt;       mDocShell;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  nsCOMPtr&lt;nsPIDOMWindow&gt;     mWindow;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt;      mParentWindow;</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; mWindow;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; mParentWindow;</span>
<a href="#l20.16"></a><span id="l20.16">   int32_t                     mURICount;</span>
<a href="#l20.17"></a><span id="l20.17">   nsTArray&lt;nsString&gt;          mURIArray;</span>
<a href="#l20.18"></a><span id="l20.18">   int32_t                     mCurrentlyPrintingURI;</span>
<a href="#l20.19"></a><span id="l20.19"> </span>
<a href="#l20.20"></a><span id="l20.20">   nsCOMPtr&lt;nsIContentViewer&gt;  mContentViewer;</span>
<a href="#l20.21"></a><span id="l20.21">   nsCOMPtr&lt;nsIStringBundle&gt;   mStringBundle;    // String bundles...</span>
<a href="#l20.22"></a><span id="l20.22">   nsCOMPtr&lt;nsIMsgStatusFeedback&gt; mFeedback;     // Tell the user something why don't ya'</span>
<a href="#l20.23"></a><span id="l20.23">   nsCOMPtr&lt;nsIWebBrowserPrint&gt; mWebBrowserPrint;</span>
<a href="#l20.24"></a><span id="l20.24">   nsCOMPtr&lt;nsIPrintSettings&gt;   mPrintSettings;</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt;       mMsgDOMWin;</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; mMsgDOMWin;</span>
<a href="#l20.27"></a><span id="l20.27">   bool                         mIsDoingPrintPreview;</span>
<a href="#l20.28"></a><span id="l20.28">   nsCOMPtr&lt;nsIObserver&gt;        mStartupPPObs;</span>
<a href="#l20.29"></a><span id="l20.29">   int32_t                      mMsgInx;</span>
<a href="#l20.30"></a><span id="l20.30"> </span>
<a href="#l20.31"></a><span id="l20.31">   // Progress Dialog</span>
<a href="#l20.32"></a><span id="l20.32">   </span>
<a href="#l20.33"></a><span id="l20.33">   nsCOMPtr&lt;nsIPrintingPromptService&gt; mPrintPromptService;</span>
<a href="#l20.34"></a><span id="l20.34">   nsCOMPtr&lt;nsIWebProgressListener&gt; mPrintProgressListener;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/src/nsMsgProgress.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgProgress.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -8,16 +8,17 @@</span>
<a href="#l21.4"></a><span id="l21.4"> #include &quot;nsIBaseWindow.h&quot;</span>
<a href="#l21.5"></a><span id="l21.5"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l21.6"></a><span id="l21.6"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l21.7"></a><span id="l21.7"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l21.8"></a><span id="l21.8"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l21.9"></a><span id="l21.9"> #include &quot;nsError.h&quot;</span>
<a href="#l21.10"></a><span id="l21.10"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l21.11"></a><span id="l21.11"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l21.13"></a><span id="l21.13"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l21.14"></a><span id="l21.14"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l21.15"></a><span id="l21.15"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l21.16"></a><span id="l21.16"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l21.17"></a><span id="l21.17"> </span>
<a href="#l21.18"></a><span id="l21.18"> NS_IMPL_ISUPPORTS(nsMsgProgress, nsIMsgStatusFeedback, nsIMsgProgress,</span>
<a href="#l21.19"></a><span id="l21.19">   nsIWebProgressListener, nsIProgressEventSink, nsISupportsWeakReference)</span>
<a href="#l21.20"></a><span id="l21.20"> </span>
<a href="#l21.21"></a><span id="l21.21" class="difflineat">@@ -30,33 +31,33 @@ nsMsgProgress::nsMsgProgress()</span>
<a href="#l21.22"></a><span id="l21.22">   m_pendingStateValue = NS_OK;</span>
<a href="#l21.23"></a><span id="l21.23"> }</span>
<a href="#l21.24"></a><span id="l21.24"> </span>
<a href="#l21.25"></a><span id="l21.25"> nsMsgProgress::~nsMsgProgress()</span>
<a href="#l21.26"></a><span id="l21.26"> {</span>
<a href="#l21.27"></a><span id="l21.27">   (void)ReleaseListeners();</span>
<a href="#l21.28"></a><span id="l21.28"> }</span>
<a href="#l21.29"></a><span id="l21.29"> </span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-NS_IMETHODIMP nsMsgProgress::OpenProgressDialog(nsIDOMWindow *parentDOMWindow, </span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-                                                nsIMsgWindow *aMsgWindow, </span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-                                                const char *dialogURL, </span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-                                                bool inDisplayModal, </span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+NS_IMETHODIMP nsMsgProgress::OpenProgressDialog(mozIDOMWindowProxy *parentDOMWindow,</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+                                                nsIMsgWindow *aMsgWindow,</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+                                                const char *dialogURL,</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+                                                bool inDisplayModal,</span>
<a href="#l21.38"></a><span id="l21.38">                                                 nsISupports *parameters)</span>
<a href="#l21.39"></a><span id="l21.39"> {</span>
<a href="#l21.40"></a><span id="l21.40">   nsresult rv;</span>
<a href="#l21.41"></a><span id="l21.41"> </span>
<a href="#l21.42"></a><span id="l21.42">   if (aMsgWindow)</span>
<a href="#l21.43"></a><span id="l21.43">   {</span>
<a href="#l21.44"></a><span id="l21.44">     SetMsgWindow(aMsgWindow);</span>
<a href="#l21.45"></a><span id="l21.45">     aMsgWindow-&gt;SetStatusFeedback(this);</span>
<a href="#l21.46"></a><span id="l21.46">   }</span>
<a href="#l21.47"></a><span id="l21.47"> </span>
<a href="#l21.48"></a><span id="l21.48">   NS_ENSURE_ARG_POINTER(dialogURL);</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineminus">-  nsCOMPtr&lt;nsPIDOMWindow&gt; parent(do_QueryInterface(parentDOMWindow));</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineminus">-  NS_ENSURE_ARG_POINTER(parent);</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+  NS_ENSURE_ARG_POINTER(parentDOMWindow);</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; parent = nsPIDOMWindowOuter::From(parentDOMWindow);</span>
<a href="#l21.53"></a><span id="l21.53">   parent = parent-&gt;GetOuterWindow();</span>
<a href="#l21.54"></a><span id="l21.54">   NS_ENSURE_ARG_POINTER(parent);</span>
<a href="#l21.55"></a><span id="l21.55"> </span>
<a href="#l21.56"></a><span id="l21.56">   // Set up window.arguments[0]...</span>
<a href="#l21.57"></a><span id="l21.57">   nsCOMPtr&lt;nsIMutableArray&gt; array(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l21.58"></a><span id="l21.58">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l21.59"></a><span id="l21.59"> </span>
<a href="#l21.60"></a><span id="l21.60">   nsCOMPtr&lt;nsISupportsInterfacePointer&gt; ifptr =</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineat">@@ -65,17 +66,17 @@ NS_IMETHODIMP nsMsgProgress::OpenProgres</span>
<a href="#l21.62"></a><span id="l21.62"> </span>
<a href="#l21.63"></a><span id="l21.63">   ifptr-&gt;SetData(static_cast&lt;nsIMsgProgress*&gt;(this));</span>
<a href="#l21.64"></a><span id="l21.64">   ifptr-&gt;SetDataIID(&amp;NS_GET_IID(nsIMsgProgress));</span>
<a href="#l21.65"></a><span id="l21.65"> </span>
<a href="#l21.66"></a><span id="l21.66">   array-&gt;AppendElement(ifptr, false);</span>
<a href="#l21.67"></a><span id="l21.67">   array-&gt;AppendElement(parameters, false);</span>
<a href="#l21.68"></a><span id="l21.68"> </span>
<a href="#l21.69"></a><span id="l21.69">   // Open the dialog.</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; newWindow;</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; newWindow;</span>
<a href="#l21.72"></a><span id="l21.72"> </span>
<a href="#l21.73"></a><span id="l21.73">   nsString chromeOptions(NS_LITERAL_STRING(&quot;chrome,dependent,centerscreen&quot;));</span>
<a href="#l21.74"></a><span id="l21.74">   if (inDisplayModal)</span>
<a href="#l21.75"></a><span id="l21.75">     chromeOptions.AppendLiteral(&quot;,modal&quot;);</span>
<a href="#l21.76"></a><span id="l21.76"> </span>
<a href="#l21.77"></a><span id="l21.77">   return parent-&gt;OpenDialog(NS_ConvertASCIItoUTF16(dialogURL),</span>
<a href="#l21.78"></a><span id="l21.78">                             NS_LITERAL_STRING(&quot;_blank&quot;),</span>
<a href="#l21.79"></a><span id="l21.79">                             chromeOptions,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/src/nsMsgWindow.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgWindow.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -4,17 +4,17 @@</span>
<a href="#l22.4"></a><span id="l22.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.5"></a><span id="l22.5"> </span>
<a href="#l22.6"></a><span id="l22.6"> #include &quot;nsMsgWindow.h&quot;</span>
<a href="#l22.7"></a><span id="l22.7"> #include &quot;nsIURILoader.h&quot;</span>
<a href="#l22.8"></a><span id="l22.8"> #include &quot;nsCURILoader.h&quot;</span>
<a href="#l22.9"></a><span id="l22.9"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l22.10"></a><span id="l22.10"> #include &quot;nsIDocShellTreeItem.h&quot;</span>
<a href="#l22.11"></a><span id="l22.11"> #include &quot;nsIDOMElement.h&quot;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l22.14"></a><span id="l22.14"> #include &quot;nsTransactionManagerCID.h&quot;</span>
<a href="#l22.15"></a><span id="l22.15"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l22.16"></a><span id="l22.16"> #include &quot;nsILoadGroup.h&quot;</span>
<a href="#l22.17"></a><span id="l22.17"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l22.18"></a><span id="l22.18"> #include &quot;nsIInterfaceRequestor.h&quot;</span>
<a href="#l22.19"></a><span id="l22.19"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l22.20"></a><span id="l22.20"> #include &quot;nsIWebProgress.h&quot;</span>
<a href="#l22.21"></a><span id="l22.21"> #include &quot;nsIWebProgressListener.h&quot;</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineat">@@ -301,32 +301,32 @@ NS_IMETHODIMP nsMsgWindow::GetCharsetOve</span>
<a href="#l22.23"></a><span id="l22.23"> }</span>
<a href="#l22.24"></a><span id="l22.24"> </span>
<a href="#l22.25"></a><span id="l22.25"> NS_IMETHODIMP nsMsgWindow::SetCharsetOverride(bool aCharsetOverride)</span>
<a href="#l22.26"></a><span id="l22.26"> {</span>
<a href="#l22.27"></a><span id="l22.27">   mCharsetOverride = aCharsetOverride;</span>
<a href="#l22.28"></a><span id="l22.28">   return NS_OK;</span>
<a href="#l22.29"></a><span id="l22.29"> }</span>
<a href="#l22.30"></a><span id="l22.30"> </span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-NS_IMETHODIMP nsMsgWindow::GetDomWindow(nsIDOMWindow **aWindow)</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+NS_IMETHODIMP nsMsgWindow::GetDomWindow(mozIDOMWindowProxy **aWindow)</span>
<a href="#l22.33"></a><span id="l22.33"> {</span>
<a href="#l22.34"></a><span id="l22.34">   NS_ENSURE_ARG_POINTER(aWindow);</span>
<a href="#l22.35"></a><span id="l22.35">   if (mDomWindow)</span>
<a href="#l22.36"></a><span id="l22.36">     CallQueryReferent(mDomWindow.get(), aWindow);</span>
<a href="#l22.37"></a><span id="l22.37">   else</span>
<a href="#l22.38"></a><span id="l22.38">     *aWindow = nullptr;</span>
<a href="#l22.39"></a><span id="l22.39">   return NS_OK;</span>
<a href="#l22.40"></a><span id="l22.40"> }</span>
<a href="#l22.41"></a><span id="l22.41"> </span>
<a href="#l22.42"></a><span id="l22.42" class="difflineminus">-NS_IMETHODIMP nsMsgWindow::SetDomWindow(nsIDOMWindow * aWindow)</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineplus">+NS_IMETHODIMP nsMsgWindow::SetDomWindow(mozIDOMWindowProxy * aWindow)</span>
<a href="#l22.44"></a><span id="l22.44"> {</span>
<a href="#l22.45"></a><span id="l22.45">   NS_ENSURE_ARG_POINTER(aWindow);</span>
<a href="#l22.46"></a><span id="l22.46">   mDomWindow = do_GetWeakReference(aWindow);</span>
<a href="#l22.47"></a><span id="l22.47"> </span>
<a href="#l22.48"></a><span id="l22.48" class="difflineminus">-  nsCOMPtr&lt;nsPIDOMWindow&gt; win(do_QueryInterface(aWindow));</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; win = nsPIDOMWindowOuter::From(aWindow);</span>
<a href="#l22.50"></a><span id="l22.50">   nsIDocShell *docShell = nullptr;</span>
<a href="#l22.51"></a><span id="l22.51">   if (win)</span>
<a href="#l22.52"></a><span id="l22.52">     docShell = win-&gt;GetDocShell();</span>
<a href="#l22.53"></a><span id="l22.53"> </span>
<a href="#l22.54"></a><span id="l22.54">   nsCOMPtr&lt;nsIDocShellTreeItem&gt; docShellAsItem(do_QueryInterface(docShell));</span>
<a href="#l22.55"></a><span id="l22.55"> </span>
<a href="#l22.56"></a><span id="l22.56">   if(docShellAsItem)</span>
<a href="#l22.57"></a><span id="l22.57">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/compose/public/nsIMsgCompose.idl</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/compose/public/nsIMsgCompose.idl</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -11,17 +11,17 @@</span>
<a href="#l23.4"></a><span id="l23.4"> %{C++</span>
<a href="#l23.5"></a><span id="l23.5"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l23.6"></a><span id="l23.6"> %}</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8"> interface nsIMsgSend;</span>
<a href="#l23.9"></a><span id="l23.9"> interface nsIMsgIdentity;</span>
<a href="#l23.10"></a><span id="l23.10"> interface nsIMsgProgress;</span>
<a href="#l23.11"></a><span id="l23.11"> interface nsIDocShell;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-interface nsIDOMWindow;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+interface mozIDOMWindowProxy;</span>
<a href="#l23.14"></a><span id="l23.14"> interface nsIEditor;</span>
<a href="#l23.15"></a><span id="l23.15"> interface nsIMsgWindow;</span>
<a href="#l23.16"></a><span id="l23.16"> </span>
<a href="#l23.17"></a><span id="l23.17"> typedef long MSG_ComposeSaveType;</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19"> [scriptable, uuid(6953e50a-7531-11d3-85fe-006008948010)]</span>
<a href="#l23.20"></a><span id="l23.20"> interface nsIMsgCompSaveType {</span>
<a href="#l23.21"></a><span id="l23.21">     const long File     = 0;</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineat">@@ -93,30 +93,30 @@ native nsString(nsString);</span>
<a href="#l23.23"></a><span id="l23.23"> </span>
<a href="#l23.24"></a><span id="l23.24"> /* recycling listener interface */</span>
<a href="#l23.25"></a><span id="l23.25"> [scriptable, uuid(0b28cc56-1dd2-11b2-bbe4-99e6a314f8ba)]</span>
<a href="#l23.26"></a><span id="l23.26"> interface nsIMsgComposeRecyclingListener : nsISupports {</span>
<a href="#l23.27"></a><span id="l23.27">   void onClose();</span>
<a href="#l23.28"></a><span id="l23.28">   void onReopen(in nsIMsgComposeParams params);</span>
<a href="#l23.29"></a><span id="l23.29"> };</span>
<a href="#l23.30"></a><span id="l23.30"> </span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-[scriptable, uuid(d06ca5af-66b5-4a08-961f-5b47e88cee98)]</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+[scriptable, uuid(c6544b6b-06dd-43ac-89b5-949d7c81bb7b)]</span>
<a href="#l23.33"></a><span id="l23.33"> interface nsIMsgCompose : nsIMsgSendListener {</span>
<a href="#l23.34"></a><span id="l23.34"> </span>
<a href="#l23.35"></a><span id="l23.35">   /**</span>
<a href="#l23.36"></a><span id="l23.36">    * Initializes the msg compose object.</span>
<a href="#l23.37"></a><span id="l23.37">    *</span>
<a href="#l23.38"></a><span id="l23.38">    * @param aParams   An nsIMsgComposeParams object containing the initial</span>
<a href="#l23.39"></a><span id="l23.39">    *                  details for the compose.</span>
<a href="#l23.40"></a><span id="l23.40">    * @param aWindow   The optional window associated with this compose object.</span>
<a href="#l23.41"></a><span id="l23.41">    * @param aDocShell The optional docShell of the editor element that is used</span>
<a href="#l23.42"></a><span id="l23.42">    *                  for composing.</span>
<a href="#l23.43"></a><span id="l23.43">    */</span>
<a href="#l23.44"></a><span id="l23.44">   void initialize(in nsIMsgComposeParams aParams,</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineminus">-                  [optional] in nsIDOMWindow aWindow,</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineplus">+                  [optional] in mozIDOMWindowProxy aWindow,</span>
<a href="#l23.47"></a><span id="l23.47">                   [optional] in nsIDocShell aDocShell); </span>
<a href="#l23.48"></a><span id="l23.48"> </span>
<a href="#l23.49"></a><span id="l23.49">   /* ... */</span>
<a href="#l23.50"></a><span id="l23.50">   void SetDocumentCharset(in string charset);</span>
<a href="#l23.51"></a><span id="l23.51">   </span>
<a href="#l23.52"></a><span id="l23.52">   /* ... */</span>
<a href="#l23.53"></a><span id="l23.53">   void RegisterStateListener(in nsIMsgComposeStateListener stateListener);</span>
<a href="#l23.54"></a><span id="l23.54"> </span>
<a href="#l23.55"></a><span id="l23.55" class="difflineat">@@ -204,17 +204,17 @@ interface nsIMsgCompose : nsIMsgSendList</span>
<a href="#l23.56"></a><span id="l23.56">    * Clear the messageSend object to break any circular references</span>
<a href="#l23.57"></a><span id="l23.57">    */</span>
<a href="#l23.58"></a><span id="l23.58">    void clearMessageSend();</span>
<a href="#l23.59"></a><span id="l23.59"> </span>
<a href="#l23.60"></a><span id="l23.60">   /* ... */</span>
<a href="#l23.61"></a><span id="l23.61">   attribute nsIEditor editor;</span>
<a href="#l23.62"></a><span id="l23.62"> </span>
<a href="#l23.63"></a><span id="l23.63"> 	/* ... */</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineminus">-  readonly attribute nsIDOMWindow domWindow;</span>
<a href="#l23.65"></a><span id="l23.65" class="difflineplus">+  readonly attribute mozIDOMWindowProxy domWindow;</span>
<a href="#l23.66"></a><span id="l23.66"> </span>
<a href="#l23.67"></a><span id="l23.67"> 	/* ... */</span>
<a href="#l23.68"></a><span id="l23.68">   readonly attribute nsIMsgCompFields compFields;</span>
<a href="#l23.69"></a><span id="l23.69">     </span>
<a href="#l23.70"></a><span id="l23.70"> 	/* ... */</span>
<a href="#l23.71"></a><span id="l23.71">   readonly attribute boolean composeHTML;</span>
<a href="#l23.72"></a><span id="l23.72"> </span>
<a href="#l23.73"></a><span id="l23.73"> 	/* ... */</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineat">@@ -236,17 +236,17 @@ interface nsIMsgCompose : nsIMsgSendList</span>
<a href="#l23.75"></a><span id="l23.75"> </span>
<a href="#l23.76"></a><span id="l23.76">   /**</span>
<a href="#l23.77"></a><span id="l23.77">    *  Init the editor THIS USED TO BE [noscript]</span>
<a href="#l23.78"></a><span id="l23.78">    *  Now, this is called after editor is created,</span>
<a href="#l23.79"></a><span id="l23.79">    *  which is triggered by loading startup url from JS.</span>
<a href="#l23.80"></a><span id="l23.80">    *  The completion of document loading is detected by observing </span>
<a href="#l23.81"></a><span id="l23.81">    *  the &quot;obs_documentCreated&quot; command</span>
<a href="#l23.82"></a><span id="l23.82">    */</span>
<a href="#l23.83"></a><span id="l23.83" class="difflineminus">-  void initEditor(in nsIEditor editor, in nsIDOMWindow contentWindow);</span>
<a href="#l23.84"></a><span id="l23.84" class="difflineplus">+  void initEditor(in nsIEditor editor, in mozIDOMWindowProxy contentWindow);</span>
<a href="#l23.85"></a><span id="l23.85"> </span>
<a href="#l23.86"></a><span id="l23.86">   /* The following functions are for internal use, essentially for the listener */</span>
<a href="#l23.87"></a><span id="l23.87"> </span>
<a href="#l23.88"></a><span id="l23.88">   /* ... */</span>
<a href="#l23.89"></a><span id="l23.89">   [noscript] void setCiteReference(in nsString citeReference);</span>
<a href="#l23.90"></a><span id="l23.90"> </span>
<a href="#l23.91"></a><span id="l23.91">   /* Set the URI of the folder where the message has been saved */</span>
<a href="#l23.92"></a><span id="l23.92">   attribute string savedFolderURI;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/compose/public/nsIMsgComposeService.idl</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/compose/public/nsIMsgComposeService.idl</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -10,17 +10,17 @@</span>
<a href="#l24.4"></a><span id="l24.4"> </span>
<a href="#l24.5"></a><span id="l24.5"> interface nsIURI;</span>
<a href="#l24.6"></a><span id="l24.6"> interface nsIDocShell;</span>
<a href="#l24.7"></a><span id="l24.7"> interface nsIMsgWindow;</span>
<a href="#l24.8"></a><span id="l24.8"> interface nsIMsgIdentity;</span>
<a href="#l24.9"></a><span id="l24.9"> interface nsIMsgIncomingServer;</span>
<a href="#l24.10"></a><span id="l24.10"> interface nsIMsgDBHdr;</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-[scriptable, uuid(8de65170-a452-11e0-8264-0800200c9a66)]</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+[scriptable, uuid(041782bf-e523-444b-a268-d90868fd2b50)]</span>
<a href="#l24.14"></a><span id="l24.14"> interface nsIMsgComposeService : nsISupports {</span>
<a href="#l24.15"></a><span id="l24.15"> </span>
<a href="#l24.16"></a><span id="l24.16">   /* we need a msg window because when we forward inline we may need progress */</span>
<a href="#l24.17"></a><span id="l24.17">   void OpenComposeWindow(in string msgComposeWindowURL,</span>
<a href="#l24.18"></a><span id="l24.18">                          in nsIMsgDBHdr msgHdr,</span>
<a href="#l24.19"></a><span id="l24.19">                          in string originalMsgURI,</span>
<a href="#l24.20"></a><span id="l24.20">                          in MSG_ComposeType type, </span>
<a href="#l24.21"></a><span id="l24.21">                          in MSG_ComposeFormat format,</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -51,35 +51,35 @@ interface nsIMsgComposeService : nsISupp</span>
<a href="#l24.23"></a><span id="l24.23">    *</span>
<a href="#l24.24"></a><span id="l24.24">    * @param aParams   An nsIMsgComposeParams object containing the initial</span>
<a href="#l24.25"></a><span id="l24.25">    *                  details for the compose.</span>
<a href="#l24.26"></a><span id="l24.26">    * @param aWindow   The optional window associated with this compose object.</span>
<a href="#l24.27"></a><span id="l24.27">    * @param aDocShell The optional docShell of the editor element that is used</span>
<a href="#l24.28"></a><span id="l24.28">    *                  for composing.</span>
<a href="#l24.29"></a><span id="l24.29">    */</span>
<a href="#l24.30"></a><span id="l24.30">   nsIMsgCompose initCompose(in nsIMsgComposeParams aParams,</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-                            [optional] in nsIDOMWindow aWindow, </span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+                            [optional] in mozIDOMWindowProxy aWindow,</span>
<a href="#l24.33"></a><span id="l24.33">                             [optional] in nsIDocShell aDocShell);</span>
<a href="#l24.34"></a><span id="l24.34"> </span>
<a href="#l24.35"></a><span id="l24.35">   /**</span>
<a href="#l24.36"></a><span id="l24.36">   * defaultIdentity</span>
<a href="#l24.37"></a><span id="l24.37">   *</span>
<a href="#l24.38"></a><span id="l24.38">   * @return the default identity, in case no identity has been setup yet, will return null</span>
<a href="#l24.39"></a><span id="l24.39">   */</span>
<a href="#l24.40"></a><span id="l24.40">   readonly attribute nsIMsgIdentity defaultIdentity;</span>
<a href="#l24.41"></a><span id="l24.41"> </span>
<a href="#l24.42"></a><span id="l24.42">   /* This function is use for debugging purpose only and may go away at anytime without warning */</span>
<a href="#l24.43"></a><span id="l24.43">   void TimeStamp(in string label, in boolean resetTime);  </span>
<a href="#l24.44"></a><span id="l24.44">   </span>
<a href="#l24.45"></a><span id="l24.45">   /* This attribute is use for debugging purposes for determining whether to PR_LOG or not */</span>
<a href="#l24.46"></a><span id="l24.46">   readonly attribute boolean logComposePerformance;</span>
<a href="#l24.47"></a><span id="l24.47"> </span>
<a href="#l24.48"></a><span id="l24.48">   [noscript] boolean determineComposeHTML(in nsIMsgIdentity aIdentity, in MSG_ComposeFormat aFormat);</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineminus">-  [noscript] void cacheWindow(in nsIDOMWindow aWindow, in boolean aComposeHTML, in nsIMsgComposeRecyclingListener listener);</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-  boolean isCachedWindow(in nsIDOMWindow aWindow);</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+  [noscript] void cacheWindow(in mozIDOMWindowProxy aWindow, in boolean aComposeHTML, in nsIMsgComposeRecyclingListener listener);</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineplus">+  boolean isCachedWindow(in mozIDOMWindowProxy aWindow);</span>
<a href="#l24.53"></a><span id="l24.53"> </span>
<a href="#l24.54"></a><span id="l24.54">   /** </span>
<a href="#l24.55"></a><span id="l24.55">    * given a mailto url, parse the attributes and turn them into a nsIMsgComposeParams object</span>
<a href="#l24.56"></a><span id="l24.56">    * @return nsIMsgComposeParams which corresponds to the passed in mailto url</span>
<a href="#l24.57"></a><span id="l24.57">    */</span>
<a href="#l24.58"></a><span id="l24.58">   nsIMsgComposeParams getParamsForMailto(in nsIURI aURI); </span>
<a href="#l24.59"></a><span id="l24.59"> </span>
<a href="#l24.60"></a><span id="l24.60">   /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/compose/public/nsIMsgSend.idl</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/compose/public/nsIMsgSend.idl</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -30,16 +30,17 @@ interface nsIMsgHdr;</span>
<a href="#l25.4"></a><span id="l25.4"> interface nsIFile;</span>
<a href="#l25.5"></a><span id="l25.5"> interface nsIOutputStream;</span>
<a href="#l25.6"></a><span id="l25.6"> interface nsIMsgComposeSecure;</span>
<a href="#l25.7"></a><span id="l25.7"> interface nsIMsgStatusFeedback;</span>
<a href="#l25.8"></a><span id="l25.8"> interface nsIEditor;</span>
<a href="#l25.9"></a><span id="l25.9"> interface nsIArray;</span>
<a href="#l25.10"></a><span id="l25.10"> interface nsISupportsArray;</span>
<a href="#l25.11"></a><span id="l25.11"> interface nsIMsgAttachmentHandler;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+interface mozIDOMWindowProxy;</span>
<a href="#l25.13"></a><span id="l25.13"> </span>
<a href="#l25.14"></a><span id="l25.14"> typedef long nsMsgDeliverMode;</span>
<a href="#l25.15"></a><span id="l25.15"> </span>
<a href="#l25.16"></a><span id="l25.16"> [scriptable, uuid(c658cd1f-dc4a-43c0-911c-c6d3e569ca7e)]</span>
<a href="#l25.17"></a><span id="l25.17"> interface nsIMsgAttachmentData : nsISupports</span>
<a href="#l25.18"></a><span id="l25.18"> {</span>
<a href="#l25.19"></a><span id="l25.19">   /// The URL to attach.</span>
<a href="#l25.20"></a><span id="l25.20">   attribute nsIURI url;</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineat">@@ -147,17 +148,17 @@ interface nsIMsgEmbeddedImageData : nsIS</span>
<a href="#l25.22"></a><span id="l25.22"> class nsMsgAttachmentHandler;</span>
<a href="#l25.23"></a><span id="l25.23"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l25.24"></a><span id="l25.24"> #include &quot;nsTArray.h&quot;</span>
<a href="#l25.25"></a><span id="l25.25"> %}</span>
<a href="#l25.26"></a><span id="l25.26"> </span>
<a href="#l25.27"></a><span id="l25.27"> [ptr] native nsMsgAttachedFile(nsMsgAttachedFile);</span>
<a href="#l25.28"></a><span id="l25.28"> [ptr] native nsMsgAttachmentHandlerArray(nsTArray&lt;RefPtr&lt;nsMsgAttachmentHandler&gt;&gt;);</span>
<a href="#l25.29"></a><span id="l25.29"> </span>
<a href="#l25.30"></a><span id="l25.30" class="difflineminus">-[scriptable, uuid(adcea7be-0585-4f43-ab97-f2436ea5e002)]</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineplus">+[scriptable, uuid(747fdfa2-1754-4282-ab26-1e55fd8de13c)]</span>
<a href="#l25.32"></a><span id="l25.32"> interface nsIMsgSend : nsISupports</span>
<a href="#l25.33"></a><span id="l25.33"> {</span>
<a href="#l25.34"></a><span id="l25.34">   //</span>
<a href="#l25.35"></a><span id="l25.35">   // This is the primary interface for creating and sending RFC822 messages</span>
<a href="#l25.36"></a><span id="l25.36">   // in the new architecture. Currently, this method supports many arguments</span>
<a href="#l25.37"></a><span id="l25.37">   // that change the behavior of the operation. This will change in time to </span>
<a href="#l25.38"></a><span id="l25.38">   // be separate calls that will be more singluar in nature.</span>
<a href="#l25.39"></a><span id="l25.39">   //</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineat">@@ -211,17 +212,17 @@ interface nsIMsgSend : nsISupports</span>
<a href="#l25.41"></a><span id="l25.41">                               in boolean aIsDigest,</span>
<a href="#l25.42"></a><span id="l25.42">                               in boolean aDontDeliver,</span>
<a href="#l25.43"></a><span id="l25.43">                               in nsMsgDeliverMode aMode,</span>
<a href="#l25.44"></a><span id="l25.44">                               in nsIMsgDBHdr aMsgToReplace,</span>
<a href="#l25.45"></a><span id="l25.45">                               in string aBodyType,</span>
<a href="#l25.46"></a><span id="l25.46">                               in ACString aBody,</span>
<a href="#l25.47"></a><span id="l25.47">                               in nsIArray aAttachments,</span>
<a href="#l25.48"></a><span id="l25.48">                               in nsIArray aPreloadedAttachments,</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineminus">-                              in nsIDOMWindow aParentWindow,</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineplus">+                              in mozIDOMWindowProxy aParentWindow,</span>
<a href="#l25.51"></a><span id="l25.51">                               in nsIMsgProgress aProgress,</span>
<a href="#l25.52"></a><span id="l25.52">                               in nsIMsgSendListener aListener,</span>
<a href="#l25.53"></a><span id="l25.53">                               in string aPassword,</span>
<a href="#l25.54"></a><span id="l25.54">                               in AUTF8String aOriginalMsgURI,</span>
<a href="#l25.55"></a><span id="l25.55">                               in MSG_ComposeType aType);</span>
<a href="#l25.56"></a><span id="l25.56"> </span>
<a href="#l25.57"></a><span id="l25.57">   /**</span>
<a href="#l25.58"></a><span id="l25.58">    * Creates a file containing an rfc822 message, using the passed information.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -7,16 +7,17 @@</span>
<a href="#l26.4"></a><span id="l26.4"> #include &quot;nsIDOMDocument.h&quot;</span>
<a href="#l26.5"></a><span id="l26.5"> #include &quot;nsIDOMNode.h&quot;</span>
<a href="#l26.6"></a><span id="l26.6"> #include &quot;nsIDOMNodeList.h&quot;</span>
<a href="#l26.7"></a><span id="l26.7"> #include &quot;nsIDOMText.h&quot;</span>
<a href="#l26.8"></a><span id="l26.8"> #include &quot;nsIDOMHTMLImageElement.h&quot;</span>
<a href="#l26.9"></a><span id="l26.9"> #include &quot;nsIDOMHTMLLinkElement.h&quot;</span>
<a href="#l26.10"></a><span id="l26.10"> #include &quot;nsIDOMHTMLAnchorElement.h&quot;</span>
<a href="#l26.11"></a><span id="l26.11"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l26.13"></a><span id="l26.13"> #include &quot;nsISelectionController.h&quot;</span>
<a href="#l26.14"></a><span id="l26.14"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l26.15"></a><span id="l26.15"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l26.16"></a><span id="l26.16"> #include &quot;nsMsgQuote.h&quot;</span>
<a href="#l26.17"></a><span id="l26.17"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l26.18"></a><span id="l26.18"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l26.19"></a><span id="l26.19"> #include &quot;nsIDocumentEncoder.h&quot;    // for editor output flags</span>
<a href="#l26.20"></a><span id="l26.20"> #include &quot;nsMsgCompUtils.h&quot;</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineat">@@ -884,32 +885,31 @@ nsMsgCompose::GetQuotingToFollow(bool* q</span>
<a href="#l26.22"></a><span id="l26.22"> {</span>
<a href="#l26.23"></a><span id="l26.23">   NS_ENSURE_ARG(quotingToFollow);</span>
<a href="#l26.24"></a><span id="l26.24">   *quotingToFollow = mQuotingToFollow;</span>
<a href="#l26.25"></a><span id="l26.25">   return NS_OK;</span>
<a href="#l26.26"></a><span id="l26.26"> }</span>
<a href="#l26.27"></a><span id="l26.27"> </span>
<a href="#l26.28"></a><span id="l26.28"> NS_IMETHODIMP</span>
<a href="#l26.29"></a><span id="l26.29"> nsMsgCompose::Initialize(nsIMsgComposeParams *aParams,</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-                         nsIDOMWindow *aWindow,</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineplus">+                         mozIDOMWindowProxy *aWindow,</span>
<a href="#l26.32"></a><span id="l26.32">                          nsIDocShell *aDocShell)</span>
<a href="#l26.33"></a><span id="l26.33"> {</span>
<a href="#l26.34"></a><span id="l26.34">   NS_ENSURE_ARG_POINTER(aParams);</span>
<a href="#l26.35"></a><span id="l26.35">   nsresult rv;</span>
<a href="#l26.36"></a><span id="l26.36"> </span>
<a href="#l26.37"></a><span id="l26.37">   aParams-&gt;GetIdentity(getter_AddRefs(m_identity));</span>
<a href="#l26.38"></a><span id="l26.38"> </span>
<a href="#l26.39"></a><span id="l26.39">   if (aWindow)</span>
<a href="#l26.40"></a><span id="l26.40">   {</span>
<a href="#l26.41"></a><span id="l26.41">     m_window = aWindow;</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-    nsCOMPtr&lt;nsPIDOMWindow&gt; window(do_QueryInterface(aWindow));</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineminus">-    if (!window)</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineminus">-      return NS_ERROR_FAILURE;</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineminus">-</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineminus">-    nsCOMPtr&lt;nsIDocShellTreeItem&gt;  treeItem =</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineplus">+    nsCOMPtr&lt;nsPIDOMWindowOuter&gt; window = nsPIDOMWindowOuter::From(aWindow);</span>
<a href="#l26.48"></a><span id="l26.48" class="difflineplus">+    NS_ENSURE_TRUE(window, NS_ERROR_FAILURE);</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineplus">+</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineplus">+    nsCOMPtr&lt;nsIDocShellTreeItem&gt; treeItem =</span>
<a href="#l26.51"></a><span id="l26.51">       do_QueryInterface(window-&gt;GetDocShell());</span>
<a href="#l26.52"></a><span id="l26.52">     nsCOMPtr&lt;nsIDocShellTreeOwner&gt; treeOwner;</span>
<a href="#l26.53"></a><span id="l26.53">     rv = treeItem-&gt;GetTreeOwner(getter_AddRefs(treeOwner));</span>
<a href="#l26.54"></a><span id="l26.54">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l26.55"></a><span id="l26.55"> </span>
<a href="#l26.56"></a><span id="l26.56">     m_baseWindow = do_QueryInterface(treeOwner);</span>
<a href="#l26.57"></a><span id="l26.57"> </span>
<a href="#l26.58"></a><span id="l26.58">     window-&gt;GetDocShell()-&gt;SetAppType(nsIDocShell::APP_TYPE_EDITOR);</span>
<a href="#l26.59"></a><span id="l26.59" class="difflineat">@@ -1172,19 +1172,20 @@ nsMsgCompose::SendMsgToServer(MSG_Delive</span>
<a href="#l26.60"></a><span id="l26.60"> NS_IMETHODIMP nsMsgCompose::SendMsg(MSG_DeliverMode deliverMode, nsIMsgIdentity *identity, const char *accountKey, nsIMsgWindow *aMsgWindow, nsIMsgProgress *progress)</span>
<a href="#l26.61"></a><span id="l26.61"> {</span>
<a href="#l26.62"></a><span id="l26.62"> </span>
<a href="#l26.63"></a><span id="l26.63">   NS_ENSURE_TRUE(m_compFields, NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l26.64"></a><span id="l26.64">   nsresult rv = NS_OK;</span>
<a href="#l26.65"></a><span id="l26.65">   nsCOMPtr&lt;nsIPrompt&gt; prompt;</span>
<a href="#l26.66"></a><span id="l26.66"> </span>
<a href="#l26.67"></a><span id="l26.67">   // i'm assuming the compose window is still up at this point...</span>
<a href="#l26.68"></a><span id="l26.68" class="difflineminus">-  nsCOMPtr&lt;nsPIDOMWindow&gt; window(do_QueryInterface(m_window));</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineminus">-  if (window)</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+  if (m_window) {</span>
<a href="#l26.71"></a><span id="l26.71" class="difflineplus">+    nsCOMPtr&lt;nsPIDOMWindowOuter&gt; window = nsPIDOMWindowOuter::From(m_window);</span>
<a href="#l26.72"></a><span id="l26.72">     window-&gt;GetPrompter(getter_AddRefs(prompt));</span>
<a href="#l26.73"></a><span id="l26.73" class="difflineplus">+  }</span>
<a href="#l26.74"></a><span id="l26.74"> </span>
<a href="#l26.75"></a><span id="l26.75">   // Set content type based on which type of compose window we had.</span>
<a href="#l26.76"></a><span id="l26.76">   nsString contentType = (m_composeHTML) ? NS_LITERAL_STRING(&quot;text/html&quot;):</span>
<a href="#l26.77"></a><span id="l26.77">                                            NS_LITERAL_STRING(&quot;text/plain&quot;);</span>
<a href="#l26.78"></a><span id="l26.78">   nsString msgBody;</span>
<a href="#l26.79"></a><span id="l26.79">   if (m_editor)</span>
<a href="#l26.80"></a><span id="l26.80">   {</span>
<a href="#l26.81"></a><span id="l26.81">     // Reset message body previously stored in the compose fields</span>
<a href="#l26.82"></a><span id="l26.82" class="difflineat">@@ -1560,28 +1561,28 @@ NS_IMETHODIMP nsMsgCompose::SetEditor(ns</span>
<a href="#l26.83"></a><span id="l26.83">   m_editor = aEditor;</span>
<a href="#l26.84"></a><span id="l26.84">   return NS_OK;</span>
<a href="#l26.85"></a><span id="l26.85"> }</span>
<a href="#l26.86"></a><span id="l26.86"> </span>
<a href="#l26.87"></a><span id="l26.87"> // This used to be called BEFORE editor was created</span>
<a href="#l26.88"></a><span id="l26.88"> //  (it did the loadUrl that triggered editor creation)</span>
<a href="#l26.89"></a><span id="l26.89"> // It is called from JS after editor creation</span>
<a href="#l26.90"></a><span id="l26.90"> //  (loadUrl is done in JS)</span>
<a href="#l26.91"></a><span id="l26.91" class="difflineminus">-NS_IMETHODIMP nsMsgCompose::InitEditor(nsIEditor* aEditor, nsIDOMWindow* aContentWindow)</span>
<a href="#l26.92"></a><span id="l26.92" class="difflineplus">+NS_IMETHODIMP nsMsgCompose::InitEditor(nsIEditor* aEditor, mozIDOMWindowProxy* aContentWindow)</span>
<a href="#l26.93"></a><span id="l26.93"> {</span>
<a href="#l26.94"></a><span id="l26.94">   NS_ENSURE_ARG_POINTER(aEditor);</span>
<a href="#l26.95"></a><span id="l26.95">   NS_ENSURE_ARG_POINTER(aContentWindow);</span>
<a href="#l26.96"></a><span id="l26.96"> </span>
<a href="#l26.97"></a><span id="l26.97">   m_editor = aEditor;</span>
<a href="#l26.98"></a><span id="l26.98"> </span>
<a href="#l26.99"></a><span id="l26.99">   // Set the charset</span>
<a href="#l26.100"></a><span id="l26.100">   const nsDependentCString msgCharSet(m_compFields-&gt;GetCharacterSet());</span>
<a href="#l26.101"></a><span id="l26.101">   m_editor-&gt;SetDocumentCharacterSet(msgCharSet);</span>
<a href="#l26.102"></a><span id="l26.102"> </span>
<a href="#l26.103"></a><span id="l26.103" class="difflineminus">-  nsCOMPtr&lt;nsPIDOMWindow&gt; window = do_QueryInterface(aContentWindow);</span>
<a href="#l26.104"></a><span id="l26.104" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; window = nsPIDOMWindowOuter::From(aContentWindow);</span>
<a href="#l26.105"></a><span id="l26.105"> </span>
<a href="#l26.106"></a><span id="l26.106">   nsIDocShell *docShell = window-&gt;GetDocShell();</span>
<a href="#l26.107"></a><span id="l26.107">   NS_ENSURE_TRUE(docShell, NS_ERROR_UNEXPECTED);</span>
<a href="#l26.108"></a><span id="l26.108"> </span>
<a href="#l26.109"></a><span id="l26.109">   nsCOMPtr&lt;nsIContentViewer&gt; childCV;</span>
<a href="#l26.110"></a><span id="l26.110">   NS_ENSURE_SUCCESS(docShell-&gt;GetContentViewer(getter_AddRefs(childCV)), NS_ERROR_FAILURE);</span>
<a href="#l26.111"></a><span id="l26.111">   if (childCV)</span>
<a href="#l26.112"></a><span id="l26.112">   {</span>
<a href="#l26.113"></a><span id="l26.113" class="difflineat">@@ -1644,17 +1645,17 @@ nsresult nsMsgCompose::SetBodyModified(b</span>
<a href="#l26.114"></a><span id="l26.114">     else</span>
<a href="#l26.115"></a><span id="l26.115">       m_editor-&gt;ResetModificationCount();</span>
<a href="#l26.116"></a><span id="l26.116">   }</span>
<a href="#l26.117"></a><span id="l26.117"> </span>
<a href="#l26.118"></a><span id="l26.118">   return rv;</span>
<a href="#l26.119"></a><span id="l26.119"> }</span>
<a href="#l26.120"></a><span id="l26.120"> </span>
<a href="#l26.121"></a><span id="l26.121"> NS_IMETHODIMP</span>
<a href="#l26.122"></a><span id="l26.122" class="difflineminus">-nsMsgCompose::GetDomWindow(nsIDOMWindow * *aDomWindow)</span>
<a href="#l26.123"></a><span id="l26.123" class="difflineplus">+nsMsgCompose::GetDomWindow(mozIDOMWindowProxy * *aDomWindow)</span>
<a href="#l26.124"></a><span id="l26.124"> {</span>
<a href="#l26.125"></a><span id="l26.125">   NS_IF_ADDREF(*aDomWindow = m_window);</span>
<a href="#l26.126"></a><span id="l26.126">   return NS_OK;</span>
<a href="#l26.127"></a><span id="l26.127"> }</span>
<a href="#l26.128"></a><span id="l26.128"> </span>
<a href="#l26.129"></a><span id="l26.129"> nsresult nsMsgCompose::GetCompFields(nsIMsgCompFields * *aCompFields)</span>
<a href="#l26.130"></a><span id="l26.130"> {</span>
<a href="#l26.131"></a><span id="l26.131">   *aCompFields = (nsIMsgCompFields*)m_compFields;</span>
<a href="#l26.132"></a><span id="l26.132" class="difflineat">@@ -2713,20 +2714,21 @@ NS_IMETHODIMP QuotingOutputStreamListene</span>
<a href="#l26.133"></a><span id="l26.133">           compFields-&gt;SetTo(EmptyString());</span>
<a href="#l26.134"></a><span id="l26.134">       }</span>
<a href="#l26.135"></a><span id="l26.135"> </span>
<a href="#l26.136"></a><span id="l26.136">       if (!followUpTo.IsEmpty())</span>
<a href="#l26.137"></a><span id="l26.137">       {</span>
<a href="#l26.138"></a><span id="l26.138">         // Handle &quot;followup-to: poster&quot; magic keyword here</span>
<a href="#l26.139"></a><span id="l26.139">         if (followUpTo.EqualsLiteral(&quot;poster&quot;))</span>
<a href="#l26.140"></a><span id="l26.140">         {</span>
<a href="#l26.141"></a><span id="l26.141" class="difflineminus">-          nsCOMPtr&lt;nsIDOMWindow&gt; domWindow;</span>
<a href="#l26.142"></a><span id="l26.142" class="difflineplus">+          nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow;</span>
<a href="#l26.143"></a><span id="l26.143">           nsCOMPtr&lt;nsIPrompt&gt; prompt;</span>
<a href="#l26.144"></a><span id="l26.144">           compose-&gt;GetDomWindow(getter_AddRefs(domWindow));</span>
<a href="#l26.145"></a><span id="l26.145" class="difflineminus">-          nsCOMPtr&lt;nsPIDOMWindow&gt; composeWindow(do_QueryInterface(domWindow));</span>
<a href="#l26.146"></a><span id="l26.146" class="difflineplus">+          NS_ENSURE_TRUE(domWindow, NS_ERROR_FAILURE);</span>
<a href="#l26.147"></a><span id="l26.147" class="difflineplus">+          nsCOMPtr&lt;nsPIDOMWindowOuter&gt; composeWindow = nsPIDOMWindowOuter::From(domWindow);</span>
<a href="#l26.148"></a><span id="l26.148">           if (composeWindow)</span>
<a href="#l26.149"></a><span id="l26.149">             composeWindow-&gt;GetPrompter(getter_AddRefs(prompt));</span>
<a href="#l26.150"></a><span id="l26.150">           nsMsgDisplayMessageByName(prompt, MOZ_UTF16(&quot;followupToSenderMessage&quot;));</span>
<a href="#l26.151"></a><span id="l26.151"> </span>
<a href="#l26.152"></a><span id="l26.152">           if (!replyTo.IsEmpty())</span>
<a href="#l26.153"></a><span id="l26.153">           {</span>
<a href="#l26.154"></a><span id="l26.154">             compFields-&gt;SetTo(replyTo);</span>
<a href="#l26.155"></a><span id="l26.155">           }</span>
<a href="#l26.156"></a><span id="l26.156" class="difflineat">@@ -3621,17 +3623,17 @@ nsresult nsMsgComposeSendListener::OnSto</span>
<a href="#l26.157"></a><span id="l26.157">       nsCOMPtr&lt;nsIMsgCompFields&gt; compFields;</span>
<a href="#l26.158"></a><span id="l26.158">       msgCompose-&gt;GetCompFields(getter_AddRefs(compFields));</span>
<a href="#l26.159"></a><span id="l26.159"> </span>
<a href="#l26.160"></a><span id="l26.160">       // only process the reply flags if we successfully sent the message</span>
<a href="#l26.161"></a><span id="l26.161">       msgCompose-&gt;ProcessReplyFlags();</span>
<a href="#l26.162"></a><span id="l26.162"> </span>
<a href="#l26.163"></a><span id="l26.163">       // See if there is a composer window</span>
<a href="#l26.164"></a><span id="l26.164">       bool hasDomWindow = true;</span>
<a href="#l26.165"></a><span id="l26.165" class="difflineminus">-      nsCOMPtr&lt;nsIDOMWindow&gt; domWindow;</span>
<a href="#l26.166"></a><span id="l26.166" class="difflineplus">+      nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow;</span>
<a href="#l26.167"></a><span id="l26.167">       rv = msgCompose-&gt;GetDomWindow(getter_AddRefs(domWindow));</span>
<a href="#l26.168"></a><span id="l26.168">       if (NS_FAILED(rv) || !domWindow)</span>
<a href="#l26.169"></a><span id="l26.169">         hasDomWindow = false;</span>
<a href="#l26.170"></a><span id="l26.170"> </span>
<a href="#l26.171"></a><span id="l26.171">       // Close the window ONLY if we are not going to do a save operation</span>
<a href="#l26.172"></a><span id="l26.172">       nsAutoString fieldsFCC;</span>
<a href="#l26.173"></a><span id="l26.173">       if (NS_SUCCEEDED(compFields-&gt;GetFcc(fieldsFCC)))</span>
<a href="#l26.174"></a><span id="l26.174">       {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.h</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.h</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -16,45 +16,46 @@</span>
<a href="#l27.4"></a><span id="l27.4"> #include &quot;nsIMsgCopyServiceListener.h&quot;</span>
<a href="#l27.5"></a><span id="l27.5"> #include &quot;nsIBaseWindow.h&quot;</span>
<a href="#l27.6"></a><span id="l27.6"> #include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l27.7"></a><span id="l27.7"> #include &quot;nsIWebProgressListener.h&quot;</span>
<a href="#l27.8"></a><span id="l27.8"> #include &quot;nsIMimeConverter.h&quot;</span>
<a href="#l27.9"></a><span id="l27.9"> #include &quot;nsIUnicodeDecoder.h&quot;</span>
<a href="#l27.10"></a><span id="l27.10"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l27.11"></a><span id="l27.11"> #include &quot;nsIDOMNode.h&quot;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l27.13"></a><span id="l27.13"> </span>
<a href="#l27.14"></a><span id="l27.14"> // Forward declares</span>
<a href="#l27.15"></a><span id="l27.15"> class QuotingOutputStreamListener;</span>
<a href="#l27.16"></a><span id="l27.16"> class nsMsgComposeSendListener;</span>
<a href="#l27.17"></a><span id="l27.17"> class nsIEditorMailSupport;</span>
<a href="#l27.18"></a><span id="l27.18"> class nsIRDFService;</span>
<a href="#l27.19"></a><span id="l27.19"> class nsIArray;</span>
<a href="#l27.20"></a><span id="l27.20"> struct nsMsgMailList;</span>
<a href="#l27.21"></a><span id="l27.21"> </span>
<a href="#l27.22"></a><span id="l27.22"> class nsMsgCompose : public nsIMsgCompose, public nsSupportsWeakReference</span>
<a href="#l27.23"></a><span id="l27.23"> {</span>
<a href="#l27.24"></a><span id="l27.24">  public: </span>
<a href="#l27.25"></a><span id="l27.25"> </span>
<a href="#l27.26"></a><span id="l27.26" class="difflineminus">-	nsMsgCompose();</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineplus">+  nsMsgCompose();</span>
<a href="#l27.28"></a><span id="l27.28"> </span>
<a href="#l27.29"></a><span id="l27.29" class="difflineminus">-	/* this macro defines QueryInterface, AddRef and Release for this class */</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineminus">-	NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineplus">+  /* this macro defines QueryInterface, AddRef and Release for this class */</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+  NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l27.33"></a><span id="l27.33"> </span>
<a href="#l27.34"></a><span id="l27.34" class="difflineminus">-	/*** nsIMsgCompose pure virtual functions */</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineminus">-	NS_DECL_NSIMSGCOMPOSE</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineplus">+  /*** nsIMsgCompose pure virtual functions */</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineplus">+  NS_DECL_NSIMSGCOMPOSE</span>
<a href="#l27.38"></a><span id="l27.38"> </span>
<a href="#l27.39"></a><span id="l27.39">   /* nsIMsgSendListener interface */</span>
<a href="#l27.40"></a><span id="l27.40">   NS_DECL_NSIMSGSENDLISTENER</span>
<a href="#l27.41"></a><span id="l27.41"> </span>
<a href="#l27.42"></a><span id="l27.42"> protected:</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineminus">-	virtual ~nsMsgCompose();</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineplus">+  virtual ~nsMsgCompose();</span>
<a href="#l27.45"></a><span id="l27.45"> </span>
<a href="#l27.46"></a><span id="l27.46">  // Deal with quoting issues...</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineminus">-	nsresult                      QuoteOriginalMessage(); // New template</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineplus">+  nsresult                      QuoteOriginalMessage(); // New template</span>
<a href="#l27.49"></a><span id="l27.49">   nsresult                      SetQuotingToFollow(bool aVal);</span>
<a href="#l27.50"></a><span id="l27.50">   nsresult                      ConvertHTMLToText(nsIFile *aSigFile, nsString &amp;aSigData);</span>
<a href="#l27.51"></a><span id="l27.51">   nsresult                      ConvertTextToHTML(nsIFile *aSigFile, nsString &amp;aSigData);</span>
<a href="#l27.52"></a><span id="l27.52">   bool                          IsEmbeddedObjectSafe(const char * originalScheme,</span>
<a href="#l27.53"></a><span id="l27.53">                                                      const char * originalHost,</span>
<a href="#l27.54"></a><span id="l27.54">                                                      const char * originalPath,</span>
<a href="#l27.55"></a><span id="l27.55">                                                      nsIDOMNode * object);</span>
<a href="#l27.56"></a><span id="l27.56">   nsresult                      ResetUrisForEmbeddedObjects();</span>
<a href="#l27.57"></a><span id="l27.57" class="difflineat">@@ -94,52 +95,52 @@ protected:</span>
<a href="#l27.58"></a><span id="l27.58">    * the relevant cards from the address books.</span>
<a href="#l27.59"></a><span id="l27.59">    */</span>
<a href="#l27.60"></a><span id="l27.60">   nsresult LookupAddressBook(RecipientsArray &amp;recipientList);</span>
<a href="#l27.61"></a><span id="l27.61">   bool IsLastWindow();</span>
<a href="#l27.62"></a><span id="l27.62">  </span>
<a href="#l27.63"></a><span id="l27.63">        // Helper function. Parameters are not checked.</span>
<a href="#l27.64"></a><span id="l27.64">   bool                                      mConvertStructs;    // for TagConvertible</span>
<a href="#l27.65"></a><span id="l27.65">   </span>
<a href="#l27.66"></a><span id="l27.66" class="difflineminus">-	nsCOMPtr&lt;nsIEditor&gt;                       m_editor;</span>
<a href="#l27.67"></a><span id="l27.67" class="difflineminus">-	nsIDOMWindow                              *m_window;</span>
<a href="#l27.68"></a><span id="l27.68" class="difflineplus">+  nsCOMPtr&lt;nsIEditor&gt;                       m_editor;</span>
<a href="#l27.69"></a><span id="l27.69" class="difflineplus">+  mozIDOMWindowProxy                        *m_window;</span>
<a href="#l27.70"></a><span id="l27.70">   nsCOMPtr&lt;nsIDocShell&gt;                     mDocShell;</span>
<a href="#l27.71"></a><span id="l27.71">   nsCOMPtr&lt;nsIBaseWindow&gt;                   m_baseWindow;</span>
<a href="#l27.72"></a><span id="l27.72" class="difflineminus">-	nsMsgCompFields                           *m_compFields;</span>
<a href="#l27.73"></a><span id="l27.73" class="difflineminus">-	nsCOMPtr&lt;nsIMsgIdentity&gt;                  m_identity;</span>
<a href="#l27.74"></a><span id="l27.74" class="difflineminus">-	bool						                        m_composeHTML;</span>
<a href="#l27.75"></a><span id="l27.75" class="difflineminus">-	QuotingOutputStreamListener               *mQuoteStreamListener;</span>
<a href="#l27.76"></a><span id="l27.76" class="difflineminus">-	nsCOMPtr&lt;nsIOutputStream&gt;                 mBaseStream;</span>
<a href="#l27.77"></a><span id="l27.77" class="difflineplus">+  nsMsgCompFields                           *m_compFields;</span>
<a href="#l27.78"></a><span id="l27.78" class="difflineplus">+  nsCOMPtr&lt;nsIMsgIdentity&gt;                  m_identity;</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineplus">+  bool                                      m_composeHTML;</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineplus">+  QuotingOutputStreamListener               *mQuoteStreamListener;</span>
<a href="#l27.81"></a><span id="l27.81" class="difflineplus">+  nsCOMPtr&lt;nsIOutputStream&gt;                 mBaseStream;</span>
<a href="#l27.82"></a><span id="l27.82"> </span>
<a href="#l27.83"></a><span id="l27.83">   nsCOMPtr&lt;nsIMsgComposeRecyclingListener&gt;  mRecyclingListener;</span>
<a href="#l27.84"></a><span id="l27.84">   bool                                      mRecycledWindow;</span>
<a href="#l27.85"></a><span id="l27.85" class="difflineminus">-	nsCOMPtr&lt;nsIMsgSend&gt;                      mMsgSend;           // for composition back end</span>
<a href="#l27.86"></a><span id="l27.86" class="difflineminus">-	nsCOMPtr&lt;nsIMsgProgress&gt;                  mProgress;          // use by the back end to report progress to the front end</span>
<a href="#l27.87"></a><span id="l27.87" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSend&gt;                      mMsgSend;           // for composition back end</span>
<a href="#l27.88"></a><span id="l27.88" class="difflineplus">+  nsCOMPtr&lt;nsIMsgProgress&gt;                  mProgress;          // use by the back end to report progress to the front end</span>
<a href="#l27.89"></a><span id="l27.89"> </span>
<a href="#l27.90"></a><span id="l27.90">   // Deal with quoting issues...</span>
<a href="#l27.91"></a><span id="l27.91">   nsString                                  mCiteReference;</span>
<a href="#l27.92"></a><span id="l27.92" class="difflineminus">-	nsCOMPtr&lt;nsIMsgQuote&gt;                     mQuote;</span>
<a href="#l27.93"></a><span id="l27.93" class="difflineminus">-	bool						                        mQuotingToFollow;   // Quoting indicator</span>
<a href="#l27.94"></a><span id="l27.94" class="difflineminus">-	MSG_ComposeType                           mType;		          // Message type</span>
<a href="#l27.95"></a><span id="l27.95" class="difflineplus">+  nsCOMPtr&lt;nsIMsgQuote&gt;                     mQuote;</span>
<a href="#l27.96"></a><span id="l27.96" class="difflineplus">+  bool                                      mQuotingToFollow;   // Quoting indicator</span>
<a href="#l27.97"></a><span id="l27.97" class="difflineplus">+  MSG_ComposeType                           mType;              // Message type</span>
<a href="#l27.98"></a><span id="l27.98">   bool                                      mCharsetOverride;</span>
<a href="#l27.99"></a><span id="l27.99">   bool                                      mDeleteDraft;</span>
<a href="#l27.100"></a><span id="l27.100">   nsMsgDispositionState                     mDraftDisposition;</span>
<a href="#l27.101"></a><span id="l27.101">   nsCOMPtr &lt;nsIMsgDBHdr&gt;                    mOrigMsgHdr;</span>
<a href="#l27.102"></a><span id="l27.102"> </span>
<a href="#l27.103"></a><span id="l27.103">   nsCString                                 mSmtpPassword;</span>
<a href="#l27.104"></a><span id="l27.104">   nsCString                                 mHtmlToQuote;</span>
<a href="#l27.105"></a><span id="l27.105"> </span>
<a href="#l27.106"></a><span id="l27.106">   nsTObserverArray&lt;nsCOMPtr&lt;nsIMsgComposeStateListener&gt; &gt; mStateListeners;</span>
<a href="#l27.107"></a><span id="l27.107">   nsTObserverArray&lt;nsCOMPtr&lt;nsIMsgSendListener&gt; &gt; mExternalSendListeners;</span>
<a href="#l27.108"></a><span id="l27.108" class="difflineminus">-    </span>
<a href="#l27.109"></a><span id="l27.109" class="difflineplus">+</span>
<a href="#l27.110"></a><span id="l27.110">   bool                                      mInsertingQuotedContent;</span>
<a href="#l27.111"></a><span id="l27.111">   MSG_DeliverMode                           mDeliverMode;  // nsIMsgCompDeliverMode long.</span>
<a href="#l27.112"></a><span id="l27.112"> </span>
<a href="#l27.113"></a><span id="l27.113">   friend class QuotingOutputStreamListener;</span>
<a href="#l27.114"></a><span id="l27.114" class="difflineminus">-	friend class nsMsgComposeSendListener;</span>
<a href="#l27.115"></a><span id="l27.115" class="difflineplus">+  friend class nsMsgComposeSendListener;</span>
<a href="#l27.116"></a><span id="l27.116"> };</span>
<a href="#l27.117"></a><span id="l27.117"> </span>
<a href="#l27.118"></a><span id="l27.118"> ////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l27.119"></a><span id="l27.119"> // THIS IS THE CLASS THAT IS THE STREAM Listener OF THE HTML OUPUT</span>
<a href="#l27.120"></a><span id="l27.120"> // FROM LIBMIME. THIS IS FOR QUOTING</span>
<a href="#l27.121"></a><span id="l27.121"> ////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l27.122"></a><span id="l27.122"> class QuotingOutputStreamListener : public nsIMsgQuotingOutputStreamListener</span>
<a href="#l27.123"></a><span id="l27.123"> {</span>
<a href="#l27.124"></a><span id="l27.124" class="difflineat">@@ -164,32 +165,32 @@ public:</span>
<a href="#l27.125"></a><span id="l27.125">                                   bool delsp,</span>
<a href="#l27.126"></a><span id="l27.126">                                   bool formatted,</span>
<a href="#l27.127"></a><span id="l27.127">                                   bool disallowBreaks);</span>
<a href="#l27.128"></a><span id="l27.128">     NS_IMETHOD InsertToCompose(nsIEditor *aEditor, bool aHTMLEditor);</span>
<a href="#l27.129"></a><span id="l27.129">     NS_IMETHOD AppendToMsgBody(const nsCString &amp;inStr);</span>
<a href="#l27.130"></a><span id="l27.130"> </span>
<a href="#l27.131"></a><span id="l27.131"> private:</span>
<a href="#l27.132"></a><span id="l27.132">     virtual ~QuotingOutputStreamListener();</span>
<a href="#l27.133"></a><span id="l27.133" class="difflineminus">-    nsWeakPtr                 mWeakComposeObj;</span>
<a href="#l27.134"></a><span id="l27.134" class="difflineminus">-    nsString       				    mMsgBody;</span>
<a href="#l27.135"></a><span id="l27.135" class="difflineminus">-    nsString       				    mCitePrefix;</span>
<a href="#l27.136"></a><span id="l27.136" class="difflineminus">-    nsString       				    mSignature;</span>
<a href="#l27.137"></a><span id="l27.137" class="difflineminus">-    bool						        mQuoteHeaders;</span>
<a href="#l27.138"></a><span id="l27.138" class="difflineminus">-    bool						        mHeadersOnly;</span>
<a href="#l27.139"></a><span id="l27.139" class="difflineminus">-    nsCOMPtr&lt;nsIMimeHeaders&gt;	mHeaders;</span>
<a href="#l27.140"></a><span id="l27.140" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIdentity&gt;  mIdentity;</span>
<a href="#l27.141"></a><span id="l27.141" class="difflineminus">-    nsCOMPtr&lt;nsIMsgDBHdr&gt;     mOrigMsgHdr;</span>
<a href="#l27.142"></a><span id="l27.142" class="difflineminus">-    nsString                  mCiteReference;</span>
<a href="#l27.143"></a><span id="l27.143" class="difflineminus">-    nsCOMPtr&lt;nsIMimeConverter&gt; mMimeConverter;</span>
<a href="#l27.144"></a><span id="l27.144" class="difflineplus">+    nsWeakPtr                   mWeakComposeObj;</span>
<a href="#l27.145"></a><span id="l27.145" class="difflineplus">+    nsString                    mMsgBody;</span>
<a href="#l27.146"></a><span id="l27.146" class="difflineplus">+    nsString                    mCitePrefix;</span>
<a href="#l27.147"></a><span id="l27.147" class="difflineplus">+    nsString                    mSignature;</span>
<a href="#l27.148"></a><span id="l27.148" class="difflineplus">+    bool                        mQuoteHeaders;</span>
<a href="#l27.149"></a><span id="l27.149" class="difflineplus">+    bool                        mHeadersOnly;</span>
<a href="#l27.150"></a><span id="l27.150" class="difflineplus">+    nsCOMPtr&lt;nsIMimeHeaders&gt;    mHeaders;</span>
<a href="#l27.151"></a><span id="l27.151" class="difflineplus">+    nsCOMPtr&lt;nsIMsgIdentity&gt;    mIdentity;</span>
<a href="#l27.152"></a><span id="l27.152" class="difflineplus">+    nsCOMPtr&lt;nsIMsgDBHdr&gt;       mOrigMsgHdr;</span>
<a href="#l27.153"></a><span id="l27.153" class="difflineplus">+    nsString                    mCiteReference;</span>
<a href="#l27.154"></a><span id="l27.154" class="difflineplus">+    nsCOMPtr&lt;nsIMimeConverter&gt;  mMimeConverter;</span>
<a href="#l27.155"></a><span id="l27.155">     nsCOMPtr&lt;nsIUnicodeDecoder&gt; mUnicodeDecoder;</span>
<a href="#l27.156"></a><span id="l27.156" class="difflineminus">-    int32_t                   mUnicodeBufferCharacterLength;</span>
<a href="#l27.157"></a><span id="l27.157" class="difflineminus">-    char16_t*                mUnicodeConversionBuffer;</span>
<a href="#l27.158"></a><span id="l27.158" class="difflineminus">-    bool                      mQuoteOriginal;</span>
<a href="#l27.159"></a><span id="l27.159" class="difflineminus">-    nsCString                 mHtmlToQuote;</span>
<a href="#l27.160"></a><span id="l27.160" class="difflineplus">+    int32_t                     mUnicodeBufferCharacterLength;</span>
<a href="#l27.161"></a><span id="l27.161" class="difflineplus">+    char16_t*                   mUnicodeConversionBuffer;</span>
<a href="#l27.162"></a><span id="l27.162" class="difflineplus">+    bool                        mQuoteOriginal;</span>
<a href="#l27.163"></a><span id="l27.163" class="difflineplus">+    nsCString                   mHtmlToQuote;</span>
<a href="#l27.164"></a><span id="l27.164"> };</span>
<a href="#l27.165"></a><span id="l27.165"> </span>
<a href="#l27.166"></a><span id="l27.166"> ////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l27.167"></a><span id="l27.167"> // This is the listener class for the send operation. We have to create this class </span>
<a href="#l27.168"></a><span id="l27.168"> // to listen for message send completion and eventually notify the caller</span>
<a href="#l27.169"></a><span id="l27.169"> ////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l27.170"></a><span id="l27.170"> class nsMsgComposeSendListener : public nsIMsgComposeSendListener, public nsIMsgSendListener, public nsIMsgCopyServiceListener, public nsIWebProgressListener</span>
<a href="#l27.171"></a><span id="l27.171"> {</span>
<a href="#l27.172"></a><span id="l27.172" class="difflineat">@@ -203,26 +204,26 @@ public:</span>
<a href="#l27.173"></a><span id="l27.173">   NS_DECL_NSIMSGCOMPOSESENDLISTENER</span>
<a href="#l27.174"></a><span id="l27.174"> </span>
<a href="#l27.175"></a><span id="l27.175">   // nsIMsgSendListener interface</span>
<a href="#l27.176"></a><span id="l27.176">   NS_DECL_NSIMSGSENDLISTENER</span>
<a href="#l27.177"></a><span id="l27.177">   </span>
<a href="#l27.178"></a><span id="l27.178">   // nsIMsgCopyServiceListener interface</span>
<a href="#l27.179"></a><span id="l27.179">   NS_DECL_NSIMSGCOPYSERVICELISTENER</span>
<a href="#l27.180"></a><span id="l27.180">   </span>
<a href="#l27.181"></a><span id="l27.181" class="difflineminus">-	// nsIWebProgressListener interface</span>
<a href="#l27.182"></a><span id="l27.182" class="difflineminus">-	NS_DECL_NSIWEBPROGRESSLISTENER</span>
<a href="#l27.183"></a><span id="l27.183" class="difflineplus">+  // nsIWebProgressListener interface</span>
<a href="#l27.184"></a><span id="l27.184" class="difflineplus">+  NS_DECL_NSIWEBPROGRESSLISTENER</span>
<a href="#l27.185"></a><span id="l27.185"> </span>
<a href="#l27.186"></a><span id="l27.186">   nsresult    RemoveCurrentDraftMessage(nsIMsgCompose *compObj, bool calledByCopy);</span>
<a href="#l27.187"></a><span id="l27.187">   nsresult    GetMsgFolder(nsIMsgCompose *compObj, nsIMsgFolder **msgFolder);</span>
<a href="#l27.188"></a><span id="l27.188"> </span>
<a href="#l27.189"></a><span id="l27.189"> private:</span>
<a href="#l27.190"></a><span id="l27.190">   virtual ~nsMsgComposeSendListener();</span>
<a href="#l27.191"></a><span id="l27.191">   nsWeakPtr               mWeakComposeObj;</span>
<a href="#l27.192"></a><span id="l27.192" class="difflineminus">-	MSG_DeliverMode         mDeliverMode;</span>
<a href="#l27.193"></a><span id="l27.193" class="difflineplus">+  MSG_DeliverMode         mDeliverMode;</span>
<a href="#l27.194"></a><span id="l27.194"> };</span>
<a href="#l27.195"></a><span id="l27.195"> </span>
<a href="#l27.196"></a><span id="l27.196"> /******************************************************************************</span>
<a href="#l27.197"></a><span id="l27.197">  * nsMsgMailList</span>
<a href="#l27.198"></a><span id="l27.198">  ******************************************************************************/</span>
<a href="#l27.199"></a><span id="l27.199"> struct nsMsgMailList</span>
<a href="#l27.200"></a><span id="l27.200"> {</span>
<a href="#l27.201"></a><span id="l27.201">   explicit nsMsgMailList(nsIAbDirectory* directory);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeContentHandler.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeContentHandler.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -8,17 +8,17 @@</span>
<a href="#l28.4"></a><span id="l28.4"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l28.5"></a><span id="l28.5"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l28.6"></a><span id="l28.6"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l28.7"></a><span id="l28.7"> #include &quot;nsIURI.h&quot;</span>
<a href="#l28.8"></a><span id="l28.8"> #include &quot;plstr.h&quot;</span>
<a href="#l28.9"></a><span id="l28.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l28.10"></a><span id="l28.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l28.11"></a><span id="l28.11"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l28.14"></a><span id="l28.14"> #include &quot;nsIDocument.h&quot;</span>
<a href="#l28.15"></a><span id="l28.15"> #include &quot;nsIDOMDocument.h&quot;</span>
<a href="#l28.16"></a><span id="l28.16"> #include &quot;nsIInterfaceRequestor.h&quot;</span>
<a href="#l28.17"></a><span id="l28.17"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l28.18"></a><span id="l28.18"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l28.19"></a><span id="l28.19"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l28.20"></a><span id="l28.20"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l28.21"></a><span id="l28.21"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -41,20 +41,19 @@ nsMsgComposeContentHandler::~nsMsgCompos</span>
<a href="#l28.23"></a><span id="l28.23"> // Try to get an appropriate nsIMsgIdentity by going through the window, getting</span>
<a href="#l28.24"></a><span id="l28.24"> // the document's URI, then the corresponding nsIMsgDBHdr. Then find the server</span>
<a href="#l28.25"></a><span id="l28.25"> // associated with that header and get the first identity for it.</span>
<a href="#l28.26"></a><span id="l28.26"> nsresult nsMsgComposeContentHandler::GetBestIdentity(</span>
<a href="#l28.27"></a><span id="l28.27">   nsIInterfaceRequestor* aWindowContext, nsIMsgIdentity **aIdentity)</span>
<a href="#l28.28"></a><span id="l28.28"> {</span>
<a href="#l28.29"></a><span id="l28.29">   nsresult rv;</span>
<a href="#l28.30"></a><span id="l28.30"> </span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; domWindow = do_GetInterface(aWindowContext);</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">-  nsCOMPtr&lt;nsPIDOMWindow&gt; window = do_QueryInterface(domWindow);</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineminus">-  if (!window)</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineminus">-    return NS_ERROR_FAILURE;</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow = do_GetInterface(aWindowContext);</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineplus">+  NS_ENSURE_TRUE(domWindow, NS_ERROR_FAILURE);</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; window = nsPIDOMWindowOuter::From(domWindow);</span>
<a href="#l28.38"></a><span id="l28.38"> </span>
<a href="#l28.39"></a><span id="l28.39">   nsAutoString documentURIString;</span>
<a href="#l28.40"></a><span id="l28.40">   window-&gt;GetDoc()-&gt;GetDocumentURI(documentURIString);</span>
<a href="#l28.41"></a><span id="l28.41"> </span>
<a href="#l28.42"></a><span id="l28.42">   nsCOMPtr&lt;nsIURI&gt; documentURI;</span>
<a href="#l28.43"></a><span id="l28.43">   rv = NS_NewURI(getter_AddRefs(documentURI), documentURIString);</span>
<a href="#l28.44"></a><span id="l28.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.45"></a><span id="l28.45"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -11,17 +11,17 @@</span>
<a href="#l29.4"></a><span id="l29.4"> #include &quot;nsIMsgIdentity.h&quot;</span>
<a href="#l29.5"></a><span id="l29.5"> #include &quot;nsISmtpUrl.h&quot;</span>
<a href="#l29.6"></a><span id="l29.6"> #include &quot;nsIURI.h&quot;</span>
<a href="#l29.7"></a><span id="l29.7"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l29.8"></a><span id="l29.8"> #include &quot;nsIMsgComposeParams.h&quot;</span>
<a href="#l29.9"></a><span id="l29.9"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l29.10"></a><span id="l29.10"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l29.11"></a><span id="l29.11"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l29.14"></a><span id="l29.14"> #include &quot;nsIContentViewer.h&quot;</span>
<a href="#l29.15"></a><span id="l29.15"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l29.16"></a><span id="l29.16"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l29.17"></a><span id="l29.17"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l29.18"></a><span id="l29.18"> #include &quot;nsIDOMDocument.h&quot;</span>
<a href="#l29.19"></a><span id="l29.19"> #include &quot;nsIDOMHTMLDocument.h&quot;</span>
<a href="#l29.20"></a><span id="l29.20"> #include &quot;nsIDOMElement.h&quot;</span>
<a href="#l29.21"></a><span id="l29.21"> #include &quot;nsIXULWindow.h&quot;</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineat">@@ -248,17 +248,17 @@ nsMsgComposeService::OpenComposeWindowWi</span>
<a href="#l29.23"></a><span id="l29.23">       int32_t i;</span>
<a href="#l29.24"></a><span id="l29.24">       for (i = 0; i &lt; mMaxRecycledWindows; i ++)</span>
<a href="#l29.25"></a><span id="l29.25">       {</span>
<a href="#l29.26"></a><span id="l29.26">         if (mCachedWindows[i].window &amp;&amp; (mCachedWindows[i].htmlCompose == composeHTML) &amp;&amp; mCachedWindows[i].listener)</span>
<a href="#l29.27"></a><span id="l29.27">         {</span>
<a href="#l29.28"></a><span id="l29.28">           /* We need to save the window pointer as OnReopen will call nsMsgComposeService::InitCompose which will</span>
<a href="#l29.29"></a><span id="l29.29">              clear the cache entry if everything goes well</span>
<a href="#l29.30"></a><span id="l29.30">           */</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">-          nsCOMPtr&lt;nsIDOMWindow&gt; domWindow(mCachedWindows[i].window);</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+          nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow(mCachedWindows[i].window);</span>
<a href="#l29.33"></a><span id="l29.33">           nsCOMPtr&lt;nsIXULWindow&gt; xulWindow(mCachedWindows[i].xulWindow);</span>
<a href="#l29.34"></a><span id="l29.34">           rv = ShowCachedComposeWindow(domWindow, xulWindow, true);</span>
<a href="#l29.35"></a><span id="l29.35">           if (NS_SUCCEEDED(rv))</span>
<a href="#l29.36"></a><span id="l29.36">           {</span>
<a href="#l29.37"></a><span id="l29.37">             mCachedWindows[i].listener-&gt;OnReopen(params);</span>
<a href="#l29.38"></a><span id="l29.38">             return NS_OK;</span>
<a href="#l29.39"></a><span id="l29.39">           }</span>
<a href="#l29.40"></a><span id="l29.40">         }</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineat">@@ -273,32 +273,32 @@ nsMsgComposeService::OpenComposeWindowWi</span>
<a href="#l29.42"></a><span id="l29.42"> </span>
<a href="#l29.43"></a><span id="l29.43">   nsCOMPtr&lt;nsISupportsInterfacePointer&gt; msgParamsWrapper =</span>
<a href="#l29.44"></a><span id="l29.44">     do_CreateInstance(NS_SUPPORTS_INTERFACE_POINTER_CONTRACTID, &amp;rv);</span>
<a href="#l29.45"></a><span id="l29.45">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.46"></a><span id="l29.46"> </span>
<a href="#l29.47"></a><span id="l29.47">   msgParamsWrapper-&gt;SetData(params);</span>
<a href="#l29.48"></a><span id="l29.48">   msgParamsWrapper-&gt;SetDataIID(&amp;NS_GET_IID(nsIMsgComposeParams));</span>
<a href="#l29.49"></a><span id="l29.49"> </span>
<a href="#l29.50"></a><span id="l29.50" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; newWindow;</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; newWindow;</span>
<a href="#l29.52"></a><span id="l29.52">   rv = wwatch-&gt;OpenWindow(0, chrome &amp;&amp; *chrome ? chrome : DEFAULT_CHROME,</span>
<a href="#l29.53"></a><span id="l29.53">                  &quot;_blank&quot;, &quot;all,chrome,dialog=no,status,toolbar&quot;, msgParamsWrapper,</span>
<a href="#l29.54"></a><span id="l29.54">                  getter_AddRefs(newWindow));</span>
<a href="#l29.55"></a><span id="l29.55"> </span>
<a href="#l29.56"></a><span id="l29.56">   return rv;</span>
<a href="#l29.57"></a><span id="l29.57"> }</span>
<a href="#l29.58"></a><span id="l29.58"> </span>
<a href="#l29.59"></a><span id="l29.59" class="difflineminus">-void nsMsgComposeService::CloseHiddenCachedWindow(nsIDOMWindow *domWindow)</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineplus">+void nsMsgComposeService::CloseHiddenCachedWindow(mozIDOMWindowProxy *domWindow)</span>
<a href="#l29.61"></a><span id="l29.61"> {</span>
<a href="#l29.62"></a><span id="l29.62">   if (domWindow)</span>
<a href="#l29.63"></a><span id="l29.63">   {</span>
<a href="#l29.64"></a><span id="l29.64">     nsCOMPtr&lt;nsIDocShell&gt; docshell;</span>
<a href="#l29.65"></a><span id="l29.65" class="difflineminus">-    nsCOMPtr&lt;nsPIDOMWindow&gt; window(do_QueryInterface(domWindow));</span>
<a href="#l29.66"></a><span id="l29.66" class="difflineminus">-    if (window)</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineplus">+    if (domWindow)</span>
<a href="#l29.68"></a><span id="l29.68">     {</span>
<a href="#l29.69"></a><span id="l29.69" class="difflineplus">+      nsCOMPtr&lt;nsPIDOMWindowOuter&gt; window = nsPIDOMWindowOuter::From(domWindow);</span>
<a href="#l29.70"></a><span id="l29.70">       nsCOMPtr&lt;nsIDocShellTreeItem&gt; treeItem =</span>
<a href="#l29.71"></a><span id="l29.71">         do_QueryInterface(window-&gt;GetDocShell());</span>
<a href="#l29.72"></a><span id="l29.72"> </span>
<a href="#l29.73"></a><span id="l29.73">       if (treeItem)</span>
<a href="#l29.74"></a><span id="l29.74">       {</span>
<a href="#l29.75"></a><span id="l29.75">         nsCOMPtr&lt;nsIDocShellTreeOwner&gt; treeOwner;</span>
<a href="#l29.76"></a><span id="l29.76">         treeItem-&gt;GetTreeOwner(getter_AddRefs(treeOwner));</span>
<a href="#l29.77"></a><span id="l29.77">         if (treeOwner)</span>
<a href="#l29.78"></a><span id="l29.78" class="difflineat">@@ -415,20 +415,19 @@ nsMsgComposeService::GetOrigWindowSelect</span>
<a href="#l29.79"></a><span id="l29.79">   nsCOMPtr&lt;nsIDocShellTreeItem&gt; childAsItem;</span>
<a href="#l29.80"></a><span id="l29.80">   rv = rootDocShell-&gt;FindChildWithName(MOZ_UTF16(&quot;messagepane&quot;),</span>
<a href="#l29.81"></a><span id="l29.81">                                        true, false, nullptr, nullptr, getter_AddRefs(childAsItem));</span>
<a href="#l29.82"></a><span id="l29.82">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.83"></a><span id="l29.83"> </span>
<a href="#l29.84"></a><span id="l29.84">   nsCOMPtr&lt;nsIDocShell&gt; docShell(do_QueryInterface(childAsItem, &amp;rv));</span>
<a href="#l29.85"></a><span id="l29.85">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.86"></a><span id="l29.86"> </span>
<a href="#l29.87"></a><span id="l29.87" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; domWindow(do_GetInterface(childAsItem, &amp;rv));</span>
<a href="#l29.88"></a><span id="l29.88" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.89"></a><span id="l29.89" class="difflineminus">-  nsCOMPtr&lt;nsPIDOMWindow&gt; privateWindow(do_QueryInterface(domWindow, &amp;rv));</span>
<a href="#l29.90"></a><span id="l29.90" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.91"></a><span id="l29.91" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindow&gt; domWindow(do_GetInterface(childAsItem));</span>
<a href="#l29.92"></a><span id="l29.92" class="difflineplus">+  NS_ENSURE_TRUE(domWindow, NS_ERROR_FAILURE);</span>
<a href="#l29.93"></a><span id="l29.93" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowInner&gt; privateWindow = nsPIDOMWindowInner::From(domWindow);</span>
<a href="#l29.94"></a><span id="l29.94">   nsCOMPtr&lt;nsISelection&gt; sel = privateWindow-&gt;GetSelection();</span>
<a href="#l29.95"></a><span id="l29.95">   NS_ENSURE_TRUE(sel, NS_ERROR_FAILURE);</span>
<a href="#l29.96"></a><span id="l29.96"> </span>
<a href="#l29.97"></a><span id="l29.97">   bool requireMultipleWords = true;</span>
<a href="#l29.98"></a><span id="l29.98">   nsAutoCString charsOnlyIf;</span>
<a href="#l29.99"></a><span id="l29.99">   prefs-&gt;GetBoolPref(PREF_MAILNEWS_REPLY_QUOTING_SELECTION_MULTI_WORD, &amp;requireMultipleWords);</span>
<a href="#l29.100"></a><span id="l29.100">   prefs-&gt;GetCharPref(PREF_MAILNEWS_REPLY_QUOTING_SELECTION_ONLY_IF, getter_Copies(charsOnlyIf));</span>
<a href="#l29.101"></a><span id="l29.101">   if (sel &amp;&amp; (requireMultipleWords || !charsOnlyIf.IsEmpty()))</span>
<a href="#l29.102"></a><span id="l29.102" class="difflineat">@@ -706,17 +705,17 @@ NS_IMETHODIMP nsMsgComposeService::OpenC</span>
<a href="#l29.103"></a><span id="l29.103">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l29.104"></a><span id="l29.104">     pMsgComposeParams-&gt;SetIdentity(identity);</span>
<a href="#l29.105"></a><span id="l29.105">     rv = OpenComposeWindowWithParams(aMsgComposeWindowURL, pMsgComposeParams);</span>
<a href="#l29.106"></a><span id="l29.106">   }</span>
<a href="#l29.107"></a><span id="l29.107">   return rv;</span>
<a href="#l29.108"></a><span id="l29.108"> }</span>
<a href="#l29.109"></a><span id="l29.109"> </span>
<a href="#l29.110"></a><span id="l29.110"> NS_IMETHODIMP nsMsgComposeService::InitCompose(nsIMsgComposeParams *aParams,</span>
<a href="#l29.111"></a><span id="l29.111" class="difflineminus">-                                               nsIDOMWindow *aWindow,</span>
<a href="#l29.112"></a><span id="l29.112" class="difflineplus">+                                               mozIDOMWindowProxy *aWindow,</span>
<a href="#l29.113"></a><span id="l29.113">                                                nsIDocShell *aDocShell,</span>
<a href="#l29.114"></a><span id="l29.114">                                                nsIMsgCompose **_retval)</span>
<a href="#l29.115"></a><span id="l29.115"> {</span>
<a href="#l29.116"></a><span id="l29.116">   // We need to remove the window from the cache.</span>
<a href="#l29.117"></a><span id="l29.117">   int32_t i;</span>
<a href="#l29.118"></a><span id="l29.118">   for (i = 0; i &lt; mMaxRecycledWindows; i ++)</span>
<a href="#l29.119"></a><span id="l29.119">     if (mCachedWindows[i].window == aWindow)</span>
<a href="#l29.120"></a><span id="l29.120">     {</span>
<a href="#l29.121"></a><span id="l29.121" class="difflineat">@@ -787,17 +786,17 @@ NS_IMETHODIMP nsMsgComposeService::TimeS</span>
<a href="#l29.122"></a><span id="l29.122"> ((double)totalTime/1000.0) + 0.005, ((double)deltaTime/1000.0) + 0.005, label));</span>
<a href="#l29.123"></a><span id="l29.123"> </span>
<a href="#l29.124"></a><span id="l29.124">   mPreviousTime = now;</span>
<a href="#l29.125"></a><span id="l29.125"> #endif</span>
<a href="#l29.126"></a><span id="l29.126">   return NS_OK;</span>
<a href="#l29.127"></a><span id="l29.127"> }</span>
<a href="#l29.128"></a><span id="l29.128"> </span>
<a href="#l29.129"></a><span id="l29.129"> NS_IMETHODIMP</span>
<a href="#l29.130"></a><span id="l29.130" class="difflineminus">-nsMsgComposeService::IsCachedWindow(nsIDOMWindow *aCachedWindow, bool *aIsCachedWindow)</span>
<a href="#l29.131"></a><span id="l29.131" class="difflineplus">+nsMsgComposeService::IsCachedWindow(mozIDOMWindowProxy *aCachedWindow, bool *aIsCachedWindow)</span>
<a href="#l29.132"></a><span id="l29.132"> {</span>
<a href="#l29.133"></a><span id="l29.133">   NS_ENSURE_ARG_POINTER(aCachedWindow);</span>
<a href="#l29.134"></a><span id="l29.134">   NS_ENSURE_ARG_POINTER(aIsCachedWindow);</span>
<a href="#l29.135"></a><span id="l29.135"> </span>
<a href="#l29.136"></a><span id="l29.136">   int32_t i;</span>
<a href="#l29.137"></a><span id="l29.137">   for (i = 0; i &lt; mMaxRecycledWindows; i ++)</span>
<a href="#l29.138"></a><span id="l29.138">     if (mCachedWindows[i].window.get() == aCachedWindow)</span>
<a href="#l29.139"></a><span id="l29.139">     {</span>
<a href="#l29.140"></a><span id="l29.140" class="difflineat">@@ -805,24 +804,23 @@ nsMsgComposeService::IsCachedWindow(nsID</span>
<a href="#l29.141"></a><span id="l29.141">       return NS_OK;</span>
<a href="#l29.142"></a><span id="l29.142">     }</span>
<a href="#l29.143"></a><span id="l29.143"> </span>
<a href="#l29.144"></a><span id="l29.144">  *aIsCachedWindow = false;</span>
<a href="#l29.145"></a><span id="l29.145">   return NS_OK;</span>
<a href="#l29.146"></a><span id="l29.146"> }</span>
<a href="#l29.147"></a><span id="l29.147"> </span>
<a href="#l29.148"></a><span id="l29.148"> NS_IMETHODIMP</span>
<a href="#l29.149"></a><span id="l29.149" class="difflineminus">-nsMsgComposeService::CacheWindow(nsIDOMWindow *aWindow, bool aComposeHTML, nsIMsgComposeRecyclingListener * aListener)</span>
<a href="#l29.150"></a><span id="l29.150" class="difflineplus">+nsMsgComposeService::CacheWindow(mozIDOMWindowProxy *aWindow, bool aComposeHTML, nsIMsgComposeRecyclingListener * aListener)</span>
<a href="#l29.151"></a><span id="l29.151"> {</span>
<a href="#l29.152"></a><span id="l29.152">   NS_ENSURE_ARG_POINTER(aWindow);</span>
<a href="#l29.153"></a><span id="l29.153">   NS_ENSURE_ARG_POINTER(aListener);</span>
<a href="#l29.154"></a><span id="l29.154"> </span>
<a href="#l29.155"></a><span id="l29.155">   nsresult rv;</span>
<a href="#l29.156"></a><span id="l29.156" class="difflineminus">-  nsCOMPtr&lt;nsPIDOMWindow&gt; window(do_QueryInterface(aWindow, &amp;rv));</span>
<a href="#l29.157"></a><span id="l29.157" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.158"></a><span id="l29.158" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; window = nsPIDOMWindowOuter::From(aWindow);</span>
<a href="#l29.159"></a><span id="l29.159"> </span>
<a href="#l29.160"></a><span id="l29.160">   nsCOMPtr&lt;nsIDocShellTreeItem&gt; treeItem(do_QueryInterface(window-&gt;GetDocShell(), &amp;rv));</span>
<a href="#l29.161"></a><span id="l29.161">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.162"></a><span id="l29.162"> </span>
<a href="#l29.163"></a><span id="l29.163">   nsCOMPtr &lt;nsIDocShellTreeOwner&gt; treeOwner;</span>
<a href="#l29.164"></a><span id="l29.164">   rv = treeItem-&gt;GetTreeOwner(getter_AddRefs(treeOwner));</span>
<a href="#l29.165"></a><span id="l29.165">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l29.166"></a><span id="l29.166"> </span>
<a href="#l29.167"></a><span id="l29.167" class="difflineat">@@ -918,17 +916,17 @@ NS_IMETHODIMP nsMsgTemplateReplyHelper::</span>
<a href="#l29.168"></a><span id="l29.168"> {</span>
<a href="#l29.169"></a><span id="l29.169">   return NS_OK;</span>
<a href="#l29.170"></a><span id="l29.170"> }</span>
<a href="#l29.171"></a><span id="l29.171"> </span>
<a href="#l29.172"></a><span id="l29.172"> NS_IMETHODIMP nsMsgTemplateReplyHelper::OnStopRunningUrl(nsIURI *aUrl, nsresult aExitCode)</span>
<a href="#l29.173"></a><span id="l29.173"> {</span>
<a href="#l29.174"></a><span id="l29.174">   NS_ENSURE_SUCCESS(aExitCode, aExitCode);</span>
<a href="#l29.175"></a><span id="l29.175">   nsresult rv;</span>
<a href="#l29.176"></a><span id="l29.176" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; parentWindow;</span>
<a href="#l29.177"></a><span id="l29.177" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; parentWindow;</span>
<a href="#l29.178"></a><span id="l29.178">   if (mMsgWindow)</span>
<a href="#l29.179"></a><span id="l29.179">   {</span>
<a href="#l29.180"></a><span id="l29.180">     nsCOMPtr&lt;nsIDocShell&gt; docShell;</span>
<a href="#l29.181"></a><span id="l29.181">     rv = mMsgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l29.182"></a><span id="l29.182">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.183"></a><span id="l29.183">     parentWindow = do_GetInterface(docShell);</span>
<a href="#l29.184"></a><span id="l29.184">     NS_ENSURE_TRUE(parentWindow, NS_ERROR_FAILURE);</span>
<a href="#l29.185"></a><span id="l29.185">   }</span>
<a href="#l29.186"></a><span id="l29.186" class="difflineat">@@ -1247,17 +1245,17 @@ nsMsgComposeService::ForwardMessage(cons</span>
<a href="#l29.187"></a><span id="l29.187">   if (aForwardType == nsIMsgComposeService::kForwardInline)</span>
<a href="#l29.188"></a><span id="l29.188">     return RunMessageThroughMimeDraft(msgUri,</span>
<a href="#l29.189"></a><span id="l29.189">                                       nsMimeOutput::nsMimeMessageDraftOrTemplate,</span>
<a href="#l29.190"></a><span id="l29.190">                                       identity,</span>
<a href="#l29.191"></a><span id="l29.191">                                       msgUri.get(), aMsgHdr,</span>
<a href="#l29.192"></a><span id="l29.192">                                       true, forwardTo,</span>
<a href="#l29.193"></a><span id="l29.193">                                       false, aMsgWindow);</span>
<a href="#l29.194"></a><span id="l29.194"> </span>
<a href="#l29.195"></a><span id="l29.195" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; parentWindow;</span>
<a href="#l29.196"></a><span id="l29.196" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; parentWindow;</span>
<a href="#l29.197"></a><span id="l29.197">   if (aMsgWindow)</span>
<a href="#l29.198"></a><span id="l29.198">   {</span>
<a href="#l29.199"></a><span id="l29.199">     nsCOMPtr&lt;nsIDocShell&gt; docShell;</span>
<a href="#l29.200"></a><span id="l29.200">     rv = aMsgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l29.201"></a><span id="l29.201">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.202"></a><span id="l29.202">     parentWindow = do_GetInterface(docShell);</span>
<a href="#l29.203"></a><span id="l29.203">     NS_ENSURE_TRUE(parentWindow, NS_ERROR_FAILURE);</span>
<a href="#l29.204"></a><span id="l29.204">   }</span>
<a href="#l29.205"></a><span id="l29.205" class="difflineat">@@ -1287,27 +1285,26 @@ nsMsgComposeService::ForwardMessage(cons</span>
<a href="#l29.206"></a><span id="l29.206">   // nsMsgCompose::ProcessReplyFlags usually takes care of marking messages</span>
<a href="#l29.207"></a><span id="l29.207">   // as forwarded. ProcessReplyFlags is normally called from</span>
<a href="#l29.208"></a><span id="l29.208">   // nsMsgComposeSendListener::OnStopSending but for this case the msgCompose</span>
<a href="#l29.209"></a><span id="l29.209">   // object is not set so ProcessReplyFlags won't get called.</span>
<a href="#l29.210"></a><span id="l29.210">   // Therefore, let's just mark it here instead.</span>
<a href="#l29.211"></a><span id="l29.211">   return folder-&gt;AddMessageDispositionState(aMsgHdr, nsIMsgFolder::nsMsgDispositionState_Forwarded);</span>
<a href="#l29.212"></a><span id="l29.212"> }</span>
<a href="#l29.213"></a><span id="l29.213"> </span>
<a href="#l29.214"></a><span id="l29.214" class="difflineminus">-nsresult nsMsgComposeService::ShowCachedComposeWindow(nsIDOMWindow *aComposeWindow, nsIXULWindow *aXULWindow, bool aShow)</span>
<a href="#l29.215"></a><span id="l29.215" class="difflineplus">+nsresult nsMsgComposeService::ShowCachedComposeWindow(mozIDOMWindowProxy *aComposeWindow, nsIXULWindow *aXULWindow, bool aShow)</span>
<a href="#l29.216"></a><span id="l29.216"> {</span>
<a href="#l29.217"></a><span id="l29.217">   nsresult rv = NS_OK;</span>
<a href="#l29.218"></a><span id="l29.218"> </span>
<a href="#l29.219"></a><span id="l29.219">   nsCOMPtr&lt;nsIObserverService&gt; obs =</span>
<a href="#l29.220"></a><span id="l29.220">     mozilla::services::GetObserverService();</span>
<a href="#l29.221"></a><span id="l29.221">   NS_ENSURE_TRUE(obs, NS_ERROR_UNEXPECTED);</span>
<a href="#l29.222"></a><span id="l29.222"> </span>
<a href="#l29.223"></a><span id="l29.223" class="difflineminus">-  nsCOMPtr &lt;nsPIDOMWindow&gt; window = do_QueryInterface(aComposeWindow, &amp;rv);</span>
<a href="#l29.224"></a><span id="l29.224" class="difflineminus">-</span>
<a href="#l29.225"></a><span id="l29.225" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l29.226"></a><span id="l29.226" class="difflineplus">+  NS_ENSURE_TRUE(aComposeWindow, NS_ERROR_FAILURE);</span>
<a href="#l29.227"></a><span id="l29.227" class="difflineplus">+  nsCOMPtr &lt;nsPIDOMWindowOuter&gt; window = nsPIDOMWindowOuter::From(aComposeWindow);</span>
<a href="#l29.228"></a><span id="l29.228"> </span>
<a href="#l29.229"></a><span id="l29.229">   nsIDocShell *docShell = window-&gt;GetDocShell();</span>
<a href="#l29.230"></a><span id="l29.230"> </span>
<a href="#l29.231"></a><span id="l29.231">   nsCOMPtr &lt;nsIDocShellTreeItem&gt; treeItem = do_QueryInterface(docShell, &amp;rv);</span>
<a href="#l29.232"></a><span id="l29.232">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l29.233"></a><span id="l29.233"> </span>
<a href="#l29.234"></a><span id="l29.234">   nsCOMPtr &lt;nsIDocShellTreeOwner&gt; treeOwner;</span>
<a href="#l29.235"></a><span id="l29.235">   rv = treeItem-&gt;GetTreeOwner(getter_AddRefs(treeOwner));</span>
<a href="#l29.236"></a><span id="l29.236" class="difflineat">@@ -1730,17 +1727,17 @@ nsMsgComposeService::Handle(nsICommandLi</span>
<a href="#l29.237"></a><span id="l29.237"> </span>
<a href="#l29.238"></a><span id="l29.238">     nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch (do_GetService(NS_WINDOWWATCHER_CONTRACTID));</span>
<a href="#l29.239"></a><span id="l29.239">     NS_ENSURE_TRUE(wwatch, NS_ERROR_FAILURE);</span>
<a href="#l29.240"></a><span id="l29.240"> </span>
<a href="#l29.241"></a><span id="l29.241">     nsCOMPtr&lt;nsISupportsString&gt; arg(do_CreateInstance(NS_SUPPORTS_STRING_CONTRACTID));</span>
<a href="#l29.242"></a><span id="l29.242">     if (arg)</span>
<a href="#l29.243"></a><span id="l29.243">       arg-&gt;SetData(uristr);</span>
<a href="#l29.244"></a><span id="l29.244"> </span>
<a href="#l29.245"></a><span id="l29.245" class="difflineminus">-    nsCOMPtr&lt;nsIDOMWindow&gt; opened;</span>
<a href="#l29.246"></a><span id="l29.246" class="difflineplus">+    nsCOMPtr&lt;mozIDOMWindowProxy&gt; opened;</span>
<a href="#l29.247"></a><span id="l29.247">     wwatch-&gt;OpenWindow(nullptr, DEFAULT_CHROME, &quot;_blank&quot;,</span>
<a href="#l29.248"></a><span id="l29.248">                        &quot;chrome,dialog=no,all&quot;, arg, getter_AddRefs(opened));</span>
<a href="#l29.249"></a><span id="l29.249"> </span>
<a href="#l29.250"></a><span id="l29.250">     aCmdLine-&gt;SetPreventDefault(true);</span>
<a href="#l29.251"></a><span id="l29.251">   }</span>
<a href="#l29.252"></a><span id="l29.252">   return NS_OK;</span>
<a href="#l29.253"></a><span id="l29.253"> }</span>
<a href="#l29.254"></a><span id="l29.254"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.h</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.h</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -2,44 +2,44 @@</span>
<a href="#l30.4"></a><span id="l30.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l30.5"></a><span id="l30.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l30.6"></a><span id="l30.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8"> #define MSGCOMP_TRACE_PERFORMANCE 1</span>
<a href="#l30.9"></a><span id="l30.9"> </span>
<a href="#l30.10"></a><span id="l30.10"> #include &quot;nsIMsgComposeService.h&quot;</span>
<a href="#l30.11"></a><span id="l30.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l30.14"></a><span id="l30.14"> #include &quot;nsIXULWindow.h&quot;</span>
<a href="#l30.15"></a><span id="l30.15"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l30.16"></a><span id="l30.16"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l30.17"></a><span id="l30.17"> #include &quot;nsIMimeStreamConverter.h&quot;</span>
<a href="#l30.18"></a><span id="l30.18"> #include &quot;nsInterfaceHashtable.h&quot;</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20"> #include &quot;nsICommandLineHandler.h&quot;</span>
<a href="#l30.21"></a><span id="l30.21"> #define ICOMMANDLINEHANDLER nsICommandLineHandler</span>
<a href="#l30.22"></a><span id="l30.22"> </span>
<a href="#l30.23"></a><span id="l30.23"> class nsMsgCachedWindowInfo</span>
<a href="#l30.24"></a><span id="l30.24"> {</span>
<a href="#l30.25"></a><span id="l30.25"> public:</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineminus">-  void Initialize(nsIDOMWindow *aWindow, nsIXULWindow *aXULWindow, nsIMsgComposeRecyclingListener *aListener, bool aHtmlCompose)</span>
<a href="#l30.27"></a><span id="l30.27" class="difflineplus">+  void Initialize(mozIDOMWindowProxy *aWindow, nsIXULWindow *aXULWindow, nsIMsgComposeRecyclingListener *aListener, bool aHtmlCompose)</span>
<a href="#l30.28"></a><span id="l30.28">   {</span>
<a href="#l30.29"></a><span id="l30.29">     window = aWindow;</span>
<a href="#l30.30"></a><span id="l30.30">     xulWindow = aXULWindow;</span>
<a href="#l30.31"></a><span id="l30.31">     listener = aListener;</span>
<a href="#l30.32"></a><span id="l30.32">     htmlCompose = aHtmlCompose;</span>
<a href="#l30.33"></a><span id="l30.33">   }</span>
<a href="#l30.34"></a><span id="l30.34">     </span>
<a href="#l30.35"></a><span id="l30.35">   void Clear()</span>
<a href="#l30.36"></a><span id="l30.36">   {</span>
<a href="#l30.37"></a><span id="l30.37">     window = nullptr;</span>
<a href="#l30.38"></a><span id="l30.38">     listener = nullptr;</span>
<a href="#l30.39"></a><span id="l30.39">   }</span>
<a href="#l30.40"></a><span id="l30.40">   </span>
<a href="#l30.41"></a><span id="l30.41" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt;                    window;</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt;              window;</span>
<a href="#l30.43"></a><span id="l30.43">   nsCOMPtr&lt;nsIXULWindow&gt;                    xulWindow;</span>
<a href="#l30.44"></a><span id="l30.44">   nsCOMPtr&lt;nsIMsgComposeRecyclingListener&gt;  listener;</span>
<a href="#l30.45"></a><span id="l30.45">   bool                                      htmlCompose;</span>
<a href="#l30.46"></a><span id="l30.46"> };</span>
<a href="#l30.47"></a><span id="l30.47"> </span>
<a href="#l30.48"></a><span id="l30.48"> class nsMsgComposeService : </span>
<a href="#l30.49"></a><span id="l30.49">   public nsIMsgComposeService,</span>
<a href="#l30.50"></a><span id="l30.50">   public nsIObserver,</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineat">@@ -61,17 +61,17 @@ public:</span>
<a href="#l30.52"></a><span id="l30.52"> </span>
<a href="#l30.53"></a><span id="l30.53"> private:</span>
<a href="#l30.54"></a><span id="l30.54"> 	virtual ~nsMsgComposeService();</span>
<a href="#l30.55"></a><span id="l30.55">   bool mLogComposePerformance;</span>
<a href="#l30.56"></a><span id="l30.56"> </span>
<a href="#l30.57"></a><span id="l30.57">   int32_t mMaxRecycledWindows;</span>
<a href="#l30.58"></a><span id="l30.58">   nsMsgCachedWindowInfo *mCachedWindows;</span>
<a href="#l30.59"></a><span id="l30.59">   </span>
<a href="#l30.60"></a><span id="l30.60" class="difflineminus">-  void CloseHiddenCachedWindow(nsIDOMWindow *domWindow);</span>
<a href="#l30.61"></a><span id="l30.61" class="difflineplus">+  void CloseHiddenCachedWindow(mozIDOMWindowProxy *domWindow);</span>
<a href="#l30.62"></a><span id="l30.62"> </span>
<a href="#l30.63"></a><span id="l30.63">   nsresult LoadDraftOrTemplate(const nsACString&amp; aMsgURI, nsMimeOutputType aOutType, </span>
<a href="#l30.64"></a><span id="l30.64">                                nsIMsgIdentity * aIdentity, const char * aOriginalMsgURI, </span>
<a href="#l30.65"></a><span id="l30.65">                                nsIMsgDBHdr * aOrigMsgHdr, bool aForwardInline,</span>
<a href="#l30.66"></a><span id="l30.66">                                bool overrideComposeFormat,</span>
<a href="#l30.67"></a><span id="l30.67">                                nsIMsgWindow *aMsgWindow);</span>
<a href="#l30.68"></a><span id="l30.68"> </span>
<a href="#l30.69"></a><span id="l30.69">   nsresult RunMessageThroughMimeDraft(const nsACString&amp; aMsgURI,</span>
<a href="#l30.70"></a><span id="l30.70" class="difflineat">@@ -79,17 +79,17 @@ private:</span>
<a href="#l30.71"></a><span id="l30.71">                                       nsIMsgIdentity * aIdentity,</span>
<a href="#l30.72"></a><span id="l30.72">                                       const char * aOriginalMsgURI,</span>
<a href="#l30.73"></a><span id="l30.73">                                       nsIMsgDBHdr * aOrigMsgHdr,</span>
<a href="#l30.74"></a><span id="l30.74">                                       bool aForwardInline,</span>
<a href="#l30.75"></a><span id="l30.75">                                       const nsAString &amp;forwardTo,</span>
<a href="#l30.76"></a><span id="l30.76">                                       bool overrideComposeFormat,</span>
<a href="#l30.77"></a><span id="l30.77">                                       nsIMsgWindow *aMsgWindow);</span>
<a href="#l30.78"></a><span id="l30.78"> </span>
<a href="#l30.79"></a><span id="l30.79" class="difflineminus">-  nsresult ShowCachedComposeWindow(nsIDOMWindow *aComposeWindow, nsIXULWindow *aXULWindow, bool aShow);</span>
<a href="#l30.80"></a><span id="l30.80" class="difflineplus">+  nsresult ShowCachedComposeWindow(mozIDOMWindowProxy *aComposeWindow, nsIXULWindow *aXULWindow, bool aShow);</span>
<a href="#l30.81"></a><span id="l30.81"> </span>
<a href="#l30.82"></a><span id="l30.82">   // hash table mapping dom windows to nsIMsgCompose objects</span>
<a href="#l30.83"></a><span id="l30.83">   nsInterfaceHashtable&lt;nsISupportsHashKey, nsIWeakReference&gt; mOpenComposeWindows;</span>
<a href="#l30.84"></a><span id="l30.84"> </span>
<a href="#l30.85"></a><span id="l30.85">   // When doing a reply and the settings are enabled, get the HTML of the selected text</span>
<a href="#l30.86"></a><span id="l30.86">   // in the original message window so that it can be quoted instead of the entire message.</span>
<a href="#l30.87"></a><span id="l30.87">   nsresult GetOrigWindowSelection(MSG_ComposeType type, nsIMsgWindow *aMsgWindow, nsACString&amp; aSelHTML);</span>
<a href="#l30.88"></a><span id="l30.88"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -75,16 +75,17 @@</span>
<a href="#l31.4"></a><span id="l31.4"> #include &quot;nsIArray.h&quot;</span>
<a href="#l31.5"></a><span id="l31.5"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l31.6"></a><span id="l31.6"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l31.7"></a><span id="l31.7"> #include &quot;mozilla/mailnews/MimeEncoder.h&quot;</span>
<a href="#l31.8"></a><span id="l31.8"> #include &quot;mozilla/mailnews/MimeHeaderParser.h&quot;</span>
<a href="#l31.9"></a><span id="l31.9"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l31.10"></a><span id="l31.10"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l31.11"></a><span id="l31.11"> #include &quot;nsIMsgProtocolInfo.h&quot;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l31.13"></a><span id="l31.13"> </span>
<a href="#l31.14"></a><span id="l31.14"> using namespace mozilla::mailnews;</span>
<a href="#l31.15"></a><span id="l31.15"> </span>
<a href="#l31.16"></a><span id="l31.16"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18"> #define PREF_MAIL_SEND_STRUCT &quot;mail.send_struct&quot;</span>
<a href="#l31.19"></a><span id="l31.19"> #define PREF_MAIL_STRICTLY_MIME &quot;mail.strictly_mime&quot;</span>
<a href="#l31.20"></a><span id="l31.20"> #define PREF_MAIL_MESSAGE_WARNING_SIZE &quot;mailnews.message_warning_size&quot;</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineat">@@ -3992,17 +3993,17 @@ nsMsgComposeAndSend::CreateAndSendMessag</span>
<a href="#l31.22"></a><span id="l31.22">               bool                              digest_p,</span>
<a href="#l31.23"></a><span id="l31.23">               bool                              dont_deliver_p,</span>
<a href="#l31.24"></a><span id="l31.24">               nsMsgDeliverMode                  mode,</span>
<a href="#l31.25"></a><span id="l31.25">               nsIMsgDBHdr                       *msgToReplace,</span>
<a href="#l31.26"></a><span id="l31.26">               const char                        *attachment1_type,</span>
<a href="#l31.27"></a><span id="l31.27">               const nsACString                  &amp;attachment1_body,</span>
<a href="#l31.28"></a><span id="l31.28">               nsIArray *attachments,</span>
<a href="#l31.29"></a><span id="l31.29">               nsIArray *preloaded_attachments,</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineminus">-              nsIDOMWindow                      *parentWindow,</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineplus">+              mozIDOMWindowProxy                *parentWindow,</span>
<a href="#l31.32"></a><span id="l31.32">               nsIMsgProgress                    *progress,</span>
<a href="#l31.33"></a><span id="l31.33">               nsIMsgSendListener                *aListener,</span>
<a href="#l31.34"></a><span id="l31.34">               const char                        *password,</span>
<a href="#l31.35"></a><span id="l31.35">               const nsACString                  &amp;aOriginalMsgURI,</span>
<a href="#l31.36"></a><span id="l31.36">               MSG_ComposeType                   aType</span>
<a href="#l31.37"></a><span id="l31.37">               )</span>
<a href="#l31.38"></a><span id="l31.38"> {</span>
<a href="#l31.39"></a><span id="l31.39">   nsresult      rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.h</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.h</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -279,17 +279,17 @@ public:</span>
<a href="#l32.4"></a><span id="l32.4">                                                  // created, instead of actually delivering message.</span>
<a href="#l32.5"></a><span id="l32.5">   nsMsgDeliverMode          m_deliver_mode;      // nsMsgDeliverNow, nsMsgQueueForLater, nsMsgSaveAsDraft,</span>
<a href="#l32.6"></a><span id="l32.6">                                                  // nsMsgSaveAsTemplate and nsMsgSendUnsent</span>
<a href="#l32.7"></a><span id="l32.7">   nsCOMPtr&lt;nsIMsgDBHdr&gt;     mMsgToReplace;       // If the mode is nsMsgSaveAsDraft, this is the message it will</span>
<a href="#l32.8"></a><span id="l32.8">                                                  // replace</span>
<a href="#l32.9"></a><span id="l32.9">   nsString mSavedToFolderName; // Name of folder we're saving to, used when</span>
<a href="#l32.10"></a><span id="l32.10">                                // displaying error on save.</span>
<a href="#l32.11"></a><span id="l32.11">   // These are needed for callbacks to the FE...</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  nsCOMPtr&lt;nsPIDOMWindow&gt;         mParentWindow;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt;    mParentWindow;</span>
<a href="#l32.14"></a><span id="l32.14">   nsCOMPtr&lt;nsIMsgProgress&gt;        mSendProgress;</span>
<a href="#l32.15"></a><span id="l32.15">   nsCOMPtr&lt;nsIMsgSendListener&gt;    mListener;</span>
<a href="#l32.16"></a><span id="l32.16">   nsCOMPtr&lt;nsIMsgStatusFeedback&gt;  mStatusFeedback;</span>
<a href="#l32.17"></a><span id="l32.17">   nsCOMPtr&lt;nsIRequest&gt;      mRunningRequest;</span>
<a href="#l32.18"></a><span id="l32.18">   bool                      mSendMailAlso;</span>
<a href="#l32.19"></a><span id="l32.19">   nsCOMPtr&lt;nsIFile&gt;         mReturnFile;     // a holder for file spec's to be returned to caller</span>
<a href="#l32.20"></a><span id="l32.20"> </span>
<a href="#l32.21"></a><span id="l32.21">   // File where we stored our HTML so that we could make the plaintext form.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -24,17 +24,17 @@</span>
<a href="#l33.4"></a><span id="l33.4"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l33.5"></a><span id="l33.5"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l33.6"></a><span id="l33.6"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l33.7"></a><span id="l33.7"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l33.8"></a><span id="l33.8"> #include &quot;nsIPromptService.h&quot;</span>
<a href="#l33.9"></a><span id="l33.9"> #include &quot;nsIInterfaceRequestor.h&quot;</span>
<a href="#l33.10"></a><span id="l33.10"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l33.11"></a><span id="l33.11"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l33.14"></a><span id="l33.14"> #include &quot;nsEmbedCID.h&quot;</span>
<a href="#l33.15"></a><span id="l33.15"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l33.16"></a><span id="l33.16"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l33.17"></a><span id="l33.17"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l33.18"></a><span id="l33.18"> #include &quot;nsIPop3Service.h&quot;</span>
<a href="#l33.19"></a><span id="l33.19"> #include &quot;nsMsgLocalCID.h&quot;</span>
<a href="#l33.20"></a><span id="l33.20"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l33.21"></a><span id="l33.21"> </span>
<a href="#l33.22"></a><span id="l33.22" class="difflineat">@@ -679,17 +679,17 @@ nsresult nsPop3Sink::HandleTempDownloadF</span>
<a href="#l33.23"></a><span id="l33.23">   nsString fromStr, subjectStr, confirmString;</span>
<a href="#l33.24"></a><span id="l33.24"> </span>
<a href="#l33.25"></a><span id="l33.25">   m_newMailParser-&gt;m_newMsgHdr-&gt;GetMime2DecodedSubject(subjectStr);</span>
<a href="#l33.26"></a><span id="l33.26">   m_newMailParser-&gt;m_newMsgHdr-&gt;GetMime2DecodedAuthor(fromStr);</span>
<a href="#l33.27"></a><span id="l33.27">   const char16_t *params[] = { fromStr.get(), subjectStr.get() };</span>
<a href="#l33.28"></a><span id="l33.28">   bundle-&gt;FormatStringFromName(</span>
<a href="#l33.29"></a><span id="l33.29">     MOZ_UTF16(&quot;pop3TmpDownloadError&quot;),</span>
<a href="#l33.30"></a><span id="l33.30">     params, 2, getter_Copies(confirmString));</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; parentWindow;</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; parentWindow;</span>
<a href="#l33.33"></a><span id="l33.33">   nsCOMPtr&lt;nsIPromptService&gt; promptService = do_GetService(NS_PROMPTSERVICE_CONTRACTID);</span>
<a href="#l33.34"></a><span id="l33.34">   nsCOMPtr&lt;nsIDocShell&gt; docShell;</span>
<a href="#l33.35"></a><span id="l33.35">   if (msgWindow)</span>
<a href="#l33.36"></a><span id="l33.36">   {</span>
<a href="#l33.37"></a><span id="l33.37">     (void) msgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l33.38"></a><span id="l33.38">     parentWindow = do_QueryInterface(docShell);</span>
<a href="#l33.39"></a><span id="l33.39">   }</span>
<a href="#l33.40"></a><span id="l33.40">   if (promptService &amp;&amp; !confirmString.IsEmpty())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -10,17 +10,17 @@</span>
<a href="#l34.4"></a><span id="l34.4"> #include &lt;direct.h&gt;</span>
<a href="#l34.5"></a><span id="l34.5"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l34.6"></a><span id="l34.6"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l34.7"></a><span id="l34.7"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l34.8"></a><span id="l34.8"> #include &quot;nsISupports.h&quot;</span>
<a href="#l34.9"></a><span id="l34.9"> #include &quot;nsIPromptService.h&quot;</span>
<a href="#l34.10"></a><span id="l34.10"> #include &quot;nsIAppStartup.h&quot;</span>
<a href="#l34.11"></a><span id="l34.11"> #include &quot;nsIAppShellService.h&quot;</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l34.14"></a><span id="l34.14"> #include &quot;nsINativeAppSupport.h&quot;</span>
<a href="#l34.15"></a><span id="l34.15"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l34.16"></a><span id="l34.16"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l34.17"></a><span id="l34.17"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l34.18"></a><span id="l34.18"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l34.19"></a><span id="l34.19"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l34.20"></a><span id="l34.20"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l34.21"></a><span id="l34.21"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineat">@@ -282,17 +282,17 @@ nsresult nsMapiHook::BlindSendMail (unsi</span>
<a href="#l34.23"></a><span id="l34.23"> {</span>
<a href="#l34.24"></a><span id="l34.24">   nsresult rv = NS_OK ;</span>
<a href="#l34.25"></a><span id="l34.25"> </span>
<a href="#l34.26"></a><span id="l34.26">   if (!IsBlindSendAllowed())</span>
<a href="#l34.27"></a><span id="l34.27">     return NS_ERROR_FAILURE;</span>
<a href="#l34.28"></a><span id="l34.28"> </span>
<a href="#l34.29"></a><span id="l34.29">   /** create nsIMsgComposeParams obj and other fields to populate it **/</span>
<a href="#l34.30"></a><span id="l34.30"> </span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt;  hiddenWindow;</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; hiddenWindow;</span>
<a href="#l34.33"></a><span id="l34.33">   // get parent window</span>
<a href="#l34.34"></a><span id="l34.34">   nsCOMPtr&lt;nsIAppShellService&gt; appService = do_GetService( &quot;@mozilla.org/appshell/appShellService;1&quot;, &amp;rv);</span>
<a href="#l34.35"></a><span id="l34.35">   if (NS_FAILED(rv)|| (!appService) ) return rv ;</span>
<a href="#l34.36"></a><span id="l34.36"> </span>
<a href="#l34.37"></a><span id="l34.37">   rv = appService-&gt;GetHiddenDOMWindow(getter_AddRefs(hiddenWindow));</span>
<a href="#l34.38"></a><span id="l34.38">   if ( NS_FAILED(rv) ) return rv ;</span>
<a href="#l34.39"></a><span id="l34.39">   // smtp password and Logged in used IdKey from MapiConfig (session obj)</span>
<a href="#l34.40"></a><span id="l34.40">   nsMAPIConfiguration * pMapiConfig = nsMAPIConfiguration::GetMAPIConfiguration() ;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -14,17 +14,17 @@</span>
<a href="#l35.4"></a><span id="l35.4"> #include &quot;msgCore.h&quot;    // precompiled header...</span>
<a href="#l35.5"></a><span id="l35.5"> #include &quot;MailNewsTypes.h&quot;</span>
<a href="#l35.6"></a><span id="l35.6"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l35.7"></a><span id="l35.7"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l35.8"></a><span id="l35.8"> #include &quot;nsINewsDatabase.h&quot;</span>
<a href="#l35.9"></a><span id="l35.9"> #include &quot;nsIMsgStatusFeedback.h&quot;</span>
<a href="#l35.10"></a><span id="l35.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l35.11"></a><span id="l35.11"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l35.14"></a><span id="l35.14"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l35.15"></a><span id="l35.15"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l35.16"></a><span id="l35.16"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l35.17"></a><span id="l35.17"> #include &quot;nsINntpIncomingServer.h&quot;</span>
<a href="#l35.18"></a><span id="l35.18"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l35.19"></a><span id="l35.19"> #include &quot;nsIMsgFilter.h&quot;</span>
<a href="#l35.20"></a><span id="l35.20"> #include &quot;nsNNTPNewsgroupList.h&quot;</span>
<a href="#l35.21"></a><span id="l35.21"> </span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -221,29 +221,29 @@ openWindow(nsIMsgWindow *aMsgWindow, con</span>
<a href="#l35.23"></a><span id="l35.23"> {</span>
<a href="#l35.24"></a><span id="l35.24">   nsresult rv;</span>
<a href="#l35.25"></a><span id="l35.25">   NS_ENSURE_ARG_POINTER(aMsgWindow);</span>
<a href="#l35.26"></a><span id="l35.26">   nsCOMPtr&lt;nsIDocShell&gt; docShell;</span>
<a href="#l35.27"></a><span id="l35.27">   rv = aMsgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l35.28"></a><span id="l35.28">   if (NS_FAILED(rv))</span>
<a href="#l35.29"></a><span id="l35.29">       return rv;</span>
<a href="#l35.30"></a><span id="l35.30"> </span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; domWindow(do_GetInterface(docShell));</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineminus">-  nsCOMPtr&lt;nsPIDOMWindow&gt; parentWindow(do_QueryInterface(domWindow));</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineminus">-  NS_ENSURE_TRUE(parentWindow, NS_ERROR_FAILURE);</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow(do_GetInterface(docShell));</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineplus">+  NS_ENSURE_TRUE(domWindow, NS_ERROR_FAILURE);</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; parentWindow = nsPIDOMWindowOuter::From(domWindow);</span>
<a href="#l35.37"></a><span id="l35.37">   parentWindow = parentWindow-&gt;GetOuterWindow();</span>
<a href="#l35.38"></a><span id="l35.38">   NS_ENSURE_ARG_POINTER(parentWindow);</span>
<a href="#l35.39"></a><span id="l35.39"> </span>
<a href="#l35.40"></a><span id="l35.40">   nsCOMPtr&lt;nsISupportsInterfacePointer&gt; ifptr = do_CreateInstance(NS_SUPPORTS_INTERFACE_POINTER_CONTRACTID, &amp;rv);</span>
<a href="#l35.41"></a><span id="l35.41">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l35.42"></a><span id="l35.42"> </span>
<a href="#l35.43"></a><span id="l35.43">   ifptr-&gt;SetData(param);</span>
<a href="#l35.44"></a><span id="l35.44">   ifptr-&gt;SetDataIID(&amp;NS_GET_IID(nsINewsDownloadDialogArgs));</span>
<a href="#l35.45"></a><span id="l35.45"> </span>
<a href="#l35.46"></a><span id="l35.46" class="difflineminus">-  nsCOMPtr&lt;nsIDOMWindow&gt; dialogWindow;</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; dialogWindow;</span>
<a href="#l35.48"></a><span id="l35.48">   rv = parentWindow-&gt;OpenDialog(NS_ConvertASCIItoUTF16(chromeURL),</span>
<a href="#l35.49"></a><span id="l35.49">                                 NS_LITERAL_STRING(&quot;_blank&quot;),</span>
<a href="#l35.50"></a><span id="l35.50">                                 NS_LITERAL_STRING(&quot;centerscreen,chrome,modal,titlebar&quot;),</span>
<a href="#l35.51"></a><span id="l35.51">                                 ifptr, getter_AddRefs(dialogWindow));</span>
<a href="#l35.52"></a><span id="l35.52"> </span>
<a href="#l35.53"></a><span id="l35.53">   return rv;</span>
<a href="#l35.54"></a><span id="l35.54"> }</span>
<a href="#l35.55"></a><span id="l35.55"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -25,17 +25,17 @@</span>
<a href="#l36.4"></a><span id="l36.4"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l36.5"></a><span id="l36.5"> #include &quot;nsIMessengerMigrator.h&quot;</span>
<a href="#l36.6"></a><span id="l36.6"> #include &quot;nsINntpIncomingServer.h&quot;</span>
<a href="#l36.7"></a><span id="l36.7"> #include &quot;nsICategoryManager.h&quot;</span>
<a href="#l36.8"></a><span id="l36.8"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l36.9"></a><span id="l36.9"> #include &quot;nsIDocShellLoadInfo.h&quot;</span>
<a href="#l36.10"></a><span id="l36.10"> #include &quot;nsIMessengerWindowService.h&quot;</span>
<a href="#l36.11"></a><span id="l36.11"> #include &quot;nsIWindowMediator.h&quot;</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+#include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l36.14"></a><span id="l36.14"> #include &quot;nsIMsgSearchSession.h&quot;</span>
<a href="#l36.15"></a><span id="l36.15"> #include &quot;nsMailDirServiceDefs.h&quot;</span>
<a href="#l36.16"></a><span id="l36.16"> #include &quot;nsIWebNavigation.h&quot;</span>
<a href="#l36.17"></a><span id="l36.17"> #include &quot;nsIIOService.h&quot;</span>
<a href="#l36.18"></a><span id="l36.18"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l36.19"></a><span id="l36.19"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l36.20"></a><span id="l36.20"> #include &quot;nsNewsDownloader.h&quot;</span>
<a href="#l36.21"></a><span id="l36.21"> #include &quot;prprf.h&quot;</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineat">@@ -1615,17 +1615,17 @@ nsNntpService::Handle(nsICommandLine* aC</span>
<a href="#l36.23"></a><span id="l36.23">   nsresult rv;</span>
<a href="#l36.24"></a><span id="l36.24">   bool found;</span>
<a href="#l36.25"></a><span id="l36.25"> </span>
<a href="#l36.26"></a><span id="l36.26">   rv = aCmdLine-&gt;HandleFlag(NS_LITERAL_STRING(&quot;news&quot;), false, &amp;found);</span>
<a href="#l36.27"></a><span id="l36.27">   if (NS_SUCCEEDED(rv) &amp;&amp; found) {</span>
<a href="#l36.28"></a><span id="l36.28">     nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch (do_GetService(NS_WINDOWWATCHER_CONTRACTID));</span>
<a href="#l36.29"></a><span id="l36.29">     NS_ENSURE_TRUE(wwatch, NS_ERROR_FAILURE);</span>
<a href="#l36.30"></a><span id="l36.30"> </span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-    nsCOMPtr&lt;nsIDOMWindow&gt; opened;</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineplus">+    nsCOMPtr&lt;mozIDOMWindowProxy&gt; opened;</span>
<a href="#l36.33"></a><span id="l36.33">     wwatch-&gt;OpenWindow(nullptr, &quot;chrome://messenger/content/&quot;, &quot;_blank&quot;,</span>
<a href="#l36.34"></a><span id="l36.34">                        &quot;chrome,extrachrome,menubar,resizable,scrollbars,status,toolbar&quot;,</span>
<a href="#l36.35"></a><span id="l36.35">                        nullptr, getter_AddRefs(opened));</span>
<a href="#l36.36"></a><span id="l36.36">     aCmdLine-&gt;SetPreventDefault(true);</span>
<a href="#l36.37"></a><span id="l36.37">   }</span>
<a href="#l36.38"></a><span id="l36.38"> </span>
<a href="#l36.39"></a><span id="l36.39">   return NS_OK;</span>
<a href="#l36.40"></a><span id="l36.40"> }</span>
<a href="#l36.41"></a><span id="l36.41" class="difflineat">@@ -1689,17 +1689,17 @@ nsNntpService::HandleContent(const char </span>
<a href="#l36.42"></a><span id="l36.42">           nsCOMPtr&lt;nsIWindowWatcher&gt; wwatcher =</span>
<a href="#l36.43"></a><span id="l36.43">             do_GetService(NS_WINDOWWATCHER_CONTRACTID, &amp;rv);</span>
<a href="#l36.44"></a><span id="l36.44">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l36.45"></a><span id="l36.45"> </span>
<a href="#l36.46"></a><span id="l36.46">           nsCOMPtr&lt;nsISupportsCString&gt; arg =</span>
<a href="#l36.47"></a><span id="l36.47">             do_CreateInstance(NS_SUPPORTS_CSTRING_CONTRACTID);</span>
<a href="#l36.48"></a><span id="l36.48">           arg-&gt;SetData(folderURL);</span>
<a href="#l36.49"></a><span id="l36.49"> </span>
<a href="#l36.50"></a><span id="l36.50" class="difflineminus">-          nsCOMPtr&lt;nsIDOMWindow&gt; newWindow;</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineplus">+          nsCOMPtr&lt;mozIDOMWindowProxy&gt; newWindow;</span>
<a href="#l36.52"></a><span id="l36.52">           rv = wwatcher-&gt;OpenWindow(nullptr, &quot;chrome://messenger/content/&quot;,</span>
<a href="#l36.53"></a><span id="l36.53">             &quot;_blank&quot;, &quot;chome,all,dialog=no&quot;, arg, getter_AddRefs(newWindow));</span>
<a href="#l36.54"></a><span id="l36.54">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l36.55"></a><span id="l36.55">         }</span>
<a href="#l36.56"></a><span id="l36.56">       }</span>
<a href="#l36.57"></a><span id="l36.57">       if (msgWindow)</span>
<a href="#l36.58"></a><span id="l36.58">       {</span>
<a href="#l36.59"></a><span id="l36.59">         nsCOMPtr&lt;nsIMsgWindowCommands&gt; windowCommands;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

