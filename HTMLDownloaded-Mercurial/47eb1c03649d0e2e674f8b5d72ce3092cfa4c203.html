<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27528:47eb1c03649d0e2e674f8b5d72ce3092cfa4c203</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 47eb1c03649d0e2e674f8b5d72ce3092cfa4c203" />
<meta property="og:url" content="/comm-central/rev/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203" />
<meta property="og:description" content="Bug 1134635 - make http urls passed from the command line trigger feed subscription. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 47eb1c03649d0e2e674f8b5d72ce3092cfa4c203 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203">shortlog</a> |
<a href="/comm-central/log/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203">files</a> |
changeset |
<a href="/comm-central/raw-rev/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203">raw</a>  | <a href="/comm-central/archive/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1134635">Bug 1134635</a> - make http urls passed from the command line trigger feed subscription. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#66;&#101;&#110;&#106;&#97;&#109;&#105;&#110;&#32;&#70;&#108;&#97;&#110;&#97;&#103;&#105;&#110;&#32;&#60;&#98;&#101;&#110;&#106;&#97;&#109;&#105;&#110;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 07 Sep 2019 15:37:57 -0500</td></tr>

<tr>
 <td>changeset 27528</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203">47eb1c03649d0e2e674f8b5d72ce3092cfa4c203</a></td>
</tr>



<tr>
<td>parent 27527</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5acb5168cb35d08e471cabdbe03f6ec773062626">5acb5168cb35d08e471cabdbe03f6ec773062626</a>
</td>
</tr>

<tr>
<td>child 27529</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6928adb14504099349266edc55eece66a7adba18">6928adb14504099349266edc55eece66a7adba18</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=47eb1c03649d0e2e674f8b5d72ce3092cfa4c203">16376</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 09 Sep 2019 07:36:21 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9f5cedbf9218 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9f5cedbf9218c7dd221b1779d3851a9aeb77611c">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9f5cedbf9218c7dd221b1779d3851a9aeb77611c&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9f5cedbf9218c7dd221b1779d3851a9aeb77611c&newProject=comm-central&newRevision=47eb1c03649d0e2e674f8b5d72ce3092cfa4c203&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9f5cedbf9218c7dd221b1779d3851a9aeb77611c&newProject=comm-central&newRevision=47eb1c03649d0e2e674f8b5d72ce3092cfa4c203&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9f5cedbf9218c7dd221b1779d3851a9aeb77611c&newProject=comm-central&newRevision=47eb1c03649d0e2e674f8b5d72ce3092cfa4c203&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1134635">1134635</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1134635">Bug 1134635</a> - make http urls passed from the command line trigger feed subscription. r=mkmelin

If Thunderbird was set as default browser for some reason, http links could trigger an infinite request loop to that URL.
This patch prevents that and tries to subscribe to the url as a feed instead.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203/mail/components/nsMailDefaultHandler.js">mail/components/nsMailDefaultHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203/mail/components/nsMailDefaultHandler.js">file</a> |
<a href="/comm-central/annotate/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203/mail/components/nsMailDefaultHandler.js">annotate</a> |
<a href="/comm-central/diff/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203/mail/components/nsMailDefaultHandler.js">diff</a> |
<a href="/comm-central/comparison/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203/mail/components/nsMailDefaultHandler.js">comparison</a> |
<a href="/comm-central/log/47eb1c03649d0e2e674f8b5d72ce3092cfa4c203/mail/components/nsMailDefaultHandler.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/nsMailDefaultHandler.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/nsMailDefaultHandler.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -339,26 +339,21 @@ var nsMailDefaultHandler = {</span>
<a href="#l1.4"></a><span id="l1.4">           var window = wlist.getNext();</span>
<a href="#l1.5"></a><span id="l1.5">           window.focus();</span>
<a href="#l1.6"></a><span id="l1.6">           return;</span>
<a href="#l1.7"></a><span id="l1.7">         }</span>
<a href="#l1.8"></a><span id="l1.8">       } catch (e) {</span>
<a href="#l1.9"></a><span id="l1.9">         dump(e);</span>
<a href="#l1.10"></a><span id="l1.10">       }</span>
<a href="#l1.11"></a><span id="l1.11">     }</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-</span>
<a href="#l1.13"></a><span id="l1.13">     if (uri) {</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-      if (uri.toLowerCase().startsWith(&quot;feed:&quot;)) {</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-        try {</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-          Cc[&quot;@mozilla.org/newsblog-feed-downloader;1&quot;]</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-            .getService(Ci.nsINewsBlogFeedDownloader)</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-            .subscribeToFeed(uri, null, null);</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-        } catch (e) {</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-          // If feed handling is not installed, do nothing</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-        }</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+      if (/^https?:/i.test(uri)) {</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+        Cc[&quot;@mozilla.org/newsblog-feed-downloader;1&quot;]</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+          .getService(Ci.nsINewsBlogFeedDownloader)</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+          .subscribeToFeed(uri, null, null);</span>
<a href="#l1.26"></a><span id="l1.26">       } else if (</span>
<a href="#l1.27"></a><span id="l1.27">         uri.toLowerCase().endsWith(&quot;.mozeml&quot;) ||</span>
<a href="#l1.28"></a><span id="l1.28">         uri.toLowerCase().endsWith(&quot;.wdseml&quot;)</span>
<a href="#l1.29"></a><span id="l1.29">       ) {</span>
<a href="#l1.30"></a><span id="l1.30">         handleIndexerResult(cmdLine.resolveFile(uri));</span>
<a href="#l1.31"></a><span id="l1.31">         cmdLine.preventDefault = true;</span>
<a href="#l1.32"></a><span id="l1.32">       } else if (uri.toLowerCase().endsWith(&quot;.eml&quot;)) {</span>
<a href="#l1.33"></a><span id="l1.33">         // Open this eml in a new message window</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

