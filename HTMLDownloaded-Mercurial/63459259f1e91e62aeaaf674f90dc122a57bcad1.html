<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 24735:63459259f1e91e62aeaaf674f90dc122a57bcad1</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 63459259f1e91e62aeaaf674f90dc122a57bcad1" />
<meta property="og:url" content="/comm-central/rev/63459259f1e91e62aeaaf674f90dc122a57bcad1" />
<meta property="og:description" content="Bug 1484636 - Revive and enable all the mozmill tests in calendar/test/mozmill; r=Fallen" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 63459259f1e91e62aeaaf674f90dc122a57bcad1 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/63459259f1e91e62aeaaf674f90dc122a57bcad1">shortlog</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/63459259f1e91e62aeaaf674f90dc122a57bcad1">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1">files</a> |
changeset |
<a href="/comm-central/raw-rev/63459259f1e91e62aeaaf674f90dc122a57bcad1">raw</a>  | <a href="/comm-central/archive/63459259f1e91e62aeaaf674f90dc122a57bcad1.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1484636">Bug 1484636</a> - Revive and enable all the mozmill tests in calendar/test/mozmill; r=Fallen
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 14 Sep 2018 11:40:11 +1200</td></tr>

<tr>
 <td>changeset 24735</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/63459259f1e91e62aeaaf674f90dc122a57bcad1">63459259f1e91e62aeaaf674f90dc122a57bcad1</a></td>
</tr>



<tr>
<td>parent 24734</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/760fa56f28063ce0a99d8b2767ff78a9933c52be">760fa56f28063ce0a99d8b2767ff78a9933c52be</a>
</td>
</tr>

<tr>
<td>child 24736</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/86b75ada0d6a76d60996891036f246e05efabfa6">86b75ada0d6a76d60996891036f246e05efabfa6</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=63459259f1e91e62aeaaf674f90dc122a57bcad1">14879</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Thu, 13 Sep 2018 23:42:10 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@63459259f1e9 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=63459259f1e91e62aeaaf674f90dc122a57bcad1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=63459259f1e91e62aeaaf674f90dc122a57bcad1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=63459259f1e91e62aeaaf674f90dc122a57bcad1&newProject=comm-central&newRevision=63459259f1e91e62aeaaf674f90dc122a57bcad1&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=63459259f1e91e62aeaaf674f90dc122a57bcad1&newProject=comm-central&newRevision=63459259f1e91e62aeaaf674f90dc122a57bcad1&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=63459259f1e91e62aeaaf674f90dc122a57bcad1&newProject=comm-central&newRevision=63459259f1e91e62aeaaf674f90dc122a57bcad1&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Fallen%29&revcount=50">Fallen</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1484636">1484636</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1484636">Bug 1484636</a> - Revive and enable all the mozmill tests in calendar/test/mozmill; r=Fallen</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/lightning/content/lightning-item-iframe.xul">calendar/lightning/content/lightning-item-iframe.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/lightning/content/lightning-item-iframe.xul">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/lightning/content/lightning-item-iframe.xul">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/lightning/content/lightning-item-iframe.xul">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/lightning/content/lightning-item-iframe.xul">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/lightning/content/lightning-item-iframe.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/.eslintrc.js">calendar/test/mozmill/.eslintrc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/.eslintrc.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/.eslintrc.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/.eslintrc.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/.eslintrc.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/.eslintrc.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialog.js">calendar/test/mozmill/eventDialog/testEventDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialog.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialog.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialog.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialog.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testUTF8.js">calendar/test/mozmill/eventDialog/testUTF8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testUTF8.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testUTF8.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testUTF8.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testUTF8.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/eventDialog/testUTF8.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/mozmilltests.list">calendar/test/mozmill/mozmilltests.list</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/mozmilltests.list">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/mozmilltests.list">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/mozmilltests.list">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/mozmilltests.list">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/mozmilltests.list">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/shared-modules/test-calendar-utils.js">calendar/test/mozmill/shared-modules/test-calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/shared-modules/test-calendar-utils.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/shared-modules/test-calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/shared-modules/test-calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/shared-modules/test-calendar-utils.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/shared-modules/test-calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/shared-modules/test-timezone-utils.js">calendar/test/mozmill/shared-modules/test-timezone-utils.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/shared-modules/test-timezone-utils.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/shared-modules/test-timezone-utils.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/shared-modules/test-timezone-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testAlarmDefaultValue.js">calendar/test/mozmill/testAlarmDefaultValue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testAlarmDefaultValue.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testAlarmDefaultValue.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testAlarmDefaultValue.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testAlarmDefaultValue.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testAlarmDefaultValue.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testTimezones.js">calendar/test/mozmill/testTimezones.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testTimezones.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testTimezones.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testTimezones.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testTimezones.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/testTimezones.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test1.js">calendar/test/mozmill/timezoneTests/test1.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test1.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test1.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test1.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test10.js">calendar/test/mozmill/timezoneTests/test10.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test10.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test10.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test10.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test2.js">calendar/test/mozmill/timezoneTests/test2.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test2.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test2.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test3.js">calendar/test/mozmill/timezoneTests/test3.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test3.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test3.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test3.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test4.js">calendar/test/mozmill/timezoneTests/test4.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test4.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test4.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test4.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test5.js">calendar/test/mozmill/timezoneTests/test5.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test5.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test5.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test5.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test6.js">calendar/test/mozmill/timezoneTests/test6.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test6.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test6.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test6.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test7.js">calendar/test/mozmill/timezoneTests/test7.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test7.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test7.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test7.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test8.js">calendar/test/mozmill/timezoneTests/test8.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test8.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test8.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test8.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test9.js">calendar/test/mozmill/timezoneTests/test9.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test9.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test9.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/timezoneTests/test9.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testDayView.js">calendar/test/mozmill/views/testDayView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testDayView.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testDayView.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testDayView.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testDayView.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testDayView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMonthView.js">calendar/test/mozmill/views/testMonthView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMonthView.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMonthView.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMonthView.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMonthView.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMonthView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMultiweekView.js">calendar/test/mozmill/views/testMultiweekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMultiweekView.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMultiweekView.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMultiweekView.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMultiweekView.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testMultiweekView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testTaskView.js">calendar/test/mozmill/views/testTaskView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testTaskView.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testTaskView.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testTaskView.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testTaskView.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testTaskView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testWeekView.js">calendar/test/mozmill/views/testWeekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testWeekView.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testWeekView.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testWeekView.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testWeekView.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/calendar/test/mozmill/views/testWeekView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/mozmill/runtest.py">mail/test/mozmill/runtest.py</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/mozmill/runtest.py">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/mozmill/runtest.py">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/mozmill/runtest.py">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/mozmill/runtest.py">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/mozmill/runtest.py">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/controller.js">mail/test/resources/mozmill/mozmill/extension/content/modules/controller.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/controller.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/controller.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/controller.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/controller.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/controller.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/frame.js">mail/test/resources/mozmill/mozmill/extension/content/modules/frame.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/frame.js">file</a> |
<a href="/comm-central/annotate/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/frame.js">annotate</a> |
<a href="/comm-central/diff/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/frame.js">diff</a> |
<a href="/comm-central/comparison/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/frame.js">comparison</a> |
<a href="/comm-central/log/63459259f1e91e62aeaaf674f90dc122a57bcad1/mail/test/resources/mozmill/mozmill/extension/content/modules/frame.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.xul</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.xul</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -580,17 +580,17 @@</span>
<a href="#l1.4"></a><span id="l1.4">                    flex=&quot;1&quot;&gt;</span>
<a href="#l1.5"></a><span id="l1.5">           &lt;tabpanel id=&quot;event-grid-tabpanel-description&quot;&gt;</span>
<a href="#l1.6"></a><span id="l1.6">             &lt;textbox id=&quot;item-description&quot;</span>
<a href="#l1.7"></a><span id="l1.7">                      disable-on-readonly=&quot;true&quot;</span>
<a href="#l1.8"></a><span id="l1.8">                      flex=&quot;1&quot;</span>
<a href="#l1.9"></a><span id="l1.9">                      multiline=&quot;true&quot;</span>
<a href="#l1.10"></a><span id="l1.10">                      rows=&quot;12&quot;/&gt;</span>
<a href="#l1.11"></a><span id="l1.11">           &lt;/tabpanel&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-          &lt;tabpanel id=&quot;event-grid-tabpanel-attachements&quot;&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+          &lt;tabpanel id=&quot;event-grid-tabpanel-attachments&quot;&gt;</span>
<a href="#l1.14"></a><span id="l1.14">             &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l1.15"></a><span id="l1.15">               &lt;richlistbox id=&quot;attachment-link&quot;</span>
<a href="#l1.16"></a><span id="l1.16">                            seltype=&quot;single&quot;</span>
<a href="#l1.17"></a><span id="l1.17">                            context=&quot;attachment-popup&quot;</span>
<a href="#l1.18"></a><span id="l1.18">                            rows=&quot;3&quot;</span>
<a href="#l1.19"></a><span id="l1.19">                            flex=&quot;1&quot;</span>
<a href="#l1.20"></a><span id="l1.20">                            disable-on-readonly=&quot;true&quot;</span>
<a href="#l1.21"></a><span id="l1.21">                            onkeypress=&quot;attachmentLinkKeyPress(event)&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/test/mozmill/.eslintrc.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/test/mozmill/.eslintrc.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -3,17 +3,27 @@</span>
<a href="#l2.4"></a><span id="l2.4"> module.exports = {</span>
<a href="#l2.5"></a><span id="l2.5">     globals: {</span>
<a href="#l2.6"></a><span id="l2.6">         elementslib: true,</span>
<a href="#l2.7"></a><span id="l2.7">         controller: true,</span>
<a href="#l2.8"></a><span id="l2.8">         mozmill: true,</span>
<a href="#l2.9"></a><span id="l2.9">         utils: true,</span>
<a href="#l2.10"></a><span id="l2.10">         require: true,</span>
<a href="#l2.11"></a><span id="l2.11">         exports: true,</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        module: true</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+        module: true,</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+        registeredFunctions: true,</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+        collector: true,</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+        persisted: true,</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+        lookup: true,</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+        eid: true,</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+        xpath: true,</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+        sleep: true,</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+        getEventBoxPath: true,</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+        lookupEventBox: true,</span>
<a href="#l2.24"></a><span id="l2.24">     },</span>
<a href="#l2.25"></a><span id="l2.25">     rules: {</span>
<a href="#l2.26"></a><span id="l2.26">         // Allow mozmill test methods to be used without warning</span>
<a href="#l2.27"></a><span id="l2.27">         &quot;no-unused-vars&quot;: [2, {</span>
<a href="#l2.28"></a><span id="l2.28">             vars: &quot;all&quot;,</span>
<a href="#l2.29"></a><span id="l2.29">             args: &quot;none&quot;,</span>
<a href="#l2.30"></a><span id="l2.30">             varsIgnorePattern: &quot;(MODULE_NAME|MODULE_REQUIRES|RELATIVE_ROOT|setupModule|installInto|teardownTest|^test[A-Z_].*)&quot;</span>
<a href="#l2.31"></a><span id="l2.31">         }]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,63 +1,61 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.5"></a><span id="l3.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.6"></a><span id="l3.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l3.9"></a><span id="l3.9"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;window-helpers&quot;];</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;, null);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+</span>
<a href="#l3.14"></a><span id="l3.14"> var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l3.15"></a><span id="l3.15"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-var handleAddingAttachment, acceptSendingNotificationMail, handleOccurrencePrompt;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+var handleAddingAttachment, handleOccurrencePrompt;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+var goToDate, setData;</span>
<a href="#l3.19"></a><span id="l3.19"> var CALENDARNAME, TIMEOUT_MODAL_DIALOG;</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-</span>
<a href="#l3.23"></a><span id="l3.23"> var eventTitle = &quot;Event&quot;;</span>
<a href="#l3.24"></a><span id="l3.24"> var eventLocation = &quot;Location&quot;;</span>
<a href="#l3.25"></a><span id="l3.25"> var eventDescription = &quot;Event Description&quot;;</span>
<a href="#l3.26"></a><span id="l3.26"> var eventAttendee = &quot;foo@bar.com&quot;;</span>
<a href="#l3.27"></a><span id="l3.27"> var eventUrl = &quot;http://mozilla.org&quot;;</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29"> function setupModule(module) {</span>
<a href="#l3.30"></a><span id="l3.30">     controller = mozmill.getMail3PaneController();</span>
<a href="#l3.31"></a><span id="l3.31">     ({ plan_for_modal_dialog, wait_for_modal_dialog } =</span>
<a href="#l3.32"></a><span id="l3.32">         collector.getModule(&quot;window-helpers&quot;));</span>
<a href="#l3.33"></a><span id="l3.33">     ({</span>
<a href="#l3.34"></a><span id="l3.34">         helpersForController,</span>
<a href="#l3.35"></a><span id="l3.35">         invokeEventDialog,</span>
<a href="#l3.36"></a><span id="l3.36">         createCalendar,</span>
<a href="#l3.37"></a><span id="l3.37">         deleteCalendars,</span>
<a href="#l3.38"></a><span id="l3.38">         handleAddingAttachment,</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-        acceptSendingNotificationMail,</span>
<a href="#l3.40"></a><span id="l3.40">         handleOccurrencePrompt,</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+        goToDate,</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+        setData,</span>
<a href="#l3.43"></a><span id="l3.43">         CALENDARNAME,</span>
<a href="#l3.44"></a><span id="l3.44">         TIMEOUT_MODAL_DIALOG</span>
<a href="#l3.45"></a><span id="l3.45">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l3.46"></a><span id="l3.46">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l3.47"></a><span id="l3.47">     Object.assign(module, helpersForController(controller));</span>
<a href="#l3.48"></a><span id="l3.48"> </span>
<a href="#l3.49"></a><span id="l3.49">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l3.50"></a><span id="l3.50"> }</span>
<a href="#l3.51"></a><span id="l3.51"> </span>
<a href="#l3.52"></a><span id="l3.52"> function testEventDialog() {</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l3.54"></a><span id="l3.54">     // paths</span>
<a href="#l3.55"></a><span id="l3.55">     let monthView = `</span>
<a href="#l3.56"></a><span id="l3.56">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l3.57"></a><span id="l3.57">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l3.58"></a><span id="l3.58">         id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l3.59"></a><span id="l3.59">         id(&quot;month-view&quot;)</span>
<a href="#l3.60"></a><span id="l3.60">     `;</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-    let miniMonth = `</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-        id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-    `;</span>
<a href="#l3.67"></a><span id="l3.67">     let eventDialog = `</span>
<a href="#l3.68"></a><span id="l3.68">         /id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/</span>
<a href="#l3.69"></a><span id="l3.69">     `;</span>
<a href="#l3.70"></a><span id="l3.70"> </span>
<a href="#l3.71"></a><span id="l3.71">     let eventBox = `</span>
<a href="#l3.72"></a><span id="l3.72">         ${monthView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l3.73"></a><span id="l3.73">         anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/</span>
<a href="#l3.74"></a><span id="l3.74">         {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}/</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineat">@@ -65,132 +63,102 @@ function testEventDialog() {</span>
<a href="#l3.76"></a><span id="l3.76">         {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l3.77"></a><span id="l3.77">         {&quot;class&quot;:&quot;calendar-event-details&quot;}</span>
<a href="#l3.78"></a><span id="l3.78">     `;</span>
<a href="#l3.79"></a><span id="l3.79"> </span>
<a href="#l3.80"></a><span id="l3.80">     // open month view</span>
<a href="#l3.81"></a><span id="l3.81">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l3.82"></a><span id="l3.82">     controller.waitThenClick(eid(&quot;calendar-month-view-button&quot;));</span>
<a href="#l3.83"></a><span id="l3.83"> </span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-    // pick year</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-    `));</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineminus">-        [0]/{&quot;value&quot;:&quot;2009&quot;}</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineminus">-    `));</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineminus">-    // pick month</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineminus">-    `));</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineminus">-</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;months-popup&quot;})/</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-        [0]/{&quot;index&quot;:&quot;0&quot;}</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineminus">-    `));</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineminus">-    // pick day</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineminus">-    `));</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l3.110"></a><span id="l3.110">     sleep();</span>
<a href="#l3.111"></a><span id="l3.111"> </span>
<a href="#l3.112"></a><span id="l3.112">     // create new event</span>
<a href="#l3.113"></a><span id="l3.113">     let now = new Date();</span>
<a href="#l3.114"></a><span id="l3.114">     let hour = now.getHours();</span>
<a href="#l3.115"></a><span id="l3.115">     let startHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-    let ampm = &quot;&quot;;</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineminus">-    // check that the start time is correct</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineminus">-    // next full hour except last hour hour of the day</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineminus">-    if (now.toLocaleTimeString().match(/AM|PM/)) {</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineminus">-        ampm = (hour &gt;= 12 ? &quot; PM&quot; : &quot; AM&quot;);</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineminus">-        startHour = startHour % 12;</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineminus">-        if (startHour == 0) {</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineminus">-            startHour = 12;</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineminus">-        }</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineminus">-    }</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-    let startTime = startHour + &quot;:00&quot; + ampm;</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineminus">-    let endTime = ((startHour + 1) % 24) + &quot;:00&quot; + ampm;</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+    let nextHour = cal.dtz.now();</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+    nextHour.resetTo(2009, 0, 1, startHour, 0, 0, cal.dtz.floating);</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+    let startTime = dateFormatter.formatTime(nextHour);</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+    nextHour.resetTo(2009, 0, 1, (startHour + 1) % 24, 0, 0, cal.dtz.floating);</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineplus">+    let endTime = dateFormatter.formatTime(nextHour);</span>
<a href="#l3.134"></a><span id="l3.134"> </span>
<a href="#l3.135"></a><span id="l3.135">     controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l3.136"></a><span id="l3.136">     invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineminus">-        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+        let { lookup: iframeLookup, eid: iframeId } = helpersForController(iframe);</span>
<a href="#l3.140"></a><span id="l3.140"> </span>
<a href="#l3.141"></a><span id="l3.141" class="difflineminus">-        let startTimeInput = eventlookup(`</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineminus">-            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineplus">+        let timeInput = `</span>
<a href="#l3.145"></a><span id="l3.145">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineminus">-            anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/id(&quot;timepicker-text&quot;)/</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-            anon({&quot;class&quot;:&quot;menulist-editable-box moz-input-box&quot;})/</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+            anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+            anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l3.150"></a><span id="l3.150">             anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+        `;</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+        let startTimeInput = iframeLookup(`</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+            /id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+            id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/${timeInput}</span>
<a href="#l3.156"></a><span id="l3.156">         `);</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+</span>
<a href="#l3.158"></a><span id="l3.158">         event.waitForElement(startTimeInput);</span>
<a href="#l3.159"></a><span id="l3.159">         event.assertValue(startTimeInput, startTime);</span>
<a href="#l3.160"></a><span id="l3.160"> </span>
<a href="#l3.161"></a><span id="l3.161">         // check selected calendar</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineminus">-        event.assertNode(eventlookup(`</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-category-color-row&quot;)/</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineminus">-            id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineminus">-            {&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;${CALENDARNAME}&quot;}</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineminus">-        `));</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+        event.assertValue(iframeId(&quot;item-calendar&quot;), CALENDARNAME);</span>
<a href="#l3.168"></a><span id="l3.168"> </span>
<a href="#l3.169"></a><span id="l3.169">         // fill in name, location, description</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineminus">-        `), eventTitle);</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineminus">-</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineminus">-        `), eventLocation);</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineminus">-</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineminus">-            id(&quot;item-description&quot;)/anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineminus">-        `), eventDescription);</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineminus">-</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineminus">-        // set category</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineminus">-        let categories = utils.getProperty(&quot;chrome://calendar/locale/categories.properties&quot;, &quot;categories2&quot;);</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineminus">-        let category = categories.split(&quot;,&quot;)[4]; // pick 4th value in a comma-separated list</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineminus">-        event.select(eventid(&quot;item-categories&quot;), null, category);</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineminus">-</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineminus">-        // repeat daily</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineminus">-        event.click(eventid(&quot;repeat-daily-menuitem&quot;));</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineminus">-</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineminus">-        // add reminder</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineminus">-        event.click(eventid(&quot;reminder-5minutes-menuitem&quot;));</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineplus">+        setData(event, iframe, {</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineplus">+            title: eventTitle,</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineplus">+            location: eventLocation,</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineplus">+            description: eventDescription,</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineplus">+            category: &quot;Clients&quot;,</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineplus">+            repeat: &quot;daily&quot;</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineplus">+        });</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineplus">+        event.click(iframeId(&quot;item-alarm&quot;));</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineplus">+        event.click(iframeId(&quot;reminder-5minutes-menuitem&quot;));</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineplus">+        event.waitFor(() =&gt; iframeId(&quot;item-alarm&quot;).getNode().label == &quot;5 minutes before&quot;);</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineplus">+        iframeId(&quot;item-alarm-menupopup&quot;).getNode().hidePopup();</span>
<a href="#l3.207"></a><span id="l3.207"> </span>
<a href="#l3.208"></a><span id="l3.208">         // add an attendee and verify added</span>
<a href="#l3.209"></a><span id="l3.209" class="difflineplus">+        event.click(iframeId(&quot;event-grid-tab-attendees&quot;));</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineplus">+</span>
<a href="#l3.211"></a><span id="l3.211">         plan_for_modal_dialog(&quot;Calendar:EventDialog:Attendees&quot;, handleAttendees);</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineminus">-        event.click(eventid(&quot;button-attendees&quot;));</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineplus">+        event.click(eventid(&quot;options-attendees-menuitem&quot;));</span>
<a href="#l3.214"></a><span id="l3.214">         wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l3.215"></a><span id="l3.215" class="difflineminus">-        event.assertValue(eventid(&quot;attendee-list&quot;), eventAttendee);</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineplus">+        event.assertNode(iframeLookup(`</span>
<a href="#l3.217"></a><span id="l3.217" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-tabbox&quot;)/id(&quot;event-grid-tabpanels&quot;)/</span>
<a href="#l3.218"></a><span id="l3.218" class="difflineplus">+            id(&quot;event-grid-tabpanel-attendees&quot;)/[0]/[1]/id(&quot;item-attendees-box&quot;)/</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineplus">+            {&quot;class&quot;:&quot;item-attendees-row&quot;}/{&quot;class&quot;:&quot;item-attendees-cell&quot;}/</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineplus">+            {&quot;class&quot;:&quot;item-attendees-cell-label&quot;,&quot;value&quot;:&quot;${eventAttendee}&quot;}</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineplus">+        `));</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineplus">+        event.click(iframeId(&quot;notify-attendees-checkbox&quot;));</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineplus">+        event.waitFor(() =&gt; !iframeId(&quot;notify-attendees-checkbox&quot;).getNode().checked);</span>
<a href="#l3.224"></a><span id="l3.224"> </span>
<a href="#l3.225"></a><span id="l3.225">         // make it private and verify label visible</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineminus">-        event.click(eventid(&quot;button-privacy&quot;));</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineplus">+        let toolbarbutton = eventid(&quot;button-privacy&quot;);</span>
<a href="#l3.228"></a><span id="l3.228" class="difflineplus">+        let rect = toolbarbutton.getNode().getBoundingClientRect();</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineplus">+        event.click(toolbarbutton, rect.width - 5, 5);</span>
<a href="#l3.230"></a><span id="l3.230">         event.click(eventid(&quot;event-privacy-private-menuitem&quot;));</span>
<a href="#l3.231"></a><span id="l3.231" class="difflineminus">-        let label = eventid(&quot;status-privacy-private-box&quot;);</span>
<a href="#l3.232"></a><span id="l3.232" class="difflineminus">-        event.assertJS(event.window.getComputedStyle(label.getNode()).getPropertyValue(&quot;visibility&quot;) == &quot;visible&quot;);</span>
<a href="#l3.233"></a><span id="l3.233" class="difflineplus">+        event.waitFor(() =&gt; !eventid(&quot;status-privacy-private-box&quot;).getNode().hasAttribute(&quot;collapsed&quot;));</span>
<a href="#l3.234"></a><span id="l3.234" class="difflineplus">+        eventid(&quot;event-privacy-menupopup&quot;).getNode().hidePopup();</span>
<a href="#l3.235"></a><span id="l3.235"> </span>
<a href="#l3.236"></a><span id="l3.236">         // add attachment and verify added</span>
<a href="#l3.237"></a><span id="l3.237" class="difflineplus">+        event.click(iframeId(&quot;event-grid-tab-attachments&quot;));</span>
<a href="#l3.238"></a><span id="l3.238" class="difflineplus">+</span>
<a href="#l3.239"></a><span id="l3.239">         handleAddingAttachment(event, eventUrl);</span>
<a href="#l3.240"></a><span id="l3.240">         event.click(eventid(&quot;button-url&quot;));</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineminus">-        event.assertNode(eventlookup(`</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-attachment-row&quot;)/</span>
<a href="#l3.243"></a><span id="l3.243" class="difflineminus">-            id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;mozilla.org&quot;}</span>
<a href="#l3.244"></a><span id="l3.244" class="difflineplus">+        wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l3.245"></a><span id="l3.245" class="difflineplus">+        event.assertNode(iframeLookup(`</span>
<a href="#l3.246"></a><span id="l3.246" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-tabbox&quot;)/id(&quot;event-grid-tabpanels&quot;)/</span>
<a href="#l3.247"></a><span id="l3.247" class="difflineplus">+            id(&quot;event-grid-tabpanel-attachments&quot;)/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineplus">+            id(&quot;attachment-link&quot;)/[0]/{&quot;value&quot;:&quot;mozilla.org&quot;}</span>
<a href="#l3.249"></a><span id="l3.249">         `));</span>
<a href="#l3.250"></a><span id="l3.250"> </span>
<a href="#l3.251"></a><span id="l3.251">         // save</span>
<a href="#l3.252"></a><span id="l3.252" class="difflineminus">-        acceptSendingNotificationMail(event);</span>
<a href="#l3.253"></a><span id="l3.253">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l3.254"></a><span id="l3.254">     });</span>
<a href="#l3.255"></a><span id="l3.255"> </span>
<a href="#l3.256"></a><span id="l3.256">     // catch and dismiss alarm</span>
<a href="#l3.257"></a><span id="l3.257">     controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length &gt; 0);</span>
<a href="#l3.258"></a><span id="l3.258">     let alarm = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;)[0]);</span>
<a href="#l3.259"></a><span id="l3.259">     let { lookup: alarmlookup } = helpersForController(alarm);</span>
<a href="#l3.260"></a><span id="l3.260"> </span>
<a href="#l3.261"></a><span id="l3.261" class="difflineat">@@ -215,18 +183,18 @@ function testEventDialog() {</span>
<a href="#l3.262"></a><span id="l3.262">     controller.assertNode(lookup(</span>
<a href="#l3.263"></a><span id="l3.263">         eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)</span>
<a href="#l3.264"></a><span id="l3.264">     ));</span>
<a href="#l3.265"></a><span id="l3.265">     checkIcon(eventBox, &quot;0&quot;, &quot;6&quot;);</span>
<a href="#l3.266"></a><span id="l3.266">     checkTooltip(monthView, &quot;0&quot;, &quot;6&quot;, &quot;3&quot;, startTime, endTime);</span>
<a href="#l3.267"></a><span id="l3.267"> </span>
<a href="#l3.268"></a><span id="l3.268">     // 31st of January is Saturday so there's four more full rows to check</span>
<a href="#l3.269"></a><span id="l3.269">     let date = 4;</span>
<a href="#l3.270"></a><span id="l3.270" class="difflineminus">-    for (row = 1; row &lt; 5; row++) {</span>
<a href="#l3.271"></a><span id="l3.271" class="difflineminus">-        for (col = 0; col &lt; 7; col++) {</span>
<a href="#l3.272"></a><span id="l3.272" class="difflineplus">+    for (let row = 1; row &lt; 5; row++) {</span>
<a href="#l3.273"></a><span id="l3.273" class="difflineplus">+        for (let col = 0; col &lt; 7; col++) {</span>
<a href="#l3.274"></a><span id="l3.274">             controller.assertNode(lookup(</span>
<a href="#l3.275"></a><span id="l3.275">                 eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)</span>
<a href="#l3.276"></a><span id="l3.276">             ));</span>
<a href="#l3.277"></a><span id="l3.277">             checkIcon(eventBox, row, col);</span>
<a href="#l3.278"></a><span id="l3.278">             checkTooltip(monthView, row, col, date, startTime, endTime);</span>
<a href="#l3.279"></a><span id="l3.279">             date++;</span>
<a href="#l3.280"></a><span id="l3.280">         }</span>
<a href="#l3.281"></a><span id="l3.281">     }</span>
<a href="#l3.282"></a><span id="l3.282" class="difflineat">@@ -244,18 +212,18 @@ function testEventDialog() {</span>
<a href="#l3.283"></a><span id="l3.283">     // verify all others still exist</span>
<a href="#l3.284"></a><span id="l3.284">     controller.assertNode(lookup(</span>
<a href="#l3.285"></a><span id="l3.285">         eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)</span>
<a href="#l3.286"></a><span id="l3.286">     ));</span>
<a href="#l3.287"></a><span id="l3.287">     controller.assertNode(lookup(</span>
<a href="#l3.288"></a><span id="l3.288">         eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)</span>
<a href="#l3.289"></a><span id="l3.289">     ));</span>
<a href="#l3.290"></a><span id="l3.290"> </span>
<a href="#l3.291"></a><span id="l3.291" class="difflineminus">-    for (row = 1; row &lt; 5; row++) {</span>
<a href="#l3.292"></a><span id="l3.292" class="difflineminus">-        for (col = 0; col &lt; 7; col++) {</span>
<a href="#l3.293"></a><span id="l3.293" class="difflineplus">+    for (let row = 1; row &lt; 5; row++) {</span>
<a href="#l3.294"></a><span id="l3.294" class="difflineplus">+        for (let col = 0; col &lt; 7; col++) {</span>
<a href="#l3.295"></a><span id="l3.295">             controller.assertNode(lookup(</span>
<a href="#l3.296"></a><span id="l3.296">                 eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)</span>
<a href="#l3.297"></a><span id="l3.297">             ));</span>
<a href="#l3.298"></a><span id="l3.298">         }</span>
<a href="#l3.299"></a><span id="l3.299">     }</span>
<a href="#l3.300"></a><span id="l3.300"> </span>
<a href="#l3.301"></a><span id="l3.301">     // delete series by deleting 3rd January and confirming to delete all</span>
<a href="#l3.302"></a><span id="l3.302">     controller.click(lookup(</span>
<a href="#l3.303"></a><span id="l3.303" class="difflineat">@@ -270,75 +238,78 @@ function testEventDialog() {</span>
<a href="#l3.304"></a><span id="l3.304">     ));</span>
<a href="#l3.305"></a><span id="l3.305">     controller.assertNodeNotExist(lookup(</span>
<a href="#l3.306"></a><span id="l3.306">         eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)</span>
<a href="#l3.307"></a><span id="l3.307">     ));</span>
<a href="#l3.308"></a><span id="l3.308">     controller.assertNodeNotExist(lookup(</span>
<a href="#l3.309"></a><span id="l3.309">         eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)</span>
<a href="#l3.310"></a><span id="l3.310">     ));</span>
<a href="#l3.311"></a><span id="l3.311"> </span>
<a href="#l3.312"></a><span id="l3.312" class="difflineminus">-    for (row = 1; row &lt; 5; row++) {</span>
<a href="#l3.313"></a><span id="l3.313" class="difflineminus">-        for (col = 0; col &lt; 7; col++) {</span>
<a href="#l3.314"></a><span id="l3.314" class="difflineplus">+    for (let row = 1; row &lt; 5; row++) {</span>
<a href="#l3.315"></a><span id="l3.315" class="difflineplus">+        for (let col = 0; col &lt; 7; col++) {</span>
<a href="#l3.316"></a><span id="l3.316">             controller.assertNodeNotExist(lookup(</span>
<a href="#l3.317"></a><span id="l3.317">                 eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)</span>
<a href="#l3.318"></a><span id="l3.318">             ));</span>
<a href="#l3.319"></a><span id="l3.319">         }</span>
<a href="#l3.320"></a><span id="l3.320">     }</span>
<a href="#l3.321"></a><span id="l3.321"> }</span>
<a href="#l3.322"></a><span id="l3.322"> </span>
<a href="#l3.323"></a><span id="l3.323"> function handleAttendees(attendees) {</span>
<a href="#l3.324"></a><span id="l3.324">     let { lookup: attendeeslookup } = helpersForController(attendees);</span>
<a href="#l3.325"></a><span id="l3.325"> </span>
<a href="#l3.326"></a><span id="l3.326">     let input = attendeeslookup(`</span>
<a href="#l3.327"></a><span id="l3.327" class="difflineminus">-        /id(&quot;calendar-event-dialog-attendees-v2&quot;)/[6]/[0]/id(&quot;attendees-list&quot;)/</span>
<a href="#l3.328"></a><span id="l3.328" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;listbox&quot;})/[1]/[1]/anon({&quot;anonid&quot;:&quot;input&quot;})/</span>
<a href="#l3.329"></a><span id="l3.329" class="difflineminus">-        {&quot;anonid&quot;:&quot;moz-input-box&quot;}/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l3.330"></a><span id="l3.330" class="difflineplus">+        /id(&quot;calendar-event-dialog-attendees-v2&quot;)/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l3.331"></a><span id="l3.331" class="difflineplus">+        id(&quot;attendees-container&quot;)/id(&quot;attendees-list&quot;)/[1]/[2]/[0]</span>
<a href="#l3.332"></a><span id="l3.332">     `);</span>
<a href="#l3.333"></a><span id="l3.333">     attendees.waitForElement(input);</span>
<a href="#l3.334"></a><span id="l3.334">     attendees.type(input, eventAttendee);</span>
<a href="#l3.335"></a><span id="l3.335">     attendees.click(attendeeslookup(`</span>
<a href="#l3.336"></a><span id="l3.336">         /id(&quot;calendar-event-dialog-attendees-v2&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l3.337"></a><span id="l3.337">         {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l3.338"></a><span id="l3.338">     `));</span>
<a href="#l3.339"></a><span id="l3.339"> }</span>
<a href="#l3.340"></a><span id="l3.340"> </span>
<a href="#l3.341"></a><span id="l3.341"> function checkIcon(eventBox, row, col) {</span>
<a href="#l3.342"></a><span id="l3.342">     let icon = lookup((`</span>
<a href="#l3.343"></a><span id="l3.343">         ${eventBox}/anon({&quot;anonid&quot;:&quot;category-box-stack&quot;})/</span>
<a href="#l3.344"></a><span id="l3.344" class="difflineminus">-        anon({&quot;align&quot;: &quot;right&quot;})/anon({&quot;class&quot;:&quot;alarm-icons-box&quot;})/</span>
<a href="#l3.345"></a><span id="l3.345" class="difflineplus">+        anon({&quot;align&quot;: &quot;center&quot;})/anon({&quot;class&quot;:&quot;alarm-icons-box&quot;})/</span>
<a href="#l3.346"></a><span id="l3.346">         anon({&quot;class&quot;: &quot;reminder-icon&quot;})</span>
<a href="#l3.347"></a><span id="l3.347">     `).replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col));</span>
<a href="#l3.348"></a><span id="l3.348"> </span>
<a href="#l3.349"></a><span id="l3.349">     controller.assertJS(icon.getNode().getAttribute(&quot;value&quot;) == &quot;DISPLAY&quot;);</span>
<a href="#l3.350"></a><span id="l3.350"> }</span>
<a href="#l3.351"></a><span id="l3.351"> </span>
<a href="#l3.352"></a><span id="l3.352"> function checkTooltip(monthView, row, col, date, startTime, endTime) {</span>
<a href="#l3.353"></a><span id="l3.353" class="difflineminus">-    controller.mouseOver(lookup((`</span>
<a href="#l3.354"></a><span id="l3.354" class="difflineplus">+    controller.mouseOver(lookup(`</span>
<a href="#l3.355"></a><span id="l3.355">         ${monthView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l3.356"></a><span id="l3.356" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/</span>
<a href="#l3.357"></a><span id="l3.357" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[${row}]/[${col}]/</span>
<a href="#l3.358"></a><span id="l3.358">         {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}</span>
<a href="#l3.359"></a><span id="l3.359" class="difflineminus">-    `).replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l3.360"></a><span id="l3.360" class="difflineplus">+    `));</span>
<a href="#l3.361"></a><span id="l3.361"> </span>
<a href="#l3.362"></a><span id="l3.362">     // check title</span>
<a href="#l3.363"></a><span id="l3.363">     let eventName = lookup(`</span>
<a href="#l3.364"></a><span id="l3.364">         /id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/</span>
<a href="#l3.365"></a><span id="l3.365">         {&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[0]/[1]</span>
<a href="#l3.366"></a><span id="l3.366">     `);</span>
<a href="#l3.367"></a><span id="l3.367" class="difflineminus">-    controller.assertJS(eventName.getNode().textContent == eventTitle);</span>
<a href="#l3.368"></a><span id="l3.368" class="difflineplus">+    controller.waitFor(() =&gt; eventName.getNode().textContent == eventTitle);</span>
<a href="#l3.369"></a><span id="l3.369"> </span>
<a href="#l3.370"></a><span id="l3.370">     // check date and time</span>
<a href="#l3.371"></a><span id="l3.371" class="difflineminus">-    // date-time string contains strings formatted in operating system language</span>
<a href="#l3.372"></a><span id="l3.372" class="difflineminus">-    // so check numeric values only</span>
<a href="#l3.373"></a><span id="l3.373">     let dateTime = lookup(`</span>
<a href="#l3.374"></a><span id="l3.374">         /id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/</span>
<a href="#l3.375"></a><span id="l3.375">         {&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[2]/[1]</span>
<a href="#l3.376"></a><span id="l3.376" class="difflineminus">-    `).getNode().textContent;</span>
<a href="#l3.377"></a><span id="l3.377" class="difflineplus">+    `);</span>
<a href="#l3.378"></a><span id="l3.378" class="difflineplus">+</span>
<a href="#l3.379"></a><span id="l3.379" class="difflineplus">+    let formatter = new Services.intl.DateTimeFormat(undefined, { dateStyle: &quot;full&quot; });</span>
<a href="#l3.380"></a><span id="l3.380" class="difflineplus">+    let startDate = formatter.format(new Date(2009, 0, date));</span>
<a href="#l3.381"></a><span id="l3.381"> </span>
<a href="#l3.382"></a><span id="l3.382" class="difflineminus">-    controller.assertJS(</span>
<a href="#l3.383"></a><span id="l3.383" class="difflineminus">-        dateTime.includes(date) &amp;&amp;</span>
<a href="#l3.384"></a><span id="l3.384" class="difflineminus">-        dateTime.includes(startTime) &amp;&amp;</span>
<a href="#l3.385"></a><span id="l3.385" class="difflineminus">-        dateTime.includes(endTime)</span>
<a href="#l3.386"></a><span id="l3.386" class="difflineminus">-    );</span>
<a href="#l3.387"></a><span id="l3.387" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l3.388"></a><span id="l3.388" class="difflineplus">+        let text = dateTime.getNode().textContent;</span>
<a href="#l3.389"></a><span id="l3.389" class="difflineplus">+        dump(`${text}\n`);</span>
<a href="#l3.390"></a><span id="l3.390" class="difflineplus">+        return text.includes(`${startDate} ${startTime}  `);</span>
<a href="#l3.391"></a><span id="l3.391" class="difflineplus">+    });</span>
<a href="#l3.392"></a><span id="l3.392" class="difflineplus">+</span>
<a href="#l3.393"></a><span id="l3.393" class="difflineplus">+    // This could be on the next day if it is 00:00.</span>
<a href="#l3.394"></a><span id="l3.394" class="difflineplus">+    controller.assertJS(() =&gt; dateTime.getNode().textContent.endsWith(endTime));</span>
<a href="#l3.395"></a><span id="l3.395"> }</span>
<a href="#l3.396"></a><span id="l3.396"> </span>
<a href="#l3.397"></a><span id="l3.397"> function teardownTest(module) {</span>
<a href="#l3.398"></a><span id="l3.398">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l3.399"></a><span id="l3.399"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -4,19 +4,16 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l4.6"></a><span id="l4.6"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> var helpersForController, invokeEventDialog, createCalendar;</span>
<a href="#l4.9"></a><span id="l4.9"> var deleteCalendars, switchToView, goToDate, setData;</span>
<a href="#l4.10"></a><span id="l4.10"> var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-var prefs = require(&quot;../shared-modules/prefs&quot;);</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-</span>
<a href="#l4.15"></a><span id="l4.15"> var savePromptAppeared = false;</span>
<a href="#l4.16"></a><span id="l4.16"> var { date1, date2, date3, data, newlines } = setupData();</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18"> function setupModule(module) {</span>
<a href="#l4.19"></a><span id="l4.19">     controller = mozmill.getMail3PaneController();</span>
<a href="#l4.20"></a><span id="l4.20">     ({</span>
<a href="#l4.21"></a><span id="l4.21">         helpersForController,</span>
<a href="#l4.22"></a><span id="l4.22">         invokeEventDialog,</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineat">@@ -28,19 +25,16 @@ function setupModule(module) {</span>
<a href="#l4.24"></a><span id="l4.24">         CALENDARNAME,</span>
<a href="#l4.25"></a><span id="l4.25">         EVENT_BOX,</span>
<a href="#l4.26"></a><span id="l4.26">         CANVAS_BOX,</span>
<a href="#l4.27"></a><span id="l4.27">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l4.28"></a><span id="l4.28">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l4.29"></a><span id="l4.29">     Object.assign(module, helpersForController(controller));</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-    let categories = prefs.preferences.getPref(&quot;calendar.categories.names&quot;, &quot;string&quot;).split(&quot;,&quot;);</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-    data[0].category = categories[0];</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-    data[1].category = categories[1];</span>
<a href="#l4.35"></a><span id="l4.35"> }</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37"> // Test that closing an event dialog with no changes does not prompt for save</span>
<a href="#l4.38"></a><span id="l4.38"> function testEventDialogModificationPrompt() {</span>
<a href="#l4.39"></a><span id="l4.39">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l4.40"></a><span id="l4.40">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l4.41"></a><span id="l4.41">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l4.42"></a><span id="l4.42"> </span>
<a href="#l4.43"></a><span id="l4.43" class="difflineat">@@ -54,67 +48,52 @@ function testEventDialogModificationProm</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45">         // save</span>
<a href="#l4.46"></a><span id="l4.46">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l4.47"></a><span id="l4.47">     });</span>
<a href="#l4.48"></a><span id="l4.48"> </span>
<a href="#l4.49"></a><span id="l4.49">     eventbox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8, '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l4.50"></a><span id="l4.50">     invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l4.51"></a><span id="l4.51">         // open, but change nothing</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-        dialog.start(handleSavePrompt);</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-</span>
<a href="#l4.55"></a><span id="l4.55">         // escape the event window, there should be no prompt to save event</span>
<a href="#l4.56"></a><span id="l4.56">         event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-        sleep();</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-        dialog.stop();</span>
<a href="#l4.59"></a><span id="l4.59">     });</span>
<a href="#l4.60"></a><span id="l4.60"> </span>
<a href="#l4.61"></a><span id="l4.61">     // open</span>
<a href="#l4.62"></a><span id="l4.62">     eventbox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8, '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l4.63"></a><span id="l4.63">     invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l4.64"></a><span id="l4.64">         // change all values</span>
<a href="#l4.65"></a><span id="l4.65">         setData(event, iframe, data[1]);</span>
<a href="#l4.66"></a><span id="l4.66"> </span>
<a href="#l4.67"></a><span id="l4.67">         // edit all values back to original</span>
<a href="#l4.68"></a><span id="l4.68">         setData(event, iframe, data[0]);</span>
<a href="#l4.69"></a><span id="l4.69"> </span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-        // this is set up after data entry because otherwise it tries to handle</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-        // attachment dialog</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-        dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-        dialog.start(handleSavePrompt);</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-</span>
<a href="#l4.75"></a><span id="l4.75">         // escape the event window, there should be no prompt to save event</span>
<a href="#l4.76"></a><span id="l4.76">         event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-        sleep();</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-        dialog.stop();</span>
<a href="#l4.79"></a><span id="l4.79">     });</span>
<a href="#l4.80"></a><span id="l4.80"> </span>
<a href="#l4.81"></a><span id="l4.81">     // delete event</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-    controller.click(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8));</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+    controller.click(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8, '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}'));</span>
<a href="#l4.84"></a><span id="l4.84">     controller.keypress(eid(&quot;day-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l4.85"></a><span id="l4.85">     controller.waitForElementNotPresent(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8));</span>
<a href="#l4.86"></a><span id="l4.86"> </span>
<a href="#l4.87"></a><span id="l4.87">     for (let i = 0; i &lt; newlines.length; i++) {</span>
<a href="#l4.88"></a><span id="l4.88">         // test set i</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-        eventbox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8, '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+        eventbox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, 8);</span>
<a href="#l4.91"></a><span id="l4.91">         invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+            let { eid: eventid } = helpersForController(event);</span>
<a href="#l4.93"></a><span id="l4.93">             setData(event, iframe, newlines[i]);</span>
<a href="#l4.94"></a><span id="l4.94">             event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l4.95"></a><span id="l4.95">         });</span>
<a href="#l4.96"></a><span id="l4.96"> </span>
<a href="#l4.97"></a><span id="l4.97">         // open and close</span>
<a href="#l4.98"></a><span id="l4.98">         eventbox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8, '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l4.99"></a><span id="l4.99">         invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l4.100"></a><span id="l4.100">             setData(event, iframe, newlines[i]);</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-            dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineminus">-            dialog.start(handleSavePrompt);</span>
<a href="#l4.103"></a><span id="l4.103">             event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-            sleep();</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-            dialog.stop();</span>
<a href="#l4.106"></a><span id="l4.106">         });</span>
<a href="#l4.107"></a><span id="l4.107"> </span>
<a href="#l4.108"></a><span id="l4.108">         // delete it</span>
<a href="#l4.109"></a><span id="l4.109">         // XXX somehow the event is selected at this point, this didn't use to</span>
<a href="#l4.110"></a><span id="l4.110">         // be the case and can't be reproduced manually</span>
<a href="#l4.111"></a><span id="l4.111">         controller.keypress(eid(&quot;day-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l4.112"></a><span id="l4.112">         controller.waitForElementNotPresent(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8));</span>
<a href="#l4.113"></a><span id="l4.113">     }</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineat">@@ -122,66 +101,53 @@ function testEventDialogModificationProm</span>
<a href="#l4.115"></a><span id="l4.115"> </span>
<a href="#l4.116"></a><span id="l4.116"> function teardownTest(module) {</span>
<a href="#l4.117"></a><span id="l4.117">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l4.118"></a><span id="l4.118">     if (savePromptAppeared) {</span>
<a href="#l4.119"></a><span id="l4.119">         controller.assertJS('&quot;Prompt appeared&quot; == &quot;Prompt didn\'t appear.&quot;');</span>
<a href="#l4.120"></a><span id="l4.120">     }</span>
<a href="#l4.121"></a><span id="l4.121"> }</span>
<a href="#l4.122"></a><span id="l4.122"> </span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">-function handleSavePrompt(controller) {</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-    // unexpected prompt, thus the test has already failed</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">-    // can't trigger a failure though, because the following click wouldn't be executed</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-    // so remembering it</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-    savePromptAppered = true;</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-    // application close is blocked without it</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-        /id(&quot;commonDialog&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;extra1&quot;}</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-    `));</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineminus">-}</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineminus">-</span>
<a href="#l4.134"></a><span id="l4.134"> function setupData() {</span>
<a href="#l4.135"></a><span id="l4.135">     return {</span>
<a href="#l4.136"></a><span id="l4.136">         date1: new Date(2009, 0, 1, 8, 0),</span>
<a href="#l4.137"></a><span id="l4.137">         date2: new Date(2009, 0, 2, 9, 0),</span>
<a href="#l4.138"></a><span id="l4.138">         date3: new Date(2009, 0, 3, 10, 0),</span>
<a href="#l4.139"></a><span id="l4.139">         data: [{</span>
<a href="#l4.140"></a><span id="l4.140">             title: &quot;title1&quot;,</span>
<a href="#l4.141"></a><span id="l4.141">             location: &quot;location1&quot;,</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineplus">+            category: &quot;Anniversary&quot;,</span>
<a href="#l4.143"></a><span id="l4.143">             description: &quot;description1&quot;,</span>
<a href="#l4.144"></a><span id="l4.144">             allday: false,</span>
<a href="#l4.145"></a><span id="l4.145">             startdate: date1,</span>
<a href="#l4.146"></a><span id="l4.146">             starttime: date1,</span>
<a href="#l4.147"></a><span id="l4.147">             enddate: date2,</span>
<a href="#l4.148"></a><span id="l4.148">             endtime: date2,</span>
<a href="#l4.149"></a><span id="l4.149">             repeat: &quot;none&quot;,</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineminus">-            reminder: 0,</span>
<a href="#l4.151"></a><span id="l4.151">             priority: &quot;normal&quot;,</span>
<a href="#l4.152"></a><span id="l4.152">             privacy: &quot;public&quot;,</span>
<a href="#l4.153"></a><span id="l4.153">             status: &quot;confirmed&quot;,</span>
<a href="#l4.154"></a><span id="l4.154">             freebusy: &quot;busy&quot;,</span>
<a href="#l4.155"></a><span id="l4.155">             timezone: true,</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineminus">-            attachment: { add: &quot;http://mozilla.org&quot; }</span>
<a href="#l4.157"></a><span id="l4.157">         }, {</span>
<a href="#l4.158"></a><span id="l4.158">             title: &quot;title2&quot;,</span>
<a href="#l4.159"></a><span id="l4.159">             location: &quot;location2&quot;,</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineplus">+            category: &quot;Birthday&quot;,</span>
<a href="#l4.161"></a><span id="l4.161">             description: &quot;description2&quot;,</span>
<a href="#l4.162"></a><span id="l4.162">             allday: true,</span>
<a href="#l4.163"></a><span id="l4.163">             startdate: date2,</span>
<a href="#l4.164"></a><span id="l4.164">             starttime: date2,</span>
<a href="#l4.165"></a><span id="l4.165">             enddate: date3,</span>
<a href="#l4.166"></a><span id="l4.166">             endtime: date3,</span>
<a href="#l4.167"></a><span id="l4.167">             repeat: &quot;daily&quot;,</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineminus">-            reminder: 2,</span>
<a href="#l4.169"></a><span id="l4.169">             priority: &quot;high&quot;,</span>
<a href="#l4.170"></a><span id="l4.170">             privacy: &quot;private&quot;,</span>
<a href="#l4.171"></a><span id="l4.171">             status: &quot;tentative&quot;,</span>
<a href="#l4.172"></a><span id="l4.172">             freebusy: &quot;free&quot;,</span>
<a href="#l4.173"></a><span id="l4.173">             timezone: true,</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineminus">-            attachment: { &quot;delete&quot;: &quot;mozilla.org&quot; }</span>
<a href="#l4.175"></a><span id="l4.175">         }],</span>
<a href="#l4.176"></a><span id="l4.176">         newlines: [</span>
<a href="#l4.177"></a><span id="l4.177">             { title: &quot;title&quot;, description: &quot;  test spaces  &quot; },</span>
<a href="#l4.178"></a><span id="l4.178">             { title: &quot;title&quot;, description: &quot;\ntest newline\n&quot; },</span>
<a href="#l4.179"></a><span id="l4.179">             { title: &quot;title&quot;, description: &quot;\rtest \\r\r&quot; },</span>
<a href="#l4.180"></a><span id="l4.180">             { title: &quot;title&quot;, description: &quot;\r\ntest \\r\\n\r\n&quot; },</span>
<a href="#l4.181"></a><span id="l4.181">             { title: &quot;title&quot;, description: &quot;\ttest \\t\t&quot; }</span>
<a href="#l4.182"></a><span id="l4.182">         ]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,97 +1,83 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.5"></a><span id="l5.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.6"></a><span id="l5.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l5.9"></a><span id="l5.9"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> var helpersForController, invokeEventDialog, createCalendar;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-var deleteCalendars, switchToView;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+var deleteCalendars, switchToView, setData;</span>
<a href="#l5.14"></a><span id="l5.14"> var EVENT_BOX, CANVAS_BOX;</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> var UTF8STRING = &quot;      &quot;;</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> function setupModule(module) {</span>
<a href="#l5.21"></a><span id="l5.21">     controller = mozmill.getMail3PaneController();</span>
<a href="#l5.22"></a><span id="l5.22">     ({</span>
<a href="#l5.23"></a><span id="l5.23">         helpersForController,</span>
<a href="#l5.24"></a><span id="l5.24">         invokeEventDialog,</span>
<a href="#l5.25"></a><span id="l5.25">         createCalendar,</span>
<a href="#l5.26"></a><span id="l5.26">         deleteCalendars,</span>
<a href="#l5.27"></a><span id="l5.27">         switchToView,</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+        setData,</span>
<a href="#l5.29"></a><span id="l5.29">         EVENT_BOX,</span>
<a href="#l5.30"></a><span id="l5.30">         CANVAS_BOX</span>
<a href="#l5.31"></a><span id="l5.31">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l5.32"></a><span id="l5.32">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l5.33"></a><span id="l5.33">     Object.assign(module, helpersForController(controller));</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35">     createCalendar(controller, UTF8STRING);</span>
<a href="#l5.36"></a><span id="l5.36">     Preferences.set(&quot;calendar.categories.names&quot;, UTF8STRING);</span>
<a href="#l5.37"></a><span id="l5.37"> }</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39"> function testUTF8() {</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-    let eventDialog = '/id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)';</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-</span>
<a href="#l5.42"></a><span id="l5.42">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l5.43"></a><span id="l5.43">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l5.44"></a><span id="l5.44"> </span>
<a href="#l5.45"></a><span id="l5.45">     // create new event</span>
<a href="#l5.46"></a><span id="l5.46">     let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, 8);</span>
<a href="#l5.47"></a><span id="l5.47">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+        let { lookup: iframeLookup, eid: iframeId } = helpersForController(iframe);</span>
<a href="#l5.51"></a><span id="l5.51"> </span>
<a href="#l5.52"></a><span id="l5.52">         // fill in name, location, description</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-        let titleTextBox = eventlookup(`</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+        setData(event, iframe, { title: UTF8STRING, location: UTF8STRING, description: UTF8STRING });</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+        let menuitem = iframeLookup(`</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+            /id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+            id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-category-color-row&quot;)/</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+            id(&quot;event-grid-category-box&quot;)/id(&quot;item-categories&quot;)/</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+            id(&quot;item-categories-popup&quot;)/[2]</span>
<a href="#l5.63"></a><span id="l5.63">         `);</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-        event.waitForElement(titleTextBox);</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-        event.type(titleTextBox, UTF8STRING);</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-        `), UTF8STRING);</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-        `), UTF8STRING);</span>
<a href="#l5.74"></a><span id="l5.74"> </span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-        // select category</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-        event.select(eventid(&quot;item-categories&quot;), null, UTF8STRING);</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+        event.click(iframeId(&quot;item-categories&quot;));</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+        menuitem.getNode().click();</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+        menuitem.getNode().setAttribute(&quot;checked&quot;, &quot;true&quot;); // When in doubt, cheat.</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+        event.waitFor(() =&gt; iframeId(&quot;item-categories&quot;).getNode().label == UTF8STRING);</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+        iframeId(&quot;item-categories-popup&quot;).getNode().hidePopup();</span>
<a href="#l5.82"></a><span id="l5.82"> </span>
<a href="#l5.83"></a><span id="l5.83">         // save</span>
<a href="#l5.84"></a><span id="l5.84">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l5.85"></a><span id="l5.85">     });</span>
<a href="#l5.86"></a><span id="l5.86"> </span>
<a href="#l5.87"></a><span id="l5.87">     // open</span>
<a href="#l5.88"></a><span id="l5.88">     let eventPath = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${UTF8STRING.toLowerCase()}&quot;}`;</span>
<a href="#l5.89"></a><span id="l5.89">     eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8, eventPath);</span>
<a href="#l5.90"></a><span id="l5.90">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+        let { eid: iframeId } = helpersForController(iframe);</span>
<a href="#l5.93"></a><span id="l5.93"> </span>
<a href="#l5.94"></a><span id="l5.94">         // check values</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-        titleTextBox = eventlookup(`</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineminus">-        `);</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineminus">-        event.waitForElement(titleTextBox);</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-        event.assertValue(titleTextBox, UTF8STRING);</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineminus">-        event.assertValue(eventlookup(`</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-        `), UTF8STRING);</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-        event.assertValue(eventlookup(`</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineminus">-        `), UTF8STRING);</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineminus">-        event.assertValue(eventid(&quot;item-categories&quot;), UTF8STRING);</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+        event.assertValue(iframeId(&quot;item-title&quot;), UTF8STRING);</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+        event.assertValue(iframeId(&quot;item-location&quot;), UTF8STRING);</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+        event.assertValue(iframeId(&quot;item-description&quot;), UTF8STRING);</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+        event.assertJS(() =&gt; iframeId(&quot;item-categories&quot;).getNode().querySelector(`menuitem[label=&quot;${UTF8STRING}&quot;][checked]`));</span>
<a href="#l5.114"></a><span id="l5.114"> </span>
<a href="#l5.115"></a><span id="l5.115">         // escape the event window</span>
<a href="#l5.116"></a><span id="l5.116">         event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l5.117"></a><span id="l5.117">     });</span>
<a href="#l5.118"></a><span id="l5.118"> }</span>
<a href="#l5.119"></a><span id="l5.119"> </span>
<a href="#l5.120"></a><span id="l5.120"> function teardownTest(module) {</span>
<a href="#l5.121"></a><span id="l5.121">     deleteCalendars(controller, UTF8STRING);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/test/mozmill/mozmilltests.list</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/test/mozmill/mozmilltests.list</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,6 +1,9 @@</span>
<a href="#l6.4"></a><span id="l6.4"> cal-recurrence</span>
<a href="#l6.5"></a><span id="l6.5"> invitations</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+recurrenceRotated</span>
<a href="#l6.7"></a><span id="l6.7"> testAlarmDefaultValue.js</span>
<a href="#l6.8"></a><span id="l6.8"> testBasicFunctionality.js</span>
<a href="#l6.9"></a><span id="l6.9"> testLocalICS.js</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+testTimezones.js</span>
<a href="#l6.11"></a><span id="l6.11"> testTodayPane.js</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+views</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,96 +1,99 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.5"></a><span id="l7.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.6"></a><span id="l7.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+var MODULE_NAME = &quot;testAnnualRecurrence&quot;;</span>
<a href="#l7.9"></a><span id="l7.9"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l7.10"></a><span id="l7.10"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-var switchToView, goToDate, handleOccurrencePrompt;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-var ALLDAY, CALENDARNAME;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+var CALENDARNAME, EVENTPATH, ALLDAY;</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+var helpersForController, handleOccurrencePrompt, switchToView, goToDate;</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+var invokeEventDialog, deleteCalendars, createCalendar, menulistSelect;</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-var STARTYEAR = 1950;</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-var EPOCH = 1970;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+const STARTYEAR = 1950;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+const EPOCH = 1970;</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24"> function setupModule(module) {</span>
<a href="#l7.25"></a><span id="l7.25">     controller = mozmill.getMail3PaneController();</span>
<a href="#l7.26"></a><span id="l7.26">     ({</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+        EVENTPATH,</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+        ALLDAY,</span>
<a href="#l7.30"></a><span id="l7.30">         helpersForController,</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-        invokeEventDialog,</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-        createCalendar,</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-        deleteCalendars,</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l7.35"></a><span id="l7.35">         switchToView,</span>
<a href="#l7.36"></a><span id="l7.36">         goToDate,</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-        handleOccurrencePrompt,</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-        ALLDAY,</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">-        CALENDARNAME</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+        deleteCalendars,</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+        createCalendar,</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+        menulistSelect</span>
<a href="#l7.44"></a><span id="l7.44">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l7.45"></a><span id="l7.45">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l7.46"></a><span id="l7.46">     Object.assign(module, helpersForController(controller));</span>
<a href="#l7.47"></a><span id="l7.47"> </span>
<a href="#l7.48"></a><span id="l7.48">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l7.49"></a><span id="l7.49"> }</span>
<a href="#l7.50"></a><span id="l7.50"> </span>
<a href="#l7.51"></a><span id="l7.51"> function testAnnualRecurrence() {</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-    let EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l7.53"></a><span id="l7.53">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+    sleep();</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+</span>
<a href="#l7.56"></a><span id="l7.56">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l7.57"></a><span id="l7.57">     goToDate(controller, STARTYEAR, 1, 1);</span>
<a href="#l7.58"></a><span id="l7.58"> </span>
<a href="#l7.59"></a><span id="l7.59">     // rotate view</span>
<a href="#l7.60"></a><span id="l7.60">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l7.61"></a><span id="l7.61">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l7.62"></a><span id="l7.62"> </span>
<a href="#l7.63"></a><span id="l7.63">     // create yearly recurring all-day event</span>
<a href="#l7.64"></a><span id="l7.64">     let eventBox = lookupEventBox(&quot;day&quot;, ALLDAY, null, 1, null);</span>
<a href="#l7.65"></a><span id="l7.65">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l7.66"></a><span id="l7.66">         let { eid: eventid } = helpersForController(event);</span>
<a href="#l7.67"></a><span id="l7.67"> </span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;yearly&quot;);</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-        event.click(eventid(&quot;button-save&quot;));</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+        menulistSelect(eventid(&quot;item-repeat&quot;), &quot;yearly&quot;, event);</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l7.72"></a><span id="l7.72">     });</span>
<a href="#l7.73"></a><span id="l7.73"> </span>
<a href="#l7.74"></a><span id="l7.74">     let checkYears = [STARTYEAR, STARTYEAR + 1, EPOCH - 1, EPOCH, EPOCH + 1];</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-    let box = &quot;&quot;;</span>
<a href="#l7.76"></a><span id="l7.76">     for (let year of checkYears) {</span>
<a href="#l7.77"></a><span id="l7.77">         goToDate(controller, year, 1, 1);</span>
<a href="#l7.78"></a><span id="l7.78">         let date = new Date(year, 0, 1);</span>
<a href="#l7.79"></a><span id="l7.79">         let column = date.getDay() + 1;</span>
<a href="#l7.80"></a><span id="l7.80"> </span>
<a href="#l7.81"></a><span id="l7.81">         // day view</span>
<a href="#l7.82"></a><span id="l7.82">         switchToView(controller, &quot;day&quot;);</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineminus">-        controller.assertNode(</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l7.85"></a><span id="l7.85">             lookupEventBox(&quot;day&quot;, ALLDAY, null, 1, null, EVENTPATH)</span>
<a href="#l7.86"></a><span id="l7.86">         );</span>
<a href="#l7.87"></a><span id="l7.87"> </span>
<a href="#l7.88"></a><span id="l7.88">         // week view</span>
<a href="#l7.89"></a><span id="l7.89">         switchToView(controller, &quot;week&quot;);</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-        controller.assertNode(</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l7.92"></a><span id="l7.92">             lookupEventBox(&quot;week&quot;, ALLDAY, null, column, null, EVENTPATH)</span>
<a href="#l7.93"></a><span id="l7.93">         );</span>
<a href="#l7.94"></a><span id="l7.94"> </span>
<a href="#l7.95"></a><span id="l7.95">         // multiweek view</span>
<a href="#l7.96"></a><span id="l7.96">         switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-        controller.assertNode(</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l7.99"></a><span id="l7.99">             lookupEventBox(&quot;multiweek&quot;, ALLDAY, 1, column, null, EVENTPATH)</span>
<a href="#l7.100"></a><span id="l7.100">         );</span>
<a href="#l7.101"></a><span id="l7.101"> </span>
<a href="#l7.102"></a><span id="l7.102">         // month view</span>
<a href="#l7.103"></a><span id="l7.103">         switchToView(controller, &quot;month&quot;);</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineminus">-        controller.assertNode(</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l7.106"></a><span id="l7.106">             lookupEventBox(&quot;month&quot;, ALLDAY, 1, column, null, EVENTPATH)</span>
<a href="#l7.107"></a><span id="l7.107">         );</span>
<a href="#l7.108"></a><span id="l7.108">     }</span>
<a href="#l7.109"></a><span id="l7.109"> </span>
<a href="#l7.110"></a><span id="l7.110">     // delete event</span>
<a href="#l7.111"></a><span id="l7.111">     goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l7.112"></a><span id="l7.112">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineminus">-    box = getEventBoxPath(&quot;day&quot;, ALLDAY, null, 1, null) + EVENTPATH;</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineplus">+    let box = getEventBoxPath(&quot;day&quot;, ALLDAY, null, 1, null) + EVENTPATH;</span>
<a href="#l7.115"></a><span id="l7.115">     controller.click(lookup(box));</span>
<a href="#l7.116"></a><span id="l7.116">     handleOccurrencePrompt(controller, eid(&quot;day-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l7.117"></a><span id="l7.117">     controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l7.118"></a><span id="l7.118"> </span>
<a href="#l7.119"></a><span id="l7.119">     // reset view</span>
<a href="#l7.120"></a><span id="l7.120">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l7.121"></a><span id="l7.121">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l7.122"></a><span id="l7.122"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,36 +1,38 @@</span>
<a href="#l8.4"></a><span id="l8.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.5"></a><span id="l8.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.6"></a><span id="l8.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8" class="difflineplus">+var MODULE_NAME = &quot;testBiweeklyRecurrence&quot;;</span>
<a href="#l8.9"></a><span id="l8.9"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l8.10"></a><span id="l8.10"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-var switchToView, goToDate, viewForward, handleOccurrencePrompt;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+var CALENDARNAME, EVENTPATH, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+var helpersForController, handleOccurrencePrompt, switchToView, goToDate;</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+var invokeEventDialog, viewForward, createCalendar, deleteCalendars, menulistSelect;</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-var HOUR = 8;</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+const HOUR = 8;</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23"> function setupModule(module) {</span>
<a href="#l8.24"></a><span id="l8.24">     controller = mozmill.getMail3PaneController();</span>
<a href="#l8.25"></a><span id="l8.25">     ({</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+        EVENTPATH,</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l8.30"></a><span id="l8.30">         helpersForController,</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-        invokeEventDialog,</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-        createCalendar,</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-        deleteCalendars,</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l8.35"></a><span id="l8.35">         switchToView,</span>
<a href="#l8.36"></a><span id="l8.36">         goToDate,</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l8.38"></a><span id="l8.38">         viewForward,</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-        handleOccurrencePrompt,</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-        CALENDARNAME,</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-        EVENT_BOX,</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-        CANVAS_BOX</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+        deleteCalendars,</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+        createCalendar,</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+        menulistSelect</span>
<a href="#l8.46"></a><span id="l8.46">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l8.47"></a><span id="l8.47">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l8.48"></a><span id="l8.48">     Object.assign(module, helpersForController(controller));</span>
<a href="#l8.49"></a><span id="l8.49"> </span>
<a href="#l8.50"></a><span id="l8.50">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l8.51"></a><span id="l8.51"> }</span>
<a href="#l8.52"></a><span id="l8.52"> </span>
<a href="#l8.53"></a><span id="l8.53"> function testBiweeklyRecurrence() {</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineat">@@ -42,73 +44,76 @@ function testBiweeklyRecurrence() {</span>
<a href="#l8.55"></a><span id="l8.55">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l8.56"></a><span id="l8.56">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l8.57"></a><span id="l8.57"> </span>
<a href="#l8.58"></a><span id="l8.58">     // create biweekly event</span>
<a href="#l8.59"></a><span id="l8.59">     let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l8.60"></a><span id="l8.60">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l8.61"></a><span id="l8.61">         let { eid: eventid } = helpersForController(event);</span>
<a href="#l8.62"></a><span id="l8.62"> </span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;bi.weekly&quot;);</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+        menulistSelect(eventid(&quot;item-repeat&quot;), &quot;bi.weekly&quot;, event);</span>
<a href="#l8.66"></a><span id="l8.66">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l8.67"></a><span id="l8.67">     });</span>
<a href="#l8.68"></a><span id="l8.68"> </span>
<a href="#l8.69"></a><span id="l8.69">     // check day view</span>
<a href="#l8.70"></a><span id="l8.70">     for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-        controller.assertNode(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH));</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+            lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH)</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+        );</span>
<a href="#l8.75"></a><span id="l8.75">         viewForward(controller, 14);</span>
<a href="#l8.76"></a><span id="l8.76">     }</span>
<a href="#l8.77"></a><span id="l8.77"> </span>
<a href="#l8.78"></a><span id="l8.78">     // check week view</span>
<a href="#l8.79"></a><span id="l8.79">     switchToView(controller, &quot;week&quot;);</span>
<a href="#l8.80"></a><span id="l8.80">     goToDate(controller, 2009, 1, 31);</span>
<a href="#l8.81"></a><span id="l8.81"> </span>
<a href="#l8.82"></a><span id="l8.82">     for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-        controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR, EVENTPATH));</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR, EVENTPATH)</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineplus">+        );</span>
<a href="#l8.87"></a><span id="l8.87">         viewForward(controller, 2);</span>
<a href="#l8.88"></a><span id="l8.88">     }</span>
<a href="#l8.89"></a><span id="l8.89"> </span>
<a href="#l8.90"></a><span id="l8.90">     // check multiweek view</span>
<a href="#l8.91"></a><span id="l8.91">     switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l8.92"></a><span id="l8.92">     goToDate(controller, 2009, 1, 31);</span>
<a href="#l8.93"></a><span id="l8.93"> </span>
<a href="#l8.94"></a><span id="l8.94">     // always two occurrences in view, 1st and 3rd or 2nd and 4th week</span>
<a href="#l8.95"></a><span id="l8.95">     for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineminus">-        controller.assertNode(</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l8.98"></a><span id="l8.98">             lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i % 2 + 1, 7, null, EVENTPATH)</span>
<a href="#l8.99"></a><span id="l8.99">         );</span>
<a href="#l8.100"></a><span id="l8.100">         controller.assertNode(</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineminus">-            getEventBoxPath(&quot;multiweek&quot;, EVENT_BOX, i % 2 + 3, 7, null, EVENTPATH)</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i % 2 + 3, 7, null, EVENTPATH)</span>
<a href="#l8.103"></a><span id="l8.103">         );</span>
<a href="#l8.104"></a><span id="l8.104">         viewForward(controller, 1);</span>
<a href="#l8.105"></a><span id="l8.105">     }</span>
<a href="#l8.106"></a><span id="l8.106"> </span>
<a href="#l8.107"></a><span id="l8.107">     // check month view</span>
<a href="#l8.108"></a><span id="l8.108">     switchToView(controller, &quot;month&quot;);</span>
<a href="#l8.109"></a><span id="l8.109">     goToDate(controller, 2009, 1, 31);</span>
<a href="#l8.110"></a><span id="l8.110"> </span>
<a href="#l8.111"></a><span id="l8.111">     // January</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineminus">-    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 5, 7, null, EVENTPATH));</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineplus">+    controller.waitForElement(lookupEventBox(&quot;month&quot;, EVENT_BOX, 5, 7, null, EVENTPATH));</span>
<a href="#l8.114"></a><span id="l8.114">     viewForward(controller, 1);</span>
<a href="#l8.115"></a><span id="l8.115"> </span>
<a href="#l8.116"></a><span id="l8.116">     // February</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 2, 7, null, EVENTPATH));</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+    controller.waitForElement(lookupEventBox(&quot;month&quot;, EVENT_BOX, 2, 7, null, EVENTPATH));</span>
<a href="#l8.119"></a><span id="l8.119">     controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 4, 7, null, EVENTPATH));</span>
<a href="#l8.120"></a><span id="l8.120">     viewForward(controller, 1);</span>
<a href="#l8.121"></a><span id="l8.121"> </span>
<a href="#l8.122"></a><span id="l8.122">     // March</span>
<a href="#l8.123"></a><span id="l8.123" class="difflineminus">-    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 2, 7, null, EVENTPATH));</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineplus">+    controller.waitForElement(lookupEventBox(&quot;month&quot;, EVENT_BOX, 2, 7, null, EVENTPATH));</span>
<a href="#l8.125"></a><span id="l8.125">     controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 4, 7, null, EVENTPATH));</span>
<a href="#l8.126"></a><span id="l8.126"> </span>
<a href="#l8.127"></a><span id="l8.127">     // delete event</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineminus">-    let box = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 4, 7, null) + EVENTPATH;</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineminus">-    controller.click(lookup(box));</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineplus">+    let box = lookupEventBox(&quot;month&quot;, EVENT_BOX, 4, 7, null, EVENTPATH);</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineplus">+    controller.click(box);</span>
<a href="#l8.132"></a><span id="l8.132">     handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l8.133"></a><span id="l8.133" class="difflineminus">-    controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l8.134"></a><span id="l8.134" class="difflineplus">+    controller.waitForElementNotPresent(box);</span>
<a href="#l8.135"></a><span id="l8.135"> </span>
<a href="#l8.136"></a><span id="l8.136">     // reset view</span>
<a href="#l8.137"></a><span id="l8.137">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l8.138"></a><span id="l8.138">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l8.139"></a><span id="l8.139">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l8.140"></a><span id="l8.140"> }</span>
<a href="#l8.141"></a><span id="l8.141"> </span>
<a href="#l8.142"></a><span id="l8.142"> function teardownTest(module) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,37 +1,40 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.5"></a><span id="l9.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.6"></a><span id="l9.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+var MODULE_NAME = &quot;testDailyRecurrence&quot;;</span>
<a href="#l9.9"></a><span id="l9.9"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l9.10"></a><span id="l9.10"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+var CALENDARNAME, EVENTPATH, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l9.13"></a><span id="l9.13"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l9.14"></a><span id="l9.14"> var switchToView, goToDate, viewForward, viewBack, handleOccurrencePrompt;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+var menulistSelect;</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-var HOUR = 8;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+const HOUR = 8;</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22"> function setupModule(module) {</span>
<a href="#l9.23"></a><span id="l9.23">     controller = mozmill.getMail3PaneController();</span>
<a href="#l9.24"></a><span id="l9.24">     ({</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+        EVENTPATH,</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l9.29"></a><span id="l9.29">         helpersForController,</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-        invokeEventDialog,</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-        createCalendar,</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-        deleteCalendars,</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l9.34"></a><span id="l9.34">         switchToView,</span>
<a href="#l9.35"></a><span id="l9.35">         goToDate,</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l9.37"></a><span id="l9.37">         viewForward,</span>
<a href="#l9.38"></a><span id="l9.38">         viewBack,</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">-        handleOccurrencePrompt,</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-        CALENDARNAME,</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-        EVENT_BOX,</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-        CANVAS_BOX</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+        deleteCalendars,</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+        createCalendar,</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+        menulistSelect</span>
<a href="#l9.46"></a><span id="l9.46">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l9.47"></a><span id="l9.47">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l9.48"></a><span id="l9.48">     Object.assign(module, helpersForController(controller));</span>
<a href="#l9.49"></a><span id="l9.49"> </span>
<a href="#l9.50"></a><span id="l9.50">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l9.51"></a><span id="l9.51"> }</span>
<a href="#l9.52"></a><span id="l9.52"> </span>
<a href="#l9.53"></a><span id="l9.53"> function testDailyRecurrence() {</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineat">@@ -43,66 +46,73 @@ function testDailyRecurrence() {</span>
<a href="#l9.55"></a><span id="l9.55">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l9.56"></a><span id="l9.56">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l9.57"></a><span id="l9.57"> </span>
<a href="#l9.58"></a><span id="l9.58">     // create daily event</span>
<a href="#l9.59"></a><span id="l9.59">     let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l9.60"></a><span id="l9.60">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l9.61"></a><span id="l9.61">         let { eid: eventid } = helpersForController(event);</span>
<a href="#l9.62"></a><span id="l9.62"> </span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineminus">-        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;daily&quot;);</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+        menulistSelect(eventid(&quot;item-repeat&quot;), &quot;daily&quot;, event);</span>
<a href="#l9.66"></a><span id="l9.66">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l9.67"></a><span id="l9.67">     });</span>
<a href="#l9.68"></a><span id="l9.68"> </span>
<a href="#l9.69"></a><span id="l9.69">     // check day view for 7 days</span>
<a href="#l9.70"></a><span id="l9.70">     let daybox = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, null) + EVENTPATH;</span>
<a href="#l9.71"></a><span id="l9.71">     controller.waitForElement(lookup(daybox));</span>
<a href="#l9.72"></a><span id="l9.72"> </span>
<a href="#l9.73"></a><span id="l9.73">     for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-        controller.assertNode(lookup(daybox));</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+        controller.waitForElement(lookup(daybox));</span>
<a href="#l9.76"></a><span id="l9.76">         viewForward(controller, 1);</span>
<a href="#l9.77"></a><span id="l9.77">     }</span>
<a href="#l9.78"></a><span id="l9.78"> </span>
<a href="#l9.79"></a><span id="l9.79">     // check week view for 2 weeks</span>
<a href="#l9.80"></a><span id="l9.80">     switchToView(controller, &quot;week&quot;);</span>
<a href="#l9.81"></a><span id="l9.81">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l9.82"></a><span id="l9.82"> </span>
<a href="#l9.83"></a><span id="l9.83">     for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">-        controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, 1, day, HOUR, EVENTPATH));</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, 1, day, HOUR, EVENTPATH)</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+        );</span>
<a href="#l9.88"></a><span id="l9.88">     }</span>
<a href="#l9.89"></a><span id="l9.89"> </span>
<a href="#l9.90"></a><span id="l9.90">     viewForward(controller, 1);</span>
<a href="#l9.91"></a><span id="l9.91"> </span>
<a href="#l9.92"></a><span id="l9.92">     for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineminus">-        controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, 2, day, HOUR, EVENTPATH));</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, 2, day, HOUR, EVENTPATH)</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+        );</span>
<a href="#l9.97"></a><span id="l9.97">     }</span>
<a href="#l9.98"></a><span id="l9.98"> </span>
<a href="#l9.99"></a><span id="l9.99">     // check multiweek view for 4 weeks</span>
<a href="#l9.100"></a><span id="l9.100">     switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l9.101"></a><span id="l9.101">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l9.102"></a><span id="l9.102"> </span>
<a href="#l9.103"></a><span id="l9.103">     for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineminus">-        controller.assertNode(lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, 1, day, HOUR, EVENTPATH));</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, 1, day, HOUR, EVENTPATH)</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+        );</span>
<a href="#l9.108"></a><span id="l9.108">     }</span>
<a href="#l9.109"></a><span id="l9.109"> </span>
<a href="#l9.110"></a><span id="l9.110">     for (let week = 2; week &lt;= 4; week++) {</span>
<a href="#l9.111"></a><span id="l9.111">         for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineminus">-            controller.assertNode(</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineplus">+            controller.waitForElement(</span>
<a href="#l9.114"></a><span id="l9.114">                 lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, week, day, HOUR, EVENTPATH)</span>
<a href="#l9.115"></a><span id="l9.115">             );</span>
<a href="#l9.116"></a><span id="l9.116">         }</span>
<a href="#l9.117"></a><span id="l9.117">     }</span>
<a href="#l9.118"></a><span id="l9.118"> </span>
<a href="#l9.119"></a><span id="l9.119">     // check month view for all 5 weeks</span>
<a href="#l9.120"></a><span id="l9.120">     switchToView(controller, &quot;month&quot;);</span>
<a href="#l9.121"></a><span id="l9.121">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l9.122"></a><span id="l9.122"> </span>
<a href="#l9.123"></a><span id="l9.123">     for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineminus">-        controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 1, day, null, EVENTPATH));</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineplus">+            lookupEventBox(&quot;month&quot;, EVENT_BOX, 1, day, null, EVENTPATH)</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+        );</span>
<a href="#l9.128"></a><span id="l9.128">     }</span>
<a href="#l9.129"></a><span id="l9.129"> </span>
<a href="#l9.130"></a><span id="l9.130">     for (let week = 2; week &lt;= 5; week++) {</span>
<a href="#l9.131"></a><span id="l9.131">         for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l9.132"></a><span id="l9.132">             controller.assertNode(</span>
<a href="#l9.133"></a><span id="l9.133">                 lookupEventBox(&quot;month&quot;, EVENT_BOX, week, day, null, EVENTPATH)</span>
<a href="#l9.134"></a><span id="l9.134">             );</span>
<a href="#l9.135"></a><span id="l9.135">         }</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineat">@@ -132,76 +142,72 @@ function testDailyRecurrence() {</span>
<a href="#l9.137"></a><span id="l9.137">     );</span>
<a href="#l9.138"></a><span id="l9.138"> </span>
<a href="#l9.139"></a><span id="l9.139">     // go to previous day to edit event to occur only on weekdays</span>
<a href="#l9.140"></a><span id="l9.140">     viewBack(controller, 1);</span>
<a href="#l9.141"></a><span id="l9.141"> </span>
<a href="#l9.142"></a><span id="l9.142">     eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH);</span>
<a href="#l9.143"></a><span id="l9.143">     handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true, false);</span>
<a href="#l9.144"></a><span id="l9.144">     invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineminus">-        let { eid: eventid } = helpersForController(event);</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineplus">+        let { eid: eventid, sleep: eventsleep } = helpersForController(event);</span>
<a href="#l9.147"></a><span id="l9.147"> </span>
<a href="#l9.148"></a><span id="l9.148" class="difflineminus">-        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineminus">-        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;every.weekday&quot;);</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineplus">+        menulistSelect(eventid(&quot;item-repeat&quot;), &quot;every.weekday&quot;, event);</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineplus">+        eventsleep();</span>
<a href="#l9.152"></a><span id="l9.152">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l9.153"></a><span id="l9.153">     });</span>
<a href="#l9.154"></a><span id="l9.154"> </span>
<a href="#l9.155"></a><span id="l9.155">     // check day view for 7 days</span>
<a href="#l9.156"></a><span id="l9.156">     let day = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, null) + EVENTPATH;</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineminus">-    let dates = [[2009, 1, 3], [2009, 1, 4]];</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineplus">+    let dates = [</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineplus">+        [2009, 1, 3],</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineplus">+        [2009, 1, 4]</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineplus">+    ];</span>
<a href="#l9.162"></a><span id="l9.162">     for (let [y, m, d] of dates) {</span>
<a href="#l9.163"></a><span id="l9.163">         goToDate(controller, y, m, d);</span>
<a href="#l9.164"></a><span id="l9.164">         controller.assertNodeNotExist(lookup(day));</span>
<a href="#l9.165"></a><span id="l9.165">     }</span>
<a href="#l9.166"></a><span id="l9.166"> </span>
<a href="#l9.167"></a><span id="l9.167">     // check week view for 2 weeks</span>
<a href="#l9.168"></a><span id="l9.168">     switchToView(controller, &quot;week&quot;);</span>
<a href="#l9.169"></a><span id="l9.169">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l9.170"></a><span id="l9.170"> </span>
<a href="#l9.171"></a><span id="l9.171">     for (let i = 0; i &lt;= 1; i++) {</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineminus">-        controller.assertNodeNotExist(</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+        controller.waitForElementNotPresent(</span>
<a href="#l9.174"></a><span id="l9.174">             lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 1, null, EVENTPATH)</span>
<a href="#l9.175"></a><span id="l9.175">         );</span>
<a href="#l9.176"></a><span id="l9.176">         controller.assertNodeNotExist(</span>
<a href="#l9.177"></a><span id="l9.177">             lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null, EVENTPATH)</span>
<a href="#l9.178"></a><span id="l9.178">         );</span>
<a href="#l9.179"></a><span id="l9.179" class="difflineminus">-</span>
<a href="#l9.180"></a><span id="l9.180">         viewForward(controller, 1);</span>
<a href="#l9.181"></a><span id="l9.181">     }</span>
<a href="#l9.182"></a><span id="l9.182"> </span>
<a href="#l9.183"></a><span id="l9.183">     // check multiweek view for 4 weeks</span>
<a href="#l9.184"></a><span id="l9.184">     switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l9.185"></a><span id="l9.185">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l9.186"></a><span id="l9.186"> </span>
<a href="#l9.187"></a><span id="l9.187">     for (let i = 1; i &lt;= 4; i++) {</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineminus">-        controller.assertNodeNotExist(</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineplus">+        controller.waitForElementNotPresent(</span>
<a href="#l9.190"></a><span id="l9.190">             lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i, 1, null, EVENTPATH)</span>
<a href="#l9.191"></a><span id="l9.191">         );</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineminus">-</span>
<a href="#l9.193"></a><span id="l9.193">         controller.assertNodeNotExist(</span>
<a href="#l9.194"></a><span id="l9.194">             lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i, 7, null, EVENTPATH)</span>
<a href="#l9.195"></a><span id="l9.195">         );</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineminus">-</span>
<a href="#l9.197"></a><span id="l9.197" class="difflineminus">-        viewForward(controller, 1);</span>
<a href="#l9.198"></a><span id="l9.198">     }</span>
<a href="#l9.199"></a><span id="l9.199"> </span>
<a href="#l9.200"></a><span id="l9.200">     // check month view for all 5 weeks</span>
<a href="#l9.201"></a><span id="l9.201">     switchToView(controller, &quot;month&quot;);</span>
<a href="#l9.202"></a><span id="l9.202">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l9.203"></a><span id="l9.203"> </span>
<a href="#l9.204"></a><span id="l9.204">     for (let i = 1; i &lt;= 5; i++) {</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineminus">-        controller.assertNodeNotExist(</span>
<a href="#l9.206"></a><span id="l9.206" class="difflineplus">+        controller.waitForElementNotPresent(</span>
<a href="#l9.207"></a><span id="l9.207">             lookupEventBox(&quot;month&quot;, EVENT_BOX, i, 1, null, EVENTPATH)</span>
<a href="#l9.208"></a><span id="l9.208">         );</span>
<a href="#l9.209"></a><span id="l9.209" class="difflineminus">-</span>
<a href="#l9.210"></a><span id="l9.210">         controller.assertNodeNotExist(</span>
<a href="#l9.211"></a><span id="l9.211">             lookupEventBox(&quot;month&quot;, EVENT_BOX, i, 7, null, EVENTPATH)</span>
<a href="#l9.212"></a><span id="l9.212">         );</span>
<a href="#l9.213"></a><span id="l9.213" class="difflineminus">-</span>
<a href="#l9.214"></a><span id="l9.214" class="difflineminus">-        viewForward(controller, 1);</span>
<a href="#l9.215"></a><span id="l9.215">     }</span>
<a href="#l9.216"></a><span id="l9.216"> </span>
<a href="#l9.217"></a><span id="l9.217">     // delete event</span>
<a href="#l9.218"></a><span id="l9.218">     day = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 1, 5, null) + EVENTPATH;</span>
<a href="#l9.219"></a><span id="l9.219">     controller.click(lookup(day));</span>
<a href="#l9.220"></a><span id="l9.220">     handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l9.221"></a><span id="l9.221">     controller.waitForElementNotPresent(lookup(day));</span>
<a href="#l9.222"></a><span id="l9.222"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,147 +1,150 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.5"></a><span id="l10.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.6"></a><span id="l10.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+var MODULE_NAME = &quot;testLastDayOfMonthRecurrence&quot;;</span>
<a href="#l10.9"></a><span id="l10.9"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;window-helpers&quot;];</span>
<a href="#l10.12"></a><span id="l10.12"> </span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-var switchToView, goToDate, handleOccurrencePrompt;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+var TIMEOUT_MODAL_DIALOG, CALENDARNAME, EVENTPATH, EVENT_BOX;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+var CANVAS_BOX, REC_DLG_ACCEPT;</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+var helpersForController, handleOccurrencePrompt, switchToView, goToDate;</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+var invokeEventDialog, deleteCalendars, createCalendar, menulistSelect;</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">-var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-var HOUR = 8;</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">-var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+const HOUR = 8;</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28"> function setupModule(module) {</span>
<a href="#l10.29"></a><span id="l10.29">     controller = mozmill.getMail3PaneController();</span>
<a href="#l10.30"></a><span id="l10.30">     ({</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+        TIMEOUT_MODAL_DIALOG,</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+        EVENTPATH,</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+        REC_DLG_ACCEPT,</span>
<a href="#l10.37"></a><span id="l10.37">         helpersForController,</span>
<a href="#l10.38"></a><span id="l10.38">         invokeEventDialog,</span>
<a href="#l10.39"></a><span id="l10.39">         createCalendar,</span>
<a href="#l10.40"></a><span id="l10.40">         deleteCalendars,</span>
<a href="#l10.41"></a><span id="l10.41">         switchToView,</span>
<a href="#l10.42"></a><span id="l10.42">         goToDate,</span>
<a href="#l10.43"></a><span id="l10.43">         handleOccurrencePrompt,</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-        CALENDARNAME,</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-        EVENT_BOX,</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-        CANVAS_BOX</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+        menulistSelect</span>
<a href="#l10.48"></a><span id="l10.48">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l10.49"></a><span id="l10.49">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l10.50"></a><span id="l10.50">     Object.assign(module, helpersForController(controller));</span>
<a href="#l10.51"></a><span id="l10.51"> </span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+    ({ plan_for_modal_dialog, wait_for_modal_dialog } =</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+        collector.getModule(&quot;window-helpers&quot;)</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+    );</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+</span>
<a href="#l10.56"></a><span id="l10.56">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l10.57"></a><span id="l10.57"> }</span>
<a href="#l10.58"></a><span id="l10.58"> </span>
<a href="#l10.59"></a><span id="l10.59"> function testLastDayOfMonthRecurrence() {</span>
<a href="#l10.60"></a><span id="l10.60">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l10.61"></a><span id="l10.61">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l10.62"></a><span id="l10.62">     goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l10.63"></a><span id="l10.63"> </span>
<a href="#l10.64"></a><span id="l10.64">     // rotate view</span>
<a href="#l10.65"></a><span id="l10.65">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l10.66"></a><span id="l10.66">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l10.67"></a><span id="l10.67"> </span>
<a href="#l10.68"></a><span id="l10.68">     // create monthly recurring event</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-    let eventBox = lookupEventBox(controller, &quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l10.71"></a><span id="l10.71">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l10.72"></a><span id="l10.72">         let { eid: eventid } = helpersForController(event);</span>
<a href="#l10.73"></a><span id="l10.73"> </span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-        dialog.start(setRecurrence);</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineminus">-        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineminus">-        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+        plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+        menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+        wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l10.81"></a><span id="l10.81"> </span>
<a href="#l10.82"></a><span id="l10.82">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l10.83"></a><span id="l10.83">     });</span>
<a href="#l10.84"></a><span id="l10.84"> </span>
<a href="#l10.85"></a><span id="l10.85" class="difflineminus">-    //                      date      correct row in month view</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineminus">-    //                   vvvvvvvvvvv  v</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+    // data tuple: [year, month, day, row in month view]</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+    // note: month starts here with 1 for January</span>
<a href="#l10.89"></a><span id="l10.89">     let checkingData = [[2008, 1, 31, 5],</span>
<a href="#l10.90"></a><span id="l10.90">                         [2008, 2, 29, 5],</span>
<a href="#l10.91"></a><span id="l10.91">                         [2008, 3, 31, 6],</span>
<a href="#l10.92"></a><span id="l10.92">                         [2008, 4, 30, 5],</span>
<a href="#l10.93"></a><span id="l10.93">                         [2008, 5, 31, 5],</span>
<a href="#l10.94"></a><span id="l10.94">                         [2008, 6, 30, 5],</span>
<a href="#l10.95"></a><span id="l10.95">                         [2008, 7, 31, 5],</span>
<a href="#l10.96"></a><span id="l10.96">                         [2008, 8, 31, 6],</span>
<a href="#l10.97"></a><span id="l10.97">                         [2008, 9, 30, 5],</span>
<a href="#l10.98"></a><span id="l10.98">                         [2008, 10, 31, 5],</span>
<a href="#l10.99"></a><span id="l10.99">                         [2008, 11, 30, 6],</span>
<a href="#l10.100"></a><span id="l10.100">                         [2008, 12, 31, 5],</span>
<a href="#l10.101"></a><span id="l10.101">                         [2009, 1, 31, 5],</span>
<a href="#l10.102"></a><span id="l10.102">                         [2009, 2, 28, 4],</span>
<a href="#l10.103"></a><span id="l10.103">                         [2009, 3, 31, 5]];</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-    let box = &quot;&quot;;</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineminus">-</span>
<a href="#l10.106"></a><span id="l10.106">     // check all dates</span>
<a href="#l10.107"></a><span id="l10.107">     for (let [y, m, d, correctRow] of checkingData) {</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+        let date = new Date(y, m - 1, d);</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+        let column = date.getDay() + 1;</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+</span>
<a href="#l10.111"></a><span id="l10.111">         goToDate(controller, y, m, d);</span>
<a href="#l10.112"></a><span id="l10.112"> </span>
<a href="#l10.113"></a><span id="l10.113">         // day view</span>
<a href="#l10.114"></a><span id="l10.114">         switchToView(controller, &quot;day&quot;);</span>
<a href="#l10.115"></a><span id="l10.115">         controller.waitForElement(</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineminus">-            lookupEventBox(controller, &quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH)</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineplus">+            lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH)</span>
<a href="#l10.118"></a><span id="l10.118">         );</span>
<a href="#l10.119"></a><span id="l10.119"> </span>
<a href="#l10.120"></a><span id="l10.120">         // week view</span>
<a href="#l10.121"></a><span id="l10.121">         switchToView(controller, &quot;week&quot;);</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineminus">-        let date = new Date(y, m - 1, d);</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineminus">-        let column = date.getDay() + 1;</span>
<a href="#l10.124"></a><span id="l10.124">         controller.waitForElement(</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineminus">-            lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, column, HOUR, EVENTPATH)</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, column, HOUR, EVENTPATH)</span>
<a href="#l10.127"></a><span id="l10.127">         );</span>
<a href="#l10.128"></a><span id="l10.128"> </span>
<a href="#l10.129"></a><span id="l10.129">         // multiweek view</span>
<a href="#l10.130"></a><span id="l10.130">         switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineminus">-        controller.assertNode(</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineminus">-            lookupEventBox(controller, &quot;multiweek&quot;, EVENT_BOX, 1, column, null, EVENTPATH)</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, 1, column, null, EVENTPATH)</span>
<a href="#l10.135"></a><span id="l10.135">         );</span>
<a href="#l10.136"></a><span id="l10.136"> </span>
<a href="#l10.137"></a><span id="l10.137">         // month view</span>
<a href="#l10.138"></a><span id="l10.138">         switchToView(controller, &quot;month&quot;);</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineminus">-        controller.assertNode(</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineminus">-            lookupEventBox(controller, &quot;month&quot;, EVENT_BOX, correctRow, column, null, EVENTPATH)</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineplus">+            lookupEventBox(&quot;month&quot;, EVENT_BOX, correctRow, column, null, EVENTPATH)</span>
<a href="#l10.143"></a><span id="l10.143">         );</span>
<a href="#l10.144"></a><span id="l10.144">     }</span>
<a href="#l10.145"></a><span id="l10.145"> </span>
<a href="#l10.146"></a><span id="l10.146">     // delete event</span>
<a href="#l10.147"></a><span id="l10.147">     goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l10.148"></a><span id="l10.148">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineminus">-</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineminus">-    box = getEventBoxPath(controller, &quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineplus">+    let box = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l10.152"></a><span id="l10.152">     controller.waitThenClick(lookup(box));</span>
<a href="#l10.153"></a><span id="l10.153">     handleOccurrencePrompt(controller, eid(&quot;day-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l10.154"></a><span id="l10.154">     controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l10.155"></a><span id="l10.155"> </span>
<a href="#l10.156"></a><span id="l10.156">     // reset view</span>
<a href="#l10.157"></a><span id="l10.157">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l10.158"></a><span id="l10.158">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l10.159"></a><span id="l10.159"> }</span>
<a href="#l10.160"></a><span id="l10.160"> </span>
<a href="#l10.161"></a><span id="l10.161"> function setRecurrence(recurrence) {</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineminus">-    let { lookup: reclookup, eid: recid, sleep: recsleep } = helpersForController(recurrence);</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineplus">+    let {</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineplus">+        sleep: recsleep,</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineplus">+        lookup: reclookup,</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineplus">+        eid: recid</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineplus">+    } = helpersForController(recurrence);</span>
<a href="#l10.168"></a><span id="l10.168"> </span>
<a href="#l10.169"></a><span id="l10.169">     // monthly</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineminus">-    recsleep();</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineminus">-    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;2&quot;);</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineplus">+    menulistSelect(recid(&quot;period-list&quot;), &quot;2&quot;, recurrence);</span>
<a href="#l10.173"></a><span id="l10.173"> </span>
<a href="#l10.174"></a><span id="l10.174">     // last day of month</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineminus">-    recurrence.click(recid(&quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l10.176"></a><span id="l10.176" class="difflineminus">-    recsleep();</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineminus">-    recurrence.select(recid(&quot;monthly-ordinal&quot;), null, null, &quot;-1&quot;);</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineminus">-    recsleep();</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineminus">-    recurrence.select(recid(&quot;monthly-weekday&quot;), null, null, &quot;-1&quot;);</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineplus">+    recurrence.radio(recid(&quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l10.181"></a><span id="l10.181" class="difflineplus">+    menulistSelect(recid(&quot;monthly-ordinal&quot;), &quot;-1&quot;, recurrence);</span>
<a href="#l10.182"></a><span id="l10.182" class="difflineplus">+    menulistSelect(recid(&quot;monthly-weekday&quot;), &quot;-1&quot;, recurrence);</span>
<a href="#l10.183"></a><span id="l10.183">     recsleep();</span>
<a href="#l10.184"></a><span id="l10.184"> </span>
<a href="#l10.185"></a><span id="l10.185">     // close dialog</span>
<a href="#l10.186"></a><span id="l10.186" class="difflineminus">-    recurrence.click(reclookup(`</span>
<a href="#l10.187"></a><span id="l10.187" class="difflineminus">-        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l10.188"></a><span id="l10.188" class="difflineminus">-        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineminus">-    `));</span>
<a href="#l10.190"></a><span id="l10.190" class="difflineplus">+    recurrence.click(reclookup(REC_DLG_ACCEPT));</span>
<a href="#l10.191"></a><span id="l10.191"> }</span>
<a href="#l10.192"></a><span id="l10.192"> </span>
<a href="#l10.193"></a><span id="l10.193"> function teardownTest(module) {</span>
<a href="#l10.194"></a><span id="l10.194">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l10.195"></a><span id="l10.195"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,43 +1,53 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.5"></a><span id="l11.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.6"></a><span id="l11.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+var MODULE_NAME = &quot;testWeeklyNRecurrence&quot;;</span>
<a href="#l11.9"></a><span id="l11.9"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;window-helpers&quot;];</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;, null);</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-var switchToView, goToDate, viewForward, handleOccurrencePrompt;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+var TIMEOUT_MODAL_DIALOG, CALENDARNAME, EVENTPATH, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+var REC_DLG_ACCEPT, REC_DLG_DAYS;</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+var helpersForController, handleOccurrencePrompt, switchToView, goToDate;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+var invokeEventDialog, viewForward, deleteCalendars, createCalendar, menulistSelect;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">-var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineminus">-var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">-</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-var HOUR = 8;</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineminus">-var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+const HOUR = 8;</span>
<a href="#l11.30"></a><span id="l11.30"> </span>
<a href="#l11.31"></a><span id="l11.31"> function setupModule(module) {</span>
<a href="#l11.32"></a><span id="l11.32">     controller = mozmill.getMail3PaneController();</span>
<a href="#l11.33"></a><span id="l11.33">     ({</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+        TIMEOUT_MODAL_DIALOG,</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+        EVENTPATH,</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+        REC_DLG_ACCEPT,</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+        REC_DLG_DAYS,</span>
<a href="#l11.41"></a><span id="l11.41">         helpersForController,</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">-        invokeEventDialog,</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-        createCalendar,</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineminus">-        deleteCalendars,</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l11.46"></a><span id="l11.46">         switchToView,</span>
<a href="#l11.47"></a><span id="l11.47">         goToDate,</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l11.49"></a><span id="l11.49">         viewForward,</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-        handleOccurrencePrompt,</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-        CALENDARNAME,</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-        EVENT_BOX,</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-        CANVAS_BOX</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+        deleteCalendars,</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+        createCalendar,</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+        menulistSelect</span>
<a href="#l11.57"></a><span id="l11.57">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l11.58"></a><span id="l11.58">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l11.59"></a><span id="l11.59">     Object.assign(module, helpersForController(controller));</span>
<a href="#l11.60"></a><span id="l11.60"> </span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+    ({ plan_for_modal_dialog, wait_for_modal_dialog } =</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineplus">+        collector.getModule(&quot;window-helpers&quot;)</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineplus">+    );</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineplus">+</span>
<a href="#l11.65"></a><span id="l11.65">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l11.66"></a><span id="l11.66"> }</span>
<a href="#l11.67"></a><span id="l11.67"> </span>
<a href="#l11.68"></a><span id="l11.68"> function testWeeklyNRecurrence() {</span>
<a href="#l11.69"></a><span id="l11.69">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l11.70"></a><span id="l11.70">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l11.71"></a><span id="l11.71">     goToDate(controller, 2009, 1, 5);</span>
<a href="#l11.72"></a><span id="l11.72"> </span>
<a href="#l11.73"></a><span id="l11.73" class="difflineat">@@ -45,129 +55,129 @@ function testWeeklyNRecurrence() {</span>
<a href="#l11.74"></a><span id="l11.74">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l11.75"></a><span id="l11.75">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l11.76"></a><span id="l11.76"> </span>
<a href="#l11.77"></a><span id="l11.77">     // create weekly recurring event</span>
<a href="#l11.78"></a><span id="l11.78">     let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l11.79"></a><span id="l11.79">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l11.80"></a><span id="l11.80">         let { eid: eventid } = helpersForController(event);</span>
<a href="#l11.81"></a><span id="l11.81"> </span>
<a href="#l11.82"></a><span id="l11.82" class="difflineminus">-        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineminus">-        dialog.start(setRecurrence);</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineplus">+        plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l11.85"></a><span id="l11.85">         event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineminus">-        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineplus">+        menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+        wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l11.89"></a><span id="l11.89"> </span>
<a href="#l11.90"></a><span id="l11.90">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l11.91"></a><span id="l11.91">     });</span>
<a href="#l11.92"></a><span id="l11.92"> </span>
<a href="#l11.93"></a><span id="l11.93">     // check day view</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineminus">-</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+    let box = getEventBoxPath(&quot;day&quot;, EVENT_BOX, undefined, 1, HOUR) + EVENTPATH;</span>
<a href="#l11.96"></a><span id="l11.96">     // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l11.97"></a><span id="l11.97">     for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineminus">-        controller.assertNode(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH));</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineplus">+        controller.waitForElement(lookup(box));</span>
<a href="#l11.100"></a><span id="l11.100">         viewForward(controller, 1);</span>
<a href="#l11.101"></a><span id="l11.101">     }</span>
<a href="#l11.102"></a><span id="l11.102"> </span>
<a href="#l11.103"></a><span id="l11.103" class="difflineminus">-    // Saturday</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineplus">+    // Not Friday</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineplus">+    sleep();</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineplus">+    controller.assertNodeNotExist(lookup(box));</span>
<a href="#l11.107"></a><span id="l11.107">     viewForward(controller, 1);</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineminus">-    controller.assertNodeNotExist(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH));</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineplus">+</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineplus">+    // Not Saturday as only 4 occurrences are set.</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineplus">+    sleep();</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineplus">+    controller.assertNodeNotExist(lookup(box));</span>
<a href="#l11.113"></a><span id="l11.113"> </span>
<a href="#l11.114"></a><span id="l11.114">     // check week view</span>
<a href="#l11.115"></a><span id="l11.115">     switchToView(controller, &quot;week&quot;);</span>
<a href="#l11.116"></a><span id="l11.116"> </span>
<a href="#l11.117"></a><span id="l11.117">     // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l11.118"></a><span id="l11.118">     for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineminus">-        controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, i, HOUR, EVENTPATH));</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, i, HOUR, EVENTPATH)</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineplus">+        );</span>
<a href="#l11.123"></a><span id="l11.123">     }</span>
<a href="#l11.124"></a><span id="l11.124"> </span>
<a href="#l11.125"></a><span id="l11.125">     // Saturday</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineminus">-    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR, EVENTPATH));</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineplus">+        lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR, EVENTPATH)</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineplus">+    );</span>
<a href="#l11.130"></a><span id="l11.130"> </span>
<a href="#l11.131"></a><span id="l11.131">     // check multiweek view</span>
<a href="#l11.132"></a><span id="l11.132">     switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l11.133"></a><span id="l11.133">     checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l11.134"></a><span id="l11.134"> </span>
<a href="#l11.135"></a><span id="l11.135">     // check month view</span>
<a href="#l11.136"></a><span id="l11.136">     switchToView(controller, &quot;month&quot;);</span>
<a href="#l11.137"></a><span id="l11.137">     checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l11.138"></a><span id="l11.138"> </span>
<a href="#l11.139"></a><span id="l11.139">     // delete event</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineminus">-    let box = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 2, 2, HOUR) + EVENTPATH;</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineplus">+    box = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 2, 2, HOUR) + EVENTPATH;</span>
<a href="#l11.142"></a><span id="l11.142">     controller.click(lookup(box));</span>
<a href="#l11.143"></a><span id="l11.143">     handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l11.144"></a><span id="l11.144">     controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l11.145"></a><span id="l11.145"> </span>
<a href="#l11.146"></a><span id="l11.146">     // reset view</span>
<a href="#l11.147"></a><span id="l11.147">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l11.148"></a><span id="l11.148">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l11.149"></a><span id="l11.149">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l11.150"></a><span id="l11.150"> }</span>
<a href="#l11.151"></a><span id="l11.151"> </span>
<a href="#l11.152"></a><span id="l11.152"> function setRecurrence(recurrence) {</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineminus">-    let { lookup: reclookup, eid: recid, sleep: recsleep } = helpersForController(recurrence);</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineplus">+    let {</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineplus">+        sleep: recsleep,</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineplus">+        lookup: reclookup,</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineplus">+        eid: recid,</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineplus">+    } = helpersForController(recurrence);</span>
<a href="#l11.159"></a><span id="l11.159"> </span>
<a href="#l11.160"></a><span id="l11.160">     // weekly</span>
<a href="#l11.161"></a><span id="l11.161">     recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineminus">-    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineplus">+    menulistSelect(recid(&quot;period-list&quot;), &quot;1&quot;, recurrence);</span>
<a href="#l11.164"></a><span id="l11.164">     recsleep();</span>
<a href="#l11.165"></a><span id="l11.165"> </span>
<a href="#l11.166"></a><span id="l11.166" class="difflineminus">-    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineminus">-    let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineminus">-    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineminus">-    let thu = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineminus">-    let sat = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineplus">+    let mon = cal.l10n.getDateFmtString(&quot;day.2.Mmm&quot;);</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineplus">+    let tue = cal.l10n.getDateFmtString(&quot;day.3.Mmm&quot;);</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineplus">+    let wed = cal.l10n.getDateFmtString(&quot;day.4.Mmm&quot;);</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineplus">+    let thu = cal.l10n.getDateFmtString(&quot;day.5.Mmm&quot;);</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineplus">+    let sat = cal.l10n.getDateFmtString(&quot;day.7.Mmm&quot;);</span>
<a href="#l11.176"></a><span id="l11.176"> </span>
<a href="#l11.177"></a><span id="l11.177" class="difflineminus">-    let days = `</span>
<a href="#l11.178"></a><span id="l11.178" class="difflineminus">-        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineminus">-        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineminus">-        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineminus">-        id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;mainbox&quot;})</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineminus">-    `;</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineminus">-</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineminus">-    // starting from Monday so it should be checked</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineminus">-    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineplus">+    // starting from Monday so it should be checked. We have to wait a little,</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineplus">+    // because the checkedstate is set in background by JS.</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineplus">+    recurrence.waitFor(() =&gt; {</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineplus">+        return recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineplus">+    }, 30000);</span>
<a href="#l11.192"></a><span id="l11.192">     // check Tuesday, Wednesday, Thursday and Saturday too</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineminus">-    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineminus">-    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineminus">-    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${thu}&quot;}`));</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineminus">-    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${sat}&quot;}`));</span>
<a href="#l11.197"></a><span id="l11.197" class="difflineplus">+    recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineplus">+    recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineplus">+    recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${thu}&quot;}`));</span>
<a href="#l11.200"></a><span id="l11.200" class="difflineplus">+    recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${sat}&quot;}`));</span>
<a href="#l11.201"></a><span id="l11.201"> </span>
<a href="#l11.202"></a><span id="l11.202">     // set number of occurrences</span>
<a href="#l11.203"></a><span id="l11.203">     recurrence.click(recid(&quot;recurrence-range-for&quot;));</span>
<a href="#l11.204"></a><span id="l11.204" class="difflineminus">-    let input = `</span>
<a href="#l11.205"></a><span id="l11.205" class="difflineminus">-        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/</span>
<a href="#l11.206"></a><span id="l11.206" class="difflineminus">-        id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/</span>
<a href="#l11.207"></a><span id="l11.207" class="difflineminus">-        id(&quot;repeat-ntimes-count&quot;)/</span>
<a href="#l11.208"></a><span id="l11.208" class="difflineminus">-        anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/</span>
<a href="#l11.209"></a><span id="l11.209" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l11.210"></a><span id="l11.210" class="difflineminus">-    `;</span>
<a href="#l11.211"></a><span id="l11.211" class="difflineminus">-    // replace previous number</span>
<a href="#l11.212"></a><span id="l11.212" class="difflineminus">-    recurrence.keypress(reclookup(input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l11.213"></a><span id="l11.213" class="difflineminus">-    recurrence.type(reclookup(input), &quot;4&quot;);</span>
<a href="#l11.214"></a><span id="l11.214" class="difflineplus">+    let ntimesField = recid(&quot;repeat-ntimes-count&quot;);</span>
<a href="#l11.215"></a><span id="l11.215" class="difflineplus">+    ntimesField.getNode().value = &quot;4&quot;;</span>
<a href="#l11.216"></a><span id="l11.216"> </span>
<a href="#l11.217"></a><span id="l11.217">     // close dialog</span>
<a href="#l11.218"></a><span id="l11.218" class="difflineminus">-    recurrence.click(reclookup(`</span>
<a href="#l11.219"></a><span id="l11.219" class="difflineminus">-        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l11.220"></a><span id="l11.220" class="difflineminus">-        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l11.221"></a><span id="l11.221" class="difflineminus">-    `));</span>
<a href="#l11.222"></a><span id="l11.222" class="difflineplus">+    recurrence.click(reclookup(REC_DLG_ACCEPT));</span>
<a href="#l11.223"></a><span id="l11.223"> }</span>
<a href="#l11.224"></a><span id="l11.224"> </span>
<a href="#l11.225"></a><span id="l11.225"> function checkMultiWeekView(view) {</span>
<a href="#l11.226"></a><span id="l11.226" class="difflineminus">-    let week = 1;</span>
<a href="#l11.227"></a><span id="l11.227" class="difflineplus">+    // make sure, the view has time to load</span>
<a href="#l11.228"></a><span id="l11.228" class="difflineplus">+    sleep();</span>
<a href="#l11.229"></a><span id="l11.229"> </span>
<a href="#l11.230"></a><span id="l11.230" class="difflineminus">-    // in month view event starts from 2nd row</span>
<a href="#l11.231"></a><span id="l11.231" class="difflineminus">-    if (view == &quot;month&quot;) {</span>
<a href="#l11.232"></a><span id="l11.232" class="difflineminus">-        week++;</span>
<a href="#l11.233"></a><span id="l11.233" class="difflineminus">-    }</span>
<a href="#l11.234"></a><span id="l11.234" class="difflineplus">+    // In month view event starts from 2nd row</span>
<a href="#l11.235"></a><span id="l11.235" class="difflineplus">+    let week = view == &quot;month&quot; ? 2 : 1;</span>
<a href="#l11.236"></a><span id="l11.236"> </span>
<a href="#l11.237"></a><span id="l11.237">     // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l11.238"></a><span id="l11.238">     for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l11.239"></a><span id="l11.239" class="difflineminus">-        controller.assertNode(lookupEventBox(view, EVENT_BOX, week, i, null, EVENTPATH));</span>
<a href="#l11.240"></a><span id="l11.240" class="difflineplus">+        controller.assertNode(</span>
<a href="#l11.241"></a><span id="l11.241" class="difflineplus">+            lookupEventBox(view, EVENT_BOX, week, i, null, EVENTPATH)</span>
<a href="#l11.242"></a><span id="l11.242" class="difflineplus">+        );</span>
<a href="#l11.243"></a><span id="l11.243">     }</span>
<a href="#l11.244"></a><span id="l11.244"> </span>
<a href="#l11.245"></a><span id="l11.245">     // Saturday</span>
<a href="#l11.246"></a><span id="l11.246" class="difflineminus">-    controller.assertNodeNotExist(lookupEventBox(view, EVENT_BOX, week, 7, null, EVENTPATH));</span>
<a href="#l11.247"></a><span id="l11.247" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l11.248"></a><span id="l11.248" class="difflineplus">+        getEventBoxPath(view, EVENT_BOX, week, 7, null, EVENTPATH)</span>
<a href="#l11.249"></a><span id="l11.249" class="difflineplus">+    );</span>
<a href="#l11.250"></a><span id="l11.250"> }</span>
<a href="#l11.251"></a><span id="l11.251"> </span>
<a href="#l11.252"></a><span id="l11.252"> function teardownTest(module) {</span>
<a href="#l11.253"></a><span id="l11.253">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l11.254"></a><span id="l11.254"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1,235 +1,227 @@</span>
<a href="#l12.4"></a><span id="l12.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.5"></a><span id="l12.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.6"></a><span id="l12.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+var MODULE_NAME = &quot;testWeeklyUntilRecurrence&quot;;</span>
<a href="#l12.9"></a><span id="l12.9"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;window-helpers&quot;];</span>
<a href="#l12.12"></a><span id="l12.12"> </span>
<a href="#l12.13"></a><span id="l12.13"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;, null);</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-var switchToView, goToDate, viewForward, handleOccurrencePrompt;</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+var SHORT_SLEEP, TIMEOUT_MODAL_DIALOG, CALENDARNAME, EVENTPATH, EVENT_BOX;</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+var CANVAS_BOX, REC_DLG_DAYS, REC_DLG_ACCEPT, REC_DLG_UNTIL_INPUT;</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+var helpersForController, handleOccurrencePrompt, switchToView, goToDate;</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+var invokeEventDialog, viewForward, deleteCalendars, createCalendar, menulistSelect;</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-var ENDDATE = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-var HOUR = 8;</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+const ENDDATE = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+const HOUR = 8;</span>
<a href="#l12.32"></a><span id="l12.32"> </span>
<a href="#l12.33"></a><span id="l12.33"> function setupModule(module) {</span>
<a href="#l12.34"></a><span id="l12.34">     controller = mozmill.getMail3PaneController();</span>
<a href="#l12.35"></a><span id="l12.35">     ({</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+        SHORT_SLEEP,</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+        TIMEOUT_MODAL_DIALOG,</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+        EVENTPATH,</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+        REC_DLG_DAYS,</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+        REC_DLG_ACCEPT,</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+        REC_DLG_UNTIL_INPUT,</span>
<a href="#l12.45"></a><span id="l12.45">         helpersForController,</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-        invokeEventDialog,</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-        createCalendar,</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-        deleteCalendars,</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l12.50"></a><span id="l12.50">         switchToView,</span>
<a href="#l12.51"></a><span id="l12.51">         goToDate,</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l12.53"></a><span id="l12.53">         viewForward,</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-        handleOccurrencePrompt,</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-        CALENDARNAME,</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineminus">-        EVENT_BOX,</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">-        CANVAS_BOX</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+        deleteCalendars,</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+        createCalendar,</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+        menulistSelect</span>
<a href="#l12.61"></a><span id="l12.61">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l12.62"></a><span id="l12.62">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l12.63"></a><span id="l12.63">     Object.assign(module, helpersForController(controller));</span>
<a href="#l12.64"></a><span id="l12.64"> </span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+    ({ plan_for_modal_dialog, wait_for_modal_dialog } =</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineplus">+        collector.getModule(&quot;window-helpers&quot;)</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+    );</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+</span>
<a href="#l12.69"></a><span id="l12.69">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l12.70"></a><span id="l12.70"> }</span>
<a href="#l12.71"></a><span id="l12.71"> </span>
<a href="#l12.72"></a><span id="l12.72"> function testWeeklyUntilRecurrence() {</span>
<a href="#l12.73"></a><span id="l12.73">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l12.74"></a><span id="l12.74">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.75"></a><span id="l12.75">     goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l12.76"></a><span id="l12.76"> </span>
<a href="#l12.77"></a><span id="l12.77">     // rotate view</span>
<a href="#l12.78"></a><span id="l12.78">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l12.79"></a><span id="l12.79">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l12.80"></a><span id="l12.80"> </span>
<a href="#l12.81"></a><span id="l12.81">     // create weekly recurring event</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-    let eventBox = lookupEventBox(controller, &quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l12.84"></a><span id="l12.84">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l12.85"></a><span id="l12.85">         let { eid: eventid } = helpersForController(event);</span>
<a href="#l12.86"></a><span id="l12.86"> </span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-        dialog.start(setRecurrence);</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+        plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l12.90"></a><span id="l12.90">         event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineplus">+        menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineplus">+        wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l12.94"></a><span id="l12.94"> </span>
<a href="#l12.95"></a><span id="l12.95">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l12.96"></a><span id="l12.96">     });</span>
<a href="#l12.97"></a><span id="l12.97"> </span>
<a href="#l12.98"></a><span id="l12.98" class="difflineminus">-    let box = getEventBoxPath(controller, &quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineplus">+    let box = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l12.100"></a><span id="l12.100"> </span>
<a href="#l12.101"></a><span id="l12.101">     // check day view</span>
<a href="#l12.102"></a><span id="l12.102">     for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l12.103"></a><span id="l12.103">         // Monday</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineminus">-        controller.assertNode(lookup(box));</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineplus">+        controller.waitForElement(lookup(box));</span>
<a href="#l12.106"></a><span id="l12.106">         viewForward(controller, 2);</span>
<a href="#l12.107"></a><span id="l12.107"> </span>
<a href="#l12.108"></a><span id="l12.108">         // Wednesday</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineminus">-        controller.assertNode(lookup(box));</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineplus">+        controller.waitForElement(lookup(box));</span>
<a href="#l12.111"></a><span id="l12.111">         viewForward(controller, 2);</span>
<a href="#l12.112"></a><span id="l12.112"> </span>
<a href="#l12.113"></a><span id="l12.113">         // Friday</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineminus">-        controller.assertNode(lookup(box));</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineplus">+        controller.waitForElement(lookup(box));</span>
<a href="#l12.116"></a><span id="l12.116">         viewForward(controller, 3);</span>
<a href="#l12.117"></a><span id="l12.117">     }</span>
<a href="#l12.118"></a><span id="l12.118"> </span>
<a href="#l12.119"></a><span id="l12.119">     // Monday, last occurrence</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineminus">-    controller.assertNode(lookup(box));</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineplus">+    controller.waitForElement(lookup(box));</span>
<a href="#l12.122"></a><span id="l12.122">     viewForward(controller, 2);</span>
<a href="#l12.123"></a><span id="l12.123"> </span>
<a href="#l12.124"></a><span id="l12.124">     // Wednesday</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineminus">-    controller.assertNodeNotExist(lookup(box));</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineminus">-    viewForward(controller, 2);</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineplus">+    controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l12.128"></a><span id="l12.128"> </span>
<a href="#l12.129"></a><span id="l12.129">     // check week view</span>
<a href="#l12.130"></a><span id="l12.130">     switchToView(controller, &quot;week&quot;);</span>
<a href="#l12.131"></a><span id="l12.131">     goToDate(controller, 2009, 1, 5);</span>
<a href="#l12.132"></a><span id="l12.132">     for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l12.133"></a><span id="l12.133">         // Monday</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineminus">-        controller.assertNode(</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineminus">-            lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, 2, HOUR, EVENTPATH)</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, HOUR, EVENTPATH)</span>
<a href="#l12.138"></a><span id="l12.138">         );</span>
<a href="#l12.139"></a><span id="l12.139"> </span>
<a href="#l12.140"></a><span id="l12.140" class="difflineminus">-        controller.assertNode(</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineminus">-            lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, 4, HOUR, EVENTPATH)</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineplus">+        // Wednesday</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, HOUR, EVENTPATH)</span>
<a href="#l12.145"></a><span id="l12.145">         );</span>
<a href="#l12.146"></a><span id="l12.146"> </span>
<a href="#l12.147"></a><span id="l12.147">         // Friday</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineminus">-        controller.assertNode(</span>
<a href="#l12.149"></a><span id="l12.149" class="difflineminus">-            lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, 6, HOUR, EVENTPATH)</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l12.151"></a><span id="l12.151" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, HOUR, EVENTPATH)</span>
<a href="#l12.152"></a><span id="l12.152">         );</span>
<a href="#l12.153"></a><span id="l12.153"> </span>
<a href="#l12.154"></a><span id="l12.154">         viewForward(controller, 1);</span>
<a href="#l12.155"></a><span id="l12.155">     }</span>
<a href="#l12.156"></a><span id="l12.156"> </span>
<a href="#l12.157"></a><span id="l12.157">     // Monday, last occurrence</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineminus">-    controller.assertNode(</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineminus">-        lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, 2, HOUR, EVENTPATH)</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineplus">+    controller.waitForElement(</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineplus">+        lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, HOUR, EVENTPATH)</span>
<a href="#l12.162"></a><span id="l12.162">     );</span>
<a href="#l12.163"></a><span id="l12.163" class="difflineminus">-</span>
<a href="#l12.164"></a><span id="l12.164">     // Wednesday</span>
<a href="#l12.165"></a><span id="l12.165">     controller.assertNodeNotExist(</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineminus">-        lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, 4, HOUR, EVENTPATH)</span>
<a href="#l12.167"></a><span id="l12.167" class="difflineplus">+        lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, HOUR, EVENTPATH)</span>
<a href="#l12.168"></a><span id="l12.168">     );</span>
<a href="#l12.169"></a><span id="l12.169"> </span>
<a href="#l12.170"></a><span id="l12.170">     // check multiweek view</span>
<a href="#l12.171"></a><span id="l12.171">     switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l12.172"></a><span id="l12.172">     goToDate(controller, 2009, 1, 5);</span>
<a href="#l12.173"></a><span id="l12.173">     checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l12.174"></a><span id="l12.174"> </span>
<a href="#l12.175"></a><span id="l12.175">     // check month view</span>
<a href="#l12.176"></a><span id="l12.176">     switchToView(controller, &quot;month&quot;);</span>
<a href="#l12.177"></a><span id="l12.177">     goToDate(controller, 2009, 1, 5);</span>
<a href="#l12.178"></a><span id="l12.178">     checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l12.179"></a><span id="l12.179"> </span>
<a href="#l12.180"></a><span id="l12.180">     // delete event</span>
<a href="#l12.181"></a><span id="l12.181" class="difflineminus">-    box = getEventBoxPath(controller, &quot;month&quot;, EVENT_BOX, 2, 2, null) + EVENTPATH;</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineplus">+    box = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 2, 2, null) + EVENTPATH;</span>
<a href="#l12.183"></a><span id="l12.183">     controller.click(lookup(box));</span>
<a href="#l12.184"></a><span id="l12.184">     handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l12.185"></a><span id="l12.185">     controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l12.186"></a><span id="l12.186"> </span>
<a href="#l12.187"></a><span id="l12.187">     // reset view</span>
<a href="#l12.188"></a><span id="l12.188">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.189"></a><span id="l12.189">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l12.190"></a><span id="l12.190">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l12.191"></a><span id="l12.191"> }</span>
<a href="#l12.192"></a><span id="l12.192"> </span>
<a href="#l12.193"></a><span id="l12.193"> function setRecurrence(recurrence) {</span>
<a href="#l12.194"></a><span id="l12.194" class="difflineminus">-    let { lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l12.195"></a><span id="l12.195" class="difflineplus">+    let { sleep: recsleep, lookup: reclookup, eid: recid } =</span>
<a href="#l12.196"></a><span id="l12.196" class="difflineplus">+        helpersForController(recurrence);</span>
<a href="#l12.197"></a><span id="l12.197"> </span>
<a href="#l12.198"></a><span id="l12.198">     // weekly</span>
<a href="#l12.199"></a><span id="l12.199">     recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineminus">-    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l12.202"></a><span id="l12.202" class="difflineplus">+    menulistSelect(recid(&quot;period-list&quot;), &quot;1&quot;, recurrence);</span>
<a href="#l12.203"></a><span id="l12.203"> </span>
<a href="#l12.204"></a><span id="l12.204" class="difflineminus">-    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l12.205"></a><span id="l12.205" class="difflineminus">-    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l12.206"></a><span id="l12.206" class="difflineminus">-    let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l12.207"></a><span id="l12.207" class="difflineplus">+    let mon = cal.l10n.getDateFmtString(&quot;day.2.Mmm&quot;);</span>
<a href="#l12.208"></a><span id="l12.208" class="difflineplus">+    let wed = cal.l10n.getDateFmtString(&quot;day.4.Mmm&quot;);</span>
<a href="#l12.209"></a><span id="l12.209" class="difflineplus">+    let fri = cal.l10n.getDateFmtString(&quot;day.6.Mmm&quot;);</span>
<a href="#l12.210"></a><span id="l12.210"> </span>
<a href="#l12.211"></a><span id="l12.211" class="difflineminus">-    let days = `</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineminus">-        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineminus">-        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l12.214"></a><span id="l12.214" class="difflineminus">-        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/</span>
<a href="#l12.215"></a><span id="l12.215" class="difflineminus">-        id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l12.216"></a><span id="l12.216" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;mainbox&quot;})</span>
<a href="#l12.217"></a><span id="l12.217" class="difflineminus">-    `;</span>
<a href="#l12.218"></a><span id="l12.218" class="difflineminus">-</span>
<a href="#l12.219"></a><span id="l12.219" class="difflineplus">+    // starting from Monday so it should be checked. We have to wait a little,</span>
<a href="#l12.220"></a><span id="l12.220" class="difflineplus">+    // because the checkedstate is set in background by JS.</span>
<a href="#l12.221"></a><span id="l12.221" class="difflineplus">+    recurrence.waitFor(() =&gt; {</span>
<a href="#l12.222"></a><span id="l12.222" class="difflineplus">+        return recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l12.223"></a><span id="l12.223" class="difflineplus">+    }, 30000);</span>
<a href="#l12.224"></a><span id="l12.224">     // starting from Monday so it should be checked</span>
<a href="#l12.225"></a><span id="l12.225" class="difflineminus">-    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineminus">-</span>
<a href="#l12.227"></a><span id="l12.227" class="difflineplus">+    recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l12.228"></a><span id="l12.228">     // check Wednesday and Friday too</span>
<a href="#l12.229"></a><span id="l12.229" class="difflineminus">-    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l12.230"></a><span id="l12.230" class="difflineminus">-    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l12.231"></a><span id="l12.231" class="difflineplus">+    recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l12.232"></a><span id="l12.232" class="difflineplus">+    recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l12.233"></a><span id="l12.233"> </span>
<a href="#l12.234"></a><span id="l12.234">     // set until date</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineminus">-    recurrence.click(recid(&quot;recurrence-range-until&quot;));</span>
<a href="#l12.236"></a><span id="l12.236" class="difflineminus">-    let input = `</span>
<a href="#l12.237"></a><span id="l12.237" class="difflineminus">-        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/</span>
<a href="#l12.238"></a><span id="l12.238" class="difflineminus">-        id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/</span>
<a href="#l12.239"></a><span id="l12.239" class="difflineminus">-        id(&quot;repeat-until-date&quot;)/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l12.240"></a><span id="l12.240" class="difflineminus">-        {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l12.241"></a><span id="l12.241" class="difflineminus">-        anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l12.242"></a><span id="l12.242" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l12.243"></a><span id="l12.243" class="difflineminus">-    `;</span>
<a href="#l12.244"></a><span id="l12.244" class="difflineplus">+    recurrence.radio(recid(&quot;recurrence-range-until&quot;));</span>
<a href="#l12.245"></a><span id="l12.245"> </span>
<a href="#l12.246"></a><span id="l12.246">     // delete previous date</span>
<a href="#l12.247"></a><span id="l12.247" class="difflineminus">-    recurrence.keypress(reclookup(input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l12.248"></a><span id="l12.248" class="difflineminus">-    recurrence.keypress(reclookup(input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l12.249"></a><span id="l12.249" class="difflineplus">+    let untilInput = reclookup(REC_DLG_UNTIL_INPUT);</span>
<a href="#l12.250"></a><span id="l12.250" class="difflineplus">+    recurrence.keypress(untilInput, &quot;a&quot;, { accelKey: true });</span>
<a href="#l12.251"></a><span id="l12.251" class="difflineplus">+    recurrence.keypress(untilInput, &quot;VK_DELETE&quot;, {});</span>
<a href="#l12.252"></a><span id="l12.252"> </span>
<a href="#l12.253"></a><span id="l12.253">     let dateFormatter = cal.getDateFormatter();</span>
<a href="#l12.254"></a><span id="l12.254"> </span>
<a href="#l12.255"></a><span id="l12.255">     let endDateString = dateFormatter.formatDateShort(cal.dtz.jsDateToDateTime(ENDDATE, cal.dtz.floating));</span>
<a href="#l12.256"></a><span id="l12.256" class="difflineplus">+    recsleep(SHORT_SLEEP);</span>
<a href="#l12.257"></a><span id="l12.257" class="difflineplus">+    recurrence.type(untilInput, endDateString);</span>
<a href="#l12.258"></a><span id="l12.258"> </span>
<a href="#l12.259"></a><span id="l12.259" class="difflineminus">-    recurrence.type(reclookup(input), endDateString);</span>
<a href="#l12.260"></a><span id="l12.260" class="difflineplus">+    recsleep(SHORT_SLEEP);</span>
<a href="#l12.261"></a><span id="l12.261" class="difflineplus">+    // Move focus to ensure the date is selected</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineplus">+    recurrence.keypress(untilInput, &quot;VK_TAB&quot;, {});</span>
<a href="#l12.263"></a><span id="l12.263"> </span>
<a href="#l12.264"></a><span id="l12.264">     // close dialog</span>
<a href="#l12.265"></a><span id="l12.265" class="difflineminus">-    recurrence.click(reclookup(`</span>
<a href="#l12.266"></a><span id="l12.266" class="difflineminus">-        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l12.267"></a><span id="l12.267" class="difflineminus">-        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l12.268"></a><span id="l12.268" class="difflineminus">-    `));</span>
<a href="#l12.269"></a><span id="l12.269" class="difflineplus">+    recurrence.click(reclookup(REC_DLG_ACCEPT));</span>
<a href="#l12.270"></a><span id="l12.270"> }</span>
<a href="#l12.271"></a><span id="l12.271"> </span>
<a href="#l12.272"></a><span id="l12.272"> function checkMultiWeekView(view) {</span>
<a href="#l12.273"></a><span id="l12.273" class="difflineminus">-    let startWeek = 1;</span>
<a href="#l12.274"></a><span id="l12.274" class="difflineminus">-</span>
<a href="#l12.275"></a><span id="l12.275" class="difflineminus">-    // in month view event starts from 2nd row</span>
<a href="#l12.276"></a><span id="l12.276" class="difflineminus">-    if (view == &quot;month&quot;) {</span>
<a href="#l12.277"></a><span id="l12.277" class="difflineminus">-        startWeek++;</span>
<a href="#l12.278"></a><span id="l12.278" class="difflineminus">-    }</span>
<a href="#l12.279"></a><span id="l12.279" class="difflineplus">+    let startWeek = view == &quot;month&quot; ? 2 : 1;</span>
<a href="#l12.280"></a><span id="l12.280"> </span>
<a href="#l12.281"></a><span id="l12.281">     for (let week = startWeek; week &lt; startWeek + 3; week++) {</span>
<a href="#l12.282"></a><span id="l12.282">         // Monday</span>
<a href="#l12.283"></a><span id="l12.283" class="difflineminus">-        controller.assertNode(</span>
<a href="#l12.284"></a><span id="l12.284" class="difflineminus">-            lookupEventBox(controller, view, EVENT_BOX, week, 2, null, EVENTPATH)</span>
<a href="#l12.285"></a><span id="l12.285" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l12.286"></a><span id="l12.286" class="difflineplus">+            lookupEventBox(view, EVENT_BOX, week, 2, null, EVENTPATH)</span>
<a href="#l12.287"></a><span id="l12.287">         );</span>
<a href="#l12.288"></a><span id="l12.288" class="difflineminus">-</span>
<a href="#l12.289"></a><span id="l12.289">         // Wednesday</span>
<a href="#l12.290"></a><span id="l12.290">         controller.assertNode(</span>
<a href="#l12.291"></a><span id="l12.291" class="difflineminus">-            lookupEventBox(controller, view, EVENT_BOX, week, 4, null, EVENTPATH)</span>
<a href="#l12.292"></a><span id="l12.292" class="difflineplus">+            lookupEventBox(view, EVENT_BOX, week, 4, null, EVENTPATH)</span>
<a href="#l12.293"></a><span id="l12.293">         );</span>
<a href="#l12.294"></a><span id="l12.294" class="difflineminus">-</span>
<a href="#l12.295"></a><span id="l12.295">         // Friday</span>
<a href="#l12.296"></a><span id="l12.296">         controller.assertNode(</span>
<a href="#l12.297"></a><span id="l12.297" class="difflineminus">-            lookupEventBox(controller, view, EVENT_BOX, week, 6, null, EVENTPATH)</span>
<a href="#l12.298"></a><span id="l12.298" class="difflineplus">+            lookupEventBox(view, EVENT_BOX, week, 6, null, EVENTPATH)</span>
<a href="#l12.299"></a><span id="l12.299">         );</span>
<a href="#l12.300"></a><span id="l12.300">     }</span>
<a href="#l12.301"></a><span id="l12.301"> </span>
<a href="#l12.302"></a><span id="l12.302">     // Monday, last occurrence</span>
<a href="#l12.303"></a><span id="l12.303">     controller.assertNode(</span>
<a href="#l12.304"></a><span id="l12.304" class="difflineminus">-        lookupEventBox(controller, view, EVENT_BOX, startWeek + 3, 2, null, EVENTPATH)</span>
<a href="#l12.305"></a><span id="l12.305" class="difflineplus">+        lookupEventBox(view, EVENT_BOX, startWeek + 3, 2, null, EVENTPATH)</span>
<a href="#l12.306"></a><span id="l12.306">     );</span>
<a href="#l12.307"></a><span id="l12.307"> </span>
<a href="#l12.308"></a><span id="l12.308">     // Wednesday</span>
<a href="#l12.309"></a><span id="l12.309">     controller.assertNodeNotExist(</span>
<a href="#l12.310"></a><span id="l12.310" class="difflineminus">-        lookupEventBox(controller, view, EVENT_BOX, startWeek + 3, 4, null, EVENTPATH)</span>
<a href="#l12.311"></a><span id="l12.311" class="difflineplus">+        lookupEventBox(view, EVENT_BOX, startWeek + 3, 4, null, EVENTPATH)</span>
<a href="#l12.312"></a><span id="l12.312">     );</span>
<a href="#l12.313"></a><span id="l12.313"> }</span>
<a href="#l12.314"></a><span id="l12.314"> </span>
<a href="#l12.315"></a><span id="l12.315"> function teardownTest(module) {</span>
<a href="#l12.316"></a><span id="l12.316">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l12.317"></a><span id="l12.317"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1,46 +1,56 @@</span>
<a href="#l13.4"></a><span id="l13.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.5"></a><span id="l13.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.6"></a><span id="l13.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8" class="difflineplus">+var MODULE_NAME = &quot;testWeeklyWithExceptionRecurrence&quot;;</span>
<a href="#l13.9"></a><span id="l13.9"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;window-helpers&quot;];</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+var TIMEOUT_MODAL_DIALOG, CALENDARNAME, EVENTPATH, EVENT_BOX;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+var CANVAS_BOX, REC_DLG_ACCEPT, REC_DLG_DAYS;</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+var helpersForController, handleOccurrencePrompt, switchToView, goToDate;</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+var invokeEventDialog, viewForward, deleteCalendars, createCalendar, setData;</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+var menulistSelect;</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;, null);</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">-var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-var switchToView, goToDate, handleOccurrencePrompt;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">-</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">-var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineminus">-var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">-</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">-var HOUR = 8;</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-var STARTDATE = new Date(2009, 0, 6);</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+const HOUR = 8;</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+const STARTDATE = new Date(2009, 0, 6);</span>
<a href="#l13.34"></a><span id="l13.34"> </span>
<a href="#l13.35"></a><span id="l13.35"> function setupModule(module) {</span>
<a href="#l13.36"></a><span id="l13.36">     controller = mozmill.getMail3PaneController();</span>
<a href="#l13.37"></a><span id="l13.37">     ({</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-        helpersForController,</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-        invokeEventDialog,</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-        createCalendar,</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-        deleteCalendars,</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-        switchToView,</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-        viewForward,</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-        goToDate,</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-        handleOccurrencePrompt,</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+        TIMEOUT_MODAL_DIALOG,</span>
<a href="#l13.47"></a><span id="l13.47">         CALENDARNAME,</span>
<a href="#l13.48"></a><span id="l13.48">         EVENT_BOX,</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-        CANVAS_BOX</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+        EVENTPATH,</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+        REC_DLG_ACCEPT,</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+        REC_DLG_DAYS,</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+        helpersForController,</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+        switchToView,</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+        goToDate,</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+        viewForward,</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+        deleteCalendars,</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+        createCalendar,</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+        setData,</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+        menulistSelect</span>
<a href="#l13.64"></a><span id="l13.64">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l13.65"></a><span id="l13.65">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l13.66"></a><span id="l13.66">     Object.assign(module, helpersForController(controller));</span>
<a href="#l13.67"></a><span id="l13.67"> </span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+    ({ plan_for_modal_dialog, wait_for_modal_dialog } =</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+        collector.getModule(&quot;window-helpers&quot;)</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+    );</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+</span>
<a href="#l13.72"></a><span id="l13.72">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l13.73"></a><span id="l13.73"> }</span>
<a href="#l13.74"></a><span id="l13.74"> </span>
<a href="#l13.75"></a><span id="l13.75"> function testWeeklyWithExceptionRecurrence() {</span>
<a href="#l13.76"></a><span id="l13.76">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l13.77"></a><span id="l13.77">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.78"></a><span id="l13.78">     goToDate(controller, 2009, 1, 5);</span>
<a href="#l13.79"></a><span id="l13.79"> </span>
<a href="#l13.80"></a><span id="l13.80" class="difflineat">@@ -48,277 +58,247 @@ function testWeeklyWithExceptionRecurren</span>
<a href="#l13.81"></a><span id="l13.81">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l13.82"></a><span id="l13.82">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l13.83"></a><span id="l13.83"> </span>
<a href="#l13.84"></a><span id="l13.84">     // create weekly recurring event</span>
<a href="#l13.85"></a><span id="l13.85">     let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l13.86"></a><span id="l13.86">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l13.87"></a><span id="l13.87">         let { eid: eventid } = helpersForController(event);</span>
<a href="#l13.88"></a><span id="l13.88"> </span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-        dialog.start(setRecurrence);</span>
<a href="#l13.91"></a><span id="l13.91">         event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineminus">-        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineplus">+        plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineplus">+        menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+        wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l13.96"></a><span id="l13.96"> </span>
<a href="#l13.97"></a><span id="l13.97">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l13.98"></a><span id="l13.98">     });</span>
<a href="#l13.99"></a><span id="l13.99"> </span>
<a href="#l13.100"></a><span id="l13.100">     // move 5th January occurrence to 6th January</span>
<a href="#l13.101"></a><span id="l13.101">     eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH);</span>
<a href="#l13.102"></a><span id="l13.102">     handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, false, false);</span>
<a href="#l13.103"></a><span id="l13.103">     invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l13.104"></a><span id="l13.104">         let { eid: eventid } = helpersForController(event);</span>
<a href="#l13.105"></a><span id="l13.105"> </span>
<a href="#l13.106"></a><span id="l13.106" class="difflineminus">-        let startDateInput = eventlookup(`</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineminus">-            /id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineminus">-            id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineminus">-            id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineminus">-            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineminus">-            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineminus">-        `);</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineminus">-        let endDateInput = eventlookup(`</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineminus">-            /id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineminus">-            id(&quot;event-grid-enddate-row&quot;)/[1]/id(&quot;event-grid-enddate-picker-box&quot;)/</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineminus">-            id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineminus">-            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineminus">-            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineminus">-        `);</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineminus">-</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineminus">-        event.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineminus">-</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineminus">-        let dateFormatter = cal.getDateFormatter();</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineminus">-</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineminus">-        let startDateString = dateFormatter.formatDateShort(cal.dtz.jsDateToDateTime(STARTDATE, cal.dtz.floating));</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineminus">-        event.type(startDateInput, startDateString);</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineminus">-        // applies startdate change</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineminus">-        event.click(endDateInput);</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineminus">-</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineplus">+        setData(event, iframe, { startdate: STARTDATE, enddate: STARTDATE });</span>
<a href="#l13.135"></a><span id="l13.135">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l13.136"></a><span id="l13.136">     });</span>
<a href="#l13.137"></a><span id="l13.137"> </span>
<a href="#l13.138"></a><span id="l13.138">     // change recurrence rule</span>
<a href="#l13.139"></a><span id="l13.139">     goToDate(controller, 2009, 1, 7);</span>
<a href="#l13.140"></a><span id="l13.140">     eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH);</span>
<a href="#l13.141"></a><span id="l13.141">     handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true, false);</span>
<a href="#l13.142"></a><span id="l13.142">     invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l13.143"></a><span id="l13.143">         let { eid: eventid } = helpersForController(event);</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineplus">+        let { lookup: iframelookup } = helpersForController(iframe);</span>
<a href="#l13.145"></a><span id="l13.145"> </span>
<a href="#l13.146"></a><span id="l13.146" class="difflineminus">-        dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineminus">-        dialog.start(changeRecurrence);</span>
<a href="#l13.148"></a><span id="l13.148">         event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineminus">-        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineplus">+        plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, changeRecurrence);</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineplus">+        event.click(iframelookup(`</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineplus">+            /id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineplus">+            id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-recurrence-row&quot;)/</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineplus">+            id(&quot;event-grid-recurrence-picker-box&quot;)/id(&quot;repeat-deck&quot;)/</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineplus">+            id(&quot;repeat-details&quot;)/[0]</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineplus">+        `));</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineplus">+        wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l13.158"></a><span id="l13.158"> </span>
<a href="#l13.159"></a><span id="l13.159">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l13.160"></a><span id="l13.160">     });</span>
<a href="#l13.161"></a><span id="l13.161"> </span>
<a href="#l13.162"></a><span id="l13.162">     // check two weeks</span>
<a href="#l13.163"></a><span id="l13.163">     // day view</span>
<a href="#l13.164"></a><span id="l13.164">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.165"></a><span id="l13.165">     let path = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l13.166"></a><span id="l13.166"> </span>
<a href="#l13.167"></a><span id="l13.167">     goToDate(controller, 2009, 1, 5);</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineminus">-    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineplus">+    controller.waitForElementNotPresent(lookup(path));</span>
<a href="#l13.170"></a><span id="l13.170"> </span>
<a href="#l13.171"></a><span id="l13.171">     viewForward(controller, 1);</span>
<a href="#l13.172"></a><span id="l13.172">     let tuesPath = `</span>
<a href="#l13.173"></a><span id="l13.173">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l13.174"></a><span id="l13.174">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l13.175"></a><span id="l13.175">         id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l13.176"></a><span id="l13.176">         id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l13.177"></a><span id="l13.177">         anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l13.178"></a><span id="l13.178">         anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]</span>
<a href="#l13.179"></a><span id="l13.179">     `;</span>
<a href="#l13.180"></a><span id="l13.180"> </span>
<a href="#l13.181"></a><span id="l13.181">     // assert exactly two</span>
<a href="#l13.182"></a><span id="l13.182" class="difflineminus">-    controller.assertNode(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + EVENTPATH));</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineplus">+    controller.waitForElement(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + EVENTPATH));</span>
<a href="#l13.184"></a><span id="l13.184">     controller.assertNode(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + EVENTPATH));</span>
<a href="#l13.185"></a><span id="l13.185">     controller.assertNodeNotExist(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + EVENTPATH));</span>
<a href="#l13.186"></a><span id="l13.186"> </span>
<a href="#l13.187"></a><span id="l13.187">     viewForward(controller, 1);</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineminus">-    controller.assertNode(lookup(path));</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineplus">+    controller.waitForElement(lookup(path));</span>
<a href="#l13.190"></a><span id="l13.190">     viewForward(controller, 1);</span>
<a href="#l13.191"></a><span id="l13.191" class="difflineminus">-    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l13.192"></a><span id="l13.192" class="difflineplus">+    controller.waitForElementNotPresent(lookup(path));</span>
<a href="#l13.193"></a><span id="l13.193">     viewForward(controller, 1);</span>
<a href="#l13.194"></a><span id="l13.194" class="difflineminus">-    controller.assertNode(lookup(path));</span>
<a href="#l13.195"></a><span id="l13.195" class="difflineplus">+    controller.waitForElement(lookup(path));</span>
<a href="#l13.196"></a><span id="l13.196">     viewForward(controller, 1);</span>
<a href="#l13.197"></a><span id="l13.197" class="difflineminus">-    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l13.198"></a><span id="l13.198" class="difflineplus">+    controller.waitForElementNotPresent(lookup(path));</span>
<a href="#l13.199"></a><span id="l13.199">     viewForward(controller, 1);</span>
<a href="#l13.200"></a><span id="l13.200" class="difflineminus">-    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l13.201"></a><span id="l13.201" class="difflineplus">+    controller.waitForElementNotPresent(lookup(path));</span>
<a href="#l13.202"></a><span id="l13.202"> </span>
<a href="#l13.203"></a><span id="l13.203">     // next week</span>
<a href="#l13.204"></a><span id="l13.204">     viewForward(controller, 1);</span>
<a href="#l13.205"></a><span id="l13.205" class="difflineminus">-    controller.assertNode(lookup(path));</span>
<a href="#l13.206"></a><span id="l13.206" class="difflineplus">+    controller.waitForElement(lookup(path));</span>
<a href="#l13.207"></a><span id="l13.207">     viewForward(controller, 1);</span>
<a href="#l13.208"></a><span id="l13.208" class="difflineminus">-    controller.assertNode(lookup(path));</span>
<a href="#l13.209"></a><span id="l13.209" class="difflineplus">+    controller.waitForElement(lookup(path));</span>
<a href="#l13.210"></a><span id="l13.210">     viewForward(controller, 1);</span>
<a href="#l13.211"></a><span id="l13.211" class="difflineminus">-    controller.assertNode(lookup(path));</span>
<a href="#l13.212"></a><span id="l13.212" class="difflineplus">+    controller.waitForElement(lookup(path));</span>
<a href="#l13.213"></a><span id="l13.213">     viewForward(controller, 1);</span>
<a href="#l13.214"></a><span id="l13.214" class="difflineminus">-    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l13.215"></a><span id="l13.215" class="difflineplus">+    controller.waitForElementNotPresent(lookup(path));</span>
<a href="#l13.216"></a><span id="l13.216">     viewForward(controller, 1);</span>
<a href="#l13.217"></a><span id="l13.217" class="difflineminus">-    controller.assertNode(lookup(path));</span>
<a href="#l13.218"></a><span id="l13.218" class="difflineplus">+    controller.waitForElement(lookup(path));</span>
<a href="#l13.219"></a><span id="l13.219">     viewForward(controller, 1);</span>
<a href="#l13.220"></a><span id="l13.220" class="difflineminus">-    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l13.221"></a><span id="l13.221" class="difflineplus">+    controller.waitForElementNotPresent(lookup(path));</span>
<a href="#l13.222"></a><span id="l13.222"> </span>
<a href="#l13.223"></a><span id="l13.223">     // week view</span>
<a href="#l13.224"></a><span id="l13.224">     switchToView(controller, &quot;week&quot;);</span>
<a href="#l13.225"></a><span id="l13.225">     goToDate(controller, 2009, 1, 5);</span>
<a href="#l13.226"></a><span id="l13.226"> </span>
<a href="#l13.227"></a><span id="l13.227" class="difflineminus">-    path = getEventBoxPath(&quot;week&quot;, EVENT_BOX, null, 2, HOUR) + EVENTPATH;</span>
<a href="#l13.228"></a><span id="l13.228" class="difflineminus">-    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l13.229"></a><span id="l13.229" class="difflineminus">-</span>
<a href="#l13.230"></a><span id="l13.230">     tuesPath = `</span>
<a href="#l13.231"></a><span id="l13.231">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l13.232"></a><span id="l13.232">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l13.233"></a><span id="l13.233">         id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l13.234"></a><span id="l13.234">         id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l13.235"></a><span id="l13.235">         anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l13.236"></a><span id="l13.236">         anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]</span>
<a href="#l13.237"></a><span id="l13.237">     `;</span>
<a href="#l13.238"></a><span id="l13.238" class="difflineplus">+</span>
<a href="#l13.239"></a><span id="l13.239">     // assert exactly two</span>
<a href="#l13.240"></a><span id="l13.240" class="difflineminus">-    controller.assertNode(</span>
<a href="#l13.241"></a><span id="l13.241" class="difflineminus">-        lookup(tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + EVENTPATH)</span>
<a href="#l13.242"></a><span id="l13.242" class="difflineminus">-    );</span>
<a href="#l13.243"></a><span id="l13.243" class="difflineminus">-    controller.assertNode(</span>
<a href="#l13.244"></a><span id="l13.244" class="difflineminus">-        lookup(tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + EVENTPATH)</span>
<a href="#l13.245"></a><span id="l13.245" class="difflineminus">-    );</span>
<a href="#l13.246"></a><span id="l13.246" class="difflineminus">-    controller.assertNodeNotExist(</span>
<a href="#l13.247"></a><span id="l13.247" class="difflineminus">-        lookup(tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + EVENTPATH)</span>
<a href="#l13.248"></a><span id="l13.248" class="difflineminus">-    );</span>
<a href="#l13.249"></a><span id="l13.249" class="difflineplus">+    controller.waitForElement(lookup(</span>
<a href="#l13.250"></a><span id="l13.250" class="difflineplus">+        tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + EVENTPATH</span>
<a href="#l13.251"></a><span id="l13.251" class="difflineplus">+    ));</span>
<a href="#l13.252"></a><span id="l13.252" class="difflineplus">+    controller.assertNode(lookup(</span>
<a href="#l13.253"></a><span id="l13.253" class="difflineplus">+        tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + EVENTPATH</span>
<a href="#l13.254"></a><span id="l13.254" class="difflineplus">+    ));</span>
<a href="#l13.255"></a><span id="l13.255" class="difflineplus">+    controller.assertNodeNotExist(lookup(</span>
<a href="#l13.256"></a><span id="l13.256" class="difflineplus">+        tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + EVENTPATH</span>
<a href="#l13.257"></a><span id="l13.257" class="difflineplus">+    ));</span>
<a href="#l13.258"></a><span id="l13.258"> </span>
<a href="#l13.259"></a><span id="l13.259" class="difflineplus">+    // wait for the last occurrence because this appears latest.</span>
<a href="#l13.260"></a><span id="l13.260" class="difflineplus">+    controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, HOUR));</span>
<a href="#l13.261"></a><span id="l13.261" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 1, HOUR));</span>
<a href="#l13.262"></a><span id="l13.262" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, HOUR));</span>
<a href="#l13.263"></a><span id="l13.263">     controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, HOUR));</span>
<a href="#l13.264"></a><span id="l13.264">     controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 5, HOUR));</span>
<a href="#l13.265"></a><span id="l13.265" class="difflineminus">-    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, HOUR));</span>
<a href="#l13.266"></a><span id="l13.266">     controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR));</span>
<a href="#l13.267"></a><span id="l13.267"> </span>
<a href="#l13.268"></a><span id="l13.268">     viewForward(controller, 1);</span>
<a href="#l13.269"></a><span id="l13.269" class="difflineplus">+    controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, HOUR));</span>
<a href="#l13.270"></a><span id="l13.270">     controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 1, HOUR));</span>
<a href="#l13.271"></a><span id="l13.271">     controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, HOUR));</span>
<a href="#l13.272"></a><span id="l13.272">     controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 3, HOUR));</span>
<a href="#l13.273"></a><span id="l13.273">     controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, HOUR));</span>
<a href="#l13.274"></a><span id="l13.274">     controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 5, HOUR));</span>
<a href="#l13.275"></a><span id="l13.275" class="difflineminus">-    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, HOUR));</span>
<a href="#l13.276"></a><span id="l13.276">     controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR));</span>
<a href="#l13.277"></a><span id="l13.277"> </span>
<a href="#l13.278"></a><span id="l13.278">     // multiweek view</span>
<a href="#l13.279"></a><span id="l13.279">     switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l13.280"></a><span id="l13.280">     goToDate(controller, 2009, 1, 5);</span>
<a href="#l13.281"></a><span id="l13.281">     checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l13.282"></a><span id="l13.282"> </span>
<a href="#l13.283"></a><span id="l13.283">     // month view</span>
<a href="#l13.284"></a><span id="l13.284">     switchToView(controller, &quot;month&quot;);</span>
<a href="#l13.285"></a><span id="l13.285">     checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l13.286"></a><span id="l13.286"> </span>
<a href="#l13.287"></a><span id="l13.287">     // delete event</span>
<a href="#l13.288"></a><span id="l13.288">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.289"></a><span id="l13.289">     goToDate(controller, 2009, 1, 12);</span>
<a href="#l13.290"></a><span id="l13.290">     path = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l13.291"></a><span id="l13.291" class="difflineminus">-</span>
<a href="#l13.292"></a><span id="l13.292">     controller.click(lookup(path));</span>
<a href="#l13.293"></a><span id="l13.293">     handleOccurrencePrompt(controller, eid(&quot;day-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l13.294"></a><span id="l13.294">     controller.waitForElementNotPresent(lookup(path));</span>
<a href="#l13.295"></a><span id="l13.295"> </span>
<a href="#l13.296"></a><span id="l13.296">     // reset view</span>
<a href="#l13.297"></a><span id="l13.297">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l13.298"></a><span id="l13.298">     controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l13.299"></a><span id="l13.299"> }</span>
<a href="#l13.300"></a><span id="l13.300"> </span>
<a href="#l13.301"></a><span id="l13.301"> function setRecurrence(recurrence) {</span>
<a href="#l13.302"></a><span id="l13.302" class="difflineminus">-    let { sleep: recsleep, lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l13.303"></a><span id="l13.303" class="difflineplus">+    let { lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l13.304"></a><span id="l13.304"> </span>
<a href="#l13.305"></a><span id="l13.305">     // weekly</span>
<a href="#l13.306"></a><span id="l13.306" class="difflineminus">-    recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l13.307"></a><span id="l13.307" class="difflineminus">-    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l13.308"></a><span id="l13.308" class="difflineminus">-    recsleep();</span>
<a href="#l13.309"></a><span id="l13.309" class="difflineplus">+    menulistSelect(recid(&quot;period-list&quot;), &quot;1&quot;, recurrence);</span>
<a href="#l13.310"></a><span id="l13.310"> </span>
<a href="#l13.311"></a><span id="l13.311" class="difflineminus">-    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l13.312"></a><span id="l13.312" class="difflineminus">-    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l13.313"></a><span id="l13.313" class="difflineminus">-    let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l13.314"></a><span id="l13.314" class="difflineplus">+    let mon = cal.l10n.getDateFmtString(&quot;day.2.Mmm&quot;);</span>
<a href="#l13.315"></a><span id="l13.315" class="difflineplus">+    let wed = cal.l10n.getDateFmtString(&quot;day.4.Mmm&quot;);</span>
<a href="#l13.316"></a><span id="l13.316" class="difflineplus">+    let fri = cal.l10n.getDateFmtString(&quot;day.6.Mmm&quot;);</span>
<a href="#l13.317"></a><span id="l13.317"> </span>
<a href="#l13.318"></a><span id="l13.318" class="difflineminus">-    let days = `</span>
<a href="#l13.319"></a><span id="l13.319" class="difflineminus">-        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l13.320"></a><span id="l13.320" class="difflineminus">-        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l13.321"></a><span id="l13.321" class="difflineminus">-        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/</span>
<a href="#l13.322"></a><span id="l13.322" class="difflineminus">-        id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l13.323"></a><span id="l13.323" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;mainbox&quot;})</span>
<a href="#l13.324"></a><span id="l13.324" class="difflineminus">-    `;</span>
<a href="#l13.325"></a><span id="l13.325" class="difflineminus">-</span>
<a href="#l13.326"></a><span id="l13.326" class="difflineminus">-    // starting from Monday so it should be checked</span>
<a href="#l13.327"></a><span id="l13.327" class="difflineminus">-    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l13.328"></a><span id="l13.328" class="difflineplus">+    // starting from Monday so it should be checked. We have to wait a little,</span>
<a href="#l13.329"></a><span id="l13.329" class="difflineplus">+    // because the checkedstate is set in background by JS.</span>
<a href="#l13.330"></a><span id="l13.330" class="difflineplus">+    recurrence.waitFor(() =&gt; {</span>
<a href="#l13.331"></a><span id="l13.331" class="difflineplus">+        return recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l13.332"></a><span id="l13.332" class="difflineplus">+    }, 10000);</span>
<a href="#l13.333"></a><span id="l13.333">     // check Wednesday and Friday too</span>
<a href="#l13.334"></a><span id="l13.334" class="difflineminus">-    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l13.335"></a><span id="l13.335" class="difflineminus">-    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l13.336"></a><span id="l13.336" class="difflineplus">+    recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l13.337"></a><span id="l13.337" class="difflineplus">+    recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l13.338"></a><span id="l13.338" class="difflineplus">+    recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l13.339"></a><span id="l13.339" class="difflineplus">+    recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l13.340"></a><span id="l13.340"> </span>
<a href="#l13.341"></a><span id="l13.341">     // close dialog</span>
<a href="#l13.342"></a><span id="l13.342" class="difflineminus">-    recurrence.click(reclookup(`</span>
<a href="#l13.343"></a><span id="l13.343" class="difflineminus">-        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l13.344"></a><span id="l13.344" class="difflineminus">-        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l13.345"></a><span id="l13.345" class="difflineminus">-    `));</span>
<a href="#l13.346"></a><span id="l13.346" class="difflineplus">+    recurrence.click(reclookup(REC_DLG_ACCEPT));</span>
<a href="#l13.347"></a><span id="l13.347"> }</span>
<a href="#l13.348"></a><span id="l13.348"> </span>
<a href="#l13.349"></a><span id="l13.349"> function changeRecurrence(recurrence) {</span>
<a href="#l13.350"></a><span id="l13.350" class="difflineminus">-    let { sleep: recsleep, lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l13.351"></a><span id="l13.351" class="difflineplus">+    let { lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l13.352"></a><span id="l13.352"> </span>
<a href="#l13.353"></a><span id="l13.353">     // weekly</span>
<a href="#l13.354"></a><span id="l13.354" class="difflineminus">-    recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l13.355"></a><span id="l13.355" class="difflineminus">-    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l13.356"></a><span id="l13.356" class="difflineminus">-    recsleep();</span>
<a href="#l13.357"></a><span id="l13.357" class="difflineplus">+    menulistSelect(recid(&quot;period-list&quot;), &quot;1&quot;, recurrence);</span>
<a href="#l13.358"></a><span id="l13.358"> </span>
<a href="#l13.359"></a><span id="l13.359" class="difflineminus">-    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l13.360"></a><span id="l13.360" class="difflineminus">-    let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l13.361"></a><span id="l13.361" class="difflineminus">-    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l13.362"></a><span id="l13.362" class="difflineminus">-    let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l13.363"></a><span id="l13.363" class="difflineminus">-</span>
<a href="#l13.364"></a><span id="l13.364" class="difflineminus">-    let days = `</span>
<a href="#l13.365"></a><span id="l13.365" class="difflineminus">-        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l13.366"></a><span id="l13.366" class="difflineminus">-        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l13.367"></a><span id="l13.367" class="difflineminus">-        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/</span>
<a href="#l13.368"></a><span id="l13.368" class="difflineminus">-        id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l13.369"></a><span id="l13.369" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;mainbox&quot;})/</span>
<a href="#l13.370"></a><span id="l13.370" class="difflineminus">-     `;</span>
<a href="#l13.371"></a><span id="l13.371" class="difflineplus">+    let mon = cal.l10n.getDateFmtString(&quot;day.2.Mmm&quot;);</span>
<a href="#l13.372"></a><span id="l13.372" class="difflineplus">+    let tue = cal.l10n.getDateFmtString(&quot;day.3.Mmm&quot;);</span>
<a href="#l13.373"></a><span id="l13.373" class="difflineplus">+    let wed = cal.l10n.getDateFmtString(&quot;day.4.Mmm&quot;);</span>
<a href="#l13.374"></a><span id="l13.374" class="difflineplus">+    let fri = cal.l10n.getDateFmtString(&quot;day.6.Mmm&quot;);</span>
<a href="#l13.375"></a><span id="l13.375"> </span>
<a href="#l13.376"></a><span id="l13.376">     // check old rule</span>
<a href="#l13.377"></a><span id="l13.377" class="difflineminus">-    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l13.378"></a><span id="l13.378" class="difflineminus">-    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l13.379"></a><span id="l13.379" class="difflineminus">-    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l13.380"></a><span id="l13.380" class="difflineplus">+    // starting from Monday so it should be checked. We have to wait a little,</span>
<a href="#l13.381"></a><span id="l13.381" class="difflineplus">+    // because the checkedstate is set in background by JS.</span>
<a href="#l13.382"></a><span id="l13.382" class="difflineplus">+    recurrence.waitFor(() =&gt; {</span>
<a href="#l13.383"></a><span id="l13.383" class="difflineplus">+        return recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l13.384"></a><span id="l13.384" class="difflineplus">+    }, 10000);</span>
<a href="#l13.385"></a><span id="l13.385" class="difflineplus">+    recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l13.386"></a><span id="l13.386" class="difflineplus">+    recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l13.387"></a><span id="l13.387"> </span>
<a href="#l13.388"></a><span id="l13.388">     // check Tuesday</span>
<a href="#l13.389"></a><span id="l13.389" class="difflineminus">-    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l13.390"></a><span id="l13.390" class="difflineplus">+    recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l13.391"></a><span id="l13.391" class="difflineplus">+    recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l13.392"></a><span id="l13.392"> </span>
<a href="#l13.393"></a><span id="l13.393">     // close dialog</span>
<a href="#l13.394"></a><span id="l13.394" class="difflineminus">-    recurrence.click(reclookup(`</span>
<a href="#l13.395"></a><span id="l13.395" class="difflineminus">-        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l13.396"></a><span id="l13.396" class="difflineminus">-        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l13.397"></a><span id="l13.397" class="difflineminus">-    `));</span>
<a href="#l13.398"></a><span id="l13.398" class="difflineplus">+    recurrence.click(reclookup(REC_DLG_ACCEPT));</span>
<a href="#l13.399"></a><span id="l13.399"> }</span>
<a href="#l13.400"></a><span id="l13.400"> </span>
<a href="#l13.401"></a><span id="l13.401"> function checkMultiWeekView(view) {</span>
<a href="#l13.402"></a><span id="l13.402">     let startWeek = view == &quot;multiweek&quot; ? 1 : 2;</span>
<a href="#l13.403"></a><span id="l13.403" class="difflineplus">+    let assertNodeLookup = (...args) =&gt; {</span>
<a href="#l13.404"></a><span id="l13.404" class="difflineplus">+        return controller.assertNode(lookupEventBox(...args));</span>
<a href="#l13.405"></a><span id="l13.405" class="difflineplus">+    };</span>
<a href="#l13.406"></a><span id="l13.406" class="difflineplus">+    let assertNodeNotExistLookup = (...args) =&gt; {</span>
<a href="#l13.407"></a><span id="l13.407" class="difflineplus">+        return controller.assertNodeNotExist(lookupEventBox(...args));</span>
<a href="#l13.408"></a><span id="l13.408" class="difflineplus">+    };</span>
<a href="#l13.409"></a><span id="l13.409"> </span>
<a href="#l13.410"></a><span id="l13.410" class="difflineminus">-    controller.assertNodeNotExist(</span>
<a href="#l13.411"></a><span id="l13.411" class="difflineminus">-        lookupEventBox(view, EVENT_BOX, startWeek, 2, HOUR, EVENTPATH)</span>
<a href="#l13.412"></a><span id="l13.412" class="difflineminus">-    );</span>
<a href="#l13.413"></a><span id="l13.413" class="difflineminus">-</span>
<a href="#l13.414"></a><span id="l13.414" class="difflineplus">+    // wait for the first items, then check the ones not to be present</span>
<a href="#l13.415"></a><span id="l13.415">     // assert exactly two</span>
<a href="#l13.416"></a><span id="l13.416" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[0]&quot;));</span>
<a href="#l13.417"></a><span id="l13.417" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[1]&quot;));</span>
<a href="#l13.418"></a><span id="l13.418" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[2]&quot;));</span>
<a href="#l13.419"></a><span id="l13.419" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 4, HOUR, EVENTPATH));</span>
<a href="#l13.420"></a><span id="l13.420" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 5, HOUR, EVENTPATH));</span>
<a href="#l13.421"></a><span id="l13.421" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 6, HOUR, EVENTPATH));</span>
<a href="#l13.422"></a><span id="l13.422" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 7, HOUR, EVENTPATH));</span>
<a href="#l13.423"></a><span id="l13.423" class="difflineplus">+    controller.waitForElement(</span>
<a href="#l13.424"></a><span id="l13.424" class="difflineplus">+        lookupEventBox(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[0]&quot;)</span>
<a href="#l13.425"></a><span id="l13.425" class="difflineplus">+    );</span>
<a href="#l13.426"></a><span id="l13.426" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[1]&quot;);</span>
<a href="#l13.427"></a><span id="l13.427" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[2]&quot;);</span>
<a href="#l13.428"></a><span id="l13.428" class="difflineplus">+    // Then check no item on the 5th.</span>
<a href="#l13.429"></a><span id="l13.429" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 2, HOUR, EVENTPATH);</span>
<a href="#l13.430"></a><span id="l13.430" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[2]&quot;);</span>
<a href="#l13.431"></a><span id="l13.431" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek, 4, HOUR, EVENTPATH);</span>
<a href="#l13.432"></a><span id="l13.432" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 5, HOUR, EVENTPATH);</span>
<a href="#l13.433"></a><span id="l13.433" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek, 6, HOUR, EVENTPATH);</span>
<a href="#l13.434"></a><span id="l13.434" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 7, HOUR, EVENTPATH);</span>
<a href="#l13.435"></a><span id="l13.435"> </span>
<a href="#l13.436"></a><span id="l13.436" class="difflineminus">-    startWeek++;</span>
<a href="#l13.437"></a><span id="l13.437" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 1, HOUR, EVENTPATH));</span>
<a href="#l13.438"></a><span id="l13.438" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 2, HOUR, EVENTPATH));</span>
<a href="#l13.439"></a><span id="l13.439" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 3, HOUR, EVENTPATH));</span>
<a href="#l13.440"></a><span id="l13.440" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 4, HOUR, EVENTPATH));</span>
<a href="#l13.441"></a><span id="l13.441" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 5, HOUR, EVENTPATH));</span>
<a href="#l13.442"></a><span id="l13.442" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 6, HOUR, EVENTPATH));</span>
<a href="#l13.443"></a><span id="l13.443" class="difflineminus">-    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 7, HOUR, EVENTPATH));</span>
<a href="#l13.444"></a><span id="l13.444" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek + 1, 1, HOUR, EVENTPATH);</span>
<a href="#l13.445"></a><span id="l13.445" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek + 1, 2, HOUR, EVENTPATH);</span>
<a href="#l13.446"></a><span id="l13.446" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek + 1, 3, HOUR, EVENTPATH);</span>
<a href="#l13.447"></a><span id="l13.447" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek + 1, 4, HOUR, EVENTPATH);</span>
<a href="#l13.448"></a><span id="l13.448" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek + 1, 5, HOUR, EVENTPATH);</span>
<a href="#l13.449"></a><span id="l13.449" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek + 1, 6, HOUR, EVENTPATH);</span>
<a href="#l13.450"></a><span id="l13.450" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek + 1, 7, HOUR, EVENTPATH);</span>
<a href="#l13.451"></a><span id="l13.451"> }</span>
<a href="#l13.452"></a><span id="l13.452"> </span>
<a href="#l13.453"></a><span id="l13.453"> function teardownTest(module) {</span>
<a href="#l13.454"></a><span id="l13.454">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l13.455"></a><span id="l13.455"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -152,18 +152,16 @@ function handleAddingAttachment(controll</span>
<a href="#l14.4"></a><span id="l14.4">     plan_for_modal_dialog(&quot;commonDialog&quot;, (attachment) =&gt; {</span>
<a href="#l14.5"></a><span id="l14.5">         let { lookup: cdlglookup, eid: cdlgid } = helpersForController(attachment);</span>
<a href="#l14.6"></a><span id="l14.6">         attachment.waitForElement(cdlgid(&quot;loginTextbox&quot;));</span>
<a href="#l14.7"></a><span id="l14.7">         cdlgid(&quot;loginTextbox&quot;).getNode().value = url;</span>
<a href="#l14.8"></a><span id="l14.8">         attachment.click(cdlglookup(`</span>
<a href="#l14.9"></a><span id="l14.9">             /id(&quot;commonDialog&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l14.10"></a><span id="l14.10">         `));</span>
<a href="#l14.11"></a><span id="l14.11">     });</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-    wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l14.14"></a><span id="l14.14"> }</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> /**</span>
<a href="#l14.17"></a><span id="l14.17">  * open and click the appropriate button on the recurrence-Prompt Dialog</span>
<a href="#l14.18"></a><span id="l14.18">  *</span>
<a href="#l14.19"></a><span id="l14.19">  * @param controller      Mozmill window controller</span>
<a href="#l14.20"></a><span id="l14.20">  * @param element         Mozmill element which will open the dialog</span>
<a href="#l14.21"></a><span id="l14.21">  * @param mode            action to exec on element (delete OR modify)</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -595,17 +593,16 @@ function findEventsInNode(node, eventNod</span>
<a href="#l14.23"></a><span id="l14.23">  *                          description - event/task description</span>
<a href="#l14.24"></a><span id="l14.24">  *                          category - category label</span>
<a href="#l14.25"></a><span id="l14.25">  *                          calendar - calendar the item should be in</span>
<a href="#l14.26"></a><span id="l14.26">  *                          allday - boolean value</span>
<a href="#l14.27"></a><span id="l14.27">  *                          startdate - Date object</span>
<a href="#l14.28"></a><span id="l14.28">  *                          starttime - Date object</span>
<a href="#l14.29"></a><span id="l14.29">  *                          enddate - Date object</span>
<a href="#l14.30"></a><span id="l14.30">  *                          endtime - Date object</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">- *                          timezone - false for local, true for set timezone</span>
<a href="#l14.32"></a><span id="l14.32">  *                          repeat - reccurrence value, one of none/daily/weekly/</span>
<a href="#l14.33"></a><span id="l14.33">  *                                   every.weekday/bi.weekly/</span>
<a href="#l14.34"></a><span id="l14.34">  *                                   monthly/yearly</span>
<a href="#l14.35"></a><span id="l14.35">  *                                   (custom is not supported)</span>
<a href="#l14.36"></a><span id="l14.36">  *                          reminder - reminder option index (custom not supp.)</span>
<a href="#l14.37"></a><span id="l14.37">  *                          priority - none/low/normal/high</span>
<a href="#l14.38"></a><span id="l14.38">  *                          privacy - public/confidential/private</span>
<a href="#l14.39"></a><span id="l14.39">  *                          status - none/tentative/confirmed/canceled for events</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineat">@@ -664,22 +661,16 @@ function setData(dialog, iframe, data) {</span>
<a href="#l14.41"></a><span id="l14.41">     let endTimeInput = iframeLookup(`</span>
<a href="#l14.42"></a><span id="l14.42">         ${innerFrame}/id(&quot;event-grid-enddate-row&quot;)/[1]/</span>
<a href="#l14.43"></a><span id="l14.43">         id(&quot;event-grid-enddate-picker-box&quot;)/id(&quot;${endId}&quot;)/${timeInput}</span>
<a href="#l14.44"></a><span id="l14.44">     `);</span>
<a href="#l14.45"></a><span id="l14.45">     let completedDateInput = iframeLookup(`</span>
<a href="#l14.46"></a><span id="l14.46">         ${innerFrame}/id(&quot;event-grid-todo-status-row&quot;)/</span>
<a href="#l14.47"></a><span id="l14.47">         id(&quot;event-grid-todo-status-picker-box&quot;)/id(&quot;completed-date-picker&quot;)/${dateInput}</span>
<a href="#l14.48"></a><span id="l14.48">     `);</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-    let percentCompleteInput = iframeLookup(`</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-        ${innerFrame}/id(&quot;event-grid-todo-status-row&quot;)/</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-        id(&quot;event-grid-todo-status-picker-box&quot;)/id(&quot;percent-complete-textbox&quot;)/</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-        anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-    `);</span>
<a href="#l14.55"></a><span id="l14.55">     let dateFormatter = cal.getDateFormatter();</span>
<a href="#l14.56"></a><span id="l14.56">     // wait for input elements' values to be populated</span>
<a href="#l14.57"></a><span id="l14.57">     sleep();</span>
<a href="#l14.58"></a><span id="l14.58"> </span>
<a href="#l14.59"></a><span id="l14.59">     // title</span>
<a href="#l14.60"></a><span id="l14.60">     if (data.title != undefined) {</span>
<a href="#l14.61"></a><span id="l14.61">         // we need to set directly here in case there is already a title.</span>
<a href="#l14.62"></a><span id="l14.62">         // accelKey+a won't work in all OS</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineat">@@ -704,23 +695,16 @@ function setData(dialog, iframe, data) {</span>
<a href="#l14.64"></a><span id="l14.64">         menulistSelect(iframeId(&quot;item-calendar&quot;), data.calendar, dialog);</span>
<a href="#l14.65"></a><span id="l14.65">     }</span>
<a href="#l14.66"></a><span id="l14.66"> </span>
<a href="#l14.67"></a><span id="l14.67">     // all-day</span>
<a href="#l14.68"></a><span id="l14.68">     if (data.allday != undefined &amp;&amp; isEvent) {</span>
<a href="#l14.69"></a><span id="l14.69">         dialog.check(iframeId(&quot;event-all-day&quot;), data.allday);</span>
<a href="#l14.70"></a><span id="l14.70">     }</span>
<a href="#l14.71"></a><span id="l14.71"> </span>
<a href="#l14.72"></a><span id="l14.72" class="difflineminus">-    // timezone</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineminus">-    if (data.timezone != undefined) {</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineminus">-        let menuitem = iframeId(&quot;options-timezones-menuitem&quot;);</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineminus">-        menuitem.getNode().setAttribute(&quot;checked&quot;, data.timezone);</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineminus">-        dialog.click(menuitem);</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineminus">-    }</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineminus">-</span>
<a href="#l14.79"></a><span id="l14.79">     // startdate</span>
<a href="#l14.80"></a><span id="l14.80">     if (data.startdate != undefined &amp;&amp; data.startdate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l14.81"></a><span id="l14.81">         let startdate = dateFormatter.formatDateShort(cal.dtz.jsDateToDateTime(data.startdate, cal.dtz.floating));</span>
<a href="#l14.82"></a><span id="l14.82"> </span>
<a href="#l14.83"></a><span id="l14.83">         if (!isEvent) {</span>
<a href="#l14.84"></a><span id="l14.84">             dialog.check(iframeId(&quot;todo-has-entrydate&quot;), true);</span>
<a href="#l14.85"></a><span id="l14.85">         }</span>
<a href="#l14.86"></a><span id="l14.86">         dialog.keypress(startDateInput, &quot;a&quot;, { accelKey: true });</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineat">@@ -759,20 +743,17 @@ function setData(dialog, iframe, data) {</span>
<a href="#l14.88"></a><span id="l14.88">     // TODO: menulistSelect does not work here, because menuitems have no value.</span>
<a href="#l14.89"></a><span id="l14.89">     // will be fixed with Bug 984044</span>
<a href="#l14.90"></a><span id="l14.90">     if (data.reminder != undefined) {</span>
<a href="#l14.91"></a><span id="l14.91">         menulistSelect(iframeId(&quot;item-alarm&quot;), data.reminder, dialog);</span>
<a href="#l14.92"></a><span id="l14.92">     }</span>
<a href="#l14.93"></a><span id="l14.93"> </span>
<a href="#l14.94"></a><span id="l14.94">     // description</span>
<a href="#l14.95"></a><span id="l14.95">     if (data.description != undefined) {</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineminus">-        let descField = iframeLookup(`</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-            ${innerFrame}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineminus">-        `);</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineplus">+        let descField = iframeId(&quot;item-description&quot;);</span>
<a href="#l14.101"></a><span id="l14.101">         descField.getNode().value = data.description;</span>
<a href="#l14.102"></a><span id="l14.102">     }</span>
<a href="#l14.103"></a><span id="l14.103"> </span>
<a href="#l14.104"></a><span id="l14.104">     // priority</span>
<a href="#l14.105"></a><span id="l14.105">     if (data.priority != undefined) {</span>
<a href="#l14.106"></a><span id="l14.106">         dialog.mainMenu.click(`#options-priority-${data.priority}-label`);</span>
<a href="#l14.107"></a><span id="l14.107">     }</span>
<a href="#l14.108"></a><span id="l14.108"> </span>
<a href="#l14.109"></a><span id="l14.109" class="difflineat">@@ -801,31 +782,32 @@ function setData(dialog, iframe, data) {</span>
<a href="#l14.110"></a><span id="l14.110">         }</span>
<a href="#l14.111"></a><span id="l14.111">     }</span>
<a href="#l14.112"></a><span id="l14.112"> </span>
<a href="#l14.113"></a><span id="l14.113">     // percent complete</span>
<a href="#l14.114"></a><span id="l14.114">     if (data.percent != undefined &amp;&amp;</span>
<a href="#l14.115"></a><span id="l14.115">         (currentStatus == &quot;NEEDS-ACTION&quot; ||</span>
<a href="#l14.116"></a><span id="l14.116">          currentStatus == &quot;IN-PROCESS&quot; ||</span>
<a href="#l14.117"></a><span id="l14.117">          currentStatus == &quot;COMPLETED&quot;)) {</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineminus">-        percentCompleteInput.getNode().value = data.percent;</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineplus">+        iframeId(&quot;percent-complete-textbox&quot;).getNode().value = data.percent;</span>
<a href="#l14.120"></a><span id="l14.120">     }</span>
<a href="#l14.121"></a><span id="l14.121"> </span>
<a href="#l14.122"></a><span id="l14.122">     // free/busy</span>
<a href="#l14.123"></a><span id="l14.123">     if (data.freebusy != undefined) {</span>
<a href="#l14.124"></a><span id="l14.124">         dialog.mainMenu.click(`#options-freebusy-${data.freebusy}-menuitem`);</span>
<a href="#l14.125"></a><span id="l14.125">     }</span>
<a href="#l14.126"></a><span id="l14.126"> </span>
<a href="#l14.127"></a><span id="l14.127">     // attachment</span>
<a href="#l14.128"></a><span id="l14.128">     // TODO: Needs fixing,</span>
<a href="#l14.129"></a><span id="l14.129">     // will be fixed with Bug 984044</span>
<a href="#l14.130"></a><span id="l14.130">     if (data.attachment != undefined) {</span>
<a href="#l14.131"></a><span id="l14.131">         if (data.attachment.add != undefined) {</span>
<a href="#l14.132"></a><span id="l14.132">             handleAddingAttachment(dialog, data.attachment.add);</span>
<a href="#l14.133"></a><span id="l14.133">             dialog.click(eid(&quot;button-url&quot;));</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineplus">+            wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l14.135"></a><span id="l14.135">         }</span>
<a href="#l14.136"></a><span id="l14.136">         if (data.attachment.delete != undefined) {</span>
<a href="#l14.137"></a><span id="l14.137">             dialog.click(iframeLookup(`</span>
<a href="#l14.138"></a><span id="l14.138">                 ${innerFrame}/id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/</span>
<a href="#l14.139"></a><span id="l14.139">                 {&quot;label&quot;:&quot;${data.attachment.delete}&quot;}</span>
<a href="#l14.140"></a><span id="l14.140">             `));</span>
<a href="#l14.141"></a><span id="l14.141">             dialog.keypress(iframeId(&quot;attachment-link&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l14.142"></a><span id="l14.142">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">deleted file mode 100755</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/test-timezone-utils.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ /dev/null</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -1,128 +0,0 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineminus">-</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineminus">-var MODULE_NAME = &quot;timezone-utils&quot;;</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineminus">-var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-var DATES = [</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-    [2009, 1, 1], [2009, 4, 2], [2009, 4, 16], [2009, 4, 30],</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-    [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-];</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">-</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">-var TIMEZONES = [</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-    &quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-    &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-];</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">-</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">-var helpersForController, goToDate, viewForward, viewBack, findEventsInNode;</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-function setupModule() {</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-    ({ helpersForController, goToDate, viewForward, viewBack, findEventsInNode } =</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-}</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-function installInto(module) {</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-    // copy constants into module</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-    module.DATES = DATES;</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-    module.TIMEZONES = TIMEZONES;</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-    // Now copy helper functions</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-    module.switchAppTimezone = switchAppTimezone;</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-    module.verify = verify;</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-}</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">-</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-function switchAppTimezone(timezone) {</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineminus">-    // change directly as Mac has different Lookup &amp; XPath than Windows &amp; Linux, bug 536605</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-    Preferences.set(&quot;calendar.timezone.local&quot;, timezone);</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-}</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineminus">-</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">-function verify(controller, dates, timezones, times) {</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-    function* datetimes() {</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-        for (let idx = 0; idx &lt; dates.length; idx++) {</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-            yield [dates[idx][0], dates[idx][1], dates[idx][2], times[idx]];</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-        }</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-    }</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineminus">-</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineminus">-    let { lookup } = helpersForController(controller);</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-    let dayView = `</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineminus">-        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineminus">-        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-        id(&quot;day-view&quot;)</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineminus">-    `;</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-    let dayStack = `</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-    `;</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-    let timeLine = `</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;timebar&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-    `;</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-    let allowedDifference = 3;</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineminus">-    /* Event box' time can't be deduced from it's position in                    ----------------</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineminus">-       xul element tree because for each event a box is laid over whole day and  |___spacer_____|</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineminus">-       a spacer is added to push the event to it's correct location.             |__event_box___|</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-       But timeline can be used to retrieve the position of a particular hour    |day continues |</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineminus">-       on screen and it can be compared against the position of the event.       ----------------</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineminus">-    */</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineminus">-</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineminus">-    for (let [selectedYear, selectedMonth, selectedDay, selectedTime] of datetimes()) {</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineminus">-        goToDate(controller, selectedYear, selectedMonth, selectedDay);</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineminus">-</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineminus">-        // find event with timezone tz</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineminus">-        for (let tzIdx = 0; tzIdx &lt; timezones.length; tzIdx++) {</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineminus">-            let [correctHour, minutes, day] = selectedTime[tzIdx];</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-            let found = false;</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-            let timeNode = lookup(`${timeLine}/[${correctHour}]`).getNode();</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineminus">-            let timeY = timeNode.boxObject.y + timeNode.boxObject.height * (minutes / 60);</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineminus">-</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineminus">-            let stackNode;</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineminus">-            let eventNodes = [];</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineminus">-</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineminus">-            // same day</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineminus">-            if (day == undefined) {</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineminus">-                stackNode = lookup(dayStack).getNode();</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineminus">-            }</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineminus">-</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineminus">-            // following day</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-            if (day != undefined &amp;&amp; day == 1) {</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineminus">-                viewForward(controller, 1);</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineminus">-                stackNode = lookup(dayStack).getNode();</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-            }</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineminus">-</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineminus">-            // previous day</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineminus">-            if (day != undefined &amp;&amp; day == -1) {</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineminus">-                viewBack(controller, 1);</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineminus">-                stackNode = lookup(dayStack).getNode();</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineminus">-            }</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineminus">-</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineminus">-            findEventsInNode(stackNode, eventNodes);</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineminus">-</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineminus">-            for (let node of eventNodes) {</span>
<a href="#l15.115"></a><span id="l15.115" class="difflineminus">-                if (Math.abs(timeY - node.boxObject.y) &lt; allowedDifference &amp;&amp;</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineminus">-                    timezones[tzIdx] == node.mOccurrence.title) {</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineminus">-                    found = true;</span>
<a href="#l15.118"></a><span id="l15.118" class="difflineminus">-                    break;</span>
<a href="#l15.119"></a><span id="l15.119" class="difflineminus">-                }</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineminus">-            }</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineminus">-</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineminus">-            if (day != undefined &amp;&amp; day == 1) {</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineminus">-                viewBack(controller, 1);</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineminus">-            }</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineminus">-</span>
<a href="#l15.126"></a><span id="l15.126" class="difflineminus">-            if (day != undefined &amp;&amp; day == -1) {</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineminus">-                viewForward(controller, 1);</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineminus">-            }</span>
<a href="#l15.129"></a><span id="l15.129" class="difflineminus">-            controller.assertJS(found);</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineminus">-        }</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineminus">-    }</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/test/mozmill/testAlarmDefaultValue.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/test/mozmill/testAlarmDefaultValue.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -64,17 +64,17 @@ function testDefaultAlarms() {</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5">     // Create New Task</span>
<a href="#l16.6"></a><span id="l16.6">     controller.click(eid(&quot;newMsgButton-task-menuitem&quot;));</span>
<a href="#l16.7"></a><span id="l16.7">     invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l16.8"></a><span id="l16.8">         let { xpath: taskpath, eid: taskid } = helpersForController(task);</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10">         // Check if the &quot;custom&quot; item was selected</span>
<a href="#l16.11"></a><span id="l16.11">         task.assertDOMProperty(taskid(&quot;item-alarm&quot;), &quot;value&quot;, &quot;custom&quot;);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        reminderDetailsVisible = taskpath(`</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+        let reminderDetailsVisible = taskpath(`</span>
<a href="#l16.14"></a><span id="l16.14">             //*[@id=&quot;reminder-details&quot;]/</span>
<a href="#l16.15"></a><span id="l16.15">             *[local-name()=&quot;label&quot; and (not(@hidden) or @hidden=&quot;false&quot;)]</span>
<a href="#l16.16"></a><span id="l16.16">         `);</span>
<a href="#l16.17"></a><span id="l16.17">         task.assertDOMProperty(reminderDetailsVisible, &quot;value&quot;, expectedTaskReminder);</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">         // Close the task dialog</span>
<a href="#l16.20"></a><span id="l16.20">         task.window.close();</span>
<a href="#l16.21"></a><span id="l16.21">     });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">rename from calendar/test/mozmill/timezoneTests/test2.js</span>
<a href="#l17.2"></a><span id="l17.2">rename to calendar/test/mozmill/testTimezones.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test2.js</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineplus">+++ b/calendar/test/mozmill/testTimezones.js</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineat">@@ -1,89 +1,339 @@</span>
<a href="#l17.6"></a><span id="l17.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l17.7"></a><span id="l17.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l17.8"></a><span id="l17.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10" class="difflineminus">-var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+var MODULE_NAME = &quot;testTimezones&quot;;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+var RELATIVE_ROOT = &quot;./shared-modules&quot;;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l17.15"></a><span id="l17.15"> </span>
<a href="#l17.16"></a><span id="l17.16"> var helpersForController, invokeEventDialog, switchToView, goToDate, setData;</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-var CANVAS_BOX;</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-var switchAppTimezone, TIMEZONES;</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+var findEventsInNode, viewForward, viewBack, CANVAS_BOX, TIMEOUT_MODAL_DIALOG;</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l17.21"></a><span id="l17.21"> </span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+var DATES = [</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+    [2009, 1, 1], [2009, 4, 2], [2009, 4, 16], [2009, 4, 30],</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+    [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+];</span>
<a href="#l17.27"></a><span id="l17.27"> </span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">-var times = [[4, 30], [4, 30], [3, 0], [3, 0], [9, 0], [14, 0], [19, 45], [1, 30]];</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+var TIMEZONES = [</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+    &quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+    &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+];</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l17.35"></a><span id="l17.35"> </span>
<a href="#l17.36"></a><span id="l17.36"> function setupModule(module) {</span>
<a href="#l17.37"></a><span id="l17.37">     controller = mozmill.getMail3PaneController();</span>
<a href="#l17.38"></a><span id="l17.38">     ({</span>
<a href="#l17.39"></a><span id="l17.39">         helpersForController,</span>
<a href="#l17.40"></a><span id="l17.40">         invokeEventDialog,</span>
<a href="#l17.41"></a><span id="l17.41">         switchToView,</span>
<a href="#l17.42"></a><span id="l17.42">         goToDate,</span>
<a href="#l17.43"></a><span id="l17.43">         setData,</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-        CANVAS_BOX</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+        findEventsInNode,</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+        viewForward,</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+        viewBack,</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+        TIMEOUT_MODAL_DIALOG</span>
<a href="#l17.50"></a><span id="l17.50">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l17.51"></a><span id="l17.51">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l17.52"></a><span id="l17.52">     Object.assign(module, helpersForController(controller));</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineminus">-    ({ switchAppTimezone, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineminus">-    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+    ({ plan_for_modal_dialog, wait_for_modal_dialog } = collector.getModule(&quot;window-helpers&quot;));</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+}</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+function testTimezones1_SetGMT() {</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Europe/London&quot;);</span>
<a href="#l17.61"></a><span id="l17.61"> }</span>
<a href="#l17.62"></a><span id="l17.62"> </span>
<a href="#l17.63"></a><span id="l17.63"> function testTimezones2_CreateEvents() {</span>
<a href="#l17.64"></a><span id="l17.64">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l17.65"></a><span id="l17.65">     switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.66"></a><span id="l17.66">     goToDate(controller, 2009, 1, 1);</span>
<a href="#l17.67"></a><span id="l17.67"> </span>
<a href="#l17.68"></a><span id="l17.68" class="difflineminus">-    // create daily recurring events in all TIMEZONES</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+    // create weekly recurring events in all TIMEZONES</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+    let times = [[4, 30], [4, 30], [3, 0], [3, 0], [9, 0], [14, 0], [19, 45], [1, 30]];</span>
<a href="#l17.71"></a><span id="l17.71">     let time = new Date();</span>
<a href="#l17.72"></a><span id="l17.72">     for (let i = 0; i &lt; TIMEZONES.length; i++) {</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineminus">-        let eventBox = lookupEventBox(controller, &quot;day&quot;, CANVAS_BOX, null, 1, i + 8);</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineplus">+        let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, i + 8);</span>
<a href="#l17.75"></a><span id="l17.75">         invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l17.76"></a><span id="l17.76">             time.setHours(times[i][0]);</span>
<a href="#l17.77"></a><span id="l17.77">             time.setMinutes(times[i][1]);</span>
<a href="#l17.78"></a><span id="l17.78"> </span>
<a href="#l17.79"></a><span id="l17.79">             // set timezone</span>
<a href="#l17.80"></a><span id="l17.80">             setTimezone(event, TIMEZONES[i]);</span>
<a href="#l17.81"></a><span id="l17.81"> </span>
<a href="#l17.82"></a><span id="l17.82">             // set title and repeat</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineminus">-            setData(event, { title: TIMEZONES[i], repeat: &quot;weekly&quot;, starttime: time });</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+            setData(event, iframe, { title: TIMEZONES[i], repeat: &quot;weekly&quot;, starttime: time });</span>
<a href="#l17.85"></a><span id="l17.85"> </span>
<a href="#l17.86"></a><span id="l17.86">             // save</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+            let { eid: eventid } = helpersForController(event);</span>
<a href="#l17.88"></a><span id="l17.88">             event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l17.89"></a><span id="l17.89">         });</span>
<a href="#l17.90"></a><span id="l17.90">     }</span>
<a href="#l17.91"></a><span id="l17.91"> }</span>
<a href="#l17.92"></a><span id="l17.92"> </span>
<a href="#l17.93"></a><span id="l17.93" class="difflineplus">+function testTimezones3_checkStJohns() {</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;America/St_Johns&quot;);</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineplus">+    let times = [</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineplus">+        [[4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30], [11, 30]],</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineplus">+        [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [12, 30]],</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineplus">+        [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineplus">+        [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineplus">+        [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineplus">+        [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [12, 30]],</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineplus">+        [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [10, 30], [11, 30], [12, 30]],</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineplus">+        [[4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30], [11, 30]]</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineplus">+    ];</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineplus">+</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineplus">+}</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineplus">+</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineplus">+function testTimezones4_checkCaracas() {</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;America/Caracas&quot;);</span>
<a href="#l17.114"></a><span id="l17.114" class="difflineplus">+    // This is actually incorrect. Venezuela shifted clocks forward 30 minutes</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineplus">+    // in 2016, but our code doesn't handle historical timezones.</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineplus">+    let times = [</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineplus">+        [[4, 0], [5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0]],</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineplus">+        [[3, 0], [5, 0], [6, 0], [6, 0], [8, 0], [8, 0], [10, 0], [11, 0]],</span>
<a href="#l17.119"></a><span id="l17.119" class="difflineplus">+        [[3, 0], [5, 0], [6, 0], [6, 0], [8, 0], [8, 0], [10, 0], [12, 0]],</span>
<a href="#l17.120"></a><span id="l17.120" class="difflineplus">+        [[3, 0], [5, 0], [6, 0], [6, 0], [8, 0], [8, 0], [10, 0], [12, 0]],</span>
<a href="#l17.121"></a><span id="l17.121" class="difflineplus">+        [[3, 0], [5, 0], [6, 0], [6, 0], [8, 0], [8, 0], [10, 0], [12, 0]],</span>
<a href="#l17.122"></a><span id="l17.122" class="difflineplus">+        [[3, 0], [5, 0], [6, 0], [6, 0], [8, 0], [8, 0], [10, 0], [11, 0]],</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineplus">+        [[3, 0], [5, 0], [6, 0], [6, 0], [8, 0], [9, 0], [10, 0], [11, 0]],</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineplus">+        [[4, 0], [5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0]]</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineplus">+    ];</span>
<a href="#l17.126"></a><span id="l17.126" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineplus">+</span>
<a href="#l17.130"></a><span id="l17.130" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineplus">+}</span>
<a href="#l17.132"></a><span id="l17.132" class="difflineplus">+</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineplus">+function testTimezones5_checkPhoenix() {</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;America/Phoenix&quot;);</span>
<a href="#l17.135"></a><span id="l17.135" class="difflineplus">+    let times = [</span>
<a href="#l17.136"></a><span id="l17.136" class="difflineplus">+        [[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l17.137"></a><span id="l17.137" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l17.138"></a><span id="l17.138" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l17.139"></a><span id="l17.139" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l17.140"></a><span id="l17.140" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l17.141"></a><span id="l17.141" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l17.142"></a><span id="l17.142" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l17.143"></a><span id="l17.143" class="difflineplus">+        [[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]]</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineplus">+    ];</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineplus">+</span>
<a href="#l17.149"></a><span id="l17.149" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l17.150"></a><span id="l17.150" class="difflineplus">+}</span>
<a href="#l17.151"></a><span id="l17.151" class="difflineplus">+</span>
<a href="#l17.152"></a><span id="l17.152" class="difflineplus">+function testTimezones6_checkLosAngeles() {</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;America/Los_Angeles&quot;);</span>
<a href="#l17.154"></a><span id="l17.154" class="difflineplus">+    let times = [</span>
<a href="#l17.155"></a><span id="l17.155" class="difflineplus">+        [[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]],</span>
<a href="#l17.156"></a><span id="l17.156" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l17.157"></a><span id="l17.157" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l17.158"></a><span id="l17.158" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l17.160"></a><span id="l17.160" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l17.161"></a><span id="l17.161" class="difflineplus">+        [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l17.162"></a><span id="l17.162" class="difflineplus">+        [[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]]</span>
<a href="#l17.163"></a><span id="l17.163" class="difflineplus">+    ];</span>
<a href="#l17.164"></a><span id="l17.164" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l17.165"></a><span id="l17.165" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.166"></a><span id="l17.166" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l17.167"></a><span id="l17.167" class="difflineplus">+</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l17.169"></a><span id="l17.169" class="difflineplus">+}</span>
<a href="#l17.170"></a><span id="l17.170" class="difflineplus">+</span>
<a href="#l17.171"></a><span id="l17.171" class="difflineplus">+function testTimezones7_checkBuenosAires() {</span>
<a href="#l17.172"></a><span id="l17.172" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;America/Argentina/Buenos_Aires&quot;);</span>
<a href="#l17.173"></a><span id="l17.173" class="difflineplus">+    let times = [</span>
<a href="#l17.174"></a><span id="l17.174" class="difflineplus">+        [[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l17.175"></a><span id="l17.175" class="difflineplus">+        [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [12, 0]],</span>
<a href="#l17.176"></a><span id="l17.176" class="difflineplus">+        [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l17.177"></a><span id="l17.177" class="difflineplus">+        [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l17.178"></a><span id="l17.178" class="difflineplus">+        [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l17.179"></a><span id="l17.179" class="difflineplus">+        [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [12, 0]],</span>
<a href="#l17.180"></a><span id="l17.180" class="difflineplus">+        [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineplus">+        [[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]]</span>
<a href="#l17.182"></a><span id="l17.182" class="difflineplus">+    ];</span>
<a href="#l17.183"></a><span id="l17.183" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l17.184"></a><span id="l17.184" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.185"></a><span id="l17.185" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l17.186"></a><span id="l17.186" class="difflineplus">+</span>
<a href="#l17.187"></a><span id="l17.187" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l17.188"></a><span id="l17.188" class="difflineplus">+}</span>
<a href="#l17.189"></a><span id="l17.189" class="difflineplus">+</span>
<a href="#l17.190"></a><span id="l17.190" class="difflineplus">+function testTimezones8_checkParis() {</span>
<a href="#l17.191"></a><span id="l17.191" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Europe/Paris&quot;);</span>
<a href="#l17.192"></a><span id="l17.192" class="difflineplus">+    let times = [</span>
<a href="#l17.193"></a><span id="l17.193" class="difflineplus">+        [[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l17.194"></a><span id="l17.194" class="difflineplus">+        [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l17.195"></a><span id="l17.195" class="difflineplus">+        [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l17.196"></a><span id="l17.196" class="difflineplus">+        [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l17.197"></a><span id="l17.197" class="difflineplus">+        [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l17.198"></a><span id="l17.198" class="difflineplus">+        [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l17.199"></a><span id="l17.199" class="difflineplus">+        [[8, 0], [10, 0], [11, 0], [11, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l17.200"></a><span id="l17.200" class="difflineplus">+        [[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]]</span>
<a href="#l17.201"></a><span id="l17.201" class="difflineplus">+    ];</span>
<a href="#l17.202"></a><span id="l17.202" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l17.203"></a><span id="l17.203" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.204"></a><span id="l17.204" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l17.205"></a><span id="l17.205" class="difflineplus">+</span>
<a href="#l17.206"></a><span id="l17.206" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l17.207"></a><span id="l17.207" class="difflineplus">+}</span>
<a href="#l17.208"></a><span id="l17.208" class="difflineplus">+</span>
<a href="#l17.209"></a><span id="l17.209" class="difflineplus">+function testTimezones9_checkKathmandu() {</span>
<a href="#l17.210"></a><span id="l17.210" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Asia/Kathmandu&quot;);</span>
<a href="#l17.211"></a><span id="l17.211" class="difflineplus">+    let times = [</span>
<a href="#l17.212"></a><span id="l17.212" class="difflineplus">+        [[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l17.213"></a><span id="l17.213" class="difflineplus">+        [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l17.214"></a><span id="l17.214" class="difflineplus">+        [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l17.215"></a><span id="l17.215" class="difflineplus">+        [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l17.216"></a><span id="l17.216" class="difflineplus">+        [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l17.217"></a><span id="l17.217" class="difflineplus">+        [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l17.218"></a><span id="l17.218" class="difflineplus">+        [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineplus">+        [[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]]</span>
<a href="#l17.220"></a><span id="l17.220" class="difflineplus">+    ];</span>
<a href="#l17.221"></a><span id="l17.221" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l17.222"></a><span id="l17.222" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.223"></a><span id="l17.223" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l17.224"></a><span id="l17.224" class="difflineplus">+</span>
<a href="#l17.225"></a><span id="l17.225" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l17.226"></a><span id="l17.226" class="difflineplus">+}</span>
<a href="#l17.227"></a><span id="l17.227" class="difflineplus">+</span>
<a href="#l17.228"></a><span id="l17.228" class="difflineplus">+function testTimezones10_checkAdelaide() {</span>
<a href="#l17.229"></a><span id="l17.229" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;Australia/Adelaide&quot;);</span>
<a href="#l17.230"></a><span id="l17.230" class="difflineplus">+    let times = [</span>
<a href="#l17.231"></a><span id="l17.231" class="difflineplus">+        [[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l17.232"></a><span id="l17.232" class="difflineplus">+        [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l17.233"></a><span id="l17.233" class="difflineplus">+        [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l17.234"></a><span id="l17.234" class="difflineplus">+        [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l17.235"></a><span id="l17.235" class="difflineplus">+        [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l17.236"></a><span id="l17.236" class="difflineplus">+        [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l17.237"></a><span id="l17.237" class="difflineplus">+        [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l17.238"></a><span id="l17.238" class="difflineplus">+        [[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]]</span>
<a href="#l17.239"></a><span id="l17.239" class="difflineplus">+    ];</span>
<a href="#l17.240"></a><span id="l17.240" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l17.241"></a><span id="l17.241" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.242"></a><span id="l17.242" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l17.243"></a><span id="l17.243" class="difflineplus">+</span>
<a href="#l17.244"></a><span id="l17.244" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l17.245"></a><span id="l17.245" class="difflineplus">+}</span>
<a href="#l17.246"></a><span id="l17.246" class="difflineplus">+</span>
<a href="#l17.247"></a><span id="l17.247"> function teardownTest(module) {</span>
<a href="#l17.248"></a><span id="l17.248" class="difflineminus">-    switchAppTimezone(TIMEZONES[0]);</span>
<a href="#l17.249"></a><span id="l17.249"> }</span>
<a href="#l17.250"></a><span id="l17.250"> </span>
<a href="#l17.251"></a><span id="l17.251"> function setTimezone(event, timezone) {</span>
<a href="#l17.252"></a><span id="l17.252">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l17.253"></a><span id="l17.253"> </span>
<a href="#l17.254"></a><span id="l17.254" class="difflineminus">-    // for some reason setting checked is needed, no other menuitem with checkbox needs it</span>
<a href="#l17.255"></a><span id="l17.255" class="difflineminus">-    let menuitem = eventid(&quot;options-TIMEZONES-menuitem&quot;);</span>
<a href="#l17.256"></a><span id="l17.256" class="difflineminus">-    event.waitForElement(menuitem);</span>
<a href="#l17.257"></a><span id="l17.257" class="difflineminus">-    menuitem.getNode().setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l17.258"></a><span id="l17.258" class="difflineminus">-    event.click(menuitem);</span>
<a href="#l17.259"></a><span id="l17.259" class="difflineplus">+    if (eventid(&quot;timezone-starttime&quot;).getNode().collapsed) {</span>
<a href="#l17.260"></a><span id="l17.260" class="difflineplus">+        let menuitem = eventid(&quot;options-timezones-menuitem&quot;);</span>
<a href="#l17.261"></a><span id="l17.261" class="difflineplus">+        event.click(menuitem);</span>
<a href="#l17.262"></a><span id="l17.262" class="difflineplus">+    }</span>
<a href="#l17.263"></a><span id="l17.263"> </span>
<a href="#l17.264"></a><span id="l17.264" class="difflineminus">-    let modal = new modalDialog.modalDialog(event.window);</span>
<a href="#l17.265"></a><span id="l17.265" class="difflineminus">-    modal.start(eventCallback.bind(null, timezone));</span>
<a href="#l17.266"></a><span id="l17.266" class="difflineplus">+    plan_for_modal_dialog(&quot;Calendar:EventDialog:Timezone&quot;, eventCallback.bind(null, timezone));</span>
<a href="#l17.267"></a><span id="l17.267">     event.waitForElement(eventid(&quot;timezone-starttime&quot;));</span>
<a href="#l17.268"></a><span id="l17.268">     event.click(eventid(&quot;timezone-starttime&quot;));</span>
<a href="#l17.269"></a><span id="l17.269" class="difflineplus">+    event.click(eventid(&quot;timezone-starttime&quot;));</span>
<a href="#l17.270"></a><span id="l17.270" class="difflineplus">+    event.waitForElement(eventid(&quot;timezone-custom-menuitem&quot;));</span>
<a href="#l17.271"></a><span id="l17.271" class="difflineplus">+    event.click(eventid(&quot;timezone-custom-menuitem&quot;));</span>
<a href="#l17.272"></a><span id="l17.272" class="difflineplus">+    wait_for_modal_dialog(&quot;Calendar:EventDialog:Timezone&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l17.273"></a><span id="l17.273"> }</span>
<a href="#l17.274"></a><span id="l17.274"> </span>
<a href="#l17.275"></a><span id="l17.275"> function eventCallback(zone, tzcontroller) {</span>
<a href="#l17.276"></a><span id="l17.276">     let { lookup: tzlookup, xpath: tzpath } = helpersForController(tzcontroller);</span>
<a href="#l17.277"></a><span id="l17.277"> </span>
<a href="#l17.278"></a><span id="l17.278">     let item = tzpath(`</span>
<a href="#l17.279"></a><span id="l17.279">         /*[name()='dialog']/*[name()='menulist'][1]/*[name()='menupopup'][1]/</span>
<a href="#l17.280"></a><span id="l17.280">         *[@value='${zone}']</span>
<a href="#l17.281"></a><span id="l17.281">     `);</span>
<a href="#l17.282"></a><span id="l17.282">     tzcontroller.waitForElement(item);</span>
<a href="#l17.283"></a><span id="l17.283">     tzcontroller.click(item);</span>
<a href="#l17.284"></a><span id="l17.284">     tzcontroller.click(tzlookup(`</span>
<a href="#l17.285"></a><span id="l17.285">         /id(&quot;calendar-event-dialog-timezone&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l17.286"></a><span id="l17.286">         {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l17.287"></a><span id="l17.287">     `));</span>
<a href="#l17.288"></a><span id="l17.288"> }</span>
<a href="#l17.289"></a><span id="l17.289" class="difflineplus">+</span>
<a href="#l17.290"></a><span id="l17.290" class="difflineplus">+function verify(controller, dates, timezones, times) {</span>
<a href="#l17.291"></a><span id="l17.291" class="difflineplus">+    function* datetimes() {</span>
<a href="#l17.292"></a><span id="l17.292" class="difflineplus">+        for (let idx = 0; idx &lt; dates.length; idx++) {</span>
<a href="#l17.293"></a><span id="l17.293" class="difflineplus">+            yield [dates[idx][0], dates[idx][1], dates[idx][2], times[idx]];</span>
<a href="#l17.294"></a><span id="l17.294" class="difflineplus">+        }</span>
<a href="#l17.295"></a><span id="l17.295" class="difflineplus">+    }</span>
<a href="#l17.296"></a><span id="l17.296" class="difflineplus">+</span>
<a href="#l17.297"></a><span id="l17.297" class="difflineplus">+    let { lookup } = helpersForController(controller);</span>
<a href="#l17.298"></a><span id="l17.298" class="difflineplus">+</span>
<a href="#l17.299"></a><span id="l17.299" class="difflineplus">+    let dayView = `</span>
<a href="#l17.300"></a><span id="l17.300" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l17.301"></a><span id="l17.301" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l17.302"></a><span id="l17.302" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l17.303"></a><span id="l17.303" class="difflineplus">+        id(&quot;day-view&quot;)</span>
<a href="#l17.304"></a><span id="l17.304" class="difflineplus">+    `;</span>
<a href="#l17.305"></a><span id="l17.305" class="difflineplus">+    let dayStack = `</span>
<a href="#l17.306"></a><span id="l17.306" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l17.307"></a><span id="l17.307" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l17.308"></a><span id="l17.308" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}</span>
<a href="#l17.309"></a><span id="l17.309" class="difflineplus">+    `;</span>
<a href="#l17.310"></a><span id="l17.310" class="difflineplus">+    let timeLine = `</span>
<a href="#l17.311"></a><span id="l17.311" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l17.312"></a><span id="l17.312" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;timebar&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})</span>
<a href="#l17.313"></a><span id="l17.313" class="difflineplus">+    `;</span>
<a href="#l17.314"></a><span id="l17.314" class="difflineplus">+    let allowedDifference = 3;</span>
<a href="#l17.315"></a><span id="l17.315" class="difflineplus">+</span>
<a href="#l17.316"></a><span id="l17.316" class="difflineplus">+    /* Event box' time can't be deduced from it's position in                    ----------------</span>
<a href="#l17.317"></a><span id="l17.317" class="difflineplus">+       xul element tree because for each event a box is laid over whole day and  |___spacer_____|</span>
<a href="#l17.318"></a><span id="l17.318" class="difflineplus">+       a spacer is added to push the event to it's correct location.             |__event_box___|</span>
<a href="#l17.319"></a><span id="l17.319" class="difflineplus">+       But timeline can be used to retrieve the position of a particular hour    |day continues |</span>
<a href="#l17.320"></a><span id="l17.320" class="difflineplus">+       on screen and it can be compared against the position of the event.       ----------------</span>
<a href="#l17.321"></a><span id="l17.321" class="difflineplus">+    */</span>
<a href="#l17.322"></a><span id="l17.322" class="difflineplus">+</span>
<a href="#l17.323"></a><span id="l17.323" class="difflineplus">+    for (let [selectedYear, selectedMonth, selectedDay, selectedTime] of datetimes()) {</span>
<a href="#l17.324"></a><span id="l17.324" class="difflineplus">+        goToDate(controller, selectedYear, selectedMonth, selectedDay);</span>
<a href="#l17.325"></a><span id="l17.325" class="difflineplus">+</span>
<a href="#l17.326"></a><span id="l17.326" class="difflineplus">+        // find event with timezone tz</span>
<a href="#l17.327"></a><span id="l17.327" class="difflineplus">+        for (let tzIdx = 0; tzIdx &lt; timezones.length; tzIdx++) {</span>
<a href="#l17.328"></a><span id="l17.328" class="difflineplus">+            let [correctHour, minutes, day] = selectedTime[tzIdx];</span>
<a href="#l17.329"></a><span id="l17.329" class="difflineplus">+</span>
<a href="#l17.330"></a><span id="l17.330" class="difflineplus">+            let timeNode = lookup(`${timeLine}/[${correctHour}]`).getNode();</span>
<a href="#l17.331"></a><span id="l17.331" class="difflineplus">+            let timeY = timeNode.boxObject.y + timeNode.boxObject.height * (minutes / 60);</span>
<a href="#l17.332"></a><span id="l17.332" class="difflineplus">+</span>
<a href="#l17.333"></a><span id="l17.333" class="difflineplus">+            let eventNodes = [];</span>
<a href="#l17.334"></a><span id="l17.334" class="difflineplus">+</span>
<a href="#l17.335"></a><span id="l17.335" class="difflineplus">+            // following day</span>
<a href="#l17.336"></a><span id="l17.336" class="difflineplus">+            if (day == 1) {</span>
<a href="#l17.337"></a><span id="l17.337" class="difflineplus">+                viewForward(controller, 1);</span>
<a href="#l17.338"></a><span id="l17.338" class="difflineplus">+            } else if (day == -1) {</span>
<a href="#l17.339"></a><span id="l17.339" class="difflineplus">+                viewBack(controller, 1);</span>
<a href="#l17.340"></a><span id="l17.340" class="difflineplus">+            }</span>
<a href="#l17.341"></a><span id="l17.341" class="difflineplus">+</span>
<a href="#l17.342"></a><span id="l17.342" class="difflineplus">+            let stackNode = lookup(dayStack);</span>
<a href="#l17.343"></a><span id="l17.343" class="difflineplus">+            controller.waitForElement(stackNode);</span>
<a href="#l17.344"></a><span id="l17.344" class="difflineplus">+            stackNode = stackNode.getNode();</span>
<a href="#l17.345"></a><span id="l17.345" class="difflineplus">+</span>
<a href="#l17.346"></a><span id="l17.346" class="difflineplus">+            findEventsInNode(stackNode, eventNodes);</span>
<a href="#l17.347"></a><span id="l17.347" class="difflineplus">+            eventNodes = eventNodes.filter(node =&gt; node.mOccurrence.title == timezones[tzIdx])</span>
<a href="#l17.348"></a><span id="l17.348" class="difflineplus">+                                   .map(node =&gt; node.boxObject.y);</span>
<a href="#l17.349"></a><span id="l17.349" class="difflineplus">+</span>
<a href="#l17.350"></a><span id="l17.350" class="difflineplus">+            dump(`Looking for ${timezones[tzIdx]} at ${timeY}: found `);</span>
<a href="#l17.351"></a><span id="l17.351" class="difflineplus">+            dump(eventNodes.join(&quot;, &quot;) + &quot;\n&quot;);</span>
<a href="#l17.352"></a><span id="l17.352" class="difflineplus">+</span>
<a href="#l17.353"></a><span id="l17.353" class="difflineplus">+            if (day != undefined &amp;&amp; day == 1) {</span>
<a href="#l17.354"></a><span id="l17.354" class="difflineplus">+                viewBack(controller, 1);</span>
<a href="#l17.355"></a><span id="l17.355" class="difflineplus">+            }</span>
<a href="#l17.356"></a><span id="l17.356" class="difflineplus">+</span>
<a href="#l17.357"></a><span id="l17.357" class="difflineplus">+            if (day != undefined &amp;&amp; day == -1) {</span>
<a href="#l17.358"></a><span id="l17.358" class="difflineplus">+                viewForward(controller, 1);</span>
<a href="#l17.359"></a><span id="l17.359" class="difflineplus">+            }</span>
<a href="#l17.360"></a><span id="l17.360" class="difflineplus">+</span>
<a href="#l17.361"></a><span id="l17.361" class="difflineplus">+            controller.assertJS(() =&gt; eventNodes.some(node =&gt; Math.abs(timeY - node) &lt; allowedDifference));</span>
<a href="#l17.362"></a><span id="l17.362" class="difflineplus">+        }</span>
<a href="#l17.363"></a><span id="l17.363" class="difflineplus">+    }</span>
<a href="#l17.364"></a><span id="l17.364" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">deleted file mode 100755</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test1.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ /dev/null</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -1,22 +0,0 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineminus">-</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineminus">-var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineminus">-</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-var createCalendar, CALENDARNAME;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-var switchAppTimezone;</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-function setupModule(module) {</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">-    ({ createCalendar, CALENDARNAME } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">-    ({ switchAppTimezone } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineminus">-    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">-    createCalendar(controller, CALENDARNAME);</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineminus">-}</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">-</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-function testTimezones1_SetGMT() {</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-    switchAppTimezone(&quot;Europe/London&quot;);</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">deleted file mode 100755</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test10.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ /dev/null</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -1,48 +0,0 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineminus">-</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineminus">-var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineminus">-</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-var helpersForController, switchToView, goToDate, deleteCalendars, CALENDARNAME;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-var verify, DATES, TIMEZONES;</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-var { preferences } = require(&quot;../shared-modules/prefs&quot;);</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">-/* rows - dates</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">-   columns - correct time for each event */</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-var times = [</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">-    [[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineminus">-    [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineminus">-    [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">-    [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineminus">-    [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineminus">-    [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineminus">-    [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineminus">-    [[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]]</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineminus">-];</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineminus">-</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-function setupModule(module) {</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">-    ({ helpersForController, switchToView, goToDate, deleteCalendars, CALENDARNAME } =</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineminus">-        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">-    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineminus">-    Object.assign(module, helpersForController(controller));</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineminus">-</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineminus">-    ({ verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineminus">-    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineminus">-}</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineminus">-</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">-function testTimezones10_checkAdelaide() {</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineminus">-    switchToView(controller, &quot;day&quot;);</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineminus">-    goToDate(controller, 2009, 1, 1);</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineminus">-</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineminus">-    verify(controller, dates, DATES, TIMEZONES, times);</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineminus">-}</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineminus">-</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineminus">-function teardownTest(module) {</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineminus">-    preferences.clearUserPref(&quot;calendar.timezone.local&quot;);</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineminus">-    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">deleted file mode 100755</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test3.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ /dev/null</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -1,47 +0,0 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineminus">-</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineminus">-var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l20.10"></a><span id="l20.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l20.11"></a><span id="l20.11" class="difflineminus">-</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-var helpersForController, switchToView, goToDate;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-/* rows - dates</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-   columns - correct time for each event */</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-var times = [</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">-    [[4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30], [11, 30]],</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">-    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [12, 30]],</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">-    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">-    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineminus">-    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineminus">-    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [12, 30]],</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">-    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [10, 30], [11, 30], [12, 30]],</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineminus">-    [[4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30], [11, 30]]</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineminus">-];</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineminus">-</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineminus">-function setupModule(module) {</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">-</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-    Object.assign(module, helpersForController(controller));</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-    ({ switchAppTimezone, verify, DATES, TIMEZONES } =</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-        collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineminus">-    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-}</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">-</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineminus">-function testTimezones3_checkStJohns() {</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineminus">-    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineminus">-    switchToView(controller, &quot;day&quot;);</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-    goToDate(controller, 2009, 1, 1);</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineminus">-</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineminus">-    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineminus">-}</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineminus">-</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineminus">-function teardownTest(module) {</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-    switchAppTimezone(TIMEZONES[1]);</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">deleted file mode 100755</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test4.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineplus">+++ /dev/null</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineat">@@ -1,46 +0,0 @@</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineminus">-</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineminus">-var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineminus">-</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-var helpersForController, switchToView, goToDate;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-/* rows - dates</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-   columns - correct time for each event */</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">-var times = [</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineminus">-    [[3, 30], [4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30]],</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineminus">-    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [10, 30]],</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineminus">-    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineminus">-    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineminus">-    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineminus">-    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [10, 30]],</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineminus">-    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [8, 30], [9, 30], [10, 30]],</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineminus">-    [[3, 30], [4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30]]</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">-];</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineminus">-</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineminus">-function setupModule(module) {</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-    Object.assign(module, helpersForController(controller));</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineminus">-</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineminus">-    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">-}</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineminus">-</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineminus">-function testTimezones4_checkCaracas() {</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineminus">-    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineminus">-    switchToView(controller, &quot;day&quot;);</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineminus">-    goToDate(controller, 2009, 1, 1);</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineminus">-</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineminus">-    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineminus">-}</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineminus">-</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-function teardownTest(module) {</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineminus">-    switchAppTimezone(TIMEZONES[2]);</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">deleted file mode 100755</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test5.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ /dev/null</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -1,44 +0,0 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineminus">-</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineminus">-var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l22.10"></a><span id="l22.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineminus">-</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-var helpersForController, switchToView, goToDate;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-/* rows - dates</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-   columns - correct time for each event */</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-var times = [</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-    [[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineminus">-    [[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]]</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineminus">-];</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineminus">-</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineminus">-function setupModule(module) {</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineminus">-    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">-    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineminus">-    Object.assign(module, helpersForController(controller));</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineminus">-    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineminus">-    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineminus">-}</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineminus">-</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineminus">-function testTimezones5_checkPhoenix() {</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineminus">-    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineminus">-    switchToView(controller, &quot;day&quot;);</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineminus">-    goToDate(controller, 2009, 1, 1);</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineminus">-</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineminus">-    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineminus">-}</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineminus">-</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineminus">-function teardownTest(module) {</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineminus">-    switchAppTimezone(TIMEZONES[3]);</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">deleted file mode 100755</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test6.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineplus">+++ /dev/null</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineat">@@ -1,44 +0,0 @@</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l23.6"></a><span id="l23.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l23.8"></a><span id="l23.8" class="difflineminus">-</span>
<a href="#l23.9"></a><span id="l23.9" class="difflineminus">-var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l23.11"></a><span id="l23.11" class="difflineminus">-</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-var helpersForController, switchToView, goToDate;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-/* rows - dates</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineminus">-   columns - correct time for each event */</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineminus">-var times = [</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineminus">-    [[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]],</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">-    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineminus">-    [[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]]</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineminus">-];</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineminus">-</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineminus">-function setupModule(module) {</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineminus">-    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineminus">-    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineminus">-    Object.assign(module, helpersForController(controller));</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineminus">-    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineminus">-    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineminus">-}</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineminus">-</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineminus">-function testTimezones6_checkLosAngeles() {</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineminus">-    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineminus">-    switchToView(controller, &quot;day&quot;);</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineminus">-    goToDate(controller, 2009, 1, 1);</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineminus">-</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineminus">-    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineminus">-}</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineminus">-</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineminus">-function teardownTest(module) {</span>
<a href="#l23.47"></a><span id="l23.47" class="difflineminus">-    switchAppTimezone(TIMEZONES[4]);</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">deleted file mode 100755</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test7.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ /dev/null</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -1,44 +0,0 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineminus">-</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineminus">-var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineminus">-</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-var helpersForController, switchToView, goToDate;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-/* rows - dates</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">-   columns - correct time for each event */</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">-var times = [</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-    [[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">-    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [12, 0]],</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineminus">-    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineminus">-    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineminus">-    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [12, 0]],</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineminus">-    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineminus">-    [[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]]</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">-];</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">-function setupModule(module) {</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">-    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineminus">-    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-    Object.assign(module, helpersForController(controller));</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-}</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">-function testTimezones7_checkBuenosAires() {</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">-    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">-    switchToView(controller, &quot;day&quot;);</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">-    goToDate(controller, 2009, 1, 1);</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">-</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineminus">-}</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineminus">-</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineminus">-function teardownTest(module) {</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineminus">-    switchAppTimezone(TIMEZONES[5]);</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1">deleted file mode 100755</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test8.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineplus">+++ /dev/null</span>
<a href="#l25.4"></a><span id="l25.4" class="difflineat">@@ -1,44 +0,0 @@</span>
<a href="#l25.5"></a><span id="l25.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l25.6"></a><span id="l25.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l25.7"></a><span id="l25.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l25.8"></a><span id="l25.8" class="difflineminus">-</span>
<a href="#l25.9"></a><span id="l25.9" class="difflineminus">-var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l25.10"></a><span id="l25.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l25.11"></a><span id="l25.11" class="difflineminus">-</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-var helpersForController, switchToView, goToDate;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-/* rows - dates</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineminus">-   columns - correct time for each event */</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineminus">-var times = [</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineminus">-    [[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineminus">-    [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineminus">-    [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineminus">-    [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineminus">-    [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineminus">-    [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineminus">-    [[8, 0], [10, 0], [11, 0], [11, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineminus">-    [[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]]</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineminus">-];</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineminus">-</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineminus">-function setupModule(module) {</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineminus">-    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">-    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineminus">-    Object.assign(module, helpersForController(controller));</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineminus">-    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineminus">-    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineminus">-}</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineminus">-</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineminus">-function testTimezones8_checkParis() {</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineminus">-    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineminus">-    switchToView(controller, &quot;day&quot;);</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineminus">-    goToDate(controller, 2009, 1, 1);</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineminus">-</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineminus">-    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineminus">-}</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineminus">-</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineminus">-function teardownTest(module) {</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineminus">-    switchAppTimezone(TIMEZONES[6]);</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1">deleted file mode 100755</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test9.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineplus">+++ /dev/null</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineat">@@ -1,44 +0,0 @@</span>
<a href="#l26.5"></a><span id="l26.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l26.6"></a><span id="l26.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l26.7"></a><span id="l26.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l26.8"></a><span id="l26.8" class="difflineminus">-</span>
<a href="#l26.9"></a><span id="l26.9" class="difflineminus">-var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l26.10"></a><span id="l26.10" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineminus">-</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-var helpersForController, switchToView, goToDate;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">-/* rows - dates</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineminus">-   columns - correct time for each event */</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineminus">-var times = [</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineminus">-    [[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineminus">-    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineminus">-    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineminus">-    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineminus">-    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineminus">-    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineminus">-    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineminus">-    [[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]]</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineminus">-];</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineminus">-</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineminus">-function setupModule(module) {</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">-    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">-    Object.assign(module, helpersForController(controller));</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineminus">-    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">-    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineminus">-}</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineminus">-</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineminus">-function testTimezones9_checkKathmandu() {</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineminus">-    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineminus">-    switchToView(controller, &quot;day&quot;);</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineminus">-    goToDate(controller, 2009, 1, 1);</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineminus">-    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineminus">-}</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineminus">-</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineminus">-function teardownTest(module) {</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineminus">-    switchAppTimezone(TIMEZONES[7]);</span>
<a href="#l26.48"></a><span id="l26.48" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -3,188 +3,142 @@</span>
<a href="#l27.4"></a><span id="l27.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l27.7"></a><span id="l27.7"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l27.8"></a><span id="l27.8"> </span>
<a href="#l27.9"></a><span id="l27.9"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;, null);</span>
<a href="#l27.10"></a><span id="l27.10"> </span>
<a href="#l27.11"></a><span id="l27.11"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-var CALENDARNAME;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+var goToDate, setData, lookupEventBox;</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+var CALENDARNAME, CANVAS_BOX, EVENT_BOX;</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16"> var TITLE1 = &quot;Day View Event&quot;;</span>
<a href="#l27.17"></a><span id="l27.17"> var TITLE2 = &quot;Day View Event Changed&quot;;</span>
<a href="#l27.18"></a><span id="l27.18"> var DESC = &quot;Day View Event Description&quot;;</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20"> function setupModule(module) {</span>
<a href="#l27.21"></a><span id="l27.21">     controller = mozmill.getMail3PaneController();</span>
<a href="#l27.22"></a><span id="l27.22">     ({</span>
<a href="#l27.23"></a><span id="l27.23">         helpersForController,</span>
<a href="#l27.24"></a><span id="l27.24">         invokeEventDialog,</span>
<a href="#l27.25"></a><span id="l27.25">         createCalendar,</span>
<a href="#l27.26"></a><span id="l27.26">         deleteCalendars,</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineminus">-        CALENDARNAME</span>
<a href="#l27.28"></a><span id="l27.28" class="difflineplus">+        goToDate,</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineplus">+        setData,</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineplus">+        lookupEventBox,</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineplus">+        EVENT_BOX</span>
<a href="#l27.34"></a><span id="l27.34">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l27.35"></a><span id="l27.35">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l27.36"></a><span id="l27.36">     Object.assign(module, helpersForController(controller));</span>
<a href="#l27.37"></a><span id="l27.37"> </span>
<a href="#l27.38"></a><span id="l27.38">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l27.39"></a><span id="l27.39"> }</span>
<a href="#l27.40"></a><span id="l27.40"> </span>
<a href="#l27.41"></a><span id="l27.41"> function testDayView() {</span>
<a href="#l27.42"></a><span id="l27.42">     let dateFormatter = cal.getDateFormatter();</span>
<a href="#l27.43"></a><span id="l27.43">     // paths</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineminus">-    let miniMonth = `</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineminus">-        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l27.46"></a><span id="l27.46" class="difflineminus">-        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineminus">-        id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineminus">-        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)</span>
<a href="#l27.49"></a><span id="l27.49" class="difflineminus">-    `;</span>
<a href="#l27.50"></a><span id="l27.50">     let dayView = `</span>
<a href="#l27.51"></a><span id="l27.51">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l27.52"></a><span id="l27.52">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l27.53"></a><span id="l27.53">         id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l27.54"></a><span id="l27.54">         id(&quot;day-view&quot;)</span>
<a href="#l27.55"></a><span id="l27.55">     `;</span>
<a href="#l27.56"></a><span id="l27.56" class="difflineminus">-    let day = lookup(`</span>
<a href="#l27.57"></a><span id="l27.57" class="difflineminus">-        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/</span>
<a href="#l27.58"></a><span id="l27.58" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/{&quot;flex&quot;:&quot;1&quot;}</span>
<a href="#l27.59"></a><span id="l27.59" class="difflineminus">-    `);</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineminus">-    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l27.61"></a><span id="l27.61"> </span>
<a href="#l27.62"></a><span id="l27.62">     // open day view</span>
<a href="#l27.63"></a><span id="l27.63">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l27.64"></a><span id="l27.64">     controller.waitThenClick(eid(&quot;calendar-day-view-button&quot;));</span>
<a href="#l27.65"></a><span id="l27.65"> </span>
<a href="#l27.66"></a><span id="l27.66" class="difflineminus">-    // pick year</span>
<a href="#l27.67"></a><span id="l27.67" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l27.68"></a><span id="l27.68" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l27.69"></a><span id="l27.69" class="difflineminus">-    `));</span>
<a href="#l27.70"></a><span id="l27.70" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l27.71"></a><span id="l27.71" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l27.72"></a><span id="l27.72" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/</span>
<a href="#l27.73"></a><span id="l27.73" class="difflineminus">-        {&quot;value&quot;:&quot;2009&quot;}</span>
<a href="#l27.74"></a><span id="l27.74" class="difflineminus">-    `));</span>
<a href="#l27.75"></a><span id="l27.75" class="difflineminus">-</span>
<a href="#l27.76"></a><span id="l27.76" class="difflineminus">-    // pick month</span>
<a href="#l27.77"></a><span id="l27.77" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l27.78"></a><span id="l27.78" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineminus">-    `));</span>
<a href="#l27.81"></a><span id="l27.81" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l27.83"></a><span id="l27.83" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/</span>
<a href="#l27.84"></a><span id="l27.84" class="difflineminus">-        {&quot;index&quot;:&quot;0&quot;}</span>
<a href="#l27.85"></a><span id="l27.85" class="difflineminus">-    `));</span>
<a href="#l27.86"></a><span id="l27.86" class="difflineminus">-</span>
<a href="#l27.87"></a><span id="l27.87" class="difflineminus">-    // pick day</span>
<a href="#l27.88"></a><span id="l27.88" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l27.89"></a><span id="l27.89" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}</span>
<a href="#l27.90"></a><span id="l27.90" class="difflineminus">-    `));</span>
<a href="#l27.91"></a><span id="l27.91" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l27.92"></a><span id="l27.92"> </span>
<a href="#l27.93"></a><span id="l27.93">     // verify date in view</span>
<a href="#l27.94"></a><span id="l27.94" class="difflineplus">+    let day = lookup(`</span>
<a href="#l27.95"></a><span id="l27.95" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/</span>
<a href="#l27.96"></a><span id="l27.96" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/{&quot;flex&quot;:&quot;1&quot;}</span>
<a href="#l27.97"></a><span id="l27.97" class="difflineplus">+    `);</span>
<a href="#l27.98"></a><span id="l27.98">     controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l27.99"></a><span id="l27.99"> </span>
<a href="#l27.100"></a><span id="l27.100">     // create event at 8 AM</span>
<a href="#l27.101"></a><span id="l27.101" class="difflineminus">-    let eventBox = lookup(`</span>
<a href="#l27.102"></a><span id="l27.102" class="difflineminus">-        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l27.103"></a><span id="l27.103" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l27.104"></a><span id="l27.104" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]')</span>
<a href="#l27.105"></a><span id="l27.105" class="difflineminus">-    `);</span>
<a href="#l27.106"></a><span id="l27.106" class="difflineminus">-</span>
<a href="#l27.107"></a><span id="l27.107" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, 8);</span>
<a href="#l27.108"></a><span id="l27.108">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l27.109"></a><span id="l27.109" class="difflineminus">-        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l27.110"></a><span id="l27.110" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l27.111"></a><span id="l27.111" class="difflineplus">+        let { lookup: iframeLookup } = helpersForController(iframe);</span>
<a href="#l27.112"></a><span id="l27.112"> </span>
<a href="#l27.113"></a><span id="l27.113" class="difflineminus">-        // check that the start time is correct</span>
<a href="#l27.114"></a><span id="l27.114" class="difflineminus">-        let startTimeInput = eventlookup(`</span>
<a href="#l27.115"></a><span id="l27.115" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l27.116"></a><span id="l27.116" class="difflineminus">-            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l27.117"></a><span id="l27.117" class="difflineplus">+        let innerFrame = '/id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l27.118"></a><span id="l27.118" class="difflineplus">+        let dateInput = `</span>
<a href="#l27.119"></a><span id="l27.119" class="difflineplus">+            anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l27.120"></a><span id="l27.120" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l27.121"></a><span id="l27.121" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l27.122"></a><span id="l27.122" class="difflineplus">+        `;</span>
<a href="#l27.123"></a><span id="l27.123" class="difflineplus">+        let timeInput = `</span>
<a href="#l27.124"></a><span id="l27.124">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l27.125"></a><span id="l27.125">             anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l27.126"></a><span id="l27.126">             anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l27.127"></a><span id="l27.127" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l27.128"></a><span id="l27.128" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l27.129"></a><span id="l27.129" class="difflineplus">+        `;</span>
<a href="#l27.130"></a><span id="l27.130" class="difflineplus">+        let startId = &quot;event-starttime&quot;;</span>
<a href="#l27.131"></a><span id="l27.131" class="difflineplus">+</span>
<a href="#l27.132"></a><span id="l27.132" class="difflineplus">+        let startTimeInput = iframeLookup(`</span>
<a href="#l27.133"></a><span id="l27.133" class="difflineplus">+            ${innerFrame}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l27.134"></a><span id="l27.134" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;${startId}&quot;)/${timeInput}</span>
<a href="#l27.135"></a><span id="l27.135">         `);</span>
<a href="#l27.136"></a><span id="l27.136" class="difflineplus">+        let startDateInput = iframeLookup(`</span>
<a href="#l27.137"></a><span id="l27.137" class="difflineplus">+            ${innerFrame}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l27.138"></a><span id="l27.138" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;${startId}&quot;)/</span>
<a href="#l27.139"></a><span id="l27.139" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/${dateInput}</span>
<a href="#l27.140"></a><span id="l27.140" class="difflineplus">+        `);</span>
<a href="#l27.141"></a><span id="l27.141" class="difflineplus">+</span>
<a href="#l27.142"></a><span id="l27.142" class="difflineplus">+        // check that the start time is correct</span>
<a href="#l27.143"></a><span id="l27.143" class="difflineplus">+        let someDate = cal.createDateTime();</span>
<a href="#l27.144"></a><span id="l27.144" class="difflineplus">+        someDate.resetTo(2009, 0, 1, 8, 0, 0, cal.dtz.floating);</span>
<a href="#l27.145"></a><span id="l27.145">         event.waitForElement(startTimeInput);</span>
<a href="#l27.146"></a><span id="l27.146" class="difflineminus">-        event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l27.147"></a><span id="l27.147" class="difflineminus">-        let someTime = cal.createDateTime();</span>
<a href="#l27.148"></a><span id="l27.148" class="difflineminus">-        someTime.resetTo(2009, 1, 1);</span>
<a href="#l27.149"></a><span id="l27.149" class="difflineminus">-        let date = dateFormatter.formatDateShort(someDate);</span>
<a href="#l27.150"></a><span id="l27.150" class="difflineminus">-        event.assertValue(eventlookup(`</span>
<a href="#l27.151"></a><span id="l27.151" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l27.152"></a><span id="l27.152" class="difflineminus">-            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l27.153"></a><span id="l27.153" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l27.154"></a><span id="l27.154" class="difflineminus">-            anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l27.155"></a><span id="l27.155" class="difflineminus">-            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l27.156"></a><span id="l27.156" class="difflineminus">-            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l27.157"></a><span id="l27.157" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l27.158"></a><span id="l27.158" class="difflineminus">-        `), date);</span>
<a href="#l27.159"></a><span id="l27.159" class="difflineplus">+        event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l27.160"></a><span id="l27.160" class="difflineplus">+        event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l27.161"></a><span id="l27.161"> </span>
<a href="#l27.162"></a><span id="l27.162">         // fill in title, description and calendar</span>
<a href="#l27.163"></a><span id="l27.163" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l27.164"></a><span id="l27.164" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l27.165"></a><span id="l27.165" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l27.166"></a><span id="l27.166" class="difflineminus">-        `), TITLE1);</span>
<a href="#l27.167"></a><span id="l27.167" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l27.168"></a><span id="l27.168" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l27.169"></a><span id="l27.169" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l27.170"></a><span id="l27.170" class="difflineminus">-        `), DESC);</span>
<a href="#l27.171"></a><span id="l27.171" class="difflineminus">-        event.select(eventid(&quot;item-calendar&quot;), null, CALENDARNAME);</span>
<a href="#l27.172"></a><span id="l27.172" class="difflineplus">+        setData(event, iframe, { title: TITLE1, description: DESC, calendar: CALENDARNAME });</span>
<a href="#l27.173"></a><span id="l27.173"> </span>
<a href="#l27.174"></a><span id="l27.174">         // save</span>
<a href="#l27.175"></a><span id="l27.175">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l27.176"></a><span id="l27.176">     });</span>
<a href="#l27.177"></a><span id="l27.177"> </span>
<a href="#l27.178"></a><span id="l27.178">     // if it was created successfully, it can be opened</span>
<a href="#l27.179"></a><span id="l27.179" class="difflineminus">-    eventBox = lookup(`</span>
<a href="#l27.180"></a><span id="l27.180" class="difflineminus">-        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l27.181"></a><span id="l27.181" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l27.182"></a><span id="l27.182" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l27.183"></a><span id="l27.183" class="difflineminus">-        {&quot;flex&quot;:&quot;1&quot;}/[0]/</span>
<a href="#l27.184"></a><span id="l27.184" class="difflineminus">-        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}</span>
<a href="#l27.185"></a><span id="l27.185" class="difflineminus">-    `);</span>
<a href="#l27.186"></a><span id="l27.186" class="difflineplus">+    eventBox = lookupEventBox(</span>
<a href="#l27.187"></a><span id="l27.187" class="difflineplus">+        &quot;day&quot;, EVENT_BOX, null, 1, 8,</span>
<a href="#l27.188"></a><span id="l27.188" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l27.189"></a><span id="l27.189" class="difflineplus">+    );</span>
<a href="#l27.190"></a><span id="l27.190">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l27.191"></a><span id="l27.191" class="difflineminus">-        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l27.192"></a><span id="l27.192" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l27.193"></a><span id="l27.193"> </span>
<a href="#l27.194"></a><span id="l27.194">         // change title and save changes</span>
<a href="#l27.195"></a><span id="l27.195" class="difflineminus">-        let titleTextBox = eventlookup(`</span>
<a href="#l27.196"></a><span id="l27.196" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l27.197"></a><span id="l27.197" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l27.198"></a><span id="l27.198" class="difflineminus">-        `);</span>
<a href="#l27.199"></a><span id="l27.199" class="difflineminus">-        event.waitForElement(titleTextBox);</span>
<a href="#l27.200"></a><span id="l27.200" class="difflineminus">-        event.type(titleTextBox, TITLE2);</span>
<a href="#l27.201"></a><span id="l27.201" class="difflineplus">+        setData(event, iframe, { title: TITLE2 });</span>
<a href="#l27.202"></a><span id="l27.202">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l27.203"></a><span id="l27.203">     });</span>
<a href="#l27.204"></a><span id="l27.204"> </span>
<a href="#l27.205"></a><span id="l27.205">     // check if name was saved</span>
<a href="#l27.206"></a><span id="l27.206" class="difflineminus">-    let eventName = lookup(`</span>
<a href="#l27.207"></a><span id="l27.207" class="difflineminus">-        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l27.208"></a><span id="l27.208" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l27.209"></a><span id="l27.209" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l27.210"></a><span id="l27.210" class="difflineminus">-        {&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l27.211"></a><span id="l27.211" class="difflineminus">-        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}/</span>
<a href="#l27.212"></a><span id="l27.212" class="difflineplus">+    let eventName = lookupEventBox(</span>
<a href="#l27.213"></a><span id="l27.213" class="difflineplus">+        &quot;day&quot;, EVENT_BOX, null, 1, 8,</span>
<a href="#l27.214"></a><span id="l27.214" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}/</span>
<a href="#l27.215"></a><span id="l27.215">         anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l27.216"></a><span id="l27.216">         {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l27.217"></a><span id="l27.217" class="difflineminus">-        {&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})</span>
<a href="#l27.218"></a><span id="l27.218" class="difflineminus">-    `);</span>
<a href="#l27.219"></a><span id="l27.219" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l27.220"></a><span id="l27.220" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;event-name&quot;})`</span>
<a href="#l27.221"></a><span id="l27.221" class="difflineplus">+    );</span>
<a href="#l27.222"></a><span id="l27.222">     controller.waitForElement(eventName);</span>
<a href="#l27.223"></a><span id="l27.223">     controller.assertJSProperty(eventName, &quot;textContent&quot;, TITLE2);</span>
<a href="#l27.224"></a><span id="l27.224"> </span>
<a href="#l27.225"></a><span id="l27.225">     // delete event</span>
<a href="#l27.226"></a><span id="l27.226" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l27.227"></a><span id="l27.227" class="difflineminus">-        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l27.228"></a><span id="l27.228" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l27.229"></a><span id="l27.229" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l27.230"></a><span id="l27.230" class="difflineminus">-        {&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l27.231"></a><span id="l27.231" class="difflineminus">-        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}</span>
<a href="#l27.232"></a><span id="l27.232" class="difflineminus">-    `));</span>
<a href="#l27.233"></a><span id="l27.233" class="difflineplus">+    controller.click(lookupEventBox(</span>
<a href="#l27.234"></a><span id="l27.234" class="difflineplus">+        &quot;day&quot;, EVENT_BOX, null, 1, 8,</span>
<a href="#l27.235"></a><span id="l27.235" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l27.236"></a><span id="l27.236" class="difflineplus">+    ));</span>
<a href="#l27.237"></a><span id="l27.237">     controller.keypress(eid(&quot;day-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l27.238"></a><span id="l27.238" class="difflineminus">-    controller.waitForElementNotPresent(lookup(`</span>
<a href="#l27.239"></a><span id="l27.239" class="difflineminus">-        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l27.240"></a><span id="l27.240" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l27.241"></a><span id="l27.241" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l27.242"></a><span id="l27.242" class="difflineminus">-        {&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l27.243"></a><span id="l27.243" class="difflineminus">-        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}</span>
<a href="#l27.244"></a><span id="l27.244" class="difflineminus">-    `));</span>
<a href="#l27.245"></a><span id="l27.245" class="difflineplus">+    controller.waitForElementNotPresent(lookupEventBox(</span>
<a href="#l27.246"></a><span id="l27.246" class="difflineplus">+        &quot;day&quot;, EVENT_BOX, null, 1, 8,</span>
<a href="#l27.247"></a><span id="l27.247" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l27.248"></a><span id="l27.248" class="difflineplus">+    ));</span>
<a href="#l27.249"></a><span id="l27.249"> }</span>
<a href="#l27.250"></a><span id="l27.250"> </span>
<a href="#l27.251"></a><span id="l27.251"> function teardownTest(module) {</span>
<a href="#l27.252"></a><span id="l27.252">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l27.253"></a><span id="l27.253"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -3,177 +3,145 @@</span>
<a href="#l28.4"></a><span id="l28.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l28.5"></a><span id="l28.5"> </span>
<a href="#l28.6"></a><span id="l28.6"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l28.7"></a><span id="l28.7"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;, null);</span>
<a href="#l28.10"></a><span id="l28.10"> </span>
<a href="#l28.11"></a><span id="l28.11"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-var CALENDARNAME;</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+var goToDate, setData, lookupEventBox;</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+var CALENDARNAME, CANVAS_BOX, EVENT_BOX;</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16"> var TITLE1 = &quot;Month View Event&quot;;</span>
<a href="#l28.17"></a><span id="l28.17"> var TITLE2 = &quot;Month View Event Changed&quot;;</span>
<a href="#l28.18"></a><span id="l28.18"> var DESC = &quot;Month View Event Description&quot;;</span>
<a href="#l28.19"></a><span id="l28.19"> </span>
<a href="#l28.20"></a><span id="l28.20"> function setupModule(module) {</span>
<a href="#l28.21"></a><span id="l28.21">     controller = mozmill.getMail3PaneController();</span>
<a href="#l28.22"></a><span id="l28.22">     ({</span>
<a href="#l28.23"></a><span id="l28.23">         helpersForController,</span>
<a href="#l28.24"></a><span id="l28.24">         invokeEventDialog,</span>
<a href="#l28.25"></a><span id="l28.25">         createCalendar,</span>
<a href="#l28.26"></a><span id="l28.26">         deleteCalendars,</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineminus">-        CALENDARNAME</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineplus">+        goToDate,</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineplus">+        setData,</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineplus">+        lookupEventBox,</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineplus">+        EVENT_BOX</span>
<a href="#l28.34"></a><span id="l28.34">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l28.35"></a><span id="l28.35">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l28.36"></a><span id="l28.36">     Object.assign(module, helpersForController(controller));</span>
<a href="#l28.37"></a><span id="l28.37"> </span>
<a href="#l28.38"></a><span id="l28.38">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l28.39"></a><span id="l28.39"> }</span>
<a href="#l28.40"></a><span id="l28.40"> </span>
<a href="#l28.41"></a><span id="l28.41"> function testMonthView() {</span>
<a href="#l28.42"></a><span id="l28.42">     let dateFormatter = cal.getDateFormatter();</span>
<a href="#l28.43"></a><span id="l28.43">     // paths</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineminus">-    let miniMonth = `</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineminus">-        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineminus">-        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineminus">-        id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineminus">-        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineminus">-    `;</span>
<a href="#l28.50"></a><span id="l28.50">     let monthView = `</span>
<a href="#l28.51"></a><span id="l28.51">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l28.52"></a><span id="l28.52">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l28.53"></a><span id="l28.53">         id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l28.54"></a><span id="l28.54">         id(&quot;month-view&quot;)</span>
<a href="#l28.55"></a><span id="l28.55">     `;</span>
<a href="#l28.56"></a><span id="l28.56" class="difflineminus">-    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l28.57"></a><span id="l28.57" class="difflineminus">-    let eventBox = `</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">-        ${monthView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineminus">-        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}/</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineminus">-        anon({&quot;flex&quot;:&quot;1&quot;})/[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l28.62"></a><span id="l28.62" class="difflineminus">-        {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l28.63"></a><span id="l28.63" class="difflineminus">-        {&quot;class&quot;:&quot;calendar-event-details&quot;}</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineminus">-    `;</span>
<a href="#l28.65"></a><span id="l28.65"> </span>
<a href="#l28.66"></a><span id="l28.66">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l28.67"></a><span id="l28.67">     controller.waitThenClick(eid(&quot;calendar-month-view-button&quot;));</span>
<a href="#l28.68"></a><span id="l28.68"> </span>
<a href="#l28.69"></a><span id="l28.69" class="difflineminus">-    // pick year</span>
<a href="#l28.70"></a><span id="l28.70" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineminus">-    `));</span>
<a href="#l28.73"></a><span id="l28.73" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l28.75"></a><span id="l28.75" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/</span>
<a href="#l28.76"></a><span id="l28.76" class="difflineminus">-        {&quot;value&quot;:&quot;2009&quot;}</span>
<a href="#l28.77"></a><span id="l28.77" class="difflineminus">-    `));</span>
<a href="#l28.78"></a><span id="l28.78" class="difflineminus">-</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineminus">-    // pick month</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l28.81"></a><span id="l28.81" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l28.82"></a><span id="l28.82" class="difflineminus">-    `));</span>
<a href="#l28.83"></a><span id="l28.83" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l28.84"></a><span id="l28.84" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l28.85"></a><span id="l28.85" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineminus">-        {&quot;index&quot;:&quot;0&quot;}</span>
<a href="#l28.87"></a><span id="l28.87" class="difflineminus">-    `));</span>
<a href="#l28.88"></a><span id="l28.88" class="difflineminus">-</span>
<a href="#l28.89"></a><span id="l28.89" class="difflineminus">-    // pick day</span>
<a href="#l28.90"></a><span id="l28.90" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l28.91"></a><span id="l28.91" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}</span>
<a href="#l28.92"></a><span id="l28.92" class="difflineminus">-    `));</span>
<a href="#l28.93"></a><span id="l28.93" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l28.94"></a><span id="l28.94"> </span>
<a href="#l28.95"></a><span id="l28.95">     // verify date</span>
<a href="#l28.96"></a><span id="l28.96">     let day = lookup(`</span>
<a href="#l28.97"></a><span id="l28.97">         ${monthView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l28.98"></a><span id="l28.98">         anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}</span>
<a href="#l28.99"></a><span id="l28.99">     `);</span>
<a href="#l28.100"></a><span id="l28.100">     controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l28.101"></a><span id="l28.101"> </span>
<a href="#l28.102"></a><span id="l28.102">     // create event</span>
<a href="#l28.103"></a><span id="l28.103">     // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l28.104"></a><span id="l28.104">     let hour = new Date().getHours(); // remember time at click</span>
<a href="#l28.105"></a><span id="l28.105" class="difflineminus">-    eventBox = lookup(`</span>
<a href="#l28.106"></a><span id="l28.106" class="difflineminus">-        ${monthView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l28.107"></a><span id="l28.107" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/</span>
<a href="#l28.108"></a><span id="l28.108" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;day-items&quot;})</span>
<a href="#l28.109"></a><span id="l28.109" class="difflineminus">-    `);</span>
<a href="#l28.110"></a><span id="l28.110" class="difflineplus">+    let eventBox = lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, 5);</span>
<a href="#l28.111"></a><span id="l28.111">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l28.112"></a><span id="l28.112" class="difflineminus">-        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l28.113"></a><span id="l28.113" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l28.114"></a><span id="l28.114" class="difflineplus">+        let { lookup: iframeLookup } = helpersForController(iframe);</span>
<a href="#l28.115"></a><span id="l28.115"> </span>
<a href="#l28.116"></a><span id="l28.116" class="difflineminus">-        // check that the start time is correct</span>
<a href="#l28.117"></a><span id="l28.117" class="difflineminus">-        // next full hour except last hour hour of the day</span>
<a href="#l28.118"></a><span id="l28.118" class="difflineminus">-        let nextHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l28.119"></a><span id="l28.119" class="difflineminus">-        let startTime = nextHour + &quot;:00&quot;; // next full hour</span>
<a href="#l28.120"></a><span id="l28.120" class="difflineminus">-        let startTimeInput = eventlookup(`</span>
<a href="#l28.121"></a><span id="l28.121" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l28.122"></a><span id="l28.122" class="difflineminus">-            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l28.123"></a><span id="l28.123" class="difflineplus">+        let innerFrame = '/id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l28.124"></a><span id="l28.124" class="difflineplus">+        let dateInput = `</span>
<a href="#l28.125"></a><span id="l28.125" class="difflineplus">+            anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l28.126"></a><span id="l28.126" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l28.127"></a><span id="l28.127" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l28.128"></a><span id="l28.128" class="difflineplus">+        `;</span>
<a href="#l28.129"></a><span id="l28.129" class="difflineplus">+        let timeInput = `</span>
<a href="#l28.130"></a><span id="l28.130">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l28.131"></a><span id="l28.131">             anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l28.132"></a><span id="l28.132">             anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l28.133"></a><span id="l28.133">             anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l28.134"></a><span id="l28.134" class="difflineminus">-        `);</span>
<a href="#l28.135"></a><span id="l28.135" class="difflineminus">-        event.waitForElement(startTimeInput);</span>
<a href="#l28.136"></a><span id="l28.136" class="difflineminus">-        event.assertValue(startTimeInput, startTime);</span>
<a href="#l28.137"></a><span id="l28.137" class="difflineplus">+        `;</span>
<a href="#l28.138"></a><span id="l28.138" class="difflineplus">+        let startId = &quot;event-starttime&quot;;</span>
<a href="#l28.139"></a><span id="l28.139"> </span>
<a href="#l28.140"></a><span id="l28.140" class="difflineminus">-        let someTime = cal.dtz.now();</span>
<a href="#l28.141"></a><span id="l28.141" class="difflineminus">-        someTime.resetTo(2009, 1, 1);</span>
<a href="#l28.142"></a><span id="l28.142" class="difflineminus">-        let date = dateFormatter.formatDateShort(someDate);</span>
<a href="#l28.143"></a><span id="l28.143" class="difflineminus">-        event.assertValue(eventlookup(`</span>
<a href="#l28.144"></a><span id="l28.144" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l28.145"></a><span id="l28.145" class="difflineminus">-            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l28.146"></a><span id="l28.146" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l28.147"></a><span id="l28.147" class="difflineminus">-            anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l28.148"></a><span id="l28.148" class="difflineminus">-            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l28.149"></a><span id="l28.149" class="difflineminus">-            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l28.150"></a><span id="l28.150" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l28.151"></a><span id="l28.151" class="difflineminus">-        `), date);</span>
<a href="#l28.152"></a><span id="l28.152" class="difflineplus">+        let startTimeInput = iframeLookup(`</span>
<a href="#l28.153"></a><span id="l28.153" class="difflineplus">+            ${innerFrame}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l28.154"></a><span id="l28.154" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;${startId}&quot;)/${timeInput}</span>
<a href="#l28.155"></a><span id="l28.155" class="difflineplus">+        `);</span>
<a href="#l28.156"></a><span id="l28.156" class="difflineplus">+        let startDateInput = iframeLookup(`</span>
<a href="#l28.157"></a><span id="l28.157" class="difflineplus">+            ${innerFrame}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l28.158"></a><span id="l28.158" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;${startId}&quot;)/</span>
<a href="#l28.159"></a><span id="l28.159" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/${dateInput}</span>
<a href="#l28.160"></a><span id="l28.160" class="difflineplus">+        `);</span>
<a href="#l28.161"></a><span id="l28.161" class="difflineplus">+</span>
<a href="#l28.162"></a><span id="l28.162" class="difflineplus">+        // check that the start time is correct</span>
<a href="#l28.163"></a><span id="l28.163" class="difflineplus">+        // next full hour except last hour hour of the day</span>
<a href="#l28.164"></a><span id="l28.164" class="difflineplus">+        let nextHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l28.165"></a><span id="l28.165" class="difflineplus">+        let someDate = cal.dtz.now();</span>
<a href="#l28.166"></a><span id="l28.166" class="difflineplus">+        someDate.resetTo(2009, 0, 1, nextHour, 0, 0, cal.dtz.floating);</span>
<a href="#l28.167"></a><span id="l28.167" class="difflineplus">+        event.waitForElement(startTimeInput);</span>
<a href="#l28.168"></a><span id="l28.168" class="difflineplus">+        event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l28.169"></a><span id="l28.169" class="difflineplus">+        event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l28.170"></a><span id="l28.170"> </span>
<a href="#l28.171"></a><span id="l28.171">         // fill in title, description and calendar</span>
<a href="#l28.172"></a><span id="l28.172" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l28.173"></a><span id="l28.173" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l28.174"></a><span id="l28.174" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l28.175"></a><span id="l28.175" class="difflineminus">-        `), TITLE1);</span>
<a href="#l28.176"></a><span id="l28.176" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l28.177"></a><span id="l28.177" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l28.178"></a><span id="l28.178" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l28.179"></a><span id="l28.179" class="difflineminus">-        `), DESC);</span>
<a href="#l28.180"></a><span id="l28.180" class="difflineminus">-        event.click(eventid(&quot;item-calendar&quot;));</span>
<a href="#l28.181"></a><span id="l28.181" class="difflineminus">-        event.click(eventlookup(`</span>
<a href="#l28.182"></a><span id="l28.182" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-category-color-row&quot;)/</span>
<a href="#l28.183"></a><span id="l28.183" class="difflineminus">-            id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/</span>
<a href="#l28.184"></a><span id="l28.184" class="difflineminus">-            {&quot;label&quot;:&quot;${CALENDARNAME}&quot;}'</span>
<a href="#l28.185"></a><span id="l28.185" class="difflineminus">-        `));</span>
<a href="#l28.186"></a><span id="l28.186" class="difflineplus">+        setData(event, iframe, { title: TITLE1, description: DESC, calendar: CALENDARNAME });</span>
<a href="#l28.187"></a><span id="l28.187"> </span>
<a href="#l28.188"></a><span id="l28.188">         // save</span>
<a href="#l28.189"></a><span id="l28.189">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l28.190"></a><span id="l28.190">     });</span>
<a href="#l28.191"></a><span id="l28.191"> </span>
<a href="#l28.192"></a><span id="l28.192">     // if it was created successfully, it can be opened</span>
<a href="#l28.193"></a><span id="l28.193" class="difflineplus">+    eventBox = lookupEventBox(</span>
<a href="#l28.194"></a><span id="l28.194" class="difflineplus">+        &quot;month&quot;, EVENT_BOX, 1, 5, null,</span>
<a href="#l28.195"></a><span id="l28.195" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l28.196"></a><span id="l28.196" class="difflineplus">+    );</span>
<a href="#l28.197"></a><span id="l28.197">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l28.198"></a><span id="l28.198" class="difflineminus">-        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l28.199"></a><span id="l28.199" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l28.200"></a><span id="l28.200"> </span>
<a href="#l28.201"></a><span id="l28.201">         // change title and save changes</span>
<a href="#l28.202"></a><span id="l28.202" class="difflineminus">-        let titleTextBox = eventlookup(`</span>
<a href="#l28.203"></a><span id="l28.203" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l28.204"></a><span id="l28.204" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l28.205"></a><span id="l28.205" class="difflineminus">-        `);</span>
<a href="#l28.206"></a><span id="l28.206" class="difflineminus">-        event.waitForElement(titleTextBox);</span>
<a href="#l28.207"></a><span id="l28.207" class="difflineminus">-        event.type(titleTextBox, TITLE2);</span>
<a href="#l28.208"></a><span id="l28.208" class="difflineplus">+        setData(event, iframe, { title: TITLE2 });</span>
<a href="#l28.209"></a><span id="l28.209">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l28.210"></a><span id="l28.210">     });</span>
<a href="#l28.211"></a><span id="l28.211"> </span>
<a href="#l28.212"></a><span id="l28.212">     // check if name was saved</span>
<a href="#l28.213"></a><span id="l28.213" class="difflineminus">-    let eventName = lookup(eventBox + '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l28.214"></a><span id="l28.214" class="difflineplus">+    let eventName = lookupEventBox(</span>
<a href="#l28.215"></a><span id="l28.215" class="difflineplus">+        &quot;month&quot;, EVENT_BOX, 1, 5, null,</span>
<a href="#l28.216"></a><span id="l28.216" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}/</span>
<a href="#l28.217"></a><span id="l28.217" class="difflineplus">+        anon({&quot;flex&quot;:&quot;1&quot;})/[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l28.218"></a><span id="l28.218" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l28.219"></a><span id="l28.219" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-details&quot;}/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})`</span>
<a href="#l28.220"></a><span id="l28.220" class="difflineplus">+    );</span>
<a href="#l28.221"></a><span id="l28.221"> </span>
<a href="#l28.222"></a><span id="l28.222">     controller.waitForElement(eventName);</span>
<a href="#l28.223"></a><span id="l28.223">     controller.assertValue(eventName, TITLE2);</span>
<a href="#l28.224"></a><span id="l28.224"> </span>
<a href="#l28.225"></a><span id="l28.225">     // delete event</span>
<a href="#l28.226"></a><span id="l28.226" class="difflineminus">-    controller.click(lookup(eventBox));</span>
<a href="#l28.227"></a><span id="l28.227" class="difflineplus">+    controller.click(lookupEventBox(</span>
<a href="#l28.228"></a><span id="l28.228" class="difflineplus">+        &quot;month&quot;, EVENT_BOX, 1, 5, null,</span>
<a href="#l28.229"></a><span id="l28.229" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l28.230"></a><span id="l28.230" class="difflineplus">+    ));</span>
<a href="#l28.231"></a><span id="l28.231">     controller.keypress(eid(&quot;month-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l28.232"></a><span id="l28.232" class="difflineminus">-    controller.waitForElementNotPresent(lookup(eventBox));</span>
<a href="#l28.233"></a><span id="l28.233" class="difflineplus">+    controller.waitForElementNotPresent(lookupEventBox(</span>
<a href="#l28.234"></a><span id="l28.234" class="difflineplus">+        &quot;month&quot;, EVENT_BOX, 1, 5, null,</span>
<a href="#l28.235"></a><span id="l28.235" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l28.236"></a><span id="l28.236" class="difflineplus">+    ));</span>
<a href="#l28.237"></a><span id="l28.237"> }</span>
<a href="#l28.238"></a><span id="l28.238"> </span>
<a href="#l28.239"></a><span id="l28.239"> function teardownTest(module) {</span>
<a href="#l28.240"></a><span id="l28.240">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l28.241"></a><span id="l28.241"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -3,175 +3,145 @@</span>
<a href="#l29.4"></a><span id="l29.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l29.7"></a><span id="l29.7"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l29.8"></a><span id="l29.8"> </span>
<a href="#l29.9"></a><span id="l29.9"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;, null);</span>
<a href="#l29.10"></a><span id="l29.10"> </span>
<a href="#l29.11"></a><span id="l29.11"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-var CALENDARNAME;</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+var goToDate, setData, lookupEventBox;</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+var CALENDARNAME, CANVAS_BOX, EVENT_BOX;</span>
<a href="#l29.15"></a><span id="l29.15"> </span>
<a href="#l29.16"></a><span id="l29.16"> var TITLE1 = &quot;Multiweek View Event&quot;;</span>
<a href="#l29.17"></a><span id="l29.17"> var TITLE2 = &quot;Multiweek View Event Changed&quot;;</span>
<a href="#l29.18"></a><span id="l29.18"> var DESC = &quot;Multiweek View Event Description&quot;;</span>
<a href="#l29.19"></a><span id="l29.19"> </span>
<a href="#l29.20"></a><span id="l29.20"> function setupModule(module) {</span>
<a href="#l29.21"></a><span id="l29.21">     controller = mozmill.getMail3PaneController();</span>
<a href="#l29.22"></a><span id="l29.22">     ({</span>
<a href="#l29.23"></a><span id="l29.23">         helpersForController,</span>
<a href="#l29.24"></a><span id="l29.24">         invokeEventDialog,</span>
<a href="#l29.25"></a><span id="l29.25">         createCalendar,</span>
<a href="#l29.26"></a><span id="l29.26">         deleteCalendars,</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineminus">-        CALENDARNAME</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineplus">+        goToDate,</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineplus">+        setData,</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineplus">+        lookupEventBox,</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineplus">+        EVENT_BOX</span>
<a href="#l29.34"></a><span id="l29.34">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l29.35"></a><span id="l29.35">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l29.36"></a><span id="l29.36">     Object.assign(module, helpersForController(controller));</span>
<a href="#l29.37"></a><span id="l29.37"> </span>
<a href="#l29.38"></a><span id="l29.38">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l29.39"></a><span id="l29.39"> }</span>
<a href="#l29.40"></a><span id="l29.40"> </span>
<a href="#l29.41"></a><span id="l29.41"> function testMultiWeekView() {</span>
<a href="#l29.42"></a><span id="l29.42">     let dateFormatter = cal.getDateFormatter();</span>
<a href="#l29.43"></a><span id="l29.43">     // paths</span>
<a href="#l29.44"></a><span id="l29.44" class="difflineminus">-    let miniMonth = `</span>
<a href="#l29.45"></a><span id="l29.45" class="difflineminus">-        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l29.46"></a><span id="l29.46" class="difflineminus">-        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineminus">-        id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineminus">-        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineminus">-    `;</span>
<a href="#l29.50"></a><span id="l29.50">     let multiWeekView = `</span>
<a href="#l29.51"></a><span id="l29.51">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l29.52"></a><span id="l29.52">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l29.53"></a><span id="l29.53">         id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l29.54"></a><span id="l29.54">         id(&quot;multiweek-view&quot;)/</span>
<a href="#l29.55"></a><span id="l29.55">     `;</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineminus">-    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineminus">-    let eventBox = `</span>
<a href="#l29.58"></a><span id="l29.58" class="difflineminus">-        ${multiWeekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l29.59"></a><span id="l29.59" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineminus">-        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + CALENDARNAME.toLowerCase() + '&quot;}/</span>
<a href="#l29.61"></a><span id="l29.61" class="difflineminus">-        anon({&quot;flex&quot;:&quot;1&quot;})/[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l29.62"></a><span id="l29.62" class="difflineminus">-        {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l29.63"></a><span id="l29.63" class="difflineminus">-        {&quot;class&quot;:&quot;calendar-event-details&quot;}</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineminus">-    `;</span>
<a href="#l29.65"></a><span id="l29.65"> </span>
<a href="#l29.66"></a><span id="l29.66">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l29.67"></a><span id="l29.67">     controller.waitThenClick(eid(&quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l29.68"></a><span id="l29.68"> </span>
<a href="#l29.69"></a><span id="l29.69" class="difflineminus">-    // pick year</span>
<a href="#l29.70"></a><span id="l29.70" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l29.71"></a><span id="l29.71" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l29.72"></a><span id="l29.72" class="difflineminus">-    `));</span>
<a href="#l29.73"></a><span id="l29.73" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l29.74"></a><span id="l29.74" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l29.75"></a><span id="l29.75" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/</span>
<a href="#l29.76"></a><span id="l29.76" class="difflineminus">-        {&quot;value&quot;:&quot;2009&quot;}</span>
<a href="#l29.77"></a><span id="l29.77" class="difflineminus">-    `));</span>
<a href="#l29.78"></a><span id="l29.78" class="difflineminus">-</span>
<a href="#l29.79"></a><span id="l29.79" class="difflineminus">-    // pick month</span>
<a href="#l29.80"></a><span id="l29.80" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l29.81"></a><span id="l29.81" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l29.82"></a><span id="l29.82" class="difflineminus">-    `));</span>
<a href="#l29.83"></a><span id="l29.83" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l29.84"></a><span id="l29.84" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l29.85"></a><span id="l29.85" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/</span>
<a href="#l29.86"></a><span id="l29.86" class="difflineminus">-        {&quot;index&quot;:&quot;0&quot;}</span>
<a href="#l29.87"></a><span id="l29.87" class="difflineminus">-    `));</span>
<a href="#l29.88"></a><span id="l29.88" class="difflineminus">-</span>
<a href="#l29.89"></a><span id="l29.89" class="difflineminus">-    // pick day</span>
<a href="#l29.90"></a><span id="l29.90" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l29.91"></a><span id="l29.91" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}</span>
<a href="#l29.92"></a><span id="l29.92" class="difflineminus">-    `));</span>
<a href="#l29.93"></a><span id="l29.93" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l29.94"></a><span id="l29.94"> </span>
<a href="#l29.95"></a><span id="l29.95">     // verify date</span>
<a href="#l29.96"></a><span id="l29.96">     let day = lookup(`</span>
<a href="#l29.97"></a><span id="l29.97">         ${multiWeekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l29.98"></a><span id="l29.98">         anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}</span>
<a href="#l29.99"></a><span id="l29.99">     `);</span>
<a href="#l29.100"></a><span id="l29.100">     controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l29.101"></a><span id="l29.101"> </span>
<a href="#l29.102"></a><span id="l29.102">     // create event</span>
<a href="#l29.103"></a><span id="l29.103">     // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l29.104"></a><span id="l29.104">     let hour = new Date().getHours(); // remember time at click</span>
<a href="#l29.105"></a><span id="l29.105" class="difflineminus">-    eventBox = lookup(`</span>
<a href="#l29.106"></a><span id="l29.106" class="difflineminus">-        ${multiWeekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l29.107"></a><span id="l29.107" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/</span>
<a href="#l29.108"></a><span id="l29.108" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;day-items&quot;})</span>
<a href="#l29.109"></a><span id="l29.109" class="difflineminus">-    `);</span>
<a href="#l29.110"></a><span id="l29.110" class="difflineplus">+    let eventBox = lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, 1, 5);</span>
<a href="#l29.111"></a><span id="l29.111">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l29.112"></a><span id="l29.112" class="difflineminus">-        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l29.113"></a><span id="l29.113" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l29.114"></a><span id="l29.114" class="difflineplus">+        let { lookup: iframeLookup } = helpersForController(iframe);</span>
<a href="#l29.115"></a><span id="l29.115"> </span>
<a href="#l29.116"></a><span id="l29.116" class="difflineminus">-        // check that the start time is correct</span>
<a href="#l29.117"></a><span id="l29.117" class="difflineminus">-        // next full hour except last hour hour of the day</span>
<a href="#l29.118"></a><span id="l29.118" class="difflineminus">-        let nextHour = (hour == 23 ? hour : (hour + 1) % 24);</span>
<a href="#l29.119"></a><span id="l29.119" class="difflineminus">-        let startTime = nextHour + &quot;:00&quot;;</span>
<a href="#l29.120"></a><span id="l29.120" class="difflineminus">-        let startTimeInput = eventlookup(`</span>
<a href="#l29.121"></a><span id="l29.121" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l29.122"></a><span id="l29.122" class="difflineminus">-            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l29.123"></a><span id="l29.123" class="difflineplus">+        let innerFrame = '/id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l29.124"></a><span id="l29.124" class="difflineplus">+        let dateInput = `</span>
<a href="#l29.125"></a><span id="l29.125" class="difflineplus">+            anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l29.126"></a><span id="l29.126" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l29.127"></a><span id="l29.127" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l29.128"></a><span id="l29.128" class="difflineplus">+        `;</span>
<a href="#l29.129"></a><span id="l29.129" class="difflineplus">+        let timeInput = `</span>
<a href="#l29.130"></a><span id="l29.130">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l29.131"></a><span id="l29.131">             anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l29.132"></a><span id="l29.132">             anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l29.133"></a><span id="l29.133">             anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l29.134"></a><span id="l29.134" class="difflineplus">+        `;</span>
<a href="#l29.135"></a><span id="l29.135" class="difflineplus">+        let startId = &quot;event-starttime&quot;;</span>
<a href="#l29.136"></a><span id="l29.136" class="difflineplus">+</span>
<a href="#l29.137"></a><span id="l29.137" class="difflineplus">+        let startTimeInput = iframeLookup(`</span>
<a href="#l29.138"></a><span id="l29.138" class="difflineplus">+            ${innerFrame}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l29.139"></a><span id="l29.139" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;${startId}&quot;)/${timeInput}</span>
<a href="#l29.140"></a><span id="l29.140">         `);</span>
<a href="#l29.141"></a><span id="l29.141" class="difflineplus">+        let startDateInput = iframeLookup(`</span>
<a href="#l29.142"></a><span id="l29.142" class="difflineplus">+            ${innerFrame}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l29.143"></a><span id="l29.143" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;${startId}&quot;)/</span>
<a href="#l29.144"></a><span id="l29.144" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/${dateInput}</span>
<a href="#l29.145"></a><span id="l29.145" class="difflineplus">+        `);</span>
<a href="#l29.146"></a><span id="l29.146" class="difflineplus">+</span>
<a href="#l29.147"></a><span id="l29.147" class="difflineplus">+        // check that the start time is correct</span>
<a href="#l29.148"></a><span id="l29.148" class="difflineplus">+        // next full hour except last hour hour of the day</span>
<a href="#l29.149"></a><span id="l29.149" class="difflineplus">+        let nextHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l29.150"></a><span id="l29.150" class="difflineplus">+        let someDate = cal.dtz.now();</span>
<a href="#l29.151"></a><span id="l29.151" class="difflineplus">+        someDate.resetTo(2009, 0, 1, nextHour, 0, 0, cal.dtz.floating);</span>
<a href="#l29.152"></a><span id="l29.152">         event.waitForElement(startTimeInput);</span>
<a href="#l29.153"></a><span id="l29.153" class="difflineminus">-        event.assertValue(startTimeInput, startTime);</span>
<a href="#l29.154"></a><span id="l29.154" class="difflineminus">-        let someTime = cal.createDateTime();</span>
<a href="#l29.155"></a><span id="l29.155" class="difflineminus">-        someTime.resetTo(2009, 1, 1);</span>
<a href="#l29.156"></a><span id="l29.156" class="difflineminus">-        let date = dateFormatter.formatDateShort(someDate);</span>
<a href="#l29.157"></a><span id="l29.157" class="difflineminus">-        event.assertValue(eventlookup(`</span>
<a href="#l29.158"></a><span id="l29.158" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l29.159"></a><span id="l29.159" class="difflineminus">-            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l29.160"></a><span id="l29.160" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l29.161"></a><span id="l29.161" class="difflineminus">-            anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l29.162"></a><span id="l29.162" class="difflineminus">-            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l29.163"></a><span id="l29.163" class="difflineminus">-            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l29.164"></a><span id="l29.164" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l29.165"></a><span id="l29.165" class="difflineminus">-        `), date);</span>
<a href="#l29.166"></a><span id="l29.166" class="difflineplus">+        event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l29.167"></a><span id="l29.167" class="difflineplus">+        event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l29.168"></a><span id="l29.168"> </span>
<a href="#l29.169"></a><span id="l29.169">         // fill in title, description and calendar</span>
<a href="#l29.170"></a><span id="l29.170" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l29.171"></a><span id="l29.171" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l29.172"></a><span id="l29.172" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l29.173"></a><span id="l29.173" class="difflineminus">-        `), TITLE1);</span>
<a href="#l29.174"></a><span id="l29.174" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l29.175"></a><span id="l29.175" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l29.176"></a><span id="l29.176" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l29.177"></a><span id="l29.177" class="difflineminus">-        `), DESC);</span>
<a href="#l29.178"></a><span id="l29.178" class="difflineminus">-        event.click(eventid(&quot;item-calendar&quot;));</span>
<a href="#l29.179"></a><span id="l29.179" class="difflineminus">-        event.click(eventlookup(`</span>
<a href="#l29.180"></a><span id="l29.180" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-category-color-row&quot;)/</span>
<a href="#l29.181"></a><span id="l29.181" class="difflineminus">-            id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/</span>
<a href="#l29.182"></a><span id="l29.182" class="difflineminus">-            {&quot;label&quot;:&quot;${CALENDARNAME}&quot;}</span>
<a href="#l29.183"></a><span id="l29.183" class="difflineminus">-        `));</span>
<a href="#l29.184"></a><span id="l29.184" class="difflineplus">+        setData(event, iframe, { title: TITLE1, description: DESC, calendar: CALENDARNAME });</span>
<a href="#l29.185"></a><span id="l29.185"> </span>
<a href="#l29.186"></a><span id="l29.186">         // save</span>
<a href="#l29.187"></a><span id="l29.187">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l29.188"></a><span id="l29.188">     });</span>
<a href="#l29.189"></a><span id="l29.189"> </span>
<a href="#l29.190"></a><span id="l29.190">     // if it was created successfully, it can be opened</span>
<a href="#l29.191"></a><span id="l29.191" class="difflineplus">+    eventBox = lookupEventBox(</span>
<a href="#l29.192"></a><span id="l29.192" class="difflineplus">+        &quot;multiweek&quot;, EVENT_BOX, 1, 5, null,</span>
<a href="#l29.193"></a><span id="l29.193" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l29.194"></a><span id="l29.194" class="difflineplus">+    );</span>
<a href="#l29.195"></a><span id="l29.195">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l29.196"></a><span id="l29.196" class="difflineminus">-        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l29.197"></a><span id="l29.197" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l29.198"></a><span id="l29.198"> </span>
<a href="#l29.199"></a><span id="l29.199">         // change title and save changes</span>
<a href="#l29.200"></a><span id="l29.200" class="difflineminus">-        let titmeTextBox = eventlookup(`</span>
<a href="#l29.201"></a><span id="l29.201" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l29.202"></a><span id="l29.202" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l29.203"></a><span id="l29.203" class="difflineminus">-        `);</span>
<a href="#l29.204"></a><span id="l29.204" class="difflineminus">-        event.waitForElement(titmeTextBox);</span>
<a href="#l29.205"></a><span id="l29.205" class="difflineminus">-        event.type(titmeTextBox, TITLE2);</span>
<a href="#l29.206"></a><span id="l29.206" class="difflineplus">+        setData(event, iframe, { title: TITLE2 });</span>
<a href="#l29.207"></a><span id="l29.207">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l29.208"></a><span id="l29.208">     });</span>
<a href="#l29.209"></a><span id="l29.209"> </span>
<a href="#l29.210"></a><span id="l29.210">     // check if name was saved</span>
<a href="#l29.211"></a><span id="l29.211" class="difflineminus">-    let eventName = lookup(eventBox + '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l29.212"></a><span id="l29.212" class="difflineplus">+    let eventName = lookupEventBox(</span>
<a href="#l29.213"></a><span id="l29.213" class="difflineplus">+        &quot;multiweek&quot;, EVENT_BOX, 1, 5, null,</span>
<a href="#l29.214"></a><span id="l29.214" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}/</span>
<a href="#l29.215"></a><span id="l29.215" class="difflineplus">+        anon({&quot;flex&quot;:&quot;1&quot;})/[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l29.216"></a><span id="l29.216" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l29.217"></a><span id="l29.217" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-details&quot;}/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})`</span>
<a href="#l29.218"></a><span id="l29.218" class="difflineplus">+    );</span>
<a href="#l29.219"></a><span id="l29.219" class="difflineplus">+</span>
<a href="#l29.220"></a><span id="l29.220">     controller.waitForElement(eventName);</span>
<a href="#l29.221"></a><span id="l29.221">     controller.assertValue(eventName, TITLE2);</span>
<a href="#l29.222"></a><span id="l29.222"> </span>
<a href="#l29.223"></a><span id="l29.223">     // delete event</span>
<a href="#l29.224"></a><span id="l29.224" class="difflineminus">-    controller.click(lookup(eventBox));</span>
<a href="#l29.225"></a><span id="l29.225" class="difflineplus">+    controller.click(lookupEventBox(</span>
<a href="#l29.226"></a><span id="l29.226" class="difflineplus">+        &quot;multiweek&quot;, EVENT_BOX, 1, 5, null,</span>
<a href="#l29.227"></a><span id="l29.227" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l29.228"></a><span id="l29.228" class="difflineplus">+    ));</span>
<a href="#l29.229"></a><span id="l29.229">     controller.keypress(eid(&quot;multiweek-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l29.230"></a><span id="l29.230" class="difflineminus">-    controller.waitForElementNotPresent(lookup(eventBox));</span>
<a href="#l29.231"></a><span id="l29.231" class="difflineplus">+    controller.waitForElementNotPresent(lookupEventBox(</span>
<a href="#l29.232"></a><span id="l29.232" class="difflineplus">+        &quot;multiweek&quot;, EVENT_BOX, 1, 5, null,</span>
<a href="#l29.233"></a><span id="l29.233" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l29.234"></a><span id="l29.234" class="difflineplus">+    ));</span>
<a href="#l29.235"></a><span id="l29.235"> }</span>
<a href="#l29.236"></a><span id="l29.236"> </span>
<a href="#l29.237"></a><span id="l29.237"> function teardownTest(module) {</span>
<a href="#l29.238"></a><span id="l29.238">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l29.239"></a><span id="l29.239"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -1,32 +1,31 @@</span>
<a href="#l30.4"></a><span id="l30.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l30.5"></a><span id="l30.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l30.6"></a><span id="l30.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l30.9"></a><span id="l30.9"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+var setData;</span>
<a href="#l30.13"></a><span id="l30.13"> var CALENDARNAME;</span>
<a href="#l30.14"></a><span id="l30.14"> </span>
<a href="#l30.15"></a><span id="l30.15" class="difflineminus">-var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineminus">-</span>
<a href="#l30.17"></a><span id="l30.17"> var TITLE = &quot;Task&quot;;</span>
<a href="#l30.18"></a><span id="l30.18"> var DESCRIPTION = &quot;1. Do A\n2. Do B&quot;;</span>
<a href="#l30.19"></a><span id="l30.19"> var percentComplete = &quot;50&quot;;</span>
<a href="#l30.20"></a><span id="l30.20"> </span>
<a href="#l30.21"></a><span id="l30.21"> function setupModule(module) {</span>
<a href="#l30.22"></a><span id="l30.22">     controller = mozmill.getMail3PaneController();</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineminus">-</span>
<a href="#l30.24"></a><span id="l30.24">     ({</span>
<a href="#l30.25"></a><span id="l30.25">         helpersForController,</span>
<a href="#l30.26"></a><span id="l30.26">         invokeEventDialog,</span>
<a href="#l30.27"></a><span id="l30.27">         createCalendar,</span>
<a href="#l30.28"></a><span id="l30.28">         deleteCalendars,</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineplus">+        setData,</span>
<a href="#l30.30"></a><span id="l30.30">         CALENDARNAME</span>
<a href="#l30.31"></a><span id="l30.31">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l30.32"></a><span id="l30.32">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l30.33"></a><span id="l30.33">     Object.assign(module, helpersForController(controller));</span>
<a href="#l30.34"></a><span id="l30.34"> </span>
<a href="#l30.35"></a><span id="l30.35">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l30.36"></a><span id="l30.36"> }</span>
<a href="#l30.37"></a><span id="l30.37"> </span>
<a href="#l30.38"></a><span id="l30.38" class="difflineat">@@ -34,17 +33,16 @@ function setupModule(module) {</span>
<a href="#l30.39"></a><span id="l30.39"> // checked</span>
<a href="#l30.40"></a><span id="l30.40"> function testTaskView() {</span>
<a href="#l30.41"></a><span id="l30.41">     // paths</span>
<a href="#l30.42"></a><span id="l30.42">     let taskView = `</span>
<a href="#l30.43"></a><span id="l30.43">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l30.44"></a><span id="l30.44">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l30.45"></a><span id="l30.45">         id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/</span>
<a href="#l30.46"></a><span id="l30.46">     `;</span>
<a href="#l30.47"></a><span id="l30.47" class="difflineminus">-    let taskDialog = '/id(&quot;calendar-task-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)';</span>
<a href="#l30.48"></a><span id="l30.48">     let treeChildren = `</span>
<a href="#l30.49"></a><span id="l30.49">         ${taskView}/[1]/id(&quot;calendar-task-tree&quot;)/</span>
<a href="#l30.50"></a><span id="l30.50">         anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/{&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}</span>
<a href="#l30.51"></a><span id="l30.51">     `;</span>
<a href="#l30.52"></a><span id="l30.52">     let taskTree = taskView + '[1]/id(&quot;calendar-task-tree&quot;)';</span>
<a href="#l30.53"></a><span id="l30.53">     let toolTip = '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;taskTreeTooltip&quot;)';</span>
<a href="#l30.54"></a><span id="l30.54">     let toolTipGrid = toolTip + '/{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/';</span>
<a href="#l30.55"></a><span id="l30.55"> </span>
<a href="#l30.56"></a><span id="l30.56" class="difflineat">@@ -66,21 +64,21 @@ function testTaskView() {</span>
<a href="#l30.57"></a><span id="l30.57">         }</span>
<a href="#l30.58"></a><span id="l30.58">     }</span>
<a href="#l30.59"></a><span id="l30.59"> </span>
<a href="#l30.60"></a><span id="l30.60">     let taskTreeNode = lookup(taskTree).getNode();</span>
<a href="#l30.61"></a><span id="l30.61">     let countBefore = taskTreeNode.mTaskArray.length;</span>
<a href="#l30.62"></a><span id="l30.62"> </span>
<a href="#l30.63"></a><span id="l30.63">     // add task</span>
<a href="#l30.64"></a><span id="l30.64">     controller.type(lookup(`</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineminus">-        ${taskView}/id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/</span>
<a href="#l30.66"></a><span id="l30.66" class="difflineplus">+        ${taskView}/id(&quot;task-addition-box&quot;)/[0]/id(&quot;view-task-edit-field&quot;)/</span>
<a href="#l30.67"></a><span id="l30.67">         anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l30.68"></a><span id="l30.68">     `), TITLE);</span>
<a href="#l30.69"></a><span id="l30.69">     controller.keypress(lookup(`</span>
<a href="#l30.70"></a><span id="l30.70" class="difflineminus">-        ${taskView}/id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/</span>
<a href="#l30.71"></a><span id="l30.71" class="difflineplus">+        ${taskView}/id(&quot;task-addition-box&quot;)/[0]/id(&quot;view-task-edit-field&quot;)/</span>
<a href="#l30.72"></a><span id="l30.72">         anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l30.73"></a><span id="l30.73">     `), &quot;VK_RETURN&quot;, {});</span>
<a href="#l30.74"></a><span id="l30.74"> </span>
<a href="#l30.75"></a><span id="l30.75">     // verify added</span>
<a href="#l30.76"></a><span id="l30.76">     let countAfter;</span>
<a href="#l30.77"></a><span id="l30.77">     controller.waitFor(() =&gt; {</span>
<a href="#l30.78"></a><span id="l30.78">         countAfter = taskTreeNode.mTaskArray.length;</span>
<a href="#l30.79"></a><span id="l30.79">         return countBefore + 1 == countAfter;</span>
<a href="#l30.80"></a><span id="l30.80" class="difflineat">@@ -89,60 +87,38 @@ function testTaskView() {</span>
<a href="#l30.81"></a><span id="l30.81">     // last added task is automatically selected so verify detail window data</span>
<a href="#l30.82"></a><span id="l30.82">     controller.assertJSProperty(eid(&quot;calendar-task-details-title&quot;), &quot;textContent&quot;, TITLE);</span>
<a href="#l30.83"></a><span id="l30.83"> </span>
<a href="#l30.84"></a><span id="l30.84">     // open added task</span>
<a href="#l30.85"></a><span id="l30.85">     // doubleclick on completion checkbox is ignored as opening action, so don't click at immediate</span>
<a href="#l30.86"></a><span id="l30.86">     // left where the checkbox is located</span>
<a href="#l30.87"></a><span id="l30.87">     controller.doubleClick(lookup(treeChildren), 50, 0);</span>
<a href="#l30.88"></a><span id="l30.88">     invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l30.89"></a><span id="l30.89" class="difflineminus">-        let { lookup: tasklookup, eid: taskid } = helpersForController(task);</span>
<a href="#l30.90"></a><span id="l30.90" class="difflineplus">+        let { eid: taskid } = helpersForController(task);</span>
<a href="#l30.91"></a><span id="l30.91" class="difflineplus">+        let { eid: iframeId } = helpersForController(iframe);</span>
<a href="#l30.92"></a><span id="l30.92"> </span>
<a href="#l30.93"></a><span id="l30.93">         // verify calendar</span>
<a href="#l30.94"></a><span id="l30.94" class="difflineminus">-        task.waitForElement(tasklookup(`</span>
<a href="#l30.95"></a><span id="l30.95" class="difflineminus">-            ${taskDialog}/id(&quot;event-grid-category-color-row&quot;)/</span>
<a href="#l30.96"></a><span id="l30.96" class="difflineminus">-            id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/</span>
<a href="#l30.97"></a><span id="l30.97" class="difflineminus">-            {&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;${CALENDARNAME}&quot;}</span>
<a href="#l30.98"></a><span id="l30.98" class="difflineminus">-        `));</span>
<a href="#l30.99"></a><span id="l30.99" class="difflineminus">-</span>
<a href="#l30.100"></a><span id="l30.100" class="difflineminus">-        // add description, mark needs action and add percent complete</span>
<a href="#l30.101"></a><span id="l30.101" class="difflineminus">-        task.type(tasklookup(`</span>
<a href="#l30.102"></a><span id="l30.102" class="difflineminus">-            ${taskDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l30.103"></a><span id="l30.103" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l30.104"></a><span id="l30.104" class="difflineminus">-        `), DESCRIPTION);</span>
<a href="#l30.105"></a><span id="l30.105" class="difflineminus">-        task.click(taskid(&quot;todo-status-needsaction-menuitem&quot;));</span>
<a href="#l30.106"></a><span id="l30.106" class="difflineplus">+        controller.assertValue(iframeId(&quot;item-calendar&quot;), CALENDARNAME);</span>
<a href="#l30.107"></a><span id="l30.107"> </span>
<a href="#l30.108"></a><span id="l30.108" class="difflineminus">-        // delete default 0 percent complete</span>
<a href="#l30.109"></a><span id="l30.109" class="difflineminus">-        task.keypress(tasklookup(`</span>
<a href="#l30.110"></a><span id="l30.110" class="difflineminus">-            ${taskDialog}/id(&quot;event-grid-todo-status-row&quot;)/</span>
<a href="#l30.111"></a><span id="l30.111" class="difflineminus">-            id(&quot;event-grid-todo-status-picker-box&quot;)/</span>
<a href="#l30.112"></a><span id="l30.112" class="difflineminus">-            id(&quot;percent-complete-textbox&quot;)/</span>
<a href="#l30.113"></a><span id="l30.113" class="difflineminus">-            anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/</span>
<a href="#l30.114"></a><span id="l30.114" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l30.115"></a><span id="l30.115" class="difflineminus">-        `), &quot;VK_DELETE&quot;, {});</span>
<a href="#l30.116"></a><span id="l30.116" class="difflineminus">-        task.type(tasklookup(`</span>
<a href="#l30.117"></a><span id="l30.117" class="difflineminus">-            ${taskDialog}/id(&quot;event-grid-todo-status-row&quot;)/</span>
<a href="#l30.118"></a><span id="l30.118" class="difflineminus">-            id(&quot;event-grid-todo-status-picker-box&quot;)/</span>
<a href="#l30.119"></a><span id="l30.119" class="difflineminus">-            id(&quot;percent-complete-textbox&quot;)/</span>
<a href="#l30.120"></a><span id="l30.120" class="difflineminus">-            anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/</span>
<a href="#l30.121"></a><span id="l30.121" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l30.122"></a><span id="l30.122" class="difflineminus">-        `), percentComplete);</span>
<a href="#l30.123"></a><span id="l30.123" class="difflineplus">+        setData(task, iframe, { status: &quot;needs-action&quot;, percent: percentComplete, description: DESCRIPTION });</span>
<a href="#l30.124"></a><span id="l30.124"> </span>
<a href="#l30.125"></a><span id="l30.125">         // save</span>
<a href="#l30.126"></a><span id="l30.126">         task.click(taskid(&quot;button-saveandclose&quot;));</span>
<a href="#l30.127"></a><span id="l30.127">     });</span>
<a href="#l30.128"></a><span id="l30.128"> </span>
<a href="#l30.129"></a><span id="l30.129">     // verify description and status in details pane</span>
<a href="#l30.130"></a><span id="l30.130">     controller.assertValue(lookup(`</span>
<a href="#l30.131"></a><span id="l30.131">         ${taskView}/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;calendar-task-details-container&quot;)/</span>
<a href="#l30.132"></a><span id="l30.132">         id(&quot;calendar-task-details-description&quot;)/</span>
<a href="#l30.133"></a><span id="l30.133">         anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l30.134"></a><span id="l30.134">     `), DESCRIPTION);</span>
<a href="#l30.135"></a><span id="l30.135" class="difflineminus">-    let status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;, &quot;taskDetailsStatusNeedsAction&quot;);</span>
<a href="#l30.136"></a><span id="l30.136" class="difflineminus">-    controller.assertValue(eid(&quot;calendar-task-details-status&quot;), status);</span>
<a href="#l30.137"></a><span id="l30.137" class="difflineplus">+    controller.assertValue(eid(&quot;calendar-task-details-status&quot;), &quot;Needs Action&quot;);</span>
<a href="#l30.138"></a><span id="l30.138" class="difflineplus">+</span>
<a href="#l30.139"></a><span id="l30.139" class="difflineplus">+    // This is a hack.</span>
<a href="#l30.140"></a><span id="l30.140" class="difflineplus">+    taskTreeNode.getTaskAtRow(0).calendar.setProperty(&quot;capabilities.priority.supported&quot;, true);</span>
<a href="#l30.141"></a><span id="l30.141"> </span>
<a href="#l30.142"></a><span id="l30.142">     // set high priority and verify it in detail pane</span>
<a href="#l30.143"></a><span id="l30.143">     controller.click(eid(&quot;task-actions-priority&quot;));</span>
<a href="#l30.144"></a><span id="l30.144">     sleep();</span>
<a href="#l30.145"></a><span id="l30.145">     controller.click(eid(&quot;priority-1-menuitem&quot;));</span>
<a href="#l30.146"></a><span id="l30.146">     sleep();</span>
<a href="#l30.147"></a><span id="l30.147">     let priorityNode = eid(&quot;calendar-task-details-priority-high&quot;);</span>
<a href="#l30.148"></a><span id="l30.148">     controller.assertNotDOMProperty(priorityNode, &quot;hidden&quot;);</span>
<a href="#l30.149"></a><span id="l30.149" class="difflineat">@@ -151,34 +127,35 @@ function testTaskView() {</span>
<a href="#l30.150"></a><span id="l30.150">     let toolTipNode = lookup(toolTip).getNode();</span>
<a href="#l30.151"></a><span id="l30.151">     toolTipNode.ownerGlobal.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l30.152"></a><span id="l30.152"> </span>
<a href="#l30.153"></a><span id="l30.153">     let toolTipName = lookup(toolTipGrid + &quot;[1]/[0]/[1]&quot;);</span>
<a href="#l30.154"></a><span id="l30.154">     let toolTipCalendar = lookup(toolTipGrid + &quot;[1]/[1]/[1]&quot;);</span>
<a href="#l30.155"></a><span id="l30.155">     let toolTipPriority = lookup(toolTipGrid + &quot;[1]/[2]/[1]&quot;);</span>
<a href="#l30.156"></a><span id="l30.156">     let toolTipStatus = lookup(toolTipGrid + &quot;[1]/[3]/[1]&quot;);</span>
<a href="#l30.157"></a><span id="l30.157">     let toolTipComplete = lookup(toolTipGrid + &quot;[1]/[4]/[1]&quot;);</span>
<a href="#l30.158"></a><span id="l30.158" class="difflineminus">-    let priority = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;, &quot;highPriority&quot;);</span>
<a href="#l30.159"></a><span id="l30.159"> </span>
<a href="#l30.160"></a><span id="l30.160">     controller.assertJSProperty(toolTipName, &quot;textContent&quot;, TITLE);</span>
<a href="#l30.161"></a><span id="l30.161">     controller.assertJSProperty(toolTipCalendar, &quot;textContent&quot;, CALENDARNAME);</span>
<a href="#l30.162"></a><span id="l30.162" class="difflineminus">-    controller.assertJSProperty(toolTipPriority, &quot;textContent&quot;, priority);</span>
<a href="#l30.163"></a><span id="l30.163" class="difflineminus">-    controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l30.164"></a><span id="l30.164" class="difflineplus">+    controller.assertJSProperty(toolTipPriority, &quot;textContent&quot;, &quot;High&quot;);</span>
<a href="#l30.165"></a><span id="l30.165" class="difflineplus">+    controller.assertJSProperty(toolTipStatus, &quot;textContent&quot;, &quot;Needs Action&quot;);</span>
<a href="#l30.166"></a><span id="l30.166">     controller.assertJSProperty(toolTipComplete, &quot;textContent&quot;, percentComplete + &quot;%&quot;);</span>
<a href="#l30.167"></a><span id="l30.167"> </span>
<a href="#l30.168"></a><span id="l30.168">     // mark completed, verify</span>
<a href="#l30.169"></a><span id="l30.169">     controller.click(eid(&quot;task-actions-markcompleted&quot;));</span>
<a href="#l30.170"></a><span id="l30.170">     sleep();</span>
<a href="#l30.171"></a><span id="l30.171"> </span>
<a href="#l30.172"></a><span id="l30.172" class="difflineminus">-    status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;, &quot;taskDetailsStatusCompleted&quot;);</span>
<a href="#l30.173"></a><span id="l30.173">     toolTipNode.ownerGlobal.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l30.174"></a><span id="l30.174" class="difflineminus">-    controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l30.175"></a><span id="l30.175" class="difflineplus">+    controller.assertJSProperty(toolTipStatus, &quot;textContent&quot;, &quot;Completed&quot;);</span>
<a href="#l30.176"></a><span id="l30.176"> </span>
<a href="#l30.177"></a><span id="l30.177">     // delete task, verify</span>
<a href="#l30.178"></a><span id="l30.178">     controller.click(eid(&quot;task-context-menu-delete&quot;));</span>
<a href="#l30.179"></a><span id="l30.179">     controller.click(eid(&quot;calendar-delete-task-button&quot;));</span>
<a href="#l30.180"></a><span id="l30.180" class="difflineminus">-    let countAfterDelete = taskTreeNode.mTaskArray.length;</span>
<a href="#l30.181"></a><span id="l30.181" class="difflineminus">-    controller.assertJS(countAfter - 1 == countAfterDelete);</span>
<a href="#l30.182"></a><span id="l30.182" class="difflineplus">+    let countAfterDelete;</span>
<a href="#l30.183"></a><span id="l30.183" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l30.184"></a><span id="l30.184" class="difflineplus">+        countAfterDelete = taskTreeNode.mTaskArray.length;</span>
<a href="#l30.185"></a><span id="l30.185" class="difflineplus">+        return countAfter - 1 == countAfterDelete;</span>
<a href="#l30.186"></a><span id="l30.186" class="difflineplus">+    });</span>
<a href="#l30.187"></a><span id="l30.187"> }</span>
<a href="#l30.188"></a><span id="l30.188"> </span>
<a href="#l30.189"></a><span id="l30.189"> function teardownTest(module) {</span>
<a href="#l30.190"></a><span id="l30.190">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l30.191"></a><span id="l30.191"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -3,170 +3,142 @@</span>
<a href="#l31.4"></a><span id="l31.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l31.7"></a><span id="l31.7"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l31.8"></a><span id="l31.8"> </span>
<a href="#l31.9"></a><span id="l31.9"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;, null);</span>
<a href="#l31.10"></a><span id="l31.10"> </span>
<a href="#l31.11"></a><span id="l31.11"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-var CALENDARNAME;</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+var goToDate, setData, lookupEventBox;</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+var CALENDARNAME, CANVAS_BOX, EVENT_BOX;</span>
<a href="#l31.15"></a><span id="l31.15"> </span>
<a href="#l31.16"></a><span id="l31.16"> var TITLE1 = &quot;Week View Event&quot;;</span>
<a href="#l31.17"></a><span id="l31.17"> var TITLE2 = &quot;Week View Event Changed&quot;;</span>
<a href="#l31.18"></a><span id="l31.18"> var DESC = &quot;Week View Event Description&quot;;</span>
<a href="#l31.19"></a><span id="l31.19"> </span>
<a href="#l31.20"></a><span id="l31.20"> function setupModule(module) {</span>
<a href="#l31.21"></a><span id="l31.21">     controller = mozmill.getMail3PaneController();</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineminus">-</span>
<a href="#l31.23"></a><span id="l31.23">     ({</span>
<a href="#l31.24"></a><span id="l31.24">         helpersForController,</span>
<a href="#l31.25"></a><span id="l31.25">         invokeEventDialog,</span>
<a href="#l31.26"></a><span id="l31.26">         createCalendar,</span>
<a href="#l31.27"></a><span id="l31.27">         deleteCalendars,</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineminus">-        CALENDARNAME</span>
<a href="#l31.29"></a><span id="l31.29" class="difflineplus">+        goToDate,</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineplus">+        setData,</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineplus">+        lookupEventBox,</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l31.34"></a><span id="l31.34" class="difflineplus">+        EVENT_BOX</span>
<a href="#l31.35"></a><span id="l31.35">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l31.36"></a><span id="l31.36">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l31.37"></a><span id="l31.37">     Object.assign(module, helpersForController(controller));</span>
<a href="#l31.38"></a><span id="l31.38"> </span>
<a href="#l31.39"></a><span id="l31.39">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l31.40"></a><span id="l31.40"> }</span>
<a href="#l31.41"></a><span id="l31.41"> </span>
<a href="#l31.42"></a><span id="l31.42"> function testWeekView() {</span>
<a href="#l31.43"></a><span id="l31.43">     let dateFormatter = cal.getDateFormatter();</span>
<a href="#l31.44"></a><span id="l31.44">     // paths</span>
<a href="#l31.45"></a><span id="l31.45" class="difflineminus">-    let miniMonth = `</span>
<a href="#l31.46"></a><span id="l31.46" class="difflineminus">-        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l31.47"></a><span id="l31.47" class="difflineminus">-        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l31.48"></a><span id="l31.48" class="difflineminus">-        id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l31.49"></a><span id="l31.49" class="difflineminus">-        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/</span>
<a href="#l31.50"></a><span id="l31.50" class="difflineminus">-    `;</span>
<a href="#l31.51"></a><span id="l31.51">     let weekView = `</span>
<a href="#l31.52"></a><span id="l31.52">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l31.53"></a><span id="l31.53">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l31.54"></a><span id="l31.54">         id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l31.55"></a><span id="l31.55" class="difflineminus">-        id(&quot;week-view&quot;)/;</span>
<a href="#l31.56"></a><span id="l31.56" class="difflineminus">-    `;</span>
<a href="#l31.57"></a><span id="l31.57" class="difflineminus">-    let eventDialog = `</span>
<a href="#l31.58"></a><span id="l31.58" class="difflineminus">-        /id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineminus">-    `;</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineminus">-    let eventBox = `</span>
<a href="#l31.61"></a><span id="l31.61" class="difflineminus">-        ${weekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l31.62"></a><span id="l31.62" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;daybox&quot;})/[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l31.63"></a><span id="l31.63" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l31.64"></a><span id="l31.64" class="difflineminus">-        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}</span>
<a href="#l31.65"></a><span id="l31.65" class="difflineplus">+        id(&quot;week-view&quot;)/</span>
<a href="#l31.66"></a><span id="l31.66">     `;</span>
<a href="#l31.67"></a><span id="l31.67"> </span>
<a href="#l31.68"></a><span id="l31.68">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l31.69"></a><span id="l31.69">     controller.waitThenClick(eid(&quot;calendar-week-view-button&quot;));</span>
<a href="#l31.70"></a><span id="l31.70"> </span>
<a href="#l31.71"></a><span id="l31.71" class="difflineminus">-    // pick year</span>
<a href="#l31.72"></a><span id="l31.72" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l31.73"></a><span id="l31.73" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l31.74"></a><span id="l31.74" class="difflineminus">-    `));</span>
<a href="#l31.75"></a><span id="l31.75" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l31.76"></a><span id="l31.76" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l31.77"></a><span id="l31.77" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/</span>
<a href="#l31.78"></a><span id="l31.78" class="difflineminus">-        {&quot;value&quot;:&quot;2009&quot;}</span>
<a href="#l31.79"></a><span id="l31.79" class="difflineminus">-    `));</span>
<a href="#l31.80"></a><span id="l31.80" class="difflineminus">-</span>
<a href="#l31.81"></a><span id="l31.81" class="difflineminus">-    // pick month</span>
<a href="#l31.82"></a><span id="l31.82" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l31.83"></a><span id="l31.83" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l31.84"></a><span id="l31.84" class="difflineminus">-    `));</span>
<a href="#l31.85"></a><span id="l31.85" class="difflineminus">-    controller.click(lookup(`</span>
<a href="#l31.86"></a><span id="l31.86" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l31.87"></a><span id="l31.87" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/</span>
<a href="#l31.88"></a><span id="l31.88" class="difflineminus">-        {&quot;index&quot;:&quot;0&quot;}'</span>
<a href="#l31.89"></a><span id="l31.89" class="difflineminus">-    `));</span>
<a href="#l31.90"></a><span id="l31.90" class="difflineminus">-</span>
<a href="#l31.91"></a><span id="l31.91" class="difflineminus">-    // pick day</span>
<a href="#l31.92"></a><span id="l31.92" class="difflineminus">-    controller.waitThenClick(lookup(`</span>
<a href="#l31.93"></a><span id="l31.93" class="difflineminus">-        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}</span>
<a href="#l31.94"></a><span id="l31.94" class="difflineminus">-    `));</span>
<a href="#l31.95"></a><span id="l31.95" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l31.96"></a><span id="l31.96"> </span>
<a href="#l31.97"></a><span id="l31.97">     // verify date</span>
<a href="#l31.98"></a><span id="l31.98">     let day = lookup(`</span>
<a href="#l31.99"></a><span id="l31.99" class="difflineminus">-        ${weekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/</span>
<a href="#l31.100"></a><span id="l31.100" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/{&quot;selected&quot;:&quot;true&quot;}</span>
<a href="#l31.101"></a><span id="l31.101" class="difflineplus">+        ${weekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;headerbox&quot;})/</span>
<a href="#l31.102"></a><span id="l31.102" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;headerdaybox&quot;})/{&quot;selected&quot;:&quot;true&quot;}</span>
<a href="#l31.103"></a><span id="l31.103">     `);</span>
<a href="#l31.104"></a><span id="l31.104">     controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l31.105"></a><span id="l31.105"> </span>
<a href="#l31.106"></a><span id="l31.106">     // create event at 8 AM</span>
<a href="#l31.107"></a><span id="l31.107">     // Thursday of 2009-01-01 is 4th with default settings</span>
<a href="#l31.108"></a><span id="l31.108" class="difflineminus">-    eventBox = lookup(`</span>
<a href="#l31.109"></a><span id="l31.109" class="difflineminus">-        ${weekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l31.110"></a><span id="l31.110" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;daybox&quot;})/[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l31.111"></a><span id="l31.111" class="difflineminus">-        anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1</span>
<a href="#l31.112"></a><span id="l31.112" class="difflineminus">-    `);</span>
<a href="#l31.113"></a><span id="l31.113" class="difflineplus">+    let eventBox = lookupEventBox(&quot;week&quot;, CANVAS_BOX, null, 5, 8);</span>
<a href="#l31.114"></a><span id="l31.114">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l31.115"></a><span id="l31.115" class="difflineminus">-        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l31.116"></a><span id="l31.116" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l31.117"></a><span id="l31.117" class="difflineplus">+        let { lookup: iframeLookup } = helpersForController(iframe);</span>
<a href="#l31.118"></a><span id="l31.118"> </span>
<a href="#l31.119"></a><span id="l31.119" class="difflineminus">-        // check that the start time is correct</span>
<a href="#l31.120"></a><span id="l31.120" class="difflineminus">-        let startTimeInput = eventlookup(`</span>
<a href="#l31.121"></a><span id="l31.121" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l31.122"></a><span id="l31.122" class="difflineminus">-            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l31.123"></a><span id="l31.123" class="difflineplus">+        let innerFrame = '/id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l31.124"></a><span id="l31.124" class="difflineplus">+        let dateInput = `</span>
<a href="#l31.125"></a><span id="l31.125" class="difflineplus">+            anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l31.126"></a><span id="l31.126" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l31.127"></a><span id="l31.127" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l31.128"></a><span id="l31.128" class="difflineplus">+        `;</span>
<a href="#l31.129"></a><span id="l31.129" class="difflineplus">+        let timeInput = `</span>
<a href="#l31.130"></a><span id="l31.130">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l31.131"></a><span id="l31.131">             anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l31.132"></a><span id="l31.132">             anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l31.133"></a><span id="l31.133" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l31.134"></a><span id="l31.134" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l31.135"></a><span id="l31.135" class="difflineplus">+        `;</span>
<a href="#l31.136"></a><span id="l31.136" class="difflineplus">+        let startId = &quot;event-starttime&quot;;</span>
<a href="#l31.137"></a><span id="l31.137" class="difflineplus">+</span>
<a href="#l31.138"></a><span id="l31.138" class="difflineplus">+        let startTimeInput = iframeLookup(`</span>
<a href="#l31.139"></a><span id="l31.139" class="difflineplus">+            ${innerFrame}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l31.140"></a><span id="l31.140" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;${startId}&quot;)/${timeInput}</span>
<a href="#l31.141"></a><span id="l31.141">         `);</span>
<a href="#l31.142"></a><span id="l31.142" class="difflineplus">+        let startDateInput = iframeLookup(`</span>
<a href="#l31.143"></a><span id="l31.143" class="difflineplus">+            ${innerFrame}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l31.144"></a><span id="l31.144" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;${startId}&quot;)/</span>
<a href="#l31.145"></a><span id="l31.145" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/${dateInput}</span>
<a href="#l31.146"></a><span id="l31.146" class="difflineplus">+        `);</span>
<a href="#l31.147"></a><span id="l31.147" class="difflineplus">+</span>
<a href="#l31.148"></a><span id="l31.148" class="difflineplus">+        // check that the start time is correct</span>
<a href="#l31.149"></a><span id="l31.149">         event.waitForElement(startTimeInput);</span>
<a href="#l31.150"></a><span id="l31.150" class="difflineminus">-        event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l31.151"></a><span id="l31.151" class="difflineminus">-        let someTime = cal.createDateTime();</span>
<a href="#l31.152"></a><span id="l31.152" class="difflineminus">-        someTime.resetTo(2009, 1, 1);</span>
<a href="#l31.153"></a><span id="l31.153" class="difflineminus">-        let date = dateFormatter.formatDateShort(someDate);</span>
<a href="#l31.154"></a><span id="l31.154" class="difflineminus">-        event.assertValue(eventlookup(`</span>
<a href="#l31.155"></a><span id="l31.155" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l31.156"></a><span id="l31.156" class="difflineminus">-            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l31.157"></a><span id="l31.157" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l31.158"></a><span id="l31.158" class="difflineminus">-            anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l31.159"></a><span id="l31.159" class="difflineminus">-            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l31.160"></a><span id="l31.160" class="difflineminus">-            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l31.161"></a><span id="l31.161" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l31.162"></a><span id="l31.162" class="difflineminus">-        `), date);</span>
<a href="#l31.163"></a><span id="l31.163" class="difflineplus">+        let someDate = cal.createDateTime();</span>
<a href="#l31.164"></a><span id="l31.164" class="difflineplus">+        someDate.resetTo(2009, 0, 1, 8, 0, 0, cal.dtz.floating);</span>
<a href="#l31.165"></a><span id="l31.165" class="difflineplus">+        event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l31.166"></a><span id="l31.166" class="difflineplus">+        event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l31.167"></a><span id="l31.167"> </span>
<a href="#l31.168"></a><span id="l31.168">         // fill in title, description and calendar</span>
<a href="#l31.169"></a><span id="l31.169" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l31.170"></a><span id="l31.170" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l31.171"></a><span id="l31.171" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l31.172"></a><span id="l31.172" class="difflineminus">-        `), TITLE1);</span>
<a href="#l31.173"></a><span id="l31.173" class="difflineminus">-        event.type(eventlookup(`</span>
<a href="#l31.174"></a><span id="l31.174" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l31.175"></a><span id="l31.175" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l31.176"></a><span id="l31.176" class="difflineminus">-        `), DESC);</span>
<a href="#l31.177"></a><span id="l31.177" class="difflineminus">-        event.select(eventid(&quot;item-calendar&quot;), null, CALENDARNAME);</span>
<a href="#l31.178"></a><span id="l31.178" class="difflineplus">+        setData(event, iframe, { title: TITLE1, description: DESC, calendar: CALENDARNAME });</span>
<a href="#l31.179"></a><span id="l31.179"> </span>
<a href="#l31.180"></a><span id="l31.180">         // save</span>
<a href="#l31.181"></a><span id="l31.181">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l31.182"></a><span id="l31.182">     });</span>
<a href="#l31.183"></a><span id="l31.183"> </span>
<a href="#l31.184"></a><span id="l31.184" class="difflineplus">+    // if it was created successfully, it can be opened</span>
<a href="#l31.185"></a><span id="l31.185" class="difflineplus">+    eventBox = lookupEventBox(</span>
<a href="#l31.186"></a><span id="l31.186" class="difflineplus">+        &quot;week&quot;, EVENT_BOX, null, 5, 8,</span>
<a href="#l31.187"></a><span id="l31.187" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l31.188"></a><span id="l31.188" class="difflineplus">+    );</span>
<a href="#l31.189"></a><span id="l31.189">     invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l31.190"></a><span id="l31.190" class="difflineminus">-        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l31.191"></a><span id="l31.191" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l31.192"></a><span id="l31.192"> </span>
<a href="#l31.193"></a><span id="l31.193">         // change title and save changes</span>
<a href="#l31.194"></a><span id="l31.194" class="difflineminus">-        let titleTextBox = eventlookup(`</span>
<a href="#l31.195"></a><span id="l31.195" class="difflineminus">-            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l31.196"></a><span id="l31.196" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l31.197"></a><span id="l31.197" class="difflineminus">-        `);</span>
<a href="#l31.198"></a><span id="l31.198" class="difflineminus">-        event.waitForElement(titleTextBox);</span>
<a href="#l31.199"></a><span id="l31.199" class="difflineminus">-        event.type(titleTextBox, TITLE2);</span>
<a href="#l31.200"></a><span id="l31.200" class="difflineplus">+        setData(event, iframe, { title: TITLE2 });</span>
<a href="#l31.201"></a><span id="l31.201">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l31.202"></a><span id="l31.202">     });</span>
<a href="#l31.203"></a><span id="l31.203"> </span>
<a href="#l31.204"></a><span id="l31.204">     // check if name was saved</span>
<a href="#l31.205"></a><span id="l31.205" class="difflineminus">-    let eventName = lookup(`</span>
<a href="#l31.206"></a><span id="l31.206" class="difflineminus">-        ${eventBox}//anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l31.207"></a><span id="l31.207" class="difflineplus">+    let eventName = lookupEventBox(</span>
<a href="#l31.208"></a><span id="l31.208" class="difflineplus">+        &quot;week&quot;, EVENT_BOX, null, 5, 8,</span>
<a href="#l31.209"></a><span id="l31.209" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}/</span>
<a href="#l31.210"></a><span id="l31.210" class="difflineplus">+        anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l31.211"></a><span id="l31.211">         {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l31.212"></a><span id="l31.212" class="difflineminus">-        {&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})'</span>
<a href="#l31.213"></a><span id="l31.213" class="difflineminus">-    `);</span>
<a href="#l31.214"></a><span id="l31.214" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l31.215"></a><span id="l31.215" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;event-name&quot;})`</span>
<a href="#l31.216"></a><span id="l31.216" class="difflineplus">+    );</span>
<a href="#l31.217"></a><span id="l31.217">     controller.waitForElement(eventName);</span>
<a href="#l31.218"></a><span id="l31.218">     controller.assertJSProperty(eventName, &quot;textContent&quot;, TITLE2);</span>
<a href="#l31.219"></a><span id="l31.219"> </span>
<a href="#l31.220"></a><span id="l31.220">     // delete event</span>
<a href="#l31.221"></a><span id="l31.221" class="difflineminus">-    controller.click(lookup(eventBox));</span>
<a href="#l31.222"></a><span id="l31.222" class="difflineplus">+    controller.click(lookupEventBox(</span>
<a href="#l31.223"></a><span id="l31.223" class="difflineplus">+        &quot;week&quot;, EVENT_BOX, null, 5, 8,</span>
<a href="#l31.224"></a><span id="l31.224" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l31.225"></a><span id="l31.225" class="difflineplus">+    ));</span>
<a href="#l31.226"></a><span id="l31.226">     controller.keypress(eid(&quot;week-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l31.227"></a><span id="l31.227" class="difflineminus">-    controller.waitForElementNotPresent(lookup(eventBox));</span>
<a href="#l31.228"></a><span id="l31.228" class="difflineplus">+    controller.waitForElementNotPresent(lookupEventBox(</span>
<a href="#l31.229"></a><span id="l31.229" class="difflineplus">+        &quot;week&quot;, EVENT_BOX, null, 5, 8,</span>
<a href="#l31.230"></a><span id="l31.230" class="difflineplus">+        `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`</span>
<a href="#l31.231"></a><span id="l31.231" class="difflineplus">+    ));</span>
<a href="#l31.232"></a><span id="l31.232"> }</span>
<a href="#l31.233"></a><span id="l31.233"> </span>
<a href="#l31.234"></a><span id="l31.234"> function teardownTest(module) {</span>
<a href="#l31.235"></a><span id="l31.235">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l31.236"></a><span id="l31.236"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/test/mozmill/runtest.py</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/test/mozmill/runtest.py</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -444,17 +444,17 @@ def logFailure(obj):</span>
<a href="#l32.4"></a><span id="l32.4"> mozmill.LoggerListener.cases['mozmill.fail'] = logFailure</span>
<a href="#l32.5"></a><span id="l32.5"> </span>
<a href="#l32.6"></a><span id="l32.6"> </span>
<a href="#l32.7"></a><span id="l32.7"> def prettifyFilename(path, tail_segs_desired=1):</span>
<a href="#l32.8"></a><span id="l32.8">     parts = path.split('/')</span>
<a href="#l32.9"></a><span id="l32.9">     return '/'.join(parts[-tail_segs_desired:])</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11"> def prettyPrintException(e):</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-    print '  EXCEPTION:', e.get('message', 'no message!')</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+    print '  EXCEPTION:', e.get('message', 'no message!').encode('utf-8')</span>
<a href="#l32.14"></a><span id="l32.14">     print '    at:', prettifyFilename(e.get('fileName', 'nonesuch')), 'line', e.get('lineNumber', 0)</span>
<a href="#l32.15"></a><span id="l32.15">     if 'stack' in e:</span>
<a href="#l32.16"></a><span id="l32.16">         for line in e['stack'].splitlines():</span>
<a href="#l32.17"></a><span id="l32.17">             if not line:</span>
<a href="#l32.18"></a><span id="l32.18">                 continue</span>
<a href="#l32.19"></a><span id="l32.19">             if line[0] == &quot;(&quot;:</span>
<a href="#l32.20"></a><span id="l32.20">                 funcname = None</span>
<a href="#l32.21"></a><span id="l32.21">             elif line[0] == &quot;@&quot;:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/content/modules/controller.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/content/modules/controller.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -762,17 +762,17 @@ MozMillController.prototype.fireEvent = </span>
<a href="#l33.4"></a><span id="l33.4"> MozMillController.prototype.startUserShutdown = function (timeout, restart) {</span>
<a href="#l33.5"></a><span id="l33.5">   // 0 = default shutdown, 1 = user shutdown, 2 = user restart</span>
<a href="#l33.6"></a><span id="l33.6">   this.fireEvent('userShutdown', restart ? 2 : 1);</span>
<a href="#l33.7"></a><span id="l33.7">   this.window.setTimeout(this.fireEvent, timeout, 'userShutdown', 0);</span>
<a href="#l33.8"></a><span id="l33.8"> }</span>
<a href="#l33.9"></a><span id="l33.9"> </span>
<a href="#l33.10"></a><span id="l33.10"> /* Select the specified option and trigger the relevant events of the element.*/</span>
<a href="#l33.11"></a><span id="l33.11"> MozMillController.prototype.select = function (el, indx, option, value) {</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  element = el.getNode();</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+  var element = el.getNode();</span>
<a href="#l33.14"></a><span id="l33.14">   if (!element){</span>
<a href="#l33.15"></a><span id="l33.15">     throw new Error(&quot;Could not find element &quot; + el.getInfo());</span>
<a href="#l33.16"></a><span id="l33.16">     return false;</span>
<a href="#l33.17"></a><span id="l33.17">   }</span>
<a href="#l33.18"></a><span id="l33.18"> </span>
<a href="#l33.19"></a><span id="l33.19">   //if we have a select drop down</span>
<a href="#l33.20"></a><span id="l33.20">   if (element.localName.toLowerCase() == &quot;select&quot;){</span>
<a href="#l33.21"></a><span id="l33.21">     var item = null;</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineat">@@ -812,17 +812,17 @@ MozMillController.prototype.select = fun</span>
<a href="#l33.23"></a><span id="l33.23">       return true;</span>
<a href="#l33.24"></a><span id="l33.24">     } catch (ex) {</span>
<a href="#l33.25"></a><span id="l33.25">       throw new Error(&quot;No item selected for element &quot; + el.getInfo());</span>
<a href="#l33.26"></a><span id="l33.26">      return false;</span>
<a href="#l33.27"></a><span id="l33.27">    }</span>
<a href="#l33.28"></a><span id="l33.28">   }</span>
<a href="#l33.29"></a><span id="l33.29">   //if we have a xul menulist select accordingly</span>
<a href="#l33.30"></a><span id="l33.30">   else if (element.localName.toLowerCase() == &quot;menulist&quot;) {</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-    ownerDoc = element.ownerDocument;</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+    var ownerDoc = element.ownerDocument;</span>
<a href="#l33.33"></a><span id="l33.33">     // Unwrap the XUL element's XPCNativeWrapper</span>
<a href="#l33.34"></a><span id="l33.34">     if (element.namespaceURI.toLowerCase() == &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;) {</span>
<a href="#l33.35"></a><span id="l33.35">       element = utils.unwrapNode(element);</span>
<a href="#l33.36"></a><span id="l33.36">     }</span>
<a href="#l33.37"></a><span id="l33.37"> </span>
<a href="#l33.38"></a><span id="l33.38">     var item = null;</span>
<a href="#l33.39"></a><span id="l33.39"> </span>
<a href="#l33.40"></a><span id="l33.40">     if (indx != undefined) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/content/modules/frame.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/content/modules/frame.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -105,17 +105,17 @@ var loadFile = function(path, collector)</span>
<a href="#l34.4"></a><span id="l34.4">   module.persisted = persisted;</span>
<a href="#l34.5"></a><span id="l34.5">   module.Cc = Cc;</span>
<a href="#l34.6"></a><span id="l34.6">   module.Ci = Ci;</span>
<a href="#l34.7"></a><span id="l34.7">   module.Cu = Cu;</span>
<a href="#l34.8"></a><span id="l34.8">   module.require = function (mod) {</span>
<a href="#l34.9"></a><span id="l34.9">     var loader = new securableModule.Loader({</span>
<a href="#l34.10"></a><span id="l34.10">       rootPaths: [ios.newFileURI(file.parent).spec],</span>
<a href="#l34.11"></a><span id="l34.11">       defaultPrincipal: &quot;system&quot;,</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-      globals : { mozmill, elementslib, persistsed, Cc, Ci, Cu }</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+      globals : { mozmill, elementslib, persisted, Cc, Ci, Cu }</span>
<a href="#l34.14"></a><span id="l34.14">     });</span>
<a href="#l34.15"></a><span id="l34.15">     if (modules != undefined) {</span>
<a href="#l34.16"></a><span id="l34.16">         loader.modules = modules;</span>
<a href="#l34.17"></a><span id="l34.17">     }</span>
<a href="#l34.18"></a><span id="l34.18">     var retval = loader.require(mod);</span>
<a href="#l34.19"></a><span id="l34.19">     modules = loader.modules;</span>
<a href="#l34.20"></a><span id="l34.20">     return retval;</span>
<a href="#l34.21"></a><span id="l34.21">   }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

