<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 13565:117ad84fb83e393e9cec56347c13e634c7c5d454</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 117ad84fb83e393e9cec56347c13e634c7c5d454" />
<meta property="og:url" content="/comm-central/rev/117ad84fb83e393e9cec56347c13e634c7c5d454" />
<meta property="og:description" content="Bug 945045 - Remove nsISupportsArray in mailnews/import. r=Standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 117ad84fb83e393e9cec56347c13e634c7c5d454 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/117ad84fb83e393e9cec56347c13e634c7c5d454">shortlog</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/117ad84fb83e393e9cec56347c13e634c7c5d454">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454">files</a> |
changeset |
<a href="/comm-central/raw-rev/117ad84fb83e393e9cec56347c13e634c7c5d454">raw</a>  | <a href="/comm-central/archive/117ad84fb83e393e9cec56347c13e634c7c5d454.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=945045">Bug 945045</a> - Remove nsISupportsArray in mailnews/import. r=Standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#72;&#105;&#114;&#111;&#121;&#117;&#107;&#105;&#32;&#73;&#107;&#101;&#122;&#111;&#101;&#32;&#60;&#104;&#105;&#105;&#107;&#101;&#122;&#111;&#101;&#64;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#45;&#106;&#97;&#112;&#97;&#110;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 28 Nov 2013 07:12:07 +0900</td></tr>

<tr>
 <td>changeset 13565</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/117ad84fb83e393e9cec56347c13e634c7c5d454">117ad84fb83e393e9cec56347c13e634c7c5d454</a></td>
</tr>



<tr>
<td>parent 13564</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/79082bf84f95ecd8966bc61d73ff03c4e2e81c2f">79082bf84f95ecd8966bc61d73ff03c4e2e81c2f</a>
</td>
</tr>

<tr>
<td>child 13566</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9eb3e41bab9bff569c7c6b939e593b390c67c287">9eb3e41bab9bff569c7c6b939e593b390c67c287</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=117ad84fb83e393e9cec56347c13e634c7c5d454">9757</a></td></tr>
<tr><td>push user</td><td>ryanvm@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 06 Jan 2014 14:32:12 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@117ad84fb83e [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=117ad84fb83e393e9cec56347c13e634c7c5d454">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=117ad84fb83e393e9cec56347c13e634c7c5d454&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=117ad84fb83e393e9cec56347c13e634c7c5d454&newProject=comm-central&newRevision=4b1338309c260cf48cb300ac019f5e85dc1e7e97&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=117ad84fb83e393e9cec56347c13e634c7c5d454&newProject=comm-central&newRevision=4b1338309c260cf48cb300ac019f5e85dc1e7e97&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=117ad84fb83e393e9cec56347c13e634c7c5d454&newProject=comm-central&newRevision=4b1338309c260cf48cb300ac019f5e85dc1e7e97&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=945045">945045</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=945045">Bug 945045</a> - Remove nsISupportsArray in mailnews/import. r=Standard8
CLOSED TREE</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.cpp">mailnews/import/applemail/src/nsAppleMailImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.h">mailnews/import/applemail/src/nsAppleMailImport.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.h">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.h">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.h">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.h">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/applemail/src/nsAppleMailImport.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraAddress.h">mailnews/import/eudora/src/nsEudoraAddress.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraAddress.h">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraAddress.h">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraAddress.h">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraAddress.h">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraAddress.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraCompose.cpp">mailnews/import/eudora/src/nsEudoraCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraCompose.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraCompose.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraCompose.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraCompose.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.cpp">mailnews/import/eudora/src/nsEudoraEditor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.h">mailnews/import/eudora/src/nsEudoraEditor.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.h">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.h">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.h">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.h">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraEditor.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.cpp">mailnews/import/eudora/src/nsEudoraFilters.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.h">mailnews/import/eudora/src/nsEudoraFilters.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.h">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.h">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.h">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.h">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraFilters.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraImport.cpp">mailnews/import/eudora/src/nsEudoraImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraImport.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraImport.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraImport.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraImport.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.cpp">mailnews/import/eudora/src/nsEudoraMac.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.h">mailnews/import/eudora/src/nsEudoraMac.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.h">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.h">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.h">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.h">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMac.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMailbox.h">mailnews/import/eudora/src/nsEudoraMailbox.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMailbox.h">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMailbox.h">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMailbox.h">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMailbox.h">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraMailbox.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.cpp">mailnews/import/eudora/src/nsEudoraWin32.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.h">mailnews/import/eudora/src/nsEudoraWin32.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.h">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.h">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.h">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.h">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/eudora/src/nsEudoraWin32.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEImport.cpp">mailnews/import/oexpress/nsOEImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEImport.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEImport.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEImport.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEImport.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.cpp">mailnews/import/oexpress/nsOEScanBoxes.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.h">mailnews/import/oexpress/nsOEScanBoxes.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.h">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.h">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.h">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.h">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/oexpress/nsOEScanBoxes.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookCompose.cpp">mailnews/import/outlook/src/nsOutlookCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookCompose.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookCompose.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookCompose.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookCompose.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookImport.cpp">mailnews/import/outlook/src/nsOutlookImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookImport.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookImport.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookImport.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookImport.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.cpp">mailnews/import/outlook/src/nsOutlookMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.h">mailnews/import/outlook/src/nsOutlookMail.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.h">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.h">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.h">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.h">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/outlook/src/nsOutlookMail.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportAddressBooks.idl">mailnews/import/public/nsIImportAddressBooks.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportAddressBooks.idl">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportAddressBooks.idl">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportAddressBooks.idl">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportAddressBooks.idl">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportAddressBooks.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportGeneric.idl">mailnews/import/public/nsIImportGeneric.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportGeneric.idl">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportGeneric.idl">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportGeneric.idl">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportGeneric.idl">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportGeneric.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportMail.idl">mailnews/import/public/nsIImportMail.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportMail.idl">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportMail.idl">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportMail.idl">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportMail.idl">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportMail.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportService.idl">mailnews/import/public/nsIImportService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportService.idl">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportService.idl">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportService.idl">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportService.idl">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/public/nsIImportService.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportAddressBooks.cpp">mailnews/import/src/nsImportAddressBooks.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportAddressBooks.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportAddressBooks.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportAddressBooks.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportAddressBooks.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportAddressBooks.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportMail.cpp">mailnews/import/src/nsImportMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportMail.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportMail.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportMail.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportMail.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportService.cpp">mailnews/import/src/nsImportService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportService.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportService.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportService.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportService.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/src/nsImportService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/test/unit/resources/TestMailImporter.js">mailnews/import/test/unit/resources/TestMailImporter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/test/unit/resources/TestMailImporter.js">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/test/unit/resources/TestMailImporter.js">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/test/unit/resources/TestMailImporter.js">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/test/unit/resources/TestMailImporter.js">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/test/unit/resources/TestMailImporter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/text/src/nsTextImport.cpp">mailnews/import/text/src/nsTextImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/text/src/nsTextImport.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/text/src/nsTextImport.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/text/src/nsTextImport.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/text/src/nsTextImport.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/text/src/nsTextImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/vcard/src/nsVCardImport.cpp">mailnews/import/vcard/src/nsVCardImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/vcard/src/nsVCardImport.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/vcard/src/nsVCardImport.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/vcard/src/nsVCardImport.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/vcard/src/nsVCardImport.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/vcard/src/nsVCardImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/winlivemail/nsWMImport.cpp">mailnews/import/winlivemail/nsWMImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/winlivemail/nsWMImport.cpp">file</a> |
<a href="/comm-central/annotate/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/winlivemail/nsWMImport.cpp">annotate</a> |
<a href="/comm-central/diff/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/winlivemail/nsWMImport.cpp">diff</a> |
<a href="/comm-central/comparison/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/winlivemail/nsWMImport.cpp">comparison</a> |
<a href="/comm-central/log/117ad84fb83e393e9cec56347c13e634c7c5d454/mailnews/import/winlivemail/nsWMImport.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -14,16 +14,17 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l1.5"></a><span id="l1.5"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l1.6"></a><span id="l1.6"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l1.7"></a><span id="l1.7"> #include &quot;nsIFile.h&quot;</span>
<a href="#l1.8"></a><span id="l1.8"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l1.9"></a><span id="l1.9"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l1.10"></a><span id="l1.10"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l1.11"></a><span id="l1.11"> #include &quot;nsIMsgPluggableStore.h&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l1.13"></a><span id="l1.13"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l1.14"></a><span id="l1.14"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l1.15"></a><span id="l1.15"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> #include &quot;nsEmlxHelperUtils.h&quot;</span>
<a href="#l1.18"></a><span id="l1.18"> #include &quot;nsAppleMailImport.h&quot;</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> PRLogModuleInfo *APPLEMAILLOGMODULE = nullptr;</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -175,33 +176,32 @@ NS_IMETHODIMP nsAppleMailImportMail::Get</span>
<a href="#l1.22"></a><span id="l1.22">     }</span>
<a href="#l1.23"></a><span id="l1.23">   }</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">   return NS_OK;</span>
<a href="#l1.26"></a><span id="l1.26"> }</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28"> // this is the method that initiates all searching for mailboxes.</span>
<a href="#l1.29"></a><span id="l1.29"> // it will assume that it has a directory like ~/Library/Mail/</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-NS_IMETHODIMP nsAppleMailImportMail::FindMailboxes(nsIFile *aMailboxFile, nsISupportsArray **aResult)</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+NS_IMETHODIMP nsAppleMailImportMail::FindMailboxes(nsIFile *aMailboxFile, nsIArray **aResult)</span>
<a href="#l1.32"></a><span id="l1.32"> {</span>
<a href="#l1.33"></a><span id="l1.33">   NS_ENSURE_ARG_POINTER(aMailboxFile);</span>
<a href="#l1.34"></a><span id="l1.34">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l1.35"></a><span id="l1.35"> </span>
<a href="#l1.36"></a><span id="l1.36">   IMPORT_LOG0(&quot;FindMailboxes for Apple mail invoked&quot;);</span>
<a href="#l1.37"></a><span id="l1.37"> </span>
<a href="#l1.38"></a><span id="l1.38">   bool exists = false;</span>
<a href="#l1.39"></a><span id="l1.39">   nsresult rv = aMailboxFile-&gt;Exists(&amp;exists);</span>
<a href="#l1.40"></a><span id="l1.40">   if (NS_FAILED(rv) || !exists)</span>
<a href="#l1.41"></a><span id="l1.41">     return NS_ERROR_FAILURE;</span>
<a href="#l1.42"></a><span id="l1.42"> </span>
<a href="#l1.43"></a><span id="l1.43">   nsCOMPtr&lt;nsIImportService&gt; importService(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l1.44"></a><span id="l1.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.45"></a><span id="l1.45"> </span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; resultsArray;</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-  NS_NewISupportsArray(getter_AddRefs(resultsArray));</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; resultsArray(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l1.49"></a><span id="l1.49">   if (!resultsArray)</span>
<a href="#l1.50"></a><span id="l1.50">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l1.51"></a><span id="l1.51"> </span>
<a href="#l1.52"></a><span id="l1.52">   mCurDepth = 1;</span>
<a href="#l1.53"></a><span id="l1.53"> </span>
<a href="#l1.54"></a><span id="l1.54">   // 1. look for accounts with mailboxes</span>
<a href="#l1.55"></a><span id="l1.55">   FindAccountMailDirs(aMailboxFile, resultsArray, importService);</span>
<a href="#l1.56"></a><span id="l1.56">   mCurDepth--;</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineat">@@ -219,24 +219,24 @@ NS_IMETHODIMP nsAppleMailImportMail::Fin</span>
<a href="#l1.58"></a><span id="l1.58">           mCurDepth++;</span>
<a href="#l1.59"></a><span id="l1.59">           rv = FindMboxDirs(mailboxesDir, resultsArray, importService);</span>
<a href="#l1.60"></a><span id="l1.60">           mCurDepth--;</span>
<a href="#l1.61"></a><span id="l1.61">         }</span>
<a href="#l1.62"></a><span id="l1.62">     }</span>
<a href="#l1.63"></a><span id="l1.63">   }</span>
<a href="#l1.64"></a><span id="l1.64"> </span>
<a href="#l1.65"></a><span id="l1.65">   if (NS_SUCCEEDED(rv) &amp;&amp; resultsArray)</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-    resultsArray.swap(*aResult);</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+    resultsArray.forget(aResult);</span>
<a href="#l1.68"></a><span id="l1.68"> </span>
<a href="#l1.69"></a><span id="l1.69">   return rv;</span>
<a href="#l1.70"></a><span id="l1.70"> }</span>
<a href="#l1.71"></a><span id="l1.71"> </span>
<a href="#l1.72"></a><span id="l1.72"> // operates on the Mail/ directory root, trying to find accounts (which are folders named something like &quot;POP-hwaara@gmail.com&quot;)</span>
<a href="#l1.73"></a><span id="l1.73"> // and add their .mbox dirs</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineminus">-void nsAppleMailImportMail::FindAccountMailDirs(nsIFile *aRoot, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService)</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+void nsAppleMailImportMail::FindAccountMailDirs(nsIFile *aRoot, nsIMutableArray *aMailboxDescs, nsIImportService *aImportService)</span>
<a href="#l1.76"></a><span id="l1.76"> {</span>
<a href="#l1.77"></a><span id="l1.77">   nsCOMPtr&lt;nsISimpleEnumerator&gt; directoryEnumerator;</span>
<a href="#l1.78"></a><span id="l1.78">   nsresult rv = aRoot-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l1.79"></a><span id="l1.79">   if (NS_FAILED(rv))</span>
<a href="#l1.80"></a><span id="l1.80">     return;</span>
<a href="#l1.81"></a><span id="l1.81"> </span>
<a href="#l1.82"></a><span id="l1.82">   bool hasMore = false;</span>
<a href="#l1.83"></a><span id="l1.83">   while (NS_SUCCEEDED(directoryEnumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineat">@@ -288,29 +288,29 @@ void nsAppleMailImportMail::FindAccountM</span>
<a href="#l1.85"></a><span id="l1.85">         nsCOMPtr&lt;nsIFile&gt; mailboxDescFile;</span>
<a href="#l1.86"></a><span id="l1.86">         rv = desc-&gt;GetFile(getter_AddRefs(mailboxDescFile));</span>
<a href="#l1.87"></a><span id="l1.87">         if (!mailboxDescFile)</span>
<a href="#l1.88"></a><span id="l1.88">           continue;</span>
<a href="#l1.89"></a><span id="l1.89"> </span>
<a href="#l1.90"></a><span id="l1.90">         mailboxDescFile-&gt;InitWithFile(currentEntry);</span>
<a href="#l1.91"></a><span id="l1.91"> </span>
<a href="#l1.92"></a><span id="l1.92">         // add this mailbox descriptor to the list</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineminus">-        aMailboxDescs-&gt;AppendElement(desc);</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+        aMailboxDescs-&gt;AppendElement(desc, false);</span>
<a href="#l1.95"></a><span id="l1.95"> </span>
<a href="#l1.96"></a><span id="l1.96">         // now add all the children mailboxes</span>
<a href="#l1.97"></a><span id="l1.97">         mCurDepth++;</span>
<a href="#l1.98"></a><span id="l1.98">         FindMboxDirs(currentEntry, aMailboxDescs, aImportService);</span>
<a href="#l1.99"></a><span id="l1.99">         mCurDepth--;  </span>
<a href="#l1.100"></a><span id="l1.100">       }</span>
<a href="#l1.101"></a><span id="l1.101">     }</span>
<a href="#l1.102"></a><span id="l1.102">   }</span>
<a href="#l1.103"></a><span id="l1.103"> }</span>
<a href="#l1.104"></a><span id="l1.104"> </span>
<a href="#l1.105"></a><span id="l1.105"> // adds the specified file as a mailboxdescriptor to the array</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineminus">-nsresult nsAppleMailImportMail::AddMboxDir(nsIFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService)</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+nsresult nsAppleMailImportMail::AddMboxDir(nsIFile *aFolder, nsIMutableArray *aMailboxDescs, nsIImportService *aImportService)</span>
<a href="#l1.108"></a><span id="l1.108"> {</span>
<a href="#l1.109"></a><span id="l1.109">   nsAutoString folderName;</span>
<a href="#l1.110"></a><span id="l1.110">   aFolder-&gt;GetLeafName(folderName);</span>
<a href="#l1.111"></a><span id="l1.111"> </span>
<a href="#l1.112"></a><span id="l1.112">   // cut off the suffix, if any, or prefix if this is an account folder.</span>
<a href="#l1.113"></a><span id="l1.113">   if (StringEndsWith(folderName, NS_LITERAL_STRING(POP_MBOX_SUFFIX)))</span>
<a href="#l1.114"></a><span id="l1.114">     folderName.SetLength(folderName.Length()-5);</span>
<a href="#l1.115"></a><span id="l1.115">   else if (StringEndsWith(folderName, NS_LITERAL_STRING(IMAP_MBOX_SUFFIX)))</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineat">@@ -365,33 +365,33 @@ nsresult nsAppleMailImportMail::AddMboxD</span>
<a href="#l1.117"></a><span id="l1.117">     nsCOMPtr&lt;nsIFile&gt; mailboxDescFile;</span>
<a href="#l1.118"></a><span id="l1.118">     rv = desc-&gt;GetFile(getter_AddRefs(mailboxDescFile));</span>
<a href="#l1.119"></a><span id="l1.119">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.120"></a><span id="l1.120"> </span>
<a href="#l1.121"></a><span id="l1.121">     if (mailboxDescFile)</span>
<a href="#l1.122"></a><span id="l1.122">       mailboxDescFile-&gt;InitWithFile(aFolder);</span>
<a href="#l1.123"></a><span id="l1.123"> </span>
<a href="#l1.124"></a><span id="l1.124">     // add this mailbox descriptor to the list</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineminus">-    aMailboxDescs-&gt;AppendElement(desc); </span>
<a href="#l1.126"></a><span id="l1.126" class="difflineplus">+    aMailboxDescs-&gt;AppendElement(desc, false);</span>
<a href="#l1.127"></a><span id="l1.127">   }</span>
<a href="#l1.128"></a><span id="l1.128"> </span>
<a href="#l1.129"></a><span id="l1.129">   return NS_OK;</span>
<a href="#l1.130"></a><span id="l1.130"> }</span>
<a href="#l1.131"></a><span id="l1.131"> </span>
<a href="#l1.132"></a><span id="l1.132"> // Starts looking for .mbox dirs in the specified dir. The .mbox dirs contain messages and can be considered leafs in a tree of</span>
<a href="#l1.133"></a><span id="l1.133"> // nested mailboxes (subfolders).</span>
<a href="#l1.134"></a><span id="l1.134"> //</span>
<a href="#l1.135"></a><span id="l1.135"> // If a mailbox has sub-mailboxes, they are contained in a sibling folder with the same name without the &quot;.mbox&quot; part.</span>
<a href="#l1.136"></a><span id="l1.136"> // example:</span>
<a href="#l1.137"></a><span id="l1.137"> //   MyParentMailbox.mbox/</span>
<a href="#l1.138"></a><span id="l1.138"> //   MyParentMailbox/</span>
<a href="#l1.139"></a><span id="l1.139"> //     MyChildMailbox.mbox/</span>
<a href="#l1.140"></a><span id="l1.140"> //     MyOtherChildMailbox.mbox/</span>
<a href="#l1.141"></a><span id="l1.141"> //</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineminus">-nsresult nsAppleMailImportMail::FindMboxDirs(nsIFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService)</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineplus">+nsresult nsAppleMailImportMail::FindMboxDirs(nsIFile *aFolder, nsIMutableArray *aMailboxDescs, nsIImportService *aImportService)</span>
<a href="#l1.144"></a><span id="l1.144"> {</span>
<a href="#l1.145"></a><span id="l1.145">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l1.146"></a><span id="l1.146">   NS_ENSURE_ARG_POINTER(aMailboxDescs);</span>
<a href="#l1.147"></a><span id="l1.147">   NS_ENSURE_ARG_POINTER(aImportService);</span>
<a href="#l1.148"></a><span id="l1.148"> </span>
<a href="#l1.149"></a><span id="l1.149">   // make sure this is a directory.</span>
<a href="#l1.150"></a><span id="l1.150">   bool isDir = false;</span>
<a href="#l1.151"></a><span id="l1.151">   if (NS_FAILED(aFolder-&gt;IsDirectory(&amp;isDir)) || !isDir)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsAppleMailImport.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsAppleMailImport.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -6,17 +6,16 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #ifndef nsAppleMailImport_h___</span>
<a href="#l2.5"></a><span id="l2.5"> #define nsAppleMailImport_h___</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> #include &quot;prlog.h&quot;</span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;nsIImportModule.h&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> #include &quot;nsIImportMail.h&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l2.13"></a><span id="l2.13"> </span>
<a href="#l2.14"></a><span id="l2.14"> // logging facilities</span>
<a href="#l2.15"></a><span id="l2.15"> extern PRLogModuleInfo *APPLEMAILLOGMODULE;</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17"> #define IMPORT_LOG0(x)          PR_LOG(APPLEMAILLOGMODULE, PR_LOG_DEBUG, (x))</span>
<a href="#l2.18"></a><span id="l2.18"> #define IMPORT_LOG1(x, y)       PR_LOG(APPLEMAILLOGMODULE, PR_LOG_DEBUG, (x, y))</span>
<a href="#l2.19"></a><span id="l2.19"> #define IMPORT_LOG2(x, y, z)    PR_LOG(APPLEMAILLOGMODULE, PR_LOG_DEBUG, (x, y, z))</span>
<a href="#l2.20"></a><span id="l2.20"> #define IMPORT_LOG3(a, b, c, d) PR_LOG(APPLEMAILLOGMODULE, PR_LOG_DEBUG, (a, b, c, d))</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -27,16 +26,17 @@ extern PRLogModuleInfo *APPLEMAILLOGMODU</span>
<a href="#l2.22"></a><span id="l2.22"> #define NS_APPLEMAILIMPORT_CID \</span>
<a href="#l2.23"></a><span id="l2.23"> { 0x6d3f101c, 0x70ec, 0x4e04, { 0xb6, 0x8d, 0x99, 0x08, 0xd1, 0xae, 0xdd, 0xf3 } }</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25"> #define NS_APPLEMAILIMPL_CONTRACTID &quot;@mozilla.org/import/import-appleMailImpl;1&quot; </span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27"> #define kAppleMailSupportsString &quot;mail&quot;</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29"> class nsIImportService;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+class nsIMutableArray;</span>
<a href="#l2.31"></a><span id="l2.31"> </span>
<a href="#l2.32"></a><span id="l2.32"> class nsAppleMailImportModule : public nsIImportModule</span>
<a href="#l2.33"></a><span id="l2.33"> {</span>
<a href="#l2.34"></a><span id="l2.34">   public:</span>
<a href="#l2.35"></a><span id="l2.35"> </span>
<a href="#l2.36"></a><span id="l2.36">   nsAppleMailImportModule();</span>
<a href="#l2.37"></a><span id="l2.37">   virtual ~nsAppleMailImportModule();</span>
<a href="#l2.38"></a><span id="l2.38">     </span>
<a href="#l2.39"></a><span id="l2.39" class="difflineat">@@ -57,19 +57,19 @@ class nsAppleMailImportMail : public nsI</span>
<a href="#l2.40"></a><span id="l2.40"> </span>
<a href="#l2.41"></a><span id="l2.41">   NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l2.42"></a><span id="l2.42">   NS_DECL_NSIIMPORTMAIL</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44">   nsresult Initialize();</span>
<a href="#l2.45"></a><span id="l2.45"> </span>
<a href="#l2.46"></a><span id="l2.46">   private:</span>
<a href="#l2.47"></a><span id="l2.47"> </span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-  void FindAccountMailDirs(nsIFile *aRoot, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-  nsresult FindMboxDirs(nsIFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-  nsresult AddMboxDir(nsIFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+  void FindAccountMailDirs(nsIFile *aRoot, nsIMutableArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+  nsresult FindMboxDirs(nsIFile *aFolder, nsIMutableArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+  nsresult AddMboxDir(nsIFile *aFolder, nsIMutableArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l2.54"></a><span id="l2.54">     </span>
<a href="#l2.55"></a><span id="l2.55">   // aInfoString is the format to a &quot;foo %s&quot; string. It may be NULL if the error string needs no such format.</span>
<a href="#l2.56"></a><span id="l2.56">   void ReportStatus(int32_t aErrorNum, nsString &amp;aName, nsAString &amp;aStream);</span>
<a href="#l2.57"></a><span id="l2.57">   static void SetLogs(const nsAString&amp; success, const nsAString&amp; error, PRUnichar **aOutErrorLog, PRUnichar **aSuccessLog);</span>
<a href="#l2.58"></a><span id="l2.58"> </span>
<a href="#l2.59"></a><span id="l2.59">   nsCOMPtr&lt;nsIStringBundle&gt;  mBundle;</span>
<a href="#l2.60"></a><span id="l2.60">   uint32_t                   mProgress;</span>
<a href="#l2.61"></a><span id="l2.61">   uint16_t                   mCurDepth;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraAddress.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraAddress.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -6,40 +6,40 @@</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> #ifndef nsEudoraAddress_h__</span>
<a href="#l3.6"></a><span id="l3.6"> #define nsEudoraAddress_h__</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> #include &quot;nscore.h&quot;</span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;nsVoidArray.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsIFile.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l3.14"></a><span id="l3.14"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> class nsIAddrDatabase;</span>
<a href="#l3.18"></a><span id="l3.18"> class CAliasEntry;</span>
<a href="#l3.19"></a><span id="l3.19"> class CAliasData;</span>
<a href="#l3.20"></a><span id="l3.20"> class nsIStringBundle;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+class nsIMutableArray;</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23"> /////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.24"></a><span id="l3.24"> /////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.25"></a><span id="l3.25"> /////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27"> class nsEudoraAddress {</span>
<a href="#l3.28"></a><span id="l3.28"> public:</span>
<a href="#l3.29"></a><span id="l3.29">   nsEudoraAddress();</span>
<a href="#l3.30"></a><span id="l3.30">   virtual ~nsEudoraAddress();</span>
<a href="#l3.31"></a><span id="l3.31"> </span>
<a href="#l3.32"></a><span id="l3.32">   // Things that must be overridden because they are platform specific.</span>
<a href="#l3.33"></a><span id="l3.33">     // retrieve the mail folder</span>
<a href="#l3.34"></a><span id="l3.34">   virtual bool      FindAddressFolder(nsIFile **pFolder) { return false;}</span>
<a href="#l3.35"></a><span id="l3.35">     // get the list of mailboxes</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-  virtual nsresult  FindAddressBooks(nsIFile *pRoot, nsISupportsArray **ppArray) { return NS_ERROR_FAILURE;}</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+  virtual nsresult  FindAddressBooks(nsIFile *pRoot, nsIMutableArray *pArray) { return NS_ERROR_FAILURE;}</span>
<a href="#l3.38"></a><span id="l3.38"> </span>
<a href="#l3.39"></a><span id="l3.39">   // Non-platform specific common stuff</span>
<a href="#l3.40"></a><span id="l3.40">     // import a mailbox</span>
<a href="#l3.41"></a><span id="l3.41">   nsresult ImportAddresses(uint32_t *pBytes, bool *pAbort, const PRUnichar *pName, nsIFile *pSrc, nsIAddrDatabase *pDb, nsString&amp; errors);</span>
<a href="#l3.42"></a><span id="l3.42"> </span>
<a href="#l3.43"></a><span id="l3.43"> </span>
<a href="#l3.44"></a><span id="l3.44"> private:</span>
<a href="#l3.45"></a><span id="l3.45">   void       EmptyAliases(void);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -607,17 +607,17 @@ nsresult nsEudoraCompose::SendTheMessage</span>
<a href="#l4.4"></a><span id="l4.4">   if (!bodyType.IsEmpty())</span>
<a href="#l4.5"></a><span id="l4.5">     pMimeType = ToNewCString(NS_LossyConvertUTF16toASCII(bodyType));</span>
<a href="#l4.6"></a><span id="l4.6">   else</span>
<a href="#l4.7"></a><span id="l4.7">     pMimeType = ToNewCString(m_bodyType);</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">   nsCOMPtr&lt;nsIArray&gt; pAttach;</span>
<a href="#l4.10"></a><span id="l4.10">   GetLocalAttachments(getter_AddRefs(pAttach));</span>
<a href="#l4.11"></a><span id="l4.11">   nsEudoraEditor eudoraEditor(m_pBody, pMailImportLocation);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; embeddedObjects;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  nsCOMPtr&lt;nsIArray&gt; embeddedObjects;</span>
<a href="#l4.14"></a><span id="l4.14">   if (eudoraEditor.HasEmbeddedContent())</span>
<a href="#l4.15"></a><span id="l4.15">     eudoraEditor.GetEmbeddedObjects(getter_AddRefs(embeddedObjects));</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">   nsString uniBody;</span>
<a href="#l4.18"></a><span id="l4.18">   NS_CopyNativeToUnicode(nsDependentCString(m_pBody), uniBody);</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20">   /*</span>
<a href="#l4.21"></a><span id="l4.21">     l10n - I have the body of the message in the system charset,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraEditor.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraEditor.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.5"></a><span id="l5.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.6"></a><span id="l5.6"> * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.7"></a><span id="l5.7"> * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;nsEudoraEditor.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l5.14"></a><span id="l5.14"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l5.15"></a><span id="l5.15"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l5.16"></a><span id="l5.16"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l5.17"></a><span id="l5.17"> #include &quot;nsImportEmbeddedImageData.h&quot;</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19"> static char *     sEudoraEmbeddedContentLines[] = {</span>
<a href="#l5.20"></a><span id="l5.20">   &quot;Embedded Content: &quot;,</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -52,29 +52,30 @@ nsEudoraEditor::nsEudoraEditor(const cha</span>
<a href="#l5.22"></a><span id="l5.22">   m_pMailImportLocation = pMailImportLocation;</span>
<a href="#l5.23"></a><span id="l5.23"> }</span>
<a href="#l5.24"></a><span id="l5.24"> </span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26"> nsEudoraEditor::~nsEudoraEditor()</span>
<a href="#l5.27"></a><span id="l5.27"> {</span>
<a href="#l5.28"></a><span id="l5.28"> }</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-nsresult nsEudoraEditor::GetEmbeddedObjects(nsISupportsArray ** aNodeList)</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+nsresult nsEudoraEditor::GetEmbeddedObjects(nsIArray ** aNodeList)</span>
<a href="#l5.32"></a><span id="l5.32"> {</span>
<a href="#l5.33"></a><span id="l5.33">   NS_ENSURE_ARG_POINTER(aNodeList);</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35">   // Check to see if we were already called</span>
<a href="#l5.36"></a><span id="l5.36">   if (m_EmbeddedObjectList != nullptr)</span>
<a href="#l5.37"></a><span id="l5.37">   {</span>
<a href="#l5.38"></a><span id="l5.38">     *aNodeList = m_EmbeddedObjectList;</span>
<a href="#l5.39"></a><span id="l5.39">     return NS_OK;</span>
<a href="#l5.40"></a><span id="l5.40">   }</span>
<a href="#l5.41"></a><span id="l5.41"> </span>
<a href="#l5.42"></a><span id="l5.42">   // Create array in m_EmbeddedObjectList</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-  nsresult rv = NS_NewISupportsArray(getter_AddRefs(m_EmbeddedObjectList));</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+  nsresult rv;</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+  m_EmbeddedObjectList = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l5.46"></a><span id="l5.46">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.47"></a><span id="l5.47"> </span>
<a href="#l5.48"></a><span id="l5.48">   // Return m_EmbeddedObjectList in aNodeList and increment ref count - caller</span>
<a href="#l5.49"></a><span id="l5.49">   // assumes that we incremented the ref count.</span>
<a href="#l5.50"></a><span id="l5.50">   NS_IF_ADDREF(*aNodeList = m_EmbeddedObjectList);</span>
<a href="#l5.51"></a><span id="l5.51"> </span>
<a href="#l5.52"></a><span id="l5.52">   // Create the embedded folder spec</span>
<a href="#l5.53"></a><span id="l5.53">   nsCOMPtr&lt;nsIFile&gt;   embeddedFolderSpec;</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineat">@@ -168,17 +169,17 @@ nsresult nsEudoraEditor::GetEmbeddedObje</span>
<a href="#l5.55"></a><span id="l5.55">       nsCOMPtr&lt;nsIURI&gt; embeddedFileURI;</span>
<a href="#l5.56"></a><span id="l5.56">       NS_NewFileURI(getter_AddRefs(embeddedFileURI), embeddedImageSpec);</span>
<a href="#l5.57"></a><span id="l5.57"> </span>
<a href="#l5.58"></a><span id="l5.58">       // Create the embedded image node</span>
<a href="#l5.59"></a><span id="l5.59">       nsImportEmbeddedImageData *imageData =</span>
<a href="#l5.60"></a><span id="l5.60">         new nsImportEmbeddedImageData(embeddedFileURI, NS_LossyConvertUTF16toASCII(cid));</span>
<a href="#l5.61"></a><span id="l5.61"> </span>
<a href="#l5.62"></a><span id="l5.62">       // Append the embedded image node to the list</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-      m_EmbeddedObjectList-&gt;AppendElement(imageData);</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+      m_EmbeddedObjectList-&gt;AppendElement(imageData, false);</span>
<a href="#l5.65"></a><span id="l5.65"> </span>
<a href="#l5.66"></a><span id="l5.66">       int32_t   endEmbeddedContentLine = m_body.Find(&quot;\r\n&quot;, true, startEmbeddedContentLine+1);</span>
<a href="#l5.67"></a><span id="l5.67">       if (endEmbeddedContentLine != kNotFound)</span>
<a href="#l5.68"></a><span id="l5.68">       {</span>
<a href="#l5.69"></a><span id="l5.69">         // We recognized the &quot;Embedded Content&quot; line correctly and found the associated image.</span>
<a href="#l5.70"></a><span id="l5.70">         // Remove the Eudora specific line about it now.</span>
<a href="#l5.71"></a><span id="l5.71">         m_body.Cut(startEmbeddedContentLine, endEmbeddedContentLine - startEmbeddedContentLine + 2);</span>
<a href="#l5.72"></a><span id="l5.72"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraEditor.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraEditor.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -4,26 +4,27 @@</span>
<a href="#l6.4"></a><span id="l6.4"> * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> #include &quot;nscore.h&quot;</span>
<a href="#l6.7"></a><span id="l6.7"> #include &quot;nsIEditor.h&quot;</span>
<a href="#l6.8"></a><span id="l6.8"> #include &quot;nsIEditorMailSupport.h&quot;</span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l6.11"></a><span id="l6.11"> #include &quot;nsIFile.h&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l6.13"></a><span id="l6.13"> </span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15"> class nsEudoraEditor</span>
<a href="#l6.16"></a><span id="l6.16"> {</span>
<a href="#l6.17"></a><span id="l6.17">   public:</span>
<a href="#l6.18"></a><span id="l6.18">     nsEudoraEditor(const char * pBody, nsIFile * pMailImportLocation);</span>
<a href="#l6.19"></a><span id="l6.19">     ~nsEudoraEditor();</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">     bool GetEmbeddedImageCID(uint32_t aCIDHash, const nsAString &amp; aOldRef, nsString &amp;aCID);</span>
<a href="#l6.22"></a><span id="l6.22">     bool HasEmbeddedContent();</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-    nsresult GetEmbeddedObjects(nsISupportsArray ** aNodeList);</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+    nsresult GetEmbeddedObjects(nsIArray ** aNodeList);</span>
<a href="#l6.25"></a><span id="l6.25">     nsresult GetBody(nsAString &amp; _retval) {_retval = m_body; return NS_OK;}</span>
<a href="#l6.26"></a><span id="l6.26">   protected:</span>
<a href="#l6.27"></a><span id="l6.27">     NS_ConvertASCIItoUTF16      m_body;</span>
<a href="#l6.28"></a><span id="l6.28">     nsCOMPtr &lt;nsIFile&gt;          m_pMailImportLocation;</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-    nsCOMPtr&lt;nsISupportsArray&gt;  m_EmbeddedObjectList; // Initialized when GetEmbeddedObjects is called</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+    nsCOMPtr&lt;nsIMutableArray&gt;   m_EmbeddedObjectList; // Initialized when GetEmbeddedObjects is called</span>
<a href="#l6.31"></a><span id="l6.31"> };</span>
<a href="#l6.32"></a><span id="l6.32"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -386,21 +386,21 @@ nsresult nsEudoraFilters::Init()</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> nsresult nsEudoraFilters::LoadServers()</span>
<a href="#l7.6"></a><span id="l7.6"> {</span>
<a href="#l7.7"></a><span id="l7.7">   nsresult rv;</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">   if (m_pServerArray)</span>
<a href="#l7.10"></a><span id="l7.10">     rv = m_pServerArray-&gt;Clear();</span>
<a href="#l7.11"></a><span id="l7.11">   else</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    rv = NS_NewISupportsArray(getter_AddRefs(m_pServerArray));</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    m_pServerArray = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l7.14"></a><span id="l7.14">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">   if (!m_pFilterArray)</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-    rv = NS_NewISupportsArray(getter_AddRefs(m_pFilterArray));</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+    m_pFilterArray = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l7.19"></a><span id="l7.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountMgr = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l7.22"></a><span id="l7.22">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24">   nsCOMPtr&lt;nsIArray&gt; allServers;</span>
<a href="#l7.25"></a><span id="l7.25">   rv = accountMgr-&gt;GetAllServers(getter_AddRefs(allServers));</span>
<a href="#l7.26"></a><span id="l7.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineat">@@ -426,32 +426,32 @@ nsresult nsEudoraFilters::LoadServers()</span>
<a href="#l7.28"></a><span id="l7.28">           if (serverType.Equals(&quot;none&quot;) || serverType.Equals(&quot;imap&quot;))</span>
<a href="#l7.29"></a><span id="l7.29">           {</span>
<a href="#l7.30"></a><span id="l7.30">             // Pre-fetch filters now so that if there's any problem reading up the</span>
<a href="#l7.31"></a><span id="l7.31">             // filter file we know about it in advance and can stop importing</span>
<a href="#l7.32"></a><span id="l7.32">             nsCOMPtr&lt;nsIMsgFilterList&gt; filterList;</span>
<a href="#l7.33"></a><span id="l7.33">             rv = server-&gt;GetFilterList(nullptr, getter_AddRefs(filterList));</span>
<a href="#l7.34"></a><span id="l7.34">             NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.35"></a><span id="l7.35"> </span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-            m_pServerArray-&gt;AppendElement(server);</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+            m_pServerArray-&gt;AppendElement(server, false);</span>
<a href="#l7.38"></a><span id="l7.38">           }</span>
<a href="#l7.39"></a><span id="l7.39">         }</span>
<a href="#l7.40"></a><span id="l7.40">       }</span>
<a href="#l7.41"></a><span id="l7.41">     }</span>
<a href="#l7.42"></a><span id="l7.42">   }</span>
<a href="#l7.43"></a><span id="l7.43"> </span>
<a href="#l7.44"></a><span id="l7.44">   return NS_OK;</span>
<a href="#l7.45"></a><span id="l7.45"> }</span>
<a href="#l7.46"></a><span id="l7.46"> </span>
<a href="#l7.47"></a><span id="l7.47"> nsresult nsEudoraFilters::SaveFilters()</span>
<a href="#l7.48"></a><span id="l7.48"> {</span>
<a href="#l7.49"></a><span id="l7.49">   nsresult rv;</span>
<a href="#l7.50"></a><span id="l7.50"> </span>
<a href="#l7.51"></a><span id="l7.51">   uint32_t numServers;</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-  rv = m_pServerArray-&gt;Count(&amp;numServers);</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+  rv = m_pServerArray-&gt;GetLength(&amp;numServers);</span>
<a href="#l7.54"></a><span id="l7.54">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.55"></a><span id="l7.55">   for (uint32_t serverIndex = 0; serverIndex &lt; numServers; serverIndex++)</span>
<a href="#l7.56"></a><span id="l7.56">   {</span>
<a href="#l7.57"></a><span id="l7.57">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryElementAt(m_pServerArray, serverIndex, &amp;rv);</span>
<a href="#l7.58"></a><span id="l7.58">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.59"></a><span id="l7.59"> </span>
<a href="#l7.60"></a><span id="l7.60">     nsCOMPtr &lt;nsIMsgFilterList&gt; filterList;</span>
<a href="#l7.61"></a><span id="l7.61">     rv = server-&gt;GetFilterList(nullptr, getter_AddRefs(filterList));</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineat">@@ -469,17 +469,17 @@ nsresult nsEudoraFilters::CreateNewFilte</span>
<a href="#l7.63"></a><span id="l7.63">   nsresult rv;</span>
<a href="#l7.64"></a><span id="l7.64"> </span>
<a href="#l7.65"></a><span id="l7.65">   rv = m_pFilterArray-&gt;Clear();</span>
<a href="#l7.66"></a><span id="l7.66">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.67"></a><span id="l7.67"> </span>
<a href="#l7.68"></a><span id="l7.68">   nsAutoString unicodeName;</span>
<a href="#l7.69"></a><span id="l7.69">   NS_CopyNativeToUnicode(nsCString(pName), unicodeName);</span>
<a href="#l7.70"></a><span id="l7.70">   uint32_t numServers;</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-  rv = m_pServerArray-&gt;Count(&amp;numServers);</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+  rv = m_pServerArray-&gt;GetLength(&amp;numServers);</span>
<a href="#l7.73"></a><span id="l7.73">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.74"></a><span id="l7.74">   for (uint32_t serverIndex = 0; serverIndex &lt; numServers; serverIndex++)</span>
<a href="#l7.75"></a><span id="l7.75">   {</span>
<a href="#l7.76"></a><span id="l7.76">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryElementAt(m_pServerArray, serverIndex, &amp;rv);</span>
<a href="#l7.77"></a><span id="l7.77">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.78"></a><span id="l7.78"> </span>
<a href="#l7.79"></a><span id="l7.79">     nsCOMPtr &lt;nsIMsgFilterList&gt; filterList;</span>
<a href="#l7.80"></a><span id="l7.80">     rv = server-&gt;GetFilterList(nullptr, getter_AddRefs(filterList));</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineat">@@ -494,17 +494,17 @@ nsresult nsEudoraFilters::CreateNewFilte</span>
<a href="#l7.82"></a><span id="l7.82"> </span>
<a href="#l7.83"></a><span id="l7.83">     uint32_t count;</span>
<a href="#l7.84"></a><span id="l7.84">     rv = filterList-&gt;GetFilterCount(&amp;count);</span>
<a href="#l7.85"></a><span id="l7.85">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.86"></a><span id="l7.86"> </span>
<a href="#l7.87"></a><span id="l7.87">     rv = filterList-&gt;InsertFilterAt(count, newFilter);</span>
<a href="#l7.88"></a><span id="l7.88">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.89"></a><span id="l7.89"> </span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-    m_pFilterArray-&gt;AppendElement(newFilter);</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineplus">+    m_pFilterArray-&gt;AppendElement(newFilter, false);</span>
<a href="#l7.92"></a><span id="l7.92">   }</span>
<a href="#l7.93"></a><span id="l7.93"> </span>
<a href="#l7.94"></a><span id="l7.94">   m_isAnd = false;</span>
<a href="#l7.95"></a><span id="l7.95">   m_isUnless = false;</span>
<a href="#l7.96"></a><span id="l7.96">   m_ignoreTerm = false;</span>
<a href="#l7.97"></a><span id="l7.97">   m_isIncoming = false;</span>
<a href="#l7.98"></a><span id="l7.98">   m_addedAction = false;</span>
<a href="#l7.99"></a><span id="l7.99">   m_hasTransfer = false;</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineat">@@ -534,17 +534,17 @@ nsresult nsEudoraFilters::FinalizeFilter</span>
<a href="#l7.101"></a><span id="l7.101">   return rv;</span>
<a href="#l7.102"></a><span id="l7.102"> }</span>
<a href="#l7.103"></a><span id="l7.103"> </span>
<a href="#l7.104"></a><span id="l7.104"> nsresult nsEudoraFilters::EnableFilter(bool enable)</span>
<a href="#l7.105"></a><span id="l7.105"> {</span>
<a href="#l7.106"></a><span id="l7.106">   nsresult rv;</span>
<a href="#l7.107"></a><span id="l7.107"> </span>
<a href="#l7.108"></a><span id="l7.108">   uint32_t numFilters;</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineminus">-  rv = m_pFilterArray-&gt;Count(&amp;numFilters);</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+  rv = m_pFilterArray-&gt;GetLength(&amp;numFilters);</span>
<a href="#l7.111"></a><span id="l7.111">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.112"></a><span id="l7.112">   for (uint32_t filterIndex = 0; filterIndex &lt; numFilters; filterIndex++)</span>
<a href="#l7.113"></a><span id="l7.113">   {</span>
<a href="#l7.114"></a><span id="l7.114">     nsCOMPtr&lt;nsIMsgFilter&gt; filter = do_QueryElementAt(m_pFilterArray, filterIndex, &amp;rv);</span>
<a href="#l7.115"></a><span id="l7.115">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.116"></a><span id="l7.116"> </span>
<a href="#l7.117"></a><span id="l7.117">     filter-&gt;SetEnabled(enable);</span>
<a href="#l7.118"></a><span id="l7.118">   }</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineat">@@ -739,17 +739,17 @@ nsresult nsEudoraFilters::AddTerm(const </span>
<a href="#l7.120"></a><span id="l7.120"> </span>
<a href="#l7.121"></a><span id="l7.121">     int32_t headerIndex = AddCustomHeader(arbitraryHeader.get());</span>
<a href="#l7.122"></a><span id="l7.122">     NS_ENSURE_TRUE(headerIndex &gt;= 0, NS_ERROR_FAILURE);</span>
<a href="#l7.123"></a><span id="l7.123"> </span>
<a href="#l7.124"></a><span id="l7.124">     attrib = nsMsgSearchAttrib::OtherHeader + 1 + headerIndex;</span>
<a href="#l7.125"></a><span id="l7.125">   }</span>
<a href="#l7.126"></a><span id="l7.126"> </span>
<a href="#l7.127"></a><span id="l7.127">   uint32_t numFilters;</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineminus">-  rv = m_pFilterArray-&gt;Count(&amp;numFilters);</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineplus">+  rv = m_pFilterArray-&gt;GetLength(&amp;numFilters);</span>
<a href="#l7.130"></a><span id="l7.130">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.131"></a><span id="l7.131">   for (uint32_t filterIndex = 0; filterIndex &lt; numFilters; filterIndex++)</span>
<a href="#l7.132"></a><span id="l7.132">   {</span>
<a href="#l7.133"></a><span id="l7.133">     nsCOMPtr&lt;nsIMsgFilter&gt; filter = do_QueryElementAt(m_pFilterArray, filterIndex, &amp;rv);</span>
<a href="#l7.134"></a><span id="l7.134">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.135"></a><span id="l7.135"> </span>
<a href="#l7.136"></a><span id="l7.136">     nsCOMPtr&lt;nsISupportsArray&gt; terms;</span>
<a href="#l7.137"></a><span id="l7.137">     rv = filter-&gt;GetSearchTerms(getter_AddRefs(terms));</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineat">@@ -788,17 +788,17 @@ nsresult nsEudoraFilters::AddTerm(const </span>
<a href="#l7.139"></a><span id="l7.139"> }</span>
<a href="#l7.140"></a><span id="l7.140"> </span>
<a href="#l7.141"></a><span id="l7.141"> nsresult nsEudoraFilters::AddAction(nsMsgRuleActionType actionType, int32_t junkScore /*= 0*/, nsMsgLabelValue label/*= 0*/,</span>
<a href="#l7.142"></a><span id="l7.142">                                     nsMsgPriorityValue priority/*= 0*/, const char* strValue/*= nullptr*/, const char* targetFolderUri/*= nullptr*/)</span>
<a href="#l7.143"></a><span id="l7.143"> {</span>
<a href="#l7.144"></a><span id="l7.144">   nsresult rv;</span>
<a href="#l7.145"></a><span id="l7.145"> </span>
<a href="#l7.146"></a><span id="l7.146">   uint32_t numFilters;</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineminus">-  rv = m_pFilterArray-&gt;Count(&amp;numFilters);</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineplus">+  rv = m_pFilterArray-&gt;GetLength(&amp;numFilters);</span>
<a href="#l7.149"></a><span id="l7.149">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.150"></a><span id="l7.150">   for (uint32_t filterIndex = 0; filterIndex &lt; numFilters; filterIndex++)</span>
<a href="#l7.151"></a><span id="l7.151">   {</span>
<a href="#l7.152"></a><span id="l7.152">     nsCOMPtr&lt;nsIMsgFilter&gt; filter = do_QueryElementAt(m_pFilterArray, filterIndex, &amp;rv);</span>
<a href="#l7.153"></a><span id="l7.153">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.154"></a><span id="l7.154"> </span>
<a href="#l7.155"></a><span id="l7.155">     nsCOMPtr&lt;nsIMsgRuleAction&gt; action;</span>
<a href="#l7.156"></a><span id="l7.156">     rv = filter-&gt;CreateAction(getter_AddRefs(action));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraFilters.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraFilters.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -3,16 +3,17 @@</span>
<a href="#l8.4"></a><span id="l8.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.5"></a><span id="l8.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> #ifndef nsEudoraFilters_h___</span>
<a href="#l8.8"></a><span id="l8.8"> #define nsEudoraFilters_h___</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10"> #include &quot;nsIImportFilters.h&quot;</span>
<a href="#l8.11"></a><span id="l8.11"> #include &quot;nsIFile.h&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l8.13"></a><span id="l8.13"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l8.14"></a><span id="l8.14"> #include &quot;nsMsgFilterCore.h&quot;</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16"> class nsIMsgFolder;</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18"> class nsEudoraFilters : public nsIImportFilters {</span>
<a href="#l8.19"></a><span id="l8.19"> public:</span>
<a href="#l8.20"></a><span id="l8.20">   nsEudoraFilters();</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineat">@@ -23,18 +24,18 @@ public:</span>
<a href="#l8.22"></a><span id="l8.22">   // nsISupports interface</span>
<a href="#l8.23"></a><span id="l8.23">   NS_DECL_ISUPPORTS</span>
<a href="#l8.24"></a><span id="l8.24"> </span>
<a href="#l8.25"></a><span id="l8.25">   // nsIImportFilters interface</span>
<a href="#l8.26"></a><span id="l8.26">   NS_DECL_NSIIMPORTFILTERS</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28"> private:</span>
<a href="#l8.29"></a><span id="l8.29">   nsCOMPtr&lt;nsIFile&gt; m_pLocation;</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; m_pServerArray;</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; m_pFilterArray;</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; m_pServerArray;</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; m_pFilterArray;</span>
<a href="#l8.34"></a><span id="l8.34">   nsCOMPtr&lt;nsIMsgFolder&gt; m_pMailboxesRoot;</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36">   nsString m_errorLog;</span>
<a href="#l8.37"></a><span id="l8.37"> </span>
<a href="#l8.38"></a><span id="l8.38">   bool m_isAnd;</span>
<a href="#l8.39"></a><span id="l8.39">   bool m_isUnless;</span>
<a href="#l8.40"></a><span id="l8.40">   bool m_ignoreTerm;</span>
<a href="#l8.41"></a><span id="l8.41">   bool m_isIncoming;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraImport.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraImport.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -18,16 +18,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> #include &quot;nscore.h&quot;</span>
<a href="#l9.5"></a><span id="l9.5"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l9.6"></a><span id="l9.6"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l9.7"></a><span id="l9.7"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l9.8"></a><span id="l9.8"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l9.9"></a><span id="l9.9"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l9.10"></a><span id="l9.10"> #include &quot;nsEudoraImport.h&quot;</span>
<a href="#l9.11"></a><span id="l9.11"> #include &quot;nsIMemory.h&quot;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l9.13"></a><span id="l9.13"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l9.14"></a><span id="l9.14"> #include &quot;nsIImportMail.h&quot;</span>
<a href="#l9.15"></a><span id="l9.15"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l9.16"></a><span id="l9.16"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l9.17"></a><span id="l9.17"> #include &quot;nsIImportAddressBooks.h&quot;</span>
<a href="#l9.18"></a><span id="l9.18"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l9.19"></a><span id="l9.19"> #include &quot;nsIImportSettings.h&quot;</span>
<a href="#l9.20"></a><span id="l9.20"> #include &quot;nsIImportFilters.h&quot;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineat">@@ -70,18 +71,18 @@ public:</span>
<a href="#l9.22"></a><span id="l9.22">   // nsISupports interface</span>
<a href="#l9.23"></a><span id="l9.23">   NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25">   // nsIImportmail interface</span>
<a href="#l9.26"></a><span id="l9.26"> </span>
<a href="#l9.27"></a><span id="l9.27">   /* void GetDefaultLocation (out nsIFile location, out boolean found, out boolean userVerify); */</span>
<a href="#l9.28"></a><span id="l9.28">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-  /* nsISupportsArray FindMailboxes (in nsIFile location); */</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-  NS_IMETHOD FindMailboxes(nsIFile *location, nsISupportsArray **_retval);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+  /* nsIArray FindMailboxes (in nsIFile location); */</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+  NS_IMETHOD FindMailboxes(nsIFile *location, nsIArray **_retval);</span>
<a href="#l9.34"></a><span id="l9.34"> </span>
<a href="#l9.35"></a><span id="l9.35">   NS_IMETHOD ImportMailbox(nsIImportMailboxDescriptor *source,</span>
<a href="#l9.36"></a><span id="l9.36">                            nsIMsgFolder *dstFolder,</span>
<a href="#l9.37"></a><span id="l9.37">                            PRUnichar **pErrorLog, PRUnichar **pSuccessLog,</span>
<a href="#l9.38"></a><span id="l9.38">                            bool *fatalError);</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40">   /* unsigned long GetImportProgress (); */</span>
<a href="#l9.41"></a><span id="l9.41">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineat">@@ -124,17 +125,17 @@ public:</span>
<a href="#l9.43"></a><span id="l9.43">   NS_IMETHOD GetSupportsMultiple(bool *_retval) { *_retval = true; return NS_OK;}</span>
<a href="#l9.44"></a><span id="l9.44"> </span>
<a href="#l9.45"></a><span id="l9.45">   NS_IMETHOD GetAutoFind(PRUnichar **description, bool *_retval);</span>
<a href="#l9.46"></a><span id="l9.46"> </span>
<a href="#l9.47"></a><span id="l9.47">   NS_IMETHOD GetNeedsFieldMap(nsIFile *location, bool *_retval) { *_retval = false; return NS_OK;}</span>
<a href="#l9.48"></a><span id="l9.48"> </span>
<a href="#l9.49"></a><span id="l9.49">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l9.50"></a><span id="l9.50"> </span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-  NS_IMETHOD FindAddressBooks(nsIFile *location, nsISupportsArray **_retval);</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+  NS_IMETHOD FindAddressBooks(nsIFile *location, nsIArray **_retval);</span>
<a href="#l9.53"></a><span id="l9.53"> </span>
<a href="#l9.54"></a><span id="l9.54">   NS_IMETHOD InitFieldMap(nsIImportFieldMap *fieldMap)</span>
<a href="#l9.55"></a><span id="l9.55">     { return NS_ERROR_FAILURE; }</span>
<a href="#l9.56"></a><span id="l9.56"> </span>
<a href="#l9.57"></a><span id="l9.57">   NS_IMETHOD ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l9.58"></a><span id="l9.58">                                nsIAddrDatabase *destination,</span>
<a href="#l9.59"></a><span id="l9.59">                                nsIImportFieldMap *fieldMap,</span>
<a href="#l9.60"></a><span id="l9.60">                                nsISupports *aSupportService,</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineat">@@ -418,33 +419,41 @@ NS_IMETHODIMP ImportEudoraMailImpl::GetD</span>
<a href="#l9.62"></a><span id="l9.62">   *ppLoc = nullptr;</span>
<a href="#l9.63"></a><span id="l9.63">   *found = m_eudora.FindMailFolder(ppLoc);</span>
<a href="#l9.64"></a><span id="l9.64">   *userVerify = true;</span>
<a href="#l9.65"></a><span id="l9.65"> </span>
<a href="#l9.66"></a><span id="l9.66">   return NS_OK;</span>
<a href="#l9.67"></a><span id="l9.67"> }</span>
<a href="#l9.68"></a><span id="l9.68"> </span>
<a href="#l9.69"></a><span id="l9.69"> </span>
<a href="#l9.70"></a><span id="l9.70" class="difflineminus">-NS_IMETHODIMP ImportEudoraMailImpl::FindMailboxes(nsIFile *pLoc, nsISupportsArray **ppArray)</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+NS_IMETHODIMP ImportEudoraMailImpl::FindMailboxes(nsIFile *pLoc, nsIArray **ppArray)</span>
<a href="#l9.72"></a><span id="l9.72"> {</span>
<a href="#l9.73"></a><span id="l9.73">   NS_PRECONDITION(pLoc != nullptr, &quot;null ptr&quot;);</span>
<a href="#l9.74"></a><span id="l9.74">   NS_PRECONDITION(ppArray != nullptr, &quot;null ptr&quot;);</span>
<a href="#l9.75"></a><span id="l9.75">   if (!pLoc || !ppArray)</span>
<a href="#l9.76"></a><span id="l9.76">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l9.77"></a><span id="l9.77"> </span>
<a href="#l9.78"></a><span id="l9.78">   bool exists = false;</span>
<a href="#l9.79"></a><span id="l9.79">   nsresult rv = pLoc-&gt;Exists(&amp;exists);</span>
<a href="#l9.80"></a><span id="l9.80">   if (NS_FAILED(rv) || !exists)</span>
<a href="#l9.81"></a><span id="l9.81">     return NS_ERROR_FAILURE;</span>
<a href="#l9.82"></a><span id="l9.82"> </span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-  rv = m_eudora.FindMailboxes(pLoc, ppArray);</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">-  if (NS_FAILED(rv) &amp;&amp; *ppArray)</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-    NS_RELEASE(*ppArray);</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; array(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+  {</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+    IMPORT_LOG0(&quot;FAILED to allocate the nsIMutableArray\n&quot;);</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineplus">+    return rv;</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineplus">+  }</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineplus">+  rv = m_eudora.FindMailboxes(pLoc, array);</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineplus">+    return rv;</span>
<a href="#l9.95"></a><span id="l9.95"> </span>
<a href="#l9.96"></a><span id="l9.96" class="difflineminus">-  return rv;</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineplus">+  array.forget(ppArray);</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineplus">+</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineplus">+  return NS_OK;</span>
<a href="#l9.100"></a><span id="l9.100"> }</span>
<a href="#l9.101"></a><span id="l9.101"> </span>
<a href="#l9.102"></a><span id="l9.102"> void ImportEudoraMailImpl::AddLinebreak(nsString *pStream)</span>
<a href="#l9.103"></a><span id="l9.103"> {</span>
<a href="#l9.104"></a><span id="l9.104">   if (pStream)</span>
<a href="#l9.105"></a><span id="l9.105">     pStream-&gt;Append(PRUnichar('\n'));</span>
<a href="#l9.106"></a><span id="l9.106"> }</span>
<a href="#l9.107"></a><span id="l9.107"> </span>
<a href="#l9.108"></a><span id="l9.108" class="difflineat">@@ -627,33 +636,41 @@ NS_IMETHODIMP ImportEudoraAddressImpl::G</span>
<a href="#l9.109"></a><span id="l9.109">   *found = m_eudora.FindAddressFolder(ppLoc);</span>
<a href="#l9.110"></a><span id="l9.110">   *userVerify = true;</span>
<a href="#l9.111"></a><span id="l9.111"> </span>
<a href="#l9.112"></a><span id="l9.112">   return NS_OK;</span>
<a href="#l9.113"></a><span id="l9.113"> }</span>
<a href="#l9.114"></a><span id="l9.114"> </span>
<a href="#l9.115"></a><span id="l9.115"> </span>
<a href="#l9.116"></a><span id="l9.116"> </span>
<a href="#l9.117"></a><span id="l9.117" class="difflineminus">-NS_IMETHODIMP ImportEudoraAddressImpl::FindAddressBooks(nsIFile *pLoc, nsISupportsArray **ppArray)</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineplus">+NS_IMETHODIMP ImportEudoraAddressImpl::FindAddressBooks(nsIFile *pLoc, nsIArray **ppArray)</span>
<a href="#l9.119"></a><span id="l9.119"> {</span>
<a href="#l9.120"></a><span id="l9.120">     NS_PRECONDITION(pLoc != nullptr, &quot;null ptr&quot;);</span>
<a href="#l9.121"></a><span id="l9.121">     NS_PRECONDITION(ppArray != nullptr, &quot;null ptr&quot;);</span>
<a href="#l9.122"></a><span id="l9.122">     if (!pLoc || !ppArray)</span>
<a href="#l9.123"></a><span id="l9.123">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l9.124"></a><span id="l9.124"> </span>
<a href="#l9.125"></a><span id="l9.125">   bool exists = false;</span>
<a href="#l9.126"></a><span id="l9.126">   nsresult rv = pLoc-&gt;Exists(&amp;exists);</span>
<a href="#l9.127"></a><span id="l9.127">   if (NS_FAILED(rv) || !exists)</span>
<a href="#l9.128"></a><span id="l9.128">     return NS_ERROR_FAILURE;</span>
<a href="#l9.129"></a><span id="l9.129"> </span>
<a href="#l9.130"></a><span id="l9.130" class="difflineminus">-  rv = m_eudora.FindAddressBooks(pLoc, ppArray);</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineminus">-  if (NS_FAILED(rv) &amp;&amp; *ppArray)</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineminus">-    NS_RELEASE(*ppArray);</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; array(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineplus">+  {</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineplus">+    IMPORT_LOG0(&quot;FAILED to allocate the nsIMutableArray\n&quot;);</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineplus">+    return rv;</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineplus">+  }</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineplus">+  rv = m_eudora.FindAddressBooks(pLoc, array);</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineplus">+    return rv;</span>
<a href="#l9.142"></a><span id="l9.142"> </span>
<a href="#l9.143"></a><span id="l9.143" class="difflineminus">-  return rv;</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineplus">+  array.forget(ppArray);</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineplus">+</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineplus">+  return NS_OK;</span>
<a href="#l9.147"></a><span id="l9.147"> }</span>
<a href="#l9.148"></a><span id="l9.148"> </span>
<a href="#l9.149"></a><span id="l9.149"> </span>
<a href="#l9.150"></a><span id="l9.150"> </span>
<a href="#l9.151"></a><span id="l9.151"> void ImportEudoraAddressImpl::ReportSuccess(nsString&amp; name, nsString *pStream)</span>
<a href="#l9.152"></a><span id="l9.152"> {</span>
<a href="#l9.153"></a><span id="l9.153">   if (!pStream)</span>
<a href="#l9.154"></a><span id="l9.154">     return;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -4,16 +4,17 @@</span>
<a href="#l10.4"></a><span id="l10.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.5"></a><span id="l10.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l10.8"></a><span id="l10.8"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l10.10"></a><span id="l10.10"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l10.15"></a><span id="l10.15"> #include &quot;nsISmtpService.h&quot;</span>
<a href="#l10.16"></a><span id="l10.16"> #include &quot;nsISmtpServer.h&quot;</span>
<a href="#l10.17"></a><span id="l10.17"> #include &quot;nsEudoraMac.h&quot;</span>
<a href="#l10.18"></a><span id="l10.18"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l10.19"></a><span id="l10.19"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l10.20"></a><span id="l10.20"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -207,52 +208,46 @@ bool nsEudoraMac::VerifyEudoraLocation(n</span>
<a href="#l10.22"></a><span id="l10.22">     return false;</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24">   NS_IF_ADDREF(*pFolder = prefFile);</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26">   return true;</span>
<a href="#l10.27"></a><span id="l10.27"> }</span>
<a href="#l10.28"></a><span id="l10.28"> </span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-nsresult nsEudoraMac::FindMailboxes(nsIFile *pRoot, nsISupportsArray **ppArray)</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+nsresult nsEudoraMac::FindMailboxes(nsIFile *pRoot, nsIMutableArray *pArray)</span>
<a href="#l10.32"></a><span id="l10.32"> {</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-  nsresult rv = NS_NewISupportsArray(ppArray);</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">-  {</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-    IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray\n&quot;);</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">-    return rv;</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">-  }</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+  nsresult rv;</span>
<a href="#l10.41"></a><span id="l10.41">   nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l10.42"></a><span id="l10.42">   if (NS_FAILED(rv))</span>
<a href="#l10.43"></a><span id="l10.43">     return rv;</span>
<a href="#l10.44"></a><span id="l10.44"> </span>
<a href="#l10.45"></a><span id="l10.45">   m_depth = 0;</span>
<a href="#l10.46"></a><span id="l10.46">   m_mailImportLocation = do_QueryInterface(pRoot);</span>
<a href="#l10.47"></a><span id="l10.47"> </span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-  return ScanMailDir(pRoot, *ppArray, impSvc);</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+  return ScanMailDir(pRoot, pArray, impSvc);</span>
<a href="#l10.50"></a><span id="l10.50"> }</span>
<a href="#l10.51"></a><span id="l10.51"> </span>
<a href="#l10.52"></a><span id="l10.52"> </span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-nsresult nsEudoraMac::ScanMailDir(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+nsresult nsEudoraMac::ScanMailDir(nsIFile *pFolder, nsIMutableArray *pArray, nsIImportService *pImport)</span>
<a href="#l10.55"></a><span id="l10.55"> {</span>
<a href="#l10.56"></a><span id="l10.56"> </span>
<a href="#l10.57"></a><span id="l10.57">   // On Windows, we look for a descmap file but on Mac we just iterate</span>
<a href="#l10.58"></a><span id="l10.58">   // the directory</span>
<a href="#l10.59"></a><span id="l10.59"> </span>
<a href="#l10.60"></a><span id="l10.60">   m_depth++;</span>
<a href="#l10.61"></a><span id="l10.61"> </span>
<a href="#l10.62"></a><span id="l10.62">   nsresult rv = IterateMailDir(pFolder, pArray, pImport);</span>
<a href="#l10.63"></a><span id="l10.63"> </span>
<a href="#l10.64"></a><span id="l10.64">   m_depth--;</span>
<a href="#l10.65"></a><span id="l10.65"> </span>
<a href="#l10.66"></a><span id="l10.66">   return rv;</span>
<a href="#l10.67"></a><span id="l10.67"> }</span>
<a href="#l10.68"></a><span id="l10.68"> </span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-nsresult nsEudoraMac::IterateMailDir(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+nsresult nsEudoraMac::IterateMailDir(nsIFile *pFolder, nsIMutableArray *pArray, nsIImportService *pImport)</span>
<a href="#l10.71"></a><span id="l10.71"> {</span>
<a href="#l10.72"></a><span id="l10.72">   bool hasMore;</span>
<a href="#l10.73"></a><span id="l10.73">   nsCOMPtr&lt;nsISimpleEnumerator&gt; directoryEnumerator;</span>
<a href="#l10.74"></a><span id="l10.74">   nsresult rv = pFolder-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l10.75"></a><span id="l10.75">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.76"></a><span id="l10.76"> </span>
<a href="#l10.77"></a><span id="l10.77">   directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l10.78"></a><span id="l10.78"> </span>
<a href="#l10.79"></a><span id="l10.79" class="difflineat">@@ -307,17 +302,17 @@ nsresult nsEudoraMac::IterateMailDir(nsI</span>
<a href="#l10.80"></a><span id="l10.80">           rv = FoundMailbox(entry, fName.get(), pArray, pImport);</span>
<a href="#l10.81"></a><span id="l10.81">       }</span>
<a href="#l10.82"></a><span id="l10.82">     }</span>
<a href="#l10.83"></a><span id="l10.83">   }</span>
<a href="#l10.84"></a><span id="l10.84">   return rv;</span>
<a href="#l10.85"></a><span id="l10.85"> }</span>
<a href="#l10.86"></a><span id="l10.86"> </span>
<a href="#l10.87"></a><span id="l10.87"> </span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-nsresult nsEudoraMac::FoundMailbox(nsIFile *mailFile, const char *pName, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+nsresult nsEudoraMac::FoundMailbox(nsIFile *mailFile, const char *pName, nsIMutableArray *pArray, nsIImportService *pImport)</span>
<a href="#l10.90"></a><span id="l10.90"> {</span>
<a href="#l10.91"></a><span id="l10.91">   nsAutoString              displayName;</span>
<a href="#l10.92"></a><span id="l10.92">   nsCOMPtr&lt;nsIImportMailboxDescriptor&gt;  desc;</span>
<a href="#l10.93"></a><span id="l10.93">   nsISupports *              pInterface;</span>
<a href="#l10.94"></a><span id="l10.94"> </span>
<a href="#l10.95"></a><span id="l10.95">   NS_CopyNativeToUnicode(nsDependentCString(pName), displayName);</span>
<a href="#l10.96"></a><span id="l10.96"> </span>
<a href="#l10.97"></a><span id="l10.97"> #ifdef IMPORT_DEBUG</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineat">@@ -339,25 +334,25 @@ nsresult nsEudoraMac::FoundMailbox(nsIFi</span>
<a href="#l10.99"></a><span id="l10.99">     desc-&gt;SetDepth(m_depth);</span>
<a href="#l10.100"></a><span id="l10.100">     nsCOMPtr &lt;nsIFile&gt; pLocalFile;</span>
<a href="#l10.101"></a><span id="l10.101">     desc-&gt;GetFile(getter_AddRefs(pLocalFile));</span>
<a href="#l10.102"></a><span id="l10.102">     if (pLocalFile)</span>
<a href="#l10.103"></a><span id="l10.103">     {</span>
<a href="#l10.104"></a><span id="l10.104">       pLocalFile-&gt;InitWithFile(mailFile);</span>
<a href="#l10.105"></a><span id="l10.105">     }</span>
<a href="#l10.106"></a><span id="l10.106">     rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-    pArray-&gt;AppendElement(pInterface);</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+    pArray-&gt;AppendElement(pInterface, false);</span>
<a href="#l10.109"></a><span id="l10.109">     pInterface-&gt;Release();</span>
<a href="#l10.110"></a><span id="l10.110">   }</span>
<a href="#l10.111"></a><span id="l10.111"> </span>
<a href="#l10.112"></a><span id="l10.112">   return NS_OK;</span>
<a href="#l10.113"></a><span id="l10.113"> }</span>
<a href="#l10.114"></a><span id="l10.114"> </span>
<a href="#l10.115"></a><span id="l10.115"> </span>
<a href="#l10.116"></a><span id="l10.116" class="difflineminus">-nsresult nsEudoraMac::FoundMailFolder(nsIFile *mailFolder, const char *pName, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineplus">+nsresult nsEudoraMac::FoundMailFolder(nsIFile *mailFolder, const char *pName, nsIMutableArray *pArray, nsIImportService *pImport)</span>
<a href="#l10.118"></a><span id="l10.118"> {</span>
<a href="#l10.119"></a><span id="l10.119">   nsAutoString          displayName;</span>
<a href="#l10.120"></a><span id="l10.120">   nsCOMPtr&lt;nsIImportMailboxDescriptor&gt;  desc;</span>
<a href="#l10.121"></a><span id="l10.121">   nsISupports *              pInterface;</span>
<a href="#l10.122"></a><span id="l10.122"> </span>
<a href="#l10.123"></a><span id="l10.123">   NS_CopyNativeToUnicode(nsDependentCString(pName), displayName);</span>
<a href="#l10.124"></a><span id="l10.124"> </span>
<a href="#l10.125"></a><span id="l10.125"> #ifdef IMPORT_DEBUG</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineat">@@ -377,17 +372,17 @@ nsresult nsEudoraMac::FoundMailFolder(ns</span>
<a href="#l10.127"></a><span id="l10.127">     desc-&gt;SetDisplayName(displayName.get());</span>
<a href="#l10.128"></a><span id="l10.128">     desc-&gt;SetDepth(m_depth);</span>
<a href="#l10.129"></a><span id="l10.129">     desc-&gt;SetSize(sz);</span>
<a href="#l10.130"></a><span id="l10.130">     nsCOMPtr &lt;nsIFile&gt; pFile;</span>
<a href="#l10.131"></a><span id="l10.131">     desc-&gt;GetFile(getter_AddRefs(pFile));</span>
<a href="#l10.132"></a><span id="l10.132">     if (pFile)</span>
<a href="#l10.133"></a><span id="l10.133">       pFile-&gt;InitWithFile(mailFolder);</span>
<a href="#l10.134"></a><span id="l10.134">     rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineminus">-    pArray-&gt;AppendElement(pInterface);</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineplus">+    pArray-&gt;AppendElement(pInterface, false);</span>
<a href="#l10.137"></a><span id="l10.137">     pInterface-&gt;Release();</span>
<a href="#l10.138"></a><span id="l10.138">   }</span>
<a href="#l10.139"></a><span id="l10.139"> </span>
<a href="#l10.140"></a><span id="l10.140">   return NS_OK;</span>
<a href="#l10.141"></a><span id="l10.141"> }</span>
<a href="#l10.142"></a><span id="l10.142"> </span>
<a href="#l10.143"></a><span id="l10.143"> bool nsEudoraMac::CreateTocFromResource(nsIFile *pMail, nsIFile **pToc)</span>
<a href="#l10.144"></a><span id="l10.144"> {</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineat">@@ -1097,33 +1092,27 @@ bool nsEudoraMac::IsValidMailboxFile(nsI</span>
<a href="#l10.146"></a><span id="l10.146"> </span>
<a href="#l10.147"></a><span id="l10.147"> </span>
<a href="#l10.148"></a><span id="l10.148"> </span>
<a href="#l10.149"></a><span id="l10.149"> bool nsEudoraMac::FindAddressFolder(nsIFile **pFolder)</span>
<a href="#l10.150"></a><span id="l10.150"> {</span>
<a href="#l10.151"></a><span id="l10.151">   return FindEudoraLocation(pFolder);</span>
<a href="#l10.152"></a><span id="l10.152"> }</span>
<a href="#l10.153"></a><span id="l10.153"> </span>
<a href="#l10.154"></a><span id="l10.154" class="difflineminus">-nsresult nsEudoraMac::FindAddressBooks(nsIFile *pRoot, nsISupportsArray **ppArray)</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineplus">+nsresult nsEudoraMac::FindAddressBooks(nsIFile *pRoot, nsIMutableArray *pArray)</span>
<a href="#l10.156"></a><span id="l10.156"> {</span>
<a href="#l10.157"></a><span id="l10.157">   // Look for the nicknames file in this folder and then</span>
<a href="#l10.158"></a><span id="l10.158">   // additional files in the Nicknames folder</span>
<a href="#l10.159"></a><span id="l10.159">   // Try and find the nickNames file</span>
<a href="#l10.160"></a><span id="l10.160">   nsresult rv;</span>
<a href="#l10.161"></a><span id="l10.161">   nsCOMPtr&lt;nsIFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l10.162"></a><span id="l10.162">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.163"></a><span id="l10.163">   rv = file-&gt;InitWithFile(pRoot);</span>
<a href="#l10.164"></a><span id="l10.164">   if (NS_FAILED(rv))</span>
<a href="#l10.165"></a><span id="l10.165">     return rv;</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineminus">-  rv = NS_NewISupportsArray(ppArray);</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineminus">-  {</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineminus">-    IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray\n&quot;);</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineminus">-    return rv;</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineminus">-  }</span>
<a href="#l10.172"></a><span id="l10.172"> </span>
<a href="#l10.173"></a><span id="l10.173">   nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l10.174"></a><span id="l10.174">   if (NS_FAILED(rv))</span>
<a href="#l10.175"></a><span id="l10.175">     return rv;</span>
<a href="#l10.176"></a><span id="l10.176"> </span>
<a href="#l10.177"></a><span id="l10.177">   nsString displayName;</span>
<a href="#l10.178"></a><span id="l10.178">   nsEudoraStringBundle::GetStringByID(EUDORAIMPORT_NICKNAMES_NAME, displayName);</span>
<a href="#l10.179"></a><span id="l10.179">   int64_t  sz = 0;</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineat">@@ -1148,17 +1137,17 @@ nsresult nsEudoraMac::FindAddressBooks(n</span>
<a href="#l10.181"></a><span id="l10.181">     {</span>
<a href="#l10.182"></a><span id="l10.182">       sz = 0;</span>
<a href="#l10.183"></a><span id="l10.183">       file-&gt;GetFileSize(&amp;sz);</span>
<a href="#l10.184"></a><span id="l10.184">       desc-&gt;SetPreferredName(displayName);</span>
<a href="#l10.185"></a><span id="l10.185">       desc-&gt;SetSize(sz);</span>
<a href="#l10.186"></a><span id="l10.186">       // SetAbFile will clone the file we pass to it.</span>
<a href="#l10.187"></a><span id="l10.187">       desc-&gt;SetAbFile(file);</span>
<a href="#l10.188"></a><span id="l10.188">       rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineminus">-      (*ppArray)-&gt;AppendElement(pInterface);</span>
<a href="#l10.190"></a><span id="l10.190" class="difflineplus">+      pArray-&gt;AppendElement(pInterface, false);</span>
<a href="#l10.191"></a><span id="l10.191">       pInterface-&gt;Release();</span>
<a href="#l10.192"></a><span id="l10.192">     }</span>
<a href="#l10.193"></a><span id="l10.193">     if (NS_FAILED(rv))</span>
<a href="#l10.194"></a><span id="l10.194">     {</span>
<a href="#l10.195"></a><span id="l10.195">       IMPORT_LOG0(&quot;*** Error creating address book descriptor for eudora nicknames\n&quot;);</span>
<a href="#l10.196"></a><span id="l10.196">       return rv;</span>
<a href="#l10.197"></a><span id="l10.197">     }</span>
<a href="#l10.198"></a><span id="l10.198">   }</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineat">@@ -1222,17 +1211,17 @@ nsresult nsEudoraMac::FindAddressBooks(n</span>
<a href="#l10.200"></a><span id="l10.200">             {</span>
<a href="#l10.201"></a><span id="l10.201">               sz = 0;</span>
<a href="#l10.202"></a><span id="l10.202">               entry-&gt;GetFileSize(&amp;sz);</span>
<a href="#l10.203"></a><span id="l10.203">               desc-&gt;SetPreferredName(displayName);</span>
<a href="#l10.204"></a><span id="l10.204">               desc-&gt;SetSize(sz);</span>
<a href="#l10.205"></a><span id="l10.205">               // SetAbFile will clone the file we pass to it.</span>
<a href="#l10.206"></a><span id="l10.206">               desc-&gt;SetAbFile(entry);</span>
<a href="#l10.207"></a><span id="l10.207">               rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineminus">-              (*ppArray)-&gt;AppendElement(pInterface);</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineplus">+              pArray-&gt;AppendElement(pInterface, false);</span>
<a href="#l10.210"></a><span id="l10.210">               pInterface-&gt;Release();</span>
<a href="#l10.211"></a><span id="l10.211">             }</span>
<a href="#l10.212"></a><span id="l10.212">             if (NS_FAILED(rv))</span>
<a href="#l10.213"></a><span id="l10.213">             {</span>
<a href="#l10.214"></a><span id="l10.214">               IMPORT_LOG0(&quot;*** Error creating address book descriptor for eudora address book\n&quot;);</span>
<a href="#l10.215"></a><span id="l10.215">               return rv;</span>
<a href="#l10.216"></a><span id="l10.216">             }</span>
<a href="#l10.217"></a><span id="l10.217">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMac.h</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMac.h</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -6,52 +6,52 @@</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5"> #ifndef nsEudoraMac_h__</span>
<a href="#l11.6"></a><span id="l11.6"> #define nsEudoraMac_h__</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> #include &quot;mozilla/Attributes.h&quot;</span>
<a href="#l11.9"></a><span id="l11.9"> #include &quot;nscore.h&quot;</span>
<a href="#l11.10"></a><span id="l11.10"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l11.11"></a><span id="l11.11"> #include &quot;nsIFile.h&quot;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l11.13"></a><span id="l11.13"> #include &quot;nsEudoraMailbox.h&quot;</span>
<a href="#l11.14"></a><span id="l11.14"> #include &quot;nsEudoraAddress.h&quot;</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16"> #include &lt;CoreServices/CoreServices.h&gt;</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18"> class nsIImportService;</span>
<a href="#l11.19"></a><span id="l11.19"> class nsIMsgAccountManager;</span>
<a href="#l11.20"></a><span id="l11.20"> class nsIMsgAccount;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+class nsIMutableArray;</span>
<a href="#l11.22"></a><span id="l11.22"> </span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24"> class nsEudoraMac : public nsEudoraMailbox, public nsEudoraAddress {</span>
<a href="#l11.25"></a><span id="l11.25"> public:</span>
<a href="#l11.26"></a><span id="l11.26">   nsEudoraMac();</span>
<a href="#l11.27"></a><span id="l11.27">   ~nsEudoraMac();</span>
<a href="#l11.28"></a><span id="l11.28"> </span>
<a href="#l11.29"></a><span id="l11.29">     // retrieve the mail folder</span>
<a href="#l11.30"></a><span id="l11.30">   virtual bool      FindMailFolder(nsIFile **pFolder) MOZ_OVERRIDE;</span>
<a href="#l11.31"></a><span id="l11.31">     // get the list of mailboxes</span>
<a href="#l11.32"></a><span id="l11.32">   virtual nsresult  FindMailboxes(nsIFile *pRoot,</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-                                  nsISupportsArray **ppArray) MOZ_OVERRIDE;</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+                                  nsIMutableArray *pArray) MOZ_OVERRIDE;</span>
<a href="#l11.35"></a><span id="l11.35">     // get a TOC file from a mailbox file</span>
<a href="#l11.36"></a><span id="l11.36">   virtual nsresult  FindTOCFile(nsIFile *pMailFile,</span>
<a href="#l11.37"></a><span id="l11.37">                                 nsIFile **pTOCFile,</span>
<a href="#l11.38"></a><span id="l11.38">                                 bool *pDeleteToc) MOZ_OVERRIDE;</span>
<a href="#l11.39"></a><span id="l11.39"> </span>
<a href="#l11.40"></a><span id="l11.40">   virtual nsresult  GetAttachmentInfo(const char *pFileName,</span>
<a href="#l11.41"></a><span id="l11.41">                                       nsIFile *pFile,</span>
<a href="#l11.42"></a><span id="l11.42">                                       nsCString&amp; mimeType,</span>
<a href="#l11.43"></a><span id="l11.43">                                       nsCString&amp; aAttachment) MOZ_OVERRIDE;</span>
<a href="#l11.44"></a><span id="l11.44"> </span>
<a href="#l11.45"></a><span id="l11.45">     // Address book stuff</span>
<a href="#l11.46"></a><span id="l11.46">   virtual bool      FindAddressFolder(nsIFile **pFolder) MOZ_OVERRIDE;</span>
<a href="#l11.47"></a><span id="l11.47">     // get the list of mailboxes</span>
<a href="#l11.48"></a><span id="l11.48">   virtual nsresult  FindAddressBooks(nsIFile *pRoot,</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-                                     nsISupportsArray **ppArray) MOZ_OVERRIDE;</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+                                     nsIMutableArray *pArray) MOZ_OVERRIDE;</span>
<a href="#l11.51"></a><span id="l11.51"> </span>
<a href="#l11.52"></a><span id="l11.52">     // import settings</span>
<a href="#l11.53"></a><span id="l11.53">   static bool    ImportSettings(nsIFile *pIniFile,</span>
<a href="#l11.54"></a><span id="l11.54">                                 nsIMsgAccount **localMailAccount);</span>
<a href="#l11.55"></a><span id="l11.55">   static bool    FindSettingsFile(nsIFile **pIniFile) { return FindEudoraLocation(pIniFile, true);}</span>
<a href="#l11.56"></a><span id="l11.56"> </span>
<a href="#l11.57"></a><span id="l11.57">   static bool    FindFiltersFile(nsIFile **pFiltersFile);</span>
<a href="#l11.58"></a><span id="l11.58"> </span>
<a href="#l11.59"></a><span id="l11.59" class="difflineat">@@ -61,28 +61,28 @@ private:</span>
<a href="#l11.60"></a><span id="l11.60">                                     nsIFile *pLookIn = nullptr);</span>
<a href="#l11.61"></a><span id="l11.61">   static bool    FindEudoraLocation(nsIFile **pFolder,</span>
<a href="#l11.62"></a><span id="l11.62">                                     bool findIni,</span>
<a href="#l11.63"></a><span id="l11.63">                                     const char *specialDirName);</span>
<a href="#l11.64"></a><span id="l11.64">   static bool    VerifyEudoraLocation(nsIFile **pFolder, bool findIni);</span>
<a href="#l11.65"></a><span id="l11.65"> </span>
<a href="#l11.66"></a><span id="l11.66"> </span>
<a href="#l11.67"></a><span id="l11.67">   nsresult  ScanMailDir(nsIFile *pFolder,</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineminus">-                        nsISupportsArray *pArray,</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineplus">+                        nsIMutableArray *pArray,</span>
<a href="#l11.70"></a><span id="l11.70">                         nsIImportService *pImport);</span>
<a href="#l11.71"></a><span id="l11.71">   nsresult  IterateMailDir(nsIFile *pFolder,</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineminus">-                           nsISupportsArray *pArray,</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+                           nsIMutableArray *pArray,</span>
<a href="#l11.74"></a><span id="l11.74">                            nsIImportService *pImport);</span>
<a href="#l11.75"></a><span id="l11.75">   nsresult  FoundMailFolder(nsIFile *mailFolder,</span>
<a href="#l11.76"></a><span id="l11.76">                             const char *pName,</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineminus">-                            nsISupportsArray *pArray,</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineplus">+                            nsIMutableArray *pArray,</span>
<a href="#l11.79"></a><span id="l11.79">                             nsIImportService *pImport);</span>
<a href="#l11.80"></a><span id="l11.80">   nsresult  FoundMailbox(nsIFile *mailFile,</span>
<a href="#l11.81"></a><span id="l11.81">                          const char *pName,</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineminus">-                         nsISupportsArray *pArray,</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineplus">+                         nsIMutableArray *pArray,</span>
<a href="#l11.84"></a><span id="l11.84">                          nsIImportService *pImport);</span>
<a href="#l11.85"></a><span id="l11.85"> </span>
<a href="#l11.86"></a><span id="l11.86">   bool      IsValidMailFolderName(nsCString&amp; name);</span>
<a href="#l11.87"></a><span id="l11.87">   bool      IsValidMailboxName(nsCString&amp; fName);</span>
<a href="#l11.88"></a><span id="l11.88">   bool      IsValidMailboxFile(nsIFile *pFile);</span>
<a href="#l11.89"></a><span id="l11.89"> </span>
<a href="#l11.90"></a><span id="l11.90">   bool      CreateTocFromResource(nsIFile *pMail, nsIFile **pToc);</span>
<a href="#l11.91"></a><span id="l11.91"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMailbox.h</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMailbox.h</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -6,20 +6,20 @@</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> #ifndef nsEudoraMailbox_h__</span>
<a href="#l12.6"></a><span id="l12.6"> #define nsEudoraMailbox_h__</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8"> #include &quot;nscore.h&quot;</span>
<a href="#l12.9"></a><span id="l12.9"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l12.10"></a><span id="l12.10"> #include &quot;nsVoidArray.h&quot;</span>
<a href="#l12.11"></a><span id="l12.11"> #include &quot;nsIFile.h&quot;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l12.13"></a><span id="l12.13"> #include &quot;nsEudoraCompose.h&quot;</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15"> class nsIOutputStream;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+class nsIMutableArray;</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18"> /////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l12.19"></a><span id="l12.19"> /////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l12.20"></a><span id="l12.20"> /////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22"> class EudoraTOCEntry {</span>
<a href="#l12.23"></a><span id="l12.23"> public:</span>
<a href="#l12.24"></a><span id="l12.24">   uint16_t    GetMozillaStatusFlags();</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineat">@@ -136,17 +136,17 @@ class nsEudoraMailbox {</span>
<a href="#l12.26"></a><span id="l12.26"> public:</span>
<a href="#l12.27"></a><span id="l12.27">   nsEudoraMailbox();</span>
<a href="#l12.28"></a><span id="l12.28">   virtual ~nsEudoraMailbox();</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30">   // Things that must be overridden because they are platform specific.</span>
<a href="#l12.31"></a><span id="l12.31">     // retrieve the mail folder</span>
<a href="#l12.32"></a><span id="l12.32">   virtual bool      FindMailFolder(nsIFile **pFolder) { return false;}</span>
<a href="#l12.33"></a><span id="l12.33">     // get the list of mailboxes</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-  virtual nsresult  FindMailboxes(nsIFile *pRoot, nsISupportsArray **ppArray) { return NS_ERROR_FAILURE;}</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+  virtual nsresult  FindMailboxes(nsIFile *pRoot, nsIMutableArray *pArray) { return NS_ERROR_FAILURE;}</span>
<a href="#l12.36"></a><span id="l12.36">     // get the toc file corresponding to this mailbox</span>
<a href="#l12.37"></a><span id="l12.37">   virtual nsresult  FindTOCFile(nsIFile *pMailFile, nsIFile **pTOCFile, bool *pDeleteToc) { return NS_ERROR_FAILURE;}</span>
<a href="#l12.38"></a><span id="l12.38">     // interpret the attachment line and return the attached file</span>
<a href="#l12.39"></a><span id="l12.39">   virtual nsresult  GetAttachmentInfo(const char *pFileName, nsIFile *pFile, nsCString&amp; mimeType, nsCString&amp; aAttachment) { return NS_ERROR_FAILURE;}</span>
<a href="#l12.40"></a><span id="l12.40"> </span>
<a href="#l12.41"></a><span id="l12.41">   // Non-platform specific common stuff</span>
<a href="#l12.42"></a><span id="l12.42">     // import a mailbox</span>
<a href="#l12.43"></a><span id="l12.43">   nsresult ImportMailbox(uint32_t *pBytes, bool *pAbort, const PRUnichar *pName,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -5,16 +5,17 @@</span>
<a href="#l13.4"></a><span id="l13.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l13.7"></a><span id="l13.7"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l13.8"></a><span id="l13.8"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l13.9"></a><span id="l13.9"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l13.10"></a><span id="l13.10"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l13.11"></a><span id="l13.11"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l13.13"></a><span id="l13.13"> #include &quot;nsIPop3IncomingServer.h&quot;</span>
<a href="#l13.14"></a><span id="l13.14"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l13.15"></a><span id="l13.15"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l13.16"></a><span id="l13.16"> #include &quot;nsISmtpService.h&quot;</span>
<a href="#l13.17"></a><span id="l13.17"> #include &quot;nsISmtpServer.h&quot;</span>
<a href="#l13.18"></a><span id="l13.18"> #include &quot;nsEudoraWin32.h&quot;</span>
<a href="#l13.19"></a><span id="l13.19"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l13.20"></a><span id="l13.20"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineat">@@ -145,36 +146,30 @@ bool nsEudoraWin32::FindEudoraLocation(n</span>
<a href="#l13.22"></a><span id="l13.22">     } // if pBytes</span>
<a href="#l13.23"></a><span id="l13.23">     ::RegCloseKey(sKey);</span>
<a href="#l13.24"></a><span id="l13.24">   }</span>
<a href="#l13.25"></a><span id="l13.25"> </span>
<a href="#l13.26"></a><span id="l13.26">   NS_IF_ADDREF(*pFolder = eudoraPath);</span>
<a href="#l13.27"></a><span id="l13.27">   return result;</span>
<a href="#l13.28"></a><span id="l13.28"> }</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-nsresult nsEudoraWin32::FindMailboxes(nsIFile *pRoot, nsISupportsArray **ppArray)</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+nsresult nsEudoraWin32::FindMailboxes(nsIFile *pRoot, nsIMutableArray *pArray)</span>
<a href="#l13.32"></a><span id="l13.32"> {</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-  nsresult rv = NS_NewISupportsArray(ppArray);</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-  {</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-    IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray\n&quot;);</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-    return rv;</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-  }</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+  nsresult rv;</span>
<a href="#l13.41"></a><span id="l13.41">   nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l13.42"></a><span id="l13.42">   if (NS_FAILED(rv))</span>
<a href="#l13.43"></a><span id="l13.43">     return rv;</span>
<a href="#l13.44"></a><span id="l13.44"> </span>
<a href="#l13.45"></a><span id="l13.45">   m_depth = 0;</span>
<a href="#l13.46"></a><span id="l13.46">   m_mailImportLocation = do_QueryInterface(pRoot);</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-  return ScanMailDir(pRoot, *ppArray, impSvc);</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+  return ScanMailDir(pRoot, pArray, impSvc);</span>
<a href="#l13.49"></a><span id="l13.49"> }</span>
<a href="#l13.50"></a><span id="l13.50"> </span>
<a href="#l13.51"></a><span id="l13.51"> </span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-nsresult nsEudoraWin32::ScanMailDir(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+nsresult nsEudoraWin32::ScanMailDir(nsIFile *pFolder, nsIMutableArray *pArray, nsIImportService *pImport)</span>
<a href="#l13.54"></a><span id="l13.54"> {</span>
<a href="#l13.55"></a><span id="l13.55">   bool            exists = false;</span>
<a href="#l13.56"></a><span id="l13.56">   bool            isFile = false;</span>
<a href="#l13.57"></a><span id="l13.57">   char *          pContents = nullptr;</span>
<a href="#l13.58"></a><span id="l13.58">   int32_t          len = 0;</span>
<a href="#l13.59"></a><span id="l13.59">   nsCOMPtr&lt;nsIFile&gt;  descMap;</span>
<a href="#l13.60"></a><span id="l13.60">   nsresult        rv;</span>
<a href="#l13.61"></a><span id="l13.61"> </span>
<a href="#l13.62"></a><span id="l13.62" class="difflineat">@@ -226,17 +221,17 @@ nsresult nsEudoraWin32::ScanMailDir(nsIF</span>
<a href="#l13.63"></a><span id="l13.63">   if (NS_FAILED(rv) || !isFile || !exists)</span>
<a href="#l13.64"></a><span id="l13.64">     rv = IterateMailDir(pFolder, pArray, pImport);</span>
<a href="#l13.65"></a><span id="l13.65"> </span>
<a href="#l13.66"></a><span id="l13.66">   m_depth--;</span>
<a href="#l13.67"></a><span id="l13.67"> </span>
<a href="#l13.68"></a><span id="l13.68">   return rv;</span>
<a href="#l13.69"></a><span id="l13.69"> }</span>
<a href="#l13.70"></a><span id="l13.70"> </span>
<a href="#l13.71"></a><span id="l13.71" class="difflineminus">-nsresult nsEudoraWin32::IterateMailDir(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+nsresult nsEudoraWin32::IterateMailDir(nsIFile *pFolder, nsIMutableArray *pArray, nsIImportService *pImport)</span>
<a href="#l13.73"></a><span id="l13.73"> {</span>
<a href="#l13.74"></a><span id="l13.74">   bool hasMore;</span>
<a href="#l13.75"></a><span id="l13.75">   nsCOMPtr&lt;nsISimpleEnumerator&gt; directoryEnumerator;</span>
<a href="#l13.76"></a><span id="l13.76">   nsresult rv = pFolder-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l13.77"></a><span id="l13.77">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.78"></a><span id="l13.78"> </span>
<a href="#l13.79"></a><span id="l13.79">   directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l13.80"></a><span id="l13.80">   bool              isFolder;</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineat">@@ -293,17 +288,17 @@ nsresult nsEudoraWin32::IterateMailDir(n</span>
<a href="#l13.82"></a><span id="l13.82">             rv = FoundMailbox(entry, name.get(), pArray, pImport);</span>
<a href="#l13.83"></a><span id="l13.83">         }</span>
<a href="#l13.84"></a><span id="l13.84">       }</span>
<a href="#l13.85"></a><span id="l13.85">     }</span>
<a href="#l13.86"></a><span id="l13.86">   }</span>
<a href="#l13.87"></a><span id="l13.87">   return rv;</span>
<a href="#l13.88"></a><span id="l13.88"> }</span>
<a href="#l13.89"></a><span id="l13.89"> </span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-nsresult nsEudoraWin32::ScanDescmap(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport, const char *pData, int32_t len)</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineplus">+nsresult nsEudoraWin32::ScanDescmap(nsIFile *pFolder, nsIMutableArray *pArray, nsIImportService *pImport, const char *pData, int32_t len)</span>
<a href="#l13.92"></a><span id="l13.92"> {</span>
<a href="#l13.93"></a><span id="l13.93">   // use this to find stuff in the directory.</span>
<a href="#l13.94"></a><span id="l13.94"> </span>
<a href="#l13.95"></a><span id="l13.95">   nsCOMPtr&lt;nsIFile&gt;  entry;</span>
<a href="#l13.96"></a><span id="l13.96">   nsresult        rv;</span>
<a href="#l13.97"></a><span id="l13.97"> </span>
<a href="#l13.98"></a><span id="l13.98">   if (NS_FAILED(rv = pFolder-&gt;Clone(getter_AddRefs(entry))))</span>
<a href="#l13.99"></a><span id="l13.99">     return rv;</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineat">@@ -420,17 +415,17 @@ nsresult nsEudoraWin32::ScanDescmap(nsIF</span>
<a href="#l13.101"></a><span id="l13.101">       }</span>
<a href="#l13.102"></a><span id="l13.102">     }</span>
<a href="#l13.103"></a><span id="l13.103">   }</span>
<a href="#l13.104"></a><span id="l13.104"> </span>
<a href="#l13.105"></a><span id="l13.105">   return NS_OK;</span>
<a href="#l13.106"></a><span id="l13.106"> }</span>
<a href="#l13.107"></a><span id="l13.107"> </span>
<a href="#l13.108"></a><span id="l13.108"> </span>
<a href="#l13.109"></a><span id="l13.109" class="difflineminus">-nsresult nsEudoraWin32::FoundMailbox(nsIFile *mailFile, const char *pName, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineplus">+nsresult nsEudoraWin32::FoundMailbox(nsIFile *mailFile, const char *pName, nsIMutableArray *pArray, nsIImportService *pImport)</span>
<a href="#l13.111"></a><span id="l13.111"> {</span>
<a href="#l13.112"></a><span id="l13.112">   nsString displayName;</span>
<a href="#l13.113"></a><span id="l13.113">   nsCOMPtr&lt;nsIImportMailboxDescriptor&gt; desc;</span>
<a href="#l13.114"></a><span id="l13.114">   nsISupports * pInterface;</span>
<a href="#l13.115"></a><span id="l13.115"> </span>
<a href="#l13.116"></a><span id="l13.116">   NS_CopyNativeToUnicode(nsDependentCString(pName), displayName);</span>
<a href="#l13.117"></a><span id="l13.117"> </span>
<a href="#l13.118"></a><span id="l13.118"> #ifdef IMPORT_DEBUG</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineat">@@ -453,25 +448,25 @@ nsresult nsEudoraWin32::FoundMailbox(nsI</span>
<a href="#l13.120"></a><span id="l13.120">     desc-&gt;SetSize(sz);</span>
<a href="#l13.121"></a><span id="l13.121">     nsCOMPtr &lt;nsIFile&gt; pFile = nullptr;</span>
<a href="#l13.122"></a><span id="l13.122">     desc-&gt;GetFile(getter_AddRefs(pFile));</span>
<a href="#l13.123"></a><span id="l13.123">     if (pFile)</span>
<a href="#l13.124"></a><span id="l13.124">     {</span>
<a href="#l13.125"></a><span id="l13.125">       pFile-&gt;InitWithFile(mailFile);</span>
<a href="#l13.126"></a><span id="l13.126">     }</span>
<a href="#l13.127"></a><span id="l13.127">     rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineminus">-    pArray-&gt;AppendElement(pInterface);</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineplus">+    pArray-&gt;AppendElement(pInterface, false);</span>
<a href="#l13.130"></a><span id="l13.130">     pInterface-&gt;Release();</span>
<a href="#l13.131"></a><span id="l13.131">   }</span>
<a href="#l13.132"></a><span id="l13.132"> </span>
<a href="#l13.133"></a><span id="l13.133">   return NS_OK;</span>
<a href="#l13.134"></a><span id="l13.134"> }</span>
<a href="#l13.135"></a><span id="l13.135"> </span>
<a href="#l13.136"></a><span id="l13.136"> </span>
<a href="#l13.137"></a><span id="l13.137" class="difflineminus">-nsresult nsEudoraWin32::FoundMailFolder(nsIFile *mailFolder, const char *pName, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineplus">+nsresult nsEudoraWin32::FoundMailFolder(nsIFile *mailFolder, const char *pName, nsIMutableArray *pArray, nsIImportService *pImport)</span>
<a href="#l13.139"></a><span id="l13.139"> {</span>
<a href="#l13.140"></a><span id="l13.140">   nsString                displayName;</span>
<a href="#l13.141"></a><span id="l13.141">   nsCOMPtr&lt;nsIImportMailboxDescriptor&gt;  desc;</span>
<a href="#l13.142"></a><span id="l13.142">   nsISupports *              pInterface;</span>
<a href="#l13.143"></a><span id="l13.143"> </span>
<a href="#l13.144"></a><span id="l13.144">   NS_CopyNativeToUnicode(nsDependentCString(pName), displayName);</span>
<a href="#l13.145"></a><span id="l13.145"> </span>
<a href="#l13.146"></a><span id="l13.146"> #ifdef IMPORT_DEBUG</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineat">@@ -493,17 +488,17 @@ nsresult nsEudoraWin32::FoundMailFolder(</span>
<a href="#l13.148"></a><span id="l13.148">     desc-&gt;SetSize(sz);</span>
<a href="#l13.149"></a><span id="l13.149">     nsCOMPtr &lt;nsIFile&gt; pFile = nullptr;</span>
<a href="#l13.150"></a><span id="l13.150">     desc-&gt;GetFile(getter_AddRefs(pFile));</span>
<a href="#l13.151"></a><span id="l13.151">     if (pFile)</span>
<a href="#l13.152"></a><span id="l13.152">     {</span>
<a href="#l13.153"></a><span id="l13.153">       pFile-&gt;InitWithFile(mailFolder);</span>
<a href="#l13.154"></a><span id="l13.154">     }</span>
<a href="#l13.155"></a><span id="l13.155">     rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineminus">-    pArray-&gt;AppendElement(pInterface);</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineplus">+    pArray-&gt;AppendElement(pInterface, false);</span>
<a href="#l13.158"></a><span id="l13.158">     pInterface-&gt;Release();</span>
<a href="#l13.159"></a><span id="l13.159">   }</span>
<a href="#l13.160"></a><span id="l13.160"> </span>
<a href="#l13.161"></a><span id="l13.161">   return NS_OK;</span>
<a href="#l13.162"></a><span id="l13.162"> }</span>
<a href="#l13.163"></a><span id="l13.163"> </span>
<a href="#l13.164"></a><span id="l13.164"> </span>
<a href="#l13.165"></a><span id="l13.165"> nsresult nsEudoraWin32::FindTOCFile(nsIFile *pMailFile, nsIFile **ppTOCFile, bool *pDeleteToc)</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineat">@@ -1311,31 +1306,24 @@ void nsEudoraWin32::GetMimeTypeFromExten</span>
<a href="#l13.167"></a><span id="l13.167"> </span>
<a href="#l13.168"></a><span id="l13.168"> bool nsEudoraWin32::FindAddressFolder(nsIFile **pFolder)</span>
<a href="#l13.169"></a><span id="l13.169"> {</span>
<a href="#l13.170"></a><span id="l13.170">   IMPORT_LOG0(&quot;*** Looking for Eudora address folder\n&quot;);</span>
<a href="#l13.171"></a><span id="l13.171"> </span>
<a href="#l13.172"></a><span id="l13.172">   return FindEudoraLocation(pFolder);</span>
<a href="#l13.173"></a><span id="l13.173"> }</span>
<a href="#l13.174"></a><span id="l13.174"> </span>
<a href="#l13.175"></a><span id="l13.175" class="difflineminus">-nsresult nsEudoraWin32::FindAddressBooks(nsIFile *pRoot, nsISupportsArray **ppArray)</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineplus">+nsresult nsEudoraWin32::FindAddressBooks(nsIFile *pRoot, nsIMutableArray *pArray)</span>
<a href="#l13.177"></a><span id="l13.177"> {</span>
<a href="#l13.178"></a><span id="l13.178">   nsresult rv;</span>
<a href="#l13.179"></a><span id="l13.179">   nsCOMPtr&lt;nsIFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l13.180"></a><span id="l13.180">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.181"></a><span id="l13.181">   rv = file-&gt;InitWithFile(pRoot);</span>
<a href="#l13.182"></a><span id="l13.182">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.183"></a><span id="l13.183"> </span>
<a href="#l13.184"></a><span id="l13.184" class="difflineminus">-  rv = NS_NewISupportsArray(ppArray);</span>
<a href="#l13.185"></a><span id="l13.185" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineminus">-  {</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineminus">-    IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray\n&quot;);</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineminus">-    return rv;</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineminus">-  }</span>
<a href="#l13.190"></a><span id="l13.190" class="difflineminus">-</span>
<a href="#l13.191"></a><span id="l13.191">   nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l13.192"></a><span id="l13.192">   if (NS_FAILED(rv))</span>
<a href="#l13.193"></a><span id="l13.193">     return rv;</span>
<a href="#l13.194"></a><span id="l13.194">   m_addressImportFolder = pRoot;</span>
<a href="#l13.195"></a><span id="l13.195">   nsString    displayName;</span>
<a href="#l13.196"></a><span id="l13.196">   nsEudoraStringBundle::GetStringByID(EUDORAIMPORT_NICKNAMES_NAME, displayName);</span>
<a href="#l13.197"></a><span id="l13.197"> </span>
<a href="#l13.198"></a><span id="l13.198">   // First off, get the default nndbase.txt, then scan the default nicknames subdir,</span>
<a href="#l13.199"></a><span id="l13.199" class="difflineat">@@ -1360,34 +1348,34 @@ nsresult nsEudoraWin32::FindAddressBooks</span>
<a href="#l13.200"></a><span id="l13.200">     // Check for alternate file extension &quot;.nnt&quot; which Windows Eudora uses as an option</span>
<a href="#l13.201"></a><span id="l13.201">     // to hide from simple minded viruses that scan &quot;.txt&quot; files for addresses.</span>
<a href="#l13.202"></a><span id="l13.202">     rv = file-&gt;SetNativeLeafName(NS_LITERAL_CSTRING(&quot;nndbase.nnt&quot;));</span>
<a href="#l13.203"></a><span id="l13.203">     checkedBoth = true;</span>
<a href="#l13.204"></a><span id="l13.204">   } while (NS_SUCCEEDED(rv));</span>
<a href="#l13.205"></a><span id="l13.205"> </span>
<a href="#l13.206"></a><span id="l13.206">   if (exists &amp;&amp; isFile)</span>
<a href="#l13.207"></a><span id="l13.207">   {</span>
<a href="#l13.208"></a><span id="l13.208" class="difflineminus">-    if (NS_FAILED(rv = FoundAddressBook(file, displayName.get(), *ppArray, impSvc)))</span>
<a href="#l13.209"></a><span id="l13.209" class="difflineplus">+    if (NS_FAILED(rv = FoundAddressBook(file, displayName.get(), pArray, impSvc)))</span>
<a href="#l13.210"></a><span id="l13.210">       return rv;</span>
<a href="#l13.211"></a><span id="l13.211">   }</span>
<a href="#l13.212"></a><span id="l13.212"> </span>
<a href="#l13.213"></a><span id="l13.213">   // Try the default directory</span>
<a href="#l13.214"></a><span id="l13.214">   rv = file-&gt;InitWithFile(pRoot);</span>
<a href="#l13.215"></a><span id="l13.215">   if (NS_FAILED(rv))</span>
<a href="#l13.216"></a><span id="l13.216">     return rv;</span>
<a href="#l13.217"></a><span id="l13.217">   rv = file-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;Nickname&quot;));</span>
<a href="#l13.218"></a><span id="l13.218">   bool isDir = false;</span>
<a href="#l13.219"></a><span id="l13.219">   exists = false;</span>
<a href="#l13.220"></a><span id="l13.220">   if (NS_SUCCEEDED(rv))</span>
<a href="#l13.221"></a><span id="l13.221">     rv = file-&gt;Exists(&amp;exists);</span>
<a href="#l13.222"></a><span id="l13.222">   if (NS_SUCCEEDED(rv) &amp;&amp; exists)</span>
<a href="#l13.223"></a><span id="l13.223">     rv = file-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l13.224"></a><span id="l13.224">   if (exists &amp;&amp; isDir)</span>
<a href="#l13.225"></a><span id="l13.225">   {</span>
<a href="#l13.226"></a><span id="l13.226" class="difflineminus">-    if (NS_FAILED(rv = ScanAddressDir(file, *ppArray, impSvc)))</span>
<a href="#l13.227"></a><span id="l13.227" class="difflineplus">+    if (NS_FAILED(rv = ScanAddressDir(file, pArray, impSvc)))</span>
<a href="#l13.228"></a><span id="l13.228">       return rv;</span>
<a href="#l13.229"></a><span id="l13.229">   }</span>
<a href="#l13.230"></a><span id="l13.230"> </span>
<a href="#l13.231"></a><span id="l13.231">   // Try the ini file to find other directories!</span>
<a href="#l13.232"></a><span id="l13.232">   rv = file-&gt;InitWithFile(pRoot);</span>
<a href="#l13.233"></a><span id="l13.233">   if (NS_FAILED(rv))</span>
<a href="#l13.234"></a><span id="l13.234">     return rv;</span>
<a href="#l13.235"></a><span id="l13.235">   rv = file-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;eudora.ini&quot;));</span>
<a href="#l13.236"></a><span id="l13.236" class="difflineat">@@ -1435,17 +1423,17 @@ nsresult nsEudoraWin32::FindAddressBooks</span>
<a href="#l13.237"></a><span id="l13.237">       exists = false;</span>
<a href="#l13.238"></a><span id="l13.238">       isDir = false;</span>
<a href="#l13.239"></a><span id="l13.239">       if (NS_SUCCEEDED(rv))</span>
<a href="#l13.240"></a><span id="l13.240">         rv = file-&gt;Exists(&amp;exists);</span>
<a href="#l13.241"></a><span id="l13.241">       if (NS_SUCCEEDED(rv) &amp;&amp; exists)</span>
<a href="#l13.242"></a><span id="l13.242">         rv = file-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l13.243"></a><span id="l13.243">       if (exists &amp;&amp; isDir)</span>
<a href="#l13.244"></a><span id="l13.244">       {</span>
<a href="#l13.245"></a><span id="l13.245" class="difflineminus">-        if (NS_FAILED(rv = ScanAddressDir(file, *ppArray, impSvc)))</span>
<a href="#l13.246"></a><span id="l13.246" class="difflineplus">+        if (NS_FAILED(rv = ScanAddressDir(file, pArray, impSvc)))</span>
<a href="#l13.247"></a><span id="l13.247">           return rv;</span>
<a href="#l13.248"></a><span id="l13.248">       }</span>
<a href="#l13.249"></a><span id="l13.249">     }</span>
<a href="#l13.250"></a><span id="l13.250">     dirs = Substring(dirs, idx + 1);</span>
<a href="#l13.251"></a><span id="l13.251">     dirs.Trim(kWhitespace);</span>
<a href="#l13.252"></a><span id="l13.252">   }</span>
<a href="#l13.253"></a><span id="l13.253">   if (!dirs.IsEmpty())</span>
<a href="#l13.254"></a><span id="l13.254">   {</span>
<a href="#l13.255"></a><span id="l13.255" class="difflineat">@@ -1453,26 +1441,25 @@ nsresult nsEudoraWin32::FindAddressBooks</span>
<a href="#l13.256"></a><span id="l13.256">     exists = false;</span>
<a href="#l13.257"></a><span id="l13.257">     isDir = false;</span>
<a href="#l13.258"></a><span id="l13.258">     if (NS_SUCCEEDED(rv))</span>
<a href="#l13.259"></a><span id="l13.259">       rv = file-&gt;Exists(&amp;exists);</span>
<a href="#l13.260"></a><span id="l13.260">     if (NS_SUCCEEDED(rv) &amp;&amp; exists)</span>
<a href="#l13.261"></a><span id="l13.261">       rv = file-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l13.262"></a><span id="l13.262">     if (exists &amp;&amp; isDir)</span>
<a href="#l13.263"></a><span id="l13.263">     {</span>
<a href="#l13.264"></a><span id="l13.264" class="difflineminus">-      if (NS_FAILED(rv = ScanAddressDir(file, *ppArray, impSvc)))</span>
<a href="#l13.265"></a><span id="l13.265" class="difflineplus">+      if (NS_FAILED(rv = ScanAddressDir(file, pArray, impSvc)))</span>
<a href="#l13.266"></a><span id="l13.266">         return rv;</span>
<a href="#l13.267"></a><span id="l13.267">     }</span>
<a href="#l13.268"></a><span id="l13.268">   }</span>
<a href="#l13.269"></a><span id="l13.269" class="difflineminus">-</span>
<a href="#l13.270"></a><span id="l13.270">   return NS_OK;</span>
<a href="#l13.271"></a><span id="l13.271"> }</span>
<a href="#l13.272"></a><span id="l13.272"> </span>
<a href="#l13.273"></a><span id="l13.273"> </span>
<a href="#l13.274"></a><span id="l13.274" class="difflineminus">-nsresult nsEudoraWin32::ScanAddressDir(nsIFile *pDir, nsISupportsArray *pArray, nsIImportService *impSvc)</span>
<a href="#l13.275"></a><span id="l13.275" class="difflineplus">+nsresult nsEudoraWin32::ScanAddressDir(nsIFile *pDir, nsIMutableArray *pArray, nsIImportService *impSvc)</span>
<a href="#l13.276"></a><span id="l13.276"> {</span>
<a href="#l13.277"></a><span id="l13.277">   bool hasMore;</span>
<a href="#l13.278"></a><span id="l13.278">   nsCOMPtr&lt;nsISimpleEnumerator&gt; directoryEnumerator;</span>
<a href="#l13.279"></a><span id="l13.279">   nsresult rv = pDir-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l13.280"></a><span id="l13.280">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.281"></a><span id="l13.281"> </span>
<a href="#l13.282"></a><span id="l13.282">   directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l13.283"></a><span id="l13.283">   bool              isFile;</span>
<a href="#l13.284"></a><span id="l13.284" class="difflineat">@@ -1520,17 +1507,17 @@ nsresult nsEudoraWin32::ScanAddressDir(n</span>
<a href="#l13.285"></a><span id="l13.285">       }</span>
<a href="#l13.286"></a><span id="l13.286">     }</span>
<a href="#l13.287"></a><span id="l13.287">   }</span>
<a href="#l13.288"></a><span id="l13.288"> </span>
<a href="#l13.289"></a><span id="l13.289">   return rv;</span>
<a href="#l13.290"></a><span id="l13.290"> }</span>
<a href="#l13.291"></a><span id="l13.291"> </span>
<a href="#l13.292"></a><span id="l13.292"> </span>
<a href="#l13.293"></a><span id="l13.293" class="difflineminus">-nsresult nsEudoraWin32::FoundAddressBook(nsIFile *file, const PRUnichar *pName, nsISupportsArray *pArray, nsIImportService *impSvc)</span>
<a href="#l13.294"></a><span id="l13.294" class="difflineplus">+nsresult nsEudoraWin32::FoundAddressBook(nsIFile *file, const PRUnichar *pName, nsIMutableArray *pArray, nsIImportService *impSvc)</span>
<a href="#l13.295"></a><span id="l13.295"> {</span>
<a href="#l13.296"></a><span id="l13.296">   nsCOMPtr&lt;nsIImportABDescriptor&gt; desc;</span>
<a href="#l13.297"></a><span id="l13.297">   nsISupports *  pInterface;</span>
<a href="#l13.298"></a><span id="l13.298">   nsString name;</span>
<a href="#l13.299"></a><span id="l13.299">   nsresult rv;</span>
<a href="#l13.300"></a><span id="l13.300"> </span>
<a href="#l13.301"></a><span id="l13.301">   if (pName)</span>
<a href="#l13.302"></a><span id="l13.302">     name = pName;</span>
<a href="#l13.303"></a><span id="l13.303" class="difflineat">@@ -1551,17 +1538,17 @@ nsresult nsEudoraWin32::FoundAddressBook</span>
<a href="#l13.304"></a><span id="l13.304">   if (NS_SUCCEEDED(rv))</span>
<a href="#l13.305"></a><span id="l13.305">   {</span>
<a href="#l13.306"></a><span id="l13.306">     int64_t sz = 0;</span>
<a href="#l13.307"></a><span id="l13.307">     file-&gt;GetFileSize(&amp;sz);</span>
<a href="#l13.308"></a><span id="l13.308">     desc-&gt;SetPreferredName(name);</span>
<a href="#l13.309"></a><span id="l13.309">     desc-&gt;SetSize((uint32_t) sz);</span>
<a href="#l13.310"></a><span id="l13.310">     desc-&gt;SetAbFile(file);</span>
<a href="#l13.311"></a><span id="l13.311">     rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l13.312"></a><span id="l13.312" class="difflineminus">-    pArray-&gt;AppendElement(pInterface);</span>
<a href="#l13.313"></a><span id="l13.313" class="difflineplus">+    pArray-&gt;AppendElement(pInterface, false);</span>
<a href="#l13.314"></a><span id="l13.314">     pInterface-&gt;Release();</span>
<a href="#l13.315"></a><span id="l13.315">   }</span>
<a href="#l13.316"></a><span id="l13.316">   if (NS_FAILED(rv))</span>
<a href="#l13.317"></a><span id="l13.317">   {</span>
<a href="#l13.318"></a><span id="l13.318">     IMPORT_LOG0(&quot;*** Error creating address book descriptor for eudora\n&quot;);</span>
<a href="#l13.319"></a><span id="l13.319">     return rv;</span>
<a href="#l13.320"></a><span id="l13.320">   }</span>
<a href="#l13.321"></a><span id="l13.321"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraWin32.h</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraWin32.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -6,65 +6,65 @@</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5"> #ifndef nsEudoraWin32_h__</span>
<a href="#l14.6"></a><span id="l14.6"> #define nsEudoraWin32_h__</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> #include &quot;mozilla/Attributes.h&quot;</span>
<a href="#l14.9"></a><span id="l14.9"> #include &quot;nscore.h&quot;</span>
<a href="#l14.10"></a><span id="l14.10"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l14.11"></a><span id="l14.11"> #include &quot;nsIFile.h&quot;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l14.13"></a><span id="l14.13"> #include &quot;nsEudoraMailbox.h&quot;</span>
<a href="#l14.14"></a><span id="l14.14"> #include &quot;nsEudoraAddress.h&quot;</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> #include &lt;windows.h&gt;</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18"> class nsIImportService;</span>
<a href="#l14.19"></a><span id="l14.19"> class nsIMsgAccountManager;</span>
<a href="#l14.20"></a><span id="l14.20"> class nsIMsgAccount;</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+class nsIMutableArray;</span>
<a href="#l14.22"></a><span id="l14.22"> </span>
<a href="#l14.23"></a><span id="l14.23"> </span>
<a href="#l14.24"></a><span id="l14.24"> class nsEudoraWin32 : public nsEudoraMailbox, public nsEudoraAddress {</span>
<a href="#l14.25"></a><span id="l14.25"> public:</span>
<a href="#l14.26"></a><span id="l14.26">   nsEudoraWin32();</span>
<a href="#l14.27"></a><span id="l14.27">   ~nsEudoraWin32();</span>
<a href="#l14.28"></a><span id="l14.28"> </span>
<a href="#l14.29"></a><span id="l14.29">     // retrieve the mail folder</span>
<a href="#l14.30"></a><span id="l14.30">   virtual bool      FindMailFolder(nsIFile **pFolder) MOZ_OVERRIDE;</span>
<a href="#l14.31"></a><span id="l14.31">     // get the list of mailboxes</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-  virtual nsresult  FindMailboxes(nsIFile *pRoot, nsISupportsArray **ppArray) MOZ_OVERRIDE;</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+  virtual nsresult  FindMailboxes(nsIFile *pRoot, nsIMutableArray *pArray) MOZ_OVERRIDE;</span>
<a href="#l14.34"></a><span id="l14.34">     // get a TOC file from a mailbox file</span>
<a href="#l14.35"></a><span id="l14.35">   virtual nsresult  FindTOCFile(nsIFile *pMailFile, nsIFile **pTOCFile, bool *pDeleteToc) MOZ_OVERRIDE;</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37">   virtual nsresult  GetAttachmentInfo(const char *pFileName, nsIFile *pFile, nsCString&amp; mimeType, nsCString&amp; aAttachment) MOZ_OVERRIDE;</span>
<a href="#l14.38"></a><span id="l14.38"> </span>
<a href="#l14.39"></a><span id="l14.39">   // Things that must be overridden because they are platform specific.</span>
<a href="#l14.40"></a><span id="l14.40">     // retrieve the address book folder</span>
<a href="#l14.41"></a><span id="l14.41">   virtual bool      FindAddressFolder(nsIFile **pFolder) MOZ_OVERRIDE;</span>
<a href="#l14.42"></a><span id="l14.42">     // get the list of address books</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-  virtual nsresult  FindAddressBooks(nsIFile *pRoot, nsISupportsArray **ppArray) MOZ_OVERRIDE;</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+  virtual nsresult  FindAddressBooks(nsIFile *pRoot, nsIMutableArray *pArray) MOZ_OVERRIDE;</span>
<a href="#l14.45"></a><span id="l14.45"> </span>
<a href="#l14.46"></a><span id="l14.46">     // import settings from Win32 ini file</span>
<a href="#l14.47"></a><span id="l14.47">   static bool    ImportSettings(nsIFile *pIniFile, nsIMsgAccount **localMailAccount);</span>
<a href="#l14.48"></a><span id="l14.48">   static bool    FindSettingsFile(nsIFile **pIniFile) { return FindEudoraLocation(pIniFile, true);}</span>
<a href="#l14.49"></a><span id="l14.49"> </span>
<a href="#l14.50"></a><span id="l14.50">   static bool    FindFiltersFile(nsIFile **pFiltersFile);</span>
<a href="#l14.51"></a><span id="l14.51"> </span>
<a href="#l14.52"></a><span id="l14.52">   static bool    GetMailboxNameHierarchy(const nsACString&amp; pEudoraLocation, const char* pEudoraFilePath, nsCString&amp; nameHierarchy);</span>
<a href="#l14.53"></a><span id="l14.53"> </span>
<a href="#l14.54"></a><span id="l14.54"> private:</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-  nsresult  ScanMailDir(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport);</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-  nsresult  IterateMailDir(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport);</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-  nsresult  ScanDescmap(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport, const char *pData, int32_t len);</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-  nsresult  FoundMailFolder(nsIFile *mailFolder, const char *pName, nsISupportsArray *pArray, nsIImportService *pImport);</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">-  nsresult  FoundMailbox(nsIFile *mailFile, const char *pName, nsISupportsArray *pArray, nsIImportService *pImport);</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+  nsresult  ScanMailDir(nsIFile *pFolder, nsIMutableArray *pArray, nsIImportService *pImport);</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+  nsresult  IterateMailDir(nsIFile *pFolder, nsIMutableArray *pArray, nsIImportService *pImport);</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+  nsresult  ScanDescmap(nsIFile *pFolder, nsIMutableArray *pArray, nsIImportService *pImport, const char *pData, int32_t len);</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+  nsresult  FoundMailFolder(nsIFile *mailFolder, const char *pName, nsIMutableArray *pArray, nsIImportService *pImport);</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+  nsresult  FoundMailbox(nsIFile *mailFile, const char *pName, nsIMutableArray *pArray, nsIImportService *pImport);</span>
<a href="#l14.65"></a><span id="l14.65">   bool      FindMimeIniFile(nsIFile *pFile);</span>
<a href="#l14.66"></a><span id="l14.66">   void    GetMimeTypeFromExtension(nsCString&amp; ext, nsCString&amp; mimeType);</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineminus">-  nsresult  FoundAddressBook(nsIFile *file, const PRUnichar *pName, nsISupportsArray *pArray, nsIImportService *impSvc);</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineminus">-  nsresult  ScanAddressDir(nsIFile *pDir, nsISupportsArray *pArray, nsIImportService *impSvc);</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+  nsresult  FoundAddressBook(nsIFile *file, const PRUnichar *pName, nsIMutableArray *pArray, nsIImportService *impSvc);</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+  nsresult  ScanAddressDir(nsIFile *pDir, nsIMutableArray *pArray, nsIImportService *impSvc);</span>
<a href="#l14.71"></a><span id="l14.71"> </span>
<a href="#l14.72"></a><span id="l14.72"> </span>
<a href="#l14.73"></a><span id="l14.73">   static bool      FindEudoraLocation(nsIFile **pFolder, bool findIni = false);</span>
<a href="#l14.74"></a><span id="l14.74"> </span>
<a href="#l14.75"></a><span id="l14.75">     // Settings support</span>
<a href="#l14.76"></a><span id="l14.76">   static bool    BuildPOPAccount(nsIMsgAccountManager *accMgr, const char *pSection, const char *pIni, nsIMsgAccount **ppAccount);</span>
<a href="#l14.77"></a><span id="l14.77">   static bool    BuildIMAPAccount(nsIMsgAccountManager *accMgr, const char *pSection, const char *pIni, nsIMsgAccount **ppAccount);</span>
<a href="#l14.78"></a><span id="l14.78">   static void    GetServerAndUserName(const char *pSection, const char *pIni, nsCString&amp; serverName, nsCString&amp; userName, char *pBuff);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -25,16 +25,17 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> #include &quot;nsIImportMail.h&quot;</span>
<a href="#l15.6"></a><span id="l15.6"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l15.8"></a><span id="l15.8"> #include &quot;nsOEMailbox.h&quot;</span>
<a href="#l15.9"></a><span id="l15.9"> #include &quot;nsIImportAddressBooks.h&quot;</span>
<a href="#l15.10"></a><span id="l15.10"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> #include &quot;nsIImportFieldMap.h&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l15.13"></a><span id="l15.13"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l15.14"></a><span id="l15.14"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l15.15"></a><span id="l15.15"> #include &quot;WabObject.h&quot;</span>
<a href="#l15.16"></a><span id="l15.16"> #include &quot;nsOEAddressIterator.h&quot;</span>
<a href="#l15.17"></a><span id="l15.17"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l15.18"></a><span id="l15.18"> #include &quot;nsOE5File.h&quot;</span>
<a href="#l15.19"></a><span id="l15.19"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l15.20"></a><span id="l15.20"> #include &quot;nsOESettings.h&quot;</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineat">@@ -61,18 +62,18 @@ public:</span>
<a href="#l15.22"></a><span id="l15.22">   // nsISupports interface</span>
<a href="#l15.23"></a><span id="l15.23">   NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25">   // nsIImportmail interface</span>
<a href="#l15.26"></a><span id="l15.26"> </span>
<a href="#l15.27"></a><span id="l15.27">   /* void GetDefaultLocation (out nsIFile location, out boolean found, out boolean userVerify); */</span>
<a href="#l15.28"></a><span id="l15.28">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-  /* nsISupportsArray FindMailboxes (in nsIFile location); */</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-  NS_IMETHOD FindMailboxes(nsIFile *location, nsISupportsArray **_retval);</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+  /* nsIArray FindMailboxes (in nsIFile location); */</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+  NS_IMETHOD FindMailboxes(nsIFile *location, nsIArray **_retval);</span>
<a href="#l15.34"></a><span id="l15.34"> </span>
<a href="#l15.35"></a><span id="l15.35">   NS_IMETHOD ImportMailbox(nsIImportMailboxDescriptor *source,</span>
<a href="#l15.36"></a><span id="l15.36">                            nsIMsgFolder *dstFolder,</span>
<a href="#l15.37"></a><span id="l15.37">                            PRUnichar **pErrorLog, PRUnichar **pSuccessLog,</span>
<a href="#l15.38"></a><span id="l15.38">                            bool *fatalError);</span>
<a href="#l15.39"></a><span id="l15.39"> </span>
<a href="#l15.40"></a><span id="l15.40">   /* unsigned long GetImportProgress (); */</span>
<a href="#l15.41"></a><span id="l15.41">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineat">@@ -106,17 +107,17 @@ public:</span>
<a href="#l15.43"></a><span id="l15.43">   NS_IMETHOD GetSupportsMultiple(bool *_retval) { *_retval = false; return NS_OK;}</span>
<a href="#l15.44"></a><span id="l15.44"> </span>
<a href="#l15.45"></a><span id="l15.45">   NS_IMETHOD GetAutoFind(PRUnichar **description, bool *_retval);</span>
<a href="#l15.46"></a><span id="l15.46"> </span>
<a href="#l15.47"></a><span id="l15.47">   NS_IMETHOD GetNeedsFieldMap(nsIFile *pLoc, bool *_retval) { *_retval = false; return NS_OK;}</span>
<a href="#l15.48"></a><span id="l15.48"> </span>
<a href="#l15.49"></a><span id="l15.49">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l15.50"></a><span id="l15.50"> </span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-  NS_IMETHOD FindAddressBooks(nsIFile *location, nsISupportsArray **_retval);</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineplus">+  NS_IMETHOD FindAddressBooks(nsIFile *location, nsIArray **_retval);</span>
<a href="#l15.53"></a><span id="l15.53"> </span>
<a href="#l15.54"></a><span id="l15.54">   NS_IMETHOD InitFieldMap(nsIImportFieldMap *fieldMap)</span>
<a href="#l15.55"></a><span id="l15.55">     { return NS_ERROR_FAILURE; }</span>
<a href="#l15.56"></a><span id="l15.56"> </span>
<a href="#l15.57"></a><span id="l15.57">   NS_IMETHOD ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l15.58"></a><span id="l15.58">                                nsIAddrDatabase *destination,</span>
<a href="#l15.59"></a><span id="l15.59">                                nsIImportFieldMap *fieldMap,</span>
<a href="#l15.60"></a><span id="l15.60">                                nsISupports *aSupportService,</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineat">@@ -322,17 +323,17 @@ NS_IMETHODIMP ImportOEMailImpl::GetDefau</span>
<a href="#l15.62"></a><span id="l15.62">     *found = false;</span>
<a href="#l15.63"></a><span id="l15.63">     *ppLoc = nullptr;</span>
<a href="#l15.64"></a><span id="l15.64">   }</span>
<a href="#l15.65"></a><span id="l15.65">   *userVerify = true;</span>
<a href="#l15.66"></a><span id="l15.66">   return NS_OK;</span>
<a href="#l15.67"></a><span id="l15.67"> }</span>
<a href="#l15.68"></a><span id="l15.68"> </span>
<a href="#l15.69"></a><span id="l15.69"> </span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-NS_IMETHODIMP ImportOEMailImpl::FindMailboxes(nsIFile *pLoc, nsISupportsArray **ppArray)</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineplus">+NS_IMETHODIMP ImportOEMailImpl::FindMailboxes(nsIFile *pLoc, nsIArray **ppArray)</span>
<a href="#l15.72"></a><span id="l15.72"> {</span>
<a href="#l15.73"></a><span id="l15.73">     NS_PRECONDITION(pLoc != nullptr, &quot;null ptr&quot;);</span>
<a href="#l15.74"></a><span id="l15.74">     NS_PRECONDITION(ppArray != nullptr, &quot;null ptr&quot;);</span>
<a href="#l15.75"></a><span id="l15.75">     if (!pLoc || !ppArray)</span>
<a href="#l15.76"></a><span id="l15.76">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l15.77"></a><span id="l15.77"> </span>
<a href="#l15.78"></a><span id="l15.78">   bool exists = false;</span>
<a href="#l15.79"></a><span id="l15.79">   nsresult rv = pLoc-&gt;Exists(&amp;exists);</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineat">@@ -516,23 +517,24 @@ NS_IMETHODIMP ImportOEAddressImpl::GetAu</span>
<a href="#l15.81"></a><span id="l15.81">   nsString str;</span>
<a href="#l15.82"></a><span id="l15.82">   str.Append(nsOEStringBundle::GetStringByID(OEIMPORT_AUTOFIND));</span>
<a href="#l15.83"></a><span id="l15.83">   *description = ToNewUnicode(str);</span>
<a href="#l15.84"></a><span id="l15.84">   return NS_OK;</span>
<a href="#l15.85"></a><span id="l15.85"> }</span>
<a href="#l15.86"></a><span id="l15.86"> </span>
<a href="#l15.87"></a><span id="l15.87"> </span>
<a href="#l15.88"></a><span id="l15.88"> </span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-NS_IMETHODIMP ImportOEAddressImpl::FindAddressBooks(nsIFile *location, nsISupportsArray **_retval)</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+NS_IMETHODIMP ImportOEAddressImpl::FindAddressBooks(nsIFile *location, nsIArray **_retval)</span>
<a href="#l15.91"></a><span id="l15.91"> {</span>
<a href="#l15.92"></a><span id="l15.92">   NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l15.93"></a><span id="l15.93">   if (!_retval)</span>
<a href="#l15.94"></a><span id="l15.94">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l15.95"></a><span id="l15.95"> </span>
<a href="#l15.96"></a><span id="l15.96" class="difflineminus">-  nsresult rv = NS_NewISupportsArray(_retval);</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineplus">+  nsresult rv;</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; array(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l15.99"></a><span id="l15.99">   if (NS_FAILED(rv))</span>
<a href="#l15.100"></a><span id="l15.100">     return rv;</span>
<a href="#l15.101"></a><span id="l15.101"> </span>
<a href="#l15.102"></a><span id="l15.102">   // Make sure we can load up the windows address book...</span>
<a href="#l15.103"></a><span id="l15.103">   rv = NS_ERROR_FAILURE;</span>
<a href="#l15.104"></a><span id="l15.104"> </span>
<a href="#l15.105"></a><span id="l15.105">   if (m_pWab)</span>
<a href="#l15.106"></a><span id="l15.106">     delete m_pWab;</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineat">@@ -562,27 +564,28 @@ NS_IMETHODIMP ImportOEAddressImpl::FindA</span>
<a href="#l15.108"></a><span id="l15.108">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l15.109"></a><span id="l15.109">       rv = impSvc-&gt;CreateNewABDescriptor(&amp;pID);</span>
<a href="#l15.110"></a><span id="l15.110">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l15.111"></a><span id="l15.111">         pID-&gt;SetIdentifier(0x4F453334);</span>
<a href="#l15.112"></a><span id="l15.112">         pID-&gt;SetRef(1);</span>
<a href="#l15.113"></a><span id="l15.113">         pID-&gt;SetSize(100);</span>
<a href="#l15.114"></a><span id="l15.114">         pID-&gt;SetPreferredName(str);</span>
<a href="#l15.115"></a><span id="l15.115">         rv = pID-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineminus">-        (*_retval)-&gt;AppendElement(pInterface);</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineplus">+        array-&gt;AppendElement(pInterface, false);</span>
<a href="#l15.118"></a><span id="l15.118">         pInterface-&gt;Release();</span>
<a href="#l15.119"></a><span id="l15.119">         pID-&gt;Release();</span>
<a href="#l15.120"></a><span id="l15.120">       }</span>
<a href="#l15.121"></a><span id="l15.121">     }</span>
<a href="#l15.122"></a><span id="l15.122">   }</span>
<a href="#l15.123"></a><span id="l15.123"> </span>
<a href="#l15.124"></a><span id="l15.124">   if (NS_FAILED(rv)) {</span>
<a href="#l15.125"></a><span id="l15.125">     delete m_pWab;</span>
<a href="#l15.126"></a><span id="l15.126">     m_pWab = nullptr;</span>
<a href="#l15.127"></a><span id="l15.127">   }</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineplus">+  array.forget(_retval);</span>
<a href="#l15.129"></a><span id="l15.129">   return NS_OK;</span>
<a href="#l15.130"></a><span id="l15.130"> }</span>
<a href="#l15.131"></a><span id="l15.131"> </span>
<a href="#l15.132"></a><span id="l15.132"> </span>
<a href="#l15.133"></a><span id="l15.133"> </span>
<a href="#l15.134"></a><span id="l15.134"> NS_IMETHODIMP ImportOEAddressImpl::ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l15.135"></a><span id="l15.135">                                                      nsIAddrDatabase *destination,</span>
<a href="#l15.136"></a><span id="l15.136">                                                      nsIImportFieldMap *fieldMap,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEScanBoxes.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEScanBoxes.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -128,17 +128,17 @@ bool nsOEScanBoxes::FindMail(nsIFile *pW</span>
<a href="#l16.4"></a><span id="l16.4">   localWhere-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;Mail&quot;));</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6">   bool isDir = false;</span>
<a href="#l16.7"></a><span id="l16.7">   localWhere-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9">   return isDir;</span>
<a href="#l16.10"></a><span id="l16.10"> }</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-bool nsOEScanBoxes::GetMailboxes(nsIFile *pWhere, nsISupportsArray **pArray)</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+bool nsOEScanBoxes::GetMailboxes(nsIFile *pWhere, nsIArray **pArray)</span>
<a href="#l16.14"></a><span id="l16.14"> {</span>
<a href="#l16.15"></a><span id="l16.15">   nsCString path;</span>
<a href="#l16.16"></a><span id="l16.16">   pWhere-&gt;GetNativePath(path);</span>
<a href="#l16.17"></a><span id="l16.17">   if (!path.IsEmpty()) {</span>
<a href="#l16.18"></a><span id="l16.18">     IMPORT_LOG1(&quot;Looking for mail in: %s\n&quot;, path.get());</span>
<a href="#l16.19"></a><span id="l16.19">   }</span>
<a href="#l16.20"></a><span id="l16.20">   else {</span>
<a href="#l16.21"></a><span id="l16.21">     pWhere-&gt;GetNativeLeafName(path);</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -675,30 +675,32 @@ uint32_t nsOEScanBoxes::CountMailboxes(M</span>
<a href="#l16.23"></a><span id="l16.23">     }</span>
<a href="#l16.24"></a><span id="l16.24">     else</span>
<a href="#l16.25"></a><span id="l16.25">       pBox = nullptr;</span>
<a href="#l16.26"></a><span id="l16.26">   }</span>
<a href="#l16.27"></a><span id="l16.27"> </span>
<a href="#l16.28"></a><span id="l16.28">   return count;</span>
<a href="#l16.29"></a><span id="l16.29"> }</span>
<a href="#l16.30"></a><span id="l16.30"> </span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-bool nsOEScanBoxes::GetMailboxList(nsIFile * root, nsISupportsArray **pArray)</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+bool nsOEScanBoxes::GetMailboxList(nsIFile * root, nsIArray **pArray)</span>
<a href="#l16.33"></a><span id="l16.33"> {</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-  nsresult rv = NS_NewISupportsArray(pArray);</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+  nsresult rv;</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; array(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l16.37"></a><span id="l16.37">   if (NS_FAILED(rv)) {</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-    IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray\n&quot;);</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+    IMPORT_LOG0(&quot;FAILED to allocate the nsIArray\n&quot;);</span>
<a href="#l16.40"></a><span id="l16.40">     return false;</span>
<a href="#l16.41"></a><span id="l16.41">   }</span>
<a href="#l16.42"></a><span id="l16.42"> </span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-  BuildMailboxList(nullptr, root, 1, *pArray);</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineplus">+  BuildMailboxList(nullptr, root, 1, array);</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+  array.forget(pArray);</span>
<a href="#l16.46"></a><span id="l16.46"> </span>
<a href="#l16.47"></a><span id="l16.47">   return true;</span>
<a href="#l16.48"></a><span id="l16.48"> }</span>
<a href="#l16.49"></a><span id="l16.49"> </span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-void nsOEScanBoxes::BuildMailboxList(MailboxEntry *pBox, nsIFile * root, int32_t depth, nsISupportsArray *pArray)</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+void nsOEScanBoxes::BuildMailboxList(MailboxEntry *pBox, nsIFile * root, int32_t depth, nsIMutableArray *pArray)</span>
<a href="#l16.52"></a><span id="l16.52"> {</span>
<a href="#l16.53"></a><span id="l16.53">   if (pBox == nullptr) {</span>
<a href="#l16.54"></a><span id="l16.54">     if (m_pFirst != nullptr) {</span>
<a href="#l16.55"></a><span id="l16.55">       pBox = m_pFirst;</span>
<a href="#l16.56"></a><span id="l16.56"> </span>
<a href="#l16.57"></a><span id="l16.57">       IMPORT_LOG0(&quot;Assigning start of mailbox list to m_pFirst\n&quot;);</span>
<a href="#l16.58"></a><span id="l16.58">     }</span>
<a href="#l16.59"></a><span id="l16.59">     else {</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineat">@@ -735,17 +737,17 @@ void nsOEScanBoxes::BuildMailboxList(Mai</span>
<a href="#l16.61"></a><span id="l16.61">         pID-&gt;GetFile(getter_AddRefs(file));</span>
<a href="#l16.62"></a><span id="l16.62">         file-&gt;InitWithFile(root);</span>
<a href="#l16.63"></a><span id="l16.63">         file-&gt;AppendNative(pBox-&gt;fileName);</span>
<a href="#l16.64"></a><span id="l16.64">         size = 0;</span>
<a href="#l16.65"></a><span id="l16.65">         file-&gt;GetFileSize(&amp;size);</span>
<a href="#l16.66"></a><span id="l16.66">         pID-&gt;SetSize(size);</span>
<a href="#l16.67"></a><span id="l16.67">       }</span>
<a href="#l16.68"></a><span id="l16.68">       rv = pID-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineminus">-      pArray-&gt;AppendElement(pInterface);</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineplus">+      pArray-&gt;AppendElement(pInterface, false);</span>
<a href="#l16.71"></a><span id="l16.71">       pInterface-&gt;Release();</span>
<a href="#l16.72"></a><span id="l16.72">       pID-&gt;Release();</span>
<a href="#l16.73"></a><span id="l16.73">     }</span>
<a href="#l16.74"></a><span id="l16.74"> </span>
<a href="#l16.75"></a><span id="l16.75">     if (pBox-&gt;child) {</span>
<a href="#l16.76"></a><span id="l16.76">       pChild = GetIndexEntry(pBox-&gt;child);</span>
<a href="#l16.77"></a><span id="l16.77">       if (pChild != nullptr)</span>
<a href="#l16.78"></a><span id="l16.78">         BuildMailboxList(pChild, root, depth + 1, pArray);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEScanBoxes.h</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEScanBoxes.h</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -4,30 +4,31 @@</span>
<a href="#l17.4"></a><span id="l17.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6"> #ifndef nsOEScanBoxes_h___</span>
<a href="#l17.7"></a><span id="l17.7"> #define nsOEScanBoxes_h___</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l17.10"></a><span id="l17.10"> #include &quot;nsIImportModule.h&quot;</span>
<a href="#l17.11"></a><span id="l17.11"> #include &quot;nsVoidArray.h&quot;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l17.15"></a><span id="l17.15"> #include &quot;nsIFile.h&quot;</span>
<a href="#l17.16"></a><span id="l17.16"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l17.17"></a><span id="l17.17"> </span>
<a href="#l17.18"></a><span id="l17.18"> class nsIInputStream;</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20"> class nsOEScanBoxes {</span>
<a href="#l17.21"></a><span id="l17.21"> public:</span>
<a href="#l17.22"></a><span id="l17.22">   nsOEScanBoxes();</span>
<a href="#l17.23"></a><span id="l17.23">   ~nsOEScanBoxes();</span>
<a href="#l17.24"></a><span id="l17.24"> </span>
<a href="#l17.25"></a><span id="l17.25">   static bool    FindMail(nsIFile *pWhere);</span>
<a href="#l17.26"></a><span id="l17.26"> </span>
<a href="#l17.27"></a><span id="l17.27" class="difflineminus">-  bool    GetMailboxes(nsIFile *pWhere, nsISupportsArray **pArray);</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+  bool    GetMailboxes(nsIFile *pWhere, nsIArray **pArray);</span>
<a href="#l17.29"></a><span id="l17.29"> </span>
<a href="#l17.30"></a><span id="l17.30"> </span>
<a href="#l17.31"></a><span id="l17.31"> private:</span>
<a href="#l17.32"></a><span id="l17.32">   typedef struct {</span>
<a href="#l17.33"></a><span id="l17.33">     uint32_t  index;</span>
<a href="#l17.34"></a><span id="l17.34">     uint32_t  parent;</span>
<a href="#l17.35"></a><span id="l17.35">     int32_t    child;</span>
<a href="#l17.36"></a><span id="l17.36">     int32_t    sibling;</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineat">@@ -55,18 +56,18 @@ private:</span>
<a href="#l17.38"></a><span id="l17.38"> </span>
<a href="#l17.39"></a><span id="l17.39"> </span>
<a href="#l17.40"></a><span id="l17.40">   bool        ReadLong(nsIInputStream * stream, int32_t&amp; val, uint32_t offset);</span>
<a href="#l17.41"></a><span id="l17.41">   bool        ReadLong(nsIInputStream * stream, uint32_t&amp; val, uint32_t offset);</span>
<a href="#l17.42"></a><span id="l17.42">   bool        ReadString(nsIInputStream * stream, nsString&amp; str, uint32_t offset);</span>
<a href="#l17.43"></a><span id="l17.43">   bool        ReadString(nsIInputStream * stream, nsCString&amp; str, uint32_t offset);</span>
<a href="#l17.44"></a><span id="l17.44">   uint32_t     CountMailboxes(MailboxEntry *pBox);</span>
<a href="#l17.45"></a><span id="l17.45"> </span>
<a href="#l17.46"></a><span id="l17.46" class="difflineminus">-  void       BuildMailboxList(MailboxEntry *pBox, nsIFile * root, int32_t depth, nsISupportsArray *pArray);</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineminus">-  bool         GetMailboxList(nsIFile * root, nsISupportsArray **pArray);</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+  void       BuildMailboxList(MailboxEntry *pBox, nsIFile * root, int32_t depth, nsIMutableArray *pArray);</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+  bool         GetMailboxList(nsIFile * root, nsIArray **pArray);</span>
<a href="#l17.50"></a><span id="l17.50"> </span>
<a href="#l17.51"></a><span id="l17.51"> private:</span>
<a href="#l17.52"></a><span id="l17.52">   MailboxEntry *        m_pFirst;</span>
<a href="#l17.53"></a><span id="l17.53">   nsVoidArray          m_entryArray;</span>
<a href="#l17.54"></a><span id="l17.54">   nsVoidArray          m_pendingChildArray; // contains child folders whose parent folders have not showed up.</span>
<a href="#l17.55"></a><span id="l17.55"> </span>
<a href="#l17.56"></a><span id="l17.56">   nsCOMPtr&lt;nsIImportService&gt;  mService;</span>
<a href="#l17.57"></a><span id="l17.57"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookCompose.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookCompose.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -20,16 +20,17 @@</span>
<a href="#l18.4"></a><span id="l18.4"> #include &quot;nsMsgAttachmentData.h&quot;</span>
<a href="#l18.5"></a><span id="l18.5"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l18.6"></a><span id="l18.6"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l18.7"></a><span id="l18.7"> #include &quot;nsIArray.h&quot;</span>
<a href="#l18.8"></a><span id="l18.8"> #include &quot;nsIMsgCompose.h&quot;</span>
<a href="#l18.9"></a><span id="l18.9"> #include &quot;nsIMsgCompFields.h&quot;</span>
<a href="#l18.10"></a><span id="l18.10"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l18.11"></a><span id="l18.11"> #include &quot;nsIMsgSend.h&quot;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l18.13"></a><span id="l18.13"> #include &quot;nsImportEmbeddedImageData.h&quot;</span>
<a href="#l18.14"></a><span id="l18.14"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l18.15"></a><span id="l18.15"> #include &quot;nsCRT.h&quot;</span>
<a href="#l18.16"></a><span id="l18.16"> #include &quot;nsOutlookCompose.h&quot;</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18"> #include &quot;OutlookDebugLog.h&quot;</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20"> #include &quot;nsMimeTypes.h&quot;</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineat">@@ -289,32 +290,32 @@ nsresult nsOutlookCompose::ComposeTheMes</span>
<a href="#l18.22"></a><span id="l18.22">   nsString bodyW;</span>
<a href="#l18.23"></a><span id="l18.23">   // Bug 593907</span>
<a href="#l18.24"></a><span id="l18.24">   if (GenerateHackSequence(msg.GetBody(), msg.GetBodyLen()))</span>
<a href="#l18.25"></a><span id="l18.25">     HackBody(msg.GetBody(), msg.GetBodyLen(), bodyW);</span>
<a href="#l18.26"></a><span id="l18.26">   else</span>
<a href="#l18.27"></a><span id="l18.27">     bodyW = msg.GetBody();</span>
<a href="#l18.28"></a><span id="l18.28">   // End Bug 593907</span>
<a href="#l18.29"></a><span id="l18.29"> </span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; embeddedObjects;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; embeddedObjects;</span>
<a href="#l18.32"></a><span id="l18.32"> </span>
<a href="#l18.33"></a><span id="l18.33">   if (msg.BodyIsHtml()) {</span>
<a href="#l18.34"></a><span id="l18.34">     for (unsigned int i = 0; i &lt;msg.EmbeddedAttachmentsCount(); i++) {</span>
<a href="#l18.35"></a><span id="l18.35">       nsIURI *uri;</span>
<a href="#l18.36"></a><span id="l18.36">       const char* cid;</span>
<a href="#l18.37"></a><span id="l18.37">       const char* name;</span>
<a href="#l18.38"></a><span id="l18.38">       if (msg.GetEmbeddedAttachmentInfo(i, &amp;uri, &amp;cid, &amp;name)) {</span>
<a href="#l18.39"></a><span id="l18.39">         if (!embeddedObjects) {</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-          embeddedObjects = do_CreateInstance(NS_SUPPORTSARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+          embeddedObjects = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l18.42"></a><span id="l18.42">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.43"></a><span id="l18.43">         }</span>
<a href="#l18.44"></a><span id="l18.44">         nsCOMPtr&lt;nsIMsgEmbeddedImageData&gt; imageData =</span>
<a href="#l18.45"></a><span id="l18.45">           new nsImportEmbeddedImageData(uri, nsDependentCString(cid),</span>
<a href="#l18.46"></a><span id="l18.46">                                      nsDependentCString(name));</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineminus">-        embeddedObjects-&gt;AppendElement(imageData);</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineplus">+        embeddedObjects-&gt;AppendElement(imageData, false);</span>
<a href="#l18.49"></a><span id="l18.49">       }</span>
<a href="#l18.50"></a><span id="l18.50">     }</span>
<a href="#l18.51"></a><span id="l18.51">   }</span>
<a href="#l18.52"></a><span id="l18.52"> </span>
<a href="#l18.53"></a><span id="l18.53">   nsCString bodyA;</span>
<a href="#l18.54"></a><span id="l18.54">   nsMsgI18NConvertFromUnicode(msg.GetBodyCharset(), bodyW, bodyA);</span>
<a href="#l18.55"></a><span id="l18.55"> </span>
<a href="#l18.56"></a><span id="l18.56">   nsCOMPtr&lt;nsIImportService&gt; impService(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookImport.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookImport.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -55,18 +55,18 @@ public:</span>
<a href="#l19.4"></a><span id="l19.4">   // nsISupports interface</span>
<a href="#l19.5"></a><span id="l19.5">   NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7">   // nsIImportmail interface</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">   /* void GetDefaultLocation (out nsIFile location, out boolean found, out boolean userVerify); */</span>
<a href="#l19.10"></a><span id="l19.10">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  /* nsISupportsArray FindMailboxes (in nsIFile location); */</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-  NS_IMETHOD FindMailboxes(nsIFile *location, nsISupportsArray **_retval);</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+  /* nsIArray FindMailboxes (in nsIFile location); */</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+  NS_IMETHOD FindMailboxes(nsIFile *location, nsIArray **_retval);</span>
<a href="#l19.16"></a><span id="l19.16"> </span>
<a href="#l19.17"></a><span id="l19.17">   NS_IMETHOD ImportMailbox(nsIImportMailboxDescriptor *source,</span>
<a href="#l19.18"></a><span id="l19.18">                            nsIMsgFolder *dstFolder,</span>
<a href="#l19.19"></a><span id="l19.19">                            PRUnichar **pErrorLog, PRUnichar **pSuccessLog,</span>
<a href="#l19.20"></a><span id="l19.20">                            bool *fatalError);</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22">   /* unsigned long GetImportProgress (); */</span>
<a href="#l19.23"></a><span id="l19.23">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineat">@@ -102,17 +102,17 @@ public:</span>
<a href="#l19.25"></a><span id="l19.25"> </span>
<a href="#l19.26"></a><span id="l19.26">   NS_IMETHOD GetAutoFind(PRUnichar **description, bool *_retval);</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">   NS_IMETHOD GetNeedsFieldMap(nsIFile *location, bool *_retval) { *_retval = false; return NS_OK;}</span>
<a href="#l19.29"></a><span id="l19.29"> </span>
<a href="#l19.30"></a><span id="l19.30">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify)</span>
<a href="#l19.31"></a><span id="l19.31">     { return NS_ERROR_FAILURE;}</span>
<a href="#l19.32"></a><span id="l19.32"> </span>
<a href="#l19.33"></a><span id="l19.33" class="difflineminus">-  NS_IMETHOD FindAddressBooks(nsIFile *location, nsISupportsArray **_retval);</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineplus">+  NS_IMETHOD FindAddressBooks(nsIFile *location, nsIArray **_retval);</span>
<a href="#l19.35"></a><span id="l19.35"> </span>
<a href="#l19.36"></a><span id="l19.36">   NS_IMETHOD InitFieldMap(nsIImportFieldMap *fieldMap)</span>
<a href="#l19.37"></a><span id="l19.37">     { return NS_ERROR_FAILURE; }</span>
<a href="#l19.38"></a><span id="l19.38"> </span>
<a href="#l19.39"></a><span id="l19.39">   NS_IMETHOD ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l19.40"></a><span id="l19.40">                                nsIAddrDatabase *destination,</span>
<a href="#l19.41"></a><span id="l19.41">                                nsIImportFieldMap *fieldMap,</span>
<a href="#l19.42"></a><span id="l19.42">                                nsISupports *aSupportService,</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineat">@@ -333,17 +333,17 @@ NS_IMETHODIMP ImportOutlookMailImpl::Get</span>
<a href="#l19.44"></a><span id="l19.44">   *found = true;</span>
<a href="#l19.45"></a><span id="l19.45">   NS_IF_ADDREF(*ppLoc = resultFile);</span>
<a href="#l19.46"></a><span id="l19.46">   *userVerify = false;</span>
<a href="#l19.47"></a><span id="l19.47"> </span>
<a href="#l19.48"></a><span id="l19.48">   return NS_OK;</span>
<a href="#l19.49"></a><span id="l19.49"> }</span>
<a href="#l19.50"></a><span id="l19.50"> </span>
<a href="#l19.51"></a><span id="l19.51"> </span>
<a href="#l19.52"></a><span id="l19.52" class="difflineminus">-NS_IMETHODIMP ImportOutlookMailImpl::FindMailboxes(nsIFile *pLoc, nsISupportsArray **ppArray)</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineplus">+NS_IMETHODIMP ImportOutlookMailImpl::FindMailboxes(nsIFile *pLoc, nsIArray **ppArray)</span>
<a href="#l19.54"></a><span id="l19.54"> {</span>
<a href="#l19.55"></a><span id="l19.55">   NS_PRECONDITION(pLoc != nullptr, &quot;null ptr&quot;);</span>
<a href="#l19.56"></a><span id="l19.56">   NS_PRECONDITION(ppArray != nullptr, &quot;null ptr&quot;);</span>
<a href="#l19.57"></a><span id="l19.57">   if (!pLoc || !ppArray)</span>
<a href="#l19.58"></a><span id="l19.58">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l19.59"></a><span id="l19.59">   return m_mail.GetMailFolders(ppArray);</span>
<a href="#l19.60"></a><span id="l19.60"> }</span>
<a href="#l19.61"></a><span id="l19.61"> </span>
<a href="#l19.62"></a><span id="l19.62" class="difflineat">@@ -496,17 +496,17 @@ NS_IMETHODIMP ImportOutlookAddressImpl::</span>
<a href="#l19.63"></a><span id="l19.63"> </span>
<a href="#l19.64"></a><span id="l19.64">   *_retval = true;</span>
<a href="#l19.65"></a><span id="l19.65">   nsString str;</span>
<a href="#l19.66"></a><span id="l19.66">   nsOutlookStringBundle::GetStringByID(OUTLOOKIMPORT_ADDRNAME, str);</span>
<a href="#l19.67"></a><span id="l19.67">   *description = ToNewUnicode(str);</span>
<a href="#l19.68"></a><span id="l19.68">   return NS_OK;</span>
<a href="#l19.69"></a><span id="l19.69"> }</span>
<a href="#l19.70"></a><span id="l19.70"> </span>
<a href="#l19.71"></a><span id="l19.71" class="difflineminus">-NS_IMETHODIMP ImportOutlookAddressImpl::FindAddressBooks(nsIFile *location, nsISupportsArray **_retval)</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineplus">+NS_IMETHODIMP ImportOutlookAddressImpl::FindAddressBooks(nsIFile *location, nsIArray **_retval)</span>
<a href="#l19.73"></a><span id="l19.73"> {</span>
<a href="#l19.74"></a><span id="l19.74">   NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l19.75"></a><span id="l19.75">   if (!_retval)</span>
<a href="#l19.76"></a><span id="l19.76">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l19.77"></a><span id="l19.77"> </span>
<a href="#l19.78"></a><span id="l19.78">   return m_address.GetAddressBooks(_retval);</span>
<a href="#l19.79"></a><span id="l19.79"> }</span>
<a href="#l19.80"></a><span id="l19.80"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookMail.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookMail.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -10,16 +10,17 @@</span>
<a href="#l20.4"></a><span id="l20.4"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l20.5"></a><span id="l20.5"> #include &quot;nscore.h&quot;</span>
<a href="#l20.6"></a><span id="l20.6"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l20.7"></a><span id="l20.7"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l20.8"></a><span id="l20.8"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l20.9"></a><span id="l20.9"> #include &quot;nsIImportFieldMap.h&quot;</span>
<a href="#l20.10"></a><span id="l20.10"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l20.11"></a><span id="l20.11"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l20.13"></a><span id="l20.13"> #include &quot;nsOutlookStringBundle.h&quot;</span>
<a href="#l20.14"></a><span id="l20.14"> #include &quot;nsABBaseCID.h&quot;</span>
<a href="#l20.15"></a><span id="l20.15"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l20.16"></a><span id="l20.16"> #include &quot;mdb.h&quot;</span>
<a href="#l20.17"></a><span id="l20.17"> #include &quot;OutlookDebugLog.h&quot;</span>
<a href="#l20.18"></a><span id="l20.18"> #include &quot;nsOutlookMail.h&quot;</span>
<a href="#l20.19"></a><span id="l20.19"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l20.20"></a><span id="l20.20"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineat">@@ -103,26 +104,27 @@ nsOutlookMail::nsOutlookMail()</span>
<a href="#l20.22"></a><span id="l20.22">   m_lpMdb = NULL;</span>
<a href="#l20.23"></a><span id="l20.23"> }</span>
<a href="#l20.24"></a><span id="l20.24"> </span>
<a href="#l20.25"></a><span id="l20.25"> nsOutlookMail::~nsOutlookMail()</span>
<a href="#l20.26"></a><span id="l20.26"> {</span>
<a href="#l20.27"></a><span id="l20.27"> //  EmptyAttachments();</span>
<a href="#l20.28"></a><span id="l20.28"> }</span>
<a href="#l20.29"></a><span id="l20.29"> </span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-nsresult nsOutlookMail::GetMailFolders(nsISupportsArray **pArray)</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+nsresult nsOutlookMail::GetMailFolders(nsIArray **pArray)</span>
<a href="#l20.32"></a><span id="l20.32"> {</span>
<a href="#l20.33"></a><span id="l20.33">   if (!m_haveMapi) {</span>
<a href="#l20.34"></a><span id="l20.34">     IMPORT_LOG0(&quot;GetMailFolders called before Mapi is initialized\n&quot;);</span>
<a href="#l20.35"></a><span id="l20.35">     return NS_ERROR_FAILURE;</span>
<a href="#l20.36"></a><span id="l20.36">   }</span>
<a href="#l20.37"></a><span id="l20.37"> </span>
<a href="#l20.38"></a><span id="l20.38" class="difflineminus">-  nsresult rv = NS_NewISupportsArray(pArray);</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineplus">+  nsresult rv;</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; array(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l20.41"></a><span id="l20.41">   if (NS_FAILED(rv)) {</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineminus">-    IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray for the mail folder list\n&quot;);</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineplus">+    IMPORT_LOG0(&quot;FAILED to allocate the nsIMutableArray for the mail folder list\n&quot;);</span>
<a href="#l20.44"></a><span id="l20.44">     return rv;</span>
<a href="#l20.45"></a><span id="l20.45">   }</span>
<a href="#l20.46"></a><span id="l20.46"> </span>
<a href="#l20.47"></a><span id="l20.47">   nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l20.48"></a><span id="l20.48">   if (NS_FAILED(rv))</span>
<a href="#l20.49"></a><span id="l20.49">     return rv;</span>
<a href="#l20.50"></a><span id="l20.50"> </span>
<a href="#l20.51"></a><span id="l20.51">   m_gotFolders = true;</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineat">@@ -169,22 +171,22 @@ nsresult nsOutlookMail::GetMailFolders(n</span>
<a href="#l20.53"></a><span id="l20.53">       pID-&gt;SetDepth(pFolder-&gt;GetDepth());</span>
<a href="#l20.54"></a><span id="l20.54">       pID-&gt;SetIdentifier(i);</span>
<a href="#l20.55"></a><span id="l20.55"> </span>
<a href="#l20.56"></a><span id="l20.56">       pFolder-&gt;GetDisplayName(name);</span>
<a href="#l20.57"></a><span id="l20.57">       pID-&gt;SetDisplayName(name.get());</span>
<a href="#l20.58"></a><span id="l20.58"> </span>
<a href="#l20.59"></a><span id="l20.59">       pID-&gt;SetSize(1000);</span>
<a href="#l20.60"></a><span id="l20.60">       rv = pID-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineminus">-      (*pArray)-&gt;AppendElement(pInterface);</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineplus">+      array-&gt;AppendElement(pInterface, false);</span>
<a href="#l20.63"></a><span id="l20.63">       pInterface-&gt;Release();</span>
<a href="#l20.64"></a><span id="l20.64">       pID-&gt;Release();</span>
<a href="#l20.65"></a><span id="l20.65">     }</span>
<a href="#l20.66"></a><span id="l20.66">   }</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineminus">-</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineplus">+  array.forget(pArray);</span>
<a href="#l20.69"></a><span id="l20.69">   return NS_OK;</span>
<a href="#l20.70"></a><span id="l20.70"> }</span>
<a href="#l20.71"></a><span id="l20.71"> </span>
<a href="#l20.72"></a><span id="l20.72"> bool nsOutlookMail::IsAddressBookNameUnique(nsString&amp; name, nsString&amp; list)</span>
<a href="#l20.73"></a><span id="l20.73"> {</span>
<a href="#l20.74"></a><span id="l20.74">   nsString    usedName;</span>
<a href="#l20.75"></a><span id="l20.75">   usedName.AppendLiteral(&quot;[&quot;);</span>
<a href="#l20.76"></a><span id="l20.76">   usedName.Append(name);</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineat">@@ -207,26 +209,27 @@ void nsOutlookMail::MakeAddressBookNameU</span>
<a href="#l20.78"></a><span id="l20.78">   }</span>
<a href="#l20.79"></a><span id="l20.79"> </span>
<a href="#l20.80"></a><span id="l20.80">   name = newName;</span>
<a href="#l20.81"></a><span id="l20.81">   list.AppendLiteral(&quot;[&quot;);</span>
<a href="#l20.82"></a><span id="l20.82">   list.Append(name);</span>
<a href="#l20.83"></a><span id="l20.83">   list.AppendLiteral(&quot;],&quot;);</span>
<a href="#l20.84"></a><span id="l20.84"> }</span>
<a href="#l20.85"></a><span id="l20.85"> </span>
<a href="#l20.86"></a><span id="l20.86" class="difflineminus">-nsresult nsOutlookMail::GetAddressBooks(nsISupportsArray **pArray)</span>
<a href="#l20.87"></a><span id="l20.87" class="difflineplus">+nsresult nsOutlookMail::GetAddressBooks(nsIArray **pArray)</span>
<a href="#l20.88"></a><span id="l20.88"> {</span>
<a href="#l20.89"></a><span id="l20.89">   if (!m_haveMapi) {</span>
<a href="#l20.90"></a><span id="l20.90">     IMPORT_LOG0(&quot;GetAddressBooks called before Mapi is initialized\n&quot;);</span>
<a href="#l20.91"></a><span id="l20.91">     return NS_ERROR_FAILURE;</span>
<a href="#l20.92"></a><span id="l20.92">   }</span>
<a href="#l20.93"></a><span id="l20.93"> </span>
<a href="#l20.94"></a><span id="l20.94" class="difflineminus">-  nsresult rv = NS_NewISupportsArray(pArray);</span>
<a href="#l20.95"></a><span id="l20.95" class="difflineplus">+  nsresult rv;</span>
<a href="#l20.96"></a><span id="l20.96" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; array(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l20.97"></a><span id="l20.97">   if (NS_FAILED(rv)) {</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineminus">-    IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray for the address book list\n&quot;);</span>
<a href="#l20.99"></a><span id="l20.99" class="difflineplus">+    IMPORT_LOG0(&quot;FAILED to allocate the nsIMutableArray for the address book list\n&quot;);</span>
<a href="#l20.100"></a><span id="l20.100">     return rv;</span>
<a href="#l20.101"></a><span id="l20.101">   }</span>
<a href="#l20.102"></a><span id="l20.102"> </span>
<a href="#l20.103"></a><span id="l20.103">   nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l20.104"></a><span id="l20.104">   if (NS_FAILED(rv))</span>
<a href="#l20.105"></a><span id="l20.105">     return rv;</span>
<a href="#l20.106"></a><span id="l20.106"> </span>
<a href="#l20.107"></a><span id="l20.107">   m_gotAddresses = true;</span>
<a href="#l20.108"></a><span id="l20.108" class="difflineat">@@ -270,23 +273,23 @@ nsresult nsOutlookMail::GetAddressBooks(</span>
<a href="#l20.109"></a><span id="l20.109">       rv = impSvc-&gt;CreateNewABDescriptor(&amp;pID);</span>
<a href="#l20.110"></a><span id="l20.110">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l20.111"></a><span id="l20.111">         pID-&gt;SetIdentifier(i);</span>
<a href="#l20.112"></a><span id="l20.112">         pFolder-&gt;GetDisplayName(name);</span>
<a href="#l20.113"></a><span id="l20.113">         MakeAddressBookNameUnique(name, list);</span>
<a href="#l20.114"></a><span id="l20.114">         pID-&gt;SetPreferredName(name);</span>
<a href="#l20.115"></a><span id="l20.115">         pID-&gt;SetSize(100);</span>
<a href="#l20.116"></a><span id="l20.116">         rv = pID-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l20.117"></a><span id="l20.117" class="difflineminus">-        (*pArray)-&gt;AppendElement(pInterface);</span>
<a href="#l20.118"></a><span id="l20.118" class="difflineplus">+        array-&gt;AppendElement(pInterface, false);</span>
<a href="#l20.119"></a><span id="l20.119">         pInterface-&gt;Release();</span>
<a href="#l20.120"></a><span id="l20.120">         pID-&gt;Release();</span>
<a href="#l20.121"></a><span id="l20.121">       }</span>
<a href="#l20.122"></a><span id="l20.122">     }</span>
<a href="#l20.123"></a><span id="l20.123">   }</span>
<a href="#l20.124"></a><span id="l20.124" class="difflineminus">-</span>
<a href="#l20.125"></a><span id="l20.125" class="difflineplus">+  array.forget(pArray);</span>
<a href="#l20.126"></a><span id="l20.126">   return NS_OK;</span>
<a href="#l20.127"></a><span id="l20.127"> }</span>
<a href="#l20.128"></a><span id="l20.128"> </span>
<a href="#l20.129"></a><span id="l20.129"> void nsOutlookMail::OpenMessageStore(CMapiFolder *pNextFolder)</span>
<a href="#l20.130"></a><span id="l20.130"> {</span>
<a href="#l20.131"></a><span id="l20.131">   // Open the store specified</span>
<a href="#l20.132"></a><span id="l20.132">   if (pNextFolder-&gt;IsStore()) {</span>
<a href="#l20.133"></a><span id="l20.133">     if (!m_mapi.OpenStore(pNextFolder-&gt;GetCBEntryID(), pNextFolder-&gt;GetEntryID(), &amp;m_lpMdb)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookMail.h</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookMail.h</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,34 +1,34 @@</span>
<a href="#l21.4"></a><span id="l21.4"> /* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l21.5"></a><span id="l21.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.6"></a><span id="l21.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.7"></a><span id="l21.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9"> #ifndef nsOutlookMail_h___</span>
<a href="#l21.10"></a><span id="l21.10"> #define nsOutlookMail_h___</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l21.14"></a><span id="l21.14"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l21.15"></a><span id="l21.15"> #include &quot;nsOutlookCompose.h&quot;</span>
<a href="#l21.16"></a><span id="l21.16"> #include &quot;nsIFile.h&quot;</span>
<a href="#l21.17"></a><span id="l21.17"> #include &quot;MapiApi.h&quot;</span>
<a href="#l21.18"></a><span id="l21.18"> #include &quot;MapiMessage.h&quot;</span>
<a href="#l21.19"></a><span id="l21.19"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l21.20"></a><span id="l21.20"> </span>
<a href="#l21.21"></a><span id="l21.21"> class nsIAddrDatabase;</span>
<a href="#l21.22"></a><span id="l21.22"> class nsIImportFieldMap;</span>
<a href="#l21.23"></a><span id="l21.23"> </span>
<a href="#l21.24"></a><span id="l21.24"> class nsOutlookMail {</span>
<a href="#l21.25"></a><span id="l21.25"> public:</span>
<a href="#l21.26"></a><span id="l21.26">   nsOutlookMail();</span>
<a href="#l21.27"></a><span id="l21.27">   ~nsOutlookMail();</span>
<a href="#l21.28"></a><span id="l21.28">   </span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-  nsresult GetMailFolders(nsISupportsArray **pArray);</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-  nsresult GetAddressBooks(nsISupportsArray **pArray);</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+  nsresult GetMailFolders(nsIArray **pArray);</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+  nsresult GetAddressBooks(nsIArray **pArray);</span>
<a href="#l21.33"></a><span id="l21.33">   nsresult ImportMailbox(uint32_t *pDoneSoFar, bool *pAbort, int32_t index,</span>
<a href="#l21.34"></a><span id="l21.34">                          const PRUnichar *pName, nsIMsgFolder *pDest,</span>
<a href="#l21.35"></a><span id="l21.35">                          int32_t *pMsgCount);</span>
<a href="#l21.36"></a><span id="l21.36">   static nsresult ImportMessage(LPMESSAGE lpMsg, nsIOutputStream *destOutputStream, nsMsgDeliverMode mode);</span>
<a href="#l21.37"></a><span id="l21.37">   nsresult ImportAddresses(uint32_t *pCount, uint32_t *pTotal, const PRUnichar *pName, uint32_t id, nsIAddrDatabase *pDb, nsString&amp; errors);</span>
<a href="#l21.38"></a><span id="l21.38"> private:</span>
<a href="#l21.39"></a><span id="l21.39">   void  OpenMessageStore(CMapiFolder *pNextFolder);</span>
<a href="#l21.40"></a><span id="l21.40">   static BOOL  WriteData(nsIOutputStream *pDest, const char *pData, int32_t len);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/import/public/nsIImportAddressBooks.idl</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/import/public/nsIImportAddressBooks.idl</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -30,23 +30,23 @@</span>
<a href="#l22.4"></a><span id="l22.4">   3) Show the progress dialog for the import - this could be per address book if</span>
<a href="#l22.5"></a><span id="l22.5">   mapping is required? what to do, what to doooooo.....</span>
<a href="#l22.6"></a><span id="l22.6">   4) All done, maybe a what was done panel??</span>
<a href="#l22.7"></a><span id="l22.7"> */</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l22.10"></a><span id="l22.10"> </span>
<a href="#l22.11"></a><span id="l22.11"> interface   nsIFile;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-interface   nsISupportsArray;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+interface   nsIArray;</span>
<a href="#l22.14"></a><span id="l22.14"> interface  nsIImportABDescriptor;</span>
<a href="#l22.15"></a><span id="l22.15"> interface  nsIOutputStream;</span>
<a href="#l22.16"></a><span id="l22.16"> interface  nsIAddrDatabase;</span>
<a href="#l22.17"></a><span id="l22.17"> interface  nsIImportFieldMap;</span>
<a href="#l22.18"></a><span id="l22.18"> </span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-[scriptable, uuid(d64a87ba-f87b-6378-5ed1-4025a7474334)]</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+[scriptable, uuid(6bba48be-331c-41e3-bc9f-c2ea3754d977)]</span>
<a href="#l22.21"></a><span id="l22.21"> interface nsIImportAddressBooks : nsISupports</span>
<a href="#l22.22"></a><span id="l22.22"> {</span>
<a href="#l22.23"></a><span id="l22.23"> </span>
<a href="#l22.24"></a><span id="l22.24">   /*</span>
<a href="#l22.25"></a><span id="l22.25">     Does this interface supports 1 or 1..n address books.  You only</span>
<a href="#l22.26"></a><span id="l22.26">     get to choose 1 location so for formats where 1..n address books</span>
<a href="#l22.27"></a><span id="l22.27">     are imported from a directory, then return true.  For a 1 to 1 relationship</span>
<a href="#l22.28"></a><span id="l22.28">     between location and address books return false.</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineat">@@ -75,21 +75,21 @@ interface nsIImportAddressBooks : nsISup</span>
<a href="#l22.30"></a><span id="l22.30">     means an error - address book cannot be found on this machine.</span>
<a href="#l22.31"></a><span id="l22.31">     If userVerify is true, the user will have an opportunity to specify</span>
<a href="#l22.32"></a><span id="l22.32">     a different location to import address book from.</span>
<a href="#l22.33"></a><span id="l22.33">   */</span>
<a href="#l22.34"></a><span id="l22.34">   void   GetDefaultLocation( out nsIFile location,</span>
<a href="#l22.35"></a><span id="l22.35">                 out boolean  found,</span>
<a href="#l22.36"></a><span id="l22.36">                 out boolean  userVerify);</span>
<a href="#l22.37"></a><span id="l22.37">   /*</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineminus">-    Returns an nsISupportsArray which contains an nsIImportABDescriptor for each</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+    Returns an nsIArray which contains an nsIImportABDescriptor for each</span>
<a href="#l22.40"></a><span id="l22.40">     address book.  The array is not sorted before display to the user.</span>
<a href="#l22.41"></a><span id="l22.41">     location is null if GetAutoFind returned true.</span>
<a href="#l22.42"></a><span id="l22.42">   */</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineminus">-  nsISupportsArray FindAddressBooks( in nsIFile location);</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineplus">+  nsIArray FindAddressBooks(in nsIFile location);</span>
<a href="#l22.45"></a><span id="l22.45"> </span>
<a href="#l22.46"></a><span id="l22.46">   /*</span>
<a href="#l22.47"></a><span id="l22.47">     Fill in defaults (if any) for a field map for importing address</span>
<a href="#l22.48"></a><span id="l22.48">     books from this location.</span>
<a href="#l22.49"></a><span id="l22.49">   */</span>
<a href="#l22.50"></a><span id="l22.50">   void InitFieldMap(in nsIImportFieldMap fieldMap);</span>
<a href="#l22.51"></a><span id="l22.51"> </span>
<a href="#l22.52"></a><span id="l22.52">   /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/import/public/nsIImportGeneric.idl</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/import/public/nsIImportGeneric.idl</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -8,27 +8,27 @@</span>
<a href="#l23.4"></a><span id="l23.4">     up UI and doing all of the work to make it happen.</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6"> */</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l23.9"></a><span id="l23.9"> </span>
<a href="#l23.10"></a><span id="l23.10"> interface nsISupportsString;</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-[scriptable, uuid(d64a87b8-aeb4-da40-fe28-57df1e50c64f)]</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+[scriptable, uuid(469d7d5f-144c-4f07-9661-e49e40156348)]</span>
<a href="#l23.14"></a><span id="l23.14"> interface nsIImportGeneric : nsISupports</span>
<a href="#l23.15"></a><span id="l23.15"> {</span>
<a href="#l23.16"></a><span id="l23.16">   /* Use these to prepare for the import */</span>
<a href="#l23.17"></a><span id="l23.17">     /*</span>
<a href="#l23.18"></a><span id="l23.18">       &quot;mailInterface&quot; - nsIImportMail interface</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineminus">-      &quot;mailBoxes&quot; - nsISupportsArray of nsIImportMailboxDescriptors</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineplus">+      &quot;mailBoxes&quot; - nsIArray of nsIImportMailboxDescriptors</span>
<a href="#l23.21"></a><span id="l23.21">       &quot;mailLocation&quot; - nsIFile, source location for mail</span>
<a href="#l23.22"></a><span id="l23.22"> </span>
<a href="#l23.23"></a><span id="l23.23">       &quot;addressInterface&quot; - nsIImportAddressBooks interface</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">-      &quot;addressBooks&quot; - nsISupportsArray of nsIImportABDescriptors</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineplus">+      &quot;addressBooks&quot; - nsIArray of nsIImportABDescriptors</span>
<a href="#l23.26"></a><span id="l23.26">       &quot;addressLocation&quot; - src location of address books (if needed!)</span>
<a href="#l23.27"></a><span id="l23.27">       &quot;addressDestination&quot; - uri of destination address book or null if</span>
<a href="#l23.28"></a><span id="l23.28">                 new address books will be created.</span>
<a href="#l23.29"></a><span id="l23.29">     */</span>
<a href="#l23.30"></a><span id="l23.30">   nsISupports  GetData( in string dataId);</span>
<a href="#l23.31"></a><span id="l23.31"> </span>
<a href="#l23.32"></a><span id="l23.32">   void    SetData( in string dataId, in nsISupports pData);</span>
<a href="#l23.33"></a><span id="l23.33"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/import/public/nsIImportMail.idl</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/import/public/nsIImportMail.idl</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -31,39 +31,39 @@</span>
<a href="#l24.4"></a><span id="l24.4">   is used for progress bar updating and MAY BE CALLED FROM ANOTHER</span>
<a href="#l24.5"></a><span id="l24.5">   THREAD!</span>
<a href="#l24.6"></a><span id="l24.6"> </span>
<a href="#l24.7"></a><span id="l24.7"> */</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11"> interface nsIFile;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-interface nsISupportsArray;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+interface nsIArray;</span>
<a href="#l24.14"></a><span id="l24.14"> interface nsIImportMailboxDescriptor;</span>
<a href="#l24.15"></a><span id="l24.15"> interface nsIOutputStream;</span>
<a href="#l24.16"></a><span id="l24.16"> interface nsIMsgFolder;</span>
<a href="#l24.17"></a><span id="l24.17"> </span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-[scriptable, uuid(306561d3-ed2f-425d-87ee-eb129a84a6af)]</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+[scriptable, uuid(a14a3308-0849-420b-86d3-13a2948b5504)]</span>
<a href="#l24.20"></a><span id="l24.20"> interface nsIImportMail : nsISupports</span>
<a href="#l24.21"></a><span id="l24.21"> {</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23">   /*</span>
<a href="#l24.24"></a><span id="l24.24">     If found and userVerify BOTH return false, then it is assumed that this</span>
<a href="#l24.25"></a><span id="l24.25">     means an error - mail cannot be found on this machine.</span>
<a href="#l24.26"></a><span id="l24.26">     If userVerify is true, the user will have an opportunity to specify</span>
<a href="#l24.27"></a><span id="l24.27">     a different location to import mail from.</span>
<a href="#l24.28"></a><span id="l24.28">   */</span>
<a href="#l24.29"></a><span id="l24.29">   void   GetDefaultLocation( out nsIFile location,</span>
<a href="#l24.30"></a><span id="l24.30">                 out boolean  found,</span>
<a href="#l24.31"></a><span id="l24.31">                 out boolean  userVerify);</span>
<a href="#l24.32"></a><span id="l24.32">   /*</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-    Returns an nsISupportsArray which contains an nsIImportMailboxID for each</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+    Returns an nsIArray which contains an nsIImportMailboxID for each</span>
<a href="#l24.35"></a><span id="l24.35">     mailbox.  The array is not sorted before display to the user.</span>
<a href="#l24.36"></a><span id="l24.36">   */</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-  nsISupportsArray FindMailboxes( in nsIFile location);</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+  nsIArray FindMailboxes(in nsIFile location);</span>
<a href="#l24.39"></a><span id="l24.39"> </span>
<a href="#l24.40"></a><span id="l24.40">   /*</span>
<a href="#l24.41"></a><span id="l24.41">     Import a specific mailbox into the destination folder supplied.  If an error</span>
<a href="#l24.42"></a><span id="l24.42">     occurs that is non-fatal, the destination will be deleted and other mailboxes</span>
<a href="#l24.43"></a><span id="l24.43">     will be imported.  If a fatal error occurs, the destination will be deleted</span>
<a href="#l24.44"></a><span id="l24.44">     and the import operation will abort.</span>
<a href="#l24.45"></a><span id="l24.45">   */</span>
<a href="#l24.46"></a><span id="l24.46">   void   ImportMailbox(in nsIImportMailboxDescriptor source,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/import/public/nsIImportService.idl</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/import/public/nsIImportService.idl</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -17,19 +17,19 @@ interface nsIImportABDescriptor;</span>
<a href="#l25.4"></a><span id="l25.4"> interface nsIImportGeneric;</span>
<a href="#l25.5"></a><span id="l25.5"> interface nsIImportFieldMap;</span>
<a href="#l25.6"></a><span id="l25.6"> interface nsIMsgSendListener;</span>
<a href="#l25.7"></a><span id="l25.7"> interface nsIMsgCompFields;</span>
<a href="#l25.8"></a><span id="l25.8"> interface nsIMsgSendListener;</span>
<a href="#l25.9"></a><span id="l25.9"> interface nsIArray;</span>
<a href="#l25.10"></a><span id="l25.10"> interface nsIMsgIdentity;</span>
<a href="#l25.11"></a><span id="l25.11"> interface nsIMsgCompFields;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-interface nsISupportsArray;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+interface nsIArray;</span>
<a href="#l25.14"></a><span id="l25.14"> </span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-[scriptable, uuid(16359964-66e3-4412-84f8-2a8d58be8be0)]</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+[scriptable, uuid(d0ed4c50-5997-49c9-8a6a-045f0680ed29)]</span>
<a href="#l25.17"></a><span id="l25.17"> interface nsIImportService : nsISupports</span>
<a href="#l25.18"></a><span id="l25.18"> {</span>
<a href="#l25.19"></a><span id="l25.19">     void DiscoverModules();</span>
<a href="#l25.20"></a><span id="l25.20"> </span>
<a href="#l25.21"></a><span id="l25.21">   long GetModuleCount( in string filter);</span>
<a href="#l25.22"></a><span id="l25.22">   void GetModuleInfo( in string filter, in long index, out wstring name, out wstring description);</span>
<a href="#l25.23"></a><span id="l25.23">   wstring GetModuleName( in string filter, in long index);</span>
<a href="#l25.24"></a><span id="l25.24">   wstring GetModuleDescription( in string filter, in long index);</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineat">@@ -42,17 +42,17 @@ interface nsIImportService : nsISupports</span>
<a href="#l25.26"></a><span id="l25.26">   nsIImportGeneric      CreateNewGenericMail();</span>
<a href="#l25.27"></a><span id="l25.27">   nsIImportGeneric      CreateNewGenericAddressBooks();</span>
<a href="#l25.28"></a><span id="l25.28">   void CreateRFC822Message(in nsIMsgIdentity aIdentity,</span>
<a href="#l25.29"></a><span id="l25.29">                            in nsIMsgCompFields aMsgFields,</span>
<a href="#l25.30"></a><span id="l25.30">                            in string aBodytype,</span>
<a href="#l25.31"></a><span id="l25.31">                            in ACString aBody,</span>
<a href="#l25.32"></a><span id="l25.32">                            in boolean aCreateAsDraft,</span>
<a href="#l25.33"></a><span id="l25.33">                            in nsIArray aLoadedAttachments,</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineminus">-                           in nsISupportsArray aEmbeddedObjects,</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+                           in nsIArray aEmbeddedObjects,</span>
<a href="#l25.36"></a><span id="l25.36">                            in nsIMsgSendListener aListener);</span>
<a href="#l25.37"></a><span id="l25.37"> </span>
<a href="#l25.38"></a><span id="l25.38"> };</span>
<a href="#l25.39"></a><span id="l25.39"> </span>
<a href="#l25.40"></a><span id="l25.40"> %{ C++</span>
<a href="#l25.41"></a><span id="l25.41"> #define NS_IMPORTSERVICE_CID              \</span>
<a href="#l25.42"></a><span id="l25.42"> { /* 5df96d60-1726-11d3-a206-00a0cc26da63 */      \</span>
<a href="#l25.43"></a><span id="l25.43">    0x5df96d60, 0x1726, 0x11d3,                   \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/import/src/nsImportAddressBooks.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/import/src/nsImportAddressBooks.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -22,18 +22,19 @@</span>
<a href="#l26.4"></a><span id="l26.4"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l26.5"></a><span id="l26.5"> #include &quot;nsImportStringBundle.h&quot;</span>
<a href="#l26.6"></a><span id="l26.6"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l26.7"></a><span id="l26.7"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l26.8"></a><span id="l26.8"> #include &quot;msgCore.h&quot;</span>
<a href="#l26.9"></a><span id="l26.9"> #include &quot;ImportDebug.h&quot;</span>
<a href="#l26.10"></a><span id="l26.10"> #include &quot;nsIAbMDBDirectory.h&quot;</span>
<a href="#l26.11"></a><span id="l26.11"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l26.14"></a><span id="l26.14"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+#include &quot;nsArrayUtils.h&quot;</span>
<a href="#l26.16"></a><span id="l26.16"> </span>
<a href="#l26.17"></a><span id="l26.17"> static void ImportAddressThread(void *stuff);</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19"> class AddressThreadData;</span>
<a href="#l26.20"></a><span id="l26.20"> </span>
<a href="#l26.21"></a><span id="l26.21"> class nsImportGenericAddressBooks : public nsIImportGeneric</span>
<a href="#l26.22"></a><span id="l26.22"> {</span>
<a href="#l26.23"></a><span id="l26.23"> public:</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineat">@@ -67,17 +68,17 @@ private:</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26"> public:</span>
<a href="#l26.27"></a><span id="l26.27">   static void  SetLogs(nsString&amp; success, nsString&amp; error, nsISupportsString *pSuccess, nsISupportsString *pError);</span>
<a href="#l26.28"></a><span id="l26.28">   static void ReportError(const PRUnichar *pName, nsString *pStream,</span>
<a href="#l26.29"></a><span id="l26.29">                           nsIStringBundle *aBundle);</span>
<a href="#l26.30"></a><span id="l26.30"> </span>
<a href="#l26.31"></a><span id="l26.31"> private:</span>
<a href="#l26.32"></a><span id="l26.32">   nsIImportAddressBooks *    m_pInterface;</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">-  nsISupportsArray *m_pBooks;</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+  nsCOMPtr&lt;nsIArray&gt; m_Books;</span>
<a href="#l26.35"></a><span id="l26.35">   nsCOMArray&lt;nsIAddrDatabase&gt; m_DBs;</span>
<a href="#l26.36"></a><span id="l26.36">   nsCOMPtr &lt;nsIFile&gt;              m_pLocation;</span>
<a href="#l26.37"></a><span id="l26.37">   nsIImportFieldMap *      m_pFieldMap;</span>
<a href="#l26.38"></a><span id="l26.38">   bool              m_autoFind;</span>
<a href="#l26.39"></a><span id="l26.39">   PRUnichar *          m_description;</span>
<a href="#l26.40"></a><span id="l26.40">   bool              m_gotLocation;</span>
<a href="#l26.41"></a><span id="l26.41">   bool              m_found;</span>
<a href="#l26.42"></a><span id="l26.42">   bool              m_userVerify;</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineat">@@ -93,17 +94,17 @@ private:</span>
<a href="#l26.44"></a><span id="l26.44"> class AddressThreadData {</span>
<a href="#l26.45"></a><span id="l26.45"> public:</span>
<a href="#l26.46"></a><span id="l26.46">   bool              driverAlive;</span>
<a href="#l26.47"></a><span id="l26.47">   bool              threadAlive;</span>
<a href="#l26.48"></a><span id="l26.48">   bool              abort;</span>
<a href="#l26.49"></a><span id="l26.49">   bool              fatalError;</span>
<a href="#l26.50"></a><span id="l26.50">   uint32_t          currentTotal;</span>
<a href="#l26.51"></a><span id="l26.51">   uint32_t          currentSize;</span>
<a href="#l26.52"></a><span id="l26.52" class="difflineminus">-  nsISupportsArray *      books;</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineplus">+  nsIArray         *books;</span>
<a href="#l26.54"></a><span id="l26.54">   nsCOMArray&lt;nsIAddrDatabase&gt;* dBs;</span>
<a href="#l26.55"></a><span id="l26.55">   nsCOMPtr&lt;nsIAbLDIFService&gt; ldifService;</span>
<a href="#l26.56"></a><span id="l26.56">   nsIImportAddressBooks *    addressImport;</span>
<a href="#l26.57"></a><span id="l26.57">   nsIImportFieldMap *      fieldMap;</span>
<a href="#l26.58"></a><span id="l26.58">   nsISupportsString *    successLog;</span>
<a href="#l26.59"></a><span id="l26.59">   nsISupportsString *    errorLog;</span>
<a href="#l26.60"></a><span id="l26.60">   char *            pDestinationUri;</span>
<a href="#l26.61"></a><span id="l26.61">     nsIStringBundle*            stringBundle;</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineat">@@ -129,17 +130,16 @@ nsresult NS_NewGenericAddressBooks(nsIIm</span>
<a href="#l26.63"></a><span id="l26.63">   NS_RELEASE(pGen);</span>
<a href="#l26.64"></a><span id="l26.64"> </span>
<a href="#l26.65"></a><span id="l26.65">     return rv;</span>
<a href="#l26.66"></a><span id="l26.66"> }</span>
<a href="#l26.67"></a><span id="l26.67"> </span>
<a href="#l26.68"></a><span id="l26.68"> nsImportGenericAddressBooks::nsImportGenericAddressBooks()</span>
<a href="#l26.69"></a><span id="l26.69"> {</span>
<a href="#l26.70"></a><span id="l26.70">   m_pInterface = nullptr;</span>
<a href="#l26.71"></a><span id="l26.71" class="difflineminus">-  m_pBooks = nullptr;</span>
<a href="#l26.72"></a><span id="l26.72">   m_pSuccessLog = nullptr;</span>
<a href="#l26.73"></a><span id="l26.73">   m_pErrorLog = nullptr;</span>
<a href="#l26.74"></a><span id="l26.74">   m_totalSize = 0;</span>
<a href="#l26.75"></a><span id="l26.75">   m_doImport = false;</span>
<a href="#l26.76"></a><span id="l26.76">   m_pThreadData = nullptr;</span>
<a href="#l26.77"></a><span id="l26.77">   m_pDestinationUri = nullptr;</span>
<a href="#l26.78"></a><span id="l26.78">   m_pFieldMap = nullptr;</span>
<a href="#l26.79"></a><span id="l26.79"> </span>
<a href="#l26.80"></a><span id="l26.80" class="difflineat">@@ -158,17 +158,16 @@ nsImportGenericAddressBooks::~nsImportGe</span>
<a href="#l26.81"></a><span id="l26.81">   if (m_pDestinationUri)</span>
<a href="#l26.82"></a><span id="l26.82">     NS_Free(m_pDestinationUri);</span>
<a href="#l26.83"></a><span id="l26.83"> </span>
<a href="#l26.84"></a><span id="l26.84">   if (m_description)</span>
<a href="#l26.85"></a><span id="l26.85">     NS_Free(m_description);</span>
<a href="#l26.86"></a><span id="l26.86"> </span>
<a href="#l26.87"></a><span id="l26.87">   NS_IF_RELEASE(m_pFieldMap);</span>
<a href="#l26.88"></a><span id="l26.88">   NS_IF_RELEASE(m_pInterface);</span>
<a href="#l26.89"></a><span id="l26.89" class="difflineminus">-  NS_IF_RELEASE(m_pBooks);</span>
<a href="#l26.90"></a><span id="l26.90">   NS_IF_RELEASE(m_pSuccessLog);</span>
<a href="#l26.91"></a><span id="l26.91">   NS_IF_RELEASE(m_pErrorLog);</span>
<a href="#l26.92"></a><span id="l26.92"> }</span>
<a href="#l26.93"></a><span id="l26.93"> </span>
<a href="#l26.94"></a><span id="l26.94"> </span>
<a href="#l26.95"></a><span id="l26.95"> </span>
<a href="#l26.96"></a><span id="l26.96"> NS_IMPL_ISUPPORTS1(nsImportGenericAddressBooks, nsIImportGeneric)</span>
<a href="#l26.97"></a><span id="l26.97"> </span>
<a href="#l26.98"></a><span id="l26.98" class="difflineat">@@ -190,20 +189,19 @@ NS_IMETHODIMP nsImportGenericAddressBook</span>
<a href="#l26.99"></a><span id="l26.99">     if (!m_pLocation)</span>
<a href="#l26.100"></a><span id="l26.100">       GetDefaultLocation();</span>
<a href="#l26.101"></a><span id="l26.101">     NS_IF_ADDREF(*_retval = m_pLocation);</span>
<a href="#l26.102"></a><span id="l26.102">   }</span>
<a href="#l26.103"></a><span id="l26.103"> </span>
<a href="#l26.104"></a><span id="l26.104">   if (!PL_strcasecmp(dataId, &quot;addressBooks&quot;)) {</span>
<a href="#l26.105"></a><span id="l26.105">     if (!m_pLocation)</span>
<a href="#l26.106"></a><span id="l26.106">       GetDefaultLocation();</span>
<a href="#l26.107"></a><span id="l26.107" class="difflineminus">-    if (!m_pBooks)</span>
<a href="#l26.108"></a><span id="l26.108" class="difflineplus">+    if (!m_Books)</span>
<a href="#l26.109"></a><span id="l26.109">       GetDefaultBooks();</span>
<a href="#l26.110"></a><span id="l26.110" class="difflineminus">-    *_retval = m_pBooks;</span>
<a href="#l26.111"></a><span id="l26.111" class="difflineminus">-    NS_IF_ADDREF(m_pBooks);</span>
<a href="#l26.112"></a><span id="l26.112" class="difflineplus">+    *_retval = m_Books;</span>
<a href="#l26.113"></a><span id="l26.113">   }</span>
<a href="#l26.114"></a><span id="l26.114"> </span>
<a href="#l26.115"></a><span id="l26.115">   if (!PL_strcasecmp(dataId, &quot;addressDestination&quot;)) {</span>
<a href="#l26.116"></a><span id="l26.116">     if (m_pDestinationUri) {</span>
<a href="#l26.117"></a><span id="l26.117">             nsCOMPtr&lt;nsISupportsCString&gt; abString = do_CreateInstance(NS_SUPPORTS_CSTRING_CONTRACTID, &amp;rv);</span>
<a href="#l26.118"></a><span id="l26.118">             NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.119"></a><span id="l26.119">             abString-&gt;SetData(nsDependentCString(m_pDestinationUri));</span>
<a href="#l26.120"></a><span id="l26.120">             NS_IF_ADDREF(*_retval = abString);</span>
<a href="#l26.121"></a><span id="l26.121" class="difflineat">@@ -269,19 +267,18 @@ NS_IMETHODIMP nsImportGenericAddressBook</span>
<a href="#l26.122"></a><span id="l26.122">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l26.123"></a><span id="l26.123"> </span>
<a href="#l26.124"></a><span id="l26.124">   if (!PL_strcasecmp(dataId, &quot;addressInterface&quot;)) {</span>
<a href="#l26.125"></a><span id="l26.125">     NS_IF_RELEASE(m_pInterface);</span>
<a href="#l26.126"></a><span id="l26.126">     if (item)</span>
<a href="#l26.127"></a><span id="l26.127">       item-&gt;QueryInterface(NS_GET_IID(nsIImportAddressBooks), (void **) &amp;m_pInterface);</span>
<a href="#l26.128"></a><span id="l26.128">   }</span>
<a href="#l26.129"></a><span id="l26.129">   if (!PL_strcasecmp(dataId, &quot;addressBooks&quot;)) {</span>
<a href="#l26.130"></a><span id="l26.130" class="difflineminus">-    NS_IF_RELEASE(m_pBooks);</span>
<a href="#l26.131"></a><span id="l26.131">     if (item)</span>
<a href="#l26.132"></a><span id="l26.132" class="difflineminus">-      item-&gt;QueryInterface(NS_GET_IID(nsISupportsArray), (void **) &amp;m_pBooks);</span>
<a href="#l26.133"></a><span id="l26.133" class="difflineplus">+      item-&gt;QueryInterface(NS_GET_IID(nsIArray), (void **) &amp;m_Books);</span>
<a href="#l26.134"></a><span id="l26.134">   }</span>
<a href="#l26.135"></a><span id="l26.135"> </span>
<a href="#l26.136"></a><span id="l26.136">   if (!PL_strcasecmp(dataId, &quot;addressLocation&quot;)) {</span>
<a href="#l26.137"></a><span id="l26.137">     m_pLocation = nullptr;</span>
<a href="#l26.138"></a><span id="l26.138"> </span>
<a href="#l26.139"></a><span id="l26.139">     if (item) {</span>
<a href="#l26.140"></a><span id="l26.140">       nsresult rv;</span>
<a href="#l26.141"></a><span id="l26.141">       m_pLocation = do_QueryInterface(item, &amp;rv);</span>
<a href="#l26.142"></a><span id="l26.142" class="difflineat">@@ -379,23 +376,23 @@ void nsImportGenericAddressBooks::GetDef</span>
<a href="#l26.143"></a><span id="l26.143">   nsCOMPtr &lt;nsIFile&gt; pLoc;</span>
<a href="#l26.144"></a><span id="l26.144">   m_pInterface-&gt;GetDefaultLocation(getter_AddRefs(pLoc), &amp;m_found, &amp;m_userVerify);</span>
<a href="#l26.145"></a><span id="l26.145">   if (!m_pLocation)</span>
<a href="#l26.146"></a><span id="l26.146">     m_pLocation = pLoc;</span>
<a href="#l26.147"></a><span id="l26.147"> }</span>
<a href="#l26.148"></a><span id="l26.148"> </span>
<a href="#l26.149"></a><span id="l26.149"> void nsImportGenericAddressBooks::GetDefaultBooks(void)</span>
<a href="#l26.150"></a><span id="l26.150"> {</span>
<a href="#l26.151"></a><span id="l26.151" class="difflineminus">-  if (!m_pInterface || m_pBooks)</span>
<a href="#l26.152"></a><span id="l26.152" class="difflineplus">+  if (!m_pInterface || m_Books)</span>
<a href="#l26.153"></a><span id="l26.153">     return;</span>
<a href="#l26.154"></a><span id="l26.154"> </span>
<a href="#l26.155"></a><span id="l26.155">   if (!m_pLocation &amp;&amp; !m_autoFind)</span>
<a href="#l26.156"></a><span id="l26.156">     return;</span>
<a href="#l26.157"></a><span id="l26.157"> </span>
<a href="#l26.158"></a><span id="l26.158" class="difflineminus">-  nsresult rv = m_pInterface-&gt;FindAddressBooks(m_pLocation, &amp;m_pBooks);</span>
<a href="#l26.159"></a><span id="l26.159" class="difflineplus">+  nsresult rv = m_pInterface-&gt;FindAddressBooks(m_pLocation, getter_AddRefs(m_Books));</span>
<a href="#l26.160"></a><span id="l26.160">   if (NS_FAILED(rv)) {</span>
<a href="#l26.161"></a><span id="l26.161">     IMPORT_LOG0(&quot;*** Error: FindAddressBooks failed\n&quot;);</span>
<a href="#l26.162"></a><span id="l26.162">   }</span>
<a href="#l26.163"></a><span id="l26.163"> }</span>
<a href="#l26.164"></a><span id="l26.164"> </span>
<a href="#l26.165"></a><span id="l26.165"> void nsImportGenericAddressBooks::GetDefaultFieldMap(void)</span>
<a href="#l26.166"></a><span id="l26.166"> {</span>
<a href="#l26.167"></a><span id="l26.167">   if (!m_pInterface || !m_pLocation)</span>
<a href="#l26.168"></a><span id="l26.168" class="difflineat">@@ -432,27 +429,27 @@ NS_IMETHODIMP nsImportGenericAddressBook</span>
<a href="#l26.169"></a><span id="l26.169">   NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l26.170"></a><span id="l26.170">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l26.171"></a><span id="l26.171"> </span>
<a href="#l26.172"></a><span id="l26.172">   GetDefaultLocation();</span>
<a href="#l26.173"></a><span id="l26.173">   GetDefaultBooks();</span>
<a href="#l26.174"></a><span id="l26.174"> </span>
<a href="#l26.175"></a><span id="l26.175">   bool result = false;</span>
<a href="#l26.176"></a><span id="l26.176"> </span>
<a href="#l26.177"></a><span id="l26.177" class="difflineminus">-  if (m_pBooks) {</span>
<a href="#l26.178"></a><span id="l26.178" class="difflineplus">+  if (m_Books) {</span>
<a href="#l26.179"></a><span id="l26.179">     uint32_t    count = 0;</span>
<a href="#l26.180"></a><span id="l26.180">     uint32_t    i;</span>
<a href="#l26.181"></a><span id="l26.181">     bool        import;</span>
<a href="#l26.182"></a><span id="l26.182">     uint32_t    size;</span>
<a href="#l26.183"></a><span id="l26.183">     uint32_t    totalSize = 0;</span>
<a href="#l26.184"></a><span id="l26.184"> </span>
<a href="#l26.185"></a><span id="l26.185" class="difflineminus">-    (void) m_pBooks-&gt;Count(&amp;count);</span>
<a href="#l26.186"></a><span id="l26.186" class="difflineplus">+    m_Books-&gt;GetLength(&amp;count);</span>
<a href="#l26.187"></a><span id="l26.187"> </span>
<a href="#l26.188"></a><span id="l26.188">     for (i = 0; i &lt; count; i++) {</span>
<a href="#l26.189"></a><span id="l26.189" class="difflineminus">-      nsCOMPtr&lt;nsIImportABDescriptor&gt; book = do_QueryElementAt(m_pBooks, i);</span>
<a href="#l26.190"></a><span id="l26.190" class="difflineplus">+      nsCOMPtr&lt;nsIImportABDescriptor&gt; book = do_QueryElementAt(m_Books, i);</span>
<a href="#l26.191"></a><span id="l26.191">       if (book) {</span>
<a href="#l26.192"></a><span id="l26.192">         import = false;</span>
<a href="#l26.193"></a><span id="l26.193">         size = 0;</span>
<a href="#l26.194"></a><span id="l26.194">         nsresult rv = book-&gt;GetImport(&amp;import);</span>
<a href="#l26.195"></a><span id="l26.195">         if (NS_SUCCEEDED(rv) &amp;&amp; import) {</span>
<a href="#l26.196"></a><span id="l26.196">           (void) book-&gt;GetSize(&amp;size);</span>
<a href="#l26.197"></a><span id="l26.197">           result = true;</span>
<a href="#l26.198"></a><span id="l26.198">         }</span>
<a href="#l26.199"></a><span id="l26.199" class="difflineat">@@ -604,17 +601,17 @@ NS_IMETHODIMP nsImportGenericAddressBook</span>
<a href="#l26.200"></a><span id="l26.200">   if (!m_doImport) {</span>
<a href="#l26.201"></a><span id="l26.201">     *_retval = true;</span>
<a href="#l26.202"></a><span id="l26.202">     nsImportStringBundle::GetStringByID(IMPORT_NO_ADDRBOOKS, m_stringBundle,</span>
<a href="#l26.203"></a><span id="l26.203">                                         success);</span>
<a href="#l26.204"></a><span id="l26.204">     SetLogs(success, error, successLog, errorLog);</span>
<a href="#l26.205"></a><span id="l26.205">     return NS_OK;</span>
<a href="#l26.206"></a><span id="l26.206">   }</span>
<a href="#l26.207"></a><span id="l26.207"> </span>
<a href="#l26.208"></a><span id="l26.208" class="difflineminus">-  if (!m_pInterface || !m_pBooks) {</span>
<a href="#l26.209"></a><span id="l26.209" class="difflineplus">+  if (!m_pInterface || !m_Books) {</span>
<a href="#l26.210"></a><span id="l26.210">     nsImportStringBundle::GetStringByID(IMPORT_ERROR_AB_NOTINITIALIZED,</span>
<a href="#l26.211"></a><span id="l26.211">                                         m_stringBundle, error);</span>
<a href="#l26.212"></a><span id="l26.212">     SetLogs(success, error, successLog, errorLog);</span>
<a href="#l26.213"></a><span id="l26.213">     *_retval = false;</span>
<a href="#l26.214"></a><span id="l26.214">     return NS_OK;</span>
<a href="#l26.215"></a><span id="l26.215">   }</span>
<a href="#l26.216"></a><span id="l26.216"> </span>
<a href="#l26.217"></a><span id="l26.217">   bool needsFieldMap = false;</span>
<a href="#l26.218"></a><span id="l26.218" class="difflineat">@@ -635,38 +632,38 @@ NS_IMETHODIMP nsImportGenericAddressBook</span>
<a href="#l26.219"></a><span id="l26.219">   NS_IF_ADDREF(m_pSuccessLog);</span>
<a href="#l26.220"></a><span id="l26.220">   NS_IF_ADDREF(m_pErrorLog);</span>
<a href="#l26.221"></a><span id="l26.221"> </span>
<a href="#l26.222"></a><span id="l26.222"> </span>
<a href="#l26.223"></a><span id="l26.223">   // create the info need to drive address book import. We're</span>
<a href="#l26.224"></a><span id="l26.224">   // not going to create a new thread for this since address books</span>
<a href="#l26.225"></a><span id="l26.225">   // don't tend to be large, and import is rare.</span>
<a href="#l26.226"></a><span id="l26.226">   m_pThreadData = new AddressThreadData();</span>
<a href="#l26.227"></a><span id="l26.227" class="difflineminus">-  m_pThreadData-&gt;books = m_pBooks;</span>
<a href="#l26.228"></a><span id="l26.228" class="difflineminus">-  NS_ADDREF(m_pBooks);</span>
<a href="#l26.229"></a><span id="l26.229" class="difflineplus">+  m_pThreadData-&gt;books = m_Books;</span>
<a href="#l26.230"></a><span id="l26.230" class="difflineplus">+  NS_ADDREF(m_Books);</span>
<a href="#l26.231"></a><span id="l26.231">   m_pThreadData-&gt;addressImport = m_pInterface;</span>
<a href="#l26.232"></a><span id="l26.232">   NS_ADDREF(m_pInterface);</span>
<a href="#l26.233"></a><span id="l26.233">   m_pThreadData-&gt;fieldMap = m_pFieldMap;</span>
<a href="#l26.234"></a><span id="l26.234">   NS_IF_ADDREF(m_pFieldMap);</span>
<a href="#l26.235"></a><span id="l26.235">   m_pThreadData-&gt;errorLog = m_pErrorLog;</span>
<a href="#l26.236"></a><span id="l26.236">   NS_IF_ADDREF(m_pErrorLog);</span>
<a href="#l26.237"></a><span id="l26.237">   m_pThreadData-&gt;successLog = m_pSuccessLog;</span>
<a href="#l26.238"></a><span id="l26.238">   NS_IF_ADDREF(m_pSuccessLog);</span>
<a href="#l26.239"></a><span id="l26.239">   if (m_pDestinationUri)</span>
<a href="#l26.240"></a><span id="l26.240">     m_pThreadData-&gt;pDestinationUri = strdup(m_pDestinationUri);</span>
<a href="#l26.241"></a><span id="l26.241"> </span>
<a href="#l26.242"></a><span id="l26.242">   uint32_t count = 0;</span>
<a href="#l26.243"></a><span id="l26.243" class="difflineminus">-  m_pBooks-&gt;Count(&amp;count);</span>
<a href="#l26.244"></a><span id="l26.244" class="difflineplus">+  m_Books-&gt;GetLength(&amp;count);</span>
<a href="#l26.245"></a><span id="l26.245">   // Create/obtain any address books that we need here, so that we don't need</span>
<a href="#l26.246"></a><span id="l26.246">   // to do so inside the import thread which would just proxy the create</span>
<a href="#l26.247"></a><span id="l26.247">   // operations back to the main thread anyway.</span>
<a href="#l26.248"></a><span id="l26.248">   nsCOMPtr&lt;nsIAddrDatabase&gt; db = GetAddressBookFromUri(m_pDestinationUri);</span>
<a href="#l26.249"></a><span id="l26.249">   for (uint32_t i = 0; i &lt; count; ++i)</span>
<a href="#l26.250"></a><span id="l26.250">   {</span>
<a href="#l26.251"></a><span id="l26.251" class="difflineminus">-    nsCOMPtr&lt;nsIImportABDescriptor&gt; book = do_QueryElementAt(m_pBooks, i);</span>
<a href="#l26.252"></a><span id="l26.252" class="difflineplus">+    nsCOMPtr&lt;nsIImportABDescriptor&gt; book = do_QueryElementAt(m_Books, i);</span>
<a href="#l26.253"></a><span id="l26.253">     if (book)</span>
<a href="#l26.254"></a><span id="l26.254">     {</span>
<a href="#l26.255"></a><span id="l26.255">       if (!db)</span>
<a href="#l26.256"></a><span id="l26.256">       {</span>
<a href="#l26.257"></a><span id="l26.257">         nsString name;</span>
<a href="#l26.258"></a><span id="l26.258">         book-&gt;GetPreferredName(name);</span>
<a href="#l26.259"></a><span id="l26.259">         db = GetAddressBook(name.get(), true);</span>
<a href="#l26.260"></a><span id="l26.260">       }</span>
<a href="#l26.261"></a><span id="l26.261" class="difflineat">@@ -806,17 +803,17 @@ static void ImportAddressThread(void *st</span>
<a href="#l26.262"></a><span id="l26.262">   uint32_t          count = 0;</span>
<a href="#l26.263"></a><span id="l26.263">   uint32_t          i;</span>
<a href="#l26.264"></a><span id="l26.264">   bool              import;</span>
<a href="#l26.265"></a><span id="l26.265">   uint32_t          size;</span>
<a href="#l26.266"></a><span id="l26.266"> </span>
<a href="#l26.267"></a><span id="l26.267">   nsString          success;</span>
<a href="#l26.268"></a><span id="l26.268">   nsString          error;</span>
<a href="#l26.269"></a><span id="l26.269"> </span>
<a href="#l26.270"></a><span id="l26.270" class="difflineminus">-  (void) pData-&gt;books-&gt;Count(&amp;count);</span>
<a href="#l26.271"></a><span id="l26.271" class="difflineplus">+  (void) pData-&gt;books-&gt;GetLength(&amp;count);</span>
<a href="#l26.272"></a><span id="l26.272"> </span>
<a href="#l26.273"></a><span id="l26.273">   for (i = 0; (i &lt; count) &amp;&amp; !(pData-&gt;abort); i++) {</span>
<a href="#l26.274"></a><span id="l26.274">     nsCOMPtr&lt;nsIImportABDescriptor&gt; book =</span>
<a href="#l26.275"></a><span id="l26.275">       do_QueryElementAt(pData-&gt;books, i);</span>
<a href="#l26.276"></a><span id="l26.276"> </span>
<a href="#l26.277"></a><span id="l26.277">     if (book) {</span>
<a href="#l26.278"></a><span id="l26.278">       import = false;</span>
<a href="#l26.279"></a><span id="l26.279">       size = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -10,17 +10,18 @@</span>
<a href="#l27.4"></a><span id="l27.4"> // sorry, this has to be before the pre-compiled header</span>
<a href="#l27.5"></a><span id="l27.5"> #define FORCE_PR_LOG /* Allow logging in the release build */</span>
<a href="#l27.6"></a><span id="l27.6"> #endif</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> #include &quot;prthread.h&quot;</span>
<a href="#l27.9"></a><span id="l27.9"> #include &quot;prprf.h&quot;</span>
<a href="#l27.10"></a><span id="l27.10"> #include &quot;nscore.h&quot;</span>
<a href="#l27.11"></a><span id="l27.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+#include &quot;nsArrayUtils.h&quot;</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16"> #include &quot;nsIImportMail.h&quot;</span>
<a href="#l27.17"></a><span id="l27.17"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l27.18"></a><span id="l27.18"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l27.19"></a><span id="l27.19"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l27.20"></a><span id="l27.20"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l27.21"></a><span id="l27.21"> </span>
<a href="#l27.22"></a><span id="l27.22"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineat">@@ -91,18 +92,18 @@ private:</span>
<a href="#l27.24"></a><span id="l27.24">   nsString      m_pName;  // module name that created this interface</span>
<a href="#l27.25"></a><span id="l27.25">   nsIMsgFolder *    m_pDestFolder;</span>
<a href="#l27.26"></a><span id="l27.26">   bool          m_deleteDestFolder;</span>
<a href="#l27.27"></a><span id="l27.27">   bool          m_createdFolder;</span>
<a href="#l27.28"></a><span id="l27.28">   nsCOMPtr &lt;nsIFile&gt; m_pSrcLocation;</span>
<a href="#l27.29"></a><span id="l27.29">   bool          m_gotLocation;</span>
<a href="#l27.30"></a><span id="l27.30">   bool          m_found;</span>
<a href="#l27.31"></a><span id="l27.31">   bool          m_userVerify;</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineminus">-  nsIImportMail *    m_pInterface;</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineminus">-  nsISupportsArray *  m_pMailboxes;</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineplus">+  nsIImportMail *m_pInterface;</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineplus">+  nsIArray *  m_pMailboxes;</span>
<a href="#l27.36"></a><span id="l27.36">   nsISupportsString *m_pSuccessLog;</span>
<a href="#l27.37"></a><span id="l27.37">   nsISupportsString *m_pErrorLog;</span>
<a href="#l27.38"></a><span id="l27.38">   uint32_t      m_totalSize;</span>
<a href="#l27.39"></a><span id="l27.39">   bool          m_doImport;</span>
<a href="#l27.40"></a><span id="l27.40">   ImportThreadData *  m_pThreadData;</span>
<a href="#l27.41"></a><span id="l27.41">     bool          m_performingMigration;</span>
<a href="#l27.42"></a><span id="l27.42">   nsCOMPtr&lt;nsIStringBundle&gt; m_stringBundle;</span>
<a href="#l27.43"></a><span id="l27.43"> };</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineat">@@ -112,17 +113,17 @@ public:</span>
<a href="#l27.45"></a><span id="l27.45">   bool            driverAlive;</span>
<a href="#l27.46"></a><span id="l27.46">   bool            threadAlive;</span>
<a href="#l27.47"></a><span id="l27.47">   bool            abort;</span>
<a href="#l27.48"></a><span id="l27.48">   bool            fatalError;</span>
<a href="#l27.49"></a><span id="l27.49">   uint32_t        currentTotal;</span>
<a href="#l27.50"></a><span id="l27.50">   uint32_t        currentSize;</span>
<a href="#l27.51"></a><span id="l27.51">   nsIMsgFolder *      destRoot;</span>
<a href="#l27.52"></a><span id="l27.52">   bool            ownsDestRoot;</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineminus">-  nsISupportsArray *    boxes;</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineplus">+  nsIArray *boxes;</span>
<a href="#l27.55"></a><span id="l27.55">   nsIImportMail *      mailImport;</span>
<a href="#l27.56"></a><span id="l27.56">   nsISupportsString *  successLog;</span>
<a href="#l27.57"></a><span id="l27.57">   nsISupportsString *  errorLog;</span>
<a href="#l27.58"></a><span id="l27.58">   uint32_t        currentMailbox;</span>
<a href="#l27.59"></a><span id="l27.59">     bool            performingMigration;</span>
<a href="#l27.60"></a><span id="l27.60">   nsIStringBundle *stringBundle;</span>
<a href="#l27.61"></a><span id="l27.61"> </span>
<a href="#l27.62"></a><span id="l27.62">   ImportThreadData();</span>
<a href="#l27.63"></a><span id="l27.63" class="difflineat">@@ -277,17 +278,17 @@ NS_IMETHODIMP nsImportGenericMail::SetDa</span>
<a href="#l27.64"></a><span id="l27.64">   if (!PL_strcasecmp(dataId, &quot;mailInterface&quot;)) {</span>
<a href="#l27.65"></a><span id="l27.65">     NS_IF_RELEASE(m_pInterface);</span>
<a href="#l27.66"></a><span id="l27.66">     if (item)</span>
<a href="#l27.67"></a><span id="l27.67">       item-&gt;QueryInterface(NS_GET_IID(nsIImportMail), (void **) &amp;m_pInterface);</span>
<a href="#l27.68"></a><span id="l27.68">   }</span>
<a href="#l27.69"></a><span id="l27.69">   if (!PL_strcasecmp(dataId, &quot;mailBoxes&quot;)) {</span>
<a href="#l27.70"></a><span id="l27.70">     NS_IF_RELEASE(m_pMailboxes);</span>
<a href="#l27.71"></a><span id="l27.71">     if (item)</span>
<a href="#l27.72"></a><span id="l27.72" class="difflineminus">-      item-&gt;QueryInterface(NS_GET_IID(nsISupportsArray), (void **) &amp;m_pMailboxes);</span>
<a href="#l27.73"></a><span id="l27.73" class="difflineplus">+      item-&gt;QueryInterface(NS_GET_IID(nsIArray), (void **) &amp;m_pMailboxes);</span>
<a href="#l27.74"></a><span id="l27.74">   }</span>
<a href="#l27.75"></a><span id="l27.75"> </span>
<a href="#l27.76"></a><span id="l27.76">   if (!PL_strcasecmp(dataId, &quot;mailLocation&quot;)) {</span>
<a href="#l27.77"></a><span id="l27.77">     NS_IF_RELEASE(m_pMailboxes);</span>
<a href="#l27.78"></a><span id="l27.78">     m_pSrcLocation = nullptr;</span>
<a href="#l27.79"></a><span id="l27.79">     if (item) {</span>
<a href="#l27.80"></a><span id="l27.80">       nsresult rv;</span>
<a href="#l27.81"></a><span id="l27.81">       nsCOMPtr &lt;nsIFile&gt; location = do_QueryInterface(item, &amp;rv);</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineat">@@ -410,17 +411,17 @@ NS_IMETHODIMP nsImportGenericMail::Wants</span>
<a href="#l27.83"></a><span id="l27.83"> </span>
<a href="#l27.84"></a><span id="l27.84">   if (m_pMailboxes) {</span>
<a href="#l27.85"></a><span id="l27.85">     uint32_t    i;</span>
<a href="#l27.86"></a><span id="l27.86">     bool        import;</span>
<a href="#l27.87"></a><span id="l27.87">     uint32_t    count = 0;</span>
<a href="#l27.88"></a><span id="l27.88">     uint32_t    size;</span>
<a href="#l27.89"></a><span id="l27.89">     uint32_t    totalSize = 0;</span>
<a href="#l27.90"></a><span id="l27.90"> </span>
<a href="#l27.91"></a><span id="l27.91" class="difflineminus">-    (void) m_pMailboxes-&gt;Count(&amp;count);</span>
<a href="#l27.92"></a><span id="l27.92" class="difflineplus">+    (void) m_pMailboxes-&gt;GetLength(&amp;count);</span>
<a href="#l27.93"></a><span id="l27.93">     for (i = 0; i &lt; count; i++) {</span>
<a href="#l27.94"></a><span id="l27.94">       nsCOMPtr&lt;nsIImportMailboxDescriptor&gt; box =</span>
<a href="#l27.95"></a><span id="l27.95">         do_QueryElementAt(m_pMailboxes, i);</span>
<a href="#l27.96"></a><span id="l27.96">       if (box) {</span>
<a href="#l27.97"></a><span id="l27.97">         import = false;</span>
<a href="#l27.98"></a><span id="l27.98">         size = 0;</span>
<a href="#l27.99"></a><span id="l27.99">         nsresult rv = box-&gt;GetImport(&amp;import);</span>
<a href="#l27.100"></a><span id="l27.100">         if (NS_SUCCEEDED(rv) &amp;&amp; import) {</span>
<a href="#l27.101"></a><span id="l27.101" class="difflineat">@@ -709,17 +710,17 @@ ImportMailThread(void *stuff)</span>
<a href="#l27.102"></a><span id="l27.102"> </span>
<a href="#l27.103"></a><span id="l27.103">   IMPORT_LOG0(&quot;ImportMailThread: Starting...&quot;);</span>
<a href="#l27.104"></a><span id="l27.104"> </span>
<a href="#l27.105"></a><span id="l27.105">   nsresult rv = NS_OK;</span>
<a href="#l27.106"></a><span id="l27.106"> </span>
<a href="#l27.107"></a><span id="l27.107">   nsCOMPtr&lt;nsIMsgFolder&gt;    destRoot(pData-&gt;destRoot);</span>
<a href="#l27.108"></a><span id="l27.108"> </span>
<a href="#l27.109"></a><span id="l27.109">   uint32_t  count = 0;</span>
<a href="#l27.110"></a><span id="l27.110" class="difflineminus">-  rv = pData-&gt;boxes-&gt;Count(&amp;count);</span>
<a href="#l27.111"></a><span id="l27.111" class="difflineplus">+  rv = pData-&gt;boxes-&gt;GetLength(&amp;count);</span>
<a href="#l27.112"></a><span id="l27.112"> </span>
<a href="#l27.113"></a><span id="l27.113">   uint32_t    i;</span>
<a href="#l27.114"></a><span id="l27.114">   bool        import;</span>
<a href="#l27.115"></a><span id="l27.115">   uint32_t    size;</span>
<a href="#l27.116"></a><span id="l27.116">   uint32_t    depth = 1;</span>
<a href="#l27.117"></a><span id="l27.117">   uint32_t    newDepth;</span>
<a href="#l27.118"></a><span id="l27.118">   nsString    lastName;</span>
<a href="#l27.119"></a><span id="l27.119">   PRUnichar *    pName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/import/src/nsImportService.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/import/src/nsImportService.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -32,16 +32,17 @@</span>
<a href="#l28.4"></a><span id="l28.4"> #include &quot;nsIEditor.h&quot;</span>
<a href="#l28.5"></a><span id="l28.5"> #include &quot;ImportDebug.h&quot;</span>
<a href="#l28.6"></a><span id="l28.6"> #include &quot;nsImportService.h&quot;</span>
<a href="#l28.7"></a><span id="l28.7"> #include &quot;nsImportStringBundle.h&quot;</span>
<a href="#l28.8"></a><span id="l28.8"> #include &quot;nsCRTGlue.h&quot;</span>
<a href="#l28.9"></a><span id="l28.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l28.10"></a><span id="l28.10"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l28.11"></a><span id="l28.11"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l28.13"></a><span id="l28.13"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l28.14"></a><span id="l28.14"> #include &quot;nsIMsgSend.h&quot;</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16"> PRLogModuleInfo *IMPORTLOGMODULE = nullptr;</span>
<a href="#l28.17"></a><span id="l28.17"> </span>
<a href="#l28.18"></a><span id="l28.18"> static nsIImportService *  gImportService = nullptr;</span>
<a href="#l28.19"></a><span id="l28.19"> static const char *  kWhitespace = &quot;\b\t\r\n &quot;;</span>
<a href="#l28.20"></a><span id="l28.20"> </span>
<a href="#l28.21"></a><span id="l28.21" class="difflineat">@@ -290,69 +291,82 @@ class nsProxySendRunnable : public nsRun</span>
<a href="#l28.22"></a><span id="l28.22"> {</span>
<a href="#l28.23"></a><span id="l28.23"> public:</span>
<a href="#l28.24"></a><span id="l28.24">   nsProxySendRunnable(nsIMsgIdentity *aIdentity,</span>
<a href="#l28.25"></a><span id="l28.25">                        nsIMsgCompFields *aMsgFields,</span>
<a href="#l28.26"></a><span id="l28.26">                        const char *attachment1_type,</span>
<a href="#l28.27"></a><span id="l28.27">                        const nsACString &amp;attachment1_body,</span>
<a href="#l28.28"></a><span id="l28.28">                        bool aIsDraft,</span>
<a href="#l28.29"></a><span id="l28.29">                        nsIArray *aLoadedAttachments,</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineminus">-                       nsISupportsArray *aEmbeddedAttachments,</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineplus">+                       nsIArray *aEmbeddedAttachments,</span>
<a href="#l28.32"></a><span id="l28.32">                        nsIMsgSendListener *aListener);</span>
<a href="#l28.33"></a><span id="l28.33">   NS_DECL_NSIRUNNABLE</span>
<a href="#l28.34"></a><span id="l28.34"> private:</span>
<a href="#l28.35"></a><span id="l28.35">   nsCOMPtr&lt;nsIMsgIdentity&gt; m_identity;</span>
<a href="#l28.36"></a><span id="l28.36">   nsCOMPtr&lt;nsIMsgCompFields&gt; m_compFields;</span>
<a href="#l28.37"></a><span id="l28.37">   bool m_isDraft;</span>
<a href="#l28.38"></a><span id="l28.38">   nsCString m_bodyType;</span>
<a href="#l28.39"></a><span id="l28.39">   nsCString m_body;</span>
<a href="#l28.40"></a><span id="l28.40">   nsCOMPtr&lt;nsIArray&gt; m_loadedAttachments;</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; m_embeddedAttachments;</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineplus">+  nsCOMPtr&lt;nsIArray&gt; m_embeddedAttachments;</span>
<a href="#l28.43"></a><span id="l28.43">   nsCOMPtr&lt;nsIMsgSendListener&gt; m_listener;</span>
<a href="#l28.44"></a><span id="l28.44"> </span>
<a href="#l28.45"></a><span id="l28.45"> };</span>
<a href="#l28.46"></a><span id="l28.46"> </span>
<a href="#l28.47"></a><span id="l28.47"> nsProxySendRunnable::nsProxySendRunnable(nsIMsgIdentity *aIdentity,</span>
<a href="#l28.48"></a><span id="l28.48">                                          nsIMsgCompFields *aMsgFields,</span>
<a href="#l28.49"></a><span id="l28.49">                                          const char *aBodyType,</span>
<a href="#l28.50"></a><span id="l28.50">                                          const nsACString &amp;aBody,</span>
<a href="#l28.51"></a><span id="l28.51">                                          bool aIsDraft,</span>
<a href="#l28.52"></a><span id="l28.52">                                          nsIArray *aLoadedAttachments,</span>
<a href="#l28.53"></a><span id="l28.53" class="difflineminus">-                                         nsISupportsArray *aEmbeddedAttachments,</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineplus">+                                         nsIArray *aEmbeddedAttachments,</span>
<a href="#l28.55"></a><span id="l28.55">                                          nsIMsgSendListener *aListener) :</span>
<a href="#l28.56"></a><span id="l28.56">   m_identity(aIdentity), m_compFields(aMsgFields),</span>
<a href="#l28.57"></a><span id="l28.57">   m_isDraft(aIsDraft), m_bodyType(aBodyType),</span>
<a href="#l28.58"></a><span id="l28.58">   m_body(aBody), m_loadedAttachments(aLoadedAttachments),</span>
<a href="#l28.59"></a><span id="l28.59">   m_embeddedAttachments(aEmbeddedAttachments),</span>
<a href="#l28.60"></a><span id="l28.60">   m_listener(aListener)</span>
<a href="#l28.61"></a><span id="l28.61"> {</span>
<a href="#l28.62"></a><span id="l28.62"> }</span>
<a href="#l28.63"></a><span id="l28.63"> </span>
<a href="#l28.64"></a><span id="l28.64"> NS_IMETHODIMP nsProxySendRunnable::Run()</span>
<a href="#l28.65"></a><span id="l28.65"> {</span>
<a href="#l28.66"></a><span id="l28.66">   nsresult rv;</span>
<a href="#l28.67"></a><span id="l28.67">   nsCOMPtr&lt;nsIMsgSend&gt; msgSend = do_CreateInstance(NS_MSGSEND_CONTRACTID, &amp;rv);</span>
<a href="#l28.68"></a><span id="l28.68">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.69"></a><span id="l28.69"> </span>
<a href="#l28.70"></a><span id="l28.70" class="difflineplus">+  nsCOMPtr&lt;nsISupportsArray&gt; supportsArray;</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineplus">+  NS_NewISupportsArray(getter_AddRefs(supportsArray));</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineplus">+</span>
<a href="#l28.73"></a><span id="l28.73" class="difflineplus">+  nsCOMPtr&lt;nsISimpleEnumerator&gt; enumerator;</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineplus">+  m_embeddedAttachments-&gt;Enumerate(getter_AddRefs(enumerator));</span>
<a href="#l28.75"></a><span id="l28.75" class="difflineplus">+</span>
<a href="#l28.76"></a><span id="l28.76" class="difflineplus">+  bool hasMore;</span>
<a href="#l28.77"></a><span id="l28.77" class="difflineplus">+  while (NS_SUCCEEDED(enumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l28.78"></a><span id="l28.78" class="difflineplus">+    nsCOMPtr&lt;nsISupports&gt; item;</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineplus">+    enumerator-&gt;GetNext(getter_AddRefs(item));</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineplus">+    supportsArray-&gt;AppendElement(item);</span>
<a href="#l28.81"></a><span id="l28.81" class="difflineplus">+  }</span>
<a href="#l28.82"></a><span id="l28.82" class="difflineplus">+</span>
<a href="#l28.83"></a><span id="l28.83">   return msgSend-&gt;CreateRFC822Message(m_identity, m_compFields,</span>
<a href="#l28.84"></a><span id="l28.84">                                       m_bodyType.get(), m_body,</span>
<a href="#l28.85"></a><span id="l28.85">                                       m_isDraft, m_loadedAttachments,</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineminus">-                                      m_embeddedAttachments,</span>
<a href="#l28.87"></a><span id="l28.87" class="difflineplus">+                                      supportsArray,</span>
<a href="#l28.88"></a><span id="l28.88">                                       m_listener);</span>
<a href="#l28.89"></a><span id="l28.89"> }</span>
<a href="#l28.90"></a><span id="l28.90"> </span>
<a href="#l28.91"></a><span id="l28.91"> </span>
<a href="#l28.92"></a><span id="l28.92"> NS_IMETHODIMP</span>
<a href="#l28.93"></a><span id="l28.93"> nsImportService::CreateRFC822Message(nsIMsgIdentity *aIdentity,</span>
<a href="#l28.94"></a><span id="l28.94">                                      nsIMsgCompFields *aMsgFields,</span>
<a href="#l28.95"></a><span id="l28.95">                                      const char *aBodyType,</span>
<a href="#l28.96"></a><span id="l28.96">                                      const nsACString &amp;aBody,</span>
<a href="#l28.97"></a><span id="l28.97">                                      bool aIsDraft,</span>
<a href="#l28.98"></a><span id="l28.98">                                      nsIArray *aLoadedAttachments,</span>
<a href="#l28.99"></a><span id="l28.99" class="difflineminus">-                                     nsISupportsArray *aEmbeddedAttachments,</span>
<a href="#l28.100"></a><span id="l28.100" class="difflineplus">+                                     nsIArray *aEmbeddedAttachments,</span>
<a href="#l28.101"></a><span id="l28.101">                                      nsIMsgSendListener *aListener)</span>
<a href="#l28.102"></a><span id="l28.102"> {</span>
<a href="#l28.103"></a><span id="l28.103">     nsRefPtr&lt;nsProxySendRunnable&gt; runnable =</span>
<a href="#l28.104"></a><span id="l28.104">       new nsProxySendRunnable(aIdentity,</span>
<a href="#l28.105"></a><span id="l28.105">                               aMsgFields,</span>
<a href="#l28.106"></a><span id="l28.106">                               aBodyType,</span>
<a href="#l28.107"></a><span id="l28.107">                               aBody,</span>
<a href="#l28.108"></a><span id="l28.108">                               aIsDraft,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/import/test/unit/resources/TestMailImporter.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/import/test/unit/resources/TestMailImporter.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -58,29 +58,29 @@ TestMailImpoter.prototype = {</span>
<a href="#l29.4"></a><span id="l29.4"> </span>
<a href="#l29.5"></a><span id="l29.5">     return descriptor;</span>
<a href="#l29.6"></a><span id="l29.6">   },</span>
<a href="#l29.7"></a><span id="l29.7"> </span>
<a href="#l29.8"></a><span id="l29.8">   _collectMailboxesInDirectory: function(directory, depth, result) {</span>
<a href="#l29.9"></a><span id="l29.9">     let descriptor = this._createMailboxDescriptor(directory.path,</span>
<a href="#l29.10"></a><span id="l29.10">                                                    directory.leafName,</span>
<a href="#l29.11"></a><span id="l29.11">                                                    depth);</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-    result.AppendElement(descriptor);</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+    result.AppendElement(descriptor, false);</span>
<a href="#l29.14"></a><span id="l29.14">     let entries = directory.directoryEntries;</span>
<a href="#l29.15"></a><span id="l29.15">     while (entries.hasMoreElements()) {</span>
<a href="#l29.16"></a><span id="l29.16">       let entry = entries.getNext().QueryInterface(Ci.nsIFile);</span>
<a href="#l29.17"></a><span id="l29.17">       if (entry.isDirectory())</span>
<a href="#l29.18"></a><span id="l29.18">         this._collectMailboxesInDirectory(entry, depth + 1, result);</span>
<a href="#l29.19"></a><span id="l29.19">     }</span>
<a href="#l29.20"></a><span id="l29.20">   },</span>
<a href="#l29.21"></a><span id="l29.21"> </span>
<a href="#l29.22"></a><span id="l29.22">   FindMailboxes: function(location) {</span>
<a href="#l29.23"></a><span id="l29.23">     let result;</span>
<a href="#l29.24"></a><span id="l29.24">     result = Cc[&quot;@mozilla.org/supports-array;1&quot;]</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineminus">-             .createInstance(Ci.nsISupportsArray);</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineplus">+             .createInstance(Ci.nsIArray);</span>
<a href="#l29.27"></a><span id="l29.27">     this._collectMailboxesInDirectory(location, 0, result);</span>
<a href="#l29.28"></a><span id="l29.28"> </span>
<a href="#l29.29"></a><span id="l29.29">     return result;</span>
<a href="#l29.30"></a><span id="l29.30">   },</span>
<a href="#l29.31"></a><span id="l29.31"> </span>
<a href="#l29.32"></a><span id="l29.32">   ImportMailbox: function(source,</span>
<a href="#l29.33"></a><span id="l29.33">                           destination,</span>
<a href="#l29.34"></a><span id="l29.34">                           errorLog,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -18,16 +18,17 @@</span>
<a href="#l30.4"></a><span id="l30.4"> #include &quot;nscore.h&quot;</span>
<a href="#l30.5"></a><span id="l30.5"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l30.6"></a><span id="l30.6"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l30.7"></a><span id="l30.7"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l30.8"></a><span id="l30.8"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l30.9"></a><span id="l30.9"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l30.10"></a><span id="l30.10"> #include &quot;nsTextImport.h&quot;</span>
<a href="#l30.11"></a><span id="l30.11"> #include &quot;nsIMemory.h&quot;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l30.13"></a><span id="l30.13"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l30.14"></a><span id="l30.14"> #include &quot;nsIImportAddressBooks.h&quot;</span>
<a href="#l30.15"></a><span id="l30.15"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l30.16"></a><span id="l30.16"> #include &quot;nsIImportFieldMap.h&quot;</span>
<a href="#l30.17"></a><span id="l30.17"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l30.18"></a><span id="l30.18"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l30.19"></a><span id="l30.19"> #include &quot;nsIAbLDIFService.h&quot;</span>
<a href="#l30.20"></a><span id="l30.20"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineat">@@ -68,17 +69,17 @@ public:</span>
<a href="#l30.22"></a><span id="l30.22">   NS_IMETHOD GetSupportsMultiple(bool *_retval) { *_retval = false; return NS_OK;}</span>
<a href="#l30.23"></a><span id="l30.23"> </span>
<a href="#l30.24"></a><span id="l30.24">   NS_IMETHOD GetAutoFind(PRUnichar **description, bool *_retval);</span>
<a href="#l30.25"></a><span id="l30.25"> </span>
<a href="#l30.26"></a><span id="l30.26">   NS_IMETHOD GetNeedsFieldMap(nsIFile *location, bool *_retval);</span>
<a href="#l30.27"></a><span id="l30.27"> </span>
<a href="#l30.28"></a><span id="l30.28">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l30.29"></a><span id="l30.29"> </span>
<a href="#l30.30"></a><span id="l30.30" class="difflineminus">-  NS_IMETHOD FindAddressBooks(nsIFile *location, nsISupportsArray **_retval);</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineplus">+  NS_IMETHOD FindAddressBooks(nsIFile *location, nsIArray **_retval);</span>
<a href="#l30.32"></a><span id="l30.32"> </span>
<a href="#l30.33"></a><span id="l30.33">   NS_IMETHOD InitFieldMap(nsIImportFieldMap *fieldMap);</span>
<a href="#l30.34"></a><span id="l30.34"> </span>
<a href="#l30.35"></a><span id="l30.35">   NS_IMETHOD ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l30.36"></a><span id="l30.36">                                nsIAddrDatabase *destination,</span>
<a href="#l30.37"></a><span id="l30.37">                                nsIImportFieldMap *fieldMap,</span>
<a href="#l30.38"></a><span id="l30.38">                                nsISupports *aSupportService,</span>
<a href="#l30.39"></a><span id="l30.39">                                PRUnichar **errorLog,</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineat">@@ -251,17 +252,17 @@ NS_IMETHODIMP ImportAddressImpl::GetDefa</span>
<a href="#l30.41"></a><span id="l30.41">   *ppLoc = nullptr;</span>
<a href="#l30.42"></a><span id="l30.42">   *found = false;</span>
<a href="#l30.43"></a><span id="l30.43">   *userVerify = true;</span>
<a href="#l30.44"></a><span id="l30.44">   return NS_OK;</span>
<a href="#l30.45"></a><span id="l30.45"> }</span>
<a href="#l30.46"></a><span id="l30.46"> </span>
<a href="#l30.47"></a><span id="l30.47"> </span>
<a href="#l30.48"></a><span id="l30.48"> </span>
<a href="#l30.49"></a><span id="l30.49" class="difflineminus">-NS_IMETHODIMP ImportAddressImpl::FindAddressBooks(nsIFile *pLoc, nsISupportsArray **ppArray)</span>
<a href="#l30.50"></a><span id="l30.50" class="difflineplus">+NS_IMETHODIMP ImportAddressImpl::FindAddressBooks(nsIFile *pLoc, nsIArray **ppArray)</span>
<a href="#l30.51"></a><span id="l30.51"> {</span>
<a href="#l30.52"></a><span id="l30.52">   NS_PRECONDITION(pLoc != nullptr, &quot;null ptr&quot;);</span>
<a href="#l30.53"></a><span id="l30.53">   NS_PRECONDITION(ppArray != nullptr, &quot;null ptr&quot;);</span>
<a href="#l30.54"></a><span id="l30.54">   if (!pLoc || !ppArray)</span>
<a href="#l30.55"></a><span id="l30.55">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l30.56"></a><span id="l30.56"> </span>
<a href="#l30.57"></a><span id="l30.57">   ClearSampleFile();</span>
<a href="#l30.58"></a><span id="l30.58"> </span>
<a href="#l30.59"></a><span id="l30.59" class="difflineat">@@ -283,20 +284,19 @@ NS_IMETHODIMP ImportAddressImpl::FindAdd</span>
<a href="#l30.60"></a><span id="l30.60">     return rv;</span>
<a href="#l30.61"></a><span id="l30.61">   }</span>
<a href="#l30.62"></a><span id="l30.62">   m_haveDelim = true;</span>
<a href="#l30.63"></a><span id="l30.63">   m_delim = m_text.GetDelim();</span>
<a href="#l30.64"></a><span id="l30.64"> </span>
<a href="#l30.65"></a><span id="l30.65">   m_fileLoc = do_QueryInterface(pLoc);</span>
<a href="#l30.66"></a><span id="l30.66"> </span>
<a href="#l30.67"></a><span id="l30.67">   /* Build an address book descriptor based on the file passed in! */</span>
<a href="#l30.68"></a><span id="l30.68" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; array;</span>
<a href="#l30.69"></a><span id="l30.69" class="difflineminus">-  rv = NS_NewISupportsArray(getter_AddRefs(array));</span>
<a href="#l30.70"></a><span id="l30.70" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; array(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l30.71"></a><span id="l30.71">   if (NS_FAILED(rv)) {</span>
<a href="#l30.72"></a><span id="l30.72" class="difflineminus">-    IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray\n&quot;);</span>
<a href="#l30.73"></a><span id="l30.73" class="difflineplus">+    IMPORT_LOG0(&quot;FAILED to allocate the nsIMutableArray\n&quot;);</span>
<a href="#l30.74"></a><span id="l30.74">     return rv;</span>
<a href="#l30.75"></a><span id="l30.75">   }</span>
<a href="#l30.76"></a><span id="l30.76"> </span>
<a href="#l30.77"></a><span id="l30.77">   nsString name;</span>
<a href="#l30.78"></a><span id="l30.78">   m_fileLoc-&gt;GetLeafName(name);</span>
<a href="#l30.79"></a><span id="l30.79">   if (NS_FAILED(rv)) {</span>
<a href="#l30.80"></a><span id="l30.80">     IMPORT_LOG0(&quot;*** Failed getting leaf name of file\n&quot;);</span>
<a href="#l30.81"></a><span id="l30.81">     return rv;</span>
<a href="#l30.82"></a><span id="l30.82" class="difflineat">@@ -319,27 +319,25 @@ NS_IMETHODIMP ImportAddressImpl::FindAdd</span>
<a href="#l30.83"></a><span id="l30.83">   rv = impSvc-&gt;CreateNewABDescriptor(getter_AddRefs(desc));</span>
<a href="#l30.84"></a><span id="l30.84">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l30.85"></a><span id="l30.85">     int64_t sz = 0;</span>
<a href="#l30.86"></a><span id="l30.86">     pLoc-&gt;GetFileSize(&amp;sz);</span>
<a href="#l30.87"></a><span id="l30.87">     desc-&gt;SetPreferredName(name);</span>
<a href="#l30.88"></a><span id="l30.88">     desc-&gt;SetSize((uint32_t) sz);</span>
<a href="#l30.89"></a><span id="l30.89">     desc-&gt;SetAbFile(m_fileLoc);</span>
<a href="#l30.90"></a><span id="l30.90">     rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l30.91"></a><span id="l30.91" class="difflineminus">-    array-&gt;AppendElement(pInterface);</span>
<a href="#l30.92"></a><span id="l30.92" class="difflineplus">+    array-&gt;AppendElement(pInterface, false);</span>
<a href="#l30.93"></a><span id="l30.93">     pInterface-&gt;Release();</span>
<a href="#l30.94"></a><span id="l30.94">   }</span>
<a href="#l30.95"></a><span id="l30.95">   if (NS_FAILED(rv)) {</span>
<a href="#l30.96"></a><span id="l30.96">     IMPORT_LOG0(&quot;*** Error creating address book descriptor for text import\n&quot;);</span>
<a href="#l30.97"></a><span id="l30.97" class="difflineplus">+    return rv;</span>
<a href="#l30.98"></a><span id="l30.98">   }</span>
<a href="#l30.99"></a><span id="l30.99" class="difflineminus">-  else {</span>
<a href="#l30.100"></a><span id="l30.100" class="difflineminus">-    rv = array-&gt;QueryInterface(NS_GET_IID(nsISupportsArray), (void **) ppArray);</span>
<a href="#l30.101"></a><span id="l30.101" class="difflineminus">-  }</span>
<a href="#l30.102"></a><span id="l30.102" class="difflineminus">-</span>
<a href="#l30.103"></a><span id="l30.103" class="difflineminus">-  return rv;</span>
<a href="#l30.104"></a><span id="l30.104" class="difflineplus">+  array.forget(ppArray);</span>
<a href="#l30.105"></a><span id="l30.105" class="difflineplus">+  return NS_OK;</span>
<a href="#l30.106"></a><span id="l30.106"> }</span>
<a href="#l30.107"></a><span id="l30.107"> </span>
<a href="#l30.108"></a><span id="l30.108"> void ImportAddressImpl::ReportSuccess(nsString&amp; name, nsString *pStream,</span>
<a href="#l30.109"></a><span id="l30.109">                                       nsIStringBundle* pBundle)</span>
<a href="#l30.110"></a><span id="l30.110"> {</span>
<a href="#l30.111"></a><span id="l30.111">   if (!pStream)</span>
<a href="#l30.112"></a><span id="l30.112">     return;</span>
<a href="#l30.113"></a><span id="l30.113"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/import/vcard/src/nsVCardImport.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/import/vcard/src/nsVCardImport.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -12,16 +12,17 @@</span>
<a href="#l31.4"></a><span id="l31.4"> </span>
<a href="#l31.5"></a><span id="l31.5"> #include &quot;nscore.h&quot;</span>
<a href="#l31.6"></a><span id="l31.6"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l31.7"></a><span id="l31.7"> #include &quot;nsIFile.h&quot;</span>
<a href="#l31.8"></a><span id="l31.8"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l31.9"></a><span id="l31.9"> #include &quot;nsIImportAddressBooks.h&quot;</span>
<a href="#l31.10"></a><span id="l31.10"> #include &quot;nsIImportFieldMap.h&quot;</span>
<a href="#l31.11"></a><span id="l31.11"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l31.13"></a><span id="l31.13"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l31.14"></a><span id="l31.14"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l31.15"></a><span id="l31.15"> #include &quot;nsIFile.h&quot;</span>
<a href="#l31.16"></a><span id="l31.16"> #include &quot;nsImportStringBundle.h&quot;</span>
<a href="#l31.17"></a><span id="l31.17"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l31.18"></a><span id="l31.18"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l31.19"></a><span id="l31.19"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l31.20"></a><span id="l31.20"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineat">@@ -53,17 +54,17 @@ public:</span>
<a href="#l31.22"></a><span id="l31.22">   NS_IMETHOD GetAutoFind(PRUnichar **description, bool *_retval);</span>
<a href="#l31.23"></a><span id="l31.23"> </span>
<a href="#l31.24"></a><span id="l31.24">   NS_IMETHOD GetNeedsFieldMap(nsIFile *location, bool *_retval)</span>
<a href="#l31.25"></a><span id="l31.25">   { *_retval = false; return NS_OK;}</span>
<a href="#l31.26"></a><span id="l31.26"> </span>
<a href="#l31.27"></a><span id="l31.27">   NS_IMETHOD GetDefaultLocation(</span>
<a href="#l31.28"></a><span id="l31.28">       nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l31.29"></a><span id="l31.29"> </span>
<a href="#l31.30"></a><span id="l31.30" class="difflineminus">-  NS_IMETHOD FindAddressBooks(nsIFile *location, nsISupportsArray **_retval);</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineplus">+  NS_IMETHOD FindAddressBooks(nsIFile *location, nsIArray **_retval);</span>
<a href="#l31.32"></a><span id="l31.32"> </span>
<a href="#l31.33"></a><span id="l31.33">   NS_IMETHOD InitFieldMap(nsIImportFieldMap *fieldMap)</span>
<a href="#l31.34"></a><span id="l31.34">   { return NS_ERROR_FAILURE;}</span>
<a href="#l31.35"></a><span id="l31.35"> </span>
<a href="#l31.36"></a><span id="l31.36">   NS_IMETHOD ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l31.37"></a><span id="l31.37">                                nsIAddrDatabase *destination,</span>
<a href="#l31.38"></a><span id="l31.38">                                nsIImportFieldMap *fieldMap,</span>
<a href="#l31.39"></a><span id="l31.39">                                nsISupports *aSupportService,</span>
<a href="#l31.40"></a><span id="l31.40" class="difflineat">@@ -222,17 +223,17 @@ NS_IMETHODIMP ImportVCardAddressImpl::Ge</span>
<a href="#l31.41"></a><span id="l31.41"> </span>
<a href="#l31.42"></a><span id="l31.42">   *ppLoc = nullptr;</span>
<a href="#l31.43"></a><span id="l31.43">   *found = false;</span>
<a href="#l31.44"></a><span id="l31.44">   *userVerify = true;</span>
<a href="#l31.45"></a><span id="l31.45">   return NS_OK;</span>
<a href="#l31.46"></a><span id="l31.46"> }</span>
<a href="#l31.47"></a><span id="l31.47"> </span>
<a href="#l31.48"></a><span id="l31.48"> NS_IMETHODIMP ImportVCardAddressImpl::FindAddressBooks(</span>
<a href="#l31.49"></a><span id="l31.49" class="difflineminus">-    nsIFile *pLoc, nsISupportsArray **ppArray)</span>
<a href="#l31.50"></a><span id="l31.50" class="difflineplus">+    nsIFile *pLoc, nsIArray **ppArray)</span>
<a href="#l31.51"></a><span id="l31.51"> {</span>
<a href="#l31.52"></a><span id="l31.52">   NS_ENSURE_ARG_POINTER(pLoc);</span>
<a href="#l31.53"></a><span id="l31.53">   NS_ENSURE_ARG_POINTER(ppArray);</span>
<a href="#l31.54"></a><span id="l31.54"> </span>
<a href="#l31.55"></a><span id="l31.55">   *ppArray = nullptr;</span>
<a href="#l31.56"></a><span id="l31.56">   bool exists = false;</span>
<a href="#l31.57"></a><span id="l31.57">   nsresult rv = pLoc-&gt;Exists(&amp;exists);</span>
<a href="#l31.58"></a><span id="l31.58">   if (NS_FAILED(rv) || !exists)</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineat">@@ -241,20 +242,19 @@ NS_IMETHODIMP ImportVCardAddressImpl::Fi</span>
<a href="#l31.60"></a><span id="l31.60">   bool isFile = false;</span>
<a href="#l31.61"></a><span id="l31.61">   rv = pLoc-&gt;IsFile(&amp;isFile);</span>
<a href="#l31.62"></a><span id="l31.62">   if (NS_FAILED(rv) || !isFile)</span>
<a href="#l31.63"></a><span id="l31.63">     return NS_ERROR_FAILURE;</span>
<a href="#l31.64"></a><span id="l31.64"> </span>
<a href="#l31.65"></a><span id="l31.65">   m_fileLoc = do_QueryInterface(pLoc);</span>
<a href="#l31.66"></a><span id="l31.66">   </span>
<a href="#l31.67"></a><span id="l31.67">   /* Build an address book descriptor based on the file passed in! */</span>
<a href="#l31.68"></a><span id="l31.68" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; array;</span>
<a href="#l31.69"></a><span id="l31.69" class="difflineminus">-  rv = NS_NewISupportsArray(getter_AddRefs(array));</span>
<a href="#l31.70"></a><span id="l31.70" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; array(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l31.71"></a><span id="l31.71">   if (NS_FAILED(rv)) {</span>
<a href="#l31.72"></a><span id="l31.72" class="difflineminus">-    IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray\n&quot;);</span>
<a href="#l31.73"></a><span id="l31.73" class="difflineplus">+    IMPORT_LOG0(&quot;FAILED to allocate the nsIMutableArray\n&quot;);</span>
<a href="#l31.74"></a><span id="l31.74">     return rv;</span>
<a href="#l31.75"></a><span id="l31.75">   }</span>
<a href="#l31.76"></a><span id="l31.76"> </span>
<a href="#l31.77"></a><span id="l31.77">   nsString name;</span>
<a href="#l31.78"></a><span id="l31.78">   m_fileLoc-&gt;GetLeafName(name);</span>
<a href="#l31.79"></a><span id="l31.79">   if (NS_FAILED(rv)) {</span>
<a href="#l31.80"></a><span id="l31.80">     IMPORT_LOG0(&quot;*** Failed getting leaf name of file\n&quot;);</span>
<a href="#l31.81"></a><span id="l31.81">     return rv;</span>
<a href="#l31.82"></a><span id="l31.82" class="difflineat">@@ -276,26 +276,26 @@ NS_IMETHODIMP ImportVCardAddressImpl::Fi</span>
<a href="#l31.83"></a><span id="l31.83">   rv = impSvc-&gt;CreateNewABDescriptor(getter_AddRefs(desc));</span>
<a href="#l31.84"></a><span id="l31.84">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l31.85"></a><span id="l31.85">     int64_t sz = 0;</span>
<a href="#l31.86"></a><span id="l31.86">     pLoc-&gt;GetFileSize(&amp;sz);</span>
<a href="#l31.87"></a><span id="l31.87">     desc-&gt;SetPreferredName(name);</span>
<a href="#l31.88"></a><span id="l31.88">     desc-&gt;SetSize((uint32_t) sz);</span>
<a href="#l31.89"></a><span id="l31.89">     desc-&gt;SetAbFile(m_fileLoc);</span>
<a href="#l31.90"></a><span id="l31.90">     nsCOMPtr&lt;nsISupports&gt; pInterface(do_QueryInterface(desc, &amp;rv));</span>
<a href="#l31.91"></a><span id="l31.91" class="difflineminus">-    array-&gt;AppendElement(pInterface);</span>
<a href="#l31.92"></a><span id="l31.92" class="difflineplus">+    array-&gt;AppendElement(pInterface, false);</span>
<a href="#l31.93"></a><span id="l31.93">   }</span>
<a href="#l31.94"></a><span id="l31.94">   if (NS_FAILED(rv)) {</span>
<a href="#l31.95"></a><span id="l31.95">     IMPORT_LOG0(</span>
<a href="#l31.96"></a><span id="l31.96">         &quot;*** Error creating address book descriptor for vCard import\n&quot;);</span>
<a href="#l31.97"></a><span id="l31.97" class="difflineminus">-  } else {</span>
<a href="#l31.98"></a><span id="l31.98" class="difflineminus">-    array.swap(*ppArray);</span>
<a href="#l31.99"></a><span id="l31.99" class="difflineplus">+    return rv;</span>
<a href="#l31.100"></a><span id="l31.100">   }</span>
<a href="#l31.101"></a><span id="l31.101"> </span>
<a href="#l31.102"></a><span id="l31.102" class="difflineminus">-  return rv;</span>
<a href="#l31.103"></a><span id="l31.103" class="difflineplus">+  array.forget(ppArray);</span>
<a href="#l31.104"></a><span id="l31.104" class="difflineplus">+  return NS_OK;</span>
<a href="#l31.105"></a><span id="l31.105"> }</span>
<a href="#l31.106"></a><span id="l31.106"> </span>
<a href="#l31.107"></a><span id="l31.107"> void ImportVCardAddressImpl::ReportSuccess(</span>
<a href="#l31.108"></a><span id="l31.108">     nsString&amp; name, nsString *pStream, nsIStringBundle* pBundle)</span>
<a href="#l31.109"></a><span id="l31.109"> {</span>
<a href="#l31.110"></a><span id="l31.110">   if (!pStream)</span>
<a href="#l31.111"></a><span id="l31.111">     return;</span>
<a href="#l31.112"></a><span id="l31.112"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMImport.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMImport.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -54,18 +54,18 @@ public:</span>
<a href="#l32.4"></a><span id="l32.4">   // nsISupports interface</span>
<a href="#l32.5"></a><span id="l32.5">   NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l32.6"></a><span id="l32.6"> </span>
<a href="#l32.7"></a><span id="l32.7">   // nsIImportmail interface</span>
<a href="#l32.8"></a><span id="l32.8"> </span>
<a href="#l32.9"></a><span id="l32.9">   /* void GetDefaultLocation (out nsIFile location, out boolean found, out boolean userVerify); */</span>
<a href="#l32.10"></a><span id="l32.10">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l32.11"></a><span id="l32.11"> </span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  /* nsISupportsArray FindMailboxes (in nsIFile location); */</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-  NS_IMETHOD FindMailboxes(nsIFile *location, nsISupportsArray **_retval);</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+  /* nsIArray FindMailboxes (in nsIFile location); */</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+  NS_IMETHOD FindMailboxes(nsIFile *location, nsIArray **_retval);</span>
<a href="#l32.16"></a><span id="l32.16"> </span>
<a href="#l32.17"></a><span id="l32.17">   NS_IMETHOD ImportMailbox(nsIImportMailboxDescriptor *source,</span>
<a href="#l32.18"></a><span id="l32.18">                            nsIMsgFolder *dstFolder,</span>
<a href="#l32.19"></a><span id="l32.19">                            PRUnichar **pErrorLog, PRUnichar **pSuccessLog,</span>
<a href="#l32.20"></a><span id="l32.20">                            bool *fatalError);</span>
<a href="#l32.21"></a><span id="l32.21"> </span>
<a href="#l32.22"></a><span id="l32.22">   /* unsigned long GetImportProgress (); */</span>
<a href="#l32.23"></a><span id="l32.23">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l32.24"></a><span id="l32.24" class="difflineat">@@ -187,17 +187,17 @@ NS_IMETHODIMP ImportWMMailImpl::Translat</span>
<a href="#l32.25"></a><span id="l32.25"> </span>
<a href="#l32.26"></a><span id="l32.26"> NS_IMETHODIMP ImportWMMailImpl::GetDefaultLocation(nsIFile **ppLoc, bool *found,</span>
<a href="#l32.27"></a><span id="l32.27">                                                    bool *userVerify)</span>
<a href="#l32.28"></a><span id="l32.28"> {</span>
<a href="#l32.29"></a><span id="l32.29">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l32.30"></a><span id="l32.30"> }</span>
<a href="#l32.31"></a><span id="l32.31"> </span>
<a href="#l32.32"></a><span id="l32.32"> NS_IMETHODIMP ImportWMMailImpl::FindMailboxes(nsIFile *pLoc,</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineminus">-                                              nsISupportsArray **ppArray)</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineplus">+                                              nsIArray **ppArray)</span>
<a href="#l32.35"></a><span id="l32.35"> {</span>
<a href="#l32.36"></a><span id="l32.36">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l32.37"></a><span id="l32.37"> }</span>
<a href="#l32.38"></a><span id="l32.38"> </span>
<a href="#l32.39"></a><span id="l32.39"> void ImportWMMailImpl::AddLinebreak(nsString *pStream)</span>
<a href="#l32.40"></a><span id="l32.40"> {</span>
<a href="#l32.41"></a><span id="l32.41">   if (pStream)</span>
<a href="#l32.42"></a><span id="l32.42">     pStream-&gt;Append(PRUnichar('\n'));</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

