<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 2766:2c2aabae129ff678d0cbcb967562ee6b50241342</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 2c2aabae129ff678d0cbcb967562ee6b50241342" />
<meta property="og:url" content="/comm-central/rev/2c2aabae129ff678d0cbcb967562ee6b50241342" />
<meta property="og:description" content="Bug 495232 Drop support for the Palm Sync Extension. mailnews part. r=Mnyromyr,sr=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 2c2aabae129ff678d0cbcb967562ee6b50241342 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/2c2aabae129ff678d0cbcb967562ee6b50241342">shortlog</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/2c2aabae129ff678d0cbcb967562ee6b50241342">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/2c2aabae129ff678d0cbcb967562ee6b50241342">files</a> |
changeset |
<a href="/comm-central/raw-rev/2c2aabae129ff678d0cbcb967562ee6b50241342">raw</a>  | <a href="/comm-central/archive/2c2aabae129ff678d0cbcb967562ee6b50241342.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=495232">Bug 495232</a> Drop support for the Palm Sync Extension. mailnews part. r=Mnyromyr,sr=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 04 Jun 2009 08:56:52 +0100</td></tr>

<tr>
 <td>changeset 2766</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/2c2aabae129ff678d0cbcb967562ee6b50241342">2c2aabae129ff678d0cbcb967562ee6b50241342</a></td>
</tr>



<tr>
<td>parent 2765</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/61c769c3dd7bf16cdc2db6a369a09a14efd4b4d1">61c769c3dd7bf16cdc2db6a369a09a14efd4b4d1</a>
</td>
</tr>

<tr>
<td>child 2767</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3c14e195490cf85decc35553195fc9c89c43a714">3c14e195490cf85decc35553195fc9c89c43a714</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=2c2aabae129ff678d0cbcb967562ee6b50241342">2241</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 04 Jun 2009 07:58:17 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@dd584408d621 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=dd584408d62187ed1440b65178eac6ef461d198d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=dd584408d62187ed1440b65178eac6ef461d198d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=dd584408d62187ed1440b65178eac6ef461d198d&newProject=comm-central&newRevision=2c2aabae129ff678d0cbcb967562ee6b50241342&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=dd584408d62187ed1440b65178eac6ef461d198d&newProject=comm-central&newRevision=2c2aabae129ff678d0cbcb967562ee6b50241342&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=dd584408d62187ed1440b65178eac6ef461d198d&newProject=comm-central&newRevision=2c2aabae129ff678d0cbcb967562ee6b50241342&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Mnyromyr%29&revcount=50">Mnyromyr</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=495232">495232</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=495232">Bug 495232</a> Drop support for the Palm Sync Extension. mailnews part. r=Mnyromyr,sr=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/Makefile.in">mailnews/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/Makefile.in">file</a> |
<a href="/comm-central/annotate/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/Makefile.in">annotate</a> |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/Makefile.in">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/Makefile.in">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/addrbook/src/Makefile.in">mailnews/addrbook/src/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/addrbook/src/Makefile.in">file</a> |
<a href="/comm-central/annotate/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/addrbook/src/Makefile.in">annotate</a> |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/addrbook/src/Makefile.in">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/addrbook/src/Makefile.in">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/addrbook/src/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/Makefile.in">mailnews/extensions/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/Makefile.in">file</a> |
<a href="/comm-central/annotate/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/Makefile.in">annotate</a> |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/Makefile.in">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/Makefile.in">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/Makefile.in">mailnews/extensions/palmsync/Makefile.in</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/Makefile.in">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/Makefile.in">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/IPalmSync.idl">mailnews/extensions/palmsync/build/IPalmSync.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/IPalmSync.idl">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/IPalmSync.idl">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/IPalmSync.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/Makefile.in">mailnews/extensions/palmsync/build/Makefile.in</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/PalmSyncProxy.def">mailnews/extensions/palmsync/build/PalmSyncProxy.def</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/PalmSyncProxy.def">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/PalmSyncProxy.def">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/build/PalmSyncProxy.def">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/Makefile.in">mailnews/extensions/palmsync/conduit/Makefile.in</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/Makefile.in">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/Makefile.in">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.cpp">mailnews/extensions/palmsync/conduit/MozABConduitGenCond.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.h">mailnews/extensions/palmsync/conduit/MozABConduitGenCond.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.rc">mailnews/extensions/palmsync/conduit/MozABConduitGenCond.rc</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.rc">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.rc">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.rc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitRecord.cpp">mailnews/extensions/palmsync/conduit/MozABConduitRecord.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitRecord.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitRecord.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitRecord.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitRecord.h">mailnews/extensions/palmsync/conduit/MozABConduitRecord.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitRecord.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitRecord.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitRecord.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitSync.cpp">mailnews/extensions/palmsync/conduit/MozABConduitSync.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitSync.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitSync.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitSync.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitSync.h">mailnews/extensions/palmsync/conduit/MozABConduitSync.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitSync.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitSync.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABConduitSync.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABHHManager.cpp">mailnews/extensions/palmsync/conduit/MozABHHManager.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABHHManager.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABHHManager.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABHHManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABHHManager.h">mailnews/extensions/palmsync/conduit/MozABHHManager.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABHHManager.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABHHManager.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABHHManager.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABPCManager.cpp">mailnews/extensions/palmsync/conduit/MozABPCManager.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABPCManager.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABPCManager.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABPCManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABPCManager.h">mailnews/extensions/palmsync/conduit/MozABPCManager.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABPCManager.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABPCManager.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/MozABPCManager.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/install.js">mailnews/extensions/palmsync/conduit/install.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/install.js">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/install.js">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/install.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/DoNothing.bmp">mailnews/extensions/palmsync/conduit/res/DoNothing.bmp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/DoNothing.bmp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/DoNothing.bmp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/DoNothing.bmp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/HhToPc.bmp">mailnews/extensions/palmsync/conduit/res/HhToPc.bmp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/HhToPc.bmp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/HhToPc.bmp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/HhToPc.bmp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/PcToHh.bmp">mailnews/extensions/palmsync/conduit/res/PcToHh.bmp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/PcToHh.bmp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/PcToHh.bmp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/PcToHh.bmp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/Synchronize.bmp">mailnews/extensions/palmsync/conduit/res/Synchronize.bmp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/Synchronize.bmp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/Synchronize.bmp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/res/Synchronize.bmp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/resource.h">mailnews/extensions/palmsync/conduit/resource.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/resource.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/resource.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/conduit/resource.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/install.rdf">mailnews/extensions/palmsync/install.rdf</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/install.rdf">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/install.rdf">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/install.rdf">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/Makefile.in">mailnews/extensions/palmsync/installer/Makefile.in</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/Makefile.in">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/Makefile.in">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/PalmSyncInstall.cpp">mailnews/extensions/palmsync/installer/PalmSyncInstall.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/PalmSyncInstall.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/PalmSyncInstall.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/PalmSyncInstall.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/PalmSyncInstall.rc">mailnews/extensions/palmsync/installer/PalmSyncInstall.rc</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/PalmSyncInstall.rc">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/PalmSyncInstall.rc">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/PalmSyncInstall.rc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/install.ico">mailnews/extensions/palmsync/installer/install.ico</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/install.ico">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/install.ico">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/install.ico">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/resource.h">mailnews/extensions/palmsync/installer/resource.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/resource.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/resource.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/resource.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/uninstall.ico">mailnews/extensions/palmsync/installer/uninstall.ico</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/uninstall.ico">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/uninstall.ico">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/installer/uninstall.ico">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/palmsync.js">mailnews/extensions/palmsync/palmsync.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/palmsync.js">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/palmsync.js">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/palmsync.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/public/Makefile.in">mailnews/extensions/palmsync/public/Makefile.in</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/public/Makefile.in">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/public/Makefile.in">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/public/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/public/nsIPalmSyncSupport.idl">mailnews/extensions/palmsync/public/nsIPalmSyncSupport.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/public/nsIPalmSyncSupport.idl">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/public/nsIPalmSyncSupport.idl">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/public/nsIPalmSyncSupport.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Makefile.in">mailnews/extensions/palmsync/src/Makefile.in</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Makefile.in">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Makefile.in">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncFactory.cpp">mailnews/extensions/palmsync/src/PalmSyncFactory.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncFactory.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncFactory.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncFactory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncFactory.h">mailnews/extensions/palmsync/src/PalmSyncFactory.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncFactory.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncFactory.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncFactory.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncImp.cpp">mailnews/extensions/palmsync/src/PalmSyncImp.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncImp.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncImp.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncImp.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncImp.h">mailnews/extensions/palmsync/src/PalmSyncImp.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncImp.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncImp.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/PalmSyncImp.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Registry.cpp">mailnews/extensions/palmsync/src/Registry.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Registry.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Registry.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Registry.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Registry.h">mailnews/extensions/palmsync/src/Registry.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Registry.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Registry.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/Registry.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbIPCCard.cpp">mailnews/extensions/palmsync/src/nsAbIPCCard.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbIPCCard.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbIPCCard.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbIPCCard.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbIPCCard.h">mailnews/extensions/palmsync/src/nsAbIPCCard.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbIPCCard.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbIPCCard.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbIPCCard.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbPalmSync.cpp">mailnews/extensions/palmsync/src/nsAbPalmSync.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbPalmSync.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbPalmSync.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbPalmSync.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbPalmSync.h">mailnews/extensions/palmsync/src/nsAbPalmSync.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbPalmSync.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbPalmSync.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsAbPalmSync.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsPalmSyncSupport.cpp">mailnews/extensions/palmsync/src/nsPalmSyncSupport.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsPalmSyncSupport.cpp">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsPalmSyncSupport.cpp">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsPalmSyncSupport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsPalmSyncSupport.h">mailnews/extensions/palmsync/src/nsPalmSyncSupport.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsPalmSyncSupport.h">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsPalmSyncSupport.h">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/extensions/palmsync/src/nsPalmSyncSupport.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/test/performance/common/mailnewsTestPrefs.js">mailnews/test/performance/common/mailnewsTestPrefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/test/performance/common/mailnewsTestPrefs.js">file</a> |
<a href="/comm-central/annotate/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/test/performance/common/mailnewsTestPrefs.js">annotate</a> |
<a href="/comm-central/diff/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/test/performance/common/mailnewsTestPrefs.js">diff</a> |
<a href="/comm-central/comparison/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/test/performance/common/mailnewsTestPrefs.js">comparison</a> |
<a href="/comm-central/log/2c2aabae129ff678d0cbcb967562ee6b50241342/mailnews/test/performance/common/mailnewsTestPrefs.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/Makefile.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/Makefile.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -39,20 +39,17 @@ DEPTH		= ..</span>
<a href="#l1.4"></a><span id="l1.4"> topsrcdir	= @top_srcdir@</span>
<a href="#l1.5"></a><span id="l1.5"> srcdir		= @srcdir@</span>
<a href="#l1.6"></a><span id="l1.6"> VPATH		= @srcdir@</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> MODULE       = mailnews</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-PARALLEL_DIRS	+= base/search/src db/msgdb db/gloda news local mime compose imap addrbook import</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-# extensions (e.g. palmsync) can depend of things built in other dirs</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-DIRS	+= extensions</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+PARALLEL_DIRS	+= base/search/src db/msgdb db/gloda news local mime compose imap addrbook import extensions</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l1.19"></a><span id="l1.19"> ifndef GNU_CC</span>
<a href="#l1.20"></a><span id="l1.20"> PARALLEL_DIRS	+= mapi/mapiDLL mapi/mapihook</span>
<a href="#l1.21"></a><span id="l1.21"> endif</span>
<a href="#l1.22"></a><span id="l1.22"> endif</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24"> ifdef MOZ_STATIC_MAIL_BUILD</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/src/Makefile.in</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/src/Makefile.in</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -107,17 +107,16 @@ CPPSRCS		= \</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> EXTRA_COMPONENTS += \</span>
<a href="#l2.6"></a><span id="l2.6"> 		nsAbLDAPAttributeMap.js \</span>
<a href="#l2.7"></a><span id="l2.7"> 		nsAbAutoCompleteMyDomain.js \</span>
<a href="#l2.8"></a><span id="l2.8"> 		nsAbAutoCompleteSearch.js \</span>
<a href="#l2.9"></a><span id="l2.9"> 		$(NULL)</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> EXPORTS		= \</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-		nsAbCardProperty.h \</span>
<a href="#l2.13"></a><span id="l2.13">                 nsVCardObj.h \</span>
<a href="#l2.14"></a><span id="l2.14"> 		$(NULL)</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l2.17"></a><span id="l2.17"> ifndef GNU_CC</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19"> CPPSRCS		+= \</span>
<a href="#l2.20"></a><span id="l2.20"> 		nsAbOutlookDirFactory.cpp \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/extensions/Makefile.in</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/extensions/Makefile.in</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -48,14 +48,10 @@ PARALLEL_DIRS	= mdn mailviews bayesian-s</span>
<a href="#l3.4"></a><span id="l3.4"> ifdef MOZ_PSM</span>
<a href="#l3.5"></a><span id="l3.5"> BUILD_SMIME=1</span>
<a href="#l3.6"></a><span id="l3.6"> endif</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> ifdef BUILD_SMIME</span>
<a href="#l3.9"></a><span id="l3.9"> PARALLEL_DIRS	+= smime</span>
<a href="#l3.10"></a><span id="l3.10"> endif</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-ifdef BUILD_PALMSYNC</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-PARALLEL_DIRS	+= palmsync</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-endif</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-</span>
<a href="#l3.16"></a><span id="l3.16"> include $(topsrcdir)/config/rules.mk</span>
<a href="#l3.17"></a><span id="l3.17"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">deleted file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- a/mailnews/extensions/palmsync/Makefile.in</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ /dev/null</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -1,81 +0,0 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineminus">-#</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">-#</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-#</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-# License.</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-#</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-#</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-#</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-#</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-#</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-DEPTH		= ../../..</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-topsrcdir	= @top_srcdir@</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-srcdir		= @srcdir@</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-VPATH		= @srcdir@</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-include $(DEPTH)/config/autoconf.mk</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-MODULE			= palmsync</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-XPI_NAME		= palmsync</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-USE_EXTENSION_MANIFEST	= 1</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-# make this id as short as possible due to a bug with the palm deskop and long path names.</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-# Change installer/Makefile.in and nsPalmSyncSupport.cpp if this changes.</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-INSTALL_EXTENSION_ID	= p@m</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-XPI_PKGNAME		= palmsync-$(MOZ_APP_VERSION)</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-DIST_FILES 		= install.rdf</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-DIRS	= build public src installer</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-PREF_JS_EXPORTS = $(srcdir)/palmsync.js</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-ifdef MOZILLA_1_9_1_BRANCH</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-THUNDERBIRD_VERSION := $(shell cat $(topsrcdir)/mail/config/version-191.txt)</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-else</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-THUNDERBIRD_VERSION := $(shell cat $(topsrcdir)/mail/config/version.txt)</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-endif</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineminus">-SEAMONKEY_VERSION := $(shell cat $(topsrcdir)/suite/config/version.txt)</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-XULAPP_DEFINES = \</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-	-DINSTALL_EXTENSION_ID=$(INSTALL_EXTENSION_ID) \</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-	-DTHUNDERBIRD_VERSION=$(THUNDERBIRD_VERSION) \</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-	-DSEAMONKEY_VERSION=$(SEAMONKEY_VERSION) \</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-	-DEXTENSION_VERSION=$(MOZILLA_VERSION) \</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-	$(NULL)</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-ifdef PALM_CDK_DIR</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-DIRS		+= conduit</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-else</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-libs::</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-	@echo &quot; &quot;</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-	@echo &quot;PLEASE SET 'PALM_CDK_DIR' ENV VARIABLE to THE DIR WHERE YOU HAVE PALM CDK INSTALLED IF YOU WANT TO BUILD THE CONDUIT&quot;</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-	@echo &quot; &quot;</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-endif</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">deleted file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- a/mailnews/extensions/palmsync/build/IPalmSync.idl</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ /dev/null</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -1,168 +0,0 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">- *</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">- *</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">- * License.</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">- *</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">- * The Original Code is Mozilla</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">- *</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">- * Netscape Communications Corp.</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">- *</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">- * Contributor(s): Rajiv Dayal (rdayal@netscape.com)</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">- *</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">- *</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-// This idl will be compiled by MIDL.  MS-COM is used </span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-// as brdige between MAPI clients and the Mozilla.</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-import &quot;unknwn.idl&quot;;</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineminus">-</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-// this is defined so that we can return an array of strings(i.e array of AB Description strings)</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-typedef struct</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-{</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-	LPTSTR lpszABName;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-  LPTSTR lpszABUrl;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-}nsMozABDesc, *lpnsMozABDesc;</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-const int kFirstTimeSyncDirFlag = 0x1;</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-const int kIsPabDirFlag = 0x2;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-// This structure defines the data fields for MozAB based on &quot;nsIAbCard.idl&quot;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-// This structure is used for interaction with the other AddressBook Apps</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-// nsIAbCard changes should be reflected here to take care of those changes</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-// Take care when converting nsIAbCard to this struct</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-typedef struct</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-{</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-    unsigned long   dwRecordId; // remote record Id for this card</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-    unsigned long   dwCategoryId; // remote category Id for this card</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-	unsigned long   dwStatus; // change status for this card</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-	// standard AB fields for this card</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-    LPTSTR          firstName;</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-    LPTSTR          lastName;</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-    LPTSTR          displayName;</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-    LPTSTR          nickName;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-    LPTSTR          primaryEmail;</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-    LPTSTR          secondEmail;</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-    LPTSTR          workPhone;</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-    LPTSTR          homePhone;</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-    LPTSTR          faxNumber;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-    LPTSTR          pagerNumber;</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-    LPTSTR          cellularNumber;</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-    LPTSTR          homeAddress;</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-    LPTSTR          homeAddress2;</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-    LPTSTR          homeCity;</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-    LPTSTR          homeState;</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-    LPTSTR          homeZipCode;</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-    LPTSTR          homeCountry;</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-    LPTSTR          workAddress;</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-    LPTSTR          workAddress2;</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-    LPTSTR          workCity;</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-    LPTSTR          workState;</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-    LPTSTR          workZipCode;</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-    LPTSTR          workCountry;</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-    LPTSTR          jobTitle;</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-    LPTSTR          department;</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-    LPTSTR          company;</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-    /**</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-     * webPage1 is work web page</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-     */</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-    LPTSTR          webPage1;</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineminus">-    /**</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineminus">-     * webPage2 is home web page</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineminus">-     */</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-    LPTSTR          webPage2;</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineminus">-    LPTSTR          birthYear;</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-    LPTSTR          birthMonth;</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-    LPTSTR          birthDay;</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-    LPTSTR          custom1;</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-    LPTSTR          custom2;</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-    LPTSTR          custom3;</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-    LPTSTR          custom4;</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineminus">-    LPTSTR          notes;</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineminus">-    unsigned long   lastModifiedDate;</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineminus">-	unsigned long   addressToUse; // home, work, ... </span>
<a href="#l5.111"></a><span id="l5.111" class="difflineminus">-    unsigned long   preferredPhoneNum; // this is displayed in the contact list</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineminus">-    unsigned long   preferMailFormat;</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineminus">-    boolean         isMailList;</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineminus">-    /**</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineminus">-     * If isMailList is true then mailListURI</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineminus">-     * will contain the URI of the associated</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineminus">-     * mail list</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineminus">-     */</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineminus">-    LPSTR           mailListURI;</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineminus">-}nsABCOMCardStruct, *lpnsABCOMCardStruct;</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineminus">-</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineminus">-[</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineminus">-    object,</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineminus">-    uuid(C8CE6FC1-CCF1-11d6-B8A5-000064657374),</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineminus">-    helpstring(&quot;nsIPalmSync Inteface&quot;),</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineminus">-    pointer_default(unique)</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineminus">-]</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineminus">-</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineminus">-interface IPalmSync : IUnknown</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineminus">-{</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineminus">-    HRESULT IsValid();</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineminus">-</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-    // Get the list of Address Books for the currently logged in user profile</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-    HRESULT nsGetABList([in] BOOL aIsUnicode, [out] short * aABListCount,</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineminus">-						[out, size_is(, *aABListCount)] lpnsMozABDesc * aABList,</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-						[out, size_is(, *aABListCount)] long ** aABCatIndexList,</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-						[out, size_is(, *aABListCount)] BOOL ** aFirstTimeSyncList);</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineminus">-</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-    // Synchronize the Address Book represented by the aCategoryIndex and the corresponding aABName in Mozilla</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineminus">-    // this will take care of ABs existing on both ends.</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineminus">-    HRESULT nsSynchronizeAB([in] BOOL aIsUnicode, [in] long aCategoryIndex, [in] long aCategoryId, [in] LPTSTR aABName,</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-                        [in] int aModRemoteRecCount, [in, size_is(aModRemoteRecCount)] lpnsABCOMCardStruct aModRemoteRecList,</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineminus">-                        [out] int * aModMozRecCount, [out, size_is(, *aModMozRecCount)] lpnsABCOMCardStruct * aModMozRecList);</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineminus">-</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineminus">-    // All records from a AB represented by aCategoryIndex and aABName into a new or existing Mozilla AB</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineminus">-    HRESULT nsAddAllABRecords([in] BOOL aIsUnicode, [in] BOOL aReplaceExisting, [in] long aCategoryIndex, [in] LPTSTR aABName,</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineminus">-							[in] int aRemoteRecCount, [in, size_is(aRemoteRecCount)] lpnsABCOMCardStruct aRemoteRecList);</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineminus">-</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-    // Get All records from a Mozilla AB</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-    HRESULT nsGetAllABCards([in] BOOL aIsUnicode, [in] long aCategoryIndex, [in] LPTSTR aABName,</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineminus">-                        [out] int * aMozRecCount, [out, size_is(, *aMozRecCount)] lpnsABCOMCardStruct * aMozRecList);</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineminus">-</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineminus">-    // Send an ack for done and update the palm rec id for new records added</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineminus">-    HRESULT nsAckSyncDone([in] BOOL aIsSuccess, [in] long aCatIndex, [in] int aNewRecCount, [in, size_is(aNewRecCount)] unsigned long * aNewPalmRecIDList);</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineminus">-</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineminus">-    // Update the Address Book's category id and mod time.</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineminus">-    HRESULT nsUpdateABSyncInfo([in] BOOL aIsUnicode, [in] long aCategoryIndex, [in] LPTSTR aABName);</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineminus">-</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineminus">-    // Delete an addressbook</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineminus">-    HRESULT nsDeleteAB([in] BOOL aIsUnicode, [in] long aCategoryIndex, [in] LPTSTR aABName, [in] LPTSTR aABUrl);</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineminus">-</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineminus">-    // was this address book deleted in Mozilla?</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineminus">-    HRESULT nsGetABDeleted([in] LPTSTR aABName, [out] BOOL *abDeleted);</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineminus">-</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineminus">-    // Rename an addressbook</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineminus">-    HRESULT nsRenameAB([in] BOOL aIsUnicode, [in] long aCategoryIndex, [in] LPTSTR aABName, [in] LPTSTR aABUrl);</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineminus">-</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineminus">-    HRESULT nsUseABHomeAddressForPalmAddress ([out] BOOL *useHomeAddress);</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineminus">-</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineminus">-    HRESULT nsPreferABHomePhoneForPalmPhone ([out] BOOL * preferHomePhone);</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineminus">-};</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">deleted file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- a/mailnews/extensions/palmsync/build/Makefile.in</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ /dev/null</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -1,89 +0,0 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineminus">-#</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">-#</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-#</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-# License.</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-#</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-#</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-#</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-#</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-#</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-DEPTH		= ../../../..</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-topsrcdir	= @top_srcdir@</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineminus">-srcdir		= @srcdir@</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">-VPATH		= @srcdir@</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineminus">-</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineminus">-include $(DEPTH)/config/autoconf.mk</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-MODULE		= PalmSyncProxy</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-LIBRARY_NAME	= $(MODULE)</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-DEFFILE		= $(win_srcdir)/PalmSyncProxy.def</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-ifndef MOZ_INCOMPLETE_EXTERNAL_LINKAGE</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-MOZILLA_INTERNAL_API = 1</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineminus">-endif</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineminus">-USE_STATIC_LIBS = 1</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-XPI_NAME	= palmsync</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineminus">-EXPORTS		= IPalmSync.h</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineminus">-CSRCS		= \</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-		dlldata.c \</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-		IPalmSync_p.c \</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-		IPalmSync_i.c \</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-		$(NULL)</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-OS_LIBS		+= rpcrt4.lib</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-MIDL_GENERATED_FILES = IPalmSync.h IPalmSync_p.c IPalmSync_i.c dlldata.c</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-SRCDIR_CSRCS	= $(addprefix $(srcdir)/,$(CSRCS))</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-GARBAGE	+= $(MIDL_GENERATED_FILES) done_gen $(CSRCS) $(SRCDIR_CSRCS)</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-LOCAL_INCLUDES	= -I.</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">-# Force use of PIC</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineminus">-FORCE_USE_PIC	= 1 </span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-FORCE_SHARED_LIB = 1</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-SRCS_IN_OBJDIR	= 1</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-include $(topsrcdir)/config/rules.mk</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-DEFINES += -DREGISTER_PROXY_DLL -DUNICODE -D_UNICODE</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-$(MIDL_GENERATED_FILES): done_gen</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-done_gen: IPalmSync.idl</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineminus">-	$(RM) $(SRCDIR_CSRCS)</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-	$(MIDL) $(MIDL_FLAGS) -Oic $(UNICODE_FLAGS) $(srcdir)/IPalmSync.idl</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineminus">-	touch $@</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineminus">-</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineminus">-export:: done_gen</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineminus">-</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">deleted file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- a/mailnews/extensions/palmsync/build/PalmSyncProxy.def</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ /dev/null</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -1,47 +0,0 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineminus">-; ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineminus">-; Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineminus">-;</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineminus">-; The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineminus">-; 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineminus">-; the License. You may obtain a copy of the License at</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineminus">-; http://www.mozilla.org/MPL/</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-; Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-; WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-; for the specific language governing rights and limitations under the</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-; License.</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-;</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-; The Original Code is Mozilla.</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-;</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-; The Initial Developer of the Original Code is</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-; Netscape Communications Corp.</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">-; Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineminus">-; the Initial Developer. All Rights Reserved.</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-;</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-; Contributor(s):  Rajiv Dayal (rdayal@netscape.com)</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineminus">-;</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">-; Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-; either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-; the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-; in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-; of those above. If you wish to allow use of your version of this file only</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-; under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-; use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-; decision by deleting the provisions above and replace them with the notice</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-; and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-; the provisions above, a recipient may use your version of this file under</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-; the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-;</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">-; ***** END LICENSE BLOCK ***** </span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineminus">-LIBRARY         PalmSyncProxy.dll</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineminus">-DESCRIPTION     'Proxy/Stub DLL'</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineminus">-</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineminus">-EXPORTS</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-                DllGetClassObject   @1  PRIVATE</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-                DllCanUnloadNow     @2  PRIVATE</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineminus">-                GetProxyDllInfo     @3  PRIVATE</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-                DllRegisterServer   @4  PRIVATE</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineminus">-                DllUnregisterServer @5  PRIVATE</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">deleted file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/Makefile.in</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ /dev/null</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -1,86 +0,0 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineminus">-#</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineminus">-#</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-#</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-# License.</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-#</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-#</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-#</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-#</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-#</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-DEPTH		= ../../../..</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-topsrcdir	= @top_srcdir@</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-srcdir		= @srcdir@</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-VPATH		= @srcdir@</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-PALM_CDK_INC	= $(PALM_CDK_DIR)/C++/Include</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-PALM_CDK_LIB	= $(PALM_CDK_DIR)/C++/Lib</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-PALM_PFC_INC	= $(PALM_CDK_DIR)/C++/Pfc/include</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-PALM_PFC_SRC	= $(PALM_CDK_DIR)/C++/Pfc/Src</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-PALM_CDK_BIN    = $(PALM_CDK_DIR)/Common/Bin</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-include $(DEPTH)/config/autoconf.mk</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-MODULE		= mozABConduit</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-EXPORT_LIBRARY	= $(MODULE)</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineminus">-LIBRARY_NAME	= $(MODULE)</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineminus">-RESFILE         = MozABConduitGenCond.res</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-USE_STATIC_LIBS = 1</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-XPI_NAME	= palmsync</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineminus">-REQUIRES	= PalmSyncProxy \</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-		  $(NULL)</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-CPPSRCS		= MozABConduitGenCond.cpp \</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-		  MozABConduitRecord.cpp \</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-		  MozABConduitSync.cpp \</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-		  MozABHHManager.cpp \</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-		  MozABPCManager.cpp \</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-		  $(NULL)</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-LOCAL_INCLUDES += -I$(PALM_CDK_INC) \</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineminus">-		  -I$(PALM_PFC_INC) \</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-		  -I$(PALM_PFC_SRC) \</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineminus">-		   $(NULL)</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">-</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-EXTRA_DSO_LDOPTS = \</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineminus">-		   $(PALM_CDK_LIB)/sync20.$(LIB_SUFFIX) \</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-		   $(PALM_CDK_LIB)/palmcmn.$(LIB_SUFFIX) \</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-       $(PALM_CDK_LIB)/hslog20.$(LIB_SUFFIX) \</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-		   $(NULL)</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineminus">-</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-OS_LIBS		+= ole32.lib comctl32.lib</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">-</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">-# Force use of PIC</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">-FORCE_USE_PIC	= 1 </span>
<a href="#l8.87"></a><span id="l8.87" class="difflineminus">-FORCE_SHARED_LIB = 1</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineminus">-</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineminus">-include $(topsrcdir)/config/rules.mk</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">deleted file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ /dev/null</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -1,494 +0,0 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineminus">-/***************************************************************************</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineminus">- *</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineminus">- * EXPORTED FUNCTIONS Conduit Entry Points Source File</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineminus">- *</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineminus">- **************************************************************************/</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">-#define STRICT 1</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineminus">-#define ASSERT(f)          ((void)0)</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-#define TRACE0(sz)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-#define TRACE(sz)</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-#include &lt;malloc.h&gt;</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-#include &lt;CPalmRec.cpp&gt;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-#include &lt;CPString.cpp&gt;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-#include &lt;CPCatgry.cpp&gt;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-#include &lt;stdio.h&gt;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-#ifdef METROWERKS_WIN</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">-#include &lt;wmem.h&gt;</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">-#else</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-#include &lt;memory.h&gt;</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-#endif</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-#include &lt;sys/stat.h&gt;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-#include &lt;TCHAR.H&gt;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-#include &lt;COMMCTRL.H&gt;</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineminus">-#include &lt;syncmgr.h&gt;</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-#include &quot;MozABConduitGenCond.h&quot;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">-#include &lt;logstrng.h&gt;</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">-</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-// TODO - Include custom sync header</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-#include &lt;PALM_CMN.H&gt;</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineminus">-#define CONDUIT_NAME &quot;MozABConduit&quot;</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineminus">-#include &quot;MozABConduitSync.h&quot;</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineminus">-</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineminus">-HANDLE hLangInstance;</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineminus">-HANDLE hAppInstance;</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineminus">-extern HANDLE hLangInstance;</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-extern HANDLE hAppInstance;</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-long CALLBACK CondCfgDlgProc(HWND hWnd, UINT Message, WPARAM wParam, </span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">-                             LPARAM lParam);</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">-void LdCfgDlgBmps(HWND hDlg);</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">-</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-//</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineminus">-//</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineminus">-//     Function:        DllMain()</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineminus">-//</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineminus">-//     Description:    main entry point to the MozABConduitProto component</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineminus">-//</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-//     Parameters:    hInstance - instance handle of the DLL</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineminus">-//                    dwReason  - why the entry point was called</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineminus">-//                    lpReserved - reserved</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">-//</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineminus">-//     Returns:        1 if okay</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-//</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineminus">-#ifndef _68K_</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineminus">-</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineminus">-static int iTerminationCount = 0;</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineminus">-</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-DWORD tId = 0;</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineminus">-</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineminus">-</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineminus">-extern &quot;C&quot; int APIENTRY</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineminus">-DllMain(HINSTANCE hInstance, DWORD dwReason, LPVOID lpReserved)</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineminus">-{</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">-</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineminus">-</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineminus">-    if (dwReason == DLL_PROCESS_ATTACH)</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-    {</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">-        TRACE0(&quot;EXPORTED FUNCTIONS Initializing!\n&quot;);</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-        </span>
<a href="#l9.86"></a><span id="l9.86" class="difflineminus">-        if (!iTerminationCount ) {</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineminus">-            hAppInstance = hInstance;</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineminus">-            // use PalmLoadLanguage here to load different languages</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineminus">-            hLangInstance = hInstance;</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineminus">-        }</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineminus">-        ++iTerminationCount;</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineminus">-</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineminus">-        tId = TlsAlloc();</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineminus">-        if (tId == 0xFFFFFFFF)</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineminus">-            return FALSE;</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineminus">-    }</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineminus">-    else if (dwReason == DLL_PROCESS_DETACH)</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineminus">-    {</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineminus">-        TRACE0(&quot;EXPORTED FUNCTIONS Terminating!\n&quot;);</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineminus">-</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineminus">-        --iTerminationCount;</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineminus">-        if (!iTerminationCount ) {</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineminus">-            // use PalmFreeLanguage here to unload different languages</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineminus">-        }</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineminus">-        TlsFree(tId);</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineminus">-    }</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineminus">-    return 1;   // ok</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineminus">-}</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineminus">-#endif</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineminus">-</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineminus">-</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineminus">-//</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineminus">-//</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineminus">-//     Function:        OpenConduit()</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineminus">-//</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineminus">-//     Description:  Extern &quot;C&quot; entry point into this conduit which starts </span>
<a href="#l9.119"></a><span id="l9.119" class="difflineminus">-//                   the process of synchronizing the local database table </span>
<a href="#l9.120"></a><span id="l9.120" class="difflineminus">-//                   with a remote conterpart residing on the remote view </span>
<a href="#l9.121"></a><span id="l9.121" class="difflineminus">-//                   device. </span>
<a href="#l9.122"></a><span id="l9.122" class="difflineminus">-//</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineminus">-//     Parameters:   Pointer to a callback function used to report progress.</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineminus">-//                    </span>
<a href="#l9.125"></a><span id="l9.125" class="difflineminus">-//                </span>
<a href="#l9.126"></a><span id="l9.126" class="difflineminus">-//</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineminus">-//     Returns:        </span>
<a href="#l9.128"></a><span id="l9.128" class="difflineminus">-//</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineminus">-ExportFunc long OpenConduit(PROGRESSFN pFn, CSyncProperties&amp; rProps)</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineminus">-{</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineminus">-    long retval = -1;</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineminus">-    if (pFn)</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineminus">-    {</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineminus">-       CMozABConduitSync * pABSync = new CMozABConduitSync(rProps);</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineminus">-        if (pABSync)</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineminus">-		{</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineminus">-            retval = pABSync-&gt;Perform();</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineminus">-            delete pABSync;</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineminus">-        }</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineminus">-    }</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineminus">-    return(retval);</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineminus">-}</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineminus">-</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineminus">-//</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineminus">-//</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineminus">-//       Function:              GetConduitName()</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineminus">-//</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineminus">-//       Description:  Extern &quot;C&quot; entry point into this conduit which returns</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineminus">-//                                the name to be used when display messages </span>
<a href="#l9.153"></a><span id="l9.153" class="difflineminus">-//                                regarding this conduit.</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineminus">-//</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineminus">-//       Parameters:   pszName - buffer in which to place the name</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineminus">-//                                 nLen - maximum number of bytes of buffer     </span>
<a href="#l9.157"></a><span id="l9.157" class="difflineminus">-//                                      </span>
<a href="#l9.158"></a><span id="l9.158" class="difflineminus">-//                              </span>
<a href="#l9.159"></a><span id="l9.159" class="difflineminus">-//</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineminus">-//       Returns:          -1 indicates erros</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineminus">-//</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineminus">-ExportFunc long GetConduitName(char* pszName,WORD nLen)</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineminus">-{</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineminus">-    strncpy(pszName,CONDUIT_NAME, nLen-1);   </span>
<a href="#l9.166"></a><span id="l9.166" class="difflineminus">-    *(pszName+nLen-1) = '\0';</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineminus">-</span>
<a href="#l9.168"></a><span id="l9.168" class="difflineminus">-    return 0;</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineminus">-}</span>
<a href="#l9.170"></a><span id="l9.170" class="difflineminus">-</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineminus">-//</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineminus">-//</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineminus">-//       Function:     GetConduitVersion()</span>
<a href="#l9.176"></a><span id="l9.176" class="difflineminus">-//</span>
<a href="#l9.177"></a><span id="l9.177" class="difflineminus">-//       Description:  Extern &quot;C&quot; entry point into this conduit which returns</span>
<a href="#l9.178"></a><span id="l9.178" class="difflineminus">-//                     the conduits version</span>
<a href="#l9.179"></a><span id="l9.179" class="difflineminus">-//</span>
<a href="#l9.180"></a><span id="l9.180" class="difflineminus">-//       Parameters:   none</span>
<a href="#l9.181"></a><span id="l9.181" class="difflineminus">-//</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineminus">-//       Returns:      DWORD indicating major and minor version number</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineminus">-//                        HIWORD - reserved</span>
<a href="#l9.184"></a><span id="l9.184" class="difflineminus">-//                        HIBYTE(LOWORD) - major number</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineminus">-//                        LOBYTE(LOWORD) - minor number</span>
<a href="#l9.186"></a><span id="l9.186" class="difflineminus">-//</span>
<a href="#l9.187"></a><span id="l9.187" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineminus">-ExportFunc DWORD GetConduitVersion()</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineminus">-{</span>
<a href="#l9.190"></a><span id="l9.190" class="difflineminus">-    return GENERIC_CONDUIT_VERSION;</span>
<a href="#l9.191"></a><span id="l9.191" class="difflineminus">-}</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineminus">-</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineminus">-//</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineminus">-//</span>
<a href="#l9.197"></a><span id="l9.197" class="difflineminus">-//       Function:     ConfigureConduit</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineminus">-//</span>
<a href="#l9.199"></a><span id="l9.199" class="difflineminus">-//       Description:  Extern &quot;C&quot; entry point into this conduit which returns</span>
<a href="#l9.200"></a><span id="l9.200" class="difflineminus">-//                     should display the UI necessary to configure this </span>
<a href="#l9.201"></a><span id="l9.201" class="difflineminus">-//                     conduit.</span>
<a href="#l9.202"></a><span id="l9.202" class="difflineminus">-//</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineminus">-//       Parameters:   none</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineminus">-//</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineminus">-//       Returns:      0 - success, !0 - failure</span>
<a href="#l9.206"></a><span id="l9.206" class="difflineminus">-//</span>
<a href="#l9.207"></a><span id="l9.207" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.208"></a><span id="l9.208" class="difflineminus">-ExportFunc long ConfigureConduit(CSyncPreference&amp; pref)</span>
<a href="#l9.209"></a><span id="l9.209" class="difflineminus">-{</span>
<a href="#l9.210"></a><span id="l9.210" class="difflineminus">-</span>
<a href="#l9.211"></a><span id="l9.211" class="difflineminus">-    long nRtn = -1;</span>
<a href="#l9.212"></a><span id="l9.212" class="difflineminus">-    CfgConduitInfoType cfgcond;</span>
<a href="#l9.213"></a><span id="l9.213" class="difflineminus">-    cfgcond.dwVersion = CFGCONDUITINFO_VERSION_1;</span>
<a href="#l9.214"></a><span id="l9.214" class="difflineminus">-    cfgcond.dwSize  = sizeof(CfgConduitInfoType);</span>
<a href="#l9.215"></a><span id="l9.215" class="difflineminus">-    cfgcond.dwCreatorId = 0;</span>
<a href="#l9.216"></a><span id="l9.216" class="difflineminus">-    cfgcond.dwUserId = 0;</span>
<a href="#l9.217"></a><span id="l9.217" class="difflineminus">-    memset(cfgcond.szUser , 0, sizeof(cfgcond.szUser));</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineminus">-    memset(cfgcond.m_PathName, 0, sizeof(cfgcond.m_PathName)); </span>
<a href="#l9.219"></a><span id="l9.219" class="difflineminus">-    cfgcond.syncPermanent = pref.m_SyncType;</span>
<a href="#l9.220"></a><span id="l9.220" class="difflineminus">-    cfgcond.syncTemporary = pref.m_SyncType;</span>
<a href="#l9.221"></a><span id="l9.221" class="difflineminus">-    cfgcond.syncNew = pref.m_SyncType;</span>
<a href="#l9.222"></a><span id="l9.222" class="difflineminus">-    cfgcond.syncPref = eTemporaryPreference; </span>
<a href="#l9.223"></a><span id="l9.223" class="difflineminus">-</span>
<a href="#l9.224"></a><span id="l9.224" class="difflineminus">-    int irv;</span>
<a href="#l9.225"></a><span id="l9.225" class="difflineminus">-    irv = DialogBoxParam((HINSTANCE)hLangInstance, </span>
<a href="#l9.226"></a><span id="l9.226" class="difflineminus">-              MAKEINTRESOURCE(IDD_CONDUIT_ACTION), </span>
<a href="#l9.227"></a><span id="l9.227" class="difflineminus">-              GetForegroundWindow(), </span>
<a href="#l9.228"></a><span id="l9.228" class="difflineminus">-              (DLGPROC)CondCfgDlgProc,</span>
<a href="#l9.229"></a><span id="l9.229" class="difflineminus">-              (LPARAM)&amp;cfgcond);</span>
<a href="#l9.230"></a><span id="l9.230" class="difflineminus">-    if (irv == 0) </span>
<a href="#l9.231"></a><span id="l9.231" class="difflineminus">-	{</span>
<a href="#l9.232"></a><span id="l9.232" class="difflineminus">-        pref.m_SyncType = cfgcond.syncNew;</span>
<a href="#l9.233"></a><span id="l9.233" class="difflineminus">-        pref.m_SyncPref = cfgcond.syncPref;</span>
<a href="#l9.234"></a><span id="l9.234" class="difflineminus">-        nRtn = 0;</span>
<a href="#l9.235"></a><span id="l9.235" class="difflineminus">-    }</span>
<a href="#l9.236"></a><span id="l9.236" class="difflineminus">-</span>
<a href="#l9.237"></a><span id="l9.237" class="difflineminus">-    return nRtn;</span>
<a href="#l9.238"></a><span id="l9.238" class="difflineminus">-}</span>
<a href="#l9.239"></a><span id="l9.239" class="difflineminus">-</span>
<a href="#l9.240"></a><span id="l9.240" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.241"></a><span id="l9.241" class="difflineminus">-// </span>
<a href="#l9.242"></a><span id="l9.242" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.243"></a><span id="l9.243" class="difflineminus">-//</span>
<a href="#l9.244"></a><span id="l9.244" class="difflineminus">-//   Method:        GetConduitInfo</span>
<a href="#l9.245"></a><span id="l9.245" class="difflineminus">-//</span>
<a href="#l9.246"></a><span id="l9.246" class="difflineminus">-//   Description:   This function provides a way for a Conduit to provide </span>
<a href="#l9.247"></a><span id="l9.247" class="difflineminus">-//                  info to the caller.  In this version of the call, MFC </span>
<a href="#l9.248"></a><span id="l9.248" class="difflineminus">-//                  Version, Conduit Name, and Default sync action are the </span>
<a href="#l9.249"></a><span id="l9.249" class="difflineminus">-//                  types of information this call will return.</span>
<a href="#l9.250"></a><span id="l9.250" class="difflineminus">-//</span>
<a href="#l9.251"></a><span id="l9.251" class="difflineminus">-//   Parameters:    ConduitInfoEnum infoType - enum specifying what info is </span>
<a href="#l9.252"></a><span id="l9.252" class="difflineminus">-//                                             being requested.</span>
<a href="#l9.253"></a><span id="l9.253" class="difflineminus">-//</span>
<a href="#l9.254"></a><span id="l9.254" class="difflineminus">-//                  void *pInArgs - This parameter may be null, except for </span>
<a href="#l9.255"></a><span id="l9.255" class="difflineminus">-//                                  the Conduit name enum, this value will </span>
<a href="#l9.256"></a><span id="l9.256" class="difflineminus">-//                                  be a ConduitRequestInfoType structure.</span>
<a href="#l9.257"></a><span id="l9.257" class="difflineminus">-//</span>
<a href="#l9.258"></a><span id="l9.258" class="difflineminus">-//                  This following two parameters vary depending upon the </span>
<a href="#l9.259"></a><span id="l9.259" class="difflineminus">-//                  info being requested. </span>
<a href="#l9.260"></a><span id="l9.260" class="difflineminus">-//</span>
<a href="#l9.261"></a><span id="l9.261" class="difflineminus">-//                  For enum eConduitName</span>
<a href="#l9.262"></a><span id="l9.262" class="difflineminus">-//                  void *pOut - will be a pointer to a character buffer</span>
<a href="#l9.263"></a><span id="l9.263" class="difflineminus">-//                  DWORD *pdwOutSize - will be a pointer to a DWORD </span>
<a href="#l9.264"></a><span id="l9.264" class="difflineminus">-//                                      specifying the size of the </span>
<a href="#l9.265"></a><span id="l9.265" class="difflineminus">-//                                      character buffer.</span>
<a href="#l9.266"></a><span id="l9.266" class="difflineminus">-//</span>
<a href="#l9.267"></a><span id="l9.267" class="difflineminus">-//                  For enum eMfcVersion</span>
<a href="#l9.268"></a><span id="l9.268" class="difflineminus">-//                  void *pOut - will be a pointer to a DWORD</span>
<a href="#l9.269"></a><span id="l9.269" class="difflineminus">-//                  DWORD *pdwOutSize - will be a pointer to a DWORD </span>
<a href="#l9.270"></a><span id="l9.270" class="difflineminus">-//                                      specifying the size of pOut.</span>
<a href="#l9.271"></a><span id="l9.271" class="difflineminus">-//</span>
<a href="#l9.272"></a><span id="l9.272" class="difflineminus">-//                  For enum eDefaultAction</span>
<a href="#l9.273"></a><span id="l9.273" class="difflineminus">-//                  void *pOut - will be a pointer to a eSyncType variable</span>
<a href="#l9.274"></a><span id="l9.274" class="difflineminus">-//                  DWORD *pdwOutSize - will be a pointer to a DWORD </span>
<a href="#l9.275"></a><span id="l9.275" class="difflineminus">-//                                      specifying the size of pOut.</span>
<a href="#l9.276"></a><span id="l9.276" class="difflineminus">-//</span>
<a href="#l9.277"></a><span id="l9.277" class="difflineminus">-//   Returns:       0   - Success.</span>
<a href="#l9.278"></a><span id="l9.278" class="difflineminus">-//                  !0  - error code.</span>
<a href="#l9.279"></a><span id="l9.279" class="difflineminus">-//</span>
<a href="#l9.280"></a><span id="l9.280" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.281"></a><span id="l9.281" class="difflineminus">-ExportFunc long GetConduitInfo(ConduitInfoEnum infoType, void *pInArgs, </span>
<a href="#l9.282"></a><span id="l9.282" class="difflineminus">-                               void *pOut, DWORD *pdwOutSize)</span>
<a href="#l9.283"></a><span id="l9.283" class="difflineminus">-{</span>
<a href="#l9.284"></a><span id="l9.284" class="difflineminus">-    if (!pOut)</span>
<a href="#l9.285"></a><span id="l9.285" class="difflineminus">-        return CONDERR_INVALID_PTR;</span>
<a href="#l9.286"></a><span id="l9.286" class="difflineminus">-    if (!pdwOutSize)</span>
<a href="#l9.287"></a><span id="l9.287" class="difflineminus">-        return CONDERR_INVALID_OUTSIZE_PTR;</span>
<a href="#l9.288"></a><span id="l9.288" class="difflineminus">-</span>
<a href="#l9.289"></a><span id="l9.289" class="difflineminus">-    switch (infoType) </span>
<a href="#l9.290"></a><span id="l9.290" class="difflineminus">-	{</span>
<a href="#l9.291"></a><span id="l9.291" class="difflineminus">-        case eConduitName:</span>
<a href="#l9.292"></a><span id="l9.292" class="difflineminus">-</span>
<a href="#l9.293"></a><span id="l9.293" class="difflineminus">-            // This code is for example. This conduit does not use this code</span>
<a href="#l9.294"></a><span id="l9.294" class="difflineminus">-            </span>
<a href="#l9.295"></a><span id="l9.295" class="difflineminus">-            if (!pInArgs)</span>
<a href="#l9.296"></a><span id="l9.296" class="difflineminus">-                return CONDERR_INVALID_INARGS_PTR;</span>
<a href="#l9.297"></a><span id="l9.297" class="difflineminus">-            ConduitRequestInfoType *pInfo;</span>
<a href="#l9.298"></a><span id="l9.298" class="difflineminus">-            pInfo = (ConduitRequestInfoType *)pInArgs;</span>
<a href="#l9.299"></a><span id="l9.299" class="difflineminus">-            if ((pInfo-&gt;dwVersion != CONDUITREQUESTINFO_VERSION_1) ||</span>
<a href="#l9.300"></a><span id="l9.300" class="difflineminus">-                (pInfo-&gt;dwSize != SZ_CONDUITREQUESTINFO))</span>
<a href="#l9.301"></a><span id="l9.301" class="difflineminus">-                return CONDERR_INVALID_INARGS_STRUCT;</span>
<a href="#l9.302"></a><span id="l9.302" class="difflineminus">-           </span>
<a href="#l9.303"></a><span id="l9.303" class="difflineminus">-                pOut = CONDUIT_NAME;</span>
<a href="#l9.304"></a><span id="l9.304" class="difflineminus">-                return CONDERR_CONDUIT_RESOURCE_FAILURE;</span>
<a href="#l9.305"></a><span id="l9.305" class="difflineminus">-            break;</span>
<a href="#l9.306"></a><span id="l9.306" class="difflineminus">-        case eDefaultAction:</span>
<a href="#l9.307"></a><span id="l9.307" class="difflineminus">-            if (*pdwOutSize != sizeof(eSyncTypes))</span>
<a href="#l9.308"></a><span id="l9.308" class="difflineminus">-                return CONDERR_INVALID_BUFFER_SIZE;</span>
<a href="#l9.309"></a><span id="l9.309" class="difflineminus">-            (*(eSyncTypes*)pOut) = eFast;</span>
<a href="#l9.310"></a><span id="l9.310" class="difflineminus">-            break;</span>
<a href="#l9.311"></a><span id="l9.311" class="difflineminus">-        case eMfcVersion:</span>
<a href="#l9.312"></a><span id="l9.312" class="difflineminus">-            if (*pdwOutSize != sizeof(DWORD))</span>
<a href="#l9.313"></a><span id="l9.313" class="difflineminus">-                return CONDERR_INVALID_BUFFER_SIZE;</span>
<a href="#l9.314"></a><span id="l9.314" class="difflineminus">-            (*(DWORD*)pOut) = MFC_NOT_USED;</span>
<a href="#l9.315"></a><span id="l9.315" class="difflineminus">-            break;</span>
<a href="#l9.316"></a><span id="l9.316" class="difflineminus">-        default:</span>
<a href="#l9.317"></a><span id="l9.317" class="difflineminus">-            return CONDERR_UNSUPPORTED_CONDUITINFO_ENUM;</span>
<a href="#l9.318"></a><span id="l9.318" class="difflineminus">-    }</span>
<a href="#l9.319"></a><span id="l9.319" class="difflineminus">-    return 0;</span>
<a href="#l9.320"></a><span id="l9.320" class="difflineminus">-}</span>
<a href="#l9.321"></a><span id="l9.321" class="difflineminus">-</span>
<a href="#l9.322"></a><span id="l9.322" class="difflineminus">-long CALLBACK CondCfgDlgProc(HWND hWnd, UINT Message, WPARAM wParam, LPARAM lParam)</span>
<a href="#l9.323"></a><span id="l9.323" class="difflineminus">-{</span>
<a href="#l9.324"></a><span id="l9.324" class="difflineminus">-    static CfgConduitInfoType *pCfgInfo;</span>
<a href="#l9.325"></a><span id="l9.325" class="difflineminus">-    TCHAR szPath[256];</span>
<a href="#l9.326"></a><span id="l9.326" class="difflineminus">-</span>
<a href="#l9.327"></a><span id="l9.327" class="difflineminus">-    switch (Message) </span>
<a href="#l9.328"></a><span id="l9.328" class="difflineminus">-	{</span>
<a href="#l9.329"></a><span id="l9.329" class="difflineminus">-      case WM_INITDIALOG:</span>
<a href="#l9.330"></a><span id="l9.330" class="difflineminus">-</span>
<a href="#l9.331"></a><span id="l9.331" class="difflineminus">-        if (lParam != 0) {</span>
<a href="#l9.332"></a><span id="l9.332" class="difflineminus">-          TCHAR szBuffer[256];</span>
<a href="#l9.333"></a><span id="l9.333" class="difflineminus">-          TCHAR szBuf2[256];</span>
<a href="#l9.334"></a><span id="l9.334" class="difflineminus">-          LoadString((HINSTANCE)hLangInstance, IDS_SYNC_ACTION_TEXT, szBuffer, </span>
<a href="#l9.335"></a><span id="l9.335" class="difflineminus">-                     sizeof(szBuffer));</span>
<a href="#l9.336"></a><span id="l9.336" class="difflineminus">-          SetDlgItemText(hWnd, IDC_ACTIONGROUPBOXTEXT, szBuffer);</span>
<a href="#l9.337"></a><span id="l9.337" class="difflineminus">-</span>
<a href="#l9.338"></a><span id="l9.338" class="difflineminus">-          LoadString((HINSTANCE)hLangInstance, IDS_CONDUIT_NAME, szBuffer, </span>
<a href="#l9.339"></a><span id="l9.339" class="difflineminus">-                     sizeof(szBuffer));</span>
<a href="#l9.340"></a><span id="l9.340" class="difflineminus">-          SetWindowText(hWnd, szBuffer);</span>
<a href="#l9.341"></a><span id="l9.341" class="difflineminus">-     </span>
<a href="#l9.342"></a><span id="l9.342" class="difflineminus">-          // Load the bitmaps properly</span>
<a href="#l9.343"></a><span id="l9.343" class="difflineminus">-          LdCfgDlgBmps(hWnd);</span>
<a href="#l9.344"></a><span id="l9.344" class="difflineminus">-</span>
<a href="#l9.345"></a><span id="l9.345" class="difflineminus">-          pCfgInfo = (CfgConduitInfoType *)lParam;</span>
<a href="#l9.346"></a><span id="l9.346" class="difflineminus">-          switch (pCfgInfo-&gt;syncTemporary)</span>
<a href="#l9.347"></a><span id="l9.347" class="difflineminus">-		  {</span>
<a href="#l9.348"></a><span id="l9.348" class="difflineminus">-            case eFast:</span>
<a href="#l9.349"></a><span id="l9.349" class="difflineminus">-            case eSlow:</span>
<a href="#l9.350"></a><span id="l9.350" class="difflineminus">-              CheckRadioButton(hWnd, IDC_RADIO_SYNC, IDC_RADIO_DONOTHING, </span>
<a href="#l9.351"></a><span id="l9.351" class="difflineminus">-                               IDC_RADIO_SYNC);</span>
<a href="#l9.352"></a><span id="l9.352" class="difflineminus">-              LoadString((HINSTANCE)hLangInstance, IDS_SYNC_FILES, szBuffer, </span>
<a href="#l9.353"></a><span id="l9.353" class="difflineminus">-                         sizeof(szBuffer));</span>
<a href="#l9.354"></a><span id="l9.354" class="difflineminus">-              break;</span>
<a href="#l9.355"></a><span id="l9.355" class="difflineminus">-            case ePCtoHH:</span>
<a href="#l9.356"></a><span id="l9.356" class="difflineminus">-              CheckRadioButton( hWnd, IDC_RADIO_SYNC, IDC_RADIO_DONOTHING, IDC_RADIO_PCTOHH);</span>
<a href="#l9.357"></a><span id="l9.357" class="difflineminus">-              LoadString((HINSTANCE)hLangInstance, IDS_PCTOHH, szBuffer, sizeof(szBuffer));</span>
<a href="#l9.358"></a><span id="l9.358" class="difflineminus">-              break;</span>
<a href="#l9.359"></a><span id="l9.359" class="difflineminus">-            case eHHtoPC:</span>
<a href="#l9.360"></a><span id="l9.360" class="difflineminus">-              CheckRadioButton( hWnd, IDC_RADIO_SYNC, IDC_RADIO_DONOTHING, IDC_RADIO_HHTOPC);</span>
<a href="#l9.361"></a><span id="l9.361" class="difflineminus">-              LoadString((HINSTANCE)hLangInstance, IDS_HHTOPC, szBuffer, sizeof(szBuffer));</span>
<a href="#l9.362"></a><span id="l9.362" class="difflineminus">-              break;</span>
<a href="#l9.363"></a><span id="l9.363" class="difflineminus">-            case eDoNothing:</span>
<a href="#l9.364"></a><span id="l9.364" class="difflineminus">-            default:</span>
<a href="#l9.365"></a><span id="l9.365" class="difflineminus">-              CheckRadioButton(hWnd, IDC_RADIO_SYNC, IDC_RADIO_DONOTHING, </span>
<a href="#l9.366"></a><span id="l9.366" class="difflineminus">-                               IDC_RADIO_DONOTHING);</span>
<a href="#l9.367"></a><span id="l9.367" class="difflineminus">-              LoadString((HINSTANCE)hLangInstance, IDS_DO_NOTHING, szBuffer,</span>
<a href="#l9.368"></a><span id="l9.368" class="difflineminus">-                         sizeof(szBuffer));</span>
<a href="#l9.369"></a><span id="l9.369" class="difflineminus">-              break;</span>
<a href="#l9.370"></a><span id="l9.370" class="difflineminus">-          }</span>
<a href="#l9.371"></a><span id="l9.371" class="difflineminus">-          // did we get called from the old config call or the new cfg call?</span>
<a href="#l9.372"></a><span id="l9.372" class="difflineminus">-          if (pCfgInfo-&gt;dwCreatorId != 0) </span>
<a href="#l9.373"></a><span id="l9.373" class="difflineminus">-		  {</span>
<a href="#l9.374"></a><span id="l9.374" class="difflineminus">-            SetDlgItemText(hWnd, IDC_STATIC_TEMPORARY, szBuffer);</span>
<a href="#l9.375"></a><span id="l9.375" class="difflineminus">-</span>
<a href="#l9.376"></a><span id="l9.376" class="difflineminus">-            switch (pCfgInfo-&gt;syncPermanent)</span>
<a href="#l9.377"></a><span id="l9.377" class="difflineminus">-			{</span>
<a href="#l9.378"></a><span id="l9.378" class="difflineminus">-              case eFast:</span>
<a href="#l9.379"></a><span id="l9.379" class="difflineminus">-              case eSlow:</span>
<a href="#l9.380"></a><span id="l9.380" class="difflineminus">-                LoadString((HINSTANCE)hLangInstance, IDS_SYNC_FILES, szBuffer,</span>
<a href="#l9.381"></a><span id="l9.381" class="difflineminus">-                           sizeof(szBuffer));</span>
<a href="#l9.382"></a><span id="l9.382" class="difflineminus">-                break;</span>
<a href="#l9.383"></a><span id="l9.383" class="difflineminus">-              case ePCtoHH:</span>
<a href="#l9.384"></a><span id="l9.384" class="difflineminus">-                LoadString((HINSTANCE)hLangInstance, IDS_PCTOHH, szBuffer,</span>
<a href="#l9.385"></a><span id="l9.385" class="difflineminus">-                           sizeof(szBuffer));</span>
<a href="#l9.386"></a><span id="l9.386" class="difflineminus">-                break;</span>
<a href="#l9.387"></a><span id="l9.387" class="difflineminus">-</span>
<a href="#l9.388"></a><span id="l9.388" class="difflineminus">-              case eHHtoPC:</span>
<a href="#l9.389"></a><span id="l9.389" class="difflineminus">-                LoadString((HINSTANCE)hLangInstance, IDS_HHTOPC, szBuffer,</span>
<a href="#l9.390"></a><span id="l9.390" class="difflineminus">-                           sizeof(szBuffer));</span>
<a href="#l9.391"></a><span id="l9.391" class="difflineminus">-                break;</span>
<a href="#l9.392"></a><span id="l9.392" class="difflineminus">-              case eDoNothing:</span>
<a href="#l9.393"></a><span id="l9.393" class="difflineminus">-              default:</span>
<a href="#l9.394"></a><span id="l9.394" class="difflineminus">-                LoadString((HINSTANCE)hLangInstance, IDS_DO_NOTHING, szBuffer,</span>
<a href="#l9.395"></a><span id="l9.395" class="difflineminus">-                           sizeof(szBuffer));</span>
<a href="#l9.396"></a><span id="l9.396" class="difflineminus">-                break;</span>
<a href="#l9.397"></a><span id="l9.397" class="difflineminus">-            }</span>
<a href="#l9.398"></a><span id="l9.398" class="difflineminus">-            SetDlgItemText(hWnd, IDC_STATIC_PERMANENT, szBuffer);</span>
<a href="#l9.399"></a><span id="l9.399" class="difflineminus">-</span>
<a href="#l9.400"></a><span id="l9.400" class="difflineminus">-            LoadString((HINSTANCE)hLangInstance, IDS_CURRENT_SETTINGS_GROUP, </span>
<a href="#l9.401"></a><span id="l9.401" class="difflineminus">-                       szBuffer, sizeof(szBuffer));</span>
<a href="#l9.402"></a><span id="l9.402" class="difflineminus">-            wsprintf(szBuf2, szBuffer, pCfgInfo-&gt;szUser);</span>
<a href="#l9.403"></a><span id="l9.403" class="difflineminus">-            SetDlgItemText(hWnd, IDC_CURRENT_SETTINGS_GROUP, szBuf2);</span>
<a href="#l9.404"></a><span id="l9.404" class="difflineminus">-          }</span>
<a href="#l9.405"></a><span id="l9.405" class="difflineminus">-        }</span>
<a href="#l9.406"></a><span id="l9.406" class="difflineminus">-        break;</span>
<a href="#l9.407"></a><span id="l9.407" class="difflineminus">-      case WM_COMMAND:</span>
<a href="#l9.408"></a><span id="l9.408" class="difflineminus">-        switch (wParam) </span>
<a href="#l9.409"></a><span id="l9.409" class="difflineminus">-		{</span>
<a href="#l9.410"></a><span id="l9.410" class="difflineminus">-          case IDC_RADIO_SYNC:</span>
<a href="#l9.411"></a><span id="l9.411" class="difflineminus">-          case IDC_RADIO_DONOTHING:</span>
<a href="#l9.412"></a><span id="l9.412" class="difflineminus">-          case IDC_RADIO_HHTOPC:</span>
<a href="#l9.413"></a><span id="l9.413" class="difflineminus">-          case IDC_RADIO_PCTOHH:</span>
<a href="#l9.414"></a><span id="l9.414" class="difflineminus">-            CheckRadioButton( hWnd, IDC_RADIO_SYNC, IDC_RADIO_DONOTHING, wParam);</span>
<a href="#l9.415"></a><span id="l9.415" class="difflineminus">-            break;</span>
<a href="#l9.416"></a><span id="l9.416" class="difflineminus">-          case IDCANCEL:</span>
<a href="#l9.417"></a><span id="l9.417" class="difflineminus">-            EndDialog(hWnd, 1);</span>
<a href="#l9.418"></a><span id="l9.418" class="difflineminus">-            return TRUE;</span>
<a href="#l9.419"></a><span id="l9.419" class="difflineminus">-          case IDOK:</span>
<a href="#l9.420"></a><span id="l9.420" class="difflineminus">-            if (IsDlgButtonChecked(hWnd, IDC_RADIO_SYNC)) </span>
<a href="#l9.421"></a><span id="l9.421" class="difflineminus">-                pCfgInfo-&gt;syncNew = eFast;</span>
<a href="#l9.422"></a><span id="l9.422" class="difflineminus">-            else if (IsDlgButtonChecked(hWnd, IDC_RADIO_PCTOHH)) </span>
<a href="#l9.423"></a><span id="l9.423" class="difflineminus">-                pCfgInfo-&gt;syncNew = ePCtoHH;</span>
<a href="#l9.424"></a><span id="l9.424" class="difflineminus">-            else if (IsDlgButtonChecked(hWnd, IDC_RADIO_HHTOPC))</span>
<a href="#l9.425"></a><span id="l9.425" class="difflineminus">-                pCfgInfo-&gt;syncNew = eHHtoPC;</span>
<a href="#l9.426"></a><span id="l9.426" class="difflineminus">-            else</span>
<a href="#l9.427"></a><span id="l9.427" class="difflineminus">-                pCfgInfo-&gt;syncNew = eDoNothing;</span>
<a href="#l9.428"></a><span id="l9.428" class="difflineminus">-            pCfgInfo-&gt;syncPref = (IsDlgButtonChecked(hWnd, IDC_MAKEDEFAULT))</span>
<a href="#l9.429"></a><span id="l9.429" class="difflineminus">-				?  ePermanentPreference : eTemporaryPreference;</span>
<a href="#l9.430"></a><span id="l9.430" class="difflineminus">-            EndDialog(hWnd, 0);</span>
<a href="#l9.431"></a><span id="l9.431" class="difflineminus">-            return TRUE;</span>
<a href="#l9.432"></a><span id="l9.432" class="difflineminus">-          default:</span>
<a href="#l9.433"></a><span id="l9.433" class="difflineminus">-            break;</span>
<a href="#l9.434"></a><span id="l9.434" class="difflineminus">-        }</span>
<a href="#l9.435"></a><span id="l9.435" class="difflineminus">-        break;</span>
<a href="#l9.436"></a><span id="l9.436" class="difflineminus">-</span>
<a href="#l9.437"></a><span id="l9.437" class="difflineminus">-      case WM_SYSCOLORCHANGE:</span>
<a href="#l9.438"></a><span id="l9.438" class="difflineminus">-        LdCfgDlgBmps(hWnd);</span>
<a href="#l9.439"></a><span id="l9.439" class="difflineminus">-        break;</span>
<a href="#l9.440"></a><span id="l9.440" class="difflineminus">-</span>
<a href="#l9.441"></a><span id="l9.441" class="difflineminus">-      default:</span>
<a href="#l9.442"></a><span id="l9.442" class="difflineminus">-        break;</span>
<a href="#l9.443"></a><span id="l9.443" class="difflineminus">-    }</span>
<a href="#l9.444"></a><span id="l9.444" class="difflineminus">-    return FALSE;</span>
<a href="#l9.445"></a><span id="l9.445" class="difflineminus">-}</span>
<a href="#l9.446"></a><span id="l9.446" class="difflineminus">-</span>
<a href="#l9.447"></a><span id="l9.447" class="difflineminus">-void LdCfgDlgBmps(HWND hDlg)</span>
<a href="#l9.448"></a><span id="l9.448" class="difflineminus">-{</span>
<a href="#l9.449"></a><span id="l9.449" class="difflineminus">-  COLORMAP    cMap;</span>
<a href="#l9.450"></a><span id="l9.450" class="difflineminus">-  HWND        hwndButton;</span>
<a href="#l9.451"></a><span id="l9.451" class="difflineminus">-  HBITMAP     hBmp, hOldBmp;</span>
<a href="#l9.452"></a><span id="l9.452" class="difflineminus">-</span>
<a href="#l9.453"></a><span id="l9.453" class="difflineminus">-  //</span>
<a href="#l9.454"></a><span id="l9.454" class="difflineminus">-  // setup the bitmaps</span>
<a href="#l9.455"></a><span id="l9.455" class="difflineminus">-  //</span>
<a href="#l9.456"></a><span id="l9.456" class="difflineminus">-  cMap.to = GetSysColor(COLOR_BTNFACE);</span>
<a href="#l9.457"></a><span id="l9.457" class="difflineminus">-  cMap.from = RGB(192,192,192);</span>
<a href="#l9.458"></a><span id="l9.458" class="difflineminus">-</span>
<a href="#l9.459"></a><span id="l9.459" class="difflineminus">-  // Sync </span>
<a href="#l9.460"></a><span id="l9.460" class="difflineminus">-  hBmp = CreateMappedBitmap((HINSTANCE)hLangInstance, IDB_SYNC, 0, &amp;cMap, 1);</span>
<a href="#l9.461"></a><span id="l9.461" class="difflineminus">-  // associate the bitmap with the button.</span>
<a href="#l9.462"></a><span id="l9.462" class="difflineminus">-  if ((hwndButton = GetDlgItem(hDlg, IDC_SYNC)) != NULL)</span>
<a href="#l9.463"></a><span id="l9.463" class="difflineminus">-  {</span>
<a href="#l9.464"></a><span id="l9.464" class="difflineminus">-    hOldBmp = (HBITMAP)SendMessage(hwndButton, STM_SETIMAGE,</span>
<a href="#l9.465"></a><span id="l9.465" class="difflineminus">-                                   (WPARAM)IMAGE_BITMAP, (LPARAM)(HANDLE)hBmp);</span>
<a href="#l9.466"></a><span id="l9.466" class="difflineminus">-    if (hOldBmp != NULL)</span>
<a href="#l9.467"></a><span id="l9.467" class="difflineminus">-      DeleteObject((HGDIOBJ)hOldBmp);</span>
<a href="#l9.468"></a><span id="l9.468" class="difflineminus">-  }</span>
<a href="#l9.469"></a><span id="l9.469" class="difflineminus">-</span>
<a href="#l9.470"></a><span id="l9.470" class="difflineminus">-  // Do Nothing </span>
<a href="#l9.471"></a><span id="l9.471" class="difflineminus">-  hBmp = CreateMappedBitmap((HINSTANCE)hLangInstance, IDB_DONOTHING, 0, &amp;cMap, 1);</span>
<a href="#l9.472"></a><span id="l9.472" class="difflineminus">-  // associate the bitmap with the button.</span>
<a href="#l9.473"></a><span id="l9.473" class="difflineminus">-  if ((hwndButton = GetDlgItem(hDlg, IDC_DONOTHING)) != NULL)</span>
<a href="#l9.474"></a><span id="l9.474" class="difflineminus">-  {</span>
<a href="#l9.475"></a><span id="l9.475" class="difflineminus">-    hOldBmp = (HBITMAP)SendMessage(hwndButton, STM_SETIMAGE,</span>
<a href="#l9.476"></a><span id="l9.476" class="difflineminus">-                                   (WPARAM)IMAGE_BITMAP, (LPARAM)(HANDLE)hBmp);</span>
<a href="#l9.477"></a><span id="l9.477" class="difflineminus">-    if (hOldBmp != NULL)</span>
<a href="#l9.478"></a><span id="l9.478" class="difflineminus">-      DeleteObject((HGDIOBJ)hOldBmp);</span>
<a href="#l9.479"></a><span id="l9.479" class="difflineminus">-  }</span>
<a href="#l9.480"></a><span id="l9.480" class="difflineminus">-  hBmp = CreateMappedBitmap((HINSTANCE)hLangInstance, IDB_PCTOHH, 0, &amp;cMap, 1);</span>
<a href="#l9.481"></a><span id="l9.481" class="difflineminus">-  // associate the bitmap with the button.</span>
<a href="#l9.482"></a><span id="l9.482" class="difflineminus">-  if ((hwndButton = GetDlgItem(hDlg, IDC_PCTOHH)) != NULL)</span>
<a href="#l9.483"></a><span id="l9.483" class="difflineminus">-  {</span>
<a href="#l9.484"></a><span id="l9.484" class="difflineminus">-    hOldBmp = (HBITMAP)SendMessage(hwndButton, STM_SETIMAGE,</span>
<a href="#l9.485"></a><span id="l9.485" class="difflineminus">-                                   (WPARAM)IMAGE_BITMAP, (LPARAM)(HANDLE)hBmp);</span>
<a href="#l9.486"></a><span id="l9.486" class="difflineminus">-    if (hOldBmp != NULL)</span>
<a href="#l9.487"></a><span id="l9.487" class="difflineminus">-      DeleteObject((HGDIOBJ)hOldBmp);</span>
<a href="#l9.488"></a><span id="l9.488" class="difflineminus">-  }</span>
<a href="#l9.489"></a><span id="l9.489" class="difflineminus">-  hBmp = CreateMappedBitmap((HINSTANCE)hLangInstance, IDB_HHTOPC, 0, &amp;cMap, 1);</span>
<a href="#l9.490"></a><span id="l9.490" class="difflineminus">-  // associate the bitmap with the button.</span>
<a href="#l9.491"></a><span id="l9.491" class="difflineminus">-  if ((hwndButton = GetDlgItem(hDlg, IDC_HHTOPC)) != NULL)</span>
<a href="#l9.492"></a><span id="l9.492" class="difflineminus">-  {</span>
<a href="#l9.493"></a><span id="l9.493" class="difflineminus">-    hOldBmp = (HBITMAP)SendMessage(hwndButton, STM_SETIMAGE,</span>
<a href="#l9.494"></a><span id="l9.494" class="difflineminus">-                                   (WPARAM)IMAGE_BITMAP, (LPARAM)(HANDLE)hBmp);</span>
<a href="#l9.495"></a><span id="l9.495" class="difflineminus">-    if (hOldBmp != NULL)</span>
<a href="#l9.496"></a><span id="l9.496" class="difflineminus">-      DeleteObject((HGDIOBJ)hOldBmp);</span>
<a href="#l9.497"></a><span id="l9.497" class="difflineminus">-  }</span>
<a href="#l9.498"></a><span id="l9.498" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">deleted file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ /dev/null</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -1,37 +0,0 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineminus">-/*****************************************************************************</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineminus">- *</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineminus">- * Generic Conduit Export Functions Header File</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineminus">- *</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineminus">- * THIS FILE IS GENERATED BY PALM CDK</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">- ****************************************************************************/</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineminus">-</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-#ifndef  __GENERIC_MAIN_CONDUIT__</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-#define  __GENERIC_MAIN_CONDUIT__</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-#include &lt;condapi.h&gt;</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-#define GENERIC_CONDUIT_VERSION 0x00000102</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">-</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineminus">-#ifndef ExportFunc</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-#ifdef _68K_</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineminus">-#define ExportFunc</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">-#else</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-#define ExportFunc __declspec( dllexport )</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-#endif</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">-#endif</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">-</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">-extern &quot;C&quot; {</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineminus">-</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineminus">-typedef  long (*PROGRESSFN) (char*);</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-ExportFunc long OpenConduit(PROGRESSFN, CSyncProperties&amp;);</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-ExportFunc long GetConduitName(char*,WORD);</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-ExportFunc DWORD GetConduitVersion();</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-ExportFunc long ConfigureConduit(CSyncPreference&amp; pref);</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-ExportFunc long GetConduitInfo(ConduitInfoEnum infoType, void *pInArgs, void *pOut, DWORD *dwOutSize);</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">-</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-}</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">-</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">-</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-#endif</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">-</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">deleted file mode 100755</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/MozABConduitGenCond.rc</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ /dev/null</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -1,130 +0,0 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineminus">-//Microsoft Developer Studio generated resource script.</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineminus">-//</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineminus">-</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineminus">-#define APSTUDIO_READONLY_SYMBOLS</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineminus">-//</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-// Generated from the TEXTINCLUDE 2 resource.</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-//</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-#include &quot;winresrc.h&quot;</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-#undef APSTUDIO_READONLY_SYMBOLS</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-// English (U.S.) resources</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_ENU)</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">-#ifdef _WIN32</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">-LANGUAGE LANG_ENGLISH, SUBLANG_ENGLISH_US</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineminus">-#pragma code_page(1252)</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">-#endif //_WIN32</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineminus">-#ifdef APSTUDIO_INVOKED</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-//</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-// TEXTINCLUDE</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-//</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-1 TEXTINCLUDE DISCARDABLE </span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-BEGIN</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-    &quot;resource.h\0&quot;</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineminus">-END</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">-</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineminus">-2 TEXTINCLUDE DISCARDABLE </span>
<a href="#l11.40"></a><span id="l11.40" class="difflineminus">-BEGIN</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineminus">-    &quot;#include &quot;&quot;winresrc.h&quot;&quot;\r\n&quot;</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">-    &quot;\0&quot;</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-END</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineminus">-</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-3 TEXTINCLUDE DISCARDABLE </span>
<a href="#l11.46"></a><span id="l11.46" class="difflineminus">-BEGIN</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-    &quot;\r\n&quot;</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineminus">-    &quot;\0&quot;</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-END</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-#endif    // APSTUDIO_INVOKED</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineminus">-//</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-// Dialog</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-//</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineminus">-</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineminus">-IDD_CONDUIT_ACTION DIALOG DISCARDABLE  0, 0, 294, 114</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-STYLE DS_MODALFRAME | WS_POPUP | WS_VISIBLE | WS_CAPTION | WS_SYSMENU</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineminus">-CAPTION &quot;Change HotSync Action&quot;</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineminus">-FONT 8, &quot;MS Sans Serif&quot;</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineminus">-BEGIN</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineminus">-    RADIOBUTTON     &quot;&amp;Synchronize the files&quot;,IDC_RADIO_SYNC,71,28,81,10,</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-                    WS_GROUP | WS_TABSTOP</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineminus">-    RADIOBUTTON     &quot;&amp;Desktop overwrites handheld&quot;,IDC_RADIO_PCTOHH,71,40,</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-                    108,10,WS_GROUP</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineminus">-    RADIOBUTTON     &quot;&amp;Handheld overwrites Desktop&quot;,IDC_RADIO_HHTOPC,71,52,</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineminus">-                    109,10,WS_GROUP</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineminus">-    RADIOBUTTON     &quot;Do &amp;nothing&quot;,IDC_RADIO_DONOTHING,71,64,51,10,WS_GROUP</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineminus">-    CONTROL         &quot;Set &amp;as default&quot;,IDC_MAKEDEFAULT,&quot;Button&quot;,</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineminus">-                    BS_AUTOCHECKBOX | WS_TABSTOP,196,64,58,10</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineminus">-    DEFPUSHBUTTON   &quot;OK&quot;,IDOK,196,11,50,14</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineminus">-    PUSHBUTTON      &quot;Cancel&quot;,IDCANCEL,196,27,50,14</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineminus">-    GROUPBOX        &quot;&lt;PlaceHolder&gt;&quot;,IDC_ACTIONGROUPBOXTEXT,5,6,186,105,</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineminus">-                    WS_GROUP</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineminus">-    CONTROL         103,IDC_SYNC,&quot;Static&quot;,SS_BITMAP | WS_GROUP,18,26,32,15</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineminus">-    CONTROL         106,IDC_DONOTHING,&quot;Static&quot;,SS_BITMAP | WS_GROUP,18,62,15,</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineminus">-                    13</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineminus">-    CONTROL         105,IDC_PCTOHH,&quot;Static&quot;,SS_BITMAP | WS_GROUP,18,39,32,15</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineminus">-    CONTROL         102,IDC_HHTOPC,&quot;Static&quot;,SS_BITMAP | WS_GROUP,18,49,32,15</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineminus">-END</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineminus">-</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineminus">-</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineminus">-//</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineminus">-// Bitmap</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineminus">-//</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineminus">-</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineminus">-IDB_DONOTHING           BITMAP  DISCARDABLE     &quot;res\\DoNothing.bmp&quot;</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineminus">-IDB_SYNC                BITMAP  DISCARDABLE     &quot;res\\Synchronize.bmp&quot;</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineminus">-IDB_HHTOPC              BITMAP  DISCARDABLE     &quot;res\\HhToPc.bmp&quot;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineminus">-IDB_PCTOHH              BITMAP  DISCARDABLE     &quot;res\\PcToHh.bmp&quot;</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineminus">-</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineminus">-//</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineminus">-// String Table</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineminus">-//</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineminus">-</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineminus">-STRINGTABLE DISCARDABLE </span>
<a href="#l11.101"></a><span id="l11.101" class="difflineminus">-BEGIN</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineminus">-    IDS_CONDUIT_NAME        &quot;Mozilla Address Book Conduit&quot;</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineminus">-END</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineminus">-</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineminus">-STRINGTABLE DISCARDABLE </span>
<a href="#l11.106"></a><span id="l11.106" class="difflineminus">-BEGIN</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineminus">-    IDS_CONNECTION          &quot;Please check your connections and try again.&quot;</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineminus">-END</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineminus">-</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineminus">-STRINGTABLE DISCARDABLE </span>
<a href="#l11.111"></a><span id="l11.111" class="difflineminus">-BEGIN</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineminus">-    IDS_CURRENT_SETTINGS_GROUP &quot;%s's Current Settings:&quot;</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineminus">-    IDS_SYNC_FILES          &quot;Synchronize the files.&quot;</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineminus">-    IDS_PCTOHH              &quot;Desktop overwrites Palm organizer.&quot;</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineminus">-    IDS_HHTOPC              &quot;Palm organizer overwrites Desktop.&quot;</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineminus">-    IDS_DO_NOTHING          &quot;Do Nothing.&quot;</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineminus">-    IDS_SYNC_ACTION_TEXT    &quot;HotSync Action for Mozilla Address Book&quot;</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineminus">-END</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineminus">-</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineminus">-#endif    // English (U.S.) resources</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineminus">-</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineminus">-</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineminus">-</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineminus">-#ifndef APSTUDIO_INVOKED</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineminus">-//</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineminus">-// Generated from the TEXTINCLUDE 3 resource.</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineminus">-//</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineminus">-</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineminus">-</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineminus">-#endif    // not APSTUDIO_INVOKED</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">deleted file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/MozABConduitRecord.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ /dev/null</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -1,604 +0,0 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineminus">- *</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">- *</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">- * License.</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">- *</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">- *</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">- *</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">- *</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">- *</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">- *</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-#include &lt;stdio.h&gt;</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-#include &lt;memory.h&gt;</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-#include &lt;sys/stat.h&gt;</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-#include &lt;TCHAR.H&gt;</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-#include &quot;MozABConduitRecord.h&quot;</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-#include &quot;MozABPCManager.h&quot;</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-#include &quot;MozABConduitSync.h&quot;</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-#define  STR_CRETURN  &quot;\r&quot; </span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-#define  STR_NEWLINE  &quot;\n&quot; </span>
<a href="#l12.56"></a><span id="l12.56" class="difflineminus">-</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">-#define  CH_CRETURN  0x0D </span>
<a href="#l12.58"></a><span id="l12.58" class="difflineminus">-#define  CH_NEWLINE  0x0A </span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineminus">-</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineminus">-// constructor</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineminus">-CMozABConduitRecord::CMozABConduitRecord(void)</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineminus">-{</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-    Reset();</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-}</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-// construct using Palm record</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-CMozABConduitRecord::CMozABConduitRecord(CPalmRecord &amp;rec)</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-{</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-    ConvertFromGeneric(rec);</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineminus">-}</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-// construct using Mozilla record</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-CMozABConduitRecord::CMozABConduitRecord(nsABCOMCardStruct &amp;rec)</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-{</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-    Reset();</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineminus">-</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-    memcpy(&amp;m_nsCard, &amp;rec, sizeof(nsABCOMCardStruct));</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-    m_dwRecordID = m_nsCard.dwRecordId;</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-    m_dwStatus = m_nsCard.dwStatus;</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-    m_dwCategoryID = m_nsCard.dwCategoryId;</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-    m_dwPhone1LabelID = PHONE_LABEL_WORK;</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineminus">-    m_dwPhone2LabelID = PHONE_LABEL_HOME;</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-    m_dwPhone3LabelID = PHONE_LABEL_FAX;</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-    m_dwPhone4LabelID = PHONE_LABEL_MOBILE;</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-    m_dwPhone5LabelID = PHONE_LABEL_EMAIL;</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineminus">-    </span>
<a href="#l12.90"></a><span id="l12.90" class="difflineminus">-    m_csName = rec.lastName;</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-    m_csFirst = rec.firstName;</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-    m_csTitle = rec.jobTitle;</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-    m_csCompany = rec.company;</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineminus">-    m_csPhone1 = rec.workPhone;</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineminus">-    m_csPhone2 = rec.homePhone;</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineminus">-    m_csPhone3 = rec.faxNumber;</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineminus">-    m_csPhone4 = rec.cellularNumber;</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-    m_csPhone5 = rec.primaryEmail;</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineminus">-</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineminus">-    m_csAddress = (MozABPCManager::gUseHomeAddress)</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-                    ? rec.homeAddress : rec.workAddress;</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineminus">-    m_csCity = (MozABPCManager::gUseHomeAddress) ? rec.homeCity : rec.workCity;</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineminus">-    m_csState = (MozABPCManager::gUseHomeAddress) ? rec.homeState : rec.workState;</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineminus">-    m_csZipCode = (MozABPCManager::gUseHomeAddress) ? rec.homeZipCode : rec.workZipCode;</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-    m_csCountry = (MozABPCManager::gUseHomeAddress) ? rec.homeCountry : rec.workCountry;</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineminus">-//    CONDUIT_LOG3(gFD, &quot;\nCMozABConduitRecord::CMozABConduitRecord(nsABCOMCardStruct &amp;rec) gUseHomeAddress = %s card home address = %s card work address = %s\n&quot;, </span>
<a href="#l12.109"></a><span id="l12.109" class="difflineminus">-//      (MozABPCManager::gUseHomeAddress) ? &quot;true&quot; : &quot;false&quot;, (char *) rec.homeAddress, (char *) rec.workAddress);</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineminus">-    m_dwDisplayPhone = rec.preferredPhoneNum;</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineminus">-</span>
<a href="#l12.112"></a><span id="l12.112" class="difflineminus">-    m_csNote = rec.notes;</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineminus">-</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineminus">-    m_csCustom1 = rec.custom1;</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineminus">-    m_csCustom2 = rec.custom2;</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineminus">-    m_csCustom3 = rec.custom3;</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineminus">-    m_csCustom4 = rec.custom4;</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineminus">-}</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineminus">-</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineminus">-// destructor</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineminus">-CMozABConduitRecord::~CMozABConduitRecord()</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineminus">-{</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineminus">-</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineminus">-}</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineminus">-</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineminus">-// reset the internal data members</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineminus">-void CMozABConduitRecord::Reset(void)</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineminus">-{</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineminus">-    memset(&amp;m_nsCard, 0, sizeof(nsABCOMCardStruct));</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineminus">-</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineminus">-    m_dwRecordID = 0;</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineminus">-    m_dwStatus = 0;</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineminus">-    m_dwPosition = 0;</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineminus">-    m_dwPhone1LabelID = 0;</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineminus">-    m_dwPhone2LabelID = 0;</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineminus">-    m_dwPhone3LabelID = 0;</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineminus">-    m_dwPhone4LabelID = 0;</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineminus">-    m_dwPhone5LabelID = 0;</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineminus">-    m_dwPrivate = 0;</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineminus">-    m_dwCategoryID = 0;</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineminus">-    m_dwDisplayPhone = 1; // work </span>
<a href="#l12.142"></a><span id="l12.142" class="difflineminus">-    m_csName.Empty();</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineminus">-    m_csFirst.Empty();</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineminus">-    m_csTitle.Empty();</span>
<a href="#l12.145"></a><span id="l12.145" class="difflineminus">-    m_csCompany.Empty();</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineminus">-    m_csPhone1.Empty();</span>
<a href="#l12.147"></a><span id="l12.147" class="difflineminus">-    m_csPhone2.Empty();</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineminus">-    m_csPhone3.Empty();</span>
<a href="#l12.149"></a><span id="l12.149" class="difflineminus">-    m_csPhone4.Empty();</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineminus">-    m_csCustom1.Empty();</span>
<a href="#l12.151"></a><span id="l12.151" class="difflineminus">-    m_csCustom2.Empty();</span>
<a href="#l12.152"></a><span id="l12.152" class="difflineminus">-    m_csCustom3.Empty();</span>
<a href="#l12.153"></a><span id="l12.153" class="difflineminus">-    m_csCustom4.Empty();</span>
<a href="#l12.154"></a><span id="l12.154" class="difflineminus">-    m_csPhone5.Empty();</span>
<a href="#l12.155"></a><span id="l12.155" class="difflineminus">-    m_csAddress.Empty();</span>
<a href="#l12.156"></a><span id="l12.156" class="difflineminus">-    m_csCity.Empty();</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineminus">-    m_csState.Empty();</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineminus">-    m_csZipCode.Empty();</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineminus">-    m_csCountry.Empty();</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineminus">-    m_csNote.Empty();</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineminus">-}</span>
<a href="#l12.162"></a><span id="l12.162" class="difflineminus">-</span>
<a href="#l12.163"></a><span id="l12.163" class="difflineminus">-// this method compares this object with another MozAB Conduit record</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineminus">-eRecCompare CMozABConduitRecord::Compare(const CMozABConduitRecord &amp;rec)</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineminus">-{</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineminus">-    if ( (m_dwPhone1LabelID != rec.m_dwPhone1LabelID) ||</span>
<a href="#l12.167"></a><span id="l12.167" class="difflineminus">-         (m_dwPhone2LabelID != rec.m_dwPhone2LabelID) ||</span>
<a href="#l12.168"></a><span id="l12.168" class="difflineminus">-         (m_dwPhone3LabelID != rec.m_dwPhone3LabelID ) ||</span>
<a href="#l12.169"></a><span id="l12.169" class="difflineminus">-         (m_dwPhone4LabelID != rec.m_dwPhone4LabelID ) ||</span>
<a href="#l12.170"></a><span id="l12.170" class="difflineminus">-         (m_dwPhone5LabelID != rec.m_dwPhone5LabelID ) ||</span>
<a href="#l12.171"></a><span id="l12.171" class="difflineminus">-         // comment this out until we can match 4.x's displayPhone algorithm</span>
<a href="#l12.172"></a><span id="l12.172" class="difflineminus">-//         (m_dwDisplayPhone !=  rec.m_dwDisplayPhone ) ||</span>
<a href="#l12.173"></a><span id="l12.173" class="difflineminus">-         (m_csName !=  rec.m_csName ) ||</span>
<a href="#l12.174"></a><span id="l12.174" class="difflineminus">-         (m_csFirst !=  rec.m_csFirst ) ||</span>
<a href="#l12.175"></a><span id="l12.175" class="difflineminus">-         (m_csTitle !=  rec.m_csTitle ) ||</span>
<a href="#l12.176"></a><span id="l12.176" class="difflineminus">-         (m_csCompany !=  rec.m_csCompany ) ||</span>
<a href="#l12.177"></a><span id="l12.177" class="difflineminus">-         (m_csPhone1 !=  rec.m_csPhone1 ) ||</span>
<a href="#l12.178"></a><span id="l12.178" class="difflineminus">-         (m_csPhone2 !=  rec.m_csPhone2 ) ||</span>
<a href="#l12.179"></a><span id="l12.179" class="difflineminus">-         (m_csPhone3 !=  rec.m_csPhone3 ) ||</span>
<a href="#l12.180"></a><span id="l12.180" class="difflineminus">-         (m_csPhone4 !=  rec.m_csPhone4 ) ||</span>
<a href="#l12.181"></a><span id="l12.181" class="difflineminus">-         (m_csCustom1 !=  rec.m_csCustom1 ) ||</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineminus">-         (m_csCustom2 !=  rec.m_csCustom2 ) ||</span>
<a href="#l12.183"></a><span id="l12.183" class="difflineminus">-         (m_csCustom3 !=  rec.m_csCustom3 ) ||</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineminus">-         (m_csCustom4 !=  rec.m_csCustom4 ) ||</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineminus">-         (m_csPhone5 !=  rec.m_csPhone5 ) ||</span>
<a href="#l12.186"></a><span id="l12.186" class="difflineminus">-         (m_csAddress !=  rec.m_csAddress ) ||</span>
<a href="#l12.187"></a><span id="l12.187" class="difflineminus">-         (m_csCity !=  rec.m_csCity ) ||</span>
<a href="#l12.188"></a><span id="l12.188" class="difflineminus">-         (m_csState !=  rec.m_csState ) ||</span>
<a href="#l12.189"></a><span id="l12.189" class="difflineminus">-         (m_csZipCode !=  rec.m_csZipCode ) ||</span>
<a href="#l12.190"></a><span id="l12.190" class="difflineminus">-         (m_csCountry !=  rec.m_csCountry ) ||</span>
<a href="#l12.191"></a><span id="l12.191" class="difflineminus">-         (m_csNote !=  rec.m_csNote ))</span>
<a href="#l12.192"></a><span id="l12.192" class="difflineminus">-         return eData;</span>
<a href="#l12.193"></a><span id="l12.193" class="difflineminus">-    if (m_dwPrivate != rec.m_dwPrivate ) </span>
<a href="#l12.194"></a><span id="l12.194" class="difflineminus">-        return ePrivateFlag;</span>
<a href="#l12.195"></a><span id="l12.195" class="difflineminus">-    if (m_dwCategoryID != rec.m_dwCategoryID ) </span>
<a href="#l12.196"></a><span id="l12.196" class="difflineminus">-        return eCategory;</span>
<a href="#l12.197"></a><span id="l12.197" class="difflineminus">-</span>
<a href="#l12.198"></a><span id="l12.198" class="difflineminus">-    return eEqual;</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineminus">-}</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineminus">-</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineminus">-#define COPY_FROM_GENERIC(m, d)  {  iLen = _tcslen((char *)pBuff);  \</span>
<a href="#l12.202"></a><span id="l12.202" class="difflineminus">-                                    CopyFromHHBuffer((char *)pBuff, m.GetBuffer(iLen * 2), iLen); \</span>
<a href="#l12.203"></a><span id="l12.203" class="difflineminus">-                                    m.ReleaseBuffer();              \</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineminus">-                                    d = m.GetBuffer(0);             \</span>
<a href="#l12.205"></a><span id="l12.205" class="difflineminus">-                                    pBuff += iLen + 1;              \</span>
<a href="#l12.206"></a><span id="l12.206" class="difflineminus">-                                 }                                  \</span>
<a href="#l12.207"></a><span id="l12.207" class="difflineminus">-</span>
<a href="#l12.208"></a><span id="l12.208" class="difflineminus">-#define COPY_PHONE_FROM_GENERIC(m, d){  iLen = _tcslen((char *)pBuff);              \</span>
<a href="#l12.209"></a><span id="l12.209" class="difflineminus">-                                        CopyFromHHBuffer((char *)pBuff, m.GetBuffer(iLen * 2), iLen); \</span>
<a href="#l12.210"></a><span id="l12.210" class="difflineminus">-                                        m.ReleaseBuffer();                          \</span>
<a href="#l12.211"></a><span id="l12.211" class="difflineminus">-                                        AssignPhoneToMozData(d, m.GetBuffer(0));    \</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineminus">-                                        pBuff += iLen + 1;                          \</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineminus">-                                     }                                              \</span>
<a href="#l12.214"></a><span id="l12.214" class="difflineminus">-</span>
<a href="#l12.215"></a><span id="l12.215" class="difflineminus">-</span>
<a href="#l12.216"></a><span id="l12.216" class="difflineminus">-// this method converts CPalmRecord to MozAB Conduit record </span>
<a href="#l12.217"></a><span id="l12.217" class="difflineminus">-long CMozABConduitRecord::ConvertFromGeneric(CPalmRecord &amp;rec)</span>
<a href="#l12.218"></a><span id="l12.218" class="difflineminus">-{</span>
<a href="#l12.219"></a><span id="l12.219" class="difflineminus">-    long                retval = 0;</span>
<a href="#l12.220"></a><span id="l12.220" class="difflineminus">-    BYTE                *pBuff;</span>
<a href="#l12.221"></a><span id="l12.221" class="difflineminus">-    AddrDBRecordFlags   flags;</span>
<a href="#l12.222"></a><span id="l12.222" class="difflineminus">-    AddrOptionsType     options;</span>
<a href="#l12.223"></a><span id="l12.223" class="difflineminus">-    int iLen;</span>
<a href="#l12.224"></a><span id="l12.224" class="difflineminus">-</span>
<a href="#l12.225"></a><span id="l12.225" class="difflineminus">-    Reset();</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineminus">-</span>
<a href="#l12.227"></a><span id="l12.227" class="difflineminus">-    if (rec.GetRawDataSize() == (sizeof(DWORD) + sizeof(DWORD) + sizeof(unsigned char))){</span>
<a href="#l12.228"></a><span id="l12.228" class="difflineminus">-        // then this is a deleted record because it has no data</span>
<a href="#l12.229"></a><span id="l12.229" class="difflineminus">-        return GEN_ERR_EMPTY_RECORD;</span>
<a href="#l12.230"></a><span id="l12.230" class="difflineminus">-    }</span>
<a href="#l12.231"></a><span id="l12.231" class="difflineminus">-</span>
<a href="#l12.232"></a><span id="l12.232" class="difflineminus">-    // palm specific data</span>
<a href="#l12.233"></a><span id="l12.233" class="difflineminus">-    m_dwRecordID = rec.GetID();</span>
<a href="#l12.234"></a><span id="l12.234" class="difflineminus">-    m_dwCategoryID = rec.GetCategory();</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineminus">-    m_dwPrivate    = rec.IsPrivate();</span>
<a href="#l12.236"></a><span id="l12.236" class="difflineminus">-    m_dwStatus = rec.GetStatus();</span>
<a href="#l12.237"></a><span id="l12.237" class="difflineminus">-</span>
<a href="#l12.238"></a><span id="l12.238" class="difflineminus">-    m_nsCard.dwRecordId = m_dwRecordID;</span>
<a href="#l12.239"></a><span id="l12.239" class="difflineminus">-    m_nsCard.dwCategoryId = m_dwCategoryID;</span>
<a href="#l12.240"></a><span id="l12.240" class="difflineminus">-    m_nsCard.dwStatus = m_dwStatus;</span>
<a href="#l12.241"></a><span id="l12.241" class="difflineminus">-</span>
<a href="#l12.242"></a><span id="l12.242" class="difflineminus">-    // clear all values in the Address Record</span>
<a href="#l12.243"></a><span id="l12.243" class="difflineminus">-    m_dwPhone1LabelID = PHONE_LABEL_WORK;</span>
<a href="#l12.244"></a><span id="l12.244" class="difflineminus">-    m_dwPhone2LabelID = PHONE_LABEL_HOME;</span>
<a href="#l12.245"></a><span id="l12.245" class="difflineminus">-    m_dwPhone3LabelID = PHONE_LABEL_FAX;</span>
<a href="#l12.246"></a><span id="l12.246" class="difflineminus">-    m_dwPhone4LabelID = PHONE_LABEL_MOBILE;</span>
<a href="#l12.247"></a><span id="l12.247" class="difflineminus">-    m_dwPhone5LabelID = PHONE_LABEL_EMAIL;</span>
<a href="#l12.248"></a><span id="l12.248" class="difflineminus">-    m_dwDisplayPhone = m_nsCard.preferredPhoneNum;</span>
<a href="#l12.249"></a><span id="l12.249" class="difflineminus">-</span>
<a href="#l12.250"></a><span id="l12.250" class="difflineminus">-    DWORD dwRawSize = rec.GetRawDataSize();</span>
<a href="#l12.251"></a><span id="l12.251" class="difflineminus">-    if (!dwRawSize) {</span>
<a href="#l12.252"></a><span id="l12.252" class="difflineminus">-        // invalid record</span>
<a href="#l12.253"></a><span id="l12.253" class="difflineminus">-        return 0;</span>
<a href="#l12.254"></a><span id="l12.254" class="difflineminus">-    }</span>
<a href="#l12.255"></a><span id="l12.255" class="difflineminus">-</span>
<a href="#l12.256"></a><span id="l12.256" class="difflineminus">-    // get the data for moz card</span>
<a href="#l12.257"></a><span id="l12.257" class="difflineminus">-    pBuff = rec.GetRawData();</span>
<a href="#l12.258"></a><span id="l12.258" class="difflineminus">-</span>
<a href="#l12.259"></a><span id="l12.259" class="difflineminus">-    // AddrOptionsType</span>
<a href="#l12.260"></a><span id="l12.260" class="difflineminus">-    *(DWORD *)&amp;options = CPalmRecord::SwapDWordToIntel(*((DWORD*)pBuff));</span>
<a href="#l12.261"></a><span id="l12.261" class="difflineminus">-    m_dwDisplayPhone  = (long)options.displayPhone + 1;</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineminus">-    m_dwPhone1LabelID = (DWORD)options.phone1;</span>
<a href="#l12.263"></a><span id="l12.263" class="difflineminus">-    m_dwPhone2LabelID = (DWORD)options.phone2;</span>
<a href="#l12.264"></a><span id="l12.264" class="difflineminus">-    m_dwPhone3LabelID = (DWORD)options.phone3;</span>
<a href="#l12.265"></a><span id="l12.265" class="difflineminus">-    m_dwPhone4LabelID = (DWORD)options.phone4;</span>
<a href="#l12.266"></a><span id="l12.266" class="difflineminus">-    m_dwPhone5LabelID = (DWORD)options.phone5;</span>
<a href="#l12.267"></a><span id="l12.267" class="difflineminus">-</span>
<a href="#l12.268"></a><span id="l12.268" class="difflineminus">-    pBuff += sizeof(DWORD);</span>
<a href="#l12.269"></a><span id="l12.269" class="difflineminus">-</span>
<a href="#l12.270"></a><span id="l12.270" class="difflineminus">-    // The flag bits are used to indicate which fields exist</span>
<a href="#l12.271"></a><span id="l12.271" class="difflineminus">-    *(DWORD *)&amp;flags = CPalmRecord::SwapDWordToIntel(*((DWORD*)pBuff));</span>
<a href="#l12.272"></a><span id="l12.272" class="difflineminus">-    pBuff += sizeof(DWORD) + sizeof(unsigned char);</span>
<a href="#l12.273"></a><span id="l12.273" class="difflineminus">-</span>
<a href="#l12.274"></a><span id="l12.274" class="difflineminus">-    // Name</span>
<a href="#l12.275"></a><span id="l12.275" class="difflineminus">-    if (flags.name) COPY_FROM_GENERIC(m_csName, m_nsCard.lastName)</span>
<a href="#l12.276"></a><span id="l12.276" class="difflineminus">-    // FirstName</span>
<a href="#l12.277"></a><span id="l12.277" class="difflineminus">-    if (flags.firstName) COPY_FROM_GENERIC(m_csFirst, m_nsCard.firstName)</span>
<a href="#l12.278"></a><span id="l12.278" class="difflineminus">-    // DisplayName</span>
<a href="#l12.279"></a><span id="l12.279" class="difflineminus">-    m_csDisplayName = m_nsCard.firstName;</span>
<a href="#l12.280"></a><span id="l12.280" class="difflineminus">-    m_csDisplayName += &quot; &quot;;</span>
<a href="#l12.281"></a><span id="l12.281" class="difflineminus">-    m_csDisplayName += m_nsCard.lastName;</span>
<a href="#l12.282"></a><span id="l12.282" class="difflineminus">-    m_nsCard.displayName = m_csDisplayName.GetBuffer(0);</span>
<a href="#l12.283"></a><span id="l12.283" class="difflineminus">-    // Company</span>
<a href="#l12.284"></a><span id="l12.284" class="difflineminus">-    if (flags.company) COPY_FROM_GENERIC(m_csCompany, m_nsCard.company)</span>
<a href="#l12.285"></a><span id="l12.285" class="difflineminus">-    // Phones</span>
<a href="#l12.286"></a><span id="l12.286" class="difflineminus">-    if (flags.phone1) COPY_PHONE_FROM_GENERIC(m_csPhone1, m_dwPhone1LabelID)</span>
<a href="#l12.287"></a><span id="l12.287" class="difflineminus">-    if (flags.phone2) COPY_PHONE_FROM_GENERIC(m_csPhone2, m_dwPhone2LabelID)</span>
<a href="#l12.288"></a><span id="l12.288" class="difflineminus">-    if (flags.phone3) COPY_PHONE_FROM_GENERIC(m_csPhone3, m_dwPhone3LabelID)</span>
<a href="#l12.289"></a><span id="l12.289" class="difflineminus">-    if (flags.phone4) COPY_PHONE_FROM_GENERIC(m_csPhone4, m_dwPhone4LabelID)</span>
<a href="#l12.290"></a><span id="l12.290" class="difflineminus">-    if (flags.phone5) COPY_PHONE_FROM_GENERIC(m_csPhone5, m_dwPhone5LabelID)</span>
<a href="#l12.291"></a><span id="l12.291" class="difflineminus">-    // Address</span>
<a href="#l12.292"></a><span id="l12.292" class="difflineminus">-    if (flags.address) </span>
<a href="#l12.293"></a><span id="l12.293" class="difflineminus">-    {</span>
<a href="#l12.294"></a><span id="l12.294" class="difflineminus">-      if (MozABPCManager::gUseHomeAddress)</span>
<a href="#l12.295"></a><span id="l12.295" class="difflineminus">-        COPY_FROM_GENERIC(m_csAddress, m_nsCard.homeAddress)</span>
<a href="#l12.296"></a><span id="l12.296" class="difflineminus">-      else</span>
<a href="#l12.297"></a><span id="l12.297" class="difflineminus">-         COPY_FROM_GENERIC(m_csAddress, m_nsCard.workAddress)</span>
<a href="#l12.298"></a><span id="l12.298" class="difflineminus">-</span>
<a href="#l12.299"></a><span id="l12.299" class="difflineminus">-//      CONDUIT_LOG4(gFD, &quot;\nConvertFromGeneric gUseHomeAddress = %s card home address = %s card work address = %s result = %s\n&quot;, </span>
<a href="#l12.300"></a><span id="l12.300" class="difflineminus">-//        (MozABPCManager::gUseHomeAddress) ? &quot;true&quot; : &quot;false&quot;, (char *) m_nsCard.homeAddress, (char *) m_nsCard.workAddress, (char *) m_csAddress);</span>
<a href="#l12.301"></a><span id="l12.301" class="difflineminus">-    }</span>
<a href="#l12.302"></a><span id="l12.302" class="difflineminus">-    // City</span>
<a href="#l12.303"></a><span id="l12.303" class="difflineminus">-    if (flags.city) </span>
<a href="#l12.304"></a><span id="l12.304" class="difflineminus">-    {</span>
<a href="#l12.305"></a><span id="l12.305" class="difflineminus">-      if (MozABPCManager::gUseHomeAddress)</span>
<a href="#l12.306"></a><span id="l12.306" class="difflineminus">-        COPY_FROM_GENERIC(m_csCity, m_nsCard.homeCity)</span>
<a href="#l12.307"></a><span id="l12.307" class="difflineminus">-      else</span>
<a href="#l12.308"></a><span id="l12.308" class="difflineminus">-        COPY_FROM_GENERIC(m_csCity, m_nsCard.workCity)</span>
<a href="#l12.309"></a><span id="l12.309" class="difflineminus">-    }</span>
<a href="#l12.310"></a><span id="l12.310" class="difflineminus">-    // State</span>
<a href="#l12.311"></a><span id="l12.311" class="difflineminus">-    if (flags.state) </span>
<a href="#l12.312"></a><span id="l12.312" class="difflineminus">-    {</span>
<a href="#l12.313"></a><span id="l12.313" class="difflineminus">-      if (MozABPCManager::gUseHomeAddress)</span>
<a href="#l12.314"></a><span id="l12.314" class="difflineminus">-        COPY_FROM_GENERIC(m_csState, m_nsCard.homeState)</span>
<a href="#l12.315"></a><span id="l12.315" class="difflineminus">-      else</span>
<a href="#l12.316"></a><span id="l12.316" class="difflineminus">-        COPY_FROM_GENERIC(m_csState, m_nsCard.workState)</span>
<a href="#l12.317"></a><span id="l12.317" class="difflineminus">-    }</span>
<a href="#l12.318"></a><span id="l12.318" class="difflineminus">-    // ZipCode</span>
<a href="#l12.319"></a><span id="l12.319" class="difflineminus">-    if (flags.zipCode) </span>
<a href="#l12.320"></a><span id="l12.320" class="difflineminus">-    {</span>
<a href="#l12.321"></a><span id="l12.321" class="difflineminus">-      if (MozABPCManager::gUseHomeAddress)</span>
<a href="#l12.322"></a><span id="l12.322" class="difflineminus">-        COPY_FROM_GENERIC(m_csZipCode, m_nsCard.homeZipCode)</span>
<a href="#l12.323"></a><span id="l12.323" class="difflineminus">-      else</span>
<a href="#l12.324"></a><span id="l12.324" class="difflineminus">-        COPY_FROM_GENERIC(m_csZipCode, m_nsCard.workZipCode)</span>
<a href="#l12.325"></a><span id="l12.325" class="difflineminus">-    }</span>
<a href="#l12.326"></a><span id="l12.326" class="difflineminus">-    // Country</span>
<a href="#l12.327"></a><span id="l12.327" class="difflineminus">-    if (flags.country)</span>
<a href="#l12.328"></a><span id="l12.328" class="difflineminus">-    {</span>
<a href="#l12.329"></a><span id="l12.329" class="difflineminus">-      if (MozABPCManager::gUseHomeAddress)</span>
<a href="#l12.330"></a><span id="l12.330" class="difflineminus">-        COPY_FROM_GENERIC(m_csCountry, m_nsCard.homeCountry)</span>
<a href="#l12.331"></a><span id="l12.331" class="difflineminus">-      else</span>
<a href="#l12.332"></a><span id="l12.332" class="difflineminus">-        COPY_FROM_GENERIC(m_csCountry, m_nsCard.workCountry)</span>
<a href="#l12.333"></a><span id="l12.333" class="difflineminus">-    }</span>
<a href="#l12.334"></a><span id="l12.334" class="difflineminus">-    // Title</span>
<a href="#l12.335"></a><span id="l12.335" class="difflineminus">-    if (flags.title) COPY_FROM_GENERIC(m_csTitle, m_nsCard.jobTitle)</span>
<a href="#l12.336"></a><span id="l12.336" class="difflineminus">-    // Customs</span>
<a href="#l12.337"></a><span id="l12.337" class="difflineminus">-    if (flags.custom1) COPY_FROM_GENERIC(m_csCustom1, m_nsCard.custom1)</span>
<a href="#l12.338"></a><span id="l12.338" class="difflineminus">-    if (flags.custom2) COPY_FROM_GENERIC(m_csCustom2, m_nsCard.custom2)</span>
<a href="#l12.339"></a><span id="l12.339" class="difflineminus">-    if (flags.custom3) COPY_FROM_GENERIC(m_csCustom3, m_nsCard.custom3)</span>
<a href="#l12.340"></a><span id="l12.340" class="difflineminus">-    if (flags.custom4) COPY_FROM_GENERIC(m_csCustom4, m_nsCard.custom4)</span>
<a href="#l12.341"></a><span id="l12.341" class="difflineminus">-    // Note</span>
<a href="#l12.342"></a><span id="l12.342" class="difflineminus">-    if (flags.note) COPY_FROM_GENERIC(m_csNote, m_nsCard.notes)</span>
<a href="#l12.343"></a><span id="l12.343" class="difflineminus">-</span>
<a href="#l12.344"></a><span id="l12.344" class="difflineminus">-    return retval;</span>
<a href="#l12.345"></a><span id="l12.345" class="difflineminus">-}</span>
<a href="#l12.346"></a><span id="l12.346" class="difflineminus">-</span>
<a href="#l12.347"></a><span id="l12.347" class="difflineminus">-// this method assigns the phone #s to the Moz card data from Palm Record Phone buffer</span>
<a href="#l12.348"></a><span id="l12.348" class="difflineminus">-void CMozABConduitRecord::AssignPhoneToMozData(DWORD labelID, LPTSTR buf)</span>
<a href="#l12.349"></a><span id="l12.349" class="difflineminus">-{</span>
<a href="#l12.350"></a><span id="l12.350" class="difflineminus">-    switch(labelID) {</span>
<a href="#l12.351"></a><span id="l12.351" class="difflineminus">-    case PHONE_LABEL_WORK:</span>
<a href="#l12.352"></a><span id="l12.352" class="difflineminus">-        m_nsCard.workPhone = buf;</span>
<a href="#l12.353"></a><span id="l12.353" class="difflineminus">-        break;</span>
<a href="#l12.354"></a><span id="l12.354" class="difflineminus">-    case PHONE_LABEL_HOME:</span>
<a href="#l12.355"></a><span id="l12.355" class="difflineminus">-        m_nsCard.homePhone = buf;</span>
<a href="#l12.356"></a><span id="l12.356" class="difflineminus">-        break;</span>
<a href="#l12.357"></a><span id="l12.357" class="difflineminus">-    case PHONE_LABEL_FAX:</span>
<a href="#l12.358"></a><span id="l12.358" class="difflineminus">-        m_nsCard.faxNumber = buf;</span>
<a href="#l12.359"></a><span id="l12.359" class="difflineminus">-        break;</span>
<a href="#l12.360"></a><span id="l12.360" class="difflineminus">-    case PHONE_LABEL_OTHER:</span>
<a href="#l12.361"></a><span id="l12.361" class="difflineminus">-        break;</span>
<a href="#l12.362"></a><span id="l12.362" class="difflineminus">-    case PHONE_LABEL_EMAIL:</span>
<a href="#l12.363"></a><span id="l12.363" class="difflineminus">-        m_nsCard.primaryEmail = buf;</span>
<a href="#l12.364"></a><span id="l12.364" class="difflineminus">-        break;</span>
<a href="#l12.365"></a><span id="l12.365" class="difflineminus">-    case PHONE_LABEL_MAIN:</span>
<a href="#l12.366"></a><span id="l12.366" class="difflineminus">-        break;</span>
<a href="#l12.367"></a><span id="l12.367" class="difflineminus">-    case PHONE_LABEL_PAGER:</span>
<a href="#l12.368"></a><span id="l12.368" class="difflineminus">-        m_nsCard.pagerNumber = buf;</span>
<a href="#l12.369"></a><span id="l12.369" class="difflineminus">-        break;</span>
<a href="#l12.370"></a><span id="l12.370" class="difflineminus">-    case PHONE_LABEL_MOBILE:</span>
<a href="#l12.371"></a><span id="l12.371" class="difflineminus">-        m_nsCard.cellularNumber = buf;</span>
<a href="#l12.372"></a><span id="l12.372" class="difflineminus">-        break;</span>
<a href="#l12.373"></a><span id="l12.373" class="difflineminus">-    }</span>
<a href="#l12.374"></a><span id="l12.374" class="difflineminus">-}</span>
<a href="#l12.375"></a><span id="l12.375" class="difflineminus">-</span>
<a href="#l12.376"></a><span id="l12.376" class="difflineminus">-</span>
<a href="#l12.377"></a><span id="l12.377" class="difflineminus">-#define COPY_TO_GENERIC(m, f)      iLen = m.length();           \</span>
<a href="#l12.378"></a><span id="l12.378" class="difflineminus">-                                   if (iLen != 0)               \</span>
<a href="#l12.379"></a><span id="l12.379" class="difflineminus">-                                   {                            \</span>
<a href="#l12.380"></a><span id="l12.380" class="difflineminus">-                                        f = 1;                  \</span>
<a href="#l12.381"></a><span id="l12.381" class="difflineminus">-                                        destLen = StripCRs(pBuff, m.c_str(), iLen);  \</span>
<a href="#l12.382"></a><span id="l12.382" class="difflineminus">-                                        pBuff += destLen;       \</span>
<a href="#l12.383"></a><span id="l12.383" class="difflineminus">-                                        dwRecSize += destLen;   \</span>
<a href="#l12.384"></a><span id="l12.384" class="difflineminus">-                                    }                           \</span>
<a href="#l12.385"></a><span id="l12.385" class="difflineminus">-</span>
<a href="#l12.386"></a><span id="l12.386" class="difflineminus">-</span>
<a href="#l12.387"></a><span id="l12.387" class="difflineminus">-// This method converts records from the Moz type to the CPalmRecord record type.</span>
<a href="#l12.388"></a><span id="l12.388" class="difflineminus">-long CMozABConduitRecord::ConvertToGeneric(CPalmRecord &amp;rec)</span>
<a href="#l12.389"></a><span id="l12.389" class="difflineminus">-{</span>
<a href="#l12.390"></a><span id="l12.390" class="difflineminus">-    long                retval = 0;</span>
<a href="#l12.391"></a><span id="l12.391" class="difflineminus">-    char                *pBuff, *pFlags, *pCompany, *pFirst;</span>
<a href="#l12.392"></a><span id="l12.392" class="difflineminus">-    AddrDBRecordFlags   flags;</span>
<a href="#l12.393"></a><span id="l12.393" class="difflineminus">-    AddrOptionsType     options;</span>
<a href="#l12.394"></a><span id="l12.394" class="difflineminus">-    int                 destLen;</span>
<a href="#l12.395"></a><span id="l12.395" class="difflineminus">-    BYTE                szRawData[MAX_RECORD_SIZE];</span>
<a href="#l12.396"></a><span id="l12.396" class="difflineminus">-    DWORD               dwRecSize = 0;</span>
<a href="#l12.397"></a><span id="l12.397" class="difflineminus">-    int                 iLen=0;</span>
<a href="#l12.398"></a><span id="l12.398" class="difflineminus">-</span>
<a href="#l12.399"></a><span id="l12.399" class="difflineminus">-</span>
<a href="#l12.400"></a><span id="l12.400" class="difflineminus">-    rec.SetID(m_dwRecordID);</span>
<a href="#l12.401"></a><span id="l12.401" class="difflineminus">-</span>
<a href="#l12.402"></a><span id="l12.402" class="difflineminus">-    rec.SetCategory(m_dwCategoryID);</span>
<a href="#l12.403"></a><span id="l12.403" class="difflineminus">-</span>
<a href="#l12.404"></a><span id="l12.404" class="difflineminus">-    rec.SetPrivate(m_dwPrivate);</span>
<a href="#l12.405"></a><span id="l12.405" class="difflineminus">-</span>
<a href="#l12.406"></a><span id="l12.406" class="difflineminus">-  	rec.SetAttribs(m_dwStatus);</span>
<a href="#l12.407"></a><span id="l12.407" class="difflineminus">-</span>
<a href="#l12.408"></a><span id="l12.408" class="difflineminus">-    pBuff = (char*)szRawData;</span>
<a href="#l12.409"></a><span id="l12.409" class="difflineminus">-</span>
<a href="#l12.410"></a><span id="l12.410" class="difflineminus">-    // AddrOptionsType</span>
<a href="#l12.411"></a><span id="l12.411" class="difflineminus">-    *(DWORD *)&amp;options = 0;</span>
<a href="#l12.412"></a><span id="l12.412" class="difflineminus">-    options.displayPhone = m_dwDisplayPhone - 1;</span>
<a href="#l12.413"></a><span id="l12.413" class="difflineminus">-    options.phone1 = LOWORD(m_dwPhone1LabelID);</span>
<a href="#l12.414"></a><span id="l12.414" class="difflineminus">-    options.phone2 = LOWORD(m_dwPhone2LabelID);</span>
<a href="#l12.415"></a><span id="l12.415" class="difflineminus">-    options.phone3 = LOWORD(m_dwPhone3LabelID);</span>
<a href="#l12.416"></a><span id="l12.416" class="difflineminus">-    options.phone4 = LOWORD(m_dwPhone4LabelID);</span>
<a href="#l12.417"></a><span id="l12.417" class="difflineminus">-    options.phone5 = LOWORD(m_dwPhone5LabelID);</span>
<a href="#l12.418"></a><span id="l12.418" class="difflineminus">-    *((DWORD *)pBuff) = CPalmRecord::SwapDWordToMotor(*(DWORD *)&amp;options);</span>
<a href="#l12.419"></a><span id="l12.419" class="difflineminus">-</span>
<a href="#l12.420"></a><span id="l12.420" class="difflineminus">-    pBuff += sizeof(DWORD);</span>
<a href="#l12.421"></a><span id="l12.421" class="difflineminus">-    dwRecSize += sizeof(DWORD);</span>
<a href="#l12.422"></a><span id="l12.422" class="difflineminus">-</span>
<a href="#l12.423"></a><span id="l12.423" class="difflineminus">-    // The flag bits are used to indicate which fields exist</span>
<a href="#l12.424"></a><span id="l12.424" class="difflineminus">-    pFlags = pBuff;</span>
<a href="#l12.425"></a><span id="l12.425" class="difflineminus">-    *(DWORD *)&amp;flags = 0;</span>
<a href="#l12.426"></a><span id="l12.426" class="difflineminus">-    pBuff += sizeof(DWORD);</span>
<a href="#l12.427"></a><span id="l12.427" class="difflineminus">-    dwRecSize += sizeof(DWORD);</span>
<a href="#l12.428"></a><span id="l12.428" class="difflineminus">-    </span>
<a href="#l12.429"></a><span id="l12.429" class="difflineminus">-    // Company Field Offset - Initialize to zero</span>
<a href="#l12.430"></a><span id="l12.430" class="difflineminus">-    pCompany = pBuff;</span>
<a href="#l12.431"></a><span id="l12.431" class="difflineminus">-    *((unsigned char *)pCompany) = 0;</span>
<a href="#l12.432"></a><span id="l12.432" class="difflineminus">-    pBuff += sizeof(unsigned char);</span>
<a href="#l12.433"></a><span id="l12.433" class="difflineminus">-    dwRecSize += sizeof(unsigned char);</span>
<a href="#l12.434"></a><span id="l12.434" class="difflineminus">-    </span>
<a href="#l12.435"></a><span id="l12.435" class="difflineminus">-    // First Field</span>
<a href="#l12.436"></a><span id="l12.436" class="difflineminus">-    pFirst = pBuff;</span>
<a href="#l12.437"></a><span id="l12.437" class="difflineminus">-</span>
<a href="#l12.438"></a><span id="l12.438" class="difflineminus">-    // Name</span>
<a href="#l12.439"></a><span id="l12.439" class="difflineminus">-    COPY_TO_GENERIC(m_csName, flags.name)</span>
<a href="#l12.440"></a><span id="l12.440" class="difflineminus">-    // FirstName</span>
<a href="#l12.441"></a><span id="l12.441" class="difflineminus">-    COPY_TO_GENERIC(m_csFirst, flags.firstName)</span>
<a href="#l12.442"></a><span id="l12.442" class="difflineminus">-    // Company</span>
<a href="#l12.443"></a><span id="l12.443" class="difflineminus">-    COPY_TO_GENERIC(m_csCompany, flags.company)</span>
<a href="#l12.444"></a><span id="l12.444" class="difflineminus">-    // Phone1</span>
<a href="#l12.445"></a><span id="l12.445" class="difflineminus">-    COPY_TO_GENERIC(m_csPhone1, flags.phone1)</span>
<a href="#l12.446"></a><span id="l12.446" class="difflineminus">-    // Phone2</span>
<a href="#l12.447"></a><span id="l12.447" class="difflineminus">-    COPY_TO_GENERIC(m_csPhone2, flags.phone2)</span>
<a href="#l12.448"></a><span id="l12.448" class="difflineminus">-    // Phone3</span>
<a href="#l12.449"></a><span id="l12.449" class="difflineminus">-    COPY_TO_GENERIC(m_csPhone3, flags.phone3)</span>
<a href="#l12.450"></a><span id="l12.450" class="difflineminus">-    // Phone4</span>
<a href="#l12.451"></a><span id="l12.451" class="difflineminus">-    COPY_TO_GENERIC(m_csPhone4, flags.phone4)</span>
<a href="#l12.452"></a><span id="l12.452" class="difflineminus">-    // Phone5</span>
<a href="#l12.453"></a><span id="l12.453" class="difflineminus">-    COPY_TO_GENERIC(m_csPhone5, flags.phone5)</span>
<a href="#l12.454"></a><span id="l12.454" class="difflineminus">-    // Address</span>
<a href="#l12.455"></a><span id="l12.455" class="difflineminus">-    COPY_TO_GENERIC(m_csAddress, flags.address)</span>
<a href="#l12.456"></a><span id="l12.456" class="difflineminus">-    // City</span>
<a href="#l12.457"></a><span id="l12.457" class="difflineminus">-    COPY_TO_GENERIC(m_csCity, flags.city)</span>
<a href="#l12.458"></a><span id="l12.458" class="difflineminus">-    // State</span>
<a href="#l12.459"></a><span id="l12.459" class="difflineminus">-    COPY_TO_GENERIC(m_csState, flags.state)</span>
<a href="#l12.460"></a><span id="l12.460" class="difflineminus">-    // ZipCode</span>
<a href="#l12.461"></a><span id="l12.461" class="difflineminus">-    COPY_TO_GENERIC(m_csZipCode, flags.zipCode)</span>
<a href="#l12.462"></a><span id="l12.462" class="difflineminus">-    // Country</span>
<a href="#l12.463"></a><span id="l12.463" class="difflineminus">-    COPY_TO_GENERIC(m_csCountry, flags.country)</span>
<a href="#l12.464"></a><span id="l12.464" class="difflineminus">-    // Title</span>
<a href="#l12.465"></a><span id="l12.465" class="difflineminus">-    COPY_TO_GENERIC(m_csTitle, flags.title)</span>
<a href="#l12.466"></a><span id="l12.466" class="difflineminus">-    // Custom1</span>
<a href="#l12.467"></a><span id="l12.467" class="difflineminus">-    COPY_TO_GENERIC(m_csCustom1, flags.custom1)</span>
<a href="#l12.468"></a><span id="l12.468" class="difflineminus">-    // Custom2</span>
<a href="#l12.469"></a><span id="l12.469" class="difflineminus">-    COPY_TO_GENERIC(m_csCustom2, flags.custom2)</span>
<a href="#l12.470"></a><span id="l12.470" class="difflineminus">-    // Custom3</span>
<a href="#l12.471"></a><span id="l12.471" class="difflineminus">-    COPY_TO_GENERIC(m_csCustom3, flags.custom3)</span>
<a href="#l12.472"></a><span id="l12.472" class="difflineminus">-    // Custom4</span>
<a href="#l12.473"></a><span id="l12.473" class="difflineminus">-    COPY_TO_GENERIC(m_csCustom4, flags.custom4)</span>
<a href="#l12.474"></a><span id="l12.474" class="difflineminus">-    // Note</span>
<a href="#l12.475"></a><span id="l12.475" class="difflineminus">-    COPY_TO_GENERIC(m_csNote, flags.note)</span>
<a href="#l12.476"></a><span id="l12.476" class="difflineminus">-</span>
<a href="#l12.477"></a><span id="l12.477" class="difflineminus">-    // Store the AddrDBRecordFlags</span>
<a href="#l12.478"></a><span id="l12.478" class="difflineminus">-    *((DWORD *)pFlags) = CPalmRecord::SwapDWordToMotor(*(DWORD *)&amp;flags);</span>
<a href="#l12.479"></a><span id="l12.479" class="difflineminus">-</span>
<a href="#l12.480"></a><span id="l12.480" class="difflineminus">-    </span>
<a href="#l12.481"></a><span id="l12.481" class="difflineminus">-    if (dwRecSize == (sizeof(DWORD) + sizeof(DWORD) + sizeof(unsigned char))){</span>
<a href="#l12.482"></a><span id="l12.482" class="difflineminus">-        // then this is a deleted record because it has no data</span>
<a href="#l12.483"></a><span id="l12.483" class="difflineminus">-        rec.SetDeleted();</span>
<a href="#l12.484"></a><span id="l12.484" class="difflineminus">-    }</span>
<a href="#l12.485"></a><span id="l12.485" class="difflineminus">-</span>
<a href="#l12.486"></a><span id="l12.486" class="difflineminus">-    retval = rec.SetRawData(dwRecSize, szRawData);</span>
<a href="#l12.487"></a><span id="l12.487" class="difflineminus">-</span>
<a href="#l12.488"></a><span id="l12.488" class="difflineminus">-    return(retval);</span>
<a href="#l12.489"></a><span id="l12.489" class="difflineminus">-}</span>
<a href="#l12.490"></a><span id="l12.490" class="difflineminus">-</span>
<a href="#l12.491"></a><span id="l12.491" class="difflineminus">-// this function copies data from the handheld into the passed destination,</span>
<a href="#l12.492"></a><span id="l12.492" class="difflineminus">-// and optionally adds carriage returns to handheld data</span>
<a href="#l12.493"></a><span id="l12.493" class="difflineminus">-long CMozABConduitRecord::CopyFromHHBuffer(TCHAR* pSrc, TCHAR* pDest, int len)</span>
<a href="#l12.494"></a><span id="l12.494" class="difflineminus">-{</span>
<a href="#l12.495"></a><span id="l12.495" class="difflineminus">-    long retval = GEN_ERR_INVALID_POINTER;</span>
<a href="#l12.496"></a><span id="l12.496" class="difflineminus">-    int off=0;</span>
<a href="#l12.497"></a><span id="l12.497" class="difflineminus">-</span>
<a href="#l12.498"></a><span id="l12.498" class="difflineminus">-    TCHAR* pCurr;</span>
<a href="#l12.499"></a><span id="l12.499" class="difflineminus">-</span>
<a href="#l12.500"></a><span id="l12.500" class="difflineminus">-    if (pDest) {</span>
<a href="#l12.501"></a><span id="l12.501" class="difflineminus">-</span>
<a href="#l12.502"></a><span id="l12.502" class="difflineminus">-        // Only add Cr's if newlines are present..</span>
<a href="#l12.503"></a><span id="l12.503" class="difflineminus">-        pCurr = (TCHAR*) _tcspbrk(pSrc, STR_NEWLINE);</span>
<a href="#l12.504"></a><span id="l12.504" class="difflineminus">-        if(pCurr) </span>
<a href="#l12.505"></a><span id="l12.505" class="difflineminus">-        {</span>
<a href="#l12.506"></a><span id="l12.506" class="difflineminus">-            while (off &lt; len &amp;&amp; *pSrc)</span>
<a href="#l12.507"></a><span id="l12.507" class="difflineminus">-            {</span>
<a href="#l12.508"></a><span id="l12.508" class="difflineminus">-                if (*pSrc == CH_NEWLINE)</span>
<a href="#l12.509"></a><span id="l12.509" class="difflineminus">-                {</span>
<a href="#l12.510"></a><span id="l12.510" class="difflineminus">-                    *pDest = CH_CRETURN;</span>
<a href="#l12.511"></a><span id="l12.511" class="difflineminus">-                    pDest++;</span>
<a href="#l12.512"></a><span id="l12.512" class="difflineminus">-                }</span>
<a href="#l12.513"></a><span id="l12.513" class="difflineminus">-                *pDest = *pSrc;</span>
<a href="#l12.514"></a><span id="l12.514" class="difflineminus">-</span>
<a href="#l12.515"></a><span id="l12.515" class="difflineminus">-                pDest++ ; pSrc++;</span>
<a href="#l12.516"></a><span id="l12.516" class="difflineminus">-                off++;</span>
<a href="#l12.517"></a><span id="l12.517" class="difflineminus">-            }</span>
<a href="#l12.518"></a><span id="l12.518" class="difflineminus">-            *pDest = 0;</span>
<a href="#l12.519"></a><span id="l12.519" class="difflineminus">-        }</span>
<a href="#l12.520"></a><span id="l12.520" class="difflineminus">-        else </span>
<a href="#l12.521"></a><span id="l12.521" class="difflineminus">-        {</span>
<a href="#l12.522"></a><span id="l12.522" class="difflineminus">-            strncpy(pDest, pSrc, len);</span>
<a href="#l12.523"></a><span id="l12.523" class="difflineminus">-            pDest[len] = 0;</span>
<a href="#l12.524"></a><span id="l12.524" class="difflineminus">-        }</span>
<a href="#l12.525"></a><span id="l12.525" class="difflineminus">-        retval = 0;</span>
<a href="#l12.526"></a><span id="l12.526" class="difflineminus">-    }</span>
<a href="#l12.527"></a><span id="l12.527" class="difflineminus">-    return(retval);</span>
<a href="#l12.528"></a><span id="l12.528" class="difflineminus">-}</span>
<a href="#l12.529"></a><span id="l12.529" class="difflineminus">-</span>
<a href="#l12.530"></a><span id="l12.530" class="difflineminus">-// this function strips extra carraige returns from PC data</span>
<a href="#l12.531"></a><span id="l12.531" class="difflineminus">-int CMozABConduitRecord::StripCRs(TCHAR* pDest, const TCHAR* pSrc, int len)</span>
<a href="#l12.532"></a><span id="l12.532" class="difflineminus">-{</span>
<a href="#l12.533"></a><span id="l12.533" class="difflineminus">-    int  retval = 0;</span>
<a href="#l12.534"></a><span id="l12.534" class="difflineminus">-    int  off    = 0;</span>
<a href="#l12.535"></a><span id="l12.535" class="difflineminus">-    TCHAR* pCurr; </span>
<a href="#l12.536"></a><span id="l12.536" class="difflineminus">-    TCHAR* pStart = pDest;</span>
<a href="#l12.537"></a><span id="l12.537" class="difflineminus">-</span>
<a href="#l12.538"></a><span id="l12.538" class="difflineminus">-    // See if any cr's are present in the first place.</span>
<a href="#l12.539"></a><span id="l12.539" class="difflineminus">-    pCurr = (TCHAR*) _tcspbrk(pSrc, STR_CRETURN);</span>
<a href="#l12.540"></a><span id="l12.540" class="difflineminus">-    if (pCurr)</span>
<a href="#l12.541"></a><span id="l12.541" class="difflineminus">-    {</span>
<a href="#l12.542"></a><span id="l12.542" class="difflineminus">-        while (off &lt; len &amp;&amp; *pSrc)</span>
<a href="#l12.543"></a><span id="l12.543" class="difflineminus">-        {</span>
<a href="#l12.544"></a><span id="l12.544" class="difflineminus">-            if (*pSrc == CH_CRETURN)</span>
<a href="#l12.545"></a><span id="l12.545" class="difflineminus">-                pSrc++;</span>
<a href="#l12.546"></a><span id="l12.546" class="difflineminus">-</span>
<a href="#l12.547"></a><span id="l12.547" class="difflineminus">-            *pDest = *pSrc;</span>
<a href="#l12.548"></a><span id="l12.548" class="difflineminus">-</span>
<a href="#l12.549"></a><span id="l12.549" class="difflineminus">-            off++;</span>
<a href="#l12.550"></a><span id="l12.550" class="difflineminus">-            pDest++ ; pSrc++;</span>
<a href="#l12.551"></a><span id="l12.551" class="difflineminus">-        }</span>
<a href="#l12.552"></a><span id="l12.552" class="difflineminus">-        *pDest = 0;</span>
<a href="#l12.553"></a><span id="l12.553" class="difflineminus">-</span>
<a href="#l12.554"></a><span id="l12.554" class="difflineminus">-        retval = strlen(pStart) + 1;</span>
<a href="#l12.555"></a><span id="l12.555" class="difflineminus">-    }</span>
<a href="#l12.556"></a><span id="l12.556" class="difflineminus">-    else</span>
<a href="#l12.557"></a><span id="l12.557" class="difflineminus">-    {</span>
<a href="#l12.558"></a><span id="l12.558" class="difflineminus">-        strncpy(pDest, pSrc, len);</span>
<a href="#l12.559"></a><span id="l12.559" class="difflineminus">-        *(pDest + len) = '\0';</span>
<a href="#l12.560"></a><span id="l12.560" class="difflineminus">-        retval = len + 1;</span>
<a href="#l12.561"></a><span id="l12.561" class="difflineminus">-    }    </span>
<a href="#l12.562"></a><span id="l12.562" class="difflineminus">-</span>
<a href="#l12.563"></a><span id="l12.563" class="difflineminus">-    return(retval);</span>
<a href="#l12.564"></a><span id="l12.564" class="difflineminus">-}</span>
<a href="#l12.565"></a><span id="l12.565" class="difflineminus">-</span>
<a href="#l12.566"></a><span id="l12.566" class="difflineminus">-void CMozABConduitRecord::CleanUpABCOMCardStruct(nsABCOMCardStruct * card)</span>
<a href="#l12.567"></a><span id="l12.567" class="difflineminus">-{</span>
<a href="#l12.568"></a><span id="l12.568" class="difflineminus">-    if(!card)</span>
<a href="#l12.569"></a><span id="l12.569" class="difflineminus">-        return;</span>
<a href="#l12.570"></a><span id="l12.570" class="difflineminus">-</span>
<a href="#l12.571"></a><span id="l12.571" class="difflineminus">-    CoTaskMemFree(card-&gt;firstName);</span>
<a href="#l12.572"></a><span id="l12.572" class="difflineminus">-    CoTaskMemFree(card-&gt;lastName);</span>
<a href="#l12.573"></a><span id="l12.573" class="difflineminus">-    CoTaskMemFree(card-&gt;displayName);</span>
<a href="#l12.574"></a><span id="l12.574" class="difflineminus">-    CoTaskMemFree(card-&gt;nickName);</span>
<a href="#l12.575"></a><span id="l12.575" class="difflineminus">-    CoTaskMemFree(card-&gt;primaryEmail);</span>
<a href="#l12.576"></a><span id="l12.576" class="difflineminus">-    CoTaskMemFree(card-&gt;secondEmail);</span>
<a href="#l12.577"></a><span id="l12.577" class="difflineminus">-    CoTaskMemFree(card-&gt;workPhone);</span>
<a href="#l12.578"></a><span id="l12.578" class="difflineminus">-    CoTaskMemFree(card-&gt;homePhone);</span>
<a href="#l12.579"></a><span id="l12.579" class="difflineminus">-    CoTaskMemFree(card-&gt;faxNumber);</span>
<a href="#l12.580"></a><span id="l12.580" class="difflineminus">-    CoTaskMemFree(card-&gt;pagerNumber);</span>
<a href="#l12.581"></a><span id="l12.581" class="difflineminus">-    CoTaskMemFree(card-&gt;cellularNumber);</span>
<a href="#l12.582"></a><span id="l12.582" class="difflineminus">-    CoTaskMemFree(card-&gt;homeAddress);</span>
<a href="#l12.583"></a><span id="l12.583" class="difflineminus">-    CoTaskMemFree(card-&gt;homeAddress2);</span>
<a href="#l12.584"></a><span id="l12.584" class="difflineminus">-    CoTaskMemFree(card-&gt;homeCity);</span>
<a href="#l12.585"></a><span id="l12.585" class="difflineminus">-    CoTaskMemFree(card-&gt;homeState);</span>
<a href="#l12.586"></a><span id="l12.586" class="difflineminus">-    CoTaskMemFree(card-&gt;homeZipCode);</span>
<a href="#l12.587"></a><span id="l12.587" class="difflineminus">-    CoTaskMemFree(card-&gt;homeCountry);</span>
<a href="#l12.588"></a><span id="l12.588" class="difflineminus">-    CoTaskMemFree(card-&gt;workAddress);</span>
<a href="#l12.589"></a><span id="l12.589" class="difflineminus">-    CoTaskMemFree(card-&gt;workAddress2);</span>
<a href="#l12.590"></a><span id="l12.590" class="difflineminus">-    CoTaskMemFree(card-&gt;workCity);</span>
<a href="#l12.591"></a><span id="l12.591" class="difflineminus">-    CoTaskMemFree(card-&gt;workState);</span>
<a href="#l12.592"></a><span id="l12.592" class="difflineminus">-    CoTaskMemFree(card-&gt;workZipCode);</span>
<a href="#l12.593"></a><span id="l12.593" class="difflineminus">-    CoTaskMemFree(card-&gt;workCountry);</span>
<a href="#l12.594"></a><span id="l12.594" class="difflineminus">-    CoTaskMemFree(card-&gt;jobTitle);</span>
<a href="#l12.595"></a><span id="l12.595" class="difflineminus">-    CoTaskMemFree(card-&gt;department);</span>
<a href="#l12.596"></a><span id="l12.596" class="difflineminus">-    CoTaskMemFree(card-&gt;company);</span>
<a href="#l12.597"></a><span id="l12.597" class="difflineminus">-    CoTaskMemFree(card-&gt;webPage1);</span>
<a href="#l12.598"></a><span id="l12.598" class="difflineminus">-    CoTaskMemFree(card-&gt;webPage2);</span>
<a href="#l12.599"></a><span id="l12.599" class="difflineminus">-    CoTaskMemFree(card-&gt;birthYear);</span>
<a href="#l12.600"></a><span id="l12.600" class="difflineminus">-    CoTaskMemFree(card-&gt;birthMonth);</span>
<a href="#l12.601"></a><span id="l12.601" class="difflineminus">-    CoTaskMemFree(card-&gt;birthDay);</span>
<a href="#l12.602"></a><span id="l12.602" class="difflineminus">-    CoTaskMemFree(card-&gt;custom1);</span>
<a href="#l12.603"></a><span id="l12.603" class="difflineminus">-    CoTaskMemFree(card-&gt;custom2);</span>
<a href="#l12.604"></a><span id="l12.604" class="difflineminus">-    CoTaskMemFree(card-&gt;custom3);</span>
<a href="#l12.605"></a><span id="l12.605" class="difflineminus">-    CoTaskMemFree(card-&gt;custom4);</span>
<a href="#l12.606"></a><span id="l12.606" class="difflineminus">-    CoTaskMemFree(card-&gt;notes);</span>
<a href="#l12.607"></a><span id="l12.607" class="difflineminus">-    CoTaskMemFree(card-&gt;mailListURI);</span>
<a href="#l12.608"></a><span id="l12.608" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">deleted file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/MozABConduitRecord.h</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ /dev/null</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -1,166 +0,0 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineminus">- *</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">- *</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">- * License.</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">- *</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">- *</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">- *</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">- *</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">- *</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">- *</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-#ifndef __MOZABCONDUIT_RECORD_H_</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-#define __MOZABCONDUIT_RECORD_H_</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-#include &lt;syncmgr.h&gt;</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-#include &quot;CPString.h&quot;</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-#include &quot;CPalmRec.h&quot;</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-#include &lt;PGenErr.h&gt;</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-#include &lt;tables.h&gt;</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-#include &quot;IPalmSync.h&quot;</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineminus">-</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-// these identify the types of phone numbers in Palm record</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineminus">-#define PHONE_LABEL_WORK        0</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineminus">-#define PHONE_LABEL_HOME        1</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-#define PHONE_LABEL_FAX         2</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineminus">-#define PHONE_LABEL_OTHER       3</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineminus">-#define PHONE_LABEL_EMAIL       4</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-#define PHONE_LABEL_MAIN        5</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-#define PHONE_LABEL_PAGER       6</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-#define PHONE_LABEL_MOBILE      7</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineminus">-</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineminus">-// these are flags which says if a field in Palm record exist or not</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineminus">-struct AddrDBRecordFlags {</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-    unsigned name               :1;</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-    unsigned firstName          :1;</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-    unsigned company            :1;</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-    unsigned phone1             :1;</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineminus">-    unsigned phone2             :1;</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineminus">-    unsigned phone3             :1;</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineminus">-    unsigned phone4             :1;</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineminus">-    unsigned phone5             :1;</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineminus">-    unsigned address            :1;</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineminus">-    unsigned city               :1;</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineminus">-    unsigned state              :1;</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineminus">-    unsigned zipCode            :1;</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineminus">-    unsigned country            :1;</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineminus">-    unsigned title              :1;</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineminus">-    unsigned custom1            :1;</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineminus">-    unsigned custom2            :1;</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineminus">-    unsigned custom3            :1;</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineminus">-    unsigned custom4            :1;</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineminus">-    unsigned note               :1;</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineminus">-    unsigned reserved           :13;</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineminus">-};</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineminus">-</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-// these are the flag that identify the type of phone #s in Palm record</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-struct AddrOptionsType {</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-    unsigned phone1             :4;</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineminus">-    unsigned phone2             :4;</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineminus">-    unsigned phone3             :4;</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineminus">-    unsigned phone4             :4;</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineminus">-    unsigned phone5             :4;</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineminus">-    unsigned displayPhone       :4;</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineminus">-    unsigned reserved           :8;</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineminus">-};</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineminus">-</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineminus">-// class implementation that represents the Mozilla AB Record type </span>
<a href="#l13.100"></a><span id="l13.100" class="difflineminus">-// used along with Palm record type</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineminus">-class CMozABConduitRecord {</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineminus">-    </span>
<a href="#l13.103"></a><span id="l13.103" class="difflineminus">-public:</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineminus">-    CMozABConduitRecord(void);</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineminus">-    CMozABConduitRecord(CPalmRecord &amp;rec);</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineminus">-    CMozABConduitRecord(nsABCOMCardStruct &amp;rec);</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineminus">-    virtual ~CMozABConduitRecord();</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineminus">-</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineminus">-public:</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineminus">-    // Mozilla AB card data structure member</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineminus">-    nsABCOMCardStruct m_nsCard;</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineminus">-</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineminus">-    // the following data members are for Palm Record</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineminus">-    DWORD m_dwRecordID;</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineminus">-    DWORD m_dwStatus;</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineminus">-    DWORD m_dwPosition;</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineminus">-    CPString m_csName;</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineminus">-    CPString m_csFirst;</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineminus">-    CPString m_csDisplayName;</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineminus">-    CPString m_csTitle;</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineminus">-    CPString m_csCompany;</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineminus">-    DWORD m_dwPhone1LabelID;</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineminus">-    CPString m_csPhone1;</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineminus">-    DWORD m_dwPhone2LabelID;</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineminus">-    CPString m_csPhone2;</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineminus">-    DWORD m_dwPhone3LabelID;</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineminus">-    CPString m_csPhone3;</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineminus">-    DWORD m_dwPhone4LabelID;</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineminus">-    CPString m_csPhone4;</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineminus">-    DWORD m_dwPhone5LabelID;</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineminus">-    CPString m_csPhone5;</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineminus">-    CPString m_csAddress;</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineminus">-    CPString m_csCity;</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineminus">-    CPString m_csState;</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineminus">-    CPString m_csZipCode;</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineminus">-    CPString m_csCountry;</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineminus">-    CPString m_csNote;</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineminus">-    DWORD m_dwPrivate;</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineminus">-    DWORD m_dwCategoryID;</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineminus">-    CPString m_csCustom1;</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineminus">-    CPString m_csCustom2;</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineminus">-    CPString m_csCustom3;</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineminus">-    CPString m_csCustom4;</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineminus">-    DWORD m_dwDisplayPhone; </span>
<a href="#l13.145"></a><span id="l13.145" class="difflineminus">-</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineminus">-protected:</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineminus">-</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineminus">-    // internal utility functions</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineminus">-    long CopyFromHHBuffer(TCHAR* pSrc, TCHAR* pDest, int len, int iBufSize);</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineminus">-    long CopyFromHHBuffer(TCHAR* pSrc, TCHAR* pDest, int len);</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineminus">-    int  StripCRs(TCHAR* pDest, const TCHAR* pSrc, int len);</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineminus">-</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineminus">-    void AssignPhoneToMozData(DWORD labelID, LPTSTR buf);</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineminus">-</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineminus">-public:</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineminus">-    // rests the data in this record object   </span>
<a href="#l13.157"></a><span id="l13.157" class="difflineminus">-    void Reset(void);</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineminus">-    // compares with another record object</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineminus">-    eRecCompare Compare(const CMozABConduitRecord &amp;rec);</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineminus">-</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineminus">-    // converts from Palm record type to self(Mozilla AB) type</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineminus">-    long ConvertFromGeneric(CPalmRecord &amp;rec);</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineminus">-    // converts from self(Mozilla AB) type to Palm record type</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineminus">-    long ConvertToGeneric(CPalmRecord &amp;rec);</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineminus">-</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineminus">-    static void CleanUpABCOMCardStruct(nsABCOMCardStruct * card);</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineminus">-</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineminus">-};</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineminus">-</span>
<a href="#l13.170"></a><span id="l13.170" class="difflineminus">-#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">deleted file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/MozABConduitSync.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ /dev/null</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -1,1020 +0,0 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineminus">- *</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">- *</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">- * License.</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">- *</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">- *</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">- *</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">- *</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">- *</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">- *</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-#include &quot;syncmgr.h&quot;</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-#include &lt;tchar.h&gt;</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-#include &lt;time.h&gt;</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-#include &lt;stdlib.h&gt;</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-#include &lt;stdio.h&gt;</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-#include &quot;CondAPI.h&quot;</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-#include &quot;hslog.h&quot;</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-#include &quot;MozABConduitSync.h&quot;</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-#include &quot;MozABConduitRecord.h&quot;</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-#define MAX_PROD_ID_TEXT	255</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-#define PERSONAL &quot;Personal&quot;</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">-// Global var</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineminus">-FILE *gFD = NULL; // logging.</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">-</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-CMozABConduitSync::CMozABConduitSync(CSyncProperties&amp; rProps)</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineminus">-{</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineminus">-    m_dbHH = NULL;</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineminus">-    m_dbPC = NULL;</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">-    m_remoteDB = NULL;</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineminus">-    m_TotRemoteDBs = rProps.m_nRemoteCount; // Fixed 3/25/99 KRM</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineminus">-    m_ConduitHandle =  (CONDHANDLE)0;</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-    memcpy(&amp;m_rSyncProperties, &amp;rProps, sizeof(m_rSyncProperties));</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineminus">-    memset(&amp;m_SystemInfo, 0, sizeof(m_SystemInfo));</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineminus">-</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineminus">-    // See if logging is turned on (ie, check env variable &quot;MOZ_CONDUIT_LOG&quot;</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineminus">-    // for a logfile like &quot;c:\\temp\\conduitlog.txt&quot;).</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineminus">-    char *envVar = getenv(ENV_VAR_CONDUTI_LOG);</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineminus">-    if(envVar != NULL )</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineminus">-      gFD = fopen(envVar, &quot;a+&quot;);</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineminus">-}</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineminus">-</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineminus">-CMozABConduitSync::~CMozABConduitSync()</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-{</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-    long retval;</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineminus">-</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineminus">-    if (m_SystemInfo.m_ProductIdText) {</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-        delete m_SystemInfo.m_ProductIdText;</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-	    m_SystemInfo.m_ProductIdText = NULL;</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineminus">-	    m_SystemInfo.m_AllocedLen = 0; </span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-    }</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-    if ((!m_rSyncProperties.m_RemoteDbList) &amp;&amp; (m_remoteDB)) {</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-        delete m_remoteDB;</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-        m_remoteDB = NULL;</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineminus">-    }</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineminus">-    if (m_ConduitHandle) {</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineminus">-        retval = SyncUnRegisterConduit(m_ConduitHandle);</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineminus">-        m_ConduitHandle = 0;</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineminus">-    }</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineminus">-</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-    if (gFD)</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineminus">-      fclose(gFD);</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineminus">-}</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-long CMozABConduitSync::Perform(void)</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-{</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-    long retval = 0;</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-    // Log the start time.</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-    time_t ltime;</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-    time( &amp;ltime );</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-    CONDUIT_LOG1(gFD, &quot;\n------------ START OF PALM SYNC ------------ at %s&quot;, ctime(&amp;ltime));</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineminus">-</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineminus">-    if (m_rSyncProperties.m_SyncType &gt; eProfileInstall)</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-        return GEN_ERR_BAD_SYNC_TYPE;</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineminus">-</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineminus">-    if (m_rSyncProperties.m_SyncType == eDoNothing) {</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineminus">-        return 0;</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineminus">-    }</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineminus">-</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineminus">-    // Obtain System Information</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineminus">-    m_SystemInfo.m_ProductIdText = (BYTE*) new char [MAX_PROD_ID_TEXT]; //deleted in d'ctor</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineminus">-    if (!m_SystemInfo.m_ProductIdText)</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineminus">-        return GEN_ERR_LOW_MEMORY;</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineminus">-</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineminus">-    m_SystemInfo.m_AllocedLen = (BYTE) MAX_PROD_ID_TEXT; </span>
<a href="#l14.123"></a><span id="l14.123" class="difflineminus">-    retval = SyncReadSystemInfo(m_SystemInfo);</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineminus">-    if (retval)</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineminus">-        return retval;</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineminus">-</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineminus">-    // Register this conduit with SyncMgr.DLL for communication to HH</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineminus">-    retval = SyncRegisterConduit(m_ConduitHandle);</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineminus">-    if (retval) {</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineminus">-        CONDUIT_LOG0(gFD, &quot;Failed SyncRegisterConduit.\n&quot;);</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineminus">-        return retval;</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineminus">-    }</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineminus">-</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineminus">-    for (int iCount=0; iCount &lt; m_TotRemoteDBs &amp;&amp; !retval; iCount++) {</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineminus">-        retval = GetRemoteDBInfo(iCount);</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineminus">-        if (retval) {</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineminus">-            retval = 0;</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineminus">-            break;</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineminus">-        }</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineminus">-</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineminus">-        m_dbHH = new MozABHHManager(GENERIC_FLAG_APPINFO_SUPPORTED | GENERIC_FLAG_CATEGORY_SUPPORTED,</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineminus">-                    m_remoteDB-&gt;m_Name,</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineminus">-                    m_remoteDB-&gt;m_Creator,</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineminus">-                    m_remoteDB-&gt;m_DbType,</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineminus">-                    m_remoteDB-&gt;m_DbFlags,</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineminus">-                    0,</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineminus">-					          m_remoteDB-&gt;m_CardNum,</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineminus">-                    m_rSyncProperties.m_SyncType);</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineminus">-        if(!m_dbHH) {</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineminus">-            CONDUIT_LOG0(gFD, &quot;Failed dbHH.\n&quot;);</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineminus">-            return GEN_ERR_LOW_MEMORY;</span>
<a href="#l14.152"></a><span id="l14.152" class="difflineminus">-        }</span>
<a href="#l14.153"></a><span id="l14.153" class="difflineminus">-</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineminus">-        m_dbPC = new MozABPCManager();</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineminus">-        if(!m_dbPC) {</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineminus">-            if (m_dbHH)</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineminus">-                delete m_dbHH;</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineminus">-            m_dbHH = NULL;</span>
<a href="#l14.159"></a><span id="l14.159" class="difflineminus">-            CONDUIT_LOG0(gFD, &quot;Failed dbPC.\n&quot;);</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineminus">-            return GEN_ERR_LOW_MEMORY;</span>
<a href="#l14.161"></a><span id="l14.161" class="difflineminus">-        }</span>
<a href="#l14.162"></a><span id="l14.162" class="difflineminus">-</span>
<a href="#l14.163"></a><span id="l14.163" class="difflineminus">-        char conduitName[32];</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineminus">-        GetConduitName(conduitName, 32);</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineminus">-        LogAddFormattedEntry(slSyncStarted, FALSE, &quot;SYNC %s&quot;, conduitName);</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineminus">-        CONDUIT_LOG1(gFD, &quot;slSyncStarted. SyncType=%d\n&quot;, m_rSyncProperties.m_SyncType);</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineminus">-</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineminus">-        switch (m_rSyncProperties.m_SyncType) {</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineminus">-            case eFast:</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineminus">-                retval = PerformFastSync();</span>
<a href="#l14.171"></a><span id="l14.171" class="difflineminus">-                if ((retval) &amp;&amp; (retval == GEN_ERR_CHANGE_SYNC_MODE)){</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineminus">-                    if (m_rSyncProperties.m_SyncType == eHHtoPC)</span>
<a href="#l14.173"></a><span id="l14.173" class="difflineminus">-                        retval = CopyHHtoPC();</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineminus">-                    else if (m_rSyncProperties.m_SyncType == ePCtoHH)</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineminus">-                        retval = CopyPCtoHH();</span>
<a href="#l14.176"></a><span id="l14.176" class="difflineminus">-                }</span>
<a href="#l14.177"></a><span id="l14.177" class="difflineminus">-                break;</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineminus">-            case eSlow:</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineminus">-                retval = PerformSlowSync();  </span>
<a href="#l14.180"></a><span id="l14.180" class="difflineminus">-                if ((retval) &amp;&amp; (retval == GEN_ERR_CHANGE_SYNC_MODE)){</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineminus">-                    if (m_rSyncProperties.m_SyncType == eHHtoPC)</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineminus">-                        retval = CopyHHtoPC();</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineminus">-                    else if (m_rSyncProperties.m_SyncType == ePCtoHH)</span>
<a href="#l14.184"></a><span id="l14.184" class="difflineminus">-                        retval = CopyPCtoHH();</span>
<a href="#l14.185"></a><span id="l14.185" class="difflineminus">-                }</span>
<a href="#l14.186"></a><span id="l14.186" class="difflineminus">-                break;</span>
<a href="#l14.187"></a><span id="l14.187" class="difflineminus">-            case eHHtoPC:</span>
<a href="#l14.188"></a><span id="l14.188" class="difflineminus">-            case eBackup: </span>
<a href="#l14.189"></a><span id="l14.189" class="difflineminus">-                retval = CopyHHtoPC();</span>
<a href="#l14.190"></a><span id="l14.190" class="difflineminus">-                break;</span>
<a href="#l14.191"></a><span id="l14.191" class="difflineminus">-            case eInstall:</span>
<a href="#l14.192"></a><span id="l14.192" class="difflineminus">-            case ePCtoHH:</span>
<a href="#l14.193"></a><span id="l14.193" class="difflineminus">-            case eProfileInstall:</span>
<a href="#l14.194"></a><span id="l14.194" class="difflineminus">-                retval = CopyPCtoHH();</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineminus">-                break;</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineminus">-            case eDoNothing:</span>
<a href="#l14.197"></a><span id="l14.197" class="difflineminus">-                break;</span>
<a href="#l14.198"></a><span id="l14.198" class="difflineminus">-            default:</span>
<a href="#l14.199"></a><span id="l14.199" class="difflineminus">-                retval = GEN_ERR_SYNC_TYPE_NOT_SUPPORTED;</span>
<a href="#l14.200"></a><span id="l14.200" class="difflineminus">-                break;</span>
<a href="#l14.201"></a><span id="l14.201" class="difflineminus">-        }</span>
<a href="#l14.202"></a><span id="l14.202" class="difflineminus">-</span>
<a href="#l14.203"></a><span id="l14.203" class="difflineminus">-        if (retval) {</span>
<a href="#l14.204"></a><span id="l14.204" class="difflineminus">-            LogAddFormattedEntry(slSyncAborted, FALSE, &quot;retval=%d %s\n&quot;, retval, conduitName);</span>
<a href="#l14.205"></a><span id="l14.205" class="difflineminus">-            CONDUIT_LOG1(gFD, &quot;Sync finished with errors retval=%d\n&quot;, retval);</span>
<a href="#l14.206"></a><span id="l14.206" class="difflineminus">-        }</span>
<a href="#l14.207"></a><span id="l14.207" class="difflineminus">-        else {</span>
<a href="#l14.208"></a><span id="l14.208" class="difflineminus">-            LogAddFormattedEntry(slSyncFinished, FALSE, &quot;%s&quot;, conduitName);</span>
<a href="#l14.209"></a><span id="l14.209" class="difflineminus">-            CONDUIT_LOG0(gFD, &quot;Sync Finished retval=0\n&quot;);</span>
<a href="#l14.210"></a><span id="l14.210" class="difflineminus">-        }</span>
<a href="#l14.211"></a><span id="l14.211" class="difflineminus">-</span>
<a href="#l14.212"></a><span id="l14.212" class="difflineminus">-        // remove the handheld and PC manager</span>
<a href="#l14.213"></a><span id="l14.213" class="difflineminus">-        if (m_dbHH)</span>
<a href="#l14.214"></a><span id="l14.214" class="difflineminus">-            delete m_dbHH;</span>
<a href="#l14.215"></a><span id="l14.215" class="difflineminus">-        m_dbHH = NULL;</span>
<a href="#l14.216"></a><span id="l14.216" class="difflineminus">-        if (m_dbPC)</span>
<a href="#l14.217"></a><span id="l14.217" class="difflineminus">-            delete m_dbPC;</span>
<a href="#l14.218"></a><span id="l14.218" class="difflineminus">-        m_dbPC = NULL;</span>
<a href="#l14.219"></a><span id="l14.219" class="difflineminus">-    }</span>
<a href="#l14.220"></a><span id="l14.220" class="difflineminus">-</span>
<a href="#l14.221"></a><span id="l14.221" class="difflineminus">-    // Log the end time.</span>
<a href="#l14.222"></a><span id="l14.222" class="difflineminus">-    time( &amp;ltime );</span>
<a href="#l14.223"></a><span id="l14.223" class="difflineminus">-    CONDUIT_LOG1(gFD, &quot;------------ END OF PALM SYNC -------------- at %s\n&quot;, ctime(&amp;ltime));</span>
<a href="#l14.224"></a><span id="l14.224" class="difflineminus">-</span>
<a href="#l14.225"></a><span id="l14.225" class="difflineminus">-    // Unregister the conduit</span>
<a href="#l14.226"></a><span id="l14.226" class="difflineminus">-    long retval2 = 0;</span>
<a href="#l14.227"></a><span id="l14.227" class="difflineminus">-    if (m_ConduitHandle) {</span>
<a href="#l14.228"></a><span id="l14.228" class="difflineminus">-        retval2 = SyncUnRegisterConduit(m_ConduitHandle);</span>
<a href="#l14.229"></a><span id="l14.229" class="difflineminus">-        m_ConduitHandle = 0;</span>
<a href="#l14.230"></a><span id="l14.230" class="difflineminus">-    }</span>
<a href="#l14.231"></a><span id="l14.231" class="difflineminus">-</span>
<a href="#l14.232"></a><span id="l14.232" class="difflineminus">-    if (!retval)</span>
<a href="#l14.233"></a><span id="l14.233" class="difflineminus">-        return retval2;</span>
<a href="#l14.234"></a><span id="l14.234" class="difflineminus">-</span>
<a href="#l14.235"></a><span id="l14.235" class="difflineminus">-    return retval;</span>
<a href="#l14.236"></a><span id="l14.236" class="difflineminus">-}</span>
<a href="#l14.237"></a><span id="l14.237" class="difflineminus">-</span>
<a href="#l14.238"></a><span id="l14.238" class="difflineminus">-long CMozABConduitSync::GetRemoteDBInfo(int iIndex)</span>
<a href="#l14.239"></a><span id="l14.239" class="difflineminus">-{</span>
<a href="#l14.240"></a><span id="l14.240" class="difflineminus">-    long retval = 0;</span>
<a href="#l14.241"></a><span id="l14.241" class="difflineminus">-    if (m_rSyncProperties.m_RemoteDbList) {</span>
<a href="#l14.242"></a><span id="l14.242" class="difflineminus">-        m_remoteDB = m_rSyncProperties.m_RemoteDbList[iIndex];</span>
<a href="#l14.243"></a><span id="l14.243" class="difflineminus">-    } else {</span>
<a href="#l14.244"></a><span id="l14.244" class="difflineminus">-        if (m_remoteDB)</span>
<a href="#l14.245"></a><span id="l14.245" class="difflineminus">-            delete m_remoteDB;</span>
<a href="#l14.246"></a><span id="l14.246" class="difflineminus">-</span>
<a href="#l14.247"></a><span id="l14.247" class="difflineminus">-        m_remoteDB = new CDbList; // deleted in d'ctor</span>
<a href="#l14.248"></a><span id="l14.248" class="difflineminus">-        if (m_remoteDB) {</span>
<a href="#l14.249"></a><span id="l14.249" class="difflineminus">-            m_remoteDB-&gt;m_Creator  = m_rSyncProperties.m_Creator; </span>
<a href="#l14.250"></a><span id="l14.250" class="difflineminus">-            m_remoteDB-&gt;m_DbFlags  = eRecord; // todo</span>
<a href="#l14.251"></a><span id="l14.251" class="difflineminus">-            m_remoteDB-&gt;m_DbType   = m_rSyncProperties.m_DbType; </span>
<a href="#l14.252"></a><span id="l14.252" class="difflineminus">-            strncpy(m_remoteDB-&gt;m_Name, m_rSyncProperties.m_RemoteName[iIndex], sizeof(m_remoteDB-&gt;m_Name)-1);</span>
<a href="#l14.253"></a><span id="l14.253" class="difflineminus">-            m_remoteDB-&gt;m_Name[sizeof(m_remoteDB-&gt;m_Name)-1] = '\0';</span>
<a href="#l14.254"></a><span id="l14.254" class="difflineminus">-            m_remoteDB-&gt;m_Version   = 0;</span>
<a href="#l14.255"></a><span id="l14.255" class="difflineminus">-            m_remoteDB-&gt;m_CardNum   = 0;</span>
<a href="#l14.256"></a><span id="l14.256" class="difflineminus">-            m_remoteDB-&gt;m_ModNumber = 0;</span>
<a href="#l14.257"></a><span id="l14.257" class="difflineminus">-            m_remoteDB-&gt;m_CreateDate= 0;</span>
<a href="#l14.258"></a><span id="l14.258" class="difflineminus">-            m_remoteDB-&gt;m_ModDate   = 0;</span>
<a href="#l14.259"></a><span id="l14.259" class="difflineminus">-            m_remoteDB-&gt;m_BackupDate= 0;</span>
<a href="#l14.260"></a><span id="l14.260" class="difflineminus">-        } else {</span>
<a href="#l14.261"></a><span id="l14.261" class="difflineminus">-            retval = GEN_ERR_LOW_MEMORY;</span>
<a href="#l14.262"></a><span id="l14.262" class="difflineminus">-        }</span>
<a href="#l14.263"></a><span id="l14.263" class="difflineminus">-    }</span>
<a href="#l14.264"></a><span id="l14.264" class="difflineminus">-    return retval;</span>
<a href="#l14.265"></a><span id="l14.265" class="difflineminus">-}</span>
<a href="#l14.266"></a><span id="l14.266" class="difflineminus">-</span>
<a href="#l14.267"></a><span id="l14.267" class="difflineminus">-BOOL CMozABConduitSync::CategoryNameMatches(CPString &amp;catName, CPString &amp;cutOffMozABName, BOOL isPAB)</span>
<a href="#l14.268"></a><span id="l14.268" class="difflineminus">-{</span>
<a href="#l14.269"></a><span id="l14.269" class="difflineminus">-  if (!catName.CompareNoCase(cutOffMozABName.GetBuffer(0)))</span>
<a href="#l14.270"></a><span id="l14.270" class="difflineminus">-    return TRUE;</span>
<a href="#l14.271"></a><span id="l14.271" class="difflineminus">-  else </span>
<a href="#l14.272"></a><span id="l14.272" class="difflineminus">-    return (isPAB &amp;&amp; !catName.CompareNoCase(&quot;Personal&quot;));</span>
<a href="#l14.273"></a><span id="l14.273" class="difflineminus">-}</span>
<a href="#l14.274"></a><span id="l14.274" class="difflineminus">-</span>
<a href="#l14.275"></a><span id="l14.275" class="difflineminus">-BOOL CMozABConduitSync::CategoryExists(CPString &amp;mozABName, BOOL isPAB)</span>
<a href="#l14.276"></a><span id="l14.276" class="difflineminus">-{</span>
<a href="#l14.277"></a><span id="l14.277" class="difflineminus">-    CPCategory * pCategory = m_dbHH-&gt;GetFirstCategory();</span>
<a href="#l14.278"></a><span id="l14.278" class="difflineminus">-    // Palm only allows 15 chars for category names.</span>
<a href="#l14.279"></a><span id="l14.279" class="difflineminus">-    CPString cutOffName;</span>
<a href="#l14.280"></a><span id="l14.280" class="difflineminus">-    if (mozABName.Length() &gt; 15)</span>
<a href="#l14.281"></a><span id="l14.281" class="difflineminus">-        cutOffName = mozABName.Left(15);</span>
<a href="#l14.282"></a><span id="l14.282" class="difflineminus">-    else</span>
<a href="#l14.283"></a><span id="l14.283" class="difflineminus">-        cutOffName = mozABName;</span>
<a href="#l14.284"></a><span id="l14.284" class="difflineminus">-    while (pCategory)</span>
<a href="#l14.285"></a><span id="l14.285" class="difflineminus">-    {</span>
<a href="#l14.286"></a><span id="l14.286" class="difflineminus">-        CPString catName(pCategory-&gt;GetName());</span>
<a href="#l14.287"></a><span id="l14.287" class="difflineminus">-        if (CategoryNameMatches(catName, cutOffName, isPAB))</span>
<a href="#l14.288"></a><span id="l14.288" class="difflineminus">-          return TRUE;</span>
<a href="#l14.289"></a><span id="l14.289" class="difflineminus">-        // Process next category</span>
<a href="#l14.290"></a><span id="l14.290" class="difflineminus">-        pCategory = m_dbHH-&gt;GetNextCategory();</span>
<a href="#l14.291"></a><span id="l14.291" class="difflineminus">-    }</span>
<a href="#l14.292"></a><span id="l14.292" class="difflineminus">-    return FALSE;</span>
<a href="#l14.293"></a><span id="l14.293" class="difflineminus">-}</span>
<a href="#l14.294"></a><span id="l14.294" class="difflineminus">-</span>
<a href="#l14.295"></a><span id="l14.295" class="difflineminus">-// this is done in separate thread since the main thread in this DLL</span>
<a href="#l14.296"></a><span id="l14.296" class="difflineminus">-// needs to call SyncYieldCycles(1) atleast once every 7 seconds</span>
<a href="#l14.297"></a><span id="l14.297" class="difflineminus">-DWORD WINAPI DoFastSync(LPVOID lpParameter)</span>
<a href="#l14.298"></a><span id="l14.298" class="difflineminus">-{</span>
<a href="#l14.299"></a><span id="l14.299" class="difflineminus">-    CONDUIT_LOG0(gFD, &quot;-- SYNC DoFastSync --\n&quot;);</span>
<a href="#l14.300"></a><span id="l14.300" class="difflineminus">-</span>
<a href="#l14.301"></a><span id="l14.301" class="difflineminus">-    CMozABConduitSync * sync = (CMozABConduitSync * ) lpParameter;</span>
<a href="#l14.302"></a><span id="l14.302" class="difflineminus">-    if(!sync || !sync-&gt;m_dbHH)</span>
<a href="#l14.303"></a><span id="l14.303" class="difflineminus">-        return 0;</span>
<a href="#l14.304"></a><span id="l14.304" class="difflineminus">-    </span>
<a href="#l14.305"></a><span id="l14.305" class="difflineminus">-    BOOL initialHHSync = (sync-&gt;m_rSyncProperties.m_FirstDevice == eHH);</span>
<a href="#l14.306"></a><span id="l14.306" class="difflineminus">-    if (initialHHSync) // if HH has been reset, copy everything on pc to hh.</span>
<a href="#l14.307"></a><span id="l14.307" class="difflineminus">-      return sync-&gt;CopyPCtoHH();</span>
<a href="#l14.308"></a><span id="l14.308" class="difflineminus">-</span>
<a href="#l14.309"></a><span id="l14.309" class="difflineminus">-    long retval=0;</span>
<a href="#l14.310"></a><span id="l14.310" class="difflineminus">-    BOOL success = FALSE;</span>
<a href="#l14.311"></a><span id="l14.311" class="difflineminus">-</span>
<a href="#l14.312"></a><span id="l14.312" class="difflineminus">-    DWORD mozABCount=0;</span>
<a href="#l14.313"></a><span id="l14.313" class="difflineminus">-    LONG * mozCatIndexList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.314"></a><span id="l14.314" class="difflineminus">-    CPString ** mozABNameList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.315"></a><span id="l14.315" class="difflineminus">-    CPString ** mozABUrlList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.316"></a><span id="l14.316" class="difflineminus">-    BOOL * mozDirFlagsList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.317"></a><span id="l14.317" class="difflineminus">-    BOOL neverDidPalmSyncBefore = TRUE; // 1st time palm sync?</span>
<a href="#l14.318"></a><span id="l14.318" class="difflineminus">-    DWORD mozABIndex;</span>
<a href="#l14.319"></a><span id="l14.319" class="difflineminus">-</span>
<a href="#l14.320"></a><span id="l14.320" class="difflineminus">-    retval = sync-&gt;m_dbHH-&gt;OpenDB(FALSE);</span>
<a href="#l14.321"></a><span id="l14.321" class="difflineminus">-    if (!retval)</span>
<a href="#l14.322"></a><span id="l14.322" class="difflineminus">-        retval = sync-&gt;m_dbHH-&gt;LoadCategories();</span>
<a href="#l14.323"></a><span id="l14.323" class="difflineminus">-</span>
<a href="#l14.324"></a><span id="l14.324" class="difflineminus">-    CONDUIT_LOG0(gFD, &quot;Getting moz AB List ... &quot;);</span>
<a href="#l14.325"></a><span id="l14.325" class="difflineminus">-    if(!retval)</span>
<a href="#l14.326"></a><span id="l14.326" class="difflineminus">-        retval = sync-&gt;m_dbPC-&gt;GetPCABList(&amp;mozABCount, &amp;mozCatIndexList, &amp;mozABNameList, &amp;mozABUrlList, &amp;mozDirFlagsList);</span>
<a href="#l14.327"></a><span id="l14.327" class="difflineminus">-    CONDUIT_LOG1(gFD, &quot;done getting moz AB List. retval = %d\n&quot;, retval);</span>
<a href="#l14.328"></a><span id="l14.328" class="difflineminus">-</span>
<a href="#l14.329"></a><span id="l14.329" class="difflineminus">-    if (retval)</span>
<a href="#l14.330"></a><span id="l14.330" class="difflineminus">-      return retval;</span>
<a href="#l14.331"></a><span id="l14.331" class="difflineminus">-    </span>
<a href="#l14.332"></a><span id="l14.332" class="difflineminus">-    // Create an array to help us identify addrbooks that have been deleted on Palm.</span>
<a href="#l14.333"></a><span id="l14.333" class="difflineminus">-    DWORD *mozABSeen = (DWORD *) CoTaskMemAlloc(sizeof(DWORD) * mozABCount);</span>
<a href="#l14.334"></a><span id="l14.334" class="difflineminus">-    if (!mozABSeen)</span>
<a href="#l14.335"></a><span id="l14.335" class="difflineminus">-      return GEN_ERR_LOW_MEMORY;</span>
<a href="#l14.336"></a><span id="l14.336" class="difflineminus">-    else</span>
<a href="#l14.337"></a><span id="l14.337" class="difflineminus">-      memset(mozABSeen, FALSE, sizeof(DWORD) * mozABCount);</span>
<a href="#l14.338"></a><span id="l14.338" class="difflineminus">-</span>
<a href="#l14.339"></a><span id="l14.339" class="difflineminus">-    CONDUIT_LOG1(gFD, &quot;first device = %lx\n&quot;, sync-&gt;m_rSyncProperties.m_FirstDevice);</span>
<a href="#l14.340"></a><span id="l14.340" class="difflineminus">-</span>
<a href="#l14.341"></a><span id="l14.341" class="difflineminus">-    // See if palm sync was performed before.</span>
<a href="#l14.342"></a><span id="l14.342" class="difflineminus">-    for(mozABIndex=0; mozABIndex&lt;mozABCount; mozABIndex++)</span>
<a href="#l14.343"></a><span id="l14.343" class="difflineminus">-      if (! (mozDirFlagsList[mozABIndex] &amp; kFirstTimeSyncDirFlag))</span>
<a href="#l14.344"></a><span id="l14.344" class="difflineminus">-      {</span>
<a href="#l14.345"></a><span id="l14.345" class="difflineminus">-        neverDidPalmSyncBefore = FALSE;</span>
<a href="#l14.346"></a><span id="l14.346" class="difflineminus">-        break;</span>
<a href="#l14.347"></a><span id="l14.347" class="difflineminus">-      }</span>
<a href="#l14.348"></a><span id="l14.348" class="difflineminus">-    </span>
<a href="#l14.349"></a><span id="l14.349" class="difflineminus">-    // Log moz addrbooks.</span>
<a href="#l14.350"></a><span id="l14.350" class="difflineminus">-    for (mozABIndex=0; mozABIndex&lt;mozABCount; mozABIndex++)</span>
<a href="#l14.351"></a><span id="l14.351" class="difflineminus">-    {</span>
<a href="#l14.352"></a><span id="l14.352" class="difflineminus">-      CONDUIT_LOG5(gFD, &quot;Moz AB[%d] category index/synced=%d/%d, name= '%s', url= '%s'\n&quot;,</span>
<a href="#l14.353"></a><span id="l14.353" class="difflineminus">-                   mozABIndex, mozCatIndexList[mozABIndex], ! (mozDirFlagsList[mozABIndex] &amp; kFirstTimeSyncDirFlag), </span>
<a href="#l14.354"></a><span id="l14.354" class="difflineminus">-                   mozABNameList[mozABIndex]-&gt;GetBuffer(0), mozABUrlList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.355"></a><span id="l14.355" class="difflineminus">-    }</span>
<a href="#l14.356"></a><span id="l14.356" class="difflineminus">-</span>
<a href="#l14.357"></a><span id="l14.357" class="difflineminus">-    // For each category, try to find the corresponding AB in the moz AB list</span>
<a href="#l14.358"></a><span id="l14.358" class="difflineminus">-    // and see if it has been synchronized before and take action accordingly.</span>
<a href="#l14.359"></a><span id="l14.359" class="difflineminus">-    CPCategory * pCategory = sync-&gt;m_dbHH-&gt;GetFirstCategory();</span>
<a href="#l14.360"></a><span id="l14.360" class="difflineminus">-    while (pCategory)</span>
<a href="#l14.361"></a><span id="l14.361" class="difflineminus">-    {</span>
<a href="#l14.362"></a><span id="l14.362" class="difflineminus">-        CPalmRecord ** recordListHH = NULL;</span>
<a href="#l14.363"></a><span id="l14.363" class="difflineminus">-        DWORD recordCountHH=0;</span>
<a href="#l14.364"></a><span id="l14.364" class="difflineminus">-</span>
<a href="#l14.365"></a><span id="l14.365" class="difflineminus">-        DWORD catID = pCategory-&gt;GetID();</span>
<a href="#l14.366"></a><span id="l14.366" class="difflineminus">-        DWORD catIndex = pCategory-&gt;GetIndex();</span>
<a href="#l14.367"></a><span id="l14.367" class="difflineminus">-        DWORD catFlags = pCategory-&gt;GetFlags();</span>
<a href="#l14.368"></a><span id="l14.368" class="difflineminus">-        CPString catName(pCategory-&gt;GetName());</span>
<a href="#l14.369"></a><span id="l14.369" class="difflineminus">-</span>
<a href="#l14.370"></a><span id="l14.370" class="difflineminus">-        CONDUIT_LOG3(gFD, &quot;\nProcessing Palm AB '%s' (catIndex/catId) = (%d/%d)... \n&quot;, catName.GetBuffer(0), catIndex, catID);</span>
<a href="#l14.371"></a><span id="l14.371" class="difflineminus">-        BOOL abRenamed = FALSE;</span>
<a href="#l14.372"></a><span id="l14.372" class="difflineminus">-        BOOL foundInABList=FALSE;</span>
<a href="#l14.373"></a><span id="l14.373" class="difflineminus">-        for(mozABIndex=0; mozABIndex&lt;mozABCount; mozABIndex++)</span>
<a href="#l14.374"></a><span id="l14.374" class="difflineminus">-        {</span>
<a href="#l14.375"></a><span id="l14.375" class="difflineminus">-            // Palm only allows 15 chars for category names.</span>
<a href="#l14.376"></a><span id="l14.376" class="difflineminus">-            CPString cutOffName;</span>
<a href="#l14.377"></a><span id="l14.377" class="difflineminus">-            if (mozABNameList[mozABIndex]-&gt;Length() &gt; 15)</span>
<a href="#l14.378"></a><span id="l14.378" class="difflineminus">-                cutOffName = mozABNameList[mozABIndex]-&gt;Left(15);</span>
<a href="#l14.379"></a><span id="l14.379" class="difflineminus">-            else</span>
<a href="#l14.380"></a><span id="l14.380" class="difflineminus">-                cutOffName = *mozABNameList[mozABIndex];</span>
<a href="#l14.381"></a><span id="l14.381" class="difflineminus">-</span>
<a href="#l14.382"></a><span id="l14.382" class="difflineminus">-            // if this category has been synchronized before</span>
<a href="#l14.383"></a><span id="l14.383" class="difflineminus">-            if(catIndex == mozCatIndexList[mozABIndex]) </span>
<a href="#l14.384"></a><span id="l14.384" class="difflineminus">-            {</span>
<a href="#l14.385"></a><span id="l14.385" class="difflineminus">-                retval = sync-&gt;m_dbHH-&gt;LoadUpdatedRecordsInCategory(catIndex, &amp;recordListHH, &amp;recordCountHH);</span>
<a href="#l14.386"></a><span id="l14.386" class="difflineminus">-                CONDUIT_LOG2(gFD, &quot;Category index = %d, name = '%s' has been synced before\n&quot;, catID, catName.GetBuffer(0));</span>
<a href="#l14.387"></a><span id="l14.387" class="difflineminus">-                foundInABList = TRUE;</span>
<a href="#l14.388"></a><span id="l14.388" class="difflineminus">-                mozABSeen[mozABIndex] = TRUE; // mark it seen</span>
<a href="#l14.389"></a><span id="l14.389" class="difflineminus">-                // See if the name has been changed on Palm side. Note that if both</span>
<a href="#l14.390"></a><span id="l14.390" class="difflineminus">-                // Palm category and the corresponding moz addrbook are renamed then </span>
<a href="#l14.391"></a><span id="l14.391" class="difflineminus">-                // Palm category name takes precedence.</span>
<a href="#l14.392"></a><span id="l14.392" class="difflineminus">-                if (!sync-&gt;CategoryNameMatches(catName, cutOffName, mozDirFlagsList[mozABIndex] &amp; kIsPabDirFlag))</span>
<a href="#l14.393"></a><span id="l14.393" class="difflineminus">-                {</span>
<a href="#l14.394"></a><span id="l14.394" class="difflineminus">-                  abRenamed = TRUE;</span>
<a href="#l14.395"></a><span id="l14.395" class="difflineminus">-                  CONDUIT_LOG3(gFD, &quot;Category index = %d, name = '%s' was renamed (from '%s') on Palm so do the same on moz\n&quot;, </span>
<a href="#l14.396"></a><span id="l14.396" class="difflineminus">-                    catID, catName.GetBuffer(0), mozABNameList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.397"></a><span id="l14.397" class="difflineminus">-                }</span>
<a href="#l14.398"></a><span id="l14.398" class="difflineminus">-                break;</span>
<a href="#l14.399"></a><span id="l14.399" class="difflineminus">-            }</span>
<a href="#l14.400"></a><span id="l14.400" class="difflineminus">-</span>
<a href="#l14.401"></a><span id="l14.401" class="difflineminus">-            // if corresponding category exists but not synchronized before</span>
<a href="#l14.402"></a><span id="l14.402" class="difflineminus">-            if(sync-&gt;CategoryNameMatches(catName, cutOffName, mozDirFlagsList[mozABIndex] &amp; kIsPabDirFlag))</span>
<a href="#l14.403"></a><span id="l14.403" class="difflineminus">-            {</span>
<a href="#l14.404"></a><span id="l14.404" class="difflineminus">-                retval = sync-&gt;m_dbHH-&gt;LoadAllRecordsInCategory(catIndex, &amp;recordListHH, &amp;recordCountHH);</span>
<a href="#l14.405"></a><span id="l14.405" class="difflineminus">-                CONDUIT_LOG2(gFD, &quot;Category index = %d, name = '%s' has not been synced before\n&quot;, catID, catName.GetBuffer(0));</span>
<a href="#l14.406"></a><span id="l14.406" class="difflineminus">-                foundInABList = TRUE;</span>
<a href="#l14.407"></a><span id="l14.407" class="difflineminus">-                mozABSeen[mozABIndex] = TRUE; // mark it seen</span>
<a href="#l14.408"></a><span id="l14.408" class="difflineminus">-                break;</span>
<a href="#l14.409"></a><span id="l14.409" class="difflineminus">-            }</span>
<a href="#l14.410"></a><span id="l14.410" class="difflineminus">-        } // end of for</span>
<a href="#l14.411"></a><span id="l14.411" class="difflineminus">-</span>
<a href="#l14.412"></a><span id="l14.412" class="difflineminus">-        if(!retval &amp;&amp; foundInABList)</span>
<a href="#l14.413"></a><span id="l14.413" class="difflineminus">-        {</span>
<a href="#l14.414"></a><span id="l14.414" class="difflineminus">-          CPalmRecord ** recordListPC=NULL;</span>
<a href="#l14.415"></a><span id="l14.415" class="difflineminus">-          DWORD recordCountPC=0;</span>
<a href="#l14.416"></a><span id="l14.416" class="difflineminus">-          DWORD newRecAddedCount = 0;</span>
<a href="#l14.417"></a><span id="l14.417" class="difflineminus">-          DWORD * newRecIDList=NULL;</span>
<a href="#l14.418"></a><span id="l14.418" class="difflineminus">-          CONDUIT_LOG1(gFD, &quot;  Syncing with moz AB with %d modified Palm record(s) ... &quot;, recordCountHH);</span>
<a href="#l14.419"></a><span id="l14.419" class="difflineminus">-          retval = sync-&gt;m_dbPC-&gt;SynchronizePCAB(catIndex, catID, catName,</span>
<a href="#l14.420"></a><span id="l14.420" class="difflineminus">-                                                 recordCountHH, recordListHH,</span>
<a href="#l14.421"></a><span id="l14.421" class="difflineminus">-                                                 &amp;recordCountPC, &amp;recordListPC);</span>
<a href="#l14.422"></a><span id="l14.422" class="difflineminus">-          CONDUIT_LOG1(gFD, &quot;Done syncing AB. retval=%lx.\n&quot;, retval);</span>
<a href="#l14.423"></a><span id="l14.423" class="difflineminus">-</span>
<a href="#l14.424"></a><span id="l14.424" class="difflineminus">-          // SynchronizePCAB() returns a list of modified moz records so update those on Palm.</span>
<a href="#l14.425"></a><span id="l14.425" class="difflineminus">-          if (!retval) {</span>
<a href="#l14.426"></a><span id="l14.426" class="difflineminus">-              unsigned long i;</span>
<a href="#l14.427"></a><span id="l14.427" class="difflineminus">-              newRecIDList = (DWORD *) calloc(recordCountPC, sizeof(DWORD));</span>
<a href="#l14.428"></a><span id="l14.428" class="difflineminus">-              if (recordCountPC &gt; 0)</span>
<a href="#l14.429"></a><span id="l14.429" class="difflineminus">-                CONDUIT_LOG1(gFD, &quot;  Updating Palm AB with %d modified moz record(s) ...\n&quot;, recordCountPC);</span>
<a href="#l14.430"></a><span id="l14.430" class="difflineminus">-              for (i=0; i &lt; recordCountPC; i++) {</span>
<a href="#l14.431"></a><span id="l14.431" class="difflineminus">-                  if(!recordListPC[i])</span>
<a href="#l14.432"></a><span id="l14.432" class="difflineminus">-                      continue;</span>
<a href="#l14.433"></a><span id="l14.433" class="difflineminus">-                  CPalmRecord palmRec = *recordListPC[i];</span>
<a href="#l14.434"></a><span id="l14.434" class="difflineminus">-                  palmRec.SetCategory(catIndex);</span>
<a href="#l14.435"></a><span id="l14.435" class="difflineminus">-                  if(palmRec.GetAttribs() == ATTR_DELETED)</span>
<a href="#l14.436"></a><span id="l14.436" class="difflineminus">-                  {</span>
<a href="#l14.437"></a><span id="l14.437" class="difflineminus">-                    CONDUIT_LOG0(gFD, &quot;    - deleting a record\n&quot;);</span>
<a href="#l14.438"></a><span id="l14.438" class="difflineminus">-							      retval = sync-&gt;m_dbHH-&gt;DeleteARecord(palmRec);</span>
<a href="#l14.439"></a><span id="l14.439" class="difflineminus">-                  }</span>
<a href="#l14.440"></a><span id="l14.440" class="difflineminus">-                  else if(palmRec.GetAttribs() == ATTR_MODIFIED)</span>
<a href="#l14.441"></a><span id="l14.441" class="difflineminus">-                  {</span>
<a href="#l14.442"></a><span id="l14.442" class="difflineminus">-                    CONDUIT_LOG0(gFD, &quot;    - modifying a record\n&quot;);</span>
<a href="#l14.443"></a><span id="l14.443" class="difflineminus">-							      retval = sync-&gt;m_dbHH-&gt;UpdateARecord(palmRec);</span>
<a href="#l14.444"></a><span id="l14.444" class="difflineminus">-                  }</span>
<a href="#l14.445"></a><span id="l14.445" class="difflineminus">-                  else if(palmRec.GetAttribs() == ATTR_NEW) {</span>
<a href="#l14.446"></a><span id="l14.446" class="difflineminus">-                      CONDUIT_LOG0(gFD, &quot;    - adding a record\n&quot;);</span>
<a href="#l14.447"></a><span id="l14.447" class="difflineminus">- 							        retval = sync-&gt;m_dbHH-&gt;AddARecord(palmRec); // should we check existing recs?</span>
<a href="#l14.448"></a><span id="l14.448" class="difflineminus">-                      if(!retval &amp;&amp; (newRecAddedCount &lt; recordCountPC)) {</span>
<a href="#l14.449"></a><span id="l14.449" class="difflineminus">-                          newRecIDList[newRecAddedCount] = palmRec.GetID();</span>
<a href="#l14.450"></a><span id="l14.450" class="difflineminus">-                          newRecAddedCount++;</span>
<a href="#l14.451"></a><span id="l14.451" class="difflineminus">-                      }</span>
<a href="#l14.452"></a><span id="l14.452" class="difflineminus">-                  }</span>
<a href="#l14.453"></a><span id="l14.453" class="difflineminus">-                  delete recordListPC[i]; // once done with PC record, delete</span>
<a href="#l14.454"></a><span id="l14.454" class="difflineminus">-					    }</span>
<a href="#l14.455"></a><span id="l14.455" class="difflineminus">-              if (recordCountPC &gt; 0)</span>
<a href="#l14.456"></a><span id="l14.456" class="difflineminus">-                CONDUIT_LOG0(gFD, &quot;  Done updating Palm AB.\n&quot;);</span>
<a href="#l14.457"></a><span id="l14.457" class="difflineminus">-          }</span>
<a href="#l14.458"></a><span id="l14.458" class="difflineminus">-          // the MozAB is now synchronized</span>
<a href="#l14.459"></a><span id="l14.459" class="difflineminus">-          if(!retval)</span>
<a href="#l14.460"></a><span id="l14.460" class="difflineminus">-              mozDirFlagsList[mozABIndex] &amp;= ~kFirstTimeSyncDirFlag;</span>
<a href="#l14.461"></a><span id="l14.461" class="difflineminus">-          // delete the PC recordList now that palm is updated</span>
<a href="#l14.462"></a><span id="l14.462" class="difflineminus">-          if(recordListPC)</span>
<a href="#l14.463"></a><span id="l14.463" class="difflineminus">-              free(recordListPC);  </span>
<a href="#l14.464"></a><span id="l14.464" class="difflineminus">-          // notify Mozilla that sync is done so that memory can be freed </span>
<a href="#l14.465"></a><span id="l14.465" class="difflineminus">-          success = retval ? FALSE : TRUE;</span>
<a href="#l14.466"></a><span id="l14.466" class="difflineminus">-</span>
<a href="#l14.467"></a><span id="l14.467" class="difflineminus">-          if(newRecAddedCount) {</span>
<a href="#l14.468"></a><span id="l14.468" class="difflineminus">-              if(newRecAddedCount != recordCountPC)</span>
<a href="#l14.469"></a><span id="l14.469" class="difflineminus">-                  newRecIDList = (DWORD *) realloc(newRecIDList, newRecAddedCount);</span>
<a href="#l14.470"></a><span id="l14.470" class="difflineminus">-              retval = sync-&gt;m_dbPC-&gt;NotifySyncDone(success, catIndex, newRecAddedCount, newRecIDList);</span>
<a href="#l14.471"></a><span id="l14.471" class="difflineminus">-          }</span>
<a href="#l14.472"></a><span id="l14.472" class="difflineminus">-          else </span>
<a href="#l14.473"></a><span id="l14.473" class="difflineminus">-              retval = sync-&gt;m_dbPC-&gt;NotifySyncDone(success);</span>
<a href="#l14.474"></a><span id="l14.474" class="difflineminus">-</span>
<a href="#l14.475"></a><span id="l14.475" class="difflineminus">-          if(newRecIDList)</span>
<a href="#l14.476"></a><span id="l14.476" class="difflineminus">-              free(newRecIDList);</span>
<a href="#l14.477"></a><span id="l14.477" class="difflineminus">-</span>
<a href="#l14.478"></a><span id="l14.478" class="difflineminus">-          // See if it was renamed on palm.</span>
<a href="#l14.479"></a><span id="l14.479" class="difflineminus">-          if (abRenamed)</span>
<a href="#l14.480"></a><span id="l14.480" class="difflineminus">-          {</span>
<a href="#l14.481"></a><span id="l14.481" class="difflineminus">-            // We should not rename personal and collected address books here.</span>
<a href="#l14.482"></a><span id="l14.482" class="difflineminus">-            if (! (mozDirFlagsList[mozABIndex] &amp; kIsPabDirFlag) &amp;&amp;</span>
<a href="#l14.483"></a><span id="l14.483" class="difflineminus">-              mozABUrlList[mozABIndex]-&gt;CompareNoCase(COLLECTED_ADDRBOOK_URL))</span>
<a href="#l14.484"></a><span id="l14.484" class="difflineminus">-            {</span>
<a href="#l14.485"></a><span id="l14.485" class="difflineminus">-              CONDUIT_LOG0(gFD, &quot;  Renaming AB ... &quot;);</span>
<a href="#l14.486"></a><span id="l14.486" class="difflineminus">-              retval = sync-&gt;m_dbPC-&gt;RenamePCAB(catIndex, catName, *mozABUrlList[mozABIndex]);</span>
<a href="#l14.487"></a><span id="l14.487" class="difflineminus">-              CONDUIT_LOG1(gFD, &quot;Done renaming AB. retval=%d.\n&quot;, retval);</span>
<a href="#l14.488"></a><span id="l14.488" class="difflineminus">-            }</span>
<a href="#l14.489"></a><span id="l14.489" class="difflineminus">-          }</span>
<a href="#l14.490"></a><span id="l14.490" class="difflineminus">-        }</span>
<a href="#l14.491"></a><span id="l14.491" class="difflineminus">-        </span>
<a href="#l14.492"></a><span id="l14.492" class="difflineminus">-        // If this category can't be found in the moz AB list then two cases here:</span>
<a href="#l14.493"></a><span id="l14.493" class="difflineminus">-        //    1. If catFlags is not CAT_DIRTY then this category has been deleted</span>
<a href="#l14.494"></a><span id="l14.494" class="difflineminus">-        //       on moz so remove it from palm side.</span>
<a href="#l14.495"></a><span id="l14.495" class="difflineminus">-        //    2. else, if we never did palm sync on moz before then it's a new one</span>
<a href="#l14.496"></a><span id="l14.496" class="difflineminus">-        //       on palm. So create a new AB in moz with all records in this category</span>
<a href="#l14.497"></a><span id="l14.497" class="difflineminus">-        //       (even if it's an empty AB).</span>
<a href="#l14.498"></a><span id="l14.498" class="difflineminus">-        if(!retval &amp;&amp; !foundInABList) </span>
<a href="#l14.499"></a><span id="l14.499" class="difflineminus">-        {</span>
<a href="#l14.500"></a><span id="l14.500" class="difflineminus">-            if (catFlags != CAT_DIRTY &amp;&amp; !neverDidPalmSyncBefore &amp;&amp; !initialHHSync)</span>
<a href="#l14.501"></a><span id="l14.501" class="difflineminus">-            {</span>
<a href="#l14.502"></a><span id="l14.502" class="difflineminus">-              BOOL abDeleted = sync-&gt;m_dbPC-&gt;PCABDeleted(catName);</span>
<a href="#l14.503"></a><span id="l14.503" class="difflineminus">-              if (abDeleted)</span>
<a href="#l14.504"></a><span id="l14.504" class="difflineminus">-              {</span>
<a href="#l14.505"></a><span id="l14.505" class="difflineminus">-                CONDUIT_LOG2(gFD, &quot;Category index = %d, name = '%s' is removed from moz and needs to be removed from palm\n&quot;, catID, catName.GetBuffer(0));</span>
<a href="#l14.506"></a><span id="l14.506" class="difflineminus">-                CONDUIT_LOG0(gFD, &quot;  Deleting AB from Palm ... &quot;);</span>
<a href="#l14.507"></a><span id="l14.507" class="difflineminus">-                retval = sync-&gt;m_dbHH-&gt;DeleteCategory(catIndex, FALSE);</span>
<a href="#l14.508"></a><span id="l14.508" class="difflineminus">-                CONDUIT_LOG1(gFD, &quot;Done deleting AB from Palm. retval=%d.\n&quot;, retval);</span>
<a href="#l14.509"></a><span id="l14.509" class="difflineminus">-              }</span>
<a href="#l14.510"></a><span id="l14.510" class="difflineminus">-            }</span>
<a href="#l14.511"></a><span id="l14.511" class="difflineminus">-            else</span>
<a href="#l14.512"></a><span id="l14.512" class="difflineminus">-            {</span>
<a href="#l14.513"></a><span id="l14.513" class="difflineminus">-              CONDUIT_LOG2(gFD, &quot;Category index = %d, name = '%s' is new on palm and needs to be added to moz\n&quot;, catID, catName.GetBuffer(0));</span>
<a href="#l14.514"></a><span id="l14.514" class="difflineminus">-              retval = sync-&gt;m_dbHH-&gt;LoadAllRecordsInCategory(catIndex, &amp;recordListHH, &amp;recordCountHH);</span>
<a href="#l14.515"></a><span id="l14.515" class="difflineminus">-              CONDUIT_LOG1(gFD, &quot;  Creating new moz AB with %d Palm record(s) ... &quot;, recordCountHH);</span>
<a href="#l14.516"></a><span id="l14.516" class="difflineminus">-              if(!retval)</span>
<a href="#l14.517"></a><span id="l14.517" class="difflineminus">-                retval = sync-&gt;m_dbPC-&gt;AddRecords(FALSE, catIndex, catName, recordCountHH, recordListHH);</span>
<a href="#l14.518"></a><span id="l14.518" class="difflineminus">-              CONDUIT_LOG1(gFD, &quot;Done creating new moz AB. retval=%d.\n&quot;, retval);</span>
<a href="#l14.519"></a><span id="l14.519" class="difflineminus">-            }</span>
<a href="#l14.520"></a><span id="l14.520" class="difflineminus">-        }</span>
<a href="#l14.521"></a><span id="l14.521" class="difflineminus">-</span>
<a href="#l14.522"></a><span id="l14.522" class="difflineminus">-        // delete and free HH records and recordList once synced</span>
<a href="#l14.523"></a><span id="l14.523" class="difflineminus">-        if(recordListHH) {</span>
<a href="#l14.524"></a><span id="l14.524" class="difflineminus">-            CPalmRecord ** tempRecordListHH = recordListHH;</span>
<a href="#l14.525"></a><span id="l14.525" class="difflineminus">-            for(DWORD i=0; i &lt; recordCountHH; i++) </span>
<a href="#l14.526"></a><span id="l14.526" class="difflineminus">-            {</span>
<a href="#l14.527"></a><span id="l14.527" class="difflineminus">-                if(*tempRecordListHH)</span>
<a href="#l14.528"></a><span id="l14.528" class="difflineminus">-                    delete *tempRecordListHH;</span>
<a href="#l14.529"></a><span id="l14.529" class="difflineminus">-                tempRecordListHH++;</span>
<a href="#l14.530"></a><span id="l14.530" class="difflineminus">-            }</span>
<a href="#l14.531"></a><span id="l14.531" class="difflineminus">-            free(recordListHH);</span>
<a href="#l14.532"></a><span id="l14.532" class="difflineminus">-        }</span>
<a href="#l14.533"></a><span id="l14.533" class="difflineminus">-</span>
<a href="#l14.534"></a><span id="l14.534" class="difflineminus">-        // Process next category</span>
<a href="#l14.535"></a><span id="l14.535" class="difflineminus">-        pCategory = sync-&gt;m_dbHH-&gt;GetNextCategory();</span>
<a href="#l14.536"></a><span id="l14.536" class="difflineminus">-    } // end of while</span>
<a href="#l14.537"></a><span id="l14.537" class="difflineminus">-</span>
<a href="#l14.538"></a><span id="l14.538" class="difflineminus">-    // Deal with any Moz AB not existing in Palm, ones not sync'ed above,</span>
<a href="#l14.539"></a><span id="l14.539" class="difflineminus">-    // and the case where Palm ABs have been deleted.</span>
<a href="#l14.540"></a><span id="l14.540" class="difflineminus">-    for(mozABIndex=0; mozABIndex&lt;mozABCount; mozABIndex++)</span>
<a href="#l14.541"></a><span id="l14.541" class="difflineminus">-    {</span>
<a href="#l14.542"></a><span id="l14.542" class="difflineminus">-        if((mozDirFlagsList[mozABIndex] &amp; kFirstTimeSyncDirFlag || neverDidPalmSyncBefore || initialHHSync) &amp;&amp; !sync-&gt;CategoryExists(*mozABNameList[mozABIndex],  mozDirFlagsList[mozABIndex] &amp; kIsPabDirFlag))</span>
<a href="#l14.543"></a><span id="l14.543" class="difflineminus">-        {</span>
<a href="#l14.544"></a><span id="l14.544" class="difflineminus">-            CONDUIT_LOG3(gFD, &quot;\nMoz AB[%d] category index = %d, name = '%s' doesn't exist on Palm so needs to be added to palm\n&quot;,</span>
<a href="#l14.545"></a><span id="l14.545" class="difflineminus">-                    mozABIndex, mozCatIndexList[mozABIndex], mozABNameList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.546"></a><span id="l14.546" class="difflineminus">-            CPalmRecord ** recordListPC=NULL;</span>
<a href="#l14.547"></a><span id="l14.547" class="difflineminus">-            DWORD recordCountPC=0;</span>
<a href="#l14.548"></a><span id="l14.548" class="difflineminus">-            DWORD * newRecIDList=NULL;</span>
<a href="#l14.549"></a><span id="l14.549" class="difflineminus">-            CPCategory cat;</span>
<a href="#l14.550"></a><span id="l14.550" class="difflineminus">-            retval = sync-&gt;m_dbPC-&gt;LoadAllRecords(*mozABNameList[mozABIndex],</span>
<a href="#l14.551"></a><span id="l14.551" class="difflineminus">-						                      &amp;recordCountPC, &amp;recordListPC);</span>
<a href="#l14.552"></a><span id="l14.552" class="difflineminus">-            if(!retval) </span>
<a href="#l14.553"></a><span id="l14.553" class="difflineminus">-            {</span>
<a href="#l14.554"></a><span id="l14.554" class="difflineminus">-                if (! (mozDirFlagsList[mozABIndex] &amp; kIsPabDirFlag))</span>
<a href="#l14.555"></a><span id="l14.555" class="difflineminus">-                  cat.SetName(mozABNameList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.556"></a><span id="l14.556" class="difflineminus">-                else</span>
<a href="#l14.557"></a><span id="l14.557" class="difflineminus">-                  cat.SetName(&quot;Personal&quot;);</span>
<a href="#l14.558"></a><span id="l14.558" class="difflineminus">-</span>
<a href="#l14.559"></a><span id="l14.559" class="difflineminus">-                CONDUIT_LOG1(gFD, &quot;  Creating new Palm AB with %d record(s) ... &quot;, recordCountPC);</span>
<a href="#l14.560"></a><span id="l14.560" class="difflineminus">-                retval = sync-&gt;m_dbHH-&gt;AddCategory(cat);</span>
<a href="#l14.561"></a><span id="l14.561" class="difflineminus">-                CONDUIT_LOG2(gFD, &quot;Done creating new Palm AB, new category index=%d. retval=%d.\n&quot;, cat.GetIndex(), retval);</span>
<a href="#l14.562"></a><span id="l14.562" class="difflineminus">-                if(!retval) </span>
<a href="#l14.563"></a><span id="l14.563" class="difflineminus">-                {</span>
<a href="#l14.564"></a><span id="l14.564" class="difflineminus">-                    CONDUIT_LOG1(gFD, &quot;  Adding %d record(s) to new Palm AB ... &quot;, recordCountPC);</span>
<a href="#l14.565"></a><span id="l14.565" class="difflineminus">-                    newRecIDList = (DWORD *) calloc(recordCountPC, sizeof(DWORD));</span>
<a href="#l14.566"></a><span id="l14.566" class="difflineminus">-                    for (unsigned long i=0; i &lt; recordCountPC; i++) </span>
<a href="#l14.567"></a><span id="l14.567" class="difflineminus">-                    {</span>
<a href="#l14.568"></a><span id="l14.568" class="difflineminus">-                        if(!recordListPC[i])</span>
<a href="#l14.569"></a><span id="l14.569" class="difflineminus">-                            continue;</span>
<a href="#l14.570"></a><span id="l14.570" class="difflineminus">-                        CPalmRecord palmRec = *recordListPC[i];</span>
<a href="#l14.571"></a><span id="l14.571" class="difflineminus">-                        palmRec.SetCategory(cat.GetIndex());</span>
<a href="#l14.572"></a><span id="l14.572" class="difflineminus">-                        retval = sync-&gt;m_dbHH-&gt;AddARecord(palmRec); // should we check existing recs?</span>
<a href="#l14.573"></a><span id="l14.573" class="difflineminus">-                        newRecIDList[i] = palmRec.GetID();</span>
<a href="#l14.574"></a><span id="l14.574" class="difflineminus">-                        delete recordListPC[i]; // delete the record now that it is used</span>
<a href="#l14.575"></a><span id="l14.575" class="difflineminus">-                    }</span>
<a href="#l14.576"></a><span id="l14.576" class="difflineminus">-                    CONDUIT_LOG0(gFD, &quot;Done adding new records to new Palm AB.\n&quot;);</span>
<a href="#l14.577"></a><span id="l14.577" class="difflineminus">-                }</span>
<a href="#l14.578"></a><span id="l14.578" class="difflineminus">-                else</span>
<a href="#l14.579"></a><span id="l14.579" class="difflineminus">-                  CONDUIT_LOG1(gFD, &quot;Creating new Palm AB failed. retval=%d.\n&quot;, retval);</span>
<a href="#l14.580"></a><span id="l14.580" class="difflineminus">-            }</span>
<a href="#l14.581"></a><span id="l14.581" class="difflineminus">-            else</span>
<a href="#l14.582"></a><span id="l14.582" class="difflineminus">-              CONDUIT_LOG1(gFD, &quot;  Loading moz AB records failed so can't create new Palm AB. retval=%d.\n&quot;, retval);</span>
<a href="#l14.583"></a><span id="l14.583" class="difflineminus">-</span>
<a href="#l14.584"></a><span id="l14.584" class="difflineminus">-</span>
<a href="#l14.585"></a><span id="l14.585" class="difflineminus">-            // the MozAB is now synchronized</span>
<a href="#l14.586"></a><span id="l14.586" class="difflineminus">-            if(!retval)</span>
<a href="#l14.587"></a><span id="l14.587" class="difflineminus">-              mozDirFlagsList[mozABIndex] &amp;= ~kFirstTimeSyncDirFlag;</span>
<a href="#l14.588"></a><span id="l14.588" class="difflineminus">-            // delete the recordList now that palm is updated</span>
<a href="#l14.589"></a><span id="l14.589" class="difflineminus">-            if(recordListPC)</span>
<a href="#l14.590"></a><span id="l14.590" class="difflineminus">-                free(recordListPC);  </span>
<a href="#l14.591"></a><span id="l14.591" class="difflineminus">-            // notify Mozilla that sync is done so that memory can be freed </span>
<a href="#l14.592"></a><span id="l14.592" class="difflineminus">-            if(!retval)</span>
<a href="#l14.593"></a><span id="l14.593" class="difflineminus">-                success = TRUE;</span>
<a href="#l14.594"></a><span id="l14.594" class="difflineminus">-            else</span>
<a href="#l14.595"></a><span id="l14.595" class="difflineminus">-            {</span>
<a href="#l14.596"></a><span id="l14.596" class="difflineminus">-                success = FALSE;</span>
<a href="#l14.597"></a><span id="l14.597" class="difflineminus">-                recordCountPC=0;</span>
<a href="#l14.598"></a><span id="l14.598" class="difflineminus">-            }</span>
<a href="#l14.599"></a><span id="l14.599" class="difflineminus">-            retval = sync-&gt;m_dbPC-&gt;NotifySyncDone(success, cat.GetIndex(), recordCountPC, newRecIDList);</span>
<a href="#l14.600"></a><span id="l14.600" class="difflineminus">-            if(newRecIDList)</span>
<a href="#l14.601"></a><span id="l14.601" class="difflineminus">-                free(newRecIDList);</span>
<a href="#l14.602"></a><span id="l14.602" class="difflineminus">-</span>
<a href="#l14.603"></a><span id="l14.603" class="difflineminus">-            // Lastly, update the AB with new category index and mod time.</span>
<a href="#l14.604"></a><span id="l14.604" class="difflineminus">-            retval = sync-&gt;m_dbPC-&gt;UpdatePCABSyncInfo(success ? cat.GetIndex() : -1, *mozABNameList[mozABIndex]);</span>
<a href="#l14.605"></a><span id="l14.605" class="difflineminus">-        }</span>
<a href="#l14.606"></a><span id="l14.606" class="difflineminus">-        else if (!mozABSeen[mozABIndex] &amp;&amp; !neverDidPalmSyncBefore &amp;&amp; !initialHHSync)</span>
<a href="#l14.607"></a><span id="l14.607" class="difflineminus">-        {</span>
<a href="#l14.608"></a><span id="l14.608" class="difflineminus">-          // We should not delete personal and collected address books here. Rather,</span>
<a href="#l14.609"></a><span id="l14.609" class="difflineminus">-          // reset the mod time so next time we can sync them back to Palm again.</span>
<a href="#l14.610"></a><span id="l14.610" class="difflineminus">-          // Note: make sure the moz addrbook has been synced before to avoid the case</span>
<a href="#l14.611"></a><span id="l14.611" class="difflineminus">-          // where early sync failed and we delete this un-synced addrbook by mistake.</span>
<a href="#l14.612"></a><span id="l14.612" class="difflineminus">-          if (mozCatIndexList[mozABIndex] &gt; -1 &amp;&amp;</span>
<a href="#l14.613"></a><span id="l14.613" class="difflineminus">-              ! (mozDirFlagsList[mozABIndex] &amp; kIsPabDirFlag) &amp;&amp;</span>
<a href="#l14.614"></a><span id="l14.614" class="difflineminus">-              mozABUrlList[mozABIndex]-&gt;CompareNoCase(COLLECTED_ADDRBOOK_URL))</span>
<a href="#l14.615"></a><span id="l14.615" class="difflineminus">-          {</span>
<a href="#l14.616"></a><span id="l14.616" class="difflineminus">-            CONDUIT_LOG3(gFD, &quot;\nMoz AB[%d] category index = %d, name = '%s' is removed on Palm and needs to be removed from moz\n&quot;, </span>
<a href="#l14.617"></a><span id="l14.617" class="difflineminus">-                    mozABIndex, mozCatIndexList[mozABIndex], mozABNameList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.618"></a><span id="l14.618" class="difflineminus">-            CONDUIT_LOG0(gFD, &quot;  Deleting AB from moz ... &quot;);</span>
<a href="#l14.619"></a><span id="l14.619" class="difflineminus">-            retval = sync-&gt;m_dbPC-&gt;DeletePCAB(mozCatIndexList[mozABIndex], *mozABNameList[mozABIndex], *mozABUrlList[mozABIndex]);</span>
<a href="#l14.620"></a><span id="l14.620" class="difflineminus">-            CONDUIT_LOG1(gFD, &quot;Done deleting AB from moz. retval=%d.\n&quot;, retval);</span>
<a href="#l14.621"></a><span id="l14.621" class="difflineminus">-          }</span>
<a href="#l14.622"></a><span id="l14.622" class="difflineminus">-          else</span>
<a href="#l14.623"></a><span id="l14.623" class="difflineminus">-          {</span>
<a href="#l14.624"></a><span id="l14.624" class="difflineminus">-            CONDUIT_LOG3(gFD, &quot;\nMoz AB[%d] category index = %d, name = '%s', is removed on Palm but only need to reset sync info on moz\n&quot;, </span>
<a href="#l14.625"></a><span id="l14.625" class="difflineminus">-                    mozABIndex, mozCatIndexList[mozABIndex], mozABNameList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.626"></a><span id="l14.626" class="difflineminus">-            // Reset category index and mod time.</span>
<a href="#l14.627"></a><span id="l14.627" class="difflineminus">-            CONDUIT_LOG0(gFD, &quot;  Resetting AB info on moz ... &quot;);</span>
<a href="#l14.628"></a><span id="l14.628" class="difflineminus">-            retval = sync-&gt;m_dbPC-&gt;UpdatePCABSyncInfo(-1, *mozABNameList[mozABIndex]);</span>
<a href="#l14.629"></a><span id="l14.629" class="difflineminus">-            CONDUIT_LOG1(gFD, &quot;  Done resetting AB info on moz. retval=%d.\n&quot;, retval);</span>
<a href="#l14.630"></a><span id="l14.630" class="difflineminus">-          }</span>
<a href="#l14.631"></a><span id="l14.631" class="difflineminus">-        }</span>
<a href="#l14.632"></a><span id="l14.632" class="difflineminus">-    } // end of mozAB not existing in Palm for loop</span>
<a href="#l14.633"></a><span id="l14.633" class="difflineminus">-</span>
<a href="#l14.634"></a><span id="l14.634" class="difflineminus">-    // Purge deleted Palm record permanently (in case they were logically deleted).</span>
<a href="#l14.635"></a><span id="l14.635" class="difflineminus">-    sync-&gt;m_dbHH-&gt;PurgeDeletedRecs();</span>
<a href="#l14.636"></a><span id="l14.636" class="difflineminus">-</span>
<a href="#l14.637"></a><span id="l14.637" class="difflineminus">-    // Free stuff we allocated.</span>
<a href="#l14.638"></a><span id="l14.638" class="difflineminus">-    CoTaskMemFree(mozABSeen);</span>
<a href="#l14.639"></a><span id="l14.639" class="difflineminus">-    </span>
<a href="#l14.640"></a><span id="l14.640" class="difflineminus">-    // update category info in HH</span>
<a href="#l14.641"></a><span id="l14.641" class="difflineminus">-    sync-&gt;m_dbHH-&gt;CompactCategoriesToHH();</span>
<a href="#l14.642"></a><span id="l14.642" class="difflineminus">-</span>
<a href="#l14.643"></a><span id="l14.643" class="difflineminus">-    // close the HH DB once synced</span>
<a href="#l14.644"></a><span id="l14.644" class="difflineminus">-    retval = sync-&gt;m_dbHH-&gt;CloseDB(FALSE);</span>
<a href="#l14.645"></a><span id="l14.645" class="difflineminus">-</span>
<a href="#l14.646"></a><span id="l14.646" class="difflineminus">-    return retval;</span>
<a href="#l14.647"></a><span id="l14.647" class="difflineminus">-}</span>
<a href="#l14.648"></a><span id="l14.648" class="difflineminus">-</span>
<a href="#l14.649"></a><span id="l14.649" class="difflineminus">-long CMozABConduitSync::PerformFastSync()</span>
<a href="#l14.650"></a><span id="l14.650" class="difflineminus">-{</span>
<a href="#l14.651"></a><span id="l14.651" class="difflineminus">-    CONDUIT_LOG0(gFD, &quot;-- SYNC Palm -&gt; PerformFastSync --\n&quot;);</span>
<a href="#l14.652"></a><span id="l14.652" class="difflineminus">-</span>
<a href="#l14.653"></a><span id="l14.653" class="difflineminus">-    DWORD ThreadId;</span>
<a href="#l14.654"></a><span id="l14.654" class="difflineminus">-    DWORD threadExitCode;</span>
<a href="#l14.655"></a><span id="l14.655" class="difflineminus">-    HANDLE hThread = CreateThread(NULL, 0, DoFastSync, this, 0, &amp;ThreadId);</span>
<a href="#l14.656"></a><span id="l14.656" class="difflineminus">-    while (WaitForSingleObject(hThread, 1000) == WAIT_TIMEOUT) {</span>
<a href="#l14.657"></a><span id="l14.657" class="difflineminus">-        SyncYieldCycles(1); // every sec call this for feedback &amp; keep Palm connection alive </span>
<a href="#l14.658"></a><span id="l14.658" class="difflineminus">-        continue;</span>
<a href="#l14.659"></a><span id="l14.659" class="difflineminus">-    }</span>
<a href="#l14.660"></a><span id="l14.660" class="difflineminus">-    </span>
<a href="#l14.661"></a><span id="l14.661" class="difflineminus">-    // get and return thread's return code if available</span>
<a href="#l14.662"></a><span id="l14.662" class="difflineminus">-    BOOL ret = GetExitCodeThread(hThread, &amp;threadExitCode);</span>
<a href="#l14.663"></a><span id="l14.663" class="difflineminus">-    if (!ret)</span>
<a href="#l14.664"></a><span id="l14.664" class="difflineminus">-        return GetLastError();</span>
<a href="#l14.665"></a><span id="l14.665" class="difflineminus">-    // thread failed</span>
<a href="#l14.666"></a><span id="l14.666" class="difflineminus">-    CONDUIT_LOG1(gFD, &quot;GetExitCodeThread failed return code = %d\n&quot;, threadExitCode);</span>
<a href="#l14.667"></a><span id="l14.667" class="difflineminus">-    return threadExitCode;</span>
<a href="#l14.668"></a><span id="l14.668" class="difflineminus">-}</span>
<a href="#l14.669"></a><span id="l14.669" class="difflineminus">-</span>
<a href="#l14.670"></a><span id="l14.670" class="difflineminus">-</span>
<a href="#l14.671"></a><span id="l14.671" class="difflineminus">-long CMozABConduitSync::PerformSlowSync()</span>
<a href="#l14.672"></a><span id="l14.672" class="difflineminus">-{</span>
<a href="#l14.673"></a><span id="l14.673" class="difflineminus">-    // we take care of first time sync in fast sync in an optimized way</span>
<a href="#l14.674"></a><span id="l14.674" class="difflineminus">-    return PerformFastSync();</span>
<a href="#l14.675"></a><span id="l14.675" class="difflineminus">-}</span>
<a href="#l14.676"></a><span id="l14.676" class="difflineminus">-</span>
<a href="#l14.677"></a><span id="l14.677" class="difflineminus">-long CMozABConduitSync::CopyHHtoPC()</span>
<a href="#l14.678"></a><span id="l14.678" class="difflineminus">-{</span>
<a href="#l14.679"></a><span id="l14.679" class="difflineminus">-    long retval=0;</span>
<a href="#l14.680"></a><span id="l14.680" class="difflineminus">-    BOOL success = FALSE;</span>
<a href="#l14.681"></a><span id="l14.681" class="difflineminus">-    CONDUIT_LOG0(gFD, &quot;-- SYNC Palm -&gt; Destkop --\n&quot;);</span>
<a href="#l14.682"></a><span id="l14.682" class="difflineminus">-</span>
<a href="#l14.683"></a><span id="l14.683" class="difflineminus">-    if(!m_dbHH)</span>
<a href="#l14.684"></a><span id="l14.684" class="difflineminus">-        return retval;</span>
<a href="#l14.685"></a><span id="l14.685" class="difflineminus">-    </span>
<a href="#l14.686"></a><span id="l14.686" class="difflineminus">-    DWORD mozABCount=0;</span>
<a href="#l14.687"></a><span id="l14.687" class="difflineminus">-    LONG * mozCatIndexList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.688"></a><span id="l14.688" class="difflineminus">-    CPString ** mozABNameList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.689"></a><span id="l14.689" class="difflineminus">-    CPString ** mozABUrlList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.690"></a><span id="l14.690" class="difflineminus">-    BOOL * mozDirFlagsList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.691"></a><span id="l14.691" class="difflineminus">-    BOOL neverDidPalmSyncBefore = TRUE; // 1st time palm sync?</span>
<a href="#l14.692"></a><span id="l14.692" class="difflineminus">-    DWORD mozABIndex;</span>
<a href="#l14.693"></a><span id="l14.693" class="difflineminus">-</span>
<a href="#l14.694"></a><span id="l14.694" class="difflineminus">-    retval = m_dbHH-&gt;OpenDB(FALSE);</span>
<a href="#l14.695"></a><span id="l14.695" class="difflineminus">-    if (!retval)</span>
<a href="#l14.696"></a><span id="l14.696" class="difflineminus">-        retval = m_dbHH-&gt;LoadCategories();</span>
<a href="#l14.697"></a><span id="l14.697" class="difflineminus">-</span>
<a href="#l14.698"></a><span id="l14.698" class="difflineminus">-    CONDUIT_LOG0(gFD, &quot;Getting moz AB List ... &quot;);</span>
<a href="#l14.699"></a><span id="l14.699" class="difflineminus">-    if(!retval)</span>
<a href="#l14.700"></a><span id="l14.700" class="difflineminus">-        retval = m_dbPC-&gt;GetPCABList(&amp;mozABCount, &amp;mozCatIndexList, &amp;mozABNameList, &amp;mozABUrlList, &amp;mozDirFlagsList);</span>
<a href="#l14.701"></a><span id="l14.701" class="difflineminus">-</span>
<a href="#l14.702"></a><span id="l14.702" class="difflineminus">-    CONDUIT_LOG1(gFD, &quot;Done getting moz AB List. retval = %d\n&quot;, retval);</span>
<a href="#l14.703"></a><span id="l14.703" class="difflineminus">-    if (retval)</span>
<a href="#l14.704"></a><span id="l14.704" class="difflineminus">-      return retval;</span>
<a href="#l14.705"></a><span id="l14.705" class="difflineminus">-    </span>
<a href="#l14.706"></a><span id="l14.706" class="difflineminus">-    // Create an array to help us identify addrbooks that have been deleted on Palm.</span>
<a href="#l14.707"></a><span id="l14.707" class="difflineminus">-    DWORD *mozABSeen = (DWORD *) CoTaskMemAlloc(sizeof(DWORD) * mozABCount);</span>
<a href="#l14.708"></a><span id="l14.708" class="difflineminus">-    if (!mozABSeen)</span>
<a href="#l14.709"></a><span id="l14.709" class="difflineminus">-      return GEN_ERR_LOW_MEMORY;</span>
<a href="#l14.710"></a><span id="l14.710" class="difflineminus">-    else</span>
<a href="#l14.711"></a><span id="l14.711" class="difflineminus">-      memset(mozABSeen, FALSE, sizeof(DWORD) * mozABCount);</span>
<a href="#l14.712"></a><span id="l14.712" class="difflineminus">-</span>
<a href="#l14.713"></a><span id="l14.713" class="difflineminus">-    // See if palm sync was performed before.</span>
<a href="#l14.714"></a><span id="l14.714" class="difflineminus">-    for(mozABIndex=0; mozABIndex&lt;mozABCount; mozABIndex++)</span>
<a href="#l14.715"></a><span id="l14.715" class="difflineminus">-      if (! (mozDirFlagsList[mozABIndex] &amp; kFirstTimeSyncDirFlag))</span>
<a href="#l14.716"></a><span id="l14.716" class="difflineminus">-      {</span>
<a href="#l14.717"></a><span id="l14.717" class="difflineminus">-        neverDidPalmSyncBefore = FALSE;</span>
<a href="#l14.718"></a><span id="l14.718" class="difflineminus">-        break;</span>
<a href="#l14.719"></a><span id="l14.719" class="difflineminus">-      }</span>
<a href="#l14.720"></a><span id="l14.720" class="difflineminus">-    </span>
<a href="#l14.721"></a><span id="l14.721" class="difflineminus">-    // Log moz addrbooks.</span>
<a href="#l14.722"></a><span id="l14.722" class="difflineminus">-    for (mozABIndex=0; mozABIndex&lt;mozABCount; mozABIndex++)</span>
<a href="#l14.723"></a><span id="l14.723" class="difflineminus">-    {</span>
<a href="#l14.724"></a><span id="l14.724" class="difflineminus">-      CONDUIT_LOG5(gFD, &quot;Moz AB[%d] category index/synced=%d/%d, name= '%s', url= '%s'\n&quot;,</span>
<a href="#l14.725"></a><span id="l14.725" class="difflineminus">-                   mozABIndex, mozCatIndexList[mozABIndex], !(mozDirFlagsList[mozABIndex] &amp; kFirstTimeSyncDirFlag), </span>
<a href="#l14.726"></a><span id="l14.726" class="difflineminus">-                   mozABNameList[mozABIndex]-&gt;GetBuffer(0), mozABUrlList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.727"></a><span id="l14.727" class="difflineminus">-    }</span>
<a href="#l14.728"></a><span id="l14.728" class="difflineminus">-</span>
<a href="#l14.729"></a><span id="l14.729" class="difflineminus">-    // For each category, try to find the corresponding AB in the moz AB list</span>
<a href="#l14.730"></a><span id="l14.730" class="difflineminus">-    // and overwrite it with the HH category.</span>
<a href="#l14.731"></a><span id="l14.731" class="difflineminus">-    CPCategory * pCategory = m_dbHH-&gt;GetFirstCategory();</span>
<a href="#l14.732"></a><span id="l14.732" class="difflineminus">-    while (pCategory)</span>
<a href="#l14.733"></a><span id="l14.733" class="difflineminus">-    {</span>
<a href="#l14.734"></a><span id="l14.734" class="difflineminus">-        CPalmRecord ** recordListHH = NULL;</span>
<a href="#l14.735"></a><span id="l14.735" class="difflineminus">-        DWORD recordCountHH=0;</span>
<a href="#l14.736"></a><span id="l14.736" class="difflineminus">-</span>
<a href="#l14.737"></a><span id="l14.737" class="difflineminus">-        DWORD catID = pCategory-&gt;GetID();</span>
<a href="#l14.738"></a><span id="l14.738" class="difflineminus">-        DWORD catIndex = pCategory-&gt;GetIndex();</span>
<a href="#l14.739"></a><span id="l14.739" class="difflineminus">-        DWORD catFlags = pCategory-&gt;GetFlags();</span>
<a href="#l14.740"></a><span id="l14.740" class="difflineminus">-        CPString catName(pCategory-&gt;GetName());</span>
<a href="#l14.741"></a><span id="l14.741" class="difflineminus">-</span>
<a href="#l14.742"></a><span id="l14.742" class="difflineminus">-        CONDUIT_LOG3(gFD, &quot;\nProcessing Palm AB '%s' (catIndex/catId) = (%d/%d)... \n&quot;, catName.GetBuffer(0), catIndex, catID);</span>
<a href="#l14.743"></a><span id="l14.743" class="difflineminus">-        BOOL abRenamed = FALSE;</span>
<a href="#l14.744"></a><span id="l14.744" class="difflineminus">-        BOOL foundInABList=FALSE;</span>
<a href="#l14.745"></a><span id="l14.745" class="difflineminus">-        for(mozABIndex = 0; mozABIndex &lt; mozABCount; mozABIndex++)</span>
<a href="#l14.746"></a><span id="l14.746" class="difflineminus">-        {</span>
<a href="#l14.747"></a><span id="l14.747" class="difflineminus">-            // Palm only allows 15 chars for category names.</span>
<a href="#l14.748"></a><span id="l14.748" class="difflineminus">-            CPString cutOffName;</span>
<a href="#l14.749"></a><span id="l14.749" class="difflineminus">-            if (mozABNameList[mozABIndex]-&gt;Length() &gt; 15)</span>
<a href="#l14.750"></a><span id="l14.750" class="difflineminus">-                cutOffName = mozABNameList[mozABIndex]-&gt;Left(15);</span>
<a href="#l14.751"></a><span id="l14.751" class="difflineminus">-            else</span>
<a href="#l14.752"></a><span id="l14.752" class="difflineminus">-                cutOffName = *mozABNameList[mozABIndex];</span>
<a href="#l14.753"></a><span id="l14.753" class="difflineminus">-</span>
<a href="#l14.754"></a><span id="l14.754" class="difflineminus">-            // if this category has been synchronized before, check if it has been renamed</span>
<a href="#l14.755"></a><span id="l14.755" class="difflineminus">-            if(catIndex == mozCatIndexList[mozABIndex]) </span>
<a href="#l14.756"></a><span id="l14.756" class="difflineminus">-            {</span>
<a href="#l14.757"></a><span id="l14.757" class="difflineminus">-                  CONDUIT_LOG4(gFD, &quot;Category index = %d, name = '%s' moz ab name = %s has been synced before uri = %s\n&quot;, </span>
<a href="#l14.758"></a><span id="l14.758" class="difflineminus">-                    catID, catName.GetBuffer(0), mozABNameList[mozABIndex]-&gt;GetBuffer(0), mozABUrlList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.759"></a><span id="l14.759" class="difflineminus">-                foundInABList = TRUE;</span>
<a href="#l14.760"></a><span id="l14.760" class="difflineminus">-                mozABSeen[mozABIndex] = TRUE; // mark it seen</span>
<a href="#l14.761"></a><span id="l14.761" class="difflineminus">-                // See if the name has been changed on Palm side. Note that if both</span>
<a href="#l14.762"></a><span id="l14.762" class="difflineminus">-                // Palm category and the corresponding moz addrbook are renamed then </span>
<a href="#l14.763"></a><span id="l14.763" class="difflineminus">-                // Palm category name takes precedence.</span>
<a href="#l14.764"></a><span id="l14.764" class="difflineminus">-                if (!CategoryNameMatches(catName, cutOffName, mozDirFlagsList[mozABIndex] &amp; kIsPabDirFlag))</span>
<a href="#l14.765"></a><span id="l14.765" class="difflineminus">-                {</span>
<a href="#l14.766"></a><span id="l14.766" class="difflineminus">-                  abRenamed = TRUE;</span>
<a href="#l14.767"></a><span id="l14.767" class="difflineminus">-                  CONDUIT_LOG3(gFD, &quot;Category index = %d, name = '%s' was renamed (from '%s') on Palm so do the same on moz\n&quot;, </span>
<a href="#l14.768"></a><span id="l14.768" class="difflineminus">-                    catID, catName.GetBuffer(0), mozABNameList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.769"></a><span id="l14.769" class="difflineminus">-                }</span>
<a href="#l14.770"></a><span id="l14.770" class="difflineminus">-                break;</span>
<a href="#l14.771"></a><span id="l14.771" class="difflineminus">-            }</span>
<a href="#l14.772"></a><span id="l14.772" class="difflineminus">-            // if corresponding category exists </span>
<a href="#l14.773"></a><span id="l14.773" class="difflineminus">-            if (CategoryNameMatches(catName, cutOffName, mozDirFlagsList[mozABIndex] &amp; kIsPabDirFlag))</span>
<a href="#l14.774"></a><span id="l14.774" class="difflineminus">-            {</span>
<a href="#l14.775"></a><span id="l14.775" class="difflineminus">-                retval = m_dbHH-&gt;LoadAllRecordsInCategory(catIndex, &amp;recordListHH, &amp;recordCountHH);</span>
<a href="#l14.776"></a><span id="l14.776" class="difflineminus">-                CONDUIT_LOG3(gFD, &quot;Category index = %d, name = '%s' matches moz ab %s\n&quot;, catID, catName.GetBuffer(0), mozABUrlList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.777"></a><span id="l14.777" class="difflineminus">-                foundInABList = TRUE;</span>
<a href="#l14.778"></a><span id="l14.778" class="difflineminus">-                mozABSeen[mozABIndex] = TRUE; // mark it seen</span>
<a href="#l14.779"></a><span id="l14.779" class="difflineminus">-                break;</span>
<a href="#l14.780"></a><span id="l14.780" class="difflineminus">-            }</span>
<a href="#l14.781"></a><span id="l14.781" class="difflineminus">-            else</span>
<a href="#l14.782"></a><span id="l14.782" class="difflineminus">-                CONDUIT_LOG3(gFD, &quot;Category index = %d, name = '%s' doesn't match moz ab %s\n&quot;, catID, catName.GetBuffer(0), mozABUrlList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.783"></a><span id="l14.783" class="difflineminus">-</span>
<a href="#l14.784"></a><span id="l14.784" class="difflineminus">-        } // end of for</span>
<a href="#l14.785"></a><span id="l14.785" class="difflineminus">-</span>
<a href="#l14.786"></a><span id="l14.786" class="difflineminus">-        // we've got a matching moz AB. So, just delete all the cards in the Moz AB and copy over all the cards</span>
<a href="#l14.787"></a><span id="l14.787" class="difflineminus">-        // in the HH category.</span>
<a href="#l14.788"></a><span id="l14.788" class="difflineminus">-        if(!retval &amp;&amp; foundInABList)</span>
<a href="#l14.789"></a><span id="l14.789" class="difflineminus">-        {</span>
<a href="#l14.790"></a><span id="l14.790" class="difflineminus">-          CPalmRecord ** recordListPC=NULL;</span>
<a href="#l14.791"></a><span id="l14.791" class="difflineminus">-          DWORD * newRecIDList=NULL;</span>
<a href="#l14.792"></a><span id="l14.792" class="difflineminus">-//          retval = m_dbPC-&gt;DeletePCAB(mozCatIndexList[mozABIndex], *mozABNameList[mozABIndex], *mozABUrlList[mozABIndex]);</span>
<a href="#l14.793"></a><span id="l14.793" class="difflineminus">-          retval = m_dbHH-&gt;LoadAllRecordsInCategory(catIndex, &amp;recordListHH, &amp;recordCountHH);</span>
<a href="#l14.794"></a><span id="l14.794" class="difflineminus">-          CONDUIT_LOG2(gFD, &quot;  Creating new moz AB %s with %d Palm record(s) ... &quot;, mozABNameList[mozABIndex]-&gt;GetBuffer(0), recordCountHH);</span>
<a href="#l14.795"></a><span id="l14.795" class="difflineminus">-          if(!retval)</span>
<a href="#l14.796"></a><span id="l14.796" class="difflineminus">-            retval = m_dbPC-&gt;AddRecords(TRUE, catIndex, *mozABNameList[mozABIndex], recordCountHH, recordListHH);</span>
<a href="#l14.797"></a><span id="l14.797" class="difflineminus">-</span>
<a href="#l14.798"></a><span id="l14.798" class="difflineminus">-          CONDUIT_LOG1(gFD, &quot;Done creating new moz AB. retval=%d.\n&quot;, retval);</span>
<a href="#l14.799"></a><span id="l14.799" class="difflineminus">-          // the MozAB is now synchronized</span>
<a href="#l14.800"></a><span id="l14.800" class="difflineminus">-          if(!retval)</span>
<a href="#l14.801"></a><span id="l14.801" class="difflineminus">-              mozDirFlagsList[mozABIndex] &amp;= ~kFirstTimeSyncDirFlag;</span>
<a href="#l14.802"></a><span id="l14.802" class="difflineminus">-          // delete the PC recordList now that palm is updated</span>
<a href="#l14.803"></a><span id="l14.803" class="difflineminus">-          if(recordListPC)</span>
<a href="#l14.804"></a><span id="l14.804" class="difflineminus">-              free(recordListPC);  </span>
<a href="#l14.805"></a><span id="l14.805" class="difflineminus">-          // notify Mozilla that sync is done so that memory can be freed </span>
<a href="#l14.806"></a><span id="l14.806" class="difflineminus">-          success = retval ? FALSE : TRUE;</span>
<a href="#l14.807"></a><span id="l14.807" class="difflineminus">-</span>
<a href="#l14.808"></a><span id="l14.808" class="difflineminus">-          retval = m_dbPC-&gt;NotifySyncDone(success);</span>
<a href="#l14.809"></a><span id="l14.809" class="difflineminus">-</span>
<a href="#l14.810"></a><span id="l14.810" class="difflineminus">-          if(newRecIDList)</span>
<a href="#l14.811"></a><span id="l14.811" class="difflineminus">-              free(newRecIDList);</span>
<a href="#l14.812"></a><span id="l14.812" class="difflineminus">-</span>
<a href="#l14.813"></a><span id="l14.813" class="difflineminus">-          // See if it was renamed on palm.</span>
<a href="#l14.814"></a><span id="l14.814" class="difflineminus">-          if (abRenamed)</span>
<a href="#l14.815"></a><span id="l14.815" class="difflineminus">-          {</span>
<a href="#l14.816"></a><span id="l14.816" class="difflineminus">-            // We should not rename personal and collected address books here.</span>
<a href="#l14.817"></a><span id="l14.817" class="difflineminus">-            if (! (mozDirFlagsList[mozABIndex] &amp; kIsPabDirFlag) &amp;&amp;</span>
<a href="#l14.818"></a><span id="l14.818" class="difflineminus">-              mozABUrlList[mozABIndex]-&gt;CompareNoCase(COLLECTED_ADDRBOOK_URL))</span>
<a href="#l14.819"></a><span id="l14.819" class="difflineminus">-            {</span>
<a href="#l14.820"></a><span id="l14.820" class="difflineminus">-              CONDUIT_LOG0(gFD, &quot;  Renaming AB ... &quot;);</span>
<a href="#l14.821"></a><span id="l14.821" class="difflineminus">-              retval = m_dbPC-&gt;RenamePCAB(catIndex, catName, *mozABUrlList[mozABIndex]);</span>
<a href="#l14.822"></a><span id="l14.822" class="difflineminus">-              CONDUIT_LOG1(gFD, &quot;Done renaming AB. retval=%d.\n&quot;, retval);</span>
<a href="#l14.823"></a><span id="l14.823" class="difflineminus">-            }</span>
<a href="#l14.824"></a><span id="l14.824" class="difflineminus">-          }</span>
<a href="#l14.825"></a><span id="l14.825" class="difflineminus">-        }</span>
<a href="#l14.826"></a><span id="l14.826" class="difflineminus">-        </span>
<a href="#l14.827"></a><span id="l14.827" class="difflineminus">-        // If this category can't be found in the moz AB list, then</span>
<a href="#l14.828"></a><span id="l14.828" class="difflineminus">-        // create a new AB in moz with all records in this category</span>
<a href="#l14.829"></a><span id="l14.829" class="difflineminus">-        //  (even if it's an empty AB).</span>
<a href="#l14.830"></a><span id="l14.830" class="difflineminus">-        if(!retval &amp;&amp; !foundInABList) </span>
<a href="#l14.831"></a><span id="l14.831" class="difflineminus">-        {</span>
<a href="#l14.832"></a><span id="l14.832" class="difflineminus">-            CONDUIT_LOG2(gFD, &quot;Category index = %d, name = '%s' is new on palm and needs to be added to moz\n&quot;, catID, catName.GetBuffer(0));</span>
<a href="#l14.833"></a><span id="l14.833" class="difflineminus">-            retval = m_dbHH-&gt;LoadAllRecordsInCategory(catIndex, &amp;recordListHH, &amp;recordCountHH);</span>
<a href="#l14.834"></a><span id="l14.834" class="difflineminus">-            CONDUIT_LOG2(gFD, &quot;  Creating new moz AB %s with %d Palm record(s) ... &quot;, catName.GetBuffer(0), recordCountHH);</span>
<a href="#l14.835"></a><span id="l14.835" class="difflineminus">-            if(!retval)</span>
<a href="#l14.836"></a><span id="l14.836" class="difflineminus">-            {</span>
<a href="#l14.837"></a><span id="l14.837" class="difflineminus">-              CPString mozABName;</span>
<a href="#l14.838"></a><span id="l14.838" class="difflineminus">-</span>
<a href="#l14.839"></a><span id="l14.839" class="difflineminus">-              retval = m_dbPC-&gt;AddRecords(FALSE, catIndex, catName, recordCountHH, recordListHH);</span>
<a href="#l14.840"></a><span id="l14.840" class="difflineminus">-            }</span>
<a href="#l14.841"></a><span id="l14.841" class="difflineminus">-            CONDUIT_LOG2(gFD, &quot;Done creating new moz AB %s - retval=%d.\n&quot;, catName.GetBuffer(0), retval);</span>
<a href="#l14.842"></a><span id="l14.842" class="difflineminus">-        }</span>
<a href="#l14.843"></a><span id="l14.843" class="difflineminus">-</span>
<a href="#l14.844"></a><span id="l14.844" class="difflineminus">-        // delete and free HH records and recordList once synced</span>
<a href="#l14.845"></a><span id="l14.845" class="difflineminus">-        if(recordListHH) </span>
<a href="#l14.846"></a><span id="l14.846" class="difflineminus">-        {</span>
<a href="#l14.847"></a><span id="l14.847" class="difflineminus">-            CPalmRecord ** tempRecordListHH = recordListHH;</span>
<a href="#l14.848"></a><span id="l14.848" class="difflineminus">-            for(DWORD i=0; i &lt; recordCountHH; i++) </span>
<a href="#l14.849"></a><span id="l14.849" class="difflineminus">-            {</span>
<a href="#l14.850"></a><span id="l14.850" class="difflineminus">-                delete *tempRecordListHH;</span>
<a href="#l14.851"></a><span id="l14.851" class="difflineminus">-                tempRecordListHH++;</span>
<a href="#l14.852"></a><span id="l14.852" class="difflineminus">-            }</span>
<a href="#l14.853"></a><span id="l14.853" class="difflineminus">-            free(recordListHH);</span>
<a href="#l14.854"></a><span id="l14.854" class="difflineminus">-        }</span>
<a href="#l14.855"></a><span id="l14.855" class="difflineminus">-</span>
<a href="#l14.856"></a><span id="l14.856" class="difflineminus">-        // Process next category</span>
<a href="#l14.857"></a><span id="l14.857" class="difflineminus">-        pCategory = m_dbHH-&gt;GetNextCategory();</span>
<a href="#l14.858"></a><span id="l14.858" class="difflineminus">-    } // end of while</span>
<a href="#l14.859"></a><span id="l14.859" class="difflineminus">-</span>
<a href="#l14.860"></a><span id="l14.860" class="difflineminus">-    // Free stuff we allocated.</span>
<a href="#l14.861"></a><span id="l14.861" class="difflineminus">-    CoTaskMemFree(mozABSeen);</span>
<a href="#l14.862"></a><span id="l14.862" class="difflineminus">-    </span>
<a href="#l14.863"></a><span id="l14.863" class="difflineminus">-    // update category info in HH</span>
<a href="#l14.864"></a><span id="l14.864" class="difflineminus">-    m_dbHH-&gt;CompactCategoriesToHH();</span>
<a href="#l14.865"></a><span id="l14.865" class="difflineminus">-</span>
<a href="#l14.866"></a><span id="l14.866" class="difflineminus">-    // close the HH DB once synced</span>
<a href="#l14.867"></a><span id="l14.867" class="difflineminus">-    retval = m_dbHH-&gt;CloseDB(FALSE);</span>
<a href="#l14.868"></a><span id="l14.868" class="difflineminus">-</span>
<a href="#l14.869"></a><span id="l14.869" class="difflineminus">-    return retval;</span>
<a href="#l14.870"></a><span id="l14.870" class="difflineminus">-}</span>
<a href="#l14.871"></a><span id="l14.871" class="difflineminus">-</span>
<a href="#l14.872"></a><span id="l14.872" class="difflineminus">-long CMozABConduitSync::CopyPCtoHH()</span>
<a href="#l14.873"></a><span id="l14.873" class="difflineminus">-{</span>
<a href="#l14.874"></a><span id="l14.874" class="difflineminus">-    long retval=0;</span>
<a href="#l14.875"></a><span id="l14.875" class="difflineminus">-    BOOL success = FALSE;</span>
<a href="#l14.876"></a><span id="l14.876" class="difflineminus">-</span>
<a href="#l14.877"></a><span id="l14.877" class="difflineminus">-    CONDUIT_LOG0(gFD, &quot;-- SYNC Destkop-&gt; Palm --\n&quot;);</span>
<a href="#l14.878"></a><span id="l14.878" class="difflineminus">-</span>
<a href="#l14.879"></a><span id="l14.879" class="difflineminus">-    if(!m_dbHH)</span>
<a href="#l14.880"></a><span id="l14.880" class="difflineminus">-        return retval;</span>
<a href="#l14.881"></a><span id="l14.881" class="difflineminus">-    </span>
<a href="#l14.882"></a><span id="l14.882" class="difflineminus">-    DWORD mozABCount=0;</span>
<a href="#l14.883"></a><span id="l14.883" class="difflineminus">-    LONG * mozCatIndexList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.884"></a><span id="l14.884" class="difflineminus">-    CPString ** mozABNameList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.885"></a><span id="l14.885" class="difflineminus">-    CPString ** mozABUrlList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.886"></a><span id="l14.886" class="difflineminus">-    BOOL * mozDirFlagsList = NULL; // freed by MSCOM/Mozilla</span>
<a href="#l14.887"></a><span id="l14.887" class="difflineminus">-    BOOL neverDidPalmSyncBefore = TRUE; // 1st time palm sync?</span>
<a href="#l14.888"></a><span id="l14.888" class="difflineminus">-    DWORD mozABIndex;</span>
<a href="#l14.889"></a><span id="l14.889" class="difflineminus">-</span>
<a href="#l14.890"></a><span id="l14.890" class="difflineminus">-    retval = m_dbHH-&gt;OpenDB(FALSE);</span>
<a href="#l14.891"></a><span id="l14.891" class="difflineminus">-    if (!retval)</span>
<a href="#l14.892"></a><span id="l14.892" class="difflineminus">-        retval = m_dbHH-&gt;LoadCategories();</span>
<a href="#l14.893"></a><span id="l14.893" class="difflineminus">-</span>
<a href="#l14.894"></a><span id="l14.894" class="difflineminus">-    CONDUIT_LOG0(gFD, &quot;Getting moz AB List ... &quot;);</span>
<a href="#l14.895"></a><span id="l14.895" class="difflineminus">-    if(!retval)</span>
<a href="#l14.896"></a><span id="l14.896" class="difflineminus">-        retval = m_dbPC-&gt;GetPCABList(&amp;mozABCount, &amp;mozCatIndexList, &amp;mozABNameList, &amp;mozABUrlList, &amp;mozDirFlagsList);</span>
<a href="#l14.897"></a><span id="l14.897" class="difflineminus">-</span>
<a href="#l14.898"></a><span id="l14.898" class="difflineminus">-    if (retval)</span>
<a href="#l14.899"></a><span id="l14.899" class="difflineminus">-      return retval;</span>
<a href="#l14.900"></a><span id="l14.900" class="difflineminus">-    CONDUIT_LOG0(gFD, &quot;Done getting moz AB List. \n&quot;);</span>
<a href="#l14.901"></a><span id="l14.901" class="difflineminus">-    </span>
<a href="#l14.902"></a><span id="l14.902" class="difflineminus">-    // Create an array to help us identify addrbooks that have been deleted on Palm.</span>
<a href="#l14.903"></a><span id="l14.903" class="difflineminus">-    DWORD *mozABSeen = (DWORD *) CoTaskMemAlloc(sizeof(DWORD) * mozABCount);</span>
<a href="#l14.904"></a><span id="l14.904" class="difflineminus">-    if (!mozABSeen)</span>
<a href="#l14.905"></a><span id="l14.905" class="difflineminus">-      return GEN_ERR_LOW_MEMORY;</span>
<a href="#l14.906"></a><span id="l14.906" class="difflineminus">-    else</span>
<a href="#l14.907"></a><span id="l14.907" class="difflineminus">-      memset(mozABSeen, FALSE, sizeof(DWORD) * mozABCount);</span>
<a href="#l14.908"></a><span id="l14.908" class="difflineminus">-</span>
<a href="#l14.909"></a><span id="l14.909" class="difflineminus">-    // See if palm sync was performed before.</span>
<a href="#l14.910"></a><span id="l14.910" class="difflineminus">-    for(mozABIndex=0; mozABIndex&lt;mozABCount; mozABIndex++)</span>
<a href="#l14.911"></a><span id="l14.911" class="difflineminus">-      if (! (mozDirFlagsList[mozABIndex] &amp; kFirstTimeSyncDirFlag))</span>
<a href="#l14.912"></a><span id="l14.912" class="difflineminus">-      {</span>
<a href="#l14.913"></a><span id="l14.913" class="difflineminus">-        neverDidPalmSyncBefore = FALSE;</span>
<a href="#l14.914"></a><span id="l14.914" class="difflineminus">-        break;</span>
<a href="#l14.915"></a><span id="l14.915" class="difflineminus">-      }</span>
<a href="#l14.916"></a><span id="l14.916" class="difflineminus">-    </span>
<a href="#l14.917"></a><span id="l14.917" class="difflineminus">-    // Log moz addrbooks.</span>
<a href="#l14.918"></a><span id="l14.918" class="difflineminus">-    for (mozABIndex=0; mozABIndex&lt;mozABCount; mozABIndex++)</span>
<a href="#l14.919"></a><span id="l14.919" class="difflineminus">-    {</span>
<a href="#l14.920"></a><span id="l14.920" class="difflineminus">-      CONDUIT_LOG5(gFD, &quot;Moz AB[%d] category index/synced=%d/%d, name= '%s', url= '%s'\n&quot;,</span>
<a href="#l14.921"></a><span id="l14.921" class="difflineminus">-                   mozABIndex, mozCatIndexList[mozABIndex], !(mozDirFlagsList[mozABIndex] &amp; kFirstTimeSyncDirFlag), </span>
<a href="#l14.922"></a><span id="l14.922" class="difflineminus">-                   mozABNameList[mozABIndex]-&gt;GetBuffer(0), mozABUrlList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.923"></a><span id="l14.923" class="difflineminus">-    }</span>
<a href="#l14.924"></a><span id="l14.924" class="difflineminus">-</span>
<a href="#l14.925"></a><span id="l14.925" class="difflineminus">-    // For each category, try to find the corresponding AB in the moz AB list</span>
<a href="#l14.926"></a><span id="l14.926" class="difflineminus">-    // and see if it has been synchronized before and take action accordingly.</span>
<a href="#l14.927"></a><span id="l14.927" class="difflineminus">-    CPCategory * pCategory = m_dbHH-&gt;GetFirstCategory();</span>
<a href="#l14.928"></a><span id="l14.928" class="difflineminus">-    while (pCategory)</span>
<a href="#l14.929"></a><span id="l14.929" class="difflineminus">-    {</span>
<a href="#l14.930"></a><span id="l14.930" class="difflineminus">-        CPalmRecord ** recordListHH = NULL;</span>
<a href="#l14.931"></a><span id="l14.931" class="difflineminus">-        DWORD recordCountHH=0;</span>
<a href="#l14.932"></a><span id="l14.932" class="difflineminus">-</span>
<a href="#l14.933"></a><span id="l14.933" class="difflineminus">-        DWORD catID = pCategory-&gt;GetID();</span>
<a href="#l14.934"></a><span id="l14.934" class="difflineminus">-        DWORD catIndex = pCategory-&gt;GetIndex();</span>
<a href="#l14.935"></a><span id="l14.935" class="difflineminus">-        DWORD catFlags = pCategory-&gt;GetFlags();</span>
<a href="#l14.936"></a><span id="l14.936" class="difflineminus">-        CPString catName(pCategory-&gt;GetName());</span>
<a href="#l14.937"></a><span id="l14.937" class="difflineminus">-</span>
<a href="#l14.938"></a><span id="l14.938" class="difflineminus">-        CONDUIT_LOG3(gFD, &quot;\nProcessing Palm AB '%s' (catIndex/catId) = (%d/%d)... \n&quot;, catName.GetBuffer(0), catIndex, catID);</span>
<a href="#l14.939"></a><span id="l14.939" class="difflineminus">-        BOOL abRenamed = FALSE;</span>
<a href="#l14.940"></a><span id="l14.940" class="difflineminus">-        BOOL foundInABList=FALSE;</span>
<a href="#l14.941"></a><span id="l14.941" class="difflineminus">-</span>
<a href="#l14.942"></a><span id="l14.942" class="difflineminus">-        retval = m_dbHH-&gt;DeleteCategory(catIndex, FALSE); // delete the category - we'll recreate from moz ab.</span>
<a href="#l14.943"></a><span id="l14.943" class="difflineminus">-</span>
<a href="#l14.944"></a><span id="l14.944" class="difflineminus">-        // Process next category</span>
<a href="#l14.945"></a><span id="l14.945" class="difflineminus">-        pCategory = m_dbHH-&gt;GetNextCategory();</span>
<a href="#l14.946"></a><span id="l14.946" class="difflineminus">-    } // end of while</span>
<a href="#l14.947"></a><span id="l14.947" class="difflineminus">-</span>
<a href="#l14.948"></a><span id="l14.948" class="difflineminus">-    // Deal with any Moz AB not existing in Palm, ones not sync'ed above,</span>
<a href="#l14.949"></a><span id="l14.949" class="difflineminus">-    // and the case where Palm ABs have been deleted.</span>
<a href="#l14.950"></a><span id="l14.950" class="difflineminus">-    for(mozABIndex=0; mozABIndex&lt;mozABCount; mozABIndex++)</span>
<a href="#l14.951"></a><span id="l14.951" class="difflineminus">-    {</span>
<a href="#l14.952"></a><span id="l14.952" class="difflineminus">-        CONDUIT_LOG3(gFD, &quot;\nMoz AB[%d] category index = %d, name = '%s' doesn't exist on Palm so needs to be added to palm\n&quot;,</span>
<a href="#l14.953"></a><span id="l14.953" class="difflineminus">-                mozABIndex, mozCatIndexList[mozABIndex], mozABNameList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.954"></a><span id="l14.954" class="difflineminus">-        CPalmRecord ** recordListPC=NULL;</span>
<a href="#l14.955"></a><span id="l14.955" class="difflineminus">-        DWORD recordCountPC=0;</span>
<a href="#l14.956"></a><span id="l14.956" class="difflineminus">-        DWORD * newRecIDList=NULL;</span>
<a href="#l14.957"></a><span id="l14.957" class="difflineminus">-        CPCategory cat;</span>
<a href="#l14.958"></a><span id="l14.958" class="difflineminus">-        retval = m_dbPC-&gt;LoadAllRecords(*mozABNameList[mozABIndex],</span>
<a href="#l14.959"></a><span id="l14.959" class="difflineminus">-						                  &amp;recordCountPC, &amp;recordListPC);</span>
<a href="#l14.960"></a><span id="l14.960" class="difflineminus">-        if(!retval) </span>
<a href="#l14.961"></a><span id="l14.961" class="difflineminus">-        {</span>
<a href="#l14.962"></a><span id="l14.962" class="difflineminus">-            if ((mozDirFlagsList[mozABIndex] &amp; kIsPabDirFlag))</span>
<a href="#l14.963"></a><span id="l14.963" class="difflineminus">-              cat.SetName(&quot;Personal&quot;);</span>
<a href="#l14.964"></a><span id="l14.964" class="difflineminus">-            else</span>
<a href="#l14.965"></a><span id="l14.965" class="difflineminus">-              cat.SetName(mozABNameList[mozABIndex]-&gt;GetBuffer(0));</span>
<a href="#l14.966"></a><span id="l14.966" class="difflineminus">-            CONDUIT_LOG1(gFD, &quot;  Creating new Palm AB with %d record(s) ... &quot;, recordCountPC);</span>
<a href="#l14.967"></a><span id="l14.967" class="difflineminus">-            retval = m_dbHH-&gt;AddCategory(cat);</span>
<a href="#l14.968"></a><span id="l14.968" class="difflineminus">-            CONDUIT_LOG2(gFD, &quot;Done creating new Palm AB, new category index=%d. retval=%d.\n&quot;, cat.GetIndex(), retval);</span>
<a href="#l14.969"></a><span id="l14.969" class="difflineminus">-            if(!retval) {</span>
<a href="#l14.970"></a><span id="l14.970" class="difflineminus">-                CONDUIT_LOG1(gFD, &quot;  Adding %d record(s) to new Palm AB ... &quot;, recordCountPC);</span>
<a href="#l14.971"></a><span id="l14.971" class="difflineminus">-                newRecIDList = (DWORD *) calloc(recordCountPC, sizeof(DWORD));</span>
<a href="#l14.972"></a><span id="l14.972" class="difflineminus">-                for (unsigned long i=0; i &lt; recordCountPC; i++) </span>
<a href="#l14.973"></a><span id="l14.973" class="difflineminus">-                {</span>
<a href="#l14.974"></a><span id="l14.974" class="difflineminus">-                    if(!recordListPC[i])</span>
<a href="#l14.975"></a><span id="l14.975" class="difflineminus">-                        continue;</span>
<a href="#l14.976"></a><span id="l14.976" class="difflineminus">-                    CPalmRecord palmRec = *recordListPC[i];</span>
<a href="#l14.977"></a><span id="l14.977" class="difflineminus">-                    palmRec.SetCategory(cat.GetIndex());</span>
<a href="#l14.978"></a><span id="l14.978" class="difflineminus">-                    retval = m_dbHH-&gt;AddARecord(palmRec); // should we check existing recs?</span>
<a href="#l14.979"></a><span id="l14.979" class="difflineminus">-                    newRecIDList[i] = palmRec.GetID();</span>
<a href="#l14.980"></a><span id="l14.980" class="difflineminus">-                    delete recordListPC[i]; // delete the record now that it is used</span>
<a href="#l14.981"></a><span id="l14.981" class="difflineminus">-                }</span>
<a href="#l14.982"></a><span id="l14.982" class="difflineminus">-                CONDUIT_LOG0(gFD, &quot;Done adding new records to new Palm AB.\n&quot;);</span>
<a href="#l14.983"></a><span id="l14.983" class="difflineminus">-            }</span>
<a href="#l14.984"></a><span id="l14.984" class="difflineminus">-            else</span>
<a href="#l14.985"></a><span id="l14.985" class="difflineminus">-              CONDUIT_LOG1(gFD, &quot;Creating new Palm AB failed. retval=%d.\n&quot;, retval);</span>
<a href="#l14.986"></a><span id="l14.986" class="difflineminus">-        }</span>
<a href="#l14.987"></a><span id="l14.987" class="difflineminus">-        else</span>
<a href="#l14.988"></a><span id="l14.988" class="difflineminus">-          CONDUIT_LOG1(gFD, &quot;  Loading moz AB records failed so can't create new Palm AB. retval=%d.\n&quot;, retval);</span>
<a href="#l14.989"></a><span id="l14.989" class="difflineminus">-</span>
<a href="#l14.990"></a><span id="l14.990" class="difflineminus">-</span>
<a href="#l14.991"></a><span id="l14.991" class="difflineminus">-        // delete the recordList now that palm is updated</span>
<a href="#l14.992"></a><span id="l14.992" class="difflineminus">-        if(recordListPC)</span>
<a href="#l14.993"></a><span id="l14.993" class="difflineminus">-            free(recordListPC);  </span>
<a href="#l14.994"></a><span id="l14.994" class="difflineminus">-        // notify Mozilla that sync is done so that memory can be freed </span>
<a href="#l14.995"></a><span id="l14.995" class="difflineminus">-        if(!retval)</span>
<a href="#l14.996"></a><span id="l14.996" class="difflineminus">-            success = TRUE;</span>
<a href="#l14.997"></a><span id="l14.997" class="difflineminus">-        else</span>
<a href="#l14.998"></a><span id="l14.998" class="difflineminus">-        {</span>
<a href="#l14.999"></a><span id="l14.999" class="difflineminus">-            success = FALSE;</span>
<a href="#l14.1000"></a><span id="l14.1000" class="difflineminus">-            recordCountPC=0;</span>
<a href="#l14.1001"></a><span id="l14.1001" class="difflineminus">-        }</span>
<a href="#l14.1002"></a><span id="l14.1002" class="difflineminus">-        retval = m_dbPC-&gt;NotifySyncDone(success, cat.GetIndex(), recordCountPC, newRecIDList);</span>
<a href="#l14.1003"></a><span id="l14.1003" class="difflineminus">-        if(newRecIDList)</span>
<a href="#l14.1004"></a><span id="l14.1004" class="difflineminus">-            free(newRecIDList);</span>
<a href="#l14.1005"></a><span id="l14.1005" class="difflineminus">-</span>
<a href="#l14.1006"></a><span id="l14.1006" class="difflineminus">-        // Lastly, update the AB with new category index and mod time.</span>
<a href="#l14.1007"></a><span id="l14.1007" class="difflineminus">-        retval = m_dbPC-&gt;UpdatePCABSyncInfo(success ? cat.GetIndex() : -1, *mozABNameList[mozABIndex]);</span>
<a href="#l14.1008"></a><span id="l14.1008" class="difflineminus">-    } // end of mozAB not existing in Palm for loop</span>
<a href="#l14.1009"></a><span id="l14.1009" class="difflineminus">-</span>
<a href="#l14.1010"></a><span id="l14.1010" class="difflineminus">-    // Purge deleted Palm record permanently (in case they were logically deleted).</span>
<a href="#l14.1011"></a><span id="l14.1011" class="difflineminus">-    m_dbHH-&gt;PurgeDeletedRecs();</span>
<a href="#l14.1012"></a><span id="l14.1012" class="difflineminus">-</span>
<a href="#l14.1013"></a><span id="l14.1013" class="difflineminus">-    // Free stuff we allocated.</span>
<a href="#l14.1014"></a><span id="l14.1014" class="difflineminus">-    CoTaskMemFree(mozABSeen);</span>
<a href="#l14.1015"></a><span id="l14.1015" class="difflineminus">-    </span>
<a href="#l14.1016"></a><span id="l14.1016" class="difflineminus">-    // update category info in HH</span>
<a href="#l14.1017"></a><span id="l14.1017" class="difflineminus">-    m_dbHH-&gt;CompactCategoriesToHH();</span>
<a href="#l14.1018"></a><span id="l14.1018" class="difflineminus">-</span>
<a href="#l14.1019"></a><span id="l14.1019" class="difflineminus">-    // close the HH DB once synced</span>
<a href="#l14.1020"></a><span id="l14.1020" class="difflineminus">-    retval = m_dbHH-&gt;CloseDB(FALSE);</span>
<a href="#l14.1021"></a><span id="l14.1021" class="difflineminus">-</span>
<a href="#l14.1022"></a><span id="l14.1022" class="difflineminus">-    return retval;</span>
<a href="#l14.1023"></a><span id="l14.1023" class="difflineminus">-}</span>
<a href="#l14.1024"></a><span id="l14.1024" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">deleted file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/MozABConduitSync.h</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ /dev/null</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -1,114 +0,0 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineminus">- *</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">- *</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">- * License.</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">- *</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">- *</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">- *</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">- *</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">- *</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">- *</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-#ifndef _MOZABCONDUIT_SYNC_H_</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineminus">-#define _MOZABCONDUIT_SYNC_H_</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-#include &lt;Cpalmrec.h&gt;</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineminus">-#include &lt;Pgenerr.h&gt;</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">-</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-#include &quot;MozABHHManager.h&quot;</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-#include &quot;MozABPCManager.h&quot;</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-#define PERSONAL_ADDRBOOK_URL   &quot;moz-abmdbdirectory://abook.mab&quot;</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-#define COLLECTED_ADDRBOOK_URL  &quot;moz-abmdbdirectory://history.mab&quot;</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineminus">-</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineminus">-#define ENV_VAR_CONDUTI_LOG &quot;MOZ_CONDUIT_LOG&quot;</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-#define CONDUIT_LOG0(fd, format) \</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineminus">-  if (fd) \</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-    {fprintf(fd, format); fflush(fd);}</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineminus">-#define CONDUIT_LOG1(fd, format, arg1) \</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-  if (fd) \</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineminus">-    {fprintf(fd, format, arg1); fflush(fd);}</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-#define CONDUIT_LOG2(fd, format, arg1, arg2) \</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-  if (fd) \</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-    {fprintf(fd, format, arg1, arg2); fflush(fd);}</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-#define CONDUIT_LOG3(fd, format, arg1, arg2, arg3) \</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-  if (fd) \</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-    {fprintf(fd, format, arg1, arg2, arg3); fflush(fd);}</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-#define CONDUIT_LOG4(fd, format, arg1, arg2, arg3, arg4) \</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-  if (fd) \</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-    {fprintf(fd, format, arg1, arg2, arg3, arg4); fflush(fd);}</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-#define CONDUIT_LOG5(fd, format, arg1, arg2, arg3, arg4, arg5) \</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-  if (fd) \</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineminus">-    {fprintf(fd, format, arg1, arg2, arg3, arg4, arg5); fflush(fd);}</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineminus">-</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineminus">-extern FILE *gFD; // logging.</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineminus">-class CMozABConduitSync</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineminus">-{</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineminus">-public:</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineminus">-    // OpenConduit creates a new object using this constructor</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineminus">-	CMozABConduitSync(CSyncProperties&amp; rProps);</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineminus">-    // destructor	</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineminus">-    ~CMozABConduitSync();</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineminus">-</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineminus">-    // OpenConduit calls this function to begin the sync process</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-    long Perform();</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-    friend DWORD WINAPI DoFastSync(LPVOID lpParameter);</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineminus">-</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineminus">-protected:</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineminus">-    // default constructor</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineminus">-    CMozABConduitSync();</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineminus">-    </span>
<a href="#l15.95"></a><span id="l15.95" class="difflineminus">-    // initialization method</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineminus">-    long GetRemoteDBInfo(int iIndex);</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineminus">-</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineminus">-    // synchronization methods</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineminus">-    long PerformFastSync();</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineminus">-    long PerformSlowSync();</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-    long CopyHHtoPC();</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineminus">-    long CopyPCtoHH();</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineminus">-    // utility methods</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-    BOOL CategoryExists(CPString &amp;mozABName, BOOL isPAB);</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineminus">-    BOOL CategoryNameMatches(CPString &amp;catName, CPString &amp;cutOffMozABName, BOOL isPAB);</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineminus">-</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineminus">-private:</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineminus">-    CSyncProperties m_rSyncProperties;</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineminus">-</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineminus">-    MozABHHManager *m_dbHH;</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineminus">-    MozABPCManager *m_dbPC;</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineminus">-    CDbList        *m_remoteDB; </span>
<a href="#l15.113"></a><span id="l15.113" class="difflineminus">-    short           m_TotRemoteDBs;</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineminus">-    CSystemInfo     m_SystemInfo;</span>
<a href="#l15.115"></a><span id="l15.115" class="difflineminus">-    CONDHANDLE      m_ConduitHandle;</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineminus">-};</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineminus">-</span>
<a href="#l15.118"></a><span id="l15.118" class="difflineminus">-#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">deleted file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/MozABHHManager.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ /dev/null</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -1,735 +0,0 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineminus">- *</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">- *</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">- * License.</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">- *</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineminus">- *</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">- *</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">- *</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">- *</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineminus">- *</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineminus">-#include &lt;stdio.h&gt;</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineminus">-#include &lt;memory.h&gt;</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-#include &lt;sys/stat.h&gt;</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineminus">-#include &lt;TCHAR.H&gt;</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-#include &lt;malloc.h&gt;</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-#include &lt;syncmgr.h&gt;</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineminus">-#include &lt;Pgenerr.h&gt;</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineminus">-#include &quot;MozABHHManager.h&quot;</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineminus">-</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineminus">-MozABHHManager::MozABHHManager(DWORD dwGenericFlags, </span>
<a href="#l16.56"></a><span id="l16.56" class="difflineminus">-               char *pName, </span>
<a href="#l16.57"></a><span id="l16.57" class="difflineminus">-               DWORD dwCreator, </span>
<a href="#l16.58"></a><span id="l16.58" class="difflineminus">-               DWORD dwType, </span>
<a href="#l16.59"></a><span id="l16.59" class="difflineminus">-               WORD dbFlags, </span>
<a href="#l16.60"></a><span id="l16.60" class="difflineminus">-               WORD dbVersion, </span>
<a href="#l16.61"></a><span id="l16.61" class="difflineminus">-			   int  iCardNum,</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineminus">-               eSyncTypes syncType)</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineminus">-{</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineminus">-    m_hhDB = 0;</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineminus">-    </span>
<a href="#l16.66"></a><span id="l16.66" class="difflineminus">-    m_rInfo.m_pBytes = NULL;</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineminus">-    m_rInfo.m_TotalBytes = 0;</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineminus">-</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineminus">-    m_dwMaxRecordCount = 0;</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineminus">-    m_pCatMgr = NULL;</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineminus">-    // since we are dealing with AB which is a Record DB in Palm</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineminus">-    m_bRecordDB = TRUE;</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineminus">-</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineminus">-    m_szName[0] = '\0';</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineminus">-    SetName( pName);</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineminus">-    m_dwCreator = dwCreator;</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineminus">-    m_dwType    = dwType;</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineminus">-    m_wFlags    = dbFlags;</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineminus">-    m_wVersion  = dbVersion;</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineminus">-    m_CardNum = iCardNum;</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineminus">-</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineminus">-    memset(&amp;m_appInfo, 0, sizeof(CDbGenInfo));</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineminus">-}</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineminus">-</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineminus">-MozABHHManager::~MozABHHManager()</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineminus">-{</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineminus">-    if (m_rInfo.m_pBytes != NULL) {</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineminus">-        delete m_rInfo.m_pBytes;</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineminus">-    }</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineminus">-    m_rInfo.m_pBytes = NULL;</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineminus">-    m_rInfo.m_TotalBytes = 0;</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineminus">-</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineminus">-    if (m_appInfo.m_pBytes) {</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineminus">-        delete m_appInfo.m_pBytes;</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineminus">-        m_appInfo.m_pBytes = NULL;</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineminus">-    }</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineminus">-</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineminus">-    if (m_pCatMgr) {</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineminus">-        delete m_pCatMgr;</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineminus">-        m_pCatMgr = NULL;</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineminus">-    }</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineminus">-</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineminus">-    CloseDB(TRUE);</span>
<a href="#l16.104"></a><span id="l16.104" class="difflineminus">-}</span>
<a href="#l16.105"></a><span id="l16.105" class="difflineminus">-</span>
<a href="#l16.106"></a><span id="l16.106" class="difflineminus">-</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineminus">-long MozABHHManager::AllocateDBInfo(CDbGenInfo &amp;info, BOOL bClearData)</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineminus">-{</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineminus">-    BOOL bNew = FALSE;</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineminus">-</span>
<a href="#l16.111"></a><span id="l16.111" class="difflineminus">-    if (!info.m_pBytes) {</span>
<a href="#l16.112"></a><span id="l16.112" class="difflineminus">-        info.m_pBytes = (BYTE *) new char[MAX_RECORD_SIZE];  // deleted in d'ctor or by caller</span>
<a href="#l16.113"></a><span id="l16.113" class="difflineminus">-        if (!info.m_pBytes)</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineminus">-            return GEN_ERR_LOW_MEMORY;</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineminus">-        info.m_TotalBytes = MAX_RECORD_SIZE;</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineminus">-        bNew = TRUE;</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineminus">-    } </span>
<a href="#l16.118"></a><span id="l16.118" class="difflineminus">-</span>
<a href="#l16.119"></a><span id="l16.119" class="difflineminus">-    if ((bClearData) || (bNew)) {</span>
<a href="#l16.120"></a><span id="l16.120" class="difflineminus">-        memset(info.m_pBytes, 0, info.m_TotalBytes);</span>
<a href="#l16.121"></a><span id="l16.121" class="difflineminus">-    }</span>
<a href="#l16.122"></a><span id="l16.122" class="difflineminus">-    return 0;</span>
<a href="#l16.123"></a><span id="l16.123" class="difflineminus">-}</span>
<a href="#l16.124"></a><span id="l16.124" class="difflineminus">-</span>
<a href="#l16.125"></a><span id="l16.125" class="difflineminus">-long MozABHHManager::GetInfoBlock(CDbGenInfo &amp;info, BOOL bSortInfo)</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineminus">-{</span>
<a href="#l16.127"></a><span id="l16.127" class="difflineminus">-    long  retval=0;</span>
<a href="#l16.128"></a><span id="l16.128" class="difflineminus">-</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineminus">-    // Allocate storage for app/sort info blocks</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineminus">-    retval = AllocateDBInfo(info);</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineminus">-    if (retval)</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineminus">-        return retval;</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineminus">-</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineminus">-    _tcsncpy((char*)info.m_FileName, m_szName, sizeof(info.m_FileName)-1);</span>
<a href="#l16.135"></a><span id="l16.135" class="difflineminus">-    info.m_FileName[sizeof(info.m_FileName)-1] = '\0';</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineminus">-    memset(info.m_pBytes, 0, info.m_TotalBytes);</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineminus">-</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineminus">-    if (!bSortInfo) {</span>
<a href="#l16.139"></a><span id="l16.139" class="difflineminus">-        // Read the AppInfo block</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineminus">-        retval = SyncReadDBAppInfoBlock(m_hhDB, info);</span>
<a href="#l16.141"></a><span id="l16.141" class="difflineminus">-    } else {</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineminus">-        // Read the SortInfo block</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineminus">-        retval = SyncReadDBSortInfoBlock(m_hhDB, info);</span>
<a href="#l16.144"></a><span id="l16.144" class="difflineminus">-    }</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineminus">-    if (retval) {// if error then clean up</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineminus">-        delete info.m_pBytes;</span>
<a href="#l16.147"></a><span id="l16.147" class="difflineminus">-        info.m_pBytes = NULL;</span>
<a href="#l16.148"></a><span id="l16.148" class="difflineminus">-        info.m_TotalBytes = 0;</span>
<a href="#l16.149"></a><span id="l16.149" class="difflineminus">-    }</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineminus">-</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineminus">-    return retval;</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineminus">-}</span>
<a href="#l16.153"></a><span id="l16.153" class="difflineminus">-</span>
<a href="#l16.154"></a><span id="l16.154" class="difflineminus">-</span>
<a href="#l16.155"></a><span id="l16.155" class="difflineminus">-long MozABHHManager::GetAppInfo(CDbGenInfo &amp;rInfo)</span>
<a href="#l16.156"></a><span id="l16.156" class="difflineminus">-{</span>
<a href="#l16.157"></a><span id="l16.157" class="difflineminus">-    long retval = 0;</span>
<a href="#l16.158"></a><span id="l16.158" class="difflineminus">-    BYTE *pBuffer;</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineminus">-</span>
<a href="#l16.160"></a><span id="l16.160" class="difflineminus">-    pBuffer = rInfo.m_pBytes; </span>
<a href="#l16.161"></a><span id="l16.161" class="difflineminus">-    WORD wTotalBytes = rInfo.m_TotalBytes;</span>
<a href="#l16.162"></a><span id="l16.162" class="difflineminus">-    memset(&amp;rInfo, 0, sizeof(CDbGenInfo));</span>
<a href="#l16.163"></a><span id="l16.163" class="difflineminus">-    if ((wTotalBytes &gt; 0) &amp;&amp; (pBuffer)) {</span>
<a href="#l16.164"></a><span id="l16.164" class="difflineminus">-        memset(pBuffer, 0, wTotalBytes);</span>
<a href="#l16.165"></a><span id="l16.165" class="difflineminus">-        rInfo.m_pBytes       = pBuffer; </span>
<a href="#l16.166"></a><span id="l16.166" class="difflineminus">-        rInfo.m_TotalBytes   = wTotalBytes;</span>
<a href="#l16.167"></a><span id="l16.167" class="difflineminus">-    }</span>
<a href="#l16.168"></a><span id="l16.168" class="difflineminus">-</span>
<a href="#l16.169"></a><span id="l16.169" class="difflineminus">-    retval = GetInfoBlock(rInfo);</span>
<a href="#l16.170"></a><span id="l16.170" class="difflineminus">-</span>
<a href="#l16.171"></a><span id="l16.171" class="difflineminus">-    if (retval) { // if error cleanup</span>
<a href="#l16.172"></a><span id="l16.172" class="difflineminus">-        if (rInfo.m_pBytes) {</span>
<a href="#l16.173"></a><span id="l16.173" class="difflineminus">-            delete rInfo.m_pBytes;</span>
<a href="#l16.174"></a><span id="l16.174" class="difflineminus">-            rInfo.m_pBytes = NULL;</span>
<a href="#l16.175"></a><span id="l16.175" class="difflineminus">-            rInfo.m_TotalBytes   = 0;</span>
<a href="#l16.176"></a><span id="l16.176" class="difflineminus">-        }</span>
<a href="#l16.177"></a><span id="l16.177" class="difflineminus">-    }</span>
<a href="#l16.178"></a><span id="l16.178" class="difflineminus">-</span>
<a href="#l16.179"></a><span id="l16.179" class="difflineminus">-    return retval;</span>
<a href="#l16.180"></a><span id="l16.180" class="difflineminus">-}</span>
<a href="#l16.181"></a><span id="l16.181" class="difflineminus">-</span>
<a href="#l16.182"></a><span id="l16.182" class="difflineminus">-long MozABHHManager::SetName( char *pName)</span>
<a href="#l16.183"></a><span id="l16.183" class="difflineminus">-{</span>
<a href="#l16.184"></a><span id="l16.184" class="difflineminus">-    if (m_hhDB)</span>
<a href="#l16.185"></a><span id="l16.185" class="difflineminus">-        return GEN_ERR_DB_ALREADY_OPEN;</span>
<a href="#l16.186"></a><span id="l16.186" class="difflineminus">-</span>
<a href="#l16.187"></a><span id="l16.187" class="difflineminus">-    WORD wLen;</span>
<a href="#l16.188"></a><span id="l16.188" class="difflineminus">-    if (!pName){</span>
<a href="#l16.189"></a><span id="l16.189" class="difflineminus">-        *m_szName = '\0';</span>
<a href="#l16.190"></a><span id="l16.190" class="difflineminus">-        return 0;</span>
<a href="#l16.191"></a><span id="l16.191" class="difflineminus">-    } </span>
<a href="#l16.192"></a><span id="l16.192" class="difflineminus">-    wLen = (WORD)strlen(pName);</span>
<a href="#l16.193"></a><span id="l16.193" class="difflineminus">-    if (!wLen) {</span>
<a href="#l16.194"></a><span id="l16.194" class="difflineminus">-        *m_szName = '\0';</span>
<a href="#l16.195"></a><span id="l16.195" class="difflineminus">-        return 0;</span>
<a href="#l16.196"></a><span id="l16.196" class="difflineminus">-    }</span>
<a href="#l16.197"></a><span id="l16.197" class="difflineminus">-    if (wLen &gt;= sizeof(m_szName))</span>
<a href="#l16.198"></a><span id="l16.198" class="difflineminus">-        return GEN_ERR_DATA_TOO_LARGE;</span>
<a href="#l16.199"></a><span id="l16.199" class="difflineminus">-</span>
<a href="#l16.200"></a><span id="l16.200" class="difflineminus">-    strncpy(m_szName, pName, sizeof(m_szName)-1);</span>
<a href="#l16.201"></a><span id="l16.201" class="difflineminus">-    m_szName[sizeof(m_szName)-1] = '\0';</span>
<a href="#l16.202"></a><span id="l16.202" class="difflineminus">-    return 0;</span>
<a href="#l16.203"></a><span id="l16.203" class="difflineminus">-}</span>
<a href="#l16.204"></a><span id="l16.204" class="difflineminus">-</span>
<a href="#l16.205"></a><span id="l16.205" class="difflineminus">-long MozABHHManager::LoadCategories(void)</span>
<a href="#l16.206"></a><span id="l16.206" class="difflineminus">-{</span>
<a href="#l16.207"></a><span id="l16.207" class="difflineminus">-    long retval=0;</span>
<a href="#l16.208"></a><span id="l16.208" class="difflineminus">-</span>
<a href="#l16.209"></a><span id="l16.209" class="difflineminus">-    if (m_pCatMgr) {  // remove existing manager</span>
<a href="#l16.210"></a><span id="l16.210" class="difflineminus">-        delete m_pCatMgr;</span>
<a href="#l16.211"></a><span id="l16.211" class="difflineminus">-        m_pCatMgr = NULL;</span>
<a href="#l16.212"></a><span id="l16.212" class="difflineminus">-    }</span>
<a href="#l16.213"></a><span id="l16.213" class="difflineminus">-</span>
<a href="#l16.214"></a><span id="l16.214" class="difflineminus">-    if (m_appInfo.m_BytesRead == 0){</span>
<a href="#l16.215"></a><span id="l16.215" class="difflineminus">-        retval = GetAppInfo(m_appInfo);</span>
<a href="#l16.216"></a><span id="l16.216" class="difflineminus">-        if (retval)</span>
<a href="#l16.217"></a><span id="l16.217" class="difflineminus">-            return retval;</span>
<a href="#l16.218"></a><span id="l16.218" class="difflineminus">-    }</span>
<a href="#l16.219"></a><span id="l16.219" class="difflineminus">-</span>
<a href="#l16.220"></a><span id="l16.220" class="difflineminus">-    if ((m_appInfo.m_BytesRead &gt; 0) &amp;&amp; (m_appInfo.m_pBytes)){</span>
<a href="#l16.221"></a><span id="l16.221" class="difflineminus">-        m_pCatMgr = new CPCategoryMgr(m_appInfo.m_pBytes, m_appInfo.m_BytesRead); // deleted in d'ctor</span>
<a href="#l16.222"></a><span id="l16.222" class="difflineminus">-        if (!m_pCatMgr)</span>
<a href="#l16.223"></a><span id="l16.223" class="difflineminus">-            return GEN_ERR_LOW_MEMORY;</span>
<a href="#l16.224"></a><span id="l16.224" class="difflineminus">-    } else {</span>
<a href="#l16.225"></a><span id="l16.225" class="difflineminus">-        retval = GEN_ERR_NO_CATEGORIES;</span>
<a href="#l16.226"></a><span id="l16.226" class="difflineminus">-    }</span>
<a href="#l16.227"></a><span id="l16.227" class="difflineminus">-    return retval;</span>
<a href="#l16.228"></a><span id="l16.228" class="difflineminus">-}</span>
<a href="#l16.229"></a><span id="l16.229" class="difflineminus">-</span>
<a href="#l16.230"></a><span id="l16.230" class="difflineminus">-long MozABHHManager::AddCategory(CPCategory &amp; cat)</span>
<a href="#l16.231"></a><span id="l16.231" class="difflineminus">-{</span>
<a href="#l16.232"></a><span id="l16.232" class="difflineminus">-    long retval=0;</span>
<a href="#l16.233"></a><span id="l16.233" class="difflineminus">-</span>
<a href="#l16.234"></a><span id="l16.234" class="difflineminus">-    if(!m_pCatMgr)</span>
<a href="#l16.235"></a><span id="l16.235" class="difflineminus">-        retval = LoadCategories();</span>
<a href="#l16.236"></a><span id="l16.236" class="difflineminus">-</span>
<a href="#l16.237"></a><span id="l16.237" class="difflineminus">-    // generate a new ID and Add the category</span>
<a href="#l16.238"></a><span id="l16.238" class="difflineminus">-    if(!retval) {</span>
<a href="#l16.239"></a><span id="l16.239" class="difflineminus">-        int id;</span>
<a href="#l16.240"></a><span id="l16.240" class="difflineminus">-        for(id = 0; id &lt;= MAX_CATEGORIES; id++)</span>
<a href="#l16.241"></a><span id="l16.241" class="difflineminus">-            if(!m_pCatMgr-&gt;FindID(id))</span>
<a href="#l16.242"></a><span id="l16.242" class="difflineminus">-                break;</span>
<a href="#l16.243"></a><span id="l16.243" class="difflineminus">-        // if ID doesnot already exist</span>
<a href="#l16.244"></a><span id="l16.244" class="difflineminus">-        if(id &lt; MAX_CATEGORIES) {</span>
<a href="#l16.245"></a><span id="l16.245" class="difflineminus">-            cat.SetID(MAKELONG(id, 0));</span>
<a href="#l16.246"></a><span id="l16.246" class="difflineminus">-            retval = m_pCatMgr-&gt;Add(cat);</span>
<a href="#l16.247"></a><span id="l16.247" class="difflineminus">-        }</span>
<a href="#l16.248"></a><span id="l16.248" class="difflineminus">-        else</span>
<a href="#l16.249"></a><span id="l16.249" class="difflineminus">-            retval = CAT_NO_ID;</span>
<a href="#l16.250"></a><span id="l16.250" class="difflineminus">-    }</span>
<a href="#l16.251"></a><span id="l16.251" class="difflineminus">-</span>
<a href="#l16.252"></a><span id="l16.252" class="difflineminus">-    if(!retval)</span>
<a href="#l16.253"></a><span id="l16.253" class="difflineminus">-        m_pCatMgr-&gt;SetChanged();</span>
<a href="#l16.254"></a><span id="l16.254" class="difflineminus">-</span>
<a href="#l16.255"></a><span id="l16.255" class="difflineminus">-    return retval;    </span>
<a href="#l16.256"></a><span id="l16.256" class="difflineminus">-}</span>
<a href="#l16.257"></a><span id="l16.257" class="difflineminus">-</span>
<a href="#l16.258"></a><span id="l16.258" class="difflineminus">-long MozABHHManager::DeleteCategory(DWORD dwCategory, BOOL bMoveToUnfiled)</span>
<a href="#l16.259"></a><span id="l16.259" class="difflineminus">-{</span>
<a href="#l16.260"></a><span id="l16.260" class="difflineminus">-    long retval=0;</span>
<a href="#l16.261"></a><span id="l16.261" class="difflineminus">-</span>
<a href="#l16.262"></a><span id="l16.262" class="difflineminus">-    if ((dwCategory &lt; 0) || (dwCategory &gt;= MAX_CATEGORIES))</span>
<a href="#l16.263"></a><span id="l16.263" class="difflineminus">-        return CAT_ERR_INDEX_OUT_OF_RANGE;</span>
<a href="#l16.264"></a><span id="l16.264" class="difflineminus">-</span>
<a href="#l16.265"></a><span id="l16.265" class="difflineminus">-    BYTE sCategory = LOBYTE(LOWORD(dwCategory));</span>
<a href="#l16.266"></a><span id="l16.266" class="difflineminus">-</span>
<a href="#l16.267"></a><span id="l16.267" class="difflineminus">-    if (!bMoveToUnfiled)</span>
<a href="#l16.268"></a><span id="l16.268" class="difflineminus">-    {</span>
<a href="#l16.269"></a><span id="l16.269" class="difflineminus">-        retval = SyncPurgeAllRecsInCategory(m_hhDB, sCategory);</span>
<a href="#l16.270"></a><span id="l16.270" class="difflineminus">-        m_pCatMgr-&gt;DeleteByIndex(dwCategory); // delete category itself</span>
<a href="#l16.271"></a><span id="l16.271" class="difflineminus">-    }</span>
<a href="#l16.272"></a><span id="l16.272" class="difflineminus">-    else </span>
<a href="#l16.273"></a><span id="l16.273" class="difflineminus">-        retval = SyncChangeCategory(m_hhDB, sCategory, 0);</span>
<a href="#l16.274"></a><span id="l16.274" class="difflineminus">-    return retval;</span>
<a href="#l16.275"></a><span id="l16.275" class="difflineminus">-}</span>
<a href="#l16.276"></a><span id="l16.276" class="difflineminus">-</span>
<a href="#l16.277"></a><span id="l16.277" class="difflineminus">-long MozABHHManager::ChangeCategory(DWORD dwOldCatIndex, DWORD dwNewCatIndex)</span>
<a href="#l16.278"></a><span id="l16.278" class="difflineminus">-{</span>
<a href="#l16.279"></a><span id="l16.279" class="difflineminus">-    long retval=0;</span>
<a href="#l16.280"></a><span id="l16.280" class="difflineminus">-</span>
<a href="#l16.281"></a><span id="l16.281" class="difflineminus">-    if ((dwOldCatIndex &lt; 0) || (dwOldCatIndex &gt;= MAX_CATEGORIES))</span>
<a href="#l16.282"></a><span id="l16.282" class="difflineminus">-        return CAT_ERR_INDEX_OUT_OF_RANGE;</span>
<a href="#l16.283"></a><span id="l16.283" class="difflineminus">-</span>
<a href="#l16.284"></a><span id="l16.284" class="difflineminus">-    BYTE sCategory = LOBYTE(LOWORD(dwOldCatIndex));</span>
<a href="#l16.285"></a><span id="l16.285" class="difflineminus">-</span>
<a href="#l16.286"></a><span id="l16.286" class="difflineminus">-    if ((dwNewCatIndex &lt; 0) || (dwNewCatIndex &gt;= MAX_CATEGORIES))</span>
<a href="#l16.287"></a><span id="l16.287" class="difflineminus">-        return CAT_ERR_INDEX_OUT_OF_RANGE;</span>
<a href="#l16.288"></a><span id="l16.288" class="difflineminus">-</span>
<a href="#l16.289"></a><span id="l16.289" class="difflineminus">-    BYTE sNewCategory = LOBYTE(LOWORD(dwNewCatIndex));</span>
<a href="#l16.290"></a><span id="l16.290" class="difflineminus">-</span>
<a href="#l16.291"></a><span id="l16.291" class="difflineminus">-    retval = SyncChangeCategory(m_hhDB, sCategory, sNewCategory);</span>
<a href="#l16.292"></a><span id="l16.292" class="difflineminus">-    return retval;</span>
<a href="#l16.293"></a><span id="l16.293" class="difflineminus">-}</span>
<a href="#l16.294"></a><span id="l16.294" class="difflineminus">-</span>
<a href="#l16.295"></a><span id="l16.295" class="difflineminus">-long MozABHHManager::CompactCategoriesToHH()</span>
<a href="#l16.296"></a><span id="l16.296" class="difflineminus">-{</span>
<a href="#l16.297"></a><span id="l16.297" class="difflineminus">-    long retval = 0;</span>
<a href="#l16.298"></a><span id="l16.298" class="difflineminus">-</span>
<a href="#l16.299"></a><span id="l16.299" class="difflineminus">-    if ((!m_pCatMgr) || (!m_pCatMgr-&gt;IsChanged()))</span>
<a href="#l16.300"></a><span id="l16.300" class="difflineminus">-        return 0;</span>
<a href="#l16.301"></a><span id="l16.301" class="difflineminus">-</span>
<a href="#l16.302"></a><span id="l16.302" class="difflineminus">-    retval = AllocateDBInfo(m_appInfo);</span>
<a href="#l16.303"></a><span id="l16.303" class="difflineminus">-    if (retval)</span>
<a href="#l16.304"></a><span id="l16.304" class="difflineminus">-        return retval;</span>
<a href="#l16.305"></a><span id="l16.305" class="difflineminus">-</span>
<a href="#l16.306"></a><span id="l16.306" class="difflineminus">-    DWORD dwRecSize;</span>
<a href="#l16.307"></a><span id="l16.307" class="difflineminus">-</span>
<a href="#l16.308"></a><span id="l16.308" class="difflineminus">-    dwRecSize = m_appInfo.m_TotalBytes;</span>
<a href="#l16.309"></a><span id="l16.309" class="difflineminus">-</span>
<a href="#l16.310"></a><span id="l16.310" class="difflineminus">-    retval = m_pCatMgr-&gt;Compact(m_appInfo.m_pBytes, &amp;dwRecSize);</span>
<a href="#l16.311"></a><span id="l16.311" class="difflineminus">-    if (!retval) {</span>
<a href="#l16.312"></a><span id="l16.312" class="difflineminus">-        // more than just the categories may be stored in the app info structure</span>
<a href="#l16.313"></a><span id="l16.313" class="difflineminus">-        // This code only replaces the category area.</span>
<a href="#l16.314"></a><span id="l16.314" class="difflineminus">-        if (!m_appInfo.m_BytesRead)</span>
<a href="#l16.315"></a><span id="l16.315" class="difflineminus">-            m_appInfo.m_BytesRead = LOWORD(dwRecSize);</span>
<a href="#l16.316"></a><span id="l16.316" class="difflineminus">-    }</span>
<a href="#l16.317"></a><span id="l16.317" class="difflineminus">-</span>
<a href="#l16.318"></a><span id="l16.318" class="difflineminus">-    if(!retval)</span>
<a href="#l16.319"></a><span id="l16.319" class="difflineminus">-        retval = SyncWriteDBAppInfoBlock(m_hhDB, m_appInfo);</span>
<a href="#l16.320"></a><span id="l16.320" class="difflineminus">-</span>
<a href="#l16.321"></a><span id="l16.321" class="difflineminus">-    return retval;</span>
<a href="#l16.322"></a><span id="l16.322" class="difflineminus">-}</span>
<a href="#l16.323"></a><span id="l16.323" class="difflineminus">-</span>
<a href="#l16.324"></a><span id="l16.324" class="difflineminus">-long MozABHHManager::OpenDB(BOOL bCreate)</span>
<a href="#l16.325"></a><span id="l16.325" class="difflineminus">-{</span>
<a href="#l16.326"></a><span id="l16.326" class="difflineminus">-    long retval=0;</span>
<a href="#l16.327"></a><span id="l16.327" class="difflineminus">-</span>
<a href="#l16.328"></a><span id="l16.328" class="difflineminus">-    if (bCreate) {</span>
<a href="#l16.329"></a><span id="l16.329" class="difflineminus">-       CDbCreateDB  createInfo;</span>
<a href="#l16.330"></a><span id="l16.330" class="difflineminus">-</span>
<a href="#l16.331"></a><span id="l16.331" class="difflineminus">-        // Delete any existing DB with the same name</span>
<a href="#l16.332"></a><span id="l16.332" class="difflineminus">-        SyncDeleteDB(m_szName, m_CardNum);</span>
<a href="#l16.333"></a><span id="l16.333" class="difflineminus">-</span>
<a href="#l16.334"></a><span id="l16.334" class="difflineminus">-        memset(&amp;createInfo, 0, sizeof(CDbCreateDB));</span>
<a href="#l16.335"></a><span id="l16.335" class="difflineminus">-</span>
<a href="#l16.336"></a><span id="l16.336" class="difflineminus">-        createInfo.m_Creator     = m_dwCreator; </span>
<a href="#l16.337"></a><span id="l16.337" class="difflineminus">-        createInfo.m_Type        = m_dwType; </span>
<a href="#l16.338"></a><span id="l16.338" class="difflineminus">-        createInfo.m_Flags       = (eDbFlags) m_wFlags;</span>
<a href="#l16.339"></a><span id="l16.339" class="difflineminus">-        createInfo.m_CardNo     = m_CardNum;  </span>
<a href="#l16.340"></a><span id="l16.340" class="difflineminus">-        strncpy(createInfo.m_Name, m_szName, sizeof(createInfo.m_Name)-1);</span>
<a href="#l16.341"></a><span id="l16.341" class="difflineminus">-        createInfo.m_Name[sizeof(createInfo.m_Name)-1] = '\0';</span>
<a href="#l16.342"></a><span id="l16.342" class="difflineminus">-        createInfo.m_Version    = m_wVersion;</span>
<a href="#l16.343"></a><span id="l16.343" class="difflineminus">-</span>
<a href="#l16.344"></a><span id="l16.344" class="difflineminus">-        if ((retval = SyncCreateDB(createInfo)) == SYNCERR_NONE)</span>
<a href="#l16.345"></a><span id="l16.345" class="difflineminus">-            m_hhDB = createInfo.m_FileHandle;</span>
<a href="#l16.346"></a><span id="l16.346" class="difflineminus">-    }</span>
<a href="#l16.347"></a><span id="l16.347" class="difflineminus">-    else </span>
<a href="#l16.348"></a><span id="l16.348" class="difflineminus">-    {</span>
<a href="#l16.349"></a><span id="l16.349" class="difflineminus">-        retval = SyncOpenDB(m_szName, </span>
<a href="#l16.350"></a><span id="l16.350" class="difflineminus">-                            m_CardNum, </span>
<a href="#l16.351"></a><span id="l16.351" class="difflineminus">-                            m_hhDB,</span>
<a href="#l16.352"></a><span id="l16.352" class="difflineminus">-                            eDbRead | eDbWrite);</span>
<a href="#l16.353"></a><span id="l16.353" class="difflineminus">-        if ((retval) &amp;&amp; (retval == SYNCERR_NOT_FOUND))</span>
<a href="#l16.354"></a><span id="l16.354" class="difflineminus">-            retval = GEN_ERR_NO_HH_DB;</span>
<a href="#l16.355"></a><span id="l16.355" class="difflineminus">-    } </span>
<a href="#l16.356"></a><span id="l16.356" class="difflineminus">-</span>
<a href="#l16.357"></a><span id="l16.357" class="difflineminus">-    return retval;</span>
<a href="#l16.358"></a><span id="l16.358" class="difflineminus">-}</span>
<a href="#l16.359"></a><span id="l16.359" class="difflineminus">-</span>
<a href="#l16.360"></a><span id="l16.360" class="difflineminus">-long MozABHHManager::CloseDB(BOOL bDontUpdate)</span>
<a href="#l16.361"></a><span id="l16.361" class="difflineminus">-{</span>
<a href="#l16.362"></a><span id="l16.362" class="difflineminus">-    long retval = 0;</span>
<a href="#l16.363"></a><span id="l16.363" class="difflineminus">-    long retval2 = 0;</span>
<a href="#l16.364"></a><span id="l16.364" class="difflineminus">-</span>
<a href="#l16.365"></a><span id="l16.365" class="difflineminus">-    if (m_hhDB == NULL) </span>
<a href="#l16.366"></a><span id="l16.366" class="difflineminus">-        return GEN_ERR_DB_NOT_OPEN;</span>
<a href="#l16.367"></a><span id="l16.367" class="difflineminus">-</span>
<a href="#l16.368"></a><span id="l16.368" class="difflineminus">-    if (!bDontUpdate) {</span>
<a href="#l16.369"></a><span id="l16.369" class="difflineminus">-        retval = SyncResetSyncFlags(m_hhDB);</span>
<a href="#l16.370"></a><span id="l16.370" class="difflineminus">-    }</span>
<a href="#l16.371"></a><span id="l16.371" class="difflineminus">-    retval2 = SyncCloseDB(m_hhDB);</span>
<a href="#l16.372"></a><span id="l16.372" class="difflineminus">-    if (!retval)</span>
<a href="#l16.373"></a><span id="l16.373" class="difflineminus">-        retval = retval2;</span>
<a href="#l16.374"></a><span id="l16.374" class="difflineminus">-    m_hhDB = NULL;</span>
<a href="#l16.375"></a><span id="l16.375" class="difflineminus">-    return retval;</span>
<a href="#l16.376"></a><span id="l16.376" class="difflineminus">-}</span>
<a href="#l16.377"></a><span id="l16.377" class="difflineminus">-</span>
<a href="#l16.378"></a><span id="l16.378" class="difflineminus">-long MozABHHManager::LoadAllUpdatedRecords(CPalmRecord ***ppRecordList, DWORD * pListSize)</span>
<a href="#l16.379"></a><span id="l16.379" class="difflineminus">-{</span>
<a href="#l16.380"></a><span id="l16.380" class="difflineminus">-    return LoadUpdatedRecords(0, ppRecordList, pListSize);</span>
<a href="#l16.381"></a><span id="l16.381" class="difflineminus">-}</span>
<a href="#l16.382"></a><span id="l16.382" class="difflineminus">-</span>
<a href="#l16.383"></a><span id="l16.383" class="difflineminus">-long MozABHHManager::LoadUpdatedRecordsInCategory(DWORD catIndex, CPalmRecord ***ppRecordList, DWORD * pListSize)</span>
<a href="#l16.384"></a><span id="l16.384" class="difflineminus">-{</span>
<a href="#l16.385"></a><span id="l16.385" class="difflineminus">-    return LoadUpdatedRecords(catIndex, ppRecordList, pListSize);</span>
<a href="#l16.386"></a><span id="l16.386" class="difflineminus">-}</span>
<a href="#l16.387"></a><span id="l16.387" class="difflineminus">-</span>
<a href="#l16.388"></a><span id="l16.388" class="difflineminus">-// this function allocates the list as well as the records, caller should free list and delete records</span>
<a href="#l16.389"></a><span id="l16.389" class="difflineminus">-long MozABHHManager::LoadUpdatedRecords(DWORD catIndex, CPalmRecord ***ppRecordList, DWORD * pListSize)</span>
<a href="#l16.390"></a><span id="l16.390" class="difflineminus">-{</span>
<a href="#l16.391"></a><span id="l16.391" class="difflineminus">-    long retval=0;</span>
<a href="#l16.392"></a><span id="l16.392" class="difflineminus">-    WORD dwRecCount=0;</span>
<a href="#l16.393"></a><span id="l16.393" class="difflineminus">-</span>
<a href="#l16.394"></a><span id="l16.394" class="difflineminus">-    retval = SyncGetDBRecordCount(m_hhDB, dwRecCount);</span>
<a href="#l16.395"></a><span id="l16.395" class="difflineminus">-    if (retval)</span>
<a href="#l16.396"></a><span id="l16.396" class="difflineminus">-        return retval;</span>
<a href="#l16.397"></a><span id="l16.397" class="difflineminus">-</span>
<a href="#l16.398"></a><span id="l16.398" class="difflineminus">-    // resset the iteration index</span>
<a href="#l16.399"></a><span id="l16.399" class="difflineminus">-    retval = SyncResetRecordIndex(m_hhDB);</span>
<a href="#l16.400"></a><span id="l16.400" class="difflineminus">-    if (retval)</span>
<a href="#l16.401"></a><span id="l16.401" class="difflineminus">-        return retval;</span>
<a href="#l16.402"></a><span id="l16.402" class="difflineminus">-</span>
<a href="#l16.403"></a><span id="l16.403" class="difflineminus">-    // allocate buffer initially for the total record size and adjust after getting records</span>
<a href="#l16.404"></a><span id="l16.404" class="difflineminus">-    CPalmRecord ** palmRecordList = (CPalmRecord **) malloc(sizeof(CPalmRecord *) * dwRecCount);</span>
<a href="#l16.405"></a><span id="l16.405" class="difflineminus">-    if (!palmRecordList)</span>
<a href="#l16.406"></a><span id="l16.406" class="difflineminus">-        return GEN_ERR_LOW_MEMORY;</span>
<a href="#l16.407"></a><span id="l16.407" class="difflineminus">-    memset(palmRecordList, 0, sizeof(CPalmRecord *) * dwRecCount);</span>
<a href="#l16.408"></a><span id="l16.408" class="difflineminus">-    *ppRecordList = palmRecordList;</span>
<a href="#l16.409"></a><span id="l16.409" class="difflineminus">-</span>
<a href="#l16.410"></a><span id="l16.410" class="difflineminus">-    // SyncReadNextModifiedRecInCategory() does not seem to be returning</span>
<a href="#l16.411"></a><span id="l16.411" class="difflineminus">-    // deleted palm records, so SyncReadNextModifiedRec() is used instead.</span>
<a href="#l16.412"></a><span id="l16.412" class="difflineminus">-    CPalmRecord *pPalmRec;</span>
<a href="#l16.413"></a><span id="l16.413" class="difflineminus">-    *pListSize = 0;</span>
<a href="#l16.414"></a><span id="l16.414" class="difflineminus">-    while ((!retval) &amp;&amp; (*pListSize &lt; dwRecCount))  {</span>
<a href="#l16.415"></a><span id="l16.415" class="difflineminus">-        retval = AllocateRawRecord();</span>
<a href="#l16.416"></a><span id="l16.416" class="difflineminus">-        if(retval)</span>
<a href="#l16.417"></a><span id="l16.417" class="difflineminus">-            break;</span>
<a href="#l16.418"></a><span id="l16.418" class="difflineminus">-        m_rInfo.m_RecIndex = 0;</span>
<a href="#l16.419"></a><span id="l16.419" class="difflineminus">-        retval = SyncReadNextModifiedRec(m_rInfo);</span>
<a href="#l16.420"></a><span id="l16.420" class="difflineminus">-        // Does it belong to the category we care about?</span>
<a href="#l16.421"></a><span id="l16.421" class="difflineminus">-        if (!retval &amp;&amp; m_rInfo.m_CatId == catIndex)</span>
<a href="#l16.422"></a><span id="l16.422" class="difflineminus">-        {</span>
<a href="#l16.423"></a><span id="l16.423" class="difflineminus">-            pPalmRec = new CPalmRecord(m_rInfo);</span>
<a href="#l16.424"></a><span id="l16.424" class="difflineminus">-            if (pPalmRec) {</span>
<a href="#l16.425"></a><span id="l16.425" class="difflineminus">-                *palmRecordList = pPalmRec;</span>
<a href="#l16.426"></a><span id="l16.426" class="difflineminus">-                palmRecordList++;</span>
<a href="#l16.427"></a><span id="l16.427" class="difflineminus">-                (*pListSize)++;</span>
<a href="#l16.428"></a><span id="l16.428" class="difflineminus">-            } else {</span>
<a href="#l16.429"></a><span id="l16.429" class="difflineminus">-                retval = GEN_ERR_LOW_MEMORY;</span>
<a href="#l16.430"></a><span id="l16.430" class="difflineminus">-            }</span>
<a href="#l16.431"></a><span id="l16.431" class="difflineminus">-        } </span>
<a href="#l16.432"></a><span id="l16.432" class="difflineminus">-    }</span>
<a href="#l16.433"></a><span id="l16.433" class="difflineminus">-</span>
<a href="#l16.434"></a><span id="l16.434" class="difflineminus">-    // reallocate to the correct size</span>
<a href="#l16.435"></a><span id="l16.435" class="difflineminus">-    if((*pListSize) != dwRecCount)</span>
<a href="#l16.436"></a><span id="l16.436" class="difflineminus">-        *ppRecordList=(CPalmRecord **) realloc(*ppRecordList, sizeof(CPalmRecord *) * (*pListSize));</span>
<a href="#l16.437"></a><span id="l16.437" class="difflineminus">-</span>
<a href="#l16.438"></a><span id="l16.438" class="difflineminus">-    if (retval == SYNCERR_FILE_NOT_FOUND) // if there are no more records</span>
<a href="#l16.439"></a><span id="l16.439" class="difflineminus">-        retval = 0;</span>
<a href="#l16.440"></a><span id="l16.440" class="difflineminus">-</span>
<a href="#l16.441"></a><span id="l16.441" class="difflineminus">-    return retval;</span>
<a href="#l16.442"></a><span id="l16.442" class="difflineminus">-}</span>
<a href="#l16.443"></a><span id="l16.443" class="difflineminus">-</span>
<a href="#l16.444"></a><span id="l16.444" class="difflineminus">-long MozABHHManager::AllocateRawRecord(void)</span>
<a href="#l16.445"></a><span id="l16.445" class="difflineminus">-{</span>
<a href="#l16.446"></a><span id="l16.446" class="difflineminus">-    if (m_rInfo.m_pBytes != NULL) {</span>
<a href="#l16.447"></a><span id="l16.447" class="difflineminus">-        BYTE *pBytes;</span>
<a href="#l16.448"></a><span id="l16.448" class="difflineminus">-</span>
<a href="#l16.449"></a><span id="l16.449" class="difflineminus">-        pBytes = m_rInfo.m_pBytes;</span>
<a href="#l16.450"></a><span id="l16.450" class="difflineminus">-        memset(&amp;m_rInfo, 0, sizeof(CRawRecordInfo));</span>
<a href="#l16.451"></a><span id="l16.451" class="difflineminus">-        memset(pBytes, 0, MAX_RECORD_SIZE);</span>
<a href="#l16.452"></a><span id="l16.452" class="difflineminus">-</span>
<a href="#l16.453"></a><span id="l16.453" class="difflineminus">-        m_rInfo.m_pBytes        = pBytes;</span>
<a href="#l16.454"></a><span id="l16.454" class="difflineminus">-        m_rInfo.m_TotalBytes    = MAX_RECORD_SIZE;</span>
<a href="#l16.455"></a><span id="l16.455" class="difflineminus">-        m_rInfo.m_FileHandle    = m_hhDB;</span>
<a href="#l16.456"></a><span id="l16.456" class="difflineminus">-        return 0;</span>
<a href="#l16.457"></a><span id="l16.457" class="difflineminus">-    }</span>
<a href="#l16.458"></a><span id="l16.458" class="difflineminus">-    </span>
<a href="#l16.459"></a><span id="l16.459" class="difflineminus">-    memset(&amp;m_rInfo, 0, sizeof(CRawRecordInfo));</span>
<a href="#l16.460"></a><span id="l16.460" class="difflineminus">-    m_rInfo.m_pBytes        = (BYTE *) new char[MAX_RECORD_SIZE];</span>
<a href="#l16.461"></a><span id="l16.461" class="difflineminus">-    if (!m_rInfo.m_pBytes)</span>
<a href="#l16.462"></a><span id="l16.462" class="difflineminus">-        return GEN_ERR_LOW_MEMORY;</span>
<a href="#l16.463"></a><span id="l16.463" class="difflineminus">-</span>
<a href="#l16.464"></a><span id="l16.464" class="difflineminus">-    memset(m_rInfo.m_pBytes, 0, MAX_RECORD_SIZE);</span>
<a href="#l16.465"></a><span id="l16.465" class="difflineminus">-    m_rInfo.m_TotalBytes    = MAX_RECORD_SIZE;</span>
<a href="#l16.466"></a><span id="l16.466" class="difflineminus">-    m_rInfo.m_FileHandle    = m_hhDB;</span>
<a href="#l16.467"></a><span id="l16.467" class="difflineminus">-    return 0;</span>
<a href="#l16.468"></a><span id="l16.468" class="difflineminus">-}</span>
<a href="#l16.469"></a><span id="l16.469" class="difflineminus">-</span>
<a href="#l16.470"></a><span id="l16.470" class="difflineminus">-// this function allocates the list as well as the records, caller should free list and delete records</span>
<a href="#l16.471"></a><span id="l16.471" class="difflineminus">-long MozABHHManager::LoadAllRecords(CPalmRecord ***ppRecordList, DWORD * pListSize)</span>
<a href="#l16.472"></a><span id="l16.472" class="difflineminus">-{</span>
<a href="#l16.473"></a><span id="l16.473" class="difflineminus">-    long retval=0;</span>
<a href="#l16.474"></a><span id="l16.474" class="difflineminus">-    WORD dwRecCount, dwIndex;</span>
<a href="#l16.475"></a><span id="l16.475" class="difflineminus">-</span>
<a href="#l16.476"></a><span id="l16.476" class="difflineminus">-    retval = SyncGetDBRecordCount(m_hhDB, dwRecCount);</span>
<a href="#l16.477"></a><span id="l16.477" class="difflineminus">-    if (!retval)</span>
<a href="#l16.478"></a><span id="l16.478" class="difflineminus">-        return retval;</span>
<a href="#l16.479"></a><span id="l16.479" class="difflineminus">-    *pListSize = dwRecCount;</span>
<a href="#l16.480"></a><span id="l16.480" class="difflineminus">-</span>
<a href="#l16.481"></a><span id="l16.481" class="difflineminus">-    *ppRecordList = (CPalmRecord **) malloc(sizeof(CPalmRecord *) * dwRecCount);</span>
<a href="#l16.482"></a><span id="l16.482" class="difflineminus">-    if (!*ppRecordList)</span>
<a href="#l16.483"></a><span id="l16.483" class="difflineminus">-        return GEN_ERR_LOW_MEMORY;</span>
<a href="#l16.484"></a><span id="l16.484" class="difflineminus">-    memset(*ppRecordList, 0, sizeof(CPalmRecord *) * dwRecCount);</span>
<a href="#l16.485"></a><span id="l16.485" class="difflineminus">-</span>
<a href="#l16.486"></a><span id="l16.486" class="difflineminus">-    CPalmRecord *pPalmRec;</span>
<a href="#l16.487"></a><span id="l16.487" class="difflineminus">-    for (dwIndex = 0; (dwIndex &lt; dwRecCount) &amp;&amp; (!retval); dwIndex++){</span>
<a href="#l16.488"></a><span id="l16.488" class="difflineminus">-        retval = AllocateRawRecord();</span>
<a href="#l16.489"></a><span id="l16.489" class="difflineminus">-        if(retval)</span>
<a href="#l16.490"></a><span id="l16.490" class="difflineminus">-            break;</span>
<a href="#l16.491"></a><span id="l16.491" class="difflineminus">-</span>
<a href="#l16.492"></a><span id="l16.492" class="difflineminus">-        m_rInfo.m_RecIndex = LOWORD(dwIndex);</span>
<a href="#l16.493"></a><span id="l16.493" class="difflineminus">-</span>
<a href="#l16.494"></a><span id="l16.494" class="difflineminus">-        retval = SyncReadRecordByIndex(m_rInfo);</span>
<a href="#l16.495"></a><span id="l16.495" class="difflineminus">-        if (!retval) {</span>
<a href="#l16.496"></a><span id="l16.496" class="difflineminus">-            pPalmRec = new CPalmRecord(m_rInfo);</span>
<a href="#l16.497"></a><span id="l16.497" class="difflineminus">-            if (pPalmRec) {</span>
<a href="#l16.498"></a><span id="l16.498" class="difflineminus">-                *ppRecordList[dwIndex] = pPalmRec;</span>
<a href="#l16.499"></a><span id="l16.499" class="difflineminus">-            } else {</span>
<a href="#l16.500"></a><span id="l16.500" class="difflineminus">-                retval = GEN_ERR_LOW_MEMORY;</span>
<a href="#l16.501"></a><span id="l16.501" class="difflineminus">-            }</span>
<a href="#l16.502"></a><span id="l16.502" class="difflineminus">-        } else if (retval != SYNCERR_FILE_NOT_FOUND) {</span>
<a href="#l16.503"></a><span id="l16.503" class="difflineminus">-            pPalmRec = new CPalmRecord(m_rInfo);</span>
<a href="#l16.504"></a><span id="l16.504" class="difflineminus">-            pPalmRec-&gt;Initialize();</span>
<a href="#l16.505"></a><span id="l16.505" class="difflineminus">-            pPalmRec-&gt;SetIndex(dwIndex);</span>
<a href="#l16.506"></a><span id="l16.506" class="difflineminus">-            *ppRecordList[dwIndex] = pPalmRec;</span>
<a href="#l16.507"></a><span id="l16.507" class="difflineminus">-        }</span>
<a href="#l16.508"></a><span id="l16.508" class="difflineminus">-    }</span>
<a href="#l16.509"></a><span id="l16.509" class="difflineminus">-    m_dwMaxRecordCount = dwIndex + 1;</span>
<a href="#l16.510"></a><span id="l16.510" class="difflineminus">-</span>
<a href="#l16.511"></a><span id="l16.511" class="difflineminus">-    if (retval == SYNCERR_FILE_NOT_FOUND) // if there are no more records</span>
<a href="#l16.512"></a><span id="l16.512" class="difflineminus">-        retval = 0;</span>
<a href="#l16.513"></a><span id="l16.513" class="difflineminus">-</span>
<a href="#l16.514"></a><span id="l16.514" class="difflineminus">-    return retval;</span>
<a href="#l16.515"></a><span id="l16.515" class="difflineminus">-}</span>
<a href="#l16.516"></a><span id="l16.516" class="difflineminus">-</span>
<a href="#l16.517"></a><span id="l16.517" class="difflineminus">-// this function allocates the list as well as the records, caller should free list and delete records</span>
<a href="#l16.518"></a><span id="l16.518" class="difflineminus">-long MozABHHManager::LoadAllRecordsInCategory(DWORD catIndex, CPalmRecord ***ppRecordList, DWORD * pListSize)</span>
<a href="#l16.519"></a><span id="l16.519" class="difflineminus">-{</span>
<a href="#l16.520"></a><span id="l16.520" class="difflineminus">-    long retval=0;</span>
<a href="#l16.521"></a><span id="l16.521" class="difflineminus">-    WORD dwRecCount=0;</span>
<a href="#l16.522"></a><span id="l16.522" class="difflineminus">-</span>
<a href="#l16.523"></a><span id="l16.523" class="difflineminus">-    retval = SyncGetDBRecordCount(m_hhDB, dwRecCount);</span>
<a href="#l16.524"></a><span id="l16.524" class="difflineminus">-    if (retval)</span>
<a href="#l16.525"></a><span id="l16.525" class="difflineminus">-        return retval;</span>
<a href="#l16.526"></a><span id="l16.526" class="difflineminus">-</span>
<a href="#l16.527"></a><span id="l16.527" class="difflineminus">-    // resset the iteration index</span>
<a href="#l16.528"></a><span id="l16.528" class="difflineminus">-    retval = SyncResetRecordIndex(m_hhDB);</span>
<a href="#l16.529"></a><span id="l16.529" class="difflineminus">-    if (retval)</span>
<a href="#l16.530"></a><span id="l16.530" class="difflineminus">-        return retval;</span>
<a href="#l16.531"></a><span id="l16.531" class="difflineminus">-</span>
<a href="#l16.532"></a><span id="l16.532" class="difflineminus">-    // allocate buffer initially for the total record size and adjust after getting records</span>
<a href="#l16.533"></a><span id="l16.533" class="difflineminus">-    CPalmRecord ** palmRecordList = (CPalmRecord **) malloc(sizeof(CPalmRecord *) * dwRecCount);</span>
<a href="#l16.534"></a><span id="l16.534" class="difflineminus">-    if (!palmRecordList)</span>
<a href="#l16.535"></a><span id="l16.535" class="difflineminus">-        return GEN_ERR_LOW_MEMORY;</span>
<a href="#l16.536"></a><span id="l16.536" class="difflineminus">-    memset(palmRecordList, 0, sizeof(CPalmRecord *) * dwRecCount);</span>
<a href="#l16.537"></a><span id="l16.537" class="difflineminus">-    *ppRecordList = palmRecordList;</span>
<a href="#l16.538"></a><span id="l16.538" class="difflineminus">-</span>
<a href="#l16.539"></a><span id="l16.539" class="difflineminus">-    CPalmRecord *pPalmRec;</span>
<a href="#l16.540"></a><span id="l16.540" class="difflineminus">-</span>
<a href="#l16.541"></a><span id="l16.541" class="difflineminus">-    *pListSize = 0;</span>
<a href="#l16.542"></a><span id="l16.542" class="difflineminus">-    while ((!retval) &amp;&amp; (*pListSize &lt; dwRecCount))  {</span>
<a href="#l16.543"></a><span id="l16.543" class="difflineminus">-        retval = AllocateRawRecord();</span>
<a href="#l16.544"></a><span id="l16.544" class="difflineminus">-        if (retval) </span>
<a href="#l16.545"></a><span id="l16.545" class="difflineminus">-            break;</span>
<a href="#l16.546"></a><span id="l16.546" class="difflineminus">-        m_rInfo.m_RecIndex = 0;</span>
<a href="#l16.547"></a><span id="l16.547" class="difflineminus">-        m_rInfo.m_CatId = catIndex;</span>
<a href="#l16.548"></a><span id="l16.548" class="difflineminus">-        retval = SyncReadNextRecInCategory(m_rInfo);</span>
<a href="#l16.549"></a><span id="l16.549" class="difflineminus">-        if (!retval) {</span>
<a href="#l16.550"></a><span id="l16.550" class="difflineminus">-            pPalmRec = new CPalmRecord(m_rInfo);</span>
<a href="#l16.551"></a><span id="l16.551" class="difflineminus">-            if (pPalmRec) {</span>
<a href="#l16.552"></a><span id="l16.552" class="difflineminus">-                *palmRecordList = pPalmRec;</span>
<a href="#l16.553"></a><span id="l16.553" class="difflineminus">-                palmRecordList++;</span>
<a href="#l16.554"></a><span id="l16.554" class="difflineminus">-                (*pListSize)++;</span>
<a href="#l16.555"></a><span id="l16.555" class="difflineminus">-            } else {</span>
<a href="#l16.556"></a><span id="l16.556" class="difflineminus">-                retval = GEN_ERR_LOW_MEMORY;</span>
<a href="#l16.557"></a><span id="l16.557" class="difflineminus">-            }</span>
<a href="#l16.558"></a><span id="l16.558" class="difflineminus">-        } </span>
<a href="#l16.559"></a><span id="l16.559" class="difflineminus">-    }</span>
<a href="#l16.560"></a><span id="l16.560" class="difflineminus">-</span>
<a href="#l16.561"></a><span id="l16.561" class="difflineminus">-    // reallocate to the correct size</span>
<a href="#l16.562"></a><span id="l16.562" class="difflineminus">-    if((*pListSize) != dwRecCount)</span>
<a href="#l16.563"></a><span id="l16.563" class="difflineminus">-        *ppRecordList=(CPalmRecord **) realloc(*ppRecordList, sizeof(CPalmRecord *) * (*pListSize));</span>
<a href="#l16.564"></a><span id="l16.564" class="difflineminus">-</span>
<a href="#l16.565"></a><span id="l16.565" class="difflineminus">-    if (retval == SYNCERR_FILE_NOT_FOUND) // if there are no more records</span>
<a href="#l16.566"></a><span id="l16.566" class="difflineminus">-        retval = 0;</span>
<a href="#l16.567"></a><span id="l16.567" class="difflineminus">-</span>
<a href="#l16.568"></a><span id="l16.568" class="difflineminus">-    return retval;</span>
<a href="#l16.569"></a><span id="l16.569" class="difflineminus">-}</span>
<a href="#l16.570"></a><span id="l16.570" class="difflineminus">-</span>
<a href="#l16.571"></a><span id="l16.571" class="difflineminus">-long MozABHHManager::AddRecords(CPalmRecord **pRecordList, DWORD pCount)</span>
<a href="#l16.572"></a><span id="l16.572" class="difflineminus">-{</span>
<a href="#l16.573"></a><span id="l16.573" class="difflineminus">-    long retval=0;</span>
<a href="#l16.574"></a><span id="l16.574" class="difflineminus">-</span>
<a href="#l16.575"></a><span id="l16.575" class="difflineminus">-    for (unsigned long i=0; i &lt; pCount; i++)</span>
<a href="#l16.576"></a><span id="l16.576" class="difflineminus">-    {</span>
<a href="#l16.577"></a><span id="l16.577" class="difflineminus">-        CPalmRecord palmRec = *pRecordList[i];</span>
<a href="#l16.578"></a><span id="l16.578" class="difflineminus">-</span>
<a href="#l16.579"></a><span id="l16.579" class="difflineminus">-        palmRec.ResetAttribs();</span>
<a href="#l16.580"></a><span id="l16.580" class="difflineminus">-</span>
<a href="#l16.581"></a><span id="l16.581" class="difflineminus">-        retval = AllocateRawRecord();</span>
<a href="#l16.582"></a><span id="l16.582" class="difflineminus">-        if (retval) </span>
<a href="#l16.583"></a><span id="l16.583" class="difflineminus">-            return retval;</span>
<a href="#l16.584"></a><span id="l16.584" class="difflineminus">-</span>
<a href="#l16.585"></a><span id="l16.585" class="difflineminus">-        retval = palmRec.ConvertToHH(m_rInfo);</span>
<a href="#l16.586"></a><span id="l16.586" class="difflineminus">-        if (!retval) {</span>
<a href="#l16.587"></a><span id="l16.587" class="difflineminus">-            m_rInfo.m_FileHandle = m_hhDB;</span>
<a href="#l16.588"></a><span id="l16.588" class="difflineminus">-            m_rInfo.m_RecId = 0;</span>
<a href="#l16.589"></a><span id="l16.589" class="difflineminus">-            if (m_bRecordDB)</span>
<a href="#l16.590"></a><span id="l16.590" class="difflineminus">-                retval = SyncWriteRec(m_rInfo);</span>
<a href="#l16.591"></a><span id="l16.591" class="difflineminus">-            else </span>
<a href="#l16.592"></a><span id="l16.592" class="difflineminus">-                retval = SyncWriteResourceRec(m_rInfo);</span>
<a href="#l16.593"></a><span id="l16.593" class="difflineminus">-            if (!retval) {</span>
<a href="#l16.594"></a><span id="l16.594" class="difflineminus">-                palmRec.SetIndex(m_rInfo.m_RecIndex);</span>
<a href="#l16.595"></a><span id="l16.595" class="difflineminus">-                palmRec.SetID(m_rInfo.m_RecId);</span>
<a href="#l16.596"></a><span id="l16.596" class="difflineminus">-            }</span>
<a href="#l16.597"></a><span id="l16.597" class="difflineminus">-        }</span>
<a href="#l16.598"></a><span id="l16.598" class="difflineminus">-        else</span>
<a href="#l16.599"></a><span id="l16.599" class="difflineminus">-            return retval;</span>
<a href="#l16.600"></a><span id="l16.600" class="difflineminus">-    }</span>
<a href="#l16.601"></a><span id="l16.601" class="difflineminus">-</span>
<a href="#l16.602"></a><span id="l16.602" class="difflineminus">-    return retval;</span>
<a href="#l16.603"></a><span id="l16.603" class="difflineminus">-}</span>
<a href="#l16.604"></a><span id="l16.604" class="difflineminus">-</span>
<a href="#l16.605"></a><span id="l16.605" class="difflineminus">-long MozABHHManager::UpdateRecords(CPalmRecord **pRecordList, DWORD pCount)</span>
<a href="#l16.606"></a><span id="l16.606" class="difflineminus">-{</span>
<a href="#l16.607"></a><span id="l16.607" class="difflineminus">-    long retval=0;</span>
<a href="#l16.608"></a><span id="l16.608" class="difflineminus">-</span>
<a href="#l16.609"></a><span id="l16.609" class="difflineminus">-    for (unsigned long i=0; i &lt; pCount; i++)</span>
<a href="#l16.610"></a><span id="l16.610" class="difflineminus">-    {</span>
<a href="#l16.611"></a><span id="l16.611" class="difflineminus">-        CPalmRecord palmRec = *pRecordList[i];</span>
<a href="#l16.612"></a><span id="l16.612" class="difflineminus">-</span>
<a href="#l16.613"></a><span id="l16.613" class="difflineminus">-        retval = AllocateRawRecord();</span>
<a href="#l16.614"></a><span id="l16.614" class="difflineminus">-        if (retval) </span>
<a href="#l16.615"></a><span id="l16.615" class="difflineminus">-            return retval;</span>
<a href="#l16.616"></a><span id="l16.616" class="difflineminus">-</span>
<a href="#l16.617"></a><span id="l16.617" class="difflineminus">-        retval = palmRec.ConvertToHH(m_rInfo);</span>
<a href="#l16.618"></a><span id="l16.618" class="difflineminus">-        if (!retval) {</span>
<a href="#l16.619"></a><span id="l16.619" class="difflineminus">-            m_rInfo.m_FileHandle = m_hhDB;</span>
<a href="#l16.620"></a><span id="l16.620" class="difflineminus">-            if (m_bRecordDB)</span>
<a href="#l16.621"></a><span id="l16.621" class="difflineminus">-                retval = SyncWriteRec(m_rInfo);</span>
<a href="#l16.622"></a><span id="l16.622" class="difflineminus">-            else </span>
<a href="#l16.623"></a><span id="l16.623" class="difflineminus">-                retval = SyncWriteResourceRec(m_rInfo);</span>
<a href="#l16.624"></a><span id="l16.624" class="difflineminus">-            if (!retval) {</span>
<a href="#l16.625"></a><span id="l16.625" class="difflineminus">-                palmRec.SetIndex(m_rInfo.m_RecIndex);</span>
<a href="#l16.626"></a><span id="l16.626" class="difflineminus">-                palmRec.SetID(m_rInfo.m_RecId);</span>
<a href="#l16.627"></a><span id="l16.627" class="difflineminus">-            }</span>
<a href="#l16.628"></a><span id="l16.628" class="difflineminus">-        }</span>
<a href="#l16.629"></a><span id="l16.629" class="difflineminus">-        else</span>
<a href="#l16.630"></a><span id="l16.630" class="difflineminus">-            return retval;</span>
<a href="#l16.631"></a><span id="l16.631" class="difflineminus">-    }</span>
<a href="#l16.632"></a><span id="l16.632" class="difflineminus">-</span>
<a href="#l16.633"></a><span id="l16.633" class="difflineminus">-    return retval;</span>
<a href="#l16.634"></a><span id="l16.634" class="difflineminus">-}</span>
<a href="#l16.635"></a><span id="l16.635" class="difflineminus">-</span>
<a href="#l16.636"></a><span id="l16.636" class="difflineminus">-long MozABHHManager::DeleteRecords(CPalmRecord **pRecordList, DWORD pCount)</span>
<a href="#l16.637"></a><span id="l16.637" class="difflineminus">-{</span>
<a href="#l16.638"></a><span id="l16.638" class="difflineminus">-    long retval=0;</span>
<a href="#l16.639"></a><span id="l16.639" class="difflineminus">-</span>
<a href="#l16.640"></a><span id="l16.640" class="difflineminus">-    for (unsigned long i=0; i &lt; pCount; i++)</span>
<a href="#l16.641"></a><span id="l16.641" class="difflineminus">-    {</span>
<a href="#l16.642"></a><span id="l16.642" class="difflineminus">-        CPalmRecord palmRec = *pRecordList[i];</span>
<a href="#l16.643"></a><span id="l16.643" class="difflineminus">-</span>
<a href="#l16.644"></a><span id="l16.644" class="difflineminus">-        retval = AllocateRawRecord();</span>
<a href="#l16.645"></a><span id="l16.645" class="difflineminus">-        if (retval) </span>
<a href="#l16.646"></a><span id="l16.646" class="difflineminus">-            return retval;</span>
<a href="#l16.647"></a><span id="l16.647" class="difflineminus">-</span>
<a href="#l16.648"></a><span id="l16.648" class="difflineminus">-        retval = palmRec.ConvertToHH(m_rInfo);</span>
<a href="#l16.649"></a><span id="l16.649" class="difflineminus">-        if (!retval) {</span>
<a href="#l16.650"></a><span id="l16.650" class="difflineminus">-            m_rInfo.m_FileHandle = m_hhDB;</span>
<a href="#l16.651"></a><span id="l16.651" class="difflineminus">-            if (m_bRecordDB)</span>
<a href="#l16.652"></a><span id="l16.652" class="difflineminus">-                retval = SyncDeleteRec(m_rInfo);</span>
<a href="#l16.653"></a><span id="l16.653" class="difflineminus">-            else </span>
<a href="#l16.654"></a><span id="l16.654" class="difflineminus">-                retval = SyncDeleteResourceRec(m_rInfo);</span>
<a href="#l16.655"></a><span id="l16.655" class="difflineminus">-        }</span>
<a href="#l16.656"></a><span id="l16.656" class="difflineminus">-        else</span>
<a href="#l16.657"></a><span id="l16.657" class="difflineminus">-            return retval;</span>
<a href="#l16.658"></a><span id="l16.658" class="difflineminus">-    }</span>
<a href="#l16.659"></a><span id="l16.659" class="difflineminus">-</span>
<a href="#l16.660"></a><span id="l16.660" class="difflineminus">-    return retval;</span>
<a href="#l16.661"></a><span id="l16.661" class="difflineminus">-}</span>
<a href="#l16.662"></a><span id="l16.662" class="difflineminus">-</span>
<a href="#l16.663"></a><span id="l16.663" class="difflineminus">-</span>
<a href="#l16.664"></a><span id="l16.664" class="difflineminus">-long MozABHHManager::AddARecord(CPalmRecord &amp; palmRec)</span>
<a href="#l16.665"></a><span id="l16.665" class="difflineminus">-{</span>
<a href="#l16.666"></a><span id="l16.666" class="difflineminus">-    long retval=0;</span>
<a href="#l16.667"></a><span id="l16.667" class="difflineminus">-</span>
<a href="#l16.668"></a><span id="l16.668" class="difflineminus">-    palmRec.ResetAttribs();</span>
<a href="#l16.669"></a><span id="l16.669" class="difflineminus">-</span>
<a href="#l16.670"></a><span id="l16.670" class="difflineminus">-    retval = AllocateRawRecord();</span>
<a href="#l16.671"></a><span id="l16.671" class="difflineminus">-    if (retval) </span>
<a href="#l16.672"></a><span id="l16.672" class="difflineminus">-        return retval;</span>
<a href="#l16.673"></a><span id="l16.673" class="difflineminus">-</span>
<a href="#l16.674"></a><span id="l16.674" class="difflineminus">-    retval = palmRec.ConvertToHH(m_rInfo);</span>
<a href="#l16.675"></a><span id="l16.675" class="difflineminus">-    if (!retval) {</span>
<a href="#l16.676"></a><span id="l16.676" class="difflineminus">-        m_rInfo.m_FileHandle = m_hhDB;</span>
<a href="#l16.677"></a><span id="l16.677" class="difflineminus">-        m_rInfo.m_RecId = 0;</span>
<a href="#l16.678"></a><span id="l16.678" class="difflineminus">-        if (m_bRecordDB)</span>
<a href="#l16.679"></a><span id="l16.679" class="difflineminus">-            retval = SyncWriteRec(m_rInfo);</span>
<a href="#l16.680"></a><span id="l16.680" class="difflineminus">-        else </span>
<a href="#l16.681"></a><span id="l16.681" class="difflineminus">-            retval = SyncWriteResourceRec(m_rInfo);</span>
<a href="#l16.682"></a><span id="l16.682" class="difflineminus">-        if (!retval) {</span>
<a href="#l16.683"></a><span id="l16.683" class="difflineminus">-            palmRec.SetIndex(m_rInfo.m_RecIndex);</span>
<a href="#l16.684"></a><span id="l16.684" class="difflineminus">-            palmRec.SetID(m_rInfo.m_RecId);</span>
<a href="#l16.685"></a><span id="l16.685" class="difflineminus">-        }</span>
<a href="#l16.686"></a><span id="l16.686" class="difflineminus">-    }</span>
<a href="#l16.687"></a><span id="l16.687" class="difflineminus">-</span>
<a href="#l16.688"></a><span id="l16.688" class="difflineminus">-    return retval;</span>
<a href="#l16.689"></a><span id="l16.689" class="difflineminus">-}</span>
<a href="#l16.690"></a><span id="l16.690" class="difflineminus">-</span>
<a href="#l16.691"></a><span id="l16.691" class="difflineminus">-long MozABHHManager::UpdateARecord(CPalmRecord &amp; palmRec)</span>
<a href="#l16.692"></a><span id="l16.692" class="difflineminus">-{</span>
<a href="#l16.693"></a><span id="l16.693" class="difflineminus">-    long retval=0;</span>
<a href="#l16.694"></a><span id="l16.694" class="difflineminus">-</span>
<a href="#l16.695"></a><span id="l16.695" class="difflineminus">-    retval = AllocateRawRecord();</span>
<a href="#l16.696"></a><span id="l16.696" class="difflineminus">-    if (retval) </span>
<a href="#l16.697"></a><span id="l16.697" class="difflineminus">-        return retval;</span>
<a href="#l16.698"></a><span id="l16.698" class="difflineminus">-</span>
<a href="#l16.699"></a><span id="l16.699" class="difflineminus">-    retval = palmRec.ConvertToHH(m_rInfo);</span>
<a href="#l16.700"></a><span id="l16.700" class="difflineminus">-    if (!retval) {</span>
<a href="#l16.701"></a><span id="l16.701" class="difflineminus">-        m_rInfo.m_FileHandle = m_hhDB;</span>
<a href="#l16.702"></a><span id="l16.702" class="difflineminus">-        m_rInfo.m_Attribs = eRecAttrDirty;</span>
<a href="#l16.703"></a><span id="l16.703" class="difflineminus">-        if (m_bRecordDB)</span>
<a href="#l16.704"></a><span id="l16.704" class="difflineminus">-            retval = SyncWriteRec(m_rInfo);</span>
<a href="#l16.705"></a><span id="l16.705" class="difflineminus">-        else </span>
<a href="#l16.706"></a><span id="l16.706" class="difflineminus">-            retval = SyncWriteResourceRec(m_rInfo);</span>
<a href="#l16.707"></a><span id="l16.707" class="difflineminus">-        if (!retval) {</span>
<a href="#l16.708"></a><span id="l16.708" class="difflineminus">-            palmRec.SetIndex(m_rInfo.m_RecIndex);</span>
<a href="#l16.709"></a><span id="l16.709" class="difflineminus">-            palmRec.SetID(m_rInfo.m_RecId);</span>
<a href="#l16.710"></a><span id="l16.710" class="difflineminus">-        }</span>
<a href="#l16.711"></a><span id="l16.711" class="difflineminus">-    }</span>
<a href="#l16.712"></a><span id="l16.712" class="difflineminus">-</span>
<a href="#l16.713"></a><span id="l16.713" class="difflineminus">-    return retval;</span>
<a href="#l16.714"></a><span id="l16.714" class="difflineminus">-}</span>
<a href="#l16.715"></a><span id="l16.715" class="difflineminus">-</span>
<a href="#l16.716"></a><span id="l16.716" class="difflineminus">-long MozABHHManager::DeleteARecord(CPalmRecord &amp; palmRec)</span>
<a href="#l16.717"></a><span id="l16.717" class="difflineminus">-{</span>
<a href="#l16.718"></a><span id="l16.718" class="difflineminus">-    long retval=0;</span>
<a href="#l16.719"></a><span id="l16.719" class="difflineminus">-</span>
<a href="#l16.720"></a><span id="l16.720" class="difflineminus">-    retval = AllocateRawRecord();</span>
<a href="#l16.721"></a><span id="l16.721" class="difflineminus">-    if (retval) </span>
<a href="#l16.722"></a><span id="l16.722" class="difflineminus">-        return retval;</span>
<a href="#l16.723"></a><span id="l16.723" class="difflineminus">-</span>
<a href="#l16.724"></a><span id="l16.724" class="difflineminus">-    retval = palmRec.ConvertToHH(m_rInfo);</span>
<a href="#l16.725"></a><span id="l16.725" class="difflineminus">-    if (!retval) {</span>
<a href="#l16.726"></a><span id="l16.726" class="difflineminus">-        m_rInfo.m_FileHandle = m_hhDB;</span>
<a href="#l16.727"></a><span id="l16.727" class="difflineminus">-        if (m_bRecordDB)</span>
<a href="#l16.728"></a><span id="l16.728" class="difflineminus">-            retval = SyncDeleteRec(m_rInfo);</span>
<a href="#l16.729"></a><span id="l16.729" class="difflineminus">-        else </span>
<a href="#l16.730"></a><span id="l16.730" class="difflineminus">-            retval = SyncDeleteResourceRec(m_rInfo);</span>
<a href="#l16.731"></a><span id="l16.731" class="difflineminus">-    }</span>
<a href="#l16.732"></a><span id="l16.732" class="difflineminus">-</span>
<a href="#l16.733"></a><span id="l16.733" class="difflineminus">-    return retval;</span>
<a href="#l16.734"></a><span id="l16.734" class="difflineminus">-}</span>
<a href="#l16.735"></a><span id="l16.735" class="difflineminus">-</span>
<a href="#l16.736"></a><span id="l16.736" class="difflineminus">-long MozABHHManager::PurgeDeletedRecs(void)</span>
<a href="#l16.737"></a><span id="l16.737" class="difflineminus">-{</span>
<a href="#l16.738"></a><span id="l16.738" class="difflineminus">-    return (SyncPurgeDeletedRecs(m_hhDB));</span>
<a href="#l16.739"></a><span id="l16.739" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">deleted file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/MozABHHManager.h</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ /dev/null</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -1,109 +0,0 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineminus">- *</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">- *</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">- * License.</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">- *</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineminus">- *</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">- *</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">- *</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">- *</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">- *</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-#ifndef _MOZAB_HHMANAGER_H_</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-#define _MOZAB_HHMANAGERT_H_</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineminus">-</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineminus">-#include &lt;CPDbBMgr.h&gt;</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineminus">-</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineminus">-class MozABHHManager</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineminus">-{</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-public:</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineminus">-    MozABHHManager(DWORD dwGenericFlags, </span>
<a href="#l17.52"></a><span id="l17.52" class="difflineminus">-               char *pName, </span>
<a href="#l17.53"></a><span id="l17.53" class="difflineminus">-               DWORD dwCreator, </span>
<a href="#l17.54"></a><span id="l17.54" class="difflineminus">-               DWORD dwType, </span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-               WORD dbFlags, </span>
<a href="#l17.56"></a><span id="l17.56" class="difflineminus">-               WORD dbVersion, </span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-			   int  iCardNum,</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineminus">-               eSyncTypes syncType);</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineminus">-    ~MozABHHManager();</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineminus">-</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineminus">-    long OpenDB(BOOL bCreate);</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineminus">-    long CloseDB(BOOL bDontUpdate);</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineminus">-</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-    // this will load categories in m_pCatMgr member</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineminus">-    long LoadCategories();</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineminus">-    CPCategory * GetFirstCategory() { return m_pCatMgr-&gt;FindFirst(); }</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineminus">-    CPCategory * GetNextCategory() { return m_pCatMgr-&gt;FindNext(); }</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineminus">-    long DeleteCategory(DWORD dwCategory, BOOL bMoveToUnfiled);</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineminus">-    long ChangeCategory(DWORD dwOldCatIndex, DWORD dwNewCatIndex);</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineminus">-    long AddCategory(CPCategory &amp; cat);</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineminus">-    long CompactCategoriesToHH();</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineminus">-</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineminus">-    long LoadAllRecords(CPalmRecord ***ppRecordList, DWORD * pListSize);</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineminus">-    long LoadAllRecordsInCategory(DWORD catIndex, CPalmRecord ***ppRecordList, DWORD * pListSize);</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineminus">-    long LoadAllUpdatedRecords(CPalmRecord ***ppRecordList, DWORD * pListSize);</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineminus">-    long LoadUpdatedRecordsInCategory(DWORD catIndex, CPalmRecord ***ppRecordList, DWORD * pListSize);</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineminus">-</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineminus">-    long AddRecords(CPalmRecord **m_pRecordList, DWORD pCount);</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineminus">-    long DeleteRecords(CPalmRecord **m_pRecordList, DWORD pCount);</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineminus">-    long UpdateRecords(CPalmRecord **m_pRecordList, DWORD pCount);</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineminus">-</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineminus">-    long AddARecord(CPalmRecord &amp; palmRec);</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineminus">-    long DeleteARecord(CPalmRecord &amp; palmRec);</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineminus">-    long UpdateARecord(CPalmRecord &amp; palmRec);</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineminus">-    long PurgeDeletedRecs(void);</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineminus">-</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineminus">-protected:</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineminus">-    char  m_szName[SYNC_DB_NAMELEN];</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineminus">-    DWORD m_dwCreator;</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineminus">-    DWORD m_dwType;</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineminus">-    WORD  m_wFlags;</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineminus">-    WORD  m_wVersion;</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineminus">-    int   m_CardNum;</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineminus">-    BOOL  m_bRecordDB;</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineminus">-</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineminus">-    DWORD m_dwMaxRecordCount;</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineminus">-</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineminus">-    CRawRecordInfo  m_rInfo;</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineminus">-    CPCategoryMgr * m_pCatMgr;</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineminus">-</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineminus">-    BYTE m_hhDB;</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineminus">-    CDbGenInfo m_appInfo;</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineminus">-    </span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-    long AllocateRawRecord();</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineminus">-    long AllocateDBInfo(CDbGenInfo &amp;info, BOOL bClearData=FALSE);</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineminus">-    long GetInfoBlock(CDbGenInfo &amp;info, BOOL bSortInfo=FALSE);</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineminus">-    long GetAppInfo(CDbGenInfo &amp;rInfo);</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineminus">-    long SetName( char *pName);</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineminus">-    long LoadUpdatedRecords(DWORD catIndex, CPalmRecord ***ppRecordList, DWORD * pListSize);</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineminus">-</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineminus">-};</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineminus">-</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineminus">-#endif</span>
<a href="#l17.114"></a><span id="l17.114">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">deleted file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/MozABPCManager.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ /dev/null</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -1,382 +0,0 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineminus">- *</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">- *</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">- * License.</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">- *</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">- *</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineminus">- *</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">- *</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineminus">- *</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">- *</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineminus">-#include &lt;stdio.h&gt;</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineminus">-#include &lt;memory.h&gt;</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineminus">-#include &lt;sys/stat.h&gt;</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineminus">-#include &lt;TCHAR.H&gt;</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineminus">-</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-#include &lt;syncmgr.h&gt;</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineminus">-#include &lt;Pgenerr.h&gt;</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineminus">-</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineminus">-#include &quot;MozABConduitRecord.h&quot;</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineminus">-#include &quot;MozABPCManager.h&quot;</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineminus">-</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineminus">-const IID IID_IPalmSync = {0xC8CE6FC1,0xCCF1,0x11d6,{0xB8,0xA5,0x00,0x00,0x64,0x65,0x73,0x74}};</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineminus">-const CLSID CLSID_CPalmSyncImp = { 0xb20b4521, 0xccf8, 0x11d6, { 0xb8, 0xa5, 0x0, 0x0, 0x64, 0x65, 0x73, 0x74 } };</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineminus">-</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineminus">-extern DWORD tId;</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineminus">-</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineminus">-/* static */BOOL MozABPCManager::gUseHomeAddress;</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineminus">-/* static */ BOOL MozABPCManager::gPreferHomePhone;</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineminus">-</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineminus">-</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-BOOL MozABPCManager::InitMozPalmSyncInstance(IPalmSync **aRetValue)</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineminus">-{</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineminus">-    // Check wehther this thread has a valid Interface</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineminus">-    // by looking into thread-specific-data variable</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineminus">-</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineminus">-    *aRetValue = (IPalmSync *)TlsGetValue(tId);</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineminus">-</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineminus">-    // Check whether the pointer actually resolves to</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineminus">-    // a valid method call; otherwise mozilla is not running</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineminus">-</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineminus">-    if ((*aRetValue) &amp;&amp; (*aRetValue)-&gt;IsValid() == S_OK)</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineminus">-         return TRUE;</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineminus">-</span>
<a href="#l18.78"></a><span id="l18.78" class="difflineminus">-    HRESULT hRes = ::CoInitialize(NULL) ;</span>
<a href="#l18.79"></a><span id="l18.79" class="difflineminus">-</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineminus">-    hRes = ::CoCreateInstance(CLSID_CPalmSyncImp, NULL, CLSCTX_LOCAL_SERVER,</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineminus">-                                         IID_IPalmSync, (LPVOID *)aRetValue);</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineminus">-</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineminus">-    if (hRes == S_OK)</span>
<a href="#l18.84"></a><span id="l18.84" class="difflineminus">-        if (TlsSetValue(tId, (LPVOID)(*aRetValue)))</span>
<a href="#l18.85"></a><span id="l18.85" class="difflineminus">-        {</span>
<a href="#l18.86"></a><span id="l18.86" class="difflineminus">-            (*aRetValue)-&gt;nsUseABHomeAddressForPalmAddress(&amp;gUseHomeAddress);</span>
<a href="#l18.87"></a><span id="l18.87" class="difflineminus">-            (*aRetValue)-&gt;nsPreferABHomePhoneForPalmPhone(&amp;gPreferHomePhone);</span>
<a href="#l18.88"></a><span id="l18.88" class="difflineminus">-            return TRUE;</span>
<a href="#l18.89"></a><span id="l18.89" class="difflineminus">-        }</span>
<a href="#l18.90"></a><span id="l18.90" class="difflineminus">-</span>
<a href="#l18.91"></a><span id="l18.91" class="difflineminus">-    // Either CoCreate or TlsSetValue failed; so return FALSE</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineminus">-</span>
<a href="#l18.93"></a><span id="l18.93" class="difflineminus">-    if ((*aRetValue))</span>
<a href="#l18.94"></a><span id="l18.94" class="difflineminus">-        (*aRetValue)-&gt;Release();</span>
<a href="#l18.95"></a><span id="l18.95" class="difflineminus">-</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineminus">-    ::CoUninitialize();</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineminus">-    return FALSE;</span>
<a href="#l18.98"></a><span id="l18.98" class="difflineminus">-}</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineminus">-</span>
<a href="#l18.100"></a><span id="l18.100" class="difflineminus">-// this function allocates the list as well as the strings, caller should free list and delete strings</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineminus">-long MozABPCManager::GetPCABList(DWORD * pCategoryCount, LONG ** pCategoryIndexList, CPString *** pCategoryNameList, CPString *** pCategoryUrlList, BOOL ** pDirFlags)</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineminus">-{</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineminus">-    lpnsMozABDesc mozABNameList=NULL;</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineminus">-</span>
<a href="#l18.105"></a><span id="l18.105" class="difflineminus">-    short  dwMozABCount=0;</span>
<a href="#l18.106"></a><span id="l18.106" class="difflineminus">-    long retval = 0;</span>
<a href="#l18.107"></a><span id="l18.107" class="difflineminus">-    IPalmSync *pNsPalmSync = NULL;</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineminus">-</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineminus">-    // get the interface </span>
<a href="#l18.110"></a><span id="l18.110" class="difflineminus">-    if (!InitMozPalmSyncInstance(&amp;pNsPalmSync))</span>
<a href="#l18.111"></a><span id="l18.111" class="difflineminus">-        return GEN_ERR_NOT_SUPPORTED;</span>
<a href="#l18.112"></a><span id="l18.112" class="difflineminus">-</span>
<a href="#l18.113"></a><span id="l18.113" class="difflineminus">-    // get the ABList</span>
<a href="#l18.114"></a><span id="l18.114" class="difflineminus">-    HRESULT hres = pNsPalmSync-&gt;nsGetABList(FALSE, &amp;dwMozABCount, </span>
<a href="#l18.115"></a><span id="l18.115" class="difflineminus">-                                        &amp;mozABNameList, pCategoryIndexList, pDirFlags);</span>
<a href="#l18.116"></a><span id="l18.116" class="difflineminus">-    if (hres != S_OK) {</span>
<a href="#l18.117"></a><span id="l18.117" class="difflineminus">-        retval = (long) hres;</span>
<a href="#l18.118"></a><span id="l18.118" class="difflineminus">-        return retval;</span>
<a href="#l18.119"></a><span id="l18.119" class="difflineminus">-    }</span>
<a href="#l18.120"></a><span id="l18.120" class="difflineminus">-</span>
<a href="#l18.121"></a><span id="l18.121" class="difflineminus">-    *pCategoryCount = dwMozABCount;</span>
<a href="#l18.122"></a><span id="l18.122" class="difflineminus">-</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineminus">-    CPString ** abNameList = (CPString **) malloc(sizeof(CPString *) * dwMozABCount);</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineminus">-    if (!abNameList) {</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineminus">-        free(mozABNameList);</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineminus">-        return GEN_ERR_LOW_MEMORY;</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineminus">-    }</span>
<a href="#l18.128"></a><span id="l18.128" class="difflineminus">-    memset(abNameList, 0, sizeof(CPString *) * dwMozABCount);</span>
<a href="#l18.129"></a><span id="l18.129" class="difflineminus">-    *pCategoryNameList = abNameList;</span>
<a href="#l18.130"></a><span id="l18.130" class="difflineminus">-</span>
<a href="#l18.131"></a><span id="l18.131" class="difflineminus">-    CPString ** abUrlList = (CPString **) malloc(sizeof(CPString *) * dwMozABCount);</span>
<a href="#l18.132"></a><span id="l18.132" class="difflineminus">-    if (!abUrlList) {</span>
<a href="#l18.133"></a><span id="l18.133" class="difflineminus">-        free(mozABNameList);</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineminus">-        free(abNameList);</span>
<a href="#l18.135"></a><span id="l18.135" class="difflineminus">-        return GEN_ERR_LOW_MEMORY;</span>
<a href="#l18.136"></a><span id="l18.136" class="difflineminus">-    }</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineminus">-    memset(abUrlList, 0, sizeof(CPString *) * dwMozABCount);</span>
<a href="#l18.138"></a><span id="l18.138" class="difflineminus">-    *pCategoryUrlList = abUrlList;</span>
<a href="#l18.139"></a><span id="l18.139" class="difflineminus">-</span>
<a href="#l18.140"></a><span id="l18.140" class="difflineminus">-    for (int i=0; i &lt; dwMozABCount; i++) {</span>
<a href="#l18.141"></a><span id="l18.141" class="difflineminus">-        CPString * pABName = new CPString((LPCTSTR) mozABNameList[i].lpszABName);</span>
<a href="#l18.142"></a><span id="l18.142" class="difflineminus">-        if (pABName)</span>
<a href="#l18.143"></a><span id="l18.143" class="difflineminus">-            *abNameList = pABName;</span>
<a href="#l18.144"></a><span id="l18.144" class="difflineminus">-        else</span>
<a href="#l18.145"></a><span id="l18.145" class="difflineminus">-            return GEN_ERR_LOW_MEMORY;</span>
<a href="#l18.146"></a><span id="l18.146" class="difflineminus">-        CoTaskMemFree(mozABNameList[i].lpszABName);</span>
<a href="#l18.147"></a><span id="l18.147" class="difflineminus">-        abNameList++;</span>
<a href="#l18.148"></a><span id="l18.148" class="difflineminus">-</span>
<a href="#l18.149"></a><span id="l18.149" class="difflineminus">-        CPString * pABUrl = new CPString((LPCTSTR) mozABNameList[i].lpszABUrl);</span>
<a href="#l18.150"></a><span id="l18.150" class="difflineminus">-        if (pABUrl)</span>
<a href="#l18.151"></a><span id="l18.151" class="difflineminus">-            *abUrlList = pABUrl;</span>
<a href="#l18.152"></a><span id="l18.152" class="difflineminus">-        else</span>
<a href="#l18.153"></a><span id="l18.153" class="difflineminus">-            return GEN_ERR_LOW_MEMORY;</span>
<a href="#l18.154"></a><span id="l18.154" class="difflineminus">-        CoTaskMemFree(mozABNameList[i].lpszABUrl);</span>
<a href="#l18.155"></a><span id="l18.155" class="difflineminus">-        abUrlList++;</span>
<a href="#l18.156"></a><span id="l18.156" class="difflineminus">-    }</span>
<a href="#l18.157"></a><span id="l18.157" class="difflineminus">-    </span>
<a href="#l18.158"></a><span id="l18.158" class="difflineminus">-    CoTaskMemFree(mozABNameList);</span>
<a href="#l18.159"></a><span id="l18.159" class="difflineminus">-    return retval;</span>
<a href="#l18.160"></a><span id="l18.160" class="difflineminus">-}</span>
<a href="#l18.161"></a><span id="l18.161" class="difflineminus">-</span>
<a href="#l18.162"></a><span id="l18.162" class="difflineminus">-// this function allocates the mozlist as well as the mozRecs, caller should free list and delete recs</span>
<a href="#l18.163"></a><span id="l18.163" class="difflineminus">-long MozABPCManager::SynchronizePCAB(LONG categoryIndex, LONG categoryId, CPString &amp; categoryName,</span>
<a href="#l18.164"></a><span id="l18.164" class="difflineminus">-					DWORD updatedPalmRecCount, CPalmRecord ** updatedPalmRecList,</span>
<a href="#l18.165"></a><span id="l18.165" class="difflineminus">-					DWORD * pUpdatedPCRecListCount, CPalmRecord *** updatedPCRecList)</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineminus">-{</span>
<a href="#l18.167"></a><span id="l18.167" class="difflineminus">-    lpnsABCOMCardStruct mozCardList=NULL;  // freed by MSCOM/Mozilla.</span>
<a href="#l18.168"></a><span id="l18.168" class="difflineminus">-    int       dwMozCardCount=0;</span>
<a href="#l18.169"></a><span id="l18.169" class="difflineminus">-    long        retval = 0;</span>
<a href="#l18.170"></a><span id="l18.170" class="difflineminus">-    IPalmSync     *pNsPalmSync = NULL;</span>
<a href="#l18.171"></a><span id="l18.171" class="difflineminus">-</span>
<a href="#l18.172"></a><span id="l18.172" class="difflineminus">-    // get the interface </span>
<a href="#l18.173"></a><span id="l18.173" class="difflineminus">-    if (!InitMozPalmSyncInstance(&amp;pNsPalmSync))</span>
<a href="#l18.174"></a><span id="l18.174" class="difflineminus">-        return GEN_ERR_NOT_SUPPORTED;</span>
<a href="#l18.175"></a><span id="l18.175" class="difflineminus">-</span>
<a href="#l18.176"></a><span id="l18.176" class="difflineminus">-    CMozABConduitRecord ** tempMozABConduitRecList = new CMozABConduitRecord*[updatedPalmRecCount];</span>
<a href="#l18.177"></a><span id="l18.177" class="difflineminus">-    nsABCOMCardStruct * palmCardList = new nsABCOMCardStruct[updatedPalmRecCount];</span>
<a href="#l18.178"></a><span id="l18.178" class="difflineminus">-    if(palmCardList)</span>
<a href="#l18.179"></a><span id="l18.179" class="difflineminus">-    {</span>
<a href="#l18.180"></a><span id="l18.180" class="difflineminus">-        for(DWORD i=0; i&lt;updatedPalmRecCount; i++) </span>
<a href="#l18.181"></a><span id="l18.181" class="difflineminus">-        {</span>
<a href="#l18.182"></a><span id="l18.182" class="difflineminus">-            if(*updatedPalmRecList)</span>
<a href="#l18.183"></a><span id="l18.183" class="difflineminus">-            {</span>
<a href="#l18.184"></a><span id="l18.184" class="difflineminus">-                CMozABConduitRecord * pConduitRecord = new CMozABConduitRecord(**updatedPalmRecList);</span>
<a href="#l18.185"></a><span id="l18.185" class="difflineminus">-                memcpy(&amp;palmCardList[i], &amp;pConduitRecord-&gt;m_nsCard, sizeof(nsABCOMCardStruct));</span>
<a href="#l18.186"></a><span id="l18.186" class="difflineminus">-                tempMozABConduitRecList[i]=pConduitRecord;</span>
<a href="#l18.187"></a><span id="l18.187" class="difflineminus">-            }</span>
<a href="#l18.188"></a><span id="l18.188" class="difflineminus">-            updatedPalmRecList++;</span>
<a href="#l18.189"></a><span id="l18.189" class="difflineminus">-        }</span>
<a href="#l18.190"></a><span id="l18.190" class="difflineminus">-        // synchronize and get the updated cards in MozAB</span>
<a href="#l18.191"></a><span id="l18.191" class="difflineminus">-        HRESULT hres = pNsPalmSync-&gt;nsSynchronizeAB(FALSE, categoryIndex, categoryId, categoryName.GetBuffer(0),</span>
<a href="#l18.192"></a><span id="l18.192" class="difflineminus">-                                                updatedPalmRecCount, palmCardList,</span>
<a href="#l18.193"></a><span id="l18.193" class="difflineminus">-                                                &amp;dwMozCardCount, &amp;mozCardList);</span>
<a href="#l18.194"></a><span id="l18.194" class="difflineminus">-        if(hres == S_OK &amp;&amp; mozCardList) </span>
<a href="#l18.195"></a><span id="l18.195" class="difflineminus">-        {</span>
<a href="#l18.196"></a><span id="l18.196" class="difflineminus">-            *pUpdatedPCRecListCount = dwMozCardCount;</span>
<a href="#l18.197"></a><span id="l18.197" class="difflineminus">-            CPalmRecord ** mozRecordList = (CPalmRecord **) malloc(sizeof(CPalmRecord *) * dwMozCardCount);</span>
<a href="#l18.198"></a><span id="l18.198" class="difflineminus">-            *updatedPCRecList = mozRecordList;</span>
<a href="#l18.199"></a><span id="l18.199" class="difflineminus">-            if (mozRecordList) </span>
<a href="#l18.200"></a><span id="l18.200" class="difflineminus">-            {</span>
<a href="#l18.201"></a><span id="l18.201" class="difflineminus">-                memset(mozRecordList, 0, sizeof(CPalmRecord *) * dwMozCardCount);</span>
<a href="#l18.202"></a><span id="l18.202" class="difflineminus">-                int i=0;</span>
<a href="#l18.203"></a><span id="l18.203" class="difflineminus">-                for (i=0; i &lt; dwMozCardCount; i++) </span>
<a href="#l18.204"></a><span id="l18.204" class="difflineminus">-                {</span>
<a href="#l18.205"></a><span id="l18.205" class="difflineminus">-                    CMozABConduitRecord * pConduitRecord = new CMozABConduitRecord(mozCardList[i]);</span>
<a href="#l18.206"></a><span id="l18.206" class="difflineminus">-                    CPalmRecord * pMozRecord = new CPalmRecord;</span>
<a href="#l18.207"></a><span id="l18.207" class="difflineminus">-                    pConduitRecord-&gt;ConvertToGeneric(*pMozRecord);</span>
<a href="#l18.208"></a><span id="l18.208" class="difflineminus">-                    *mozRecordList = pMozRecord;</span>
<a href="#l18.209"></a><span id="l18.209" class="difflineminus">-                    mozRecordList++;</span>
<a href="#l18.210"></a><span id="l18.210" class="difflineminus">-                    delete pConduitRecord;</span>
<a href="#l18.211"></a><span id="l18.211" class="difflineminus">-                    CMozABConduitRecord::CleanUpABCOMCardStruct(&amp;mozCardList[i]);</span>
<a href="#l18.212"></a><span id="l18.212" class="difflineminus">-                }</span>
<a href="#l18.213"></a><span id="l18.213" class="difflineminus">-            }</span>
<a href="#l18.214"></a><span id="l18.214" class="difflineminus">-            else</span>
<a href="#l18.215"></a><span id="l18.215" class="difflineminus">-                retval = GEN_ERR_LOW_MEMORY;</span>
<a href="#l18.216"></a><span id="l18.216" class="difflineminus">-            CoTaskMemFree(mozCardList);</span>
<a href="#l18.217"></a><span id="l18.217" class="difflineminus">-        }</span>
<a href="#l18.218"></a><span id="l18.218" class="difflineminus">-        else</span>
<a href="#l18.219"></a><span id="l18.219" class="difflineminus">-            retval = (long) hres;</span>
<a href="#l18.220"></a><span id="l18.220" class="difflineminus">-    }</span>
<a href="#l18.221"></a><span id="l18.221" class="difflineminus">-    else</span>
<a href="#l18.222"></a><span id="l18.222" class="difflineminus">-        retval = GEN_ERR_LOW_MEMORY;</span>
<a href="#l18.223"></a><span id="l18.223" class="difflineminus">-</span>
<a href="#l18.224"></a><span id="l18.224" class="difflineminus">-</span>
<a href="#l18.225"></a><span id="l18.225" class="difflineminus">-        delete palmCardList;</span>
<a href="#l18.226"></a><span id="l18.226" class="difflineminus">-    if(tempMozABConduitRecList) </span>
<a href="#l18.227"></a><span id="l18.227" class="difflineminus">-    {</span>
<a href="#l18.228"></a><span id="l18.228" class="difflineminus">-        for(DWORD j=0; j&lt;updatedPalmRecCount; j++)</span>
<a href="#l18.229"></a><span id="l18.229" class="difflineminus">-            delete tempMozABConduitRecList[j];</span>
<a href="#l18.230"></a><span id="l18.230" class="difflineminus">-        delete tempMozABConduitRecList;</span>
<a href="#l18.231"></a><span id="l18.231" class="difflineminus">-    }</span>
<a href="#l18.232"></a><span id="l18.232" class="difflineminus">-</span>
<a href="#l18.233"></a><span id="l18.233" class="difflineminus">-    return retval;</span>
<a href="#l18.234"></a><span id="l18.234" class="difflineminus">-}</span>
<a href="#l18.235"></a><span id="l18.235" class="difflineminus">-</span>
<a href="#l18.236"></a><span id="l18.236" class="difflineminus">-// this will add all records in a Palm category into a new or existing Mozilla AB </span>
<a href="#l18.237"></a><span id="l18.237" class="difflineminus">-long MozABPCManager::AddRecords(BOOL replaceExisting, LONG categoryIndex, CPString &amp; categoryName,</span>
<a href="#l18.238"></a><span id="l18.238" class="difflineminus">-					DWORD updatedPalmRecCount, CPalmRecord ** updatedPalmRecList)</span>
<a href="#l18.239"></a><span id="l18.239" class="difflineminus">-{</span>
<a href="#l18.240"></a><span id="l18.240" class="difflineminus">-    long        retval = 0;</span>
<a href="#l18.241"></a><span id="l18.241" class="difflineminus">-    IPalmSync     *pNsPalmSync = NULL;</span>
<a href="#l18.242"></a><span id="l18.242" class="difflineminus">-</span>
<a href="#l18.243"></a><span id="l18.243" class="difflineminus">-    // get the interface </span>
<a href="#l18.244"></a><span id="l18.244" class="difflineminus">-    if (!InitMozPalmSyncInstance(&amp;pNsPalmSync))</span>
<a href="#l18.245"></a><span id="l18.245" class="difflineminus">-        return GEN_ERR_NOT_SUPPORTED;</span>
<a href="#l18.246"></a><span id="l18.246" class="difflineminus">-</span>
<a href="#l18.247"></a><span id="l18.247" class="difflineminus">-    CMozABConduitRecord ** tempMozABConduitRecList = new CMozABConduitRecord*[updatedPalmRecCount];</span>
<a href="#l18.248"></a><span id="l18.248" class="difflineminus">-    nsABCOMCardStruct * palmCardList = new nsABCOMCardStruct[updatedPalmRecCount];</span>
<a href="#l18.249"></a><span id="l18.249" class="difflineminus">-    if(palmCardList) </span>
<a href="#l18.250"></a><span id="l18.250" class="difflineminus">-    {</span>
<a href="#l18.251"></a><span id="l18.251" class="difflineminus">-        for(DWORD i=0; i&lt;updatedPalmRecCount; i++) </span>
<a href="#l18.252"></a><span id="l18.252" class="difflineminus">-        {</span>
<a href="#l18.253"></a><span id="l18.253" class="difflineminus">-            if(*updatedPalmRecList) </span>
<a href="#l18.254"></a><span id="l18.254" class="difflineminus">-            {</span>
<a href="#l18.255"></a><span id="l18.255" class="difflineminus">-                CMozABConduitRecord * pConduitRecord = new CMozABConduitRecord(**updatedPalmRecList);</span>
<a href="#l18.256"></a><span id="l18.256" class="difflineminus">-                memcpy(&amp;palmCardList[i], &amp;pConduitRecord-&gt;m_nsCard, sizeof(nsABCOMCardStruct));</span>
<a href="#l18.257"></a><span id="l18.257" class="difflineminus">-                tempMozABConduitRecList[i]=pConduitRecord;</span>
<a href="#l18.258"></a><span id="l18.258" class="difflineminus">-            }</span>
<a href="#l18.259"></a><span id="l18.259" class="difflineminus">-            updatedPalmRecList++;</span>
<a href="#l18.260"></a><span id="l18.260" class="difflineminus">-        }</span>
<a href="#l18.261"></a><span id="l18.261" class="difflineminus">-        // get the ABList</span>
<a href="#l18.262"></a><span id="l18.262" class="difflineminus">-        HRESULT hres = pNsPalmSync-&gt;nsAddAllABRecords(FALSE, replaceExisting, categoryIndex, categoryName.GetBuffer(0),</span>
<a href="#l18.263"></a><span id="l18.263" class="difflineminus">-                                                updatedPalmRecCount, palmCardList);</span>
<a href="#l18.264"></a><span id="l18.264" class="difflineminus">-        if (hres != S_OK)</span>
<a href="#l18.265"></a><span id="l18.265" class="difflineminus">-            retval = (long) hres;</span>
<a href="#l18.266"></a><span id="l18.266" class="difflineminus">-    }</span>
<a href="#l18.267"></a><span id="l18.267" class="difflineminus">-    else</span>
<a href="#l18.268"></a><span id="l18.268" class="difflineminus">-        retval = GEN_ERR_LOW_MEMORY;</span>
<a href="#l18.269"></a><span id="l18.269" class="difflineminus">-</span>
<a href="#l18.270"></a><span id="l18.270" class="difflineminus">-        delete palmCardList;</span>
<a href="#l18.271"></a><span id="l18.271" class="difflineminus">-    if(tempMozABConduitRecList) </span>
<a href="#l18.272"></a><span id="l18.272" class="difflineminus">-    {</span>
<a href="#l18.273"></a><span id="l18.273" class="difflineminus">-</span>
<a href="#l18.274"></a><span id="l18.274" class="difflineminus">-        for(DWORD i=0; i&lt;updatedPalmRecCount; i++)</span>
<a href="#l18.275"></a><span id="l18.275" class="difflineminus">-            delete tempMozABConduitRecList[i];</span>
<a href="#l18.276"></a><span id="l18.276" class="difflineminus">-        delete tempMozABConduitRecList;</span>
<a href="#l18.277"></a><span id="l18.277" class="difflineminus">-    }</span>
<a href="#l18.278"></a><span id="l18.278" class="difflineminus">-    return retval;</span>
<a href="#l18.279"></a><span id="l18.279" class="difflineminus">-}</span>
<a href="#l18.280"></a><span id="l18.280" class="difflineminus">-</span>
<a href="#l18.281"></a><span id="l18.281" class="difflineminus">-bool MozABPCManager::PCABDeleted(CPString &amp;ABName)</span>
<a href="#l18.282"></a><span id="l18.282" class="difflineminus">-{</span>
<a href="#l18.283"></a><span id="l18.283" class="difflineminus">-    IPalmSync     *pNsPalmSync = NULL;</span>
<a href="#l18.284"></a><span id="l18.284" class="difflineminus">-    // get the interface </span>
<a href="#l18.285"></a><span id="l18.285" class="difflineminus">-    if (!InitMozPalmSyncInstance(&amp;pNsPalmSync))</span>
<a href="#l18.286"></a><span id="l18.286" class="difflineminus">-        return false;</span>
<a href="#l18.287"></a><span id="l18.287" class="difflineminus">-    BOOL abDeleted;</span>
<a href="#l18.288"></a><span id="l18.288" class="difflineminus">-    HRESULT hres = pNsPalmSync-&gt;nsGetABDeleted(ABName.GetBuffer(0), &amp;abDeleted);</span>
<a href="#l18.289"></a><span id="l18.289" class="difflineminus">-    return (hres == S_OK) ? abDeleted : false; // assume false;</span>
<a href="#l18.290"></a><span id="l18.290" class="difflineminus">-</span>
<a href="#l18.291"></a><span id="l18.291" class="difflineminus">-}</span>
<a href="#l18.292"></a><span id="l18.292" class="difflineminus">-// this load all records in an Moz AB</span>
<a href="#l18.293"></a><span id="l18.293" class="difflineminus">-// this function allocates the mozlist as well as the mozRecs, caller should free list and delete recs</span>
<a href="#l18.294"></a><span id="l18.294" class="difflineminus">-long MozABPCManager::LoadAllRecords(CPString &amp; ABName, DWORD * pPCRecListCount, CPalmRecord *** pPCRecList)</span>
<a href="#l18.295"></a><span id="l18.295" class="difflineminus">-{</span>
<a href="#l18.296"></a><span id="l18.296" class="difflineminus">-    lpnsABCOMCardStruct mozCardList=NULL; // freed by MSCOM/Mozilla.</span>
<a href="#l18.297"></a><span id="l18.297" class="difflineminus">-    int       dwMozCardCount=0;</span>
<a href="#l18.298"></a><span id="l18.298" class="difflineminus">-    long        retval = 0;</span>
<a href="#l18.299"></a><span id="l18.299" class="difflineminus">-    IPalmSync     *pNsPalmSync = NULL;</span>
<a href="#l18.300"></a><span id="l18.300" class="difflineminus">-</span>
<a href="#l18.301"></a><span id="l18.301" class="difflineminus">-    // get the interface </span>
<a href="#l18.302"></a><span id="l18.302" class="difflineminus">-    if (!InitMozPalmSyncInstance(&amp;pNsPalmSync))</span>
<a href="#l18.303"></a><span id="l18.303" class="difflineminus">-        return GEN_ERR_NOT_SUPPORTED;</span>
<a href="#l18.304"></a><span id="l18.304" class="difflineminus">-</span>
<a href="#l18.305"></a><span id="l18.305" class="difflineminus">-    // get the ABList</span>
<a href="#l18.306"></a><span id="l18.306" class="difflineminus">-    HRESULT hres = pNsPalmSync-&gt;nsGetAllABCards(FALSE, -1, ABName.GetBuffer(0),</span>
<a href="#l18.307"></a><span id="l18.307" class="difflineminus">-                                            &amp;dwMozCardCount, &amp;mozCardList);</span>
<a href="#l18.308"></a><span id="l18.308" class="difflineminus">-    if (hres == S_OK &amp;&amp; mozCardList) {</span>
<a href="#l18.309"></a><span id="l18.309" class="difflineminus">-        *pPCRecListCount = dwMozCardCount;</span>
<a href="#l18.310"></a><span id="l18.310" class="difflineminus">-        CPalmRecord ** mozRecordList = (CPalmRecord **) malloc(sizeof(CPalmRecord *) * dwMozCardCount);</span>
<a href="#l18.311"></a><span id="l18.311" class="difflineminus">-        *pPCRecList = mozRecordList;</span>
<a href="#l18.312"></a><span id="l18.312" class="difflineminus">-        if (mozRecordList) {</span>
<a href="#l18.313"></a><span id="l18.313" class="difflineminus">-            memset(mozRecordList, 0, sizeof(CPalmRecord *) * dwMozCardCount);</span>
<a href="#l18.314"></a><span id="l18.314" class="difflineminus">-            for (int i=0; i &lt; dwMozCardCount; i++) {</span>
<a href="#l18.315"></a><span id="l18.315" class="difflineminus">-                CMozABConduitRecord * pConduitRecord = new CMozABConduitRecord(mozCardList[i]);</span>
<a href="#l18.316"></a><span id="l18.316" class="difflineminus">-                CPalmRecord * pMozRecord = new CPalmRecord;</span>
<a href="#l18.317"></a><span id="l18.317" class="difflineminus">-                pConduitRecord-&gt;ConvertToGeneric(*pMozRecord);</span>
<a href="#l18.318"></a><span id="l18.318" class="difflineminus">-                *mozRecordList = pMozRecord;</span>
<a href="#l18.319"></a><span id="l18.319" class="difflineminus">-                mozRecordList++;</span>
<a href="#l18.320"></a><span id="l18.320" class="difflineminus">-                delete pConduitRecord;</span>
<a href="#l18.321"></a><span id="l18.321" class="difflineminus">-                CMozABConduitRecord::CleanUpABCOMCardStruct(&amp;mozCardList[i]);</span>
<a href="#l18.322"></a><span id="l18.322" class="difflineminus">-            }</span>
<a href="#l18.323"></a><span id="l18.323" class="difflineminus">-        }</span>
<a href="#l18.324"></a><span id="l18.324" class="difflineminus">-        else</span>
<a href="#l18.325"></a><span id="l18.325" class="difflineminus">-            retval = GEN_ERR_LOW_MEMORY;</span>
<a href="#l18.326"></a><span id="l18.326" class="difflineminus">-        CoTaskMemFree(mozCardList);</span>
<a href="#l18.327"></a><span id="l18.327" class="difflineminus">-    }</span>
<a href="#l18.328"></a><span id="l18.328" class="difflineminus">-    else</span>
<a href="#l18.329"></a><span id="l18.329" class="difflineminus">-        retval = (long) hres;</span>
<a href="#l18.330"></a><span id="l18.330" class="difflineminus">-    </span>
<a href="#l18.331"></a><span id="l18.331" class="difflineminus">-    return retval;</span>
<a href="#l18.332"></a><span id="l18.332" class="difflineminus">-}</span>
<a href="#l18.333"></a><span id="l18.333" class="difflineminus">-</span>
<a href="#l18.334"></a><span id="l18.334" class="difflineminus">-long MozABPCManager::NotifySyncDone(BOOL success, LONG catIndex, DWORD newRecCount, DWORD * newRecIDList)</span>
<a href="#l18.335"></a><span id="l18.335" class="difflineminus">-{</span>
<a href="#l18.336"></a><span id="l18.336" class="difflineminus">-    IPalmSync     *pNsPalmSync = NULL;</span>
<a href="#l18.337"></a><span id="l18.337" class="difflineminus">-    // get the interface </span>
<a href="#l18.338"></a><span id="l18.338" class="difflineminus">-    if (!InitMozPalmSyncInstance(&amp;pNsPalmSync))</span>
<a href="#l18.339"></a><span id="l18.339" class="difflineminus">-        return GEN_ERR_NOT_SUPPORTED;</span>
<a href="#l18.340"></a><span id="l18.340" class="difflineminus">-</span>
<a href="#l18.341"></a><span id="l18.341" class="difflineminus">-    // MS COM Proxy stub Dll will not accept NULL for this address</span>
<a href="#l18.342"></a><span id="l18.342" class="difflineminus">-    if(!newRecIDList)</span>
<a href="#l18.343"></a><span id="l18.343" class="difflineminus">-        newRecIDList = &amp;newRecCount;</span>
<a href="#l18.344"></a><span id="l18.344" class="difflineminus">-</span>
<a href="#l18.345"></a><span id="l18.345" class="difflineminus">-    HRESULT hres = pNsPalmSync-&gt;nsAckSyncDone(success, catIndex, newRecCount, newRecIDList);</span>
<a href="#l18.346"></a><span id="l18.346" class="difflineminus">-    long retval = (long) hres;</span>
<a href="#l18.347"></a><span id="l18.347" class="difflineminus">-</span>
<a href="#l18.348"></a><span id="l18.348" class="difflineminus">-    return retval;</span>
<a href="#l18.349"></a><span id="l18.349" class="difflineminus">-}</span>
<a href="#l18.350"></a><span id="l18.350" class="difflineminus">-</span>
<a href="#l18.351"></a><span id="l18.351" class="difflineminus">-long MozABPCManager::UpdatePCABSyncInfo(LONG categoryIndex, CPString &amp; categoryName)</span>
<a href="#l18.352"></a><span id="l18.352" class="difflineminus">-{</span>
<a href="#l18.353"></a><span id="l18.353" class="difflineminus">-    IPalmSync     *pNsPalmSync = NULL;</span>
<a href="#l18.354"></a><span id="l18.354" class="difflineminus">-    // get the interface </span>
<a href="#l18.355"></a><span id="l18.355" class="difflineminus">-    if (!InitMozPalmSyncInstance(&amp;pNsPalmSync))</span>
<a href="#l18.356"></a><span id="l18.356" class="difflineminus">-        return GEN_ERR_NOT_SUPPORTED;</span>
<a href="#l18.357"></a><span id="l18.357" class="difflineminus">-</span>
<a href="#l18.358"></a><span id="l18.358" class="difflineminus">-    HRESULT hres = pNsPalmSync-&gt;nsUpdateABSyncInfo(FALSE, categoryIndex, categoryName);</span>
<a href="#l18.359"></a><span id="l18.359" class="difflineminus">-    long retval = (long) hres;</span>
<a href="#l18.360"></a><span id="l18.360" class="difflineminus">-</span>
<a href="#l18.361"></a><span id="l18.361" class="difflineminus">-    return retval;</span>
<a href="#l18.362"></a><span id="l18.362" class="difflineminus">-}</span>
<a href="#l18.363"></a><span id="l18.363" class="difflineminus">-</span>
<a href="#l18.364"></a><span id="l18.364" class="difflineminus">-long MozABPCManager::DeletePCAB(LONG categoryIndex, CPString &amp; categoryName, CPString &amp; categoryUrl)</span>
<a href="#l18.365"></a><span id="l18.365" class="difflineminus">-{</span>
<a href="#l18.366"></a><span id="l18.366" class="difflineminus">-    IPalmSync     *pNsPalmSync = NULL;</span>
<a href="#l18.367"></a><span id="l18.367" class="difflineminus">-    // get the interface </span>
<a href="#l18.368"></a><span id="l18.368" class="difflineminus">-    if (!InitMozPalmSyncInstance(&amp;pNsPalmSync))</span>
<a href="#l18.369"></a><span id="l18.369" class="difflineminus">-        return GEN_ERR_NOT_SUPPORTED;</span>
<a href="#l18.370"></a><span id="l18.370" class="difflineminus">-</span>
<a href="#l18.371"></a><span id="l18.371" class="difflineminus">-    HRESULT hres = pNsPalmSync-&gt;nsDeleteAB(FALSE, categoryIndex, categoryName, categoryUrl);</span>
<a href="#l18.372"></a><span id="l18.372" class="difflineminus">-    long retval = (long) hres;</span>
<a href="#l18.373"></a><span id="l18.373" class="difflineminus">-</span>
<a href="#l18.374"></a><span id="l18.374" class="difflineminus">-    return retval;</span>
<a href="#l18.375"></a><span id="l18.375" class="difflineminus">-}</span>
<a href="#l18.376"></a><span id="l18.376" class="difflineminus">-</span>
<a href="#l18.377"></a><span id="l18.377" class="difflineminus">-long MozABPCManager::RenamePCAB(LONG categoryIndex, CPString &amp; categoryName, CPString &amp; categoryUrl)</span>
<a href="#l18.378"></a><span id="l18.378" class="difflineminus">-{</span>
<a href="#l18.379"></a><span id="l18.379" class="difflineminus">-    IPalmSync     *pNsPalmSync = NULL;</span>
<a href="#l18.380"></a><span id="l18.380" class="difflineminus">-    // get the interface </span>
<a href="#l18.381"></a><span id="l18.381" class="difflineminus">-    if (!InitMozPalmSyncInstance(&amp;pNsPalmSync))</span>
<a href="#l18.382"></a><span id="l18.382" class="difflineminus">-        return GEN_ERR_NOT_SUPPORTED;</span>
<a href="#l18.383"></a><span id="l18.383" class="difflineminus">-</span>
<a href="#l18.384"></a><span id="l18.384" class="difflineminus">-    HRESULT hres = pNsPalmSync-&gt;nsRenameAB(FALSE, categoryIndex, categoryName, categoryUrl);</span>
<a href="#l18.385"></a><span id="l18.385" class="difflineminus">-    return (long) hres;</span>
<a href="#l18.386"></a><span id="l18.386" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">deleted file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/MozABPCManager.h</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ /dev/null</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -1,89 +0,0 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineminus">- *</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">- *</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">- * License.</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">- *</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">- *</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineminus">- *</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineminus">- *</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineminus">- *</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineminus">- *</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineminus">-#ifndef _MOZAB_PCMANAGER_H_</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineminus">-#define _MOZAB_PCMANAGER_H_</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineminus">-</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineminus">-#include &lt;CPString.h&gt;</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineminus">-#include &lt;CPDbBMgr.h&gt;</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineminus">-</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineminus">-#include &quot;IPalmSync.h&quot;</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineminus">-</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineminus">-class MozABPCManager</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineminus">-{</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineminus">-public:</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-    MozABPCManager() { }</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineminus">-    ~MozABPCManager() { }</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineminus">-</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineminus">-	// this will return the list of ABs in Mozilla and some flags, including if they were synced before</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineminus">-    long GetPCABList(DWORD * pCategoryCount, LONG ** pCategoryIndexList, </span>
<a href="#l19.59"></a><span id="l19.59" class="difflineminus">-                        CPString *** pCategoryNameList, CPString *** pCategoryURLList, BOOL ** pDirFlags);</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineminus">-	// this will update a Mozilla AB with updated Palm records and </span>
<a href="#l19.61"></a><span id="l19.61" class="difflineminus">-	// return updated records in a Mozilla AB after the last sync</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineminus">-    // this will take care of first time sync also in which case </span>
<a href="#l19.63"></a><span id="l19.63" class="difflineminus">-    // updatedPalmRecList is the list of all palm records and </span>
<a href="#l19.64"></a><span id="l19.64" class="difflineminus">-    // updatedPCRecList is the list of unique Moz AB cards / records.</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineminus">-	long SynchronizePCAB(LONG categoryIndex, LONG categoryId, CPString &amp; categoryName,</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineminus">-						DWORD updatedPalmRecCount, CPalmRecord ** updatedPalmRecList,</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineminus">-						DWORD * pUpdatedPCRecList, CPalmRecord *** updatedPCRecList);</span>
<a href="#l19.68"></a><span id="l19.68" class="difflineminus">-	// this will add all records in a Palm category into a new or existing Mozilla AB </span>
<a href="#l19.69"></a><span id="l19.69" class="difflineminus">-	long AddRecords(BOOL replaceExisting, LONG categoryIndex, CPString &amp; categoryName,</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineminus">-						DWORD updatedPalmRecCount, CPalmRecord ** updatedPalmRecList);</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineminus">-    // this load all records in an Moz AB</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineminus">-	long LoadAllRecords(CPString &amp; ABName, DWORD * pPCRecListCount, CPalmRecord *** pPCRecList);</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineminus">-</span>
<a href="#l19.74"></a><span id="l19.74" class="difflineminus">-  long NotifySyncDone(BOOL success, LONG catIndex=-1, DWORD newRecCount=0, DWORD * newRecIDList=NULL);</span>
<a href="#l19.75"></a><span id="l19.75" class="difflineminus">-</span>
<a href="#l19.76"></a><span id="l19.76" class="difflineminus">-  // Update/Reset category id and mod time in an Moz AB</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineminus">-  long UpdatePCABSyncInfo(LONG categoryIndex, CPString &amp; categoryName);</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineminus">-  // Delete an Moz AB</span>
<a href="#l19.79"></a><span id="l19.79" class="difflineminus">-  long DeletePCAB(LONG categoryIndex, CPString &amp; categoryName, CPString &amp; categoryUrl);</span>
<a href="#l19.80"></a><span id="l19.80" class="difflineminus">-  // Rename an Moz AB</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineminus">-  long RenamePCAB(LONG categoryIndex, CPString &amp; categoryName, CPString &amp; categoryUrl);</span>
<a href="#l19.82"></a><span id="l19.82" class="difflineminus">-</span>
<a href="#l19.83"></a><span id="l19.83" class="difflineminus">-  bool PCABDeleted(CPString &amp;abName);</span>
<a href="#l19.84"></a><span id="l19.84" class="difflineminus">-  static BOOL gUseHomeAddress;</span>
<a href="#l19.85"></a><span id="l19.85" class="difflineminus">-  static BOOL gPreferHomePhone;</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineminus">-</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineminus">-private:</span>
<a href="#l19.88"></a><span id="l19.88" class="difflineminus">-  	// this will initiate the communication with Mozilla</span>
<a href="#l19.89"></a><span id="l19.89" class="difflineminus">-	BOOL InitMozPalmSyncInstance(IPalmSync **aRetValue);</span>
<a href="#l19.90"></a><span id="l19.90" class="difflineminus">-</span>
<a href="#l19.91"></a><span id="l19.91" class="difflineminus">-};</span>
<a href="#l19.92"></a><span id="l19.92" class="difflineminus">-</span>
<a href="#l19.93"></a><span id="l19.93" class="difflineminus">-#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">deleted file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/install.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ /dev/null</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -1,105 +0,0 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineminus">-// Install script for palmsync</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineminus">-</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineminus">-var err;</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineminus">-</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineminus">-err = initInstall(&quot;Palmsync v0.4.0&quot;, // name for install UI</span>
<a href="#l20.10"></a><span id="l20.10" class="difflineminus">-                  &quot;/palmsync&quot;,         // registered name</span>
<a href="#l20.11"></a><span id="l20.11" class="difflineminus">-                  &quot;0.4.0.0&quot;);        // package version</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-const APP_VERSION = &quot;0.0.4&quot;;</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-const APP_PACKAGE = &quot;/XXX.mozdev.org/palmsync&quot;;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-logComment(&quot;initInstall: &quot; + err);</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">-var srDest = 300;       // Disk space required for installation (KB)</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">-</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">-var fProgram    = getFolder(&quot;Program&quot;);</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">-logComment(&quot;fProgram: &quot; + fProgram);</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineminus">-</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineminus">-if (!verifyDiskSpace(fProgram, srDest)) {</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">-  cancelInstall(INSUFFICIENT_DISK_SPACE);</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineminus">-</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineminus">-} else {</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineminus">-</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineminus">-  var fInstallDir = getFolder(&quot;.&quot;);</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineminus">-  var fComponentsDir = getFolder(&quot;components&quot;);</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-  err = addFile(APP_PACKAGE, APP_VERSION, &quot;mozABConduit.dll&quot;, fProgram, null);</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-  err = addFile(APP_PACKAGE, APP_VERSION, &quot;CondMgr.dll&quot;, fProgram, null);</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-  err = addFile(APP_PACKAGE, APP_VERSION, &quot;HSAPI.dll&quot;, fProgram, null);</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-  err = addFile(APP_PACKAGE, APP_VERSION, &quot;PalmSyncProxy.dll&quot;, fProgram, null);</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">-  err = addFile(APP_PACKAGE, APP_VERSION, &quot;PalmSyncInstall.exe&quot;, fProgram, null);</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-  err = addFile(APP_PACKAGE, APP_VERSION, &quot;palmsync.dll&quot;, fComponentsDir, null);</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-  err = addFile(APP_PACKAGE, APP_VERSION, &quot;palmSync.xpt&quot;, fComponentsDir, null);</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineminus">-  err = getLastError();</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">-  if (err == ACCESS_DENIED) {</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineminus">-    alert(&quot;Unable to write to installation directory &quot;+fInstallDir+&quot;.\n You will need to restart the browser with administrator/root privileges to install this software. After installing as root (or administrator), you will need to restart the browser one more time to register the installed software.\n After the second restart, you can go back to running the browser without privileges!&quot;);</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineminus">-</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineminus">-    cancelInstall(ACCESS_DENIED);</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineminus">-  } else if (err != SUCCESS) {</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineminus">-    cancelInstall(err);</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineminus">-</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineminus">-  } else {</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineminus">-    var args = &quot;/p&quot;;</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-    args += fProgram;</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineminus">-	err = execute(&quot;PalmSyncInstall.exe&quot;, args, true);</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineminus">-    performInstall();</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-  }</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineminus">-}</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineminus">-</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineminus">-// this function verifies disk space in kilobytes</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineminus">-function verifyDiskSpace(dirPath, spaceRequired) {</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineminus">-  var spaceAvailable;</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineminus">-</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineminus">-  // Get the available disk space on the given path</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineminus">-  spaceAvailable = fileGetDiskSpaceAvailable(dirPath);</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineminus">-</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineminus">-  // Convert the available disk space into kilobytes</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineminus">-  spaceAvailable = parseInt(spaceAvailable / 1024);</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineminus">-</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineminus">-  // do the verification</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineminus">-  if(spaceAvailable &lt; spaceRequired) {</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineminus">-    logComment(&quot;Insufficient disk space: &quot; + dirPath);</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineminus">-    logComment(&quot;  required : &quot; + spaceRequired + &quot; K&quot;);</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineminus">-    logComment(&quot;  available: &quot; + spaceAvailable + &quot; K&quot;);</span>
<a href="#l20.71"></a><span id="l20.71" class="difflineminus">-    return false;</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineminus">-  }</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineminus">-</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineminus">-  return true;</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineminus">-}</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineminus">-</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineminus">-// OS type detection</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineminus">-// which platform?</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineminus">-function getPlatform() {</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineminus">-  var platformStr;</span>
<a href="#l20.81"></a><span id="l20.81" class="difflineminus">-  var platformNode;</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineminus">-</span>
<a href="#l20.83"></a><span id="l20.83" class="difflineminus">-  if('platform' in Install) {</span>
<a href="#l20.84"></a><span id="l20.84" class="difflineminus">-    platformStr = new String(Install.platform);</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineminus">-</span>
<a href="#l20.86"></a><span id="l20.86" class="difflineminus">-    if (!platformStr.search(/^Macintosh/))</span>
<a href="#l20.87"></a><span id="l20.87" class="difflineminus">-      platformNode = 'mac';</span>
<a href="#l20.88"></a><span id="l20.88" class="difflineminus">-    else if (!platformStr.search(/^Win/))</span>
<a href="#l20.89"></a><span id="l20.89" class="difflineminus">-      platformNode = 'win';</span>
<a href="#l20.90"></a><span id="l20.90" class="difflineminus">-    else</span>
<a href="#l20.91"></a><span id="l20.91" class="difflineminus">-      platformNode = 'unix';</span>
<a href="#l20.92"></a><span id="l20.92" class="difflineminus">-  }</span>
<a href="#l20.93"></a><span id="l20.93" class="difflineminus">-  else {</span>
<a href="#l20.94"></a><span id="l20.94" class="difflineminus">-    var fOSMac  = getFolder(&quot;Mac System&quot;);</span>
<a href="#l20.95"></a><span id="l20.95" class="difflineminus">-    var fOSWin  = getFolder(&quot;Win System&quot;);</span>
<a href="#l20.96"></a><span id="l20.96" class="difflineminus">-</span>
<a href="#l20.97"></a><span id="l20.97" class="difflineminus">-    logComment(&quot;fOSMac: &quot;  + fOSMac);</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineminus">-    logComment(&quot;fOSWin: &quot;  + fOSWin);</span>
<a href="#l20.99"></a><span id="l20.99" class="difflineminus">-</span>
<a href="#l20.100"></a><span id="l20.100" class="difflineminus">-    if(fOSMac != null)</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineminus">-      platformNode = 'mac';</span>
<a href="#l20.102"></a><span id="l20.102" class="difflineminus">-    else if(fOSWin != null)</span>
<a href="#l20.103"></a><span id="l20.103" class="difflineminus">-      platformNode = 'win';</span>
<a href="#l20.104"></a><span id="l20.104" class="difflineminus">-    else</span>
<a href="#l20.105"></a><span id="l20.105" class="difflineminus">-      platformNode = 'unix';</span>
<a href="#l20.106"></a><span id="l20.106" class="difflineminus">-  }</span>
<a href="#l20.107"></a><span id="l20.107" class="difflineminus">-</span>
<a href="#l20.108"></a><span id="l20.108" class="difflineminus">-  return platformNode;</span>
<a href="#l20.109"></a><span id="l20.109" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">deleted file mode 100755</span>
<a href="#l21.2"></a><span id="l21.2">index 095361ac1bdea3fc5877b10379a4dea5c906c7fc..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l21.3"></a><span id="l21.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">deleted file mode 100755</span>
<a href="#l22.2"></a><span id="l22.2">index d33ceb685653be6abccafd947e717afff2116cde..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l22.3"></a><span id="l22.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">deleted file mode 100755</span>
<a href="#l23.2"></a><span id="l23.2">index c89c282e2fd7d5ff452fa99b63a1cf2cfc0c5b3b..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l23.3"></a><span id="l23.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">deleted file mode 100755</span>
<a href="#l24.2"></a><span id="l24.2">index c8fb625a942a5ddb26f680bbe5eb084a0d31174f..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l24.3"></a><span id="l24.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1">deleted file mode 100755</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineminus">--- a/mailnews/extensions/palmsync/conduit/resource.h</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineplus">+++ /dev/null</span>
<a href="#l25.4"></a><span id="l25.4" class="difflineat">@@ -1,41 +0,0 @@</span>
<a href="#l25.5"></a><span id="l25.5" class="difflineminus">-//{{NO_DEPENDENCIES}}</span>
<a href="#l25.6"></a><span id="l25.6" class="difflineminus">-// Microsoft Developer Studio generated include file.</span>
<a href="#l25.7"></a><span id="l25.7" class="difflineminus">-// Used by MozABConduitGenCond.rc</span>
<a href="#l25.8"></a><span id="l25.8" class="difflineminus">-//</span>
<a href="#l25.9"></a><span id="l25.9" class="difflineminus">-#define IDS_CONDUIT_NAME                1</span>
<a href="#l25.10"></a><span id="l25.10" class="difflineminus">-#define IDB_HHTOPC                      102</span>
<a href="#l25.11"></a><span id="l25.11" class="difflineminus">-#define IDB_SYNC                        103</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-#define IDB_DONOTHING                   104</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-#define IDB_PCTOHH                      105</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-#define IDD_CONDUIT_ACTION              399</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-#define IDC_ACTIONGROUPBOXTEXT          403</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineminus">-#define IDC_RADIO_SYNC                  404</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineminus">-#define IDC_RADIO_PCTOHH                405</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineminus">-#define IDC_RADIO_HHTOPC                406</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineminus">-#define IDC_RADIO_DONOTHING             407</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineminus">-#define IDC_MAKEDEFAULT                 411</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineminus">-#define IDC_SYNC                        1000</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineminus">-#define IDC_DONOTHING                   1001</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineminus">-#define IDC_STATIC_PERMANENT            1002</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineminus">-#define IDC_STATIC_TEMPORARY            1003</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineminus">-#define IDC_CURRENT_SETTINGS_GROUP      1004</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineminus">-#define IDC_PCTOHH                      1005</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineminus">-#define IDC_HHTOPC                      1006</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineminus">-#define IDS_CONNECTION                  3311</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineminus">-#define IDS_CURRENT_SETTINGS_GROUP      8004</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineminus">-#define IDS_SYNC_FILES                  8005</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-#define IDS_DO_NOTHING                  8006</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">-#define IDS_PCTOHH                      8007</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineminus">-#define IDS_HHTOPC                      8008</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineminus">-#define IDS_SYNC_ACTION_TEXT            8009</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineminus">-</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineminus">-// Next default values for new objects</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineminus">-// </span>
<a href="#l25.38"></a><span id="l25.38" class="difflineminus">-#ifdef APSTUDIO_INVOKED</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineminus">-#ifndef APSTUDIO_READONLY_SYMBOLS</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineminus">-#define _APS_NEXT_RESOURCE_VALUE        106</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineminus">-#define _APS_NEXT_COMMAND_VALUE         40001</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineminus">-#define _APS_NEXT_CONTROL_VALUE         1000</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineminus">-#define _APS_NEXT_SYMED_VALUE           101</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineminus">-#endif</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineminus">-#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1">deleted file mode 100644</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineminus">--- a/mailnews/extensions/palmsync/install.rdf</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineplus">+++ /dev/null</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineat">@@ -1,34 +0,0 @@</span>
<a href="#l26.5"></a><span id="l26.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l26.6"></a><span id="l26.6" class="difflineminus">-</span>
<a href="#l26.7"></a><span id="l26.7" class="difflineminus">-#filter substitution</span>
<a href="#l26.8"></a><span id="l26.8" class="difflineminus">-</span>
<a href="#l26.9"></a><span id="l26.9" class="difflineminus">-&lt;RDF xmlns=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l26.10"></a><span id="l26.10" class="difflineminus">-     xmlns:em=&quot;http://www.mozilla.org/2004/em-rdf#&quot;&gt;</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineminus">-  &lt;Description about=&quot;urn:mozilla:install-manifest&quot;&gt;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-    &lt;em:id&gt;@INSTALL_EXTENSION_ID@&lt;/em:id&gt;  </span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-    &lt;em:version&gt;@EXTENSION_VERSION@&lt;/em:version&gt;</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">-    &lt;em:targetApplication&gt;</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineminus">-      &lt;!-- Thunderbird --&gt;</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineminus">-      &lt;Description&gt;</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineminus">-        &lt;em:id&gt;{3550f703-e582-4d05-9a08-453d09bdfdc6}&lt;/em:id&gt;</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineminus">-        &lt;em:minVersion&gt;@THUNDERBIRD_VERSION@&lt;/em:minVersion&gt;</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineminus">-        &lt;em:maxVersion&gt;@THUNDERBIRD_VERSION@&lt;/em:maxVersion&gt;</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineminus">-      &lt;/Description&gt;</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineminus">-    &lt;/em:targetApplication&gt;</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineminus">-    </span>
<a href="#l26.24"></a><span id="l26.24" class="difflineminus">-    &lt;em:targetApplication&gt;</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineminus">-      &lt;!-- SeaMonkey --&gt;</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineminus">-      &lt;Description&gt;</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineminus">-        &lt;em:id&gt;{92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a}&lt;/em:id&gt;</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineminus">-        &lt;em:minVersion&gt;@SEAMONKEY_VERSION@&lt;/em:minVersion&gt;</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineminus">-        &lt;em:maxVersion&gt;@SEAMONKEY_VERSION@&lt;/em:maxVersion&gt;</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-      &lt;/Description&gt;</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-    &lt;/em:targetApplication&gt;</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">-    </span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">-    &lt;em:name&gt;Palm Sync&lt;/em:name&gt;</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineminus">-    &lt;em:description&gt;Palm address book synchronization.&lt;/em:description&gt;</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">-    &lt;em:creator&gt;Team Thunderbird&lt;/em:creator&gt;</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineminus">-    &lt;em:homepageURL&gt;http://kb.mozillazine.org/PalmSync_-_Thunderbird&lt;/em:homepageURL&gt;</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineminus">-  &lt;/Description&gt;</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineminus">-&lt;/RDF&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1">deleted file mode 100644</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineminus">--- a/mailnews/extensions/palmsync/installer/Makefile.in</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineplus">+++ /dev/null</span>
<a href="#l27.4"></a><span id="l27.4" class="difflineat">@@ -1,65 +0,0 @@</span>
<a href="#l27.5"></a><span id="l27.5" class="difflineminus">-#</span>
<a href="#l27.6"></a><span id="l27.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l27.7"></a><span id="l27.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l27.8"></a><span id="l27.8" class="difflineminus">-#</span>
<a href="#l27.9"></a><span id="l27.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l27.10"></a><span id="l27.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l27.11"></a><span id="l27.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-#</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineminus">-# License.</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineminus">-#</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineminus">-#</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineminus">-#</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineminus">-#</span>
<a href="#l27.28"></a><span id="l27.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineminus">-#</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineminus">-</span>
<a href="#l27.42"></a><span id="l27.42" class="difflineminus">-DEPTH		= ../../../..</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineminus">-topsrcdir	= @top_srcdir@</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineminus">-srcdir		= @srcdir@</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineminus">-VPATH		= @srcdir@</span>
<a href="#l27.46"></a><span id="l27.46" class="difflineminus">-</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineminus">-PALM_CDK_INC	= $(PALM_CDK_DIR)/C++/Include</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineminus">-</span>
<a href="#l27.49"></a><span id="l27.49" class="difflineminus">-include $(DEPTH)/config/autoconf.mk</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineminus">-</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineminus">-XPI_NAME               = palmsync</span>
<a href="#l27.52"></a><span id="l27.52" class="difflineminus">-USE_EXTENSION_MANIFEST = 1</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineminus">-# make this id as short as possible due to a bug with the palm deskop and long path names.</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineminus">-# Change /mailnews/extensions/palmsync/Makefile.in and nsPalmSyncSupport.cpp if this changes.</span>
<a href="#l27.55"></a><span id="l27.55" class="difflineminus">-INSTALL_EXTENSION_ID   = p@m</span>
<a href="#l27.56"></a><span id="l27.56" class="difflineminus">-XPI_PKGNAME            = palmsync-$(MOZ_APP_VERSION)</span>
<a href="#l27.57"></a><span id="l27.57" class="difflineminus">-</span>
<a href="#l27.58"></a><span id="l27.58" class="difflineminus">-PROGRAM		= PalmSyncInstall$(BIN_SUFFIX)</span>
<a href="#l27.59"></a><span id="l27.59" class="difflineminus">-RESFILE		= PalmSyncInstall.res</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineminus">-USE_STATIC_LIBS = 1</span>
<a href="#l27.61"></a><span id="l27.61" class="difflineminus">-</span>
<a href="#l27.62"></a><span id="l27.62" class="difflineminus">-LOCAL_INCLUDES += -I$(PALM_CDK_INC) \</span>
<a href="#l27.63"></a><span id="l27.63" class="difflineminus">-		   $(NULL)</span>
<a href="#l27.64"></a><span id="l27.64" class="difflineminus">-</span>
<a href="#l27.65"></a><span id="l27.65" class="difflineminus">-CPPSRCS		= PalmSyncInstall.cpp</span>
<a href="#l27.66"></a><span id="l27.66" class="difflineminus">-</span>
<a href="#l27.67"></a><span id="l27.67" class="difflineminus">-include $(topsrcdir)/config/rules.mk</span>
<a href="#l27.68"></a><span id="l27.68" class="difflineminus">-</span>
<a href="#l27.69"></a><span id="l27.69" class="difflineminus">-LDFLAGS		+= /SUBSYSTEM:WINDOWS /MACHINE:i386</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1">deleted file mode 100644</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineminus">--- a/mailnews/extensions/palmsync/installer/PalmSyncInstall.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineplus">+++ /dev/null</span>
<a href="#l28.4"></a><span id="l28.4" class="difflineat">@@ -1,844 +0,0 @@</span>
<a href="#l28.5"></a><span id="l28.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l28.6"></a><span id="l28.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l28.7"></a><span id="l28.7" class="difflineminus">- *</span>
<a href="#l28.8"></a><span id="l28.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l28.9"></a><span id="l28.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l28.10"></a><span id="l28.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l28.11"></a><span id="l28.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">- *</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineminus">- * License.</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">- *</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineminus">- *</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineminus">- *</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineminus">- *</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineminus">- *    Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineminus">- *		David Bienvenu &lt;bienvenu@nventure.com&gt;</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineminus">- *</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineminus">- *</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineminus">-</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineminus">-#include &lt;io.h&gt;</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineminus">-#include &lt;stdlib.h&gt;</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineminus">-#include &lt;stdio.h&gt;</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineminus">-#include &lt;tchar.h&gt;</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineminus">-#include &lt;Winreg.h&gt;</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineminus">-</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineminus">-#include &quot;CondMgr.h&quot;</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineminus">-#include &quot;HSAPI.h&quot;</span>
<a href="#l28.53"></a><span id="l28.53" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineminus">-</span>
<a href="#l28.55"></a><span id="l28.55" class="difflineminus">-#define MOZ_PALMSYNC_PROXY      &quot;.\\PalmSyncProxy.dll&quot;</span>
<a href="#l28.56"></a><span id="l28.56" class="difflineminus">-#define CREATOR                  &quot;addr&quot;</span>
<a href="#l28.57"></a><span id="l28.57" class="difflineminus">-#define CONDUIT_FILENAME         &quot;mozABConduit.dll&quot;</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">-#define REMOTE_DB                &quot;AddressDB&quot;</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineminus">-#define CONDUIT_NAME             &quot;address&quot;</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineminus">-#define CONDUIT_PRIORITY         2</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineminus">-</span>
<a href="#l28.62"></a><span id="l28.62" class="difflineminus">-#define CONDMGR_FILENAME         &quot;CondMgr.dll&quot;</span>
<a href="#l28.63"></a><span id="l28.63" class="difflineminus">-#define HSAPI_FILENAME           &quot;HsApi.dll&quot;</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineminus">-#define DIRECTORY_SEPARATOR      '\\'</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineminus">-#define DIRECTORY_SEPARATOR_STR  &quot;\\&quot;</span>
<a href="#l28.66"></a><span id="l28.66" class="difflineminus">-#define EXECUTABLE_EXTENSION     &quot;.exe&quot;</span>
<a href="#l28.67"></a><span id="l28.67" class="difflineminus">-#define HOTSYNC_MAX_WAIT         30         // wait for HotSync to start/stop in seconds</span>
<a href="#l28.68"></a><span id="l28.68" class="difflineminus">-</span>
<a href="#l28.69"></a><span id="l28.69" class="difflineminus">-#define MAX_LOADSTRING 256</span>
<a href="#l28.70"></a><span id="l28.70" class="difflineminus">-</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineminus">-// Define any Conduit Manager function pointer types</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineminus">-typedef int (WINAPI *CmGetCorePathPtr)(TCHAR *pPath, int *piSize);</span>
<a href="#l28.73"></a><span id="l28.73" class="difflineminus">-typedef int (WINAPI *CmGetHotSyncExecPathPtr)(char *szPath, int *iSize);</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineminus">-</span>
<a href="#l28.75"></a><span id="l28.75" class="difflineminus">-typedef int (WINAPI *CmInstallCreatorPtr)(const char *pCreator, int iType);</span>
<a href="#l28.76"></a><span id="l28.76" class="difflineminus">-typedef int (WINAPI *CmRemoveConduitByCreatorIDPtr)(const char *pCreator);</span>
<a href="#l28.77"></a><span id="l28.77" class="difflineminus">-typedef int (WINAPI *CmRestoreHotSyncSettingsPtr)(BOOL bToDefaults);</span>
<a href="#l28.78"></a><span id="l28.78" class="difflineminus">-typedef int (WINAPI *CmSetCreatorRemotePtr)(const char *pCreator, const TCHAR *pRemote);</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineminus">-typedef int (WINAPI *CmSetCreatorNamePtr)(const char *pCreator, const TCHAR *pConduitName);</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineminus">-typedef int (WINAPI *CmSetCreatorTitlePtr)(const char *pCreator, const TCHAR *pConduitTitle);</span>
<a href="#l28.81"></a><span id="l28.81" class="difflineminus">-typedef int (WINAPI *CmSetCreatorFilePtr)(const char *pCreator, const TCHAR *pConduitFile);</span>
<a href="#l28.82"></a><span id="l28.82" class="difflineminus">-typedef int (WINAPI *CmSetCreatorDirectoryPtr)(const char *pCreator, const TCHAR *pConduitDirectory);</span>
<a href="#l28.83"></a><span id="l28.83" class="difflineminus">-</span>
<a href="#l28.84"></a><span id="l28.84" class="difflineminus">-typedef int (WINAPI *CmSetCreatorPriorityPtr)(const char *pCreator, DWORD dwPriority);</span>
<a href="#l28.85"></a><span id="l28.85" class="difflineminus">-typedef int (WINAPI *CmSetCreatorIntegratePtr)(const char *pCreator, DWORD dwIntegrate);</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineminus">-typedef int (WINAPI *CmSetCreatorValueDwordPtr)(const char *pCreator, TCHAR *pValue, DWORD dwValue);</span>
<a href="#l28.87"></a><span id="l28.87" class="difflineminus">-typedef int (WINAPI *CmSetCreatorValueStringPtr)(const char *pCreator, TCHAR *pValueName, TCHAR *value);</span>
<a href="#l28.88"></a><span id="l28.88" class="difflineminus">-typedef int (WINAPI *CmSetCorePathPtr) (const char *pPath);</span>
<a href="#l28.89"></a><span id="l28.89" class="difflineminus">-typedef int (WINAPI *CmSetHotSyncExePathPtr) (const char *pPath);</span>
<a href="#l28.90"></a><span id="l28.90" class="difflineminus">-typedef int (WINAPI *CmSetCreatorModulePtr) (const char *pCreatorID, const TCHAR *pModule);</span>
<a href="#l28.91"></a><span id="l28.91" class="difflineminus">-</span>
<a href="#l28.92"></a><span id="l28.92" class="difflineminus">-typedef int (WINAPI *CmGetCreatorNamePtr)(const char *pCreator, TCHAR *pConduitName, int *pSize);</span>
<a href="#l28.93"></a><span id="l28.93" class="difflineminus">-typedef int (WINAPI *CmGetCreatorTitlePtr)(const char *pCreator, TCHAR *pConduitTitle, int *pSize);</span>
<a href="#l28.94"></a><span id="l28.94" class="difflineminus">-typedef int (WINAPI *CmGetCreatorPriorityPtr)(const char *pCreator, DWORD *dwPriority);</span>
<a href="#l28.95"></a><span id="l28.95" class="difflineminus">-typedef int (WINAPI *CmGetCreatorTypePtr)(const char *pCreator);</span>
<a href="#l28.96"></a><span id="l28.96" class="difflineminus">-typedef int (WINAPI *CmGetCreatorIntegratePtr)(const char *pCreator, DWORD *dwIntegrate);</span>
<a href="#l28.97"></a><span id="l28.97" class="difflineminus">-typedef int (WINAPI *CmGetCreatorValueDwordPtr)(const char *pCreator, TCHAR *pValueName, DWORD dwValue, DWORD dwDefault);</span>
<a href="#l28.98"></a><span id="l28.98" class="difflineminus">-typedef int (WINAPI *CmGetCreatorValueStringPtr)(const char *pCreator, TCHAR *pValueName, TCHAR *pValue, int *pSize, TCHAR *pDefault);</span>
<a href="#l28.99"></a><span id="l28.99" class="difflineminus">-typedef int (WINAPI *CmGetCreatorFilePtr) (const TCHAR *pCreatorID, TCHAR *pFile, int *piSize);</span>
<a href="#l28.100"></a><span id="l28.100" class="difflineminus">-typedef int (WINAPI *CmGetCreatorDirectoryPtr) (const TCHAR *pCreatorID, TCHAR *pFile, int *piSize);</span>
<a href="#l28.101"></a><span id="l28.101" class="difflineminus">-typedef int (WINAPI *CmGetCreatorModulePtr) (const char *pCreatorID, TCHAR *pModule, int *piSize);</span>
<a href="#l28.102"></a><span id="l28.102" class="difflineminus">-typedef int (WINAPI *CmGetCreatorRemotePtr)(const char *pCreator, const TCHAR *pRemote, int*pSize);</span>
<a href="#l28.103"></a><span id="l28.103" class="difflineminus">-</span>
<a href="#l28.104"></a><span id="l28.104" class="difflineminus">-// Define any HSAPI function pointer types</span>
<a href="#l28.105"></a><span id="l28.105" class="difflineminus">-typedef int (WINAPI *HsCheckApiStatusPtr)(void);</span>
<a href="#l28.106"></a><span id="l28.106" class="difflineminus">-typedef int (WINAPI *HsGetSyncStatusPtr)(DWORD *dwStatus);</span>
<a href="#l28.107"></a><span id="l28.107" class="difflineminus">-typedef int (WINAPI *HsSetAppStatusPtr)(HsStatusType statusType, DWORD dwStartFlags);</span>
<a href="#l28.108"></a><span id="l28.108" class="difflineminus">-</span>
<a href="#l28.109"></a><span id="l28.109" class="difflineminus">-// Define general registration fn pointer types</span>
<a href="#l28.110"></a><span id="l28.110" class="difflineminus">-typedef int (WINAPI *mozDllRegisterServerPtr)(void);</span>
<a href="#l28.111"></a><span id="l28.111" class="difflineminus">-typedef int (WINAPI *mozDllUnregisterServerPtr)(void);</span>
<a href="#l28.112"></a><span id="l28.112" class="difflineminus">-</span>
<a href="#l28.113"></a><span id="l28.113" class="difflineminus">-// forward declaration</span>
<a href="#l28.114"></a><span id="l28.114" class="difflineminus">-int  InstallConduit(HINSTANCE hInstance, TCHAR *installPath, TCHAR *appName);</span>
<a href="#l28.115"></a><span id="l28.115" class="difflineminus">-int UninstallConduit();</span>
<a href="#l28.116"></a><span id="l28.116" class="difflineminus">-void ConstructMessage(HINSTANCE hInstance, TCHAR *appName, DWORD dwMessageId, TCHAR *formattedMsg);</span>
<a href="#l28.117"></a><span id="l28.117" class="difflineminus">-</span>
<a href="#l28.118"></a><span id="l28.118" class="difflineminus">-// Global vars</span>
<a href="#l28.119"></a><span id="l28.119" class="difflineminus">-BOOL    gWasHotSyncRunning = FALSE;</span>
<a href="#l28.120"></a><span id="l28.120" class="difflineminus">-</span>
<a href="#l28.121"></a><span id="l28.121" class="difflineminus">-void ConstructMessage(HINSTANCE hInstance, TCHAR *appName, DWORD dwMessageId, TCHAR *formattedMsg)</span>
<a href="#l28.122"></a><span id="l28.122" class="difflineminus">-{</span>
<a href="#l28.123"></a><span id="l28.123" class="difflineminus">-  // Load brand name and the format string.</span>
<a href="#l28.124"></a><span id="l28.124" class="difflineminus">-  TCHAR formatString[MAX_LOADSTRING];</span>
<a href="#l28.125"></a><span id="l28.125" class="difflineminus">-  LoadString(hInstance, dwMessageId, formatString, MAX_LOADSTRING-1);</span>
<a href="#l28.126"></a><span id="l28.126" class="difflineminus">-</span>
<a href="#l28.127"></a><span id="l28.127" class="difflineminus">-  // A few msgs needs two app name substitutions.</span>
<a href="#l28.128"></a><span id="l28.128" class="difflineminus">-  if ((dwMessageId == IDS_SUCCESS_INSTALL) ||</span>
<a href="#l28.129"></a><span id="l28.129" class="difflineminus">-      (dwMessageId == IDS_CONFIRM_INSTALL))</span>
<a href="#l28.130"></a><span id="l28.130" class="difflineminus">-    _sntprintf(formattedMsg, MAX_LOADSTRING-1, formatString, appName, appName);</span>
<a href="#l28.131"></a><span id="l28.131" class="difflineminus">-  else</span>
<a href="#l28.132"></a><span id="l28.132" class="difflineminus">-    _sntprintf(formattedMsg, MAX_LOADSTRING-1, formatString, appName);</span>
<a href="#l28.133"></a><span id="l28.133" class="difflineminus">-</span>
<a href="#l28.134"></a><span id="l28.134" class="difflineminus">-  formattedMsg[MAX_LOADSTRING-1]='\0';</span>
<a href="#l28.135"></a><span id="l28.135" class="difflineminus">-}</span>
<a href="#l28.136"></a><span id="l28.136" class="difflineminus">-</span>
<a href="#l28.137"></a><span id="l28.137" class="difflineminus">-int APIENTRY WinMain(HINSTANCE hInstance,</span>
<a href="#l28.138"></a><span id="l28.138" class="difflineminus">-                     HINSTANCE hPrevInstance,</span>
<a href="#l28.139"></a><span id="l28.139" class="difflineminus">-                     LPSTR     lpCmdLine,</span>
<a href="#l28.140"></a><span id="l28.140" class="difflineminus">-                     int       nCmdShow)</span>
<a href="#l28.141"></a><span id="l28.141" class="difflineminus">-{</span>
<a href="#l28.142"></a><span id="l28.142" class="difflineminus">-  TCHAR appTitle[MAX_LOADSTRING];</span>
<a href="#l28.143"></a><span id="l28.143" class="difflineminus">-  TCHAR appName[MAX_LOADSTRING] = {0};</span>
<a href="#l28.144"></a><span id="l28.144" class="difflineminus">-  TCHAR msgStr[MAX_LOADSTRING];</span>
<a href="#l28.145"></a><span id="l28.145" class="difflineminus">-</span>
<a href="#l28.146"></a><span id="l28.146" class="difflineminus">-  enum eActionType</span>
<a href="#l28.147"></a><span id="l28.147" class="difflineminus">-  {</span>
<a href="#l28.148"></a><span id="l28.148" class="difflineminus">-    eInstall,</span>
<a href="#l28.149"></a><span id="l28.149" class="difflineminus">-    eSilentInstall,</span>
<a href="#l28.150"></a><span id="l28.150" class="difflineminus">-    eUninstall,</span>
<a href="#l28.151"></a><span id="l28.151" class="difflineminus">-    eSilentUninstall</span>
<a href="#l28.152"></a><span id="l28.152" class="difflineminus">-  };</span>
<a href="#l28.153"></a><span id="l28.153" class="difflineminus">-</span>
<a href="#l28.154"></a><span id="l28.154" class="difflineminus">-  int res = -1;</span>
<a href="#l28.155"></a><span id="l28.155" class="difflineminus">-</span>
<a href="#l28.156"></a><span id="l28.156" class="difflineminus">-  char* installDir = NULL;</span>
<a href="#l28.157"></a><span id="l28.157" class="difflineminus">-  eActionType action = eInstall;</span>
<a href="#l28.158"></a><span id="l28.158" class="difflineminus">-</span>
<a href="#l28.159"></a><span id="l28.159" class="difflineminus">-  if (__argc &gt; 1)</span>
<a href="#l28.160"></a><span id="l28.160" class="difflineminus">-  {</span>
<a href="#l28.161"></a><span id="l28.161" class="difflineminus">-    char* arg;</span>
<a href="#l28.162"></a><span id="l28.162" class="difflineminus">-    // Skip the first arg</span>
<a href="#l28.163"></a><span id="l28.163" class="difflineminus">-    for (int i = 1; i &lt; __argc; ++i)</span>
<a href="#l28.164"></a><span id="l28.164" class="difflineminus">-    {</span>
<a href="#l28.165"></a><span id="l28.165" class="difflineminus">-      // The calling's app brand name</span>
<a href="#l28.166"></a><span id="l28.166" class="difflineminus">-      arg = strstr(__argv[i], &quot;/n&quot;);</span>
<a href="#l28.167"></a><span id="l28.167" class="difflineminus">-      if (arg)</span>
<a href="#l28.168"></a><span id="l28.168" class="difflineminus">-      {</span>
<a href="#l28.169"></a><span id="l28.169" class="difflineminus">-        // advance pass app name</span>
<a href="#l28.170"></a><span id="l28.170" class="difflineminus">-        arg += 2;</span>
<a href="#l28.171"></a><span id="l28.171" class="difflineminus">-</span>
<a href="#l28.172"></a><span id="l28.172" class="difflineminus">-        // now get the name</span>
<a href="#l28.173"></a><span id="l28.173" class="difflineminus">-        strncpy(appName, arg, MAX_LOADSTRING - 1);</span>
<a href="#l28.174"></a><span id="l28.174" class="difflineminus">-</span>
<a href="#l28.175"></a><span id="l28.175" class="difflineminus">-        // Add a space onto the name so that we get the display right</span>
<a href="#l28.176"></a><span id="l28.176" class="difflineminus">-        strcat(appName, &quot; &quot;);</span>
<a href="#l28.177"></a><span id="l28.177" class="difflineminus">-      }</span>
<a href="#l28.178"></a><span id="l28.178" class="difflineminus">-      else</span>
<a href="#l28.179"></a><span id="l28.179" class="difflineminus">-      {</span>
<a href="#l28.180"></a><span id="l28.180" class="difflineminus">-        // /p can only be used with a standard install,</span>
<a href="#l28.181"></a><span id="l28.181" class="difflineminus">-        // i.e., non-silent install</span>
<a href="#l28.182"></a><span id="l28.182" class="difflineminus">-        arg = strstr(__argv[i], &quot;/p&quot;);</span>
<a href="#l28.183"></a><span id="l28.183" class="difflineminus">-        if (arg)</span>
<a href="#l28.184"></a><span id="l28.184" class="difflineminus">-          // move past the /p, default action is install.</span>
<a href="#l28.185"></a><span id="l28.185" class="difflineminus">-          installDir = arg + 2;</span>
<a href="#l28.186"></a><span id="l28.186" class="difflineminus">-        else if (!strcmpi(__argv[i], &quot;/u&quot;))</span>
<a href="#l28.187"></a><span id="l28.187" class="difflineminus">-          action = eUninstall;</span>
<a href="#l28.188"></a><span id="l28.188" class="difflineminus">-        else if (!strcmpi(__argv[i], &quot;/us&quot;))</span>
<a href="#l28.189"></a><span id="l28.189" class="difflineminus">-          action = eSilentUninstall;</span>
<a href="#l28.190"></a><span id="l28.190" class="difflineminus">-        else if (!strcmpi(__argv[i], &quot;/s&quot;))</span>
<a href="#l28.191"></a><span id="l28.191" class="difflineminus">-          action = eSilentInstall;</span>
<a href="#l28.192"></a><span id="l28.192" class="difflineminus">-      }</span>
<a href="#l28.193"></a><span id="l28.193" class="difflineminus">-    }</span>
<a href="#l28.194"></a><span id="l28.194" class="difflineminus">-  }</span>
<a href="#l28.195"></a><span id="l28.195" class="difflineminus">-</span>
<a href="#l28.196"></a><span id="l28.196" class="difflineminus">-  // Free the command line memory</span>
<a href="#l28.197"></a><span id="l28.197" class="difflineminus">-  LocalFree(__argv);</span>
<a href="#l28.198"></a><span id="l28.198" class="difflineminus">-</span>
<a href="#l28.199"></a><span id="l28.199" class="difflineminus">-  switch (action)</span>
<a href="#l28.200"></a><span id="l28.200" class="difflineminus">-  {</span>
<a href="#l28.201"></a><span id="l28.201" class="difflineminus">-  case eInstall:</span>
<a href="#l28.202"></a><span id="l28.202" class="difflineminus">-    ConstructMessage(hInstance, appName, IDS_APP_TITLE_INSTALL, appTitle);</span>
<a href="#l28.203"></a><span id="l28.203" class="difflineminus">-    ConstructMessage(hInstance, appName, IDS_CONFIRM_INSTALL, msgStr);</span>
<a href="#l28.204"></a><span id="l28.204" class="difflineminus">-</span>
<a href="#l28.205"></a><span id="l28.205" class="difflineminus">-    if (MessageBox(NULL, msgStr, appTitle, MB_YESNO | MB_TOPMOST) == IDYES) </span>
<a href="#l28.206"></a><span id="l28.206" class="difflineminus">-    {</span>
<a href="#l28.207"></a><span id="l28.207" class="difflineminus">-      res = InstallConduit(hInstance, installDir, appName);</span>
<a href="#l28.208"></a><span id="l28.208" class="difflineminus">-      if (!res)</span>
<a href="#l28.209"></a><span id="l28.209" class="difflineminus">-        res = IDS_SUCCESS_INSTALL;</span>
<a href="#l28.210"></a><span id="l28.210" class="difflineminus">-    }</span>
<a href="#l28.211"></a><span id="l28.211" class="difflineminus">-    else</span>
<a href="#l28.212"></a><span id="l28.212" class="difflineminus">-      return 0;</span>
<a href="#l28.213"></a><span id="l28.213" class="difflineminus">-    break;</span>
<a href="#l28.214"></a><span id="l28.214" class="difflineminus">-</span>
<a href="#l28.215"></a><span id="l28.215" class="difflineminus">-  case eSilentInstall:</span>
<a href="#l28.216"></a><span id="l28.216" class="difflineminus">-    return InstallConduit(hInstance, installDir, appName);</span>
<a href="#l28.217"></a><span id="l28.217" class="difflineminus">-</span>
<a href="#l28.218"></a><span id="l28.218" class="difflineminus">-  case eUninstall:</span>
<a href="#l28.219"></a><span id="l28.219" class="difflineminus">-    ConstructMessage(hInstance, appName, IDS_APP_TITLE_UNINSTALL, appTitle);</span>
<a href="#l28.220"></a><span id="l28.220" class="difflineminus">-    ConstructMessage(hInstance, appName, IDS_CONFIRM_UNINSTALL, msgStr);</span>
<a href="#l28.221"></a><span id="l28.221" class="difflineminus">-</span>
<a href="#l28.222"></a><span id="l28.222" class="difflineminus">-    if (MessageBox(NULL, msgStr, appTitle, MB_YESNO) == IDYES) </span>
<a href="#l28.223"></a><span id="l28.223" class="difflineminus">-    {</span>
<a href="#l28.224"></a><span id="l28.224" class="difflineminus">-      res = UninstallConduit();</span>
<a href="#l28.225"></a><span id="l28.225" class="difflineminus">-      if (!res)</span>
<a href="#l28.226"></a><span id="l28.226" class="difflineminus">-        res = IDS_SUCCESS_UNINSTALL;</span>
<a href="#l28.227"></a><span id="l28.227" class="difflineminus">-      break;</span>
<a href="#l28.228"></a><span id="l28.228" class="difflineminus">-    }</span>
<a href="#l28.229"></a><span id="l28.229" class="difflineminus">-    else</span>
<a href="#l28.230"></a><span id="l28.230" class="difflineminus">-      return 0;</span>
<a href="#l28.231"></a><span id="l28.231" class="difflineminus">-</span>
<a href="#l28.232"></a><span id="l28.232" class="difflineminus">-  case eSilentUninstall:</span>
<a href="#l28.233"></a><span id="l28.233" class="difflineminus">-    return UninstallConduit();</span>
<a href="#l28.234"></a><span id="l28.234" class="difflineminus">-  }</span>
<a href="#l28.235"></a><span id="l28.235" class="difflineminus">-</span>
<a href="#l28.236"></a><span id="l28.236" class="difflineminus">-  if (res &gt; IDS_ERR_MAX || res &lt; IDS_ERR_GENERAL)</span>
<a href="#l28.237"></a><span id="l28.237" class="difflineminus">-     res = IDS_ERR_GENERAL;</span>
<a href="#l28.238"></a><span id="l28.238" class="difflineminus">-</span>
<a href="#l28.239"></a><span id="l28.239" class="difflineminus">-  ConstructMessage(hInstance, appName, res, msgStr);</span>
<a href="#l28.240"></a><span id="l28.240" class="difflineminus">-  MessageBox(NULL, msgStr, appTitle, MB_OK);</span>
<a href="#l28.241"></a><span id="l28.241" class="difflineminus">-</span>
<a href="#l28.242"></a><span id="l28.242" class="difflineminus">-  return 0;</span>
<a href="#l28.243"></a><span id="l28.243" class="difflineminus">-}</span>
<a href="#l28.244"></a><span id="l28.244" class="difflineminus">-</span>
<a href="#l28.245"></a><span id="l28.245" class="difflineminus">-// this function gets the install dir for installation</span>
<a href="#l28.246"></a><span id="l28.246" class="difflineminus">-int GetPalmDesktopInstallDirectory(TCHAR *pPDInstallDirectory, unsigned long *pSize)</span>
<a href="#l28.247"></a><span id="l28.247" class="difflineminus">-{</span>
<a href="#l28.248"></a><span id="l28.248" class="difflineminus">-    HKEY   key;</span>
<a href="#l28.249"></a><span id="l28.249" class="difflineminus">-    // open the key</span>
<a href="#l28.250"></a><span id="l28.250" class="difflineminus">-    LONG rc = ::RegOpenKey(HKEY_CURRENT_USER, &quot;Software\\U.S. Robotics\\Pilot Desktop\\Core&quot;, &amp;key);</span>
<a href="#l28.251"></a><span id="l28.251" class="difflineminus">-    if (rc == ERROR_SUCCESS) {</span>
<a href="#l28.252"></a><span id="l28.252" class="difflineminus">-        // get key value</span>
<a href="#l28.253"></a><span id="l28.253" class="difflineminus">-        rc = ::RegQueryValueEx(key, &quot;Path&quot;, NULL, NULL, </span>
<a href="#l28.254"></a><span id="l28.254" class="difflineminus">-                               (LPBYTE)pPDInstallDirectory, pSize);</span>
<a href="#l28.255"></a><span id="l28.255" class="difflineminus">-        if (rc == ERROR_SUCCESS) {</span>
<a href="#l28.256"></a><span id="l28.256" class="difflineminus">-            *pSize = _tcslen(pPDInstallDirectory); // windows only</span>
<a href="#l28.257"></a><span id="l28.257" class="difflineminus">-            rc=0; // 0 is success for us</span>
<a href="#l28.258"></a><span id="l28.258" class="difflineminus">-        }</span>
<a href="#l28.259"></a><span id="l28.259" class="difflineminus">-        // close the key</span>
<a href="#l28.260"></a><span id="l28.260" class="difflineminus">-        ::RegCloseKey(key);</span>
<a href="#l28.261"></a><span id="l28.261" class="difflineminus">-    }</span>
<a href="#l28.262"></a><span id="l28.262" class="difflineminus">-</span>
<a href="#l28.263"></a><span id="l28.263" class="difflineminus">-    if(rc) {</span>
<a href="#l28.264"></a><span id="l28.264" class="difflineminus">-        HKEY   key2;</span>
<a href="#l28.265"></a><span id="l28.265" class="difflineminus">-        // open the key</span>
<a href="#l28.266"></a><span id="l28.266" class="difflineminus">-        rc = ::RegOpenKey(HKEY_LOCAL_MACHINE, &quot;Software\\Microsoft\\Windows\\CurrentVersion\\App Paths\\palm.exe&quot;, &amp;key2);</span>
<a href="#l28.267"></a><span id="l28.267" class="difflineminus">-        if (rc == ERROR_SUCCESS) {</span>
<a href="#l28.268"></a><span id="l28.268" class="difflineminus">-            // get the default key value</span>
<a href="#l28.269"></a><span id="l28.269" class="difflineminus">-            rc = ::RegQueryValueEx(key2, &quot;&quot;, NULL, NULL, </span>
<a href="#l28.270"></a><span id="l28.270" class="difflineminus">-                                   (LPBYTE)pPDInstallDirectory, pSize);</span>
<a href="#l28.271"></a><span id="l28.271" class="difflineminus">-            // get only the path (ie, strip out the exe name). note that we don't use string match</span>
<a href="#l28.272"></a><span id="l28.272" class="difflineminus">-            // for the exe name here since it's possilbe that the exe name in the default setting</span>
<a href="#l28.273"></a><span id="l28.273" class="difflineminus">-            // is different from the exe name in RegOpenKey() call. For example, the exe name in</span>
<a href="#l28.274"></a><span id="l28.274" class="difflineminus">-            // the default setting for &quot;Software\\...\\App Paths\\pbrush.exe&quot; is mspaint.exe.</span>
<a href="#l28.275"></a><span id="l28.275" class="difflineminus">-            if (rc == ERROR_SUCCESS) {</span>
<a href="#l28.276"></a><span id="l28.276" class="difflineminus">-              TCHAR *end = pPDInstallDirectory + _tcslen(pPDInstallDirectory);</span>
<a href="#l28.277"></a><span id="l28.277" class="difflineminus">-              while ((*end != '\\') &amp;&amp; (end != pPDInstallDirectory))</span>
<a href="#l28.278"></a><span id="l28.278" class="difflineminus">-                end--;</span>
<a href="#l28.279"></a><span id="l28.279" class="difflineminus">-              *end = '\0';</span>
<a href="#l28.280"></a><span id="l28.280" class="difflineminus">-              rc=0; // 0 is success for us</span>
<a href="#l28.281"></a><span id="l28.281" class="difflineminus">-            }</span>
<a href="#l28.282"></a><span id="l28.282" class="difflineminus">-            // close the key</span>
<a href="#l28.283"></a><span id="l28.283" class="difflineminus">-            ::RegCloseKey(key2);</span>
<a href="#l28.284"></a><span id="l28.284" class="difflineminus">-        }</span>
<a href="#l28.285"></a><span id="l28.285" class="difflineminus">-    }</span>
<a href="#l28.286"></a><span id="l28.286" class="difflineminus">-    </span>
<a href="#l28.287"></a><span id="l28.287" class="difflineminus">-    return rc;</span>
<a href="#l28.288"></a><span id="l28.288" class="difflineminus">-}</span>
<a href="#l28.289"></a><span id="l28.289" class="difflineminus">-</span>
<a href="#l28.290"></a><span id="l28.290" class="difflineminus">-// this function loads the Conduit Manager</span>
<a href="#l28.291"></a><span id="l28.291" class="difflineminus">-int LoadConduitManagerDll(HINSTANCE* hCondMgrDll, const TCHAR * szPalmDesktopDirectory)</span>
<a href="#l28.292"></a><span id="l28.292" class="difflineminus">-{</span>
<a href="#l28.293"></a><span id="l28.293" class="difflineminus">-    // Initialize the return value</span>
<a href="#l28.294"></a><span id="l28.294" class="difflineminus">-    *hCondMgrDll=NULL;</span>
<a href="#l28.295"></a><span id="l28.295" class="difflineminus">-    </span>
<a href="#l28.296"></a><span id="l28.296" class="difflineminus">-    // Construct the path of the Palm Desktop Conduit Manager</span>
<a href="#l28.297"></a><span id="l28.297" class="difflineminus">-    TCHAR   szPDCondMgrPath[_MAX_PATH];</span>
<a href="#l28.298"></a><span id="l28.298" class="difflineminus">-    // take care of any possible string overwrites</span>
<a href="#l28.299"></a><span id="l28.299" class="difflineminus">-    if((strlen(szPalmDesktopDirectory) + strlen(DIRECTORY_SEPARATOR_STR) +  strlen(CONDMGR_FILENAME)) &gt;= _MAX_PATH)</span>
<a href="#l28.300"></a><span id="l28.300" class="difflineminus">-        return IDS_ERR_LOADING_CONDMGR;</span>
<a href="#l28.301"></a><span id="l28.301" class="difflineminus">-    strcpy(szPDCondMgrPath, szPalmDesktopDirectory);</span>
<a href="#l28.302"></a><span id="l28.302" class="difflineminus">-    strcat(szPDCondMgrPath, DIRECTORY_SEPARATOR_STR);</span>
<a href="#l28.303"></a><span id="l28.303" class="difflineminus">-    strcat(szPDCondMgrPath, CONDMGR_FILENAME);</span>
<a href="#l28.304"></a><span id="l28.304" class="difflineminus">-    // Load the Conduit Manager library from the Palm Desktop directory</span>
<a href="#l28.305"></a><span id="l28.305" class="difflineminus">-    if( (*hCondMgrDll=LoadLibrary(szPDCondMgrPath)) != NULL )</span>
<a href="#l28.306"></a><span id="l28.306" class="difflineminus">-        // Successfully loaded CondMgr Library from Palm Desktop Directory</span>
<a href="#l28.307"></a><span id="l28.307" class="difflineminus">-    return 0;</span>
<a href="#l28.308"></a><span id="l28.308" class="difflineminus">-</span>
<a href="#l28.309"></a><span id="l28.309" class="difflineminus">-    return IDS_ERR_LOADING_CONDMGR;</span>
<a href="#l28.310"></a><span id="l28.310" class="difflineminus">-}</span>
<a href="#l28.311"></a><span id="l28.311" class="difflineminus">-</span>
<a href="#l28.312"></a><span id="l28.312" class="difflineminus">-// this function loads the Hsapi Dll</span>
<a href="#l28.313"></a><span id="l28.313" class="difflineminus">-int LoadHsapiDll(HINSTANCE* hHsapiDLL, const TCHAR * szPalmDesktopDirectory)</span>
<a href="#l28.314"></a><span id="l28.314" class="difflineminus">-{</span>
<a href="#l28.315"></a><span id="l28.315" class="difflineminus">-    // Initialize the return value</span>
<a href="#l28.316"></a><span id="l28.316" class="difflineminus">-    *hHsapiDLL=NULL;</span>
<a href="#l28.317"></a><span id="l28.317" class="difflineminus">-    </span>
<a href="#l28.318"></a><span id="l28.318" class="difflineminus">-    TCHAR   szHsapiPath[_MAX_PATH];</span>
<a href="#l28.319"></a><span id="l28.319" class="difflineminus">-    // take care of any possible string overwrites</span>
<a href="#l28.320"></a><span id="l28.320" class="difflineminus">-    if((strlen(szPalmDesktopDirectory) + strlen(DIRECTORY_SEPARATOR_STR) +  strlen(HSAPI_FILENAME)) &gt;= _MAX_PATH)</span>
<a href="#l28.321"></a><span id="l28.321" class="difflineminus">-        return IDS_ERR_LOADING_CONDMGR;</span>
<a href="#l28.322"></a><span id="l28.322" class="difflineminus">-    strcpy(szHsapiPath, szPalmDesktopDirectory);</span>
<a href="#l28.323"></a><span id="l28.323" class="difflineminus">-    strcat(szHsapiPath, DIRECTORY_SEPARATOR_STR);</span>
<a href="#l28.324"></a><span id="l28.324" class="difflineminus">-    strcat(szHsapiPath, HSAPI_FILENAME);</span>
<a href="#l28.325"></a><span id="l28.325" class="difflineminus">-    if( (*hHsapiDLL=LoadLibrary(szHsapiPath)) != NULL )</span>
<a href="#l28.326"></a><span id="l28.326" class="difflineminus">-        // Successfully loaded HSAPI Library from Palm Desktop Directory</span>
<a href="#l28.327"></a><span id="l28.327" class="difflineminus">-        return 0;</span>
<a href="#l28.328"></a><span id="l28.328" class="difflineminus">-</span>
<a href="#l28.329"></a><span id="l28.329" class="difflineminus">-    // If we get here, then there was an error loading the library</span>
<a href="#l28.330"></a><span id="l28.330" class="difflineminus">-    return IDS_ERR_HSAPI_NOT_FOUND;</span>
<a href="#l28.331"></a><span id="l28.331" class="difflineminus">-}</span>
<a href="#l28.332"></a><span id="l28.332" class="difflineminus">-</span>
<a href="#l28.333"></a><span id="l28.333" class="difflineminus">-// finds if HotSync Manager is running</span>
<a href="#l28.334"></a><span id="l28.334" class="difflineminus">-BOOL IsHotSyncRunning(HINSTANCE hHsapiDLL)</span>
<a href="#l28.335"></a><span id="l28.335" class="difflineminus">-{</span>
<a href="#l28.336"></a><span id="l28.336" class="difflineminus">-    BOOL    bRetVal = FALSE;</span>
<a href="#l28.337"></a><span id="l28.337" class="difflineminus">-    </span>
<a href="#l28.338"></a><span id="l28.338" class="difflineminus">-    if(!hHsapiDLL)</span>
<a href="#l28.339"></a><span id="l28.339" class="difflineminus">-        return bRetVal;</span>
<a href="#l28.340"></a><span id="l28.340" class="difflineminus">-    </span>
<a href="#l28.341"></a><span id="l28.341" class="difflineminus">-    // Prepare to use the HSAPI functions</span>
<a href="#l28.342"></a><span id="l28.342" class="difflineminus">-    HsCheckApiStatusPtr lpfnHsCheckApiStatus;</span>
<a href="#l28.343"></a><span id="l28.343" class="difflineminus">-    lpfnHsCheckApiStatus = (HsCheckApiStatusPtr) GetProcAddress(hHsapiDLL, &quot;HsCheckApiStatus&quot;);</span>
<a href="#l28.344"></a><span id="l28.344" class="difflineminus">-    </span>
<a href="#l28.345"></a><span id="l28.345" class="difflineminus">-    if( lpfnHsCheckApiStatus )</span>
<a href="#l28.346"></a><span id="l28.346" class="difflineminus">-    {</span>
<a href="#l28.347"></a><span id="l28.347" class="difflineminus">-        if( (*lpfnHsCheckApiStatus)() == 0 )</span>
<a href="#l28.348"></a><span id="l28.348" class="difflineminus">-            bRetVal = TRUE;</span>
<a href="#l28.349"></a><span id="l28.349" class="difflineminus">-    }</span>
<a href="#l28.350"></a><span id="l28.350" class="difflineminus">-    return bRetVal;</span>
<a href="#l28.351"></a><span id="l28.351" class="difflineminus">-}</span>
<a href="#l28.352"></a><span id="l28.352" class="difflineminus">-</span>
<a href="#l28.353"></a><span id="l28.353" class="difflineminus">-// finds if a sync process is going on</span>
<a href="#l28.354"></a><span id="l28.354" class="difflineminus">-BOOL IsHotSyncInProgress(HINSTANCE hHsapiDLL)</span>
<a href="#l28.355"></a><span id="l28.355" class="difflineminus">-{</span>
<a href="#l28.356"></a><span id="l28.356" class="difflineminus">-    DWORD dwStatus;</span>
<a href="#l28.357"></a><span id="l28.357" class="difflineminus">-    </span>
<a href="#l28.358"></a><span id="l28.358" class="difflineminus">-    if(!hHsapiDLL)</span>
<a href="#l28.359"></a><span id="l28.359" class="difflineminus">-        return FALSE;</span>
<a href="#l28.360"></a><span id="l28.360" class="difflineminus">-    </span>
<a href="#l28.361"></a><span id="l28.361" class="difflineminus">-    if(IsHotSyncRunning(hHsapiDLL))</span>
<a href="#l28.362"></a><span id="l28.362" class="difflineminus">-    {</span>
<a href="#l28.363"></a><span id="l28.363" class="difflineminus">-        // Prepare to use the HSAPI functions</span>
<a href="#l28.364"></a><span id="l28.364" class="difflineminus">-        HsGetSyncStatusPtr  lpfnHsGetSyncStatus;</span>
<a href="#l28.365"></a><span id="l28.365" class="difflineminus">-        lpfnHsGetSyncStatus = (HsGetSyncStatusPtr) GetProcAddress(hHsapiDLL, &quot;HsGetSyncStatus&quot;);</span>
<a href="#l28.366"></a><span id="l28.366" class="difflineminus">-    </span>
<a href="#l28.367"></a><span id="l28.367" class="difflineminus">-        if( lpfnHsGetSyncStatus )</span>
<a href="#l28.368"></a><span id="l28.368" class="difflineminus">-        {</span>
<a href="#l28.369"></a><span id="l28.369" class="difflineminus">-            if( (*lpfnHsGetSyncStatus)(&amp;dwStatus) == 0 )</span>
<a href="#l28.370"></a><span id="l28.370" class="difflineminus">-                if( dwStatus == HOTSYNC_STATUS_IDLE )</span>
<a href="#l28.371"></a><span id="l28.371" class="difflineminus">-                    return FALSE;</span>
<a href="#l28.372"></a><span id="l28.372" class="difflineminus">-        }</span>
<a href="#l28.373"></a><span id="l28.373" class="difflineminus">-    }</span>
<a href="#l28.374"></a><span id="l28.374" class="difflineminus">-    return TRUE;</span>
<a href="#l28.375"></a><span id="l28.375" class="difflineminus">-}</span>
<a href="#l28.376"></a><span id="l28.376" class="difflineminus">-</span>
<a href="#l28.377"></a><span id="l28.377" class="difflineminus">-// shuts down the HotSync Manager</span>
<a href="#l28.378"></a><span id="l28.378" class="difflineminus">-void ShutdownHotSync(HINSTANCE hHsapiDLL)</span>
<a href="#l28.379"></a><span id="l28.379" class="difflineminus">-{</span>
<a href="#l28.380"></a><span id="l28.380" class="difflineminus">-    if(!hHsapiDLL)</span>
<a href="#l28.381"></a><span id="l28.381" class="difflineminus">-        return;</span>
<a href="#l28.382"></a><span id="l28.382" class="difflineminus">-</span>
<a href="#l28.383"></a><span id="l28.383" class="difflineminus">-    BOOL    bHotSyncRunning=IsHotSyncRunning(hHsapiDLL);</span>
<a href="#l28.384"></a><span id="l28.384" class="difflineminus">-    </span>
<a href="#l28.385"></a><span id="l28.385" class="difflineminus">-    if(bHotSyncRunning)</span>
<a href="#l28.386"></a><span id="l28.386" class="difflineminus">-    {</span>
<a href="#l28.387"></a><span id="l28.387" class="difflineminus">-        // Prepare to use the HSAPI functions</span>
<a href="#l28.388"></a><span id="l28.388" class="difflineminus">-        HsSetAppStatusPtr   lpfnHsSetAppStatus;</span>
<a href="#l28.389"></a><span id="l28.389" class="difflineminus">-        lpfnHsSetAppStatus = (HsSetAppStatusPtr) GetProcAddress(hHsapiDLL, &quot;HsSetAppStatus&quot;);</span>
<a href="#l28.390"></a><span id="l28.390" class="difflineminus">-    </span>
<a href="#l28.391"></a><span id="l28.391" class="difflineminus">-        if( lpfnHsSetAppStatus )</span>
<a href="#l28.392"></a><span id="l28.392" class="difflineminus">-            (*lpfnHsSetAppStatus)(HsCloseApp, HSFLAG_NONE);</span>
<a href="#l28.393"></a><span id="l28.393" class="difflineminus">-        </span>
<a href="#l28.394"></a><span id="l28.394" class="difflineminus">-        // Wait for HotSync to stop</span>
<a href="#l28.395"></a><span id="l28.395" class="difflineminus">-        for( int i=0; (i&lt;HOTSYNC_MAX_WAIT*2) &amp;&amp; bHotSyncRunning; i++ )</span>
<a href="#l28.396"></a><span id="l28.396" class="difflineminus">-        {</span>
<a href="#l28.397"></a><span id="l28.397" class="difflineminus">-            if( (bHotSyncRunning=IsHotSyncRunning(hHsapiDLL)) == TRUE )</span>
<a href="#l28.398"></a><span id="l28.398" class="difflineminus">-                Sleep(500);</span>
<a href="#l28.399"></a><span id="l28.399" class="difflineminus">-        }</span>
<a href="#l28.400"></a><span id="l28.400" class="difflineminus">-    }</span>
<a href="#l28.401"></a><span id="l28.401" class="difflineminus">-}</span>
<a href="#l28.402"></a><span id="l28.402" class="difflineminus">-</span>
<a href="#l28.403"></a><span id="l28.403" class="difflineminus">-// starts HotSync Manager if not runnning</span>
<a href="#l28.404"></a><span id="l28.404" class="difflineminus">-void StartHotSync(HINSTANCE hHsapiDLL)</span>
<a href="#l28.405"></a><span id="l28.405" class="difflineminus">-{</span>
<a href="#l28.406"></a><span id="l28.406" class="difflineminus">-    if(!hHsapiDLL)</span>
<a href="#l28.407"></a><span id="l28.407" class="difflineminus">-        return;</span>
<a href="#l28.408"></a><span id="l28.408" class="difflineminus">-</span>
<a href="#l28.409"></a><span id="l28.409" class="difflineminus">-    BOOL    bHotSyncRunning=IsHotSyncRunning(hHsapiDLL);</span>
<a href="#l28.410"></a><span id="l28.410" class="difflineminus">-    </span>
<a href="#l28.411"></a><span id="l28.411" class="difflineminus">-    if(!bHotSyncRunning)</span>
<a href="#l28.412"></a><span id="l28.412" class="difflineminus">-    {</span>
<a href="#l28.413"></a><span id="l28.413" class="difflineminus">-        // Prepare to use the HSAPI functions</span>
<a href="#l28.414"></a><span id="l28.414" class="difflineminus">-        HsSetAppStatusPtr   lpfnHsSetAppStatus;</span>
<a href="#l28.415"></a><span id="l28.415" class="difflineminus">-        lpfnHsSetAppStatus = (HsSetAppStatusPtr) GetProcAddress(hHsapiDLL, &quot;HsSetAppStatus&quot;);</span>
<a href="#l28.416"></a><span id="l28.416" class="difflineminus">-    </span>
<a href="#l28.417"></a><span id="l28.417" class="difflineminus">-        if( lpfnHsSetAppStatus )</span>
<a href="#l28.418"></a><span id="l28.418" class="difflineminus">-            (*lpfnHsSetAppStatus)(HsStartApp, HSFLAG_NONE);</span>
<a href="#l28.419"></a><span id="l28.419" class="difflineminus">-        </span>
<a href="#l28.420"></a><span id="l28.420" class="difflineminus">-        // Wait for HotSync to start</span>
<a href="#l28.421"></a><span id="l28.421" class="difflineminus">-        for( int i=0; (i&lt;HOTSYNC_MAX_WAIT*2) &amp;&amp; !bHotSyncRunning; i++ )</span>
<a href="#l28.422"></a><span id="l28.422" class="difflineminus">-        {</span>
<a href="#l28.423"></a><span id="l28.423" class="difflineminus">-            if( (bHotSyncRunning=IsHotSyncRunning(hHsapiDLL)) == FALSE )</span>
<a href="#l28.424"></a><span id="l28.424" class="difflineminus">-                Sleep(500);</span>
<a href="#l28.425"></a><span id="l28.425" class="difflineminus">-        }</span>
<a href="#l28.426"></a><span id="l28.426" class="difflineminus">-    }</span>
<a href="#l28.427"></a><span id="l28.427" class="difflineminus">-}</span>
<a href="#l28.428"></a><span id="l28.428" class="difflineminus">-</span>
<a href="#l28.429"></a><span id="l28.429" class="difflineminus">-int RegisterMozPalmSyncDll()</span>
<a href="#l28.430"></a><span id="l28.430" class="difflineminus">-{</span>
<a href="#l28.431"></a><span id="l28.431" class="difflineminus">-    HINSTANCE hMozPalmSyncProxyDll = NULL;</span>
<a href="#l28.432"></a><span id="l28.432" class="difflineminus">-    if( (hMozPalmSyncProxyDll=LoadLibrary(MOZ_PALMSYNC_PROXY)) != NULL ) {</span>
<a href="#l28.433"></a><span id="l28.433" class="difflineminus">-        mozDllRegisterServerPtr lpfnmozDllRegisterServer;</span>
<a href="#l28.434"></a><span id="l28.434" class="difflineminus">-        lpfnmozDllRegisterServer = (mozDllRegisterServerPtr) GetProcAddress(hMozPalmSyncProxyDll, &quot;DllRegisterServer&quot;);</span>
<a href="#l28.435"></a><span id="l28.435" class="difflineminus">-        DWORD dwReturnCode = (*lpfnmozDllRegisterServer)();</span>
<a href="#l28.436"></a><span id="l28.436" class="difflineminus">-        if(dwReturnCode == S_OK)</span>
<a href="#l28.437"></a><span id="l28.437" class="difflineminus">-            // Successfully registered</span>
<a href="#l28.438"></a><span id="l28.438" class="difflineminus">-            return 0;</span>
<a href="#l28.439"></a><span id="l28.439" class="difflineminus">-    }</span>
<a href="#l28.440"></a><span id="l28.440" class="difflineminus">-</span>
<a href="#l28.441"></a><span id="l28.441" class="difflineminus">-    return IDS_ERR_REGISTERING_MOZ_DLL;</span>
<a href="#l28.442"></a><span id="l28.442" class="difflineminus">-}</span>
<a href="#l28.443"></a><span id="l28.443" class="difflineminus">-</span>
<a href="#l28.444"></a><span id="l28.444" class="difflineminus">-int UnregisterMozPalmSyncDll()</span>
<a href="#l28.445"></a><span id="l28.445" class="difflineminus">-{</span>
<a href="#l28.446"></a><span id="l28.446" class="difflineminus">-    HINSTANCE hMozPalmSyncProxyDll = NULL;</span>
<a href="#l28.447"></a><span id="l28.447" class="difflineminus">-    if( (hMozPalmSyncProxyDll=LoadLibrary(MOZ_PALMSYNC_PROXY)) != NULL ) {</span>
<a href="#l28.448"></a><span id="l28.448" class="difflineminus">-        mozDllUnregisterServerPtr lpfnmozDllUnregisterServer;</span>
<a href="#l28.449"></a><span id="l28.449" class="difflineminus">-        lpfnmozDllUnregisterServer = (mozDllUnregisterServerPtr) GetProcAddress(hMozPalmSyncProxyDll, &quot;DllUnregisterServer&quot;);</span>
<a href="#l28.450"></a><span id="l28.450" class="difflineminus">-        DWORD dwReturnCode = (*lpfnmozDllUnregisterServer)();</span>
<a href="#l28.451"></a><span id="l28.451" class="difflineminus">-        if(dwReturnCode == S_OK)</span>
<a href="#l28.452"></a><span id="l28.452" class="difflineminus">-            // Successfully registered</span>
<a href="#l28.453"></a><span id="l28.453" class="difflineminus">-            return 0;</span>
<a href="#l28.454"></a><span id="l28.454" class="difflineminus">-    }</span>
<a href="#l28.455"></a><span id="l28.455" class="difflineminus">-</span>
<a href="#l28.456"></a><span id="l28.456" class="difflineminus">-    return IDS_ERR_UNREGISTERING_MOZ_DLL;</span>
<a href="#l28.457"></a><span id="l28.457" class="difflineminus">-}</span>
<a href="#l28.458"></a><span id="l28.458" class="difflineminus">-</span>
<a href="#l28.459"></a><span id="l28.459" class="difflineminus">-</span>
<a href="#l28.460"></a><span id="l28.460" class="difflineminus">-char *mystrsep(char **stringp, char delim)</span>
<a href="#l28.461"></a><span id="l28.461" class="difflineminus">-{</span>
<a href="#l28.462"></a><span id="l28.462" class="difflineminus">-  char *endStr = strchr(*stringp, delim);</span>
<a href="#l28.463"></a><span id="l28.463" class="difflineminus">-  char *retStr;</span>
<a href="#l28.464"></a><span id="l28.464" class="difflineminus">-  if (endStr)</span>
<a href="#l28.465"></a><span id="l28.465" class="difflineminus">-  {</span>
<a href="#l28.466"></a><span id="l28.466" class="difflineminus">-    bool foundDelim = (*endStr == delim);</span>
<a href="#l28.467"></a><span id="l28.467" class="difflineminus">-    *endStr = '\0';</span>
<a href="#l28.468"></a><span id="l28.468" class="difflineminus">-    retStr = *stringp;</span>
<a href="#l28.469"></a><span id="l28.469" class="difflineminus">-    *stringp = endStr + !!foundDelim;</span>
<a href="#l28.470"></a><span id="l28.470" class="difflineminus">-  }</span>
<a href="#l28.471"></a><span id="l28.471" class="difflineminus">-  else</span>
<a href="#l28.472"></a><span id="l28.472" class="difflineminus">-    return NULL;</span>
<a href="#l28.473"></a><span id="l28.473" class="difflineminus">-  return retStr;</span>
<a href="#l28.474"></a><span id="l28.474" class="difflineminus">-}</span>
<a href="#l28.475"></a><span id="l28.475" class="difflineminus">-</span>
<a href="#l28.476"></a><span id="l28.476" class="difflineminus">-char oldSettingsStr[500];</span>
<a href="#l28.477"></a><span id="l28.477" class="difflineminus">-static char             gSavedCwd[_MAX_PATH];</span>
<a href="#l28.478"></a><span id="l28.478" class="difflineminus">-</span>
<a href="#l28.479"></a><span id="l28.479" class="difflineminus">-// installs our Conduit</span>
<a href="#l28.480"></a><span id="l28.480" class="difflineminus">-int InstallConduit(HINSTANCE hInstance, TCHAR *installDir, TCHAR *appName)</span>
<a href="#l28.481"></a><span id="l28.481" class="difflineminus">-{ </span>
<a href="#l28.482"></a><span id="l28.482" class="difflineminus">-    int dwReturnCode;</span>
<a href="#l28.483"></a><span id="l28.483" class="difflineminus">-    BOOL    bHotSyncRunning = FALSE;</span>
<a href="#l28.484"></a><span id="l28.484" class="difflineminus">-</span>
<a href="#l28.485"></a><span id="l28.485" class="difflineminus">-    // Prepare the full path of the conduit.</span>
<a href="#l28.486"></a><span id="l28.486" class="difflineminus">-    // Applications should not place conduits in the Palm Desktop directory.</span>
<a href="#l28.487"></a><span id="l28.487" class="difflineminus">-    // The Palm Desktop installer only manages the Palm Desktop conduits.</span>
<a href="#l28.488"></a><span id="l28.488" class="difflineminus">-</span>
<a href="#l28.489"></a><span id="l28.489" class="difflineminus">-    TCHAR szConduitPath[_MAX_PATH];</span>
<a href="#l28.490"></a><span id="l28.490" class="difflineminus">-    if (!installDir)</span>
<a href="#l28.491"></a><span id="l28.491" class="difflineminus">-    {</span>
<a href="#l28.492"></a><span id="l28.492" class="difflineminus">-      if(!GetModuleFileName(NULL, szConduitPath, _MAX_PATH))</span>
<a href="#l28.493"></a><span id="l28.493" class="difflineminus">-          return IDS_ERR_CONDUIT_NOT_FOUND;</span>
<a href="#l28.494"></a><span id="l28.494" class="difflineminus">-</span>
<a href="#l28.495"></a><span id="l28.495" class="difflineminus">-      // extract the dir path (without the module name)</span>
<a href="#l28.496"></a><span id="l28.496" class="difflineminus">-      int index = strlen(szConduitPath)-1;</span>
<a href="#l28.497"></a><span id="l28.497" class="difflineminus">-      while((szConduitPath[index] != DIRECTORY_SEPARATOR) &amp;&amp; index)</span>
<a href="#l28.498"></a><span id="l28.498" class="difflineminus">-          index--;</span>
<a href="#l28.499"></a><span id="l28.499" class="difflineminus">-      szConduitPath[index] = 0;</span>
<a href="#l28.500"></a><span id="l28.500" class="difflineminus">-    }</span>
<a href="#l28.501"></a><span id="l28.501" class="difflineminus">-    else</span>
<a href="#l28.502"></a><span id="l28.502" class="difflineminus">-      strncpy(szConduitPath, installDir, sizeof(szConduitPath) - 1);</span>
<a href="#l28.503"></a><span id="l28.503" class="difflineminus">-</span>
<a href="#l28.504"></a><span id="l28.504" class="difflineminus">-    // take care of any possible string overwrites</span>
<a href="#l28.505"></a><span id="l28.505" class="difflineminus">-    if((strlen(szConduitPath) + strlen(DIRECTORY_SEPARATOR_STR) + strlen(CONDUIT_FILENAME)) &gt; _MAX_PATH)</span>
<a href="#l28.506"></a><span id="l28.506" class="difflineminus">-        return IDS_ERR_LOADING_CONDMGR;</span>
<a href="#l28.507"></a><span id="l28.507" class="difflineminus">-    // might already have conduit filename in szConduitPath if we're</span>
<a href="#l28.508"></a><span id="l28.508" class="difflineminus">-    // called recursively, also check for .DLL as that is the best option</span>
<a href="#l28.509"></a><span id="l28.509" class="difflineminus">-    // if we're passed a short patch name with a file in it.</span>
<a href="#l28.510"></a><span id="l28.510" class="difflineminus">-    if (!strstr(szConduitPath, &quot;.DLL&quot;) &amp;&amp; !strstr(szConduitPath, CONDUIT_FILENAME))</span>
<a href="#l28.511"></a><span id="l28.511" class="difflineminus">-    {</span>
<a href="#l28.512"></a><span id="l28.512" class="difflineminus">-      if (szConduitPath[strlen(szConduitPath) - 1] != DIRECTORY_SEPARATOR)</span>
<a href="#l28.513"></a><span id="l28.513" class="difflineminus">-        strcat(szConduitPath, DIRECTORY_SEPARATOR_STR);</span>
<a href="#l28.514"></a><span id="l28.514" class="difflineminus">-      strcat(szConduitPath, CONDUIT_FILENAME);</span>
<a href="#l28.515"></a><span id="l28.515" class="difflineminus">-    }</span>
<a href="#l28.516"></a><span id="l28.516" class="difflineminus">-</span>
<a href="#l28.517"></a><span id="l28.517" class="difflineminus">-    TCHAR shortConduitPath[_MAX_PATH];</span>
<a href="#l28.518"></a><span id="l28.518" class="difflineminus">-</span>
<a href="#l28.519"></a><span id="l28.519" class="difflineminus">-    // Try and get the short path name.</span>
<a href="#l28.520"></a><span id="l28.520" class="difflineminus">-    if (!GetShortPathName(szConduitPath, shortConduitPath, _MAX_PATH))</span>
<a href="#l28.521"></a><span id="l28.521" class="difflineminus">-      // If failed, so just use the long one</span>
<a href="#l28.522"></a><span id="l28.522" class="difflineminus">-      strncpy(shortConduitPath, szConduitPath, _MAX_PATH);</span>
<a href="#l28.523"></a><span id="l28.523" class="difflineminus">-</span>
<a href="#l28.524"></a><span id="l28.524" class="difflineminus">-    // Make sure the conduit dll exists</span>
<a href="#l28.525"></a><span id="l28.525" class="difflineminus">-    struct _finddata_t dll_file;</span>
<a href="#l28.526"></a><span id="l28.526" class="difflineminus">-    long hFile;</span>
<a href="#l28.527"></a><span id="l28.527" class="difflineminus">-    if( (hFile = _findfirst( shortConduitPath, &amp;dll_file )) == -1L )</span>
<a href="#l28.528"></a><span id="l28.528" class="difflineminus">-        return IDS_ERR_CONDUIT_NOT_FOUND;</span>
<a href="#l28.529"></a><span id="l28.529" class="difflineminus">-</span>
<a href="#l28.530"></a><span id="l28.530" class="difflineminus">-    // now register the Mozilla Palm Sync Support Dll</span>
<a href="#l28.531"></a><span id="l28.531" class="difflineminus">-    if( (dwReturnCode = RegisterMozPalmSyncDll()) != 0)</span>
<a href="#l28.532"></a><span id="l28.532" class="difflineminus">-        return dwReturnCode;</span>
<a href="#l28.533"></a><span id="l28.533" class="difflineminus">-    </span>
<a href="#l28.534"></a><span id="l28.534" class="difflineminus">-    // Get the Palm Desktop Installation directory</span>
<a href="#l28.535"></a><span id="l28.535" class="difflineminus">-    TCHAR   szPalmDesktopDir[_MAX_PATH];</span>
<a href="#l28.536"></a><span id="l28.536" class="difflineminus">-    unsigned long desktopSize=_MAX_PATH;</span>
<a href="#l28.537"></a><span id="l28.537" class="difflineminus">-    </span>
<a href="#l28.538"></a><span id="l28.538" class="difflineminus">-    // old conduit settings - MAX_PATH is arbitrarily long...</span>
<a href="#l28.539"></a><span id="l28.539" class="difflineminus">-    TCHAR szOldCreatorName[_MAX_PATH];</span>
<a href="#l28.540"></a><span id="l28.540" class="difflineminus">-    TCHAR szOldRemote[_MAX_PATH];</span>
<a href="#l28.541"></a><span id="l28.541" class="difflineminus">-    TCHAR szOldCreatorTitle[_MAX_PATH];</span>
<a href="#l28.542"></a><span id="l28.542" class="difflineminus">-    TCHAR szOldCreatorFile[_MAX_PATH];</span>
<a href="#l28.543"></a><span id="l28.543" class="difflineminus">-    TCHAR szOldCreatorDirectory[_MAX_PATH];</span>
<a href="#l28.544"></a><span id="l28.544" class="difflineminus">-    DWORD oldPriority;</span>
<a href="#l28.545"></a><span id="l28.545" class="difflineminus">-    DWORD oldIntegrate;</span>
<a href="#l28.546"></a><span id="l28.546" class="difflineminus">-    int   oldType;</span>
<a href="#l28.547"></a><span id="l28.547" class="difflineminus">-</span>
<a href="#l28.548"></a><span id="l28.548" class="difflineminus">-    // Load the Conduit Manager DLL.</span>
<a href="#l28.549"></a><span id="l28.549" class="difflineminus">-    HINSTANCE hConduitManagerDLL;</span>
<a href="#l28.550"></a><span id="l28.550" class="difflineminus">-    if( (dwReturnCode=GetPalmDesktopInstallDirectory(szPalmDesktopDir, &amp;desktopSize)) == 0 ) </span>
<a href="#l28.551"></a><span id="l28.551" class="difflineminus">-    {</span>
<a href="#l28.552"></a><span id="l28.552" class="difflineminus">-        // need to switch current working directory to directory with palm dlls</span>
<a href="#l28.553"></a><span id="l28.553" class="difflineminus">-        // because of a bug in Palm Desktop 6.01</span>
<a href="#l28.554"></a><span id="l28.554" class="difflineminus">-</span>
<a href="#l28.555"></a><span id="l28.555" class="difflineminus">-        GetCurrentDirectory(sizeof(gSavedCwd), gSavedCwd);</span>
<a href="#l28.556"></a><span id="l28.556" class="difflineminus">-        SetCurrentDirectory(szPalmDesktopDir);</span>
<a href="#l28.557"></a><span id="l28.557" class="difflineminus">-</span>
<a href="#l28.558"></a><span id="l28.558" class="difflineminus">-        if( (dwReturnCode = LoadConduitManagerDll(&amp;hConduitManagerDLL, szPalmDesktopDir)) != 0 )</span>
<a href="#l28.559"></a><span id="l28.559" class="difflineminus">-            return dwReturnCode;</span>
<a href="#l28.560"></a><span id="l28.560" class="difflineminus">-    }</span>
<a href="#l28.561"></a><span id="l28.561" class="difflineminus">-    else </span>
<a href="#l28.562"></a><span id="l28.562" class="difflineminus">-        return IDS_ERR_CONDUIT_NOT_FOUND;</span>
<a href="#l28.563"></a><span id="l28.563" class="difflineminus">-    </span>
<a href="#l28.564"></a><span id="l28.564" class="difflineminus">-    // Prepare to install the conduit using Conduit Manager functions</span>
<a href="#l28.565"></a><span id="l28.565" class="difflineminus">-    CmInstallCreatorPtr lpfnCmInstallCreator;</span>
<a href="#l28.566"></a><span id="l28.566" class="difflineminus">-    lpfnCmInstallCreator = (CmInstallCreatorPtr) GetProcAddress(hConduitManagerDLL, &quot;CmInstallCreator&quot;);</span>
<a href="#l28.567"></a><span id="l28.567" class="difflineminus">-    CmSetCreatorRemotePtr   lpfnCmSetCreatorRemote;</span>
<a href="#l28.568"></a><span id="l28.568" class="difflineminus">-    lpfnCmSetCreatorRemote = (CmSetCreatorRemotePtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorRemote&quot;);</span>
<a href="#l28.569"></a><span id="l28.569" class="difflineminus">-    CmSetCreatorNamePtr lpfnCmSetCreatorName;</span>
<a href="#l28.570"></a><span id="l28.570" class="difflineminus">-    lpfnCmSetCreatorName = (CmSetCreatorNamePtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorName&quot;);</span>
<a href="#l28.571"></a><span id="l28.571" class="difflineminus">-    CmSetCreatorTitlePtr lpfnCmSetCreatorTitle;</span>
<a href="#l28.572"></a><span id="l28.572" class="difflineminus">-    lpfnCmSetCreatorTitle = (CmSetCreatorTitlePtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorTitle&quot;);</span>
<a href="#l28.573"></a><span id="l28.573" class="difflineminus">-    CmSetCreatorPriorityPtr lpfnCmSetCreatorPriority;</span>
<a href="#l28.574"></a><span id="l28.574" class="difflineminus">-    lpfnCmSetCreatorPriority = (CmSetCreatorPriorityPtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorPriority&quot;);</span>
<a href="#l28.575"></a><span id="l28.575" class="difflineminus">-    CmSetCreatorIntegratePtr    lpfnCmSetCreatorIntegrate;</span>
<a href="#l28.576"></a><span id="l28.576" class="difflineminus">-    lpfnCmSetCreatorIntegrate = (CmSetCreatorIntegratePtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorIntegrate&quot;);</span>
<a href="#l28.577"></a><span id="l28.577" class="difflineminus">-    CmRemoveConduitByCreatorIDPtr   lpfnCmRemoveConduitByCreatorID;</span>
<a href="#l28.578"></a><span id="l28.578" class="difflineminus">-    lpfnCmRemoveConduitByCreatorID = (CmRemoveConduitByCreatorIDPtr) GetProcAddress(hConduitManagerDLL, &quot;CmRemoveConduitByCreatorID&quot;);</span>
<a href="#l28.579"></a><span id="l28.579" class="difflineminus">-    CmSetCreatorValueStringPtr lpfnCmSetCreatorValueString = (CmSetCreatorValueStringPtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorValueString&quot;);</span>
<a href="#l28.580"></a><span id="l28.580" class="difflineminus">-</span>
<a href="#l28.581"></a><span id="l28.581" class="difflineminus">-    CmGetCreatorRemotePtr   lpfnCmGetCreatorRemote;</span>
<a href="#l28.582"></a><span id="l28.582" class="difflineminus">-    lpfnCmGetCreatorRemote = (CmGetCreatorRemotePtr) GetProcAddress(hConduitManagerDLL, &quot;CmGetCreatorRemote&quot;);</span>
<a href="#l28.583"></a><span id="l28.583" class="difflineminus">-    CmGetCreatorNamePtr lpfnCmGetCreatorName;</span>
<a href="#l28.584"></a><span id="l28.584" class="difflineminus">-    lpfnCmGetCreatorName = (CmGetCreatorNamePtr) GetProcAddress(hConduitManagerDLL, &quot;CmGetCreatorName&quot;);</span>
<a href="#l28.585"></a><span id="l28.585" class="difflineminus">-    CmGetCreatorTitlePtr lpfnCmGetCreatorTitle;</span>
<a href="#l28.586"></a><span id="l28.586" class="difflineminus">-    lpfnCmGetCreatorTitle = (CmGetCreatorTitlePtr) GetProcAddress(hConduitManagerDLL, &quot;CmGetCreatorTitle&quot;);</span>
<a href="#l28.587"></a><span id="l28.587" class="difflineminus">-    CmGetCreatorPriorityPtr lpfnCmGetCreatorPriority;</span>
<a href="#l28.588"></a><span id="l28.588" class="difflineminus">-    lpfnCmGetCreatorPriority = (CmGetCreatorPriorityPtr) GetProcAddress(hConduitManagerDLL, &quot;CmGetCreatorPriority&quot;);</span>
<a href="#l28.589"></a><span id="l28.589" class="difflineminus">-    CmGetCreatorIntegratePtr    lpfnCmGetCreatorIntegrate;</span>
<a href="#l28.590"></a><span id="l28.590" class="difflineminus">-    lpfnCmGetCreatorIntegrate = (CmGetCreatorIntegratePtr) GetProcAddress(hConduitManagerDLL, &quot;CmGetCreatorIntegrate&quot;);</span>
<a href="#l28.591"></a><span id="l28.591" class="difflineminus">-    CmGetCreatorTypePtr lpfnCmGetCreatorType = (CmGetCreatorTypePtr) GetProcAddress(hConduitManagerDLL, &quot;CmGetCreatorType&quot;);</span>
<a href="#l28.592"></a><span id="l28.592" class="difflineminus">-    CmGetCreatorFilePtr lpfnCmGetCreatorFile = (CmGetCreatorFilePtr) GetProcAddress(hConduitManagerDLL, &quot;CmGetCreatorFile&quot;);</span>
<a href="#l28.593"></a><span id="l28.593" class="difflineminus">-    CmGetCreatorDirectoryPtr lpfnCmGetCreatorDirectory = (CmGetCreatorDirectoryPtr) GetProcAddress(hConduitManagerDLL, &quot;CmGetCreatorDirectory&quot;);</span>
<a href="#l28.594"></a><span id="l28.594" class="difflineminus">-    if( (lpfnCmInstallCreator == NULL) </span>
<a href="#l28.595"></a><span id="l28.595" class="difflineminus">-        || (lpfnCmSetCreatorRemote == NULL)</span>
<a href="#l28.596"></a><span id="l28.596" class="difflineminus">-        || (lpfnCmSetCreatorName == NULL)</span>
<a href="#l28.597"></a><span id="l28.597" class="difflineminus">-        || (lpfnCmSetCreatorTitle == NULL)</span>
<a href="#l28.598"></a><span id="l28.598" class="difflineminus">-        || (lpfnCmSetCreatorPriority == NULL)</span>
<a href="#l28.599"></a><span id="l28.599" class="difflineminus">-        || (lpfnCmSetCreatorIntegrate == NULL)</span>
<a href="#l28.600"></a><span id="l28.600" class="difflineminus">-        )</span>
<a href="#l28.601"></a><span id="l28.601" class="difflineminus">-    {</span>
<a href="#l28.602"></a><span id="l28.602" class="difflineminus">-        // Return error code.</span>
<a href="#l28.603"></a><span id="l28.603" class="difflineminus">-        return(IDS_ERR_LOADING_CONDMGR);</span>
<a href="#l28.604"></a><span id="l28.604" class="difflineminus">-    }</span>
<a href="#l28.605"></a><span id="l28.605" class="difflineminus">- </span>
<a href="#l28.606"></a><span id="l28.606" class="difflineminus">-    szOldCreatorTitle[0] = '\0';</span>
<a href="#l28.607"></a><span id="l28.607" class="difflineminus">-    szOldCreatorName[0] = '\0';</span>
<a href="#l28.608"></a><span id="l28.608" class="difflineminus">-    szOldRemote[0] = '\0';</span>
<a href="#l28.609"></a><span id="l28.609" class="difflineminus">-    szOldCreatorTitle[0] = '\0';</span>
<a href="#l28.610"></a><span id="l28.610" class="difflineminus">-    szOldCreatorFile[0] = '\0';</span>
<a href="#l28.611"></a><span id="l28.611" class="difflineminus">-    szOldCreatorDirectory[0] = '\0';</span>
<a href="#l28.612"></a><span id="l28.612" class="difflineminus">-    // get settings for old conduit</span>
<a href="#l28.613"></a><span id="l28.613" class="difflineminus">-    int remoteBufSize = sizeof(szOldRemote);</span>
<a href="#l28.614"></a><span id="l28.614" class="difflineminus">-    (*lpfnCmGetCreatorRemote) (CREATOR, szOldRemote, &amp;remoteBufSize);</span>
<a href="#l28.615"></a><span id="l28.615" class="difflineminus">-    int creatorBufSize = sizeof(szOldCreatorName);</span>
<a href="#l28.616"></a><span id="l28.616" class="difflineminus">-    (*lpfnCmGetCreatorName)(CREATOR, szOldCreatorName, &amp;creatorBufSize);</span>
<a href="#l28.617"></a><span id="l28.617" class="difflineminus">-    int creatorTitleBufSize = sizeof(szOldCreatorTitle);</span>
<a href="#l28.618"></a><span id="l28.618" class="difflineminus">-    (*lpfnCmGetCreatorTitle)(CREATOR, szOldCreatorTitle, &amp;creatorTitleBufSize);</span>
<a href="#l28.619"></a><span id="l28.619" class="difflineminus">-    int creatorFileBufSize = sizeof(szOldCreatorFile);</span>
<a href="#l28.620"></a><span id="l28.620" class="difflineminus">-    int creatorDirectoryBufSize = sizeof(szOldCreatorDirectory);</span>
<a href="#l28.621"></a><span id="l28.621" class="difflineminus">-    (*lpfnCmGetCreatorFile)(CREATOR, szOldCreatorFile, &amp;creatorFileBufSize);</span>
<a href="#l28.622"></a><span id="l28.622" class="difflineminus">-    (*lpfnCmGetCreatorDirectory)(CREATOR, szOldCreatorDirectory, &amp;creatorDirectoryBufSize);</span>
<a href="#l28.623"></a><span id="l28.623" class="difflineminus">-    (*lpfnCmGetCreatorPriority)(CREATOR, &amp;oldPriority);</span>
<a href="#l28.624"></a><span id="l28.624" class="difflineminus">-    (*lpfnCmGetCreatorIntegrate)(CREATOR, &amp;oldIntegrate);</span>
<a href="#l28.625"></a><span id="l28.625" class="difflineminus">-    oldType = (*lpfnCmGetCreatorType) (CREATOR);</span>
<a href="#l28.626"></a><span id="l28.626" class="difflineminus">-</span>
<a href="#l28.627"></a><span id="l28.627" class="difflineminus">-    // if not set by previous pass through here</span>
<a href="#l28.628"></a><span id="l28.628" class="difflineminus">-    if (!oldSettingsStr[0])</span>
<a href="#l28.629"></a><span id="l28.629" class="difflineminus">-      _snprintf(oldSettingsStr, sizeof(oldSettingsStr), &quot;%s,%s,%s,%s,%s,%d,%d,%d&quot;, szOldRemote, szOldCreatorName, </span>
<a href="#l28.630"></a><span id="l28.630" class="difflineminus">-        szOldCreatorTitle, szOldCreatorFile, szOldCreatorDirectory, oldType, oldPriority, oldIntegrate);</span>
<a href="#l28.631"></a><span id="l28.631" class="difflineminus">-</span>
<a href="#l28.632"></a><span id="l28.632" class="difflineminus">-    // Load the HSAPI DLL.</span>
<a href="#l28.633"></a><span id="l28.633" class="difflineminus">-    HINSTANCE hHsapiDLL;</span>
<a href="#l28.634"></a><span id="l28.634" class="difflineminus">-    if( (dwReturnCode = LoadHsapiDll(&amp;hHsapiDLL, szPalmDesktopDir)) != 0 )</span>
<a href="#l28.635"></a><span id="l28.635" class="difflineminus">-        return dwReturnCode;</span>
<a href="#l28.636"></a><span id="l28.636" class="difflineminus">-        </span>
<a href="#l28.637"></a><span id="l28.637" class="difflineminus">-    // Shutdown the HotSync Process if it is running</span>
<a href="#l28.638"></a><span id="l28.638" class="difflineminus">-    if( (bHotSyncRunning=IsHotSyncRunning(hHsapiDLL)) )</span>
<a href="#l28.639"></a><span id="l28.639" class="difflineminus">-    {</span>
<a href="#l28.640"></a><span id="l28.640" class="difflineminus">-        // Check for any synchronizations in progress</span>
<a href="#l28.641"></a><span id="l28.641" class="difflineminus">-        if( IsHotSyncInProgress(hHsapiDLL) )</span>
<a href="#l28.642"></a><span id="l28.642" class="difflineminus">-            return IDS_ERR_HOTSYNC_IN_PROGRESS;</span>
<a href="#l28.643"></a><span id="l28.643" class="difflineminus">-            </span>
<a href="#l28.644"></a><span id="l28.644" class="difflineminus">-        ShutdownHotSync(hHsapiDLL);</span>
<a href="#l28.645"></a><span id="l28.645" class="difflineminus">-        // store the flag in temp global so that in the recursive call it is restarted</span>
<a href="#l28.646"></a><span id="l28.646" class="difflineminus">-        gWasHotSyncRunning = TRUE;</span>
<a href="#l28.647"></a><span id="l28.647" class="difflineminus">-    }</span>
<a href="#l28.648"></a><span id="l28.648" class="difflineminus">-    </span>
<a href="#l28.649"></a><span id="l28.649" class="difflineminus">-    // Actually install the conduit as an Application Conduit</span>
<a href="#l28.650"></a><span id="l28.650" class="difflineminus">-    dwReturnCode = (*lpfnCmInstallCreator)(CREATOR, CONDUIT_APPLICATION);</span>
<a href="#l28.651"></a><span id="l28.651" class="difflineminus">-    if(dwReturnCode == ERR_CREATORID_ALREADY_IN_USE) {</span>
<a href="#l28.652"></a><span id="l28.652" class="difflineminus">-        dwReturnCode = (*lpfnCmRemoveConduitByCreatorID)(CREATOR);</span>
<a href="#l28.653"></a><span id="l28.653" class="difflineminus">-        if(dwReturnCode &gt;= 0 ) {</span>
<a href="#l28.654"></a><span id="l28.654" class="difflineminus">-            //free the library so that the existing AB Conduit is unloaded properly</span>
<a href="#l28.655"></a><span id="l28.655" class="difflineminus">-            FreeLibrary(hConduitManagerDLL);</span>
<a href="#l28.656"></a><span id="l28.656" class="difflineminus">-            FreeLibrary(hHsapiDLL);</span>
<a href="#l28.657"></a><span id="l28.657" class="difflineminus">-            return InstallConduit(hInstance, shortConduitPath, appName);</span>
<a href="#l28.658"></a><span id="l28.658" class="difflineminus">-        }</span>
<a href="#l28.659"></a><span id="l28.659" class="difflineminus">-    }</span>
<a href="#l28.660"></a><span id="l28.660" class="difflineminus">-    if( dwReturnCode == 0 )</span>
<a href="#l28.661"></a><span id="l28.661" class="difflineminus">-    {</span>
<a href="#l28.662"></a><span id="l28.662" class="difflineminus">-        (*lpfnCmSetCreatorValueString) (CREATOR, &quot;oldConduitSettings&quot;, oldSettingsStr);</span>
<a href="#l28.663"></a><span id="l28.663" class="difflineminus">-        dwReturnCode = (*lpfnCmSetCreatorName)(CREATOR, shortConduitPath);</span>
<a href="#l28.664"></a><span id="l28.664" class="difflineminus">-        if( dwReturnCode != 0 ) return dwReturnCode;</span>
<a href="#l28.665"></a><span id="l28.665" class="difflineminus">-        TCHAR title[MAX_LOADSTRING];</span>
<a href="#l28.666"></a><span id="l28.666" class="difflineminus">-        // Construct conduit title (the one displayed in HotSync Mgr's Custom...list)..</span>
<a href="#l28.667"></a><span id="l28.667" class="difflineminus">-        ConstructMessage(hInstance, appName, IDS_CONDUIT_TITLE, title);</span>
<a href="#l28.668"></a><span id="l28.668" class="difflineminus">-        dwReturnCode = (*lpfnCmSetCreatorTitle)(CREATOR, title);</span>
<a href="#l28.669"></a><span id="l28.669" class="difflineminus">-        if( dwReturnCode != 0 ) return dwReturnCode;</span>
<a href="#l28.670"></a><span id="l28.670" class="difflineminus">-        dwReturnCode = (*lpfnCmSetCreatorRemote)(CREATOR, REMOTE_DB);</span>
<a href="#l28.671"></a><span id="l28.671" class="difflineminus">-        if( dwReturnCode != 0 ) return dwReturnCode;</span>
<a href="#l28.672"></a><span id="l28.672" class="difflineminus">-        dwReturnCode = (*lpfnCmSetCreatorPriority)(CREATOR, CONDUIT_PRIORITY);</span>
<a href="#l28.673"></a><span id="l28.673" class="difflineminus">-        if( dwReturnCode != 0 ) return dwReturnCode;</span>
<a href="#l28.674"></a><span id="l28.674" class="difflineminus">-        // Applications should always set Integrate to 0</span>
<a href="#l28.675"></a><span id="l28.675" class="difflineminus">-        dwReturnCode = (*lpfnCmSetCreatorIntegrate)(CREATOR, (DWORD)0);</span>
<a href="#l28.676"></a><span id="l28.676" class="difflineminus">-        (*lpfnCmSetCreatorValueString) (CREATOR, &quot;oldConduitSettings&quot;, oldSettingsStr);</span>
<a href="#l28.677"></a><span id="l28.677" class="difflineminus">-    }</span>
<a href="#l28.678"></a><span id="l28.678" class="difflineminus">-    </span>
<a href="#l28.679"></a><span id="l28.679" class="difflineminus">-    // Re-start HotSync if it was running before</span>
<a href="#l28.680"></a><span id="l28.680" class="difflineminus">-    if( gWasHotSyncRunning )</span>
<a href="#l28.681"></a><span id="l28.681" class="difflineminus">-        StartHotSync(hHsapiDLL);</span>
<a href="#l28.682"></a><span id="l28.682" class="difflineminus">-</span>
<a href="#l28.683"></a><span id="l28.683" class="difflineminus">-    // restore cwd, if we changed it.        </span>
<a href="#l28.684"></a><span id="l28.684" class="difflineminus">-    if (gSavedCwd[0])</span>
<a href="#l28.685"></a><span id="l28.685" class="difflineminus">-      SetCurrentDirectory(gSavedCwd);</span>
<a href="#l28.686"></a><span id="l28.686" class="difflineminus">-</span>
<a href="#l28.687"></a><span id="l28.687" class="difflineminus">-    return(dwReturnCode);</span>
<a href="#l28.688"></a><span id="l28.688" class="difflineminus">-}</span>
<a href="#l28.689"></a><span id="l28.689" class="difflineminus">-</span>
<a href="#l28.690"></a><span id="l28.690" class="difflineminus">-// uninstalls our conduit</span>
<a href="#l28.691"></a><span id="l28.691" class="difflineminus">-int UninstallConduit()</span>
<a href="#l28.692"></a><span id="l28.692" class="difflineminus">-{ </span>
<a href="#l28.693"></a><span id="l28.693" class="difflineminus">-    int dwReturnCode;</span>
<a href="#l28.694"></a><span id="l28.694" class="difflineminus">-    BOOL    bHotSyncRunning = FALSE;</span>
<a href="#l28.695"></a><span id="l28.695" class="difflineminus">-</span>
<a href="#l28.696"></a><span id="l28.696" class="difflineminus">-    // Get the Palm Desktop Installation directory</span>
<a href="#l28.697"></a><span id="l28.697" class="difflineminus">-    TCHAR   szPalmDesktopDir[_MAX_PATH];</span>
<a href="#l28.698"></a><span id="l28.698" class="difflineminus">-    unsigned long desktopSize=_MAX_PATH;</span>
<a href="#l28.699"></a><span id="l28.699" class="difflineminus">-    // Load the Conduit Manager DLL.</span>
<a href="#l28.700"></a><span id="l28.700" class="difflineminus">-    HINSTANCE hConduitManagerDLL;</span>
<a href="#l28.701"></a><span id="l28.701" class="difflineminus">-    if( (dwReturnCode=GetPalmDesktopInstallDirectory(szPalmDesktopDir, &amp;desktopSize)) == 0 )</span>
<a href="#l28.702"></a><span id="l28.702" class="difflineminus">-    {</span>
<a href="#l28.703"></a><span id="l28.703" class="difflineminus">-        if( (dwReturnCode = LoadConduitManagerDll(&amp;hConduitManagerDLL, szPalmDesktopDir)) != 0 )</span>
<a href="#l28.704"></a><span id="l28.704" class="difflineminus">-                return(dwReturnCode);</span>
<a href="#l28.705"></a><span id="l28.705" class="difflineminus">-    }</span>
<a href="#l28.706"></a><span id="l28.706" class="difflineminus">-    // if registery key not load it from local dir if present by any chance</span>
<a href="#l28.707"></a><span id="l28.707" class="difflineminus">-    else </span>
<a href="#l28.708"></a><span id="l28.708" class="difflineminus">-          return(dwReturnCode);</span>
<a href="#l28.709"></a><span id="l28.709" class="difflineminus">-    </span>
<a href="#l28.710"></a><span id="l28.710" class="difflineminus">-    // need to switch current working directory to directory with palm dlls</span>
<a href="#l28.711"></a><span id="l28.711" class="difflineminus">-    // because of a bug in Palm Desktop 6.01</span>
<a href="#l28.712"></a><span id="l28.712" class="difflineminus">-</span>
<a href="#l28.713"></a><span id="l28.713" class="difflineminus">-    GetCurrentDirectory(sizeof(gSavedCwd), gSavedCwd);</span>
<a href="#l28.714"></a><span id="l28.714" class="difflineminus">-    SetCurrentDirectory(szPalmDesktopDir);</span>
<a href="#l28.715"></a><span id="l28.715" class="difflineminus">-</span>
<a href="#l28.716"></a><span id="l28.716" class="difflineminus">-    // Prepare to uninstall the conduit using Conduit Manager functions</span>
<a href="#l28.717"></a><span id="l28.717" class="difflineminus">-    CmRemoveConduitByCreatorIDPtr   lpfnCmRemoveConduitByCreatorID;</span>
<a href="#l28.718"></a><span id="l28.718" class="difflineminus">-    lpfnCmRemoveConduitByCreatorID = (CmRemoveConduitByCreatorIDPtr) GetProcAddress(hConduitManagerDLL, &quot;CmRemoveConduitByCreatorID&quot;);</span>
<a href="#l28.719"></a><span id="l28.719" class="difflineminus">-    if( (lpfnCmRemoveConduitByCreatorID == NULL) )</span>
<a href="#l28.720"></a><span id="l28.720" class="difflineminus">-        return(IDS_ERR_LOADING_CONDMGR);</span>
<a href="#l28.721"></a><span id="l28.721" class="difflineminus">-        CmSetCorePathPtr lpfnCmSetCorePath = (CmSetCorePathPtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCorePath&quot;);</span>
<a href="#l28.722"></a><span id="l28.722" class="difflineminus">-    CmSetHotSyncExePathPtr lpfnCmSetHotSyncExePath = (CmSetHotSyncExePathPtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetHotSyncExecPath&quot;);</span>
<a href="#l28.723"></a><span id="l28.723" class="difflineminus">-    CmRestoreHotSyncSettingsPtr lpfnCmRestoreHotSyncSettings;</span>
<a href="#l28.724"></a><span id="l28.724" class="difflineminus">-    lpfnCmRestoreHotSyncSettings = (CmRestoreHotSyncSettingsPtr) GetProcAddress(hConduitManagerDLL, &quot;CmRestoreHotSyncSettings&quot;);</span>
<a href="#l28.725"></a><span id="l28.725" class="difflineminus">-    CmGetCreatorValueStringPtr lpfnCmGetCreatorValueString = (CmGetCreatorValueStringPtr) GetProcAddress(hConduitManagerDLL, &quot;CmGetCreatorValueString&quot;);</span>
<a href="#l28.726"></a><span id="l28.726" class="difflineminus">-    CmInstallCreatorPtr lpfnCmInstallCreator;</span>
<a href="#l28.727"></a><span id="l28.727" class="difflineminus">-    lpfnCmInstallCreator = (CmInstallCreatorPtr) GetProcAddress(hConduitManagerDLL, &quot;CmInstallCreator&quot;);</span>
<a href="#l28.728"></a><span id="l28.728" class="difflineminus">-    CmSetCreatorRemotePtr   lpfnCmSetCreatorRemote;</span>
<a href="#l28.729"></a><span id="l28.729" class="difflineminus">-    lpfnCmSetCreatorRemote = (CmSetCreatorRemotePtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorRemote&quot;);</span>
<a href="#l28.730"></a><span id="l28.730" class="difflineminus">-    CmSetCreatorNamePtr lpfnCmSetCreatorName;</span>
<a href="#l28.731"></a><span id="l28.731" class="difflineminus">-    lpfnCmSetCreatorName = (CmSetCreatorNamePtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorName&quot;);</span>
<a href="#l28.732"></a><span id="l28.732" class="difflineminus">-    CmSetCreatorTitlePtr lpfnCmSetCreatorTitle;</span>
<a href="#l28.733"></a><span id="l28.733" class="difflineminus">-    lpfnCmSetCreatorTitle = (CmSetCreatorTitlePtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorTitle&quot;);</span>
<a href="#l28.734"></a><span id="l28.734" class="difflineminus">-    CmSetCreatorPriorityPtr lpfnCmSetCreatorPriority;</span>
<a href="#l28.735"></a><span id="l28.735" class="difflineminus">-    lpfnCmSetCreatorPriority = (CmSetCreatorPriorityPtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorPriority&quot;);</span>
<a href="#l28.736"></a><span id="l28.736" class="difflineminus">-    CmSetCreatorIntegratePtr    lpfnCmSetCreatorIntegrate;</span>
<a href="#l28.737"></a><span id="l28.737" class="difflineminus">-    lpfnCmSetCreatorIntegrate = (CmSetCreatorIntegratePtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorIntegrate&quot;);</span>
<a href="#l28.738"></a><span id="l28.738" class="difflineminus">-    CmSetCreatorFilePtr lpfnCmSetCreatorFile = (CmSetCreatorFilePtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorFile&quot;);</span>
<a href="#l28.739"></a><span id="l28.739" class="difflineminus">-    CmSetCreatorDirectoryPtr lpfnCmSetCreatorDirectory = (CmSetCreatorDirectoryPtr) GetProcAddress(hConduitManagerDLL, &quot;CmSetCreatorDirectory&quot;);</span>
<a href="#l28.740"></a><span id="l28.740" class="difflineminus">-    if( (lpfnCmRestoreHotSyncSettings == NULL) )</span>
<a href="#l28.741"></a><span id="l28.741" class="difflineminus">-        return(IDS_ERR_LOADING_CONDMGR);</span>
<a href="#l28.742"></a><span id="l28.742" class="difflineminus">-    </span>
<a href="#l28.743"></a><span id="l28.743" class="difflineminus">-    // Load the HSAPI DLL.</span>
<a href="#l28.744"></a><span id="l28.744" class="difflineminus">-    HINSTANCE hHsapiDLL;</span>
<a href="#l28.745"></a><span id="l28.745" class="difflineminus">-    if( (dwReturnCode = LoadHsapiDll(&amp;hHsapiDLL, szPalmDesktopDir)) != 0 )</span>
<a href="#l28.746"></a><span id="l28.746" class="difflineminus">-          return(dwReturnCode);</span>
<a href="#l28.747"></a><span id="l28.747" class="difflineminus">-        </span>
<a href="#l28.748"></a><span id="l28.748" class="difflineminus">-    // Shutdown the HotSync Process if it is running</span>
<a href="#l28.749"></a><span id="l28.749" class="difflineminus">-    if( (bHotSyncRunning=IsHotSyncRunning(hHsapiDLL)) )</span>
<a href="#l28.750"></a><span id="l28.750" class="difflineminus">-    {</span>
<a href="#l28.751"></a><span id="l28.751" class="difflineminus">-        // Check for any synchronizations in progress</span>
<a href="#l28.752"></a><span id="l28.752" class="difflineminus">-        if( IsHotSyncInProgress(hHsapiDLL) )</span>
<a href="#l28.753"></a><span id="l28.753" class="difflineminus">-            return IDS_ERR_HOTSYNC_IN_PROGRESS;</span>
<a href="#l28.754"></a><span id="l28.754" class="difflineminus">-            </span>
<a href="#l28.755"></a><span id="l28.755" class="difflineminus">-        ShutdownHotSync(hHsapiDLL);</span>
<a href="#l28.756"></a><span id="l28.756" class="difflineminus">-    }</span>
<a href="#l28.757"></a><span id="l28.757" class="difflineminus">-    </span>
<a href="#l28.758"></a><span id="l28.758" class="difflineminus">-    TCHAR oldConduitSettings[500];</span>
<a href="#l28.759"></a><span id="l28.759" class="difflineminus">-    int strSize = sizeof(oldConduitSettings);</span>
<a href="#l28.760"></a><span id="l28.760" class="difflineminus">-    dwReturnCode = (*lpfnCmGetCreatorValueString)(CREATOR, &quot;oldConduitSettings&quot;, oldConduitSettings, &amp;strSize, &quot;&quot;);</span>
<a href="#l28.761"></a><span id="l28.761" class="difflineminus">-</span>
<a href="#l28.762"></a><span id="l28.762" class="difflineminus">-    // Actually uninstall the conduit</span>
<a href="#l28.763"></a><span id="l28.763" class="difflineminus">-    dwReturnCode = (*lpfnCmRemoveConduitByCreatorID)(CREATOR);</span>
<a href="#l28.764"></a><span id="l28.764" class="difflineminus">-</span>
<a href="#l28.765"></a><span id="l28.765" class="difflineminus">-    if(dwReturnCode &gt;= 0) </span>
<a href="#l28.766"></a><span id="l28.766" class="difflineminus">-    {</span>
<a href="#l28.767"></a><span id="l28.767" class="difflineminus">-        // uninstall Mozilla Palm Sync Support Proxy Dll</span>
<a href="#l28.768"></a><span id="l28.768" class="difflineminus">-        dwReturnCode = UnregisterMozPalmSyncDll();</span>
<a href="#l28.769"></a><span id="l28.769" class="difflineminus">-//        dwReturnCode = (*lpfnCmRestoreHotSyncSettings)(TRUE);</span>
<a href="#l28.770"></a><span id="l28.770" class="difflineminus">-    }</span>
<a href="#l28.771"></a><span id="l28.771" class="difflineminus">-</span>
<a href="#l28.772"></a><span id="l28.772" class="difflineminus">-    if (dwReturnCode &gt;= 0)</span>
<a href="#l28.773"></a><span id="l28.773" class="difflineminus">-    {</span>
<a href="#l28.774"></a><span id="l28.774" class="difflineminus">-      char * szOldCreatorName;</span>
<a href="#l28.775"></a><span id="l28.775" class="difflineminus">-      char *szOldRemote;</span>
<a href="#l28.776"></a><span id="l28.776" class="difflineminus">-      char *szOldCreatorTitle;</span>
<a href="#l28.777"></a><span id="l28.777" class="difflineminus">-      char *szOldCreatorFile;</span>
<a href="#l28.778"></a><span id="l28.778" class="difflineminus">-      char *szOldCreatorDirectory;</span>
<a href="#l28.779"></a><span id="l28.779" class="difflineminus">-      char *oldIntStr;</span>
<a href="#l28.780"></a><span id="l28.780" class="difflineminus">-      DWORD oldPriority;</span>
<a href="#l28.781"></a><span id="l28.781" class="difflineminus">-      DWORD oldIntegrate;</span>
<a href="#l28.782"></a><span id="l28.782" class="difflineminus">-      int   oldType;</span>
<a href="#l28.783"></a><span id="l28.783" class="difflineminus">-</span>
<a href="#l28.784"></a><span id="l28.784" class="difflineminus">-      char *strPtr = oldConduitSettings;</span>
<a href="#l28.785"></a><span id="l28.785" class="difflineminus">-      szOldRemote = mystrsep(&amp;strPtr, ',');</span>
<a href="#l28.786"></a><span id="l28.786" class="difflineminus">-      szOldCreatorName = mystrsep(&amp;strPtr, ',');</span>
<a href="#l28.787"></a><span id="l28.787" class="difflineminus">-      szOldCreatorTitle = mystrsep(&amp;strPtr, ',');</span>
<a href="#l28.788"></a><span id="l28.788" class="difflineminus">-      szOldCreatorFile = mystrsep(&amp;strPtr, ',');</span>
<a href="#l28.789"></a><span id="l28.789" class="difflineminus">-      szOldCreatorDirectory = mystrsep(&amp;strPtr, ',');</span>
<a href="#l28.790"></a><span id="l28.790" class="difflineminus">-      oldIntStr = mystrsep(&amp;strPtr, ',');</span>
<a href="#l28.791"></a><span id="l28.791" class="difflineminus">-      oldType = (oldIntStr) ? atoi(oldIntStr) : 0;</span>
<a href="#l28.792"></a><span id="l28.792" class="difflineminus">-      oldIntStr = mystrsep(&amp;strPtr, ',');</span>
<a href="#l28.793"></a><span id="l28.793" class="difflineminus">-      oldPriority = (oldIntStr) ? atoi(oldIntStr) : 0;</span>
<a href="#l28.794"></a><span id="l28.794" class="difflineminus">-      oldIntStr = mystrsep(&amp;strPtr, ',');</span>
<a href="#l28.795"></a><span id="l28.795" class="difflineminus">-      oldIntegrate = (oldIntStr) ? atoi(oldIntStr) : 0;</span>
<a href="#l28.796"></a><span id="l28.796" class="difflineminus">-</span>
<a href="#l28.797"></a><span id="l28.797" class="difflineminus">-      dwReturnCode = (*lpfnCmInstallCreator)(CREATOR, oldType);</span>
<a href="#l28.798"></a><span id="l28.798" class="difflineminus">-      if( dwReturnCode == 0 )</span>
<a href="#l28.799"></a><span id="l28.799" class="difflineminus">-      {</span>
<a href="#l28.800"></a><span id="l28.800" class="difflineminus">-          dwReturnCode = (*lpfnCmSetCreatorName)(CREATOR, szOldCreatorName);</span>
<a href="#l28.801"></a><span id="l28.801" class="difflineminus">-          if( dwReturnCode != 0 ) return dwReturnCode;</span>
<a href="#l28.802"></a><span id="l28.802" class="difflineminus">-          // Construct conduit title (the one displayed in HotSync Mgr's Custom...list)..</span>
<a href="#l28.803"></a><span id="l28.803" class="difflineminus">-          dwReturnCode = (*lpfnCmSetCreatorTitle)(CREATOR, szOldCreatorTitle);</span>
<a href="#l28.804"></a><span id="l28.804" class="difflineminus">-          if( dwReturnCode != 0 ) return dwReturnCode;</span>
<a href="#l28.805"></a><span id="l28.805" class="difflineminus">-          dwReturnCode = (*lpfnCmSetCreatorRemote)(CREATOR, szOldRemote);</span>
<a href="#l28.806"></a><span id="l28.806" class="difflineminus">-          if( dwReturnCode != 0 ) return dwReturnCode;</span>
<a href="#l28.807"></a><span id="l28.807" class="difflineminus">-          dwReturnCode = (*lpfnCmSetCreatorFile)(CREATOR, szOldCreatorFile);</span>
<a href="#l28.808"></a><span id="l28.808" class="difflineminus">-          if( dwReturnCode != 0 ) return dwReturnCode;</span>
<a href="#l28.809"></a><span id="l28.809" class="difflineminus">-          dwReturnCode = (*lpfnCmSetCreatorDirectory)(CREATOR, szOldCreatorDirectory);</span>
<a href="#l28.810"></a><span id="l28.810" class="difflineminus">-          if( dwReturnCode != 0 ) return dwReturnCode;</span>
<a href="#l28.811"></a><span id="l28.811" class="difflineminus">-          dwReturnCode = (*lpfnCmSetCreatorPriority)(CREATOR, oldPriority);</span>
<a href="#l28.812"></a><span id="l28.812" class="difflineminus">-          if( dwReturnCode != 0 ) return dwReturnCode;</span>
<a href="#l28.813"></a><span id="l28.813" class="difflineminus">-          // Applications should always set Integrate to 0</span>
<a href="#l28.814"></a><span id="l28.814" class="difflineminus">-          dwReturnCode = (*lpfnCmSetCreatorIntegrate)(CREATOR, oldIntegrate);</span>
<a href="#l28.815"></a><span id="l28.815" class="difflineminus">-      }</span>
<a href="#l28.816"></a><span id="l28.816" class="difflineminus">-    }</span>
<a href="#l28.817"></a><span id="l28.817" class="difflineminus">-</span>
<a href="#l28.818"></a><span id="l28.818" class="difflineminus">-//    if (lpfnCmSetCorePath)</span>
<a href="#l28.819"></a><span id="l28.819" class="difflineminus">-//      (*lpfnCmSetCorePath)(szPalmDesktopDir);</span>
<a href="#l28.820"></a><span id="l28.820" class="difflineminus">-//    if (lpfnCmSetHotSyncExePath)</span>
<a href="#l28.821"></a><span id="l28.821" class="difflineminus">-//      (*lpfnCmSetHotSyncExePath)(szPalmHotSyncInstallDir);</span>
<a href="#l28.822"></a><span id="l28.822" class="difflineminus">-    </span>
<a href="#l28.823"></a><span id="l28.823" class="difflineminus">-    // this registry key is set by the RestoreHotSyncSettings to point incorrectly to Mozilla dir</span>
<a href="#l28.824"></a><span id="l28.824" class="difflineminus">-    // this should point to the Palm directory to enable sync with Palm Desktop.</span>
<a href="#l28.825"></a><span id="l28.825" class="difflineminus">-#if 0</span>
<a href="#l28.826"></a><span id="l28.826" class="difflineminus">-    HKEY key;</span>
<a href="#l28.827"></a><span id="l28.827" class="difflineminus">-    LONG rc = RegOpenKeyEx(HKEY_CURRENT_USER, &quot;Software\\U.S. Robotics\\Pilot Desktop\\Core&quot;,</span>
<a href="#l28.828"></a><span id="l28.828" class="difflineminus">-                                0, KEY_ALL_ACCESS, &amp;key);</span>
<a href="#l28.829"></a><span id="l28.829" class="difflineminus">-    if(rc == ERROR_SUCCESS)</span>
<a href="#l28.830"></a><span id="l28.830" class="difflineminus">-        ::RegSetValueEx(key, &quot;Path&quot;, 0, REG_SZ, (const BYTE *) szPalmDesktopDir, desktopSize);</span>
<a href="#l28.831"></a><span id="l28.831" class="difflineminus">- </span>
<a href="#l28.832"></a><span id="l28.832" class="difflineminus">-    if(rc == ERROR_SUCCESS)</span>
<a href="#l28.833"></a><span id="l28.833" class="difflineminus">-        ::RegSetValueEx(key, &quot;HotSyncPath&quot;, 0, REG_SZ, (const BYTE *) szPalmHotSyncInstallDir, installSize);</span>
<a href="#l28.834"></a><span id="l28.834" class="difflineminus">-#endif</span>
<a href="#l28.835"></a><span id="l28.835" class="difflineminus">-    // Re-start HotSync if it was running before</span>
<a href="#l28.836"></a><span id="l28.836" class="difflineminus">-    if( bHotSyncRunning )</span>
<a href="#l28.837"></a><span id="l28.837" class="difflineminus">-        StartHotSync(hHsapiDLL);</span>
<a href="#l28.838"></a><span id="l28.838" class="difflineminus">-        </span>
<a href="#l28.839"></a><span id="l28.839" class="difflineminus">-    // restore cwd, if we changed it.        </span>
<a href="#l28.840"></a><span id="l28.840" class="difflineminus">-    if (gSavedCwd[0])</span>
<a href="#l28.841"></a><span id="l28.841" class="difflineminus">-      SetCurrentDirectory(gSavedCwd);</span>
<a href="#l28.842"></a><span id="l28.842" class="difflineminus">-</span>
<a href="#l28.843"></a><span id="l28.843" class="difflineminus">-    if( dwReturnCode &lt; 0 ) </span>
<a href="#l28.844"></a><span id="l28.844" class="difflineminus">-        return dwReturnCode;</span>
<a href="#l28.845"></a><span id="l28.845" class="difflineminus">-    else </span>
<a href="#l28.846"></a><span id="l28.846" class="difflineminus">-        return(0);</span>
<a href="#l28.847"></a><span id="l28.847" class="difflineminus">-}</span>
<a href="#l28.848"></a><span id="l28.848" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1">deleted file mode 100644</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineminus">--- a/mailnews/extensions/palmsync/installer/PalmSyncInstall.rc</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineplus">+++ /dev/null</span>
<a href="#l29.4"></a><span id="l29.4" class="difflineat">@@ -1,106 +0,0 @@</span>
<a href="#l29.5"></a><span id="l29.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l29.6"></a><span id="l29.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l29.7"></a><span id="l29.7" class="difflineminus">- *</span>
<a href="#l29.8"></a><span id="l29.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l29.9"></a><span id="l29.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l29.10"></a><span id="l29.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l29.11"></a><span id="l29.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">- *</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">- * License.</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineminus">- *</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineminus">- *</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineminus">- *</span>
<a href="#l29.23"></a><span id="l29.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineminus">- *</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineminus">- *</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l29.34"></a><span id="l29.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l29.35"></a><span id="l29.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l29.36"></a><span id="l29.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l29.37"></a><span id="l29.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l29.40"></a><span id="l29.40" class="difflineminus">- *</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l29.42"></a><span id="l29.42" class="difflineminus">-</span>
<a href="#l29.43"></a><span id="l29.43" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l29.44"></a><span id="l29.44" class="difflineminus">-</span>
<a href="#l29.45"></a><span id="l29.45" class="difflineminus">-#define APSTUDIO_READONLY_SYMBOLS</span>
<a href="#l29.46"></a><span id="l29.46" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineminus">-//</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineminus">-#define APSTUDIO_HIDDEN_SYMBOLS</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineminus">-#include &quot;windows.h&quot;</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineminus">-#undef APSTUDIO_HIDDEN_SYMBOLS</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineminus">-//</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineminus">-#undef APSTUDIO_READONLY_SYMBOLS</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineminus">-</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineminus">-// English (U.S.) resources</span>
<a href="#l29.58"></a><span id="l29.58" class="difflineminus">-</span>
<a href="#l29.59"></a><span id="l29.59" class="difflineminus">-#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_ENU)</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineminus">-#ifdef _WIN32</span>
<a href="#l29.61"></a><span id="l29.61" class="difflineminus">-LANGUAGE LANG_ENGLISH, SUBLANG_ENGLISH_US</span>
<a href="#l29.62"></a><span id="l29.62" class="difflineminus">-#pragma code_page(1252)</span>
<a href="#l29.63"></a><span id="l29.63" class="difflineminus">-#endif //_WIN32</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineminus">-</span>
<a href="#l29.65"></a><span id="l29.65" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l29.66"></a><span id="l29.66" class="difflineminus">-//</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineminus">-// Icon</span>
<a href="#l29.68"></a><span id="l29.68" class="difflineminus">-//</span>
<a href="#l29.69"></a><span id="l29.69" class="difflineminus">-</span>
<a href="#l29.70"></a><span id="l29.70" class="difflineminus">-// Icon with lowest ID value placed first to ensure application icon</span>
<a href="#l29.71"></a><span id="l29.71" class="difflineminus">-// remains consistent on all systems.</span>
<a href="#l29.72"></a><span id="l29.72" class="difflineminus">-1                       ICON    DISCARDABLE     &quot;install.ico&quot;</span>
<a href="#l29.73"></a><span id="l29.73" class="difflineminus">-2                       ICON    DISCARDABLE     &quot;uninstall.ico&quot;</span>
<a href="#l29.74"></a><span id="l29.74" class="difflineminus">-</span>
<a href="#l29.75"></a><span id="l29.75" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l29.76"></a><span id="l29.76" class="difflineminus">-//</span>
<a href="#l29.77"></a><span id="l29.77" class="difflineminus">-// String Table</span>
<a href="#l29.78"></a><span id="l29.78" class="difflineminus">-//</span>
<a href="#l29.79"></a><span id="l29.79" class="difflineminus">-</span>
<a href="#l29.80"></a><span id="l29.80" class="difflineminus">-// Note these strings don't have a space after %s because the code adds that for us</span>
<a href="#l29.81"></a><span id="l29.81" class="difflineminus">-// (just in case we've not got a name to dispaly).</span>
<a href="#l29.82"></a><span id="l29.82" class="difflineminus">-STRINGTABLE DISCARDABLE </span>
<a href="#l29.83"></a><span id="l29.83" class="difflineminus">-BEGIN</span>
<a href="#l29.84"></a><span id="l29.84" class="difflineminus">-    IDS_APP_TITLE_INSTALL   &quot;%sAddress Book Palm Sync Install&quot;</span>
<a href="#l29.85"></a><span id="l29.85" class="difflineminus">-    IDS_APP_TITLE_UNINSTALL &quot;%sAddress Book Palm Sync Uninstall&quot;</span>
<a href="#l29.86"></a><span id="l29.86" class="difflineminus">-    IDS_CONDUIT_TITLE       &quot;%sAddress Book&quot;</span>
<a href="#l29.87"></a><span id="l29.87" class="difflineminus">-    IDC_PALMSYNCINSTALL     &quot;PALMSYNCINSTALL&quot;</span>
<a href="#l29.88"></a><span id="l29.88" class="difflineminus">-    IDS_ERR_GENERAL         &quot;Error in (un)installing the %sAddress Book Palm Sync Conduit&quot;</span>
<a href="#l29.89"></a><span id="l29.89" class="difflineminus">-    IDS_ERR_LOADING_CONDMGR &quot;Error in loading the Conduit Manager while (un)installing the %sAddress Book Palm Sync Conduit&quot;</span>
<a href="#l29.90"></a><span id="l29.90" class="difflineminus">-END</span>
<a href="#l29.91"></a><span id="l29.91" class="difflineminus">-</span>
<a href="#l29.92"></a><span id="l29.92" class="difflineminus">-STRINGTABLE DISCARDABLE </span>
<a href="#l29.93"></a><span id="l29.93" class="difflineminus">-BEGIN</span>
<a href="#l29.94"></a><span id="l29.94" class="difflineminus">-    IDS_ERR_HSAPI_NOT_FOUND &quot;Could not find the HSAPI.dll while (un)installing the %sAddress Book Palm Sync Conduit&quot;</span>
<a href="#l29.95"></a><span id="l29.95" class="difflineminus">-    IDS_ERR_CONDUIT_NOT_FOUND </span>
<a href="#l29.96"></a><span id="l29.96" class="difflineminus">-                            &quot;Could not find the %sAddress Book Palm Sync Conduit to install&quot;</span>
<a href="#l29.97"></a><span id="l29.97" class="difflineminus">-    IDS_ERR_HOTSYNC_IN_PROGRESS </span>
<a href="#l29.98"></a><span id="l29.98" class="difflineminus">-                            &quot;A Palm HotSync operation is in progress, let it complete first then install the %sAddress Book Palm Sync Conduit&quot;</span>
<a href="#l29.99"></a><span id="l29.99" class="difflineminus">-    IDS_ERR_FINDING_INSTALL_DIR </span>
<a href="#l29.100"></a><span id="l29.100" class="difflineminus">-                            &quot;Could not find the directory to install the %sAddress Book Palm Sync Conduit.&quot;</span>
<a href="#l29.101"></a><span id="l29.101" class="difflineminus">-    IDS_SUCCESS_INSTALL     &quot;%sAddress Book Palm Sync was successfully installed. Using your Palm device, perform a HotSync operation to synchronize your Palm device's address book with your %saddress book.&quot;</span>
<a href="#l29.102"></a><span id="l29.102" class="difflineminus">-    IDS_SUCCESS_UNINSTALL   &quot;%sAddress Book Palm Sync was successfully uninstalled. Palm Desktop synchronization with your Palm device is now restored.&quot;</span>
<a href="#l29.103"></a><span id="l29.103" class="difflineminus">-    IDS_CONFIRM_INSTALL     &quot;You are about to add the %sAddress Book conduit to your Palm Hot Sync installation, which may remove the Palm Desktop conduit.  Do you want to continue?&quot;</span>
<a href="#l29.104"></a><span id="l29.104" class="difflineminus">-    IDS_CONFIRM_UNINSTALL   &quot;You are about to uninstall %sAddress Book Palm Sync. This will restore Palm Desktop synchronization. Do you want to continue?&quot;</span>
<a href="#l29.105"></a><span id="l29.105" class="difflineminus">-    IDS_ERR_REGISTERING_MOZ_DLL </span>
<a href="#l29.106"></a><span id="l29.106" class="difflineminus">-                            &quot;Failed to register the Palm Sync Support Proxy Dll while installing the %sAddress Book Palm Sync Conduit.&quot;</span>
<a href="#l29.107"></a><span id="l29.107" class="difflineminus">-END</span>
<a href="#l29.108"></a><span id="l29.108" class="difflineminus">-</span>
<a href="#l29.109"></a><span id="l29.109" class="difflineminus">-#endif    // English (U.S.) resources</span>
<a href="#l29.110"></a><span id="l29.110" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1">deleted file mode 100644</span>
<a href="#l30.2"></a><span id="l30.2">index f8acc71c2506733106ec3a9f48c16fbb7e52b064..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l30.3"></a><span id="l30.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1">deleted file mode 100644</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineminus">--- a/mailnews/extensions/palmsync/installer/resource.h</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineplus">+++ /dev/null</span>
<a href="#l31.4"></a><span id="l31.4" class="difflineat">@@ -1,60 +0,0 @@</span>
<a href="#l31.5"></a><span id="l31.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l31.6"></a><span id="l31.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l31.7"></a><span id="l31.7" class="difflineminus">- *</span>
<a href="#l31.8"></a><span id="l31.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l31.9"></a><span id="l31.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l31.10"></a><span id="l31.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l31.11"></a><span id="l31.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">- *</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">- * License.</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineminus">- *</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineminus">- *</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineminus">- *</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineminus">- *</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineminus">- *</span>
<a href="#l31.29"></a><span id="l31.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l31.34"></a><span id="l31.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l31.35"></a><span id="l31.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l31.36"></a><span id="l31.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l31.37"></a><span id="l31.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l31.38"></a><span id="l31.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l31.39"></a><span id="l31.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l31.40"></a><span id="l31.40" class="difflineminus">- *</span>
<a href="#l31.41"></a><span id="l31.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l31.42"></a><span id="l31.42" class="difflineminus">-</span>
<a href="#l31.43"></a><span id="l31.43" class="difflineminus">-#define IDS_APP_TITLE_INSTALL           103</span>
<a href="#l31.44"></a><span id="l31.44" class="difflineminus">-#define IDS_APP_TITLE_UNINSTALL         104</span>
<a href="#l31.45"></a><span id="l31.45" class="difflineminus">-#define IDS_CONDUIT_TITLE               105</span>
<a href="#l31.46"></a><span id="l31.46" class="difflineminus">-#define IDI_PALMSYNCINSTALL             107</span>
<a href="#l31.47"></a><span id="l31.47" class="difflineminus">-#define IDI_SMALL                       108</span>
<a href="#l31.48"></a><span id="l31.48" class="difflineminus">-#define IDC_PALMSYNCINSTALL             109</span>
<a href="#l31.49"></a><span id="l31.49" class="difflineminus">-</span>
<a href="#l31.50"></a><span id="l31.50" class="difflineminus">-// all error messages should be between the range of 110 and 140</span>
<a href="#l31.51"></a><span id="l31.51" class="difflineminus">-#define IDS_ERR_GENERAL                 110</span>
<a href="#l31.52"></a><span id="l31.52" class="difflineminus">-#define IDS_ERR_LOADING_CONDMGR         111</span>
<a href="#l31.53"></a><span id="l31.53" class="difflineminus">-#define IDS_ERR_HSAPI_NOT_FOUND         112</span>
<a href="#l31.54"></a><span id="l31.54" class="difflineminus">-#define IDS_ERR_CONDUIT_NOT_FOUND       113</span>
<a href="#l31.55"></a><span id="l31.55" class="difflineminus">-#define IDS_ERR_HOTSYNC_IN_PROGRESS     114</span>
<a href="#l31.56"></a><span id="l31.56" class="difflineminus">-#define IDS_ERR_FINDING_INSTALL_DIR     115</span>
<a href="#l31.57"></a><span id="l31.57" class="difflineminus">-#define IDS_SUCCESS_INSTALL             116</span>
<a href="#l31.58"></a><span id="l31.58" class="difflineminus">-#define IDS_CONFIRM_INSTALL             117</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineminus">-#define IDS_CONFIRM_UNINSTALL           118</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineminus">-#define IDS_SUCCESS_UNINSTALL           119</span>
<a href="#l31.61"></a><span id="l31.61" class="difflineminus">-#define IDS_ERR_REGISTERING_MOZ_DLL     120</span>
<a href="#l31.62"></a><span id="l31.62" class="difflineminus">-#define IDS_ERR_UNREGISTERING_MOZ_DLL   121</span>
<a href="#l31.63"></a><span id="l31.63" class="difflineminus">-#define IDS_ERR_MAX			140</span>
<a href="#l31.64"></a><span id="l31.64" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1">deleted file mode 100644</span>
<a href="#l32.2"></a><span id="l32.2">index e285f82c10038af3ed023278c9451d39d129f513..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l32.3"></a><span id="l32.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1">deleted file mode 100644</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineminus">--- a/mailnews/extensions/palmsync/palmsync.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineplus">+++ /dev/null</span>
<a href="#l33.4"></a><span id="l33.4" class="difflineat">@@ -1,7 +0,0 @@</span>
<a href="#l33.5"></a><span id="l33.5" class="difflineminus">-/*</span>
<a href="#l33.6"></a><span id="l33.6" class="difflineminus">-   Default pref values for the PalmSync Extension</span>
<a href="#l33.7"></a><span id="l33.7" class="difflineminus">-*/</span>
<a href="#l33.8"></a><span id="l33.8" class="difflineminus">-</span>
<a href="#l33.9"></a><span id="l33.9" class="difflineminus">-// global pref used to keep track of whether we have run PalmSyncInstall.exe </span>
<a href="#l33.10"></a><span id="l33.10" class="difflineminus">-// for the current installation of the extension.</span>
<a href="#l33.11"></a><span id="l33.11" class="difflineminus">-pref(&quot;extensions.palmsync.conduitRegistered&quot;, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1">deleted file mode 100644</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineminus">--- a/mailnews/extensions/palmsync/public/Makefile.in</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineplus">+++ /dev/null</span>
<a href="#l34.4"></a><span id="l34.4" class="difflineat">@@ -1,53 +0,0 @@</span>
<a href="#l34.5"></a><span id="l34.5" class="difflineminus">-#</span>
<a href="#l34.6"></a><span id="l34.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l34.7"></a><span id="l34.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l34.8"></a><span id="l34.8" class="difflineminus">-#</span>
<a href="#l34.9"></a><span id="l34.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l34.10"></a><span id="l34.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l34.11"></a><span id="l34.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-#</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineminus">-# License.</span>
<a href="#l34.18"></a><span id="l34.18" class="difflineminus">-#</span>
<a href="#l34.19"></a><span id="l34.19" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l34.20"></a><span id="l34.20" class="difflineminus">-#</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l34.23"></a><span id="l34.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l34.24"></a><span id="l34.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l34.25"></a><span id="l34.25" class="difflineminus">-#</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l34.27"></a><span id="l34.27" class="difflineminus">-#</span>
<a href="#l34.28"></a><span id="l34.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l34.29"></a><span id="l34.29" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l34.34"></a><span id="l34.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l34.35"></a><span id="l34.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l34.36"></a><span id="l34.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l34.38"></a><span id="l34.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineminus">-#</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineminus">-</span>
<a href="#l34.42"></a><span id="l34.42" class="difflineminus">-DEPTH		= ../../../..</span>
<a href="#l34.43"></a><span id="l34.43" class="difflineminus">-topsrcdir	= @top_srcdir@</span>
<a href="#l34.44"></a><span id="l34.44" class="difflineminus">-srcdir		= @srcdir@</span>
<a href="#l34.45"></a><span id="l34.45" class="difflineminus">-VPATH		= @srcdir@</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineminus">-</span>
<a href="#l34.47"></a><span id="l34.47" class="difflineminus">-include $(DEPTH)/config/autoconf.mk</span>
<a href="#l34.48"></a><span id="l34.48" class="difflineminus">-</span>
<a href="#l34.49"></a><span id="l34.49" class="difflineminus">-MODULE		= palmsync</span>
<a href="#l34.50"></a><span id="l34.50" class="difflineminus">-XPIDL_MODULE	= palmsync</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineminus">-XPI_NAME	= palmsync</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineminus">-</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineminus">-XPIDLSRCS	= \</span>
<a href="#l34.54"></a><span id="l34.54" class="difflineminus">-		nsIPalmSyncSupport.idl \</span>
<a href="#l34.55"></a><span id="l34.55" class="difflineminus">-		$(NULL)</span>
<a href="#l34.56"></a><span id="l34.56" class="difflineminus">-</span>
<a href="#l34.57"></a><span id="l34.57" class="difflineminus">-include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1">deleted file mode 100644</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineminus">--- a/mailnews/extensions/palmsync/public/nsIPalmSyncSupport.idl</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineplus">+++ /dev/null</span>
<a href="#l35.4"></a><span id="l35.4" class="difflineat">@@ -1,74 +0,0 @@</span>
<a href="#l35.5"></a><span id="l35.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l35.6"></a><span id="l35.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l35.7"></a><span id="l35.7" class="difflineminus">- *</span>
<a href="#l35.8"></a><span id="l35.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l35.9"></a><span id="l35.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l35.10"></a><span id="l35.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l35.11"></a><span id="l35.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">- *</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineminus">- * License.</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineminus">- *</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineminus">- *</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineminus">- *</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineminus">- *           Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineminus">- *</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l35.37"></a><span id="l35.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineminus">- *</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l35.41"></a><span id="l35.41" class="difflineminus">-</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineminus">-#include &quot;nsISupports.idl&quot;</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineminus">-</span>
<a href="#l35.44"></a><span id="l35.44" class="difflineminus">-/**</span>
<a href="#l35.45"></a><span id="l35.45" class="difflineminus">- * This interface provides support for registering Mozilla as a COM component</span>
<a href="#l35.46"></a><span id="l35.46" class="difflineminus">- * for enabling Palm-Mozilla Address Book (and also other when implemented) Synchronization</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineminus">- * </span>
<a href="#l35.48"></a><span id="l35.48" class="difflineminus">- */</span>
<a href="#l35.49"></a><span id="l35.49" class="difflineminus">-</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineminus">-[noscript, uuid(0071C291-CE82-11d6-B8A6-00B0D06E5F27)]</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineminus">-</span>
<a href="#l35.52"></a><span id="l35.52" class="difflineminus">-interface nsIPalmSyncSupport : nsISupports {</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineminus">-</span>
<a href="#l35.54"></a><span id="l35.54" class="difflineminus">-   /** Initiates PalmSync support</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineminus">-    */</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineminus">-   void initializePalmSyncSupport();</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineminus">-</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineminus">-   /** Register the PalmSync COM interface for IPC</span>
<a href="#l35.59"></a><span id="l35.59" class="difflineminus">-     * This is called only once from the installer</span>
<a href="#l35.60"></a><span id="l35.60" class="difflineminus">-     */</span>
<a href="#l35.61"></a><span id="l35.61" class="difflineminus">-   void registerPalmSync();</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineminus">-</span>
<a href="#l35.63"></a><span id="l35.63" class="difflineminus">-   /** Unregister the PalmSync COM interface for IPC</span>
<a href="#l35.64"></a><span id="l35.64" class="difflineminus">-     * This is called only once from the installer</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineminus">-     */</span>
<a href="#l35.66"></a><span id="l35.66" class="difflineminus">-   void unRegisterPalmSync();</span>
<a href="#l35.67"></a><span id="l35.67" class="difflineminus">-</span>
<a href="#l35.68"></a><span id="l35.68" class="difflineminus">-   /**  Shuts down the PalmSync support</span>
<a href="#l35.69"></a><span id="l35.69" class="difflineminus">-    */</span>
<a href="#l35.70"></a><span id="l35.70" class="difflineminus">-   void shutdownPalmSyncSupport();</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineminus">-};</span>
<a href="#l35.72"></a><span id="l35.72" class="difflineminus">-</span>
<a href="#l35.73"></a><span id="l35.73" class="difflineminus">-%{C++</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineminus">-#define NS_IPALMSYNCSUPPORT_CONTRACTID    &quot;@mozilla.org/palmsyncsupport;1&quot;</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineminus">-#define NS_IPALMSYNCSUPPORT_CLASSNAME     &quot;Mozilla PalmSync Support&quot;</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineminus">-%}</span>
<a href="#l35.77"></a><span id="l35.77" class="difflineminus">-</span>
<a href="#l35.78"></a><span id="l35.78" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1">deleted file mode 100644</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/Makefile.in</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineplus">+++ /dev/null</span>
<a href="#l36.4"></a><span id="l36.4" class="difflineat">@@ -1,125 +0,0 @@</span>
<a href="#l36.5"></a><span id="l36.5" class="difflineminus">-#</span>
<a href="#l36.6"></a><span id="l36.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l36.7"></a><span id="l36.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l36.8"></a><span id="l36.8" class="difflineminus">-#</span>
<a href="#l36.9"></a><span id="l36.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l36.10"></a><span id="l36.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l36.11"></a><span id="l36.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-#</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineminus">-# License.</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineminus">-#</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l36.20"></a><span id="l36.20" class="difflineminus">-#</span>
<a href="#l36.21"></a><span id="l36.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l36.23"></a><span id="l36.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l36.24"></a><span id="l36.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l36.25"></a><span id="l36.25" class="difflineminus">-#</span>
<a href="#l36.26"></a><span id="l36.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineminus">-#</span>
<a href="#l36.28"></a><span id="l36.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l36.29"></a><span id="l36.29" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l36.30"></a><span id="l36.30" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l36.34"></a><span id="l36.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l36.35"></a><span id="l36.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l36.37"></a><span id="l36.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l36.38"></a><span id="l36.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l36.39"></a><span id="l36.39" class="difflineminus">-#</span>
<a href="#l36.40"></a><span id="l36.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l36.41"></a><span id="l36.41" class="difflineminus">-</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineminus">-DEPTH       = ../../../..</span>
<a href="#l36.43"></a><span id="l36.43" class="difflineminus">-topsrcdir   = @top_srcdir@</span>
<a href="#l36.44"></a><span id="l36.44" class="difflineminus">-srcdir      = @srcdir@</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineminus">-VPATH       = @srcdir@</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineminus">-</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineminus">-include $(DEPTH)/config/autoconf.mk</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineminus">-</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineminus">-MODULE			= palmsync</span>
<a href="#l36.50"></a><span id="l36.50" class="difflineminus">-LIBRARY_NAME		= $(MODULE)</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineminus">-# Do not set EXPORT_LIBRARY as we do not want palmsync in the static libs list</span>
<a href="#l36.52"></a><span id="l36.52" class="difflineminus">-IS_COMPONENT		= 1</span>
<a href="#l36.53"></a><span id="l36.53" class="difflineminus">-FORCE_SHARED_LIB	= 1</span>
<a href="#l36.54"></a><span id="l36.54" class="difflineminus">-ifndef MOZ_INCOMPLETE_EXTERNAL_LINKAGE</span>
<a href="#l36.55"></a><span id="l36.55" class="difflineminus">-MOZILLA_INTERNAL_API	= 1</span>
<a href="#l36.56"></a><span id="l36.56" class="difflineminus">-endif</span>
<a href="#l36.57"></a><span id="l36.57" class="difflineminus">-XPI_NAME		= palmsync</span>
<a href="#l36.58"></a><span id="l36.58" class="difflineminus">-</span>
<a href="#l36.59"></a><span id="l36.59" class="difflineminus">-REQUIRES = \</span>
<a href="#l36.60"></a><span id="l36.60" class="difflineminus">-	xpcom \</span>
<a href="#l36.61"></a><span id="l36.61" class="difflineminus">-	PalmSyncProxy \</span>
<a href="#l36.62"></a><span id="l36.62" class="difflineminus">-	embedcomponents \</span>
<a href="#l36.63"></a><span id="l36.63" class="difflineminus">-	pref \</span>
<a href="#l36.64"></a><span id="l36.64" class="difflineminus">-	string \</span>
<a href="#l36.65"></a><span id="l36.65" class="difflineminus">-	rdf \</span>
<a href="#l36.66"></a><span id="l36.66" class="difflineminus">-	rdfutil \</span>
<a href="#l36.67"></a><span id="l36.67" class="difflineminus">-	mork \</span>
<a href="#l36.68"></a><span id="l36.68" class="difflineminus">-	unicharutil \</span>
<a href="#l36.69"></a><span id="l36.69" class="difflineminus">-	MapiProxy \</span>
<a href="#l36.70"></a><span id="l36.70" class="difflineminus">-	locale \</span>
<a href="#l36.71"></a><span id="l36.71" class="difflineminus">-	msgbase \</span>
<a href="#l36.72"></a><span id="l36.72" class="difflineminus">-	msgbaseutil \</span>
<a href="#l36.73"></a><span id="l36.73" class="difflineminus">-	necko \</span>
<a href="#l36.74"></a><span id="l36.74" class="difflineminus">-	addrbook \</span>
<a href="#l36.75"></a><span id="l36.75" class="difflineminus">-	xulapp \</span>
<a href="#l36.76"></a><span id="l36.76" class="difflineminus">-	extensions \</span>
<a href="#l36.77"></a><span id="l36.77" class="difflineminus">-	$(NULL)</span>
<a href="#l36.78"></a><span id="l36.78" class="difflineminus">-</span>
<a href="#l36.79"></a><span id="l36.79" class="difflineminus">-CPPSRCS = \</span>
<a href="#l36.80"></a><span id="l36.80" class="difflineminus">-        nsPalmSyncSupport.cpp \</span>
<a href="#l36.81"></a><span id="l36.81" class="difflineminus">-        PalmSyncFactory.cpp \</span>
<a href="#l36.82"></a><span id="l36.82" class="difflineminus">-        PalmSyncImp.cpp \</span>
<a href="#l36.83"></a><span id="l36.83" class="difflineminus">-        Registry.cpp \</span>
<a href="#l36.84"></a><span id="l36.84" class="difflineminus">-        nsAbIPCCard.cpp \</span>
<a href="#l36.85"></a><span id="l36.85" class="difflineminus">-        nsAbPalmSync.cpp \</span>
<a href="#l36.86"></a><span id="l36.86" class="difflineminus">-        $(NULL)</span>
<a href="#l36.87"></a><span id="l36.87" class="difflineminus">-</span>
<a href="#l36.88"></a><span id="l36.88" class="difflineminus">-EXPORTS = \</span>
<a href="#l36.89"></a><span id="l36.89" class="difflineminus">-        nsAbIPCCard.h \</span>
<a href="#l36.90"></a><span id="l36.90" class="difflineminus">-        nsAbPalmSync.h \</span>
<a href="#l36.91"></a><span id="l36.91" class="difflineminus">-        $(NULL)</span>
<a href="#l36.92"></a><span id="l36.92" class="difflineminus">-</span>
<a href="#l36.93"></a><span id="l36.93" class="difflineminus">-LOBJS = ../build/IPalmSync_i.$(OBJ_SUFFIX)</span>
<a href="#l36.94"></a><span id="l36.94" class="difflineminus">-</span>
<a href="#l36.95"></a><span id="l36.95" class="difflineminus">-ifndef MOZ_STATIC_MAIL_BUILD</span>
<a href="#l36.96"></a><span id="l36.96" class="difflineminus">-ifeq ($(USE_SHORT_LIBNAME),1)</span>
<a href="#l36.97"></a><span id="l36.97" class="difflineminus">-EXTRA_DSO_LIBS  = msgbsutl</span>
<a href="#l36.98"></a><span id="l36.98" class="difflineminus">-else</span>
<a href="#l36.99"></a><span id="l36.99" class="difflineminus">-EXTRA_DSO_LIBS  = msgbaseutil</span>
<a href="#l36.100"></a><span id="l36.100" class="difflineminus">-endif</span>
<a href="#l36.101"></a><span id="l36.101" class="difflineminus">-</span>
<a href="#l36.102"></a><span id="l36.102" class="difflineminus">-else</span>
<a href="#l36.103"></a><span id="l36.103" class="difflineminus">-SHARED_LIBRARY_LIBS = ../../../base/util/$(LIB_PREFIX)msgbsutl_s.$(LIB_SUFFIX)</span>
<a href="#l36.104"></a><span id="l36.104" class="difflineminus">-endif</span>
<a href="#l36.105"></a><span id="l36.105" class="difflineminus">-</span>
<a href="#l36.106"></a><span id="l36.106" class="difflineminus">-ifdef MOZILLA_INTERNAL_API</span>
<a href="#l36.107"></a><span id="l36.107" class="difflineminus">-EXTRA_DSO_LDOPTS= \</span>
<a href="#l36.108"></a><span id="l36.108" class="difflineminus">-        ../../../addrbook/src/$(LIB_PREFIX)addrbook_s.$(LIB_SUFFIX) \</span>
<a href="#l36.109"></a><span id="l36.109" class="difflineminus">-        $(EXTRA_DSO_LIBS) \</span>
<a href="#l36.110"></a><span id="l36.110" class="difflineminus">-        $(XPCOM_LIBS) \</span>
<a href="#l36.111"></a><span id="l36.111" class="difflineminus">-        $(MOZ_UNICHARUTIL_LIBS) \</span>
<a href="#l36.112"></a><span id="l36.112" class="difflineminus">-        $(NSPR_LIBS) \</span>
<a href="#l36.113"></a><span id="l36.113" class="difflineminus">-        $(NULL)</span>
<a href="#l36.114"></a><span id="l36.114" class="difflineminus">-else</span>
<a href="#l36.115"></a><span id="l36.115" class="difflineminus">-EXTRA_DSO_LDOPTS= \</span>
<a href="#l36.116"></a><span id="l36.116" class="difflineminus">-        ../../../addrbook/src/$(LIB_PREFIX)addrbook_s.$(LIB_SUFFIX) \</span>
<a href="#l36.117"></a><span id="l36.117" class="difflineminus">-	$(LIBS_DIR) \</span>
<a href="#l36.118"></a><span id="l36.118" class="difflineminus">-	$(EXTRA_DSO_LIBS) \</span>
<a href="#l36.119"></a><span id="l36.119" class="difflineminus">-	$(XPCOM_GLUE_LDOPTS) \</span>
<a href="#l36.120"></a><span id="l36.120" class="difflineminus">-	$(call EXPAND_LIBNAME_PATH,unicharutil_external_s,$(LIBXUL_DIST)/lib) \</span>
<a href="#l36.121"></a><span id="l36.121" class="difflineminus">-	$(NSPR_LIBS) \</span>
<a href="#l36.122"></a><span id="l36.122" class="difflineminus">-	$(NULL)</span>
<a href="#l36.123"></a><span id="l36.123" class="difflineminus">-endif</span>
<a href="#l36.124"></a><span id="l36.124" class="difflineminus">-</span>
<a href="#l36.125"></a><span id="l36.125" class="difflineminus">-OS_LIBS     += ole32.lib shell32.lib</span>
<a href="#l36.126"></a><span id="l36.126" class="difflineminus">-</span>
<a href="#l36.127"></a><span id="l36.127" class="difflineminus">-include $(topsrcdir)/config/rules.mk</span>
<a href="#l36.128"></a><span id="l36.128" class="difflineminus">-</span>
<a href="#l36.129"></a><span id="l36.129" class="difflineminus">-DEFINES += -DUNICODE -D_UNICODE</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1">deleted file mode 100644</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/PalmSyncFactory.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineplus">+++ /dev/null</span>
<a href="#l37.4"></a><span id="l37.4" class="difflineat">@@ -1,118 +0,0 @@</span>
<a href="#l37.5"></a><span id="l37.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l37.6"></a><span id="l37.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l37.7"></a><span id="l37.7" class="difflineminus">- *</span>
<a href="#l37.8"></a><span id="l37.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l37.9"></a><span id="l37.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l37.10"></a><span id="l37.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l37.11"></a><span id="l37.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">- *</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineminus">- * License.</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineminus">- *</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineminus">- * The Original Code is Mozilla</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineminus">- *</span>
<a href="#l37.20"></a><span id="l37.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l37.21"></a><span id="l37.21" class="difflineminus">- * Netscape Communications Corp.</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l37.23"></a><span id="l37.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineminus">- *</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineminus">- * Contributors:</span>
<a href="#l37.26"></a><span id="l37.26" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineminus">- *</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l37.30"></a><span id="l37.30" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l37.33"></a><span id="l37.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l37.34"></a><span id="l37.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l37.35"></a><span id="l37.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l37.36"></a><span id="l37.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l37.37"></a><span id="l37.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l37.38"></a><span id="l37.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l37.39"></a><span id="l37.39" class="difflineminus">- *</span>
<a href="#l37.40"></a><span id="l37.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l37.41"></a><span id="l37.41" class="difflineminus">-</span>
<a href="#l37.42"></a><span id="l37.42" class="difflineminus">-// #undef UNICODE</span>
<a href="#l37.43"></a><span id="l37.43" class="difflineminus">-// #undef _UNICODE</span>
<a href="#l37.44"></a><span id="l37.44" class="difflineminus">-</span>
<a href="#l37.45"></a><span id="l37.45" class="difflineminus">-#include &quot;PalmSyncImp.h&quot;</span>
<a href="#l37.46"></a><span id="l37.46" class="difflineminus">-#include &quot;PalmSyncFactory.h&quot;</span>
<a href="#l37.47"></a><span id="l37.47" class="difflineminus">-</span>
<a href="#l37.48"></a><span id="l37.48" class="difflineminus">-CPalmSyncFactory ::CPalmSyncFactory()</span>
<a href="#l37.49"></a><span id="l37.49" class="difflineminus">-: m_cRef(1)</span>
<a href="#l37.50"></a><span id="l37.50" class="difflineminus">-{</span>
<a href="#l37.51"></a><span id="l37.51" class="difflineminus">-}</span>
<a href="#l37.52"></a><span id="l37.52" class="difflineminus">-</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineminus">-CPalmSyncFactory::~CPalmSyncFactory()</span>
<a href="#l37.54"></a><span id="l37.54" class="difflineminus">-{</span>
<a href="#l37.55"></a><span id="l37.55" class="difflineminus">-}</span>
<a href="#l37.56"></a><span id="l37.56" class="difflineminus">-</span>
<a href="#l37.57"></a><span id="l37.57" class="difflineminus">-STDMETHODIMP CPalmSyncFactory::QueryInterface(const IID&amp; aIid, void** aPpv)</span>
<a href="#l37.58"></a><span id="l37.58" class="difflineminus">-{    </span>
<a href="#l37.59"></a><span id="l37.59" class="difflineminus">-    if ((aIid == IID_IUnknown) || (aIid == IID_IClassFactory))</span>
<a href="#l37.60"></a><span id="l37.60" class="difflineminus">-    {</span>
<a href="#l37.61"></a><span id="l37.61" class="difflineminus">-        *aPpv = static_cast&lt;IClassFactory*&gt;(this); </span>
<a href="#l37.62"></a><span id="l37.62" class="difflineminus">-    }</span>
<a href="#l37.63"></a><span id="l37.63" class="difflineminus">-    else</span>
<a href="#l37.64"></a><span id="l37.64" class="difflineminus">-    {</span>
<a href="#l37.65"></a><span id="l37.65" class="difflineminus">-        *aPpv = NULL;</span>
<a href="#l37.66"></a><span id="l37.66" class="difflineminus">-        return E_NOINTERFACE;</span>
<a href="#l37.67"></a><span id="l37.67" class="difflineminus">-    }</span>
<a href="#l37.68"></a><span id="l37.68" class="difflineminus">-    reinterpret_cast&lt;IUnknown*&gt;(*aPpv)-&gt;AddRef();</span>
<a href="#l37.69"></a><span id="l37.69" class="difflineminus">-    return S_OK;</span>
<a href="#l37.70"></a><span id="l37.70" class="difflineminus">-}</span>
<a href="#l37.71"></a><span id="l37.71" class="difflineminus">-</span>
<a href="#l37.72"></a><span id="l37.72" class="difflineminus">-STDMETHODIMP_(ULONG) CPalmSyncFactory::AddRef()</span>
<a href="#l37.73"></a><span id="l37.73" class="difflineminus">-{</span>
<a href="#l37.74"></a><span id="l37.74" class="difflineminus">-    return (PR_AtomicIncrement(&amp;m_cRef));</span>
<a href="#l37.75"></a><span id="l37.75" class="difflineminus">-}</span>
<a href="#l37.76"></a><span id="l37.76" class="difflineminus">-</span>
<a href="#l37.77"></a><span id="l37.77" class="difflineminus">-STDMETHODIMP_(ULONG) CPalmSyncFactory::Release() </span>
<a href="#l37.78"></a><span id="l37.78" class="difflineminus">-{</span>
<a href="#l37.79"></a><span id="l37.79" class="difflineminus">-    PRInt32 temp;</span>
<a href="#l37.80"></a><span id="l37.80" class="difflineminus">-    temp = PR_AtomicDecrement(&amp;m_cRef);</span>
<a href="#l37.81"></a><span id="l37.81" class="difflineminus">-    if (m_cRef == 0)</span>
<a href="#l37.82"></a><span id="l37.82" class="difflineminus">-    {</span>
<a href="#l37.83"></a><span id="l37.83" class="difflineminus">-        delete this;</span>
<a href="#l37.84"></a><span id="l37.84" class="difflineminus">-        return 0;</span>
<a href="#l37.85"></a><span id="l37.85" class="difflineminus">-    }</span>
<a href="#l37.86"></a><span id="l37.86" class="difflineminus">-</span>
<a href="#l37.87"></a><span id="l37.87" class="difflineminus">-    return temp;</span>
<a href="#l37.88"></a><span id="l37.88" class="difflineminus">-}</span>
<a href="#l37.89"></a><span id="l37.89" class="difflineminus">-</span>
<a href="#l37.90"></a><span id="l37.90" class="difflineminus">-STDMETHODIMP CPalmSyncFactory::CreateInstance(IUnknown* aUnknownOuter,</span>
<a href="#l37.91"></a><span id="l37.91" class="difflineminus">-                                           const IID&amp; aIid,</span>
<a href="#l37.92"></a><span id="l37.92" class="difflineminus">-                                           void** aPpv) </span>
<a href="#l37.93"></a><span id="l37.93" class="difflineminus">-{</span>
<a href="#l37.94"></a><span id="l37.94" class="difflineminus">-    // Cannot aggregate.</span>
<a href="#l37.95"></a><span id="l37.95" class="difflineminus">-</span>
<a href="#l37.96"></a><span id="l37.96" class="difflineminus">-    if (aUnknownOuter != NULL)</span>
<a href="#l37.97"></a><span id="l37.97" class="difflineminus">-    {</span>
<a href="#l37.98"></a><span id="l37.98" class="difflineminus">-        return CLASS_E_NOAGGREGATION ;</span>
<a href="#l37.99"></a><span id="l37.99" class="difflineminus">-    }</span>
<a href="#l37.100"></a><span id="l37.100" class="difflineminus">-</span>
<a href="#l37.101"></a><span id="l37.101" class="difflineminus">-    // Create component.</span>
<a href="#l37.102"></a><span id="l37.102" class="difflineminus">-</span>
<a href="#l37.103"></a><span id="l37.103" class="difflineminus">-    CPalmSyncImp* pImp = new CPalmSyncImp();</span>
<a href="#l37.104"></a><span id="l37.104" class="difflineminus">-    if (pImp == NULL)</span>
<a href="#l37.105"></a><span id="l37.105" class="difflineminus">-    {</span>
<a href="#l37.106"></a><span id="l37.106" class="difflineminus">-        return E_OUTOFMEMORY ;</span>
<a href="#l37.107"></a><span id="l37.107" class="difflineminus">-    }</span>
<a href="#l37.108"></a><span id="l37.108" class="difflineminus">-</span>
<a href="#l37.109"></a><span id="l37.109" class="difflineminus">-    // Get the requested interface.</span>
<a href="#l37.110"></a><span id="l37.110" class="difflineminus">-    HRESULT hr = pImp-&gt;QueryInterface(aIid, aPpv);</span>
<a href="#l37.111"></a><span id="l37.111" class="difflineminus">-</span>
<a href="#l37.112"></a><span id="l37.112" class="difflineminus">-    // Release the IUnknown pointer.</span>
<a href="#l37.113"></a><span id="l37.113" class="difflineminus">-    // (If QueryInterface failed, component will delete itself.)</span>
<a href="#l37.114"></a><span id="l37.114" class="difflineminus">-</span>
<a href="#l37.115"></a><span id="l37.115" class="difflineminus">-    pImp-&gt;Release();</span>
<a href="#l37.116"></a><span id="l37.116" class="difflineminus">-    return hr;</span>
<a href="#l37.117"></a><span id="l37.117" class="difflineminus">-}</span>
<a href="#l37.118"></a><span id="l37.118" class="difflineminus">-</span>
<a href="#l37.119"></a><span id="l37.119" class="difflineminus">-STDMETHODIMP CPalmSyncFactory::LockServer(PRBool aLock) </span>
<a href="#l37.120"></a><span id="l37.120" class="difflineminus">-{</span>
<a href="#l37.121"></a><span id="l37.121" class="difflineminus">-    return S_OK ;</span>
<a href="#l37.122"></a><span id="l37.122" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1">deleted file mode 100644</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/PalmSyncFactory.h</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineplus">+++ /dev/null</span>
<a href="#l38.4"></a><span id="l38.4" class="difflineat">@@ -1,70 +0,0 @@</span>
<a href="#l38.5"></a><span id="l38.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l38.6"></a><span id="l38.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l38.7"></a><span id="l38.7" class="difflineminus">- *</span>
<a href="#l38.8"></a><span id="l38.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l38.9"></a><span id="l38.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l38.10"></a><span id="l38.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l38.11"></a><span id="l38.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">- *</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineminus">- * License.</span>
<a href="#l38.17"></a><span id="l38.17" class="difflineminus">- *</span>
<a href="#l38.18"></a><span id="l38.18" class="difflineminus">- * The Original Code is Mozilla</span>
<a href="#l38.19"></a><span id="l38.19" class="difflineminus">- *</span>
<a href="#l38.20"></a><span id="l38.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineminus">- * Netscape Communications Corp.</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l38.23"></a><span id="l38.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l38.24"></a><span id="l38.24" class="difflineminus">- *</span>
<a href="#l38.25"></a><span id="l38.25" class="difflineminus">- * Contributors:</span>
<a href="#l38.26"></a><span id="l38.26" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l38.27"></a><span id="l38.27" class="difflineminus">- *</span>
<a href="#l38.28"></a><span id="l38.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l38.29"></a><span id="l38.29" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l38.37"></a><span id="l38.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l38.38"></a><span id="l38.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l38.39"></a><span id="l38.39" class="difflineminus">- *</span>
<a href="#l38.40"></a><span id="l38.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineminus">-</span>
<a href="#l38.42"></a><span id="l38.42" class="difflineminus">-#ifndef MSG_PALMSYNC_FACTORY_H</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineminus">-#define MSG_PALMSYNC_FACTORY_H</span>
<a href="#l38.44"></a><span id="l38.44" class="difflineminus">-</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l38.46"></a><span id="l38.46" class="difflineminus">-#include &lt;objbase.h&gt;</span>
<a href="#l38.47"></a><span id="l38.47" class="difflineminus">-#include &quot;nspr.h&quot;</span>
<a href="#l38.48"></a><span id="l38.48" class="difflineminus">-</span>
<a href="#l38.49"></a><span id="l38.49" class="difflineminus">-</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-class CPalmSyncFactory : public IClassFactory</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineminus">-{</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineminus">-public :</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineminus">-</span>
<a href="#l38.54"></a><span id="l38.54" class="difflineminus">-    // IUnknown</span>
<a href="#l38.55"></a><span id="l38.55" class="difflineminus">-</span>
<a href="#l38.56"></a><span id="l38.56" class="difflineminus">-    STDMETHODIMP            QueryInterface (REFIID aIid, void** aPpv);</span>
<a href="#l38.57"></a><span id="l38.57" class="difflineminus">-    STDMETHODIMP_(ULONG)    AddRef(void);</span>
<a href="#l38.58"></a><span id="l38.58" class="difflineminus">-    STDMETHODIMP_(ULONG)    Release(void);</span>
<a href="#l38.59"></a><span id="l38.59" class="difflineminus">-</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineminus">-    // IClassFactory</span>
<a href="#l38.61"></a><span id="l38.61" class="difflineminus">-</span>
<a href="#l38.62"></a><span id="l38.62" class="difflineminus">-    STDMETHODIMP        CreateInstance (LPUNKNOWN aUnkOuter, REFIID aIid, void **aPpv);</span>
<a href="#l38.63"></a><span id="l38.63" class="difflineminus">-    STDMETHODIMP        LockServer (BOOL aLock);</span>
<a href="#l38.64"></a><span id="l38.64" class="difflineminus">-</span>
<a href="#l38.65"></a><span id="l38.65" class="difflineminus">-    CPalmSyncFactory ();</span>
<a href="#l38.66"></a><span id="l38.66" class="difflineminus">-    ~CPalmSyncFactory ();</span>
<a href="#l38.67"></a><span id="l38.67" class="difflineminus">-</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineminus">-private :</span>
<a href="#l38.69"></a><span id="l38.69" class="difflineminus">-</span>
<a href="#l38.70"></a><span id="l38.70" class="difflineminus">-    PRInt32 m_cRef;</span>
<a href="#l38.71"></a><span id="l38.71" class="difflineminus">-};</span>
<a href="#l38.72"></a><span id="l38.72" class="difflineminus">-</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineminus">-#endif  // MSG_PALMSYNC_FACTORY_H</span>
<a href="#l38.74"></a><span id="l38.74" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1">deleted file mode 100644</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/PalmSyncImp.cpp</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineplus">+++ /dev/null</span>
<a href="#l39.4"></a><span id="l39.4" class="difflineat">@@ -1,515 +0,0 @@</span>
<a href="#l39.5"></a><span id="l39.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l39.6"></a><span id="l39.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l39.7"></a><span id="l39.7" class="difflineminus">- *</span>
<a href="#l39.8"></a><span id="l39.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l39.9"></a><span id="l39.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l39.10"></a><span id="l39.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l39.11"></a><span id="l39.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">- *</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l39.14"></a><span id="l39.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineminus">- * License.</span>
<a href="#l39.17"></a><span id="l39.17" class="difflineminus">- *</span>
<a href="#l39.18"></a><span id="l39.18" class="difflineminus">- * The Original Code is Mozilla</span>
<a href="#l39.19"></a><span id="l39.19" class="difflineminus">- *</span>
<a href="#l39.20"></a><span id="l39.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l39.21"></a><span id="l39.21" class="difflineminus">- * Netscape Communications Corp.</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l39.23"></a><span id="l39.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l39.24"></a><span id="l39.24" class="difflineminus">- *</span>
<a href="#l39.25"></a><span id="l39.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l39.26"></a><span id="l39.26" class="difflineminus">- *                 Rajiv Dayal (rdayal@netscape.com)</span>
<a href="#l39.27"></a><span id="l39.27" class="difflineminus">- *</span>
<a href="#l39.28"></a><span id="l39.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l39.29"></a><span id="l39.29" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l39.30"></a><span id="l39.30" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l39.33"></a><span id="l39.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l39.34"></a><span id="l39.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l39.35"></a><span id="l39.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l39.36"></a><span id="l39.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l39.37"></a><span id="l39.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l39.38"></a><span id="l39.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l39.39"></a><span id="l39.39" class="difflineminus">- *</span>
<a href="#l39.40"></a><span id="l39.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l39.41"></a><span id="l39.41" class="difflineminus">-</span>
<a href="#l39.42"></a><span id="l39.42" class="difflineminus">-#ifdef MOZ_LOGGING</span>
<a href="#l39.43"></a><span id="l39.43" class="difflineminus">-// sorry, this has to be before the pre-compiled header</span>
<a href="#l39.44"></a><span id="l39.44" class="difflineminus">-#define FORCE_PR_LOG /* Allow logging in the release build */</span>
<a href="#l39.45"></a><span id="l39.45" class="difflineminus">-#endif</span>
<a href="#l39.46"></a><span id="l39.46" class="difflineminus">-</span>
<a href="#l39.47"></a><span id="l39.47" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l39.48"></a><span id="l39.48" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l39.49"></a><span id="l39.49" class="difflineminus">-#include &quot;nsISupports.h&quot;</span>
<a href="#l39.50"></a><span id="l39.50" class="difflineminus">-</span>
<a href="#l39.51"></a><span id="l39.51" class="difflineminus">-#include &quot;IPalmSync.h&quot;</span>
<a href="#l39.52"></a><span id="l39.52" class="difflineminus">-#include &quot;PalmSyncImp.h&quot;</span>
<a href="#l39.53"></a><span id="l39.53" class="difflineminus">-#include &quot;PalmSyncFactory.h&quot;</span>
<a href="#l39.54"></a><span id="l39.54" class="difflineminus">-</span>
<a href="#l39.55"></a><span id="l39.55" class="difflineminus">-#include &quot;nsAbPalmSync.h&quot;</span>
<a href="#l39.56"></a><span id="l39.56" class="difflineminus">-#include &quot;nsMsgI18N.h&quot;</span>
<a href="#l39.57"></a><span id="l39.57" class="difflineminus">-#include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l39.58"></a><span id="l39.58" class="difflineminus">-#include &quot;nsRDFResource.h&quot;</span>
<a href="#l39.59"></a><span id="l39.59" class="difflineminus">-#include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l39.60"></a><span id="l39.60" class="difflineminus">-#include &quot;nsIAbManager.h&quot;</span>
<a href="#l39.61"></a><span id="l39.61" class="difflineminus">-#include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l39.62"></a><span id="l39.62" class="difflineminus">-</span>
<a href="#l39.63"></a><span id="l39.63" class="difflineminus">-#include &quot;nsIPrefService.h&quot;</span>
<a href="#l39.64"></a><span id="l39.64" class="difflineminus">-#include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l39.65"></a><span id="l39.65" class="difflineminus">-</span>
<a href="#l39.66"></a><span id="l39.66" class="difflineminus">-#include &quot;nspr.h&quot;</span>
<a href="#l39.67"></a><span id="l39.67" class="difflineminus">-PRLogModuleInfo *PALMSYNC;</span>
<a href="#l39.68"></a><span id="l39.68" class="difflineminus">-</span>
<a href="#l39.69"></a><span id="l39.69" class="difflineminus">-#define kPABDirectory  2  // defined in nsDirPrefs.h</span>
<a href="#l39.70"></a><span id="l39.70" class="difflineminus">-#define kMAPIDirectory 3</span>
<a href="#l39.71"></a><span id="l39.71" class="difflineminus">-</span>
<a href="#l39.72"></a><span id="l39.72" class="difflineminus">-CPalmSyncImp::CPalmSyncImp()</span>
<a href="#l39.73"></a><span id="l39.73" class="difflineminus">-: m_cRef(1),</span>
<a href="#l39.74"></a><span id="l39.74" class="difflineminus">-  m_PalmHotSync(nsnull)</span>
<a href="#l39.75"></a><span id="l39.75" class="difflineminus">-{</span>
<a href="#l39.76"></a><span id="l39.76" class="difflineminus">-  if (!PALMSYNC)</span>
<a href="#l39.77"></a><span id="l39.77" class="difflineminus">-    PALMSYNC = PR_NewLogModule(&quot;PALMSYNC&quot;);</span>
<a href="#l39.78"></a><span id="l39.78" class="difflineminus">-</span>
<a href="#l39.79"></a><span id="l39.79" class="difflineminus">-</span>
<a href="#l39.80"></a><span id="l39.80" class="difflineminus">-}</span>
<a href="#l39.81"></a><span id="l39.81" class="difflineminus">-</span>
<a href="#l39.82"></a><span id="l39.82" class="difflineminus">-CPalmSyncImp::~CPalmSyncImp() </span>
<a href="#l39.83"></a><span id="l39.83" class="difflineminus">-{ </span>
<a href="#l39.84"></a><span id="l39.84" class="difflineminus">-</span>
<a href="#l39.85"></a><span id="l39.85" class="difflineminus">-}</span>
<a href="#l39.86"></a><span id="l39.86" class="difflineminus">-</span>
<a href="#l39.87"></a><span id="l39.87" class="difflineminus">-STDMETHODIMP CPalmSyncImp::QueryInterface(const IID&amp; aIid, void** aPpv)</span>
<a href="#l39.88"></a><span id="l39.88" class="difflineminus">-{    </span>
<a href="#l39.89"></a><span id="l39.89" class="difflineminus">-    if (aIid == IID_IUnknown)</span>
<a href="#l39.90"></a><span id="l39.90" class="difflineminus">-    {</span>
<a href="#l39.91"></a><span id="l39.91" class="difflineminus">-        *aPpv = static_cast&lt;IPalmSync*&gt;(this); </span>
<a href="#l39.92"></a><span id="l39.92" class="difflineminus">-    }</span>
<a href="#l39.93"></a><span id="l39.93" class="difflineminus">-    else if (aIid == IID_IPalmSync)</span>
<a href="#l39.94"></a><span id="l39.94" class="difflineminus">-    {</span>
<a href="#l39.95"></a><span id="l39.95" class="difflineminus">-        *aPpv = static_cast&lt;IPalmSync*&gt;(this);</span>
<a href="#l39.96"></a><span id="l39.96" class="difflineminus">-    }</span>
<a href="#l39.97"></a><span id="l39.97" class="difflineminus">-    else</span>
<a href="#l39.98"></a><span id="l39.98" class="difflineminus">-    {</span>
<a href="#l39.99"></a><span id="l39.99" class="difflineminus">-        *aPpv = nsnull;</span>
<a href="#l39.100"></a><span id="l39.100" class="difflineminus">-        return E_NOINTERFACE;</span>
<a href="#l39.101"></a><span id="l39.101" class="difflineminus">-    }</span>
<a href="#l39.102"></a><span id="l39.102" class="difflineminus">-</span>
<a href="#l39.103"></a><span id="l39.103" class="difflineminus">-    reinterpret_cast&lt;IUnknown*&gt;(*aPpv)-&gt;AddRef();</span>
<a href="#l39.104"></a><span id="l39.104" class="difflineminus">-    return S_OK;</span>
<a href="#l39.105"></a><span id="l39.105" class="difflineminus">-}</span>
<a href="#l39.106"></a><span id="l39.106" class="difflineminus">-</span>
<a href="#l39.107"></a><span id="l39.107" class="difflineminus">-STDMETHODIMP_(ULONG) CPalmSyncImp::AddRef()</span>
<a href="#l39.108"></a><span id="l39.108" class="difflineminus">-{</span>
<a href="#l39.109"></a><span id="l39.109" class="difflineminus">-    return PR_AtomicIncrement(&amp;m_cRef);</span>
<a href="#l39.110"></a><span id="l39.110" class="difflineminus">-}</span>
<a href="#l39.111"></a><span id="l39.111" class="difflineminus">-</span>
<a href="#l39.112"></a><span id="l39.112" class="difflineminus">-STDMETHODIMP_(ULONG) CPalmSyncImp::Release() </span>
<a href="#l39.113"></a><span id="l39.113" class="difflineminus">-{</span>
<a href="#l39.114"></a><span id="l39.114" class="difflineminus">-    PRInt32 temp;</span>
<a href="#l39.115"></a><span id="l39.115" class="difflineminus">-    temp = PR_AtomicDecrement(&amp;m_cRef);</span>
<a href="#l39.116"></a><span id="l39.116" class="difflineminus">-    if (m_cRef == 0)</span>
<a href="#l39.117"></a><span id="l39.117" class="difflineminus">-    {</span>
<a href="#l39.118"></a><span id="l39.118" class="difflineminus">-        delete this;</span>
<a href="#l39.119"></a><span id="l39.119" class="difflineminus">-        return 0;</span>
<a href="#l39.120"></a><span id="l39.120" class="difflineminus">-    }</span>
<a href="#l39.121"></a><span id="l39.121" class="difflineminus">-</span>
<a href="#l39.122"></a><span id="l39.122" class="difflineminus">-    return temp;</span>
<a href="#l39.123"></a><span id="l39.123" class="difflineminus">-}</span>
<a href="#l39.124"></a><span id="l39.124" class="difflineminus">-</span>
<a href="#l39.125"></a><span id="l39.125" class="difflineminus">-STDMETHODIMP CPalmSyncImp::IsValid()</span>
<a href="#l39.126"></a><span id="l39.126" class="difflineminus">-{</span>
<a href="#l39.127"></a><span id="l39.127" class="difflineminus">-    return S_OK;</span>
<a href="#l39.128"></a><span id="l39.128" class="difflineminus">-}</span>
<a href="#l39.129"></a><span id="l39.129" class="difflineminus">-</span>
<a href="#l39.130"></a><span id="l39.130" class="difflineminus">-// Get the list of Address Books for the currently logged in user profile</span>
<a href="#l39.131"></a><span id="l39.131" class="difflineminus">-STDMETHODIMP CPalmSyncImp::nsGetABList(BOOL aIsUnicode, short * aABListCount,</span>
<a href="#l39.132"></a><span id="l39.132" class="difflineminus">-                        lpnsMozABDesc * aABList, long ** aABCatIndexList, BOOL ** aDirFlagsList)</span>
<a href="#l39.133"></a><span id="l39.133" class="difflineminus">-{</span>
<a href="#l39.134"></a><span id="l39.134" class="difflineminus">-  if (!aABListCount || !aABList || !aABCatIndexList ||!aDirFlagsList)</span>
<a href="#l39.135"></a><span id="l39.135" class="difflineminus">-        return E_FAIL;</span>
<a href="#l39.136"></a><span id="l39.136" class="difflineminus">-  *aABListCount = 0;</span>
<a href="#l39.137"></a><span id="l39.137" class="difflineminus">-</span>
<a href="#l39.138"></a><span id="l39.138" class="difflineminus">-  nsresult rv;</span>
<a href="#l39.139"></a><span id="l39.139" class="difflineminus">-  nsCOMPtr&lt;nsIAbManager&gt; abManager(do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l39.140"></a><span id="l39.140" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l39.141"></a><span id="l39.141" class="difflineminus">-    return E_FAIL;</span>
<a href="#l39.142"></a><span id="l39.142" class="difflineminus">-</span>
<a href="#l39.143"></a><span id="l39.143" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; subDirectories;</span>
<a href="#l39.144"></a><span id="l39.144" class="difflineminus">-  if (NS_SUCCEEDED(abManager-&gt;GetDirectories(getter_AddRefs(subDirectories))) &amp;&amp;</span>
<a href="#l39.145"></a><span id="l39.145" class="difflineminus">-      subDirectories)</span>
<a href="#l39.146"></a><span id="l39.146" class="difflineminus">-  {</span>
<a href="#l39.147"></a><span id="l39.147" class="difflineminus">-    // Get the total number of addrbook.</span>
<a href="#l39.148"></a><span id="l39.148" class="difflineminus">-    PRInt16 count=0;</span>
<a href="#l39.149"></a><span id="l39.149" class="difflineminus">-    nsCOMPtr&lt;nsISupports&gt; item;</span>
<a href="#l39.150"></a><span id="l39.150" class="difflineminus">-    PRBool hasMore;</span>
<a href="#l39.151"></a><span id="l39.151" class="difflineminus">-    while (NS_SUCCEEDED(rv = subDirectories-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l39.152"></a><span id="l39.152" class="difflineminus">-    {</span>
<a href="#l39.153"></a><span id="l39.153" class="difflineminus">-        if (NS_SUCCEEDED(subDirectories-&gt;GetNext(getter_AddRefs(item))))</span>
<a href="#l39.154"></a><span id="l39.154" class="difflineminus">-        {</span>
<a href="#l39.155"></a><span id="l39.155" class="difflineminus">-          nsCOMPtr&lt;nsIAbDirectory&gt; directory(do_QueryInterface(item, &amp;rv));</span>
<a href="#l39.156"></a><span id="l39.156" class="difflineminus">-          if (NS_SUCCEEDED(rv))</span>
<a href="#l39.157"></a><span id="l39.157" class="difflineminus">-          {</span>
<a href="#l39.158"></a><span id="l39.158" class="difflineminus">-              nsCAutoString fileName;</span>
<a href="#l39.159"></a><span id="l39.159" class="difflineminus">-              rv = directory-&gt;GetFileName(fileName);</span>
<a href="#l39.160"></a><span id="l39.160" class="difflineminus">-              if(NS_FAILED(rv)) </span>
<a href="#l39.161"></a><span id="l39.161" class="difflineminus">-                continue;</span>
<a href="#l39.162"></a><span id="l39.162" class="difflineminus">-              PRInt32 dirType;</span>
<a href="#l39.163"></a><span id="l39.163" class="difflineminus">-              rv = directory-&gt;GetDirType(&amp;dirType);</span>
<a href="#l39.164"></a><span id="l39.164" class="difflineminus">-              if(NS_FAILED(rv)) </span>
<a href="#l39.165"></a><span id="l39.165" class="difflineminus">-                continue;</span>
<a href="#l39.166"></a><span id="l39.166" class="difflineminus">-</span>
<a href="#l39.167"></a><span id="l39.167" class="difflineminus">-              PRBool disableThisAB;</span>
<a href="#l39.168"></a><span id="l39.168" class="difflineminus">-              rv = directory-&gt;GetBoolValue(&quot;disablePalmSync&quot;,</span>
<a href="#l39.169"></a><span id="l39.169" class="difflineminus">-                                           PR_FALSE, &amp;disableThisAB);</span>
<a href="#l39.170"></a><span id="l39.170" class="difflineminus">-              if (NS_FAILED(rv))</span>
<a href="#l39.171"></a><span id="l39.171" class="difflineminus">-                continue;</span>
<a href="#l39.172"></a><span id="l39.172" class="difflineminus">-</span>
<a href="#l39.173"></a><span id="l39.173" class="difflineminus">-              // Skip/Ignore 4.X addrbooks (ie, with &quot;.na2&quot; extension), and non personal AB's</span>
<a href="#l39.174"></a><span id="l39.174" class="difflineminus">-              if (disableThisAB || ((fileName.Length() &gt; kABFileName_PreviousSuffixLen) &amp;&amp; </span>
<a href="#l39.175"></a><span id="l39.175" class="difflineminus">-                   strcmp(fileName.get() + fileName.Length() - kABFileName_PreviousSuffixLen, kABFileName_PreviousSuffix) == 0) ||</span>
<a href="#l39.176"></a><span id="l39.176" class="difflineminus">-                    (dirType != kPABDirectory &amp;&amp; dirType != kMAPIDirectory))</span>
<a href="#l39.177"></a><span id="l39.177" class="difflineminus">-                    continue;</span>
<a href="#l39.178"></a><span id="l39.178" class="difflineminus">-          }</span>
<a href="#l39.179"></a><span id="l39.179" class="difflineminus">-        }</span>
<a href="#l39.180"></a><span id="l39.180" class="difflineminus">-        count++;</span>
<a href="#l39.181"></a><span id="l39.181" class="difflineminus">-    }</span>
<a href="#l39.182"></a><span id="l39.182" class="difflineminus">-</span>
<a href="#l39.183"></a><span id="l39.183" class="difflineminus">-    if (!count)</span>
<a href="#l39.184"></a><span id="l39.184" class="difflineminus">-      return E_FAIL;  // should not happen but just in case.</span>
<a href="#l39.185"></a><span id="l39.185" class="difflineminus">-</span>
<a href="#l39.186"></a><span id="l39.186" class="difflineminus">-    lpnsMozABDesc serverDescList = (lpnsMozABDesc) CoTaskMemAlloc(sizeof(nsMozABDesc) * count);</span>
<a href="#l39.187"></a><span id="l39.187" class="difflineminus">-    BOOL *dirFlagsList = (BOOL *) CoTaskMemAlloc(sizeof(BOOL) * count);</span>
<a href="#l39.188"></a><span id="l39.188" class="difflineminus">-    long *catIndexList = (long *) CoTaskMemAlloc(sizeof(long) * count);</span>
<a href="#l39.189"></a><span id="l39.189" class="difflineminus">-</span>
<a href="#l39.190"></a><span id="l39.190" class="difflineminus">-    *aABListCount = count;</span>
<a href="#l39.191"></a><span id="l39.191" class="difflineminus">-    *aABList = serverDescList;</span>
<a href="#l39.192"></a><span id="l39.192" class="difflineminus">-    *aDirFlagsList = dirFlagsList;</span>
<a href="#l39.193"></a><span id="l39.193" class="difflineminus">-    *aABCatIndexList = catIndexList;</span>
<a href="#l39.194"></a><span id="l39.194" class="difflineminus">-</span>
<a href="#l39.195"></a><span id="l39.195" class="difflineminus">-    // reset enumerator</span>
<a href="#l39.196"></a><span id="l39.196" class="difflineminus">-    if (NS_FAILED(abManager-&gt;GetDirectories(getter_AddRefs(subDirectories))))</span>
<a href="#l39.197"></a><span id="l39.197" class="difflineminus">-      return E_FAIL;</span>
<a href="#l39.198"></a><span id="l39.198" class="difflineminus">-</span>
<a href="#l39.199"></a><span id="l39.199" class="difflineminus">-    // For each valid addrbook collect info.</span>
<a href="#l39.200"></a><span id="l39.200" class="difflineminus">-    while (NS_SUCCEEDED(rv = subDirectories-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l39.201"></a><span id="l39.201" class="difflineminus">-    {</span>
<a href="#l39.202"></a><span id="l39.202" class="difflineminus">-      if (NS_SUCCEEDED(subDirectories-&gt;GetNext(getter_AddRefs(item))))</span>
<a href="#l39.203"></a><span id="l39.203" class="difflineminus">-      {</span>
<a href="#l39.204"></a><span id="l39.204" class="difflineminus">-        nsCOMPtr&lt;nsIAbDirectory&gt; directory(do_QueryInterface(item, &amp;rv));</span>
<a href="#l39.205"></a><span id="l39.205" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l39.206"></a><span id="l39.206" class="difflineminus">-        {</span>
<a href="#l39.207"></a><span id="l39.207" class="difflineminus">-          // We don't have to skip mailing list since there's no mailing lists at the top level.</span>
<a href="#l39.208"></a><span id="l39.208" class="difflineminus">-          nsCAutoString fileName;</span>
<a href="#l39.209"></a><span id="l39.209" class="difflineminus">-          nsCAutoString uri;</span>
<a href="#l39.210"></a><span id="l39.210" class="difflineminus">-          nsString description;</span>
<a href="#l39.211"></a><span id="l39.211" class="difflineminus">-          PRUint32 palmSyncTimeStamp;</span>
<a href="#l39.212"></a><span id="l39.212" class="difflineminus">-          PRInt32 dirType, palmCategoryIndex;</span>
<a href="#l39.213"></a><span id="l39.213" class="difflineminus">-</span>
<a href="#l39.214"></a><span id="l39.214" class="difflineminus">-          rv = directory-&gt;GetDescription(description);</span>
<a href="#l39.215"></a><span id="l39.215" class="difflineminus">-          if(NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l39.216"></a><span id="l39.216" class="difflineminus">-          rv = directory-&gt;GetFileName(fileName);</span>
<a href="#l39.217"></a><span id="l39.217" class="difflineminus">-          if(NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l39.218"></a><span id="l39.218" class="difflineminus">-          rv = directory-&gt;GetURI(uri);</span>
<a href="#l39.219"></a><span id="l39.219" class="difflineminus">-          if(NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l39.220"></a><span id="l39.220" class="difflineminus">-          rv = directory-&gt;GetDirType(&amp;dirType);</span>
<a href="#l39.221"></a><span id="l39.221" class="difflineminus">-          if(NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l39.222"></a><span id="l39.222" class="difflineminus">-          rv = directory-&gt;GetIntValue(&quot;PalmCategoryId&quot;, -1, &amp;palmCategoryIndex);</span>
<a href="#l39.223"></a><span id="l39.223" class="difflineminus">-          if (NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l39.224"></a><span id="l39.224" class="difflineminus">-          rv = directory-&gt;GetIntValue(&quot;PalmSyncTimeStamp&quot;, 0,</span>
<a href="#l39.225"></a><span id="l39.225" class="difflineminus">-                                      (PRInt32*)&amp;palmSyncTimeStamp);</span>
<a href="#l39.226"></a><span id="l39.226" class="difflineminus">-          if (NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l39.227"></a><span id="l39.227" class="difflineminus">-</span>
<a href="#l39.228"></a><span id="l39.228" class="difflineminus">-          PRBool disableThisAB;</span>
<a href="#l39.229"></a><span id="l39.229" class="difflineminus">-          rv = directory-&gt;GetBoolValue(&quot;disablePalmSync&quot;, PR_FALSE, &amp;disableThisAB);</span>
<a href="#l39.230"></a><span id="l39.230" class="difflineminus">-          if (NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l39.231"></a><span id="l39.231" class="difflineminus">-</span>
<a href="#l39.232"></a><span id="l39.232" class="difflineminus">-          // Skip/Ignore 4.X addrbooks (ie, with &quot;.na2&quot; extension), and non personal AB's</span>
<a href="#l39.233"></a><span id="l39.233" class="difflineminus">-          if (disableThisAB || ((fileName.Length() &gt; kABFileName_PreviousSuffixLen) &amp;&amp; </span>
<a href="#l39.234"></a><span id="l39.234" class="difflineminus">-               strcmp(fileName.get() + fileName.Length() - kABFileName_PreviousSuffixLen, kABFileName_PreviousSuffix) == 0) ||</span>
<a href="#l39.235"></a><span id="l39.235" class="difflineminus">-                (dirType != kPABDirectory &amp;&amp; dirType != kMAPIDirectory))</span>
<a href="#l39.236"></a><span id="l39.236" class="difflineminus">-          {</span>
<a href="#l39.237"></a><span id="l39.237" class="difflineminus">-            continue;</span>
<a href="#l39.238"></a><span id="l39.238" class="difflineminus">-          }</span>
<a href="#l39.239"></a><span id="l39.239" class="difflineminus">-</span>
<a href="#l39.240"></a><span id="l39.240" class="difflineminus">-          if(aIsUnicode) </span>
<a href="#l39.241"></a><span id="l39.241" class="difflineminus">-          {</span>
<a href="#l39.242"></a><span id="l39.242" class="difflineminus">-            // convert uri to Unicode</span>
<a href="#l39.243"></a><span id="l39.243" class="difflineminus">-            nsAutoString abUrl;</span>
<a href="#l39.244"></a><span id="l39.244" class="difflineminus">-            rv = ConvertToUnicode(&quot;UTF-8&quot;, uri, abUrl);</span>
<a href="#l39.245"></a><span id="l39.245" class="difflineminus">-            if (NS_FAILED(rv))</span>
<a href="#l39.246"></a><span id="l39.246" class="difflineminus">-              break;</span>
<a href="#l39.247"></a><span id="l39.247" class="difflineminus">-            // add to the list</span>
<a href="#l39.248"></a><span id="l39.248" class="difflineminus">-            CopyUnicodeString(&amp;(serverDescList-&gt;lpszABName), description);</span>
<a href="#l39.249"></a><span id="l39.249" class="difflineminus">-            CopyUnicodeString(&amp;(serverDescList-&gt;lpszABUrl), abUrl);</span>
<a href="#l39.250"></a><span id="l39.250" class="difflineminus">-          }</span>
<a href="#l39.251"></a><span id="l39.251" class="difflineminus">-          else {</span>
<a href="#l39.252"></a><span id="l39.252" class="difflineminus">-            // we need to convert uri to Unicode and then to ASCII</span>
<a href="#l39.253"></a><span id="l39.253" class="difflineminus">-            nsAutoString abUUrl;</span>
<a href="#l39.254"></a><span id="l39.254" class="difflineminus">-</span>
<a href="#l39.255"></a><span id="l39.255" class="difflineminus">-            rv = ConvertToUnicode(&quot;UTF-8&quot;, uri, abUUrl);</span>
<a href="#l39.256"></a><span id="l39.256" class="difflineminus">-            if (NS_FAILED(rv))</span>
<a href="#l39.257"></a><span id="l39.257" class="difflineminus">-              break;</span>
<a href="#l39.258"></a><span id="l39.258" class="difflineminus">-</span>
<a href="#l39.259"></a><span id="l39.259" class="difflineminus">-            CopyCString(&amp;(serverDescList-&gt;lpszABName),</span>
<a href="#l39.260"></a><span id="l39.260" class="difflineminus">-                        NS_ConvertUTF16toUTF8(description));</span>
<a href="#l39.261"></a><span id="l39.261" class="difflineminus">-            CopyCString(&amp;(serverDescList-&gt;lpszABUrl),</span>
<a href="#l39.262"></a><span id="l39.262" class="difflineminus">-                        NS_ConvertUTF16toUTF8(abUUrl));</span>
<a href="#l39.263"></a><span id="l39.263" class="difflineminus">-          }</span>
<a href="#l39.264"></a><span id="l39.264" class="difflineminus">-          serverDescList++;</span>
<a href="#l39.265"></a><span id="l39.265" class="difflineminus">-</span>
<a href="#l39.266"></a><span id="l39.266" class="difflineminus">-          PRUint32 dirFlag = 0;</span>
<a href="#l39.267"></a><span id="l39.267" class="difflineminus">-          if (palmSyncTimeStamp &lt;= 0)</span>
<a href="#l39.268"></a><span id="l39.268" class="difflineminus">-            dirFlag |= kFirstTimeSyncDirFlag;</span>
<a href="#l39.269"></a><span id="l39.269" class="difflineminus">-          // was this the pab?</span>
<a href="#l39.270"></a><span id="l39.270" class="difflineminus">-          nsCAutoString prefName;</span>
<a href="#l39.271"></a><span id="l39.271" class="difflineminus">-          rv = directory-&gt;GetDirPrefId(prefName);</span>
<a href="#l39.272"></a><span id="l39.272" class="difflineminus">-          if (NS_FAILED(rv))</span>
<a href="#l39.273"></a><span id="l39.273" class="difflineminus">-            break;</span>
<a href="#l39.274"></a><span id="l39.274" class="difflineminus">-</span>
<a href="#l39.275"></a><span id="l39.275" class="difflineminus">-          if (prefName.Equals(&quot;ldap_2.servers.pab&quot;))</span>
<a href="#l39.276"></a><span id="l39.276" class="difflineminus">-            dirFlag |= kIsPabDirFlag;</span>
<a href="#l39.277"></a><span id="l39.277" class="difflineminus">-          *dirFlagsList = (BOOL) dirFlag;</span>
<a href="#l39.278"></a><span id="l39.278" class="difflineminus">-          dirFlagsList++;</span>
<a href="#l39.279"></a><span id="l39.279" class="difflineminus">-</span>
<a href="#l39.280"></a><span id="l39.280" class="difflineminus">-          *catIndexList = palmCategoryIndex;</span>
<a href="#l39.281"></a><span id="l39.281" class="difflineminus">-          catIndexList++;</span>
<a href="#l39.282"></a><span id="l39.282" class="difflineminus">-        }</span>
<a href="#l39.283"></a><span id="l39.283" class="difflineminus">-      }</span>
<a href="#l39.284"></a><span id="l39.284" class="difflineminus">-    }</span>
<a href="#l39.285"></a><span id="l39.285" class="difflineminus">-</span>
<a href="#l39.286"></a><span id="l39.286" class="difflineminus">-    // assign member variables to the beginning of the list</span>
<a href="#l39.287"></a><span id="l39.287" class="difflineminus">-    serverDescList = *aABList;</span>
<a href="#l39.288"></a><span id="l39.288" class="difflineminus">-    dirFlagsList = *aDirFlagsList;</span>
<a href="#l39.289"></a><span id="l39.289" class="difflineminus">-    catIndexList = *aABCatIndexList;</span>
<a href="#l39.290"></a><span id="l39.290" class="difflineminus">-</span>
<a href="#l39.291"></a><span id="l39.291" class="difflineminus">-    if(NS_FAILED(rv))</span>
<a href="#l39.292"></a><span id="l39.292" class="difflineminus">-      return E_FAIL;</span>
<a href="#l39.293"></a><span id="l39.293" class="difflineminus">-  }</span>
<a href="#l39.294"></a><span id="l39.294" class="difflineminus">-  return S_OK;</span>
<a href="#l39.295"></a><span id="l39.295" class="difflineminus">-}</span>
<a href="#l39.296"></a><span id="l39.296" class="difflineminus">-</span>
<a href="#l39.297"></a><span id="l39.297" class="difflineminus">-// Synchronize the Address Book represented by the aCategoryIndex and/or corresponding aABName in Mozilla</span>
<a href="#l39.298"></a><span id="l39.298" class="difflineminus">-STDMETHODIMP CPalmSyncImp::nsSynchronizeAB(BOOL aIsUnicode, long aCategoryIndex,</span>
<a href="#l39.299"></a><span id="l39.299" class="difflineminus">-                    long aCategoryId, LPTSTR aABName,</span>
<a href="#l39.300"></a><span id="l39.300" class="difflineminus">-                    int aModRemoteRecCount, lpnsABCOMCardStruct aModRemoteRecList,</span>
<a href="#l39.301"></a><span id="l39.301" class="difflineminus">-                    int * aModMozRecCount, lpnsABCOMCardStruct * aModMozRecList)</span>
<a href="#l39.302"></a><span id="l39.302" class="difflineminus">-{</span>
<a href="#l39.303"></a><span id="l39.303" class="difflineminus">-    // let the already continuing sync complete</span>
<a href="#l39.304"></a><span id="l39.304" class="difflineminus">-    if(m_PalmHotSync)</span>
<a href="#l39.305"></a><span id="l39.305" class="difflineminus">-        return E_FAIL;</span>
<a href="#l39.306"></a><span id="l39.306" class="difflineminus">-</span>
<a href="#l39.307"></a><span id="l39.307" class="difflineminus">-    m_PalmHotSync = (nsAbPalmHotSync *) new nsAbPalmHotSync(aIsUnicode, aABName, (char*)aABName, aCategoryIndex, aCategoryId);</span>
<a href="#l39.308"></a><span id="l39.308" class="difflineminus">-    if(!m_PalmHotSync)</span>
<a href="#l39.309"></a><span id="l39.309" class="difflineminus">-        return E_FAIL;</span>
<a href="#l39.310"></a><span id="l39.310" class="difflineminus">-</span>
<a href="#l39.311"></a><span id="l39.311" class="difflineminus">-    nsresult rv = ((nsAbPalmHotSync *)m_PalmHotSync)-&gt;Initialize();</span>
<a href="#l39.312"></a><span id="l39.312" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l39.313"></a><span id="l39.313" class="difflineminus">-        rv = ((nsAbPalmHotSync *)m_PalmHotSync)-&gt;DoSyncAndGetUpdatedCards(aModRemoteRecCount, aModRemoteRecList, aModMozRecCount, aModMozRecList);</span>
<a href="#l39.314"></a><span id="l39.314" class="difflineminus">-</span>
<a href="#l39.315"></a><span id="l39.315" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l39.316"></a><span id="l39.316" class="difflineminus">-        return E_FAIL;</span>
<a href="#l39.317"></a><span id="l39.317" class="difflineminus">-</span>
<a href="#l39.318"></a><span id="l39.318" class="difflineminus">-    return S_OK;</span>
<a href="#l39.319"></a><span id="l39.319" class="difflineminus">-}</span>
<a href="#l39.320"></a><span id="l39.320" class="difflineminus">-</span>
<a href="#l39.321"></a><span id="l39.321" class="difflineminus">-// All records from a AB represented by aCategoryIndex and aABName into a new Mozilla AB</span>
<a href="#l39.322"></a><span id="l39.322" class="difflineminus">-STDMETHODIMP CPalmSyncImp::nsAddAllABRecords(BOOL aIsUnicode, BOOL replaceExisting, long aCategoryIndex, LPTSTR aABName,</span>
<a href="#l39.323"></a><span id="l39.323" class="difflineminus">-                            int aRemoteRecCount, lpnsABCOMCardStruct aRemoteRecList)</span>
<a href="#l39.324"></a><span id="l39.324" class="difflineminus">-{</span>
<a href="#l39.325"></a><span id="l39.325" class="difflineminus">-    // since we are not returning any data we don't need to keep the nsAbPalmHotSync reference</span>
<a href="#l39.326"></a><span id="l39.326" class="difflineminus">-    // in order to free the returned data in its destructor. Just create a local nsAbPalmHotSync var.</span>
<a href="#l39.327"></a><span id="l39.327" class="difflineminus">-    nsAbPalmHotSync palmHotSync(aIsUnicode, aABName, (const char*)aABName, aCategoryIndex, -1);</span>
<a href="#l39.328"></a><span id="l39.328" class="difflineminus">-</span>
<a href="#l39.329"></a><span id="l39.329" class="difflineminus">-    nsresult rv = palmHotSync.AddAllRecordsToAB(replaceExisting, aRemoteRecCount, aRemoteRecList);</span>
<a href="#l39.330"></a><span id="l39.330" class="difflineminus">-</span>
<a href="#l39.331"></a><span id="l39.331" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l39.332"></a><span id="l39.332" class="difflineminus">-        return E_FAIL;</span>
<a href="#l39.333"></a><span id="l39.333" class="difflineminus">-</span>
<a href="#l39.334"></a><span id="l39.334" class="difflineminus">-    return S_OK;</span>
<a href="#l39.335"></a><span id="l39.335" class="difflineminus">-}</span>
<a href="#l39.336"></a><span id="l39.336" class="difflineminus">-</span>
<a href="#l39.337"></a><span id="l39.337" class="difflineminus">-STDMETHODIMP CPalmSyncImp::nsGetABDeleted(LPTSTR aABName, BOOL *abDeleted)</span>
<a href="#l39.338"></a><span id="l39.338" class="difflineminus">-{</span>
<a href="#l39.339"></a><span id="l39.339" class="difflineminus">-  nsCAutoString prefName(&quot;ldap_2.servers.&quot;);</span>
<a href="#l39.340"></a><span id="l39.340" class="difflineminus">-  prefName.Append((const char *)aABName);</span>
<a href="#l39.341"></a><span id="l39.341" class="difflineminus">-  prefName.Append(&quot;.position&quot;);</span>
<a href="#l39.342"></a><span id="l39.342" class="difflineminus">-  PRInt32 position = GetIntPref(prefName.get(), -1);</span>
<a href="#l39.343"></a><span id="l39.343" class="difflineminus">-  *abDeleted = (position == 0);</span>
<a href="#l39.344"></a><span id="l39.344" class="difflineminus">-  return S_OK;</span>
<a href="#l39.345"></a><span id="l39.345" class="difflineminus">-}</span>
<a href="#l39.346"></a><span id="l39.346" class="difflineminus">-</span>
<a href="#l39.347"></a><span id="l39.347" class="difflineminus">-</span>
<a href="#l39.348"></a><span id="l39.348" class="difflineminus">-// Get All records from a Mozilla AB</span>
<a href="#l39.349"></a><span id="l39.349" class="difflineminus">-STDMETHODIMP CPalmSyncImp::nsGetAllABCards(BOOL aIsUnicode, long aCategoryIndex, LPTSTR aABName,</span>
<a href="#l39.350"></a><span id="l39.350" class="difflineminus">-                            int * aMozRecCount, lpnsABCOMCardStruct * aMozRecList)</span>
<a href="#l39.351"></a><span id="l39.351" class="difflineminus">-{</span>
<a href="#l39.352"></a><span id="l39.352" class="difflineminus">-    // if sync is already going on wait for AckSyncDone to be called</span>
<a href="#l39.353"></a><span id="l39.353" class="difflineminus">-    if(m_PalmHotSync)</span>
<a href="#l39.354"></a><span id="l39.354" class="difflineminus">-        return E_FAIL;</span>
<a href="#l39.355"></a><span id="l39.355" class="difflineminus">-</span>
<a href="#l39.356"></a><span id="l39.356" class="difflineminus">-    m_PalmHotSync = (nsAbPalmHotSync *) new nsAbPalmHotSync(aIsUnicode, aABName, (char*)aABName, aCategoryIndex, -1);</span>
<a href="#l39.357"></a><span id="l39.357" class="difflineminus">-    if(!m_PalmHotSync)</span>
<a href="#l39.358"></a><span id="l39.358" class="difflineminus">-        return E_FAIL;</span>
<a href="#l39.359"></a><span id="l39.359" class="difflineminus">-</span>
<a href="#l39.360"></a><span id="l39.360" class="difflineminus">-    nsresult rv = ((nsAbPalmHotSync *)m_PalmHotSync)-&gt;Initialize();</span>
<a href="#l39.361"></a><span id="l39.361" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l39.362"></a><span id="l39.362" class="difflineminus">-        rv = ((nsAbPalmHotSync *)m_PalmHotSync)-&gt;GetAllCards(aMozRecCount, aMozRecList);</span>
<a href="#l39.363"></a><span id="l39.363" class="difflineminus">-</span>
<a href="#l39.364"></a><span id="l39.364" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l39.365"></a><span id="l39.365" class="difflineminus">-        return E_FAIL;</span>
<a href="#l39.366"></a><span id="l39.366" class="difflineminus">-</span>
<a href="#l39.367"></a><span id="l39.367" class="difflineminus">-    return S_OK;</span>
<a href="#l39.368"></a><span id="l39.368" class="difflineminus">-}</span>
<a href="#l39.369"></a><span id="l39.369" class="difflineminus">-</span>
<a href="#l39.370"></a><span id="l39.370" class="difflineminus">-// Send an ack for sync done on the remote AB to Mozilla, </span>
<a href="#l39.371"></a><span id="l39.371" class="difflineminus">-// now we delete the data returned to the calling app.</span>
<a href="#l39.372"></a><span id="l39.372" class="difflineminus">-STDMETHODIMP CPalmSyncImp::nsAckSyncDone(BOOL aIsSuccess, long aCatIndex, int aNewRecCount, unsigned long * aNewPalmRecIDList)</span>
<a href="#l39.373"></a><span id="l39.373" class="difflineminus">-{</span>
<a href="#l39.374"></a><span id="l39.374" class="difflineminus">-    nsAbPalmHotSync * tempPalmHotSync = (nsAbPalmHotSync *) m_PalmHotSync;</span>
<a href="#l39.375"></a><span id="l39.375" class="difflineminus">-    if(tempPalmHotSync) {</span>
<a href="#l39.376"></a><span id="l39.376" class="difflineminus">-        if(aNewRecCount &amp;&amp; (aCatIndex &gt; -1))</span>
<a href="#l39.377"></a><span id="l39.377" class="difflineminus">-            tempPalmHotSync-&gt;Done(aIsSuccess, aCatIndex, aNewRecCount, aNewPalmRecIDList);</span>
<a href="#l39.378"></a><span id="l39.378" class="difflineminus">-        delete tempPalmHotSync;</span>
<a href="#l39.379"></a><span id="l39.379" class="difflineminus">-    }</span>
<a href="#l39.380"></a><span id="l39.380" class="difflineminus">-    m_PalmHotSync = nsnull;</span>
<a href="#l39.381"></a><span id="l39.381" class="difflineminus">-</span>
<a href="#l39.382"></a><span id="l39.382" class="difflineminus">-    return S_OK;</span>
<a href="#l39.383"></a><span id="l39.383" class="difflineminus">-}</span>
<a href="#l39.384"></a><span id="l39.384" class="difflineminus">-</span>
<a href="#l39.385"></a><span id="l39.385" class="difflineminus">-// Update the category id and mod tiem for the Address Book in Mozilla</span>
<a href="#l39.386"></a><span id="l39.386" class="difflineminus">-STDMETHODIMP CPalmSyncImp::nsUpdateABSyncInfo(BOOL aIsUnicode, long aCategoryIndex, LPTSTR aABName)</span>
<a href="#l39.387"></a><span id="l39.387" class="difflineminus">-{</span>
<a href="#l39.388"></a><span id="l39.388" class="difflineminus">-  nsresult rv;</span>
<a href="#l39.389"></a><span id="l39.389" class="difflineminus">-  if(m_PalmHotSync)</span>
<a href="#l39.390"></a><span id="l39.390" class="difflineminus">-    rv = ((nsAbPalmHotSync *)m_PalmHotSync)-&gt;UpdateSyncInfo(aCategoryIndex);</span>
<a href="#l39.391"></a><span id="l39.391" class="difflineminus">-  else</span>
<a href="#l39.392"></a><span id="l39.392" class="difflineminus">-  {</span>
<a href="#l39.393"></a><span id="l39.393" class="difflineminus">-    // Launch another ABpalmHotSync session.</span>
<a href="#l39.394"></a><span id="l39.394" class="difflineminus">-    nsAbPalmHotSync palmHotSync(aIsUnicode, aABName, (const char*)aABName, aCategoryIndex, -1);</span>
<a href="#l39.395"></a><span id="l39.395" class="difflineminus">-    rv = palmHotSync.Initialize();</span>
<a href="#l39.396"></a><span id="l39.396" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l39.397"></a><span id="l39.397" class="difflineminus">-      rv = palmHotSync.UpdateSyncInfo(aCategoryIndex);</span>
<a href="#l39.398"></a><span id="l39.398" class="difflineminus">-  }</span>
<a href="#l39.399"></a><span id="l39.399" class="difflineminus">-</span>
<a href="#l39.400"></a><span id="l39.400" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l39.401"></a><span id="l39.401" class="difflineminus">-    return E_FAIL;</span>
<a href="#l39.402"></a><span id="l39.402" class="difflineminus">-</span>
<a href="#l39.403"></a><span id="l39.403" class="difflineminus">-  return S_OK;</span>
<a href="#l39.404"></a><span id="l39.404" class="difflineminus">-}</span>
<a href="#l39.405"></a><span id="l39.405" class="difflineminus">-</span>
<a href="#l39.406"></a><span id="l39.406" class="difflineminus">-// Delete an Address Book in Mozilla</span>
<a href="#l39.407"></a><span id="l39.407" class="difflineminus">-STDMETHODIMP CPalmSyncImp::nsDeleteAB(BOOL aIsUnicode, long aCategoryIndex, LPTSTR aABName, LPTSTR aABUrl)</span>
<a href="#l39.408"></a><span id="l39.408" class="difflineminus">-{</span>
<a href="#l39.409"></a><span id="l39.409" class="difflineminus">-  // This is an independent operation so use a local nsAbPalmHotSync var</span>
<a href="#l39.410"></a><span id="l39.410" class="difflineminus">-  // (ie the callers don't need to call AckSyncdone after this is done).</span>
<a href="#l39.411"></a><span id="l39.411" class="difflineminus">-  nsAbPalmHotSync palmHotSync(aIsUnicode, aABName, (const char*)aABName, aCategoryIndex, -1);</span>
<a href="#l39.412"></a><span id="l39.412" class="difflineminus">-</span>
<a href="#l39.413"></a><span id="l39.413" class="difflineminus">-  nsresult rv = palmHotSync.DeleteAB((const char*)aABUrl);</span>
<a href="#l39.414"></a><span id="l39.414" class="difflineminus">-</span>
<a href="#l39.415"></a><span id="l39.415" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l39.416"></a><span id="l39.416" class="difflineminus">-      return E_FAIL;</span>
<a href="#l39.417"></a><span id="l39.417" class="difflineminus">-</span>
<a href="#l39.418"></a><span id="l39.418" class="difflineminus">-  return S_OK;</span>
<a href="#l39.419"></a><span id="l39.419" class="difflineminus">-}</span>
<a href="#l39.420"></a><span id="l39.420" class="difflineminus">-</span>
<a href="#l39.421"></a><span id="l39.421" class="difflineminus">-// Rename an Address Book in Mozilla</span>
<a href="#l39.422"></a><span id="l39.422" class="difflineminus">-STDMETHODIMP CPalmSyncImp::nsRenameAB(BOOL aIsUnicode, long aCategoryIndex, LPTSTR aABName, LPTSTR aABUrl)</span>
<a href="#l39.423"></a><span id="l39.423" class="difflineminus">-{</span>
<a href="#l39.424"></a><span id="l39.424" class="difflineminus">-  // This is an independent operation so use a local nsAbPalmHotSync var</span>
<a href="#l39.425"></a><span id="l39.425" class="difflineminus">-  // (ie the callers don't need to call AckSyncdone after this is done).</span>
<a href="#l39.426"></a><span id="l39.426" class="difflineminus">-  nsAbPalmHotSync palmHotSync(aIsUnicode, aABName, (const char*)aABName, aCategoryIndex, -1);</span>
<a href="#l39.427"></a><span id="l39.427" class="difflineminus">-</span>
<a href="#l39.428"></a><span id="l39.428" class="difflineminus">-  nsresult rv = palmHotSync.RenameAB(aCategoryIndex, (const char*)aABUrl);</span>
<a href="#l39.429"></a><span id="l39.429" class="difflineminus">-</span>
<a href="#l39.430"></a><span id="l39.430" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l39.431"></a><span id="l39.431" class="difflineminus">-    return E_FAIL;</span>
<a href="#l39.432"></a><span id="l39.432" class="difflineminus">-</span>
<a href="#l39.433"></a><span id="l39.433" class="difflineminus">-  return S_OK;</span>
<a href="#l39.434"></a><span id="l39.434" class="difflineminus">-}</span>
<a href="#l39.435"></a><span id="l39.435" class="difflineminus">-</span>
<a href="#l39.436"></a><span id="l39.436" class="difflineminus">-void CPalmSyncImp::CopyUnicodeString(LPTSTR *destStr, const nsString&amp; srcStr)</span>
<a href="#l39.437"></a><span id="l39.437" class="difflineminus">-{</span>
<a href="#l39.438"></a><span id="l39.438" class="difflineminus">-  if (!destStr)</span>
<a href="#l39.439"></a><span id="l39.439" class="difflineminus">-    return;</span>
<a href="#l39.440"></a><span id="l39.440" class="difflineminus">-</span>
<a href="#l39.441"></a><span id="l39.441" class="difflineminus">-  PRInt32 length = srcStr.Length()+1;</span>
<a href="#l39.442"></a><span id="l39.442" class="difflineminus">-  *destStr = (LPTSTR) CoTaskMemAlloc(sizeof(PRUnichar) * length);</span>
<a href="#l39.443"></a><span id="l39.443" class="difflineminus">-  wcsncpy(*destStr, srcStr.get(), length-1);</span>
<a href="#l39.444"></a><span id="l39.444" class="difflineminus">-  (*destStr)[length-1] = '\0';</span>
<a href="#l39.445"></a><span id="l39.445" class="difflineminus">-}</span>
<a href="#l39.446"></a><span id="l39.446" class="difflineminus">-</span>
<a href="#l39.447"></a><span id="l39.447" class="difflineminus">-void CPalmSyncImp::CopyCString(LPTSTR *destStr, const nsCString&amp; srcStr)</span>
<a href="#l39.448"></a><span id="l39.448" class="difflineminus">-{</span>
<a href="#l39.449"></a><span id="l39.449" class="difflineminus">-  if (!destStr)</span>
<a href="#l39.450"></a><span id="l39.450" class="difflineminus">-    return;</span>
<a href="#l39.451"></a><span id="l39.451" class="difflineminus">-</span>
<a href="#l39.452"></a><span id="l39.452" class="difflineminus">-  // these strings are defined as wide in the idl, so we need to add up to 3</span>
<a href="#l39.453"></a><span id="l39.453" class="difflineminus">-  // bytes of 0 byte padding at the end (if the string is an odd number of</span>
<a href="#l39.454"></a><span id="l39.454" class="difflineminus">-  // bytes long, we need one null byte to pad out the last char to a wide char</span>
<a href="#l39.455"></a><span id="l39.455" class="difflineminus">-  // and then  two more nulls as a wide null terminator. </span>
<a href="#l39.456"></a><span id="l39.456" class="difflineminus">-  PRInt32 length = sizeof(char) * (srcStr.Length()+3);</span>
<a href="#l39.457"></a><span id="l39.457" class="difflineminus">-  *destStr = (LPTSTR) CoTaskMemAlloc(length);</span>
<a href="#l39.458"></a><span id="l39.458" class="difflineminus">-  char *sp = (char *)*destStr;</span>
<a href="#l39.459"></a><span id="l39.459" class="difflineminus">-  strncpy(sp, srcStr.get(), length-1); // this will null fill the end of destStr</span>
<a href="#l39.460"></a><span id="l39.460" class="difflineminus">-  sp[length-1] = '\0';</span>
<a href="#l39.461"></a><span id="l39.461" class="difflineminus">-}</span>
<a href="#l39.462"></a><span id="l39.462" class="difflineminus">-</span>
<a href="#l39.463"></a><span id="l39.463" class="difflineminus">-</span>
<a href="#l39.464"></a><span id="l39.464" class="difflineminus">-/* static */PRBool CPalmSyncImp::GetBoolPref(const char *prefName, PRBool defaultVal)</span>
<a href="#l39.465"></a><span id="l39.465" class="difflineminus">-{</span>
<a href="#l39.466"></a><span id="l39.466" class="difflineminus">-  PRBool boolVal = defaultVal;</span>
<a href="#l39.467"></a><span id="l39.467" class="difflineminus">-  </span>
<a href="#l39.468"></a><span id="l39.468" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l39.469"></a><span id="l39.469" class="difflineminus">-  if (prefBranch)</span>
<a href="#l39.470"></a><span id="l39.470" class="difflineminus">-    prefBranch-&gt;GetBoolPref(prefName, &amp;boolVal);</span>
<a href="#l39.471"></a><span id="l39.471" class="difflineminus">-  return boolVal;</span>
<a href="#l39.472"></a><span id="l39.472" class="difflineminus">-}</span>
<a href="#l39.473"></a><span id="l39.473" class="difflineminus">-</span>
<a href="#l39.474"></a><span id="l39.474" class="difflineminus">-/* static */PRInt32 CPalmSyncImp::GetIntPref(const char *prefName, PRInt32 defaultVal)</span>
<a href="#l39.475"></a><span id="l39.475" class="difflineminus">-{</span>
<a href="#l39.476"></a><span id="l39.476" class="difflineminus">-  PRInt32 intVal = defaultVal;</span>
<a href="#l39.477"></a><span id="l39.477" class="difflineminus">-  </span>
<a href="#l39.478"></a><span id="l39.478" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l39.479"></a><span id="l39.479" class="difflineminus">-  if (prefBranch)</span>
<a href="#l39.480"></a><span id="l39.480" class="difflineminus">-    prefBranch-&gt;GetIntPref(prefName, &amp;intVal);</span>
<a href="#l39.481"></a><span id="l39.481" class="difflineminus">-  return intVal;</span>
<a href="#l39.482"></a><span id="l39.482" class="difflineminus">-}</span>
<a href="#l39.483"></a><span id="l39.483" class="difflineminus">-</span>
<a href="#l39.484"></a><span id="l39.484" class="difflineminus">-</span>
<a href="#l39.485"></a><span id="l39.485" class="difflineminus">-STDMETHODIMP CPalmSyncImp::nsUseABHomeAddressForPalmAddress(BOOL *aUseHomeAddress)</span>
<a href="#l39.486"></a><span id="l39.486" class="difflineminus">-{</span>
<a href="#l39.487"></a><span id="l39.487" class="difflineminus">-  *aUseHomeAddress = nsUseABHomeAddressForPalmAddress();</span>
<a href="#l39.488"></a><span id="l39.488" class="difflineminus">-  return S_OK;</span>
<a href="#l39.489"></a><span id="l39.489" class="difflineminus">-}</span>
<a href="#l39.490"></a><span id="l39.490" class="difflineminus">-</span>
<a href="#l39.491"></a><span id="l39.491" class="difflineminus">-STDMETHODIMP CPalmSyncImp::nsPreferABHomePhoneForPalmPhone(BOOL *aPreferHomePhone)</span>
<a href="#l39.492"></a><span id="l39.492" class="difflineminus">-{</span>
<a href="#l39.493"></a><span id="l39.493" class="difflineminus">-  *aPreferHomePhone = nsPreferABHomePhoneForPalmPhone();</span>
<a href="#l39.494"></a><span id="l39.494" class="difflineminus">-  return S_OK;</span>
<a href="#l39.495"></a><span id="l39.495" class="difflineminus">-}</span>
<a href="#l39.496"></a><span id="l39.496" class="difflineminus">-</span>
<a href="#l39.497"></a><span id="l39.497" class="difflineminus">-/* static */ PRBool CPalmSyncImp::nsUseABHomeAddressForPalmAddress()</span>
<a href="#l39.498"></a><span id="l39.498" class="difflineminus">-{</span>
<a href="#l39.499"></a><span id="l39.499" class="difflineminus">-  static PRBool gGotAddressPref = PR_FALSE;</span>
<a href="#l39.500"></a><span id="l39.500" class="difflineminus">-  static PRBool gUseHomeAddress;</span>
<a href="#l39.501"></a><span id="l39.501" class="difflineminus">-  if (!gGotAddressPref)</span>
<a href="#l39.502"></a><span id="l39.502" class="difflineminus">-  {</span>
<a href="#l39.503"></a><span id="l39.503" class="difflineminus">-    gUseHomeAddress = GetBoolPref(&quot;mail.palmsync.useHomeAddress&quot;, PR_TRUE);</span>
<a href="#l39.504"></a><span id="l39.504" class="difflineminus">-    gGotAddressPref = PR_TRUE;</span>
<a href="#l39.505"></a><span id="l39.505" class="difflineminus">-  }</span>
<a href="#l39.506"></a><span id="l39.506" class="difflineminus">-  return gUseHomeAddress;</span>
<a href="#l39.507"></a><span id="l39.507" class="difflineminus">-}</span>
<a href="#l39.508"></a><span id="l39.508" class="difflineminus">-</span>
<a href="#l39.509"></a><span id="l39.509" class="difflineminus">-/* static */ PRBool CPalmSyncImp::nsPreferABHomePhoneForPalmPhone()</span>
<a href="#l39.510"></a><span id="l39.510" class="difflineminus">-{</span>
<a href="#l39.511"></a><span id="l39.511" class="difflineminus">-  static PRBool gGotPhonePref = PR_FALSE;</span>
<a href="#l39.512"></a><span id="l39.512" class="difflineminus">-  static PRBool gPreferHomePhone;</span>
<a href="#l39.513"></a><span id="l39.513" class="difflineminus">-  if (!gGotPhonePref)</span>
<a href="#l39.514"></a><span id="l39.514" class="difflineminus">-  {</span>
<a href="#l39.515"></a><span id="l39.515" class="difflineminus">-    gPreferHomePhone = GetBoolPref(&quot;mail.palmsync.preferHomePhone&quot;, PR_TRUE);</span>
<a href="#l39.516"></a><span id="l39.516" class="difflineminus">-    gGotPhonePref = PR_TRUE;</span>
<a href="#l39.517"></a><span id="l39.517" class="difflineminus">-  }</span>
<a href="#l39.518"></a><span id="l39.518" class="difflineminus">-  return gPreferHomePhone;</span>
<a href="#l39.519"></a><span id="l39.519" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1">deleted file mode 100644</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/PalmSyncImp.h</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineplus">+++ /dev/null</span>
<a href="#l40.4"></a><span id="l40.4" class="difflineat">@@ -1,109 +0,0 @@</span>
<a href="#l40.5"></a><span id="l40.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l40.6"></a><span id="l40.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l40.7"></a><span id="l40.7" class="difflineminus">- *</span>
<a href="#l40.8"></a><span id="l40.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l40.9"></a><span id="l40.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l40.10"></a><span id="l40.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l40.11"></a><span id="l40.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">- *</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l40.16"></a><span id="l40.16" class="difflineminus">- * License.</span>
<a href="#l40.17"></a><span id="l40.17" class="difflineminus">- *</span>
<a href="#l40.18"></a><span id="l40.18" class="difflineminus">- * The Original Code is Mozilla</span>
<a href="#l40.19"></a><span id="l40.19" class="difflineminus">- *</span>
<a href="#l40.20"></a><span id="l40.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l40.21"></a><span id="l40.21" class="difflineminus">- * Netscape Communications Corp.</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l40.23"></a><span id="l40.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l40.24"></a><span id="l40.24" class="difflineminus">- *</span>
<a href="#l40.25"></a><span id="l40.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l40.26"></a><span id="l40.26" class="difflineminus">- *                 Rajiv Dayal (rdayal@netscape.com)</span>
<a href="#l40.27"></a><span id="l40.27" class="difflineminus">- *</span>
<a href="#l40.28"></a><span id="l40.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l40.29"></a><span id="l40.29" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l40.30"></a><span id="l40.30" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l40.33"></a><span id="l40.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l40.34"></a><span id="l40.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l40.35"></a><span id="l40.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l40.36"></a><span id="l40.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l40.37"></a><span id="l40.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l40.38"></a><span id="l40.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l40.39"></a><span id="l40.39" class="difflineminus">- *</span>
<a href="#l40.40"></a><span id="l40.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineminus">-</span>
<a href="#l40.42"></a><span id="l40.42" class="difflineminus">-#ifndef PALMSYNC_IMP_H</span>
<a href="#l40.43"></a><span id="l40.43" class="difflineminus">-#define PALMSYNC_IMP_H</span>
<a href="#l40.44"></a><span id="l40.44" class="difflineminus">-</span>
<a href="#l40.45"></a><span id="l40.45" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l40.46"></a><span id="l40.46" class="difflineminus">-#include &quot;IPalmSync.h&quot;</span>
<a href="#l40.47"></a><span id="l40.47" class="difflineminus">-#include &quot;nspr.h&quot;</span>
<a href="#l40.48"></a><span id="l40.48" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l40.49"></a><span id="l40.49" class="difflineminus">-</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineminus">-const CLSID CLSID_CPalmSyncImp = { 0xb20b4521, 0xccf8, 0x11d6, { 0xb8, 0xa5, 0x0, 0x0, 0x64, 0x65, 0x73, 0x74 } };</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineminus">-</span>
<a href="#l40.52"></a><span id="l40.52" class="difflineminus">-// this class implements the MS COM interface IPalmSync that provides the methods</span>
<a href="#l40.53"></a><span id="l40.53" class="difflineminus">-// called by the Palm Conduit to perform the AB Sync operations.</span>
<a href="#l40.54"></a><span id="l40.54" class="difflineminus">-class CPalmSyncImp : public IPalmSync</span>
<a href="#l40.55"></a><span id="l40.55" class="difflineminus">-{</span>
<a href="#l40.56"></a><span id="l40.56" class="difflineminus">-</span>
<a href="#l40.57"></a><span id="l40.57" class="difflineminus">-public :</span>
<a href="#l40.58"></a><span id="l40.58" class="difflineminus">-</span>
<a href="#l40.59"></a><span id="l40.59" class="difflineminus">-    // IUnknown</span>
<a href="#l40.60"></a><span id="l40.60" class="difflineminus">-</span>
<a href="#l40.61"></a><span id="l40.61" class="difflineminus">-    STDMETHODIMP            QueryInterface(const IID&amp; aIid, void** aPpv);</span>
<a href="#l40.62"></a><span id="l40.62" class="difflineminus">-    STDMETHODIMP_(ULONG)    AddRef();</span>
<a href="#l40.63"></a><span id="l40.63" class="difflineminus">-    STDMETHODIMP_(ULONG)    Release();</span>
<a href="#l40.64"></a><span id="l40.64" class="difflineminus">-</span>
<a href="#l40.65"></a><span id="l40.65" class="difflineminus">-    // Interface IPalmSync</span>
<a href="#l40.66"></a><span id="l40.66" class="difflineminus">-</span>
<a href="#l40.67"></a><span id="l40.67" class="difflineminus">-    STDMETHODIMP IsValid();</span>
<a href="#l40.68"></a><span id="l40.68" class="difflineminus">-</span>
<a href="#l40.69"></a><span id="l40.69" class="difflineminus">-    CPalmSyncImp();</span>
<a href="#l40.70"></a><span id="l40.70" class="difflineminus">-    ~CPalmSyncImp();</span>
<a href="#l40.71"></a><span id="l40.71" class="difflineminus">-</span>
<a href="#l40.72"></a><span id="l40.72" class="difflineminus">-    // Get the list of Address Books for the currently logged in user profile</span>
<a href="#l40.73"></a><span id="l40.73" class="difflineminus">-    STDMETHODIMP nsGetABList(BOOL aIsUnicode, short * aABListCount,</span>
<a href="#l40.74"></a><span id="l40.74" class="difflineminus">-                            lpnsMozABDesc * aABList, long ** aABCatIndexList, BOOL ** aDirFlags);</span>
<a href="#l40.75"></a><span id="l40.75" class="difflineminus">-</span>
<a href="#l40.76"></a><span id="l40.76" class="difflineminus">-    // Synchronize the Address Book represented by the aCategoryIndex and/or corresponding aABName in Mozilla</span>
<a href="#l40.77"></a><span id="l40.77" class="difflineminus">-    STDMETHODIMP nsSynchronizeAB(BOOL aIsUnicode, long aCategoryIndex, long aCategoryId, LPTSTR aABName,</span>
<a href="#l40.78"></a><span id="l40.78" class="difflineminus">-                        int aModRemoteRecCount, lpnsABCOMCardStruct aModRemoteRecList,</span>
<a href="#l40.79"></a><span id="l40.79" class="difflineminus">-                        int * aModMozRecCount, lpnsABCOMCardStruct * aModMozRecList);</span>
<a href="#l40.80"></a><span id="l40.80" class="difflineminus">-</span>
<a href="#l40.81"></a><span id="l40.81" class="difflineminus">-    STDMETHODIMP nsAddAllABRecords(BOOL aIsUnicode, BOOL replaceExisting, long aCategoryIndex, LPTSTR aABName,</span>
<a href="#l40.82"></a><span id="l40.82" class="difflineminus">-                            int aRemoteRecCount, lpnsABCOMCardStruct aRemoteRecList);</span>
<a href="#l40.83"></a><span id="l40.83" class="difflineminus">-</span>
<a href="#l40.84"></a><span id="l40.84" class="difflineminus">-</span>
<a href="#l40.85"></a><span id="l40.85" class="difflineminus">-    STDMETHODIMP nsGetAllABCards(BOOL aIsUnicode, long aCategoryIndex, LPTSTR aABName,</span>
<a href="#l40.86"></a><span id="l40.86" class="difflineminus">-                            int * aMozRecCount, lpnsABCOMCardStruct * aMozRecList);</span>
<a href="#l40.87"></a><span id="l40.87" class="difflineminus">-</span>
<a href="#l40.88"></a><span id="l40.88" class="difflineminus">-    STDMETHODIMP nsAckSyncDone(BOOL aIsSuccess, long aCatIndex, int aNewRecCount, unsigned long * aNewPalmRecIDList);</span>
<a href="#l40.89"></a><span id="l40.89" class="difflineminus">-</span>
<a href="#l40.90"></a><span id="l40.90" class="difflineminus">-    STDMETHODIMP nsUpdateABSyncInfo(BOOL aIsUnicode, long aCategoryIndex, LPTSTR aABName);</span>
<a href="#l40.91"></a><span id="l40.91" class="difflineminus">-</span>
<a href="#l40.92"></a><span id="l40.92" class="difflineminus">-    STDMETHODIMP nsDeleteAB(BOOL aIsUnicode, long aCategoryIndex, LPTSTR aABName, LPTSTR aABUrl);</span>
<a href="#l40.93"></a><span id="l40.93" class="difflineminus">- </span>
<a href="#l40.94"></a><span id="l40.94" class="difflineminus">-    STDMETHODIMP nsRenameAB(BOOL aIsUnicode, long aCategoryIndex, LPTSTR aABName, LPTSTR aABUrl);</span>
<a href="#l40.95"></a><span id="l40.95" class="difflineminus">-</span>
<a href="#l40.96"></a><span id="l40.96" class="difflineminus">-    STDMETHODIMP nsUseABHomeAddressForPalmAddress(BOOL *aUseHomeAddress);</span>
<a href="#l40.97"></a><span id="l40.97" class="difflineminus">-</span>
<a href="#l40.98"></a><span id="l40.98" class="difflineminus">-    STDMETHODIMP nsPreferABHomePhoneForPalmPhone(BOOL *aPreferHomePhone);</span>
<a href="#l40.99"></a><span id="l40.99" class="difflineminus">-</span>
<a href="#l40.100"></a><span id="l40.100" class="difflineminus">-    STDMETHODIMP nsGetABDeleted(LPTSTR aABName, BOOL *abDeleted);</span>
<a href="#l40.101"></a><span id="l40.101" class="difflineminus">-</span>
<a href="#l40.102"></a><span id="l40.102" class="difflineminus">-    static PRBool GetBoolPref(const char *prefName, PRBool defaultVal);</span>
<a href="#l40.103"></a><span id="l40.103" class="difflineminus">-    static PRInt32 GetIntPref(const char *prefName, PRInt32 defaultVal);</span>
<a href="#l40.104"></a><span id="l40.104" class="difflineminus">-    static PRBool nsUseABHomeAddressForPalmAddress();</span>
<a href="#l40.105"></a><span id="l40.105" class="difflineminus">-    static PRBool nsPreferABHomePhoneForPalmPhone();</span>
<a href="#l40.106"></a><span id="l40.106" class="difflineminus">-private :</span>
<a href="#l40.107"></a><span id="l40.107" class="difflineminus">-    PRInt32 m_cRef;</span>
<a href="#l40.108"></a><span id="l40.108" class="difflineminus">-    void * m_PalmHotSync;</span>
<a href="#l40.109"></a><span id="l40.109" class="difflineminus">-    void CopyUnicodeString(LPTSTR *destStr, const nsString&amp; srcStr);</span>
<a href="#l40.110"></a><span id="l40.110" class="difflineminus">-    void CopyCString(LPTSTR *destStr, const nsCString&amp; srcStr);</span>
<a href="#l40.111"></a><span id="l40.111" class="difflineminus">-};</span>
<a href="#l40.112"></a><span id="l40.112" class="difflineminus">-</span>
<a href="#l40.113"></a><span id="l40.113" class="difflineminus">-#endif // MSG_MAPI_IMP_H</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1">deleted file mode 100644</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/Registry.cpp</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineplus">+++ /dev/null</span>
<a href="#l41.4"></a><span id="l41.4" class="difflineat">@@ -1,312 +0,0 @@</span>
<a href="#l41.5"></a><span id="l41.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l41.6"></a><span id="l41.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l41.7"></a><span id="l41.7" class="difflineminus">- *</span>
<a href="#l41.8"></a><span id="l41.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l41.9"></a><span id="l41.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l41.10"></a><span id="l41.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l41.11"></a><span id="l41.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">- *</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineminus">- * License.</span>
<a href="#l41.17"></a><span id="l41.17" class="difflineminus">- *</span>
<a href="#l41.18"></a><span id="l41.18" class="difflineminus">- * The Original Code is Mozilla</span>
<a href="#l41.19"></a><span id="l41.19" class="difflineminus">- *</span>
<a href="#l41.20"></a><span id="l41.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l41.21"></a><span id="l41.21" class="difflineminus">- * Netscape Communications Corp.</span>
<a href="#l41.22"></a><span id="l41.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l41.23"></a><span id="l41.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l41.24"></a><span id="l41.24" class="difflineminus">- *</span>
<a href="#l41.25"></a><span id="l41.25" class="difflineminus">- * Contributors:</span>
<a href="#l41.26"></a><span id="l41.26" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l41.27"></a><span id="l41.27" class="difflineminus">- *</span>
<a href="#l41.28"></a><span id="l41.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l41.29"></a><span id="l41.29" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l41.30"></a><span id="l41.30" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l41.33"></a><span id="l41.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l41.34"></a><span id="l41.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l41.35"></a><span id="l41.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l41.36"></a><span id="l41.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l41.37"></a><span id="l41.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l41.38"></a><span id="l41.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l41.39"></a><span id="l41.39" class="difflineminus">- *</span>
<a href="#l41.40"></a><span id="l41.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l41.41"></a><span id="l41.41" class="difflineminus">-</span>
<a href="#l41.42"></a><span id="l41.42" class="difflineminus">-#undef _UNICODE</span>
<a href="#l41.43"></a><span id="l41.43" class="difflineminus">-#undef UNICODE</span>
<a href="#l41.44"></a><span id="l41.44" class="difflineminus">-</span>
<a href="#l41.45"></a><span id="l41.45" class="difflineminus">-#include &lt;objbase.h&gt;</span>
<a href="#l41.46"></a><span id="l41.46" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l41.47"></a><span id="l41.47" class="difflineminus">-#include &quot;Registry.h&quot;</span>
<a href="#l41.48"></a><span id="l41.48" class="difflineminus">-</span>
<a href="#l41.49"></a><span id="l41.49" class="difflineminus">-#define PALMSYNC_PROXY_DLL_NAME   &quot;PalmSyncProxy.dll&quot;</span>
<a href="#l41.50"></a><span id="l41.50" class="difflineminus">-#define PALMSYNC_STARTUP_ARG      &quot; -PalmSyncStartup&quot;</span>
<a href="#l41.51"></a><span id="l41.51" class="difflineminus">-#define MAX_SIZE              2048</span>
<a href="#l41.52"></a><span id="l41.52" class="difflineminus">-</span>
<a href="#l41.53"></a><span id="l41.53" class="difflineminus">-// Size of a CLSID as a string</span>
<a href="#l41.54"></a><span id="l41.54" class="difflineminus">-const int CLSID_STRING_SIZE = 39;</span>
<a href="#l41.55"></a><span id="l41.55" class="difflineminus">-</span>
<a href="#l41.56"></a><span id="l41.56" class="difflineminus">-// Proxy/Stub Dll Routines</span>
<a href="#l41.57"></a><span id="l41.57" class="difflineminus">-</span>
<a href="#l41.58"></a><span id="l41.58" class="difflineminus">-typedef HRESULT (__stdcall ProxyServer)();</span>
<a href="#l41.59"></a><span id="l41.59" class="difflineminus">-</span>
<a href="#l41.60"></a><span id="l41.60" class="difflineminus">-</span>
<a href="#l41.61"></a><span id="l41.61" class="difflineminus">-// Convert a CLSID to a char string.</span>
<a href="#l41.62"></a><span id="l41.62" class="difflineminus">-</span>
<a href="#l41.63"></a><span id="l41.63" class="difflineminus">-BOOL CLSIDtochar(const CLSID&amp; clsid, char* szCLSID,</span>
<a href="#l41.64"></a><span id="l41.64" class="difflineminus">-                 int length)</span>
<a href="#l41.65"></a><span id="l41.65" class="difflineminus">-{</span>
<a href="#l41.66"></a><span id="l41.66" class="difflineminus">-    LPOLESTR wszCLSID = NULL;</span>
<a href="#l41.67"></a><span id="l41.67" class="difflineminus">-</span>
<a href="#l41.68"></a><span id="l41.68" class="difflineminus">-    // Get CLSID</span>
<a href="#l41.69"></a><span id="l41.69" class="difflineminus">-    HRESULT hr = StringFromCLSID(clsid, &amp;wszCLSID);</span>
<a href="#l41.70"></a><span id="l41.70" class="difflineminus">-    if (FAILED(hr))</span>
<a href="#l41.71"></a><span id="l41.71" class="difflineminus">-        return FALSE;</span>
<a href="#l41.72"></a><span id="l41.72" class="difflineminus">-</span>
<a href="#l41.73"></a><span id="l41.73" class="difflineminus">-    // Covert from wide characters to non-wide.</span>
<a href="#l41.74"></a><span id="l41.74" class="difflineminus">-    wcstombs(szCLSID, wszCLSID, length);</span>
<a href="#l41.75"></a><span id="l41.75" class="difflineminus">-</span>
<a href="#l41.76"></a><span id="l41.76" class="difflineminus">-    // Free memory.</span>
<a href="#l41.77"></a><span id="l41.77" class="difflineminus">-    CoTaskMemFree(wszCLSID);</span>
<a href="#l41.78"></a><span id="l41.78" class="difflineminus">-</span>
<a href="#l41.79"></a><span id="l41.79" class="difflineminus">-    return TRUE;</span>
<a href="#l41.80"></a><span id="l41.80" class="difflineminus">-}</span>
<a href="#l41.81"></a><span id="l41.81" class="difflineminus">-</span>
<a href="#l41.82"></a><span id="l41.82" class="difflineminus">-// Create a key and set its value.</span>
<a href="#l41.83"></a><span id="l41.83" class="difflineminus">-</span>
<a href="#l41.84"></a><span id="l41.84" class="difflineminus">-BOOL setKeyAndValue(nsCAutoString keyName, const char* subKey,</span>
<a href="#l41.85"></a><span id="l41.85" class="difflineminus">-                    const char* theValue)</span>
<a href="#l41.86"></a><span id="l41.86" class="difflineminus">-{</span>
<a href="#l41.87"></a><span id="l41.87" class="difflineminus">-    HKEY hKey;</span>
<a href="#l41.88"></a><span id="l41.88" class="difflineminus">-    BOOL retValue = TRUE;</span>
<a href="#l41.89"></a><span id="l41.89" class="difflineminus">-</span>
<a href="#l41.90"></a><span id="l41.90" class="difflineminus">-    nsCAutoString theKey(keyName);</span>
<a href="#l41.91"></a><span id="l41.91" class="difflineminus">-    if (subKey != NULL)</span>
<a href="#l41.92"></a><span id="l41.92" class="difflineminus">-    {</span>
<a href="#l41.93"></a><span id="l41.93" class="difflineminus">-        theKey += &quot;\\&quot;;</span>
<a href="#l41.94"></a><span id="l41.94" class="difflineminus">-        theKey += subKey;</span>
<a href="#l41.95"></a><span id="l41.95" class="difflineminus">-    }</span>
<a href="#l41.96"></a><span id="l41.96" class="difflineminus">-</span>
<a href="#l41.97"></a><span id="l41.97" class="difflineminus">-    // Create and open key and subkey.</span>
<a href="#l41.98"></a><span id="l41.98" class="difflineminus">-    long lResult = RegCreateKeyEx(HKEY_CLASSES_ROOT, theKey.get(), </span>
<a href="#l41.99"></a><span id="l41.99" class="difflineminus">-                                  0, NULL, REG_OPTION_NON_VOLATILE,</span>
<a href="#l41.100"></a><span id="l41.100" class="difflineminus">-                                  KEY_ALL_ACCESS, NULL, &amp;hKey, NULL);</span>
<a href="#l41.101"></a><span id="l41.101" class="difflineminus">-    if (lResult != ERROR_SUCCESS)</span>
<a href="#l41.102"></a><span id="l41.102" class="difflineminus">-        return FALSE ;</span>
<a href="#l41.103"></a><span id="l41.103" class="difflineminus">-</span>
<a href="#l41.104"></a><span id="l41.104" class="difflineminus">-    // Set the Value.</span>
<a href="#l41.105"></a><span id="l41.105" class="difflineminus">-    if (theValue != NULL)</span>
<a href="#l41.106"></a><span id="l41.106" class="difflineminus">-    {</span>
<a href="#l41.107"></a><span id="l41.107" class="difflineminus">-       lResult = RegSetValueEx(hKey, NULL, 0, REG_SZ, (BYTE *)theValue, </span>
<a href="#l41.108"></a><span id="l41.108" class="difflineminus">-                      strlen(theValue)+1);</span>
<a href="#l41.109"></a><span id="l41.109" class="difflineminus">-       if (lResult != ERROR_SUCCESS)</span>
<a href="#l41.110"></a><span id="l41.110" class="difflineminus">-           retValue = FALSE;</span>
<a href="#l41.111"></a><span id="l41.111" class="difflineminus">-    }</span>
<a href="#l41.112"></a><span id="l41.112" class="difflineminus">-</span>
<a href="#l41.113"></a><span id="l41.113" class="difflineminus">-    RegCloseKey(hKey);</span>
<a href="#l41.114"></a><span id="l41.114" class="difflineminus">-    return TRUE;</span>
<a href="#l41.115"></a><span id="l41.115" class="difflineminus">-}</span>
<a href="#l41.116"></a><span id="l41.116" class="difflineminus">-</span>
<a href="#l41.117"></a><span id="l41.117" class="difflineminus">-// Delete a key and all of its descendents.</span>
<a href="#l41.118"></a><span id="l41.118" class="difflineminus">-</span>
<a href="#l41.119"></a><span id="l41.119" class="difflineminus">-LONG recursiveDeleteKey(HKEY hKeyParent,           // Parent of key to delete</span>
<a href="#l41.120"></a><span id="l41.120" class="difflineminus">-                        const char* lpszKeyChild)  // Key to delete</span>
<a href="#l41.121"></a><span id="l41.121" class="difflineminus">-{</span>
<a href="#l41.122"></a><span id="l41.122" class="difflineminus">-    // Open the child.</span>
<a href="#l41.123"></a><span id="l41.123" class="difflineminus">-    HKEY hKeyChild ;</span>
<a href="#l41.124"></a><span id="l41.124" class="difflineminus">-    LONG lRes = RegOpenKeyEx(hKeyParent, lpszKeyChild, 0,</span>
<a href="#l41.125"></a><span id="l41.125" class="difflineminus">-                             KEY_ALL_ACCESS, &amp;hKeyChild) ;</span>
<a href="#l41.126"></a><span id="l41.126" class="difflineminus">-    if (lRes != ERROR_SUCCESS)</span>
<a href="#l41.127"></a><span id="l41.127" class="difflineminus">-    {</span>
<a href="#l41.128"></a><span id="l41.128" class="difflineminus">-        return lRes ;</span>
<a href="#l41.129"></a><span id="l41.129" class="difflineminus">-    }</span>
<a href="#l41.130"></a><span id="l41.130" class="difflineminus">-</span>
<a href="#l41.131"></a><span id="l41.131" class="difflineminus">-    // Enumerate all of the decendents of this child.</span>
<a href="#l41.132"></a><span id="l41.132" class="difflineminus">-    FILETIME time ;</span>
<a href="#l41.133"></a><span id="l41.133" class="difflineminus">-    char szBuffer[MAX_SIZE] ;</span>
<a href="#l41.134"></a><span id="l41.134" class="difflineminus">-    DWORD dwSize = MAX_SIZE ;</span>
<a href="#l41.135"></a><span id="l41.135" class="difflineminus">-    while (RegEnumKeyEx(hKeyChild, 0, szBuffer, &amp;dwSize, NULL,</span>
<a href="#l41.136"></a><span id="l41.136" class="difflineminus">-                        NULL, NULL, &amp;time) == S_OK)</span>
<a href="#l41.137"></a><span id="l41.137" class="difflineminus">-    {</span>
<a href="#l41.138"></a><span id="l41.138" class="difflineminus">-        // Delete the decendents of this child.</span>
<a href="#l41.139"></a><span id="l41.139" class="difflineminus">-        lRes = recursiveDeleteKey(hKeyChild, szBuffer) ;</span>
<a href="#l41.140"></a><span id="l41.140" class="difflineminus">-        if (lRes != ERROR_SUCCESS)</span>
<a href="#l41.141"></a><span id="l41.141" class="difflineminus">-        {</span>
<a href="#l41.142"></a><span id="l41.142" class="difflineminus">-            // Cleanup before exiting.</span>
<a href="#l41.143"></a><span id="l41.143" class="difflineminus">-            RegCloseKey(hKeyChild) ;</span>
<a href="#l41.144"></a><span id="l41.144" class="difflineminus">-            return lRes;</span>
<a href="#l41.145"></a><span id="l41.145" class="difflineminus">-        }</span>
<a href="#l41.146"></a><span id="l41.146" class="difflineminus">-        dwSize = MAX_SIZE;</span>
<a href="#l41.147"></a><span id="l41.147" class="difflineminus">-    }</span>
<a href="#l41.148"></a><span id="l41.148" class="difflineminus">-</span>
<a href="#l41.149"></a><span id="l41.149" class="difflineminus">-    // Close the child.</span>
<a href="#l41.150"></a><span id="l41.150" class="difflineminus">-    RegCloseKey(hKeyChild) ;</span>
<a href="#l41.151"></a><span id="l41.151" class="difflineminus">-</span>
<a href="#l41.152"></a><span id="l41.152" class="difflineminus">-    // Delete this child.</span>
<a href="#l41.153"></a><span id="l41.153" class="difflineminus">-    return RegDeleteKey(hKeyParent, lpszKeyChild) ;</span>
<a href="#l41.154"></a><span id="l41.154" class="difflineminus">-}</span>
<a href="#l41.155"></a><span id="l41.155" class="difflineminus">-</span>
<a href="#l41.156"></a><span id="l41.156" class="difflineminus">-void RegisterProxy()</span>
<a href="#l41.157"></a><span id="l41.157" class="difflineminus">-{</span>
<a href="#l41.158"></a><span id="l41.158" class="difflineminus">-    HINSTANCE h = NULL;</span>
<a href="#l41.159"></a><span id="l41.159" class="difflineminus">-    ProxyServer *RegisterFunc = NULL;</span>
<a href="#l41.160"></a><span id="l41.160" class="difflineminus">-</span>
<a href="#l41.161"></a><span id="l41.161" class="difflineminus">-    char szModule[MAX_SIZE];</span>
<a href="#l41.162"></a><span id="l41.162" class="difflineminus">-    char *pTemp = NULL;</span>
<a href="#l41.163"></a><span id="l41.163" class="difflineminus">-</span>
<a href="#l41.164"></a><span id="l41.164" class="difflineminus">-    HMODULE hModule = GetModuleHandle(NULL);</span>
<a href="#l41.165"></a><span id="l41.165" class="difflineminus">-    DWORD dwResult  = ::GetModuleFileName(hModule, szModule,</span>
<a href="#l41.166"></a><span id="l41.166" class="difflineminus">-                                          sizeof(szModule)/sizeof(char));</span>
<a href="#l41.167"></a><span id="l41.167" class="difflineminus">-    if (dwResult == 0)</span>
<a href="#l41.168"></a><span id="l41.168" class="difflineminus">-        return;</span>
<a href="#l41.169"></a><span id="l41.169" class="difflineminus">-</span>
<a href="#l41.170"></a><span id="l41.170" class="difflineminus">-    pTemp = strrchr(szModule, '\\');</span>
<a href="#l41.171"></a><span id="l41.171" class="difflineminus">-    if (pTemp == NULL)</span>
<a href="#l41.172"></a><span id="l41.172" class="difflineminus">-        return;</span>
<a href="#l41.173"></a><span id="l41.173" class="difflineminus">-</span>
<a href="#l41.174"></a><span id="l41.174" class="difflineminus">-    *pTemp = '\0';</span>
<a href="#l41.175"></a><span id="l41.175" class="difflineminus">-    nsCAutoString proxyPath(szModule);</span>
<a href="#l41.176"></a><span id="l41.176" class="difflineminus">-</span>
<a href="#l41.177"></a><span id="l41.177" class="difflineminus">-    proxyPath += &quot;\\&quot;;</span>
<a href="#l41.178"></a><span id="l41.178" class="difflineminus">-    proxyPath += PALMSYNC_PROXY_DLL_NAME;</span>
<a href="#l41.179"></a><span id="l41.179" class="difflineminus">-</span>
<a href="#l41.180"></a><span id="l41.180" class="difflineminus">-    h = LoadLibrary(proxyPath.get());</span>
<a href="#l41.181"></a><span id="l41.181" class="difflineminus">-    if (h == NULL)</span>
<a href="#l41.182"></a><span id="l41.182" class="difflineminus">-        return;</span>
<a href="#l41.183"></a><span id="l41.183" class="difflineminus">-</span>
<a href="#l41.184"></a><span id="l41.184" class="difflineminus">-    RegisterFunc = (ProxyServer *) GetProcAddress(h, &quot;DllRegisterServer&quot;);</span>
<a href="#l41.185"></a><span id="l41.185" class="difflineminus">-    if (RegisterFunc)</span>
<a href="#l41.186"></a><span id="l41.186" class="difflineminus">-        RegisterFunc();</span>
<a href="#l41.187"></a><span id="l41.187" class="difflineminus">-</span>
<a href="#l41.188"></a><span id="l41.188" class="difflineminus">-    FreeLibrary(h);</span>
<a href="#l41.189"></a><span id="l41.189" class="difflineminus">-}</span>
<a href="#l41.190"></a><span id="l41.190" class="difflineminus">-</span>
<a href="#l41.191"></a><span id="l41.191" class="difflineminus">-void UnRegisterProxy()</span>
<a href="#l41.192"></a><span id="l41.192" class="difflineminus">-{</span>
<a href="#l41.193"></a><span id="l41.193" class="difflineminus">-    HINSTANCE h = NULL;</span>
<a href="#l41.194"></a><span id="l41.194" class="difflineminus">-    ProxyServer *UnRegisterFunc = NULL;</span>
<a href="#l41.195"></a><span id="l41.195" class="difflineminus">-</span>
<a href="#l41.196"></a><span id="l41.196" class="difflineminus">-    char szModule[MAX_SIZE];</span>
<a href="#l41.197"></a><span id="l41.197" class="difflineminus">-    char *pTemp = NULL;</span>
<a href="#l41.198"></a><span id="l41.198" class="difflineminus">-</span>
<a href="#l41.199"></a><span id="l41.199" class="difflineminus">-    HMODULE hModule = GetModuleHandle(NULL);</span>
<a href="#l41.200"></a><span id="l41.200" class="difflineminus">-    DWORD dwResult  = ::GetModuleFileName(hModule, szModule,</span>
<a href="#l41.201"></a><span id="l41.201" class="difflineminus">-                                          sizeof(szModule)/sizeof(char));</span>
<a href="#l41.202"></a><span id="l41.202" class="difflineminus">-    if (dwResult == 0)</span>
<a href="#l41.203"></a><span id="l41.203" class="difflineminus">-        return;</span>
<a href="#l41.204"></a><span id="l41.204" class="difflineminus">-</span>
<a href="#l41.205"></a><span id="l41.205" class="difflineminus">-    pTemp = strrchr(szModule, '\\');</span>
<a href="#l41.206"></a><span id="l41.206" class="difflineminus">-    if (pTemp == NULL)</span>
<a href="#l41.207"></a><span id="l41.207" class="difflineminus">-        return;</span>
<a href="#l41.208"></a><span id="l41.208" class="difflineminus">-</span>
<a href="#l41.209"></a><span id="l41.209" class="difflineminus">-    *pTemp = '\0';</span>
<a href="#l41.210"></a><span id="l41.210" class="difflineminus">-    nsCAutoString proxyPath(szModule);</span>
<a href="#l41.211"></a><span id="l41.211" class="difflineminus">-</span>
<a href="#l41.212"></a><span id="l41.212" class="difflineminus">-    proxyPath += &quot;\\&quot;;</span>
<a href="#l41.213"></a><span id="l41.213" class="difflineminus">-    proxyPath += PALMSYNC_PROXY_DLL_NAME;</span>
<a href="#l41.214"></a><span id="l41.214" class="difflineminus">-</span>
<a href="#l41.215"></a><span id="l41.215" class="difflineminus">-    h = LoadLibrary(proxyPath.get());</span>
<a href="#l41.216"></a><span id="l41.216" class="difflineminus">-    if (h == NULL)</span>
<a href="#l41.217"></a><span id="l41.217" class="difflineminus">-        return;</span>
<a href="#l41.218"></a><span id="l41.218" class="difflineminus">-</span>
<a href="#l41.219"></a><span id="l41.219" class="difflineminus">-    UnRegisterFunc = (ProxyServer *) GetProcAddress(h, &quot;DllUnregisterServer&quot;);</span>
<a href="#l41.220"></a><span id="l41.220" class="difflineminus">-    if (UnRegisterFunc)</span>
<a href="#l41.221"></a><span id="l41.221" class="difflineminus">-        UnRegisterFunc();</span>
<a href="#l41.222"></a><span id="l41.222" class="difflineminus">-</span>
<a href="#l41.223"></a><span id="l41.223" class="difflineminus">-    FreeLibrary(h);</span>
<a href="#l41.224"></a><span id="l41.224" class="difflineminus">-}</span>
<a href="#l41.225"></a><span id="l41.225" class="difflineminus">-</span>
<a href="#l41.226"></a><span id="l41.226" class="difflineminus">-// Register the component in the registry.</span>
<a href="#l41.227"></a><span id="l41.227" class="difflineminus">-</span>
<a href="#l41.228"></a><span id="l41.228" class="difflineminus">-HRESULT RegisterServerForPalmSync(const CLSID&amp; clsid,         // Class ID</span>
<a href="#l41.229"></a><span id="l41.229" class="difflineminus">-                       const char* szFriendlyName, // Friendly Name</span>
<a href="#l41.230"></a><span id="l41.230" class="difflineminus">-                       const char* szVerIndProgID, // Programmatic</span>
<a href="#l41.231"></a><span id="l41.231" class="difflineminus">-                       const char* szProgID)       //   IDs</span>
<a href="#l41.232"></a><span id="l41.232" class="difflineminus">-{</span>
<a href="#l41.233"></a><span id="l41.233" class="difflineminus">-    HMODULE hModule = GetModuleHandle(NULL);</span>
<a href="#l41.234"></a><span id="l41.234" class="difflineminus">-    char szModuleName[MAX_SIZE];</span>
<a href="#l41.235"></a><span id="l41.235" class="difflineminus">-    char szCLSID[CLSID_STRING_SIZE];</span>
<a href="#l41.236"></a><span id="l41.236" class="difflineminus">-</span>
<a href="#l41.237"></a><span id="l41.237" class="difflineminus">-    nsCAutoString independentProgId(szVerIndProgID);</span>
<a href="#l41.238"></a><span id="l41.238" class="difflineminus">-    nsCAutoString progId(szProgID);</span>
<a href="#l41.239"></a><span id="l41.239" class="difflineminus">-</span>
<a href="#l41.240"></a><span id="l41.240" class="difflineminus">-    DWORD dwResult = ::GetModuleFileName(hModule, szModuleName,</span>
<a href="#l41.241"></a><span id="l41.241" class="difflineminus">-                              sizeof(szModuleName)/sizeof(char));</span>
<a href="#l41.242"></a><span id="l41.242" class="difflineminus">-</span>
<a href="#l41.243"></a><span id="l41.243" class="difflineminus">-    if (dwResult == 0)</span>
<a href="#l41.244"></a><span id="l41.244" class="difflineminus">-        return S_FALSE;</span>
<a href="#l41.245"></a><span id="l41.245" class="difflineminus">-</span>
<a href="#l41.246"></a><span id="l41.246" class="difflineminus">-    nsCAutoString moduleName(szModuleName);</span>
<a href="#l41.247"></a><span id="l41.247" class="difflineminus">-    nsCAutoString registryKey(&quot;CLSID\\&quot;);</span>
<a href="#l41.248"></a><span id="l41.248" class="difflineminus">-</span>
<a href="#l41.249"></a><span id="l41.249" class="difflineminus">-    moduleName += PALMSYNC_STARTUP_ARG;</span>
<a href="#l41.250"></a><span id="l41.250" class="difflineminus">-</span>
<a href="#l41.251"></a><span id="l41.251" class="difflineminus">-    // Convert the CLSID into a char.</span>
<a href="#l41.252"></a><span id="l41.252" class="difflineminus">-</span>
<a href="#l41.253"></a><span id="l41.253" class="difflineminus">-    if (!CLSIDtochar(clsid, szCLSID, sizeof(szCLSID)))</span>
<a href="#l41.254"></a><span id="l41.254" class="difflineminus">-        return S_FALSE;</span>
<a href="#l41.255"></a><span id="l41.255" class="difflineminus">-    registryKey += szCLSID;</span>
<a href="#l41.256"></a><span id="l41.256" class="difflineminus">-</span>
<a href="#l41.257"></a><span id="l41.257" class="difflineminus">-    // Add the CLSID to the registry.</span>
<a href="#l41.258"></a><span id="l41.258" class="difflineminus">-    if((!setKeyAndValue(registryKey, NULL, szFriendlyName))</span>
<a href="#l41.259"></a><span id="l41.259" class="difflineminus">-         || (!setKeyAndValue(registryKey, &quot;LocalServer32&quot;, moduleName.get()))</span>
<a href="#l41.260"></a><span id="l41.260" class="difflineminus">-         // Add the ProgID subkey under the CLSID key.</span>
<a href="#l41.261"></a><span id="l41.261" class="difflineminus">-         || (!setKeyAndValue(registryKey, &quot;ProgID&quot;, szProgID))</span>
<a href="#l41.262"></a><span id="l41.262" class="difflineminus">-         // Add the version-independent ProgID subkey under CLSID key.</span>
<a href="#l41.263"></a><span id="l41.263" class="difflineminus">-         || (!setKeyAndValue(registryKey, &quot;VersionIndependentProgID&quot;, szVerIndProgID))</span>
<a href="#l41.264"></a><span id="l41.264" class="difflineminus">-         // Add the version-independent ProgID subkey under HKEY_CLASSES_ROOT.</span>
<a href="#l41.265"></a><span id="l41.265" class="difflineminus">-         || (!setKeyAndValue(independentProgId, NULL, szFriendlyName))</span>
<a href="#l41.266"></a><span id="l41.266" class="difflineminus">-         || (!setKeyAndValue(independentProgId, &quot;CLSID&quot;, szCLSID))</span>
<a href="#l41.267"></a><span id="l41.267" class="difflineminus">-         || (!setKeyAndValue(independentProgId, &quot;CurVer&quot;, szProgID))</span>
<a href="#l41.268"></a><span id="l41.268" class="difflineminus">-         // Add the versioned ProgID subkey under HKEY_CLASSES_ROOT.</span>
<a href="#l41.269"></a><span id="l41.269" class="difflineminus">-         || (!setKeyAndValue(progId, NULL, szFriendlyName))</span>
<a href="#l41.270"></a><span id="l41.270" class="difflineminus">-         || (!setKeyAndValue(progId, &quot;CLSID&quot;, szCLSID))</span>
<a href="#l41.271"></a><span id="l41.271" class="difflineminus">-      )</span>
<a href="#l41.272"></a><span id="l41.272" class="difflineminus">-        return S_FALSE;</span>
<a href="#l41.273"></a><span id="l41.273" class="difflineminus">-</span>
<a href="#l41.274"></a><span id="l41.274" class="difflineminus">-    RegisterProxy();</span>
<a href="#l41.275"></a><span id="l41.275" class="difflineminus">-</span>
<a href="#l41.276"></a><span id="l41.276" class="difflineminus">-    return S_OK;</span>
<a href="#l41.277"></a><span id="l41.277" class="difflineminus">-}</span>
<a href="#l41.278"></a><span id="l41.278" class="difflineminus">-</span>
<a href="#l41.279"></a><span id="l41.279" class="difflineminus">-LONG UnregisterServerForPalmSync(const CLSID&amp; clsid,         // Class ID</span>
<a href="#l41.280"></a><span id="l41.280" class="difflineminus">-                      const char* szVerIndProgID, // Programmatic</span>
<a href="#l41.281"></a><span id="l41.281" class="difflineminus">-                      const char* szProgID)       //   IDs</span>
<a href="#l41.282"></a><span id="l41.282" class="difflineminus">-{</span>
<a href="#l41.283"></a><span id="l41.283" class="difflineminus">-    LONG lResult = S_OK;</span>
<a href="#l41.284"></a><span id="l41.284" class="difflineminus">-</span>
<a href="#l41.285"></a><span id="l41.285" class="difflineminus">-    // Convert the CLSID into a char.</span>
<a href="#l41.286"></a><span id="l41.286" class="difflineminus">-</span>
<a href="#l41.287"></a><span id="l41.287" class="difflineminus">-    char szCLSID[CLSID_STRING_SIZE];</span>
<a href="#l41.288"></a><span id="l41.288" class="difflineminus">-    if (!CLSIDtochar(clsid, szCLSID, sizeof(szCLSID)))</span>
<a href="#l41.289"></a><span id="l41.289" class="difflineminus">-        return S_FALSE;</span>
<a href="#l41.290"></a><span id="l41.290" class="difflineminus">-</span>
<a href="#l41.291"></a><span id="l41.291" class="difflineminus">-    UnRegisterProxy();</span>
<a href="#l41.292"></a><span id="l41.292" class="difflineminus">-</span>
<a href="#l41.293"></a><span id="l41.293" class="difflineminus">-    nsCAutoString registryKey(&quot;CLSID\\&quot;);</span>
<a href="#l41.294"></a><span id="l41.294" class="difflineminus">-    registryKey += szCLSID;</span>
<a href="#l41.295"></a><span id="l41.295" class="difflineminus">-</span>
<a href="#l41.296"></a><span id="l41.296" class="difflineminus">-    lResult = recursiveDeleteKey(HKEY_CLASSES_ROOT, registryKey.get());</span>
<a href="#l41.297"></a><span id="l41.297" class="difflineminus">-    if (lResult == ERROR_SUCCESS || lResult == ERROR_FILE_NOT_FOUND)</span>
<a href="#l41.298"></a><span id="l41.298" class="difflineminus">-        return lResult;</span>
<a href="#l41.299"></a><span id="l41.299" class="difflineminus">-</span>
<a href="#l41.300"></a><span id="l41.300" class="difflineminus">-    registryKey += &quot;\\LocalServer32&quot;;</span>
<a href="#l41.301"></a><span id="l41.301" class="difflineminus">-</span>
<a href="#l41.302"></a><span id="l41.302" class="difflineminus">-    // Delete only the path for this server.</span>
<a href="#l41.303"></a><span id="l41.303" class="difflineminus">-</span>
<a href="#l41.304"></a><span id="l41.304" class="difflineminus">-    lResult = recursiveDeleteKey(HKEY_CLASSES_ROOT, registryKey.get());</span>
<a href="#l41.305"></a><span id="l41.305" class="difflineminus">-    if (lResult != ERROR_SUCCESS &amp;&amp; lResult != ERROR_FILE_NOT_FOUND)</span>
<a href="#l41.306"></a><span id="l41.306" class="difflineminus">-        return lResult;</span>
<a href="#l41.307"></a><span id="l41.307" class="difflineminus">-</span>
<a href="#l41.308"></a><span id="l41.308" class="difflineminus">-    // Delete the version-independent ProgID Key.</span>
<a href="#l41.309"></a><span id="l41.309" class="difflineminus">-    lResult = recursiveDeleteKey(HKEY_CLASSES_ROOT, szVerIndProgID);</span>
<a href="#l41.310"></a><span id="l41.310" class="difflineminus">-    if (lResult != ERROR_SUCCESS &amp;&amp; lResult != ERROR_FILE_NOT_FOUND)</span>
<a href="#l41.311"></a><span id="l41.311" class="difflineminus">-        return lResult;</span>
<a href="#l41.312"></a><span id="l41.312" class="difflineminus">-</span>
<a href="#l41.313"></a><span id="l41.313" class="difflineminus">-    lResult = recursiveDeleteKey(HKEY_CLASSES_ROOT, szProgID);</span>
<a href="#l41.314"></a><span id="l41.314" class="difflineminus">-</span>
<a href="#l41.315"></a><span id="l41.315" class="difflineminus">-    return lResult;</span>
<a href="#l41.316"></a><span id="l41.316" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1">deleted file mode 100644</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/Registry.h</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineplus">+++ /dev/null</span>
<a href="#l42.4"></a><span id="l42.4" class="difflineat">@@ -1,56 +0,0 @@</span>
<a href="#l42.5"></a><span id="l42.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l42.6"></a><span id="l42.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l42.7"></a><span id="l42.7" class="difflineminus">- *</span>
<a href="#l42.8"></a><span id="l42.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l42.9"></a><span id="l42.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l42.10"></a><span id="l42.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l42.11"></a><span id="l42.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">- *</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineminus">- * License.</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineminus">- *</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineminus">- *</span>
<a href="#l42.20"></a><span id="l42.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l42.21"></a><span id="l42.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2001</span>
<a href="#l42.23"></a><span id="l42.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l42.24"></a><span id="l42.24" class="difflineminus">- *</span>
<a href="#l42.25"></a><span id="l42.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l42.26"></a><span id="l42.26" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l42.27"></a><span id="l42.27" class="difflineminus">- *</span>
<a href="#l42.28"></a><span id="l42.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l42.29"></a><span id="l42.29" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l42.30"></a><span id="l42.30" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l42.33"></a><span id="l42.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l42.34"></a><span id="l42.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l42.35"></a><span id="l42.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l42.36"></a><span id="l42.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l42.37"></a><span id="l42.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l42.38"></a><span id="l42.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l42.39"></a><span id="l42.39" class="difflineminus">- *</span>
<a href="#l42.40"></a><span id="l42.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineminus">-</span>
<a href="#l42.42"></a><span id="l42.42" class="difflineminus">-#ifndef _REGISTRY_H_</span>
<a href="#l42.43"></a><span id="l42.43" class="difflineminus">-#define _REGISTRY_H_</span>
<a href="#l42.44"></a><span id="l42.44" class="difflineminus">-</span>
<a href="#l42.45"></a><span id="l42.45" class="difflineminus">-#include &lt;objbase.h&gt;</span>
<a href="#l42.46"></a><span id="l42.46" class="difflineminus">-</span>
<a href="#l42.47"></a><span id="l42.47" class="difflineminus">-// This function will register a component in the Registry.</span>
<a href="#l42.48"></a><span id="l42.48" class="difflineminus">-</span>
<a href="#l42.49"></a><span id="l42.49" class="difflineminus">-HRESULT RegisterServerForPalmSync(const CLSID&amp; clsid, </span>
<a href="#l42.50"></a><span id="l42.50" class="difflineminus">-                       const char* szFriendlyName,</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineminus">-                       const char* szVerIndProgID,</span>
<a href="#l42.52"></a><span id="l42.52" class="difflineminus">-                       const char* szProgID) ;</span>
<a href="#l42.53"></a><span id="l42.53" class="difflineminus">-</span>
<a href="#l42.54"></a><span id="l42.54" class="difflineminus">-// This function will unregister a component.</span>
<a href="#l42.55"></a><span id="l42.55" class="difflineminus">-</span>
<a href="#l42.56"></a><span id="l42.56" class="difflineminus">-HRESULT UnregisterServerForPalmSync(const CLSID&amp; clsid,</span>
<a href="#l42.57"></a><span id="l42.57" class="difflineminus">-                         const char* szVerIndProgID,</span>
<a href="#l42.58"></a><span id="l42.58" class="difflineminus">-                         const char* szProgID) ;</span>
<a href="#l42.59"></a><span id="l42.59" class="difflineminus">-</span>
<a href="#l42.60"></a><span id="l42.60" class="difflineminus">-#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1">deleted file mode 100644</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/nsAbIPCCard.cpp</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineplus">+++ /dev/null</span>
<a href="#l43.4"></a><span id="l43.4" class="difflineat">@@ -1,1022 +0,0 @@</span>
<a href="#l43.5"></a><span id="l43.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l43.6"></a><span id="l43.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l43.7"></a><span id="l43.7" class="difflineminus">- *</span>
<a href="#l43.8"></a><span id="l43.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l43.9"></a><span id="l43.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l43.10"></a><span id="l43.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l43.11"></a><span id="l43.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">- *</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineminus">- * License.</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineminus">- *</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineminus">- *</span>
<a href="#l43.20"></a><span id="l43.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l43.21"></a><span id="l43.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l43.23"></a><span id="l43.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l43.24"></a><span id="l43.24" class="difflineminus">- *</span>
<a href="#l43.25"></a><span id="l43.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l43.26"></a><span id="l43.26" class="difflineminus">- *   Created by: Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l43.27"></a><span id="l43.27" class="difflineminus">- *</span>
<a href="#l43.28"></a><span id="l43.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l43.29"></a><span id="l43.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l43.30"></a><span id="l43.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l43.33"></a><span id="l43.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l43.34"></a><span id="l43.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l43.35"></a><span id="l43.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l43.36"></a><span id="l43.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l43.37"></a><span id="l43.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l43.38"></a><span id="l43.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l43.39"></a><span id="l43.39" class="difflineminus">- *</span>
<a href="#l43.40"></a><span id="l43.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l43.41"></a><span id="l43.41" class="difflineminus">-</span>
<a href="#l43.42"></a><span id="l43.42" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l43.43"></a><span id="l43.43" class="difflineminus">-#include &lt;tchar.h&gt;</span>
<a href="#l43.44"></a><span id="l43.44" class="difflineminus">-</span>
<a href="#l43.45"></a><span id="l43.45" class="difflineminus">-#include &quot;nsAbIPCCard.h&quot;</span>
<a href="#l43.46"></a><span id="l43.46" class="difflineminus">-#include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l43.47"></a><span id="l43.47" class="difflineminus">-#include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l43.48"></a><span id="l43.48" class="difflineminus">-#include &quot;prdtoa.h&quot;</span>
<a href="#l43.49"></a><span id="l43.49" class="difflineminus">-#include &quot;PalmSyncImp.h&quot;</span>
<a href="#l43.50"></a><span id="l43.50" class="difflineminus">-</span>
<a href="#l43.51"></a><span id="l43.51" class="difflineminus">-extern PRLogModuleInfo *PALMSYNC;</span>
<a href="#l43.52"></a><span id="l43.52" class="difflineminus">-</span>
<a href="#l43.53"></a><span id="l43.53" class="difflineminus">-#define CONVERT_ASSIGNTO_UNICODE(d, s, convertCRLF)  d.Truncate();\</span>
<a href="#l43.54"></a><span id="l43.54" class="difflineminus">-                                        if((char*) s) d.AppendASCII((char*)s);\</span>
<a href="#l43.55"></a><span id="l43.55" class="difflineminus">-                                        if (convertCRLF) \</span>
<a href="#l43.56"></a><span id="l43.56" class="difflineminus">-                                          d.ReplaceSubstring(NS_LITERAL_STRING(&quot;\x0D\x0A&quot;).get(),NS_LITERAL_STRING(&quot; &quot;).get());</span>
<a href="#l43.57"></a><span id="l43.57" class="difflineminus">-</span>
<a href="#l43.58"></a><span id="l43.58" class="difflineminus">-#define CONVERT_CRLF_TO_SPACE(d, s) d.Assign(s); \</span>
<a href="#l43.59"></a><span id="l43.59" class="difflineminus">-                                    d.ReplaceSubstring(NS_LITERAL_STRING(&quot;\x0D\x0A&quot;).get(),NS_LITERAL_STRING(&quot; &quot;).get());</span>
<a href="#l43.60"></a><span id="l43.60" class="difflineminus">-</span>
<a href="#l43.61"></a><span id="l43.61" class="difflineminus">-NS_IMPL_ISUPPORTS_INHERITED0(nsAbIPCCard, nsAbCardProperty)</span>
<a href="#l43.62"></a><span id="l43.62" class="difflineminus">-</span>
<a href="#l43.63"></a><span id="l43.63" class="difflineminus">-nsAbIPCCard::nsAbIPCCard()</span>
<a href="#l43.64"></a><span id="l43.64" class="difflineminus">-{</span>
<a href="#l43.65"></a><span id="l43.65" class="difflineminus">-    mRecordId = 0;</span>
<a href="#l43.66"></a><span id="l43.66" class="difflineminus">-    mCategoryId = -1;</span>
<a href="#l43.67"></a><span id="l43.67" class="difflineminus">-    mStatus = -1;</span>
<a href="#l43.68"></a><span id="l43.68" class="difflineminus">-    PR_LOG(PALMSYNC, PR_LOG_DEBUG, (&quot;nsAbIPCCard::nsAbIPCCard \n&quot;));</span>
<a href="#l43.69"></a><span id="l43.69" class="difflineminus">-}</span>
<a href="#l43.70"></a><span id="l43.70" class="difflineminus">-</span>
<a href="#l43.71"></a><span id="l43.71" class="difflineminus">-nsAbIPCCard::~nsAbIPCCard()</span>
<a href="#l43.72"></a><span id="l43.72" class="difflineminus">-{</span>
<a href="#l43.73"></a><span id="l43.73" class="difflineminus">-   </span>
<a href="#l43.74"></a><span id="l43.74" class="difflineminus">-}</span>
<a href="#l43.75"></a><span id="l43.75" class="difflineminus">-</span>
<a href="#l43.76"></a><span id="l43.76" class="difflineminus">-nsAbIPCCard::nsAbIPCCard(nsIAbCard *card)</span>
<a href="#l43.77"></a><span id="l43.77" class="difflineminus">-{</span>
<a href="#l43.78"></a><span id="l43.78" class="difflineminus">-    Copy(card);</span>
<a href="#l43.79"></a><span id="l43.79" class="difflineminus">-}</span>
<a href="#l43.80"></a><span id="l43.80" class="difflineminus">-</span>
<a href="#l43.81"></a><span id="l43.81" class="difflineminus">-nsAbIPCCard::nsAbIPCCard(nsABCOMCardStruct *card, PRBool isUnicode)</span>
<a href="#l43.82"></a><span id="l43.82" class="difflineminus">-{</span>
<a href="#l43.83"></a><span id="l43.83" class="difflineminus">-    if(isUnicode)</span>
<a href="#l43.84"></a><span id="l43.84" class="difflineminus">-        Copy(card);</span>
<a href="#l43.85"></a><span id="l43.85" class="difflineminus">-    else</span>
<a href="#l43.86"></a><span id="l43.86" class="difflineminus">-        ConvertToUnicodeAndCopy(card);</span>
<a href="#l43.87"></a><span id="l43.87" class="difflineminus">-}</span>
<a href="#l43.88"></a><span id="l43.88" class="difflineminus">-</span>
<a href="#l43.89"></a><span id="l43.89" class="difflineminus">-NS_IMETHODIMP nsAbIPCCard::Copy(nsIAbCard *srcCard)</span>
<a href="#l43.90"></a><span id="l43.90" class="difflineminus">-{</span>
<a href="#l43.91"></a><span id="l43.91" class="difflineminus">-    NS_ENSURE_ARG_POINTER(srcCard);</span>
<a href="#l43.92"></a><span id="l43.92" class="difflineminus">-</span>
<a href="#l43.93"></a><span id="l43.93" class="difflineminus">-    nsString palmIDStr;</span>
<a href="#l43.94"></a><span id="l43.94" class="difflineminus">-    nsresult rv = srcCard-&gt;GetPropertyAsAString(CARD_ATTRIB_PALMID, palmIDStr);</span>
<a href="#l43.95"></a><span id="l43.95" class="difflineminus">-   if (NS_SUCCEEDED(rv) &amp;&amp; !palmIDStr.IsEmpty()) {</span>
<a href="#l43.96"></a><span id="l43.96" class="difflineminus">-     PRFloat64 f = PR_strtod(NS_LossyConvertUTF16toASCII(palmIDStr).get(), nsnull);</span>
<a href="#l43.97"></a><span id="l43.97" class="difflineminus">-     PRInt64 l;</span>
<a href="#l43.98"></a><span id="l43.98" class="difflineminus">-     LL_D2L(l, f);</span>
<a href="#l43.99"></a><span id="l43.99" class="difflineminus">-     LL_L2UI(mRecordId, l);</span>
<a href="#l43.100"></a><span id="l43.100" class="difflineminus">-   }</span>
<a href="#l43.101"></a><span id="l43.101" class="difflineminus">-   else</span>
<a href="#l43.102"></a><span id="l43.102" class="difflineminus">-     mRecordId = 0;</span>
<a href="#l43.103"></a><span id="l43.103" class="difflineminus">-</span>
<a href="#l43.104"></a><span id="l43.104" class="difflineminus">-   PRUint32 rowID = 0;</span>
<a href="#l43.105"></a><span id="l43.105" class="difflineminus">-   srcCard-&gt;GetPropertyAsUint32(&quot;DbRowID&quot;, &amp;rowID);</span>
<a href="#l43.106"></a><span id="l43.106" class="difflineminus">-   SetPropertyAsUint32(&quot;DbRowID&quot;, rowID);</span>
<a href="#l43.107"></a><span id="l43.107" class="difflineminus">-</span>
<a href="#l43.108"></a><span id="l43.108" class="difflineminus">-   PRUint32 key = 0;</span>
<a href="#l43.109"></a><span id="l43.109" class="difflineminus">-   srcCard-&gt;GetPropertyAsUint32(&quot;RecordKey&quot;, &amp;key);</span>
<a href="#l43.110"></a><span id="l43.110" class="difflineminus">-   SetPropertyAsUint32(&quot;RecordKey&quot;, key);</span>
<a href="#l43.111"></a><span id="l43.111" class="difflineminus">-</span>
<a href="#l43.112"></a><span id="l43.112" class="difflineminus">-   PRUint32 lastModifiedDate = 0;</span>
<a href="#l43.113"></a><span id="l43.113" class="difflineminus">-   srcCard-&gt;GetPropertyAsUint32(kLastModifiedDateProperty, &amp;lastModifiedDate);</span>
<a href="#l43.114"></a><span id="l43.114" class="difflineminus">-   mStatus = (lastModifiedDate) ? ATTR_MODIFIED : ATTR_NEW;</span>
<a href="#l43.115"></a><span id="l43.115" class="difflineminus">-</span>
<a href="#l43.116"></a><span id="l43.116" class="difflineminus">-</span>
<a href="#l43.117"></a><span id="l43.117" class="difflineminus">-    rv = nsAbCardProperty::Copy(srcCard);</span>
<a href="#l43.118"></a><span id="l43.118" class="difflineminus">-    // do we need to join the work and home addresses?</span>
<a href="#l43.119"></a><span id="l43.119" class="difflineminus">-    // or split them?</span>
<a href="#l43.120"></a><span id="l43.120" class="difflineminus">-</span>
<a href="#l43.121"></a><span id="l43.121" class="difflineminus">-    return rv;</span>
<a href="#l43.122"></a><span id="l43.122" class="difflineminus">-}</span>
<a href="#l43.123"></a><span id="l43.123" class="difflineminus">-</span>
<a href="#l43.124"></a><span id="l43.124" class="difflineminus">-nsresult nsAbIPCCard::Copy(nsABCOMCardStruct * srcCard)</span>
<a href="#l43.125"></a><span id="l43.125" class="difflineminus">-{</span>
<a href="#l43.126"></a><span id="l43.126" class="difflineminus">-    NS_ENSURE_ARG_POINTER(srcCard);</span>
<a href="#l43.127"></a><span id="l43.127" class="difflineminus">-</span>
<a href="#l43.128"></a><span id="l43.128" class="difflineminus">-    mRecordId = srcCard-&gt;dwRecordId;</span>
<a href="#l43.129"></a><span id="l43.129" class="difflineminus">-    mCategoryId = srcCard-&gt;dwCategoryId;</span>
<a href="#l43.130"></a><span id="l43.130" class="difflineminus">-    mStatus = srcCard-&gt;dwStatus;</span>
<a href="#l43.131"></a><span id="l43.131" class="difflineminus">-    srcCard-&gt;addressToUse = CPalmSyncImp::nsUseABHomeAddressForPalmAddress(); // 0 == work, 1 == home</span>
<a href="#l43.132"></a><span id="l43.132" class="difflineminus">-    PR_LOG(PALMSYNC, PR_LOG_DEBUG, (&quot;nsAbIPCCard::Copy using %d\n&quot;, srcCard-&gt;addressToUse));</span>
<a href="#l43.133"></a><span id="l43.133" class="difflineminus">-</span>
<a href="#l43.134"></a><span id="l43.134" class="difflineminus">-    // Each palm address field is allowed to have multiple lines</span>
<a href="#l43.135"></a><span id="l43.135" class="difflineminus">-    // so replace CRLFs with spaces (since other than Notes field</span>
<a href="#l43.136"></a><span id="l43.136" class="difflineminus">-    // moz only displays fields in a single line).</span>
<a href="#l43.137"></a><span id="l43.137" class="difflineminus">-    nsAutoString str;</span>
<a href="#l43.138"></a><span id="l43.138" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;firstName);</span>
<a href="#l43.139"></a><span id="l43.139" class="difflineminus">-    SetFirstName(str);</span>
<a href="#l43.140"></a><span id="l43.140" class="difflineminus">-</span>
<a href="#l43.141"></a><span id="l43.141" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;lastName);</span>
<a href="#l43.142"></a><span id="l43.142" class="difflineminus">-    SetLastName(str);</span>
<a href="#l43.143"></a><span id="l43.143" class="difflineminus">-</span>
<a href="#l43.144"></a><span id="l43.144" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;displayName);</span>
<a href="#l43.145"></a><span id="l43.145" class="difflineminus">-    SetDisplayName(str);</span>
<a href="#l43.146"></a><span id="l43.146" class="difflineminus">-</span>
<a href="#l43.147"></a><span id="l43.147" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;nickName);</span>
<a href="#l43.148"></a><span id="l43.148" class="difflineminus">-    SetPropertyAsAString(kNicknameProperty, str);</span>
<a href="#l43.149"></a><span id="l43.149" class="difflineminus">-</span>
<a href="#l43.150"></a><span id="l43.150" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;primaryEmail);</span>
<a href="#l43.151"></a><span id="l43.151" class="difflineminus">-    SetPrimaryEmail(str);</span>
<a href="#l43.152"></a><span id="l43.152" class="difflineminus">-</span>
<a href="#l43.153"></a><span id="l43.153" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;secondEmail);</span>
<a href="#l43.154"></a><span id="l43.154" class="difflineminus">-    SetPropertyAsAString(k2ndEmailProperty, str);</span>
<a href="#l43.155"></a><span id="l43.155" class="difflineminus">-</span>
<a href="#l43.156"></a><span id="l43.156" class="difflineminus">-    SetPropertyAsUint32(kPreferMailFormatProperty, srcCard-&gt;preferMailFormat);</span>
<a href="#l43.157"></a><span id="l43.157" class="difflineminus">-</span>
<a href="#l43.158"></a><span id="l43.158" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;workPhone);</span>
<a href="#l43.159"></a><span id="l43.159" class="difflineminus">-    SetPropertyAsAString(kWorkPhoneProperty, str);</span>
<a href="#l43.160"></a><span id="l43.160" class="difflineminus">-</span>
<a href="#l43.161"></a><span id="l43.161" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;homePhone);</span>
<a href="#l43.162"></a><span id="l43.162" class="difflineminus">-    SetPropertyAsAString(kHomePhoneProperty, str);</span>
<a href="#l43.163"></a><span id="l43.163" class="difflineminus">-</span>
<a href="#l43.164"></a><span id="l43.164" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;faxNumber);</span>
<a href="#l43.165"></a><span id="l43.165" class="difflineminus">-    SetPropertyAsAString(kFaxProperty, str);</span>
<a href="#l43.166"></a><span id="l43.166" class="difflineminus">-</span>
<a href="#l43.167"></a><span id="l43.167" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;pagerNumber);</span>
<a href="#l43.168"></a><span id="l43.168" class="difflineminus">-    SetPropertyAsAString(kPagerProperty, str);</span>
<a href="#l43.169"></a><span id="l43.169" class="difflineminus">-</span>
<a href="#l43.170"></a><span id="l43.170" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;cellularNumber);</span>
<a href="#l43.171"></a><span id="l43.171" class="difflineminus">-    SetPropertyAsAString(kCellularProperty, str);</span>
<a href="#l43.172"></a><span id="l43.172" class="difflineminus">-</span>
<a href="#l43.173"></a><span id="l43.173" class="difflineminus">-    // See if home address contains multiple lines.</span>
<a href="#l43.174"></a><span id="l43.174" class="difflineminus">-    SplitHomeAndWorkAddresses(srcCard, PR_TRUE);</span>
<a href="#l43.175"></a><span id="l43.175" class="difflineminus">-</span>
<a href="#l43.176"></a><span id="l43.176" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;homeCity);</span>
<a href="#l43.177"></a><span id="l43.177" class="difflineminus">-    SetPropertyAsAString(kHomeCityProperty, str);</span>
<a href="#l43.178"></a><span id="l43.178" class="difflineminus">-</span>
<a href="#l43.179"></a><span id="l43.179" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;homeState);</span>
<a href="#l43.180"></a><span id="l43.180" class="difflineminus">-    SetPropertyAsAString(kHomeStateProperty, str);</span>
<a href="#l43.181"></a><span id="l43.181" class="difflineminus">-</span>
<a href="#l43.182"></a><span id="l43.182" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;homeZipCode);</span>
<a href="#l43.183"></a><span id="l43.183" class="difflineminus">-    SetPropertyAsAString(kHomeZipCodeProperty, str);</span>
<a href="#l43.184"></a><span id="l43.184" class="difflineminus">-</span>
<a href="#l43.185"></a><span id="l43.185" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;homeCountry);</span>
<a href="#l43.186"></a><span id="l43.186" class="difflineminus">-    SetPropertyAsAString(kHomeCountryProperty, str);</span>
<a href="#l43.187"></a><span id="l43.187" class="difflineminus">-</span>
<a href="#l43.188"></a><span id="l43.188" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;workCity);</span>
<a href="#l43.189"></a><span id="l43.189" class="difflineminus">-    SetPropertyAsAString(kWorkCityProperty, str);</span>
<a href="#l43.190"></a><span id="l43.190" class="difflineminus">-</span>
<a href="#l43.191"></a><span id="l43.191" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;workState);</span>
<a href="#l43.192"></a><span id="l43.192" class="difflineminus">-    SetPropertyAsAString(kWorkStateProperty, str);</span>
<a href="#l43.193"></a><span id="l43.193" class="difflineminus">-</span>
<a href="#l43.194"></a><span id="l43.194" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;workZipCode);</span>
<a href="#l43.195"></a><span id="l43.195" class="difflineminus">-    SetPropertyAsAString(kWorkZipCodeProperty, str);</span>
<a href="#l43.196"></a><span id="l43.196" class="difflineminus">-</span>
<a href="#l43.197"></a><span id="l43.197" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;workCountry);</span>
<a href="#l43.198"></a><span id="l43.198" class="difflineminus">-    SetPropertyAsAString(kWorkCountryProperty, str);</span>
<a href="#l43.199"></a><span id="l43.199" class="difflineminus">-</span>
<a href="#l43.200"></a><span id="l43.200" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;jobTitle);</span>
<a href="#l43.201"></a><span id="l43.201" class="difflineminus">-    SetPropertyAsAString(kJobTitleProperty, str);</span>
<a href="#l43.202"></a><span id="l43.202" class="difflineminus">-</span>
<a href="#l43.203"></a><span id="l43.203" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;department);</span>
<a href="#l43.204"></a><span id="l43.204" class="difflineminus">-    SetPropertyAsAString(kDepartmentProperty, str);</span>
<a href="#l43.205"></a><span id="l43.205" class="difflineminus">-</span>
<a href="#l43.206"></a><span id="l43.206" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;company);</span>
<a href="#l43.207"></a><span id="l43.207" class="difflineminus">-    SetPropertyAsAString(kCompanyProperty, str);</span>
<a href="#l43.208"></a><span id="l43.208" class="difflineminus">-</span>
<a href="#l43.209"></a><span id="l43.209" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;webPage1);</span>
<a href="#l43.210"></a><span id="l43.210" class="difflineminus">-    SetPropertyAsAString(kWorkWebPageProperty, str);</span>
<a href="#l43.211"></a><span id="l43.211" class="difflineminus">-</span>
<a href="#l43.212"></a><span id="l43.212" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;webPage2);</span>
<a href="#l43.213"></a><span id="l43.213" class="difflineminus">-    SetPropertyAsAString(kHomeWebPageProperty, str);</span>
<a href="#l43.214"></a><span id="l43.214" class="difflineminus">-</span>
<a href="#l43.215"></a><span id="l43.215" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;birthYear);</span>
<a href="#l43.216"></a><span id="l43.216" class="difflineminus">-    SetPropertyAsAString(kBirthYearProperty, str);</span>
<a href="#l43.217"></a><span id="l43.217" class="difflineminus">-</span>
<a href="#l43.218"></a><span id="l43.218" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;birthMonth);</span>
<a href="#l43.219"></a><span id="l43.219" class="difflineminus">-    SetPropertyAsAString(kBirthMonthProperty, str);</span>
<a href="#l43.220"></a><span id="l43.220" class="difflineminus">-</span>
<a href="#l43.221"></a><span id="l43.221" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;birthDay);</span>
<a href="#l43.222"></a><span id="l43.222" class="difflineminus">-    SetPropertyAsAString(kBirthDayProperty, str);</span>
<a href="#l43.223"></a><span id="l43.223" class="difflineminus">-</span>
<a href="#l43.224"></a><span id="l43.224" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;custom1);</span>
<a href="#l43.225"></a><span id="l43.225" class="difflineminus">-    SetPropertyAsAString(kCustom1Property, str);</span>
<a href="#l43.226"></a><span id="l43.226" class="difflineminus">-</span>
<a href="#l43.227"></a><span id="l43.227" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;custom2);</span>
<a href="#l43.228"></a><span id="l43.228" class="difflineminus">-    SetPropertyAsAString(kCustom2Property, str);</span>
<a href="#l43.229"></a><span id="l43.229" class="difflineminus">-</span>
<a href="#l43.230"></a><span id="l43.230" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;custom3);</span>
<a href="#l43.231"></a><span id="l43.231" class="difflineminus">-    SetPropertyAsAString(kCustom3Property, str);</span>
<a href="#l43.232"></a><span id="l43.232" class="difflineminus">-</span>
<a href="#l43.233"></a><span id="l43.233" class="difflineminus">-    CONVERT_CRLF_TO_SPACE(str, srcCard-&gt;custom4);</span>
<a href="#l43.234"></a><span id="l43.234" class="difflineminus">-    SetPropertyAsAString(kCustom4Property, str);</span>
<a href="#l43.235"></a><span id="l43.235" class="difflineminus">-</span>
<a href="#l43.236"></a><span id="l43.236" class="difflineminus">-    str.Assign(srcCard-&gt;notes);</span>
<a href="#l43.237"></a><span id="l43.237" class="difflineminus">-    SetPropertyAsAString(kNotesProperty, str);</span>
<a href="#l43.238"></a><span id="l43.238" class="difflineminus">-    SetPropertyAsUint32(kLastModifiedDateProperty, srcCard-&gt;lastModifiedDate);</span>
<a href="#l43.239"></a><span id="l43.239" class="difflineminus">-    SetIsMailList(srcCard-&gt;isMailList);</span>
<a href="#l43.240"></a><span id="l43.240" class="difflineminus">-    SetMailListURI(srcCard-&gt;mailListURI);</span>
<a href="#l43.241"></a><span id="l43.241" class="difflineminus">-</span>
<a href="#l43.242"></a><span id="l43.242" class="difflineminus">-    return NS_OK;</span>
<a href="#l43.243"></a><span id="l43.243" class="difflineminus">-}</span>
<a href="#l43.244"></a><span id="l43.244" class="difflineminus">-</span>
<a href="#l43.245"></a><span id="l43.245" class="difflineminus">-nsresult nsAbIPCCard::ConvertToUnicodeAndCopy(nsABCOMCardStruct * srcCard)</span>
<a href="#l43.246"></a><span id="l43.246" class="difflineminus">-{</span>
<a href="#l43.247"></a><span id="l43.247" class="difflineminus">-    NS_ENSURE_ARG_POINTER(srcCard);</span>
<a href="#l43.248"></a><span id="l43.248" class="difflineminus">-</span>
<a href="#l43.249"></a><span id="l43.249" class="difflineminus">-    mRecordId = srcCard-&gt;dwRecordId;</span>
<a href="#l43.250"></a><span id="l43.250" class="difflineminus">-    mCategoryId = srcCard-&gt;dwCategoryId;</span>
<a href="#l43.251"></a><span id="l43.251" class="difflineminus">-    mStatus = srcCard-&gt;dwStatus;</span>
<a href="#l43.252"></a><span id="l43.252" class="difflineminus">-</span>
<a href="#l43.253"></a><span id="l43.253" class="difflineminus">-    nsAutoString str;</span>
<a href="#l43.254"></a><span id="l43.254" class="difflineminus">-</span>
<a href="#l43.255"></a><span id="l43.255" class="difflineminus">-    // Each palm address field is allowed to have multiple lines</span>
<a href="#l43.256"></a><span id="l43.256" class="difflineminus">-    // so replace CRLFs with spaces (since other than Notes field</span>
<a href="#l43.257"></a><span id="l43.257" class="difflineminus">-    // moz only displays fields in a single line).</span>
<a href="#l43.258"></a><span id="l43.258" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;firstName, PR_TRUE);</span>
<a href="#l43.259"></a><span id="l43.259" class="difflineminus">-    SetFirstName(str);</span>
<a href="#l43.260"></a><span id="l43.260" class="difflineminus">-</span>
<a href="#l43.261"></a><span id="l43.261" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;lastName, PR_TRUE);</span>
<a href="#l43.262"></a><span id="l43.262" class="difflineminus">-    SetLastName(str);</span>
<a href="#l43.263"></a><span id="l43.263" class="difflineminus">-</span>
<a href="#l43.264"></a><span id="l43.264" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;displayName, PR_TRUE);</span>
<a href="#l43.265"></a><span id="l43.265" class="difflineminus">-    SetDisplayName(str);</span>
<a href="#l43.266"></a><span id="l43.266" class="difflineminus">-</span>
<a href="#l43.267"></a><span id="l43.267" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;nickName, PR_TRUE);</span>
<a href="#l43.268"></a><span id="l43.268" class="difflineminus">-    SetPropertyAsAString(kNicknameProperty, str);</span>
<a href="#l43.269"></a><span id="l43.269" class="difflineminus">-</span>
<a href="#l43.270"></a><span id="l43.270" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;primaryEmail, PR_TRUE);</span>
<a href="#l43.271"></a><span id="l43.271" class="difflineminus">-    SetPrimaryEmail(str);</span>
<a href="#l43.272"></a><span id="l43.272" class="difflineminus">-</span>
<a href="#l43.273"></a><span id="l43.273" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;secondEmail, PR_TRUE);</span>
<a href="#l43.274"></a><span id="l43.274" class="difflineminus">-    SetPropertyAsAString(k2ndEmailProperty, str);</span>
<a href="#l43.275"></a><span id="l43.275" class="difflineminus">-</span>
<a href="#l43.276"></a><span id="l43.276" class="difflineminus">-    SetPropertyAsUint32(kPreferMailFormatProperty, srcCard-&gt;preferMailFormat);</span>
<a href="#l43.277"></a><span id="l43.277" class="difflineminus">-</span>
<a href="#l43.278"></a><span id="l43.278" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;workPhone, PR_TRUE);</span>
<a href="#l43.279"></a><span id="l43.279" class="difflineminus">-    SetPropertyAsAString(kWorkPhoneProperty, str);</span>
<a href="#l43.280"></a><span id="l43.280" class="difflineminus">-</span>
<a href="#l43.281"></a><span id="l43.281" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;homePhone, PR_TRUE);</span>
<a href="#l43.282"></a><span id="l43.282" class="difflineminus">-    SetPropertyAsAString(kHomePhoneProperty, str);</span>
<a href="#l43.283"></a><span id="l43.283" class="difflineminus">-</span>
<a href="#l43.284"></a><span id="l43.284" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;faxNumber, PR_TRUE);</span>
<a href="#l43.285"></a><span id="l43.285" class="difflineminus">-    SetPropertyAsAString(kFaxProperty, str);</span>
<a href="#l43.286"></a><span id="l43.286" class="difflineminus">-</span>
<a href="#l43.287"></a><span id="l43.287" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;pagerNumber, PR_TRUE);</span>
<a href="#l43.288"></a><span id="l43.288" class="difflineminus">-    SetPropertyAsAString(kPagerProperty, str);</span>
<a href="#l43.289"></a><span id="l43.289" class="difflineminus">-</span>
<a href="#l43.290"></a><span id="l43.290" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;cellularNumber, PR_TRUE);</span>
<a href="#l43.291"></a><span id="l43.291" class="difflineminus">-    SetPropertyAsAString(kCellularProperty, str);</span>
<a href="#l43.292"></a><span id="l43.292" class="difflineminus">-</span>
<a href="#l43.293"></a><span id="l43.293" class="difflineminus">-    // See if home address contains multiple lines.</span>
<a href="#l43.294"></a><span id="l43.294" class="difflineminus">-    SplitHomeAndWorkAddresses(srcCard, PR_FALSE);</span>
<a href="#l43.295"></a><span id="l43.295" class="difflineminus">-</span>
<a href="#l43.296"></a><span id="l43.296" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;homeCity, PR_TRUE);</span>
<a href="#l43.297"></a><span id="l43.297" class="difflineminus">-    SetPropertyAsAString(kHomeCityProperty, str);</span>
<a href="#l43.298"></a><span id="l43.298" class="difflineminus">-</span>
<a href="#l43.299"></a><span id="l43.299" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;homeState, PR_TRUE);</span>
<a href="#l43.300"></a><span id="l43.300" class="difflineminus">-    SetPropertyAsAString(kHomeStateProperty, str);</span>
<a href="#l43.301"></a><span id="l43.301" class="difflineminus">-</span>
<a href="#l43.302"></a><span id="l43.302" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;homeZipCode, PR_TRUE);</span>
<a href="#l43.303"></a><span id="l43.303" class="difflineminus">-    SetPropertyAsAString(kHomeZipCodeProperty, str);</span>
<a href="#l43.304"></a><span id="l43.304" class="difflineminus">-</span>
<a href="#l43.305"></a><span id="l43.305" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;homeCountry, PR_TRUE);</span>
<a href="#l43.306"></a><span id="l43.306" class="difflineminus">-    SetPropertyAsAString(kHomeCountryProperty, str);</span>
<a href="#l43.307"></a><span id="l43.307" class="difflineminus">-</span>
<a href="#l43.308"></a><span id="l43.308" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;workCity, PR_TRUE);</span>
<a href="#l43.309"></a><span id="l43.309" class="difflineminus">-    SetPropertyAsAString(kWorkCityProperty, str);</span>
<a href="#l43.310"></a><span id="l43.310" class="difflineminus">-</span>
<a href="#l43.311"></a><span id="l43.311" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;workState, PR_TRUE);</span>
<a href="#l43.312"></a><span id="l43.312" class="difflineminus">-    SetPropertyAsAString(kWorkStateProperty, str);</span>
<a href="#l43.313"></a><span id="l43.313" class="difflineminus">-</span>
<a href="#l43.314"></a><span id="l43.314" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;workZipCode, PR_TRUE);</span>
<a href="#l43.315"></a><span id="l43.315" class="difflineminus">-    SetPropertyAsAString(kWorkZipCodeProperty, str);</span>
<a href="#l43.316"></a><span id="l43.316" class="difflineminus">-</span>
<a href="#l43.317"></a><span id="l43.317" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;workCountry, PR_TRUE);</span>
<a href="#l43.318"></a><span id="l43.318" class="difflineminus">-    SetPropertyAsAString(kWorkCountryProperty, str);</span>
<a href="#l43.319"></a><span id="l43.319" class="difflineminus">-</span>
<a href="#l43.320"></a><span id="l43.320" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;jobTitle, PR_TRUE);</span>
<a href="#l43.321"></a><span id="l43.321" class="difflineminus">-    SetPropertyAsAString(kJobTitleProperty, str);</span>
<a href="#l43.322"></a><span id="l43.322" class="difflineminus">-</span>
<a href="#l43.323"></a><span id="l43.323" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;department, PR_TRUE);</span>
<a href="#l43.324"></a><span id="l43.324" class="difflineminus">-    SetPropertyAsAString(kDepartmentProperty, str);</span>
<a href="#l43.325"></a><span id="l43.325" class="difflineminus">-</span>
<a href="#l43.326"></a><span id="l43.326" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;company, PR_TRUE);</span>
<a href="#l43.327"></a><span id="l43.327" class="difflineminus">-    SetPropertyAsAString(kCompanyProperty, str);</span>
<a href="#l43.328"></a><span id="l43.328" class="difflineminus">-</span>
<a href="#l43.329"></a><span id="l43.329" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;webPage1, PR_TRUE);</span>
<a href="#l43.330"></a><span id="l43.330" class="difflineminus">-    SetPropertyAsAString(kWorkWebPageProperty, str);</span>
<a href="#l43.331"></a><span id="l43.331" class="difflineminus">-</span>
<a href="#l43.332"></a><span id="l43.332" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;webPage2, PR_TRUE);</span>
<a href="#l43.333"></a><span id="l43.333" class="difflineminus">-    SetPropertyAsAString(kHomeWebPageProperty, str);</span>
<a href="#l43.334"></a><span id="l43.334" class="difflineminus">-</span>
<a href="#l43.335"></a><span id="l43.335" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;birthYear, PR_TRUE);</span>
<a href="#l43.336"></a><span id="l43.336" class="difflineminus">-    SetPropertyAsAString(kBirthYearProperty, str);</span>
<a href="#l43.337"></a><span id="l43.337" class="difflineminus">-</span>
<a href="#l43.338"></a><span id="l43.338" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;birthMonth, PR_TRUE);</span>
<a href="#l43.339"></a><span id="l43.339" class="difflineminus">-    SetPropertyAsAString(kBirthMonthProperty, str);</span>
<a href="#l43.340"></a><span id="l43.340" class="difflineminus">-</span>
<a href="#l43.341"></a><span id="l43.341" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;birthDay, PR_TRUE);</span>
<a href="#l43.342"></a><span id="l43.342" class="difflineminus">-    SetPropertyAsAString(kBirthDayProperty, str);</span>
<a href="#l43.343"></a><span id="l43.343" class="difflineminus">-</span>
<a href="#l43.344"></a><span id="l43.344" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;custom1, PR_TRUE);</span>
<a href="#l43.345"></a><span id="l43.345" class="difflineminus">-    SetPropertyAsAString(kCustom1Property, str);</span>
<a href="#l43.346"></a><span id="l43.346" class="difflineminus">-</span>
<a href="#l43.347"></a><span id="l43.347" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;custom2, PR_TRUE);</span>
<a href="#l43.348"></a><span id="l43.348" class="difflineminus">-    SetPropertyAsAString(kCustom2Property, str);</span>
<a href="#l43.349"></a><span id="l43.349" class="difflineminus">-</span>
<a href="#l43.350"></a><span id="l43.350" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;custom3, PR_TRUE);</span>
<a href="#l43.351"></a><span id="l43.351" class="difflineminus">-    SetPropertyAsAString(kCustom3Property, str);</span>
<a href="#l43.352"></a><span id="l43.352" class="difflineminus">-</span>
<a href="#l43.353"></a><span id="l43.353" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;custom4, PR_TRUE);</span>
<a href="#l43.354"></a><span id="l43.354" class="difflineminus">-    SetPropertyAsAString(kCustom4Property, str);</span>
<a href="#l43.355"></a><span id="l43.355" class="difflineminus">-</span>
<a href="#l43.356"></a><span id="l43.356" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(str, srcCard-&gt;notes, PR_FALSE);</span>
<a href="#l43.357"></a><span id="l43.357" class="difflineminus">-    SetPropertyAsAString(kNotesProperty, str);</span>
<a href="#l43.358"></a><span id="l43.358" class="difflineminus">-</span>
<a href="#l43.359"></a><span id="l43.359" class="difflineminus">-    SetPropertyAsUint32(kLastModifiedDateProperty, srcCard-&gt;lastModifiedDate);</span>
<a href="#l43.360"></a><span id="l43.360" class="difflineminus">-    SetIsMailList(srcCard-&gt;isMailList);</span>
<a href="#l43.361"></a><span id="l43.361" class="difflineminus">-    SetMailListURI(srcCard-&gt;mailListURI);</span>
<a href="#l43.362"></a><span id="l43.362" class="difflineminus">-</span>
<a href="#l43.363"></a><span id="l43.363" class="difflineminus">-    return NS_OK;</span>
<a href="#l43.364"></a><span id="l43.364" class="difflineminus">-}</span>
<a href="#l43.365"></a><span id="l43.365" class="difflineminus">-</span>
<a href="#l43.366"></a><span id="l43.366" class="difflineminus">-void nsAbIPCCard::SplitAddresses(PRBool isUnicode, LPTSTR homeAddress, LPTSTR workAddress)</span>
<a href="#l43.367"></a><span id="l43.367" class="difflineminus">-{</span>
<a href="#l43.368"></a><span id="l43.368" class="difflineminus">-  PRInt32 idx;</span>
<a href="#l43.369"></a><span id="l43.369" class="difflineminus">-  nsAutoString homeAddressStr;</span>
<a href="#l43.370"></a><span id="l43.370" class="difflineminus">-  nsAutoString workAddressStr;</span>
<a href="#l43.371"></a><span id="l43.371" class="difflineminus">-  if (isUnicode)</span>
<a href="#l43.372"></a><span id="l43.372" class="difflineminus">-  {</span>
<a href="#l43.373"></a><span id="l43.373" class="difflineminus">-    homeAddressStr.Assign(homeAddress);</span>
<a href="#l43.374"></a><span id="l43.374" class="difflineminus">-    workAddressStr.Assign(workAddress);</span>
<a href="#l43.375"></a><span id="l43.375" class="difflineminus">-  }</span>
<a href="#l43.376"></a><span id="l43.376" class="difflineminus">-  else</span>
<a href="#l43.377"></a><span id="l43.377" class="difflineminus">-  {</span>
<a href="#l43.378"></a><span id="l43.378" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(homeAddressStr, homeAddress, PR_FALSE);</span>
<a href="#l43.379"></a><span id="l43.379" class="difflineminus">-    CONVERT_ASSIGNTO_UNICODE(workAddressStr, workAddress, PR_FALSE);</span>
<a href="#l43.380"></a><span id="l43.380" class="difflineminus">-  }</span>
<a href="#l43.381"></a><span id="l43.381" class="difflineminus">-  nsAutoString addr1, addr2;</span>
<a href="#l43.382"></a><span id="l43.382" class="difflineminus">-  if ((idx = homeAddressStr.Find( &quot;\x0D\x0A&quot;)) != kNotFound)</span>
<a href="#l43.383"></a><span id="l43.383" class="difflineminus">-  {</span>
<a href="#l43.384"></a><span id="l43.384" class="difflineminus">-    homeAddressStr.Left(addr1, idx);</span>
<a href="#l43.385"></a><span id="l43.385" class="difflineminus">-    homeAddressStr.Right( addr2, homeAddressStr.Length() - idx - 2);  // need to minus string lenght of CRLF.</span>
<a href="#l43.386"></a><span id="l43.386" class="difflineminus">-    addr2.ReplaceSubstring(NS_LITERAL_STRING(&quot;\x0D\x0A&quot;).get(),NS_LITERAL_STRING(&quot;, &quot;).get());</span>
<a href="#l43.387"></a><span id="l43.387" class="difflineminus">-</span>
<a href="#l43.388"></a><span id="l43.388" class="difflineminus">-    SetPropertyAsAString(kHomeAddressProperty, addr1);</span>
<a href="#l43.389"></a><span id="l43.389" class="difflineminus">-    SetPropertyAsAString(kHomeAddress2Property, addr2);</span>
<a href="#l43.390"></a><span id="l43.390" class="difflineminus">-  }</span>
<a href="#l43.391"></a><span id="l43.391" class="difflineminus">-  else</span>
<a href="#l43.392"></a><span id="l43.392" class="difflineminus">-    SetPropertyAsAString(kHomeAddressProperty, homeAddressStr);</span>
<a href="#l43.393"></a><span id="l43.393" class="difflineminus">-</span>
<a href="#l43.394"></a><span id="l43.394" class="difflineminus">-  if ((idx = workAddressStr.Find( &quot;\x0D\x0A&quot;)) != kNotFound)</span>
<a href="#l43.395"></a><span id="l43.395" class="difflineminus">-  {</span>
<a href="#l43.396"></a><span id="l43.396" class="difflineminus">-    workAddressStr.Left(addr1, idx);</span>
<a href="#l43.397"></a><span id="l43.397" class="difflineminus">-    workAddressStr.Right( addr2, workAddressStr.Length() - idx - 2);  // need to minus string lenght of CRLF.</span>
<a href="#l43.398"></a><span id="l43.398" class="difflineminus">-    addr2.ReplaceSubstring(NS_LITERAL_STRING(&quot;\x0D\x0A&quot;).get(),NS_LITERAL_STRING(&quot;, &quot;).get());</span>
<a href="#l43.399"></a><span id="l43.399" class="difflineminus">-</span>
<a href="#l43.400"></a><span id="l43.400" class="difflineminus">-    SetPropertyAsAString(kWorkAddressProperty, addr1);</span>
<a href="#l43.401"></a><span id="l43.401" class="difflineminus">-    SetPropertyAsAString(kWorkAddress2Property, addr2);</span>
<a href="#l43.402"></a><span id="l43.402" class="difflineminus">-  }</span>
<a href="#l43.403"></a><span id="l43.403" class="difflineminus">-  else</span>
<a href="#l43.404"></a><span id="l43.404" class="difflineminus">-    SetPropertyAsAString(kWorkAddressProperty, workAddressStr);</span>
<a href="#l43.405"></a><span id="l43.405" class="difflineminus">-}</span>
<a href="#l43.406"></a><span id="l43.406" class="difflineminus">-</span>
<a href="#l43.407"></a><span id="l43.407" class="difflineminus">-void nsAbIPCCard::SplitHomeAndWorkAddresses(nsABCOMCardStruct * card, PRBool isUnicode)</span>
<a href="#l43.408"></a><span id="l43.408" class="difflineminus">-{</span>
<a href="#l43.409"></a><span id="l43.409" class="difflineminus">-  // If the address contains more than one line then split it into two </span>
<a href="#l43.410"></a><span id="l43.410" class="difflineminus">-  // (since moz only allows two address lines) and make sure all CRLFs</span>
<a href="#l43.411"></a><span id="l43.411" class="difflineminus">-  // are converted to spaces in the 2nd address line. Lines are ended</span>
<a href="#l43.412"></a><span id="l43.412" class="difflineminus">-  // with CRLF (done by moz conduit). So card-&gt;homeAddress2 </span>
<a href="#l43.413"></a><span id="l43.413" class="difflineminus">-  // and card-&gt;workAddress2 are never used.</span>
<a href="#l43.414"></a><span id="l43.414" class="difflineminus">-  SplitAddresses(isUnicode, card-&gt;homeAddress, card-&gt;workAddress);</span>
<a href="#l43.415"></a><span id="l43.415" class="difflineminus">-}</span>
<a href="#l43.416"></a><span id="l43.416" class="difflineminus">-</span>
<a href="#l43.417"></a><span id="l43.417" class="difflineminus">-</span>
<a href="#l43.418"></a><span id="l43.418" class="difflineminus">-PRBool nsAbIPCCard::EqualsAfterUnicodeConversion(nsABCOMCardStruct * card, nsStringArray &amp; differingAttrs)</span>
<a href="#l43.419"></a><span id="l43.419" class="difflineminus">-{</span>
<a href="#l43.420"></a><span id="l43.420" class="difflineminus">-    if(!card)</span>
<a href="#l43.421"></a><span id="l43.421" class="difflineminus">-        return PR_FALSE;</span>
<a href="#l43.422"></a><span id="l43.422" class="difflineminus">-</span>
<a href="#l43.423"></a><span id="l43.423" class="difflineminus">-    // convert to Unicode first</span>
<a href="#l43.424"></a><span id="l43.424" class="difflineminus">-    nsAbIPCCard card1(card, PR_FALSE);</span>
<a href="#l43.425"></a><span id="l43.425" class="difflineminus">-    card1.SplitAddresses(PR_FALSE, card-&gt;homeAddress, card-&gt;workAddress);</span>
<a href="#l43.426"></a><span id="l43.426" class="difflineminus">-    nsABCOMCardStruct * newCard = new nsABCOMCardStruct;</span>
<a href="#l43.427"></a><span id="l43.427" class="difflineminus">-    // get the unicode nsABCOMCardStruct and compare</span>
<a href="#l43.428"></a><span id="l43.428" class="difflineminus">-    card1.GetABCOMCardStruct(PR_TRUE, newCard);</span>
<a href="#l43.429"></a><span id="l43.429" class="difflineminus">-    // want to split newCard home and work address</span>
<a href="#l43.430"></a><span id="l43.430" class="difflineminus">-</span>
<a href="#l43.431"></a><span id="l43.431" class="difflineminus">-    // I think this leaks...need to free up the original values</span>
<a href="#l43.432"></a><span id="l43.432" class="difflineminus">-    card1.CopyValue(PR_TRUE, kHomeAddressProperty, &amp;newCard-&gt;homeAddress);</span>
<a href="#l43.433"></a><span id="l43.433" class="difflineminus">-    card1.CopyValue(PR_TRUE, kHomeAddress2Property, &amp;newCard-&gt;homeAddress2);</span>
<a href="#l43.434"></a><span id="l43.434" class="difflineminus">-    card1.CopyValue(PR_TRUE, kWorkAddressProperty, &amp;newCard-&gt;workAddress);</span>
<a href="#l43.435"></a><span id="l43.435" class="difflineminus">-    card1.CopyValue(PR_TRUE, kWorkAddress2Property, &amp;newCard-&gt;workAddress2);</span>
<a href="#l43.436"></a><span id="l43.436" class="difflineminus">-  </span>
<a href="#l43.437"></a><span id="l43.437" class="difflineminus">-    PRBool ret = Equals(newCard, differingAttrs);</span>
<a href="#l43.438"></a><span id="l43.438" class="difflineminus">-    delete newCard;</span>
<a href="#l43.439"></a><span id="l43.439" class="difflineminus">-    return ret;</span>
<a href="#l43.440"></a><span id="l43.440" class="difflineminus">-}</span>
<a href="#l43.441"></a><span id="l43.441" class="difflineminus">-</span>
<a href="#l43.442"></a><span id="l43.442" class="difflineminus">-</span>
<a href="#l43.443"></a><span id="l43.443" class="difflineminus">-PRBool nsAbIPCCard::Equals(nsABCOMCardStruct * card, nsStringArray &amp; differingAttrs)</span>
<a href="#l43.444"></a><span id="l43.444" class="difflineminus">-{</span>
<a href="#l43.445"></a><span id="l43.445" class="difflineminus">-    if(!card)</span>
<a href="#l43.446"></a><span id="l43.446" class="difflineminus">-        return PR_FALSE;</span>
<a href="#l43.447"></a><span id="l43.447" class="difflineminus">-</span>
<a href="#l43.448"></a><span id="l43.448" class="difflineminus">-    differingAttrs.Clear();</span>
<a href="#l43.449"></a><span id="l43.449" class="difflineminus">-</span>
<a href="#l43.450"></a><span id="l43.450" class="difflineminus">-    if(card-&gt;firstName)</span>
<a href="#l43.451"></a><span id="l43.451" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;firstName, kFirstNameProperty))</span>
<a href="#l43.452"></a><span id="l43.452" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kFirstNameProperty));</span>
<a href="#l43.453"></a><span id="l43.453" class="difflineminus">-    if(card-&gt;lastName)</span>
<a href="#l43.454"></a><span id="l43.454" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;lastName, kLastNameProperty))</span>
<a href="#l43.455"></a><span id="l43.455" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kLastNameProperty));</span>
<a href="#l43.456"></a><span id="l43.456" class="difflineminus">-    if(card-&gt;displayName)</span>
<a href="#l43.457"></a><span id="l43.457" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;displayName, kDisplayNameProperty))</span>
<a href="#l43.458"></a><span id="l43.458" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kDisplayNameProperty));</span>
<a href="#l43.459"></a><span id="l43.459" class="difflineminus">-    if(card-&gt;nickName)</span>
<a href="#l43.460"></a><span id="l43.460" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;nickName, kNicknameProperty))</span>
<a href="#l43.461"></a><span id="l43.461" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kNicknameProperty));</span>
<a href="#l43.462"></a><span id="l43.462" class="difflineminus">-    if(card-&gt;primaryEmail)</span>
<a href="#l43.463"></a><span id="l43.463" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;primaryEmail, kPriEmailProperty))</span>
<a href="#l43.464"></a><span id="l43.464" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kPriEmailProperty));</span>
<a href="#l43.465"></a><span id="l43.465" class="difflineminus">-    if(card-&gt;secondEmail)</span>
<a href="#l43.466"></a><span id="l43.466" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;secondEmail, k2ndEmailProperty))</span>
<a href="#l43.467"></a><span id="l43.467" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(k2ndEmailProperty));</span>
<a href="#l43.468"></a><span id="l43.468" class="difflineminus">-    if(card-&gt;workPhone)</span>
<a href="#l43.469"></a><span id="l43.469" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;workPhone, kWorkPhoneProperty))</span>
<a href="#l43.470"></a><span id="l43.470" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kWorkPhoneProperty));</span>
<a href="#l43.471"></a><span id="l43.471" class="difflineminus">-    if(card-&gt;homePhone)</span>
<a href="#l43.472"></a><span id="l43.472" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;homePhone, kHomePhoneProperty))</span>
<a href="#l43.473"></a><span id="l43.473" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kHomePhoneProperty));</span>
<a href="#l43.474"></a><span id="l43.474" class="difflineminus">-    if(card-&gt;faxNumber)</span>
<a href="#l43.475"></a><span id="l43.475" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;faxNumber, kFaxProperty))</span>
<a href="#l43.476"></a><span id="l43.476" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kFaxProperty));</span>
<a href="#l43.477"></a><span id="l43.477" class="difflineminus">-    if(card-&gt;pagerNumber)</span>
<a href="#l43.478"></a><span id="l43.478" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;pagerNumber, kPagerProperty))</span>
<a href="#l43.479"></a><span id="l43.479" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kPagerProperty));</span>
<a href="#l43.480"></a><span id="l43.480" class="difflineminus">-    if(card-&gt;cellularNumber)</span>
<a href="#l43.481"></a><span id="l43.481" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;cellularNumber, kCellularProperty))</span>
<a href="#l43.482"></a><span id="l43.482" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kCellularProperty));</span>
<a href="#l43.483"></a><span id="l43.483" class="difflineminus">-    // card  has home and work addresses joined, but &quot;this&quot; has them split</span>
<a href="#l43.484"></a><span id="l43.484" class="difflineminus">-    if(card-&gt;homeAddress)</span>
<a href="#l43.485"></a><span id="l43.485" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;homeAddress, kHomeAddressProperty))</span>
<a href="#l43.486"></a><span id="l43.486" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kHomeAddressProperty));</span>
<a href="#l43.487"></a><span id="l43.487" class="difflineminus">-    if(card-&gt;homeAddress2)</span>
<a href="#l43.488"></a><span id="l43.488" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;homeAddress2, kHomeAddress2Property))</span>
<a href="#l43.489"></a><span id="l43.489" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kHomeAddress2Property));</span>
<a href="#l43.490"></a><span id="l43.490" class="difflineminus">-    if(card-&gt;homeCity)</span>
<a href="#l43.491"></a><span id="l43.491" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;homeCity, kHomeCityProperty))</span>
<a href="#l43.492"></a><span id="l43.492" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kHomeCityProperty));</span>
<a href="#l43.493"></a><span id="l43.493" class="difflineminus">-    if(card-&gt;homeState)</span>
<a href="#l43.494"></a><span id="l43.494" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;homeState, kHomeStateProperty))</span>
<a href="#l43.495"></a><span id="l43.495" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kHomeStateProperty));</span>
<a href="#l43.496"></a><span id="l43.496" class="difflineminus">-    if(card-&gt;homeZipCode)</span>
<a href="#l43.497"></a><span id="l43.497" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;homeZipCode, kHomeZipCodeProperty))</span>
<a href="#l43.498"></a><span id="l43.498" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kHomeZipCodeProperty));</span>
<a href="#l43.499"></a><span id="l43.499" class="difflineminus">-    if(card-&gt;homeCountry)</span>
<a href="#l43.500"></a><span id="l43.500" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;homeCountry, kHomeCountryProperty))</span>
<a href="#l43.501"></a><span id="l43.501" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kHomeCountryProperty));</span>
<a href="#l43.502"></a><span id="l43.502" class="difflineminus">-    // card-&gt;workAddress is Joined, WorkAddress and WorkAddress2 are split</span>
<a href="#l43.503"></a><span id="l43.503" class="difflineminus">-    if(card-&gt;workAddress)</span>
<a href="#l43.504"></a><span id="l43.504" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;workAddress, kWorkAddressProperty))</span>
<a href="#l43.505"></a><span id="l43.505" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kWorkAddressProperty));</span>
<a href="#l43.506"></a><span id="l43.506" class="difflineminus">-    if(card-&gt;workAddress2)</span>
<a href="#l43.507"></a><span id="l43.507" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;workAddress2, kWorkAddress2Property))</span>
<a href="#l43.508"></a><span id="l43.508" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kWorkAddress2Property));</span>
<a href="#l43.509"></a><span id="l43.509" class="difflineminus">-    if(card-&gt;workCity)</span>
<a href="#l43.510"></a><span id="l43.510" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;workCity, kWorkCityProperty))</span>
<a href="#l43.511"></a><span id="l43.511" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kWorkCityProperty));</span>
<a href="#l43.512"></a><span id="l43.512" class="difflineminus">-    if(card-&gt;workState)</span>
<a href="#l43.513"></a><span id="l43.513" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;workState, kWorkStateProperty))</span>
<a href="#l43.514"></a><span id="l43.514" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kWorkStateProperty));</span>
<a href="#l43.515"></a><span id="l43.515" class="difflineminus">-    if(card-&gt;workZipCode)</span>
<a href="#l43.516"></a><span id="l43.516" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;workZipCode, kWorkZipCodeProperty))</span>
<a href="#l43.517"></a><span id="l43.517" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kWorkZipCodeProperty));</span>
<a href="#l43.518"></a><span id="l43.518" class="difflineminus">-    if(card-&gt;workCountry)</span>
<a href="#l43.519"></a><span id="l43.519" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;workCountry, kWorkCountryProperty))</span>
<a href="#l43.520"></a><span id="l43.520" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kWorkCountryProperty));</span>
<a href="#l43.521"></a><span id="l43.521" class="difflineminus">-    if(card-&gt;jobTitle)</span>
<a href="#l43.522"></a><span id="l43.522" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;jobTitle, kJobTitleProperty))</span>
<a href="#l43.523"></a><span id="l43.523" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kJobTitleProperty));</span>
<a href="#l43.524"></a><span id="l43.524" class="difflineminus">-    if(card-&gt;department)</span>
<a href="#l43.525"></a><span id="l43.525" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;department, kDepartmentProperty))</span>
<a href="#l43.526"></a><span id="l43.526" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kDepartmentProperty));</span>
<a href="#l43.527"></a><span id="l43.527" class="difflineminus">-    if(card-&gt;company)</span>
<a href="#l43.528"></a><span id="l43.528" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;company, kCompanyProperty))</span>
<a href="#l43.529"></a><span id="l43.529" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kCompanyProperty));</span>
<a href="#l43.530"></a><span id="l43.530" class="difflineminus">-    if(card-&gt;webPage1)</span>
<a href="#l43.531"></a><span id="l43.531" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;webPage1, kWorkWebPageProperty))</span>
<a href="#l43.532"></a><span id="l43.532" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kWorkWebPageProperty));</span>
<a href="#l43.533"></a><span id="l43.533" class="difflineminus">-    if(card-&gt;webPage2)</span>
<a href="#l43.534"></a><span id="l43.534" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;webPage2, kWorkWebPageProperty))</span>
<a href="#l43.535"></a><span id="l43.535" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kHomeWebPageProperty));</span>
<a href="#l43.536"></a><span id="l43.536" class="difflineminus">-    if(card-&gt;birthYear)</span>
<a href="#l43.537"></a><span id="l43.537" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;birthYear, kBirthYearProperty))</span>
<a href="#l43.538"></a><span id="l43.538" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kBirthYearProperty));</span>
<a href="#l43.539"></a><span id="l43.539" class="difflineminus">-    if(card-&gt;birthMonth)</span>
<a href="#l43.540"></a><span id="l43.540" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;birthMonth, kBirthMonthProperty))</span>
<a href="#l43.541"></a><span id="l43.541" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kBirthMonthProperty));</span>
<a href="#l43.542"></a><span id="l43.542" class="difflineminus">-    if(card-&gt;birthDay)</span>
<a href="#l43.543"></a><span id="l43.543" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;birthDay, kBirthDayProperty))</span>
<a href="#l43.544"></a><span id="l43.544" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kBirthDayProperty));</span>
<a href="#l43.545"></a><span id="l43.545" class="difflineminus">-    if(card-&gt;custom1)</span>
<a href="#l43.546"></a><span id="l43.546" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;custom1, kCustom1Property))</span>
<a href="#l43.547"></a><span id="l43.547" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kCustom1Property));</span>
<a href="#l43.548"></a><span id="l43.548" class="difflineminus">-    if(card-&gt;custom2)</span>
<a href="#l43.549"></a><span id="l43.549" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;custom2, kCustom2Property))</span>
<a href="#l43.550"></a><span id="l43.550" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kCustom2Property));</span>
<a href="#l43.551"></a><span id="l43.551" class="difflineminus">-    if(card-&gt;custom3)</span>
<a href="#l43.552"></a><span id="l43.552" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;custom3, kCustom3Property))</span>
<a href="#l43.553"></a><span id="l43.553" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kCustom3Property));</span>
<a href="#l43.554"></a><span id="l43.554" class="difflineminus">-    if(card-&gt;custom4)</span>
<a href="#l43.555"></a><span id="l43.555" class="difflineminus">-        if (CompareValue(PR_TRUE, card-&gt;custom4, kCustom4Property))</span>
<a href="#l43.556"></a><span id="l43.556" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kCustom4Property));</span>
<a href="#l43.557"></a><span id="l43.557" class="difflineminus">-    if (card-&gt;isMailList != m_IsMailList)</span>
<a href="#l43.558"></a><span id="l43.558" class="difflineminus">-        differingAttrs.AppendString(NS_LITERAL_STRING(kMailListName));</span>
<a href="#l43.559"></a><span id="l43.559" class="difflineminus">-    if(card-&gt;mailListURI) {</span>
<a href="#l43.560"></a><span id="l43.560" class="difflineminus">-        nsCAutoString str(card-&gt;mailListURI);</span>
<a href="#l43.561"></a><span id="l43.561" class="difflineminus">-        if (str.Equals(m_MailListURI, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l43.562"></a><span id="l43.562" class="difflineminus">-            differingAttrs.AppendString(NS_LITERAL_STRING(kMailListDescription));</span>
<a href="#l43.563"></a><span id="l43.563" class="difflineminus">-    }</span>
<a href="#l43.564"></a><span id="l43.564" class="difflineminus">-</span>
<a href="#l43.565"></a><span id="l43.565" class="difflineminus">-    return (differingAttrs.Count() == 0);</span>
<a href="#l43.566"></a><span id="l43.566" class="difflineminus">-}</span>
<a href="#l43.567"></a><span id="l43.567" class="difflineminus">-</span>
<a href="#l43.568"></a><span id="l43.568" class="difflineminus">-</span>
<a href="#l43.569"></a><span id="l43.569" class="difflineminus">-NS_IMETHODIMP nsAbIPCCard::Equals(nsIAbCard *card, PRBool *_retval)</span>
<a href="#l43.570"></a><span id="l43.570" class="difflineminus">-{</span>
<a href="#l43.571"></a><span id="l43.571" class="difflineminus">-    NS_ENSURE_ARG_POINTER(card);</span>
<a href="#l43.572"></a><span id="l43.572" class="difflineminus">-    NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l43.573"></a><span id="l43.573" class="difflineminus">-</span>
<a href="#l43.574"></a><span id="l43.574" class="difflineminus">-    nsString str;</span>
<a href="#l43.575"></a><span id="l43.575" class="difflineminus">-    *_retval = PR_FALSE;</span>
<a href="#l43.576"></a><span id="l43.576" class="difflineminus">-</span>
<a href="#l43.577"></a><span id="l43.577" class="difflineminus">-    card-&gt;GetFirstName(str);</span>
<a href="#l43.578"></a><span id="l43.578" class="difflineminus">-    if (Compare(str, kFirstNameProperty))</span>
<a href="#l43.579"></a><span id="l43.579" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.580"></a><span id="l43.580" class="difflineminus">-</span>
<a href="#l43.581"></a><span id="l43.581" class="difflineminus">-    card-&gt;GetLastName(str);</span>
<a href="#l43.582"></a><span id="l43.582" class="difflineminus">-    if (Compare(str, kLastNameProperty))</span>
<a href="#l43.583"></a><span id="l43.583" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.584"></a><span id="l43.584" class="difflineminus">-</span>
<a href="#l43.585"></a><span id="l43.585" class="difflineminus">-    card-&gt;GetDisplayName(str);</span>
<a href="#l43.586"></a><span id="l43.586" class="difflineminus">-    if (Compare(str, kDisplayNameProperty))</span>
<a href="#l43.587"></a><span id="l43.587" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.588"></a><span id="l43.588" class="difflineminus">-</span>
<a href="#l43.589"></a><span id="l43.589" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kNicknameProperty, str)))</span>
<a href="#l43.590"></a><span id="l43.590" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.591"></a><span id="l43.591" class="difflineminus">-    if (Compare(str, kNicknameProperty))</span>
<a href="#l43.592"></a><span id="l43.592" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.593"></a><span id="l43.593" class="difflineminus">-</span>
<a href="#l43.594"></a><span id="l43.594" class="difflineminus">-    card-&gt;GetPrimaryEmail(str);</span>
<a href="#l43.595"></a><span id="l43.595" class="difflineminus">-    if (Compare(str, kPriEmailProperty))</span>
<a href="#l43.596"></a><span id="l43.596" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.597"></a><span id="l43.597" class="difflineminus">-</span>
<a href="#l43.598"></a><span id="l43.598" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(k2ndEmailProperty, str)))</span>
<a href="#l43.599"></a><span id="l43.599" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.600"></a><span id="l43.600" class="difflineminus">-    if (Compare(str, k2ndEmailProperty))</span>
<a href="#l43.601"></a><span id="l43.601" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.602"></a><span id="l43.602" class="difflineminus">-</span>
<a href="#l43.603"></a><span id="l43.603" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kWorkPhoneProperty, str)))</span>
<a href="#l43.604"></a><span id="l43.604" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.605"></a><span id="l43.605" class="difflineminus">-    if (Compare(str, kWorkPhoneProperty))</span>
<a href="#l43.606"></a><span id="l43.606" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.607"></a><span id="l43.607" class="difflineminus">-</span>
<a href="#l43.608"></a><span id="l43.608" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kHomePhoneProperty, str)))</span>
<a href="#l43.609"></a><span id="l43.609" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.610"></a><span id="l43.610" class="difflineminus">-    if (Compare(str, kHomePhoneProperty))</span>
<a href="#l43.611"></a><span id="l43.611" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.612"></a><span id="l43.612" class="difflineminus">-</span>
<a href="#l43.613"></a><span id="l43.613" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kFaxProperty, str)))</span>
<a href="#l43.614"></a><span id="l43.614" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.615"></a><span id="l43.615" class="difflineminus">-    if (Compare(str, kFaxProperty))</span>
<a href="#l43.616"></a><span id="l43.616" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.617"></a><span id="l43.617" class="difflineminus">-</span>
<a href="#l43.618"></a><span id="l43.618" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kPagerProperty, str)))</span>
<a href="#l43.619"></a><span id="l43.619" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.620"></a><span id="l43.620" class="difflineminus">-    if (Compare(str, kPagerProperty))</span>
<a href="#l43.621"></a><span id="l43.621" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.622"></a><span id="l43.622" class="difflineminus">-</span>
<a href="#l43.623"></a><span id="l43.623" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kCellularProperty, str)))</span>
<a href="#l43.624"></a><span id="l43.624" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.625"></a><span id="l43.625" class="difflineminus">-    if (Compare(str, kCellularProperty))</span>
<a href="#l43.626"></a><span id="l43.626" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.627"></a><span id="l43.627" class="difflineminus">-</span>
<a href="#l43.628"></a><span id="l43.628" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kHomeAddressProperty, str)))</span>
<a href="#l43.629"></a><span id="l43.629" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.630"></a><span id="l43.630" class="difflineminus">-    if (Compare(str, kHomeAddressProperty))</span>
<a href="#l43.631"></a><span id="l43.631" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.632"></a><span id="l43.632" class="difflineminus">-</span>
<a href="#l43.633"></a><span id="l43.633" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kHomeAddress2Property, str)))</span>
<a href="#l43.634"></a><span id="l43.634" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.635"></a><span id="l43.635" class="difflineminus">-    if (Compare(str, kHomeAddress2Property))</span>
<a href="#l43.636"></a><span id="l43.636" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.637"></a><span id="l43.637" class="difflineminus">-</span>
<a href="#l43.638"></a><span id="l43.638" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kHomeCityProperty, str)))</span>
<a href="#l43.639"></a><span id="l43.639" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.640"></a><span id="l43.640" class="difflineminus">-    if (Compare(str, kHomeCityProperty))</span>
<a href="#l43.641"></a><span id="l43.641" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.642"></a><span id="l43.642" class="difflineminus">-</span>
<a href="#l43.643"></a><span id="l43.643" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kHomeStateProperty, str)))</span>
<a href="#l43.644"></a><span id="l43.644" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.645"></a><span id="l43.645" class="difflineminus">-    if (Compare(str, kHomeStateProperty))</span>
<a href="#l43.646"></a><span id="l43.646" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.647"></a><span id="l43.647" class="difflineminus">-</span>
<a href="#l43.648"></a><span id="l43.648" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kHomeZipCodeProperty, str)))</span>
<a href="#l43.649"></a><span id="l43.649" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.650"></a><span id="l43.650" class="difflineminus">-    if (Compare(str, kHomeZipCodeProperty))</span>
<a href="#l43.651"></a><span id="l43.651" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.652"></a><span id="l43.652" class="difflineminus">-</span>
<a href="#l43.653"></a><span id="l43.653" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kHomeCountryProperty, str)))</span>
<a href="#l43.654"></a><span id="l43.654" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.655"></a><span id="l43.655" class="difflineminus">-    if (Compare(str, kHomeCountryProperty))</span>
<a href="#l43.656"></a><span id="l43.656" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.657"></a><span id="l43.657" class="difflineminus">-</span>
<a href="#l43.658"></a><span id="l43.658" class="difflineminus">-    // both card and this have their addresses split, which is correct</span>
<a href="#l43.659"></a><span id="l43.659" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kWorkAddressProperty, str)))</span>
<a href="#l43.660"></a><span id="l43.660" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.661"></a><span id="l43.661" class="difflineminus">-    if (Compare(str, kWorkAddressProperty))</span>
<a href="#l43.662"></a><span id="l43.662" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.663"></a><span id="l43.663" class="difflineminus">-</span>
<a href="#l43.664"></a><span id="l43.664" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kWorkAddress2Property, str)))</span>
<a href="#l43.665"></a><span id="l43.665" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.666"></a><span id="l43.666" class="difflineminus">-    if (Compare(str, kWorkAddress2Property))</span>
<a href="#l43.667"></a><span id="l43.667" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.668"></a><span id="l43.668" class="difflineminus">-</span>
<a href="#l43.669"></a><span id="l43.669" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kWorkCityProperty, str)))</span>
<a href="#l43.670"></a><span id="l43.670" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.671"></a><span id="l43.671" class="difflineminus">-    if (Compare(str, kWorkCityProperty))</span>
<a href="#l43.672"></a><span id="l43.672" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.673"></a><span id="l43.673" class="difflineminus">-</span>
<a href="#l43.674"></a><span id="l43.674" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kWorkStateProperty, str)))</span>
<a href="#l43.675"></a><span id="l43.675" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.676"></a><span id="l43.676" class="difflineminus">-    if (Compare(str, kWorkStateProperty))</span>
<a href="#l43.677"></a><span id="l43.677" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.678"></a><span id="l43.678" class="difflineminus">-</span>
<a href="#l43.679"></a><span id="l43.679" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kWorkZipCodeProperty, str)))</span>
<a href="#l43.680"></a><span id="l43.680" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.681"></a><span id="l43.681" class="difflineminus">-    if (Compare(str, kWorkZipCodeProperty))</span>
<a href="#l43.682"></a><span id="l43.682" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.683"></a><span id="l43.683" class="difflineminus">-</span>
<a href="#l43.684"></a><span id="l43.684" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kWorkCountryProperty, str)))</span>
<a href="#l43.685"></a><span id="l43.685" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.686"></a><span id="l43.686" class="difflineminus">-    if (Compare(str, kWorkCountryProperty))</span>
<a href="#l43.687"></a><span id="l43.687" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.688"></a><span id="l43.688" class="difflineminus">-</span>
<a href="#l43.689"></a><span id="l43.689" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kJobTitleProperty, str)))</span>
<a href="#l43.690"></a><span id="l43.690" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.691"></a><span id="l43.691" class="difflineminus">-    if (Compare(str, kJobTitleProperty))</span>
<a href="#l43.692"></a><span id="l43.692" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.693"></a><span id="l43.693" class="difflineminus">-</span>
<a href="#l43.694"></a><span id="l43.694" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kDepartmentProperty, str)))</span>
<a href="#l43.695"></a><span id="l43.695" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.696"></a><span id="l43.696" class="difflineminus">-    if (Compare(str, kDepartmentProperty))</span>
<a href="#l43.697"></a><span id="l43.697" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.698"></a><span id="l43.698" class="difflineminus">-</span>
<a href="#l43.699"></a><span id="l43.699" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kCompanyProperty, str)))</span>
<a href="#l43.700"></a><span id="l43.700" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.701"></a><span id="l43.701" class="difflineminus">-    if (Compare(str, kCompanyProperty))</span>
<a href="#l43.702"></a><span id="l43.702" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.703"></a><span id="l43.703" class="difflineminus">-</span>
<a href="#l43.704"></a><span id="l43.704" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kWorkWebPageProperty, str)))</span>
<a href="#l43.705"></a><span id="l43.705" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.706"></a><span id="l43.706" class="difflineminus">-    if (Compare(str, kWorkWebPageProperty))</span>
<a href="#l43.707"></a><span id="l43.707" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.708"></a><span id="l43.708" class="difflineminus">-</span>
<a href="#l43.709"></a><span id="l43.709" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kHomeWebPageProperty, str)))</span>
<a href="#l43.710"></a><span id="l43.710" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.711"></a><span id="l43.711" class="difflineminus">-    if (Compare(str, kHomeWebPageProperty))</span>
<a href="#l43.712"></a><span id="l43.712" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.713"></a><span id="l43.713" class="difflineminus">-</span>
<a href="#l43.714"></a><span id="l43.714" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kBirthYearProperty, str)))</span>
<a href="#l43.715"></a><span id="l43.715" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.716"></a><span id="l43.716" class="difflineminus">-    if (Compare(str, kBirthYearProperty))</span>
<a href="#l43.717"></a><span id="l43.717" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.718"></a><span id="l43.718" class="difflineminus">-</span>
<a href="#l43.719"></a><span id="l43.719" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kBirthMonthProperty, str)))</span>
<a href="#l43.720"></a><span id="l43.720" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.721"></a><span id="l43.721" class="difflineminus">-    if (Compare(str, kBirthMonthProperty))</span>
<a href="#l43.722"></a><span id="l43.722" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.723"></a><span id="l43.723" class="difflineminus">-</span>
<a href="#l43.724"></a><span id="l43.724" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kBirthDayProperty, str)))</span>
<a href="#l43.725"></a><span id="l43.725" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.726"></a><span id="l43.726" class="difflineminus">-    if (Compare(str, kBirthDayProperty))</span>
<a href="#l43.727"></a><span id="l43.727" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.728"></a><span id="l43.728" class="difflineminus">-</span>
<a href="#l43.729"></a><span id="l43.729" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kCustom1Property, str)))</span>
<a href="#l43.730"></a><span id="l43.730" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.731"></a><span id="l43.731" class="difflineminus">-    if (Compare(str, kCustom1Property))</span>
<a href="#l43.732"></a><span id="l43.732" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.733"></a><span id="l43.733" class="difflineminus">-</span>
<a href="#l43.734"></a><span id="l43.734" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kCustom2Property, str)))</span>
<a href="#l43.735"></a><span id="l43.735" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.736"></a><span id="l43.736" class="difflineminus">-    if (Compare(str, kCustom2Property))</span>
<a href="#l43.737"></a><span id="l43.737" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.738"></a><span id="l43.738" class="difflineminus">-</span>
<a href="#l43.739"></a><span id="l43.739" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kCustom3Property, str)))</span>
<a href="#l43.740"></a><span id="l43.740" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.741"></a><span id="l43.741" class="difflineminus">-    if (Compare(str, kCustom3Property))</span>
<a href="#l43.742"></a><span id="l43.742" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.743"></a><span id="l43.743" class="difflineminus">-</span>
<a href="#l43.744"></a><span id="l43.744" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kCustom4Property, str)))</span>
<a href="#l43.745"></a><span id="l43.745" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.746"></a><span id="l43.746" class="difflineminus">-    if (Compare(str, kCustom4Property))</span>
<a href="#l43.747"></a><span id="l43.747" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.748"></a><span id="l43.748" class="difflineminus">-</span>
<a href="#l43.749"></a><span id="l43.749" class="difflineminus">-    PRBool isMailList=PR_FALSE;</span>
<a href="#l43.750"></a><span id="l43.750" class="difflineminus">-    card-&gt;GetIsMailList(&amp;isMailList);</span>
<a href="#l43.751"></a><span id="l43.751" class="difflineminus">-    if (isMailList != m_IsMailList)</span>
<a href="#l43.752"></a><span id="l43.752" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.753"></a><span id="l43.753" class="difflineminus">-</span>
<a href="#l43.754"></a><span id="l43.754" class="difflineminus">-    nsCString str2;</span>
<a href="#l43.755"></a><span id="l43.755" class="difflineminus">-    card-&gt;GetMailListURI(getter_Copies(str2));</span>
<a href="#l43.756"></a><span id="l43.756" class="difflineminus">-    if (m_MailListURI.Equals(str2, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l43.757"></a><span id="l43.757" class="difflineminus">-        return NS_OK;</span>
<a href="#l43.758"></a><span id="l43.758" class="difflineminus">-</span>
<a href="#l43.759"></a><span id="l43.759" class="difflineminus">-    *_retval = PR_TRUE;</span>
<a href="#l43.760"></a><span id="l43.760" class="difflineminus">-    return NS_OK;</span>
<a href="#l43.761"></a><span id="l43.761" class="difflineminus">-}</span>
<a href="#l43.762"></a><span id="l43.762" class="difflineminus">-</span>
<a href="#l43.763"></a><span id="l43.763" class="difflineminus">-PRBool nsAbIPCCard::CompareValue(PRBool isUnicode, LPTSTR cardValue, const char *attribute)</span>
<a href="#l43.764"></a><span id="l43.764" class="difflineminus">-{</span>
<a href="#l43.765"></a><span id="l43.765" class="difflineminus">-    if(cardValue) {</span>
<a href="#l43.766"></a><span id="l43.766" class="difflineminus">-        if(isUnicode) {</span>
<a href="#l43.767"></a><span id="l43.767" class="difflineminus">-            if (Compare(nsDependentString(cardValue), attribute))</span>
<a href="#l43.768"></a><span id="l43.768" class="difflineminus">-                return PR_FALSE;</span>
<a href="#l43.769"></a><span id="l43.769" class="difflineminus">-        }</span>
<a href="#l43.770"></a><span id="l43.770" class="difflineminus">-        else {</span>
<a href="#l43.771"></a><span id="l43.771" class="difflineminus">-            nsAutoString str;</span>
<a href="#l43.772"></a><span id="l43.772" class="difflineminus">-            CONVERT_ASSIGNTO_UNICODE(str, cardValue, PR_TRUE);</span>
<a href="#l43.773"></a><span id="l43.773" class="difflineminus">-            if (Compare(str, attribute))</span>
<a href="#l43.774"></a><span id="l43.774" class="difflineminus">-                return PR_FALSE;</span>
<a href="#l43.775"></a><span id="l43.775" class="difflineminus">-        }</span>
<a href="#l43.776"></a><span id="l43.776" class="difflineminus">-    }</span>
<a href="#l43.777"></a><span id="l43.777" class="difflineminus">-</span>
<a href="#l43.778"></a><span id="l43.778" class="difflineminus">-    return PR_TRUE;</span>
<a href="#l43.779"></a><span id="l43.779" class="difflineminus">-}</span>
<a href="#l43.780"></a><span id="l43.780" class="difflineminus">-</span>
<a href="#l43.781"></a><span id="l43.781" class="difflineminus">-PRBool nsAbIPCCard::Compare(nsString &amp;cardValue, const char *attribute)</span>
<a href="#l43.782"></a><span id="l43.782" class="difflineminus">-{</span>
<a href="#l43.783"></a><span id="l43.783" class="difflineminus">-  nsAutoString attribValue;</span>
<a href="#l43.784"></a><span id="l43.784" class="difflineminus">-  GetPropertyAsAString(attribute, attribValue);</span>
<a href="#l43.785"></a><span id="l43.785" class="difflineminus">-  return ::Compare(cardValue, attribValue, nsCaseInsensitiveStringComparator());</span>
<a href="#l43.786"></a><span id="l43.786" class="difflineminus">-}</span>
<a href="#l43.787"></a><span id="l43.787" class="difflineminus">-PRBool nsAbIPCCard::Same(nsABCOMCardStruct * card, PRBool isUnicode)</span>
<a href="#l43.788"></a><span id="l43.788" class="difflineminus">-{</span>
<a href="#l43.789"></a><span id="l43.789" class="difflineminus">-    if(!card)</span>
<a href="#l43.790"></a><span id="l43.790" class="difflineminus">-        return PR_FALSE;</span>
<a href="#l43.791"></a><span id="l43.791" class="difflineminus">-</span>
<a href="#l43.792"></a><span id="l43.792" class="difflineminus">-    if(mRecordId &amp;&amp; card-&gt;dwRecordId) </span>
<a href="#l43.793"></a><span id="l43.793" class="difflineminus">-        return (mRecordId == card-&gt;dwRecordId);</span>
<a href="#l43.794"></a><span id="l43.794" class="difflineminus">-</span>
<a href="#l43.795"></a><span id="l43.795" class="difflineminus">-    if(CompareValue(isUnicode, card-&gt;firstName, kFirstNameProperty))</span>
<a href="#l43.796"></a><span id="l43.796" class="difflineminus">-        if(CompareValue(isUnicode, card-&gt;lastName, kLastNameProperty))</span>
<a href="#l43.797"></a><span id="l43.797" class="difflineminus">-            if(CompareValue(isUnicode, card-&gt;displayName, kDisplayNameProperty))</span>
<a href="#l43.798"></a><span id="l43.798" class="difflineminus">-                if(CompareValue(isUnicode, card-&gt;nickName, kNicknameProperty))</span>
<a href="#l43.799"></a><span id="l43.799" class="difflineminus">-                    return PR_TRUE;</span>
<a href="#l43.800"></a><span id="l43.800" class="difflineminus">-</span>
<a href="#l43.801"></a><span id="l43.801" class="difflineminus">-    return PR_FALSE;</span>
<a href="#l43.802"></a><span id="l43.802" class="difflineminus">-}</span>
<a href="#l43.803"></a><span id="l43.803" class="difflineminus">-</span>
<a href="#l43.804"></a><span id="l43.804" class="difflineminus">-</span>
<a href="#l43.805"></a><span id="l43.805" class="difflineminus">-PRBool nsAbIPCCard::Same(nsIAbCard *card)</span>
<a href="#l43.806"></a><span id="l43.806" class="difflineminus">-{</span>
<a href="#l43.807"></a><span id="l43.807" class="difflineminus">-    if(!card)</span>
<a href="#l43.808"></a><span id="l43.808" class="difflineminus">-        return PR_FALSE;</span>
<a href="#l43.809"></a><span id="l43.809" class="difflineminus">-</span>
<a href="#l43.810"></a><span id="l43.810" class="difflineminus">-    nsresult rv;</span>
<a href="#l43.811"></a><span id="l43.811" class="difflineminus">-    // first check the palmID for the cards if they exist</span>
<a href="#l43.812"></a><span id="l43.812" class="difflineminus">-    nsString palmIDStr;</span>
<a href="#l43.813"></a><span id="l43.813" class="difflineminus">-    rv = card-&gt;GetPropertyAsAString(CARD_ATTRIB_PALMID, palmIDStr);</span>
<a href="#l43.814"></a><span id="l43.814" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; palmIDStr.get()) {</span>
<a href="#l43.815"></a><span id="l43.815" class="difflineminus">-      PRInt32 palmID=0;</span>
<a href="#l43.816"></a><span id="l43.816" class="difflineminus">-      PRFloat64 f = PR_strtod(NS_LossyConvertUTF16toASCII(palmIDStr).get(), nsnull);</span>
<a href="#l43.817"></a><span id="l43.817" class="difflineminus">-      PRInt64 l;</span>
<a href="#l43.818"></a><span id="l43.818" class="difflineminus">-      LL_D2L(l, f);</span>
<a href="#l43.819"></a><span id="l43.819" class="difflineminus">-      LL_L2UI(palmID, l);</span>
<a href="#l43.820"></a><span id="l43.820" class="difflineminus">-      if (palmID &amp;&amp; mRecordId)</span>
<a href="#l43.821"></a><span id="l43.821" class="difflineminus">-        return mRecordId == palmID;</span>
<a href="#l43.822"></a><span id="l43.822" class="difflineminus">-    }</span>
<a href="#l43.823"></a><span id="l43.823" class="difflineminus">-</span>
<a href="#l43.824"></a><span id="l43.824" class="difflineminus">-    nsString str;</span>
<a href="#l43.825"></a><span id="l43.825" class="difflineminus">-    card-&gt;GetFirstName(str);</span>
<a href="#l43.826"></a><span id="l43.826" class="difflineminus">-    if (Compare(str, kFirstNameProperty))</span>
<a href="#l43.827"></a><span id="l43.827" class="difflineminus">-        return PR_FALSE;</span>
<a href="#l43.828"></a><span id="l43.828" class="difflineminus">-    card-&gt;GetLastName(str);</span>
<a href="#l43.829"></a><span id="l43.829" class="difflineminus">-    if (Compare(str, kLastNameProperty))</span>
<a href="#l43.830"></a><span id="l43.830" class="difflineminus">-        return PR_FALSE;</span>
<a href="#l43.831"></a><span id="l43.831" class="difflineminus">-    card-&gt;GetDisplayName(str);</span>
<a href="#l43.832"></a><span id="l43.832" class="difflineminus">-    if (Compare(str, kDisplayNameProperty))</span>
<a href="#l43.833"></a><span id="l43.833" class="difflineminus">-        return PR_FALSE;</span>
<a href="#l43.834"></a><span id="l43.834" class="difflineminus">-    if (NS_FAILED(card-&gt;GetPropertyAsAString(kNicknameProperty, str)))</span>
<a href="#l43.835"></a><span id="l43.835" class="difflineminus">-      str.Truncate();</span>
<a href="#l43.836"></a><span id="l43.836" class="difflineminus">-    if (Compare(str, kNicknameProperty))</span>
<a href="#l43.837"></a><span id="l43.837" class="difflineminus">-        return PR_FALSE;</span>
<a href="#l43.838"></a><span id="l43.838" class="difflineminus">-</span>
<a href="#l43.839"></a><span id="l43.839" class="difflineminus">-    return PR_TRUE;</span>
<a href="#l43.840"></a><span id="l43.840" class="difflineminus">-}</span>
<a href="#l43.841"></a><span id="l43.841" class="difflineminus">-</span>
<a href="#l43.842"></a><span id="l43.842" class="difflineminus">-</span>
<a href="#l43.843"></a><span id="l43.843" class="difflineminus">-void nsAbIPCCard::CopyValue(PRBool isUnicode, const char *attribute, LPTSTR * result)</span>
<a href="#l43.844"></a><span id="l43.844" class="difflineminus">-{</span>
<a href="#l43.845"></a><span id="l43.845" class="difflineminus">-    *result = NULL;</span>
<a href="#l43.846"></a><span id="l43.846" class="difflineminus">-    nsAutoString attribValue;</span>
<a href="#l43.847"></a><span id="l43.847" class="difflineminus">-    GetPropertyAsAString(attribute, attribValue);</span>
<a href="#l43.848"></a><span id="l43.848" class="difflineminus">-    if(attribValue.Length() &amp;&amp; attribValue.get()) {</span>
<a href="#l43.849"></a><span id="l43.849" class="difflineminus">-        PRInt32 length;</span>
<a href="#l43.850"></a><span id="l43.850" class="difflineminus">-        if(isUnicode) {                                 </span>
<a href="#l43.851"></a><span id="l43.851" class="difflineminus">-            length = attribValue.Length()+1;</span>
<a href="#l43.852"></a><span id="l43.852" class="difflineminus">-            PRUnichar * Str = (PRUnichar *) CoTaskMemAlloc(sizeof(PRUnichar) * length);</span>
<a href="#l43.853"></a><span id="l43.853" class="difflineminus">-            wcsncpy(Str, attribValue.get(), length-1);</span>
<a href="#l43.854"></a><span id="l43.854" class="difflineminus">-            Str[length-1] = '\0';</span>
<a href="#l43.855"></a><span id="l43.855" class="difflineminus">-            *result = Str;</span>
<a href="#l43.856"></a><span id="l43.856" class="difflineminus">-        } </span>
<a href="#l43.857"></a><span id="l43.857" class="difflineminus">-        else { </span>
<a href="#l43.858"></a><span id="l43.858" class="difflineminus">-            NS_LossyConvertUTF16toASCII cStr(attribValue);</span>
<a href="#l43.859"></a><span id="l43.859" class="difflineminus">-            // These strings are defined as wide in the idl, so we need to add up to 3</span>
<a href="#l43.860"></a><span id="l43.860" class="difflineminus">-            // bytes of 0 byte padding at the end (if the string is an odd number of </span>
<a href="#l43.861"></a><span id="l43.861" class="difflineminus">-            // bytes long, we need one null byte to pad out the last char to a wide char</span>
<a href="#l43.862"></a><span id="l43.862" class="difflineminus">-            // and then  two more nulls as a wide null terminator.</span>
<a href="#l43.863"></a><span id="l43.863" class="difflineminus">-            length = cStr.Length()+3;</span>
<a href="#l43.864"></a><span id="l43.864" class="difflineminus">-            char * str = (char *) CoTaskMemAlloc(length);</span>
<a href="#l43.865"></a><span id="l43.865" class="difflineminus">-            strncpy(str, cStr.get(), length-1);</span>
<a href="#l43.866"></a><span id="l43.866" class="difflineminus">-            str[length-1] = '\0';</span>
<a href="#l43.867"></a><span id="l43.867" class="difflineminus">-            *result = (LPTSTR) str;</span>
<a href="#l43.868"></a><span id="l43.868" class="difflineminus">-        } </span>
<a href="#l43.869"></a><span id="l43.869" class="difflineminus">-    }</span>
<a href="#l43.870"></a><span id="l43.870" class="difflineminus">-}</span>
<a href="#l43.871"></a><span id="l43.871" class="difflineminus">-</span>
<a href="#l43.872"></a><span id="l43.872" class="difflineminus">-nsresult nsAbIPCCard::GetABCOMCardStruct(PRBool isUnicode, nsABCOMCardStruct * card)</span>
<a href="#l43.873"></a><span id="l43.873" class="difflineminus">-{</span>
<a href="#l43.874"></a><span id="l43.874" class="difflineminus">-    NS_ENSURE_ARG_POINTER(card);</span>
<a href="#l43.875"></a><span id="l43.875" class="difflineminus">-</span>
<a href="#l43.876"></a><span id="l43.876" class="difflineminus">-    // If memset() call is missing, callers of MS COM nsSynchronizeAB() will</span>
<a href="#l43.877"></a><span id="l43.877" class="difflineminus">-    // receive a different return code even if nsSynchronizeAB() return S_OK.</span>
<a href="#l43.878"></a><span id="l43.878" class="difflineminus">-    memset(card, 0, sizeof(nsABCOMCardStruct));</span>
<a href="#l43.879"></a><span id="l43.879" class="difflineminus">-    card-&gt;dwRecordId = mRecordId;</span>
<a href="#l43.880"></a><span id="l43.880" class="difflineminus">-    card-&gt;dwCategoryId = mCategoryId;</span>
<a href="#l43.881"></a><span id="l43.881" class="difflineminus">-    card-&gt;dwStatus = mStatus;</span>
<a href="#l43.882"></a><span id="l43.882" class="difflineminus">-    card-&gt;addressToUse = CPalmSyncImp::nsUseABHomeAddressForPalmAddress(); // 0 == home, 1 == work</span>
<a href="#l43.883"></a><span id="l43.883" class="difflineminus">-    PR_LOG(PALMSYNC, PR_LOG_DEBUG, (&quot;nsAbIPCCard::GetABCOMCardStruct using %d\n&quot;, card-&gt;addressToUse));</span>
<a href="#l43.884"></a><span id="l43.884" class="difflineminus">-</span>
<a href="#l43.885"></a><span id="l43.885" class="difflineminus">-    CopyValue(isUnicode, kFirstNameProperty, &amp;card-&gt;firstName);</span>
<a href="#l43.886"></a><span id="l43.886" class="difflineminus">-    CopyValue(isUnicode, kLastNameProperty, &amp;card-&gt;lastName);</span>
<a href="#l43.887"></a><span id="l43.887" class="difflineminus">-    CopyValue(isUnicode, kDisplayNameProperty, &amp;card-&gt;displayName);</span>
<a href="#l43.888"></a><span id="l43.888" class="difflineminus">-    CopyValue(isUnicode, kNicknameProperty, &amp;card-&gt;nickName);</span>
<a href="#l43.889"></a><span id="l43.889" class="difflineminus">-    CopyValue(isUnicode, kPriEmailProperty, &amp;card-&gt;primaryEmail);</span>
<a href="#l43.890"></a><span id="l43.890" class="difflineminus">-    CopyValue(isUnicode, k2ndEmailProperty, &amp;card-&gt;secondEmail);</span>
<a href="#l43.891"></a><span id="l43.891" class="difflineminus">-    CopyValue(isUnicode, kWorkPhoneProperty, &amp;card-&gt;workPhone);</span>
<a href="#l43.892"></a><span id="l43.892" class="difflineminus">-    CopyValue(isUnicode, kHomePhoneProperty, &amp;card-&gt;homePhone);</span>
<a href="#l43.893"></a><span id="l43.893" class="difflineminus">-    CopyValue(isUnicode, kFaxProperty, &amp;card-&gt;faxNumber);</span>
<a href="#l43.894"></a><span id="l43.894" class="difflineminus">-    CopyValue(isUnicode, kPagerProperty, &amp;card-&gt;pagerNumber);</span>
<a href="#l43.895"></a><span id="l43.895" class="difflineminus">-    CopyValue(isUnicode, kCellularProperty, &amp;card-&gt;cellularNumber);</span>
<a href="#l43.896"></a><span id="l43.896" class="difflineminus">-    // See if home address contains multiple lines.</span>
<a href="#l43.897"></a><span id="l43.897" class="difflineminus">-    JoinHomeAndWorkAddresses(isUnicode, card);</span>
<a href="#l43.898"></a><span id="l43.898" class="difflineminus">-    CopyValue(isUnicode, kHomeCityProperty, &amp;card-&gt;homeCity);</span>
<a href="#l43.899"></a><span id="l43.899" class="difflineminus">-    CopyValue(isUnicode, kHomeStateProperty, &amp;card-&gt;homeState);</span>
<a href="#l43.900"></a><span id="l43.900" class="difflineminus">-    CopyValue(isUnicode, kHomeZipCodeProperty, &amp;card-&gt;homeZipCode);</span>
<a href="#l43.901"></a><span id="l43.901" class="difflineminus">-    CopyValue(isUnicode, kHomeCountryProperty, &amp;card-&gt;homeCountry);</span>
<a href="#l43.902"></a><span id="l43.902" class="difflineminus">-    CopyValue(isUnicode, kWorkCityProperty, &amp;card-&gt;workCity);</span>
<a href="#l43.903"></a><span id="l43.903" class="difflineminus">-    CopyValue(isUnicode, kWorkStateProperty, &amp;card-&gt;workState);</span>
<a href="#l43.904"></a><span id="l43.904" class="difflineminus">-    CopyValue(isUnicode, kWorkZipCodeProperty, &amp;card-&gt;workZipCode);</span>
<a href="#l43.905"></a><span id="l43.905" class="difflineminus">-    CopyValue(isUnicode, kWorkCountryProperty, &amp;card-&gt;workCountry);</span>
<a href="#l43.906"></a><span id="l43.906" class="difflineminus">-    CopyValue(isUnicode, kJobTitleProperty, &amp;card-&gt;jobTitle);</span>
<a href="#l43.907"></a><span id="l43.907" class="difflineminus">-    CopyValue(isUnicode, kDepartmentProperty, &amp;card-&gt;department);</span>
<a href="#l43.908"></a><span id="l43.908" class="difflineminus">-    CopyValue(isUnicode, kCompanyProperty, &amp;card-&gt;company);</span>
<a href="#l43.909"></a><span id="l43.909" class="difflineminus">-    CopyValue(isUnicode, kWorkWebPageProperty, &amp;card-&gt;webPage1);</span>
<a href="#l43.910"></a><span id="l43.910" class="difflineminus">-    CopyValue(isUnicode, kHomeWebPageProperty, &amp;card-&gt;webPage2);</span>
<a href="#l43.911"></a><span id="l43.911" class="difflineminus">-    CopyValue(isUnicode, kBirthYearProperty, &amp;card-&gt;birthYear);</span>
<a href="#l43.912"></a><span id="l43.912" class="difflineminus">-    CopyValue(isUnicode, kBirthMonthProperty, &amp;card-&gt;birthMonth);</span>
<a href="#l43.913"></a><span id="l43.913" class="difflineminus">-    CopyValue(isUnicode, kBirthDayProperty, &amp;card-&gt;birthDay);</span>
<a href="#l43.914"></a><span id="l43.914" class="difflineminus">-    CopyValue(isUnicode, kCustom1Property, &amp;card-&gt;custom1);</span>
<a href="#l43.915"></a><span id="l43.915" class="difflineminus">-    CopyValue(isUnicode, kCustom2Property, &amp;card-&gt;custom2);</span>
<a href="#l43.916"></a><span id="l43.916" class="difflineminus">-    CopyValue(isUnicode, kCustom3Property, &amp;card-&gt;custom3);</span>
<a href="#l43.917"></a><span id="l43.917" class="difflineminus">-    CopyValue(isUnicode, kCustom4Property, &amp;card-&gt;custom4);</span>
<a href="#l43.918"></a><span id="l43.918" class="difflineminus">-    CopyValue(isUnicode, kNotesProperty, &amp;card-&gt;notes);</span>
<a href="#l43.919"></a><span id="l43.919" class="difflineminus">-</span>
<a href="#l43.920"></a><span id="l43.920" class="difflineminus">-    GetPropertyAsUint32(kLastModifiedDateProperty,</span>
<a href="#l43.921"></a><span id="l43.921" class="difflineminus">-                        (PRUint32*)&amp;card-&gt;lastModifiedDate);</span>
<a href="#l43.922"></a><span id="l43.922" class="difflineminus">-    GetPropertyAsUint32(kPreferMailFormatProperty,</span>
<a href="#l43.923"></a><span id="l43.923" class="difflineminus">-                        (PRUint32*)&amp;card-&gt;preferMailFormat);</span>
<a href="#l43.924"></a><span id="l43.924" class="difflineminus">-    card-&gt;addressToUse = CPalmSyncImp::nsUseABHomeAddressForPalmAddress(); // 0 == home, 1 == work</span>
<a href="#l43.925"></a><span id="l43.925" class="difflineminus">-    nsAutoString homePhone, workPhone;</span>
<a href="#l43.926"></a><span id="l43.926" class="difflineminus">-    GetPropertyAsAString(kHomePhoneProperty, homePhone);</span>
<a href="#l43.927"></a><span id="l43.927" class="difflineminus">-    GetPropertyAsAString(kWorkPhoneProperty, workPhone);</span>
<a href="#l43.928"></a><span id="l43.928" class="difflineminus">-    if (CPalmSyncImp::nsPreferABHomePhoneForPalmPhone())</span>
<a href="#l43.929"></a><span id="l43.929" class="difflineminus">-      card-&gt;preferredPhoneNum = (homePhone.IsEmpty()) ? (workPhone.IsEmpty() ? 4 : 1) : 2;</span>
<a href="#l43.930"></a><span id="l43.930" class="difflineminus">-    else</span>
<a href="#l43.931"></a><span id="l43.931" class="difflineminus">-      card-&gt;preferredPhoneNum = (workPhone.IsEmpty()) ? 2 : (workPhone.IsEmpty() ? 4 : 1);</span>
<a href="#l43.932"></a><span id="l43.932" class="difflineminus">-    card-&gt;isMailList = m_IsMailList;</span>
<a href="#l43.933"></a><span id="l43.933" class="difflineminus">-    // Can't use ToNewCString() call here becasue MSCOM will complaint about</span>
<a href="#l43.934"></a><span id="l43.934" class="difflineminus">-    // memory deallocation (ie, NdrPointerFree()) use CoTaskMemAlloc() instead.</span>
<a href="#l43.935"></a><span id="l43.935" class="difflineminus">-    if (m_MailListURI.IsEmpty())</span>
<a href="#l43.936"></a><span id="l43.936" class="difflineminus">-      card-&gt;mailListURI = NULL;</span>
<a href="#l43.937"></a><span id="l43.937" class="difflineminus">-    else</span>
<a href="#l43.938"></a><span id="l43.938" class="difflineminus">-    {</span>
<a href="#l43.939"></a><span id="l43.939" class="difflineminus">-      PRInt32 length = m_MailListURI.Length()+1;</span>
<a href="#l43.940"></a><span id="l43.940" class="difflineminus">-      char * str = (char *) CoTaskMemAlloc(sizeof(char) * length);</span>
<a href="#l43.941"></a><span id="l43.941" class="difflineminus">-      strncpy(str, m_MailListURI.get(), length-1);</span>
<a href="#l43.942"></a><span id="l43.942" class="difflineminus">-      str[length-1] = '\0';</span>
<a href="#l43.943"></a><span id="l43.943" class="difflineminus">-      card-&gt;mailListURI = str;</span>
<a href="#l43.944"></a><span id="l43.944" class="difflineminus">-    }</span>
<a href="#l43.945"></a><span id="l43.945" class="difflineminus">-</span>
<a href="#l43.946"></a><span id="l43.946" class="difflineminus">-    return NS_OK;</span>
<a href="#l43.947"></a><span id="l43.947" class="difflineminus">-}</span>
<a href="#l43.948"></a><span id="l43.948" class="difflineminus">-</span>
<a href="#l43.949"></a><span id="l43.949" class="difflineminus">-void nsAbIPCCard::JoinAddress(PRBool isUnicode, LPTSTR *ptrAddress, nsString &amp;address1, nsString &amp;address2)</span>
<a href="#l43.950"></a><span id="l43.950" class="difflineminus">-{</span>
<a href="#l43.951"></a><span id="l43.951" class="difflineminus">-  // If the two address lines in a moz card are not empty</span>
<a href="#l43.952"></a><span id="l43.952" class="difflineminus">-  // then join the lines into a single line separated by</span>
<a href="#l43.953"></a><span id="l43.953" class="difflineminus">-  // '\x0A'. This is the format expected by Palm.</span>
<a href="#l43.954"></a><span id="l43.954" class="difflineminus">-  *ptrAddress = NULL;</span>
<a href="#l43.955"></a><span id="l43.955" class="difflineminus">-  PRUint32 strLength= address1.Length() + address2.Length();</span>
<a href="#l43.956"></a><span id="l43.956" class="difflineminus">-  if(!strLength)</span>
<a href="#l43.957"></a><span id="l43.957" class="difflineminus">-    return;</span>
<a href="#l43.958"></a><span id="l43.958" class="difflineminus">-</span>
<a href="#l43.959"></a><span id="l43.959" class="difflineminus">-  // Allocate space for 'strLength' plus three for nulls and one for &quot;\x0A&quot;.</span>
<a href="#l43.960"></a><span id="l43.960" class="difflineminus">-  // These strings are defined as wide in the idl, so we need to add up to 3</span>
<a href="#l43.961"></a><span id="l43.961" class="difflineminus">-  // bytes of 0 byte padding at the end (if the string is an odd number of </span>
<a href="#l43.962"></a><span id="l43.962" class="difflineminus">-  // bytes long, we need one null byte to pad out the last char to a wide char</span>
<a href="#l43.963"></a><span id="l43.963" class="difflineminus">-  // and then  two more nulls as a wide null terminator.</span>
<a href="#l43.964"></a><span id="l43.964" class="difflineminus">-  strLength += 4;</span>
<a href="#l43.965"></a><span id="l43.965" class="difflineminus">-  if(isUnicode)</span>
<a href="#l43.966"></a><span id="l43.966" class="difflineminus">-  { </span>
<a href="#l43.967"></a><span id="l43.967" class="difflineminus">-    PRUnichar * uniStr = (PRUnichar *) CoTaskMemAlloc(sizeof(PRUnichar) * (strLength));</span>
<a href="#l43.968"></a><span id="l43.968" class="difflineminus">-    if(address1.Length())</span>
<a href="#l43.969"></a><span id="l43.969" class="difflineminus">-    {</span>
<a href="#l43.970"></a><span id="l43.970" class="difflineminus">-      wcsncpy(uniStr, address1.get(), strLength-1);</span>
<a href="#l43.971"></a><span id="l43.971" class="difflineminus">-      uniStr[strLength-1] = '\0';</span>
<a href="#l43.972"></a><span id="l43.972" class="difflineminus">-      if(address2.Length())</span>
<a href="#l43.973"></a><span id="l43.973" class="difflineminus">-      {</span>
<a href="#l43.974"></a><span id="l43.974" class="difflineminus">-        wcsncat(uniStr, (const wchar_t *)&quot;\x0A&quot;, strLength-1);</span>
<a href="#l43.975"></a><span id="l43.975" class="difflineminus">-        wcsncat(uniStr, address2.get(), strLength-1);</span>
<a href="#l43.976"></a><span id="l43.976" class="difflineminus">-        uniStr[strLength-1] = '\0';</span>
<a href="#l43.977"></a><span id="l43.977" class="difflineminus">-      }</span>
<a href="#l43.978"></a><span id="l43.978" class="difflineminus">-    }</span>
<a href="#l43.979"></a><span id="l43.979" class="difflineminus">-    else</span>
<a href="#l43.980"></a><span id="l43.980" class="difflineminus">-    {</span>
<a href="#l43.981"></a><span id="l43.981" class="difflineminus">-      wcsncpy(uniStr, address2.get(), strLength-1);</span>
<a href="#l43.982"></a><span id="l43.982" class="difflineminus">-      uniStr[strLength-1] = '\0';</span>
<a href="#l43.983"></a><span id="l43.983" class="difflineminus">-    }</span>
<a href="#l43.984"></a><span id="l43.984" class="difflineminus">-</span>
<a href="#l43.985"></a><span id="l43.985" class="difflineminus">-    *ptrAddress = uniStr;</span>
<a href="#l43.986"></a><span id="l43.986" class="difflineminus">-  } </span>
<a href="#l43.987"></a><span id="l43.987" class="difflineminus">-  else</span>
<a href="#l43.988"></a><span id="l43.988" class="difflineminus">-  { </span>
<a href="#l43.989"></a><span id="l43.989" class="difflineminus">-    char * str = (char *) CoTaskMemAlloc(strLength);</span>
<a href="#l43.990"></a><span id="l43.990" class="difflineminus">-    if(address1.Length())</span>
<a href="#l43.991"></a><span id="l43.991" class="difflineminus">-    {</span>
<a href="#l43.992"></a><span id="l43.992" class="difflineminus">-      NS_LossyConvertUTF16toASCII cStr(address1);</span>
<a href="#l43.993"></a><span id="l43.993" class="difflineminus">-      strncpy(str, cStr.get(), strLength-1);</span>
<a href="#l43.994"></a><span id="l43.994" class="difflineminus">-      str[strLength-1] = '\0';</span>
<a href="#l43.995"></a><span id="l43.995" class="difflineminus">-      if(address2.Length())</span>
<a href="#l43.996"></a><span id="l43.996" class="difflineminus">-      {</span>
<a href="#l43.997"></a><span id="l43.997" class="difflineminus">-        LossyCopyUTF16toASCII(address2, cStr);</span>
<a href="#l43.998"></a><span id="l43.998" class="difflineminus">-        strncat(str, &quot;\x0A&quot;, strLength-1);</span>
<a href="#l43.999"></a><span id="l43.999" class="difflineminus">-        strncat(str, cStr.get(), strLength-1);</span>
<a href="#l43.1000"></a><span id="l43.1000" class="difflineminus">-        str[strLength-1] = '\0';</span>
<a href="#l43.1001"></a><span id="l43.1001" class="difflineminus">-      }</span>
<a href="#l43.1002"></a><span id="l43.1002" class="difflineminus">-    }</span>
<a href="#l43.1003"></a><span id="l43.1003" class="difflineminus">-    else</span>
<a href="#l43.1004"></a><span id="l43.1004" class="difflineminus">-    {</span>
<a href="#l43.1005"></a><span id="l43.1005" class="difflineminus">-      NS_LossyConvertUTF16toASCII cStr(address2);</span>
<a href="#l43.1006"></a><span id="l43.1006" class="difflineminus">-      strncpy(str, cStr.get(), strLength-1);</span>
<a href="#l43.1007"></a><span id="l43.1007" class="difflineminus">-      str[strLength-1] = '\0';</span>
<a href="#l43.1008"></a><span id="l43.1008" class="difflineminus">-    }</span>
<a href="#l43.1009"></a><span id="l43.1009" class="difflineminus">-    *ptrAddress = (LPTSTR) str;</span>
<a href="#l43.1010"></a><span id="l43.1010" class="difflineminus">-  } </span>
<a href="#l43.1011"></a><span id="l43.1011" class="difflineminus">-}</span>
<a href="#l43.1012"></a><span id="l43.1012" class="difflineminus">-void nsAbIPCCard::JoinHomeAndWorkAddresses(PRBool isUnicode, nsABCOMCardStruct * card)</span>
<a href="#l43.1013"></a><span id="l43.1013" class="difflineminus">-{</span>
<a href="#l43.1014"></a><span id="l43.1014" class="difflineminus">-  nsAutoString address, address2;</span>
<a href="#l43.1015"></a><span id="l43.1015" class="difflineminus">-  GetPropertyAsAString(kHomeAddressProperty, address);</span>
<a href="#l43.1016"></a><span id="l43.1016" class="difflineminus">-  GetPropertyAsAString(kHomeAddress2Property, address2);</span>
<a href="#l43.1017"></a><span id="l43.1017" class="difflineminus">-  JoinAddress(isUnicode, &amp;card-&gt;homeAddress, address, address2);</span>
<a href="#l43.1018"></a><span id="l43.1018" class="difflineminus">-</span>
<a href="#l43.1019"></a><span id="l43.1019" class="difflineminus">-  address.Truncate();</span>
<a href="#l43.1020"></a><span id="l43.1020" class="difflineminus">-  address2.Truncate();</span>
<a href="#l43.1021"></a><span id="l43.1021" class="difflineminus">-  GetPropertyAsAString(kWorkAddressProperty, address);</span>
<a href="#l43.1022"></a><span id="l43.1022" class="difflineminus">-  GetPropertyAsAString(kWorkAddress2Property, address2);</span>
<a href="#l43.1023"></a><span id="l43.1023" class="difflineminus">-  JoinAddress(isUnicode, &amp;card-&gt;workAddress, address, address2);</span>
<a href="#l43.1024"></a><span id="l43.1024" class="difflineminus">-}</span>
<a href="#l43.1025"></a><span id="l43.1025" class="difflineminus">-</span>
<a href="#l43.1026"></a><span id="l43.1026" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1">deleted file mode 100644</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/nsAbIPCCard.h</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineplus">+++ /dev/null</span>
<a href="#l44.4"></a><span id="l44.4" class="difflineat">@@ -1,104 +0,0 @@</span>
<a href="#l44.5"></a><span id="l44.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l44.6"></a><span id="l44.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l44.7"></a><span id="l44.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l44.8"></a><span id="l44.8" class="difflineminus">- *</span>
<a href="#l44.9"></a><span id="l44.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l44.10"></a><span id="l44.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l44.11"></a><span id="l44.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineminus">- *</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l44.16"></a><span id="l44.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l44.17"></a><span id="l44.17" class="difflineminus">- * License.</span>
<a href="#l44.18"></a><span id="l44.18" class="difflineminus">- *</span>
<a href="#l44.19"></a><span id="l44.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l44.20"></a><span id="l44.20" class="difflineminus">- *</span>
<a href="#l44.21"></a><span id="l44.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l44.22"></a><span id="l44.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l44.23"></a><span id="l44.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2001</span>
<a href="#l44.24"></a><span id="l44.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l44.25"></a><span id="l44.25" class="difflineminus">- *</span>
<a href="#l44.26"></a><span id="l44.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l44.27"></a><span id="l44.27" class="difflineminus">- *   Created by: Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l44.28"></a><span id="l44.28" class="difflineminus">- *</span>
<a href="#l44.29"></a><span id="l44.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l44.30"></a><span id="l44.30" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l44.31"></a><span id="l44.31" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l44.32"></a><span id="l44.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l44.33"></a><span id="l44.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l44.34"></a><span id="l44.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l44.35"></a><span id="l44.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l44.36"></a><span id="l44.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l44.37"></a><span id="l44.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l44.38"></a><span id="l44.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l44.39"></a><span id="l44.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l44.40"></a><span id="l44.40" class="difflineminus">- *</span>
<a href="#l44.41"></a><span id="l44.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l44.42"></a><span id="l44.42" class="difflineminus">-</span>
<a href="#l44.43"></a><span id="l44.43" class="difflineminus">-#ifndef nsAbIPCCard_h__</span>
<a href="#l44.44"></a><span id="l44.44" class="difflineminus">-#define nsAbIPCCard_h__</span>
<a href="#l44.45"></a><span id="l44.45" class="difflineminus">-</span>
<a href="#l44.46"></a><span id="l44.46" class="difflineminus">-#include &quot;nsAbCardProperty.h&quot;</span>
<a href="#l44.47"></a><span id="l44.47" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l44.48"></a><span id="l44.48" class="difflineminus">-#include &quot;nsVoidArray.h&quot;</span>
<a href="#l44.49"></a><span id="l44.49" class="difflineminus">-#include &quot;IPalmSync.h&quot;</span>
<a href="#l44.50"></a><span id="l44.50" class="difflineminus">-</span>
<a href="#l44.51"></a><span id="l44.51" class="difflineminus">-// these are states of Palm record</span>
<a href="#l44.52"></a><span id="l44.52" class="difflineminus">-// as defined in the Palm CDK</span>
<a href="#l44.53"></a><span id="l44.53" class="difflineminus">-#define ATTR_DELETED        0x0001</span>
<a href="#l44.54"></a><span id="l44.54" class="difflineminus">-#define ATTR_ARCHIVED       0x0002</span>
<a href="#l44.55"></a><span id="l44.55" class="difflineminus">-#define ATTR_MODIFIED       0x0004</span>
<a href="#l44.56"></a><span id="l44.56" class="difflineminus">-#define ATTR_NEW            0x0008</span>
<a href="#l44.57"></a><span id="l44.57" class="difflineminus">-#define ATTR_NONE           0x0020</span>
<a href="#l44.58"></a><span id="l44.58" class="difflineminus">-#define ATTR_NO_REC         0x0040</span>
<a href="#l44.59"></a><span id="l44.59" class="difflineminus">-</span>
<a href="#l44.60"></a><span id="l44.60" class="difflineminus">-class nsAbIPCCard : public nsAbCardProperty</span>
<a href="#l44.61"></a><span id="l44.61" class="difflineminus">-{</span>
<a href="#l44.62"></a><span id="l44.62" class="difflineminus">-public:</span>
<a href="#l44.63"></a><span id="l44.63" class="difflineminus">-    NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l44.64"></a><span id="l44.64" class="difflineminus">-    </span>
<a href="#l44.65"></a><span id="l44.65" class="difflineminus">-    // this checks for all card data fields</span>
<a href="#l44.66"></a><span id="l44.66" class="difflineminus">-    NS_IMETHOD Equals(nsIAbCard *card, PRBool *_retval);</span>
<a href="#l44.67"></a><span id="l44.67" class="difflineminus">-    PRBool Equals(nsABCOMCardStruct * card, nsStringArray &amp; differingAttrs);</span>
<a href="#l44.68"></a><span id="l44.68" class="difflineminus">-    PRBool EqualsAfterUnicodeConversion(nsABCOMCardStruct * card, nsStringArray &amp; differingAttrs);</span>
<a href="#l44.69"></a><span id="l44.69" class="difflineminus">-    </span>
<a href="#l44.70"></a><span id="l44.70" class="difflineminus">-    // this check names attribs: first name + last name + display name + nickname</span>
<a href="#l44.71"></a><span id="l44.71" class="difflineminus">-    PRBool Same(nsABCOMCardStruct * card, PRBool isUnicode=PR_TRUE);</span>
<a href="#l44.72"></a><span id="l44.72" class="difflineminus">-    PRBool Same(nsIAbCard *card);</span>
<a href="#l44.73"></a><span id="l44.73" class="difflineminus">-</span>
<a href="#l44.74"></a><span id="l44.74" class="difflineminus">-    NS_IMETHOD Copy(nsIAbCard *srcCard);</span>
<a href="#l44.75"></a><span id="l44.75" class="difflineminus">-    nsresult Copy(nsABCOMCardStruct * srcCard);</span>
<a href="#l44.76"></a><span id="l44.76" class="difflineminus">-    nsresult ConvertToUnicodeAndCopy(nsABCOMCardStruct * srcCard);</span>
<a href="#l44.77"></a><span id="l44.77" class="difflineminus">-</span>
<a href="#l44.78"></a><span id="l44.78" class="difflineminus">-    // this function will allocate new memory for the passed in card struct data members</span>
<a href="#l44.79"></a><span id="l44.79" class="difflineminus">-    // the caller needs to CoTaskMemFree once it is done using the card struct</span>
<a href="#l44.80"></a><span id="l44.80" class="difflineminus">-    nsresult GetABCOMCardStruct(PRBool isUnicode, nsABCOMCardStruct * card);</span>
<a href="#l44.81"></a><span id="l44.81" class="difflineminus">-</span>
<a href="#l44.82"></a><span id="l44.82" class="difflineminus">-    nsAbIPCCard();</span>
<a href="#l44.83"></a><span id="l44.83" class="difflineminus">-    nsAbIPCCard(nsIAbCard *card);</span>
<a href="#l44.84"></a><span id="l44.84" class="difflineminus">-    nsAbIPCCard(nsABCOMCardStruct *card, PRBool isUnicode=PR_TRUE);</span>
<a href="#l44.85"></a><span id="l44.85" class="difflineminus">-    virtual ~nsAbIPCCard();</span>
<a href="#l44.86"></a><span id="l44.86" class="difflineminus">-</span>
<a href="#l44.87"></a><span id="l44.87" class="difflineminus">-    void SetStatus(PRUint32 status) { mStatus = status; }</span>
<a href="#l44.88"></a><span id="l44.88" class="difflineminus">-    PRUint32 GetStatus() { return mStatus; }</span>
<a href="#l44.89"></a><span id="l44.89" class="difflineminus">-    void SetRecordId(PRUint32 recID) { mRecordId = recID; }</span>
<a href="#l44.90"></a><span id="l44.90" class="difflineminus">-    PRUint32 GetRecordId() { return mRecordId; }</span>
<a href="#l44.91"></a><span id="l44.91" class="difflineminus">-    void SetCategoryId(PRUint32 catID) { mCategoryId = catID; }</span>
<a href="#l44.92"></a><span id="l44.92" class="difflineminus">-    PRUint32 GetCategoryId() { return mCategoryId; }</span>
<a href="#l44.93"></a><span id="l44.93" class="difflineminus">-</span>
<a href="#l44.94"></a><span id="l44.94" class="difflineminus">-private:</span>
<a href="#l44.95"></a><span id="l44.95" class="difflineminus">-    PRUint32 mRecordId;</span>
<a href="#l44.96"></a><span id="l44.96" class="difflineminus">-    PRUint32 mCategoryId;</span>
<a href="#l44.97"></a><span id="l44.97" class="difflineminus">-    PRUint32 mStatus;</span>
<a href="#l44.98"></a><span id="l44.98" class="difflineminus">-</span>
<a href="#l44.99"></a><span id="l44.99" class="difflineminus">-    void CopyValue(PRBool isUnicode, const char *attribute, LPTSTR * result);</span>
<a href="#l44.100"></a><span id="l44.100" class="difflineminus">-    PRBool CompareValue(PRBool isUnicode, LPTSTR cardValue, const char *attribute);</span>
<a href="#l44.101"></a><span id="l44.101" class="difflineminus">-    PRBool Compare(nsString &amp;cardValue, const char *attribute);</span>
<a href="#l44.102"></a><span id="l44.102" class="difflineminus">-    void SplitHomeAndWorkAddresses(nsABCOMCardStruct * card, PRBool isUnicode);</span>
<a href="#l44.103"></a><span id="l44.103" class="difflineminus">-    void SplitAddresses(PRBool isUnicode, LPTSTR homeAddress, LPTSTR workAddress);</span>
<a href="#l44.104"></a><span id="l44.104" class="difflineminus">-    void JoinHomeAndWorkAddresses(PRBool isUnicode, nsABCOMCardStruct * card);</span>
<a href="#l44.105"></a><span id="l44.105" class="difflineminus">-    void JoinAddress(PRBool isUnicode, LPTSTR *ptrAddress, nsString &amp;address1, nsString &amp;address2);</span>
<a href="#l44.106"></a><span id="l44.106" class="difflineminus">-};</span>
<a href="#l44.107"></a><span id="l44.107" class="difflineminus">-</span>
<a href="#l44.108"></a><span id="l44.108" class="difflineminus">-#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1">deleted file mode 100644</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/nsAbPalmSync.cpp</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineplus">+++ /dev/null</span>
<a href="#l45.4"></a><span id="l45.4" class="difflineat">@@ -1,1028 +0,0 @@</span>
<a href="#l45.5"></a><span id="l45.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l45.6"></a><span id="l45.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l45.7"></a><span id="l45.7" class="difflineminus">- *</span>
<a href="#l45.8"></a><span id="l45.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l45.9"></a><span id="l45.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l45.10"></a><span id="l45.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l45.11"></a><span id="l45.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">- *</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l45.14"></a><span id="l45.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l45.16"></a><span id="l45.16" class="difflineminus">- * License.</span>
<a href="#l45.17"></a><span id="l45.17" class="difflineminus">- *</span>
<a href="#l45.18"></a><span id="l45.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l45.19"></a><span id="l45.19" class="difflineminus">- *</span>
<a href="#l45.20"></a><span id="l45.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l45.21"></a><span id="l45.21" class="difflineminus">- * Netscape Communications Corporation</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineminus">- *</span>
<a href="#l45.23"></a><span id="l45.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l45.24"></a><span id="l45.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l45.25"></a><span id="l45.25" class="difflineminus">- *</span>
<a href="#l45.26"></a><span id="l45.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l45.27"></a><span id="l45.27" class="difflineminus">- *       Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l45.28"></a><span id="l45.28" class="difflineminus">- *       Mark Banner &lt;mark@standard8.demon.co.uk&gt;</span>
<a href="#l45.29"></a><span id="l45.29" class="difflineminus">- *</span>
<a href="#l45.30"></a><span id="l45.30" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l45.33"></a><span id="l45.33" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l45.34"></a><span id="l45.34" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l45.35"></a><span id="l45.35" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l45.36"></a><span id="l45.36" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l45.37"></a><span id="l45.37" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l45.38"></a><span id="l45.38" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l45.39"></a><span id="l45.39" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l45.40"></a><span id="l45.40" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l45.41"></a><span id="l45.41" class="difflineminus">- *</span>
<a href="#l45.42"></a><span id="l45.42" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l45.43"></a><span id="l45.43" class="difflineminus">-</span>
<a href="#l45.44"></a><span id="l45.44" class="difflineminus">-#include &quot;nsRDFResource.h&quot;</span>
<a href="#l45.45"></a><span id="l45.45" class="difflineminus">-#include &quot;nsAbPalmSync.h&quot;</span>
<a href="#l45.46"></a><span id="l45.46" class="difflineminus">-#include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l45.47"></a><span id="l45.47" class="difflineminus">-#include &quot;nsMsgI18N.h&quot;</span>
<a href="#l45.48"></a><span id="l45.48" class="difflineminus">-#include &quot;nsIRDFService.h&quot;</span>
<a href="#l45.49"></a><span id="l45.49" class="difflineminus">-#include &quot;nsRDFCID.h&quot;</span>
<a href="#l45.50"></a><span id="l45.50" class="difflineminus">-#include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l45.51"></a><span id="l45.51" class="difflineminus">-#include &quot;nsIAbManager.h&quot;</span>
<a href="#l45.52"></a><span id="l45.52" class="difflineminus">-#include &quot;nsAbCardProperty.h&quot;</span>
<a href="#l45.53"></a><span id="l45.53" class="difflineminus">-#include &quot;prdtoa.h&quot;</span>
<a href="#l45.54"></a><span id="l45.54" class="difflineminus">-#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l45.55"></a><span id="l45.55" class="difflineminus">-#include &quot;nsIArray.h&quot;</span>
<a href="#l45.56"></a><span id="l45.56" class="difflineminus">-#include &quot;nsArrayUtils.h&quot;</span>
<a href="#l45.57"></a><span id="l45.57" class="difflineminus">-</span>
<a href="#l45.58"></a><span id="l45.58" class="difflineminus">-#define  PREVIOUS_EXTENSION &quot;.prev&quot;</span>
<a href="#l45.59"></a><span id="l45.59" class="difflineminus">-#define  kPABDirectory  2 // defined in nsDirPrefs.h</span>
<a href="#l45.60"></a><span id="l45.60" class="difflineminus">-#define  kMAPIDirectory 3 // defined in nsDirPrefs.h</span>
<a href="#l45.61"></a><span id="l45.61" class="difflineminus">-</span>
<a href="#l45.62"></a><span id="l45.62" class="difflineminus">-#define PERSONAL_ADDRBOOK_URL   &quot;moz-abmdbdirectory://abook.mab&quot; // defined in MozABConduitSync.h</span>
<a href="#l45.63"></a><span id="l45.63" class="difflineminus">-</span>
<a href="#l45.64"></a><span id="l45.64" class="difflineminus">-#ifdef DEBUG_bienvenu</span>
<a href="#l45.65"></a><span id="l45.65" class="difflineminus">-   PRBool PalmDataDisplayed = PR_FALSE;</span>
<a href="#l45.66"></a><span id="l45.66" class="difflineminus">-   void DisplayTestData(nsABCOMCardStruct * aIPCCard, PRBool IsUnicode)</span>
<a href="#l45.67"></a><span id="l45.67" class="difflineminus">-   {</span>
<a href="#l45.68"></a><span id="l45.68" class="difflineminus">-       if (IsUnicode) {</span>
<a href="#l45.69"></a><span id="l45.69" class="difflineminus">-           if(aIPCCard-&gt;displayName)</span>
<a href="#l45.70"></a><span id="l45.70" class="difflineminus">-               printf(&quot;\n Card Data For : %S:&quot;, aIPCCard-&gt;displayName);</span>
<a href="#l45.71"></a><span id="l45.71" class="difflineminus">-           if(aIPCCard-&gt;firstName)</span>
<a href="#l45.72"></a><span id="l45.72" class="difflineminus">-               printf(&quot;\n First Name : %S&quot;, aIPCCard-&gt;firstName);</span>
<a href="#l45.73"></a><span id="l45.73" class="difflineminus">-           if(aIPCCard-&gt;lastName)</span>
<a href="#l45.74"></a><span id="l45.74" class="difflineminus">-               printf(&quot;\n Last Name : %S&quot;, aIPCCard-&gt;lastName);</span>
<a href="#l45.75"></a><span id="l45.75" class="difflineminus">-           if(aIPCCard-&gt;primaryEmail)</span>
<a href="#l45.76"></a><span id="l45.76" class="difflineminus">-               printf(&quot;\n Email : %S&quot;, aIPCCard-&gt;primaryEmail);</span>
<a href="#l45.77"></a><span id="l45.77" class="difflineminus">-           if(aIPCCard-&gt;workPhone)</span>
<a href="#l45.78"></a><span id="l45.78" class="difflineminus">-               printf(&quot;\n Work Phone : %S&quot;, aIPCCard-&gt;workPhone);</span>
<a href="#l45.79"></a><span id="l45.79" class="difflineminus">-           if(aIPCCard-&gt;homePhone)</span>
<a href="#l45.80"></a><span id="l45.80" class="difflineminus">-               printf(&quot;\n Home Phone : %S&quot;, aIPCCard-&gt;homePhone);</span>
<a href="#l45.81"></a><span id="l45.81" class="difflineminus">-           if(aIPCCard-&gt;faxNumber)</span>
<a href="#l45.82"></a><span id="l45.82" class="difflineminus">-               printf(&quot;\n Fax Number : %S&quot;, aIPCCard-&gt;faxNumber);</span>
<a href="#l45.83"></a><span id="l45.83" class="difflineminus">-           if(aIPCCard-&gt;company)</span>
<a href="#l45.84"></a><span id="l45.84" class="difflineminus">-               printf(&quot;\n Company : %S&quot;, aIPCCard-&gt;company);</span>
<a href="#l45.85"></a><span id="l45.85" class="difflineminus">-           if(aIPCCard-&gt;jobTitle)</span>
<a href="#l45.86"></a><span id="l45.86" class="difflineminus">-               printf(&quot;\n Job Title : %S&quot;, aIPCCard-&gt;jobTitle);</span>
<a href="#l45.87"></a><span id="l45.87" class="difflineminus">-           if(aIPCCard-&gt;homeAddress)</span>
<a href="#l45.88"></a><span id="l45.88" class="difflineminus">-               printf(&quot;\n Home Address : %S&quot;, aIPCCard-&gt;homeAddress);</span>
<a href="#l45.89"></a><span id="l45.89" class="difflineminus">-           if(aIPCCard-&gt;homeCity)</span>
<a href="#l45.90"></a><span id="l45.90" class="difflineminus">-               printf(&quot;\n Home City : %S&quot;, aIPCCard-&gt;homeCity);</span>
<a href="#l45.91"></a><span id="l45.91" class="difflineminus">-           if(aIPCCard-&gt;homeState)</span>
<a href="#l45.92"></a><span id="l45.92" class="difflineminus">-               printf(&quot;\n Home State : %S&quot;, aIPCCard-&gt;homeState);</span>
<a href="#l45.93"></a><span id="l45.93" class="difflineminus">-           printf(&quot;\n&quot;);</span>
<a href="#l45.94"></a><span id="l45.94" class="difflineminus">-       }</span>
<a href="#l45.95"></a><span id="l45.95" class="difflineminus">-       else {</span>
<a href="#l45.96"></a><span id="l45.96" class="difflineminus">-           if(aIPCCard-&gt;displayName)</span>
<a href="#l45.97"></a><span id="l45.97" class="difflineminus">-               printf(&quot;\n Card Data For : %s:&quot;, (char *) aIPCCard-&gt;displayName);</span>
<a href="#l45.98"></a><span id="l45.98" class="difflineminus">-           if(aIPCCard-&gt;firstName)</span>
<a href="#l45.99"></a><span id="l45.99" class="difflineminus">-               printf(&quot;\n First Name : %s&quot;, (char *) aIPCCard-&gt;firstName);</span>
<a href="#l45.100"></a><span id="l45.100" class="difflineminus">-           if(aIPCCard-&gt;lastName)</span>
<a href="#l45.101"></a><span id="l45.101" class="difflineminus">-               printf(&quot;\n Last Name : %s&quot;, (char *) aIPCCard-&gt;lastName);</span>
<a href="#l45.102"></a><span id="l45.102" class="difflineminus">-           if(aIPCCard-&gt;primaryEmail)</span>
<a href="#l45.103"></a><span id="l45.103" class="difflineminus">-               printf(&quot;\n Email : %s&quot;, (char *) aIPCCard-&gt;primaryEmail);</span>
<a href="#l45.104"></a><span id="l45.104" class="difflineminus">-           if(aIPCCard-&gt;workPhone)</span>
<a href="#l45.105"></a><span id="l45.105" class="difflineminus">-               printf(&quot;\n Work Phone : %s&quot;, (char *) aIPCCard-&gt;workPhone);</span>
<a href="#l45.106"></a><span id="l45.106" class="difflineminus">-           if(aIPCCard-&gt;homePhone)</span>
<a href="#l45.107"></a><span id="l45.107" class="difflineminus">-               printf(&quot;\n Home Phone : %s&quot;, (char *) aIPCCard-&gt;homePhone);</span>
<a href="#l45.108"></a><span id="l45.108" class="difflineminus">-           if(aIPCCard-&gt;faxNumber)</span>
<a href="#l45.109"></a><span id="l45.109" class="difflineminus">-               printf(&quot;\n Fax Number : %s&quot;, (char *) aIPCCard-&gt;faxNumber);</span>
<a href="#l45.110"></a><span id="l45.110" class="difflineminus">-           if(aIPCCard-&gt;company)</span>
<a href="#l45.111"></a><span id="l45.111" class="difflineminus">-               printf(&quot;\n Company :   %s&quot;, (char *) aIPCCard-&gt;company);</span>
<a href="#l45.112"></a><span id="l45.112" class="difflineminus">-           if(aIPCCard-&gt;jobTitle)</span>
<a href="#l45.113"></a><span id="l45.113" class="difflineminus">-               printf(&quot;\n Job Title : %s&quot;, (char *) aIPCCard-&gt;jobTitle);</span>
<a href="#l45.114"></a><span id="l45.114" class="difflineminus">-           if(aIPCCard-&gt;homeAddress)</span>
<a href="#l45.115"></a><span id="l45.115" class="difflineminus">-               printf(&quot;\n Home Address : %s&quot;, (char *) aIPCCard-&gt;homeAddress);</span>
<a href="#l45.116"></a><span id="l45.116" class="difflineminus">-           if(aIPCCard-&gt;homeCity)</span>
<a href="#l45.117"></a><span id="l45.117" class="difflineminus">-               printf(&quot;\n Home City : %s&quot;, (char *) aIPCCard-&gt;homeCity);</span>
<a href="#l45.118"></a><span id="l45.118" class="difflineminus">-           if(aIPCCard-&gt;homeState)</span>
<a href="#l45.119"></a><span id="l45.119" class="difflineminus">-               printf(&quot;\n Home State : %s&quot;, (char *) aIPCCard-&gt;homeState);</span>
<a href="#l45.120"></a><span id="l45.120" class="difflineminus">-           printf(&quot;\n&quot;);</span>
<a href="#l45.121"></a><span id="l45.121" class="difflineminus">-       }</span>
<a href="#l45.122"></a><span id="l45.122" class="difflineminus">-   }</span>
<a href="#l45.123"></a><span id="l45.123" class="difflineminus">-#endif</span>
<a href="#l45.124"></a><span id="l45.124" class="difflineminus">-</span>
<a href="#l45.125"></a><span id="l45.125" class="difflineminus">-nsAbPalmHotSync::nsAbPalmHotSync(PRBool aIsUnicode, PRUnichar * aAbDescUnicode, const char * aAbDesc, PRInt32 aPalmCatIndex, PRInt32 aPalmCatId)</span>
<a href="#l45.126"></a><span id="l45.126" class="difflineminus">-{</span>
<a href="#l45.127"></a><span id="l45.127" class="difflineminus">-    mTotalCardCount=0;</span>
<a href="#l45.128"></a><span id="l45.128" class="difflineminus">-</span>
<a href="#l45.129"></a><span id="l45.129" class="difflineminus">-    mCardForPalmCount = 0;</span>
<a href="#l45.130"></a><span id="l45.130" class="difflineminus">-    mCardListForPalm = nsnull;</span>
<a href="#l45.131"></a><span id="l45.131" class="difflineminus">-    </span>
<a href="#l45.132"></a><span id="l45.132" class="difflineminus">-    mInitialized = PR_FALSE;</span>
<a href="#l45.133"></a><span id="l45.133" class="difflineminus">-    mDBOpen = PR_FALSE;</span>
<a href="#l45.134"></a><span id="l45.134" class="difflineminus">-    </span>
<a href="#l45.135"></a><span id="l45.135" class="difflineminus">-    if(aIsUnicode)</span>
<a href="#l45.136"></a><span id="l45.136" class="difflineminus">-        mAbName.Assign(aAbDescUnicode);</span>
<a href="#l45.137"></a><span id="l45.137" class="difflineminus">-    else</span>
<a href="#l45.138"></a><span id="l45.138" class="difflineminus">-        mAbName.AssignASCII(aAbDesc);</span>
<a href="#l45.139"></a><span id="l45.139" class="difflineminus">-    mAbName.Trim(&quot; &quot;);</span>
<a href="#l45.140"></a><span id="l45.140" class="difflineminus">-</span>
<a href="#l45.141"></a><span id="l45.141" class="difflineminus">-    mPalmCategoryIndex = aPalmCatIndex;</span>
<a href="#l45.142"></a><span id="l45.142" class="difflineminus">-    mPalmCategoryId    = aPalmCatId;</span>
<a href="#l45.143"></a><span id="l45.143" class="difflineminus">-</span>
<a href="#l45.144"></a><span id="l45.144" class="difflineminus">-    mIsPalmDataUnicode = aIsUnicode;</span>
<a href="#l45.145"></a><span id="l45.145" class="difflineminus">-</span>
<a href="#l45.146"></a><span id="l45.146" class="difflineminus">-    mNewCardCount = 0;</span>
<a href="#l45.147"></a><span id="l45.147" class="difflineminus">-    NS_NewISupportsArray(getter_AddRefs(mNewCardsArray));</span>
<a href="#l45.148"></a><span id="l45.148" class="difflineminus">-    mIsNewCardForPalm = PR_FALSE;</span>
<a href="#l45.149"></a><span id="l45.149" class="difflineminus">-}</span>
<a href="#l45.150"></a><span id="l45.150" class="difflineminus">-</span>
<a href="#l45.151"></a><span id="l45.151" class="difflineminus">-nsAbPalmHotSync::~nsAbPalmHotSync()</span>
<a href="#l45.152"></a><span id="l45.152" class="difflineminus">-{</span>
<a href="#l45.153"></a><span id="l45.153" class="difflineminus">-    // clear the nsVoidArray, don't free the stored pointers since they are freed by calling app (Conduit)</span>
<a href="#l45.154"></a><span id="l45.154" class="difflineminus">-    mPalmRecords.Clear();</span>
<a href="#l45.155"></a><span id="l45.155" class="difflineminus">-</span>
<a href="#l45.156"></a><span id="l45.156" class="difflineminus">-    if(mDBOpen &amp;&amp; mABDB)</span>
<a href="#l45.157"></a><span id="l45.157" class="difflineminus">-        mABDB-&gt;Close(PR_FALSE);</span>
<a href="#l45.158"></a><span id="l45.158" class="difflineminus">-}</span>
<a href="#l45.159"></a><span id="l45.159" class="difflineminus">-</span>
<a href="#l45.160"></a><span id="l45.160" class="difflineminus">-// this is a utility function</span>
<a href="#l45.161"></a><span id="l45.161" class="difflineminus">-void nsAbPalmHotSync::ConvertAssignPalmIDAttrib(PRUint32 id, nsIAbCard * card)  </span>
<a href="#l45.162"></a><span id="l45.162" class="difflineminus">-{ </span>
<a href="#l45.163"></a><span id="l45.163" class="difflineminus">-    PRInt64 l;</span>
<a href="#l45.164"></a><span id="l45.164" class="difflineminus">-    LL_UI2L(l, id);</span>
<a href="#l45.165"></a><span id="l45.165" class="difflineminus">-    PRFloat64 f;</span>
<a href="#l45.166"></a><span id="l45.166" class="difflineminus">-    LL_L2F(f, l);</span>
<a href="#l45.167"></a><span id="l45.167" class="difflineminus">-    char buf[128];</span>
<a href="#l45.168"></a><span id="l45.168" class="difflineminus">-    PR_cnvtf(buf, 128, 0, f);</span>
<a href="#l45.169"></a><span id="l45.169" class="difflineminus">-    mABDB-&gt;SetCardValue(card, CARD_ATTRIB_PALMID, NS_ConvertASCIItoUTF16(buf).get(), PR_TRUE);</span>
<a href="#l45.170"></a><span id="l45.170" class="difflineminus">-}</span>
<a href="#l45.171"></a><span id="l45.171" class="difflineminus">-</span>
<a href="#l45.172"></a><span id="l45.172" class="difflineminus">-nsresult nsAbPalmHotSync::GetABInterface()</span>
<a href="#l45.173"></a><span id="l45.173" class="difflineminus">-{</span>
<a href="#l45.174"></a><span id="l45.174" class="difflineminus">-  // Use GetChildNodes() call here.</span>
<a href="#l45.175"></a><span id="l45.175" class="difflineminus">-  nsresult rv;</span>
<a href="#l45.176"></a><span id="l45.176" class="difflineminus">-  nsCOMPtr&lt;nsIAbManager&gt; abManager(do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l45.177"></a><span id="l45.177" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l45.178"></a><span id="l45.178" class="difflineminus">-    return E_FAIL;</span>
<a href="#l45.179"></a><span id="l45.179" class="difflineminus">-</span>
<a href="#l45.180"></a><span id="l45.180" class="difflineminus">-  nsString description;</span>
<a href="#l45.181"></a><span id="l45.181" class="difflineminus">-  nsCString fileName, uri, prefName;</span>
<a href="#l45.182"></a><span id="l45.182" class="difflineminus">-  PRUint32 palmSyncTimeStamp;</span>
<a href="#l45.183"></a><span id="l45.183" class="difflineminus">-  PRInt32 dirType, palmCategoryIndex;</span>
<a href="#l45.184"></a><span id="l45.184" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; subDirectories;</span>
<a href="#l45.185"></a><span id="l45.185" class="difflineminus">-  if (NS_FAILED(abManager-&gt;GetDirectories(getter_AddRefs(subDirectories))) || !subDirectories)</span>
<a href="#l45.186"></a><span id="l45.186" class="difflineminus">-    return E_FAIL;</span>
<a href="#l45.187"></a><span id="l45.187" class="difflineminus">-</span>
<a href="#l45.188"></a><span id="l45.188" class="difflineminus">-  // Check each valid addrbook.</span>
<a href="#l45.189"></a><span id="l45.189" class="difflineminus">-  nsCOMPtr&lt;nsISupports&gt; item;</span>
<a href="#l45.190"></a><span id="l45.190" class="difflineminus">-  nsCOMPtr&lt;nsIAbDirectory&gt; directory;</span>
<a href="#l45.191"></a><span id="l45.191" class="difflineminus">-  PRBool hasMore;</span>
<a href="#l45.192"></a><span id="l45.192" class="difflineminus">-  while (NS_SUCCEEDED(rv = subDirectories-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l45.193"></a><span id="l45.193" class="difflineminus">-  {</span>
<a href="#l45.194"></a><span id="l45.194" class="difflineminus">-    if (NS_SUCCEEDED(subDirectories-&gt;GetNext(getter_AddRefs(item))))</span>
<a href="#l45.195"></a><span id="l45.195" class="difflineminus">-    {</span>
<a href="#l45.196"></a><span id="l45.196" class="difflineminus">-      directory = do_QueryInterface(item, &amp;rv);</span>
<a href="#l45.197"></a><span id="l45.197" class="difflineminus">-      if (NS_SUCCEEDED(rv))</span>
<a href="#l45.198"></a><span id="l45.198" class="difflineminus">-      {</span>
<a href="#l45.199"></a><span id="l45.199" class="difflineminus">-        // TODO: may need to skip mailing list?? but maybe not since there's no mailing list on the top level.</span>
<a href="#l45.200"></a><span id="l45.200" class="difflineminus">-</span>
<a href="#l45.201"></a><span id="l45.201" class="difflineminus">-        rv = directory-&gt;GetDescription(description);</span>
<a href="#l45.202"></a><span id="l45.202" class="difflineminus">-        if(NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l45.203"></a><span id="l45.203" class="difflineminus">-        rv = directory-&gt;GetFileName(fileName);</span>
<a href="#l45.204"></a><span id="l45.204" class="difflineminus">-        if(NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l45.205"></a><span id="l45.205" class="difflineminus">-        rv = directory-&gt;GetURI(uri);</span>
<a href="#l45.206"></a><span id="l45.206" class="difflineminus">-        if(NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l45.207"></a><span id="l45.207" class="difflineminus">-        rv = directory-&gt;GetDirType(&amp;dirType);</span>
<a href="#l45.208"></a><span id="l45.208" class="difflineminus">-        if(NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l45.209"></a><span id="l45.209" class="difflineminus">-        rv = directory-&gt;GetDirPrefId(prefName);</span>
<a href="#l45.210"></a><span id="l45.210" class="difflineminus">-        if (NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l45.211"></a><span id="l45.211" class="difflineminus">-        rv = directory-&gt;GetIntValue(&quot;PalmCategoryId&quot;, -1, &amp;palmCategoryIndex);</span>
<a href="#l45.212"></a><span id="l45.212" class="difflineminus">-        if (NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l45.213"></a><span id="l45.213" class="difflineminus">-        rv = directory-&gt;GetIntValue(&quot;PalmSyncTimeStamp&quot;, 0,</span>
<a href="#l45.214"></a><span id="l45.214" class="difflineminus">-                                    (PRInt32*)&amp;palmSyncTimeStamp);</span>
<a href="#l45.215"></a><span id="l45.215" class="difflineminus">-        if (NS_FAILED(rv)) return E_FAIL;</span>
<a href="#l45.216"></a><span id="l45.216" class="difflineminus">-</span>
<a href="#l45.217"></a><span id="l45.217" class="difflineminus">-        // Skip/Ignore 4.X addrbooks (ie, with &quot;.na2&quot; extension).</span>
<a href="#l45.218"></a><span id="l45.218" class="difflineminus">-        if (((fileName.Length() &gt; kABFileName_PreviousSuffixLen) &amp;&amp; </span>
<a href="#l45.219"></a><span id="l45.219" class="difflineminus">-            strcmp(fileName.get() + fileName.Length() - kABFileName_PreviousSuffixLen, kABFileName_PreviousSuffix) == 0) ||</span>
<a href="#l45.220"></a><span id="l45.220" class="difflineminus">-            (dirType != kPABDirectory &amp;&amp; dirType != kMAPIDirectory))</span>
<a href="#l45.221"></a><span id="l45.221" class="difflineminus">-          continue;</span>
<a href="#l45.222"></a><span id="l45.222" class="difflineminus">-</span>
<a href="#l45.223"></a><span id="l45.223" class="difflineminus">-        // If Palm category is already assigned to AB then just check that (ie, was synced before).</span>
<a href="#l45.224"></a><span id="l45.224" class="difflineminus">-        if((palmCategoryIndex &gt; -1) &amp;&amp; (mPalmCategoryIndex == palmCategoryIndex))</span>
<a href="#l45.225"></a><span id="l45.225" class="difflineminus">-          break;</span>
<a href="#l45.226"></a><span id="l45.226" class="difflineminus">-</span>
<a href="#l45.227"></a><span id="l45.227" class="difflineminus">-        // If Palm category is not already assigned check the AB name (ie, never</span>
<a href="#l45.228"></a><span id="l45.228" class="difflineminus">-        // synced before). Note that Palm category name is only 15 chars max.</span>
<a href="#l45.229"></a><span id="l45.229" class="difflineminus">-        if (description.Length() &gt; 15 &amp;&amp; mAbName.Length() &lt;= 15)</span>
<a href="#l45.230"></a><span id="l45.230" class="difflineminus">-          description.Cut(15, description.Length()-15);</span>
<a href="#l45.231"></a><span id="l45.231" class="difflineminus">-</span>
<a href="#l45.232"></a><span id="l45.232" class="difflineminus">-        // check for matching AB+Category, and special case personal address book</span>
<a href="#l45.233"></a><span id="l45.233" class="difflineminus">-        // to match &quot;Personal&quot; category.</span>
<a href="#l45.234"></a><span id="l45.234" class="difflineminus">-        if(description == mAbName || </span>
<a href="#l45.235"></a><span id="l45.235" class="difflineminus">-            (prefName.Equals(&quot;ldap_2.servers.pab&quot;, nsCaseInsensitiveCStringComparator())</span>
<a href="#l45.236"></a><span id="l45.236" class="difflineminus">-             &amp;&amp; mAbName.LowerCaseEqualsLiteral(&quot;personal&quot;)))</span>
<a href="#l45.237"></a><span id="l45.237" class="difflineminus">-          break;</span>
<a href="#l45.238"></a><span id="l45.238" class="difflineminus">-        directory = nsnull;</span>
<a href="#l45.239"></a><span id="l45.239" class="difflineminus">-      }</span>
<a href="#l45.240"></a><span id="l45.240" class="difflineminus">-    }</span>
<a href="#l45.241"></a><span id="l45.241" class="difflineminus">-  }</span>
<a href="#l45.242"></a><span id="l45.242" class="difflineminus">-</span>
<a href="#l45.243"></a><span id="l45.243" class="difflineminus">-  // If not found return error.</span>
<a href="#l45.244"></a><span id="l45.244" class="difflineminus">-  if(!directory)</span>
<a href="#l45.245"></a><span id="l45.245" class="difflineminus">-    return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l45.246"></a><span id="l45.246" class="difflineminus">-</span>
<a href="#l45.247"></a><span id="l45.247" class="difflineminus">-  mDirectory = directory;</span>
<a href="#l45.248"></a><span id="l45.248" class="difflineminus">-  mFileName = fileName;</span>
<a href="#l45.249"></a><span id="l45.249" class="difflineminus">-  mUri = uri;</span>
<a href="#l45.250"></a><span id="l45.250" class="difflineminus">-  mDescription = description;</span>
<a href="#l45.251"></a><span id="l45.251" class="difflineminus">-  mDirType = dirType;</span>
<a href="#l45.252"></a><span id="l45.252" class="difflineminus">-  mPalmSyncTimeStamp = palmSyncTimeStamp;</span>
<a href="#l45.253"></a><span id="l45.253" class="difflineminus">-</span>
<a href="#l45.254"></a><span id="l45.254" class="difflineminus">-  return NS_OK;</span>
<a href="#l45.255"></a><span id="l45.255" class="difflineminus">-}</span>
<a href="#l45.256"></a><span id="l45.256" class="difflineminus">-</span>
<a href="#l45.257"></a><span id="l45.257" class="difflineminus">-nsresult nsAbPalmHotSync::Initialize()</span>
<a href="#l45.258"></a><span id="l45.258" class="difflineminus">-{</span>
<a href="#l45.259"></a><span id="l45.259" class="difflineminus">-  // Use GetChildNodes() call here.</span>
<a href="#l45.260"></a><span id="l45.260" class="difflineminus">-  if(mInitialized)</span>
<a href="#l45.261"></a><span id="l45.261" class="difflineminus">-      return NS_OK;</span>
<a href="#l45.262"></a><span id="l45.262" class="difflineminus">-</span>
<a href="#l45.263"></a><span id="l45.263" class="difflineminus">-  nsresult rv = GetABInterface();</span>
<a href="#l45.264"></a><span id="l45.264" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.265"></a><span id="l45.265" class="difflineminus">-  mInitialized = TRUE;</span>
<a href="#l45.266"></a><span id="l45.266" class="difflineminus">-    return NS_OK;</span>
<a href="#l45.267"></a><span id="l45.267" class="difflineminus">-}</span>
<a href="#l45.268"></a><span id="l45.268" class="difflineminus">-</span>
<a href="#l45.269"></a><span id="l45.269" class="difflineminus">-nsresult nsAbPalmHotSync::AddAllRecordsToAB(PRBool existingAB, PRInt32 aCount, lpnsABCOMCardStruct aPalmRecords)</span>
<a href="#l45.270"></a><span id="l45.270" class="difflineminus">-{</span>
<a href="#l45.271"></a><span id="l45.271" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aPalmRecords);</span>
<a href="#l45.272"></a><span id="l45.272" class="difflineminus">-    nsresult rv;</span>
<a href="#l45.273"></a><span id="l45.273" class="difflineminus">-    // Create the new AB dir before adding cards/records.</span>
<a href="#l45.274"></a><span id="l45.274" class="difflineminus">-    if (existingAB)</span>
<a href="#l45.275"></a><span id="l45.275" class="difflineminus">-    {</span>
<a href="#l45.276"></a><span id="l45.276" class="difflineminus">-      rv = Initialize();  </span>
<a href="#l45.277"></a><span id="l45.277" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv); </span>
<a href="#l45.278"></a><span id="l45.278" class="difflineminus">-      rv = OpenABDBForHotSync(PR_FALSE);</span>
<a href="#l45.279"></a><span id="l45.279" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.280"></a><span id="l45.280" class="difflineminus">-      // lets try deleting the db out from under ourselves. </span>
<a href="#l45.281"></a><span id="l45.281" class="difflineminus">-      nsCOMPtr&lt;nsIFile&gt; abFile;</span>
<a href="#l45.282"></a><span id="l45.282" class="difflineminus">-      rv = mABDB-&gt;GetDbPath(getter_AddRefs(abFile));</span>
<a href="#l45.283"></a><span id="l45.283" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.284"></a><span id="l45.284" class="difflineminus">-      mABDB-&gt;ForceClosed();</span>
<a href="#l45.285"></a><span id="l45.285" class="difflineminus">-      mDBOpen = PR_FALSE;</span>
<a href="#l45.286"></a><span id="l45.286" class="difflineminus">-      mABDB = nsnull;</span>
<a href="#l45.287"></a><span id="l45.287" class="difflineminus">-      abFile-&gt;Remove(PR_FALSE);</span>
<a href="#l45.288"></a><span id="l45.288" class="difflineminus">-    }</span>
<a href="#l45.289"></a><span id="l45.289" class="difflineminus">-    else</span>
<a href="#l45.290"></a><span id="l45.290" class="difflineminus">-    {</span>
<a href="#l45.291"></a><span id="l45.291" class="difflineminus">-      nsresult rv = NewAB(mAbName);</span>
<a href="#l45.292"></a><span id="l45.292" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.293"></a><span id="l45.293" class="difflineminus">-</span>
<a href="#l45.294"></a><span id="l45.294" class="difflineminus">-      rv = Initialize(); // Find the new AB and and init some vars (set mDirectory etc).</span>
<a href="#l45.295"></a><span id="l45.295" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.296"></a><span id="l45.296" class="difflineminus">-    }</span>
<a href="#l45.297"></a><span id="l45.297" class="difflineminus">-</span>
<a href="#l45.298"></a><span id="l45.298" class="difflineminus">-    // open the Moz AB database</span>
<a href="#l45.299"></a><span id="l45.299" class="difflineminus">-    rv = OpenABDBForHotSync(PR_TRUE);</span>
<a href="#l45.300"></a><span id="l45.300" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.301"></a><span id="l45.301" class="difflineminus">-    // we are just storing the pointer array here not record arrays</span>
<a href="#l45.302"></a><span id="l45.302" class="difflineminus">-    for (PRInt32 i=0; i &lt; aCount; i++)</span>
<a href="#l45.303"></a><span id="l45.303" class="difflineminus">-        mPalmRecords.AppendElement(&amp;aPalmRecords[i]);</span>
<a href="#l45.304"></a><span id="l45.304" class="difflineminus">-</span>
<a href="#l45.305"></a><span id="l45.305" class="difflineminus">-    // new DB here so no need to backup</span>
<a href="#l45.306"></a><span id="l45.306" class="difflineminus">-    rv = UpdateMozABWithPalmRecords();</span>
<a href="#l45.307"></a><span id="l45.307" class="difflineminus">- </span>
<a href="#l45.308"></a><span id="l45.308" class="difflineminus">-    rv = mABDB-&gt;Close(NS_SUCCEEDED(rv));</span>
<a href="#l45.309"></a><span id="l45.309" class="difflineminus">-</span>
<a href="#l45.310"></a><span id="l45.310" class="difflineminus">-    if(NS_SUCCEEDED(rv)) {</span>
<a href="#l45.311"></a><span id="l45.311" class="difflineminus">-        mDBOpen = PR_FALSE;</span>
<a href="#l45.312"></a><span id="l45.312" class="difflineminus">-        PRUint32 modTimeInSec;</span>
<a href="#l45.313"></a><span id="l45.313" class="difflineminus">-        PRTime2Seconds(PR_Now(), &amp;modTimeInSec);</span>
<a href="#l45.314"></a><span id="l45.314" class="difflineminus">-        rv = UpdateABInfo(modTimeInSec, mPalmCategoryIndex);</span>
<a href="#l45.315"></a><span id="l45.315" class="difflineminus">-    }</span>
<a href="#l45.316"></a><span id="l45.316" class="difflineminus">-    else { // get back the previous file</span>
<a href="#l45.317"></a><span id="l45.317" class="difflineminus">-        rv = mABDB-&gt;ForceClosed();</span>
<a href="#l45.318"></a><span id="l45.318" class="difflineminus">-        if(NS_SUCCEEDED(rv)) {</span>
<a href="#l45.319"></a><span id="l45.319" class="difflineminus">-            nsCAutoString leafName;</span>
<a href="#l45.320"></a><span id="l45.320" class="difflineminus">-            mABFile-&gt;GetNativeLeafName(leafName);</span>
<a href="#l45.321"></a><span id="l45.321" class="difflineminus">-            PRBool bExists=PR_FALSE;</span>
<a href="#l45.322"></a><span id="l45.322" class="difflineminus">-            mPreviousABFile-&gt;Exists(&amp;bExists);</span>
<a href="#l45.323"></a><span id="l45.323" class="difflineminus">-            if(bExists) {</span>
<a href="#l45.324"></a><span id="l45.324" class="difflineminus">-                nsCOMPtr&lt;nsIFile&gt; parent;</span>
<a href="#l45.325"></a><span id="l45.325" class="difflineminus">-                rv = mABFile-&gt;GetParent(getter_AddRefs(parent));</span>
<a href="#l45.326"></a><span id="l45.326" class="difflineminus">-                if (NS_SUCCEEDED(rv)) {</span>
<a href="#l45.327"></a><span id="l45.327" class="difflineminus">-                    mABFile-&gt;Remove(PR_FALSE);</span>
<a href="#l45.328"></a><span id="l45.328" class="difflineminus">-                    mPreviousABFile-&gt;CopyToNative(parent, leafName);</span>
<a href="#l45.329"></a><span id="l45.329" class="difflineminus">-                }</span>
<a href="#l45.330"></a><span id="l45.330" class="difflineminus">-            }</span>
<a href="#l45.331"></a><span id="l45.331" class="difflineminus">-            mDBOpen = PR_FALSE;</span>
<a href="#l45.332"></a><span id="l45.332" class="difflineminus">-        }</span>
<a href="#l45.333"></a><span id="l45.333" class="difflineminus">-    }</span>
<a href="#l45.334"></a><span id="l45.334" class="difflineminus">-</span>
<a href="#l45.335"></a><span id="l45.335" class="difflineminus">-    return rv;</span>
<a href="#l45.336"></a><span id="l45.336" class="difflineminus">-}</span>
<a href="#l45.337"></a><span id="l45.337" class="difflineminus">-</span>
<a href="#l45.338"></a><span id="l45.338" class="difflineminus">-nsresult nsAbPalmHotSync::GetAllCards(PRInt32 * aCount, lpnsABCOMCardStruct * aCardList)</span>
<a href="#l45.339"></a><span id="l45.339" class="difflineminus">-{</span>
<a href="#l45.340"></a><span id="l45.340" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aCount);</span>
<a href="#l45.341"></a><span id="l45.341" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aCardList);</span>
<a href="#l45.342"></a><span id="l45.342" class="difflineminus">-</span>
<a href="#l45.343"></a><span id="l45.343" class="difflineminus">-    if(!mInitialized) </span>
<a href="#l45.344"></a><span id="l45.344" class="difflineminus">-        return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l45.345"></a><span id="l45.345" class="difflineminus">-</span>
<a href="#l45.346"></a><span id="l45.346" class="difflineminus">-    // open the Moz AB database</span>
<a href="#l45.347"></a><span id="l45.347" class="difflineminus">-    nsresult rv = OpenABDBForHotSync(PR_FALSE); </span>
<a href="#l45.348"></a><span id="l45.348" class="difflineminus">-    if(NS_FAILED(rv))</span>
<a href="#l45.349"></a><span id="l45.349" class="difflineminus">-        return rv;</span>
<a href="#l45.350"></a><span id="l45.350" class="difflineminus">-</span>
<a href="#l45.351"></a><span id="l45.351" class="difflineminus">-    // create the list to be sent back to Palm</span>
<a href="#l45.352"></a><span id="l45.352" class="difflineminus">-    mABDB-&gt;GetCardCount(&amp;mTotalCardCount);</span>
<a href="#l45.353"></a><span id="l45.353" class="difflineminus">-    *aCount = mTotalCardCount;</span>
<a href="#l45.354"></a><span id="l45.354" class="difflineminus">-    if(!mTotalCardCount) {</span>
<a href="#l45.355"></a><span id="l45.355" class="difflineminus">-        mABDB-&gt;Close(PR_FALSE);</span>
<a href="#l45.356"></a><span id="l45.356" class="difflineminus">-        return NS_OK;</span>
<a href="#l45.357"></a><span id="l45.357" class="difflineminus">-    }</span>
<a href="#l45.358"></a><span id="l45.358" class="difflineminus">-</span>
<a href="#l45.359"></a><span id="l45.359" class="difflineminus">-    mCardListForPalm = (lpnsABCOMCardStruct) CoTaskMemAlloc(sizeof(nsABCOMCardStruct) * mTotalCardCount);</span>
<a href="#l45.360"></a><span id="l45.360" class="difflineminus">-    if(!mCardListForPalm) {</span>
<a href="#l45.361"></a><span id="l45.361" class="difflineminus">-        mABDB-&gt;Close(PR_FALSE);</span>
<a href="#l45.362"></a><span id="l45.362" class="difflineminus">-        return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l45.363"></a><span id="l45.363" class="difflineminus">-    }</span>
<a href="#l45.364"></a><span id="l45.364" class="difflineminus">-</span>
<a href="#l45.365"></a><span id="l45.365" class="difflineminus">-    nsCOMPtr&lt;nsISimpleEnumerator&gt; cardsEnumerator;</span>
<a href="#l45.366"></a><span id="l45.366" class="difflineminus">-    rv = mABDB-&gt;EnumerateCards(mDirectory, getter_AddRefs(cardsEnumerator));</span>
<a href="#l45.367"></a><span id="l45.367" class="difflineminus">-    if (NS_FAILED(rv) || !cardsEnumerator) {</span>
<a href="#l45.368"></a><span id="l45.368" class="difflineminus">-        mABDB-&gt;Close(PR_FALSE);</span>
<a href="#l45.369"></a><span id="l45.369" class="difflineminus">-        return rv;</span>
<a href="#l45.370"></a><span id="l45.370" class="difflineminus">-    }</span>
<a href="#l45.371"></a><span id="l45.371" class="difflineminus">-</span>
<a href="#l45.372"></a><span id="l45.372" class="difflineminus">-    nsCOMPtr&lt;nsISupports&gt; item;</span>
<a href="#l45.373"></a><span id="l45.373" class="difflineminus">-    nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l45.374"></a><span id="l45.374" class="difflineminus">-    PRBool more;</span>
<a href="#l45.375"></a><span id="l45.375" class="difflineminus">-    while (NS_SUCCEEDED(cardsEnumerator-&gt;HasMoreElements(&amp;more)) &amp;&amp; more) {</span>
<a href="#l45.376"></a><span id="l45.376" class="difflineminus">-        rv = cardsEnumerator-&gt;GetNext(getter_AddRefs(item));</span>
<a href="#l45.377"></a><span id="l45.377" class="difflineminus">-        if (NS_FAILED(rv)) </span>
<a href="#l45.378"></a><span id="l45.378" class="difflineminus">-            continue;</span>
<a href="#l45.379"></a><span id="l45.379" class="difflineminus">-</span>
<a href="#l45.380"></a><span id="l45.380" class="difflineminus">-        card = do_QueryInterface(item, &amp;rv);</span>
<a href="#l45.381"></a><span id="l45.381" class="difflineminus">-        if (NS_FAILED(rv)) // can this be anything but a card?</span>
<a href="#l45.382"></a><span id="l45.382" class="difflineminus">-            continue;</span>
<a href="#l45.383"></a><span id="l45.383" class="difflineminus">-</span>
<a href="#l45.384"></a><span id="l45.384" class="difflineminus">-        PRBool isMailingList=PR_FALSE;</span>
<a href="#l45.385"></a><span id="l45.385" class="difflineminus">-        rv = card-&gt;GetIsMailList(&amp;isMailingList);</span>
<a href="#l45.386"></a><span id="l45.386" class="difflineminus">-        if (NS_FAILED(rv) || isMailingList) // if mailing list go to cards</span>
<a href="#l45.387"></a><span id="l45.387" class="difflineminus">-            continue;</span>
<a href="#l45.388"></a><span id="l45.388" class="difflineminus">-</span>
<a href="#l45.389"></a><span id="l45.389" class="difflineminus">-        nsAbIPCCard  ipcCard(card);</span>
<a href="#l45.390"></a><span id="l45.390" class="difflineminus">-        ipcCard.SetStatus(ATTR_NEW);</span>
<a href="#l45.391"></a><span id="l45.391" class="difflineminus">-</span>
<a href="#l45.392"></a><span id="l45.392" class="difflineminus">-        rv = AddToListForPalm(ipcCard);</span>
<a href="#l45.393"></a><span id="l45.393" class="difflineminus">-        if(NS_FAILED(rv))</span>
<a href="#l45.394"></a><span id="l45.394" class="difflineminus">-            break;</span>
<a href="#l45.395"></a><span id="l45.395" class="difflineminus">-</span>
<a href="#l45.396"></a><span id="l45.396" class="difflineminus">-        mNewCardsArray-&gt;AppendElement(card);</span>
<a href="#l45.397"></a><span id="l45.397" class="difflineminus">-        mNewCardCount++;</span>
<a href="#l45.398"></a><span id="l45.398" class="difflineminus">-    }</span>
<a href="#l45.399"></a><span id="l45.399" class="difflineminus">-</span>
<a href="#l45.400"></a><span id="l45.400" class="difflineminus">-</span>
<a href="#l45.401"></a><span id="l45.401" class="difflineminus">-    *aCount = mCardForPalmCount;</span>
<a href="#l45.402"></a><span id="l45.402" class="difflineminus">-    *aCardList = mCardListForPalm;</span>
<a href="#l45.403"></a><span id="l45.403" class="difflineminus">-</span>
<a href="#l45.404"></a><span id="l45.404" class="difflineminus">-    // Don't close the DB yet, it will be closed when Done is called</span>
<a href="#l45.405"></a><span id="l45.405" class="difflineminus">-</span>
<a href="#l45.406"></a><span id="l45.406" class="difflineminus">-    return NS_OK;</span>
<a href="#l45.407"></a><span id="l45.407" class="difflineminus">-}</span>
<a href="#l45.408"></a><span id="l45.408" class="difflineminus">-</span>
<a href="#l45.409"></a><span id="l45.409" class="difflineminus">-nsresult nsAbPalmHotSync::DoSyncAndGetUpdatedCards(PRInt32 aPalmCount, lpnsABCOMCardStruct aPalmRecords, </span>
<a href="#l45.410"></a><span id="l45.410" class="difflineminus">-                                                    PRInt32 * aMozCount, lpnsABCOMCardStruct * aMozCards)</span>
<a href="#l45.411"></a><span id="l45.411" class="difflineminus">-{</span>
<a href="#l45.412"></a><span id="l45.412" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aPalmRecords);</span>
<a href="#l45.413"></a><span id="l45.413" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aMozCount);</span>
<a href="#l45.414"></a><span id="l45.414" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aMozCards);</span>
<a href="#l45.415"></a><span id="l45.415" class="difflineminus">-</span>
<a href="#l45.416"></a><span id="l45.416" class="difflineminus">-    if(!mInitialized) </span>
<a href="#l45.417"></a><span id="l45.417" class="difflineminus">-        return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l45.418"></a><span id="l45.418" class="difflineminus">-</span>
<a href="#l45.419"></a><span id="l45.419" class="difflineminus">-    // open the Moz AB database</span>
<a href="#l45.420"></a><span id="l45.420" class="difflineminus">-    nsresult rv = OpenABDBForHotSync(PR_FALSE); </span>
<a href="#l45.421"></a><span id="l45.421" class="difflineminus">-    if(NS_FAILED(rv))</span>
<a href="#l45.422"></a><span id="l45.422" class="difflineminus">-        return rv;</span>
<a href="#l45.423"></a><span id="l45.423" class="difflineminus">-</span>
<a href="#l45.424"></a><span id="l45.424" class="difflineminus">-    // we are just storing the pointer array here, not record arrays</span>
<a href="#l45.425"></a><span id="l45.425" class="difflineminus">-    for (PRInt32 i=0; i &lt; aPalmCount; i++) </span>
<a href="#l45.426"></a><span id="l45.426" class="difflineminus">-    {</span>
<a href="#l45.427"></a><span id="l45.427" class="difflineminus">-        mPalmRecords.AppendElement(&amp;aPalmRecords[i]);</span>
<a href="#l45.428"></a><span id="l45.428" class="difflineminus">-#ifdef DEBUG_bienvenu        </span>
<a href="#l45.429"></a><span id="l45.429" class="difflineminus">-        DisplayTestData(&amp;aPalmRecords[i],PR_FALSE);</span>
<a href="#l45.430"></a><span id="l45.430" class="difflineminus">-#endif</span>
<a href="#l45.431"></a><span id="l45.431" class="difflineminus">-    }</span>
<a href="#l45.432"></a><span id="l45.432" class="difflineminus">-</span>
<a href="#l45.433"></a><span id="l45.433" class="difflineminus">-    // create the list to be sent back to Palm</span>
<a href="#l45.434"></a><span id="l45.434" class="difflineminus">-    mABDB-&gt;GetCardCount(&amp;mTotalCardCount);</span>
<a href="#l45.435"></a><span id="l45.435" class="difflineminus">-    PRUint32  deletedCardCount=0;</span>
<a href="#l45.436"></a><span id="l45.436" class="difflineminus">-    mABDB-&gt;GetDeletedCardCount(&amp;deletedCardCount);</span>
<a href="#l45.437"></a><span id="l45.437" class="difflineminus">-    mTotalCardCount += deletedCardCount;</span>
<a href="#l45.438"></a><span id="l45.438" class="difflineminus">-    if(mTotalCardCount) </span>
<a href="#l45.439"></a><span id="l45.439" class="difflineminus">-    {</span>
<a href="#l45.440"></a><span id="l45.440" class="difflineminus">-        mCardListForPalm = (lpnsABCOMCardStruct) CoTaskMemAlloc(sizeof(nsABCOMCardStruct) * mTotalCardCount);</span>
<a href="#l45.441"></a><span id="l45.441" class="difflineminus">-        if(!mCardListForPalm) </span>
<a href="#l45.442"></a><span id="l45.442" class="difflineminus">-        {</span>
<a href="#l45.443"></a><span id="l45.443" class="difflineminus">-            mABDB-&gt;Close(PR_FALSE);</span>
<a href="#l45.444"></a><span id="l45.444" class="difflineminus">-            return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l45.445"></a><span id="l45.445" class="difflineminus">-        }</span>
<a href="#l45.446"></a><span id="l45.446" class="difflineminus">-    }</span>
<a href="#l45.447"></a><span id="l45.447" class="difflineminus">-</span>
<a href="#l45.448"></a><span id="l45.448" class="difflineminus">-    // initialize the flag for any new Moz cards to be added to Palm</span>
<a href="#l45.449"></a><span id="l45.449" class="difflineminus">-    mIsNewCardForPalm = PR_FALSE;</span>
<a href="#l45.450"></a><span id="l45.450" class="difflineminus">-</span>
<a href="#l45.451"></a><span id="l45.451" class="difflineminus">-    // deal with new / modified or first time sync</span>
<a href="#l45.452"></a><span id="l45.452" class="difflineminus">-    rv = LoadNewModifiedCardsSinceLastSync();</span>
<a href="#l45.453"></a><span id="l45.453" class="difflineminus">-    if(NS_SUCCEEDED(rv))</span>
<a href="#l45.454"></a><span id="l45.454" class="difflineminus">-        // deal with deleted</span>
<a href="#l45.455"></a><span id="l45.455" class="difflineminus">-        rv = LoadDeletedCardsSinceLastSync();</span>
<a href="#l45.456"></a><span id="l45.456" class="difflineminus">-    if(NS_SUCCEEDED(rv))</span>
<a href="#l45.457"></a><span id="l45.457" class="difflineminus">-        // first backup the existing DB as Previous</span>
<a href="#l45.458"></a><span id="l45.458" class="difflineminus">-        rv = KeepCurrentStateAsPrevious();</span>
<a href="#l45.459"></a><span id="l45.459" class="difflineminus">-    if(NS_SUCCEEDED(rv))</span>
<a href="#l45.460"></a><span id="l45.460" class="difflineminus">-        // update local DB for sync</span>
<a href="#l45.461"></a><span id="l45.461" class="difflineminus">-        rv = UpdateMozABWithPalmRecords();</span>
<a href="#l45.462"></a><span id="l45.462" class="difflineminus">-</span>
<a href="#l45.463"></a><span id="l45.463" class="difflineminus">-    // if there are no new cards to be added in Palm close DB</span>
<a href="#l45.464"></a><span id="l45.464" class="difflineminus">-    // else wait for Done to be called.</span>
<a href="#l45.465"></a><span id="l45.465" class="difflineminus">-    if(!mIsNewCardForPalm) </span>
<a href="#l45.466"></a><span id="l45.466" class="difflineminus">-    {</span>
<a href="#l45.467"></a><span id="l45.467" class="difflineminus">-        rv = mABDB-&gt;Close(NS_SUCCEEDED(rv) &amp;&amp; mPalmRecords.Count());</span>
<a href="#l45.468"></a><span id="l45.468" class="difflineminus">-</span>
<a href="#l45.469"></a><span id="l45.469" class="difflineminus">-        if(NS_SUCCEEDED(rv)) </span>
<a href="#l45.470"></a><span id="l45.470" class="difflineminus">-        {</span>
<a href="#l45.471"></a><span id="l45.471" class="difflineminus">-            mDBOpen = PR_FALSE;</span>
<a href="#l45.472"></a><span id="l45.472" class="difflineminus">-            PRUint32 modTimeInSec;</span>
<a href="#l45.473"></a><span id="l45.473" class="difflineminus">-            PRTime2Seconds(PR_Now(), &amp;modTimeInSec);</span>
<a href="#l45.474"></a><span id="l45.474" class="difflineminus">-            rv = UpdateABInfo(modTimeInSec, mPalmCategoryIndex);</span>
<a href="#l45.475"></a><span id="l45.475" class="difflineminus">-        }</span>
<a href="#l45.476"></a><span id="l45.476" class="difflineminus">-        else</span>
<a href="#l45.477"></a><span id="l45.477" class="difflineminus">-        { // get back the previous file</span>
<a href="#l45.478"></a><span id="l45.478" class="difflineminus">-            rv = mABDB-&gt;ForceClosed();</span>
<a href="#l45.479"></a><span id="l45.479" class="difflineminus">-            if(NS_SUCCEEDED(rv)) </span>
<a href="#l45.480"></a><span id="l45.480" class="difflineminus">-            {</span>
<a href="#l45.481"></a><span id="l45.481" class="difflineminus">-                nsCAutoString leafName;</span>
<a href="#l45.482"></a><span id="l45.482" class="difflineminus">-                mABFile-&gt;GetNativeLeafName(leafName);</span>
<a href="#l45.483"></a><span id="l45.483" class="difflineminus">-                PRBool bExists=PR_FALSE;</span>
<a href="#l45.484"></a><span id="l45.484" class="difflineminus">-                mPreviousABFile-&gt;Exists(&amp;bExists);</span>
<a href="#l45.485"></a><span id="l45.485" class="difflineminus">-                if(bExists) </span>
<a href="#l45.486"></a><span id="l45.486" class="difflineminus">-                {</span>
<a href="#l45.487"></a><span id="l45.487" class="difflineminus">-                    nsCOMPtr&lt;nsIFile&gt; parent;</span>
<a href="#l45.488"></a><span id="l45.488" class="difflineminus">-                    rv = mABFile-&gt;GetParent(getter_AddRefs(parent));</span>
<a href="#l45.489"></a><span id="l45.489" class="difflineminus">-                    if (NS_SUCCEEDED(rv)) </span>
<a href="#l45.490"></a><span id="l45.490" class="difflineminus">-                    {</span>
<a href="#l45.491"></a><span id="l45.491" class="difflineminus">-                        mABFile-&gt;Remove(PR_FALSE);</span>
<a href="#l45.492"></a><span id="l45.492" class="difflineminus">-                        mPreviousABFile-&gt;CopyToNative(parent, leafName);</span>
<a href="#l45.493"></a><span id="l45.493" class="difflineminus">-                    }</span>
<a href="#l45.494"></a><span id="l45.494" class="difflineminus">-                }</span>
<a href="#l45.495"></a><span id="l45.495" class="difflineminus">-                mDBOpen = PR_FALSE;</span>
<a href="#l45.496"></a><span id="l45.496" class="difflineminus">-            }</span>
<a href="#l45.497"></a><span id="l45.497" class="difflineminus">-        }</span>
<a href="#l45.498"></a><span id="l45.498" class="difflineminus">-    }</span>
<a href="#l45.499"></a><span id="l45.499" class="difflineminus">-</span>
<a href="#l45.500"></a><span id="l45.500" class="difflineminus">-    *aMozCount = mCardForPalmCount;</span>
<a href="#l45.501"></a><span id="l45.501" class="difflineminus">-    *aMozCards = mCardListForPalm;</span>
<a href="#l45.502"></a><span id="l45.502" class="difflineminus">-</span>
<a href="#l45.503"></a><span id="l45.503" class="difflineminus">-    return rv;</span>
<a href="#l45.504"></a><span id="l45.504" class="difflineminus">-}</span>
<a href="#l45.505"></a><span id="l45.505" class="difflineminus">-</span>
<a href="#l45.506"></a><span id="l45.506" class="difflineminus">-// this takes care of the cases when the state is deleted</span>
<a href="#l45.507"></a><span id="l45.507" class="difflineminus">-nsresult nsAbPalmHotSync::LoadDeletedCardsSinceLastSync()</span>
<a href="#l45.508"></a><span id="l45.508" class="difflineminus">-{</span>
<a href="#l45.509"></a><span id="l45.509" class="difflineminus">-    if (!mDBOpen || !mABDB || !mInitialized) </span>
<a href="#l45.510"></a><span id="l45.510" class="difflineminus">-        return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l45.511"></a><span id="l45.511" class="difflineminus">-    </span>
<a href="#l45.512"></a><span id="l45.512" class="difflineminus">-    nsCOMPtr&lt;nsIArray&gt; deletedCardArray;</span>
<a href="#l45.513"></a><span id="l45.513" class="difflineminus">-    nsresult rv = mABDB-&gt;GetDeletedCardList(getter_AddRefs(deletedCardArray));</span>
<a href="#l45.514"></a><span id="l45.514" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l45.515"></a><span id="l45.515" class="difflineminus">-        return rv;</span>
<a href="#l45.516"></a><span id="l45.516" class="difflineminus">-</span>
<a href="#l45.517"></a><span id="l45.517" class="difflineminus">-    PRUint32 deletedCardCount;</span>
<a href="#l45.518"></a><span id="l45.518" class="difflineminus">-    rv = deletedCardArray-&gt;GetLength(&amp;deletedCardCount);</span>
<a href="#l45.519"></a><span id="l45.519" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l45.520"></a><span id="l45.520" class="difflineminus">-        return rv;</span>
<a href="#l45.521"></a><span id="l45.521" class="difflineminus">-</span>
<a href="#l45.522"></a><span id="l45.522" class="difflineminus">-    for(PRUint32 i=0; i &lt; deletedCardCount; i++) </span>
<a href="#l45.523"></a><span id="l45.523" class="difflineminus">-    {</span>
<a href="#l45.524"></a><span id="l45.524" class="difflineminus">-        nsCOMPtr&lt;nsIAbCard&gt; card(do_QueryElementAt(deletedCardArray, i, &amp;rv));</span>
<a href="#l45.525"></a><span id="l45.525" class="difflineminus">-        if (NS_FAILED(rv)) // can this be anything but a card?</span>
<a href="#l45.526"></a><span id="l45.526" class="difflineminus">-            continue;</span>
<a href="#l45.527"></a><span id="l45.527" class="difflineminus">-        </span>
<a href="#l45.528"></a><span id="l45.528" class="difflineminus">-        PRBool isMailingList=PR_FALSE;</span>
<a href="#l45.529"></a><span id="l45.529" class="difflineminus">-        rv = card-&gt;GetIsMailList(&amp;isMailingList);</span>
<a href="#l45.530"></a><span id="l45.530" class="difflineminus">-        if (NS_FAILED(rv) || isMailingList)</span>
<a href="#l45.531"></a><span id="l45.531" class="difflineminus">-            continue;</span>
<a href="#l45.532"></a><span id="l45.532" class="difflineminus">-</span>
<a href="#l45.533"></a><span id="l45.533" class="difflineminus">-        PRUint32 lastModifiedDate = 0;</span>
<a href="#l45.534"></a><span id="l45.534" class="difflineminus">-        rv = card-&gt;GetPropertyAsUint32(kLastModifiedDateProperty, &amp;lastModifiedDate);</span>
<a href="#l45.535"></a><span id="l45.535" class="difflineminus">-        if (NS_FAILED(rv) || !lastModifiedDate)</span>
<a href="#l45.536"></a><span id="l45.536" class="difflineminus">-            continue;</span>
<a href="#l45.537"></a><span id="l45.537" class="difflineminus">-</span>
<a href="#l45.538"></a><span id="l45.538" class="difflineminus">-        if(lastModifiedDate &gt; mPalmSyncTimeStamp)</span>
<a href="#l45.539"></a><span id="l45.539" class="difflineminus">-        {</span>
<a href="#l45.540"></a><span id="l45.540" class="difflineminus">-            nsAbIPCCard  ipcCard(card);</span>
<a href="#l45.541"></a><span id="l45.541" class="difflineminus">-            // check in the list of Palm records</span>
<a href="#l45.542"></a><span id="l45.542" class="difflineminus">-            for(PRInt32 i=mPalmRecords.Count()-1; i &gt;=0;  i--) </span>
<a href="#l45.543"></a><span id="l45.543" class="difflineminus">-            {</span>
<a href="#l45.544"></a><span id="l45.544" class="difflineminus">-                nsABCOMCardStruct * palmRec = (nsABCOMCardStruct *) mPalmRecords.ElementAt(i);</span>
<a href="#l45.545"></a><span id="l45.545" class="difflineminus">-                // if same record exists in palm list, donot delete it from Palm</span>
<a href="#l45.546"></a><span id="l45.546" class="difflineminus">-                if(ipcCard.Same(palmRec, mIsPalmDataUnicode))</span>
<a href="#l45.547"></a><span id="l45.547" class="difflineminus">-                    continue;</span>
<a href="#l45.548"></a><span id="l45.548" class="difflineminus">-            }</span>
<a href="#l45.549"></a><span id="l45.549" class="difflineminus">-            ipcCard.SetStatus(ATTR_DELETED);</span>
<a href="#l45.550"></a><span id="l45.550" class="difflineminus">-</span>
<a href="#l45.551"></a><span id="l45.551" class="difflineminus">-            rv = AddToListForPalm(ipcCard);</span>
<a href="#l45.552"></a><span id="l45.552" class="difflineminus">-            if(NS_FAILED(rv))</span>
<a href="#l45.553"></a><span id="l45.553" class="difflineminus">-                break;</span>
<a href="#l45.554"></a><span id="l45.554" class="difflineminus">-        }</span>
<a href="#l45.555"></a><span id="l45.555" class="difflineminus">-    }</span>
<a href="#l45.556"></a><span id="l45.556" class="difflineminus">-    return rv;</span>
<a href="#l45.557"></a><span id="l45.557" class="difflineminus">-}</span>
<a href="#l45.558"></a><span id="l45.558" class="difflineminus">-</span>
<a href="#l45.559"></a><span id="l45.559" class="difflineminus">-</span>
<a href="#l45.560"></a><span id="l45.560" class="difflineminus">-nsresult nsAbPalmHotSync::LoadNewModifiedCardsSinceLastSync()</span>
<a href="#l45.561"></a><span id="l45.561" class="difflineminus">-{</span>
<a href="#l45.562"></a><span id="l45.562" class="difflineminus">-    if(!mDBOpen || !mABDB || !mInitialized) </span>
<a href="#l45.563"></a><span id="l45.563" class="difflineminus">-        return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l45.564"></a><span id="l45.564" class="difflineminus">-</span>
<a href="#l45.565"></a><span id="l45.565" class="difflineminus">-    nsCOMPtr&lt;nsISimpleEnumerator&gt; cardsEnumerator;</span>
<a href="#l45.566"></a><span id="l45.566" class="difflineminus">-    nsresult rv = mABDB-&gt;EnumerateCards(mDirectory, getter_AddRefs(cardsEnumerator));</span>
<a href="#l45.567"></a><span id="l45.567" class="difflineminus">-    if (NS_FAILED(rv) || !cardsEnumerator) </span>
<a href="#l45.568"></a><span id="l45.568" class="difflineminus">-        return NS_ERROR_NOT_AVAILABLE; // no cards available</span>
<a href="#l45.569"></a><span id="l45.569" class="difflineminus">-</span>
<a href="#l45.570"></a><span id="l45.570" class="difflineminus">-    // create the list of cards to be sent to Palm</span>
<a href="#l45.571"></a><span id="l45.571" class="difflineminus">-    nsCOMPtr&lt;nsISupports&gt; item;</span>
<a href="#l45.572"></a><span id="l45.572" class="difflineminus">-    nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l45.573"></a><span id="l45.573" class="difflineminus">-    PRBool more;</span>
<a href="#l45.574"></a><span id="l45.574" class="difflineminus">-    while (NS_SUCCEEDED(cardsEnumerator-&gt;HasMoreElements(&amp;more)) &amp;&amp; more) </span>
<a href="#l45.575"></a><span id="l45.575" class="difflineminus">-    {</span>
<a href="#l45.576"></a><span id="l45.576" class="difflineminus">-        rv = cardsEnumerator-&gt;GetNext(getter_AddRefs(item));</span>
<a href="#l45.577"></a><span id="l45.577" class="difflineminus">-        if (NS_FAILED(rv)) </span>
<a href="#l45.578"></a><span id="l45.578" class="difflineminus">-            return rv;</span>
<a href="#l45.579"></a><span id="l45.579" class="difflineminus">-</span>
<a href="#l45.580"></a><span id="l45.580" class="difflineminus">-        card = do_QueryInterface(item, &amp;rv);</span>
<a href="#l45.581"></a><span id="l45.581" class="difflineminus">-        if (NS_FAILED(rv)) // can this be anything but a card?</span>
<a href="#l45.582"></a><span id="l45.582" class="difflineminus">-            continue;</span>
<a href="#l45.583"></a><span id="l45.583" class="difflineminus">-</span>
<a href="#l45.584"></a><span id="l45.584" class="difflineminus">-        PRBool isMailingList=PR_FALSE;</span>
<a href="#l45.585"></a><span id="l45.585" class="difflineminus">-        rv = card-&gt;GetIsMailList(&amp;isMailingList);</span>
<a href="#l45.586"></a><span id="l45.586" class="difflineminus">-        if (NS_FAILED(rv) || isMailingList) // if mailing list go to cards</span>
<a href="#l45.587"></a><span id="l45.587" class="difflineminus">-            continue;</span>
<a href="#l45.588"></a><span id="l45.588" class="difflineminus">-</span>
<a href="#l45.589"></a><span id="l45.589" class="difflineminus">-        PRUint32 lastModifiedDate = 0;</span>
<a href="#l45.590"></a><span id="l45.590" class="difflineminus">-        rv = card-&gt;GetPropertyAsUint32(kLastModifiedDateProperty, &amp;lastModifiedDate);</span>
<a href="#l45.591"></a><span id="l45.591" class="difflineminus">-        if (NS_FAILED(rv))</span>
<a href="#l45.592"></a><span id="l45.592" class="difflineminus">-            continue;</span>
<a href="#l45.593"></a><span id="l45.593" class="difflineminus">-</span>
<a href="#l45.594"></a><span id="l45.594" class="difflineminus">-        if(lastModifiedDate &gt; mPalmSyncTimeStamp  // take care of modified</span>
<a href="#l45.595"></a><span id="l45.595" class="difflineminus">-            || !lastModifiedDate || !mPalmSyncTimeStamp) </span>
<a href="#l45.596"></a><span id="l45.596" class="difflineminus">-        {  // take care of new or never before sync</span>
<a href="#l45.597"></a><span id="l45.597" class="difflineminus">-            </span>
<a href="#l45.598"></a><span id="l45.598" class="difflineminus">-            //create nsAbIPCCard and assign its status based on lastModifiedDate</span>
<a href="#l45.599"></a><span id="l45.599" class="difflineminus">-            nsAbIPCCard ipcCard(card);</span>
<a href="#l45.600"></a><span id="l45.600" class="difflineminus">-            ipcCard.AddRef(); // someone needs a reference to this, since we</span>
<a href="#l45.601"></a><span id="l45.601" class="difflineminus">-            // pass it around as an interface pointer</span>
<a href="#l45.602"></a><span id="l45.602" class="difflineminus">-            ipcCard.SetStatus((lastModifiedDate) ? ATTR_MODIFIED : ATTR_NEW);</span>
<a href="#l45.603"></a><span id="l45.603" class="difflineminus">-</span>
<a href="#l45.604"></a><span id="l45.604" class="difflineminus">-            // Check with the palm list (merging is done if required)</span>
<a href="#l45.605"></a><span id="l45.605" class="difflineminus">-            if (CardExistsInPalmList(&amp;ipcCard)) </span>
<a href="#l45.606"></a><span id="l45.606" class="difflineminus">-                continue;</span>
<a href="#l45.607"></a><span id="l45.607" class="difflineminus">-</span>
<a href="#l45.608"></a><span id="l45.608" class="difflineminus">-            rv = AddToListForPalm(ipcCard);</span>
<a href="#l45.609"></a><span id="l45.609" class="difflineminus">-            if(NS_FAILED(rv))</span>
<a href="#l45.610"></a><span id="l45.610" class="difflineminus">-                break;</span>
<a href="#l45.611"></a><span id="l45.611" class="difflineminus">-</span>
<a href="#l45.612"></a><span id="l45.612" class="difflineminus">-            if(ipcCard.GetStatus() == ATTR_NEW) </span>
<a href="#l45.613"></a><span id="l45.613" class="difflineminus">-            {</span>
<a href="#l45.614"></a><span id="l45.614" class="difflineminus">-                mNewCardsArray-&gt;AppendElement(card);</span>
<a href="#l45.615"></a><span id="l45.615" class="difflineminus">-                mNewCardCount++;</span>
<a href="#l45.616"></a><span id="l45.616" class="difflineminus">-                mIsNewCardForPalm = PR_TRUE;</span>
<a href="#l45.617"></a><span id="l45.617" class="difflineminus">-            }</span>
<a href="#l45.618"></a><span id="l45.618" class="difflineminus">-        }</span>
<a href="#l45.619"></a><span id="l45.619" class="difflineminus">-    }</span>
<a href="#l45.620"></a><span id="l45.620" class="difflineminus">-</span>
<a href="#l45.621"></a><span id="l45.621" class="difflineminus">-    return NS_OK;</span>
<a href="#l45.622"></a><span id="l45.622" class="difflineminus">-}</span>
<a href="#l45.623"></a><span id="l45.623" class="difflineminus">-</span>
<a href="#l45.624"></a><span id="l45.624" class="difflineminus">-</span>
<a href="#l45.625"></a><span id="l45.625" class="difflineminus">-// this take care of the all cases when the state is either modified or new</span>
<a href="#l45.626"></a><span id="l45.626" class="difflineminus">-PRBool nsAbPalmHotSync::CardExistsInPalmList(nsAbIPCCard  * aIPCCard)</span>
<a href="#l45.627"></a><span id="l45.627" class="difflineminus">-{</span>
<a href="#l45.628"></a><span id="l45.628" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aIPCCard);</span>
<a href="#l45.629"></a><span id="l45.629" class="difflineminus">-</span>
<a href="#l45.630"></a><span id="l45.630" class="difflineminus">-    if(!mInitialized) </span>
<a href="#l45.631"></a><span id="l45.631" class="difflineminus">-        return PR_FALSE;</span>
<a href="#l45.632"></a><span id="l45.632" class="difflineminus">-</span>
<a href="#l45.633"></a><span id="l45.633" class="difflineminus">-    PRBool exists = PR_FALSE;</span>
<a href="#l45.634"></a><span id="l45.634" class="difflineminus">-</span>
<a href="#l45.635"></a><span id="l45.635" class="difflineminus">-    for(PRInt32 i=mPalmRecords.Count()-1; i &gt;=0;  i--) </span>
<a href="#l45.636"></a><span id="l45.636" class="difflineminus">-    {</span>
<a href="#l45.637"></a><span id="l45.637" class="difflineminus">-        nsABCOMCardStruct * palmRec = (nsABCOMCardStruct *) mPalmRecords.ElementAt(i);</span>
<a href="#l45.638"></a><span id="l45.638" class="difflineminus">-        </span>
<a href="#l45.639"></a><span id="l45.639" class="difflineminus">-        // if same record is in palm list also</span>
<a href="#l45.640"></a><span id="l45.640" class="difflineminus">-        if(aIPCCard-&gt;Same(palmRec, mIsPalmDataUnicode)) </span>
<a href="#l45.641"></a><span id="l45.641" class="difflineminus">-        {</span>
<a href="#l45.642"></a><span id="l45.642" class="difflineminus">-            // if the state deleted on both sides no need to do anything</span>
<a href="#l45.643"></a><span id="l45.643" class="difflineminus">-            if ((palmRec-&gt;dwStatus &amp; ATTR_DELETED || palmRec-&gt;dwStatus &amp; ATTR_ARCHIVED) &amp;&amp;</span>
<a href="#l45.644"></a><span id="l45.644" class="difflineminus">-                (aIPCCard-&gt;GetStatus() == ATTR_DELETED)) </span>
<a href="#l45.645"></a><span id="l45.645" class="difflineminus">-            {</span>
<a href="#l45.646"></a><span id="l45.646" class="difflineminus">-                mPalmRecords.RemoveElementAt(i);</span>
<a href="#l45.647"></a><span id="l45.647" class="difflineminus">-                return PR_TRUE;</span>
<a href="#l45.648"></a><span id="l45.648" class="difflineminus">-            }</span>
<a href="#l45.649"></a><span id="l45.649" class="difflineminus">-            // if deleted on Palm and added or modified on Moz, don't delete on Moz</span>
<a href="#l45.650"></a><span id="l45.650" class="difflineminus">-            if ( (palmRec-&gt;dwStatus &amp; ATTR_DELETED || palmRec-&gt;dwStatus &amp; ATTR_ARCHIVED) &amp;&amp; </span>
<a href="#l45.651"></a><span id="l45.651" class="difflineminus">-                 ((aIPCCard-&gt;GetStatus() == ATTR_NEW) || (aIPCCard-&gt;GetStatus() == ATTR_MODIFIED)) ) </span>
<a href="#l45.652"></a><span id="l45.652" class="difflineminus">-            {</span>
<a href="#l45.653"></a><span id="l45.653" class="difflineminus">-                mPalmRecords.RemoveElementAt(i);</span>
<a href="#l45.654"></a><span id="l45.654" class="difflineminus">-                return PR_FALSE;</span>
<a href="#l45.655"></a><span id="l45.655" class="difflineminus">-            }</span>
<a href="#l45.656"></a><span id="l45.656" class="difflineminus">-</span>
<a href="#l45.657"></a><span id="l45.657" class="difflineminus">-            // set the palm record ID in the card if not already set</span>
<a href="#l45.658"></a><span id="l45.658" class="difflineminus">-            if(!aIPCCard-&gt;GetRecordId()) </span>
<a href="#l45.659"></a><span id="l45.659" class="difflineminus">-            {</span>
<a href="#l45.660"></a><span id="l45.660" class="difflineminus">-                ConvertAssignPalmIDAttrib(palmRec-&gt;dwRecordId, aIPCCard);</span>
<a href="#l45.661"></a><span id="l45.661" class="difflineminus">-                mABDB-&gt;EditCard(aIPCCard, PR_FALSE, nsnull);</span>
<a href="#l45.662"></a><span id="l45.662" class="difflineminus">-                aIPCCard-&gt;SetRecordId(palmRec-&gt;dwRecordId);</span>
<a href="#l45.663"></a><span id="l45.663" class="difflineminus">-            }</span>
<a href="#l45.664"></a><span id="l45.664" class="difflineminus">-</span>
<a href="#l45.665"></a><span id="l45.665" class="difflineminus">-            // if deleted in Moz and added or modified on Palm, don't delete on Palm</span>
<a href="#l45.666"></a><span id="l45.666" class="difflineminus">-            if ( (aIPCCard-&gt;GetStatus() == ATTR_DELETED) &amp;&amp; </span>
<a href="#l45.667"></a><span id="l45.667" class="difflineminus">-                 ((palmRec-&gt;dwStatus == ATTR_NEW) </span>
<a href="#l45.668"></a><span id="l45.668" class="difflineminus">-                   ||(palmRec-&gt;dwStatus == ATTR_MODIFIED)) ) </span>
<a href="#l45.669"></a><span id="l45.669" class="difflineminus">-                return PR_TRUE;</span>
<a href="#l45.670"></a><span id="l45.670" class="difflineminus">-</span>
<a href="#l45.671"></a><span id="l45.671" class="difflineminus">-            // for rest of the cases with state as either mod or new:</span>
<a href="#l45.672"></a><span id="l45.672" class="difflineminus">-            nsStringArray diffAttrs;</span>
<a href="#l45.673"></a><span id="l45.673" class="difflineminus">-            PRBool fieldsMatch = PR_FALSE;</span>
<a href="#l45.674"></a><span id="l45.674" class="difflineminus">-            if(mIsPalmDataUnicode)</span>
<a href="#l45.675"></a><span id="l45.675" class="difflineminus">-                fieldsMatch = aIPCCard-&gt;Equals(palmRec, diffAttrs);</span>
<a href="#l45.676"></a><span id="l45.676" class="difflineminus">-            else</span>
<a href="#l45.677"></a><span id="l45.677" class="difflineminus">-                fieldsMatch = aIPCCard-&gt;EqualsAfterUnicodeConversion(palmRec, diffAttrs);</span>
<a href="#l45.678"></a><span id="l45.678" class="difflineminus">-</span>
<a href="#l45.679"></a><span id="l45.679" class="difflineminus">-            // if fields match, no need to keep it for sync</span>
<a href="#l45.680"></a><span id="l45.680" class="difflineminus">-            if(fieldsMatch) </span>
<a href="#l45.681"></a><span id="l45.681" class="difflineminus">-            {</span>
<a href="#l45.682"></a><span id="l45.682" class="difflineminus">-                exists = PR_TRUE;</span>
<a href="#l45.683"></a><span id="l45.683" class="difflineminus">-                // since the fields match, no need to update Moz AB with palm record</span>
<a href="#l45.684"></a><span id="l45.684" class="difflineminus">-                mPalmRecords.RemoveElementAt(i); </span>
<a href="#l45.685"></a><span id="l45.685" class="difflineminus">-            }</span>
<a href="#l45.686"></a><span id="l45.686" class="difflineminus">-            else </span>
<a href="#l45.687"></a><span id="l45.687" class="difflineminus">-            {</span>
<a href="#l45.688"></a><span id="l45.688" class="difflineminus">-                // we add an additional record on both sides alike Palm Desktop sync</span>
<a href="#l45.689"></a><span id="l45.689" class="difflineminus">-                palmRec-&gt;dwStatus = ATTR_NONE;</span>
<a href="#l45.690"></a><span id="l45.690" class="difflineminus">-                aIPCCard-&gt;SetStatus(ATTR_NEW);</span>
<a href="#l45.691"></a><span id="l45.691" class="difflineminus">-                exists = PR_FALSE;</span>
<a href="#l45.692"></a><span id="l45.692" class="difflineminus">-            }</span>
<a href="#l45.693"></a><span id="l45.693" class="difflineminus">-            // since we found the same record in palm sync list</span>
<a href="#l45.694"></a><span id="l45.694" class="difflineminus">-            // no need to go thru the rest of the mPalmRecords list</span>
<a href="#l45.695"></a><span id="l45.695" class="difflineminus">-            break;</span>
<a href="#l45.696"></a><span id="l45.696" class="difflineminus">-        }</span>
<a href="#l45.697"></a><span id="l45.697" class="difflineminus">-    }</span>
<a href="#l45.698"></a><span id="l45.698" class="difflineminus">-</span>
<a href="#l45.699"></a><span id="l45.699" class="difflineminus">-    return exists;</span>
<a href="#l45.700"></a><span id="l45.700" class="difflineminus">-}</span>
<a href="#l45.701"></a><span id="l45.701" class="difflineminus">-</span>
<a href="#l45.702"></a><span id="l45.702" class="difflineminus">-// utility function</span>
<a href="#l45.703"></a><span id="l45.703" class="difflineminus">-nsresult nsAbPalmHotSync::AddToListForPalm(nsAbIPCCard &amp; ipcCard)</span>
<a href="#l45.704"></a><span id="l45.704" class="difflineminus">-{</span>
<a href="#l45.705"></a><span id="l45.705" class="difflineminus">-    // this should never happen but check for crossing array index</span>
<a href="#l45.706"></a><span id="l45.706" class="difflineminus">-    if(mCardForPalmCount &gt;= mTotalCardCount)</span>
<a href="#l45.707"></a><span id="l45.707" class="difflineminus">-        return NS_ERROR_UNEXPECTED;</span>
<a href="#l45.708"></a><span id="l45.708" class="difflineminus">-</span>
<a href="#l45.709"></a><span id="l45.709" class="difflineminus">-    nsresult rv = ipcCard.GetABCOMCardStruct(mIsPalmDataUnicode, &amp;mCardListForPalm[mCardForPalmCount]);</span>
<a href="#l45.710"></a><span id="l45.710" class="difflineminus">-    if(NS_SUCCEEDED(rv)) </span>
<a href="#l45.711"></a><span id="l45.711" class="difflineminus">-    {</span>
<a href="#l45.712"></a><span id="l45.712" class="difflineminus">-        mCardListForPalm[mCardForPalmCount].dwCategoryId = mPalmCategoryId;</span>
<a href="#l45.713"></a><span id="l45.713" class="difflineminus">-        mCardForPalmCount++;</span>
<a href="#l45.714"></a><span id="l45.714" class="difflineminus">-    }</span>
<a href="#l45.715"></a><span id="l45.715" class="difflineminus">-</span>
<a href="#l45.716"></a><span id="l45.716" class="difflineminus">-    return rv;</span>
<a href="#l45.717"></a><span id="l45.717" class="difflineminus">-}</span>
<a href="#l45.718"></a><span id="l45.718" class="difflineminus">-</span>
<a href="#l45.719"></a><span id="l45.719" class="difflineminus">-nsresult nsAbPalmHotSync::OpenABDBForHotSync(PRBool aCreate)</span>
<a href="#l45.720"></a><span id="l45.720" class="difflineminus">-{</span>
<a href="#l45.721"></a><span id="l45.721" class="difflineminus">-    if(!mInitialized) </span>
<a href="#l45.722"></a><span id="l45.722" class="difflineminus">-        return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l45.723"></a><span id="l45.723" class="difflineminus">-</span>
<a href="#l45.724"></a><span id="l45.724" class="difflineminus">-    // if already open</span>
<a href="#l45.725"></a><span id="l45.725" class="difflineminus">-    if(mDBOpen &amp;&amp; mABDB &amp;&amp; mDirectory)</span>
<a href="#l45.726"></a><span id="l45.726" class="difflineminus">-        return NS_OK;</span>
<a href="#l45.727"></a><span id="l45.727" class="difflineminus">-</span>
<a href="#l45.728"></a><span id="l45.728" class="difflineminus">-    if(mFileName.IsEmpty())</span>
<a href="#l45.729"></a><span id="l45.729" class="difflineminus">-        return NS_ERROR_FILE_INVALID_PATH;</span>
<a href="#l45.730"></a><span id="l45.730" class="difflineminus">-</span>
<a href="#l45.731"></a><span id="l45.731" class="difflineminus">-    nsresult rv;</span>
<a href="#l45.732"></a><span id="l45.732" class="difflineminus">-    nsCOMPtr&lt;nsIAbManager&gt; abManager(do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l45.733"></a><span id="l45.733" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l45.734"></a><span id="l45.734" class="difflineminus">-      return rv;</span>
<a href="#l45.735"></a><span id="l45.735" class="difflineminus">-</span>
<a href="#l45.736"></a><span id="l45.736" class="difflineminus">-    rv = abManager-&gt;GetUserProfileDirectory(getter_AddRefs(mABFile));</span>
<a href="#l45.737"></a><span id="l45.737" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l45.738"></a><span id="l45.738" class="difflineminus">-      return rv;</span>
<a href="#l45.739"></a><span id="l45.739" class="difflineminus">-</span>
<a href="#l45.740"></a><span id="l45.740" class="difflineminus">-    mABFile-&gt;AppendNative(mFileName);</span>
<a href="#l45.741"></a><span id="l45.741" class="difflineminus">-</span>
<a href="#l45.742"></a><span id="l45.742" class="difflineminus">-    nsCOMPtr&lt;nsIAddrDatabase&gt; addrDBFactory = </span>
<a href="#l45.743"></a><span id="l45.743" class="difflineminus">-             do_GetService(NS_ADDRDATABASE_CONTRACTID, &amp;rv);</span>
<a href="#l45.744"></a><span id="l45.744" class="difflineminus">-    if(NS_FAILED(rv)) </span>
<a href="#l45.745"></a><span id="l45.745" class="difflineminus">-    {</span>
<a href="#l45.746"></a><span id="l45.746" class="difflineminus">-        return rv;</span>
<a href="#l45.747"></a><span id="l45.747" class="difflineminus">-    }</span>
<a href="#l45.748"></a><span id="l45.748" class="difflineminus">-    </span>
<a href="#l45.749"></a><span id="l45.749" class="difflineminus">-    rv = addrDBFactory-&gt;Open(mABFile, aCreate, PR_TRUE, getter_AddRefs(mABDB));</span>
<a href="#l45.750"></a><span id="l45.750" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.751"></a><span id="l45.751" class="difflineminus">-    mDBOpen = PR_TRUE;  // Moz AB DB is now Open</span>
<a href="#l45.752"></a><span id="l45.752" class="difflineminus">-</span>
<a href="#l45.753"></a><span id="l45.753" class="difflineminus">-    return rv;</span>
<a href="#l45.754"></a><span id="l45.754" class="difflineminus">-}</span>
<a href="#l45.755"></a><span id="l45.755" class="difflineminus">-</span>
<a href="#l45.756"></a><span id="l45.756" class="difflineminus">-nsresult nsAbPalmHotSync::KeepCurrentStateAsPrevious()</span>
<a href="#l45.757"></a><span id="l45.757" class="difflineminus">-{</span>
<a href="#l45.758"></a><span id="l45.758" class="difflineminus">-    if(!mInitialized) </span>
<a href="#l45.759"></a><span id="l45.759" class="difflineminus">-        return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l45.760"></a><span id="l45.760" class="difflineminus">-</span>
<a href="#l45.761"></a><span id="l45.761" class="difflineminus">-    nsresult rv = NS_OK;</span>
<a href="#l45.762"></a><span id="l45.762" class="difflineminus">-</span>
<a href="#l45.763"></a><span id="l45.763" class="difflineminus">-    nsCAutoString previousLeafName(mFileName);</span>
<a href="#l45.764"></a><span id="l45.764" class="difflineminus">-    previousLeafName += PREVIOUS_EXTENSION;</span>
<a href="#l45.765"></a><span id="l45.765" class="difflineminus">-</span>
<a href="#l45.766"></a><span id="l45.766" class="difflineminus">-    if(!mPreviousABFile) </span>
<a href="#l45.767"></a><span id="l45.767" class="difflineminus">-    {</span>
<a href="#l45.768"></a><span id="l45.768" class="difflineminus">-      nsCOMPtr&lt;nsIAbManager&gt; abManager(do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l45.769"></a><span id="l45.769" class="difflineminus">-      if (NS_FAILED(rv))</span>
<a href="#l45.770"></a><span id="l45.770" class="difflineminus">-        return rv;</span>
<a href="#l45.771"></a><span id="l45.771" class="difflineminus">-</span>
<a href="#l45.772"></a><span id="l45.772" class="difflineminus">-      rv = abManager-&gt;GetUserProfileDirectory(getter_AddRefs(mPreviousABFile));</span>
<a href="#l45.773"></a><span id="l45.773" class="difflineminus">-      if (NS_SUCCEEDED(rv))</span>
<a href="#l45.774"></a><span id="l45.774" class="difflineminus">-      {</span>
<a href="#l45.775"></a><span id="l45.775" class="difflineminus">-        mPreviousABFile-&gt;AppendNative(previousLeafName);</span>
<a href="#l45.776"></a><span id="l45.776" class="difflineminus">-        if (NS_FAILED(rv))</span>
<a href="#l45.777"></a><span id="l45.777" class="difflineminus">-          return rv;</span>
<a href="#l45.778"></a><span id="l45.778" class="difflineminus">-      }</span>
<a href="#l45.779"></a><span id="l45.779" class="difflineminus">-    }</span>
<a href="#l45.780"></a><span id="l45.780" class="difflineminus">-</span>
<a href="#l45.781"></a><span id="l45.781" class="difflineminus">-    PRBool bExists=PR_FALSE;</span>
<a href="#l45.782"></a><span id="l45.782" class="difflineminus">-    mABFile-&gt;Exists(&amp;bExists);</span>
<a href="#l45.783"></a><span id="l45.783" class="difflineminus">-    if(bExists) </span>
<a href="#l45.784"></a><span id="l45.784" class="difflineminus">-    {</span>
<a href="#l45.785"></a><span id="l45.785" class="difflineminus">-        mPreviousABFile-&gt;Exists(&amp;bExists);</span>
<a href="#l45.786"></a><span id="l45.786" class="difflineminus">-        if(bExists)</span>
<a href="#l45.787"></a><span id="l45.787" class="difflineminus">-            rv = mPreviousABFile-&gt;Remove(PR_FALSE);</span>
<a href="#l45.788"></a><span id="l45.788" class="difflineminus">-        nsCOMPtr&lt;nsIFile&gt; parent;</span>
<a href="#l45.789"></a><span id="l45.789" class="difflineminus">-        rv = mABFile-&gt;GetParent(getter_AddRefs(parent));</span>
<a href="#l45.790"></a><span id="l45.790" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l45.791"></a><span id="l45.791" class="difflineminus">-            rv = mABFile-&gt;CopyToNative(parent, previousLeafName);</span>
<a href="#l45.792"></a><span id="l45.792" class="difflineminus">-    }        </span>
<a href="#l45.793"></a><span id="l45.793" class="difflineminus">-    return rv;</span>
<a href="#l45.794"></a><span id="l45.794" class="difflineminus">-}</span>
<a href="#l45.795"></a><span id="l45.795" class="difflineminus">-</span>
<a href="#l45.796"></a><span id="l45.796" class="difflineminus">-</span>
<a href="#l45.797"></a><span id="l45.797" class="difflineminus">-nsresult nsAbPalmHotSync::UpdateMozABWithPalmRecords()</span>
<a href="#l45.798"></a><span id="l45.798" class="difflineminus">-{</span>
<a href="#l45.799"></a><span id="l45.799" class="difflineminus">-    if(!mInitialized || !mABDB || !mDBOpen)</span>
<a href="#l45.800"></a><span id="l45.800" class="difflineminus">-        return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l45.801"></a><span id="l45.801" class="difflineminus">-</span>
<a href="#l45.802"></a><span id="l45.802" class="difflineminus">-    nsresult rv = NS_OK;</span>
<a href="#l45.803"></a><span id="l45.803" class="difflineminus">-</span>
<a href="#l45.804"></a><span id="l45.804" class="difflineminus">-    for(PRInt32 i=mPalmRecords.Count()-1; i &gt;=0;  i--) </span>
<a href="#l45.805"></a><span id="l45.805" class="difflineminus">-    {</span>
<a href="#l45.806"></a><span id="l45.806" class="difflineminus">-        nsABCOMCardStruct * palmRec = (nsABCOMCardStruct *)mPalmRecords.ElementAt(i);</span>
<a href="#l45.807"></a><span id="l45.807" class="difflineminus">-        nsAbIPCCard ipcCard(palmRec, PR_FALSE);</span>
<a href="#l45.808"></a><span id="l45.808" class="difflineminus">-</span>
<a href="#l45.809"></a><span id="l45.809" class="difflineminus">-        char recordIDBuf[128]; </span>
<a href="#l45.810"></a><span id="l45.810" class="difflineminus">-        PRInt64 l;</span>
<a href="#l45.811"></a><span id="l45.811" class="difflineminus">-        LL_UI2L(l, palmRec-&gt;dwRecordId);</span>
<a href="#l45.812"></a><span id="l45.812" class="difflineminus">-        PRFloat64 f;</span>
<a href="#l45.813"></a><span id="l45.813" class="difflineminus">-        LL_L2F(f, l);</span>
<a href="#l45.814"></a><span id="l45.814" class="difflineminus">-        PR_cnvtf(recordIDBuf, 128, 0, f);</span>
<a href="#l45.815"></a><span id="l45.815" class="difflineminus">-</span>
<a href="#l45.816"></a><span id="l45.816" class="difflineminus">-        // if the card already exists</span>
<a href="#l45.817"></a><span id="l45.817" class="difflineminus">-        nsCOMPtr&lt;nsIAbCard&gt; existingCard;</span>
<a href="#l45.818"></a><span id="l45.818" class="difflineminus">-        rv = mABDB-&gt;GetCardFromAttribute(nsnull, CARD_ATTRIB_PALMID,</span>
<a href="#l45.819"></a><span id="l45.819" class="difflineminus">-					 nsDependentCString(recordIDBuf),</span>
<a href="#l45.820"></a><span id="l45.820" class="difflineminus">-					 PR_FALSE, getter_AddRefs(existingCard));</span>
<a href="#l45.821"></a><span id="l45.821" class="difflineminus">-        if (!existingCard)</span>
<a href="#l45.822"></a><span id="l45.822" class="difflineminus">-        {</span>
<a href="#l45.823"></a><span id="l45.823" class="difflineminus">-          rv = mABDB-&gt;GetCardFromAttribute(nsnull, CARD_ATTRIB_DISPLAY,</span>
<a href="#l45.824"></a><span id="l45.824" class="difflineminus">-					   nsDependentCString((const char *) palmRec-&gt;displayName),</span>
<a href="#l45.825"></a><span id="l45.825" class="difflineminus">-					   PR_FALSE, getter_AddRefs(existingCard));</span>
<a href="#l45.826"></a><span id="l45.826" class="difflineminus">-          // if card with this display name exists, just continue; But, we should make sure</span>
<a href="#l45.827"></a><span id="l45.827" class="difflineminus">-          // it's associated with the palm card going forward, so set the palmid.</span>
<a href="#l45.828"></a><span id="l45.828" class="difflineminus">-          if (NS_SUCCEEDED(rv) &amp;&amp; existingCard)</span>
<a href="#l45.829"></a><span id="l45.829" class="difflineminus">-          {</span>
<a href="#l45.830"></a><span id="l45.830" class="difflineminus">-            existingCard-&gt;SetPropertyAsAUTF8String(CARD_ATTRIB_PALMID,</span>
<a href="#l45.831"></a><span id="l45.831" class="difflineminus">-                nsDependentCString(recordIDBuf));</span>
<a href="#l45.832"></a><span id="l45.832" class="difflineminus">-            continue;</span>
<a href="#l45.833"></a><span id="l45.833" class="difflineminus">-          }</span>
<a href="#l45.834"></a><span id="l45.834" class="difflineminus">-</span>
<a href="#l45.835"></a><span id="l45.835" class="difflineminus">-        }</span>
<a href="#l45.836"></a><span id="l45.836" class="difflineminus">-        if(NS_SUCCEEDED(rv) &amp;&amp; existingCard) </span>
<a href="#l45.837"></a><span id="l45.837" class="difflineminus">-        {</span>
<a href="#l45.838"></a><span id="l45.838" class="difflineminus">-            // Archived is the same as deleted in palm.</span>
<a href="#l45.839"></a><span id="l45.839" class="difflineminus">-            if(palmRec-&gt;dwStatus &amp; ATTR_DELETED || palmRec-&gt;dwStatus &amp; ATTR_ARCHIVED) </span>
<a href="#l45.840"></a><span id="l45.840" class="difflineminus">-            {</span>
<a href="#l45.841"></a><span id="l45.841" class="difflineminus">-                mABDB-&gt;DeleteCard(existingCard, PR_FALSE, nsnull);</span>
<a href="#l45.842"></a><span id="l45.842" class="difflineminus">-                continue;</span>
<a href="#l45.843"></a><span id="l45.843" class="difflineminus">-            }</span>
<a href="#l45.844"></a><span id="l45.844" class="difflineminus">-            if(palmRec-&gt;dwStatus &amp; ATTR_NEW)</span>
<a href="#l45.845"></a><span id="l45.845" class="difflineminus">-                continue;</span>
<a href="#l45.846"></a><span id="l45.846" class="difflineminus">-            if(palmRec-&gt;dwStatus &amp; ATTR_MODIFIED) </span>
<a href="#l45.847"></a><span id="l45.847" class="difflineminus">-            {</span>
<a href="#l45.848"></a><span id="l45.848" class="difflineminus">-                PRBool isEqual=PR_FALSE;</span>
<a href="#l45.849"></a><span id="l45.849" class="difflineminus">-                ipcCard.Equals(existingCard, &amp;isEqual);</span>
<a href="#l45.850"></a><span id="l45.850" class="difflineminus">-                if(isEqual)</span>
<a href="#l45.851"></a><span id="l45.851" class="difflineminus">-                    continue;</span>
<a href="#l45.852"></a><span id="l45.852" class="difflineminus">-                else </span>
<a href="#l45.853"></a><span id="l45.853" class="difflineminus">-                {</span>
<a href="#l45.854"></a><span id="l45.854" class="difflineminus">-                    existingCard-&gt;Copy(&amp;ipcCard);</span>
<a href="#l45.855"></a><span id="l45.855" class="difflineminus">-                    rv = mABDB-&gt;EditCard(existingCard, PR_FALSE, nsnull);</span>
<a href="#l45.856"></a><span id="l45.856" class="difflineminus">-                    continue;</span>
<a href="#l45.857"></a><span id="l45.857" class="difflineminus">-                }</span>
<a href="#l45.858"></a><span id="l45.858" class="difflineminus">-            }</span>
<a href="#l45.859"></a><span id="l45.859" class="difflineminus">-        }</span>
<a href="#l45.860"></a><span id="l45.860" class="difflineminus">-</span>
<a href="#l45.861"></a><span id="l45.861" class="difflineminus">-        nsCOMPtr&lt;nsIAbCard&gt; newCard;</span>
<a href="#l45.862"></a><span id="l45.862" class="difflineminus">-        newCard = do_CreateInstance(NS_ABMDBCARD_CONTRACTID, &amp;rv);</span>
<a href="#l45.863"></a><span id="l45.863" class="difflineminus">-        if(NS_FAILED(rv))</span>
<a href="#l45.864"></a><span id="l45.864" class="difflineminus">-            continue;</span>
<a href="#l45.865"></a><span id="l45.865" class="difflineminus">-</span>
<a href="#l45.866"></a><span id="l45.866" class="difflineminus">-        rv = newCard-&gt;Copy(&amp;ipcCard);</span>
<a href="#l45.867"></a><span id="l45.867" class="difflineminus">-        if(NS_FAILED(rv)) </span>
<a href="#l45.868"></a><span id="l45.868" class="difflineminus">-            continue;</span>
<a href="#l45.869"></a><span id="l45.869" class="difflineminus">-</span>
<a href="#l45.870"></a><span id="l45.870" class="difflineminus">-        // if the card does not exist</span>
<a href="#l45.871"></a><span id="l45.871" class="difflineminus">-        if((ipcCard.GetStatus() == ATTR_NEW)</span>
<a href="#l45.872"></a><span id="l45.872" class="difflineminus">-            ||(ipcCard.GetStatus() == ATTR_MODIFIED)</span>
<a href="#l45.873"></a><span id="l45.873" class="difflineminus">-            || (ipcCard.GetStatus() == ATTR_NONE)) </span>
<a href="#l45.874"></a><span id="l45.874" class="difflineminus">-        {</span>
<a href="#l45.875"></a><span id="l45.875" class="difflineminus">-            PRUint32 modTimeInSec;</span>
<a href="#l45.876"></a><span id="l45.876" class="difflineminus">-            PRTime2Seconds(PR_Now(), &amp;modTimeInSec);</span>
<a href="#l45.877"></a><span id="l45.877" class="difflineminus">-            ipcCard.SetPropertyAsUint32(kLastModifiedDateProperty, modTimeInSec);</span>
<a href="#l45.878"></a><span id="l45.878" class="difflineminus">-            rv = mABDB-&gt;CreateNewCardAndAddToDB(newCard, PR_FALSE, nsnull);</span>
<a href="#l45.879"></a><span id="l45.879" class="difflineminus">-            if(NS_SUCCEEDED(rv)) </span>
<a href="#l45.880"></a><span id="l45.880" class="difflineminus">-            {</span>
<a href="#l45.881"></a><span id="l45.881" class="difflineminus">-                // now set the attribute for the PalmRecID in the card in the DB</span>
<a href="#l45.882"></a><span id="l45.882" class="difflineminus">-                newCard-&gt;SetPropertyAsAUTF8String(CARD_ATTRIB_PALMID,</span>
<a href="#l45.883"></a><span id="l45.883" class="difflineminus">-                    nsDependentCString(recordIDBuf));</span>
<a href="#l45.884"></a><span id="l45.884" class="difflineminus">-                rv = mABDB-&gt;EditCard(newCard, PR_FALSE, nsnull);</span>
<a href="#l45.885"></a><span id="l45.885" class="difflineminus">-            }</span>
<a href="#l45.886"></a><span id="l45.886" class="difflineminus">-        }</span>
<a href="#l45.887"></a><span id="l45.887" class="difflineminus">-    }</span>
<a href="#l45.888"></a><span id="l45.888" class="difflineminus">-</span>
<a href="#l45.889"></a><span id="l45.889" class="difflineminus">-    return rv;</span>
<a href="#l45.890"></a><span id="l45.890" class="difflineminus">-}</span>
<a href="#l45.891"></a><span id="l45.891" class="difflineminus">-</span>
<a href="#l45.892"></a><span id="l45.892" class="difflineminus">-</span>
<a href="#l45.893"></a><span id="l45.893" class="difflineminus">-nsresult nsAbPalmHotSync::Done(PRBool aSuccess, PRInt32 aPalmCatIndex, PRUint32 aPalmRecIDListCount, unsigned long * aPalmRecordIDList)</span>
<a href="#l45.894"></a><span id="l45.894" class="difflineminus">-{</span>
<a href="#l45.895"></a><span id="l45.895" class="difflineminus">-    if(!mInitialized) </span>
<a href="#l45.896"></a><span id="l45.896" class="difflineminus">-        return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l45.897"></a><span id="l45.897" class="difflineminus">-</span>
<a href="#l45.898"></a><span id="l45.898" class="difflineminus">-    nsresult rv=NS_ERROR_UNEXPECTED;</span>
<a href="#l45.899"></a><span id="l45.899" class="difflineminus">-</span>
<a href="#l45.900"></a><span id="l45.900" class="difflineminus">-    if(aPalmRecIDListCount == mNewCardCount) </span>
<a href="#l45.901"></a><span id="l45.901" class="difflineminus">-    {</span>
<a href="#l45.902"></a><span id="l45.902" class="difflineminus">-        for(PRUint32 i=0; i&lt;aPalmRecIDListCount; i++) </span>
<a href="#l45.903"></a><span id="l45.903" class="difflineminus">-        {</span>
<a href="#l45.904"></a><span id="l45.904" class="difflineminus">-            nsCOMPtr&lt;nsIAbCard&gt; newCard;</span>
<a href="#l45.905"></a><span id="l45.905" class="difflineminus">-            rv = mNewCardsArray-&gt;QueryElementAt(i, NS_GET_IID(nsIAbCard), getter_AddRefs(newCard));</span>
<a href="#l45.906"></a><span id="l45.906" class="difflineminus">-            if (NS_SUCCEEDED(rv) &amp;&amp; newCard) </span>
<a href="#l45.907"></a><span id="l45.907" class="difflineminus">-            {</span>
<a href="#l45.908"></a><span id="l45.908" class="difflineminus">-                ConvertAssignPalmIDAttrib(aPalmRecordIDList[i], newCard);</span>
<a href="#l45.909"></a><span id="l45.909" class="difflineminus">-                mABDB-&gt;EditCard(newCard, PR_FALSE, nsnull);</span>
<a href="#l45.910"></a><span id="l45.910" class="difflineminus">-            }</span>
<a href="#l45.911"></a><span id="l45.911" class="difflineminus">-        }</span>
<a href="#l45.912"></a><span id="l45.912" class="difflineminus">-    }</span>
<a href="#l45.913"></a><span id="l45.913" class="difflineminus">-</span>
<a href="#l45.914"></a><span id="l45.914" class="difflineminus">-    if(mABDB &amp;&amp; mDBOpen) </span>
<a href="#l45.915"></a><span id="l45.915" class="difflineminus">-    {</span>
<a href="#l45.916"></a><span id="l45.916" class="difflineminus">-        if(aSuccess) </span>
<a href="#l45.917"></a><span id="l45.917" class="difflineminus">-        {</span>
<a href="#l45.918"></a><span id="l45.918" class="difflineminus">-            rv = mABDB-&gt;Close(PR_TRUE);</span>
<a href="#l45.919"></a><span id="l45.919" class="difflineminus">-            if(NS_SUCCEEDED(rv)) </span>
<a href="#l45.920"></a><span id="l45.920" class="difflineminus">-            {</span>
<a href="#l45.921"></a><span id="l45.921" class="difflineminus">-                mDBOpen = PR_FALSE;</span>
<a href="#l45.922"></a><span id="l45.922" class="difflineminus">-                PRUint32 modTimeInSec;</span>
<a href="#l45.923"></a><span id="l45.923" class="difflineminus">-                PRTime2Seconds(PR_Now(), &amp;modTimeInSec);</span>
<a href="#l45.924"></a><span id="l45.924" class="difflineminus">-                rv = UpdateABInfo(modTimeInSec, aPalmCatIndex);</span>
<a href="#l45.925"></a><span id="l45.925" class="difflineminus">-            }</span>
<a href="#l45.926"></a><span id="l45.926" class="difflineminus">-        }</span>
<a href="#l45.927"></a><span id="l45.927" class="difflineminus">-        if(NS_FAILED(rv) || !aSuccess) </span>
<a href="#l45.928"></a><span id="l45.928" class="difflineminus">-        { // get back the previous file</span>
<a href="#l45.929"></a><span id="l45.929" class="difflineminus">-            rv = mABDB-&gt;ForceClosed();</span>
<a href="#l45.930"></a><span id="l45.930" class="difflineminus">-            if(NS_SUCCEEDED(rv)) </span>
<a href="#l45.931"></a><span id="l45.931" class="difflineminus">-            {</span>
<a href="#l45.932"></a><span id="l45.932" class="difflineminus">-                nsCAutoString leafName;</span>
<a href="#l45.933"></a><span id="l45.933" class="difflineminus">-                mABFile-&gt;GetNativeLeafName(leafName);</span>
<a href="#l45.934"></a><span id="l45.934" class="difflineminus">-                PRBool bExists=PR_FALSE;</span>
<a href="#l45.935"></a><span id="l45.935" class="difflineminus">-                mPreviousABFile-&gt;Exists(&amp;bExists);</span>
<a href="#l45.936"></a><span id="l45.936" class="difflineminus">-                if(bExists) </span>
<a href="#l45.937"></a><span id="l45.937" class="difflineminus">-                {</span>
<a href="#l45.938"></a><span id="l45.938" class="difflineminus">-                    nsCOMPtr&lt;nsIFile&gt; parent;</span>
<a href="#l45.939"></a><span id="l45.939" class="difflineminus">-                    rv = mABFile-&gt;GetParent(getter_AddRefs(parent));</span>
<a href="#l45.940"></a><span id="l45.940" class="difflineminus">-                    if (NS_SUCCEEDED(rv)) </span>
<a href="#l45.941"></a><span id="l45.941" class="difflineminus">-                    {</span>
<a href="#l45.942"></a><span id="l45.942" class="difflineminus">-                        mABFile-&gt;Remove(PR_FALSE);</span>
<a href="#l45.943"></a><span id="l45.943" class="difflineminus">-                        mPreviousABFile-&gt;CopyToNative(parent, leafName);</span>
<a href="#l45.944"></a><span id="l45.944" class="difflineminus">-                    }</span>
<a href="#l45.945"></a><span id="l45.945" class="difflineminus">-                }</span>
<a href="#l45.946"></a><span id="l45.946" class="difflineminus">-                mDBOpen = PR_FALSE;</span>
<a href="#l45.947"></a><span id="l45.947" class="difflineminus">-            }</span>
<a href="#l45.948"></a><span id="l45.948" class="difflineminus">-        }</span>
<a href="#l45.949"></a><span id="l45.949" class="difflineminus">-    }</span>
<a href="#l45.950"></a><span id="l45.950" class="difflineminus">-    </span>
<a href="#l45.951"></a><span id="l45.951" class="difflineminus">-    return rv;</span>
<a href="#l45.952"></a><span id="l45.952" class="difflineminus">-}</span>
<a href="#l45.953"></a><span id="l45.953" class="difflineminus">-</span>
<a href="#l45.954"></a><span id="l45.954" class="difflineminus">-nsresult nsAbPalmHotSync::UpdateSyncInfo(long aCategoryIndex)</span>
<a href="#l45.955"></a><span id="l45.955" class="difflineminus">-{</span>
<a href="#l45.956"></a><span id="l45.956" class="difflineminus">-  // aCategoryIndex = -1 means that callers want to reset the mod time as well. </span>
<a href="#l45.957"></a><span id="l45.957" class="difflineminus">-  mDBOpen = PR_FALSE;</span>
<a href="#l45.958"></a><span id="l45.958" class="difflineminus">-  PRUint32 modTimeInSec;</span>
<a href="#l45.959"></a><span id="l45.959" class="difflineminus">-  PRTime2Seconds(PR_Now(), &amp;modTimeInSec);</span>
<a href="#l45.960"></a><span id="l45.960" class="difflineminus">-  if (aCategoryIndex &gt;= 0)</span>
<a href="#l45.961"></a><span id="l45.961" class="difflineminus">-    return(UpdateABInfo(modTimeInSec, aCategoryIndex));</span>
<a href="#l45.962"></a><span id="l45.962" class="difflineminus">-  else</span>
<a href="#l45.963"></a><span id="l45.963" class="difflineminus">-    return(UpdateABInfo(0, aCategoryIndex)); // Reset mod time.</span>
<a href="#l45.964"></a><span id="l45.964" class="difflineminus">-}</span>
<a href="#l45.965"></a><span id="l45.965" class="difflineminus">-</span>
<a href="#l45.966"></a><span id="l45.966" class="difflineminus">-nsresult nsAbPalmHotSync::DeleteAB(const char* aABUrl)</span>
<a href="#l45.967"></a><span id="l45.967" class="difflineminus">-{</span>
<a href="#l45.968"></a><span id="l45.968" class="difflineminus">-  nsresult rv;</span>
<a href="#l45.969"></a><span id="l45.969" class="difflineminus">-  nsCOMPtr&lt;nsIAbManager&gt; ab(do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l45.970"></a><span id="l45.970" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.971"></a><span id="l45.971" class="difflineminus">-</span>
<a href="#l45.972"></a><span id="l45.972" class="difflineminus">-  return ab-&gt;DeleteAddressBook(nsDependentCString(aABUrl));</span>
<a href="#l45.973"></a><span id="l45.973" class="difflineminus">-}</span>
<a href="#l45.974"></a><span id="l45.974" class="difflineminus">-</span>
<a href="#l45.975"></a><span id="l45.975" class="difflineminus">-nsresult nsAbPalmHotSync::RenameAB(long aCategoryIndex, const char * aABUrl)</span>
<a href="#l45.976"></a><span id="l45.976" class="difflineminus">-{</span>
<a href="#l45.977"></a><span id="l45.977" class="difflineminus">-  PRUint32 modTimeInSec;</span>
<a href="#l45.978"></a><span id="l45.978" class="difflineminus">-  PRTime2Seconds(PR_Now(), &amp;modTimeInSec);</span>
<a href="#l45.979"></a><span id="l45.979" class="difflineminus">-</span>
<a href="#l45.980"></a><span id="l45.980" class="difflineminus">-  return ModifyAB(aABUrl, mAbName, modTimeInSec, aCategoryIndex);</span>
<a href="#l45.981"></a><span id="l45.981" class="difflineminus">-}</span>
<a href="#l45.982"></a><span id="l45.982" class="difflineminus">-</span>
<a href="#l45.983"></a><span id="l45.983" class="difflineminus">-nsresult nsAbPalmHotSync::NewAB(const nsString&amp; aAbName)</span>
<a href="#l45.984"></a><span id="l45.984" class="difflineminus">-{</span>
<a href="#l45.985"></a><span id="l45.985" class="difflineminus">-  nsresult rv;</span>
<a href="#l45.986"></a><span id="l45.986" class="difflineminus">-  nsCOMPtr &lt;nsIAbManager&gt; ab(do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l45.987"></a><span id="l45.987" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.988"></a><span id="l45.988" class="difflineminus">-</span>
<a href="#l45.989"></a><span id="l45.989" class="difflineminus">-  // Don't actually need to keep the result</span>
<a href="#l45.990"></a><span id="l45.990" class="difflineminus">-  nsCString result;</span>
<a href="#l45.991"></a><span id="l45.991" class="difflineminus">-  return ab-&gt;NewAddressBook(aAbName, EmptyCString(), kPABDirectory, EmptyCString(), result);</span>
<a href="#l45.992"></a><span id="l45.992" class="difflineminus">-}</span>
<a href="#l45.993"></a><span id="l45.993" class="difflineminus">-</span>
<a href="#l45.994"></a><span id="l45.994" class="difflineminus">-nsresult nsAbPalmHotSync::UpdateABInfo(PRUint32 aModTime, PRInt32 aCategoryIndex)</span>
<a href="#l45.995"></a><span id="l45.995" class="difflineminus">-{</span>
<a href="#l45.996"></a><span id="l45.996" class="difflineminus">-  return(ModifyAB(mUri.get(), mDescription, aModTime, aCategoryIndex));</span>
<a href="#l45.997"></a><span id="l45.997" class="difflineminus">-}</span>
<a href="#l45.998"></a><span id="l45.998" class="difflineminus">-</span>
<a href="#l45.999"></a><span id="l45.999" class="difflineminus">-nsresult nsAbPalmHotSync::ModifyAB(const char * aABUrl,</span>
<a href="#l45.1000"></a><span id="l45.1000" class="difflineminus">-				   const nsString &amp;aAbName,</span>
<a href="#l45.1001"></a><span id="l45.1001" class="difflineminus">-				   const PRUint32 aModTime,</span>
<a href="#l45.1002"></a><span id="l45.1002" class="difflineminus">-				   const PRInt32 aCategoryId)</span>
<a href="#l45.1003"></a><span id="l45.1003" class="difflineminus">-{</span>
<a href="#l45.1004"></a><span id="l45.1004" class="difflineminus">-  nsresult rv;</span>
<a href="#l45.1005"></a><span id="l45.1005" class="difflineminus">-</span>
<a href="#l45.1006"></a><span id="l45.1006" class="difflineminus">-  nsCOMPtr&lt;nsIRDFService&gt; rdfService = do_GetService (NS_RDF_CONTRACTID &quot;/rdf-service;1&quot;, &amp;rv);</span>
<a href="#l45.1007"></a><span id="l45.1007" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.1008"></a><span id="l45.1008" class="difflineminus">-</span>
<a href="#l45.1009"></a><span id="l45.1009" class="difflineminus">-  // Parent nsIABDirectory: like &quot;moz-abdirectory://&quot;.</span>
<a href="#l45.1010"></a><span id="l45.1010" class="difflineminus">-  nsCOMPtr &lt;nsIRDFResource&gt; resource;</span>
<a href="#l45.1011"></a><span id="l45.1011" class="difflineminus">-  rv = rdfService-&gt;GetResource(NS_LITERAL_CSTRING(&quot;moz-abdirectory://&quot;), getter_AddRefs(resource));</span>
<a href="#l45.1012"></a><span id="l45.1012" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.1013"></a><span id="l45.1013" class="difflineminus">-</span>
<a href="#l45.1014"></a><span id="l45.1014" class="difflineminus">-  nsCOMPtr &lt;nsIAbDirectory&gt; parentDirectory = do_QueryInterface(resource, &amp;rv);</span>
<a href="#l45.1015"></a><span id="l45.1015" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.1016"></a><span id="l45.1016" class="difflineminus">-</span>
<a href="#l45.1017"></a><span id="l45.1017" class="difflineminus">-  // Selected folder nsIABDirectory: like &quot;moz-abmdbdirectory://abook-1.mab&quot;</span>
<a href="#l45.1018"></a><span id="l45.1018" class="difflineminus">-  nsCOMPtr &lt;nsIRDFResource&gt; childResource;</span>
<a href="#l45.1019"></a><span id="l45.1019" class="difflineminus">-  rv = rdfService-&gt;GetResource(nsDependentCString(aABUrl), getter_AddRefs(childResource));</span>
<a href="#l45.1020"></a><span id="l45.1020" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.1021"></a><span id="l45.1021" class="difflineminus">-  nsCOMPtr &lt;nsIAbDirectory&gt; selectedDirectory = do_QueryInterface(childResource, &amp;rv);</span>
<a href="#l45.1022"></a><span id="l45.1022" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.1023"></a><span id="l45.1023" class="difflineminus">-</span>
<a href="#l45.1024"></a><span id="l45.1024" class="difflineminus">-  rv = selectedDirectory-&gt;SetDirName(aAbName);</span>
<a href="#l45.1025"></a><span id="l45.1025" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.1026"></a><span id="l45.1026" class="difflineminus">-</span>
<a href="#l45.1027"></a><span id="l45.1027" class="difflineminus">-  // Now set the mod time and category id directly via the selected directory.</span>
<a href="#l45.1028"></a><span id="l45.1028" class="difflineminus">-  rv = selectedDirectory-&gt;SetIntValue(&quot;PalmSyncTimeStamp&quot;, aModTime);</span>
<a href="#l45.1029"></a><span id="l45.1029" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.1030"></a><span id="l45.1030" class="difflineminus">-  </span>
<a href="#l45.1031"></a><span id="l45.1031" class="difflineminus">-  return selectedDirectory-&gt;SetIntValue(&quot;PalmSyncCategoryId&quot;, aCategoryId);</span>
<a href="#l45.1032"></a><span id="l45.1032" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1">deleted file mode 100644</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/nsAbPalmSync.h</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineplus">+++ /dev/null</span>
<a href="#l46.4"></a><span id="l46.4" class="difflineat">@@ -1,152 +0,0 @@</span>
<a href="#l46.5"></a><span id="l46.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l46.6"></a><span id="l46.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l46.7"></a><span id="l46.7" class="difflineminus">- *</span>
<a href="#l46.8"></a><span id="l46.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l46.9"></a><span id="l46.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l46.10"></a><span id="l46.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l46.11"></a><span id="l46.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">- *</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l46.14"></a><span id="l46.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l46.16"></a><span id="l46.16" class="difflineminus">- * License.</span>
<a href="#l46.17"></a><span id="l46.17" class="difflineminus">- *</span>
<a href="#l46.18"></a><span id="l46.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l46.19"></a><span id="l46.19" class="difflineminus">- *</span>
<a href="#l46.20"></a><span id="l46.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l46.21"></a><span id="l46.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l46.22"></a><span id="l46.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l46.23"></a><span id="l46.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l46.24"></a><span id="l46.24" class="difflineminus">- *</span>
<a href="#l46.25"></a><span id="l46.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l46.26"></a><span id="l46.26" class="difflineminus">- *   Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l46.27"></a><span id="l46.27" class="difflineminus">- *</span>
<a href="#l46.28"></a><span id="l46.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l46.29"></a><span id="l46.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l46.30"></a><span id="l46.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l46.34"></a><span id="l46.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l46.35"></a><span id="l46.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l46.36"></a><span id="l46.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l46.37"></a><span id="l46.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l46.38"></a><span id="l46.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l46.39"></a><span id="l46.39" class="difflineminus">- *</span>
<a href="#l46.40"></a><span id="l46.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l46.41"></a><span id="l46.41" class="difflineminus">-</span>
<a href="#l46.42"></a><span id="l46.42" class="difflineminus">-#ifndef nsAbPalmHotSync_h__</span>
<a href="#l46.43"></a><span id="l46.43" class="difflineminus">-#define nsAbPalmHotSync_h__</span>
<a href="#l46.44"></a><span id="l46.44" class="difflineminus">-</span>
<a href="#l46.45"></a><span id="l46.45" class="difflineminus">-#include &quot;msgMapi.h&quot;</span>
<a href="#l46.46"></a><span id="l46.46" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l46.47"></a><span id="l46.47" class="difflineminus">-#include &quot;nsAbIPCCard.h&quot;</span>
<a href="#l46.48"></a><span id="l46.48" class="difflineminus">-#include &quot;nsIAbCard.h&quot;</span>
<a href="#l46.49"></a><span id="l46.49" class="difflineminus">-#include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l46.50"></a><span id="l46.50" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l46.51"></a><span id="l46.51" class="difflineminus">-#include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l46.52"></a><span id="l46.52" class="difflineminus">-</span>
<a href="#l46.53"></a><span id="l46.53" class="difflineminus">-class nsAbPalmHotSync</span>
<a href="#l46.54"></a><span id="l46.54" class="difflineminus">-{</span>
<a href="#l46.55"></a><span id="l46.55" class="difflineminus">-public:</span>
<a href="#l46.56"></a><span id="l46.56" class="difflineminus">-</span>
<a href="#l46.57"></a><span id="l46.57" class="difflineminus">-    // this class will do HotSync for a specific AB</span>
<a href="#l46.58"></a><span id="l46.58" class="difflineminus">-    nsAbPalmHotSync(PRBool aIsUnicode, PRUnichar * aAbDescUnicode, const char * aAbDesc, PRInt32 aPalmCatIndex, PRInt32 aPalmCatId);</span>
<a href="#l46.59"></a><span id="l46.59" class="difflineminus">-    ~nsAbPalmHotSync();</span>
<a href="#l46.60"></a><span id="l46.60" class="difflineminus">-</span>
<a href="#l46.61"></a><span id="l46.61" class="difflineminus">-    // initialize the object, info for AB for the object, etc</span>
<a href="#l46.62"></a><span id="l46.62" class="difflineminus">-    nsresult Initialize();</span>
<a href="#l46.63"></a><span id="l46.63" class="difflineminus">-</span>
<a href="#l46.64"></a><span id="l46.64" class="difflineminus">-    // this will take in all updated/new Palm records and start Sync.</span>
<a href="#l46.65"></a><span id="l46.65" class="difflineminus">-    // Sync process will load updated/new cards and compare with updated/new </span>
<a href="#l46.66"></a><span id="l46.66" class="difflineminus">-    // Palm records to create final list to be sent to Palm and to update AB.</span>
<a href="#l46.67"></a><span id="l46.67" class="difflineminus">-    nsresult DoSyncAndGetUpdatedCards(PRInt32 aPalmCount, lpnsABCOMCardStruct aPalmRecords, PRInt32 * aMozCount, lpnsABCOMCardStruct * aMozCards);</span>
<a href="#l46.68"></a><span id="l46.68" class="difflineminus">-</span>
<a href="#l46.69"></a><span id="l46.69" class="difflineminus">-    // this will return all cards in an AB</span>
<a href="#l46.70"></a><span id="l46.70" class="difflineminus">-    nsresult GetAllCards(PRInt32 * aCount, lpnsABCOMCardStruct * aCardList);</span>
<a href="#l46.71"></a><span id="l46.71" class="difflineminus">-</span>
<a href="#l46.72"></a><span id="l46.72" class="difflineminus">-    // this will return the final list created by above Sync methods</span>
<a href="#l46.73"></a><span id="l46.73" class="difflineminus">-    // allocates aCardList as a memory block and populates it with mIPCCardList to be sent to Palm</span>
<a href="#l46.74"></a><span id="l46.74" class="difflineminus">-    nsresult GetCardsToBeSentToPalm(PRInt32 * aCount, lpnsABCOMCardStruct * aCardList);</span>
<a href="#l46.75"></a><span id="l46.75" class="difflineminus">-</span>
<a href="#l46.76"></a><span id="l46.76" class="difflineminus">-    // this will create a new AB and all data into it</span>
<a href="#l46.77"></a><span id="l46.77" class="difflineminus">-    nsresult AddAllRecordsToAB(PRBool replaceExisting, PRInt32 aCount, lpnsABCOMCardStruct aPalmRecords);</span>
<a href="#l46.78"></a><span id="l46.78" class="difflineminus">-</span>
<a href="#l46.79"></a><span id="l46.79" class="difflineminus">-    // this will be called when an AckSyncDone is received from the Conduit</span>
<a href="#l46.80"></a><span id="l46.80" class="difflineminus">-    nsresult Done(PRBool aSuccess, PRInt32 aPalmCatIndex, PRUint32 aPalmRecIDListCount = 0, unsigned long * aPalmRecordIDList = nsnull);</span>
<a href="#l46.81"></a><span id="l46.81" class="difflineminus">-</span>
<a href="#l46.82"></a><span id="l46.82" class="difflineminus">-    // this will upate AB with new category id and mod time.</span>
<a href="#l46.83"></a><span id="l46.83" class="difflineminus">-    nsresult UpdateSyncInfo(long aCategoryIndex);</span>
<a href="#l46.84"></a><span id="l46.84" class="difflineminus">-</span>
<a href="#l46.85"></a><span id="l46.85" class="difflineminus">-    // this will delete an AB</span>
<a href="#l46.86"></a><span id="l46.86" class="difflineminus">-    nsresult DeleteAB(const char * aABUrl);</span>
<a href="#l46.87"></a><span id="l46.87" class="difflineminus">-</span>
<a href="#l46.88"></a><span id="l46.88" class="difflineminus">-    // this will rename an AB</span>
<a href="#l46.89"></a><span id="l46.89" class="difflineminus">-    nsresult RenameAB(long aCategoryIndex, const char * aABUrl);</span>
<a href="#l46.90"></a><span id="l46.90" class="difflineminus">-</span>
<a href="#l46.91"></a><span id="l46.91" class="difflineminus">-protected:</span>
<a href="#l46.92"></a><span id="l46.92" class="difflineminus">-</span>
<a href="#l46.93"></a><span id="l46.93" class="difflineminus">-    PRBool mIsPalmDataUnicode;</span>
<a href="#l46.94"></a><span id="l46.94" class="difflineminus">-</span>
<a href="#l46.95"></a><span id="l46.95" class="difflineminus">-    // data members related to AB DB</span>
<a href="#l46.96"></a><span id="l46.96" class="difflineminus">-    PRUint32  mTotalCardCount;</span>
<a href="#l46.97"></a><span id="l46.97" class="difflineminus">-    nsCOMPtr&lt;nsIAddrDatabase&gt; mABDB;</span>
<a href="#l46.98"></a><span id="l46.98" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; mABFile;</span>
<a href="#l46.99"></a><span id="l46.99" class="difflineminus">-    PRBool   mDBOpen;</span>
<a href="#l46.100"></a><span id="l46.100" class="difflineminus">-    // pref for the AB DB</span>
<a href="#l46.101"></a><span id="l46.101" class="difflineminus">-    nsString     mAbName;</span>
<a href="#l46.102"></a><span id="l46.102" class="difflineminus">-    PRInt32      mPalmCategoryId;</span>
<a href="#l46.103"></a><span id="l46.103" class="difflineminus">-    PRInt32      mPalmCategoryIndex;</span>
<a href="#l46.104"></a><span id="l46.104" class="difflineminus">-    nsCString    mFileName;</span>
<a href="#l46.105"></a><span id="l46.105" class="difflineminus">-    nsCString    mUri;</span>
<a href="#l46.106"></a><span id="l46.106" class="difflineminus">-    nsString     mDescription;</span>
<a href="#l46.107"></a><span id="l46.107" class="difflineminus">-    PRUint32     mDirType;</span>
<a href="#l46.108"></a><span id="l46.108" class="difflineminus">-    PRUint32     mPalmSyncTimeStamp;</span>
<a href="#l46.109"></a><span id="l46.109" class="difflineminus">-    // cards directory for the AB</span>
<a href="#l46.110"></a><span id="l46.110" class="difflineminus">-    nsCOMPtr&lt;nsIAbDirectory&gt; mDirectory;</span>
<a href="#l46.111"></a><span id="l46.111" class="difflineminus">-</span>
<a href="#l46.112"></a><span id="l46.112" class="difflineminus">-    // previous AB, the AB state before the last sync</span>
<a href="#l46.113"></a><span id="l46.113" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; mPreviousABFile;</span>
<a href="#l46.114"></a><span id="l46.114" class="difflineminus">-</span>
<a href="#l46.115"></a><span id="l46.115" class="difflineminus">-    // Palm records list</span>
<a href="#l46.116"></a><span id="l46.116" class="difflineminus">-    nsVoidArray mPalmRecords;</span>
<a href="#l46.117"></a><span id="l46.117" class="difflineminus">-    // CardList to be sent to Palm</span>
<a href="#l46.118"></a><span id="l46.118" class="difflineminus">-    PRUint32 mCardForPalmCount;</span>
<a href="#l46.119"></a><span id="l46.119" class="difflineminus">-    lpnsABCOMCardStruct mCardListForPalm;</span>
<a href="#l46.120"></a><span id="l46.120" class="difflineminus">-    // since cards are already in memory because the db is open, </span>
<a href="#l46.121"></a><span id="l46.121" class="difflineminus">-    // this doesn't add much to memory overhead</span>
<a href="#l46.122"></a><span id="l46.122" class="difflineminus">-    PRUint32 mNewCardCount;</span>
<a href="#l46.123"></a><span id="l46.123" class="difflineminus">-    nsCOMPtr &lt;nsISupportsArray&gt; mNewCardsArray;</span>
<a href="#l46.124"></a><span id="l46.124" class="difflineminus">-    PRBool   mIsNewCardForPalm;</span>
<a href="#l46.125"></a><span id="l46.125" class="difflineminus">-    </span>
<a href="#l46.126"></a><span id="l46.126" class="difflineminus">-    PRBool      mInitialized;</span>
<a href="#l46.127"></a><span id="l46.127" class="difflineminus">-protected:</span>
<a href="#l46.128"></a><span id="l46.128" class="difflineminus">-    // disallow calling of default constructor</span>
<a href="#l46.129"></a><span id="l46.129" class="difflineminus">-    nsAbPalmHotSync();</span>
<a href="#l46.130"></a><span id="l46.130" class="difflineminus">-</span>
<a href="#l46.131"></a><span id="l46.131" class="difflineminus">-    // this will take care of opening, nsIAbDirectroy creation, DB backup, etc</span>
<a href="#l46.132"></a><span id="l46.132" class="difflineminus">-    nsresult OpenABDBForHotSync(PRBool aCreate);</span>
<a href="#l46.133"></a><span id="l46.133" class="difflineminus">-    nsresult KeepCurrentStateAsPrevious();</span>
<a href="#l46.134"></a><span id="l46.134" class="difflineminus">-    nsresult UpdateMozABWithPalmRecords();</span>
<a href="#l46.135"></a><span id="l46.135" class="difflineminus">-</span>
<a href="#l46.136"></a><span id="l46.136" class="difflineminus">-    // this will load and create a list of cards since last sync</span>
<a href="#l46.137"></a><span id="l46.137" class="difflineminus">-    nsresult LoadNewModifiedCardsSinceLastSync();</span>
<a href="#l46.138"></a><span id="l46.138" class="difflineminus">-    nsresult LoadDeletedCardsSinceLastSync();</span>
<a href="#l46.139"></a><span id="l46.139" class="difflineminus">-</span>
<a href="#l46.140"></a><span id="l46.140" class="difflineminus">-    // Checks with the corresponding Palm record for any discrepencies</span>
<a href="#l46.141"></a><span id="l46.141" class="difflineminus">-    // if any modification needed, this will return the modified card</span>
<a href="#l46.142"></a><span id="l46.142" class="difflineminus">-    // returns whether card exists (in which case it can be discarded)</span>
<a href="#l46.143"></a><span id="l46.143" class="difflineminus">-    PRBool CardExistsInPalmList(nsAbIPCCard  * aIPCCard);</span>
<a href="#l46.144"></a><span id="l46.144" class="difflineminus">-</span>
<a href="#l46.145"></a><span id="l46.145" class="difflineminus">-    // utility function</span>
<a href="#l46.146"></a><span id="l46.146" class="difflineminus">-    nsresult AddToListForPalm(nsAbIPCCard &amp; ipcCard);</span>
<a href="#l46.147"></a><span id="l46.147" class="difflineminus">-    void ConvertAssignPalmIDAttrib(PRUint32 id, nsIAbCard * card);</span>
<a href="#l46.148"></a><span id="l46.148" class="difflineminus">-    nsresult GetABInterface();</span>
<a href="#l46.149"></a><span id="l46.149" class="difflineminus">-    nsresult UpdateABInfo(PRUint32 modTime, PRInt32 categoryId);</span>
<a href="#l46.150"></a><span id="l46.150" class="difflineminus">-    nsresult ModifyAB(const char * ABUrl, const nsString &amp;aAbName,</span>
<a href="#l46.151"></a><span id="l46.151" class="difflineminus">-                      const PRUint32 aModTime, const PRInt32 aCategoryId);</span>
<a href="#l46.152"></a><span id="l46.152" class="difflineminus">-    nsresult NewAB(const nsString&amp; aAbName);</span>
<a href="#l46.153"></a><span id="l46.153" class="difflineminus">-</span>
<a href="#l46.154"></a><span id="l46.154" class="difflineminus">-};</span>
<a href="#l46.155"></a><span id="l46.155" class="difflineminus">-</span>
<a href="#l46.156"></a><span id="l46.156" class="difflineminus">-#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1">deleted file mode 100644</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/nsPalmSyncSupport.cpp</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineplus">+++ /dev/null</span>
<a href="#l47.4"></a><span id="l47.4" class="difflineat">@@ -1,313 +0,0 @@</span>
<a href="#l47.5"></a><span id="l47.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l47.6"></a><span id="l47.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l47.7"></a><span id="l47.7" class="difflineminus">- *</span>
<a href="#l47.8"></a><span id="l47.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l47.9"></a><span id="l47.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l47.10"></a><span id="l47.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l47.11"></a><span id="l47.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">- *</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l47.14"></a><span id="l47.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l47.15"></a><span id="l47.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l47.16"></a><span id="l47.16" class="difflineminus">- * License.</span>
<a href="#l47.17"></a><span id="l47.17" class="difflineminus">- *</span>
<a href="#l47.18"></a><span id="l47.18" class="difflineminus">- * The Original Code is Mozilla</span>
<a href="#l47.19"></a><span id="l47.19" class="difflineminus">- *</span>
<a href="#l47.20"></a><span id="l47.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l47.21"></a><span id="l47.21" class="difflineminus">- * Netscape Communications Corp.</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l47.23"></a><span id="l47.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l47.24"></a><span id="l47.24" class="difflineminus">- *</span>
<a href="#l47.25"></a><span id="l47.25" class="difflineminus">- * Contributor(s): </span>
<a href="#l47.26"></a><span id="l47.26" class="difflineminus">- *           Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l47.27"></a><span id="l47.27" class="difflineminus">- *</span>
<a href="#l47.28"></a><span id="l47.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l47.29"></a><span id="l47.29" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l47.30"></a><span id="l47.30" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l47.33"></a><span id="l47.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l47.34"></a><span id="l47.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l47.35"></a><span id="l47.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l47.36"></a><span id="l47.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l47.37"></a><span id="l47.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l47.38"></a><span id="l47.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l47.39"></a><span id="l47.39" class="difflineminus">- *</span>
<a href="#l47.40"></a><span id="l47.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l47.41"></a><span id="l47.41" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l47.42"></a><span id="l47.42" class="difflineminus">-#include &quot;objbase.h&quot;</span>
<a href="#l47.43"></a><span id="l47.43" class="difflineminus">-#include &quot;nsISupports.h&quot;</span>
<a href="#l47.44"></a><span id="l47.44" class="difflineminus">-</span>
<a href="#l47.45"></a><span id="l47.45" class="difflineminus">-#include &quot;nsIGenericFactory.h&quot;</span>
<a href="#l47.46"></a><span id="l47.46" class="difflineminus">-#include &quot;nsIObserverService.h&quot;</span>
<a href="#l47.47"></a><span id="l47.47" class="difflineminus">-#include &quot;nsIAppStartupNotifier.h&quot;</span>
<a href="#l47.48"></a><span id="l47.48" class="difflineminus">-#include &quot;nsIServiceManager.h&quot;</span>
<a href="#l47.49"></a><span id="l47.49" class="difflineminus">-#include &quot;nsIComponentManager.h&quot;</span>
<a href="#l47.50"></a><span id="l47.50" class="difflineminus">-#include &quot;nsICategoryManager.h&quot;</span>
<a href="#l47.51"></a><span id="l47.51" class="difflineminus">-#include &quot;nsIExtensionManager.h&quot;</span>
<a href="#l47.52"></a><span id="l47.52" class="difflineminus">-#include &quot;nsIFile.h&quot;</span>
<a href="#l47.53"></a><span id="l47.53" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l47.54"></a><span id="l47.54" class="difflineminus">-#include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l47.55"></a><span id="l47.55" class="difflineminus">-#include &quot;nsIPrefService.h&quot;</span>
<a href="#l47.56"></a><span id="l47.56" class="difflineminus">-#include &quot;nsIXULAppInfo.h&quot;</span>
<a href="#l47.57"></a><span id="l47.57" class="difflineminus">-#include &quot;nsCRTGlue.h&quot;</span>
<a href="#l47.58"></a><span id="l47.58" class="difflineminus">-#include &quot;PalmSyncImp.h&quot;</span>
<a href="#l47.59"></a><span id="l47.59" class="difflineminus">-#include &quot;nsPalmSyncSupport.h&quot;</span>
<a href="#l47.60"></a><span id="l47.60" class="difflineminus">-#include &quot;Registry.h&quot;</span>
<a href="#l47.61"></a><span id="l47.61" class="difflineminus">-#include &lt;shellapi.h&gt; // needed for ShellExecute</span>
<a href="#l47.62"></a><span id="l47.62" class="difflineminus">-</span>
<a href="#l47.63"></a><span id="l47.63" class="difflineminus">-#define EXTENSION_ID &quot;p@m&quot; // would ideally be palmsync@mozilla.org, but palm can't handle the long file path</span>
<a href="#l47.64"></a><span id="l47.64" class="difflineminus">-#define EXECUTABLE_FILENAME &quot;PalmSyncInstall.exe&quot;</span>
<a href="#l47.65"></a><span id="l47.65" class="difflineminus">-#define PREF_CONDUIT_REGISTERED &quot;extensions.palmsync.conduitRegistered&quot;</span>
<a href="#l47.66"></a><span id="l47.66" class="difflineminus">-</span>
<a href="#l47.67"></a><span id="l47.67" class="difflineminus">-</span>
<a href="#l47.68"></a><span id="l47.68" class="difflineminus">-/** Implementation of the IPalmSyncSupport interface.</span>
<a href="#l47.69"></a><span id="l47.69" class="difflineminus">- *  Use standard implementation of nsISupports stuff.</span>
<a href="#l47.70"></a><span id="l47.70" class="difflineminus">- *  This also implements the Observors for App Startup</span>
<a href="#l47.71"></a><span id="l47.71" class="difflineminus">- *  at which time it will register the MSCOM interface</span>
<a href="#l47.72"></a><span id="l47.72" class="difflineminus">- *  for PalmSync used for IPC with the Palm Conduits</span>
<a href="#l47.73"></a><span id="l47.73" class="difflineminus">- *  </span>
<a href="#l47.74"></a><span id="l47.74" class="difflineminus">- */</span>
<a href="#l47.75"></a><span id="l47.75" class="difflineminus">-</span>
<a href="#l47.76"></a><span id="l47.76" class="difflineminus">-NS_IMPL_THREADSAFE_ISUPPORTS2(nsPalmSyncSupport, nsIPalmSyncSupport, nsIObserver)</span>
<a href="#l47.77"></a><span id="l47.77" class="difflineminus">-</span>
<a href="#l47.78"></a><span id="l47.78" class="difflineminus">-static NS_METHOD nsPalmSyncRegistrationProc(nsIComponentManager *aCompMgr,</span>
<a href="#l47.79"></a><span id="l47.79" class="difflineminus">-                   nsIFile *aPath, const char *registryLocation, const char *componentType,</span>
<a href="#l47.80"></a><span id="l47.80" class="difflineminus">-                   const nsModuleComponentInfo *info)</span>
<a href="#l47.81"></a><span id="l47.81" class="difflineminus">-{</span>
<a href="#l47.82"></a><span id="l47.82" class="difflineminus">-  nsresult rv;</span>
<a href="#l47.83"></a><span id="l47.83" class="difflineminus">-  nsCOMPtr&lt;nsICategoryManager&gt; categoryManager(do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l47.84"></a><span id="l47.84" class="difflineminus">-  if (NS_SUCCEEDED(rv)) </span>
<a href="#l47.85"></a><span id="l47.85" class="difflineminus">-      rv = categoryManager-&gt;AddCategoryEntry(APPSTARTUP_CATEGORY, &quot;PalmSync Support&quot;, </span>
<a href="#l47.86"></a><span id="l47.86" class="difflineminus">-                  &quot;service,&quot; NS_IPALMSYNCSUPPORT_CONTRACTID, PR_TRUE, PR_TRUE, nsnull);</span>
<a href="#l47.87"></a><span id="l47.87" class="difflineminus">-  return rv ;</span>
<a href="#l47.88"></a><span id="l47.88" class="difflineminus">-}</span>
<a href="#l47.89"></a><span id="l47.89" class="difflineminus">-</span>
<a href="#l47.90"></a><span id="l47.90" class="difflineminus">-static NS_METHOD nsPalmSyncUnRegistrationProc(nsIComponentManager *aCompMgr,</span>
<a href="#l47.91"></a><span id="l47.91" class="difflineminus">-                   nsIFile *aPath, const char *registryLocation, const nsModuleComponentInfo *info)</span>
<a href="#l47.92"></a><span id="l47.92" class="difflineminus">-{    </span>
<a href="#l47.93"></a><span id="l47.93" class="difflineminus">-    nsresult rv;</span>
<a href="#l47.94"></a><span id="l47.94" class="difflineminus">-    nsCOMPtr&lt;nsICategoryManager&gt; categoryManager(do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l47.95"></a><span id="l47.95" class="difflineminus">-    if (NS_SUCCEEDED(rv)) </span>
<a href="#l47.96"></a><span id="l47.96" class="difflineminus">-        rv = categoryManager-&gt;DeleteCategoryEntry(APPSTARTUP_CATEGORY, &quot;PalmSync Support&quot;, PR_TRUE);</span>
<a href="#l47.97"></a><span id="l47.97" class="difflineminus">- </span>
<a href="#l47.98"></a><span id="l47.98" class="difflineminus">-    return rv;</span>
<a href="#l47.99"></a><span id="l47.99" class="difflineminus">-}</span>
<a href="#l47.100"></a><span id="l47.100" class="difflineminus">-</span>
<a href="#l47.101"></a><span id="l47.101" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l47.102"></a><span id="l47.102" class="difflineminus">-nsPalmSyncSupport::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *aData)</span>
<a href="#l47.103"></a><span id="l47.103" class="difflineminus">-{</span>
<a href="#l47.104"></a><span id="l47.104" class="difflineminus">-    nsresult rv = NS_OK ;</span>
<a href="#l47.105"></a><span id="l47.105" class="difflineminus">-</span>
<a href="#l47.106"></a><span id="l47.106" class="difflineminus">-    // If nsIAppStartupNotifer tells us the app is starting up, then register</span>
<a href="#l47.107"></a><span id="l47.107" class="difflineminus">-    // our observer topics and return.</span>
<a href="#l47.108"></a><span id="l47.108" class="difflineminus">-    if (!strcmp(aTopic, &quot;app-startup&quot;))</span>
<a href="#l47.109"></a><span id="l47.109" class="difflineminus">-    {</span>
<a href="#l47.110"></a><span id="l47.110" class="difflineminus">-    nsCOMPtr&lt;nsIObserverService&gt; observerService(do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv));</span>
<a href="#l47.111"></a><span id="l47.111" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.112"></a><span id="l47.112" class="difflineminus">- </span>
<a href="#l47.113"></a><span id="l47.113" class="difflineminus">-    rv = observerService-&gt;AddObserver(this,&quot;profile-after-change&quot;, PR_FALSE);</span>
<a href="#l47.114"></a><span id="l47.114" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.115"></a><span id="l47.115" class="difflineminus">-</span>
<a href="#l47.116"></a><span id="l47.116" class="difflineminus">-      rv = observerService-&gt;AddObserver(this, &quot;em-action-requested&quot;, PR_FALSE);</span>
<a href="#l47.117"></a><span id="l47.117" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);      </span>
<a href="#l47.118"></a><span id="l47.118" class="difflineminus">-</span>
<a href="#l47.119"></a><span id="l47.119" class="difflineminus">-      rv = observerService-&gt;AddObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID, PR_FALSE);</span>
<a href="#l47.120"></a><span id="l47.120" class="difflineminus">-}</span>
<a href="#l47.121"></a><span id="l47.121" class="difflineminus">-    // otherwise, take the appropriate action based on the topic</span>
<a href="#l47.122"></a><span id="l47.122" class="difflineminus">-    else if (!strcmp(aTopic, &quot;profile-after-change&quot;))</span>
<a href="#l47.123"></a><span id="l47.123" class="difflineminus">-    {</span>
<a href="#l47.124"></a><span id="l47.124" class="difflineminus">-        // we can't call installPalmSync in app-startup because the extension manager hasn't been initialized yet. </span>
<a href="#l47.125"></a><span id="l47.125" class="difflineminus">-        // so we need to wait until the profile-after-change notification has fired. </span>
<a href="#l47.126"></a><span id="l47.126" class="difflineminus">-        rv = LaunchPalmSyncInstallExe(); </span>
<a href="#l47.127"></a><span id="l47.127" class="difflineminus">-        rv |= InitializePalmSyncSupport();</span>
<a href="#l47.128"></a><span id="l47.128" class="difflineminus">-    } </span>
<a href="#l47.129"></a><span id="l47.129" class="difflineminus">-    else if (!strcmp(aTopic, NS_XPCOM_SHUTDOWN_OBSERVER_ID))</span>
<a href="#l47.130"></a><span id="l47.130" class="difflineminus">-        rv = ShutdownPalmSyncSupport();</span>
<a href="#l47.131"></a><span id="l47.131" class="difflineminus">-    else if (aSubject &amp;&amp; !strcmp(aTopic, &quot;em-action-requested&quot;) &amp;&amp; !NS_strcmp(aData, NS_LITERAL_STRING(&quot;item-uninstalled&quot;).get()))</span>
<a href="#l47.132"></a><span id="l47.132" class="difflineminus">-    {</span>
<a href="#l47.133"></a><span id="l47.133" class="difflineminus">-        // make sure the subject is our extension.</span>
<a href="#l47.134"></a><span id="l47.134" class="difflineminus">-        nsCOMPtr&lt;nsIUpdateItem&gt; updateItem (do_QueryInterface(aSubject, &amp;rv));</span>
<a href="#l47.135"></a><span id="l47.135" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.136"></a><span id="l47.136" class="difflineminus">-</span>
<a href="#l47.137"></a><span id="l47.137" class="difflineminus">-        nsAutoString extensionName;</span>
<a href="#l47.138"></a><span id="l47.138" class="difflineminus">-        updateItem-&gt;GetId(extensionName);</span>
<a href="#l47.139"></a><span id="l47.139" class="difflineminus">-</span>
<a href="#l47.140"></a><span id="l47.140" class="difflineminus">-        if (extensionName.EqualsLiteral(EXTENSION_ID))</span>
<a href="#l47.141"></a><span id="l47.141" class="difflineminus">-        {</span>
<a href="#l47.142"></a><span id="l47.142" class="difflineminus">-            nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l47.143"></a><span id="l47.143" class="difflineminus">-            NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l47.144"></a><span id="l47.144" class="difflineminus">-           </span>
<a href="#l47.145"></a><span id="l47.145" class="difflineminus">-            // clear the conduit pref so we'll re-run PalmSyncInstall.exe the next time the extension is installed.</span>
<a href="#l47.146"></a><span id="l47.146" class="difflineminus">-            rv = prefBranch-&gt;ClearUserPref(PREF_CONDUIT_REGISTERED); </span>
<a href="#l47.147"></a><span id="l47.147" class="difflineminus">-</span>
<a href="#l47.148"></a><span id="l47.148" class="difflineminus">-            nsCOMPtr&lt;nsILocalFile&gt; palmSyncInstall;</span>
<a href="#l47.149"></a><span id="l47.149" class="difflineminus">-            rv = GetPalmSyncInstall(getter_AddRefs(palmSyncInstall));</span>
<a href="#l47.150"></a><span id="l47.150" class="difflineminus">-            NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.151"></a><span id="l47.151" class="difflineminus">-</span>
<a href="#l47.152"></a><span id="l47.152" class="difflineminus">-            nsCAutoString nativePath;</span>
<a href="#l47.153"></a><span id="l47.153" class="difflineminus">-            palmSyncInstall-&gt;GetNativePath(nativePath);</span>
<a href="#l47.154"></a><span id="l47.154" class="difflineminus">-        </span>
<a href="#l47.155"></a><span id="l47.155" class="difflineminus">-            LONG r = (LONG) ::ShellExecuteA( NULL, NULL, nativePath.get(), &quot;/u&quot;, NULL, SW_SHOWNORMAL);  // silent uninstall</span>
<a href="#l47.156"></a><span id="l47.156" class="difflineminus">-        }</span>
<a href="#l47.157"></a><span id="l47.157" class="difflineminus">-    }</span>
<a href="#l47.158"></a><span id="l47.158" class="difflineminus">-</span>
<a href="#l47.159"></a><span id="l47.159" class="difflineminus">-    return rv;</span>
<a href="#l47.160"></a><span id="l47.160" class="difflineminus">-}</span>
<a href="#l47.161"></a><span id="l47.161" class="difflineminus">-</span>
<a href="#l47.162"></a><span id="l47.162" class="difflineminus">-nsPalmSyncSupport::nsPalmSyncSupport()</span>
<a href="#l47.163"></a><span id="l47.163" class="difflineminus">-: m_dwRegister(0),</span>
<a href="#l47.164"></a><span id="l47.164" class="difflineminus">-  m_nsPalmSyncFactory(nsnull)</span>
<a href="#l47.165"></a><span id="l47.165" class="difflineminus">-{</span>
<a href="#l47.166"></a><span id="l47.166" class="difflineminus">-}</span>
<a href="#l47.167"></a><span id="l47.167" class="difflineminus">-</span>
<a href="#l47.168"></a><span id="l47.168" class="difflineminus">-nsPalmSyncSupport::~nsPalmSyncSupport()</span>
<a href="#l47.169"></a><span id="l47.169" class="difflineminus">-{</span>
<a href="#l47.170"></a><span id="l47.170" class="difflineminus">-}</span>
<a href="#l47.171"></a><span id="l47.171" class="difflineminus">-</span>
<a href="#l47.172"></a><span id="l47.172" class="difflineminus">-nsresult nsPalmSyncSupport::GetPalmSyncInstall(nsILocalFile ** aLocalFile)</span>
<a href="#l47.173"></a><span id="l47.173" class="difflineminus">-{</span>
<a href="#l47.174"></a><span id="l47.174" class="difflineminus">-    nsresult rv;</span>
<a href="#l47.175"></a><span id="l47.175" class="difflineminus">-    nsCOMPtr&lt;nsIExtensionManager&gt; em(do_GetService(&quot;@mozilla.org/extensions/manager;1&quot;, &amp;rv));</span>
<a href="#l47.176"></a><span id="l47.176" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.177"></a><span id="l47.177" class="difflineminus">-</span>
<a href="#l47.178"></a><span id="l47.178" class="difflineminus">-    nsCOMPtr&lt;nsIInstallLocation&gt; installLocation;</span>
<a href="#l47.179"></a><span id="l47.179" class="difflineminus">-    em-&gt;GetInstallLocation(NS_LITERAL_STRING(EXTENSION_ID), getter_AddRefs(installLocation));</span>
<a href="#l47.180"></a><span id="l47.180" class="difflineminus">-    if (!installLocation)</span>
<a href="#l47.181"></a><span id="l47.181" class="difflineminus">-      return NS_ERROR_FAILURE;</span>
<a href="#l47.182"></a><span id="l47.182" class="difflineminus">-</span>
<a href="#l47.183"></a><span id="l47.183" class="difflineminus">-    nsCOMPtr&lt;nsIFile&gt; palmSyncInstallExe;</span>
<a href="#l47.184"></a><span id="l47.184" class="difflineminus">-    rv = installLocation-&gt;GetItemFile(NS_LITERAL_STRING(EXTENSION_ID), NS_LITERAL_STRING(EXECUTABLE_FILENAME), getter_AddRefs(palmSyncInstallExe));</span>
<a href="#l47.185"></a><span id="l47.185" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.186"></a><span id="l47.186" class="difflineminus">-</span>
<a href="#l47.187"></a><span id="l47.187" class="difflineminus">-    palmSyncInstallExe-&gt;QueryInterface(NS_GET_IID(nsILocalFile), (void **) aLocalFile);</span>
<a href="#l47.188"></a><span id="l47.188" class="difflineminus">-    return rv;</span>
<a href="#l47.189"></a><span id="l47.189" class="difflineminus">-}</span>
<a href="#l47.190"></a><span id="l47.190" class="difflineminus">-</span>
<a href="#l47.191"></a><span id="l47.191" class="difflineminus">-nsresult nsPalmSyncSupport::LaunchPalmSyncInstallExe()</span>
<a href="#l47.192"></a><span id="l47.192" class="difflineminus">-{</span>
<a href="#l47.193"></a><span id="l47.193" class="difflineminus">-    // we only want to call PalmSyncInstall.exe the first time the app is run after installing the</span>
<a href="#l47.194"></a><span id="l47.194" class="difflineminus">-    // palm sync extension. We use PREF_CONDUIT_REGISTERED to keep track of that</span>
<a href="#l47.195"></a><span id="l47.195" class="difflineminus">-    // information.</span>
<a href="#l47.196"></a><span id="l47.196" class="difflineminus">-</span>
<a href="#l47.197"></a><span id="l47.197" class="difflineminus">-    nsresult rv;    </span>
<a href="#l47.198"></a><span id="l47.198" class="difflineminus">-    nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l47.199"></a><span id="l47.199" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l47.200"></a><span id="l47.200" class="difflineminus">-    </span>
<a href="#l47.201"></a><span id="l47.201" class="difflineminus">-    PRBool conduitIsRegistered = PR_FALSE;</span>
<a href="#l47.202"></a><span id="l47.202" class="difflineminus">-    rv = prefBranch-&gt;GetBoolPref(PREF_CONDUIT_REGISTERED, &amp;conduitIsRegistered);</span>
<a href="#l47.203"></a><span id="l47.203" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l47.204"></a><span id="l47.204" class="difflineminus">-</span>
<a href="#l47.205"></a><span id="l47.205" class="difflineminus">-    if (!conduitIsRegistered)</span>
<a href="#l47.206"></a><span id="l47.206" class="difflineminus">-    {        </span>
<a href="#l47.207"></a><span id="l47.207" class="difflineminus">-        rv = prefBranch-&gt;SetBoolPref(PREF_CONDUIT_REGISTERED, PR_TRUE); </span>
<a href="#l47.208"></a><span id="l47.208" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; palmSyncInstall;</span>
<a href="#l47.209"></a><span id="l47.209" class="difflineminus">-        rv = GetPalmSyncInstall(getter_AddRefs(palmSyncInstall));</span>
<a href="#l47.210"></a><span id="l47.210" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.211"></a><span id="l47.211" class="difflineminus">-</span>
<a href="#l47.212"></a><span id="l47.212" class="difflineminus">-        // Get our app name.</span>
<a href="#l47.213"></a><span id="l47.213" class="difflineminus">-        nsCOMPtr&lt;nsIXULAppInfo&gt; appInfo = </span>
<a href="#l47.214"></a><span id="l47.214" class="difflineminus">-          do_GetService(&quot;@mozilla.org/xre/app-info;1&quot;, &amp;rv);</span>
<a href="#l47.215"></a><span id="l47.215" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.216"></a><span id="l47.216" class="difflineminus">-</span>
<a href="#l47.217"></a><span id="l47.217" class="difflineminus">-        nsCAutoString appName;</span>
<a href="#l47.218"></a><span id="l47.218" class="difflineminus">-        rv = appInfo-&gt;GetName(appName);</span>
<a href="#l47.219"></a><span id="l47.219" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.220"></a><span id="l47.220" class="difflineminus">-</span>
<a href="#l47.221"></a><span id="l47.221" class="difflineminus">-        nsCAutoString args(NS_LITERAL_CSTRING(&quot;/n&quot;));</span>
<a href="#l47.222"></a><span id="l47.222" class="difflineminus">-        args.Append(appName);</span>
<a href="#l47.223"></a><span id="l47.223" class="difflineminus">-</span>
<a href="#l47.224"></a><span id="l47.224" class="difflineminus">-        // nsILocalFile-&gt;Launch doesn't accept arguments so we'll have to</span>
<a href="#l47.225"></a><span id="l47.225" class="difflineminus">-	// do it ourselves</span>
<a href="#l47.226"></a><span id="l47.226" class="difflineminus">-        nsString path;</span>
<a href="#l47.227"></a><span id="l47.227" class="difflineminus">-        rv = palmSyncInstall-&gt;GetPath(path);</span>
<a href="#l47.228"></a><span id="l47.228" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.229"></a><span id="l47.229" class="difflineminus">-</span>
<a href="#l47.230"></a><span id="l47.230" class="difflineminus">-        LONG r = (LONG)::ShellExecuteW(NULL, NULL, path.get(),</span>
<a href="#l47.231"></a><span id="l47.231" class="difflineminus">-				       NS_ConvertUTF8toUTF16(args).get(),</span>
<a href="#l47.232"></a><span id="l47.232" class="difflineminus">-				       NULL, SW_SHOWNORMAL);</span>
<a href="#l47.233"></a><span id="l47.233" class="difflineminus">-</span>
<a href="#l47.234"></a><span id="l47.234" class="difflineminus">-        if (r &lt; 32)</span>
<a href="#l47.235"></a><span id="l47.235" class="difflineminus">-          rv = NS_ERROR_FAILURE;</span>
<a href="#l47.236"></a><span id="l47.236" class="difflineminus">-    }</span>
<a href="#l47.237"></a><span id="l47.237" class="difflineminus">-</span>
<a href="#l47.238"></a><span id="l47.238" class="difflineminus">-    return rv;</span>
<a href="#l47.239"></a><span id="l47.239" class="difflineminus">-}</span>
<a href="#l47.240"></a><span id="l47.240" class="difflineminus">-</span>
<a href="#l47.241"></a><span id="l47.241" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l47.242"></a><span id="l47.242" class="difflineminus">-nsPalmSyncSupport::InitializePalmSyncSupport()</span>
<a href="#l47.243"></a><span id="l47.243" class="difflineminus">-{</span>
<a href="#l47.244"></a><span id="l47.244" class="difflineminus">-    ::CoInitialize(nsnull) ;</span>
<a href="#l47.245"></a><span id="l47.245" class="difflineminus">-</span>
<a href="#l47.246"></a><span id="l47.246" class="difflineminus">-    if (m_nsPalmSyncFactory == nsnull)    // No Registering if already done.  Sanity Check!!</span>
<a href="#l47.247"></a><span id="l47.247" class="difflineminus">-    {</span>
<a href="#l47.248"></a><span id="l47.248" class="difflineminus">-        m_nsPalmSyncFactory = new CPalmSyncFactory();</span>
<a href="#l47.249"></a><span id="l47.249" class="difflineminus">-</span>
<a href="#l47.250"></a><span id="l47.250" class="difflineminus">-        if (m_nsPalmSyncFactory != nsnull)</span>
<a href="#l47.251"></a><span id="l47.251" class="difflineminus">-        {</span>
<a href="#l47.252"></a><span id="l47.252" class="difflineminus">-            HRESULT hr = ::CoRegisterClassObject(CLSID_CPalmSyncImp, \</span>
<a href="#l47.253"></a><span id="l47.253" class="difflineminus">-                                                 m_nsPalmSyncFactory, \</span>
<a href="#l47.254"></a><span id="l47.254" class="difflineminus">-                                                 CLSCTX_LOCAL_SERVER, \</span>
<a href="#l47.255"></a><span id="l47.255" class="difflineminus">-                                                 REGCLS_MULTIPLEUSE, \</span>
<a href="#l47.256"></a><span id="l47.256" class="difflineminus">-                                                 &amp;m_dwRegister);</span>
<a href="#l47.257"></a><span id="l47.257" class="difflineminus">-</span>
<a href="#l47.258"></a><span id="l47.258" class="difflineminus">-            if (FAILED(hr))</span>
<a href="#l47.259"></a><span id="l47.259" class="difflineminus">-            {</span>
<a href="#l47.260"></a><span id="l47.260" class="difflineminus">-                m_nsPalmSyncFactory-&gt;Release() ;</span>
<a href="#l47.261"></a><span id="l47.261" class="difflineminus">-                m_nsPalmSyncFactory = nsnull;</span>
<a href="#l47.262"></a><span id="l47.262" class="difflineminus">-                return NS_ERROR_FAILURE;</span>
<a href="#l47.263"></a><span id="l47.263" class="difflineminus">-            }</span>
<a href="#l47.264"></a><span id="l47.264" class="difflineminus">-	    RegisterPalmSync();</span>
<a href="#l47.265"></a><span id="l47.265" class="difflineminus">-        }</span>
<a href="#l47.266"></a><span id="l47.266" class="difflineminus">-    }</span>
<a href="#l47.267"></a><span id="l47.267" class="difflineminus">-</span>
<a href="#l47.268"></a><span id="l47.268" class="difflineminus">-    return NS_OK;</span>
<a href="#l47.269"></a><span id="l47.269" class="difflineminus">-}</span>
<a href="#l47.270"></a><span id="l47.270" class="difflineminus">-</span>
<a href="#l47.271"></a><span id="l47.271" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l47.272"></a><span id="l47.272" class="difflineminus">-nsPalmSyncSupport::ShutdownPalmSyncSupport()</span>
<a href="#l47.273"></a><span id="l47.273" class="difflineminus">-{</span>
<a href="#l47.274"></a><span id="l47.274" class="difflineminus">-    if (m_dwRegister != 0)</span>
<a href="#l47.275"></a><span id="l47.275" class="difflineminus">-        ::CoRevokeClassObject(m_dwRegister);</span>
<a href="#l47.276"></a><span id="l47.276" class="difflineminus">-</span>
<a href="#l47.277"></a><span id="l47.277" class="difflineminus">-    if (m_nsPalmSyncFactory != nsnull)</span>
<a href="#l47.278"></a><span id="l47.278" class="difflineminus">-    {</span>
<a href="#l47.279"></a><span id="l47.279" class="difflineminus">-        m_nsPalmSyncFactory-&gt;Release();</span>
<a href="#l47.280"></a><span id="l47.280" class="difflineminus">-        m_nsPalmSyncFactory = nsnull;</span>
<a href="#l47.281"></a><span id="l47.281" class="difflineminus">-    }</span>
<a href="#l47.282"></a><span id="l47.282" class="difflineminus">-</span>
<a href="#l47.283"></a><span id="l47.283" class="difflineminus">-    ::CoUninitialize();</span>
<a href="#l47.284"></a><span id="l47.284" class="difflineminus">-</span>
<a href="#l47.285"></a><span id="l47.285" class="difflineminus">-    return NS_OK ;</span>
<a href="#l47.286"></a><span id="l47.286" class="difflineminus">-}</span>
<a href="#l47.287"></a><span id="l47.287" class="difflineminus">-</span>
<a href="#l47.288"></a><span id="l47.288" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l47.289"></a><span id="l47.289" class="difflineminus">-nsPalmSyncSupport::RegisterPalmSync()</span>
<a href="#l47.290"></a><span id="l47.290" class="difflineminus">-{</span>
<a href="#l47.291"></a><span id="l47.291" class="difflineminus">-    return RegisterServerForPalmSync(CLSID_CPalmSyncImp, &quot;Mozilla PalmSync&quot;, &quot;MozillaPalmSync&quot;, &quot;MozillaPalmSync.1&quot;);</span>
<a href="#l47.292"></a><span id="l47.292" class="difflineminus">-}</span>
<a href="#l47.293"></a><span id="l47.293" class="difflineminus">-</span>
<a href="#l47.294"></a><span id="l47.294" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l47.295"></a><span id="l47.295" class="difflineminus">-nsPalmSyncSupport::UnRegisterPalmSync()</span>
<a href="#l47.296"></a><span id="l47.296" class="difflineminus">-{</span>
<a href="#l47.297"></a><span id="l47.297" class="difflineminus">-    return UnregisterServerForPalmSync(CLSID_CPalmSyncImp, &quot;MozillaPalmSync&quot;, &quot;MozillaPalmSync.1&quot;);</span>
<a href="#l47.298"></a><span id="l47.298" class="difflineminus">-}</span>
<a href="#l47.299"></a><span id="l47.299" class="difflineminus">-</span>
<a href="#l47.300"></a><span id="l47.300" class="difflineminus">-</span>
<a href="#l47.301"></a><span id="l47.301" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR(nsPalmSyncSupport)</span>
<a href="#l47.302"></a><span id="l47.302" class="difflineminus">-</span>
<a href="#l47.303"></a><span id="l47.303" class="difflineminus">-// The list of components we register</span>
<a href="#l47.304"></a><span id="l47.304" class="difflineminus">-static const nsModuleComponentInfo components[] = </span>
<a href="#l47.305"></a><span id="l47.305" class="difflineminus">-{</span>
<a href="#l47.306"></a><span id="l47.306" class="difflineminus">-    {</span>
<a href="#l47.307"></a><span id="l47.307" class="difflineminus">-        NS_IPALMSYNCSUPPORT_CLASSNAME,</span>
<a href="#l47.308"></a><span id="l47.308" class="difflineminus">-        NS_IPALMSYNCSUPPORT_CID,</span>
<a href="#l47.309"></a><span id="l47.309" class="difflineminus">-        NS_IPALMSYNCSUPPORT_CONTRACTID,</span>
<a href="#l47.310"></a><span id="l47.310" class="difflineminus">-        nsPalmSyncSupportConstructor,</span>
<a href="#l47.311"></a><span id="l47.311" class="difflineminus">-        nsPalmSyncRegistrationProc,</span>
<a href="#l47.312"></a><span id="l47.312" class="difflineminus">-        nsnull</span>
<a href="#l47.313"></a><span id="l47.313" class="difflineminus">-    }</span>
<a href="#l47.314"></a><span id="l47.314" class="difflineminus">-};</span>
<a href="#l47.315"></a><span id="l47.315" class="difflineminus">-</span>
<a href="#l47.316"></a><span id="l47.316" class="difflineminus">-NS_IMPL_NSGETMODULE(PalmSyncModule, components)</span>
<a href="#l47.317"></a><span id="l47.317" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1">deleted file mode 100644</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineminus">--- a/mailnews/extensions/palmsync/src/nsPalmSyncSupport.h</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineplus">+++ /dev/null</span>
<a href="#l48.4"></a><span id="l48.4" class="difflineat">@@ -1,74 +0,0 @@</span>
<a href="#l48.5"></a><span id="l48.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l48.6"></a><span id="l48.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l48.7"></a><span id="l48.7" class="difflineminus">- *</span>
<a href="#l48.8"></a><span id="l48.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l48.9"></a><span id="l48.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l48.10"></a><span id="l48.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l48.11"></a><span id="l48.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">- *</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l48.14"></a><span id="l48.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l48.15"></a><span id="l48.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l48.16"></a><span id="l48.16" class="difflineminus">- * License.</span>
<a href="#l48.17"></a><span id="l48.17" class="difflineminus">- *</span>
<a href="#l48.18"></a><span id="l48.18" class="difflineminus">- * The Original Code is Mozilla</span>
<a href="#l48.19"></a><span id="l48.19" class="difflineminus">- *</span>
<a href="#l48.20"></a><span id="l48.20" class="difflineminus">- * The Initial Developer of the Original Code is </span>
<a href="#l48.21"></a><span id="l48.21" class="difflineminus">- * Netscape Communications Corp.</span>
<a href="#l48.22"></a><span id="l48.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l48.23"></a><span id="l48.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l48.24"></a><span id="l48.24" class="difflineminus">- *</span>
<a href="#l48.25"></a><span id="l48.25" class="difflineminus">- * Contributor(s): </span>
<a href="#l48.26"></a><span id="l48.26" class="difflineminus">- *           Rajiv Dayal &lt;rdayal@netscape.com&gt;</span>
<a href="#l48.27"></a><span id="l48.27" class="difflineminus">- *</span>
<a href="#l48.28"></a><span id="l48.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l48.29"></a><span id="l48.29" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l48.30"></a><span id="l48.30" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l48.31"></a><span id="l48.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l48.32"></a><span id="l48.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l48.33"></a><span id="l48.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l48.34"></a><span id="l48.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l48.35"></a><span id="l48.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l48.36"></a><span id="l48.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l48.37"></a><span id="l48.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l48.38"></a><span id="l48.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l48.39"></a><span id="l48.39" class="difflineminus">- *</span>
<a href="#l48.40"></a><span id="l48.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l48.41"></a><span id="l48.41" class="difflineminus">-</span>
<a href="#l48.42"></a><span id="l48.42" class="difflineminus">-#ifndef MSG_PALMSYNC_SUPPORT_H_</span>
<a href="#l48.43"></a><span id="l48.43" class="difflineminus">-#define MSG_PALMSYNC_SUPPORT_H_</span>
<a href="#l48.44"></a><span id="l48.44" class="difflineminus">-</span>
<a href="#l48.45"></a><span id="l48.45" class="difflineminus">-#include &quot;nsIObserver.h&quot;</span>
<a href="#l48.46"></a><span id="l48.46" class="difflineminus">-#include &quot;nsIPalmSyncSupport.h&quot;</span>
<a href="#l48.47"></a><span id="l48.47" class="difflineminus">-#include &quot;PalmSyncFactory.h&quot;</span>
<a href="#l48.48"></a><span id="l48.48" class="difflineminus">-</span>
<a href="#l48.49"></a><span id="l48.49" class="difflineminus">-class nsILocalFile;</span>
<a href="#l48.50"></a><span id="l48.50" class="difflineminus">-</span>
<a href="#l48.51"></a><span id="l48.51" class="difflineminus">-// {44812571-CE84-11d6-B8A6-00B0D06E5F27}</span>
<a href="#l48.52"></a><span id="l48.52" class="difflineminus">-#define NS_IPALMSYNCSUPPORT_CID \</span>
<a href="#l48.53"></a><span id="l48.53" class="difflineminus">-  { 0x44812571, 0xce84, 0x11d6, \</span>
<a href="#l48.54"></a><span id="l48.54" class="difflineminus">-    { 0xb8, 0xa6, 0x0, 0xb0, 0xd0, 0x6e, 0x5f, 0x27 } }</span>
<a href="#l48.55"></a><span id="l48.55" class="difflineminus">-</span>
<a href="#l48.56"></a><span id="l48.56" class="difflineminus">-</span>
<a href="#l48.57"></a><span id="l48.57" class="difflineminus">-class nsPalmSyncSupport : public nsIPalmSyncSupport,</span>
<a href="#l48.58"></a><span id="l48.58" class="difflineminus">-                      public nsIObserver</span>
<a href="#l48.59"></a><span id="l48.59" class="difflineminus">-{</span>
<a href="#l48.60"></a><span id="l48.60" class="difflineminus">-    public :</span>
<a href="#l48.61"></a><span id="l48.61" class="difflineminus">-        nsPalmSyncSupport();</span>
<a href="#l48.62"></a><span id="l48.62" class="difflineminus">-        ~nsPalmSyncSupport();</span>
<a href="#l48.63"></a><span id="l48.63" class="difflineminus">-</span>
<a href="#l48.64"></a><span id="l48.64" class="difflineminus">-        // Declare all interface methods we must implement.</span>
<a href="#l48.65"></a><span id="l48.65" class="difflineminus">-        NS_DECL_ISUPPORTS</span>
<a href="#l48.66"></a><span id="l48.66" class="difflineminus">-        NS_DECL_NSIOBSERVER</span>
<a href="#l48.67"></a><span id="l48.67" class="difflineminus">-        NS_DECL_NSIPALMSYNCSUPPORT</span>
<a href="#l48.68"></a><span id="l48.68" class="difflineminus">-</span>
<a href="#l48.69"></a><span id="l48.69" class="difflineminus">-    private :</span>
<a href="#l48.70"></a><span id="l48.70" class="difflineminus">-</span>
<a href="#l48.71"></a><span id="l48.71" class="difflineminus">-        DWORD   m_dwRegister;</span>
<a href="#l48.72"></a><span id="l48.72" class="difflineminus">-        CPalmSyncFactory *m_nsPalmSyncFactory;</span>
<a href="#l48.73"></a><span id="l48.73" class="difflineminus">-</span>
<a href="#l48.74"></a><span id="l48.74" class="difflineminus">-        nsresult LaunchPalmSyncInstallExe();</span>
<a href="#l48.75"></a><span id="l48.75" class="difflineminus">-        nsresult GetPalmSyncInstall(nsILocalFile ** aLocalFile);</span>
<a href="#l48.76"></a><span id="l48.76" class="difflineminus">-};</span>
<a href="#l48.77"></a><span id="l48.77" class="difflineminus">-</span>
<a href="#l48.78"></a><span id="l48.78" class="difflineminus">-#endif  // MSG_PALMSYNC_SUPPORT_H_</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/test/performance/common/mailnewsTestPrefs.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/test/performance/common/mailnewsTestPrefs.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l49.4"></a><span id="l49.4"> // This set of prefs is copyied over the defaults that build-seamonkey-util.pl</span>
<a href="#l49.5"></a><span id="l49.5"> // sets up.</span>
<a href="#l49.6"></a><span id="l49.6"> user_pref(&quot;browser.dom.window.dump.enabled&quot;, true);</span>
<a href="#l49.7"></a><span id="l49.7"> // no slow script dialogs</span>
<a href="#l49.8"></a><span id="l49.8"> user_pref(&quot;dom.max_chrome_script_run_time&quot;, 200);</span>
<a href="#l49.9"></a><span id="l49.9"> user_pref(&quot;dom.max_script_run_time&quot;, 0);</span>
<a href="#l49.10"></a><span id="l49.10" class="difflineminus">-user_pref(&quot;extensions.palmsync.conduitRegistered&quot;, true);</span>
<a href="#l49.11"></a><span id="l49.11"> user_pref(&quot;mail.account.account1.server&quot;, &quot;server1&quot;);</span>
<a href="#l49.12"></a><span id="l49.12"> user_pref(&quot;mail.account.account2.identities&quot;, &quot;id1&quot;);</span>
<a href="#l49.13"></a><span id="l49.13"> user_pref(&quot;mail.account.account2.server&quot;, &quot;server2&quot;);</span>
<a href="#l49.14"></a><span id="l49.14"> user_pref(&quot;mail.accountmanager.accounts&quot;, &quot;account1,account2&quot;);</span>
<a href="#l49.15"></a><span id="l49.15"> user_pref(&quot;mail.accountmanager.defaultaccount&quot;, &quot;account2&quot;);</span>
<a href="#l49.16"></a><span id="l49.16"> user_pref(&quot;mail.accountmanager.localfoldersserver&quot;, &quot;server1&quot;);</span>
<a href="#l49.17"></a><span id="l49.17"> user_pref(&quot;mail.identity.id1.fullName&quot;, &quot;Tinderbox&quot;);</span>
<a href="#l49.18"></a><span id="l49.18"> user_pref(&quot;mail.identity.id1.smtpServer&quot;, &quot;smtp1&quot;);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

