<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 18504:9579c61e62f5bdf1ac39e97074fec5b259d80256</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 9579c61e62f5bdf1ac39e97074fec5b259d80256" />
<meta property="og:url" content="/comm-central/rev/9579c61e62f5bdf1ac39e97074fec5b259d80256" />
<meta property="og:description" content="Bug 1212462 - Rename nsRefPtr&lt;T&gt; to RefPtr&lt;T&gt; due to mozilla-central Bug 1207245 rs=Ratty a=Ratty bustage fix CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 9579c61e62f5bdf1ac39e97074fec5b259d80256 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/9579c61e62f5bdf1ac39e97074fec5b259d80256">shortlog</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/9579c61e62f5bdf1ac39e97074fec5b259d80256">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256">files</a> |
changeset |
<a href="/comm-central/raw-rev/9579c61e62f5bdf1ac39e97074fec5b259d80256">raw</a>  | <a href="/comm-central/archive/9579c61e62f5bdf1ac39e97074fec5b259d80256.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1212462">Bug 1212462</a> - Rename nsRefPtr&lt;T&gt; to RefPtr&lt;T&gt; due to mozilla-central <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1207245">Bug 1207245</a> rs=Ratty a=Ratty bustage fix CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#114;&#97;&#110;&#107;&#45;&#82;&#97;&#105;&#110;&#101;&#114;&#32;&#71;&#114;&#97;&#104;&#108;&#32;&#102;&#114;&#103;&#114;&#97;&#104;&#108;&#64;&#103;&#109;&#120;&#46;&#110;&#101;&#116;</td></tr>
<tr><td></td><td class="date age">Mon, 19 Oct 2015 03:17:36 +0800</td></tr>

<tr>
 <td>changeset 18504</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/9579c61e62f5bdf1ac39e97074fec5b259d80256">9579c61e62f5bdf1ac39e97074fec5b259d80256</a></td>
</tr>



<tr>
<td>parent 18503</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/dff28c2b43af5b1df1bab8efec9f3153433f0e1e">dff28c2b43af5b1df1bab8efec9f3153433f0e1e</a>
</td>
</tr>

<tr>
<td>child 18505</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/15fa117f0444d6cb96325c42f6264d5834fbf890">15fa117f0444d6cb96325c42f6264d5834fbf890</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=9579c61e62f5bdf1ac39e97074fec5b259d80256">11322</a></td></tr>
<tr><td>push user</td><td>philip.chee@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 18 Oct 2015 19:29:07 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9579c61e62f5 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9579c61e62f5bdf1ac39e97074fec5b259d80256">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9579c61e62f5bdf1ac39e97074fec5b259d80256&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9579c61e62f5bdf1ac39e97074fec5b259d80256&newProject=comm-central&newRevision=9579c61e62f5bdf1ac39e97074fec5b259d80256&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9579c61e62f5bdf1ac39e97074fec5b259d80256&newProject=comm-central&newRevision=9579c61e62f5bdf1ac39e97074fec5b259d80256&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9579c61e62f5bdf1ac39e97074fec5b259d80256&newProject=comm-central&newRevision=9579c61e62f5bdf1ac39e97074fec5b259d80256&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Ratty%29&revcount=50">Ratty</a>, <a href="/comm-central/log?rev=reviewer%28Ratty%29&revcount=50">Ratty</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1212462">1212462</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1207245">1207245</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1212462">Bug 1212462</a> - Rename nsRefPtr&lt;T&gt; to RefPtr&lt;T&gt; due to mozilla-central <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1207245">Bug 1207245</a> rs=Ratty a=Ratty bustage fix CLOSED TREE</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/im/components/mintrayr/trayToolkit.cpp">im/components/mintrayr/trayToolkit.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/im/components/mintrayr/trayToolkit.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/im/components/mintrayr/trayToolkit.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/im/components/mintrayr/trayToolkit.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/im/components/mintrayr/trayToolkit.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/im/components/mintrayr/trayToolkit.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.cpp">ldap/xpcom/src/nsLDAPConnection.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.h">ldap/xpcom/src/nsLDAPConnection.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPConnection.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.cpp">ldap/xpcom/src/nsLDAPOperation.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.h">ldap/xpcom/src/nsLDAPOperation.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/ldap/xpcom/src/nsLDAPOperation.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mail/components/search/nsMailWinSearchHelper.cpp">mail/components/search/nsMailWinSearchHelper.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mail/components/search/nsMailWinSearchHelper.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mail/components/search/nsMailWinSearchHelper.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mail/components/search/nsMailWinSearchHelper.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mail/components/search/nsMailWinSearchHelper.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mail/components/search/nsMailWinSearchHelper.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddbookUrl.cpp">mailnews/addrbook/src/nsAddbookUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddbookUrl.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddbookUrl.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddbookUrl.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddbookUrl.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddbookUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddrDatabase.cpp">mailnews/addrbook/src/nsAddrDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddrDatabase.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddrDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddrDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddrDatabase.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/addrbook/src/nsAddrDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgFilterService.cpp">mailnews/base/search/src/nsMsgFilterService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgFilterService.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgFilterService.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgFilterService.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgFilterService.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgFilterService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.cpp">mailnews/base/search/src/nsMsgSearchSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.h">mailnews/base/search/src/nsMsgSearchSession.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/search/src/nsMsgSearchSession.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.h">mailnews/base/src/nsMsgAccountManager.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgAccountManager.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgDBView.h">mailnews/base/src/nsMsgDBView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgDBView.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgDBView.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgDBView.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgDBView.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgDBView.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgFolderCompactor.h">mailnews/base/src/nsMsgFolderCompactor.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgFolderCompactor.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgFolderCompactor.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgFolderCompactor.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgFolderCompactor.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgFolderCompactor.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgPrintEngine.cpp">mailnews/base/src/nsMsgPrintEngine.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgPrintEngine.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgPrintEngine.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgPrintEngine.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgPrintEngine.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/src/nsMsgPrintEngine.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/build/nsMailModule.cpp">mailnews/build/nsMailModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/build/nsMailModule.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/build/nsMailModule.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/build/nsMailModule.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/build/nsMailModule.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/build/nsMailModule.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/public/nsIMsgSend.idl">mailnews/compose/public/nsIMsgSend.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/public/nsIMsgSend.idl">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/public/nsIMsgSend.idl">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/public/nsIMsgSend.idl">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/public/nsIMsgSend.idl">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/public/nsIMsgSend.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgAttachmentHandler.cpp">mailnews/compose/src/nsMsgAttachmentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgAttachmentHandler.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgAttachmentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgAttachmentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgAttachmentHandler.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgAttachmentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCopy.cpp">mailnews/compose/src/nsMsgCopy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCopy.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCopy.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCopy.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCopy.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgCopy.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.h">mailnews/compose/src/nsMsgSend.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsMsgSend.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpService.cpp">mailnews/compose/src/nsSmtpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpService.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpService.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpService.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpService.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpUrl.cpp">mailnews/compose/src/nsSmtpUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpUrl.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpUrl.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpUrl.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpUrl.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsSmtpUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsURLFetcher.h">mailnews/compose/src/nsURLFetcher.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsURLFetcher.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsURLFetcher.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsURLFetcher.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsURLFetcher.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/compose/src/nsURLFetcher.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgDatabase.h">mailnews/db/msgdb/public/nsMsgDatabase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgDatabase.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgDatabase.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgDatabase.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgDatabase.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgDatabase.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgThread.h">mailnews/db/msgdb/public/nsMsgThread.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgThread.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgThread.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgThread.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgThread.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/public/nsMsgThread.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgHdr.cpp">mailnews/db/msgdb/src/nsMsgHdr.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgHdr.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgHdr.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgHdr.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgHdr.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/db/msgdb/src/nsMsgHdr.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsAutoSyncState.cpp">mailnews/imap/src/nsAutoSyncState.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsAutoSyncState.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsAutoSyncState.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsAutoSyncState.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsAutoSyncState.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsAutoSyncState.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsIMAPBodyShell.cpp">mailnews/imap/src/nsIMAPBodyShell.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsIMAPBodyShell.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsIMAPBodyShell.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsIMAPBodyShell.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsIMAPBodyShell.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsIMAPBodyShell.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.h">mailnews/imap/src/nsImapMailFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapMailFolder.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.h">mailnews/imap/src/nsImapProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapServerResponseParser.h">mailnews/imap/src/nsImapServerResponseParser.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapServerResponseParser.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapServerResponseParser.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapServerResponseParser.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapServerResponseParser.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsImapServerResponseParser.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsSyncRunnableHelpers.cpp">mailnews/imap/src/nsSyncRunnableHelpers.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsSyncRunnableHelpers.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsSyncRunnableHelpers.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsSyncRunnableHelpers.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsSyncRunnableHelpers.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/src/nsSyncRunnableHelpers.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapFlagAndUidState.cpp">mailnews/imap/test/TestImapFlagAndUidState.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapFlagAndUidState.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapFlagAndUidState.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapFlagAndUidState.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapFlagAndUidState.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapFlagAndUidState.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapHdrXferInfo.cpp">mailnews/imap/test/TestImapHdrXferInfo.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapHdrXferInfo.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapHdrXferInfo.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapHdrXferInfo.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapHdrXferInfo.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/imap/test/TestImapHdrXferInfo.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportMail.cpp">mailnews/import/src/nsImportMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportMail.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportMail.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportMail.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportMail.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportService.cpp">mailnews/import/src/nsImportService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportService.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportService.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportService.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportService.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/import/src/nsImportService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.h">mailnews/local/src/nsLocalMailFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsLocalMailFolder.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMailboxService.cpp">mailnews/local/src/nsMailboxService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMailboxService.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMailboxService.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMailboxService.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMailboxService.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMailboxService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMovemailService.cpp">mailnews/local/src/nsMovemailService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMovemailService.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMovemailService.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMovemailService.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMovemailService.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMovemailService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgBrkMBoxStore.cpp">mailnews/local/src/nsMsgBrkMBoxStore.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgBrkMBoxStore.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgBrkMBoxStore.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgBrkMBoxStore.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgBrkMBoxStore.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgBrkMBoxStore.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgMaildirStore.cpp">mailnews/local/src/nsMsgMaildirStore.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgMaildirStore.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgMaildirStore.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgMaildirStore.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgMaildirStore.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsMsgMaildirStore.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsParseMailbox.h">mailnews/local/src/nsParseMailbox.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsParseMailbox.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsParseMailbox.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsParseMailbox.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsParseMailbox.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsParseMailbox.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3IncomingServer.cpp">mailnews/local/src/nsPop3IncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3IncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3IncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3IncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3IncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3IncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Service.cpp">mailnews/local/src/nsPop3Service.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Service.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Service.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Service.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Service.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Service.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Sink.h">mailnews/local/src/nsPop3Sink.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Sink.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Sink.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Sink.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Sink.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/local/src/nsPop3Sink.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">mailnews/mime/emitters/nsMimeHtmlEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/mimecms.cpp">mailnews/mime/src/mimecms.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/mimecms.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/mimecms.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/mimecms.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/mimecms.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/mimecms.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/nsSimpleMimeConverterStub.cpp">mailnews/mime/src/nsSimpleMimeConverterStub.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/nsSimpleMimeConverterStub.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/nsSimpleMimeConverterStub.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/nsSimpleMimeConverterStub.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/nsSimpleMimeConverterStub.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/mime/src/nsSimpleMimeConverterStub.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNNTPArticleList.cpp">mailnews/news/src/nsNNTPArticleList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNNTPArticleList.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNNTPArticleList.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNNTPArticleList.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNNTPArticleList.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNNTPArticleList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.h">mailnews/news/src/nsNntpIncomingServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.h">file</a> |
<a href="/comm-central/annotate/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.h">annotate</a> |
<a href="/comm-central/diff/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.h">diff</a> |
<a href="/comm-central/comparison/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.h">comparison</a> |
<a href="/comm-central/log/9579c61e62f5bdf1ac39e97074fec5b259d80256/mailnews/news/src/nsNntpIncomingServer.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/im/components/mintrayr/trayToolkit.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/im/components/mintrayr/trayToolkit.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -311,17 +311,17 @@ NS_IMETHODIMP TrayServiceImpl::CreateIco</span>
<a href="#l1.4"></a><span id="l1.4">     if (domWindow != aWindow) {</span>
<a href="#l1.5"></a><span id="l1.5">       continue;</span>
<a href="#l1.6"></a><span id="l1.6">     }</span>
<a href="#l1.7"></a><span id="l1.7">     *aResult = mIcons[i];</span>
<a href="#l1.8"></a><span id="l1.8">     NS_ADDREF(*aResult);</span>
<a href="#l1.9"></a><span id="l1.9">     return NS_OK;</span>
<a href="#l1.10"></a><span id="l1.10">   }</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  nsRefPtr&lt;TrayIconImpl&gt; icon = new TrayIconImpl(this);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  RefPtr&lt;TrayIconImpl&gt; icon = new TrayIconImpl(this);</span>
<a href="#l1.14"></a><span id="l1.14">   rv = icon-&gt;Init(aWindow, aCloseOnRestore);</span>
<a href="#l1.15"></a><span id="l1.15">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l1.16"></a><span id="l1.16">     mIcons.AppendObject(icon);</span>
<a href="#l1.17"></a><span id="l1.17">     if (aResult) {</span>
<a href="#l1.18"></a><span id="l1.18">       icon.forget(aResult);</span>
<a href="#l1.19"></a><span id="l1.19">     }</span>
<a href="#l1.20"></a><span id="l1.20">   }</span>
<a href="#l1.21"></a><span id="l1.21">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPConnection.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPConnection.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -389,17 +389,17 @@ class nsOnLDAPMessageRunnable : public n</span>
<a href="#l2.4"></a><span id="l2.4"> {</span>
<a href="#l2.5"></a><span id="l2.5"> public:</span>
<a href="#l2.6"></a><span id="l2.6">   nsOnLDAPMessageRunnable(nsLDAPMessage *aMsg, bool aClear)</span>
<a href="#l2.7"></a><span id="l2.7">     : m_msg(aMsg)</span>
<a href="#l2.8"></a><span id="l2.8">     , m_clear(aClear)</span>
<a href="#l2.9"></a><span id="l2.9">   {}</span>
<a href="#l2.10"></a><span id="l2.10">   NS_DECL_NSIRUNNABLE</span>
<a href="#l2.11"></a><span id="l2.11"> private:</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  nsRefPtr&lt;nsLDAPMessage&gt; m_msg;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  RefPtr&lt;nsLDAPMessage&gt; m_msg;</span>
<a href="#l2.14"></a><span id="l2.14">   bool m_clear;</span>
<a href="#l2.15"></a><span id="l2.15"> };</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17"> NS_IMETHODIMP nsOnLDAPMessageRunnable::Run()</span>
<a href="#l2.18"></a><span id="l2.18"> {</span>
<a href="#l2.19"></a><span id="l2.19">   // get the message listener object.</span>
<a href="#l2.20"></a><span id="l2.20">   nsLDAPOperation *nsoperation = static_cast&lt;nsLDAPOperation *&gt;(m_msg-&gt;mOperation.get());</span>
<a href="#l2.21"></a><span id="l2.21">   nsCOMPtr&lt;nsILDAPMessageListener&gt; listener;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -440,17 +440,17 @@ nsLDAPConnection::InvokeMessageCallback(</span>
<a href="#l2.23"></a><span id="l2.23">   }</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25">   NS_ENSURE_TRUE(operation, NS_ERROR_NULL_POINTER);</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27">   nsLDAPMessage *msg = static_cast&lt;nsLDAPMessage *&gt;(aMsg);</span>
<a href="#l2.28"></a><span id="l2.28">   msg-&gt;mOperation = operation;</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30">   // proxy the listener callback to the ui thread.</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-  nsRefPtr&lt;nsOnLDAPMessageRunnable&gt; runnable =</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  RefPtr&lt;nsOnLDAPMessageRunnable&gt; runnable =</span>
<a href="#l2.33"></a><span id="l2.33">     new nsOnLDAPMessageRunnable(msg, aRemoveOpFromConnQ);</span>
<a href="#l2.34"></a><span id="l2.34">   // invoke the callback</span>
<a href="#l2.35"></a><span id="l2.35">   NS_DispatchToMainThread(runnable);</span>
<a href="#l2.36"></a><span id="l2.36"> </span>
<a href="#l2.37"></a><span id="l2.37">   // if requested (ie the operation is done), remove the operation</span>
<a href="#l2.38"></a><span id="l2.38">   // from the connection queue.</span>
<a href="#l2.39"></a><span id="l2.39">   if (aRemoveOpFromConnQ)</span>
<a href="#l2.40"></a><span id="l2.40">   {</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineat">@@ -631,17 +631,17 @@ NS_IMETHODIMP nsLDAPConnectionRunnable::</span>
<a href="#l2.42"></a><span id="l2.42"> {</span>
<a href="#l2.43"></a><span id="l2.43">   if (!mOperationID) {</span>
<a href="#l2.44"></a><span id="l2.44">     NS_ERROR(&quot;mOperationID is null&quot;);</span>
<a href="#l2.45"></a><span id="l2.45">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l2.46"></a><span id="l2.46">   }</span>
<a href="#l2.47"></a><span id="l2.47"> </span>
<a href="#l2.48"></a><span id="l2.48">   LDAPMessage *msgHandle;</span>
<a href="#l2.49"></a><span id="l2.49">   bool operationFinished = true;</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-  nsRefPtr&lt;nsLDAPMessage&gt; msg;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+  RefPtr&lt;nsLDAPMessage&gt; msg;</span>
<a href="#l2.52"></a><span id="l2.52"> </span>
<a href="#l2.53"></a><span id="l2.53">   struct timeval timeout = { 0, 0 };</span>
<a href="#l2.54"></a><span id="l2.54"> </span>
<a href="#l2.55"></a><span id="l2.55">   nsCOMPtr&lt;nsIThread&gt; thread = do_GetCurrentThread();</span>
<a href="#l2.56"></a><span id="l2.56">   int32_t returnCode = ldap_result(mConnection-&gt;mConnectionHandle, mOperationID, LDAP_MSG_ONE, &amp;timeout, &amp;msgHandle);</span>
<a href="#l2.57"></a><span id="l2.57">   switch (returnCode)</span>
<a href="#l2.58"></a><span id="l2.58">   {</span>
<a href="#l2.59"></a><span id="l2.59">     // timeout</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPConnection.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPConnection.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -115,15 +115,15 @@ public:</span>
<a href="#l3.4"></a><span id="l3.4">   nsLDAPConnectionRunnable(int32_t aOperationID,</span>
<a href="#l3.5"></a><span id="l3.5">                            nsILDAPOperation *aOperation,</span>
<a href="#l3.6"></a><span id="l3.6">                            nsLDAPConnection *aConnection);</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">   NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l3.9"></a><span id="l3.9">   NS_DECL_NSIRUNNABLE</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   int32_t mOperationID;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  nsRefPtr&lt;nsLDAPConnection&gt; mConnection;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  RefPtr&lt;nsLDAPConnection&gt; mConnection;</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> private:</span>
<a href="#l3.16"></a><span id="l3.16">   virtual ~nsLDAPConnectionRunnable();</span>
<a href="#l3.17"></a><span id="l3.17"> };</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> #endif // _nsLDAPConnection_h_</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPOperation.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPOperation.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -252,17 +252,17 @@ nsLDAPOperation::SaslStep(const char *to</span>
<a href="#l4.4"></a><span id="l4.4"> }</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> // wrapper for ldap_simple_bind()</span>
<a href="#l4.8"></a><span id="l4.8"> //</span>
<a href="#l4.9"></a><span id="l4.9"> NS_IMETHODIMP</span>
<a href="#l4.10"></a><span id="l4.10"> nsLDAPOperation::SimpleBind(const nsACString&amp; passwd)</span>
<a href="#l4.11"></a><span id="l4.11"> {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    nsRefPtr&lt;nsLDAPConnection&gt; connection = mConnection;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    RefPtr&lt;nsLDAPConnection&gt; connection = mConnection;</span>
<a href="#l4.14"></a><span id="l4.14">     // There is a possibilty that mConnection can be cleared by another</span>
<a href="#l4.15"></a><span id="l4.15">     // thread. Grabbing a local reference to mConnection may avoid this.</span>
<a href="#l4.16"></a><span id="l4.16">     // See https://bugzilla.mozilla.org/show_bug.cgi?id=557928#c1</span>
<a href="#l4.17"></a><span id="l4.17">     nsresult rv;</span>
<a href="#l4.18"></a><span id="l4.18">     nsAutoCString bindName;</span>
<a href="#l4.19"></a><span id="l4.19">     int32_t originalMsgID = mMsgID;</span>
<a href="#l4.20"></a><span id="l4.20">     // Ugly hack alert:</span>
<a href="#l4.21"></a><span id="l4.21">     // the first time we get called with a passwd, remember it.</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -281,17 +281,17 @@ nsLDAPOperation::SimpleBind(const nsACSt</span>
<a href="#l4.23"></a><span id="l4.23">         return rv;</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">     MOZ_LOG(gLDAPLogModule, mozilla::LogLevel::Debug,</span>
<a href="#l4.26"></a><span id="l4.26">            (&quot;nsLDAPOperation::SimpleBind(): called; bindName = '%s'; &quot;,</span>
<a href="#l4.27"></a><span id="l4.27">             bindName.get()));</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29">     // this (nsLDAPOperation) may be released by RemovePendingOperation()</span>
<a href="#l4.30"></a><span id="l4.30">     // See https://bugzilla.mozilla.org/show_bug.cgi?id=1063829.</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    nsRefPtr&lt;nsLDAPOperation&gt; kungFuDeathGrip = this;</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+    RefPtr&lt;nsLDAPOperation&gt; kungFuDeathGrip = this;</span>
<a href="#l4.33"></a><span id="l4.33"> </span>
<a href="#l4.34"></a><span id="l4.34">     // If this is a second try at binding, remove the operation from pending ops</span>
<a href="#l4.35"></a><span id="l4.35">     // because msg id has changed...</span>
<a href="#l4.36"></a><span id="l4.36">     if (originalMsgID)</span>
<a href="#l4.37"></a><span id="l4.37">       connection-&gt;RemovePendingOperation(originalMsgID);</span>
<a href="#l4.38"></a><span id="l4.38"> </span>
<a href="#l4.39"></a><span id="l4.39">     mMsgID = ldap_simple_bind(mConnectionHandle, bindName.get(),</span>
<a href="#l4.40"></a><span id="l4.40">                               mSavePassword.get());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPOperation.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPOperation.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -84,17 +84,17 @@ class nsLDAPOperation : public nsILDAPOp</span>
<a href="#l5.4"></a><span id="l5.4">     /**</span>
<a href="#l5.5"></a><span id="l5.5">      * Helper function to copy the values of an nsILDAPModification into an</span>
<a href="#l5.6"></a><span id="l5.6">      * array of berval's.</span>
<a href="#l5.7"></a><span id="l5.7">      */</span>
<a href="#l5.8"></a><span id="l5.8">     static nsresult CopyValues(nsILDAPModification* aMod, berval*** aBValues);</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10">     nsCOMPtr&lt;nsILDAPMessageListener&gt; mMessageListener; // results go here</span>
<a href="#l5.11"></a><span id="l5.11">     nsCOMPtr&lt;nsISupports&gt; mClosure;  // private parameter (anything caller desires)</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    nsRefPtr&lt;nsLDAPConnection&gt; mConnection; // connection this op is on</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    RefPtr&lt;nsLDAPConnection&gt; mConnection; // connection this op is on</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15">     LDAP *mConnectionHandle; // cache connection handle</span>
<a href="#l5.16"></a><span id="l5.16">     nsCString mSavePassword;</span>
<a href="#l5.17"></a><span id="l5.17">     nsCString mMechanism;</span>
<a href="#l5.18"></a><span id="l5.18">     nsCOMPtr&lt;nsIAuthModule&gt; mAuthModule;</span>
<a href="#l5.19"></a><span id="l5.19">     int32_t mMsgID;          // opaque handle to outbound message for this op</span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21">     nsCOMPtr&lt;nsIMutableArray&gt; mClientControls;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/search/nsMailWinSearchHelper.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/search/nsMailWinSearchHelper.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -53,27 +53,27 @@ NS_IMETHODIMP nsMailWinSearchHelper::Get</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5">   // If the service isn't present or running, we shouldn't proceed.</span>
<a href="#l6.6"></a><span id="l6.6">   bool serviceRunning;</span>
<a href="#l6.7"></a><span id="l6.7">   nsresult rv = GetServiceRunning(&amp;serviceRunning);</span>
<a href="#l6.8"></a><span id="l6.8">   if (!serviceRunning || NS_FAILED(rv))</span>
<a href="#l6.9"></a><span id="l6.9">     return rv;</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">   // We need to do this every time so that we have the latest data</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  nsRefPtr&lt;ISearchManager&gt; searchManager;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  RefPtr&lt;ISearchManager&gt; searchManager;</span>
<a href="#l6.14"></a><span id="l6.14">   HRESULT hr = CoCreateInstance(CLSID_CSearchManager, NULL, CLSCTX_ALL, IID_ISearchManager, getter_AddRefs(searchManager));</span>
<a href="#l6.15"></a><span id="l6.15">   if (FAILED(hr))</span>
<a href="#l6.16"></a><span id="l6.16">     return NS_ERROR_FAILURE;</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-  nsRefPtr&lt;ISearchCatalogManager&gt; catalogManager;</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+  RefPtr&lt;ISearchCatalogManager&gt; catalogManager;</span>
<a href="#l6.20"></a><span id="l6.20">   hr = searchManager-&gt;GetCatalog(L&quot;SystemIndex&quot;, getter_AddRefs(catalogManager));</span>
<a href="#l6.21"></a><span id="l6.21">   if (FAILED(hr))</span>
<a href="#l6.22"></a><span id="l6.22">     return NS_ERROR_FAILURE;</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-  nsRefPtr&lt;ISearchCrawlScopeManager&gt; crawlScopeManager;</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+  RefPtr&lt;ISearchCrawlScopeManager&gt; crawlScopeManager;</span>
<a href="#l6.26"></a><span id="l6.26">   hr = catalogManager-&gt;GetCrawlScopeManager(getter_AddRefs(crawlScopeManager));</span>
<a href="#l6.27"></a><span id="l6.27">   if (FAILED(hr))</span>
<a href="#l6.28"></a><span id="l6.28">     return NS_ERROR_FAILURE;</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30">   // We need to create appropriate URLs to check with the crawl scope manager.</span>
<a href="#l6.31"></a><span id="l6.31">   for (uint32_t i = 0; i &lt; MOZ_ARRAY_LENGTH(sFoldersToIndex); i++)</span>
<a href="#l6.32"></a><span id="l6.32">   {</span>
<a href="#l6.33"></a><span id="l6.33">     nsCOMPtr&lt;nsIFile&gt; subdir;</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineat">@@ -186,34 +186,34 @@ NS_IMETHODIMP nsMailWinSearchHelper::Set</span>
<a href="#l6.35"></a><span id="l6.35"> }</span>
<a href="#l6.36"></a><span id="l6.36"> </span>
<a href="#l6.37"></a><span id="l6.37"> NS_IMETHODIMP nsMailWinSearchHelper::GetIsFileAssociationSet(bool *aResult)</span>
<a href="#l6.38"></a><span id="l6.38"> {</span>
<a href="#l6.39"></a><span id="l6.39">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l6.40"></a><span id="l6.40">   *aResult = false;</span>
<a href="#l6.41"></a><span id="l6.41"> </span>
<a href="#l6.42"></a><span id="l6.42">   // We'll use the Vista method here</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-  nsRefPtr&lt;IApplicationAssociationRegistration&gt; pAAR;</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+  RefPtr&lt;IApplicationAssociationRegistration&gt; pAAR;</span>
<a href="#l6.45"></a><span id="l6.45">   HRESULT hr = CoCreateInstance(CLSID_ApplicationAssociationRegistration,</span>
<a href="#l6.46"></a><span id="l6.46">                                 NULL,</span>
<a href="#l6.47"></a><span id="l6.47">                                 CLSCTX_INPROC,</span>
<a href="#l6.48"></a><span id="l6.48">                                 IID_IApplicationAssociationRegistration,</span>
<a href="#l6.49"></a><span id="l6.49">                                 getter_AddRefs(pAAR));</span>
<a href="#l6.50"></a><span id="l6.50"> </span>
<a href="#l6.51"></a><span id="l6.51">   BOOL res;</span>
<a href="#l6.52"></a><span id="l6.52">   if (SUCCEEDED(hr))</span>
<a href="#l6.53"></a><span id="l6.53">     pAAR-&gt;QueryAppIsDefault(L&quot;.wdseml&quot;, AT_FILEEXTENSION, AL_EFFECTIVE, APP_REG_NAME_MAIL, &amp;res);</span>
<a href="#l6.54"></a><span id="l6.54">   *aResult = res;</span>
<a href="#l6.55"></a><span id="l6.55"> </span>
<a href="#l6.56"></a><span id="l6.56">   return NS_OK;</span>
<a href="#l6.57"></a><span id="l6.57"> }</span>
<a href="#l6.58"></a><span id="l6.58"> </span>
<a href="#l6.59"></a><span id="l6.59"> NS_IMETHODIMP nsMailWinSearchHelper::SetFileAssociation()</span>
<a href="#l6.60"></a><span id="l6.60"> {</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-  nsRefPtr&lt;IApplicationAssociationRegistration&gt; pAAR;</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+  RefPtr&lt;IApplicationAssociationRegistration&gt; pAAR;</span>
<a href="#l6.63"></a><span id="l6.63">   HRESULT hr = CoCreateInstance(CLSID_ApplicationAssociationRegistration,</span>
<a href="#l6.64"></a><span id="l6.64">                                 NULL,</span>
<a href="#l6.65"></a><span id="l6.65">                                 CLSCTX_INPROC,</span>
<a href="#l6.66"></a><span id="l6.66">                                 IID_IApplicationAssociationRegistration,</span>
<a href="#l6.67"></a><span id="l6.67">                                 getter_AddRefs(pAAR));</span>
<a href="#l6.68"></a><span id="l6.68">   if (SUCCEEDED(hr))</span>
<a href="#l6.69"></a><span id="l6.69">     hr = pAAR-&gt;SetAppAsDefault(APP_REG_NAME_MAIL, L&quot;.wdseml&quot;, AT_FILEEXTENSION);</span>
<a href="#l6.70"></a><span id="l6.70"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddbookUrl.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddbookUrl.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -182,17 +182,17 @@ NS_IMETHODIMP nsAddbookUrl::Equals(nsIUR</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5">   return m_baseURL-&gt;Equals(other, _retval);</span>
<a href="#l7.6"></a><span id="l7.6"> }</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> NS_IMETHODIMP nsAddbookUrl::Clone(nsIURI **_retval)</span>
<a href="#l7.9"></a><span id="l7.9"> {</span>
<a href="#l7.10"></a><span id="l7.10">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  nsRefPtr&lt;nsAddbookUrl&gt; clone = new nsAddbookUrl();</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  RefPtr&lt;nsAddbookUrl&gt; clone = new nsAddbookUrl();</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15">   if (!clone)</span>
<a href="#l7.16"></a><span id="l7.16">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18">   nsresult rv = m_baseURL-&gt;Clone(getter_AddRefs(clone-&gt;m_baseURL));</span>
<a href="#l7.19"></a><span id="l7.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.20"></a><span id="l7.20">   clone-&gt;ParseUrl();</span>
<a href="#l7.21"></a><span id="l7.21">   clone.forget(_retval);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -228,17 +228,17 @@ NS_IMETHODIMP nsAddbookUrl::EqualsExcept</span>
<a href="#l7.23"></a><span id="l7.23">   return m_baseURL-&gt;EqualsExceptRef(other, _retval);</span>
<a href="#l7.24"></a><span id="l7.24"> }</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26"> NS_IMETHODIMP</span>
<a href="#l7.27"></a><span id="l7.27"> nsAddbookUrl::CloneIgnoringRef(nsIURI** _retval)</span>
<a href="#l7.28"></a><span id="l7.28"> {</span>
<a href="#l7.29"></a><span id="l7.29">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  nsRefPtr&lt;nsAddbookUrl&gt; clone = new nsAddbookUrl();</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  RefPtr&lt;nsAddbookUrl&gt; clone = new nsAddbookUrl();</span>
<a href="#l7.33"></a><span id="l7.33"> </span>
<a href="#l7.34"></a><span id="l7.34">   if (!clone)</span>
<a href="#l7.35"></a><span id="l7.35">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37">   nsresult rv = m_baseURL-&gt;CloneIgnoringRef(getter_AddRefs(clone-&gt;m_baseURL));</span>
<a href="#l7.38"></a><span id="l7.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.39"></a><span id="l7.39">   clone-&gt;ParseUrl();</span>
<a href="#l7.40"></a><span id="l7.40">   clone.forget(_retval);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -2506,17 +2506,17 @@ public:</span>
<a href="#l8.4"></a><span id="l8.4">     NS_DECL_NSISIMPLEENUMERATOR</span>
<a href="#l8.5"></a><span id="l8.5">     NS_DECL_NSIADDRDBLISTENER</span>
<a href="#l8.6"></a><span id="l8.6">     // nsAddrDBEnumerator methods:</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">     nsAddrDBEnumerator(nsAddrDatabase* aDb);</span>
<a href="#l8.9"></a><span id="l8.9">     void Clear();</span>
<a href="#l8.10"></a><span id="l8.10"> protected:</span>
<a href="#l8.11"></a><span id="l8.11">     virtual ~nsAddrDBEnumerator();</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    nsRefPtr&lt;nsAddrDatabase&gt; mDb;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    RefPtr&lt;nsAddrDatabase&gt; mDb;</span>
<a href="#l8.14"></a><span id="l8.14">     nsIMdbTable *mDbTable;</span>
<a href="#l8.15"></a><span id="l8.15">     nsCOMPtr&lt;nsIMdbTableRowCursor&gt; mRowCursor;</span>
<a href="#l8.16"></a><span id="l8.16">     nsCOMPtr&lt;nsIMdbRow&gt; mCurrentRow;</span>
<a href="#l8.17"></a><span id="l8.17">     mdb_pos mRowPos;</span>
<a href="#l8.18"></a><span id="l8.18"> };</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20"> nsAddrDBEnumerator::nsAddrDBEnumerator(nsAddrDatabase* aDb)</span>
<a href="#l8.21"></a><span id="l8.21">     : mDb(aDb),</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -2672,17 +2672,17 @@ public:</span>
<a href="#l8.23"></a><span id="l8.23">     NS_DECL_NSISIMPLEENUMERATOR</span>
<a href="#l8.24"></a><span id="l8.24"> </span>
<a href="#l8.25"></a><span id="l8.25">     // nsListAddressEnumerator methods:</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27">     nsListAddressEnumerator(nsAddrDatabase* aDb, mdb_id aRowID);</span>
<a href="#l8.28"></a><span id="l8.28"> </span>
<a href="#l8.29"></a><span id="l8.29"> protected:</span>
<a href="#l8.30"></a><span id="l8.30">     ~nsListAddressEnumerator() {}</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-    nsRefPtr&lt;nsAddrDatabase&gt; mDb;</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+    RefPtr&lt;nsAddrDatabase&gt; mDb;</span>
<a href="#l8.33"></a><span id="l8.33">     nsIMdbTable *mDbTable;</span>
<a href="#l8.34"></a><span id="l8.34">     nsCOMPtr&lt;nsIMdbRow&gt; mListRow;</span>
<a href="#l8.35"></a><span id="l8.35">     mdb_id mListRowID;</span>
<a href="#l8.36"></a><span id="l8.36">     uint32_t mAddressTotal;</span>
<a href="#l8.37"></a><span id="l8.37">     uint16_t mAddressPos;</span>
<a href="#l8.38"></a><span id="l8.38"> };</span>
<a href="#l8.39"></a><span id="l8.39"> </span>
<a href="#l8.40"></a><span id="l8.40"> nsListAddressEnumerator::nsListAddressEnumerator(nsAddrDatabase* aDb,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -101,17 +101,17 @@ NS_IMETHODIMP nsMsgFilterService::OpenFi</span>
<a href="#l9.4"></a><span id="l9.4">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.5"></a><span id="l9.5">   }</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7">   nsCOMPtr&lt;nsIInputStream&gt; fileStream;</span>
<a href="#l9.8"></a><span id="l9.8">   rv = NS_NewLocalFileInputStream(getter_AddRefs(fileStream), aFilterFile);</span>
<a href="#l9.9"></a><span id="l9.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.10"></a><span id="l9.10">   NS_ENSURE_TRUE(fileStream, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  nsRefPtr&lt;nsMsgFilterList&gt; filterList = new nsMsgFilterList();</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  RefPtr&lt;nsMsgFilterList&gt; filterList = new nsMsgFilterList();</span>
<a href="#l9.14"></a><span id="l9.14">   NS_ENSURE_TRUE(filterList, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l9.15"></a><span id="l9.15">   filterList-&gt;SetFolder(rootFolder);</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17">   // temporarily tell the filter where its file path is</span>
<a href="#l9.18"></a><span id="l9.18">   filterList-&gt;SetDefaultFile(aFilterFile);</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20">   int64_t size = 0;</span>
<a href="#l9.21"></a><span id="l9.21">   rv = aFilterFile-&gt;GetFileSize(&amp;size);</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -906,17 +906,17 @@ NS_IMETHODIMP</span>
<a href="#l9.23"></a><span id="l9.23"> nsMsgFilterService::ApplyFiltersToFolders(nsIMsgFilterList *aFilterList,</span>
<a href="#l9.24"></a><span id="l9.24">                                           nsIArray *aFolders,</span>
<a href="#l9.25"></a><span id="l9.25">                                           nsIMsgWindow *aMsgWindow,</span>
<a href="#l9.26"></a><span id="l9.26">                                           nsIMsgOperationListener *aCallback)</span>
<a href="#l9.27"></a><span id="l9.27"> {</span>
<a href="#l9.28"></a><span id="l9.28">   NS_ENSURE_ARG_POINTER(aFilterList);</span>
<a href="#l9.29"></a><span id="l9.29">   NS_ENSURE_ARG_POINTER(aFolders);</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-  nsRefPtr&lt;nsMsgFilterAfterTheFact&gt; filterExecutor =</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+  RefPtr&lt;nsMsgFilterAfterTheFact&gt; filterExecutor =</span>
<a href="#l9.33"></a><span id="l9.33">     new nsMsgFilterAfterTheFact(aMsgWindow, aFilterList, aFolders, aCallback);</span>
<a href="#l9.34"></a><span id="l9.34">   if (filterExecutor)</span>
<a href="#l9.35"></a><span id="l9.35">     return filterExecutor-&gt;AdvanceToNextFolder();</span>
<a href="#l9.36"></a><span id="l9.36">   else</span>
<a href="#l9.37"></a><span id="l9.37">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l9.38"></a><span id="l9.38"> }</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40"> NS_IMETHODIMP nsMsgFilterService::AddCustomAction(nsIMsgFilterCustomAction *aAction)</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineat">@@ -1107,17 +1107,17 @@ NS_IMETHODIMP nsMsgFilterService::ApplyF</span>
<a href="#l9.42"></a><span id="l9.42"> </span>
<a href="#l9.43"></a><span id="l9.43">   nsCOMPtr&lt;nsIMutableArray&gt; folderList(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l9.44"></a><span id="l9.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.45"></a><span id="l9.45"> </span>
<a href="#l9.46"></a><span id="l9.46">   folderList-&gt;AppendElement(aFolder, false);</span>
<a href="#l9.47"></a><span id="l9.47"> </span>
<a href="#l9.48"></a><span id="l9.48">   // Create our nsMsgApplyFiltersToMessages object which will be called when ApplyFiltersToHdr</span>
<a href="#l9.49"></a><span id="l9.49">   // finds one or more filters that hit.</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-  nsRefPtr&lt;nsMsgApplyFiltersToMessages&gt; filterExecutor =</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+  RefPtr&lt;nsMsgApplyFiltersToMessages&gt; filterExecutor =</span>
<a href="#l9.52"></a><span id="l9.52">     new nsMsgApplyFiltersToMessages(aMsgWindow, filterList, folderList,</span>
<a href="#l9.53"></a><span id="l9.53">                                     aMsgHdrList, aFilterType, aCallback);</span>
<a href="#l9.54"></a><span id="l9.54"> </span>
<a href="#l9.55"></a><span id="l9.55">   if (filterExecutor)</span>
<a href="#l9.56"></a><span id="l9.56">     return filterExecutor-&gt;AdvanceToNextFolder();</span>
<a href="#l9.57"></a><span id="l9.57"> </span>
<a href="#l9.58"></a><span id="l9.58">   return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l9.59"></a><span id="l9.59"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -528,17 +528,17 @@ NS_IMETHODIMP nsMsgSearchSession::AddSea</span>
<a href="#l10.4"></a><span id="l10.4">   m_iListener = -1;</span>
<a href="#l10.5"></a><span id="l10.5">   return NS_OK;</span>
<a href="#l10.6"></a><span id="l10.6"> }</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> nsresult nsMsgSearchSession::NotifyListenersDone(nsresult aStatus)</span>
<a href="#l10.9"></a><span id="l10.9"> {</span>
<a href="#l10.10"></a><span id="l10.10">   // need to stabilize &quot;this&quot; in case one of the listeners releases the last</span>
<a href="#l10.11"></a><span id="l10.11">   // reference to us.</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  nsRefPtr&lt;nsIMsgSearchSession&gt; kungFuDeathGrip(this);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  RefPtr&lt;nsIMsgSearchSession&gt; kungFuDeathGrip(this);</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15">   nsCOMPtr&lt;nsIMsgSearchNotify&gt; listener;</span>
<a href="#l10.16"></a><span id="l10.16">   m_iListener = 0;</span>
<a href="#l10.17"></a><span id="l10.17">   while (m_iListener != -1 &amp;&amp; m_iListener &lt; (signed)m_listenerList.Length())</span>
<a href="#l10.18"></a><span id="l10.18">   {</span>
<a href="#l10.19"></a><span id="l10.19">     listener = m_listenerList[m_iListener];</span>
<a href="#l10.20"></a><span id="l10.20">     int32_t listenerFlags = m_listenerFlagList[m_iListener++];</span>
<a href="#l10.21"></a><span id="l10.21">     if (!listenerFlags || (listenerFlags &amp; nsIMsgSearchSession::onSearchDone))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchSession.h</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchSession.h</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -42,17 +42,17 @@ protected:</span>
<a href="#l11.4"></a><span id="l11.4">   nsresult BeginSearching();</span>
<a href="#l11.5"></a><span id="l11.5">   nsresult DoNextSearch();</span>
<a href="#l11.6"></a><span id="l11.6">   nsresult SearchWOUrls ();</span>
<a href="#l11.7"></a><span id="l11.7">   nsresult GetNextUrl();</span>
<a href="#l11.8"></a><span id="l11.8">   nsresult NotifyListenersDone(nsresult status);</span>
<a href="#l11.9"></a><span id="l11.9">   void EnableFolderNotifications(bool aEnable);</span>
<a href="#l11.10"></a><span id="l11.10">   void ReleaseFolderDBRef();</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  nsTArray&lt;nsRefPtr&lt;nsMsgSearchScopeTerm&gt;&gt; m_scopeList;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  nsTArray&lt;RefPtr&lt;nsMsgSearchScopeTerm&gt;&gt; m_scopeList;</span>
<a href="#l11.14"></a><span id="l11.14">   nsCOMPtr &lt;nsISupportsArray&gt; m_termList;</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16">   nsTArray&lt;nsCOMPtr&lt;nsIMsgSearchNotify&gt; &gt; m_listenerList;</span>
<a href="#l11.17"></a><span id="l11.17">   nsTArray&lt;int32_t&gt; m_listenerFlagList;</span>
<a href="#l11.18"></a><span id="l11.18">   /**</span>
<a href="#l11.19"></a><span id="l11.19">    * Iterator index for m_listenerList/m_listenerFlagList.  We used to use an</span>
<a href="#l11.20"></a><span id="l11.20">    * nsTObserverArray for m_listenerList but its auto-adjusting iterator was</span>
<a href="#l11.21"></a><span id="l11.21">    * not helping us keep our m_listenerFlagList iterator correct.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -637,17 +637,17 @@ nsresult nsMessenger::SaveAttachment(nsI</span>
<a href="#l12.4"></a><span id="l12.4">   nsSaveAllAttachmentsState *saveState= (nsSaveAllAttachmentsState*) closure;</span>
<a href="#l12.5"></a><span id="l12.5">   nsCOMPtr&lt;nsIMsgMessageFetchPartService&gt; fetchService;</span>
<a href="#l12.6"></a><span id="l12.6">   nsAutoCString urlString;</span>
<a href="#l12.7"></a><span id="l12.7">   nsCOMPtr&lt;nsIURI&gt; URL;</span>
<a href="#l12.8"></a><span id="l12.8">   nsAutoCString fullMessageUri(aMessageUri);</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10">   // This instance will be held onto by the listeners, and will be released once </span>
<a href="#l12.11"></a><span id="l12.11">   // the transfer has been completed.</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  nsRefPtr&lt;nsSaveMsgListener&gt; saveListener(new nsSaveMsgListener(aFile, this, aListener));</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  RefPtr&lt;nsSaveMsgListener&gt; saveListener(new nsSaveMsgListener(aFile, this, aListener));</span>
<a href="#l12.14"></a><span id="l12.14">   if (!saveListener)</span>
<a href="#l12.15"></a><span id="l12.15">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17">   saveListener-&gt;m_contentType = aContentType;</span>
<a href="#l12.18"></a><span id="l12.18">   if (saveState)</span>
<a href="#l12.19"></a><span id="l12.19">   {</span>
<a href="#l12.20"></a><span id="l12.20">     saveListener-&gt;m_saveAllAttachmentsState = saveState;</span>
<a href="#l12.21"></a><span id="l12.21">     if (saveState-&gt;m_detachingAttachments)</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -1039,17 +1039,17 @@ nsMessenger::SaveAs(const nsACString&amp; aU</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24">     rv = PromptIfFileExists(saveAsFile);</span>
<a href="#l12.25"></a><span id="l12.25">     if (NS_FAILED(rv)) {</span>
<a href="#l12.26"></a><span id="l12.26">       goto done;</span>
<a href="#l12.27"></a><span id="l12.27">     }</span>
<a href="#l12.28"></a><span id="l12.28"> </span>
<a href="#l12.29"></a><span id="l12.29">     // After saveListener goes out of scope, the listener will be owned by</span>
<a href="#l12.30"></a><span id="l12.30">     // whoever the listener is registered with, usually a URL.</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-    nsRefPtr&lt;nsSaveMsgListener&gt; saveListener = new nsSaveMsgListener(saveAsFile, this, nullptr);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+    RefPtr&lt;nsSaveMsgListener&gt; saveListener = new nsSaveMsgListener(saveAsFile, this, nullptr);</span>
<a href="#l12.33"></a><span id="l12.33">     if (!saveListener) {</span>
<a href="#l12.34"></a><span id="l12.34">       rv = NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l12.35"></a><span id="l12.35">       goto done;</span>
<a href="#l12.36"></a><span id="l12.36">     }</span>
<a href="#l12.37"></a><span id="l12.37">     rv = saveListener-&gt;QueryInterface(NS_GET_IID(nsIUrlListener), getter_AddRefs(urlListener));</span>
<a href="#l12.38"></a><span id="l12.38">     if (NS_FAILED(rv))</span>
<a href="#l12.39"></a><span id="l12.39">       goto done;</span>
<a href="#l12.40"></a><span id="l12.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -184,18 +184,18 @@ nsresult nsMsgAccountManager::Shutdown()</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5">   nsresult rv;</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7">   SaveVirtualFolders();</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9">   nsCOMPtr&lt;nsIMsgDBService&gt; msgDBService = do_GetService(NS_MSGDB_SERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l13.10"></a><span id="l13.10">   if (msgDBService)</span>
<a href="#l13.11"></a><span id="l13.11">   {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    nsTObserverArray&lt;nsRefPtr&lt;VirtualFolderChangeListener&gt; &gt;::ForwardIterator iter(m_virtualFolderListeners);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-    nsRefPtr&lt;VirtualFolderChangeListener&gt; listener;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+    nsTObserverArray&lt;RefPtr&lt;VirtualFolderChangeListener&gt; &gt;::ForwardIterator iter(m_virtualFolderListeners);</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+    RefPtr&lt;VirtualFolderChangeListener&gt; listener;</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17">     while (iter.HasMore())</span>
<a href="#l13.18"></a><span id="l13.18">     {</span>
<a href="#l13.19"></a><span id="l13.19">       listener = iter.GetNext();</span>
<a href="#l13.20"></a><span id="l13.20">       msgDBService-&gt;UnregisterPendingListener(listener);</span>
<a href="#l13.21"></a><span id="l13.21">     }</span>
<a href="#l13.22"></a><span id="l13.22">   }</span>
<a href="#l13.23"></a><span id="l13.23">   if(m_msgFolderCache)</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineat">@@ -2586,17 +2586,17 @@ public:</span>
<a href="#l13.25"></a><span id="l13.25">   NS_IMETHOD Run()</span>
<a href="#l13.26"></a><span id="l13.26">   {</span>
<a href="#l13.27"></a><span id="l13.27">     if (mVFChangeListener)</span>
<a href="#l13.28"></a><span id="l13.28">       mVFChangeListener-&gt;ProcessUpdateEvent(mFolder, mDB);</span>
<a href="#l13.29"></a><span id="l13.29">     return NS_OK;</span>
<a href="#l13.30"></a><span id="l13.30">   }</span>
<a href="#l13.31"></a><span id="l13.31"> </span>
<a href="#l13.32"></a><span id="l13.32"> private:</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-  nsRefPtr&lt;VirtualFolderChangeListener&gt; mVFChangeListener;</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+  RefPtr&lt;VirtualFolderChangeListener&gt; mVFChangeListener;</span>
<a href="#l13.35"></a><span id="l13.35">   nsCOMPtr&lt;nsIMsgFolder&gt; mFolder;</span>
<a href="#l13.36"></a><span id="l13.36">   nsCOMPtr&lt;nsIMsgDatabase&gt; mDB;</span>
<a href="#l13.37"></a><span id="l13.37"> };</span>
<a href="#l13.38"></a><span id="l13.38"> </span>
<a href="#l13.39"></a><span id="l13.39"> NS_IMPL_ISUPPORTS(VirtualFolderChangeListener, nsIDBChangeListener)</span>
<a href="#l13.40"></a><span id="l13.40"> </span>
<a href="#l13.41"></a><span id="l13.41"> VirtualFolderChangeListener::VirtualFolderChangeListener() :</span>
<a href="#l13.42"></a><span id="l13.42">   m_searchOnMsgStatus(false), m_batchingEvents(false)</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineat">@@ -3271,17 +3271,17 @@ nsresult nsMsgAccountManager::AddVFListe</span>
<a href="#l13.44"></a><span id="l13.44">   nsCOMPtr &lt;nsIRDFResource&gt; resource;</span>
<a href="#l13.45"></a><span id="l13.45"> </span>
<a href="#l13.46"></a><span id="l13.46">   for (uint32_t i = 0; i &lt; folderUris.Length(); i++)</span>
<a href="#l13.47"></a><span id="l13.47">   {</span>
<a href="#l13.48"></a><span id="l13.48">     rdf-&gt;GetResource(folderUris[i], getter_AddRefs(resource));</span>
<a href="#l13.49"></a><span id="l13.49">     nsCOMPtr &lt;nsIMsgFolder&gt; realFolder = do_QueryInterface(resource);</span>
<a href="#l13.50"></a><span id="l13.50">     if (!realFolder)</span>
<a href="#l13.51"></a><span id="l13.51">       continue;</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-    nsRefPtr&lt;VirtualFolderChangeListener&gt; dbListener = new VirtualFolderChangeListener();</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+    RefPtr&lt;VirtualFolderChangeListener&gt; dbListener = new VirtualFolderChangeListener();</span>
<a href="#l13.54"></a><span id="l13.54">     NS_ENSURE_TRUE(dbListener, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l13.55"></a><span id="l13.55">     dbListener-&gt;m_virtualFolder = virtualFolder;</span>
<a href="#l13.56"></a><span id="l13.56">     dbListener-&gt;m_folderWatching = realFolder;</span>
<a href="#l13.57"></a><span id="l13.57">     if (NS_FAILED(dbListener-&gt;Init()))</span>
<a href="#l13.58"></a><span id="l13.58">     {</span>
<a href="#l13.59"></a><span id="l13.59">       dbListener = nullptr;</span>
<a href="#l13.60"></a><span id="l13.60">       continue;</span>
<a href="#l13.61"></a><span id="l13.61">     }</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineat">@@ -3295,18 +3295,18 @@ nsresult nsMsgAccountManager::AddVFListe</span>
<a href="#l13.63"></a><span id="l13.63"> // has gone away.</span>
<a href="#l13.64"></a><span id="l13.64"> nsresult nsMsgAccountManager::RemoveVFListenerForVF(nsIMsgFolder *virtualFolder,</span>
<a href="#l13.65"></a><span id="l13.65">                                                     nsIMsgFolder *folder)</span>
<a href="#l13.66"></a><span id="l13.66"> {</span>
<a href="#l13.67"></a><span id="l13.67">   nsresult rv;</span>
<a href="#l13.68"></a><span id="l13.68">   nsCOMPtr&lt;nsIMsgDBService&gt; msgDBService(do_GetService(NS_MSGDB_SERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l13.69"></a><span id="l13.69">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.70"></a><span id="l13.70"> </span>
<a href="#l13.71"></a><span id="l13.71" class="difflineminus">-  nsTObserverArray&lt;nsRefPtr&lt;VirtualFolderChangeListener&gt; &gt;::ForwardIterator iter(m_virtualFolderListeners);</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineminus">-  nsRefPtr&lt;VirtualFolderChangeListener&gt; listener;</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+  nsTObserverArray&lt;RefPtr&lt;VirtualFolderChangeListener&gt; &gt;::ForwardIterator iter(m_virtualFolderListeners);</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+  RefPtr&lt;VirtualFolderChangeListener&gt; listener;</span>
<a href="#l13.75"></a><span id="l13.75"> </span>
<a href="#l13.76"></a><span id="l13.76">   while (iter.HasMore())</span>
<a href="#l13.77"></a><span id="l13.77">   {</span>
<a href="#l13.78"></a><span id="l13.78">     listener = iter.GetNext();</span>
<a href="#l13.79"></a><span id="l13.79">     if (listener-&gt;m_folderWatching == folder &amp;&amp;</span>
<a href="#l13.80"></a><span id="l13.80">         listener-&gt;m_virtualFolder == virtualFolder)</span>
<a href="#l13.81"></a><span id="l13.81">     {</span>
<a href="#l13.82"></a><span id="l13.82">       msgDBService-&gt;UnregisterPendingListener(listener);</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineat">@@ -3391,18 +3391,18 @@ NS_IMETHODIMP nsMsgAccountManager::OnIte</span>
<a href="#l13.84"></a><span id="l13.84">     }</span>
<a href="#l13.85"></a><span id="l13.85">   }</span>
<a href="#l13.86"></a><span id="l13.86">   nsresult rv = NS_OK;</span>
<a href="#l13.87"></a><span id="l13.87">   // if this is a special folder, check if we have a saved search over</span>
<a href="#l13.88"></a><span id="l13.88">   // folders with this flag, and if so, add this folder to the scope.</span>
<a href="#l13.89"></a><span id="l13.89">   if (addToSmartFolders)</span>
<a href="#l13.90"></a><span id="l13.90">   {</span>
<a href="#l13.91"></a><span id="l13.91">     // quick way to enumerate the saved searches.</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineminus">-    nsTObserverArray&lt;nsRefPtr&lt;VirtualFolderChangeListener&gt; &gt;::ForwardIterator iter(m_virtualFolderListeners);</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineminus">-    nsRefPtr&lt;VirtualFolderChangeListener&gt; listener;</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineplus">+    nsTObserverArray&lt;RefPtr&lt;VirtualFolderChangeListener&gt; &gt;::ForwardIterator iter(m_virtualFolderListeners);</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+    RefPtr&lt;VirtualFolderChangeListener&gt; listener;</span>
<a href="#l13.96"></a><span id="l13.96"> </span>
<a href="#l13.97"></a><span id="l13.97">     while (iter.HasMore())</span>
<a href="#l13.98"></a><span id="l13.98">     {</span>
<a href="#l13.99"></a><span id="l13.99">       listener = iter.GetNext();</span>
<a href="#l13.100"></a><span id="l13.100">       nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l13.101"></a><span id="l13.101">       nsCOMPtr &lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l13.102"></a><span id="l13.102">       listener-&gt;m_virtualFolder-&gt;GetDBFolderInfoAndDB(getter_AddRefs(dbFolderInfo),</span>
<a href="#l13.103"></a><span id="l13.103">                                                       getter_AddRefs(db));</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineat">@@ -3504,18 +3504,18 @@ NS_IMETHODIMP nsMsgAccountManager::OnIte</span>
<a href="#l13.105"></a><span id="l13.105"> </span>
<a href="#l13.106"></a><span id="l13.106">   // build a &quot;normalized&quot; uri that we can do a find on.</span>
<a href="#l13.107"></a><span id="l13.107">   nsCString removedFolderURI;</span>
<a href="#l13.108"></a><span id="l13.108">   folder-&gt;GetURI(removedFolderURI);</span>
<a href="#l13.109"></a><span id="l13.109">   removedFolderURI.Insert('|', 0);</span>
<a href="#l13.110"></a><span id="l13.110">   removedFolderURI.Append('|');</span>
<a href="#l13.111"></a><span id="l13.111"> </span>
<a href="#l13.112"></a><span id="l13.112">   // Enumerate the saved searches.</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineminus">-  nsTObserverArray&lt;nsRefPtr&lt;VirtualFolderChangeListener&gt; &gt;::ForwardIterator iter(m_virtualFolderListeners);</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineminus">-  nsRefPtr&lt;VirtualFolderChangeListener&gt; listener;</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineplus">+  nsTObserverArray&lt;RefPtr&lt;VirtualFolderChangeListener&gt; &gt;::ForwardIterator iter(m_virtualFolderListeners);</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineplus">+  RefPtr&lt;VirtualFolderChangeListener&gt; listener;</span>
<a href="#l13.117"></a><span id="l13.117"> </span>
<a href="#l13.118"></a><span id="l13.118">   while (iter.HasMore())</span>
<a href="#l13.119"></a><span id="l13.119">   {</span>
<a href="#l13.120"></a><span id="l13.120">     listener = iter.GetNext();</span>
<a href="#l13.121"></a><span id="l13.121">     nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l13.122"></a><span id="l13.122">     nsCOMPtr&lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l13.123"></a><span id="l13.123">     nsCOMPtr&lt;nsIMsgFolder&gt; savedSearch = listener-&gt;m_virtualFolder;</span>
<a href="#l13.124"></a><span id="l13.124">     savedSearch-&gt;GetDBFolderInfoAndDB(getter_AddRefs(dbFolderInfo),</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineat">@@ -3622,18 +3622,18 @@ nsMsgAccountManager::RemoveFolderFromSma</span>
<a href="#l13.126"></a><span id="l13.126">   aFolder-&gt;GetURI(removedFolderURI);</span>
<a href="#l13.127"></a><span id="l13.127">   removedFolderURI.Insert('|', 0);</span>
<a href="#l13.128"></a><span id="l13.128">   removedFolderURI.Append('|');</span>
<a href="#l13.129"></a><span id="l13.129">   uint32_t flags;</span>
<a href="#l13.130"></a><span id="l13.130">   aFolder-&gt;GetFlags(&amp;flags);</span>
<a href="#l13.131"></a><span id="l13.131">   NS_ASSERTION(!(flags &amp; flagsChanged), &quot;smart folder flag should not be set&quot;);</span>
<a href="#l13.132"></a><span id="l13.132">   // Flag was removed. Look for smart folder based on that flag,</span>
<a href="#l13.133"></a><span id="l13.133">   // and remove this folder from its scope.</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineminus">-  nsTObserverArray&lt;nsRefPtr&lt;VirtualFolderChangeListener&gt; &gt;::ForwardIterator iter(m_virtualFolderListeners);</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineminus">-  nsRefPtr&lt;VirtualFolderChangeListener&gt; listener;</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineplus">+  nsTObserverArray&lt;RefPtr&lt;VirtualFolderChangeListener&gt; &gt;::ForwardIterator iter(m_virtualFolderListeners);</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineplus">+  RefPtr&lt;VirtualFolderChangeListener&gt; listener;</span>
<a href="#l13.138"></a><span id="l13.138"> </span>
<a href="#l13.139"></a><span id="l13.139">   while (iter.HasMore())</span>
<a href="#l13.140"></a><span id="l13.140">   {</span>
<a href="#l13.141"></a><span id="l13.141">     listener = iter.GetNext();</span>
<a href="#l13.142"></a><span id="l13.142">     nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l13.143"></a><span id="l13.143">     nsCOMPtr &lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l13.144"></a><span id="l13.144">     listener-&gt;m_virtualFolder-&gt;GetDBFolderInfoAndDB(getter_AddRefs(dbFolderInfo),</span>
<a href="#l13.145"></a><span id="l13.145">                                                     getter_AddRefs(db));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.h</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -93,17 +93,17 @@ private:</span>
<a href="#l14.4"></a><span id="l14.4">   nsCOMPtr &lt;nsIMsgFolderCache&gt; m_msgFolderCache;</span>
<a href="#l14.5"></a><span id="l14.5">   nsCOMPtr&lt;nsIAtom&gt; kDefaultServerAtom;</span>
<a href="#l14.6"></a><span id="l14.6">   nsCOMPtr&lt;nsIAtom&gt; mFolderFlagAtom;</span>
<a href="#l14.7"></a><span id="l14.7">   nsTArray&lt;nsCOMPtr&lt;nsIMsgAccount&gt; &gt; m_accounts;</span>
<a href="#l14.8"></a><span id="l14.8">   nsInterfaceHashtable&lt;nsCStringHashKey, nsIMsgIdentity&gt; m_identities;</span>
<a href="#l14.9"></a><span id="l14.9">   nsInterfaceHashtable&lt;nsCStringHashKey, nsIMsgIncomingServer&gt; m_incomingServers;</span>
<a href="#l14.10"></a><span id="l14.10">   nsCOMPtr&lt;nsIMsgAccount&gt; m_defaultAccount;</span>
<a href="#l14.11"></a><span id="l14.11">   nsCOMArray&lt;nsIIncomingServerListener&gt; m_incomingServerListeners;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  nsTObserverArray&lt;nsRefPtr&lt;VirtualFolderChangeListener&gt; &gt; m_virtualFolderListeners;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  nsTObserverArray&lt;RefPtr&lt;VirtualFolderChangeListener&gt; &gt; m_virtualFolderListeners;</span>
<a href="#l14.14"></a><span id="l14.14">   nsCOMPtr&lt;nsIMsgFolder&gt; m_folderDoingEmptyTrash;</span>
<a href="#l14.15"></a><span id="l14.15">   nsCOMPtr&lt;nsIMsgFolder&gt; m_folderDoingCleanupInbox;</span>
<a href="#l14.16"></a><span id="l14.16">   bool m_emptyTrashInProgress;</span>
<a href="#l14.17"></a><span id="l14.17">   bool m_cleanupInboxInProgress;</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19">   nsCString mAccountKeyList;</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21">   // These are static because the account manager may go away during</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -488,17 +488,17 @@ private:</span>
<a href="#l15.4"></a><span id="l15.4">     NS_DECL_ISUPPORTS</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6">     // nsISimpleEnumerator methods:</span>
<a href="#l15.7"></a><span id="l15.7">     NS_DECL_NSISIMPLEENUMERATOR</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9">     // nsMsgThreadEnumerator methods:</span>
<a href="#l15.10"></a><span id="l15.10">     nsMsgViewHdrEnumerator(nsMsgDBView *view);</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    nsRefPtr &lt;nsMsgDBView&gt; m_view;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+    RefPtr&lt;nsMsgDBView&gt; m_view;</span>
<a href="#l15.14"></a><span id="l15.14">     nsMsgViewIndex m_curHdrIndex;</span>
<a href="#l15.15"></a><span id="l15.15"> </span>
<a href="#l15.16"></a><span id="l15.16">   private:</span>
<a href="#l15.17"></a><span id="l15.17">     ~nsMsgViewHdrEnumerator();</span>
<a href="#l15.18"></a><span id="l15.18">   };</span>
<a href="#l15.19"></a><span id="l15.19"> };</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCompactor.h</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCompactor.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -55,17 +55,17 @@ protected:</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5">   nsCString m_baseMessageUri; // base message uri</span>
<a href="#l16.6"></a><span id="l16.6">   nsCString m_messageUri; // current message uri being copy</span>
<a href="#l16.7"></a><span id="l16.7">   nsCOMPtr&lt;nsIMsgFolder&gt; m_folder; // current folder being compact</span>
<a href="#l16.8"></a><span id="l16.8">   nsCOMPtr&lt;nsIMsgDatabase&gt; m_db; // new database for the compact folder</span>
<a href="#l16.9"></a><span id="l16.9">   nsCOMPtr &lt;nsIFile&gt; m_file; // new mailbox for the compact folder</span>
<a href="#l16.10"></a><span id="l16.10">   nsCOMPtr &lt;nsIOutputStream&gt; m_fileStream; // output file stream for writing</span>
<a href="#l16.11"></a><span id="l16.11">   // all message keys that need to be copied over</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  nsRefPtr&lt;nsMsgKeyArray&gt; m_keyArray;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  RefPtr&lt;nsMsgKeyArray&gt; m_keyArray;</span>
<a href="#l16.14"></a><span id="l16.14">   uint32_t m_size;</span>
<a href="#l16.15"></a><span id="l16.15"> </span>
<a href="#l16.16"></a><span id="l16.16">    // sum of the sizes of the messages, accumulated as we visit each msg.</span>
<a href="#l16.17"></a><span id="l16.17">   uint64_t m_totalMsgSize;</span>
<a href="#l16.18"></a><span id="l16.18">   // number of bytes that can be expunged while compacting.</span>
<a href="#l16.19"></a><span id="l16.19">   uint64_t m_totalExpungedBytes;</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21">   uint32_t m_curIndex; // index of the current copied message key in key array</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -654,17 +654,17 @@ public:</span>
<a href="#l17.4"></a><span id="l17.4">   NS_IMETHOD Run()</span>
<a href="#l17.5"></a><span id="l17.5">   {</span>
<a href="#l17.6"></a><span id="l17.6">     if (mMsgPrintEngine) </span>
<a href="#l17.7"></a><span id="l17.7">       mMsgPrintEngine-&gt;PrintMsgWindow();</span>
<a href="#l17.8"></a><span id="l17.8">     return NS_OK;</span>
<a href="#l17.9"></a><span id="l17.9">   }</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11"> private:</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  nsRefPtr&lt;nsMsgPrintEngine&gt; mMsgPrintEngine;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  RefPtr&lt;nsMsgPrintEngine&gt; mMsgPrintEngine;</span>
<a href="#l17.14"></a><span id="l17.14"> };</span>
<a href="#l17.15"></a><span id="l17.15"> </span>
<a href="#l17.16"></a><span id="l17.16"> //-----------------------------------------------------------</span>
<a href="#l17.17"></a><span id="l17.17"> class nsStartNextPrintOpEvent : public nsRunnable</span>
<a href="#l17.18"></a><span id="l17.18"> {</span>
<a href="#l17.19"></a><span id="l17.19"> public:</span>
<a href="#l17.20"></a><span id="l17.20">   nsStartNextPrintOpEvent(nsMsgPrintEngine *mpe)</span>
<a href="#l17.21"></a><span id="l17.21">     : mMsgPrintEngine(mpe)</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -673,17 +673,17 @@ public:</span>
<a href="#l17.23"></a><span id="l17.23">   NS_IMETHOD Run()</span>
<a href="#l17.24"></a><span id="l17.24">   {</span>
<a href="#l17.25"></a><span id="l17.25">     if (mMsgPrintEngine) </span>
<a href="#l17.26"></a><span id="l17.26">       mMsgPrintEngine-&gt;StartNextPrintOperation();</span>
<a href="#l17.27"></a><span id="l17.27">     return NS_OK;</span>
<a href="#l17.28"></a><span id="l17.28">   }</span>
<a href="#l17.29"></a><span id="l17.29"> </span>
<a href="#l17.30"></a><span id="l17.30"> private:</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-  nsRefPtr&lt;nsMsgPrintEngine&gt; mMsgPrintEngine;</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+  RefPtr&lt;nsMsgPrintEngine&gt; mMsgPrintEngine;</span>
<a href="#l17.33"></a><span id="l17.33"> };</span>
<a href="#l17.34"></a><span id="l17.34"> </span>
<a href="#l17.35"></a><span id="l17.35"> //-----------------------------------------------------------</span>
<a href="#l17.36"></a><span id="l17.36"> bool</span>
<a href="#l17.37"></a><span id="l17.37"> nsMsgPrintEngine::FirePrintEvent()</span>
<a href="#l17.38"></a><span id="l17.38"> {</span>
<a href="#l17.39"></a><span id="l17.39">   nsCOMPtr&lt;nsIRunnable&gt; event = new nsPrintMsgWindowEvent(this);</span>
<a href="#l17.40"></a><span id="l17.40">   return NS_SUCCEEDED(NS_DispatchToCurrentThread(event));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -1443,17 +1443,17 @@ nsMsgDBFolder::AddMessageDispositionStat</span>
<a href="#l18.4"></a><span id="l18.4">     mDatabase-&gt;MarkForwarded(msgKey, true, nullptr);</span>
<a href="#l18.5"></a><span id="l18.5">   return NS_OK;</span>
<a href="#l18.6"></a><span id="l18.6"> }</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8"> nsresult nsMsgDBFolder::AddMarkAllReadUndoAction(nsIMsgWindow *msgWindow,</span>
<a href="#l18.9"></a><span id="l18.9">                                                  nsMsgKey *thoseMarked,</span>
<a href="#l18.10"></a><span id="l18.10">                                                  uint32_t numMarked)</span>
<a href="#l18.11"></a><span id="l18.11"> {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  nsRefPtr&lt;nsMsgReadStateTxn&gt; readStateTxn = new nsMsgReadStateTxn();</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  RefPtr&lt;nsMsgReadStateTxn&gt; readStateTxn = new nsMsgReadStateTxn();</span>
<a href="#l18.14"></a><span id="l18.14">   if (!readStateTxn)</span>
<a href="#l18.15"></a><span id="l18.15">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17">   nsresult rv = readStateTxn-&gt;Init(this, numMarked, thoseMarked);</span>
<a href="#l18.18"></a><span id="l18.18">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20">   rv = readStateTxn-&gt;SetTransactionType(nsIMessenger::eMarkAllMsg);</span>
<a href="#l18.21"></a><span id="l18.21">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -1816,17 +1816,17 @@ public:</span>
<a href="#l18.23"></a><span id="l18.23">   {</span>
<a href="#l18.24"></a><span id="l18.24">     if (mFolder)</span>
<a href="#l18.25"></a><span id="l18.25">       mFolder-&gt;HandleAutoCompactEvent(mMsgWindow);</span>
<a href="#l18.26"></a><span id="l18.26">     return NS_OK;</span>
<a href="#l18.27"></a><span id="l18.27">   }</span>
<a href="#l18.28"></a><span id="l18.28"> </span>
<a href="#l18.29"></a><span id="l18.29"> private:</span>
<a href="#l18.30"></a><span id="l18.30">   nsCOMPtr&lt;nsIMsgWindow&gt; mMsgWindow;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-  nsRefPtr&lt;nsMsgDBFolder&gt; mFolder;</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+  RefPtr&lt;nsMsgDBFolder&gt; mFolder;</span>
<a href="#l18.33"></a><span id="l18.33"> };</span>
<a href="#l18.34"></a><span id="l18.34"> </span>
<a href="#l18.35"></a><span id="l18.35"> nsresult nsMsgDBFolder::HandleAutoCompactEvent(nsIMsgWindow *aWindow)</span>
<a href="#l18.36"></a><span id="l18.36"> {</span>
<a href="#l18.37"></a><span id="l18.37">   nsresult rv;</span>
<a href="#l18.38"></a><span id="l18.38">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountMgr = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l18.39"></a><span id="l18.39">   if (NS_SUCCEEDED(rv))</span>
<a href="#l18.40"></a><span id="l18.40">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -2113,17 +2113,17 @@ MsgExamineForProxy(nsIChannel *channel, </span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5">   nsCOMPtr&lt;nsIProtocolProxyService&gt; proxyService =</span>
<a href="#l19.6"></a><span id="l19.6">       do_GetService(NS_PROTOCOLPROXYSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l19.7"></a><span id="l19.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">   // XXX: This &quot;interface&quot; ID is exposed, but it's not hooked up to the QI.</span>
<a href="#l19.10"></a><span id="l19.10">   // Until it is, use a static_cast for now.</span>
<a href="#l19.11"></a><span id="l19.11"> #if 0</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  nsRefPtr&lt;nsProtocolProxyService&gt; rawProxyService = do_QueryObject(proxyService, &amp;rv);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+  RefPtr&lt;nsProtocolProxyService&gt; rawProxyService = do_QueryObject(proxyService, &amp;rv);</span>
<a href="#l19.14"></a><span id="l19.14">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.15"></a><span id="l19.15"> #else</span>
<a href="#l19.16"></a><span id="l19.16">   nsProtocolProxyService *rawProxyService = static_cast&lt;nsProtocolProxyService*&gt;(proxyService.get());</span>
<a href="#l19.17"></a><span id="l19.17"> #endif</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19">   return rawProxyService-&gt;DeprecatedBlockingResolve(channel, 0, proxyInfo);</span>
<a href="#l19.20"></a><span id="l19.20"> }</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -2368,17 +2368,17 @@ MsgDetectCharsetFromFile(nsIFile *aFile,</span>
<a href="#l19.23"></a><span id="l19.23">   nsresult rv;</span>
<a href="#l19.24"></a><span id="l19.24">   nsCOMPtr&lt;nsIInputStream&gt; inputStream;</span>
<a href="#l19.25"></a><span id="l19.25">   rv = NS_NewLocalFileInputStream(getter_AddRefs(inputStream), aFile);</span>
<a href="#l19.26"></a><span id="l19.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">   if (detector) {</span>
<a href="#l19.29"></a><span id="l19.29">     nsAutoCString buffer;</span>
<a href="#l19.30"></a><span id="l19.30"> </span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-    nsRefPtr&lt;CharsetDetectionObserver&gt; observer = new CharsetDetectionObserver();</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+    RefPtr&lt;CharsetDetectionObserver&gt; observer = new CharsetDetectionObserver();</span>
<a href="#l19.33"></a><span id="l19.33"> </span>
<a href="#l19.34"></a><span id="l19.34">     rv = detector-&gt;Init(observer);</span>
<a href="#l19.35"></a><span id="l19.35">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.36"></a><span id="l19.36"> </span>
<a href="#l19.37"></a><span id="l19.37">     nsCOMPtr&lt;nsILineInputStream&gt; lineInputStream;</span>
<a href="#l19.38"></a><span id="l19.38">     lineInputStream = do_QueryInterface(inputStream, &amp;rv);</span>
<a href="#l19.39"></a><span id="l19.39">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.40"></a><span id="l19.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/build/nsMailModule.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/build/nsMailModule.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -808,17 +808,17 @@ static nsresult</span>
<a href="#l20.4"></a><span id="l20.4"> nsPgpMimeMimeContentTypeHandlerConstructor(nsISupports *aOuter,</span>
<a href="#l20.5"></a><span id="l20.5">                                          REFNSIID aIID,</span>
<a href="#l20.6"></a><span id="l20.6">                                          void **aResult)</span>
<a href="#l20.7"></a><span id="l20.7"> {</span>
<a href="#l20.8"></a><span id="l20.8">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l20.9"></a><span id="l20.9">   NS_ENSURE_FALSE(aOuter, NS_ERROR_NO_AGGREGATION);</span>
<a href="#l20.10"></a><span id="l20.10">   *aResult = nullptr;</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  nsRefPtr&lt;nsMimeContentTypeHandler&gt; inst(</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  RefPtr&lt;nsMimeContentTypeHandler&gt; inst(</span>
<a href="#l20.14"></a><span id="l20.14">     new nsMimeContentTypeHandler(&quot;mulitpart/encrypted&quot;,</span>
<a href="#l20.15"></a><span id="l20.15">                                  &amp;MIME_PgpMimeCreateContentTypeHandlerClass));</span>
<a href="#l20.16"></a><span id="l20.16"> </span>
<a href="#l20.17"></a><span id="l20.17">   NS_ENSURE_TRUE(inst, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l20.18"></a><span id="l20.18"> </span>
<a href="#l20.19"></a><span id="l20.19">   return inst-&gt;QueryInterface(aIID, aResult);</span>
<a href="#l20.20"></a><span id="l20.20"> }</span>
<a href="#l20.21"></a><span id="l20.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/compose/public/nsIMsgSend.idl</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/compose/public/nsIMsgSend.idl</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -144,19 +144,19 @@ interface nsIMsgEmbeddedImageData : nsIS</span>
<a href="#l21.4"></a><span id="l21.4"> %{ C++</span>
<a href="#l21.5"></a><span id="l21.5"> // Forward declaration</span>
<a href="#l21.6"></a><span id="l21.6"> class nsMsgAttachmentHandler;</span>
<a href="#l21.7"></a><span id="l21.7"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l21.8"></a><span id="l21.8"> #include &quot;nsTArray.h&quot;</span>
<a href="#l21.9"></a><span id="l21.9"> %}</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11"> [ptr] native nsMsgAttachedFile(nsMsgAttachedFile);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-[ptr] native nsMsgAttachmentHandlerArray(nsTArray&lt;nsRefPtr&lt;nsMsgAttachmentHandler&gt;&gt;);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+[ptr] native nsMsgAttachmentHandlerArray(nsTArray&lt;RefPtr&lt;nsMsgAttachmentHandler&gt;&gt;);</span>
<a href="#l21.14"></a><span id="l21.14"> </span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-[scriptable, uuid(648f8e40-3977-4dd8-88f1-b932bc654aef)]</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+[scriptable, uuid(3fa45021-8174-478f-8c69-f3a8dc3f49fc)]</span>
<a href="#l21.17"></a><span id="l21.17"> interface nsIMsgSend : nsISupports</span>
<a href="#l21.18"></a><span id="l21.18"> {</span>
<a href="#l21.19"></a><span id="l21.19">   //</span>
<a href="#l21.20"></a><span id="l21.20">   // This is the primary interface for creating and sending RFC822 messages</span>
<a href="#l21.21"></a><span id="l21.21">   // in the new architecture. Currently, this method supports many arguments</span>
<a href="#l21.22"></a><span id="l21.22">   // that change the behavior of the operation. This will change in time to </span>
<a href="#l21.23"></a><span id="l21.23">   // be separate calls that will be more singluar in nature.</span>
<a href="#l21.24"></a><span id="l21.24">   //</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1167,17 +1167,17 @@ nsMsgAttachmentHandler::UrlExit(nsresult</span>
<a href="#l22.4"></a><span id="l22.4">   m_mime_delivery_state-&gt;GetProcessAttachmentsSynchronously(&amp;processAttachmentsSynchronously);</span>
<a href="#l22.5"></a><span id="l22.5">   if (NS_SUCCEEDED(status) &amp;&amp; processAttachmentsSynchronously)</span>
<a href="#l22.6"></a><span id="l22.6">   {</span>
<a href="#l22.7"></a><span id="l22.7">     /* Find the next attachment which has not yet been loaded,</span>
<a href="#l22.8"></a><span id="l22.8">      if any, and start it going.</span>
<a href="#l22.9"></a><span id="l22.9">      */</span>
<a href="#l22.10"></a><span id="l22.10">     uint32_t i;</span>
<a href="#l22.11"></a><span id="l22.11">     nsMsgAttachmentHandler *next = 0;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    nsTArray&lt;nsRefPtr&lt;nsMsgAttachmentHandler&gt;&gt; *attachments;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+    nsTArray&lt;RefPtr&lt;nsMsgAttachmentHandler&gt;&gt; *attachments;</span>
<a href="#l22.14"></a><span id="l22.14"> </span>
<a href="#l22.15"></a><span id="l22.15">     m_mime_delivery_state-&gt;GetAttachmentHandlers(&amp;attachments);</span>
<a href="#l22.16"></a><span id="l22.16"> </span>
<a href="#l22.17"></a><span id="l22.17">     for (i = 0; i &lt; attachments-&gt;Length(); i++)</span>
<a href="#l22.18"></a><span id="l22.18">     {</span>
<a href="#l22.19"></a><span id="l22.19">       if (!(*attachments)[i]-&gt;m_done)</span>
<a href="#l22.20"></a><span id="l22.20">       {</span>
<a href="#l22.21"></a><span id="l22.21">         next = (*attachments)[i];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -1081,17 +1081,17 @@ nsresult nsMsgCompose::_SendMsg(MSG_Deli</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5">       // right now, AutoSaveAsDraft is identical to SaveAsDraft as</span>
<a href="#l23.6"></a><span id="l23.6">       // far as the msg send code is concerned. This way, we don't have</span>
<a href="#l23.7"></a><span id="l23.7">       // to add an nsMsgDeliverMode for autosaveasdraft, and add cases for</span>
<a href="#l23.8"></a><span id="l23.8">       // it in the msg send code.</span>
<a href="#l23.9"></a><span id="l23.9">       if (deliverMode == nsIMsgCompDeliverMode::AutoSaveAsDraft)</span>
<a href="#l23.10"></a><span id="l23.10">         deliverMode = nsIMsgCompDeliverMode::SaveAsDraft;</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-      nsRefPtr&lt;nsIMsgCompose&gt; msgCompose(this);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+      RefPtr&lt;nsIMsgCompose&gt; msgCompose(this);</span>
<a href="#l23.14"></a><span id="l23.14">       composeSendListener-&gt;SetMsgCompose(msgCompose);</span>
<a href="#l23.15"></a><span id="l23.15">       composeSendListener-&gt;SetDeliverMode(deliverMode);</span>
<a href="#l23.16"></a><span id="l23.16"> </span>
<a href="#l23.17"></a><span id="l23.17">       if (mProgress)</span>
<a href="#l23.18"></a><span id="l23.18">       {</span>
<a href="#l23.19"></a><span id="l23.19">         nsCOMPtr&lt;nsIWebProgressListener&gt; progressListener = do_QueryInterface(composeSendListener);</span>
<a href="#l23.20"></a><span id="l23.20">         mProgress-&gt;RegisterListener(progressListener);</span>
<a href="#l23.21"></a><span id="l23.21">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCopy.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCopy.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -238,17 +238,17 @@ nsMsgCopy::DoCopy(nsIFile *aDiskFile, ns</span>
<a href="#l24.4"></a><span id="l24.4"> </span>
<a href="#l24.5"></a><span id="l24.5">   // Check sanity</span>
<a href="#l24.6"></a><span id="l24.6">   if ((!aDiskFile) || (!dstFolder))</span>
<a href="#l24.7"></a><span id="l24.7">     return NS_ERROR_INVALID_ARG;</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9">   //Call copyservice with dstFolder, disk file, and txnManager</span>
<a href="#l24.10"></a><span id="l24.10">   if(NS_SUCCEEDED(rv))</span>
<a href="#l24.11"></a><span id="l24.11">   {</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-    nsRefPtr&lt;CopyListener&gt; copyListener = new CopyListener();</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+    RefPtr&lt;CopyListener&gt; copyListener = new CopyListener();</span>
<a href="#l24.14"></a><span id="l24.14">     if (!copyListener)</span>
<a href="#l24.15"></a><span id="l24.15">       return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l24.16"></a><span id="l24.16"> </span>
<a href="#l24.17"></a><span id="l24.17">     copyListener-&gt;SetMsgComposeAndSendObject(aMsgSendObj);</span>
<a href="#l24.18"></a><span id="l24.18">     nsCOMPtr&lt;nsIThread&gt; thread;</span>
<a href="#l24.19"></a><span id="l24.19"> </span>
<a href="#l24.20"></a><span id="l24.20">     if (aIsDraft)</span>
<a href="#l24.21"></a><span id="l24.21">     {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -1450,17 +1450,17 @@ nsMsgComposeAndSend::GetMultipartRelated</span>
<a href="#l25.4"></a><span id="l25.4"> </span>
<a href="#l25.5"></a><span id="l25.5">   if (NS_SUCCEEDED(mEmbeddedObjectList-&gt;Count(&amp;count)))</span>
<a href="#l25.6"></a><span id="l25.6">   {</span>
<a href="#l25.7"></a><span id="l25.7">     if (count &gt; 0)</span>
<a href="#l25.8"></a><span id="l25.8">     {</span>
<a href="#l25.9"></a><span id="l25.9">       // preallocate space for part numbers</span>
<a href="#l25.10"></a><span id="l25.10">       m_partNumbers.SetLength(count);</span>
<a href="#l25.11"></a><span id="l25.11">       // Let parse the list to count the number of valid objects. BTW, we can remove the others from the list</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-      nsRefPtr&lt;nsMsgAttachmentData&gt; attachment(new nsMsgAttachmentData);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+      RefPtr&lt;nsMsgAttachmentData&gt; attachment(new nsMsgAttachmentData);</span>
<a href="#l25.14"></a><span id="l25.14"> </span>
<a href="#l25.15"></a><span id="l25.15">       int32_t i;</span>
<a href="#l25.16"></a><span id="l25.16">       nsCOMPtr&lt;nsIDOMNode&gt; node;</span>
<a href="#l25.17"></a><span id="l25.17"> </span>
<a href="#l25.18"></a><span id="l25.18">       for (i = count - 1, count = 0; i &gt;= 0; i --)</span>
<a href="#l25.19"></a><span id="l25.19">       {</span>
<a href="#l25.20"></a><span id="l25.20">         // Reset this structure to null!</span>
<a href="#l25.21"></a><span id="l25.21"> </span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -1761,17 +1761,17 @@ nsMsgComposeAndSend::ProcessMultipartRel</span>
<a href="#l25.23"></a><span id="l25.23">   int32_t                   j = -1;</span>
<a href="#l25.24"></a><span id="l25.24">   uint32_t                  k;</span>
<a href="#l25.25"></a><span id="l25.25">   int32_t                   duplicateOf;</span>
<a href="#l25.26"></a><span id="l25.26">   domSaveStruct             *domSaveArray = nullptr;</span>
<a href="#l25.27"></a><span id="l25.27"> </span>
<a href="#l25.28"></a><span id="l25.28">    if (!mEmbeddedObjectList)</span>
<a href="#l25.29"></a><span id="l25.29">     return NS_ERROR_MIME_MPART_ATTACHMENT_ERROR;</span>
<a href="#l25.30"></a><span id="l25.30"> </span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-  nsRefPtr&lt;nsMsgAttachmentData&gt; attachment(new nsMsgAttachmentData);</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+  RefPtr&lt;nsMsgAttachmentData&gt; attachment(new nsMsgAttachmentData);</span>
<a href="#l25.33"></a><span id="l25.33">   int32_t               locCount = -1;</span>
<a href="#l25.34"></a><span id="l25.34"> </span>
<a href="#l25.35"></a><span id="l25.35">   if (multipartCount &gt; 0)</span>
<a href="#l25.36"></a><span id="l25.36">   {</span>
<a href="#l25.37"></a><span id="l25.37">     domSaveArray = (domSaveStruct *)PR_MALLOC(sizeof(domSaveStruct) * multipartCount);</span>
<a href="#l25.38"></a><span id="l25.38">     if (!domSaveArray)</span>
<a href="#l25.39"></a><span id="l25.39">       return NS_ERROR_MIME_MPART_ATTACHMENT_ERROR;</span>
<a href="#l25.40"></a><span id="l25.40">     memset(domSaveArray, 0, sizeof(domSaveStruct) * multipartCount);</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineat">@@ -2347,17 +2347,17 @@ nsMsgComposeAndSend::HackAttachments(nsI</span>
<a href="#l25.42"></a><span id="l25.42"> </span>
<a href="#l25.43"></a><span id="l25.43">   mRemoteAttachmentCount += numAttachments;</span>
<a href="#l25.44"></a><span id="l25.44"> </span>
<a href="#l25.45"></a><span id="l25.45">   m_attachment_count = mPreloadedAttachmentCount + mRemoteAttachmentCount;</span>
<a href="#l25.46"></a><span id="l25.46"> </span>
<a href="#l25.47"></a><span id="l25.47">   uint32_t i; // counter for location in attachment array...</span>
<a href="#l25.48"></a><span id="l25.48">   // Now create the array of attachment handlers...</span>
<a href="#l25.49"></a><span id="l25.49">   for (i = 0; i &lt; m_attachment_count; i++) {</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineminus">-    nsRefPtr&lt;nsMsgAttachmentHandler&gt; handler = new nsMsgAttachmentHandler;</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineplus">+    RefPtr&lt;nsMsgAttachmentHandler&gt; handler = new nsMsgAttachmentHandler;</span>
<a href="#l25.52"></a><span id="l25.52">     m_attachments.AppendElement(handler);</span>
<a href="#l25.53"></a><span id="l25.53">   }</span>
<a href="#l25.54"></a><span id="l25.54"> </span>
<a href="#l25.55"></a><span id="l25.55">   //</span>
<a href="#l25.56"></a><span id="l25.56">   // First, we need to attach the files that are defined in the comp fields...</span>
<a href="#l25.57"></a><span id="l25.57">   if (NS_FAILED(AddCompFieldLocalAttachments()))</span>
<a href="#l25.58"></a><span id="l25.58">     return NS_ERROR_INVALID_ARG;</span>
<a href="#l25.59"></a><span id="l25.59"> </span>
<a href="#l25.60"></a><span id="l25.60" class="difflineat">@@ -4805,17 +4805,17 @@ nsresult nsMsgComposeAndSend::Abort()</span>
<a href="#l25.61"></a><span id="l25.61"> </span>
<a href="#l25.62"></a><span id="l25.62"> NS_IMETHODIMP nsMsgComposeAndSend::GetProcessAttachmentsSynchronously(bool *_retval)</span>
<a href="#l25.63"></a><span id="l25.63"> {</span>
<a href="#l25.64"></a><span id="l25.64">   NS_ENSURE_ARG(_retval);</span>
<a href="#l25.65"></a><span id="l25.65">   *_retval = m_be_synchronous_p;</span>
<a href="#l25.66"></a><span id="l25.66">   return NS_OK;</span>
<a href="#l25.67"></a><span id="l25.67"> }</span>
<a href="#l25.68"></a><span id="l25.68"> </span>
<a href="#l25.69"></a><span id="l25.69" class="difflineminus">-NS_IMETHODIMP nsMsgComposeAndSend::GetAttachmentHandlers(nsTArray&lt;nsRefPtr&lt;nsMsgAttachmentHandler&gt;&gt; **_retval)</span>
<a href="#l25.70"></a><span id="l25.70" class="difflineplus">+NS_IMETHODIMP nsMsgComposeAndSend::GetAttachmentHandlers(nsTArray&lt;RefPtr&lt;nsMsgAttachmentHandler&gt;&gt; **_retval)</span>
<a href="#l25.71"></a><span id="l25.71"> {</span>
<a href="#l25.72"></a><span id="l25.72">   NS_ENSURE_ARG(_retval);</span>
<a href="#l25.73"></a><span id="l25.73">   *_retval = &amp;m_attachments;</span>
<a href="#l25.74"></a><span id="l25.74">   return NS_OK;</span>
<a href="#l25.75"></a><span id="l25.75"> }</span>
<a href="#l25.76"></a><span id="l25.76"> </span>
<a href="#l25.77"></a><span id="l25.77"> NS_IMETHODIMP nsMsgComposeAndSend::GetAttachmentCount(uint32_t *aAttachmentCount)</span>
<a href="#l25.78"></a><span id="l25.78"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.h</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.h</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -262,17 +262,17 @@ public:</span>
<a href="#l26.4"></a><span id="l26.4">   nsresult    SetStatusMessage(const nsString &amp;aMsgString);     // Status message method</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6">   //</span>
<a href="#l26.7"></a><span id="l26.7">   // All vars necessary for this implementation</span>
<a href="#l26.8"></a><span id="l26.8">   //</span>
<a href="#l26.9"></a><span id="l26.9">   nsMsgKey                  m_messageKey;        // jt -- Draft/Template support; newly created key</span>
<a href="#l26.10"></a><span id="l26.10">   nsCOMPtr&lt;nsIMsgIdentity&gt;  mUserIdentity;</span>
<a href="#l26.11"></a><span id="l26.11">   nsCString                 mAccountKey;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  nsRefPtr&lt;nsMsgCompFields&gt; mCompFields;         // All needed composition fields (header, etc...)</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+  RefPtr&lt;nsMsgCompFields&gt; mCompFields;         // All needed composition fields (header, etc...)</span>
<a href="#l26.14"></a><span id="l26.14">   nsCOMPtr&lt;nsIFile&gt;         mTempFile;           // our temporary file</span>
<a href="#l26.15"></a><span id="l26.15"> </span>
<a href="#l26.16"></a><span id="l26.16">   nsCOMPtr&lt;nsIOutputStream&gt; mOutputFile;         // the actual output file stream</span>
<a href="#l26.17"></a><span id="l26.17">   uint32_t                  mMessageWarningSize; // Warn if a message is over this size!</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19">   bool                      m_dont_deliver_p;    // If set, we just return the nsIFile of the file</span>
<a href="#l26.20"></a><span id="l26.20">                                                  // created, instead of actually delivering message.</span>
<a href="#l26.21"></a><span id="l26.21">   nsMsgDeliverMode          m_deliver_mode;      // nsMsgDeliverNow, nsMsgQueueForLater, nsMsgSaveAsDraft,</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -298,17 +298,17 @@ public:</span>
<a href="#l26.23"></a><span id="l26.23"> </span>
<a href="#l26.24"></a><span id="l26.24">   // mapping between editor dom node indexes and saved mime part numbers.</span>
<a href="#l26.25"></a><span id="l26.25">   nsTArray&lt;nsCString&gt; m_partNumbers;</span>
<a href="#l26.26"></a><span id="l26.26">   //</span>
<a href="#l26.27"></a><span id="l26.27">   // These variables are needed for message Copy operations!</span>
<a href="#l26.28"></a><span id="l26.28">   //</span>
<a href="#l26.29"></a><span id="l26.29">   nsCOMPtr&lt;nsIFile&gt;         mCopyFile;</span>
<a href="#l26.30"></a><span id="l26.30">   nsCOMPtr&lt;nsIFile&gt;         mCopyFile2;</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-  nsRefPtr&lt;nsMsgCopy&gt;       mCopyObj;</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+  RefPtr&lt;nsMsgCopy&gt;       mCopyObj;</span>
<a href="#l26.33"></a><span id="l26.33">   bool                      mNeedToPerformSecondFCC;</span>
<a href="#l26.34"></a><span id="l26.34">   bool                      mPerformingSecondFCC;</span>
<a href="#l26.35"></a><span id="l26.35"> </span>
<a href="#l26.36"></a><span id="l26.36">   // For MHTML message creation</span>
<a href="#l26.37"></a><span id="l26.37">   nsCOMPtr&lt;nsIEditor&gt;       mEditor;</span>
<a href="#l26.38"></a><span id="l26.38"> </span>
<a href="#l26.39"></a><span id="l26.39">   //</span>
<a href="#l26.40"></a><span id="l26.40">   // The first attachment, if any (typed in by the user.)</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineat">@@ -316,28 +316,28 @@ public:</span>
<a href="#l26.42"></a><span id="l26.42">   char                    *m_attachment1_type;</span>
<a href="#l26.43"></a><span id="l26.43">   char                    *m_attachment1_encoding;</span>
<a href="#l26.44"></a><span id="l26.44">   nsAutoPtr&lt;MimeEncoder&gt;  m_attachment1_encoder;</span>
<a href="#l26.45"></a><span id="l26.45">   char                    *m_attachment1_body;</span>
<a href="#l26.46"></a><span id="l26.46">   uint32_t                m_attachment1_body_length;</span>
<a href="#l26.47"></a><span id="l26.47">   char                    *mOriginalHTMLBody;</span>
<a href="#l26.48"></a><span id="l26.48"> </span>
<a href="#l26.49"></a><span id="l26.49">   // The plaintext form of the first attachment, if needed.</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineminus">-  nsRefPtr&lt;nsMsgAttachmentHandler&gt;  m_plaintext;</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineplus">+  RefPtr&lt;nsMsgAttachmentHandler&gt;  m_plaintext;</span>
<a href="#l26.52"></a><span id="l26.52"> </span>
<a href="#l26.53"></a><span id="l26.53">   // The multipart/related save object for HTML text.</span>
<a href="#l26.54"></a><span id="l26.54">   nsMsgSendPart           *m_related_part;</span>
<a href="#l26.55"></a><span id="l26.55">   nsMsgSendPart           *m_related_body_part;</span>
<a href="#l26.56"></a><span id="l26.56"> </span>
<a href="#l26.57"></a><span id="l26.57">   //</span>
<a href="#l26.58"></a><span id="l26.58">   // Subsequent attachments, if any.</span>
<a href="#l26.59"></a><span id="l26.59">   //</span>
<a href="#l26.60"></a><span id="l26.60">   uint32_t                m_attachment_count;</span>
<a href="#l26.61"></a><span id="l26.61">   uint32_t                m_attachment_pending_count;</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineminus">-  nsTArray&lt; nsRefPtr&lt;nsMsgAttachmentHandler&gt; &gt;  m_attachments;</span>
<a href="#l26.63"></a><span id="l26.63" class="difflineplus">+  nsTArray&lt; RefPtr&lt;nsMsgAttachmentHandler&gt; &gt;  m_attachments;</span>
<a href="#l26.64"></a><span id="l26.64">   nsresult                m_status; // in case some attachments fail but not all</span>
<a href="#l26.65"></a><span id="l26.65"> </span>
<a href="#l26.66"></a><span id="l26.66">   uint32_t                mPreloadedAttachmentCount;</span>
<a href="#l26.67"></a><span id="l26.67">   uint32_t                mRemoteAttachmentCount;</span>
<a href="#l26.68"></a><span id="l26.68">   int32_t                 mMultipartRelatedAttachmentCount; // the number of mpart related attachments, -1 means it has not been yet initialized</span>
<a href="#l26.69"></a><span id="l26.69"> </span>
<a href="#l26.70"></a><span id="l26.70">   uint32_t                mCompFieldLocalAttachments;     // the number of file:// attachments in the comp fields</span>
<a href="#l26.71"></a><span id="l26.71">   uint32_t                mCompFieldRemoteAttachments;    // the number of remote attachments in the comp fields</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -213,17 +213,17 @@ nsresult NS_MsgLoadSmtpUrl(nsIURI * aUrl</span>
<a href="#l27.4"></a><span id="l27.4">   NS_ENSURE_ARG_POINTER(aUrl);</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6">   // For now, assume the url is an smtp url and load it.</span>
<a href="#l27.7"></a><span id="l27.7">   nsresult rv;</span>
<a href="#l27.8"></a><span id="l27.8">   nsCOMPtr&lt;nsISmtpUrl&gt; smtpUrl(do_QueryInterface(aUrl, &amp;rv));</span>
<a href="#l27.9"></a><span id="l27.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.10"></a><span id="l27.10"> </span>
<a href="#l27.11"></a><span id="l27.11">   // Create a smtp protocol instance to run the url in.</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  nsRefPtr&lt;nsSmtpProtocol&gt; smtpProtocol = new nsSmtpProtocol(aUrl);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  RefPtr&lt;nsSmtpProtocol&gt; smtpProtocol = new nsSmtpProtocol(aUrl);</span>
<a href="#l27.14"></a><span id="l27.14">   if (!smtpProtocol)</span>
<a href="#l27.15"></a><span id="l27.15">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l27.16"></a><span id="l27.16"> </span>
<a href="#l27.17"></a><span id="l27.17">   // Protocol will get destroyed when url is completed.</span>
<a href="#l27.18"></a><span id="l27.18">   rv = smtpProtocol-&gt;LoadUrl(aUrl, aConsumer);</span>
<a href="#l27.19"></a><span id="l27.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.20"></a><span id="l27.20"> </span>
<a href="#l27.21"></a><span id="l27.21">   return CallQueryInterface(smtpProtocol.get(), aRequest);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpUrl.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpUrl.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -514,17 +514,17 @@ NS_IMETHODIMP nsMailtoUrl::Equals(nsIURI</span>
<a href="#l28.4"></a><span id="l28.4"> </span>
<a href="#l28.5"></a><span id="l28.5">   return m_baseURL-&gt;Equals(other, _retval);</span>
<a href="#l28.6"></a><span id="l28.6"> }</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8"> NS_IMETHODIMP nsMailtoUrl::Clone(nsIURI **_retval)</span>
<a href="#l28.9"></a><span id="l28.9"> {</span>
<a href="#l28.10"></a><span id="l28.10">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  nsRefPtr&lt;nsMailtoUrl&gt; clone = new nsMailtoUrl();</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  RefPtr&lt;nsMailtoUrl&gt; clone = new nsMailtoUrl();</span>
<a href="#l28.14"></a><span id="l28.14"> </span>
<a href="#l28.15"></a><span id="l28.15">   NS_ENSURE_TRUE(clone, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l28.16"></a><span id="l28.16"> </span>
<a href="#l28.17"></a><span id="l28.17">   nsresult rv = m_baseURL-&gt;Clone(getter_AddRefs(clone-&gt;m_baseURL));</span>
<a href="#l28.18"></a><span id="l28.18">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.19"></a><span id="l28.19"> </span>
<a href="#l28.20"></a><span id="l28.20">   clone-&gt;ParseUrl();</span>
<a href="#l28.21"></a><span id="l28.21">   clone.forget(_retval);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/compose/src/nsURLFetcher.h</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/compose/src/nsURLFetcher.h</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -63,17 +63,17 @@ private:</span>
<a href="#l29.4"></a><span id="l29.4">   nsCOMPtr&lt;nsIStreamListener&gt;     mConverter;               // the stream converter, if needed</span>
<a href="#l29.5"></a><span id="l29.5">   nsCString                  mConverterContentType;    // The content type of the converter</span>
<a href="#l29.6"></a><span id="l29.6">   bool                            mStillRunning;  // Are we still running?</span>
<a href="#l29.7"></a><span id="l29.7">   int32_t                         mTotalWritten;  // Size counter variable</span>
<a href="#l29.8"></a><span id="l29.8">   char                            *mBuffer;                 // Buffer used for reading the data</span>
<a href="#l29.9"></a><span id="l29.9">   uint32_t                        mBufferSize;              // Buffer size;</span>
<a href="#l29.10"></a><span id="l29.10">   nsCString                  mContentType;             // The content type retrieved from the server</span>
<a href="#l29.11"></a><span id="l29.11">   nsCString                  mCharset;                 // The charset retrieved from the server</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  nsRefPtr&lt;nsMsgAttachmentHandler&gt; mTagData;      // Tag data for callback...</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+  RefPtr&lt;nsMsgAttachmentHandler&gt; mTagData;      // Tag data for callback...</span>
<a href="#l29.14"></a><span id="l29.14">   nsAttachSaveCompletionCallback  mCallback;      // Callback to call once the file is saved...</span>
<a href="#l29.15"></a><span id="l29.15">   nsCOMPtr&lt;nsISupports&gt;           mLoadCookie;    // load cookie used by the uri loader when we fetch the url</span>
<a href="#l29.16"></a><span id="l29.16">   bool                            mOnStopRequestProcessed; // used to prevent calling OnStopRequest multiple times</span>
<a href="#l29.17"></a><span id="l29.17">   bool                            mIsFile;        // This is used to check whether the URI is a local file.</span>
<a href="#l29.18"></a><span id="l29.18"> </span>
<a href="#l29.19"></a><span id="l29.19">   friend class nsURLFetcherStreamConsumer;</span>
<a href="#l29.20"></a><span id="l29.20"> }; </span>
<a href="#l29.21"></a><span id="l29.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/db/msgdb/public/nsMsgDatabase.h</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/db/msgdb/public/nsMsgDatabase.h</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -83,17 +83,17 @@ public:</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5">     nsMsgDBEnumerator(nsMsgDatabase* db, nsIMdbTable *table,</span>
<a href="#l30.6"></a><span id="l30.6">                       nsMsgDBEnumeratorFilter filter, void* closure,</span>
<a href="#l30.7"></a><span id="l30.7">                       bool iterateForwards = true);</span>
<a href="#l30.8"></a><span id="l30.8">     void Clear();</span>
<a href="#l30.9"></a><span id="l30.9"> </span>
<a href="#l30.10"></a><span id="l30.10">     nsresult                        GetRowCursor();</span>
<a href="#l30.11"></a><span id="l30.11">     virtual nsresult                PrefetchNext();</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-    nsRefPtr&lt;nsMsgDatabase&gt;         mDB;</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+    RefPtr&lt;nsMsgDatabase&gt;         mDB;</span>
<a href="#l30.14"></a><span id="l30.14">     nsCOMPtr&lt;nsIMdbTableRowCursor&gt;  mRowCursor;</span>
<a href="#l30.15"></a><span id="l30.15">     mdb_pos                         mRowPos;</span>
<a href="#l30.16"></a><span id="l30.16">     nsCOMPtr&lt;nsIMsgDBHdr&gt;           mResultHdr;</span>
<a href="#l30.17"></a><span id="l30.17">     bool                            mDone;</span>
<a href="#l30.18"></a><span id="l30.18">     bool                            mNextPrefetched;</span>
<a href="#l30.19"></a><span id="l30.19">     bool                            mIterateForwards;</span>
<a href="#l30.20"></a><span id="l30.20">     nsMsgDBEnumeratorFilter         mFilter;</span>
<a href="#l30.21"></a><span id="l30.21">     nsCOMPtr &lt;nsIMdbTable&gt;          mTable;</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineat">@@ -419,17 +419,17 @@ public:</span>
<a href="#l30.23"></a><span id="l30.23">                                  void *arg);</span>
<a href="#l30.24"></a><span id="l30.24">   virtual size_t SizeOfExcludingThis(mozilla::MallocSizeOf aMallocSizeOf) const;</span>
<a href="#l30.25"></a><span id="l30.25">   virtual size_t SizeOfIncludingThis(mozilla::MallocSizeOf aMallocSizeOf) const</span>
<a href="#l30.26"></a><span id="l30.26">   {</span>
<a href="#l30.27"></a><span id="l30.27">     return aMallocSizeOf(this) + SizeOfExcludingThis(aMallocSizeOf);</span>
<a href="#l30.28"></a><span id="l30.28">   }</span>
<a href="#l30.29"></a><span id="l30.29"> private:</span>
<a href="#l30.30"></a><span id="l30.30">   uint32_t m_cacheSize;</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-  nsRefPtr&lt;mozilla::mailnews::MsgDBReporter&gt; mMemReporter;</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+  RefPtr&lt;mozilla::mailnews::MsgDBReporter&gt; mMemReporter;</span>
<a href="#l30.33"></a><span id="l30.33"> };</span>
<a href="#l30.34"></a><span id="l30.34"> </span>
<a href="#l30.35"></a><span id="l30.35"> class nsMsgRetentionSettings : public nsIMsgRetentionSettings</span>
<a href="#l30.36"></a><span id="l30.36"> {</span>
<a href="#l30.37"></a><span id="l30.37"> public:</span>
<a href="#l30.38"></a><span id="l30.38">   nsMsgRetentionSettings();</span>
<a href="#l30.39"></a><span id="l30.39"> </span>
<a href="#l30.40"></a><span id="l30.40">   NS_DECL_ISUPPORTS</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/db/msgdb/public/nsMsgThread.h</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/db/msgdb/public/nsMsgThread.h</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -22,17 +22,17 @@ public:</span>
<a href="#l31.4"></a><span id="l31.4">   nsMsgThread(nsMsgDatabase *db, nsIMdbTable *table);</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6">   friend class nsMsgThreadEnumerator;</span>
<a href="#l31.7"></a><span id="l31.7">   friend class nsMsgDatabase;</span>
<a href="#l31.8"></a><span id="l31.8"> </span>
<a href="#l31.9"></a><span id="l31.9">   NS_DECL_ISUPPORTS</span>
<a href="#l31.10"></a><span id="l31.10">   NS_DECL_NSIMSGTHREAD</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  nsRefPtr&lt;nsMsgDatabase&gt; m_mdbDB;</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+  RefPtr&lt;nsMsgDatabase&gt; m_mdbDB;</span>
<a href="#l31.14"></a><span id="l31.14"> </span>
<a href="#l31.15"></a><span id="l31.15"> protected:</span>
<a href="#l31.16"></a><span id="l31.16">   virtual ~nsMsgThread();</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18">   void                  Init();</span>
<a href="#l31.19"></a><span id="l31.19">   void                  Clear();</span>
<a href="#l31.20"></a><span id="l31.20">   virtual nsresult      InitCachedValues();</span>
<a href="#l31.21"></a><span id="l31.21">   nsresult              ChangeChildCount(int32_t delta);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -346,17 +346,17 @@ NS_IMETHODIMP nsMsgDBService::OpenMailDB</span>
<a href="#l32.4"></a><span id="l32.4">   nsCOMPtr &lt;nsIFile&gt;  dbPath;</span>
<a href="#l32.5"></a><span id="l32.5">   nsresult rv = GetSummaryFileLocation(aFolderName, getter_AddRefs(dbPath));</span>
<a href="#l32.6"></a><span id="l32.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8">   *pMessageDB = FindInCache(dbPath);</span>
<a href="#l32.9"></a><span id="l32.9">   if (*pMessageDB)</span>
<a href="#l32.10"></a><span id="l32.10">     return NS_OK;</span>
<a href="#l32.11"></a><span id="l32.11"> </span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  nsRefPtr&lt;nsMailDatabase&gt; msgDB = new nsMailDatabase;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+  RefPtr&lt;nsMailDatabase&gt; msgDB = new nsMailDatabase;</span>
<a href="#l32.14"></a><span id="l32.14">   NS_ENSURE_TRUE(msgDB, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l32.15"></a><span id="l32.15">   rv = msgDB-&gt;Open(this, dbPath, aCreate, aLeaveInvalidDB);</span>
<a href="#l32.16"></a><span id="l32.16">   if (rv == NS_ERROR_FILE_TARGET_DOES_NOT_EXIST)</span>
<a href="#l32.17"></a><span id="l32.17">     return rv;</span>
<a href="#l32.18"></a><span id="l32.18">   NS_IF_ADDREF(*pMessageDB = msgDB);</span>
<a href="#l32.19"></a><span id="l32.19">   if (aCreate &amp;&amp; msgDB &amp;&amp; rv == NS_MSG_ERROR_FOLDER_SUMMARY_MISSING)</span>
<a href="#l32.20"></a><span id="l32.20">     rv = NS_OK;</span>
<a href="#l32.21"></a><span id="l32.21">   if (NS_SUCCEEDED(rv))</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineat">@@ -3028,17 +3028,17 @@ nsMsgDatabase::ReverseEnumerateMessages(</span>
<a href="#l32.23"></a><span id="l32.23">   return NS_OK;</span>
<a href="#l32.24"></a><span id="l32.24"> }</span>
<a href="#l32.25"></a><span id="l32.25"> </span>
<a href="#l32.26"></a><span id="l32.26"> NS_IMETHODIMP</span>
<a href="#l32.27"></a><span id="l32.27"> nsMsgDatabase::GetFilterEnumerator(nsIArray *searchTerms, bool aReverse,</span>
<a href="#l32.28"></a><span id="l32.28">                                    nsISimpleEnumerator **aResult)</span>
<a href="#l32.29"></a><span id="l32.29"> {</span>
<a href="#l32.30"></a><span id="l32.30">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-  nsRefPtr&lt;nsMsgFilteredDBEnumerator&gt; e = </span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+  RefPtr&lt;nsMsgFilteredDBEnumerator&gt; e = </span>
<a href="#l32.33"></a><span id="l32.33">     new nsMsgFilteredDBEnumerator(this, m_mdbAllMsgHeadersTable, aReverse,</span>
<a href="#l32.34"></a><span id="l32.34">                                   searchTerms);</span>
<a href="#l32.35"></a><span id="l32.35"> </span>
<a href="#l32.36"></a><span id="l32.36">   NS_ENSURE_TRUE(e, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l32.37"></a><span id="l32.37">   nsresult rv = e-&gt;InitSearchSession(searchTerms, m_folder);</span>
<a href="#l32.38"></a><span id="l32.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l32.39"></a><span id="l32.39">   return CallQueryInterface(e.get(), aResult);</span>
<a href="#l32.40"></a><span id="l32.40"> }</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineat">@@ -4375,17 +4375,17 @@ nsIMsgThread *  nsMsgDatabase::GetThread</span>
<a href="#l32.42"></a><span id="l32.42">       // It is fine if key was not found,</span>
<a href="#l32.43"></a><span id="l32.43">       // GetThreadForThreadId(nsMsgKey_None) returns nullptr.</span>
<a href="#l32.44"></a><span id="l32.44">       thread = GetThreadForThreadId(key);</span>
<a href="#l32.45"></a><span id="l32.45">     }</span>
<a href="#l32.46"></a><span id="l32.46"> #ifdef DEBUG_bienvenu1</span>
<a href="#l32.47"></a><span id="l32.47">     else</span>
<a href="#l32.48"></a><span id="l32.48">     {</span>
<a href="#l32.49"></a><span id="l32.49">       nsresult  rv;</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineminus">-      nsRefPtr&lt;nsMsgThread&gt; pThread;</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineplus">+      RefPtr&lt;nsMsgThread&gt; pThread;</span>
<a href="#l32.52"></a><span id="l32.52"> </span>
<a href="#l32.53"></a><span id="l32.53">       nsCOMPtr &lt;nsIMdbPortTableCursor&gt; tableCursor;</span>
<a href="#l32.54"></a><span id="l32.54">       m_mdbStore-&gt;GetPortTableCursor(GetEnv(), m_hdrRowScopeToken, m_threadTableKindToken,</span>
<a href="#l32.55"></a><span id="l32.55">                                      getter_AddRefs(tableCursor));</span>
<a href="#l32.56"></a><span id="l32.56"> </span>
<a href="#l32.57"></a><span id="l32.57">         nsCOMPtr&lt;nsIMdbTable&gt; table;</span>
<a href="#l32.58"></a><span id="l32.58"> </span>
<a href="#l32.59"></a><span id="l32.59">         while (true)</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineat">@@ -4972,17 +4972,17 @@ NS_IMETHODIMP nsMsgDatabase::GetNextFake</span>
<a href="#l32.61"></a><span id="l32.61"> }</span>
<a href="#l32.62"></a><span id="l32.62"> </span>
<a href="#l32.63"></a><span id="l32.63"> #ifdef DEBUG</span>
<a href="#l32.64"></a><span id="l32.64"> nsresult nsMsgDatabase::DumpContents()</span>
<a href="#l32.65"></a><span id="l32.65"> {</span>
<a href="#l32.66"></a><span id="l32.66">   nsMsgKey key;</span>
<a href="#l32.67"></a><span id="l32.67">   uint32_t i;</span>
<a href="#l32.68"></a><span id="l32.68"> </span>
<a href="#l32.69"></a><span id="l32.69" class="difflineminus">-  nsRefPtr&lt;nsMsgKeyArray&gt; keys = new nsMsgKeyArray;</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineplus">+  RefPtr&lt;nsMsgKeyArray&gt; keys = new nsMsgKeyArray;</span>
<a href="#l32.71"></a><span id="l32.71">   if (!keys)</span>
<a href="#l32.72"></a><span id="l32.72">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l32.73"></a><span id="l32.73">   nsresult rv = ListAllKeys(keys);</span>
<a href="#l32.74"></a><span id="l32.74">   uint32_t numKeys;</span>
<a href="#l32.75"></a><span id="l32.75">   keys-&gt;GetLength(&amp;numKeys);</span>
<a href="#l32.76"></a><span id="l32.76">   for (i = 0; i &lt; numKeys; i++) {</span>
<a href="#l32.77"></a><span id="l32.77">     key = keys-&gt;m_keys[i];</span>
<a href="#l32.78"></a><span id="l32.78">     nsIMsgDBHdr *msg = NULL;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgHdr.cpp</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgHdr.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -1002,26 +1002,26 @@ public:</span>
<a href="#l33.4"></a><span id="l33.4"> protected:</span>
<a href="#l33.5"></a><span id="l33.5">   virtual ~nsMsgPropertyEnumerator();</span>
<a href="#l33.6"></a><span id="l33.6">   nsCOMPtr&lt;nsIMdbRowCellCursor&gt; mRowCellCursor;</span>
<a href="#l33.7"></a><span id="l33.7">   nsCOMPtr&lt;nsIMdbEnv&gt; m_mdbEnv;</span>
<a href="#l33.8"></a><span id="l33.8">   nsCOMPtr&lt;nsIMdbStore&gt; m_mdbStore;</span>
<a href="#l33.9"></a><span id="l33.9">   // Hold a reference to the hdr so it will hold an xpcom reference to the</span>
<a href="#l33.10"></a><span id="l33.10">   // underlying mdb row. The row cell cursor will crash if the underlying</span>
<a href="#l33.11"></a><span id="l33.11">   // row goes away.</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  nsRefPtr&lt;nsMsgHdr&gt; m_hdr;</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+  RefPtr&lt;nsMsgHdr&gt; m_hdr;</span>
<a href="#l33.14"></a><span id="l33.14">   bool mNextPrefetched;</span>
<a href="#l33.15"></a><span id="l33.15">   mdb_column mNextColumn;</span>
<a href="#l33.16"></a><span id="l33.16"> };</span>
<a href="#l33.17"></a><span id="l33.17"> </span>
<a href="#l33.18"></a><span id="l33.18"> nsMsgPropertyEnumerator::nsMsgPropertyEnumerator(nsMsgHdr* aHdr)</span>
<a href="#l33.19"></a><span id="l33.19">   :  mNextPrefetched(false),</span>
<a href="#l33.20"></a><span id="l33.20">      mNextColumn(NULL_MORK_COLUMN)</span>
<a href="#l33.21"></a><span id="l33.21"> {</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineminus">-  nsRefPtr&lt;nsMsgDatabase&gt; mdb;</span>
<a href="#l33.23"></a><span id="l33.23" class="difflineplus">+  RefPtr&lt;nsMsgDatabase&gt; mdb;</span>
<a href="#l33.24"></a><span id="l33.24">   nsCOMPtr&lt;nsIMdbRow&gt; mdbRow;</span>
<a href="#l33.25"></a><span id="l33.25"> </span>
<a href="#l33.26"></a><span id="l33.26">   if (aHdr &amp;&amp;</span>
<a href="#l33.27"></a><span id="l33.27">       (mdbRow = aHdr-&gt;GetMDBRow()) &amp;&amp;</span>
<a href="#l33.28"></a><span id="l33.28">       (m_hdr = aHdr) &amp;&amp;</span>
<a href="#l33.29"></a><span id="l33.29">       (mdb = aHdr-&gt;m_mdb) &amp;&amp;</span>
<a href="#l33.30"></a><span id="l33.30">       (m_mdbEnv = mdb-&gt;m_mdbEnv) &amp;&amp;</span>
<a href="#l33.31"></a><span id="l33.31">       (m_mdbStore = mdb-&gt;m_mdbStore))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/imap/src/nsAutoSyncState.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/imap/src/nsAutoSyncState.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -337,17 +337,17 @@ NS_IMETHODIMP nsAutoSyncState::ProcessEx</span>
<a href="#l34.4"></a><span id="l34.4">   nsCOMPtr&lt;nsIMsgDatabase&gt; database;</span>
<a href="#l34.5"></a><span id="l34.5">   rv = folder-&gt;GetMsgDatabase(getter_AddRefs(database));</span>
<a href="#l34.6"></a><span id="l34.6">   if (!database)</span>
<a href="#l34.7"></a><span id="l34.7">     return NS_ERROR_FAILURE;</span>
<a href="#l34.8"></a><span id="l34.8"> </span>
<a href="#l34.9"></a><span id="l34.9">   // create a queue to process existing headers for the first time</span>
<a href="#l34.10"></a><span id="l34.10">   if (mExistingHeadersQ.IsEmpty())</span>
<a href="#l34.11"></a><span id="l34.11">   {</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-    nsRefPtr&lt;nsMsgKeyArray&gt; keys = new nsMsgKeyArray;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+    RefPtr&lt;nsMsgKeyArray&gt; keys = new nsMsgKeyArray;</span>
<a href="#l34.14"></a><span id="l34.14">     rv = database-&gt;ListAllKeys(keys);</span>
<a href="#l34.15"></a><span id="l34.15">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.16"></a><span id="l34.16">     keys-&gt;Sort();</span>
<a href="#l34.17"></a><span id="l34.17">     mExistingHeadersQ.AppendElements(keys-&gt;m_keys);</span>
<a href="#l34.18"></a><span id="l34.18">     mProcessPointer = 0;</span>
<a href="#l34.19"></a><span id="l34.19">   }</span>
<a href="#l34.20"></a><span id="l34.20"> </span>
<a href="#l34.21"></a><span id="l34.21">   // process the existing headers and find the messages not downloaded yet</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPBodyShell.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPBodyShell.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -1248,17 +1248,17 @@ bool nsIMAPBodyShellCache::AddShellToCac</span>
<a href="#l35.4"></a><span id="l35.4">   if (FindShellForUID(shell-&gt;GetUID(), shell-&gt;GetFolderName(), shell-&gt;GetContentModified()))</span>
<a href="#l35.5"></a><span id="l35.5">     return true;</span>
<a href="#l35.6"></a><span id="l35.6"> </span>
<a href="#l35.7"></a><span id="l35.7">   // OK, so it's not in the cache currently.</span>
<a href="#l35.8"></a><span id="l35.8"> </span>
<a href="#l35.9"></a><span id="l35.9">   // First, for safety sake, remove any entry with the given UID,</span>
<a href="#l35.10"></a><span id="l35.10">   // just in case we have a collision between two messages in different</span>
<a href="#l35.11"></a><span id="l35.11">   // folders with the same UID.</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-  nsRefPtr&lt;nsIMAPBodyShell&gt; foundShell;</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+  RefPtr&lt;nsIMAPBodyShell&gt; foundShell;</span>
<a href="#l35.14"></a><span id="l35.14">   m_shellHash.Get(shell-&gt;GetUID(), getter_AddRefs(foundShell));</span>
<a href="#l35.15"></a><span id="l35.15">   if (foundShell)</span>
<a href="#l35.16"></a><span id="l35.16">   {</span>
<a href="#l35.17"></a><span id="l35.17">     m_shellHash.Remove(foundShell-&gt;GetUID());</span>
<a href="#l35.18"></a><span id="l35.18">     m_shellList-&gt;RemoveElement(foundShell);</span>
<a href="#l35.19"></a><span id="l35.19">   }</span>
<a href="#l35.20"></a><span id="l35.20"> </span>
<a href="#l35.21"></a><span id="l35.21">   // Add the new one to the cache</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -1274,17 +1274,17 @@ bool nsIMAPBodyShellCache::AddShellToCac</span>
<a href="#l35.23"></a><span id="l35.23"> </span>
<a href="#l35.24"></a><span id="l35.24">   return rv;</span>
<a href="#l35.25"></a><span id="l35.25"> </span>
<a href="#l35.26"></a><span id="l35.26"> }</span>
<a href="#l35.27"></a><span id="l35.27"> </span>
<a href="#l35.28"></a><span id="l35.28"> nsIMAPBodyShell *nsIMAPBodyShellCache::FindShellForUID(nsCString &amp;UID, const char *mailboxName,</span>
<a href="#l35.29"></a><span id="l35.29">                                                        IMAP_ContentModifiedType modType)</span>
<a href="#l35.30"></a><span id="l35.30"> {</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-  nsRefPtr&lt;nsIMAPBodyShell&gt; foundShell;</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+  RefPtr&lt;nsIMAPBodyShell&gt; foundShell;</span>
<a href="#l35.33"></a><span id="l35.33">   m_shellHash.Get(UID, getter_AddRefs(foundShell));</span>
<a href="#l35.34"></a><span id="l35.34">   if (!foundShell)</span>
<a href="#l35.35"></a><span id="l35.35">     return nullptr;</span>
<a href="#l35.36"></a><span id="l35.36">   // Make sure the content-modified types are compatible.</span>
<a href="#l35.37"></a><span id="l35.37">   // This allows us to work seamlessly while people switch between</span>
<a href="#l35.38"></a><span id="l35.38">   // View Attachments Inline and View Attachments As Links.</span>
<a href="#l35.39"></a><span id="l35.39">   // Enforce the invariant that any cached shell we use</span>
<a href="#l35.40"></a><span id="l35.40">   // match the current content-modified settings.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -784,17 +784,17 @@ NS_IMETHODIMP nsImapMailFolder::UpdateFo</span>
<a href="#l36.4"></a><span id="l36.4"> </span>
<a href="#l36.5"></a><span id="l36.5">   if (!WeAreOffline())</span>
<a href="#l36.6"></a><span id="l36.6">   {</span>
<a href="#l36.7"></a><span id="l36.7">     if (hasOfflineEvents)</span>
<a href="#l36.8"></a><span id="l36.8">     {</span>
<a href="#l36.9"></a><span id="l36.9">       // hold a reference to the offline sync object. If ProcessNextOperation</span>
<a href="#l36.10"></a><span id="l36.10">       // runs a url, a reference will be added to it. Otherwise, it will get</span>
<a href="#l36.11"></a><span id="l36.11">       // destroyed when the refptr goes out of scope.</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-      nsRefPtr&lt;nsImapOfflineSync&gt; goOnline = new nsImapOfflineSync(aMsgWindow, this, this);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+      RefPtr&lt;nsImapOfflineSync&gt; goOnline = new nsImapOfflineSync(aMsgWindow, this, this);</span>
<a href="#l36.14"></a><span id="l36.14">       if (goOnline)</span>
<a href="#l36.15"></a><span id="l36.15">       {</span>
<a href="#l36.16"></a><span id="l36.16">         m_urlListener = aUrlListener;</span>
<a href="#l36.17"></a><span id="l36.17">         return goOnline-&gt;ProcessNextOperation();</span>
<a href="#l36.18"></a><span id="l36.18">       }</span>
<a href="#l36.19"></a><span id="l36.19">     }</span>
<a href="#l36.20"></a><span id="l36.20">   }</span>
<a href="#l36.21"></a><span id="l36.21"> </span>
<a href="#l36.22"></a><span id="l36.22" class="difflineat">@@ -2240,17 +2240,17 @@ NS_IMETHODIMP nsImapMailFolder::DeleteMe</span>
<a href="#l36.23"></a><span id="l36.23">     }</span>
<a href="#l36.24"></a><span id="l36.24">   }</span>
<a href="#l36.25"></a><span id="l36.25"> </span>
<a href="#l36.26"></a><span id="l36.26">   if ((NS_SUCCEEDED(rv) &amp;&amp; deleteImmediatelyNoTrash) || deleteModel == nsMsgImapDeleteModels::IMAPDelete )</span>
<a href="#l36.27"></a><span id="l36.27">   {</span>
<a href="#l36.28"></a><span id="l36.28">     if (allowUndo)</span>
<a href="#l36.29"></a><span id="l36.29">     {</span>
<a href="#l36.30"></a><span id="l36.30">       //need to take care of these two delete models</span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-      nsRefPtr&lt;nsImapMoveCopyMsgTxn&gt; undoMsgTxn = new nsImapMoveCopyMsgTxn;</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineplus">+      RefPtr&lt;nsImapMoveCopyMsgTxn&gt; undoMsgTxn = new nsImapMoveCopyMsgTxn;</span>
<a href="#l36.33"></a><span id="l36.33">       if (!undoMsgTxn || NS_FAILED(undoMsgTxn-&gt;Init(this, &amp;srcKeyArray, messageIds.get(), nullptr,</span>
<a href="#l36.34"></a><span id="l36.34">                                                     true, isMove)))</span>
<a href="#l36.35"></a><span id="l36.35">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l36.36"></a><span id="l36.36"> </span>
<a href="#l36.37"></a><span id="l36.37">       undoMsgTxn-&gt;SetTransactionType(nsIMessenger::eDeleteMsg);</span>
<a href="#l36.38"></a><span id="l36.38">       // we're adding this undo action before the delete is successful. This is evil,</span>
<a href="#l36.39"></a><span id="l36.39">       // but 4.5 did it as well.</span>
<a href="#l36.40"></a><span id="l36.40">       nsCOMPtr &lt;nsITransactionManager&gt; txnMgr;</span>
<a href="#l36.41"></a><span id="l36.41" class="difflineat">@@ -2669,17 +2669,17 @@ NS_IMETHODIMP nsImapMailFolder::UpdateIm</span>
<a href="#l36.42"></a><span id="l36.42">     {</span>
<a href="#l36.43"></a><span id="l36.43">       dbFolderInfo-&gt;GetImapUidValidity(&amp;imapUIDValidity);</span>
<a href="#l36.44"></a><span id="l36.44">       uint64_t mailboxHighestModSeq;</span>
<a href="#l36.45"></a><span id="l36.45">       aSpec-&gt;GetHighestModSeq(&amp;mailboxHighestModSeq);</span>
<a href="#l36.46"></a><span id="l36.46">       char intStrBuf[40];</span>
<a href="#l36.47"></a><span id="l36.47">       PR_snprintf(intStrBuf, sizeof(intStrBuf), &quot;%llu&quot;,  mailboxHighestModSeq);</span>
<a href="#l36.48"></a><span id="l36.48">       dbFolderInfo-&gt;SetCharProperty(kModSeqPropertyName, nsDependentCString(intStrBuf));</span>
<a href="#l36.49"></a><span id="l36.49">     }</span>
<a href="#l36.50"></a><span id="l36.50" class="difflineminus">-    nsRefPtr&lt;nsMsgKeyArray&gt; keys = new nsMsgKeyArray;</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineplus">+    RefPtr&lt;nsMsgKeyArray&gt; keys = new nsMsgKeyArray;</span>
<a href="#l36.52"></a><span id="l36.52">     if (!keys)</span>
<a href="#l36.53"></a><span id="l36.53">       return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l36.54"></a><span id="l36.54">     rv = mDatabase-&gt;ListAllKeys(keys);</span>
<a href="#l36.55"></a><span id="l36.55">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l36.56"></a><span id="l36.56">     existingKeys.AppendElements(keys-&gt;m_keys);</span>
<a href="#l36.57"></a><span id="l36.57">     mDatabase-&gt;ListAllOfflineDeletes(&amp;existingKeys);</span>
<a href="#l36.58"></a><span id="l36.58">   }</span>
<a href="#l36.59"></a><span id="l36.59">   int32_t folderValidity;</span>
<a href="#l36.60"></a><span id="l36.60" class="difflineat">@@ -5254,17 +5254,17 @@ nsImapMailFolder::OnStopRunningUrl(nsIUR</span>
<a href="#l36.61"></a><span id="l36.61">           {</span>
<a href="#l36.62"></a><span id="l36.62">             if (NS_SUCCEEDED(aExitCode))</span>
<a href="#l36.63"></a><span id="l36.63">             {</span>
<a href="#l36.64"></a><span id="l36.64">               nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l36.65"></a><span id="l36.65">               if (srcFolder)</span>
<a href="#l36.66"></a><span id="l36.66">                   rv = srcFolder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l36.67"></a><span id="l36.67">               if (NS_SUCCEEDED(rv) &amp;&amp; srcDB)</span>
<a href="#l36.68"></a><span id="l36.68">               {</span>
<a href="#l36.69"></a><span id="l36.69" class="difflineminus">-                nsRefPtr&lt;nsImapMoveCopyMsgTxn&gt; msgTxn;</span>
<a href="#l36.70"></a><span id="l36.70" class="difflineplus">+                RefPtr&lt;nsImapMoveCopyMsgTxn&gt; msgTxn;</span>
<a href="#l36.71"></a><span id="l36.71">                 nsTArray&lt;nsMsgKey&gt; srcKeyArray;</span>
<a href="#l36.72"></a><span id="l36.72">                 if (m_copyState-&gt;m_allowUndo)</span>
<a href="#l36.73"></a><span id="l36.73">                 {</span>
<a href="#l36.74"></a><span id="l36.74">                   msgTxn = m_copyState-&gt;m_undoMsgTxn;</span>
<a href="#l36.75"></a><span id="l36.75">                   if (msgTxn)</span>
<a href="#l36.76"></a><span id="l36.76">                     msgTxn-&gt;GetSrcKeyArray(srcKeyArray);</span>
<a href="#l36.77"></a><span id="l36.77">                 }</span>
<a href="#l36.78"></a><span id="l36.78">                 else</span>
<a href="#l36.79"></a><span id="l36.79" class="difflineat">@@ -5622,17 +5622,17 @@ nsImapMailFolder::RefreshFolderRights()</span>
<a href="#l36.80"></a><span id="l36.80">   return NS_OK;</span>
<a href="#l36.81"></a><span id="l36.81"> }</span>
<a href="#l36.82"></a><span id="l36.82"> </span>
<a href="#l36.83"></a><span id="l36.83"> NS_IMETHODIMP</span>
<a href="#l36.84"></a><span id="l36.84"> nsImapMailFolder::SetCopyResponseUid(const char* msgIdString,</span>
<a href="#l36.85"></a><span id="l36.85">                                      nsIImapUrl * aUrl)</span>
<a href="#l36.86"></a><span id="l36.86"> {   // CopyMessages() only</span>
<a href="#l36.87"></a><span id="l36.87">   nsresult rv = NS_OK;</span>
<a href="#l36.88"></a><span id="l36.88" class="difflineminus">-  nsRefPtr&lt;nsImapMoveCopyMsgTxn&gt; msgTxn;</span>
<a href="#l36.89"></a><span id="l36.89" class="difflineplus">+  RefPtr&lt;nsImapMoveCopyMsgTxn&gt; msgTxn;</span>
<a href="#l36.90"></a><span id="l36.90">   nsCOMPtr&lt;nsISupports&gt; copyState;</span>
<a href="#l36.91"></a><span id="l36.91"> </span>
<a href="#l36.92"></a><span id="l36.92">   if (aUrl)</span>
<a href="#l36.93"></a><span id="l36.93">     aUrl-&gt;GetCopyState(getter_AddRefs(copyState));</span>
<a href="#l36.94"></a><span id="l36.94"> </span>
<a href="#l36.95"></a><span id="l36.95">   if (copyState)</span>
<a href="#l36.96"></a><span id="l36.96">   {</span>
<a href="#l36.97"></a><span id="l36.97">     nsCOMPtr&lt;nsImapMailCopyState&gt; mailCopyState =</span>
<a href="#l36.98"></a><span id="l36.98" class="difflineat">@@ -5640,17 +5640,17 @@ nsImapMailFolder::SetCopyResponseUid(con</span>
<a href="#l36.99"></a><span id="l36.99">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l36.100"></a><span id="l36.100">     if (mailCopyState-&gt;m_undoMsgTxn)</span>
<a href="#l36.101"></a><span id="l36.101">       msgTxn = mailCopyState-&gt;m_undoMsgTxn;</span>
<a href="#l36.102"></a><span id="l36.102">   }</span>
<a href="#l36.103"></a><span id="l36.103">   else if (aUrl &amp;&amp; m_pendingOfflineMoves.Length())</span>
<a href="#l36.104"></a><span id="l36.104">   {</span>
<a href="#l36.105"></a><span id="l36.105">     nsCString urlSourceMsgIds, undoTxnSourceMsgIds;</span>
<a href="#l36.106"></a><span id="l36.106">     aUrl-&gt;GetListOfMessageIds(urlSourceMsgIds);</span>
<a href="#l36.107"></a><span id="l36.107" class="difflineminus">-    nsRefPtr&lt;nsImapMoveCopyMsgTxn&gt; imapUndo = m_pendingOfflineMoves[0];</span>
<a href="#l36.108"></a><span id="l36.108" class="difflineplus">+    RefPtr&lt;nsImapMoveCopyMsgTxn&gt; imapUndo = m_pendingOfflineMoves[0];</span>
<a href="#l36.109"></a><span id="l36.109">     if (imapUndo)</span>
<a href="#l36.110"></a><span id="l36.110">     {</span>
<a href="#l36.111"></a><span id="l36.111">       imapUndo-&gt;GetSrcMsgIds(undoTxnSourceMsgIds);</span>
<a href="#l36.112"></a><span id="l36.112">       if (undoTxnSourceMsgIds.Equals(urlSourceMsgIds))</span>
<a href="#l36.113"></a><span id="l36.113">         msgTxn = imapUndo;</span>
<a href="#l36.114"></a><span id="l36.114">       // ### we should handle batched moves, but lets keep it simple for a2.</span>
<a href="#l36.115"></a><span id="l36.115">       m_pendingOfflineMoves.Clear();</span>
<a href="#l36.116"></a><span id="l36.116">     }</span>
<a href="#l36.117"></a><span id="l36.117" class="difflineat">@@ -5752,17 +5752,17 @@ nsImapMailFolder::SetAppendMsgUid(nsMsgK</span>
<a href="#l36.118"></a><span id="l36.118">     aUrl-&gt;GetCopyState(getter_AddRefs(copyState));</span>
<a href="#l36.119"></a><span id="l36.119">   if (copyState)</span>
<a href="#l36.120"></a><span id="l36.120">   {</span>
<a href="#l36.121"></a><span id="l36.121">     nsCOMPtr&lt;nsImapMailCopyState&gt; mailCopyState = do_QueryInterface(copyState, &amp;rv);</span>
<a href="#l36.122"></a><span id="l36.122">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l36.123"></a><span id="l36.123"> </span>
<a href="#l36.124"></a><span id="l36.124">     if (mailCopyState-&gt;m_undoMsgTxn) // CopyMessages()</span>
<a href="#l36.125"></a><span id="l36.125">     {</span>
<a href="#l36.126"></a><span id="l36.126" class="difflineminus">-        nsRefPtr&lt;nsImapMoveCopyMsgTxn&gt; msgTxn;</span>
<a href="#l36.127"></a><span id="l36.127" class="difflineplus">+        RefPtr&lt;nsImapMoveCopyMsgTxn&gt; msgTxn;</span>
<a href="#l36.128"></a><span id="l36.128">         msgTxn = mailCopyState-&gt;m_undoMsgTxn;</span>
<a href="#l36.129"></a><span id="l36.129">         msgTxn-&gt;AddDstKey(aKey);</span>
<a href="#l36.130"></a><span id="l36.130">     }</span>
<a href="#l36.131"></a><span id="l36.131">     else if (mailCopyState-&gt;m_listener) // CopyFileMessage();</span>
<a href="#l36.132"></a><span id="l36.132">                                         // Draft/Template goes here</span>
<a href="#l36.133"></a><span id="l36.133">     {</span>
<a href="#l36.134"></a><span id="l36.134">       mailCopyState-&gt;m_appendUID = aKey;</span>
<a href="#l36.135"></a><span id="l36.135">       mailCopyState-&gt;m_listener-&gt;SetMessageKey(aKey);</span>
<a href="#l36.136"></a><span id="l36.136" class="difflineat">@@ -6899,17 +6899,17 @@ nsImapMailFolder::CopyMessagesWithStream</span>
<a href="#l36.137"></a><span id="l36.137"> </span>
<a href="#l36.138"></a><span id="l36.138">   // ** jt - needs to create server to server move/copy undo msg txn</span>
<a href="#l36.139"></a><span id="l36.139">   if (m_copyState-&gt;m_allowUndo)</span>
<a href="#l36.140"></a><span id="l36.140">   {</span>
<a href="#l36.141"></a><span id="l36.141">     nsAutoCString messageIds;</span>
<a href="#l36.142"></a><span id="l36.142">     nsTArray&lt;nsMsgKey&gt; srcKeyArray;</span>
<a href="#l36.143"></a><span id="l36.143">     rv = BuildIdsAndKeyArray(messages, messageIds, srcKeyArray);</span>
<a href="#l36.144"></a><span id="l36.144"> </span>
<a href="#l36.145"></a><span id="l36.145" class="difflineminus">-    nsRefPtr&lt;nsImapMoveCopyMsgTxn&gt; undoMsgTxn = new nsImapMoveCopyMsgTxn;</span>
<a href="#l36.146"></a><span id="l36.146" class="difflineplus">+    RefPtr&lt;nsImapMoveCopyMsgTxn&gt; undoMsgTxn = new nsImapMoveCopyMsgTxn;</span>
<a href="#l36.147"></a><span id="l36.147"> </span>
<a href="#l36.148"></a><span id="l36.148">     if (!undoMsgTxn || NS_FAILED(undoMsgTxn-&gt;Init(srcFolder, &amp;srcKeyArray, messageIds.get(), this,</span>
<a href="#l36.149"></a><span id="l36.149">                                 true, isMove)))</span>
<a href="#l36.150"></a><span id="l36.150">       return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l36.151"></a><span id="l36.151"> </span>
<a href="#l36.152"></a><span id="l36.152">     if (isMove)</span>
<a href="#l36.153"></a><span id="l36.153">     {</span>
<a href="#l36.154"></a><span id="l36.154">       if (mFlags &amp; nsMsgFolderFlags::Trash)</span>
<a href="#l36.155"></a><span id="l36.155" class="difflineat">@@ -7350,22 +7350,22 @@ nsresult nsImapMailFolder::CopyMessagesO</span>
<a href="#l36.156"></a><span id="l36.156">               sourceMailDB-&gt;MarkImapDeleted(msgKey, true, nullptr); // offline delete</span>
<a href="#l36.157"></a><span id="l36.157">           }</span>
<a href="#l36.158"></a><span id="l36.158">           if (successfulCopy)</span>
<a href="#l36.159"></a><span id="l36.159">             // This is for both moves and copies</span>
<a href="#l36.160"></a><span id="l36.160">             msgHdrsCopied-&gt;AppendElement(mailHdr, false);</span>
<a href="#l36.161"></a><span id="l36.161">         }</span>
<a href="#l36.162"></a><span id="l36.162">       }</span>
<a href="#l36.163"></a><span id="l36.163">       EnableNotifications(nsIMsgFolder::allMessageCountNotifications, true, false);</span>
<a href="#l36.164"></a><span id="l36.164" class="difflineminus">-      nsRefPtr&lt;nsImapOfflineTxn&gt; addHdrMsgTxn = new</span>
<a href="#l36.165"></a><span id="l36.165" class="difflineplus">+      RefPtr&lt;nsImapOfflineTxn&gt; addHdrMsgTxn = new</span>
<a href="#l36.166"></a><span id="l36.166">         nsImapOfflineTxn(this, &amp;addedKeys, nullptr, this, isMove, nsIMsgOfflineImapOperation::kAddedHeader,</span>
<a href="#l36.167"></a><span id="l36.167">                          addedHdrs);</span>
<a href="#l36.168"></a><span id="l36.168">       if (addHdrMsgTxn &amp;&amp; txnMgr)</span>
<a href="#l36.169"></a><span id="l36.169">          txnMgr-&gt;DoTransaction(addHdrMsgTxn);</span>
<a href="#l36.170"></a><span id="l36.170" class="difflineminus">-      nsRefPtr&lt;nsImapOfflineTxn&gt; undoMsgTxn = new</span>
<a href="#l36.171"></a><span id="l36.171" class="difflineplus">+      RefPtr&lt;nsImapOfflineTxn&gt; undoMsgTxn = new</span>
<a href="#l36.172"></a><span id="l36.172">         nsImapOfflineTxn(srcFolder, &amp;srcKeyArray, messageIds.get(), this,</span>
<a href="#l36.173"></a><span id="l36.173">                          isMove, moveCopyOpType, srcMsgs);</span>
<a href="#l36.174"></a><span id="l36.174">       if (undoMsgTxn)</span>
<a href="#l36.175"></a><span id="l36.175">       {</span>
<a href="#l36.176"></a><span id="l36.176">         if (isMove)</span>
<a href="#l36.177"></a><span id="l36.177">         {</span>
<a href="#l36.178"></a><span id="l36.178">           undoMsgTxn-&gt;SetTransactionType(nsIMessenger::eMoveMsg);</span>
<a href="#l36.179"></a><span id="l36.179">           nsCOMPtr&lt;nsIMsgImapMailFolder&gt; srcIsImap(do_QueryInterface(srcFolder));</span>
<a href="#l36.180"></a><span id="l36.180" class="difflineat">@@ -7689,17 +7689,17 @@ nsImapMailFolder::CopyMessages(nsIMsgFol</span>
<a href="#l36.181"></a><span id="l36.181"> </span>
<a href="#l36.182"></a><span id="l36.182">     nsCOMPtr&lt;nsISupports&gt; copySupport = do_QueryInterface(m_copyState);</span>
<a href="#l36.183"></a><span id="l36.183">     rv = imapService-&gt;OnlineMessageCopy(srcFolder, messageIds,</span>
<a href="#l36.184"></a><span id="l36.184">                                         this, true, isMove,</span>
<a href="#l36.185"></a><span id="l36.185">                                         urlListener, nullptr,</span>
<a href="#l36.186"></a><span id="l36.186">                                         copySupport, msgWindow);</span>
<a href="#l36.187"></a><span id="l36.187">     if (NS_SUCCEEDED(rv) &amp;&amp; m_copyState-&gt;m_allowUndo)</span>
<a href="#l36.188"></a><span id="l36.188">     {</span>
<a href="#l36.189"></a><span id="l36.189" class="difflineminus">-      nsRefPtr&lt;nsImapMoveCopyMsgTxn&gt; undoMsgTxn = new nsImapMoveCopyMsgTxn;</span>
<a href="#l36.190"></a><span id="l36.190" class="difflineplus">+      RefPtr&lt;nsImapMoveCopyMsgTxn&gt; undoMsgTxn = new nsImapMoveCopyMsgTxn;</span>
<a href="#l36.191"></a><span id="l36.191">       if (!undoMsgTxn || NS_FAILED(undoMsgTxn-&gt;Init(srcFolder, &amp;keyArray,</span>
<a href="#l36.192"></a><span id="l36.192">                                    messageIds.get(), this,</span>
<a href="#l36.193"></a><span id="l36.193">                                    true, isMove)))</span>
<a href="#l36.194"></a><span id="l36.194">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l36.195"></a><span id="l36.195"> </span>
<a href="#l36.196"></a><span id="l36.196">       if (isMove)</span>
<a href="#l36.197"></a><span id="l36.197">       {</span>
<a href="#l36.198"></a><span id="l36.198">         if (mFlags &amp; nsMsgFolderFlags::Trash)</span>
<a href="#l36.199"></a><span id="l36.199" class="difflineat">@@ -7736,17 +7736,17 @@ public:</span>
<a href="#l36.200"></a><span id="l36.200">   NS_DECL_ISUPPORTS</span>
<a href="#l36.201"></a><span id="l36.201">   NS_DECL_NSIURLLISTENER</span>
<a href="#l36.202"></a><span id="l36.202">   NS_DECL_NSIMSGCOPYSERVICELISTENER</span>
<a href="#l36.203"></a><span id="l36.203"> </span>
<a href="#l36.204"></a><span id="l36.204">   nsresult StartNextCopy();</span>
<a href="#l36.205"></a><span id="l36.205">   nsresult AdvanceToNextFolder(nsresult aStatus);</span>
<a href="#l36.206"></a><span id="l36.206"> protected:</span>
<a href="#l36.207"></a><span id="l36.207">   ~nsImapFolderCopyState();</span>
<a href="#l36.208"></a><span id="l36.208" class="difflineminus">-  nsRefPtr&lt;nsImapMailFolder&gt; m_newDestFolder;</span>
<a href="#l36.209"></a><span id="l36.209" class="difflineplus">+  RefPtr&lt;nsImapMailFolder&gt; m_newDestFolder;</span>
<a href="#l36.210"></a><span id="l36.210">   nsCOMPtr&lt;nsISupports&gt; m_origSrcFolder;</span>
<a href="#l36.211"></a><span id="l36.211">   nsCOMPtr&lt;nsIMsgFolder&gt; m_curDestParent;</span>
<a href="#l36.212"></a><span id="l36.212">   nsCOMPtr&lt;nsIMsgFolder&gt; m_curSrcFolder;</span>
<a href="#l36.213"></a><span id="l36.213">   bool                    m_isMoveFolder;</span>
<a href="#l36.214"></a><span id="l36.214">   nsCOMPtr&lt;nsIMsgCopyServiceListener&gt; m_copySrvcListener;</span>
<a href="#l36.215"></a><span id="l36.215">   nsCOMPtr&lt;nsIMsgWindow&gt; m_msgWindow;</span>
<a href="#l36.216"></a><span id="l36.216">   int32_t                 m_childIndex;</span>
<a href="#l36.217"></a><span id="l36.217">   nsCOMArray&lt;nsIMsgFolder&gt; m_srcChildFolders;</span>
<a href="#l36.218"></a><span id="l36.218" class="difflineat">@@ -9640,17 +9640,17 @@ nsresult nsImapMailFolder::CreatePlaybac</span>
<a href="#l36.219"></a><span id="l36.219"> }</span>
<a href="#l36.220"></a><span id="l36.220"> </span>
<a href="#l36.221"></a><span id="l36.221"> void nsImapMailFolder::PlaybackTimerCallback(nsITimer *aTimer, void *aClosure)</span>
<a href="#l36.222"></a><span id="l36.222"> {</span>
<a href="#l36.223"></a><span id="l36.223">   nsPlaybackRequest *request = static_cast&lt;nsPlaybackRequest*&gt;(aClosure);</span>
<a href="#l36.224"></a><span id="l36.224">   </span>
<a href="#l36.225"></a><span id="l36.225">   NS_ASSERTION(request-&gt;SrcFolder-&gt;m_pendingPlaybackReq == request, &quot;wrong playback request pointer&quot;);</span>
<a href="#l36.226"></a><span id="l36.226">   </span>
<a href="#l36.227"></a><span id="l36.227" class="difflineminus">-  nsRefPtr&lt;nsImapOfflineSync&gt; offlineSync = new nsImapOfflineSync(request-&gt;MsgWindow, nullptr, request-&gt;SrcFolder, true);</span>
<a href="#l36.228"></a><span id="l36.228" class="difflineplus">+  RefPtr&lt;nsImapOfflineSync&gt; offlineSync = new nsImapOfflineSync(request-&gt;MsgWindow, nullptr, request-&gt;SrcFolder, true);</span>
<a href="#l36.229"></a><span id="l36.229">   if (offlineSync)</span>
<a href="#l36.230"></a><span id="l36.230">   {</span>
<a href="#l36.231"></a><span id="l36.231">     mozilla::DebugOnly&lt;nsresult&gt; rv = offlineSync-&gt;ProcessNextOperation();</span>
<a href="#l36.232"></a><span id="l36.232">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;pseudo-offline playback is not successful&quot;);</span>
<a href="#l36.233"></a><span id="l36.233">   }</span>
<a href="#l36.234"></a><span id="l36.234">   </span>
<a href="#l36.235"></a><span id="l36.235">   // release request struct</span>
<a href="#l36.236"></a><span id="l36.236">   request-&gt;SrcFolder-&gt;m_pendingPlaybackReq = nullptr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.h</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.h</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -52,17 +52,17 @@ public:</span>
<a href="#l37.4"></a><span id="l37.4">     NS_DECLARE_STATIC_IID_ACCESSOR(NS_IMAPMAILCOPYSTATE_IID)</span>
<a href="#l37.5"></a><span id="l37.5"> </span>
<a href="#l37.6"></a><span id="l37.6">     NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l37.7"></a><span id="l37.7"> </span>
<a href="#l37.8"></a><span id="l37.8">     nsImapMailCopyState();</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10">     nsCOMPtr&lt;nsISupports&gt; m_srcSupport; // source file spec or folder</span>
<a href="#l37.11"></a><span id="l37.11">     nsCOMPtr&lt;nsIArray&gt; m_messages; // array of source messages</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-    nsRefPtr&lt;nsImapMoveCopyMsgTxn&gt; m_undoMsgTxn; // undo object with this copy operation</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+    RefPtr&lt;nsImapMoveCopyMsgTxn&gt; m_undoMsgTxn; // undo object with this copy operation</span>
<a href="#l37.14"></a><span id="l37.14">     nsCOMPtr&lt;nsIMsgDBHdr&gt; m_message; // current message to be copied</span>
<a href="#l37.15"></a><span id="l37.15">     nsCOMPtr&lt;nsIMsgCopyServiceListener&gt; m_listener; // listener of this copy</span>
<a href="#l37.16"></a><span id="l37.16">                                                     // operation</span>
<a href="#l37.17"></a><span id="l37.17">     nsCOMPtr&lt;nsIFile&gt; m_tmpFile; // temp file spec for copy operation</span>
<a href="#l37.18"></a><span id="l37.18">     nsCOMPtr&lt;nsIMsgWindow&gt; m_msgWindow; // msg window for copy operation</span>
<a href="#l37.19"></a><span id="l37.19"> </span>
<a href="#l37.20"></a><span id="l37.20">     nsCOMPtr&lt;nsIMsgMessageService&gt; m_msgService; // source folder message service; can</span>
<a href="#l37.21"></a><span id="l37.21">                                         // be Nntp, Mailbox, or Imap</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineat">@@ -476,18 +476,18 @@ protected:</span>
<a href="#l37.23"></a><span id="l37.23">   // if server supports UIDNEXT, we store it here.</span>
<a href="#l37.24"></a><span id="l37.24">   int32_t m_nextUID;</span>
<a href="#l37.25"></a><span id="l37.25"> </span>
<a href="#l37.26"></a><span id="l37.26">   int32_t  m_nextMessageByteLength;</span>
<a href="#l37.27"></a><span id="l37.27">   nsCOMPtr&lt;nsIUrlListener&gt; m_urlListener;</span>
<a href="#l37.28"></a><span id="l37.28">   bool m_urlRunning;</span>
<a href="#l37.29"></a><span id="l37.29"> </span>
<a href="#l37.30"></a><span id="l37.30">   // undo move/copy transaction support</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineminus">-  nsRefPtr&lt;nsMsgTxn&gt; m_pendingUndoTxn;</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineminus">-  nsRefPtr&lt;nsImapMailCopyState&gt; m_copyState;</span>
<a href="#l37.33"></a><span id="l37.33" class="difflineplus">+  RefPtr&lt;nsMsgTxn&gt; m_pendingUndoTxn;</span>
<a href="#l37.34"></a><span id="l37.34" class="difflineplus">+  RefPtr&lt;nsImapMailCopyState&gt; m_copyState;</span>
<a href="#l37.35"></a><span id="l37.35">   char m_hierarchyDelimiter;</span>
<a href="#l37.36"></a><span id="l37.36">   int32_t m_boxFlags;</span>
<a href="#l37.37"></a><span id="l37.37">   nsCString m_onlineFolderName;</span>
<a href="#l37.38"></a><span id="l37.38">   nsCString m_ownerUserName;  // username of the &quot;other user,&quot; as in</span>
<a href="#l37.39"></a><span id="l37.39">   // &quot;Other Users' Mailboxes&quot;</span>
<a href="#l37.40"></a><span id="l37.40"> </span>
<a href="#l37.41"></a><span id="l37.41">   nsCString m_adminUrl;   // url to run to set admin privileges for this folder</span>
<a href="#l37.42"></a><span id="l37.42">   nsIMAPNamespace  *m_namespace;</span>
<a href="#l37.43"></a><span id="l37.43" class="difflineat">@@ -512,27 +512,27 @@ protected:</span>
<a href="#l37.44"></a><span id="l37.44"> </span>
<a href="#l37.45"></a><span id="l37.45">   // determines if we are on GMail server</span>
<a href="#l37.46"></a><span id="l37.46">   bool m_isGmailServer;</span>
<a href="#l37.47"></a><span id="l37.47">   // offline imap support</span>
<a href="#l37.48"></a><span id="l37.48">   bool m_downloadingFolderForOfflineUse;</span>
<a href="#l37.49"></a><span id="l37.49">   bool m_filterListRequiresBody;</span>
<a href="#l37.50"></a><span id="l37.50"> </span>
<a href="#l37.51"></a><span id="l37.51">   // auto-sync (automatic message download) support</span>
<a href="#l37.52"></a><span id="l37.52" class="difflineminus">-  nsRefPtr&lt;nsAutoSyncState&gt; m_autoSyncStateObj;</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineplus">+  RefPtr&lt;nsAutoSyncState&gt; m_autoSyncStateObj;</span>
<a href="#l37.54"></a><span id="l37.54"> </span>
<a href="#l37.55"></a><span id="l37.55">   // Quota support</span>
<a href="#l37.56"></a><span id="l37.56">   nsCString m_folderQuotaRoot;</span>
<a href="#l37.57"></a><span id="l37.57">   uint32_t m_folderQuotaUsedKB;</span>
<a href="#l37.58"></a><span id="l37.58">   uint32_t m_folderQuotaMaxKB;</span>
<a href="#l37.59"></a><span id="l37.59"> </span>
<a href="#l37.60"></a><span id="l37.60">   // Pseudo-Offline Playback support</span>
<a href="#l37.61"></a><span id="l37.61">   nsPlaybackRequest *m_pendingPlaybackReq;</span>
<a href="#l37.62"></a><span id="l37.62">   nsCOMPtr&lt;nsITimer&gt; m_playbackTimer;</span>
<a href="#l37.63"></a><span id="l37.63" class="difflineminus">-  nsTArray&lt;nsRefPtr&lt;nsImapMoveCopyMsgTxn&gt; &gt; m_pendingOfflineMoves;</span>
<a href="#l37.64"></a><span id="l37.64" class="difflineplus">+  nsTArray&lt;RefPtr&lt;nsImapMoveCopyMsgTxn&gt; &gt; m_pendingOfflineMoves;</span>
<a href="#l37.65"></a><span id="l37.65">   // hash table of mapping between messageids and message keys</span>
<a href="#l37.66"></a><span id="l37.66">   // for pseudo hdrs.</span>
<a href="#l37.67"></a><span id="l37.67">   nsDataHashtable&lt;nsCStringHashKey, nsMsgKey&gt; m_pseudoHdrs;</span>
<a href="#l37.68"></a><span id="l37.68"> </span>
<a href="#l37.69"></a><span id="l37.69">   nsTArray&lt;nsMsgKey&gt; m_keysToFetch;</span>
<a href="#l37.70"></a><span id="l37.70">   uint32_t m_totalKeysToFetch;</span>
<a href="#l37.71"></a><span id="l37.71"> </span>
<a href="#l37.72"></a><span id="l37.72">   /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1826,17 +1826,17 @@ bool nsImapProtocol::ProcessCurrentURL()</span>
<a href="#l38.4"></a><span id="l38.4">     m_runningUrl-&gt;GetCopyState(getter_AddRefs(copyState));</span>
<a href="#l38.5"></a><span id="l38.5">   // this is so hokey...we MUST clear any local references to the url</span>
<a href="#l38.6"></a><span id="l38.6">   // BEFORE calling ReleaseUrlState</span>
<a href="#l38.7"></a><span id="l38.7">   mailnewsurl = nullptr;</span>
<a href="#l38.8"></a><span id="l38.8"> </span>
<a href="#l38.9"></a><span id="l38.9">   if (suspendUrl)</span>
<a href="#l38.10"></a><span id="l38.10">     m_imapServerSink-&gt;SuspendUrl(m_runningUrl);</span>
<a href="#l38.11"></a><span id="l38.11">   // save the imap folder sink since we need it to do the CopyNextStreamMessage</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-  nsRefPtr&lt;ImapMailFolderSinkProxy&gt; imapMailFolderSink = m_imapMailFolderSink;</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+  RefPtr&lt;ImapMailFolderSinkProxy&gt; imapMailFolderSink = m_imapMailFolderSink;</span>
<a href="#l38.14"></a><span id="l38.14">   // release the url as we are done with it...</span>
<a href="#l38.15"></a><span id="l38.15">   ReleaseUrlState(false);</span>
<a href="#l38.16"></a><span id="l38.16">   ResetProgressInfo();</span>
<a href="#l38.17"></a><span id="l38.17"> </span>
<a href="#l38.18"></a><span id="l38.18">   ClearFlag(IMAP_CLEAN_UP_URL_STATE);</span>
<a href="#l38.19"></a><span id="l38.19"> </span>
<a href="#l38.20"></a><span id="l38.20">   if (imapMailFolderSink)</span>
<a href="#l38.21"></a><span id="l38.21">   {</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineat">@@ -2574,17 +2574,17 @@ void nsImapProtocol::ProcessSelectedStat</span>
<a href="#l38.23"></a><span id="l38.23">               {</span>
<a href="#l38.24"></a><span id="l38.24">                 // We actually want a specific MIME part of the message.</span>
<a href="#l38.25"></a><span id="l38.25">                 // The Body Shell will generate it, even though we haven't downloaded it yet.</span>
<a href="#l38.26"></a><span id="l38.26"> </span>
<a href="#l38.27"></a><span id="l38.27">                 IMAP_ContentModifiedType modType = GetShowAttachmentsInline() ?</span>
<a href="#l38.28"></a><span id="l38.28">                   IMAP_CONTENT_MODIFIED_VIEW_INLINE :</span>
<a href="#l38.29"></a><span id="l38.29">                   IMAP_CONTENT_MODIFIED_VIEW_AS_LINKS ;</span>
<a href="#l38.30"></a><span id="l38.30"> </span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-                nsRefPtr&lt;nsIMAPBodyShell&gt; foundShell;</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+                RefPtr&lt;nsIMAPBodyShell&gt; foundShell;</span>
<a href="#l38.33"></a><span id="l38.33">                 res = m_hostSessionList-&gt;FindShellInCacheForHost(GetImapServerKey(),</span>
<a href="#l38.34"></a><span id="l38.34">                   GetServerStateParser().GetSelectedMailboxName(),</span>
<a href="#l38.35"></a><span id="l38.35">                   messageIdString.get(), modType, getter_AddRefs(foundShell));</span>
<a href="#l38.36"></a><span id="l38.36">                 if (!foundShell)</span>
<a href="#l38.37"></a><span id="l38.37">                 {</span>
<a href="#l38.38"></a><span id="l38.38">                   // The shell wasn't in the cache.  Deal with this case later.</span>
<a href="#l38.39"></a><span id="l38.39">                   Log(&quot;SHELL&quot;,NULL,&quot;Loading part, shell not found in cache!&quot;);</span>
<a href="#l38.40"></a><span id="l38.40">                   //MOZ_LOG(IMAP, out, (&quot;BODYSHELL: Loading part, shell not found in cache!&quot;));</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineat">@@ -2645,17 +2645,17 @@ void nsImapProtocol::ProcessSelectedStat</span>
<a href="#l38.42"></a><span id="l38.42">                   !GetShouldFetchAllParts() &amp;&amp;</span>
<a href="#l38.43"></a><span id="l38.43">                   GetServerStateParser().ServerHasIMAP4Rev1Capability() /* &amp;&amp;</span>
<a href="#l38.44"></a><span id="l38.44">                 !mimePartSelectorDetected */)  // if a ?part=, don't do BS.</span>
<a href="#l38.45"></a><span id="l38.45">               {</span>
<a href="#l38.46"></a><span id="l38.46">                 // OK, we're doing bodystructure</span>
<a href="#l38.47"></a><span id="l38.47"> </span>
<a href="#l38.48"></a><span id="l38.48">                 // Before fetching the bodystructure, let's check our body shell cache to see if</span>
<a href="#l38.49"></a><span id="l38.49">                 // we already have it around.</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-                nsRefPtr&lt;nsIMAPBodyShell&gt; foundShell;</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineplus">+                RefPtr&lt;nsIMAPBodyShell&gt; foundShell;</span>
<a href="#l38.52"></a><span id="l38.52">                 IMAP_ContentModifiedType modType = GetShowAttachmentsInline() ?</span>
<a href="#l38.53"></a><span id="l38.53">                   IMAP_CONTENT_MODIFIED_VIEW_INLINE :</span>
<a href="#l38.54"></a><span id="l38.54">                   IMAP_CONTENT_MODIFIED_VIEW_AS_LINKS ;</span>
<a href="#l38.55"></a><span id="l38.55"> </span>
<a href="#l38.56"></a><span id="l38.56">                 bool wasStoringMsgOffline;</span>
<a href="#l38.57"></a><span id="l38.57">                 m_runningUrl-&gt;GetStoreResultsOffline(&amp;wasStoringMsgOffline);</span>
<a href="#l38.58"></a><span id="l38.58">                 m_runningUrl-&gt;SetStoreOfflineOnFallback(wasStoringMsgOffline);</span>
<a href="#l38.59"></a><span id="l38.59">                 m_runningUrl-&gt;SetStoreResultsOffline(false);</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineat">@@ -5426,26 +5426,26 @@ void nsImapProtocol::StartCompressDeflat</span>
<a href="#l38.61"></a><span id="l38.61">     }</span>
<a href="#l38.62"></a><span id="l38.62">   }</span>
<a href="#l38.63"></a><span id="l38.63"> }</span>
<a href="#l38.64"></a><span id="l38.64"> </span>
<a href="#l38.65"></a><span id="l38.65"> nsresult nsImapProtocol::BeginCompressing()</span>
<a href="#l38.66"></a><span id="l38.66"> {</span>
<a href="#l38.67"></a><span id="l38.67">   // wrap the streams in compression layers that compress or decompress</span>
<a href="#l38.68"></a><span id="l38.68">   // all traffic.</span>
<a href="#l38.69"></a><span id="l38.69" class="difflineminus">-  nsRefPtr&lt;nsMsgCompressIStream&gt; new_in = new nsMsgCompressIStream();</span>
<a href="#l38.70"></a><span id="l38.70" class="difflineplus">+  RefPtr&lt;nsMsgCompressIStream&gt; new_in = new nsMsgCompressIStream();</span>
<a href="#l38.71"></a><span id="l38.71">   if (!new_in)</span>
<a href="#l38.72"></a><span id="l38.72">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l38.73"></a><span id="l38.73"> </span>
<a href="#l38.74"></a><span id="l38.74">   nsresult rv = new_in-&gt;InitInputStream(m_inputStream);</span>
<a href="#l38.75"></a><span id="l38.75">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l38.76"></a><span id="l38.76"> </span>
<a href="#l38.77"></a><span id="l38.77">   m_inputStream = new_in;</span>
<a href="#l38.78"></a><span id="l38.78"> </span>
<a href="#l38.79"></a><span id="l38.79" class="difflineminus">-  nsRefPtr&lt;nsMsgCompressOStream&gt; new_out = new nsMsgCompressOStream();</span>
<a href="#l38.80"></a><span id="l38.80" class="difflineplus">+  RefPtr&lt;nsMsgCompressOStream&gt; new_out = new nsMsgCompressOStream();</span>
<a href="#l38.81"></a><span id="l38.81">   if (!new_out)</span>
<a href="#l38.82"></a><span id="l38.82">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l38.83"></a><span id="l38.83"> </span>
<a href="#l38.84"></a><span id="l38.84">   rv = new_out-&gt;InitOutputStream(m_outputStream);</span>
<a href="#l38.85"></a><span id="l38.85">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l38.86"></a><span id="l38.86"> </span>
<a href="#l38.87"></a><span id="l38.87">   m_outputStream = new_out;</span>
<a href="#l38.88"></a><span id="l38.88">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -362,20 +362,20 @@ private:</span>
<a href="#l39.4"></a><span id="l39.4">   bool         m_imapThreadIsRunning;</span>
<a href="#l39.5"></a><span id="l39.5">   void ImapThreadMainLoop(void);</span>
<a href="#l39.6"></a><span id="l39.6">   nsresult    m_connectionStatus;</span>
<a href="#l39.7"></a><span id="l39.7">   nsCString   m_connectionType;</span>
<a href="#l39.8"></a><span id="l39.8"> </span>
<a href="#l39.9"></a><span id="l39.9">   bool        m_nextUrlReadyToRun;</span>
<a href="#l39.10"></a><span id="l39.10">   nsWeakPtr   m_server;</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-  nsRefPtr&lt;ImapMailFolderSinkProxy&gt; m_imapMailFolderSink;</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineminus">-  nsRefPtr&lt;ImapMessageSinkProxy&gt;    m_imapMessageSink;</span>
<a href="#l39.14"></a><span id="l39.14" class="difflineminus">-  nsRefPtr&lt;ImapServerSinkProxy&gt;     m_imapServerSink;</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineminus">-  nsRefPtr&lt;ImapProtocolSinkProxy&gt;   m_imapProtocolSink;</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineplus">+  RefPtr&lt;ImapMailFolderSinkProxy&gt; m_imapMailFolderSink;</span>
<a href="#l39.17"></a><span id="l39.17" class="difflineplus">+  RefPtr&lt;ImapMessageSinkProxy&gt;    m_imapMessageSink;</span>
<a href="#l39.18"></a><span id="l39.18" class="difflineplus">+  RefPtr&lt;ImapServerSinkProxy&gt;     m_imapServerSink;</span>
<a href="#l39.19"></a><span id="l39.19" class="difflineplus">+  RefPtr&lt;ImapProtocolSinkProxy&gt;   m_imapProtocolSink;</span>
<a href="#l39.20"></a><span id="l39.20"> </span>
<a href="#l39.21"></a><span id="l39.21">   // helper function to setup imap sink interface proxies</span>
<a href="#l39.22"></a><span id="l39.22">   void SetupSinkProxy();</span>
<a href="#l39.23"></a><span id="l39.23">   // End thread support stuff</span>
<a href="#l39.24"></a><span id="l39.24"> </span>
<a href="#l39.25"></a><span id="l39.25">   bool GetDeleteIsMoveToTrash();</span>
<a href="#l39.26"></a><span id="l39.26">   bool GetShowDeletedMessages();</span>
<a href="#l39.27"></a><span id="l39.27">   nsCString m_currentCommand;</span>
<a href="#l39.28"></a><span id="l39.28" class="difflineat">@@ -598,18 +598,18 @@ private:</span>
<a href="#l39.29"></a><span id="l39.29">   int32_t m_curFetchSize;</span>
<a href="#l39.30"></a><span id="l39.30">   bool    m_ignoreExpunges;</span>
<a href="#l39.31"></a><span id="l39.31">   eIMAPCapabilityFlags m_prefAuthMethods; // set of capability flags (in nsImapCore.h) for auth methods</span>
<a href="#l39.32"></a><span id="l39.32">   eIMAPCapabilityFlags m_failedAuthMethods; // ditto</span>
<a href="#l39.33"></a><span id="l39.33">   eIMAPCapabilityFlag m_currentAuthMethod; // exactly one capability flag, or 0</span>
<a href="#l39.34"></a><span id="l39.34">   int32_t m_socketType;</span>
<a href="#l39.35"></a><span id="l39.35">   int32_t m_chunkSize;</span>
<a href="#l39.36"></a><span id="l39.36">   int32_t m_chunkThreshold;</span>
<a href="#l39.37"></a><span id="l39.37" class="difflineminus">-  nsRefPtr &lt;nsMsgImapLineDownloadCache&gt; m_downloadLineCache;</span>
<a href="#l39.38"></a><span id="l39.38" class="difflineminus">-  nsRefPtr &lt;nsMsgImapHdrXferInfo&gt; m_hdrDownloadCache;</span>
<a href="#l39.39"></a><span id="l39.39" class="difflineplus">+  RefPtr&lt;nsMsgImapLineDownloadCache&gt; m_downloadLineCache;</span>
<a href="#l39.40"></a><span id="l39.40" class="difflineplus">+  RefPtr&lt;nsMsgImapHdrXferInfo&gt; m_hdrDownloadCache;</span>
<a href="#l39.41"></a><span id="l39.41">   nsCOMPtr &lt;nsIImapHeaderInfo&gt; m_curHdrInfo;</span>
<a href="#l39.42"></a><span id="l39.42">   // mapping between mailboxes and the corresponding folder flags</span>
<a href="#l39.43"></a><span id="l39.43">   nsDataHashtable&lt;nsCStringHashKey, int32_t&gt; m_standardListMailboxes;</span>
<a href="#l39.44"></a><span id="l39.44">   // mapping between special xlist mailboxes and the corresponding folder flags</span>
<a href="#l39.45"></a><span id="l39.45">   nsDataHashtable&lt;nsCStringHashKey, int32_t&gt; m_specialXListMailboxes;</span>
<a href="#l39.46"></a><span id="l39.46"> </span>
<a href="#l39.47"></a><span id="l39.47"> </span>
<a href="#l39.48"></a><span id="l39.48">   nsIImapHostSessionList * m_hostSessionList;</span>
<a href="#l39.49"></a><span id="l39.49" class="difflineat">@@ -667,17 +667,17 @@ private:</span>
<a href="#l39.50"></a><span id="l39.50">   nsTArray&lt;char*&gt; *            m_deletableChildren;</span>
<a href="#l39.51"></a><span id="l39.51">   uint32_t                    m_flagChangeCount;</span>
<a href="#l39.52"></a><span id="l39.52">   PRTime                      m_lastCheckTime;</span>
<a href="#l39.53"></a><span id="l39.53"> </span>
<a href="#l39.54"></a><span id="l39.54">   bool CheckNeeded();</span>
<a href="#l39.55"></a><span id="l39.55"> </span>
<a href="#l39.56"></a><span id="l39.56">   nsString m_emptyMimePartString;</span>
<a href="#l39.57"></a><span id="l39.57"> </span>
<a href="#l39.58"></a><span id="l39.58" class="difflineminus">-  nsRefPtr&lt;mozilla::mailnews::OAuth2ThreadHelper&gt; mOAuth2Support;</span>
<a href="#l39.59"></a><span id="l39.59" class="difflineplus">+  RefPtr&lt;mozilla::mailnews::OAuth2ThreadHelper&gt; mOAuth2Support;</span>
<a href="#l39.60"></a><span id="l39.60"> };</span>
<a href="#l39.61"></a><span id="l39.61"> </span>
<a href="#l39.62"></a><span id="l39.62"> // This small class is a &quot;mock&quot; channel because it is a mockery of the imap channel's implementation...</span>
<a href="#l39.63"></a><span id="l39.63"> // it's a light weight channel that we can return to necko when they ask for a channel on a url before</span>
<a href="#l39.64"></a><span id="l39.64"> // we actually have an imap protocol instance around which can run the url. Please see my comments in</span>
<a href="#l39.65"></a><span id="l39.65"> // nsIImapMockChannel.idl for more details..</span>
<a href="#l39.66"></a><span id="l39.66"> //</span>
<a href="#l39.67"></a><span id="l39.67"> // Threading concern: This class lives entirely in the UI thread.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/imap/src/nsImapServerResponseParser.h</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapServerResponseParser.h</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -252,17 +252,17 @@ private:</span>
<a href="#l40.4"></a><span id="l40.4">   int32_t fFetchResponseIndex;</span>
<a href="#l40.5"></a><span id="l40.5"> </span>
<a href="#l40.6"></a><span id="l40.6">   // used for aborting a fetch stream when we're pseudo-Interrupted</span>
<a href="#l40.7"></a><span id="l40.7">   int32_t numberOfCharsInThisChunk;</span>
<a href="#l40.8"></a><span id="l40.8">   int32_t charsReadSoFar;</span>
<a href="#l40.9"></a><span id="l40.9">   bool fLastChunk;</span>
<a href="#l40.10"></a><span id="l40.10"> </span>
<a href="#l40.11"></a><span id="l40.11">   // points to the current body shell, if any</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-  nsRefPtr&lt;nsIMAPBodyShell&gt; m_shell;</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+  RefPtr&lt;nsIMAPBodyShell&gt; m_shell;</span>
<a href="#l40.14"></a><span id="l40.14"> </span>
<a href="#l40.15"></a><span id="l40.15">   // The connection object</span>
<a href="#l40.16"></a><span id="l40.16">   nsImapProtocol &amp;fServerConnection;</span>
<a href="#l40.17"></a><span id="l40.17"> </span>
<a href="#l40.18"></a><span id="l40.18">   nsIImapHostSessionList *fHostSessionList;</span>
<a href="#l40.19"></a><span id="l40.19">   nsTArray&lt;nsMsgKey&gt; fCopyResponseKeyArray;</span>
<a href="#l40.20"></a><span id="l40.20"> };</span>
<a href="#l40.21"></a><span id="l40.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/imap/src/nsSyncRunnableHelpers.cpp</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/imap/src/nsSyncRunnableHelpers.cpp</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -277,81 +277,81 @@ DispatchSyncRunnable(SyncRunnableBase* r</span>
<a href="#l41.4"></a><span id="l41.4">   }</span>
<a href="#l41.5"></a><span id="l41.5">   return r-&gt;Result();</span>
<a href="#l41.6"></a><span id="l41.6"> }</span>
<a href="#l41.7"></a><span id="l41.7"> </span>
<a href="#l41.8"></a><span id="l41.8"> } // anonymous namespace</span>
<a href="#l41.9"></a><span id="l41.9"> </span>
<a href="#l41.10"></a><span id="l41.10"> #define NS_SYNCRUNNABLEMETHOD0(iface, method)                       \</span>
<a href="#l41.11"></a><span id="l41.11">   NS_IMETHODIMP iface##Proxy::method() {                     \</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-    nsRefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+    RefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.14"></a><span id="l41.14">       new SyncRunnable0&lt;nsI##iface&gt;                           \</span>
<a href="#l41.15"></a><span id="l41.15">       (mReceiver, &amp;nsI##iface::method);                         \</span>
<a href="#l41.16"></a><span id="l41.16">     return DispatchSyncRunnable(r);                                 \</span>
<a href="#l41.17"></a><span id="l41.17">   }</span>
<a href="#l41.18"></a><span id="l41.18"> </span>
<a href="#l41.19"></a><span id="l41.19"> </span>
<a href="#l41.20"></a><span id="l41.20"> #define NS_SYNCRUNNABLEMETHOD1(iface, method,                       \</span>
<a href="#l41.21"></a><span id="l41.21">                                arg1)                                \</span>
<a href="#l41.22"></a><span id="l41.22">   NS_IMETHODIMP iface##Proxy::method(arg1 a1) {                     \</span>
<a href="#l41.23"></a><span id="l41.23" class="difflineminus">-    nsRefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.24"></a><span id="l41.24" class="difflineplus">+    RefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.25"></a><span id="l41.25">       new SyncRunnable1&lt;nsI##iface, arg1&gt;                           \</span>
<a href="#l41.26"></a><span id="l41.26">       (mReceiver, &amp;nsI##iface::method, a1);                         \</span>
<a href="#l41.27"></a><span id="l41.27">     return DispatchSyncRunnable(r);                                 \</span>
<a href="#l41.28"></a><span id="l41.28">   }</span>
<a href="#l41.29"></a><span id="l41.29"> </span>
<a href="#l41.30"></a><span id="l41.30"> #define NS_SYNCRUNNABLEMETHOD2(iface, method,                       \</span>
<a href="#l41.31"></a><span id="l41.31">                                arg1, arg2)                          \</span>
<a href="#l41.32"></a><span id="l41.32">   NS_IMETHODIMP iface##Proxy::method(arg1 a1, arg2 a2) {            \</span>
<a href="#l41.33"></a><span id="l41.33" class="difflineminus">-    nsRefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.34"></a><span id="l41.34" class="difflineplus">+    RefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.35"></a><span id="l41.35">       new SyncRunnable2&lt;nsI##iface, arg1, arg2&gt;                     \</span>
<a href="#l41.36"></a><span id="l41.36">       (mReceiver, &amp;nsI##iface::method, a1, a2);                     \</span>
<a href="#l41.37"></a><span id="l41.37">     return DispatchSyncRunnable(r);                                 \</span>
<a href="#l41.38"></a><span id="l41.38">   }</span>
<a href="#l41.39"></a><span id="l41.39"> </span>
<a href="#l41.40"></a><span id="l41.40"> #define NS_SYNCRUNNABLEMETHOD3(iface, method,                       \</span>
<a href="#l41.41"></a><span id="l41.41">                                arg1, arg2, arg3)                    \</span>
<a href="#l41.42"></a><span id="l41.42">   NS_IMETHODIMP iface##Proxy::method(arg1 a1, arg2 a2, arg3 a3) {   \</span>
<a href="#l41.43"></a><span id="l41.43" class="difflineminus">-    nsRefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.44"></a><span id="l41.44" class="difflineplus">+    RefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.45"></a><span id="l41.45">       new SyncRunnable3&lt;nsI##iface, arg1, arg2, arg3&gt;               \</span>
<a href="#l41.46"></a><span id="l41.46">       (mReceiver, &amp;nsI##iface::method,                              \</span>
<a href="#l41.47"></a><span id="l41.47">        a1, a2, a3);                                                 \</span>
<a href="#l41.48"></a><span id="l41.48">     return DispatchSyncRunnable(r);                                 \</span>
<a href="#l41.49"></a><span id="l41.49">   }</span>
<a href="#l41.50"></a><span id="l41.50"> </span>
<a href="#l41.51"></a><span id="l41.51"> #define NS_SYNCRUNNABLEMETHOD4(iface, method,                       \</span>
<a href="#l41.52"></a><span id="l41.52">                                arg1, arg2, arg3, arg4)              \</span>
<a href="#l41.53"></a><span id="l41.53">   NS_IMETHODIMP iface##Proxy::method(arg1 a1, arg2 a2, arg3 a3, arg4 a4) { \</span>
<a href="#l41.54"></a><span id="l41.54" class="difflineminus">-    nsRefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.55"></a><span id="l41.55" class="difflineplus">+    RefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.56"></a><span id="l41.56">       new SyncRunnable4&lt;nsI##iface, arg1, arg2, arg3, arg4&gt;         \</span>
<a href="#l41.57"></a><span id="l41.57">       (mReceiver, &amp;nsI##iface::method,                              \</span>
<a href="#l41.58"></a><span id="l41.58">        a1, a2, a3, a4);                                             \</span>
<a href="#l41.59"></a><span id="l41.59">     return DispatchSyncRunnable(r);                                 \</span>
<a href="#l41.60"></a><span id="l41.60">   }</span>
<a href="#l41.61"></a><span id="l41.61"> </span>
<a href="#l41.62"></a><span id="l41.62"> #define NS_SYNCRUNNABLEMETHOD5(iface, method,                       \</span>
<a href="#l41.63"></a><span id="l41.63">                                arg1, arg2, arg3, arg4, arg5)        \</span>
<a href="#l41.64"></a><span id="l41.64">   NS_IMETHODIMP iface##Proxy::method(arg1 a1, arg2 a2, arg3 a3, arg4 a4, arg5 a5) {   \</span>
<a href="#l41.65"></a><span id="l41.65" class="difflineminus">-    nsRefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.66"></a><span id="l41.66" class="difflineplus">+    RefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.67"></a><span id="l41.67">       new SyncRunnable5&lt;nsI##iface, arg1, arg2, arg3, arg4, arg5&gt;   \</span>
<a href="#l41.68"></a><span id="l41.68">       (mReceiver, &amp;nsI##iface::method,                              \</span>
<a href="#l41.69"></a><span id="l41.69">        a1, a2, a3, a4, a5);                                         \</span>
<a href="#l41.70"></a><span id="l41.70">     return DispatchSyncRunnable(r);                                 \</span>
<a href="#l41.71"></a><span id="l41.71">   }</span>
<a href="#l41.72"></a><span id="l41.72"> </span>
<a href="#l41.73"></a><span id="l41.73"> #define NS_SYNCRUNNABLEATTRIBUTE(iface, attribute,                       \</span>
<a href="#l41.74"></a><span id="l41.74">                                  type)                                \</span>
<a href="#l41.75"></a><span id="l41.75"> NS_IMETHODIMP iface##Proxy::Get##attribute(type *a1) {                     \</span>
<a href="#l41.76"></a><span id="l41.76" class="difflineminus">-    nsRefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.77"></a><span id="l41.77" class="difflineplus">+    RefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.78"></a><span id="l41.78">       new SyncRunnable1&lt;nsI##iface, type *&gt;                           \</span>
<a href="#l41.79"></a><span id="l41.79">       (mReceiver, &amp;nsI##iface::Get##attribute, a1);                         \</span>
<a href="#l41.80"></a><span id="l41.80">     return DispatchSyncRunnable(r);                                 \</span>
<a href="#l41.81"></a><span id="l41.81">   } \</span>
<a href="#l41.82"></a><span id="l41.82"> NS_IMETHODIMP iface##Proxy::Set##attribute(type a1) {                     \</span>
<a href="#l41.83"></a><span id="l41.83" class="difflineminus">-    nsRefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.84"></a><span id="l41.84" class="difflineplus">+    RefPtr&lt;SyncRunnableBase&gt; r =                                  \</span>
<a href="#l41.85"></a><span id="l41.85">       new SyncRunnable1&lt;nsI##iface, type&gt;                           \</span>
<a href="#l41.86"></a><span id="l41.86">       (mReceiver, &amp;nsI##iface::Set##attribute, a1);                         \</span>
<a href="#l41.87"></a><span id="l41.87">     return DispatchSyncRunnable(r);                                 \</span>
<a href="#l41.88"></a><span id="l41.88">   }</span>
<a href="#l41.89"></a><span id="l41.89"> </span>
<a href="#l41.90"></a><span id="l41.90"> </span>
<a href="#l41.91"></a><span id="l41.91"> #define NS_NOTIMPLEMENTED \</span>
<a href="#l41.92"></a><span id="l41.92">   { NS_RUNTIMEABORT(&quot;Not implemented&quot;); return NS_ERROR_UNEXPECTED; }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/imap/test/TestImapFlagAndUidState.cpp</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/imap/test/TestImapFlagAndUidState.cpp</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -85,17 +85,17 @@ int main(int argc, char** argv)</span>
<a href="#l42.4"></a><span id="l42.4"> </span>
<a href="#l42.5"></a><span id="l42.5">   struct msgState msgState1[] = {</span>
<a href="#l42.6"></a><span id="l42.6">   {10, kImapMsgSeenFlag, 0},</span>
<a href="#l42.7"></a><span id="l42.7">   {15, kImapMsgSeenFlag, 1},</span>
<a href="#l42.8"></a><span id="l42.8">   {16, kImapMsgSeenFlag, 2},</span>
<a href="#l42.9"></a><span id="l42.9">   {17, kImapMsgSeenFlag, 3},</span>
<a href="#l42.10"></a><span id="l42.10">   {18, kImapMsgSeenFlag, 4}};</span>
<a href="#l42.11"></a><span id="l42.11"> </span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  nsRefPtr&lt;nsImapFlagAndUidState&gt; flagState = new nsImapFlagAndUidState(10);</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+  RefPtr&lt;nsImapFlagAndUidState&gt; flagState = new nsImapFlagAndUidState(10);</span>
<a href="#l42.14"></a><span id="l42.14">   int32_t numMsgs = sizeof(msgState1) / sizeof(msgState1[0]);</span>
<a href="#l42.15"></a><span id="l42.15">   for (int32_t i = 0; i &lt; numMsgs; i++)</span>
<a href="#l42.16"></a><span id="l42.16">         flagState-&gt;AddUidFlagPair(msgState1[i].uid, msgState1[i].flag,</span>
<a href="#l42.17"></a><span id="l42.17">                                   msgState1[i].index);</span>
<a href="#l42.18"></a><span id="l42.18"> </span>
<a href="#l42.19"></a><span id="l42.19">   const char * error = MainChecks(flagState, msgState1, numMsgs, 0);</span>
<a href="#l42.20"></a><span id="l42.20">   if (error)</span>
<a href="#l42.21"></a><span id="l42.21">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/imap/test/TestImapHdrXferInfo.cpp</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/imap/test/TestImapHdrXferInfo.cpp</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -91,17 +91,17 @@ int MainChecks(nsMsgImapHdrXferInfo* hdr</span>
<a href="#l43.4"></a><span id="l43.4"> // General note about return values:</span>
<a href="#l43.5"></a><span id="l43.5"> // return 1 for a setup or xpcom type failure, return 2 for a real test failure</span>
<a href="#l43.6"></a><span id="l43.6"> int main(int argc, char** argv)</span>
<a href="#l43.7"></a><span id="l43.7"> {</span>
<a href="#l43.8"></a><span id="l43.8">   ScopedXPCOM xpcom(&quot;TestImapHdrXferInfo.cpp&quot;);</span>
<a href="#l43.9"></a><span id="l43.9">   if (xpcom.failed())</span>
<a href="#l43.10"></a><span id="l43.10">     return 1;</span>
<a href="#l43.11"></a><span id="l43.11"> </span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-  nsRefPtr&lt;nsMsgImapHdrXferInfo&gt; hdrInfo = new nsMsgImapHdrXferInfo();</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+  RefPtr&lt;nsMsgImapHdrXferInfo&gt; hdrInfo = new nsMsgImapHdrXferInfo();</span>
<a href="#l43.14"></a><span id="l43.14">   // Purposely not reference counted to ensure we get the same pointers the</span>
<a href="#l43.15"></a><span id="l43.15">   // second time round MainChecks.</span>
<a href="#l43.16"></a><span id="l43.16">   nsIImapHeaderInfo* hdrArray[kNumHdrsToXfer] = { nullptr };</span>
<a href="#l43.17"></a><span id="l43.17"> </span>
<a href="#l43.18"></a><span id="l43.18">   int result = MainChecks(hdrInfo, hdrArray, eAddNoCheck);</span>
<a href="#l43.19"></a><span id="l43.19">   if (result)</span>
<a href="#l43.20"></a><span id="l43.20">   {</span>
<a href="#l43.21"></a><span id="l43.21">     printf(&quot;TEST-UNEXPECTED-FAIL | %s | %d\n&quot;, __FILE__, result);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -1007,17 +1007,17 @@ GetSubFoldersRunnable::GetSubFoldersRunn</span>
<a href="#l44.4"></a><span id="l44.4"> NS_IMETHODIMP GetSubFoldersRunnable::Run()</span>
<a href="#l44.5"></a><span id="l44.5"> {</span>
<a href="#l44.6"></a><span id="l44.6">   return m_folder-&gt;GetSubFolders(nullptr);</span>
<a href="#l44.7"></a><span id="l44.7"> }</span>
<a href="#l44.8"></a><span id="l44.8"> </span>
<a href="#l44.9"></a><span id="l44.9"> </span>
<a href="#l44.10"></a><span id="l44.10"> nsresult ProxyGetSubFolders(nsIMsgFolder *aFolder)</span>
<a href="#l44.11"></a><span id="l44.11"> {</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-  nsRefPtr&lt;GetSubFoldersRunnable&gt; getSubFolders =</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+  RefPtr&lt;GetSubFoldersRunnable&gt; getSubFolders =</span>
<a href="#l44.14"></a><span id="l44.14">     new GetSubFoldersRunnable(aFolder);</span>
<a href="#l44.15"></a><span id="l44.15">   return NS_DispatchToMainThread(getSubFolders, NS_DISPATCH_SYNC);</span>
<a href="#l44.16"></a><span id="l44.16"> }</span>
<a href="#l44.17"></a><span id="l44.17"> </span>
<a href="#l44.18"></a><span id="l44.18"> class GetChildNamedRunnable : public nsRunnable</span>
<a href="#l44.19"></a><span id="l44.19"> {</span>
<a href="#l44.20"></a><span id="l44.20"> public:</span>
<a href="#l44.21"></a><span id="l44.21">   GetChildNamedRunnable(nsIMsgFolder *aFolder, const nsAString&amp; aName, nsIMsgFolder **aChild);</span>
<a href="#l44.22"></a><span id="l44.22" class="difflineat">@@ -1039,17 +1039,17 @@ NS_IMETHODIMP GetChildNamedRunnable::Run</span>
<a href="#l44.23"></a><span id="l44.23"> {</span>
<a href="#l44.24"></a><span id="l44.24">   return m_folder-&gt;GetChildNamed(m_name, m_child);</span>
<a href="#l44.25"></a><span id="l44.25"> }</span>
<a href="#l44.26"></a><span id="l44.26"> </span>
<a href="#l44.27"></a><span id="l44.27"> </span>
<a href="#l44.28"></a><span id="l44.28"> nsresult ProxyGetChildNamed(nsIMsgFolder *aFolder, const nsAString &amp; aName,</span>
<a href="#l44.29"></a><span id="l44.29">                             nsIMsgFolder **aChild)</span>
<a href="#l44.30"></a><span id="l44.30"> {</span>
<a href="#l44.31"></a><span id="l44.31" class="difflineminus">-  nsRefPtr&lt;GetChildNamedRunnable&gt; getChildNamed =</span>
<a href="#l44.32"></a><span id="l44.32" class="difflineplus">+  RefPtr&lt;GetChildNamedRunnable&gt; getChildNamed =</span>
<a href="#l44.33"></a><span id="l44.33">     new GetChildNamedRunnable(aFolder, aName, aChild);</span>
<a href="#l44.34"></a><span id="l44.34">   return NS_DispatchToMainThread(getChildNamed, NS_DISPATCH_SYNC);</span>
<a href="#l44.35"></a><span id="l44.35"> }</span>
<a href="#l44.36"></a><span id="l44.36"> </span>
<a href="#l44.37"></a><span id="l44.37"> class GetParentRunnable : public nsRunnable</span>
<a href="#l44.38"></a><span id="l44.38"> {</span>
<a href="#l44.39"></a><span id="l44.39"> public:</span>
<a href="#l44.40"></a><span id="l44.40">   GetParentRunnable(nsIMsgFolder *aFolder, nsIMsgFolder **aParent);</span>
<a href="#l44.41"></a><span id="l44.41" class="difflineat">@@ -1067,17 +1067,17 @@ GetParentRunnable::GetParentRunnable(nsI</span>
<a href="#l44.42"></a><span id="l44.42"> NS_IMETHODIMP GetParentRunnable::Run()</span>
<a href="#l44.43"></a><span id="l44.43"> {</span>
<a href="#l44.44"></a><span id="l44.44">   return m_folder-&gt;GetParent(m_parent);</span>
<a href="#l44.45"></a><span id="l44.45"> }</span>
<a href="#l44.46"></a><span id="l44.46"> </span>
<a href="#l44.47"></a><span id="l44.47"> </span>
<a href="#l44.48"></a><span id="l44.48"> nsresult ProxyGetParent(nsIMsgFolder *aFolder, nsIMsgFolder **aParent)</span>
<a href="#l44.49"></a><span id="l44.49"> {</span>
<a href="#l44.50"></a><span id="l44.50" class="difflineminus">-  nsRefPtr&lt;GetParentRunnable&gt; getParent =</span>
<a href="#l44.51"></a><span id="l44.51" class="difflineplus">+  RefPtr&lt;GetParentRunnable&gt; getParent =</span>
<a href="#l44.52"></a><span id="l44.52">     new GetParentRunnable(aFolder, aParent);</span>
<a href="#l44.53"></a><span id="l44.53">   return NS_DispatchToMainThread(getParent, NS_DISPATCH_SYNC);</span>
<a href="#l44.54"></a><span id="l44.54"> }</span>
<a href="#l44.55"></a><span id="l44.55"> </span>
<a href="#l44.56"></a><span id="l44.56"> class ContainsChildNamedRunnable : public nsRunnable</span>
<a href="#l44.57"></a><span id="l44.57"> {</span>
<a href="#l44.58"></a><span id="l44.58"> public:</span>
<a href="#l44.59"></a><span id="l44.59">   ContainsChildNamedRunnable(nsIMsgFolder *aFolder, const nsAString&amp; aName, bool *aResult);</span>
<a href="#l44.60"></a><span id="l44.60" class="difflineat">@@ -1099,17 +1099,17 @@ NS_IMETHODIMP ContainsChildNamedRunnable</span>
<a href="#l44.61"></a><span id="l44.61"> {</span>
<a href="#l44.62"></a><span id="l44.62">   return m_folder-&gt;ContainsChildNamed(m_name, m_result);</span>
<a href="#l44.63"></a><span id="l44.63"> }</span>
<a href="#l44.64"></a><span id="l44.64"> </span>
<a href="#l44.65"></a><span id="l44.65"> </span>
<a href="#l44.66"></a><span id="l44.66"> nsresult ProxyContainsChildNamed(nsIMsgFolder *aFolder, const nsAString &amp;aName,</span>
<a href="#l44.67"></a><span id="l44.67">                                  bool *aResult)</span>
<a href="#l44.68"></a><span id="l44.68"> {</span>
<a href="#l44.69"></a><span id="l44.69" class="difflineminus">-  nsRefPtr&lt;ContainsChildNamedRunnable&gt; containsChildNamed =</span>
<a href="#l44.70"></a><span id="l44.70" class="difflineplus">+  RefPtr&lt;ContainsChildNamedRunnable&gt; containsChildNamed =</span>
<a href="#l44.71"></a><span id="l44.71">     new ContainsChildNamedRunnable(aFolder, aName, aResult);</span>
<a href="#l44.72"></a><span id="l44.72">   return NS_DispatchToMainThread(containsChildNamed, NS_DISPATCH_SYNC);</span>
<a href="#l44.73"></a><span id="l44.73"> }</span>
<a href="#l44.74"></a><span id="l44.74"> </span>
<a href="#l44.75"></a><span id="l44.75"> </span>
<a href="#l44.76"></a><span id="l44.76"> class GenerateUniqueSubfolderNameRunnable : public nsRunnable</span>
<a href="#l44.77"></a><span id="l44.77"> {</span>
<a href="#l44.78"></a><span id="l44.78"> public:</span>
<a href="#l44.79"></a><span id="l44.79" class="difflineat">@@ -1139,17 +1139,17 @@ NS_IMETHODIMP GenerateUniqueSubfolderNam</span>
<a href="#l44.80"></a><span id="l44.80"> </span>
<a href="#l44.81"></a><span id="l44.81"> </span>
<a href="#l44.82"></a><span id="l44.82"> nsresult ProxyGenerateUniqueSubfolderName(nsIMsgFolder *aFolder,</span>
<a href="#l44.83"></a><span id="l44.83">                                           const nsAString&amp; aPrefix,</span>
<a href="#l44.84"></a><span id="l44.84">                                           nsIMsgFolder *aOtherFolder,</span>
<a href="#l44.85"></a><span id="l44.85">                                           nsAString&amp; aName)</span>
<a href="#l44.86"></a><span id="l44.86"> </span>
<a href="#l44.87"></a><span id="l44.87"> {</span>
<a href="#l44.88"></a><span id="l44.88" class="difflineminus">-  nsRefPtr&lt;GenerateUniqueSubfolderNameRunnable&gt; generateUniqueSubfolderName =</span>
<a href="#l44.89"></a><span id="l44.89" class="difflineplus">+  RefPtr&lt;GenerateUniqueSubfolderNameRunnable&gt; generateUniqueSubfolderName =</span>
<a href="#l44.90"></a><span id="l44.90">     new GenerateUniqueSubfolderNameRunnable(aFolder, aPrefix, aOtherFolder, aName);</span>
<a href="#l44.91"></a><span id="l44.91">   return NS_DispatchToMainThread(generateUniqueSubfolderName, NS_DISPATCH_SYNC);</span>
<a href="#l44.92"></a><span id="l44.92"> }</span>
<a href="#l44.93"></a><span id="l44.93"> </span>
<a href="#l44.94"></a><span id="l44.94"> class CreateSubfolderRunnable : public nsRunnable</span>
<a href="#l44.95"></a><span id="l44.95"> {</span>
<a href="#l44.96"></a><span id="l44.96"> public:</span>
<a href="#l44.97"></a><span id="l44.97">   CreateSubfolderRunnable(nsIMsgFolder *aFolder, const nsAString&amp; aName);</span>
<a href="#l44.98"></a><span id="l44.98" class="difflineat">@@ -1168,17 +1168,17 @@ CreateSubfolderRunnable::CreateSubfolder</span>
<a href="#l44.99"></a><span id="l44.99"> NS_IMETHODIMP CreateSubfolderRunnable::Run()</span>
<a href="#l44.100"></a><span id="l44.100"> {</span>
<a href="#l44.101"></a><span id="l44.101">   return m_folder-&gt;CreateSubfolder(m_name, nullptr);</span>
<a href="#l44.102"></a><span id="l44.102"> }</span>
<a href="#l44.103"></a><span id="l44.103"> </span>
<a href="#l44.104"></a><span id="l44.104"> </span>
<a href="#l44.105"></a><span id="l44.105"> nsresult ProxyCreateSubfolder(nsIMsgFolder *aFolder, const nsAString &amp;aName)</span>
<a href="#l44.106"></a><span id="l44.106"> {</span>
<a href="#l44.107"></a><span id="l44.107" class="difflineminus">-  nsRefPtr&lt;CreateSubfolderRunnable&gt; createSubfolder =</span>
<a href="#l44.108"></a><span id="l44.108" class="difflineplus">+  RefPtr&lt;CreateSubfolderRunnable&gt; createSubfolder =</span>
<a href="#l44.109"></a><span id="l44.109">     new CreateSubfolderRunnable(aFolder, aName);</span>
<a href="#l44.110"></a><span id="l44.110">   return NS_DispatchToMainThread(createSubfolder, NS_DISPATCH_SYNC);</span>
<a href="#l44.111"></a><span id="l44.111"> }</span>
<a href="#l44.112"></a><span id="l44.112"> </span>
<a href="#l44.113"></a><span id="l44.113"> class ForceDBClosedRunnable : public nsRunnable</span>
<a href="#l44.114"></a><span id="l44.114"> {</span>
<a href="#l44.115"></a><span id="l44.115"> public:</span>
<a href="#l44.116"></a><span id="l44.116">   ForceDBClosedRunnable(nsIMsgFolder *aFolder);</span>
<a href="#l44.117"></a><span id="l44.117" class="difflineat">@@ -1194,14 +1194,14 @@ ForceDBClosedRunnable::ForceDBClosedRunn</span>
<a href="#l44.118"></a><span id="l44.118"> </span>
<a href="#l44.119"></a><span id="l44.119"> NS_IMETHODIMP ForceDBClosedRunnable::Run()</span>
<a href="#l44.120"></a><span id="l44.120"> {</span>
<a href="#l44.121"></a><span id="l44.121">   return m_folder-&gt;ForceDBClosed();</span>
<a href="#l44.122"></a><span id="l44.122"> }</span>
<a href="#l44.123"></a><span id="l44.123"> </span>
<a href="#l44.124"></a><span id="l44.124"> nsresult ProxyForceDBClosed(nsIMsgFolder *aFolder)</span>
<a href="#l44.125"></a><span id="l44.125"> {</span>
<a href="#l44.126"></a><span id="l44.126" class="difflineminus">-  nsRefPtr&lt;ForceDBClosedRunnable&gt; forceDBClosed =</span>
<a href="#l44.127"></a><span id="l44.127" class="difflineplus">+  RefPtr&lt;ForceDBClosedRunnable&gt; forceDBClosed =</span>
<a href="#l44.128"></a><span id="l44.128">     new ForceDBClosedRunnable(aFolder);</span>
<a href="#l44.129"></a><span id="l44.129">   return NS_DispatchToMainThread(forceDBClosed, NS_DISPATCH_SYNC);</span>
<a href="#l44.130"></a><span id="l44.130"> }</span>
<a href="#l44.131"></a><span id="l44.131"> </span>
<a href="#l44.132"></a><span id="l44.132"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/import/src/nsImportService.cpp</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/import/src/nsImportService.cpp</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -357,17 +357,17 @@ nsImportService::CreateRFC822Message(nsI</span>
<a href="#l45.4"></a><span id="l45.4">                                      nsIMsgCompFields *aMsgFields,</span>
<a href="#l45.5"></a><span id="l45.5">                                      const char *aBodyType,</span>
<a href="#l45.6"></a><span id="l45.6">                                      const nsACString &amp;aBody,</span>
<a href="#l45.7"></a><span id="l45.7">                                      bool aIsDraft,</span>
<a href="#l45.8"></a><span id="l45.8">                                      nsIArray *aLoadedAttachments,</span>
<a href="#l45.9"></a><span id="l45.9">                                      nsIArray *aEmbeddedAttachments,</span>
<a href="#l45.10"></a><span id="l45.10">                                      nsIMsgSendListener *aListener)</span>
<a href="#l45.11"></a><span id="l45.11"> {</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-    nsRefPtr&lt;nsProxySendRunnable&gt; runnable =</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+    RefPtr&lt;nsProxySendRunnable&gt; runnable =</span>
<a href="#l45.14"></a><span id="l45.14">       new nsProxySendRunnable(aIdentity,</span>
<a href="#l45.15"></a><span id="l45.15">                               aMsgFields,</span>
<a href="#l45.16"></a><span id="l45.16">                               aBodyType,</span>
<a href="#l45.17"></a><span id="l45.17">                               aBody,</span>
<a href="#l45.18"></a><span id="l45.18">                               aIsDraft,</span>
<a href="#l45.19"></a><span id="l45.19">                               aLoadedAttachments,</span>
<a href="#l45.20"></a><span id="l45.20">                               aEmbeddedAttachments,</span>
<a href="#l45.21"></a><span id="l45.21">                               aListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -1641,17 +1641,17 @@ nsMsgLocalMailFolder::CopyMessages(nsIMs</span>
<a href="#l46.4"></a><span id="l46.4">       if (msgDb)</span>
<a href="#l46.5"></a><span id="l46.5">         parseMsgState-&gt;SetMailDB(msgDb);</span>
<a href="#l46.6"></a><span id="l46.6">     }</span>
<a href="#l46.7"></a><span id="l46.7">   }</span>
<a href="#l46.8"></a><span id="l46.8"> </span>
<a href="#l46.9"></a><span id="l46.9">   // undo stuff</span>
<a href="#l46.10"></a><span id="l46.10">   if (allowUndo)    //no undo for folder move/copy or or move/copy from search window</span>
<a href="#l46.11"></a><span id="l46.11">   {</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-    nsRefPtr&lt;nsLocalMoveCopyMsgTxn&gt; msgTxn = new nsLocalMoveCopyMsgTxn;</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+    RefPtr&lt;nsLocalMoveCopyMsgTxn&gt; msgTxn = new nsLocalMoveCopyMsgTxn;</span>
<a href="#l46.14"></a><span id="l46.14">     if (msgTxn &amp;&amp; NS_SUCCEEDED(msgTxn-&gt;Init(srcFolder, this, isMove)))</span>
<a href="#l46.15"></a><span id="l46.15">     {</span>
<a href="#l46.16"></a><span id="l46.16">       msgTxn-&gt;SetMsgWindow(msgWindow);</span>
<a href="#l46.17"></a><span id="l46.17">       if (isMove)</span>
<a href="#l46.18"></a><span id="l46.18">       {</span>
<a href="#l46.19"></a><span id="l46.19">         if (mFlags &amp; nsMsgFolderFlags::Trash)</span>
<a href="#l46.20"></a><span id="l46.20">           msgTxn-&gt;SetTransactionType(nsIMessenger::eDeleteMsg);</span>
<a href="#l46.21"></a><span id="l46.21">         else</span>
<a href="#l46.22"></a><span id="l46.22" class="difflineat">@@ -2336,17 +2336,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::EndC</span>
<a href="#l46.23"></a><span id="l46.23">       // enable the dest folder</span>
<a href="#l46.24"></a><span id="l46.24">       EnableNotifications(allMessageCountNotifications, true, false /*dbBatching*/); //dest folder doesn't need db batching</span>
<a href="#l46.25"></a><span id="l46.25">     }</span>
<a href="#l46.26"></a><span id="l46.26">     return NS_OK;</span>
<a href="#l46.27"></a><span id="l46.27">   }</span>
<a href="#l46.28"></a><span id="l46.28"> </span>
<a href="#l46.29"></a><span id="l46.29">   bool multipleCopiesFinished = (mCopyState-&gt;m_curCopyIndex &gt;= mCopyState-&gt;m_totalMsgCount);</span>
<a href="#l46.30"></a><span id="l46.30"> </span>
<a href="#l46.31"></a><span id="l46.31" class="difflineminus">-  nsRefPtr&lt;nsLocalMoveCopyMsgTxn&gt; localUndoTxn = mCopyState-&gt;m_undoMsgTxn;</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineplus">+  RefPtr&lt;nsLocalMoveCopyMsgTxn&gt; localUndoTxn = mCopyState-&gt;m_undoMsgTxn;</span>
<a href="#l46.33"></a><span id="l46.33"> </span>
<a href="#l46.34"></a><span id="l46.34">   NS_ASSERTION(mCopyState-&gt;m_leftOver == 0, &quot;whoops, something wrong with previous copy&quot;);</span>
<a href="#l46.35"></a><span id="l46.35">   mCopyState-&gt;m_leftOver = 0; // reset to 0.</span>
<a href="#l46.36"></a><span id="l46.36">   // need to reset this in case we're move/copying multiple msgs.</span>
<a href="#l46.37"></a><span id="l46.37">   mCopyState-&gt;m_fromLineSeen = false;</span>
<a href="#l46.38"></a><span id="l46.38"> </span>
<a href="#l46.39"></a><span id="l46.39">   // flush the copied message. We need a close at the end to get the</span>
<a href="#l46.40"></a><span id="l46.40">   // file size and time updated correctly.</span>
<a href="#l46.41"></a><span id="l46.41" class="difflineat">@@ -2669,17 +2669,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::Star</span>
<a href="#l46.42"></a><span id="l46.42">   return WriteStartOfNewMessage();</span>
<a href="#l46.43"></a><span id="l46.43"> }</span>
<a href="#l46.44"></a><span id="l46.44"> </span>
<a href="#l46.45"></a><span id="l46.45"> // just finished the current message.</span>
<a href="#l46.46"></a><span id="l46.46"> NS_IMETHODIMP nsMsgLocalMailFolder::EndMessage(nsMsgKey key)</span>
<a href="#l46.47"></a><span id="l46.47"> {</span>
<a href="#l46.48"></a><span id="l46.48">   NS_ENSURE_ARG_POINTER(mCopyState);</span>
<a href="#l46.49"></a><span id="l46.49"> </span>
<a href="#l46.50"></a><span id="l46.50" class="difflineminus">-  nsRefPtr&lt;nsLocalMoveCopyMsgTxn&gt; localUndoTxn = mCopyState-&gt;m_undoMsgTxn;</span>
<a href="#l46.51"></a><span id="l46.51" class="difflineplus">+  RefPtr&lt;nsLocalMoveCopyMsgTxn&gt; localUndoTxn = mCopyState-&gt;m_undoMsgTxn;</span>
<a href="#l46.52"></a><span id="l46.52">   nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow;</span>
<a href="#l46.53"></a><span id="l46.53">   nsresult rv;</span>
<a href="#l46.54"></a><span id="l46.54"> </span>
<a href="#l46.55"></a><span id="l46.55">   if (localUndoTxn)</span>
<a href="#l46.56"></a><span id="l46.56">   {</span>
<a href="#l46.57"></a><span id="l46.57">     localUndoTxn-&gt;GetMsgWindow(getter_AddRefs(msgWindow));</span>
<a href="#l46.58"></a><span id="l46.58">     localUndoTxn-&gt;AddSrcKey(key);</span>
<a href="#l46.59"></a><span id="l46.59">     localUndoTxn-&gt;AddDstKey(mCopyState-&gt;m_curDstKey);</span>
<a href="#l46.60"></a><span id="l46.60" class="difflineat">@@ -3679,17 +3679,17 @@ nsMsgLocalMailFolder::AddMessageBatch(ui</span>
<a href="#l46.61"></a><span id="l46.61"> </span>
<a href="#l46.62"></a><span id="l46.62">   if (NS_SUCCEEDED(rv))</span>
<a href="#l46.63"></a><span id="l46.63">   {</span>
<a href="#l46.64"></a><span id="l46.64">     nsCOMPtr&lt;nsIMutableArray&gt; hdrArray =</span>
<a href="#l46.65"></a><span id="l46.65">       do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l46.66"></a><span id="l46.66">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l46.67"></a><span id="l46.67">     for (uint32_t i = 0; i &lt; aMessageCount; i++)</span>
<a href="#l46.68"></a><span id="l46.68">     {</span>
<a href="#l46.69"></a><span id="l46.69" class="difflineminus">-      nsRefPtr&lt;nsParseNewMailState&gt; newMailParser = new nsParseNewMailState;</span>
<a href="#l46.70"></a><span id="l46.70" class="difflineplus">+      RefPtr&lt;nsParseNewMailState&gt; newMailParser = new nsParseNewMailState;</span>
<a href="#l46.71"></a><span id="l46.71">       NS_ENSURE_TRUE(newMailParser, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l46.72"></a><span id="l46.72">       if (!mGettingNewMessages)</span>
<a href="#l46.73"></a><span id="l46.73">         newMailParser-&gt;DisableFilters();</span>
<a href="#l46.74"></a><span id="l46.74">       bool reusable;</span>
<a href="#l46.75"></a><span id="l46.75">       rv = msgStore-&gt;GetNewMsgOutputStream(this, getter_AddRefs(newHdr),</span>
<a href="#l46.76"></a><span id="l46.76">                                       &amp;reusable,</span>
<a href="#l46.77"></a><span id="l46.77">                                       getter_AddRefs(outFileStream));</span>
<a href="#l46.78"></a><span id="l46.78">       NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.h</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.h</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -36,20 +36,20 @@ struct nsLocalMailCopyState</span>
<a href="#l47.4"></a><span id="l47.4">   </span>
<a href="#l47.5"></a><span id="l47.5">   nsCOMPtr &lt;nsIOutputStream&gt; m_fileStream;</span>
<a href="#l47.6"></a><span id="l47.6">   nsCOMPtr&lt;nsIMsgPluggableStore&gt; m_msgStore;</span>
<a href="#l47.7"></a><span id="l47.7">   nsCOMPtr&lt;nsISupports&gt; m_srcSupport;</span>
<a href="#l47.8"></a><span id="l47.8">   /// Source nsIMsgDBHdr instances.</span>
<a href="#l47.9"></a><span id="l47.9">   nsCOMPtr&lt;nsIArray&gt; m_messages;</span>
<a href="#l47.10"></a><span id="l47.10">   /// Destination nsIMsgDBHdr instances.</span>
<a href="#l47.11"></a><span id="l47.11">   nsCOMPtr&lt;nsIMutableArray&gt; m_destMessages;</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  nsRefPtr&lt;nsLocalMoveCopyMsgTxn&gt; m_undoMsgTxn;</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+  RefPtr&lt;nsLocalMoveCopyMsgTxn&gt; m_undoMsgTxn;</span>
<a href="#l47.14"></a><span id="l47.14">   nsCOMPtr&lt;nsIMsgDBHdr&gt; m_message; // current copy message</span>
<a href="#l47.15"></a><span id="l47.15">   nsMsgMessageFlagType m_flags; // current copy message flags</span>
<a href="#l47.16"></a><span id="l47.16" class="difflineminus">-  nsRefPtr&lt;nsParseMailMessageState&gt; m_parseMsgState;</span>
<a href="#l47.17"></a><span id="l47.17" class="difflineplus">+  RefPtr&lt;nsParseMailMessageState&gt; m_parseMsgState;</span>
<a href="#l47.18"></a><span id="l47.18">   nsCOMPtr&lt;nsIMsgCopyServiceListener&gt; m_listener;</span>
<a href="#l47.19"></a><span id="l47.19">   nsCOMPtr&lt;nsIMsgWindow&gt; m_msgWindow;</span>
<a href="#l47.20"></a><span id="l47.20">   nsCOMPtr&lt;nsIMsgDatabase&gt; m_destDB;</span>
<a href="#l47.21"></a><span id="l47.21"> </span>
<a href="#l47.22"></a><span id="l47.22">   // for displaying status;</span>
<a href="#l47.23"></a><span id="l47.23">   nsCOMPtr &lt;nsIMsgStatusFeedback&gt; m_statusFeedback;</span>
<a href="#l47.24"></a><span id="l47.24">   nsCOMPtr &lt;nsIStringBundle&gt; m_stringBundle;</span>
<a href="#l47.25"></a><span id="l47.25">   int64_t m_lastProgressTime;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -21,17 +21,17 @@</span>
<a href="#l48.4"></a><span id="l48.4"> #include &quot;nsIPop3Service.h&quot;</span>
<a href="#l48.5"></a><span id="l48.5"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l48.6"></a><span id="l48.6"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l48.7"></a><span id="l48.7"> #include &quot;nsIDocShellLoadInfo.h&quot;</span>
<a href="#l48.8"></a><span id="l48.8"> #include &quot;nsIWebNavigation.h&quot;</span>
<a href="#l48.9"></a><span id="l48.9"> #include &quot;prprf.h&quot;</span>
<a href="#l48.10"></a><span id="l48.10"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l48.11"></a><span id="l48.11"> #include &quot;nsIFileURL.h&quot;</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-#include &quot;mozilla/nsRefPtr.h&quot;</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+#include &quot;mozilla/RefPtr.h&quot;</span>
<a href="#l48.14"></a><span id="l48.14"> </span>
<a href="#l48.15"></a><span id="l48.15"> nsMailboxService::nsMailboxService()</span>
<a href="#l48.16"></a><span id="l48.16"> {</span>
<a href="#l48.17"></a><span id="l48.17">     mPrintingOperation = false;</span>
<a href="#l48.18"></a><span id="l48.18"> }</span>
<a href="#l48.19"></a><span id="l48.19"> </span>
<a href="#l48.20"></a><span id="l48.20"> nsMailboxService::~nsMailboxService()</span>
<a href="#l48.21"></a><span id="l48.21"> {}</span>
<a href="#l48.22"></a><span id="l48.22" class="difflineat">@@ -595,17 +595,17 @@ NS_IMETHODIMP nsMailboxService::NewChann</span>
<a href="#l48.23"></a><span id="l48.23">       nsCOMPtr &lt;nsIURI&gt; pop3Uri;</span>
<a href="#l48.24"></a><span id="l48.24"> </span>
<a href="#l48.25"></a><span id="l48.25">       rv = handler-&gt;NewURI(spec, &quot;&quot; /* ignored */, aURI, getter_AddRefs(pop3Uri));</span>
<a href="#l48.26"></a><span id="l48.26">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l48.27"></a><span id="l48.27">       return handler-&gt;NewChannel2(pop3Uri, aLoadInfo, _retval);</span>
<a href="#l48.28"></a><span id="l48.28">     }</span>
<a href="#l48.29"></a><span id="l48.29">   }</span>
<a href="#l48.30"></a><span id="l48.30"> </span>
<a href="#l48.31"></a><span id="l48.31" class="difflineminus">-  nsRefPtr&lt;nsMailboxProtocol&gt; protocol = new nsMailboxProtocol(aURI);</span>
<a href="#l48.32"></a><span id="l48.32" class="difflineplus">+  RefPtr&lt;nsMailboxProtocol&gt; protocol = new nsMailboxProtocol(aURI);</span>
<a href="#l48.33"></a><span id="l48.33">   if (!protocol) {</span>
<a href="#l48.34"></a><span id="l48.34">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l48.35"></a><span id="l48.35">   }</span>
<a href="#l48.36"></a><span id="l48.36"> </span>
<a href="#l48.37"></a><span id="l48.37">   rv = protocol-&gt;Initialize(aURI);</span>
<a href="#l48.38"></a><span id="l48.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l48.39"></a><span id="l48.39"> </span>
<a href="#l48.40"></a><span id="l48.40">   rv = protocol-&gt;SetLoadInfo(aLoadInfo);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -80,17 +80,17 @@ public:</span>
<a href="#l49.4"></a><span id="l49.4">   ~SpoolLock();</span>
<a href="#l49.5"></a><span id="l49.5"> </span>
<a href="#l49.6"></a><span id="l49.6">   bool isLocked();</span>
<a href="#l49.7"></a><span id="l49.7"> </span>
<a href="#l49.8"></a><span id="l49.8"> private:</span>
<a href="#l49.9"></a><span id="l49.9">   bool mLocked;</span>
<a href="#l49.10"></a><span id="l49.10">   nsCString mSpoolName;</span>
<a href="#l49.11"></a><span id="l49.11">   bool mUsingLockFile;</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  nsRefPtr&lt;nsMovemailService&gt; mOwningService;</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+  RefPtr&lt;nsMovemailService&gt; mOwningService;</span>
<a href="#l49.14"></a><span id="l49.14">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; mServer;</span>
<a href="#l49.15"></a><span id="l49.15"> </span>
<a href="#l49.16"></a><span id="l49.16">   bool ObtainSpoolLock(unsigned int aSeconds);</span>
<a href="#l49.17"></a><span id="l49.17">   bool YieldSpoolLock();</span>
<a href="#l49.18"></a><span id="l49.18"> };</span>
<a href="#l49.19"></a><span id="l49.19"> </span>
<a href="#l49.20"></a><span id="l49.20"> }</span>
<a href="#l49.21"></a><span id="l49.21"> </span>
<a href="#l49.22"></a><span id="l49.22" class="difflineat">@@ -463,17 +463,17 @@ nsMovemailService::GetNewMail(nsIMsgWind</span>
<a href="#l49.23"></a><span id="l49.23">                                         getter_AddRefs(inbox));</span>
<a href="#l49.24"></a><span id="l49.24">   NS_ENSURE_TRUE(NS_SUCCEEDED(rv) &amp;&amp; inbox, rv);</span>
<a href="#l49.25"></a><span id="l49.25"> </span>
<a href="#l49.26"></a><span id="l49.26">   nsCOMPtr&lt;nsIMsgPluggableStore&gt; msgStore;</span>
<a href="#l49.27"></a><span id="l49.27">   rv = in_server-&gt;GetMsgStore(getter_AddRefs(msgStore));</span>
<a href="#l49.28"></a><span id="l49.28">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l49.29"></a><span id="l49.29"> </span>
<a href="#l49.30"></a><span id="l49.30">   // create a new mail parser</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineminus">-  nsRefPtr&lt;nsParseNewMailState&gt; newMailParser = new nsParseNewMailState;</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineplus">+  RefPtr&lt;nsParseNewMailState&gt; newMailParser = new nsParseNewMailState;</span>
<a href="#l49.33"></a><span id="l49.33"> </span>
<a href="#l49.34"></a><span id="l49.34">   // Try and obtain the lock for the spool file.</span>
<a href="#l49.35"></a><span id="l49.35">   SpoolLock lock(&amp;spoolPath, 5, *this, in_server);</span>
<a href="#l49.36"></a><span id="l49.36">   if (!lock.isLocked())</span>
<a href="#l49.37"></a><span id="l49.37">     return NS_ERROR_FAILURE;</span>
<a href="#l49.38"></a><span id="l49.38"> </span>
<a href="#l49.39"></a><span id="l49.39">   nsCOMPtr&lt;nsIMsgDBHdr&gt; newHdr;</span>
<a href="#l49.40"></a><span id="l49.40">   nsCOMPtr&lt;nsIOutputStream&gt; outputStream;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/local/src/nsMsgBrkMBoxStore.cpp</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgBrkMBoxStore.cpp</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -811,17 +811,17 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::Rebuild</span>
<a href="#l50.4"></a><span id="l50.4">     NS_ASSERTION(false, &quot;Could not get folder lock&quot;);</span>
<a href="#l50.5"></a><span id="l50.5">     return NS_MSG_FOLDER_BUSY;</span>
<a href="#l50.6"></a><span id="l50.6">   }</span>
<a href="#l50.7"></a><span id="l50.7"> </span>
<a href="#l50.8"></a><span id="l50.8">   nsCOMPtr&lt;nsIMailboxService&gt; mailboxService =</span>
<a href="#l50.9"></a><span id="l50.9">     do_GetService(NS_MAILBOXSERVICE_CONTRACTID1, &amp;rv);</span>
<a href="#l50.10"></a><span id="l50.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l50.11"></a><span id="l50.11"> </span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-  nsRefPtr&lt;nsMsgMailboxParser&gt; parser = new nsMsgMailboxParser(aFolder);</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+  RefPtr&lt;nsMsgMailboxParser&gt; parser = new nsMsgMailboxParser(aFolder);</span>
<a href="#l50.14"></a><span id="l50.14">   NS_ENSURE_TRUE(parser, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l50.15"></a><span id="l50.15">   rv = parser-&gt;Init();</span>
<a href="#l50.16"></a><span id="l50.16">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l50.17"></a><span id="l50.17"> </span>
<a href="#l50.18"></a><span id="l50.18">   return mailboxService-&gt;ParseMailbox(aMsgWindow, pathFile, parser, aListener,</span>
<a href="#l50.19"></a><span id="l50.19">                                       nullptr);</span>
<a href="#l50.20"></a><span id="l50.20"> }</span>
<a href="#l50.21"></a><span id="l50.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/local/src/nsMsgMaildirStore.cpp</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgMaildirStore.cpp</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -1007,17 +1007,17 @@ nsMsgMaildirStore::CopyMessages(bool aIs</span>
<a href="#l51.4"></a><span id="l51.4"> </span>
<a href="#l51.5"></a><span id="l51.5">   nsCOMPtr&lt;nsIFile&gt; srcFolderPath;</span>
<a href="#l51.6"></a><span id="l51.6">   rv = srcFolder-&gt;GetFilePath(getter_AddRefs(srcFolderPath));</span>
<a href="#l51.7"></a><span id="l51.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l51.8"></a><span id="l51.8">   srcFolderPath-&gt;Append(NS_LITERAL_STRING(&quot;cur&quot;));</span>
<a href="#l51.9"></a><span id="l51.9"> </span>
<a href="#l51.10"></a><span id="l51.10">   nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l51.11"></a><span id="l51.11">   srcFolder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-  nsRefPtr&lt;nsLocalMoveCopyMsgTxn&gt; msgTxn = new nsLocalMoveCopyMsgTxn;</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+  RefPtr&lt;nsLocalMoveCopyMsgTxn&gt; msgTxn = new nsLocalMoveCopyMsgTxn;</span>
<a href="#l51.14"></a><span id="l51.14">   NS_ENSURE_TRUE(msgTxn, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l51.15"></a><span id="l51.15">   if (NS_SUCCEEDED(msgTxn-&gt;Init(srcFolder, aDstFolder, aIsMove)))</span>
<a href="#l51.16"></a><span id="l51.16">   {</span>
<a href="#l51.17"></a><span id="l51.17">     if (aIsMove)</span>
<a href="#l51.18"></a><span id="l51.18">       msgTxn-&gt;SetTransactionType(nsIMessenger::eMoveMsg);</span>
<a href="#l51.19"></a><span id="l51.19">     else</span>
<a href="#l51.20"></a><span id="l51.20">       msgTxn-&gt;SetTransactionType(nsIMessenger::eCopyMsg);</span>
<a href="#l51.21"></a><span id="l51.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.h</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.h</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -238,17 +238,17 @@ protected:</span>
<a href="#l52.4"></a><span id="l52.4">   nsCOMPtr &lt;nsIMsgFilterList&gt; m_filterList;</span>
<a href="#l52.5"></a><span id="l52.5">   nsCOMPtr &lt;nsIMsgFilterList&gt; m_deferredToServerFilterList;</span>
<a href="#l52.6"></a><span id="l52.6">   nsCOMPtr &lt;nsIMsgFolder&gt; m_rootFolder;</span>
<a href="#l52.7"></a><span id="l52.7">   nsCOMPtr &lt;nsIMsgWindow&gt; m_msgWindow;</span>
<a href="#l52.8"></a><span id="l52.8">   nsCOMPtr &lt;nsIMsgFolder&gt; m_downloadFolder;</span>
<a href="#l52.9"></a><span id="l52.9">   nsCOMPtr&lt;nsIOutputStream&gt; m_outputStream;</span>
<a href="#l52.10"></a><span id="l52.10">   nsCOMArray &lt;nsIMsgFolder&gt; m_filterTargetFolders;</span>
<a href="#l52.11"></a><span id="l52.11"> </span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  nsRefPtr&lt;nsImapMoveCoalescer&gt; m_moveCoalescer;</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+  RefPtr&lt;nsImapMoveCoalescer&gt; m_moveCoalescer;</span>
<a href="#l52.14"></a><span id="l52.14"> </span>
<a href="#l52.15"></a><span id="l52.15">   bool          m_msgMovedByFilter;</span>
<a href="#l52.16"></a><span id="l52.16">   bool          m_msgCopiedByFilter;</span>
<a href="#l52.17"></a><span id="l52.17">   bool          m_disableFilters;</span>
<a href="#l52.18"></a><span id="l52.18">   uint32_t      m_ibuffer_fp;</span>
<a href="#l52.19"></a><span id="l52.19">   char          *m_ibuffer;</span>
<a href="#l52.20"></a><span id="l52.20">   uint32_t      m_ibuffer_size;</span>
<a href="#l52.21"></a><span id="l52.21">   // used for applying move filters, because in the case of using a temporary</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/local/src/nsPop3IncomingServer.cpp</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3IncomingServer.cpp</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -160,17 +160,17 @@ NS_IMETHODIMP nsPop3IncomingServer::GetD</span>
<a href="#l53.4"></a><span id="l53.4">               if (subFolder)</span>
<a href="#l53.5"></a><span id="l53.5">               {</span>
<a href="#l53.6"></a><span id="l53.6">                 nsCOMPtr&lt;nsIMsgDatabase&gt; subFolderDB;</span>
<a href="#l53.7"></a><span id="l53.7">                 subFolder-&gt;GetMsgDatabase(getter_AddRefs(subFolderDB));</span>
<a href="#l53.8"></a><span id="l53.8">                 if (subFolderDB)</span>
<a href="#l53.9"></a><span id="l53.9">                 {</span>
<a href="#l53.10"></a><span id="l53.10">                   // Copy any messages in this sub-folder of the hidden</span>
<a href="#l53.11"></a><span id="l53.11">                   // account to the corresponding folder in Local Folders.</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-                  nsRefPtr&lt;nsMsgKeyArray&gt; keys = new nsMsgKeyArray;</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+                  RefPtr&lt;nsMsgKeyArray&gt; keys = new nsMsgKeyArray;</span>
<a href="#l53.14"></a><span id="l53.14">                   rv = subFolderDB-&gt;ListAllKeys(keys);</span>
<a href="#l53.15"></a><span id="l53.15">                   nsCOMPtr&lt;nsIMutableArray&gt; hdrsToCopy(do_CreateInstance(NS_ARRAY_CONTRACTID));</span>
<a href="#l53.16"></a><span id="l53.16">                   MsgGetHeadersFromKeys(subFolderDB, keys-&gt;m_keys, hdrsToCopy);</span>
<a href="#l53.17"></a><span id="l53.17">                   uint32_t numHdrs = 0;</span>
<a href="#l53.18"></a><span id="l53.18">                   if (hdrsToCopy)</span>
<a href="#l53.19"></a><span id="l53.19">                     hdrsToCopy-&gt;GetLength(&amp;numHdrs);</span>
<a href="#l53.20"></a><span id="l53.20">                   if (numHdrs)</span>
<a href="#l53.21"></a><span id="l53.21">                   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -250,17 +250,17 @@ nsresult nsPop3Service::RunPopUrl(nsIMsg</span>
<a href="#l54.4"></a><span id="l54.4"> </span>
<a href="#l54.5"></a><span id="l54.5">   // find out if the server is busy or not...if the server is busy, we are</span>
<a href="#l54.6"></a><span id="l54.6">   // *NOT* going to run the url</span>
<a href="#l54.7"></a><span id="l54.7">   bool serverBusy = false;</span>
<a href="#l54.8"></a><span id="l54.8">   rv = aServer-&gt;GetServerBusy(&amp;serverBusy);</span>
<a href="#l54.9"></a><span id="l54.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l54.10"></a><span id="l54.10">   if (!serverBusy)</span>
<a href="#l54.11"></a><span id="l54.11">   {</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-    nsRefPtr&lt;nsPop3Protocol&gt; protocol = new nsPop3Protocol(aUrlToRun);</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+    RefPtr&lt;nsPop3Protocol&gt; protocol = new nsPop3Protocol(aUrlToRun);</span>
<a href="#l54.14"></a><span id="l54.14">     if (protocol)</span>
<a href="#l54.15"></a><span id="l54.15">     {</span>
<a href="#l54.16"></a><span id="l54.16">       // the protocol stores the unescaped username, so there is no need to escape it.</span>
<a href="#l54.17"></a><span id="l54.17">       protocol-&gt;SetUsername(userName.get());</span>
<a href="#l54.18"></a><span id="l54.18">       rv = protocol-&gt;LoadUrl(aUrlToRun);</span>
<a href="#l54.19"></a><span id="l54.19">       if (NS_FAILED(rv))</span>
<a href="#l54.20"></a><span id="l54.20">         aServer-&gt;SetServerBusy(false);</span>
<a href="#l54.21"></a><span id="l54.21">     }</span>
<a href="#l54.22"></a><span id="l54.22" class="difflineat">@@ -504,17 +504,17 @@ NS_IMETHODIMP nsPop3Service::NewChannel2</span>
<a href="#l54.23"></a><span id="l54.23">       {</span>
<a href="#l54.24"></a><span id="l54.24">         AlertServerBusy(url);</span>
<a href="#l54.25"></a><span id="l54.25">         return NS_MSG_FOLDER_BUSY;</span>
<a href="#l54.26"></a><span id="l54.26">       }</span>
<a href="#l54.27"></a><span id="l54.27">       server-&gt;GetRealUsername(realUserName);</span>
<a href="#l54.28"></a><span id="l54.28">     }</span>
<a href="#l54.29"></a><span id="l54.29">   }</span>
<a href="#l54.30"></a><span id="l54.30"> </span>
<a href="#l54.31"></a><span id="l54.31" class="difflineminus">-  nsRefPtr&lt;nsPop3Protocol&gt; protocol = new nsPop3Protocol(aURI);</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineplus">+  RefPtr&lt;nsPop3Protocol&gt; protocol = new nsPop3Protocol(aURI);</span>
<a href="#l54.33"></a><span id="l54.33">   NS_ENSURE_TRUE(protocol, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l54.34"></a><span id="l54.34"> </span>
<a href="#l54.35"></a><span id="l54.35">   rv = protocol-&gt;Initialize(aURI);</span>
<a href="#l54.36"></a><span id="l54.36">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l54.37"></a><span id="l54.37"> </span>
<a href="#l54.38"></a><span id="l54.38">   rv = protocol-&gt;SetLoadInfo(aLoadInfo);</span>
<a href="#l54.39"></a><span id="l54.39">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l54.40"></a><span id="l54.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Sink.h</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Sink.h</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -55,17 +55,17 @@ protected:</span>
<a href="#l55.4"></a><span id="l55.4">     int32_t m_numNewMessages;</span>
<a href="#l55.5"></a><span id="l55.5">     int32_t m_numNewMessagesInFolder;</span>
<a href="#l55.6"></a><span id="l55.6">     int32_t m_numMsgsDownloaded;</span>
<a href="#l55.7"></a><span id="l55.7">     bool m_senderAuthed;</span>
<a href="#l55.8"></a><span id="l55.8">     nsCString m_outputBuffer;</span>
<a href="#l55.9"></a><span id="l55.9">     nsCOMPtr&lt;nsIPop3IncomingServer&gt; m_popServer;</span>
<a href="#l55.10"></a><span id="l55.10">     //Currently the folder we want to update about biff info</span>
<a href="#l55.11"></a><span id="l55.11">     nsCOMPtr&lt;nsIMsgFolder&gt; m_folder;</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-    nsRefPtr&lt;nsParseNewMailState&gt; m_newMailParser;</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+    RefPtr&lt;nsParseNewMailState&gt; m_newMailParser;</span>
<a href="#l55.14"></a><span id="l55.14">     nsCOMPtr &lt;nsIOutputStream&gt; m_outFileStream; // the file we write to, which may be temporary</span>
<a href="#l55.15"></a><span id="l55.15">     nsCOMPtr&lt;nsIMsgPluggableStore&gt; m_msgStore;</span>
<a href="#l55.16"></a><span id="l55.16">     bool m_uidlDownload;</span>
<a href="#l55.17"></a><span id="l55.17">     bool m_buildMessageUri;</span>
<a href="#l55.18"></a><span id="l55.18">     bool m_downloadingToTempFile;</span>
<a href="#l55.19"></a><span id="l55.19">     nsCOMPtr &lt;nsIFile&gt; m_tmpDownloadFile;</span>
<a href="#l55.20"></a><span id="l55.20">     nsCOMPtr&lt;nsIMsgWindow&gt; m_window;</span>
<a href="#l55.21"></a><span id="l55.21">     nsCString m_messageUri;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -157,19 +157,19 @@ nsMimeHtmlDisplayEmitter::GetHeaderSink(</span>
<a href="#l56.4"></a><span id="l56.4">   *aHeaderSink = mHeaderSink;</span>
<a href="#l56.5"></a><span id="l56.5">   NS_IF_ADDREF(*aHeaderSink);</span>
<a href="#l56.6"></a><span id="l56.6">   return rv;</span>
<a href="#l56.7"></a><span id="l56.7"> }</span>
<a href="#l56.8"></a><span id="l56.8"> </span>
<a href="#l56.9"></a><span id="l56.9"> nsresult nsMimeHtmlDisplayEmitter::BroadcastHeaders(nsIMsgHeaderSink * aHeaderSink, int32_t aHeaderMode, bool aFromNewsgroup)</span>
<a href="#l56.10"></a><span id="l56.10"> {</span>
<a href="#l56.11"></a><span id="l56.11">   // two string enumerators to pass out to the header sink</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-  nsRefPtr&lt;nsMimeStringEnumerator&gt; headerNameEnumerator = new nsMimeStringEnumerator();</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+  RefPtr&lt;nsMimeStringEnumerator&gt; headerNameEnumerator = new nsMimeStringEnumerator();</span>
<a href="#l56.14"></a><span id="l56.14">   NS_ENSURE_TRUE(headerNameEnumerator, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l56.15"></a><span id="l56.15" class="difflineminus">-  nsRefPtr&lt;nsMimeStringEnumerator&gt; headerValueEnumerator = new nsMimeStringEnumerator();</span>
<a href="#l56.16"></a><span id="l56.16" class="difflineplus">+  RefPtr&lt;nsMimeStringEnumerator&gt; headerValueEnumerator = new nsMimeStringEnumerator();</span>
<a href="#l56.17"></a><span id="l56.17">   NS_ENSURE_TRUE(headerValueEnumerator, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l56.18"></a><span id="l56.18"> </span>
<a href="#l56.19"></a><span id="l56.19">   nsCString extraExpandedHeaders;</span>
<a href="#l56.20"></a><span id="l56.20">   nsTArray&lt;nsCString&gt; extraExpandedHeadersArray;</span>
<a href="#l56.21"></a><span id="l56.21">   nsAutoCString convertedDateString;</span>
<a href="#l56.22"></a><span id="l56.22"> </span>
<a href="#l56.23"></a><span id="l56.23">   nsresult rv;</span>
<a href="#l56.24"></a><span id="l56.24">   nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/mime/src/mimecms.cpp</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/mime/src/mimecms.cpp</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -269,17 +269,17 @@ NS_IMETHODIMP SignedStatusRunnable::Run(</span>
<a href="#l57.4"></a><span id="l57.4"> }</span>
<a href="#l57.5"></a><span id="l57.5"> </span>
<a href="#l57.6"></a><span id="l57.6"> </span>
<a href="#l57.7"></a><span id="l57.7"> nsresult ProxySignedStatus(const nsMainThreadPtrHandle&lt;nsIMsgSMIMEHeaderSink&gt; &amp;aSink,</span>
<a href="#l57.8"></a><span id="l57.8">                            int32_t aNestingLevel,</span>
<a href="#l57.9"></a><span id="l57.9">                            int32_t aSignatureStatus,</span>
<a href="#l57.10"></a><span id="l57.10">                            nsIX509Cert *aSignerCert)</span>
<a href="#l57.11"></a><span id="l57.11"> {</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-  nsRefPtr&lt;SignedStatusRunnable&gt; signedStatus =</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+  RefPtr&lt;SignedStatusRunnable&gt; signedStatus =</span>
<a href="#l57.14"></a><span id="l57.14">     new SignedStatusRunnable(aSink, aNestingLevel, aSignatureStatus, aSignerCert);</span>
<a href="#l57.15"></a><span id="l57.15">   return NS_DispatchToMainThread(signedStatus, NS_DISPATCH_SYNC);</span>
<a href="#l57.16"></a><span id="l57.16"> }</span>
<a href="#l57.17"></a><span id="l57.17"> </span>
<a href="#l57.18"></a><span id="l57.18"> NS_IMPL_ISUPPORTS(nsSMimeVerificationListener, nsISMimeVerificationListener)</span>
<a href="#l57.19"></a><span id="l57.19"> </span>
<a href="#l57.20"></a><span id="l57.20"> nsSMimeVerificationListener::nsSMimeVerificationListener(const char *aFromAddr, const char *aFromName,</span>
<a href="#l57.21"></a><span id="l57.21">                                                          const char *aSenderAddr, const char *aSenderName,</span>
<a href="#l57.22"></a><span id="l57.22" class="difflineat">@@ -568,17 +568,17 @@ void MimeCMSRequestAsyncSignatureVerific</span>
<a href="#l57.23"></a><span id="l57.23">                                               const char *aSenderAddr, const char *aSenderName,</span>
<a href="#l57.24"></a><span id="l57.24">                                               nsIMsgSMIMEHeaderSink *aHeaderSink, int32_t aMimeNestingLevel,</span>
<a href="#l57.25"></a><span id="l57.25">                                               unsigned char* item_data, uint32_t item_len)</span>
<a href="#l57.26"></a><span id="l57.26"> {</span>
<a href="#l57.27"></a><span id="l57.27">   nsCOMPtr&lt;nsICMSMessage2&gt; msg2 = do_QueryInterface(aCMSMsg);</span>
<a href="#l57.28"></a><span id="l57.28">   if (!msg2)</span>
<a href="#l57.29"></a><span id="l57.29">     return;</span>
<a href="#l57.30"></a><span id="l57.30">   </span>
<a href="#l57.31"></a><span id="l57.31" class="difflineminus">-  nsRefPtr&lt;nsSMimeVerificationListener&gt; listener = </span>
<a href="#l57.32"></a><span id="l57.32" class="difflineplus">+  RefPtr&lt;nsSMimeVerificationListener&gt; listener = </span>
<a href="#l57.33"></a><span id="l57.33">     new nsSMimeVerificationListener(aFromAddr, aFromName, aSenderAddr, aSenderName,</span>
<a href="#l57.34"></a><span id="l57.34">                                     aHeaderSink, aMimeNestingLevel);</span>
<a href="#l57.35"></a><span id="l57.35">   if (!listener)</span>
<a href="#l57.36"></a><span id="l57.36">     return;</span>
<a href="#l57.37"></a><span id="l57.37">   </span>
<a href="#l57.38"></a><span id="l57.38">   if (item_data)</span>
<a href="#l57.39"></a><span id="l57.39">     msg2-&gt;AsyncVerifyDetachedSignature(listener, item_data, item_len);</span>
<a href="#l57.40"></a><span id="l57.40">   else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/mime/src/nsSimpleMimeConverterStub.cpp</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/mime/src/nsSimpleMimeConverterStub.cpp</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -194,13 +194,13 @@ nsSimpleMimeConverterStub::CreateContent</span>
<a href="#l58.4"></a><span id="l58.4">     initStruct-&gt;force_inline_display = true;</span>
<a href="#l58.5"></a><span id="l58.5">     return NS_OK;;</span>
<a href="#l58.6"></a><span id="l58.6"> }</span>
<a href="#l58.7"></a><span id="l58.7"> </span>
<a href="#l58.8"></a><span id="l58.8"> nsresult</span>
<a href="#l58.9"></a><span id="l58.9"> MIME_NewSimpleMimeConverterStub(const char *aContentType,</span>
<a href="#l58.10"></a><span id="l58.10">                                 nsIMimeContentTypeHandler **aResult)</span>
<a href="#l58.11"></a><span id="l58.11"> {</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-    nsRefPtr&lt;nsSimpleMimeConverterStub&gt; inst = new nsSimpleMimeConverterStub(aContentType);</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineplus">+    RefPtr&lt;nsSimpleMimeConverterStub&gt; inst = new nsSimpleMimeConverterStub(aContentType);</span>
<a href="#l58.14"></a><span id="l58.14">     NS_ENSURE_TRUE(inst, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l58.15"></a><span id="l58.15"> </span>
<a href="#l58.16"></a><span id="l58.16">     return CallQueryInterface(inst.get(), aResult);</span>
<a href="#l58.17"></a><span id="l58.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPArticleList.cpp</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPArticleList.cpp</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -40,17 +40,17 @@ nsNNTPArticleList::Initialize(nsIMsgNews</span>
<a href="#l59.4"></a><span id="l59.4"> </span>
<a href="#l59.5"></a><span id="l59.5">     nsCOMPtr &lt;nsIMsgFolder&gt; folder = do_QueryInterface(m_newsFolder, &amp;rv);</span>
<a href="#l59.6"></a><span id="l59.6">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l59.7"></a><span id="l59.7"> </span>
<a href="#l59.8"></a><span id="l59.8">     rv = folder-&gt;GetMsgDatabase(getter_AddRefs(m_newsDB));</span>
<a href="#l59.9"></a><span id="l59.9">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l59.10"></a><span id="l59.10">     if (!m_newsDB) return NS_ERROR_UNEXPECTED;</span>
<a href="#l59.11"></a><span id="l59.11"> </span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-    nsRefPtr&lt;nsMsgKeyArray&gt; keys = new nsMsgKeyArray;</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+    RefPtr&lt;nsMsgKeyArray&gt; keys = new nsMsgKeyArray;</span>
<a href="#l59.14"></a><span id="l59.14">     rv = m_newsDB-&gt;ListAllKeys(keys);</span>
<a href="#l59.15"></a><span id="l59.15">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l59.16"></a><span id="l59.16">     keys-&gt;Sort();</span>
<a href="#l59.17"></a><span id="l59.17">     m_idsInDB.AppendElements(keys-&gt;m_keys);</span>
<a href="#l59.18"></a><span id="l59.18"> </span>
<a href="#l59.19"></a><span id="l59.19">     return NS_OK;</span>
<a href="#l59.20"></a><span id="l59.20"> }</span>
<a href="#l59.21"></a><span id="l59.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -615,17 +615,17 @@ nsNntpIncomingServer::PrepareForNextUrl(</span>
<a href="#l60.4"></a><span id="l60.4"> {</span>
<a href="#l60.5"></a><span id="l60.5">   NS_ENSURE_ARG(aConnection);</span>
<a href="#l60.6"></a><span id="l60.6"> </span>
<a href="#l60.7"></a><span id="l60.7">   // Start the connection on the next URL in the queue. If it can't get a URL to</span>
<a href="#l60.8"></a><span id="l60.8">   // work, drop that URL (the channel will handle failure notification) and move</span>
<a href="#l60.9"></a><span id="l60.9">   // on.</span>
<a href="#l60.10"></a><span id="l60.10">   while (m_queuedChannels.Length() &gt; 0)</span>
<a href="#l60.11"></a><span id="l60.11">   {</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-    nsRefPtr&lt;nsNntpMockChannel&gt; channel = m_queuedChannels[0];</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+    RefPtr&lt;nsNntpMockChannel&gt; channel = m_queuedChannels[0];</span>
<a href="#l60.14"></a><span id="l60.14">     m_queuedChannels.RemoveElementAt(0);</span>
<a href="#l60.15"></a><span id="l60.15">     nsresult rv = channel-&gt;AttachNNTPConnection(*aConnection);</span>
<a href="#l60.16"></a><span id="l60.16">     // If this succeeded, the connection is now running the URL.</span>
<a href="#l60.17"></a><span id="l60.17">     if (NS_SUCCEEDED(rv))</span>
<a href="#l60.18"></a><span id="l60.18">       return NS_OK;</span>
<a href="#l60.19"></a><span id="l60.19">   }</span>
<a href="#l60.20"></a><span id="l60.20">   </span>
<a href="#l60.21"></a><span id="l60.21">   // No queued uris.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.h</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.h</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -78,17 +78,17 @@ protected:</span>
<a href="#l61.4"></a><span id="l61.4">    virtual nsresult CreateRootFolderFromUri(const nsCString &amp;serverUri,</span>
<a href="#l61.5"></a><span id="l61.5">                                             nsIMsgFolder **rootFolder);</span>
<a href="#l61.6"></a><span id="l61.6">     nsresult GetNntpConnection(nsIURI *url, nsIMsgWindow *window,</span>
<a href="#l61.7"></a><span id="l61.7">                                nsINNTPProtocol **aNntpConnection);</span>
<a href="#l61.8"></a><span id="l61.8">     nsresult CreateProtocolInstance(nsINNTPProtocol **aNntpConnection,</span>
<a href="#l61.9"></a><span id="l61.9">                                     nsIURI *url, nsIMsgWindow *window);</span>
<a href="#l61.10"></a><span id="l61.10">     bool ConnectionTimeOut(nsINNTPProtocol* aNntpConnection);</span>
<a href="#l61.11"></a><span id="l61.11">     nsCOMArray&lt;nsINNTPProtocol&gt; mConnectionCache;</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-    nsTArray&lt;nsRefPtr&lt;nsNntpMockChannel&gt; &gt; m_queuedChannels;</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+    nsTArray&lt;RefPtr&lt;nsNntpMockChannel&gt; &gt; m_queuedChannels;</span>
<a href="#l61.14"></a><span id="l61.14"> </span>
<a href="#l61.15"></a><span id="l61.15">     /**</span>
<a href="#l61.16"></a><span id="l61.16">      * Downloads the newsgroup headers.</span>
<a href="#l61.17"></a><span id="l61.17">      */</span>
<a href="#l61.18"></a><span id="l61.18">     nsresult DownloadMail(nsIMsgWindow *aMsgWindow);</span>
<a href="#l61.19"></a><span id="l61.19"> </span>
<a href="#l61.20"></a><span id="l61.20">     NS_IMETHOD GetServerRequiresPasswordForBiff(bool *aServerRequiresPasswordForBiff);</span>
<a href="#l61.21"></a><span id="l61.21">     nsresult SetupNewsrcSaveTimer();</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

