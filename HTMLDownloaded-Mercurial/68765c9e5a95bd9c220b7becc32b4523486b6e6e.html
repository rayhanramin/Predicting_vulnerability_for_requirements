<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 37:68765c9e5a95bd9c220b7becc32b4523486b6e6e</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 68765c9e5a95bd9c220b7becc32b4523486b6e6e" />
<meta property="og:url" content="/comm-central/rev/68765c9e5a95bd9c220b7becc32b4523486b6e6e" />
<meta property="og:description" content="Test case for Bug 439819 LDIF import does not include mozillahomestreet. r=me" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 68765c9e5a95bd9c220b7becc32b4523486b6e6e 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/68765c9e5a95bd9c220b7becc32b4523486b6e6e">shortlog</a> |
<a href="/comm-central/log/68765c9e5a95bd9c220b7becc32b4523486b6e6e">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/68765c9e5a95bd9c220b7becc32b4523486b6e6e">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/68765c9e5a95bd9c220b7becc32b4523486b6e6e">files</a> |
changeset |
<a href="/comm-central/raw-rev/68765c9e5a95bd9c220b7becc32b4523486b6e6e">raw</a>  | <a href="/comm-central/archive/68765c9e5a95bd9c220b7becc32b4523486b6e6e.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Test case for <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=439819">Bug 439819</a> LDIF import does not include mozillahomestreet. r=me
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#115;&#104;&#32;&#71;&#101;&#101;&#110;&#101;&#110;&#32;&#60;&#106;&#111;&#115;&#104;&#103;&#101;&#101;&#110;&#101;&#110;&#43;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 28 Jul 2008 08:53:17 -0700</td></tr>

<tr>
 <td>changeset 37</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/68765c9e5a95bd9c220b7becc32b4523486b6e6e">68765c9e5a95bd9c220b7becc32b4523486b6e6e</a></td>
</tr>



<tr>
<td>parent 36</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1b3d7cd8932925318ba1daefe90b2f942f83b65f">1b3d7cd8932925318ba1daefe90b2f942f83b65f</a>
</td>
</tr>

<tr>
<td>child 38</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/014093b714605ae1b6ba31da104d013c480ad9ae">014093b714605ae1b6ba31da104d013c480ad9ae</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=68765c9e5a95bd9c220b7becc32b4523486b6e6e">32</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 28 Jul 2008 15:55:02 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@68765c9e5a95 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=68765c9e5a95bd9c220b7becc32b4523486b6e6e">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=68765c9e5a95bd9c220b7becc32b4523486b6e6e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68765c9e5a95bd9c220b7becc32b4523486b6e6e&newProject=comm-central&newRevision=68765c9e5a95bd9c220b7becc32b4523486b6e6e&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68765c9e5a95bd9c220b7becc32b4523486b6e6e&newProject=comm-central&newRevision=68765c9e5a95bd9c220b7becc32b4523486b6e6e&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68765c9e5a95bd9c220b7becc32b4523486b6e6e&newProject=comm-central&newRevision=68765c9e5a95bd9c220b7becc32b4523486b6e6e&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28me%29&revcount=50">me</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=439819">439819</a></td></tr>




</table></div>

<div class="page_body description">Test case for <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=439819">Bug 439819</a> LDIF import does not include mozillahomestreet. r=me</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/AB_README">mailnews/import/test/resources/AB_README</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/AB_README">file</a> |
<a href="/comm-central/annotate/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/AB_README">annotate</a> |
<a href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/AB_README">diff</a> |
<a href="/comm-central/comparison/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/AB_README">comparison</a> |
<a href="/comm-central/log/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/AB_README">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/addressbook.json">mailnews/import/test/resources/addressbook.json</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/addressbook.json">file</a> |
<a href="/comm-central/annotate/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/addressbook.json">annotate</a> |
<a href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/addressbook.json">diff</a> |
<a href="/comm-central/comparison/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/addressbook.json">comparison</a> |
<a href="/comm-central/log/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/addressbook.json">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/basic_ldif_addressbook.ldif">mailnews/import/test/resources/basic_ldif_addressbook.ldif</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/basic_ldif_addressbook.ldif">file</a> |
<a href="/comm-central/annotate/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/basic_ldif_addressbook.ldif">annotate</a> |
<a href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/basic_ldif_addressbook.ldif">diff</a> |
<a href="/comm-central/comparison/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/basic_ldif_addressbook.ldif">comparison</a> |
<a href="/comm-central/log/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/basic_ldif_addressbook.ldif">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/import_helper.js">mailnews/import/test/resources/import_helper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/import_helper.js">file</a> |
<a href="/comm-central/annotate/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/import_helper.js">annotate</a> |
<a href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/import_helper.js">diff</a> |
<a href="/comm-central/comparison/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/import_helper.js">comparison</a> |
<a href="/comm-central/log/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/resources/import_helper.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_bug_437556.js">mailnews/import/test/unit/test_bug_437556.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_bug_437556.js">file</a> |
<a href="/comm-central/annotate/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_bug_437556.js">annotate</a> |
<a href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_bug_437556.js">diff</a> |
<a href="/comm-central/comparison/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_bug_437556.js">comparison</a> |
<a href="/comm-central/log/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_bug_437556.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_ldif_import.js">mailnews/import/test/unit/test_ldif_import.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_ldif_import.js">file</a> |
<a href="/comm-central/annotate/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_ldif_import.js">annotate</a> |
<a href="/comm-central/diff/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_ldif_import.js">diff</a> |
<a href="/comm-central/comparison/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_ldif_import.js">comparison</a> |
<a href="/comm-central/log/68765c9e5a95bd9c220b7becc32b4523486b6e6e/mailnews/import/test/unit/test_ldif_import.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1">new file mode 100644</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineminus">--- /dev/null</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineplus">+++ b/mailnews/import/test/resources/AB_README</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineat">@@ -0,0 +1,39 @@</span>
<a href="#l1.5"></a><span id="l1.5" class="difflineplus">+To test importing an address book, make a new file in the</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineplus">+/import/test/unit directory with the prefix test_ in the filename</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineplus">+(ex. test_ldif_import.js).</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineplus">+</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineplus">+It should have a function named run_test with no parameters.  If you are using</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineplus">+import_helper.js, which is already imported, you must at least get the file</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+to import and make a new AbImportHelper object with at least the file and type</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+of import.  Call the beginImport method on the object when you are ready to</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+start the import.</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+If you would like the results of the import checked, make sure to update</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+addressbook.json.  This file is read by import_helper.js to compare the address</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+book cards imported to an array of &quot;cards&quot; in in this file. When making a new</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+import, first chose a name for the array (like basic_addressbook) to store the</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+cards that should be in the newly-imported address book.  The properties and</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+values of each object in the array should identical to the properties and values</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+of the newly-imported card(s) and the cards themselves need to be in the</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+expected order.  If a card to be imported does not have a property, do not</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+include it in the JSON card.  Multiple types of imports can be tested with one</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+array, as only the supported attributes are checked.</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+You will also need to give the AbImportHelper constructor two additional</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+parameters: the name the imported address book will have (the filename without</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+the extension) and the name you chose for the JSON object.</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+Here is a sample unit test that doesn't check the results:</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+function run_test()</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+{</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+  var file = do_get_file(&quot;../mailnews/import/test/resources/basic_ldif_addressbook.ldif&quot;);</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+  new AbImportHelper(file, &quot;ldif&quot;).beginImport();</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+}</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+Here is a sample unit test that checks the results:</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+function run_test()</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+{</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+  var file = do_get_file(&quot;../mailnews/import/test/resources/basic_ldif_addressbook.ldif&quot;);</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+  new AbImportHelper(file, &quot;ldif&quot;, &quot;basic_ldif_addressbook&quot;,</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+                     &quot;basic_addressbook&quot;).beginImport();</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/mailnews/import/test/resources/addressbook.json</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,46 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+{</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+  &quot;basic_addressbook&quot; :</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+  [</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+    {</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+      &quot;DisplayName&quot;      : &quot;Display Name&quot;,</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+      &quot;PrimaryEmail&quot;     : &quot;primaryemail@host.invalid&quot;,</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+      &quot;FirstName&quot;        : &quot;First&quot;,</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+      &quot;LastName&quot;         : &quot;Last&quot;,</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+      &quot;NickName&quot;         : &quot;Nickname&quot;,</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+      &quot;SecondEmail&quot;      : &quot;secondemail@host.invalid&quot;,</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+      &quot;_AimScreenName&quot;    : &quot;screenname&quot;,</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+      &quot;PreferMailFormat&quot; : &quot;html&quot;,</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+      &quot;LastModifiedDate&quot; : 1213818826,</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+      &quot;WorkPhone&quot;        : &quot;123-456-7890&quot;,</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+      &quot;HomePhone&quot;        : &quot;234-567-8901&quot;,</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+      &quot;FaxNumber&quot;        : &quot;345-678-9012&quot;,</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+      &quot;PagerNumber&quot;      : &quot;456-789-0123&quot;,</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+      &quot;CellularNumber&quot;   : &quot;567-890-1234&quot;,</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+      &quot;HomeAddress&quot;      : &quot;Home Address Line 1&quot;,</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+      &quot;HomeAddress2&quot;     : &quot;Home Address Line 2&quot;,</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+      &quot;HomeCity&quot;         : &quot;Home City&quot;,</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+      &quot;HomeState&quot;        : &quot;Home State&quot;,</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+      &quot;HomeZipCode&quot;      : &quot;Home Zip&quot;,</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+      &quot;HomeCountry&quot;      : &quot;Home Country&quot;,</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+      &quot;WorkAddress&quot;      : &quot;Work Address Line 1&quot;,</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+      &quot;WorkAddress2&quot;     : &quot;Work Address Line 2&quot;,</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+      &quot;WorkCity&quot;         : &quot;Work City&quot;,</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+      &quot;WorkState&quot;        : &quot;Work State&quot;,</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+      &quot;WorkZipCode&quot;      : &quot;Work Zip&quot;,</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+      &quot;WorkCountry&quot;      : &quot;Work Country&quot;,</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+      &quot;JobTitle&quot;         : &quot;Job Title&quot;,</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+      &quot;Department&quot;       : &quot;Department&quot;,</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+      &quot;Company&quot;          : &quot;Organization Name&quot;,</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+      &quot;WebPage1&quot;         : &quot;http://127.0.0.1&quot;,</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+      &quot;WebPage2&quot;         : &quot;http://localhost&quot;,</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+      &quot;BirthYear&quot;        : &quot;1900&quot;,</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+      &quot;BirthMonth&quot;       : &quot;1&quot;,</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+      &quot;BirthDay&quot;         : &quot;2&quot;,</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+      &quot;Custom1&quot;          : &quot;Custom Field 1&quot;,</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+      &quot;Custom2&quot;          : &quot;Custom Field 2&quot;,</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+      &quot;Custom3&quot;          : &quot;Custom Field 3&quot;,</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+      &quot;Custom4&quot;          : &quot;Custom Field 4&quot;,</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+      &quot;Notes&quot;            : &quot;Notes line 1\nNotes line 2\nNotes line 3\nNotes line 4&quot;</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+    }</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+  ]</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/mailnews/import/test/resources/basic_ldif_addressbook.ldif</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,43 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+dn: cn=Display Name,mail=primaryemail@host.invalid</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+objectclass: top</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+objectclass: person</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+objectclass: organizationalPerson</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+objectclass: inetOrgPerson</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+objectclass: mozillaAbPersonAlpha</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+givenName: First</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+sn: Last</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+cn: Display Name</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+mozillaNickname: Nickname</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+mail: primaryemail@host.invalid</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+mozillaSecondEmail: secondemail@host.invalid</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+nsAIMid: screenname</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+mozillaUseHtmlMail: true</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+modifytimestamp: 1213818826</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+telephoneNumber: 123-456-7890</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+homePhone: 234-567-8901</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+fax: 345-678-9012</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+pager: 456-789-0123</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+mobile: 567-890-1234</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+mozillaHomeStreet: Home Address Line 1</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+mozillaHomeStreet2: Home Address Line 2</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+mozillaHomeLocalityName: Home City</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+mozillaHomeState: Home State</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+mozillaHomePostalCode: Home Zip</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+mozillaHomeCountryName: Home Country</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+street: Work Address Line 1</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+mozillaWorkStreet2: Work Address Line 2</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+l: Work City</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+st: Work State</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+postalCode: Work Zip</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+c: Work Country</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+title: Job Title</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+ou: Department</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+o: Organization Name</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+mozillaWorkUrl: http://127.0.0.1</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+mozillaHomeUrl: http://localhost</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+birthyear: 1900</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+mozillaCustom1: Custom Field 1</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+mozillaCustom2: Custom Field 2</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+mozillaCustom3: Custom Field 3</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+mozillaCustom4: Custom Field 4</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+description:: Tm90ZXMgbGluZSAxCk5vdGVzIGxpbmUgMgpOb3RlcyBsaW5lIDMKTm90ZXMgbGluZSA0</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/import/test/resources/import_helper.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/import/test/resources/import_helper.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,37 +1,278 @@</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineplus">+// used by checkProgress to periodically check the progress of the import</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineplus">+var gAbImportHelper;</span>
<a href="#l4.6"></a><span id="l4.6"> /**</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">- * Returns an import interface based on the name of the module and a string</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">- * to search for.  Throws an error if it cannot find the module.</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+ * AbImportHelper</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+ * A helper for Address Book imports. To use, supply at least the file and type.</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+ * If you would like the results checked, add a new array in the addressbook</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+ * JSON file in the resources folder and supply aAbName and aJsonName.</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+ * See AB_README for more information.</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+ * </span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+ * @param aFile     An instance of nsIAbFile to import.</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+ * @param aType     The type of import.  Should be LDIF, CSV, or TAB.</span>
<a href="#l4.17"></a><span id="l4.17">  *</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">- * @param moduleName The name of the module, such as &quot;addressbook&quot;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">- * @param searchStr  The string to search the module names for, such as &quot;.csv&quot;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">- *                   to find the import module for comma-separated value files</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">- * @return           An nsIImportGeneric import interface.</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+ * Optional parameters: Include if you would like the import checked.</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+ * @param aAbName   The name the address book will have (the filename without</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+ *                  the extension).</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+ * @param aJsonName The name of the array in addressbook.json with the cards</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+ *                  to compare with the imported cards.</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+ * @constructor</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+ * @class</span>
<a href="#l4.29"></a><span id="l4.29">  */</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-function getImportInterface(moduleName, searchStr)</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+function AbImportHelper(aFile, aType, aAbName, aJsonName)</span>
<a href="#l4.32"></a><span id="l4.32"> {</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-  do_check_true(moduleName &amp;&amp; moduleName.length &gt; 0);</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-  do_check_true(searchStr &amp;&amp; searchStr.length &gt; 0);</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+  helper = null;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+  this.mFile = aFile; // checked in the beginImport method</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+  this.mAbName = aAbName;</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+  /* Attribute notes:  The attributes listed in the declaration below are</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+   * supported by all three text export/import types.  AimScreenName &amp;</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+   * PreferMailFormat are only supported by LDIF, and BirthMonth and BirthDay</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+   * are only supported by CSV and tab-delimited exports/imports.</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+   * The following are not supported: anniversaryYear, anniversaryMonth,</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+   * anniversaryDay, popularityIndex, isMailList, mailListURI, lastModifiedDate,</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+   * and allowRemoteContent</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+   */</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+  var supportedAttributes =</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+    [&quot;FirstName&quot;, &quot;LastName&quot;, &quot;DisplayName&quot;, &quot;NickName&quot;, &quot;PrimaryEmail&quot;,</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+     &quot;SecondEmail&quot;, &quot;WorkPhone&quot;, &quot;HomePhone&quot;, &quot;FaxNumber&quot;, &quot;PagerNumber&quot;,</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+     &quot;CellularNumber&quot;, &quot;HomeAddress&quot;, &quot;HomeAddress2&quot;, &quot;HomeCity&quot;, &quot;HomeState&quot;,</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+     &quot;HomeZipCode&quot;, &quot;HomeCountry&quot;, &quot;WorkAddress&quot;, &quot;WorkAddress2&quot;, &quot;WorkCity&quot;,</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+     &quot;WorkState&quot;, &quot;WorkZipCode&quot;, &quot;WorkCountry&quot;, &quot;JobTitle&quot;, &quot;Department&quot;,</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+     &quot;Company&quot;, &quot;BirthYear&quot;, &quot;WebPage1&quot;, &quot;WebPage2&quot;, &quot;Custom1&quot;, &quot;Custom2&quot;,</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+     &quot;Custom3&quot;, &quot;Custom4&quot;, &quot;Notes&quot;];</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+  // get the extra attributes supported for the given type of import</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+  if (aType == &quot;LDIF&quot;)</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+  {</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+    // LDIF: add AimScreenName and PreferMailFormat</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+    this.mSupportedAttributes = supportedAttributes.concat([&quot;_AimScreenName&quot;,</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+                                                            &quot;PreferMailFormat&quot;]);</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineplus">+    this.mLdif = true;</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineplus">+  }</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+  else if (aType == &quot;CSV&quot; || aType == &quot;TAB&quot;)</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+  {</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+    // CSV or TAB: add BirthMonth and BirthDay</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+    this.mSupportedAttributes = supportedAttributes.concat([&quot;BirthMonth&quot;,</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+                                                            &quot;BirthDay&quot;]);</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineplus">+    this.mLdif = false;</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+  }</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+  else</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+    do_throw(&quot;Unexpected type passed to the AbImportHelper constructor&quot;);</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+  // get the &quot;cards&quot; from the JSON file, if necessary</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+  if (aJsonName)</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineplus">+    this.mJsonCards = this.getJsonCards(aJsonName);</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineplus">+}</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineplus">+AbImportHelper.prototype =</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+{</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineplus">+  /**</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+   * AbImportHelper.beginImport</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+   * Imports the given address book export and checks the imported address book</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+   * with the array in addressbook.json if aAbName and aJsonName were supplied</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+   * to the constructor.</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+   */</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+  beginImport: function()</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineplus">+  {</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineplus">+    do_check_true(this.mFile instanceof Ci.nsIFile &amp;&amp; this.mFile.exists() &amp;&amp;</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineplus">+                  this.mFile.isFile());</span>
<a href="#l4.88"></a><span id="l4.88"> </span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-  var importService = Cc[&quot;@mozilla.org/import/import-service;1&quot;]</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-                        .getService(Ci.nsIImportService);</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-  var module;</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-  var count = importService.GetModuleCount(moduleName);</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineplus">+    // get the import interface used for all text imports</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineplus">+    this.mAbInterface = this.getInterface(&quot;addressbook&quot;, &quot;.csv&quot;);</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineplus">+    this.mAbInterface.SetData(&quot;addressLocation&quot;, this.mFile);</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineplus">+    // skip setting the field map if this is an LDIF import</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineplus">+    if (!this.mLdif)</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineplus">+      this.mAbInterface.SetData(&quot;fieldMap&quot;, this.getDefaultFieldMap(true));</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineplus">+</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineplus">+    do_check_true(this.mAbInterface.WantsProgress());</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+    do_check_true(this.mAbInterface.BeginImport(null, null, false));</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+    do_test_pending();</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineplus">+    this.checkProgress();</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineplus">+  },</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineplus">+  /**</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineplus">+   * AbImportHelper.getInterface</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+   * Returns an import interface based on the name of the module and a string</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+   * to search for.</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+   *</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+   * @param aModuleName The name of the module, such as &quot;addressbook&quot;.</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineplus">+   * @param aSearchStr  The string to search the module names for, such as</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineplus">+   *                    &quot;.csv&quot; to find the import module for comma-separated</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+   *                    value, LDIF, and tab-delimited files.</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineplus">+   * @return An nsIImportGeneric import interface.</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineplus">+   */</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineplus">+  getInterface: function(aModuleName, aSearchStr)</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineplus">+  {</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineplus">+    do_check_true(aModuleName &amp;&amp; aModuleName.length &gt; 0);</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineplus">+    do_check_true(aSearchStr &amp;&amp; aSearchStr.length &gt; 0);</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineplus">+    var importService = Cc[&quot;@mozilla.org/import/import-service;1&quot;]</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineplus">+                         .getService(Ci.nsIImportService);</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineplus">+    var module;</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineplus">+    var count = importService.GetModuleCount(aModuleName);</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineplus">+</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineplus">+    // Iterate through each import module until the one being searched for is</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+    // found and then return the ImportInterface of that module</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineplus">+    for (var i = 0; i &lt; count; i++)</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineplus">+      // Check if the current module fits the search string gets the interface</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+      if (importService.GetModuleName(aModuleName, i).indexOf(aSearchStr) != -1)</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineplus">+        return importService.GetModule(aModuleName, i)</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineplus">+                            .GetImportInterface(aModuleName)</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineplus">+                            .QueryInterface(Ci.nsIImportGeneric);</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineplus">+    return null; // it wasn't found</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineplus">+  },</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+  /**</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineplus">+   * AbImportHelper.getDefaultFieldMap</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineplus">+   * Returns the default field map.</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineplus">+   *</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineplus">+   * @param aSkipFirstRecord True if the first record of the text file should</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineplus">+   *                         be skipped.</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineplus">+   * @return A default field map.</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineplus">+   */</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineplus">+  getDefaultFieldMap: function(aSkipFirstRecord)</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineplus">+  {</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineplus">+    var importService = Cc[&quot;@mozilla.org/import/import-service;1&quot;]</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineplus">+                         .getService(Ci.nsIImportService);</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineplus">+    var fieldMap = importService.CreateNewFieldMap();</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineplus">+</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineplus">+    fieldMap.DefaultFieldMap(fieldMap.numMozFields);</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineplus">+    fieldMap.skipFirstRecord = aSkipFirstRecord;</span>
<a href="#l4.152"></a><span id="l4.152"> </span>
<a href="#l4.153"></a><span id="l4.153" class="difflineminus">-  // Iterate through each import module until the one being searched for is found</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineminus">-  for (var i = 0; i &lt; count; i++)</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineplus">+    return fieldMap;</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineplus">+  },</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineplus">+  /**</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineplus">+   * AbImportHelper.checkProgress</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineplus">+   * Checks the progress of an import every 200 milliseconds until it is</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineplus">+   * complete.  Checks the test results if there is an original address book,</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineplus">+   * otherwise evaluates the optional command, or calls do_test_finished().</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineplus">+   */</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineplus">+  checkProgress: function()</span>
<a href="#l4.164"></a><span id="l4.164">   {</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-    // Check if the current module fits the search string gets the interface</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineminus">-    if (importService.GetModuleName(moduleName, i).indexOf(searchStr) != -1)</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineplus">+    do_check_true(this.mAbInterface &amp;&amp; </span>
<a href="#l4.168"></a><span id="l4.168" class="difflineplus">+                  this.mAbInterface instanceof Ci.nsIImportGeneric);</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineplus">+    do_check_true(this.mAbInterface.ContinueImport());</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineplus">+    // if the import isn't done, check again in 200 milliseconds.</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineplus">+    if (this.mAbInterface.GetProgress() != 100) {</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineplus">+      // use the helper object to check the progress of the import after 200 ms</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineplus">+      gAbImportHelper = this;</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineplus">+      do_timeout(200, &quot;gAbImportHelper.checkProgress();&quot;);</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineplus">+    }</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineplus">+    // if it is done, check the results or finish the test.</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineplus">+    else</span>
<a href="#l4.178"></a><span id="l4.178">     {</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineminus">-      module = importService.GetModule(moduleName, i);</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineminus">-      break;</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineplus">+      if (this.mAbName)</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineplus">+        this.checkResults(this.mAbName);</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineplus">+      else</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineplus">+        do_test_finished();</span>
<a href="#l4.185"></a><span id="l4.185">     }</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineminus">-  }</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineplus">+  },</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineplus">+  /**</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineplus">+   * AbImportHelper.checkResults</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineplus">+   * Checks the results of the import.</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineplus">+   * Ensures the an address book was created, then compares the supported</span>
<a href="#l4.192"></a><span id="l4.192" class="difflineplus">+   * attributes of each card with the card(s) in the JSON array.</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineplus">+   * Calls do_test_finished() when done</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineplus">+   */</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineplus">+  checkResults: function()</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineplus">+  {</span>
<a href="#l4.197"></a><span id="l4.197" class="difflineplus">+    if (!this.mJsonCards)</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineplus">+      do_throw(&quot;The address book must be setup before checking results&quot;);</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineplus">+    // When do_test_pending() was called and there is an error the test hangs.</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineplus">+    // This try/catch block will catch any errors and call do_throw() with the</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineplus">+    // error to throw the error and avoid the hang.</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineplus">+    try</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineplus">+    {</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineplus">+      // make sure an address book was created</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineplus">+      var newAb = this.getAbByName(this.mAbName);</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineplus">+      do_check_neq(newAb, null);</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineplus">+      do_check_true(newAb instanceof Ci.nsIAbDirectory &amp;&amp;</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineplus">+                    newAb.childCards instanceof Ci.nsISimpleEnumerator);</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineplus">+      // get the imported card(s) and check each one</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineplus">+      var iter = newAb.childCards;</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineplus">+      var count = 0;</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineplus">+      for (; iter.hasMoreElements(); count++) {</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineplus">+        var importedCard = iter.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineplus">+        this.compareCards(this.mJsonCards[count], importedCard);</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineplus">+      }</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineplus">+      // make sure there are the same number of cards in the address book and</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineplus">+      // the JSON array</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineplus">+      do_check_eq(count, this.mJsonCards.length);</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineplus">+      do_test_finished();</span>
<a href="#l4.220"></a><span id="l4.220" class="difflineplus">+    } catch(e) { do_throw(e); }</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineplus">+  },</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineplus">+  /**</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineplus">+   * AbImportHelper.getAbByName</span>
<a href="#l4.224"></a><span id="l4.224" class="difflineplus">+   * Returns the Address Book (if any) with the given name.</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineplus">+   *</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineplus">+   * @param aName The name of the Address Book to find.</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineplus">+   * @return An nsIAbDirectory, if found.</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineplus">+   *         null if the requested Address Book could not be found.</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineplus">+   */</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineplus">+  getAbByName: function(aName)</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineplus">+  {</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineplus">+    do_check_true(aName &amp;&amp; aName.length &gt; 0);</span>
<a href="#l4.233"></a><span id="l4.233"> </span>
<a href="#l4.234"></a><span id="l4.234" class="difflineminus">-  // Make sure the module was found.  If not, return false</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineminus">-  if (!module)</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineplus">+    var iter = Cc[&quot;@mozilla.org/abmanager;1&quot;].getService(Ci.nsIAbManager)</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineplus">+                                             .directories;</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineplus">+    var data = null;</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineplus">+    while (iter.hasMoreElements())</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineplus">+    {</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineplus">+      data = iter.getNext();</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineplus">+      if (data instanceof Ci.nsIAbDirectory)</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineplus">+        if (data.dirName == aName)</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineplus">+          return data;</span>
<a href="#l4.245"></a><span id="l4.245" class="difflineplus">+    }</span>
<a href="#l4.246"></a><span id="l4.246">     return null;</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineplus">+  },</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineplus">+  /**</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineplus">+   * AbImportHelper.compareCards</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineplus">+   * Compares a JSON &quot;card&quot; with an imported card and throws an error if the</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineplus">+   * values of a supported attribute are different.</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineplus">+   *</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineplus">+   * @param aJsonCard The object decoded from addressbook.json.</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineplus">+   * @param aCard     The imported card to compare with.</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineplus">+   */</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineplus">+  compareCards: function(aJsonCard, aCard)</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineplus">+  {</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineplus">+    for (var i in aJsonCard)</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineplus">+      if (this.mSupportedAttributes.indexOf(i) &gt;= 0)</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineplus">+          do_check_eq(aJsonCard[i], aCard.getCardValue(i));</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineplus">+  },</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineplus">+  /**</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineplus">+   * AbImportHelper.getJsonCards</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineplus">+   * Gets an array of &quot;cards&quot; from the JSON file addressbook.json located in the</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineplus">+   * mailnews/import/test/resources folder.  The array should contain objects</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineplus">+   * with the expected properties and values of the cards in the imported</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineplus">+   * address book.</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineplus">+   * See addressbook.json for an example and AB_README for more details.</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineplus">+   *</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineplus">+   * @param aName The name of the array in addressbook.json.</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineplus">+   * @return An array of &quot;cards&quot;.</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineplus">+   */</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineplus">+  getJsonCards: function(aName)</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineplus">+  {</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineplus">+    if (!aName)</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineplus">+      do_throw(&quot;Error - getJSONAb requires an address book name&quot;);</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineplus">+    var file = do_get_file(&quot;../mailnews/import/test/resources/addressbook.json&quot;);</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineplus">+    if (!file || !file.exists() || !file.isFile())</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineplus">+      do_throw(&quot;Unable to get JSON file&quot;);</span>
<a href="#l4.280"></a><span id="l4.280"> </span>
<a href="#l4.281"></a><span id="l4.281" class="difflineminus">-  return module.GetImportInterface(moduleName)</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineminus">-               .QueryInterface(Ci.nsIImportGeneric);</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineplus">+    var fis = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineplus">+               .createInstance(Ci.nsIFileInputStream);</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineplus">+    fis.init(file, 0x01, 0444, 0);</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineplus">+    var istream = Cc[&quot;@mozilla.org/intl/converter-input-stream;1&quot;]</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineplus">+                   .createInstance(Ci.nsIConverterInputStream);</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineplus">+    var replacementChar = Ci.nsIConverterInputStream</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineplus">+                            .DEFAULT_REPLACEMENT_CHARACTER;</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineplus">+    istream.init(fis, &quot;UTF-8&quot;, 1024, replacementChar);</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineplus">+    var json = &quot;&quot;;</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineplus">+    var str = {};</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineplus">+    // get the entire file into the json string</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineplus">+    while(istream.readString(4096, str) != 0)</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineplus">+      json += str.value;</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineplus">+    // close the input streams</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineplus">+    istream.close();</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineplus">+    fis.close();</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineplus">+    // decode the JSON and get the array of cards</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineplus">+    var nsIJSON = Cc[&quot;@mozilla.org/dom/json;1&quot;].createInstance(Ci.nsIJSON);  </span>
<a href="#l4.301"></a><span id="l4.301" class="difflineplus">+    var arr = nsIJSON.decode(json)[aName];</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineplus">+    do_check_true(arr &amp;&amp; arr.length &gt; 0);</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineplus">+    return arr;</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineplus">+  }</span>
<a href="#l4.305"></a><span id="l4.305"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/import/test/unit/test_bug_437556.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_bug_437556.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,19 +1,21 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /**</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">- * Test for a regression of bug 437556: mailnews crashes while importing an </span>
<a href="#l5.6"></a><span id="l5.6" class="difflineminus">- * address book if a field map is required but not set</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+ * Test for a regression of Bug 437556: mailnews crashes while importing an </span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+ * address book if a field map is required but not set.</span>
<a href="#l5.9"></a><span id="l5.9">  */</span>
<a href="#l5.10"></a><span id="l5.10"> function run_test()</span>
<a href="#l5.11"></a><span id="l5.11"> {</span>
<a href="#l5.12"></a><span id="l5.12">   var file = do_get_file(&quot;../mailnews/import/test/resources/basic_addressbook.csv&quot;);</span>
<a href="#l5.13"></a><span id="l5.13">   var errorStr = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-                     .createInstance(Ci.nsISupportsString);</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-  // get the text Address Book import interface and make sure it succeeded</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-  var abInterface = getImportInterface(&quot;addressbook&quot;, &quot;.csv&quot;);</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+                  .createInstance(Ci.nsISupportsString);</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+  // get the Address Book text import interface and make sure it succeeded</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+  var helper = new AbImportHelper(file, &quot;CSV&quot;);</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+  var abInterface = helper.getInterface(&quot;addressbook&quot;, &quot;.csv&quot;);</span>
<a href="#l5.21"></a><span id="l5.21">   do_check_neq(abInterface, null);</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+  // prepare to start the import</span>
<a href="#l5.23"></a><span id="l5.23">   abInterface.SetData(&quot;addressLocation&quot;, file);</span>
<a href="#l5.24"></a><span id="l5.24">   do_check_true(abInterface.WantsProgress());</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+  // start the import</span>
<a href="#l5.27"></a><span id="l5.27">   // BeginImport should return false and log an error if the fieldMap isn't set</span>
<a href="#l5.28"></a><span id="l5.28">   do_check_false(abInterface.BeginImport(null, errorStr, false));</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-  do_check_neq(errorStr, null);</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+  do_check_neq(errorStr, &quot;&quot;);</span>
<a href="#l5.31"></a><span id="l5.31"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/mailnews/import/test/unit/test_ldif_import.js</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,16 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+/**</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+ * Tests importing an address book export in the LDAP data interchange (LDIF)</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+ * format and checks the accuracy of the imported address book's cards.</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+ * The current export contains only one card with most fields full.</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+ *</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+ * This test also checks for the following bugs:</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+ *   -Bug 439819: LDIF import does not include mozillahomestreet.</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+ *   -Bug 182128: Edit Card, Notes on several lines appear on one after</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+ *                export/import in text format *(only tests the import).</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+ */</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+function run_test()</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+{</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+  var file = do_get_file(&quot;../mailnews/import/test/resources/basic_ldif_addressbook.ldif&quot;);</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+  new AbImportHelper(file, &quot;LDIF&quot;, &quot;basic_ldif_addressbook&quot;,</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+                     &quot;basic_addressbook&quot;).beginImport();</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+}</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

