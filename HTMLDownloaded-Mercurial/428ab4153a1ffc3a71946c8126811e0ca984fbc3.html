<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 348:428ab4153a1ffc3a71946c8126811e0ca984fbc3</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 428ab4153a1ffc3a71946c8126811e0ca984fbc3" />
<meta property="og:url" content="/comm-central/rev/428ab4153a1ffc3a71946c8126811e0ca984fbc3" />
<meta property="og:description" content="add birthday field to abook ui, patch by pi, r=standard8, sr=bienvenu, 13595" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 428ab4153a1ffc3a71946c8126811e0ca984fbc3 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/428ab4153a1ffc3a71946c8126811e0ca984fbc3">shortlog</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/428ab4153a1ffc3a71946c8126811e0ca984fbc3">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3">files</a> |
changeset |
<a href="/comm-central/raw-rev/428ab4153a1ffc3a71946c8126811e0ca984fbc3">raw</a>  | <a href="/comm-central/archive/428ab4153a1ffc3a71946c8126811e0ca984fbc3.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
add birthday field to abook ui, patch by pi, r=standard8, sr=bienvenu, 13595
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#97;&#118;&#105;&#100;&#32;&#66;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#32;&#60;&#98;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#64;&#110;&#118;&#101;&#110;&#116;&#117;&#114;&#101;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 16 Sep 2008 18:29:56 -0700</td></tr>

<tr>
 <td>changeset 348</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/428ab4153a1ffc3a71946c8126811e0ca984fbc3">428ab4153a1ffc3a71946c8126811e0ca984fbc3</a></td>
</tr>



<tr>
<td>parent 347</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/cb70018a34dc44107a5c212e7e8ac31713f0e231">cb70018a34dc44107a5c212e7e8ac31713f0e231</a>
</td>
</tr>

<tr>
<td>child 349</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5ad568b3a57beb8e190f0dbc9b0ab31a1fe1cb69">5ad568b3a57beb8e190f0dbc9b0ab31a1fe1cb69</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=428ab4153a1ffc3a71946c8126811e0ca984fbc3">316</a></td></tr>
<tr><td>push user</td><td>bienvenu@nventure.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 17 Sep 2008 01:30:09 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@428ab4153a1f [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=428ab4153a1ffc3a71946c8126811e0ca984fbc3">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=428ab4153a1ffc3a71946c8126811e0ca984fbc3&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=428ab4153a1ffc3a71946c8126811e0ca984fbc3&newProject=comm-central&newRevision=428ab4153a1ffc3a71946c8126811e0ca984fbc3&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=428ab4153a1ffc3a71946c8126811e0ca984fbc3&newProject=comm-central&newRevision=428ab4153a1ffc3a71946c8126811e0ca984fbc3&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=428ab4153a1ffc3a71946c8126811e0ca984fbc3&newProject=comm-central&newRevision=428ab4153a1ffc3a71946c8126811e0ca984fbc3&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28standard8%29&revcount=50">standard8</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a>, <a href="/comm-central/log?rev=reviewer%2813595%29&revcount=50">13595</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=13595">13595</a></td></tr>




</table></div>

<div class="page_body description">add birthday field to abook ui, patch by pi, r=standard8, sr=bienvenu, 13595</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardOverlay.js">mail/components/addrbook/content/abCardOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardOverlay.js">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardOverlay.js">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardOverlay.js">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardOverlay.js">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardViewOverlay.js">mail/components/addrbook/content/abCardViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardViewOverlay.js">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardViewOverlay.js">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/abCardViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/addressbook.xul">mail/components/addrbook/content/addressbook.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/addressbook.xul">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/addressbook.xul">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/addressbook.xul">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/addressbook.xul">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/components/addrbook/content/addressbook.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/abCardOverlay.dtd">mail/locales/en-US/chrome/messenger/addressbook/abCardOverlay.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/abCardOverlay.dtd">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/abCardOverlay.dtd">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/abCardOverlay.dtd">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/abCardOverlay.dtd">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/abCardOverlay.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.js">mailnews/addrbook/resources/content/abCardOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.js">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.js">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.js">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.js">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.xul">mailnews/addrbook/resources/content/abCardOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.xul">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.xul">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.xul">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.xul">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.js">mailnews/addrbook/resources/content/abCardViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.js">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.js">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.xul">mailnews/addrbook/resources/content/abCardViewOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.xul">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.xul">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.xul">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.xul">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/resources/content/abCardViewOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/src/nsAbLDIFService.cpp">mailnews/addrbook/src/nsAbLDIFService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/src/nsAbLDIFService.cpp">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/src/nsAbLDIFService.cpp">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/src/nsAbLDIFService.cpp">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/src/nsAbLDIFService.cpp">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/mailnews/addrbook/src/nsAbLDIFService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">file</a> |
<a href="/comm-central/annotate/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">annotate</a> |
<a href="/comm-central/diff/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">diff</a> |
<a href="/comm-central/comparison/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">comparison</a> |
<a href="/comm-central/log/428ab4153a1ffc3a71946c8126811e0ca984fbc3/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/addrbook/content/abCardOverlay.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCardOverlay.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -83,16 +83,17 @@ const kVcardFields =</span>
<a href="#l1.4"></a><span id="l1.4">           // Other &gt; (custom)</span>
<a href="#l1.5"></a><span id="l1.5">          [&quot;Custom1&quot;, &quot;Custom1&quot;],</span>
<a href="#l1.6"></a><span id="l1.6">          [&quot;Custom2&quot;, &quot;Custom2&quot;],</span>
<a href="#l1.7"></a><span id="l1.7">          [&quot;Custom3&quot;, &quot;Custom3&quot;],</span>
<a href="#l1.8"></a><span id="l1.8">          [&quot;Custom4&quot;, &quot;Custom4&quot;],</span>
<a href="#l1.9"></a><span id="l1.9">           // Other &gt; Notes</span>
<a href="#l1.10"></a><span id="l1.10">          [&quot;Notes&quot;, &quot;Notes&quot;]];</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+const kDefaultYear = 2000;</span>
<a href="#l1.13"></a><span id="l1.13"> var gEditCard;</span>
<a href="#l1.14"></a><span id="l1.14"> var gOnSaveListeners = new Array();</span>
<a href="#l1.15"></a><span id="l1.15"> var gOkCallback = null;</span>
<a href="#l1.16"></a><span id="l1.16"> var gHideABPicker = false;</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> function OnLoadNewCard()</span>
<a href="#l1.19"></a><span id="l1.19"> {</span>
<a href="#l1.20"></a><span id="l1.20">   InitEditCard();</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -276,16 +277,21 @@ function OnLoadEditCard()</span>
<a href="#l1.22"></a><span id="l1.22">       var directory = GetDirectoryFromURI(abURI);</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24">       if (!(directory.operations &amp; directory.opWrite)) </span>
<a href="#l1.25"></a><span id="l1.25">       {</span>
<a href="#l1.26"></a><span id="l1.26">         // Set all the editable vcard fields to read only</span>
<a href="#l1.27"></a><span id="l1.27">         for (var i = kVcardFields.length; i-- &gt; 0; )</span>
<a href="#l1.28"></a><span id="l1.28">           document.getElementById(kVcardFields[i][0]).readOnly = true;</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+        // the birthday fields</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+        document.getElementById(&quot;Birthday&quot;).readOnly = true;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+        document.getElementById(&quot;BirthYear&quot;).readOnly = true;</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+        document.getElementById(&quot;Age&quot;).readOnly = true;</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+</span>
<a href="#l1.35"></a><span id="l1.35">         // And the phonetic fields</span>
<a href="#l1.36"></a><span id="l1.36">         document.getElementById(kPhoneticFields[0]).readOnly = true;</span>
<a href="#l1.37"></a><span id="l1.37">         document.getElementById(kPhoneticFields[3]).readOnly = true;</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">         // Also disable the mail format popup and allow remote content items.</span>
<a href="#l1.40"></a><span id="l1.40">         document.getElementById(&quot;PreferMailFormatPopup&quot;).disabled = true;</span>
<a href="#l1.41"></a><span id="l1.41">         document.getElementById(&quot;allowRemoteContent&quot;).disabled = true;</span>
<a href="#l1.42"></a><span id="l1.42"> </span>
<a href="#l1.43"></a><span id="l1.43" class="difflineat">@@ -410,16 +416,51 @@ function GetCardValues(cardproperty, doc</span>
<a href="#l1.44"></a><span id="l1.44">   if (!cardproperty)</span>
<a href="#l1.45"></a><span id="l1.45">     return;</span>
<a href="#l1.46"></a><span id="l1.46"> </span>
<a href="#l1.47"></a><span id="l1.47">   for (var i = kVcardFields.length; i-- &gt; 0; ) {</span>
<a href="#l1.48"></a><span id="l1.48">     doc.getElementById(kVcardFields[i][0]).value =</span>
<a href="#l1.49"></a><span id="l1.49">       cardproperty.getProperty(kVcardFields[i][1], &quot;&quot;);</span>
<a href="#l1.50"></a><span id="l1.50">   }</span>
<a href="#l1.51"></a><span id="l1.51"> </span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+  var birthday = doc.getElementById(&quot;Birthday&quot;);</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+  modifyDatepicker(birthday);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+  // get the month of the year (1 - 12)</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+  var month = cardproperty.getProperty(&quot;BirthMonth&quot;, null);</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+  // set the datepicker's month and prepend a zero if necessary</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+  if (month) {</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+    birthday.month = parseInt(month) - 1;</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+    if (month.length &lt; 2)</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+      month = &quot;0&quot; + month;</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+  }</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+  birthday.monthField.value = month;</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+  // get the date of the month (1 - 31)</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+  var date = cardproperty.getProperty(&quot;BirthDay&quot;, null);</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+  birthday.dateField.value = date;</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+  // get the year</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+  var year = cardproperty.getProperty(&quot;BirthYear&quot;, null);</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+  var birthYear = doc.getElementById(&quot;BirthYear&quot;);</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+  // set the year in the datepicker to the stored year</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+  // if the year isn't present, default to 2000 (a leap year)</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+  birthday.year = year ? year : kDefaultYear;</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+  birthYear.value = year;</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+  // get the current age</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+  calculateAge(null, birthYear);</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+  // when the birth year changes, update the datepicker's year to the new value</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+  // or to kDefaultYear if the value is null</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+  birthYear.onchange = calculateAge;</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+  birthday.onchange = calculateAge;</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+  var age = doc.getElementById(&quot;Age&quot;);</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+  age.onchange = calculateYear;</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+</span>
<a href="#l1.87"></a><span id="l1.87">   var popup = document.getElementById(&quot;PreferMailFormatPopup&quot;);</span>
<a href="#l1.88"></a><span id="l1.88">   if (popup)</span>
<a href="#l1.89"></a><span id="l1.89">     popup.value = cardproperty.getProperty(&quot;PreferMailFormat&quot;, &quot;&quot;);</span>
<a href="#l1.90"></a><span id="l1.90">     </span>
<a href="#l1.91"></a><span id="l1.91">   var allowRemoteContentEl = document.getElementById(&quot;allowRemoteContent&quot;);</span>
<a href="#l1.92"></a><span id="l1.92">   if (allowRemoteContentEl)</span>
<a href="#l1.93"></a><span id="l1.93">     allowRemoteContentEl.checked = cardproperty.getProperty(&quot;AllowRemoteContent&quot;, false);</span>
<a href="#l1.94"></a><span id="l1.94"> </span>
<a href="#l1.95"></a><span id="l1.95" class="difflineat">@@ -451,16 +492,36 @@ function CheckAndSetCardValues(cardprope</span>
<a href="#l1.96"></a><span id="l1.96"> </span>
<a href="#l1.97"></a><span id="l1.97">   if (!cardproperty)</span>
<a href="#l1.98"></a><span id="l1.98">     return true;</span>
<a href="#l1.99"></a><span id="l1.99"> </span>
<a href="#l1.100"></a><span id="l1.100">   for (var i = kVcardFields.length; i-- &gt; 0; )</span>
<a href="#l1.101"></a><span id="l1.101">     cardproperty.setProperty(kVcardFields[i][1],</span>
<a href="#l1.102"></a><span id="l1.102">       doc.getElementById(kVcardFields[i][0]).value);</span>
<a href="#l1.103"></a><span id="l1.103"> </span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+  // get the birthday information from the dialog</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+  var birthdayElem = doc.getElementById(&quot;Birthday&quot;);</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineplus">+  var birthMonth = birthdayElem.monthField.value;</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+  var birthDay = birthdayElem.dateField.value;</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+  var birthYear = doc.getElementById(&quot;BirthYear&quot;).value;</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineplus">+</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineplus">+  // set or delete the birth day, month, and year properties, if necessary</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineplus">+  if (birthDay)</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineplus">+    cardproperty.setProperty(&quot;BirthDay&quot;, birthDay);</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+  else if(cardproperty.getProperty(&quot;BirthDay&quot;, null))</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineplus">+    cardproperty.deleteProperty(&quot;BirthDay&quot;);</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineplus">+  if (birthMonth)</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineplus">+    cardproperty.setProperty(&quot;BirthMonth&quot;, birthMonth);</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+  else if(cardproperty.getProperty(&quot;BirthMonth&quot;, null))</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+    cardproperty.deleteProperty(&quot;BirthMonth&quot;);</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+  if (birthYear)</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+    cardproperty.setProperty(&quot;BirthYear&quot;, birthYear);</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineplus">+  else if(cardproperty.getProperty(&quot;BirthYear&quot;, null))</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+    cardproperty.deleteProperty(&quot;BirthYear&quot;);</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineplus">+</span>
<a href="#l1.124"></a><span id="l1.124">   var popup = document.getElementById(&quot;PreferMailFormatPopup&quot;);</span>
<a href="#l1.125"></a><span id="l1.125">   if (popup)</span>
<a href="#l1.126"></a><span id="l1.126">     cardproperty.setProperty(&quot;PreferMailFormat&quot;, popup.value);</span>
<a href="#l1.127"></a><span id="l1.127">     </span>
<a href="#l1.128"></a><span id="l1.128">   var allowRemoteContentEl = document.getElementById(&quot;allowRemoteContent&quot;);</span>
<a href="#l1.129"></a><span id="l1.129">   if (allowRemoteContentEl)</span>
<a href="#l1.130"></a><span id="l1.130">     cardproperty.setProperty(&quot;AllowRemoteContent&quot;, allowRemoteContentEl.checked);</span>
<a href="#l1.131"></a><span id="l1.131">     </span>
<a href="#l1.132"></a><span id="l1.132" class="difflineat">@@ -570,8 +631,201 @@ function DisplayNameChanged()</span>
<a href="#l1.133"></a><span id="l1.133"> }</span>
<a href="#l1.134"></a><span id="l1.134"> </span>
<a href="#l1.135"></a><span id="l1.135"> function SetCardDialogTitle(displayName)</span>
<a href="#l1.136"></a><span id="l1.136"> {</span>
<a href="#l1.137"></a><span id="l1.137">   document.title = displayName</span>
<a href="#l1.138"></a><span id="l1.138">     ? gAddressBookBundle.getFormattedString(gEditCard.titleProperty + &quot;WithDisplayName&quot;, [displayName])</span>
<a href="#l1.139"></a><span id="l1.139">     : gAddressBookBundle.getString(gEditCard.titleProperty);</span>
<a href="#l1.140"></a><span id="l1.140"> }</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineplus">+</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineplus">+/**</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineplus">+ * Calculates the duration of time between an event and now and updates the year</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineplus">+ * of whichever element did not call this function.</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineplus">+ * @param aEvent   The event calling this method.</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineplus">+ * @param aElement Optional, but required if this function is not called from an</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineplus">+ *                 element's event listener. The element that would call this.</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineplus">+ */</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineplus">+function calculateAge(aEvent, aElement) {</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineplus">+  var datepicker, yearElem, ageElem;</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineplus">+  if (aEvent)</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineplus">+    aElement = this;</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineplus">+  if (aElement.id == &quot;BirthYear&quot; || aElement.id == &quot;Birthday&quot;) {</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineplus">+    datepicker = document.getElementById(&quot;Birthday&quot;);</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineplus">+    yearElem = document.getElementById(&quot;BirthYear&quot;);</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineplus">+    ageElem = document.getElementById(&quot;Age&quot;);</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineplus">+  }</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineplus">+  if (!datepicker || !yearElem || !ageElem)</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineplus">+    return;</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineplus">+</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineplus">+  // if the datepicker was updated, update the year element</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineplus">+  if (aElement == datepicker &amp;&amp; !(datepicker.year == kDefaultYear &amp;&amp; !yearElem.value))</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineplus">+    yearElem.value = datepicker.year;</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineplus">+  var year = yearElem.value;</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineplus">+  // if the year element's value is invalid set the year and age elements to null</span>
<a href="#l1.166"></a><span id="l1.166" class="difflineplus">+  if (isNaN(year) || year &lt; 1 || year &gt; 9999) {</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineplus">+    yearElem.value = null;</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineplus">+    ageElem.value = null;</span>
<a href="#l1.169"></a><span id="l1.169" class="difflineplus">+    datepicker.year = kDefaultYear;</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineplus">+    return;</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineplus">+  }</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineplus">+  else if (aElement == yearElem)</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineplus">+    datepicker.year = year;</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineplus">+  // calculate the length of time between the event and now</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineplus">+  try {</span>
<a href="#l1.176"></a><span id="l1.176" class="difflineplus">+    var event = new Date(datepicker.year, datepicker.month, datepicker.date);</span>
<a href="#l1.177"></a><span id="l1.177" class="difflineplus">+    // if the year is only 2 digits, then the year won't be set correctly</span>
<a href="#l1.178"></a><span id="l1.178" class="difflineplus">+    // using setFullYear fixes this issue</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineplus">+    event.setFullYear(datepicker.year);</span>
<a href="#l1.180"></a><span id="l1.180" class="difflineplus">+    // get the difference between today and the event</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineplus">+    var age = new Date(new Date() - event);</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineplus">+    // get the number of years of the difference and subtract 1970 (epoch)</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineplus">+    ageElem.value = age.getFullYear() - 1970;</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineplus">+  }</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineplus">+  catch(e) {</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineplus">+    datepicker.year = kDefaultYear;</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineplus">+    // if there was an error (like invalid year) set the year and age to null</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineplus">+    yearElem.value = null;</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineplus">+    ageElem.value = null;</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineplus">+  }</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineplus">+}</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineplus">+</span>
<a href="#l1.193"></a><span id="l1.193" class="difflineplus">+/**</span>
<a href="#l1.194"></a><span id="l1.194" class="difflineplus">+ * Calculates the year an event ocurred based on the number of years, months,</span>
<a href="#l1.195"></a><span id="l1.195" class="difflineplus">+ * and days since the event and updates the relevant element.</span>
<a href="#l1.196"></a><span id="l1.196" class="difflineplus">+ * @param aEvent   The event calling this method.</span>
<a href="#l1.197"></a><span id="l1.197" class="difflineplus">+ * @param aElement Optional, but required if this function is not called from an</span>
<a href="#l1.198"></a><span id="l1.198" class="difflineplus">+ *                 element's event listener. The element that would call this.</span>
<a href="#l1.199"></a><span id="l1.199" class="difflineplus">+ */</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineplus">+function calculateYear(aEvent, aElement) {</span>
<a href="#l1.201"></a><span id="l1.201" class="difflineplus">+  var yearElem, datepicker;</span>
<a href="#l1.202"></a><span id="l1.202" class="difflineplus">+  if (aEvent)</span>
<a href="#l1.203"></a><span id="l1.203" class="difflineplus">+    aElement = this;</span>
<a href="#l1.204"></a><span id="l1.204" class="difflineplus">+  if (aElement.id == &quot;Age&quot;) {</span>
<a href="#l1.205"></a><span id="l1.205" class="difflineplus">+    yearElem = document.getElementById(&quot;BirthYear&quot;);</span>
<a href="#l1.206"></a><span id="l1.206" class="difflineplus">+    datepicker = document.getElementById(&quot;Birthday&quot;);</span>
<a href="#l1.207"></a><span id="l1.207" class="difflineplus">+  }</span>
<a href="#l1.208"></a><span id="l1.208" class="difflineplus">+  if (!yearElem || !datepicker)</span>
<a href="#l1.209"></a><span id="l1.209" class="difflineplus">+    return;</span>
<a href="#l1.210"></a><span id="l1.210" class="difflineplus">+</span>
<a href="#l1.211"></a><span id="l1.211" class="difflineplus">+  // if the age is null, remove the year from the year element, and set the</span>
<a href="#l1.212"></a><span id="l1.212" class="difflineplus">+  // datepicker to the default year</span>
<a href="#l1.213"></a><span id="l1.213" class="difflineplus">+  if (!aElement.value) {</span>
<a href="#l1.214"></a><span id="l1.214" class="difflineplus">+    datepicker.year = kDefaultYear;</span>
<a href="#l1.215"></a><span id="l1.215" class="difflineplus">+    yearElem.value = null;</span>
<a href="#l1.216"></a><span id="l1.216" class="difflineplus">+    return;</span>
<a href="#l1.217"></a><span id="l1.217" class="difflineplus">+  }</span>
<a href="#l1.218"></a><span id="l1.218" class="difflineplus">+  var today = new Date();</span>
<a href="#l1.219"></a><span id="l1.219" class="difflineplus">+  try {</span>
<a href="#l1.220"></a><span id="l1.220" class="difflineplus">+    var date = new Date(aElement.value, datepicker.month, datepicker.date);</span>
<a href="#l1.221"></a><span id="l1.221" class="difflineplus">+    date.setFullYear(aElement.value);</span>
<a href="#l1.222"></a><span id="l1.222" class="difflineplus">+    // get the difference between today and the age (the year is offset by 1970)</span>
<a href="#l1.223"></a><span id="l1.223" class="difflineplus">+    var difference = new Date(today - date);</span>
<a href="#l1.224"></a><span id="l1.224" class="difflineplus">+    datepicker.year = yearElem.value = difference.getFullYear() - 1970;</span>
<a href="#l1.225"></a><span id="l1.225" class="difflineplus">+  }</span>
<a href="#l1.226"></a><span id="l1.226" class="difflineplus">+  // the above code may throw an invalid year exception.  If that happens, set</span>
<a href="#l1.227"></a><span id="l1.227" class="difflineplus">+  // the year to kDefaultYear and set the year element's value to 0</span>
<a href="#l1.228"></a><span id="l1.228" class="difflineplus">+  catch (e) {</span>
<a href="#l1.229"></a><span id="l1.229" class="difflineplus">+    datepicker.year = kDefaultYear;</span>
<a href="#l1.230"></a><span id="l1.230" class="difflineplus">+    // if there was an error (like invalid year) set the year and age to null</span>
<a href="#l1.231"></a><span id="l1.231" class="difflineplus">+    yearElem.value = null;</span>
<a href="#l1.232"></a><span id="l1.232" class="difflineplus">+    ageElem.value = null;</span>
<a href="#l1.233"></a><span id="l1.233" class="difflineplus">+  }</span>
<a href="#l1.234"></a><span id="l1.234" class="difflineplus">+}</span>
<a href="#l1.235"></a><span id="l1.235" class="difflineplus">+</span>
<a href="#l1.236"></a><span id="l1.236" class="difflineplus">+/**</span>
<a href="#l1.237"></a><span id="l1.237" class="difflineplus">+ * Modifies a datepicker in the following ways:</span>
<a href="#l1.238"></a><span id="l1.238" class="difflineplus">+ *  - Removes the scroll arrows</span>
<a href="#l1.239"></a><span id="l1.239" class="difflineplus">+ *  - Hides the year</span>
<a href="#l1.240"></a><span id="l1.240" class="difflineplus">+ *  - Allows the day and month to be blank</span>
<a href="#l1.241"></a><span id="l1.241" class="difflineplus">+ * NOTE:</span>
<a href="#l1.242"></a><span id="l1.242" class="difflineplus">+ * The datepicker's date, month, year, and dateValue properties are not always</span>
<a href="#l1.243"></a><span id="l1.243" class="difflineplus">+ * what appear physically to the user in the datepicker fields.</span>
<a href="#l1.244"></a><span id="l1.244" class="difflineplus">+ * If any field is blank, the corresponding property is either the previous</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineplus">+ * value if there was one since the card was opened or the relevant portion of</span>
<a href="#l1.246"></a><span id="l1.246" class="difflineplus">+ * the current date.</span>
<a href="#l1.247"></a><span id="l1.247" class="difflineplus">+ * </span>
<a href="#l1.248"></a><span id="l1.248" class="difflineplus">+ * To get the displayed values, get the value of the individual field, such as</span>
<a href="#l1.249"></a><span id="l1.249" class="difflineplus">+ * datepicker.yyyyField.value where yyyy is &quot;year&quot;, &quot;month&quot;, or &quot;date&quot; for the</span>
<a href="#l1.250"></a><span id="l1.250" class="difflineplus">+ * year, month, and day, respectively.</span>
<a href="#l1.251"></a><span id="l1.251" class="difflineplus">+ * If the value is null, then the field is blank and vice versa.</span>
<a href="#l1.252"></a><span id="l1.252" class="difflineplus">+ * @param aDatepicker The datepicker to modify.</span>
<a href="#l1.253"></a><span id="l1.253" class="difflineplus">+ */</span>
<a href="#l1.254"></a><span id="l1.254" class="difflineplus">+function modifyDatepicker(aDatepicker) {</span>
<a href="#l1.255"></a><span id="l1.255" class="difflineplus">+  // collapse the year field and separator</span>
<a href="#l1.256"></a><span id="l1.256" class="difflineplus">+  aDatepicker.yearField.parentNode.collapsed = true;</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineplus">+  if (aDatepicker.yearField == aDatepicker._fieldThree ||</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineplus">+      aDatepicker.yearField == aDatepicker._fieldTwo)</span>
<a href="#l1.259"></a><span id="l1.259" class="difflineplus">+    aDatepicker._separatorSecond.collapsed = true;</span>
<a href="#l1.260"></a><span id="l1.260" class="difflineplus">+  else</span>
<a href="#l1.261"></a><span id="l1.261" class="difflineplus">+    aDatepicker._separatorFirst.collapsed = true;</span>
<a href="#l1.262"></a><span id="l1.262" class="difflineplus">+  // collapse the spinner element</span>
<a href="#l1.263"></a><span id="l1.263" class="difflineplus">+  document.getAnonymousElementByAttribute(aDatepicker, &quot;anonid&quot;, &quot;buttons&quot;)</span>
<a href="#l1.264"></a><span id="l1.264" class="difflineplus">+          .collapsed = true;</span>
<a href="#l1.265"></a><span id="l1.265" class="difflineplus">+  // this modified constrain value function ignores values less than the minimum</span>
<a href="#l1.266"></a><span id="l1.266" class="difflineplus">+  // to let the value be blank (null)</span>
<a href="#l1.267"></a><span id="l1.267" class="difflineplus">+  // from: mozilla/toolkit/content/widgets/datetimepicker.xml#759</span>
<a href="#l1.268"></a><span id="l1.268" class="difflineplus">+  aDatepicker._constrainValue = function newConstrainValue(aField, aValue, aNoWrap) {</span>
<a href="#l1.269"></a><span id="l1.269" class="difflineplus">+    // if the value is less than one, make the field's value null</span>
<a href="#l1.270"></a><span id="l1.270" class="difflineplus">+    if (aValue &lt; 1) {</span>
<a href="#l1.271"></a><span id="l1.271" class="difflineplus">+      aField.value = null;</span>
<a href="#l1.272"></a><span id="l1.272" class="difflineplus">+      return null;</span>
<a href="#l1.273"></a><span id="l1.273" class="difflineplus">+    }</span>
<a href="#l1.274"></a><span id="l1.274" class="difflineplus">+    if (aNoWrap &amp;&amp; aField == this.monthField)</span>
<a href="#l1.275"></a><span id="l1.275" class="difflineplus">+      aValue--;</span>
<a href="#l1.276"></a><span id="l1.276" class="difflineplus">+    // make sure the date is valid for the given month</span>
<a href="#l1.277"></a><span id="l1.277" class="difflineplus">+    if (aField == this.dateField) {</span>
<a href="#l1.278"></a><span id="l1.278" class="difflineplus">+      var currentMonth = this.month;</span>
<a href="#l1.279"></a><span id="l1.279" class="difflineplus">+      var dt = new Date(this.year, currentMonth, aValue);</span>
<a href="#l1.280"></a><span id="l1.280" class="difflineplus">+      return dt.getMonth() != currentMonth ? 1 : aValue;</span>
<a href="#l1.281"></a><span id="l1.281" class="difflineplus">+    }</span>
<a href="#l1.282"></a><span id="l1.282" class="difflineplus">+    var max = (aField == this.monthField) ? 11 : 9999;</span>
<a href="#l1.283"></a><span id="l1.283" class="difflineplus">+    // make sure the value isn't too high</span>
<a href="#l1.284"></a><span id="l1.284" class="difflineplus">+    if (aValue &gt; max)</span>
<a href="#l1.285"></a><span id="l1.285" class="difflineplus">+      return aNoWrap ? max : min;</span>
<a href="#l1.286"></a><span id="l1.286" class="difflineplus">+    return aValue;</span>
<a href="#l1.287"></a><span id="l1.287" class="difflineplus">+  }</span>
<a href="#l1.288"></a><span id="l1.288" class="difflineplus">+  // sets the specified field to the given value, but allows blank fields</span>
<a href="#l1.289"></a><span id="l1.289" class="difflineplus">+  // from: mozilla/toolkit/content/widgets/datetimepicker.xml#698</span>
<a href="#l1.290"></a><span id="l1.290" class="difflineplus">+  aDatepicker._setFieldValue = function setValue(aField, aValue) {</span>
<a href="#l1.291"></a><span id="l1.291" class="difflineplus">+    if (aField == this.yearField &amp;&amp; aValue &gt; 0 &amp;&amp; aValue &lt; 10000) {</span>
<a href="#l1.292"></a><span id="l1.292" class="difflineplus">+      var oldDate = this._dateValue;</span>
<a href="#l1.293"></a><span id="l1.293" class="difflineplus">+      this._dateValue.setFullYear(aValue);</span>
<a href="#l1.294"></a><span id="l1.294" class="difflineplus">+      if (oldDate != this._dateValue) {</span>
<a href="#l1.295"></a><span id="l1.295" class="difflineplus">+        this._dateValue.setDate(0);</span>
<a href="#l1.296"></a><span id="l1.296" class="difflineplus">+        this._updateUI(this.dateField, this.date);</span>
<a href="#l1.297"></a><span id="l1.297" class="difflineplus">+      }</span>
<a href="#l1.298"></a><span id="l1.298" class="difflineplus">+    }</span>
<a href="#l1.299"></a><span id="l1.299" class="difflineplus">+    // update the month if the value isn't null</span>
<a href="#l1.300"></a><span id="l1.300" class="difflineplus">+    else if (aField == this.monthField &amp;&amp; aValue != null) {</span>
<a href="#l1.301"></a><span id="l1.301" class="difflineplus">+      var oldDate = this.date;</span>
<a href="#l1.302"></a><span id="l1.302" class="difflineplus">+      this._dateValue.setMonth(aValue);</span>
<a href="#l1.303"></a><span id="l1.303" class="difflineplus">+      if (oldDate != this.date)</span>
<a href="#l1.304"></a><span id="l1.304" class="difflineplus">+        this._dateValue.setDate(0);</span>
<a href="#l1.305"></a><span id="l1.305" class="difflineplus">+      this._updateUI(this.dateField, this.date);</span>
<a href="#l1.306"></a><span id="l1.306" class="difflineplus">+      var date = this._dateValue.getDate();</span>
<a href="#l1.307"></a><span id="l1.307" class="difflineplus">+      this.dateField.value = date &lt; 10 ? &quot;0&quot; + date : date;</span>
<a href="#l1.308"></a><span id="l1.308" class="difflineplus">+      var month = this._dateValue.getMonth() + 1;</span>
<a href="#l1.309"></a><span id="l1.309" class="difflineplus">+      this.monthField.value = month &lt; 10 ? &quot;0&quot; + month : month;</span>
<a href="#l1.310"></a><span id="l1.310" class="difflineplus">+    }</span>
<a href="#l1.311"></a><span id="l1.311" class="difflineplus">+    // update the date if the value isn't null</span>
<a href="#l1.312"></a><span id="l1.312" class="difflineplus">+    else if (aField == this.dateField &amp;&amp; aValue != null) {</span>
<a href="#l1.313"></a><span id="l1.313" class="difflineplus">+      this._dateValue.setDate(aValue);</span>
<a href="#l1.314"></a><span id="l1.314" class="difflineplus">+      this._updateUI(this.dateField, this.date);</span>
<a href="#l1.315"></a><span id="l1.315" class="difflineplus">+      var date = this._dateValue.getDate();</span>
<a href="#l1.316"></a><span id="l1.316" class="difflineplus">+      this.dateField.value = date &lt; 10 ? &quot;0&quot; + date : date;</span>
<a href="#l1.317"></a><span id="l1.317" class="difflineplus">+      var month = this._dateValue.getMonth() + 1;</span>
<a href="#l1.318"></a><span id="l1.318" class="difflineplus">+      this.monthField.value = month &lt; 10 ? &quot;0&quot; + month : month;</span>
<a href="#l1.319"></a><span id="l1.319" class="difflineplus">+    }</span>
<a href="#l1.320"></a><span id="l1.320" class="difflineplus">+    this.setAttribute(&quot;value&quot;, this.value);</span>
<a href="#l1.321"></a><span id="l1.321" class="difflineplus">+</span>
<a href="#l1.322"></a><span id="l1.322" class="difflineplus">+    if (this.attachedControl)</span>
<a href="#l1.323"></a><span id="l1.323" class="difflineplus">+      this.attachedControl._setValueNoSync(this._dateValue);</span>
<a href="#l1.324"></a><span id="l1.324" class="difflineplus">+    // if the aField's value is null or 0, set both field's values to null</span>
<a href="#l1.325"></a><span id="l1.325" class="difflineplus">+    if (!aField.value &amp;&amp; aField != this.yearField) {</span>
<a href="#l1.326"></a><span id="l1.326" class="difflineplus">+      this.dateField.value = null;</span>
<a href="#l1.327"></a><span id="l1.327" class="difflineplus">+      this.monthField.value = null;</span>
<a href="#l1.328"></a><span id="l1.328" class="difflineplus">+    }</span>
<a href="#l1.329"></a><span id="l1.329" class="difflineplus">+    // make the field's value null if aValue is null and the field's value isn't</span>
<a href="#l1.330"></a><span id="l1.330" class="difflineplus">+    if (aValue == null &amp;&amp; aField.value != null)</span>
<a href="#l1.331"></a><span id="l1.331" class="difflineplus">+      aField.value = null;</span>
<a href="#l1.332"></a><span id="l1.332" class="difflineplus">+  }</span>
<a href="#l1.333"></a><span id="l1.333" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/addrbook/content/abCardViewOverlay.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCardViewOverlay.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -59,16 +59,17 @@ var zSecondaryEmail;</span>
<a href="#l2.4"></a><span id="l2.4"> var zScreenName;</span>
<a href="#l2.5"></a><span id="l2.5"> var zNickname;</span>
<a href="#l2.6"></a><span id="l2.6"> var zDisplayName;</span>
<a href="#l2.7"></a><span id="l2.7"> var zWork;</span>
<a href="#l2.8"></a><span id="l2.8"> var zHome;</span>
<a href="#l2.9"></a><span id="l2.9"> var zFax;</span>
<a href="#l2.10"></a><span id="l2.10"> var zCellular;</span>
<a href="#l2.11"></a><span id="l2.11"> var zPager;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+var zBirthday;</span>
<a href="#l2.13"></a><span id="l2.13"> var zCustom1;</span>
<a href="#l2.14"></a><span id="l2.14"> var zCustom2;</span>
<a href="#l2.15"></a><span id="l2.15"> var zCustom3;</span>
<a href="#l2.16"></a><span id="l2.16"> var zCustom4;</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> var cvData;</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> function OnLoadCardView()</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -79,16 +80,17 @@ function OnLoadCardView()</span>
<a href="#l2.22"></a><span id="l2.22">   zNickname = gAddressBookBundle.getString(&quot;propertyNickname&quot;);</span>
<a href="#l2.23"></a><span id="l2.23">   zDisplayName = gAddressBookBundle.getString(&quot;propertyDisplayName&quot;);</span>
<a href="#l2.24"></a><span id="l2.24">   zListName = gAddressBookBundle.getString(&quot;propertyListName&quot;);</span>
<a href="#l2.25"></a><span id="l2.25">   zWork = gAddressBookBundle.getString(&quot;propertyWork&quot;);</span>
<a href="#l2.26"></a><span id="l2.26">   zHome = gAddressBookBundle.getString(&quot;propertyHome&quot;);</span>
<a href="#l2.27"></a><span id="l2.27">   zFax = gAddressBookBundle.getString(&quot;propertyFax&quot;);</span>
<a href="#l2.28"></a><span id="l2.28">   zCellular = gAddressBookBundle.getString(&quot;propertyCellular&quot;);</span>
<a href="#l2.29"></a><span id="l2.29">   zPager = gAddressBookBundle.getString(&quot;propertyPager&quot;);</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+  zBirthday = gAddressBookBundle.getString(&quot;propertyBirthday&quot;);</span>
<a href="#l2.31"></a><span id="l2.31">   zCustom1 = gAddressBookBundle.getString(&quot;propertyCustom1&quot;);</span>
<a href="#l2.32"></a><span id="l2.32">   zCustom2 = gAddressBookBundle.getString(&quot;propertyCustom2&quot;);</span>
<a href="#l2.33"></a><span id="l2.33">   zCustom3 = gAddressBookBundle.getString(&quot;propertyCustom3&quot;);</span>
<a href="#l2.34"></a><span id="l2.34">   zCustom4 = gAddressBookBundle.getString(&quot;propertyCustom4&quot;);</span>
<a href="#l2.35"></a><span id="l2.35"> </span>
<a href="#l2.36"></a><span id="l2.36">   var doc = document;</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38">   /* data for address book, prefixes: &quot;cvb&quot; = card view box</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineat">@@ -122,18 +124,19 @@ function OnLoadCardView()</span>
<a href="#l2.40"></a><span id="l2.40">   cvData.cvHomeAddress2  = doc.getElementById(&quot;cvHomeAddress2&quot;);</span>
<a href="#l2.41"></a><span id="l2.41">   cvData.cvHomeCityStZip  = doc.getElementById(&quot;cvHomeCityStZip&quot;);</span>
<a href="#l2.42"></a><span id="l2.42">   cvData.cvHomeCountry  = doc.getElementById(&quot;cvHomeCountry&quot;);</span>
<a href="#l2.43"></a><span id="l2.43">   cvData.cvbHomeMapItBox  = doc.getElementById(&quot;cvbHomeMapItBox&quot;);</span>
<a href="#l2.44"></a><span id="l2.44">   cvData.cvHomeMapIt = doc.getElementById(&quot;cvHomeMapIt&quot;);</span>
<a href="#l2.45"></a><span id="l2.45">   cvData.cvHomeWebPageBox = doc.getElementById(&quot;cvHomeWebPageBox&quot;);</span>
<a href="#l2.46"></a><span id="l2.46">   cvData.cvHomeWebPage  = doc.getElementById(&quot;cvHomeWebPage&quot;);</span>
<a href="#l2.47"></a><span id="l2.47">   // Other section</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-  cvData.cvbOther      = doc.getElementById(&quot;cvbOther&quot;);</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-  cvData.cvhOther      = doc.getElementById(&quot;cvhOther&quot;);</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+  cvData.cvbOther     = doc.getElementById(&quot;cvbOther&quot;);</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+  cvData.cvhOther     = doc.getElementById(&quot;cvhOther&quot;);</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+  cvData.cvBirthday   = doc.getElementById(&quot;cvBirthday&quot;);</span>
<a href="#l2.53"></a><span id="l2.53">   cvData.cvCustom1    = doc.getElementById(&quot;cvCustom1&quot;);</span>
<a href="#l2.54"></a><span id="l2.54">   cvData.cvCustom2    = doc.getElementById(&quot;cvCustom2&quot;);</span>
<a href="#l2.55"></a><span id="l2.55">   cvData.cvCustom3    = doc.getElementById(&quot;cvCustom3&quot;);</span>
<a href="#l2.56"></a><span id="l2.56">   cvData.cvCustom4    = doc.getElementById(&quot;cvCustom4&quot;);</span>
<a href="#l2.57"></a><span id="l2.57">   cvData.cvNotes      = doc.getElementById(&quot;cvNotes&quot;);</span>
<a href="#l2.58"></a><span id="l2.58">   // Description section (mailing lists only)</span>
<a href="#l2.59"></a><span id="l2.59">   cvData.cvbDescription      = doc.getElementById(&quot;cvbDescription&quot;);</span>
<a href="#l2.60"></a><span id="l2.60">   cvData.cvhDescription      = doc.getElementById(&quot;cvhDescription&quot;);</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineat">@@ -305,18 +308,36 @@ function DisplayCardViewPane(realCard)</span>
<a href="#l2.62"></a><span id="l2.62">     visible = cvAddAddressNodes(data.cvAddresses, card.mailListURI);</span>
<a href="#l2.63"></a><span id="l2.63">     cvSetVisible(data.cvbAddresses, visible);</span>
<a href="#l2.64"></a><span id="l2.64"> </span>
<a href="#l2.65"></a><span id="l2.65">     // Other section, not shown for mailing lists.</span>
<a href="#l2.66"></a><span id="l2.66">     cvSetVisible(data.cvbOther, false);</span>
<a href="#l2.67"></a><span id="l2.67">   }</span>
<a href="#l2.68"></a><span id="l2.68">   else {</span>
<a href="#l2.69"></a><span id="l2.69">     // Other section</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+    // setup the birthday information</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+    var day = card.getProperty(&quot;BirthDay&quot;, null);</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+    var month = card.getProperty(&quot;BirthMonth&quot;, null);</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+    var year = card.getProperty(&quot;BirthYear&quot;, null);</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+    var dateStr;</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+    if (day || month) {</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+      var date = (new Date(year, parseInt(month) - 1, day));</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+      // if the year exists, just use Date.toLocaleString</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+      if (year)</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+        dateStr = date.toLocaleDateString();</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+      // if the year doesn't exist, display Month DD (ex. January 01)</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+      else</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+        dateStr = date.toLocaleFormat(gAddressBookBundle.getString(&quot;dateformat&quot;));</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+    }</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+    else if (year)</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+      dateStr = year;</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+    visible = cvSetNodeWithLabel(data.cvBirthday, zBirthday, dateStr);</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+</span>
<a href="#l2.88"></a><span id="l2.88">     visible = cvSetNodeWithLabel(data.cvCustom1, zCustom1,</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-                                 card.getProperty(&quot;Custom1&quot;));</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+                                 card.getProperty(&quot;Custom1&quot;)) || visible;</span>
<a href="#l2.91"></a><span id="l2.91">     visible = cvSetNodeWithLabel(data.cvCustom2, zCustom2,</span>
<a href="#l2.92"></a><span id="l2.92">                                  card.getProperty(&quot;Custom2&quot;)) || visible;</span>
<a href="#l2.93"></a><span id="l2.93">     visible = cvSetNodeWithLabel(data.cvCustom3, zCustom3,</span>
<a href="#l2.94"></a><span id="l2.94">                                  card.getProperty(&quot;Custom3&quot;)) || visible;</span>
<a href="#l2.95"></a><span id="l2.95">     visible = cvSetNodeWithLabel(data.cvCustom4, zCustom4,</span>
<a href="#l2.96"></a><span id="l2.96">                                  card.getProperty(&quot;Custom4&quot;)) || visible;</span>
<a href="#l2.97"></a><span id="l2.97">     visible = cvSetNode(data.cvNotes, card.getProperty(&quot;Notes&quot;)) || visible;</span>
<a href="#l2.98"></a><span id="l2.98">     visible = setBuddyIcon(card, data.cvBuddyIcon) || visible;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -742,16 +742,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">                     &lt;/vbox&gt;</span>
<a href="#l3.5"></a><span id="l3.5">                   &lt;/hbox&gt;</span>
<a href="#l3.6"></a><span id="l3.6">                   &lt;description class=&quot;CardViewLink&quot; id=&quot;cvHomeWebPageBox&quot;&gt;</span>
<a href="#l3.7"></a><span id="l3.7">                     &lt;html:a onclick=&quot;return openLink('cvHomeWebPage');&quot; href=&quot;&quot; id=&quot;cvHomeWebPage&quot;/&gt;</span>
<a href="#l3.8"></a><span id="l3.8">                   &lt;/description&gt;</span>
<a href="#l3.9"></a><span id="l3.9">                 &lt;/vbox&gt;</span>
<a href="#l3.10"></a><span id="l3.10">                 &lt;vbox id=&quot;cvbOther&quot; class=&quot;cardViewGroup&quot;&gt;</span>
<a href="#l3.11"></a><span id="l3.11">                   &lt;description class=&quot;CardViewHeading&quot; id=&quot;cvhOther&quot;&gt;&amp;other.heading;&lt;/description&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+                  &lt;description class=&quot;CardViewText&quot; id=&quot;cvBirthday&quot;/&gt;</span>
<a href="#l3.13"></a><span id="l3.13">                   &lt;description class=&quot;CardViewText&quot; id=&quot;cvCustom1&quot;/&gt;</span>
<a href="#l3.14"></a><span id="l3.14">                   &lt;description class=&quot;CardViewText&quot; id=&quot;cvCustom2&quot;/&gt;</span>
<a href="#l3.15"></a><span id="l3.15">                   &lt;description class=&quot;CardViewText&quot; id=&quot;cvCustom3&quot;/&gt;</span>
<a href="#l3.16"></a><span id="l3.16">                   &lt;description class=&quot;CardViewText&quot; id=&quot;cvCustom4&quot;/&gt;</span>
<a href="#l3.17"></a><span id="l3.17">                   &lt;description class=&quot;CardViewText&quot; id=&quot;cvNotes&quot; style=&quot;white-space: pre-wrap;&quot;/&gt;</span>
<a href="#l3.18"></a><span id="l3.18">                   &lt;hbox&gt;</span>
<a href="#l3.19"></a><span id="l3.19">                     &lt;image id=&quot;cvBuddyIcon&quot;/&gt; </span>
<a href="#l3.20"></a><span id="l3.20">                   &lt;/hbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/addressbook/abCardOverlay.dtd</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/addressbook/abCardOverlay.dtd</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -131,16 +131,21 @@</span>
<a href="#l4.4"></a><span id="l4.4"> &lt;!ENTITY WorkZipCode.accesskey          &quot;P&quot;&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> &lt;!ENTITY WorkCountry.label              &quot;Country:&quot;&gt;</span>
<a href="#l4.6"></a><span id="l4.6"> &lt;!ENTITY WorkCountry.accesskey          &quot;n&quot;&gt;</span>
<a href="#l4.7"></a><span id="l4.7"> &lt;!ENTITY WorkWebPage.label              &quot;Web Page:&quot;&gt;</span>
<a href="#l4.8"></a><span id="l4.8"> &lt;!ENTITY WorkWebPage.accesskey          &quot;b&quot;&gt;</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10"> &lt;!ENTITY Other.tab                      &quot;Other&quot;&gt;</span>
<a href="#l4.11"></a><span id="l4.11"> &lt;!ENTITY Other.accesskey                &quot;h&quot;&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+&lt;!ENTITY Birthday.label                 &quot;Birthday:&quot;&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+&lt;!ENTITY Birthday.accesskey             &quot;B&quot;&gt;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+&lt;!ENTITY Year.emptytext                 &quot;Year&quot;&gt;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+&lt;!ENTITY Or.value                       &quot;or&quot;&gt;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+&lt;!ENTITY Age.emptytext                  &quot;Age&quot;&gt;</span>
<a href="#l4.17"></a><span id="l4.17"> &lt;!ENTITY Custom1.label                  &quot;Custom 1:&quot;&gt;</span>
<a href="#l4.18"></a><span id="l4.18"> &lt;!ENTITY Custom1.accesskey              &quot;1&quot;&gt;</span>
<a href="#l4.19"></a><span id="l4.19"> &lt;!ENTITY Custom2.label                  &quot;Custom 2:&quot;&gt;</span>
<a href="#l4.20"></a><span id="l4.20"> &lt;!ENTITY Custom2.accesskey              &quot;2&quot;&gt;</span>
<a href="#l4.21"></a><span id="l4.21"> &lt;!ENTITY Custom3.label                  &quot;Custom 3:&quot;&gt;</span>
<a href="#l4.22"></a><span id="l4.22"> &lt;!ENTITY Custom3.accesskey              &quot;3&quot;&gt;</span>
<a href="#l4.23"></a><span id="l4.23"> &lt;!ENTITY Custom4.label                  &quot;Custom 4:&quot;&gt;</span>
<a href="#l4.24"></a><span id="l4.24"> &lt;!ENTITY Custom4.accesskey              &quot;4&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -82,21 +82,29 @@ propertySecondaryEmail=Additional Email</span>
<a href="#l5.4"></a><span id="l5.4"> propertyScreenName=Screen Name</span>
<a href="#l5.5"></a><span id="l5.5"> propertyNickname=Nickname</span>
<a href="#l5.6"></a><span id="l5.6"> propertyDisplayName=Display Name</span>
<a href="#l5.7"></a><span id="l5.7"> propertyWork=Work</span>
<a href="#l5.8"></a><span id="l5.8"> propertyHome=Home</span>
<a href="#l5.9"></a><span id="l5.9"> propertyFax=Fax</span>
<a href="#l5.10"></a><span id="l5.10"> propertyCellular=Mobile</span>
<a href="#l5.11"></a><span id="l5.11"> propertyPager=Pager</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+propertyBirthday=Birthday</span>
<a href="#l5.13"></a><span id="l5.13"> propertyCustom1=Custom 1</span>
<a href="#l5.14"></a><span id="l5.14"> propertyCustom2=Custom 2</span>
<a href="#l5.15"></a><span id="l5.15"> propertyCustom3=Custom 3</span>
<a href="#l5.16"></a><span id="l5.16"> propertyCustom4=Custom 4</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+## LOCALIZATION NOTE (dateformat)</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+## Only used if the year isn't present and should be in the format used by Date.toLocaleFormat</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+## see http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Date/toLocaleFormat</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+## %B is the month's localized name and %e is the day of the month [1-31]</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+## Separators (a space, dash, etc.) can be used</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+dateformat=%B %e</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+</span>
<a href="#l5.25"></a><span id="l5.25"> ## LOCALIZATION NOTE (cityAndStateAndZip): </span>
<a href="#l5.26"></a><span id="l5.26"> ## %1$S is city, %2$S is state, %3$S is zip</span>
<a href="#l5.27"></a><span id="l5.27"> cityAndStateAndZip=%1$S, %2$S %3$S</span>
<a href="#l5.28"></a><span id="l5.28"> ## LOCALIZATION NOTE (cityAndStateNoZip): </span>
<a href="#l5.29"></a><span id="l5.29"> ## %1$S is city, %2$S is state</span>
<a href="#l5.30"></a><span id="l5.30"> cityAndStateNoZip=%1$S, %2$S</span>
<a href="#l5.31"></a><span id="l5.31"> ## LOCALIZATION NOTE (cityOrStateAndZip): </span>
<a href="#l5.32"></a><span id="l5.32"> ## %1$S is city or state, %2$S is zip</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/addrbook/resources/content/abCardOverlay.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/addrbook/resources/content/abCardOverlay.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -83,16 +83,17 @@ const kVcardFields =</span>
<a href="#l6.4"></a><span id="l6.4">           // Other &gt; (custom)</span>
<a href="#l6.5"></a><span id="l6.5">          [&quot;Custom1&quot;, &quot;Custom1&quot;],</span>
<a href="#l6.6"></a><span id="l6.6">          [&quot;Custom2&quot;, &quot;Custom2&quot;],</span>
<a href="#l6.7"></a><span id="l6.7">          [&quot;Custom3&quot;, &quot;Custom3&quot;],</span>
<a href="#l6.8"></a><span id="l6.8">          [&quot;Custom4&quot;, &quot;Custom4&quot;],</span>
<a href="#l6.9"></a><span id="l6.9">           // Other &gt; Notes</span>
<a href="#l6.10"></a><span id="l6.10">          [&quot;Notes&quot;, &quot;Notes&quot;]];</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+const kDefaultYear = 2000;</span>
<a href="#l6.13"></a><span id="l6.13"> var gEditCard;</span>
<a href="#l6.14"></a><span id="l6.14"> var gOnSaveListeners = new Array();</span>
<a href="#l6.15"></a><span id="l6.15"> var gOkCallback = null;</span>
<a href="#l6.16"></a><span id="l6.16"> var gHideABPicker = false;</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> function OnLoadNewCard()</span>
<a href="#l6.19"></a><span id="l6.19"> {</span>
<a href="#l6.20"></a><span id="l6.20">   InitEditCard();</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -276,16 +277,21 @@ function OnLoadEditCard()</span>
<a href="#l6.22"></a><span id="l6.22">       var directory = GetDirectoryFromURI(abURI);</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24">       if (!(directory.operations &amp; directory.opWrite)) </span>
<a href="#l6.25"></a><span id="l6.25">       {</span>
<a href="#l6.26"></a><span id="l6.26">         // Set all the editable vcard fields to read only</span>
<a href="#l6.27"></a><span id="l6.27">         for (var i = kVcardFields.length; i-- &gt; 0; )</span>
<a href="#l6.28"></a><span id="l6.28">           document.getElementById(kVcardFields[i][0]).readOnly = true;</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+        // the birthday fields</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+        document.getElementById(&quot;Birthday&quot;).readOnly = true;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+        document.getElementById(&quot;BirthYear&quot;).readOnly = true;</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+        document.getElementById(&quot;Age&quot;).readOnly = true;</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+</span>
<a href="#l6.35"></a><span id="l6.35">         // And the phonetic fields</span>
<a href="#l6.36"></a><span id="l6.36">         document.getElementById(kPhoneticFields[0]).readOnly = true;</span>
<a href="#l6.37"></a><span id="l6.37">         document.getElementById(kPhoneticFields[3]).readOnly = true;</span>
<a href="#l6.38"></a><span id="l6.38"> </span>
<a href="#l6.39"></a><span id="l6.39">         // Also disable the mail format popup and allow remote content items.</span>
<a href="#l6.40"></a><span id="l6.40">         document.getElementById(&quot;PreferMailFormatPopup&quot;).disabled = true;</span>
<a href="#l6.41"></a><span id="l6.41">         document.getElementById(&quot;allowRemoteContent&quot;).disabled = true;</span>
<a href="#l6.42"></a><span id="l6.42"> </span>
<a href="#l6.43"></a><span id="l6.43" class="difflineat">@@ -408,16 +414,50 @@ function GetCardValues(cardproperty, doc</span>
<a href="#l6.44"></a><span id="l6.44">   if (!cardproperty)</span>
<a href="#l6.45"></a><span id="l6.45">     return;</span>
<a href="#l6.46"></a><span id="l6.46"> </span>
<a href="#l6.47"></a><span id="l6.47">   for (var i = kVcardFields.length; i-- &gt; 0; ) {</span>
<a href="#l6.48"></a><span id="l6.48">     doc.getElementById(kVcardFields[i][0]).value =</span>
<a href="#l6.49"></a><span id="l6.49">       cardproperty.getProperty(kVcardFields[i][1], &quot;&quot;);</span>
<a href="#l6.50"></a><span id="l6.50">   }</span>
<a href="#l6.51"></a><span id="l6.51"> </span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+  var birthday = doc.getElementById(&quot;Birthday&quot;);</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+  modifyDatepicker(birthday);</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+  // get the month of the year (1 - 12)</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+  var month = cardproperty.getProperty(&quot;BirthMonth&quot;, null);</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+  // set the datepicker's month and prepend a zero if necessary</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+  if (month) {</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+    birthday.month = parseInt(month) - 1;</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+    if (month.length &lt; 2)</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+      month = &quot;0&quot; + month;</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+  }</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+  birthday.monthField.value = month;</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+  // get the date of the month (1 - 31)</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+  var date = cardproperty.getProperty(&quot;BirthDay&quot;, null);</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+  birthday.dateField.value = date;</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+  // get the year</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+  var year = cardproperty.getProperty(&quot;BirthYear&quot;, null);</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+  var birthYear = doc.getElementById(&quot;BirthYear&quot;);</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+  // set the year in the datepicker to the stored year</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+  // if the year isn't present, default to 2000 (a leap year)</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineplus">+  birthday.year = year ? year : kDefaultYear;</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+  birthYear.value = year;</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+  // get the current age</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineplus">+  calculateAge(null, birthYear);</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+  // when the birth year changes, update the datepicker's year to the new value</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+  // or to kDefaultYear if the value is null</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+  birthYear.onchange = calculateAge;</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineplus">+  birthday.onchange = calculateAge;</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineplus">+  var age = doc.getElementById(&quot;Age&quot;);</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+  age.onchange = calculateYear;</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+</span>
<a href="#l6.86"></a><span id="l6.86">   var popup = document.getElementById(&quot;PreferMailFormatPopup&quot;);</span>
<a href="#l6.87"></a><span id="l6.87">   if (popup)</span>
<a href="#l6.88"></a><span id="l6.88">     popup.value = cardproperty.getProperty(&quot;PreferMailFormat&quot;, &quot;&quot;);</span>
<a href="#l6.89"></a><span id="l6.89">     </span>
<a href="#l6.90"></a><span id="l6.90">   var allowRemoteContentEl = document.getElementById(&quot;allowRemoteContent&quot;);</span>
<a href="#l6.91"></a><span id="l6.91">   if (allowRemoteContentEl)</span>
<a href="#l6.92"></a><span id="l6.92">     allowRemoteContentEl.checked = cardproperty.getProperty(&quot;AllowRemoteContent&quot;, false);</span>
<a href="#l6.93"></a><span id="l6.93"> </span>
<a href="#l6.94"></a><span id="l6.94" class="difflineat">@@ -449,16 +489,36 @@ function CheckAndSetCardValues(cardprope</span>
<a href="#l6.95"></a><span id="l6.95"> </span>
<a href="#l6.96"></a><span id="l6.96">   if (!cardproperty)</span>
<a href="#l6.97"></a><span id="l6.97">     return true;</span>
<a href="#l6.98"></a><span id="l6.98"> </span>
<a href="#l6.99"></a><span id="l6.99">   for (var i = kVcardFields.length; i-- &gt; 0; )</span>
<a href="#l6.100"></a><span id="l6.100">     cardproperty.setProperty(kVcardFields[i][1],</span>
<a href="#l6.101"></a><span id="l6.101">       doc.getElementById(kVcardFields[i][0]).value);</span>
<a href="#l6.102"></a><span id="l6.102"> </span>
<a href="#l6.103"></a><span id="l6.103" class="difflineplus">+  // get the birthday information from the dialog</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineplus">+  var birthdayElem = doc.getElementById(&quot;Birthday&quot;);</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineplus">+  var birthMonth = birthdayElem.monthField.value;</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineplus">+  var birthDay = birthdayElem.dateField.value;</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineplus">+  var birthYear = doc.getElementById(&quot;BirthYear&quot;).value;</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineplus">+</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineplus">+  // set or delete the birth day, month, and year properties, if necessary</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineplus">+  if (birthDay)</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineplus">+    cardproperty.setProperty(&quot;BirthDay&quot;, birthDay);</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineplus">+  else if(cardproperty.getProperty(&quot;BirthDay&quot;, null))</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineplus">+    cardproperty.deleteProperty(&quot;BirthDay&quot;);</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineplus">+  if (birthMonth)</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineplus">+    cardproperty.setProperty(&quot;BirthMonth&quot;, birthMonth);</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineplus">+  else if(cardproperty.getProperty(&quot;BirthMonth&quot;, null))</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineplus">+    cardproperty.deleteProperty(&quot;BirthMonth&quot;);</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineplus">+  if (birthYear)</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineplus">+    cardproperty.setProperty(&quot;BirthYear&quot;, birthYear);</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineplus">+  else if(cardproperty.getProperty(&quot;BirthYear&quot;, null))</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineplus">+    cardproperty.deleteProperty(&quot;BirthYear&quot;);</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineplus">+</span>
<a href="#l6.123"></a><span id="l6.123">   var popup = document.getElementById(&quot;PreferMailFormatPopup&quot;);</span>
<a href="#l6.124"></a><span id="l6.124">   if (popup)</span>
<a href="#l6.125"></a><span id="l6.125">     cardproperty.setProperty(&quot;PreferMailFormat&quot;, popup.value);</span>
<a href="#l6.126"></a><span id="l6.126">     </span>
<a href="#l6.127"></a><span id="l6.127">   var allowRemoteContentEl = document.getElementById(&quot;allowRemoteContent&quot;);</span>
<a href="#l6.128"></a><span id="l6.128">   if (allowRemoteContentEl)</span>
<a href="#l6.129"></a><span id="l6.129">     cardproperty.setProperty(&quot;AllowRemoteContent&quot;, allowRemoteContentEl.checked);</span>
<a href="#l6.130"></a><span id="l6.130"> </span>
<a href="#l6.131"></a><span id="l6.131" class="difflineat">@@ -568,8 +628,201 @@ function DisplayNameChanged()</span>
<a href="#l6.132"></a><span id="l6.132"> }</span>
<a href="#l6.133"></a><span id="l6.133"> </span>
<a href="#l6.134"></a><span id="l6.134"> function SetCardDialogTitle(displayName)</span>
<a href="#l6.135"></a><span id="l6.135"> {</span>
<a href="#l6.136"></a><span id="l6.136">   document.title = displayName</span>
<a href="#l6.137"></a><span id="l6.137">     ? gAddressBookBundle.getFormattedString(gEditCard.titleProperty + &quot;WithDisplayName&quot;, [displayName])</span>
<a href="#l6.138"></a><span id="l6.138">     : gAddressBookBundle.getString(gEditCard.titleProperty);</span>
<a href="#l6.139"></a><span id="l6.139"> }</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineplus">+</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineplus">+/**</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineplus">+ * Calculates the duration of time between an event and now and updates the year</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineplus">+ * of whichever element did not call this function.</span>
<a href="#l6.144"></a><span id="l6.144" class="difflineplus">+ * @param aEvent   The event calling this method.</span>
<a href="#l6.145"></a><span id="l6.145" class="difflineplus">+ * @param aElement Optional, but required if this function is not called from an</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineplus">+ *                 element's event listener. The element that would call this.</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineplus">+ */</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineplus">+function calculateAge(aEvent, aElement) {</span>
<a href="#l6.149"></a><span id="l6.149" class="difflineplus">+  var datepicker, yearElem, ageElem;</span>
<a href="#l6.150"></a><span id="l6.150" class="difflineplus">+  if (aEvent)</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineplus">+    aElement = this;</span>
<a href="#l6.152"></a><span id="l6.152" class="difflineplus">+  if (aElement.id == &quot;BirthYear&quot; || aElement.id == &quot;Birthday&quot;) {</span>
<a href="#l6.153"></a><span id="l6.153" class="difflineplus">+    datepicker = document.getElementById(&quot;Birthday&quot;);</span>
<a href="#l6.154"></a><span id="l6.154" class="difflineplus">+    yearElem = document.getElementById(&quot;BirthYear&quot;);</span>
<a href="#l6.155"></a><span id="l6.155" class="difflineplus">+    ageElem = document.getElementById(&quot;Age&quot;);</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineplus">+  }</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineplus">+  if (!datepicker || !yearElem || !ageElem)</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineplus">+    return;</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineplus">+</span>
<a href="#l6.160"></a><span id="l6.160" class="difflineplus">+  // if the datepicker was updated, update the year element</span>
<a href="#l6.161"></a><span id="l6.161" class="difflineplus">+  if (aElement == datepicker &amp;&amp; !(datepicker.year == kDefaultYear &amp;&amp; !yearElem.value))</span>
<a href="#l6.162"></a><span id="l6.162" class="difflineplus">+    yearElem.value = datepicker.year;</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineplus">+  var year = yearElem.value;</span>
<a href="#l6.164"></a><span id="l6.164" class="difflineplus">+  // if the year element's value is invalid set the year and age elements to null</span>
<a href="#l6.165"></a><span id="l6.165" class="difflineplus">+  if (isNaN(year) || year &lt; 1 || year &gt; 9999) {</span>
<a href="#l6.166"></a><span id="l6.166" class="difflineplus">+    yearElem.value = null;</span>
<a href="#l6.167"></a><span id="l6.167" class="difflineplus">+    ageElem.value = null;</span>
<a href="#l6.168"></a><span id="l6.168" class="difflineplus">+    datepicker.year = kDefaultYear;</span>
<a href="#l6.169"></a><span id="l6.169" class="difflineplus">+    return;</span>
<a href="#l6.170"></a><span id="l6.170" class="difflineplus">+  }</span>
<a href="#l6.171"></a><span id="l6.171" class="difflineplus">+  else if (aElement == yearElem)</span>
<a href="#l6.172"></a><span id="l6.172" class="difflineplus">+    datepicker.year = year;</span>
<a href="#l6.173"></a><span id="l6.173" class="difflineplus">+  // calculate the length of time between the event and now</span>
<a href="#l6.174"></a><span id="l6.174" class="difflineplus">+  try {</span>
<a href="#l6.175"></a><span id="l6.175" class="difflineplus">+    var event = new Date(datepicker.year, datepicker.month, datepicker.date);</span>
<a href="#l6.176"></a><span id="l6.176" class="difflineplus">+    // if the year is only 2 digits, then the year won't be set correctly</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineplus">+    // using setFullYear fixes this issue</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineplus">+    event.setFullYear(datepicker.year);</span>
<a href="#l6.179"></a><span id="l6.179" class="difflineplus">+    // get the difference between today and the event</span>
<a href="#l6.180"></a><span id="l6.180" class="difflineplus">+    var age = new Date(new Date() - event);</span>
<a href="#l6.181"></a><span id="l6.181" class="difflineplus">+    // get the number of years of the difference and subtract 1970 (epoch)</span>
<a href="#l6.182"></a><span id="l6.182" class="difflineplus">+    ageElem.value = age.getFullYear() - 1970;</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineplus">+  }</span>
<a href="#l6.184"></a><span id="l6.184" class="difflineplus">+  catch(e) {</span>
<a href="#l6.185"></a><span id="l6.185" class="difflineplus">+    datepicker.year = kDefaultYear;</span>
<a href="#l6.186"></a><span id="l6.186" class="difflineplus">+    // if there was an error (like invalid year) set the year and age to null</span>
<a href="#l6.187"></a><span id="l6.187" class="difflineplus">+    yearElem.value = null;</span>
<a href="#l6.188"></a><span id="l6.188" class="difflineplus">+    ageElem.value = null;</span>
<a href="#l6.189"></a><span id="l6.189" class="difflineplus">+  }</span>
<a href="#l6.190"></a><span id="l6.190" class="difflineplus">+}</span>
<a href="#l6.191"></a><span id="l6.191" class="difflineplus">+</span>
<a href="#l6.192"></a><span id="l6.192" class="difflineplus">+/**</span>
<a href="#l6.193"></a><span id="l6.193" class="difflineplus">+ * Calculates the year an event ocurred based on the number of years, months,</span>
<a href="#l6.194"></a><span id="l6.194" class="difflineplus">+ * and days since the event and updates the relevant element.</span>
<a href="#l6.195"></a><span id="l6.195" class="difflineplus">+ * @param aEvent   The event calling this method.</span>
<a href="#l6.196"></a><span id="l6.196" class="difflineplus">+ * @param aElement Optional, but required if this function is not called from an</span>
<a href="#l6.197"></a><span id="l6.197" class="difflineplus">+ *                 element's event listener. The element that would call this.</span>
<a href="#l6.198"></a><span id="l6.198" class="difflineplus">+ */</span>
<a href="#l6.199"></a><span id="l6.199" class="difflineplus">+function calculateYear(aEvent, aElement) {</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineplus">+  var yearElem, datepicker;</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineplus">+  if (aEvent)</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineplus">+    aElement = this;</span>
<a href="#l6.203"></a><span id="l6.203" class="difflineplus">+  if (aElement.id == &quot;Age&quot;) {</span>
<a href="#l6.204"></a><span id="l6.204" class="difflineplus">+    yearElem = document.getElementById(&quot;BirthYear&quot;);</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineplus">+    datepicker = document.getElementById(&quot;Birthday&quot;);</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineplus">+  }</span>
<a href="#l6.207"></a><span id="l6.207" class="difflineplus">+  if (!yearElem || !datepicker)</span>
<a href="#l6.208"></a><span id="l6.208" class="difflineplus">+    return;</span>
<a href="#l6.209"></a><span id="l6.209" class="difflineplus">+</span>
<a href="#l6.210"></a><span id="l6.210" class="difflineplus">+  // if the age is null, remove the year from the year element, and set the</span>
<a href="#l6.211"></a><span id="l6.211" class="difflineplus">+  // datepicker to the default year</span>
<a href="#l6.212"></a><span id="l6.212" class="difflineplus">+  if (!aElement.value) {</span>
<a href="#l6.213"></a><span id="l6.213" class="difflineplus">+    datepicker.year = kDefaultYear;</span>
<a href="#l6.214"></a><span id="l6.214" class="difflineplus">+    yearElem.value = null;</span>
<a href="#l6.215"></a><span id="l6.215" class="difflineplus">+    return;</span>
<a href="#l6.216"></a><span id="l6.216" class="difflineplus">+  }</span>
<a href="#l6.217"></a><span id="l6.217" class="difflineplus">+  var today = new Date();</span>
<a href="#l6.218"></a><span id="l6.218" class="difflineplus">+  try {</span>
<a href="#l6.219"></a><span id="l6.219" class="difflineplus">+    var date = new Date(aElement.value, datepicker.month, datepicker.date);</span>
<a href="#l6.220"></a><span id="l6.220" class="difflineplus">+    date.setFullYear(aElement.value);</span>
<a href="#l6.221"></a><span id="l6.221" class="difflineplus">+    // get the difference between today and the age (the year is offset by 1970)</span>
<a href="#l6.222"></a><span id="l6.222" class="difflineplus">+    var difference = new Date(today - date);</span>
<a href="#l6.223"></a><span id="l6.223" class="difflineplus">+    datepicker.year = yearElem.value = difference.getFullYear() - 1970;</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineplus">+  }</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineplus">+  // the above code may throw an invalid year exception.  If that happens, set</span>
<a href="#l6.226"></a><span id="l6.226" class="difflineplus">+  // the year to kDefaultYear and set the year element's value to 0</span>
<a href="#l6.227"></a><span id="l6.227" class="difflineplus">+  catch (e) {</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineplus">+    datepicker.year = kDefaultYear;</span>
<a href="#l6.229"></a><span id="l6.229" class="difflineplus">+    // if there was an error (like invalid year) set the year and age to null</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineplus">+    yearElem.value = null;</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineplus">+    ageElem.value = null;</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineplus">+  }</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineplus">+}</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineplus">+</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineplus">+/**</span>
<a href="#l6.236"></a><span id="l6.236" class="difflineplus">+ * Modifies a datepicker in the following ways:</span>
<a href="#l6.237"></a><span id="l6.237" class="difflineplus">+ *  - Removes the scroll arrows</span>
<a href="#l6.238"></a><span id="l6.238" class="difflineplus">+ *  - Hides the year</span>
<a href="#l6.239"></a><span id="l6.239" class="difflineplus">+ *  - Allows the day and month to be blank</span>
<a href="#l6.240"></a><span id="l6.240" class="difflineplus">+ * NOTE:</span>
<a href="#l6.241"></a><span id="l6.241" class="difflineplus">+ * The datepicker's date, month, year, and dateValue properties are not always</span>
<a href="#l6.242"></a><span id="l6.242" class="difflineplus">+ * what appear physically to the user in the datepicker fields.</span>
<a href="#l6.243"></a><span id="l6.243" class="difflineplus">+ * If any field is blank, the corresponding property is either the previous</span>
<a href="#l6.244"></a><span id="l6.244" class="difflineplus">+ * value if there was one since the card was opened or the relevant portion of</span>
<a href="#l6.245"></a><span id="l6.245" class="difflineplus">+ * the current date.</span>
<a href="#l6.246"></a><span id="l6.246" class="difflineplus">+ * </span>
<a href="#l6.247"></a><span id="l6.247" class="difflineplus">+ * To get the displayed values, get the value of the individual field, such as</span>
<a href="#l6.248"></a><span id="l6.248" class="difflineplus">+ * datepicker.yyyyField.value where yyyy is &quot;year&quot;, &quot;month&quot;, or &quot;date&quot; for the</span>
<a href="#l6.249"></a><span id="l6.249" class="difflineplus">+ * year, month, and day, respectively.</span>
<a href="#l6.250"></a><span id="l6.250" class="difflineplus">+ * If the value is null, then the field is blank and vice versa.</span>
<a href="#l6.251"></a><span id="l6.251" class="difflineplus">+ * @param aDatepicker The datepicker to modify.</span>
<a href="#l6.252"></a><span id="l6.252" class="difflineplus">+ */</span>
<a href="#l6.253"></a><span id="l6.253" class="difflineplus">+function modifyDatepicker(aDatepicker) {</span>
<a href="#l6.254"></a><span id="l6.254" class="difflineplus">+  // collapse the year field and separator</span>
<a href="#l6.255"></a><span id="l6.255" class="difflineplus">+  aDatepicker.yearField.parentNode.collapsed = true;</span>
<a href="#l6.256"></a><span id="l6.256" class="difflineplus">+  if (aDatepicker.yearField == aDatepicker._fieldThree ||</span>
<a href="#l6.257"></a><span id="l6.257" class="difflineplus">+      aDatepicker.yearField == aDatepicker._fieldTwo)</span>
<a href="#l6.258"></a><span id="l6.258" class="difflineplus">+    aDatepicker._separatorSecond.collapsed = true;</span>
<a href="#l6.259"></a><span id="l6.259" class="difflineplus">+  else</span>
<a href="#l6.260"></a><span id="l6.260" class="difflineplus">+    aDatepicker._separatorFirst.collapsed = true;</span>
<a href="#l6.261"></a><span id="l6.261" class="difflineplus">+  // collapse the spinner element</span>
<a href="#l6.262"></a><span id="l6.262" class="difflineplus">+  document.getAnonymousElementByAttribute(aDatepicker, &quot;anonid&quot;, &quot;buttons&quot;)</span>
<a href="#l6.263"></a><span id="l6.263" class="difflineplus">+          .collapsed = true;</span>
<a href="#l6.264"></a><span id="l6.264" class="difflineplus">+  // this modified constrain value function ignores values less than the minimum</span>
<a href="#l6.265"></a><span id="l6.265" class="difflineplus">+  // to let the value be blank (null)</span>
<a href="#l6.266"></a><span id="l6.266" class="difflineplus">+  // from: mozilla/toolkit/content/widgets/datetimepicker.xml#759</span>
<a href="#l6.267"></a><span id="l6.267" class="difflineplus">+  aDatepicker._constrainValue = function newConstrainValue(aField, aValue, aNoWrap) {</span>
<a href="#l6.268"></a><span id="l6.268" class="difflineplus">+    // if the value is less than one, make the field's value null</span>
<a href="#l6.269"></a><span id="l6.269" class="difflineplus">+    if (aValue &lt; 1) {</span>
<a href="#l6.270"></a><span id="l6.270" class="difflineplus">+      aField.value = null;</span>
<a href="#l6.271"></a><span id="l6.271" class="difflineplus">+      return null;</span>
<a href="#l6.272"></a><span id="l6.272" class="difflineplus">+    }</span>
<a href="#l6.273"></a><span id="l6.273" class="difflineplus">+    if (aNoWrap &amp;&amp; aField == this.monthField)</span>
<a href="#l6.274"></a><span id="l6.274" class="difflineplus">+      aValue--;</span>
<a href="#l6.275"></a><span id="l6.275" class="difflineplus">+    // make sure the date is valid for the given month</span>
<a href="#l6.276"></a><span id="l6.276" class="difflineplus">+    if (aField == this.dateField) {</span>
<a href="#l6.277"></a><span id="l6.277" class="difflineplus">+      var currentMonth = this.month;</span>
<a href="#l6.278"></a><span id="l6.278" class="difflineplus">+      var dt = new Date(this.year, currentMonth, aValue);</span>
<a href="#l6.279"></a><span id="l6.279" class="difflineplus">+      return dt.getMonth() != currentMonth ? 1 : aValue;</span>
<a href="#l6.280"></a><span id="l6.280" class="difflineplus">+    }</span>
<a href="#l6.281"></a><span id="l6.281" class="difflineplus">+    var max = (aField == this.monthField) ? 11 : 9999;</span>
<a href="#l6.282"></a><span id="l6.282" class="difflineplus">+    // make sure the value isn't too high</span>
<a href="#l6.283"></a><span id="l6.283" class="difflineplus">+    if (aValue &gt; max)</span>
<a href="#l6.284"></a><span id="l6.284" class="difflineplus">+      return aNoWrap ? max : min;</span>
<a href="#l6.285"></a><span id="l6.285" class="difflineplus">+    return aValue;</span>
<a href="#l6.286"></a><span id="l6.286" class="difflineplus">+  }</span>
<a href="#l6.287"></a><span id="l6.287" class="difflineplus">+  // sets the specified field to the given value, but allows blank fields</span>
<a href="#l6.288"></a><span id="l6.288" class="difflineplus">+  // from: mozilla/toolkit/content/widgets/datetimepicker.xml#698</span>
<a href="#l6.289"></a><span id="l6.289" class="difflineplus">+  aDatepicker._setFieldValue = function setValue(aField, aValue) {</span>
<a href="#l6.290"></a><span id="l6.290" class="difflineplus">+    if (aField == this.yearField &amp;&amp; aValue &gt; 0 &amp;&amp; aValue &lt; 10000) {</span>
<a href="#l6.291"></a><span id="l6.291" class="difflineplus">+      var oldDate = this._dateValue;</span>
<a href="#l6.292"></a><span id="l6.292" class="difflineplus">+      this._dateValue.setFullYear(aValue);</span>
<a href="#l6.293"></a><span id="l6.293" class="difflineplus">+      if (oldDate != this._dateValue) {</span>
<a href="#l6.294"></a><span id="l6.294" class="difflineplus">+        this._dateValue.setDate(0);</span>
<a href="#l6.295"></a><span id="l6.295" class="difflineplus">+        this._updateUI(this.dateField, this.date);</span>
<a href="#l6.296"></a><span id="l6.296" class="difflineplus">+      }</span>
<a href="#l6.297"></a><span id="l6.297" class="difflineplus">+    }</span>
<a href="#l6.298"></a><span id="l6.298" class="difflineplus">+    // update the month if the value isn't null</span>
<a href="#l6.299"></a><span id="l6.299" class="difflineplus">+    else if (aField == this.monthField &amp;&amp; aValue != null) {</span>
<a href="#l6.300"></a><span id="l6.300" class="difflineplus">+      var oldDate = this.date;</span>
<a href="#l6.301"></a><span id="l6.301" class="difflineplus">+      this._dateValue.setMonth(aValue);</span>
<a href="#l6.302"></a><span id="l6.302" class="difflineplus">+      if (oldDate != this.date)</span>
<a href="#l6.303"></a><span id="l6.303" class="difflineplus">+        this._dateValue.setDate(0);</span>
<a href="#l6.304"></a><span id="l6.304" class="difflineplus">+      this._updateUI(this.dateField, this.date);</span>
<a href="#l6.305"></a><span id="l6.305" class="difflineplus">+      var date = this._dateValue.getDate();</span>
<a href="#l6.306"></a><span id="l6.306" class="difflineplus">+      this.dateField.value = date &lt; 10 ? &quot;0&quot; + date : date;</span>
<a href="#l6.307"></a><span id="l6.307" class="difflineplus">+      var month = this._dateValue.getMonth() + 1;</span>
<a href="#l6.308"></a><span id="l6.308" class="difflineplus">+      this.monthField.value = month &lt; 10 ? &quot;0&quot; + month : month;</span>
<a href="#l6.309"></a><span id="l6.309" class="difflineplus">+    }</span>
<a href="#l6.310"></a><span id="l6.310" class="difflineplus">+    // update the date if the value isn't null</span>
<a href="#l6.311"></a><span id="l6.311" class="difflineplus">+    else if (aField == this.dateField &amp;&amp; aValue != null) {</span>
<a href="#l6.312"></a><span id="l6.312" class="difflineplus">+      this._dateValue.setDate(aValue);</span>
<a href="#l6.313"></a><span id="l6.313" class="difflineplus">+      this._updateUI(this.dateField, this.date);</span>
<a href="#l6.314"></a><span id="l6.314" class="difflineplus">+      var date = this._dateValue.getDate();</span>
<a href="#l6.315"></a><span id="l6.315" class="difflineplus">+      this.dateField.value = date &lt; 10 ? &quot;0&quot; + date : date;</span>
<a href="#l6.316"></a><span id="l6.316" class="difflineplus">+      var month = this._dateValue.getMonth() + 1;</span>
<a href="#l6.317"></a><span id="l6.317" class="difflineplus">+      this.monthField.value = month &lt; 10 ? &quot;0&quot; + month : month;</span>
<a href="#l6.318"></a><span id="l6.318" class="difflineplus">+    }</span>
<a href="#l6.319"></a><span id="l6.319" class="difflineplus">+    this.setAttribute(&quot;value&quot;, this.value);</span>
<a href="#l6.320"></a><span id="l6.320" class="difflineplus">+</span>
<a href="#l6.321"></a><span id="l6.321" class="difflineplus">+    if (this.attachedControl)</span>
<a href="#l6.322"></a><span id="l6.322" class="difflineplus">+      this.attachedControl._setValueNoSync(this._dateValue);</span>
<a href="#l6.323"></a><span id="l6.323" class="difflineplus">+    // if the aField's value is null or 0, set both field's values to null</span>
<a href="#l6.324"></a><span id="l6.324" class="difflineplus">+    if (!aField.value &amp;&amp; aField != this.yearField) {</span>
<a href="#l6.325"></a><span id="l6.325" class="difflineplus">+      this.dateField.value = null;</span>
<a href="#l6.326"></a><span id="l6.326" class="difflineplus">+      this.monthField.value = null;</span>
<a href="#l6.327"></a><span id="l6.327" class="difflineplus">+    }</span>
<a href="#l6.328"></a><span id="l6.328" class="difflineplus">+    // make the field's value null if aValue is null and the field's value isn't</span>
<a href="#l6.329"></a><span id="l6.329" class="difflineplus">+    if (aValue == null &amp;&amp; aField.value != null)</span>
<a href="#l6.330"></a><span id="l6.330" class="difflineplus">+      aField.value = null;</span>
<a href="#l6.331"></a><span id="l6.331" class="difflineplus">+  }</span>
<a href="#l6.332"></a><span id="l6.332" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/addrbook/resources/content/abCardOverlay.xul</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/addrbook/resources/content/abCardOverlay.xul</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -345,35 +345,59 @@</span>
<a href="#l7.4"></a><span id="l7.4">               &lt;/hbox&gt;</span>
<a href="#l7.5"></a><span id="l7.5">             &lt;/hbox&gt;</span>
<a href="#l7.6"></a><span id="l7.6">           &lt;/vbox&gt;</span>
<a href="#l7.7"></a><span id="l7.7">         &lt;/groupbox&gt;</span>
<a href="#l7.8"></a><span id="l7.8">       &lt;/vbox&gt;</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">       &lt;!-- ** Other Tab ** --&gt;</span>
<a href="#l7.11"></a><span id="l7.11">       &lt;vbox index=&quot;other&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+        &lt;vbox id=&quot;birthdayField&quot; class=&quot;alignBoxWithFieldset&quot;&gt;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+          &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+            &lt;label control=&quot;Birthday&quot; value=&quot;&amp;Birthday.label;&quot; accesskey=&quot;&amp;Birthday.accesskey;&quot; class=&quot;CardEditLabel&quot;/&gt;</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+            &lt;hbox class=&quot;CardEditWidth&quot;&gt;</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+              &lt;!-- NOTE: This datepicker is modified.  See abCardOverlay.js for details--&gt;</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+              &lt;datepicker id=&quot;Birthday&quot; type=&quot;popup&quot;/&gt;</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+              &lt;textbox id=&quot;BirthYear&quot; maxlength=&quot;4&quot; emptytext=&quot;&amp;Year.emptytext;&quot; width=&quot;60&quot;/&gt;</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+              &lt;label control=&quot;Age&quot; value=&quot;&amp;Or.value;&quot; class=&quot;CardEditLabel&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+              &lt;textbox id=&quot;Age&quot; maxlength=&quot;4&quot; emptytext=&quot;&amp;Age.emptytext;&quot; width=&quot;60&quot;/&gt;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+        &lt;/vbox&gt;</span>
<a href="#l7.25"></a><span id="l7.25">         &lt;vbox id=&quot;customFields&quot; class=&quot;alignBoxWithFieldset&quot;&gt;</span>
<a href="#l7.26"></a><span id="l7.26">           &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l7.28"></a><span id="l7.28">             &lt;label control=&quot;Custom1&quot; value=&quot;&amp;Custom1.label;&quot; accesskey=&quot;&amp;Custom1.accesskey;&quot; class=&quot;CardEditLabel&quot;/&gt;</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-            &lt;textbox id=&quot;Custom1&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-          &lt;/hbox&gt;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-          &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-            &lt;label control=&quot;Custom2&quot; value=&quot;&amp;Custom2.label;&quot; accesskey=&quot;&amp;Custom2.accesskey;&quot; class=&quot;CardEditLabel&quot;/&gt;</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-            &lt;textbox id=&quot;Custom2&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+            &lt;hbox class=&quot;CardEditWidth&quot;&gt;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+              &lt;textbox id=&quot;Custom1&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l7.37"></a><span id="l7.37">           &lt;/hbox&gt;</span>
<a href="#l7.38"></a><span id="l7.38">           &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">-            &lt;label control=&quot;Custom3&quot; value=&quot;&amp;Custom3.label;&quot; accesskey=&quot;&amp;Custom3.accesskey;&quot; class=&quot;CardEditLabel&quot;/&gt;</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-            &lt;textbox id=&quot;Custom3&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+            &lt;label control=&quot;Custom2&quot; value=&quot;&amp;Custom2.label;&quot; accesskey=&quot;&amp;Custom2.accesskey;&quot; class=&quot;CardEditLabel&quot;/&gt;</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+            &lt;hbox class=&quot;CardEditWidth&quot;&gt;</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+              &lt;textbox id=&quot;Custom2&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l7.46"></a><span id="l7.46">           &lt;/hbox&gt;</span>
<a href="#l7.47"></a><span id="l7.47">           &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+            &lt;label control=&quot;Custom3&quot; value=&quot;&amp;Custom3.label;&quot; accesskey=&quot;&amp;Custom3.accesskey;&quot; class=&quot;CardEditLabel&quot;/&gt;</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+            &lt;hbox class=&quot;CardEditWidth&quot;&gt;</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+              &lt;textbox id=&quot;Custom3&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+          &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l7.56"></a><span id="l7.56">             &lt;label control=&quot;Custom4&quot; value=&quot;&amp;Custom4.label;&quot; accesskey=&quot;&amp;Custom4.accesskey;&quot; class=&quot;CardEditLabel&quot;/&gt;</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-            &lt;textbox id=&quot;Custom4&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+            &lt;hbox class=&quot;CardEditWidth&quot;&gt;</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+              &lt;textbox id=&quot;Custom4&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l7.61"></a><span id="l7.61">           &lt;/hbox&gt;</span>
<a href="#l7.62"></a><span id="l7.62">         &lt;/vbox&gt;</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-</span>
<a href="#l7.64"></a><span id="l7.64">         &lt;groupbox flex=&quot;1&quot;&gt;</span>
<a href="#l7.65"></a><span id="l7.65">           &lt;caption&gt;</span>
<a href="#l7.66"></a><span id="l7.66">             &lt;label control=&quot;Notes&quot; value=&quot;&amp;Notes.box;&quot; accesskey=&quot;&amp;Notes.accesskey;&quot;/&gt;</span>
<a href="#l7.67"></a><span id="l7.67">           &lt;/caption&gt;</span>
<a href="#l7.68"></a><span id="l7.68">           &lt;textbox id=&quot;Notes&quot; multiline=&quot;true&quot; wrap=&quot;virtual&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l7.69"></a><span id="l7.69">         &lt;/groupbox&gt;</span>
<a href="#l7.70"></a><span id="l7.70"> </span>
<a href="#l7.71"></a><span id="l7.71">       &lt;/vbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/addrbook/resources/content/abCardViewOverlay.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/addrbook/resources/content/abCardViewOverlay.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -58,16 +58,17 @@ var zSecondaryEmail;</span>
<a href="#l8.4"></a><span id="l8.4"> var zScreenName;</span>
<a href="#l8.5"></a><span id="l8.5"> var zNickname;</span>
<a href="#l8.6"></a><span id="l8.6"> var zDisplayName;</span>
<a href="#l8.7"></a><span id="l8.7"> var zWork;</span>
<a href="#l8.8"></a><span id="l8.8"> var zHome;</span>
<a href="#l8.9"></a><span id="l8.9"> var zFax;</span>
<a href="#l8.10"></a><span id="l8.10"> var zCellular;</span>
<a href="#l8.11"></a><span id="l8.11"> var zPager;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+var zBirthday;</span>
<a href="#l8.13"></a><span id="l8.13"> var zCustom1;</span>
<a href="#l8.14"></a><span id="l8.14"> var zCustom2;</span>
<a href="#l8.15"></a><span id="l8.15"> var zCustom3;</span>
<a href="#l8.16"></a><span id="l8.16"> var zCustom4;</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18"> var cvData;</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20"> function OnLoadCardView()</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineat">@@ -78,16 +79,17 @@ function OnLoadCardView()</span>
<a href="#l8.22"></a><span id="l8.22">   zNickname = gAddressBookBundle.getString(&quot;propertyNickname&quot;);</span>
<a href="#l8.23"></a><span id="l8.23">   zDisplayName = gAddressBookBundle.getString(&quot;propertyDisplayName&quot;);</span>
<a href="#l8.24"></a><span id="l8.24">   zListName = gAddressBookBundle.getString(&quot;propertyListName&quot;);</span>
<a href="#l8.25"></a><span id="l8.25">   zWork = gAddressBookBundle.getString(&quot;propertyWork&quot;);</span>
<a href="#l8.26"></a><span id="l8.26">   zHome = gAddressBookBundle.getString(&quot;propertyHome&quot;);</span>
<a href="#l8.27"></a><span id="l8.27">   zFax = gAddressBookBundle.getString(&quot;propertyFax&quot;);</span>
<a href="#l8.28"></a><span id="l8.28">   zCellular = gAddressBookBundle.getString(&quot;propertyCellular&quot;);</span>
<a href="#l8.29"></a><span id="l8.29">   zPager = gAddressBookBundle.getString(&quot;propertyPager&quot;);</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+  zBirthday = gAddressBookBundle.getString(&quot;propertyBirthday&quot;);</span>
<a href="#l8.31"></a><span id="l8.31">   zCustom1 = gAddressBookBundle.getString(&quot;propertyCustom1&quot;);</span>
<a href="#l8.32"></a><span id="l8.32">   zCustom2 = gAddressBookBundle.getString(&quot;propertyCustom2&quot;);</span>
<a href="#l8.33"></a><span id="l8.33">   zCustom3 = gAddressBookBundle.getString(&quot;propertyCustom3&quot;);</span>
<a href="#l8.34"></a><span id="l8.34">   zCustom4 = gAddressBookBundle.getString(&quot;propertyCustom4&quot;);</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36"> 	var doc = document;</span>
<a href="#l8.37"></a><span id="l8.37"> 	</span>
<a href="#l8.38"></a><span id="l8.38"> 	/* data for address book, prefixes: &quot;cvb&quot; = card view box</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineat">@@ -122,16 +124,17 @@ function OnLoadCardView()</span>
<a href="#l8.40"></a><span id="l8.40"> 	cvData.cvHomeCityStZip	= doc.getElementById(&quot;cvHomeCityStZip&quot;);</span>
<a href="#l8.41"></a><span id="l8.41"> 	cvData.cvHomeCountry	= doc.getElementById(&quot;cvHomeCountry&quot;);</span>
<a href="#l8.42"></a><span id="l8.42">   cvData.cvbHomeMapItBox  = doc.getElementById(&quot;cvbHomeMapItBox&quot;);</span>
<a href="#l8.43"></a><span id="l8.43">   cvData.cvHomeMapIt = doc.getElementById(&quot;cvHomeMapIt&quot;);</span>
<a href="#l8.44"></a><span id="l8.44"> 	cvData.cvHomeWebPageBox = doc.getElementById(&quot;cvHomeWebPageBox&quot;);</span>
<a href="#l8.45"></a><span id="l8.45"> 	cvData.cvHomeWebPage	= doc.getElementById(&quot;cvHomeWebPage&quot;);</span>
<a href="#l8.46"></a><span id="l8.46"> 	// Other section</span>
<a href="#l8.47"></a><span id="l8.47"> 	cvData.cvbOther			= doc.getElementById(&quot;cvbOther&quot;);</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+	cvData.cvBirthday   = doc.getElementById(&quot;cvBirthday&quot;);</span>
<a href="#l8.49"></a><span id="l8.49"> 	cvData.cvhOther			= doc.getElementById(&quot;cvhOther&quot;);</span>
<a href="#l8.50"></a><span id="l8.50"> 	cvData.cvCustom1		= doc.getElementById(&quot;cvCustom1&quot;);</span>
<a href="#l8.51"></a><span id="l8.51"> 	cvData.cvCustom2		= doc.getElementById(&quot;cvCustom2&quot;);</span>
<a href="#l8.52"></a><span id="l8.52"> 	cvData.cvCustom3		= doc.getElementById(&quot;cvCustom3&quot;);</span>
<a href="#l8.53"></a><span id="l8.53"> 	cvData.cvCustom4		= doc.getElementById(&quot;cvCustom4&quot;);</span>
<a href="#l8.54"></a><span id="l8.54"> 	cvData.cvNotes			= doc.getElementById(&quot;cvNotes&quot;);</span>
<a href="#l8.55"></a><span id="l8.55">   // Description section (mailing lists only)</span>
<a href="#l8.56"></a><span id="l8.56">   cvData.cvbDescription			= doc.getElementById(&quot;cvbDescription&quot;);</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineat">@@ -287,17 +290,35 @@ function DisplayCardViewPane(realCard)</span>
<a href="#l8.58"></a><span id="l8.58"> 	  visible = cvAddAddressNodes(data.cvAddresses, card.mailListURI);</span>
<a href="#l8.59"></a><span id="l8.59">   	cvSetVisible(data.cvbAddresses, visible);</span>
<a href="#l8.60"></a><span id="l8.60">  </span>
<a href="#l8.61"></a><span id="l8.61">     // Other section, not shown for mailing lists.</span>
<a href="#l8.62"></a><span id="l8.62">     cvSetVisible(data.cvbOther, false);</span>
<a href="#l8.63"></a><span id="l8.63">   }</span>
<a href="#l8.64"></a><span id="l8.64">   else {</span>
<a href="#l8.65"></a><span id="l8.65"> 	  // Other section</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-	  visible = cvSetNodeWithLabel(data.cvCustom1, zCustom1, card.getProperty(&quot;Custom1&quot;));</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+    /// setup the birthday information</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+    var day = card.getProperty(&quot;BirthDay&quot;, null);</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+    var month = card.getProperty(&quot;BirthMonth&quot;, null);</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+    var year = card.getProperty(&quot;BirthYear&quot;, null);</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+    var dateStr;</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+    if (day || month) {</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+      var date = (new Date(year, parseInt(month) - 1, day));</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+      // if the year exists, just use Date.toLocaleString</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+      if (year)</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+        dateStr = date.toLocaleDateString();</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+      // if the year doesn't exist, display Month DD (ex. January 01)</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+      else</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+        dateStr = date.toLocaleFormat(gAddressBookBundle.getString(&quot;dateformat&quot;));</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+    }</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineplus">+    else if (year)</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+      dateStr = year;</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineplus">+    visible = cvSetNodeWithLabel(data.cvBirthday, zBirthday, dateStr);</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+	  visible = cvSetNodeWithLabel(data.cvCustom1, zCustom1, card.getProperty(&quot;Custom1&quot;)) || visible;</span>
<a href="#l8.86"></a><span id="l8.86"> 	  visible = cvSetNodeWithLabel(data.cvCustom2, zCustom2, card.getProperty(&quot;Custom2&quot;)) || visible;</span>
<a href="#l8.87"></a><span id="l8.87"> 	  visible = cvSetNodeWithLabel(data.cvCustom3, zCustom3, card.getProperty(&quot;Custom3&quot;)) || visible;</span>
<a href="#l8.88"></a><span id="l8.88"> 	  visible = cvSetNodeWithLabel(data.cvCustom4, zCustom4, card.getProperty(&quot;Custom4&quot;)) || visible;</span>
<a href="#l8.89"></a><span id="l8.89"> 	  visible = cvSetNode(data.cvNotes, card.getProperty(&quot;Notes&quot;)) || visible;</span>
<a href="#l8.90"></a><span id="l8.90">     visible = setBuddyIcon(card, data.cvBuddyIcon) || visible;</span>
<a href="#l8.91"></a><span id="l8.91"> </span>
<a href="#l8.92"></a><span id="l8.92">     cvSetVisible(data.cvhOther, visible);</span>
<a href="#l8.93"></a><span id="l8.93">     cvSetVisible(data.cvbOther, visible);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/addrbook/resources/content/abCardViewOverlay.xul</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/addrbook/resources/content/abCardViewOverlay.xul</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -67,17 +67,16 @@</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">             &lt;description class=&quot;CardViewLink&quot; id=&quot;cvEmail1Box&quot;&gt;</span>
<a href="#l9.6"></a><span id="l9.6">               &lt;html:a href=&quot;&quot; id=&quot;cvEmail1&quot;/&gt;</span>
<a href="#l9.7"></a><span id="l9.7">             &lt;/description&gt;</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">             &lt;description class=&quot;CardViewLink&quot; id=&quot;cvEmail2Box&quot;&gt;</span>
<a href="#l9.10"></a><span id="l9.10">               &lt;html:a href=&quot;&quot; id=&quot;cvEmail2&quot;/&gt;</span>
<a href="#l9.11"></a><span id="l9.11">             &lt;/description&gt;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-</span>
<a href="#l9.13"></a><span id="l9.13">             &lt;description class=&quot;CardViewLink&quot; id=&quot;cvScreennameBox&quot;&gt;</span>
<a href="#l9.14"></a><span id="l9.14">               &lt;html:a href=&quot;&quot; id=&quot;cvScreenname&quot;/&gt;</span>
<a href="#l9.15"></a><span id="l9.15">               &lt;html:img onclick=&quot;GoIM()&quot; align=&quot;top&quot; id=&quot;cvAimPresence&quot;/&gt;</span>
<a href="#l9.16"></a><span id="l9.16">             &lt;/description&gt;</span>
<a href="#l9.17"></a><span id="l9.17">         &lt;/vbox&gt;</span>
<a href="#l9.18"></a><span id="l9.18">         </span>
<a href="#l9.19"></a><span id="l9.19">         &lt;vbox id=&quot;cvbHome&quot; class=&quot;cardViewGroup&quot;&gt;</span>
<a href="#l9.20"></a><span id="l9.20">           &lt;description class=&quot;CardViewHeading&quot; id=&quot;cvhHome&quot;&gt;&amp;home.heading;&lt;/description&gt;          </span>
<a href="#l9.21"></a><span id="l9.21" class="difflineat">@@ -94,16 +93,17 @@</span>
<a href="#l9.22"></a><span id="l9.22">           &lt;/hbox&gt;</span>
<a href="#l9.23"></a><span id="l9.23">           &lt;description class=&quot;CardViewLink&quot; id=&quot;cvHomeWebPageBox&quot;&gt;</span>
<a href="#l9.24"></a><span id="l9.24">             &lt;html:a onclick=&quot;return openLink('cvHomeWebPage');&quot; href=&quot;&quot; id=&quot;cvHomeWebPage&quot;/&gt;</span>
<a href="#l9.25"></a><span id="l9.25">           &lt;/description&gt;</span>
<a href="#l9.26"></a><span id="l9.26">         &lt;/vbox&gt;</span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28">         &lt;vbox id=&quot;cvbOther&quot; class=&quot;cardViewGroup&quot;&gt;</span>
<a href="#l9.29"></a><span id="l9.29">           &lt;description class=&quot;CardViewHeading&quot; id=&quot;cvhOther&quot;&gt;&amp;other.heading;&lt;/description&gt;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+          &lt;description class=&quot;CardViewText&quot; id=&quot;cvBirthday&quot;/&gt;</span>
<a href="#l9.31"></a><span id="l9.31">           &lt;description class=&quot;CardViewText&quot; id=&quot;cvCustom1&quot;/&gt;</span>
<a href="#l9.32"></a><span id="l9.32">           &lt;description class=&quot;CardViewText&quot; id=&quot;cvCustom2&quot;/&gt;</span>
<a href="#l9.33"></a><span id="l9.33">           &lt;description class=&quot;CardViewText&quot; id=&quot;cvCustom3&quot;/&gt;</span>
<a href="#l9.34"></a><span id="l9.34">           &lt;description class=&quot;CardViewText&quot; id=&quot;cvCustom4&quot;/&gt;</span>
<a href="#l9.35"></a><span id="l9.35">           &lt;description class=&quot;CardViewText&quot; id=&quot;cvNotes&quot; style=&quot;white-space: pre-wrap;&quot;/&gt;</span>
<a href="#l9.36"></a><span id="l9.36"> </span>
<a href="#l9.37"></a><span id="l9.37">           &lt;hbox&gt;</span>
<a href="#l9.38"></a><span id="l9.38">             &lt;image id=&quot;cvBuddyIcon&quot;/&gt; </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDIFService.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDIFService.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -429,16 +429,20 @@ void nsAbLDIFService::AddLdifColToDataba</span>
<a href="#l10.4"></a><span id="l10.4">   ToLowerCase(colType);</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6">   mdb_u1 firstByte = (mdb_u1)(colType.get())[0];</span>
<a href="#l10.7"></a><span id="l10.7">   switch ( firstByte )</span>
<a href="#l10.8"></a><span id="l10.8">   {</span>
<a href="#l10.9"></a><span id="l10.9">   case 'b':</span>
<a href="#l10.10"></a><span id="l10.10">     if (colType.EqualsLiteral(&quot;birthyear&quot;))</span>
<a href="#l10.11"></a><span id="l10.11">       mDatabase-&gt;AddBirthYear(newRow, column.get());</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+    else if (colType.EqualsLiteral(&quot;birthmonth&quot;))</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+      mDatabase-&gt;AddBirthMonth(newRow, column.get());</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+    else if (colType.EqualsLiteral(&quot;birthday&quot;))</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+      mDatabase-&gt;AddBirthDay(newRow, column.get());</span>
<a href="#l10.16"></a><span id="l10.16">     break; // 'b'</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18">   case 'c':</span>
<a href="#l10.19"></a><span id="l10.19">     if (colType.EqualsLiteral(&quot;cn&quot;) || colType.EqualsLiteral(&quot;commonname&quot;))</span>
<a href="#l10.20"></a><span id="l10.20">     {</span>
<a href="#l10.21"></a><span id="l10.21">       if (bIsList)</span>
<a href="#l10.22"></a><span id="l10.22">         mDatabase-&gt;AddListName(newRow, column.get());</span>
<a href="#l10.23"></a><span id="l10.23">       else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -131,16 +131,21 @@</span>
<a href="#l11.4"></a><span id="l11.4"> &lt;!ENTITY WorkZipCode.accesskey          &quot;P&quot;&gt;</span>
<a href="#l11.5"></a><span id="l11.5"> &lt;!ENTITY WorkCountry.label              &quot;Country:&quot;&gt;</span>
<a href="#l11.6"></a><span id="l11.6"> &lt;!ENTITY WorkCountry.accesskey          &quot;n&quot;&gt;</span>
<a href="#l11.7"></a><span id="l11.7"> &lt;!ENTITY WorkWebPage.label              &quot;Web Page:&quot;&gt;</span>
<a href="#l11.8"></a><span id="l11.8"> &lt;!ENTITY WorkWebPage.accesskey          &quot;b&quot;&gt;</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10"> &lt;!ENTITY Other.tab                      &quot;Other&quot;&gt;</span>
<a href="#l11.11"></a><span id="l11.11"> &lt;!ENTITY Other.accesskey                &quot;h&quot;&gt;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+&lt;!ENTITY Birthday.label                 &quot;Birthday:&quot;&gt;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+&lt;!ENTITY Birthday.accesskey             &quot;B&quot;&gt;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+&lt;!ENTITY Year.emptytext                 &quot;Year&quot;&gt;</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+&lt;!ENTITY Or.value                       &quot;or&quot;&gt;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+&lt;!ENTITY Age.emptytext                  &quot;Age&quot;&gt;</span>
<a href="#l11.17"></a><span id="l11.17"> &lt;!ENTITY Custom1.label                  &quot;Custom 1:&quot;&gt;</span>
<a href="#l11.18"></a><span id="l11.18"> &lt;!ENTITY Custom1.accesskey              &quot;1&quot;&gt;</span>
<a href="#l11.19"></a><span id="l11.19"> &lt;!ENTITY Custom2.label                  &quot;Custom 2:&quot;&gt;</span>
<a href="#l11.20"></a><span id="l11.20"> &lt;!ENTITY Custom2.accesskey              &quot;2&quot;&gt;</span>
<a href="#l11.21"></a><span id="l11.21"> &lt;!ENTITY Custom3.label                  &quot;Custom 3:&quot;&gt;</span>
<a href="#l11.22"></a><span id="l11.22"> &lt;!ENTITY Custom3.accesskey              &quot;3&quot;&gt;</span>
<a href="#l11.23"></a><span id="l11.23"> &lt;!ENTITY Custom4.label                  &quot;Custom 4:&quot;&gt;</span>
<a href="#l11.24"></a><span id="l11.24"> &lt;!ENTITY Custom4.accesskey              &quot;4&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -82,21 +82,29 @@ propertySecondaryEmail=Additional Email</span>
<a href="#l12.4"></a><span id="l12.4"> propertyScreenName=Screen Name</span>
<a href="#l12.5"></a><span id="l12.5"> propertyNickname=Nickname</span>
<a href="#l12.6"></a><span id="l12.6"> propertyDisplayName=Display Name</span>
<a href="#l12.7"></a><span id="l12.7"> propertyWork=Work</span>
<a href="#l12.8"></a><span id="l12.8"> propertyHome=Home</span>
<a href="#l12.9"></a><span id="l12.9"> propertyFax=Fax</span>
<a href="#l12.10"></a><span id="l12.10"> propertyCellular=Mobile</span>
<a href="#l12.11"></a><span id="l12.11"> propertyPager=Pager</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+propertyBirthday=Birthday</span>
<a href="#l12.13"></a><span id="l12.13"> propertyCustom1=Custom 1</span>
<a href="#l12.14"></a><span id="l12.14"> propertyCustom2=Custom 2</span>
<a href="#l12.15"></a><span id="l12.15"> propertyCustom3=Custom 3</span>
<a href="#l12.16"></a><span id="l12.16"> propertyCustom4=Custom 4</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+## LOCALIZATION NOTE (dateformat)</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+## Only used if the year isn't present and should be in the format used by Date.toLocaleFormat</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+## see http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Date/toLocaleFormat</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+## %B is the month's localized name and %e is the day of the month [1-31]</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+## Separators (a space, dash, etc.) can be used</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+dateformat=%B %e</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+</span>
<a href="#l12.25"></a><span id="l12.25"> ## LOCALIZATION NOTE (cityAndStateAndZip): </span>
<a href="#l12.26"></a><span id="l12.26"> ## %1$S is city, %2$S is state, %3$S is zip</span>
<a href="#l12.27"></a><span id="l12.27"> cityAndStateAndZip=%1$S, %2$S %3$S</span>
<a href="#l12.28"></a><span id="l12.28"> ## LOCALIZATION NOTE (cityAndStateNoZip): </span>
<a href="#l12.29"></a><span id="l12.29"> ## %1$S is city, %2$S is state</span>
<a href="#l12.30"></a><span id="l12.30"> cityAndStateNoZip=%1$S, %2$S</span>
<a href="#l12.31"></a><span id="l12.31"> ## LOCALIZATION NOTE (cityOrStateAndZip): </span>
<a href="#l12.32"></a><span id="l12.32"> ## %1$S is city or state, %2$S is zip</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

