<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25130:86c5e6686ff369415311612453b2b6c966683e72</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 86c5e6686ff369415311612453b2b6c966683e72" />
<meta property="og:url" content="/comm-central/rev/86c5e6686ff369415311612453b2b6c966683e72" />
<meta property="og:description" content="Bug 1503734 - Remove needless constants for nsMsgFolderFlags. r=jorgk DONTBUILD" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 86c5e6686ff369415311612453b2b6c966683e72 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/86c5e6686ff369415311612453b2b6c966683e72">shortlog</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/86c5e6686ff369415311612453b2b6c966683e72">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72">files</a> |
changeset |
<a href="/comm-central/raw-rev/86c5e6686ff369415311612453b2b6c966683e72">raw</a>  | <a href="/comm-central/archive/86c5e6686ff369415311612453b2b6c966683e72.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1503734">Bug 1503734</a> - Remove needless constants for nsMsgFolderFlags. r=jorgk DONTBUILD
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 31 Oct 2018 16:38:00 +0100</td></tr>

<tr>
 <td>changeset 25130</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/86c5e6686ff369415311612453b2b6c966683e72">86c5e6686ff369415311612453b2b6c966683e72</a></td>
</tr>



<tr>
<td>parent 25129</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/29028feb0c71338166c9d4fc24cbad6312334f4c">29028feb0c71338166c9d4fc24cbad6312334f4c</a>
</td>
</tr>

<tr>
<td>child 25131</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/87943872543e306a510525a2a02502564ff49f18">87943872543e306a510525a2a02502564ff49f18</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=86c5e6686ff369415311612453b2b6c966683e72">15086</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 01 Nov 2018 14:17:34 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@86c5e6686ff3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=86c5e6686ff369415311612453b2b6c966683e72">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=86c5e6686ff369415311612453b2b6c966683e72&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=86c5e6686ff369415311612453b2b6c966683e72&newProject=comm-central&newRevision=86c5e6686ff369415311612453b2b6c966683e72&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=86c5e6686ff369415311612453b2b6c966683e72&newProject=comm-central&newRevision=86c5e6686ff369415311612453b2b6c966683e72&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=86c5e6686ff369415311612453b2b6c966683e72&newProject=comm-central&newRevision=86c5e6686ff369415311612453b2b6c966683e72&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1503734">1503734</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1503734">Bug 1503734</a> - Remove needless constants for nsMsgFolderFlags. r=jorgk DONTBUILD</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderDisplay.js">mail/base/content/folderDisplay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderDisplay.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderDisplay.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderDisplay.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderDisplay.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderDisplay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderPane.js">mail/base/content/folderPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderPane.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderPane.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderPane.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderPane.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/folderPane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mail3PaneWindowCommands.js">mail/base/content/mail3PaneWindowCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mail3PaneWindowCommands.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mail3PaneWindowCommands.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mail3PaneWindowCommands.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mail3PaneWindowCommands.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mail3PaneWindowCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailContextMenus.js">mail/base/content/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailWindowOverlay.js">mail/base/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgMail3PaneWindow.js">mail/base/content/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgViewNavigation.js">mail/base/content/msgViewNavigation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgViewNavigation.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgViewNavigation.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgViewNavigation.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgViewNavigation.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/msgViewNavigation.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/phishingDetector.js">mail/base/content/phishingDetector.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/phishingDetector.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/phishingDetector.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/phishingDetector.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/phishingDetector.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/phishingDetector.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/threadPane.js">mail/base/content/threadPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/threadPane.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/threadPane.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/threadPane.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/threadPane.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/base/content/threadPane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/components/activity/modules/moveCopy.jsm">mail/components/activity/modules/moveCopy.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/components/activity/modules/moveCopy.jsm">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/components/activity/modules/moveCopy.jsm">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/components/activity/modules/moveCopy.jsm">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/components/activity/modules/moveCopy.jsm">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/components/activity/modules/moveCopy.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-pane/test-display-message-with-folder-modes.js">mail/test/mozmill/folder-pane/test-display-message-with-folder-modes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-pane/test-display-message-with-folder-modes.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-pane/test-display-message-with-folder-modes.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-pane/test-display-message-with-folder-modes.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-pane/test-display-message-with-folder-modes.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-pane/test-display-message-with-folder-modes.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">mail/test/mozmill/folder-tree-modes/test-mode-switching.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">mail/test/mozmill/folder-tree-modes/test-smart-folders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-unread-folders.js">mail/test/mozmill/folder-tree-modes/test-unread-folders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-unread-folders.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-unread-folders.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-unread-folders.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-unread-folders.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mail/test/mozmill/folder-tree-modes/test-unread-folders.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/folderProps.js">mailnews/base/content/folderProps.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/folderProps.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/folderProps.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/folderProps.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/folderProps.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/folderProps.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/msgSelectOfflineFolders.js">mailnews/base/content/msgSelectOfflineFolders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/msgSelectOfflineFolders.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/msgSelectOfflineFolders.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/msgSelectOfflineFolders.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/msgSelectOfflineFolders.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/content/msgSelectOfflineFolders.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/util/folderUtils.jsm">mailnews/base/util/folderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/util/folderUtils.jsm">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/util/folderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/util/folderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/util/folderUtils.jsm">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mailnews/base/util/folderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/gloda/modules/index_msg.js">mailnews/db/gloda/modules/index_msg.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/gloda/modules/index_msg.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/gloda/modules/index_msg.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/gloda/modules/index_msg.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/gloda/modules/index_msg.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/gloda/modules/index_msg.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">mailnews/db/msgdb/test/unit/test_filter_enumerator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_imapContentLength.js">mailnews/imap/test/unit/test_imapContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_imapContentLength.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_imapContentLength.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_imapContentLength.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_imapContentLength.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_imapContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_listSubscribed.js">mailnews/imap/test/unit/test_listSubscribed.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_listSubscribed.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_listSubscribed.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_listSubscribed.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_listSubscribed.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_listSubscribed.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_lsub.js">mailnews/imap/test/unit/test_lsub.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_lsub.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_lsub.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_lsub.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_lsub.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_lsub.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/86c5e6686ff369415311612453b2b6c966683e72/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">file</a> |
<a href="/comm-central/annotate/86c5e6686ff369415311612453b2b6c966683e72/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">annotate</a> |
<a href="/comm-central/diff/86c5e6686ff369415311612453b2b6c966683e72/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">diff</a> |
<a href="/comm-central/comparison/86c5e6686ff369415311612453b2b6c966683e72/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">comparison</a> |
<a href="/comm-central/log/86c5e6686ff369415311612453b2b6c966683e72/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/folderDisplay.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/folderDisplay.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -5,19 +5,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> ChromeUtils.import(&quot;resource:///modules/DBViewWrapper.jsm&quot;);</span>
<a href="#l1.5"></a><span id="l1.5"> ChromeUtils.import(&quot;resource:///modules/jsTreeSelection.js&quot;);</span>
<a href="#l1.6"></a><span id="l1.6"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l1.7"></a><span id="l1.7"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> var gFolderDisplay = null;</span>
<a href="#l1.10"></a><span id="l1.10"> var gMessageDisplay = null;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-var nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-var nsMsgMessageFlags = Ci.nsMsgMessageFlags;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-</span>
<a href="#l1.15"></a><span id="l1.15"> /**</span>
<a href="#l1.16"></a><span id="l1.16">  * Maintains a list of listeners for all FolderDisplayWidget instances in this</span>
<a href="#l1.17"></a><span id="l1.17">  *  window.  The assumption is that because of our multiplexed tab</span>
<a href="#l1.18"></a><span id="l1.18">  *  implementation all consumers are effectively going to care about all such</span>
<a href="#l1.19"></a><span id="l1.19">  *  tabs.</span>
<a href="#l1.20"></a><span id="l1.20">  *</span>
<a href="#l1.21"></a><span id="l1.21">  * We are not just a global list so that we can add brains about efficiently</span>
<a href="#l1.22"></a><span id="l1.22">  *  building lists, provide try-wrapper convenience, etc.</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineat">@@ -542,18 +539,16 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l1.24"></a><span id="l1.24">     this._persistColumnStates(this.getColumnStates());</span>
<a href="#l1.25"></a><span id="l1.25">   },</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">   /**</span>
<a href="#l1.28"></a><span id="l1.28">    * Either inherit the column state of another folder or use heuristics to</span>
<a href="#l1.29"></a><span id="l1.29">    *  figure out the best column state for the current folder.</span>
<a href="#l1.30"></a><span id="l1.30">    */</span>
<a href="#l1.31"></a><span id="l1.31">   _getDefaultColumnsForCurrentFolder: function(aDoNotInherit) {</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-    const InboxFlag = Ci.nsMsgFolderFlags.Inbox;</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-</span>
<a href="#l1.34"></a><span id="l1.34">     // If the view is synthetic, try asking it for its default columns. If it</span>
<a href="#l1.35"></a><span id="l1.35">     // fails, just return nothing, since most synthetic views don't care about</span>
<a href="#l1.36"></a><span id="l1.36">     // columns anyway.</span>
<a href="#l1.37"></a><span id="l1.37">     if (this.view.isSynthetic) {</span>
<a href="#l1.38"></a><span id="l1.38">       if (&quot;getDefaultSetting&quot; in this.view._syntheticView)</span>
<a href="#l1.39"></a><span id="l1.39">         return this.view._syntheticView.getDefaultSetting(&quot;columns&quot;);</span>
<a href="#l1.40"></a><span id="l1.40">       return {};</span>
<a href="#l1.41"></a><span id="l1.41">     }</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineat">@@ -570,24 +565,24 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l1.43"></a><span id="l1.43">     //    (Although we could try and see if they have opened any other news</span>
<a href="#l1.44"></a><span id="l1.44">     //    folders in the same account.  But it's not all that important to us.)</span>
<a href="#l1.45"></a><span id="l1.45">     // - It's an inbox!</span>
<a href="#l1.46"></a><span id="l1.46">     let doNotInherit = aDoNotInherit ||</span>
<a href="#l1.47"></a><span id="l1.47">       this.view.isOutgoingFolder ||</span>
<a href="#l1.48"></a><span id="l1.48">       this.view.isVirtual ||</span>
<a href="#l1.49"></a><span id="l1.49">       this.view.isMultiFolder ||</span>
<a href="#l1.50"></a><span id="l1.50">       this.view.isNewsFolder ||</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-      this.displayedFolder.flags &amp; InboxFlag;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+      this.displayedFolder.getFlag(Ci.nsMsgFolderFlags.Inbox);</span>
<a href="#l1.53"></a><span id="l1.53"> </span>
<a href="#l1.54"></a><span id="l1.54">     // Try and grab the inbox for this account's settings.  we may not be able</span>
<a href="#l1.55"></a><span id="l1.55">     //  to, in which case we just won't inherit.  (It ends up the same since the</span>
<a href="#l1.56"></a><span id="l1.56">     //  inbox is obviously not customized in this case.)</span>
<a href="#l1.57"></a><span id="l1.57">     if (!doNotInherit) {</span>
<a href="#l1.58"></a><span id="l1.58">       let inboxFolder =</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-        this.displayedFolder.rootFolder.getFolderWithFlags(InboxFlag);</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+        this.displayedFolder.rootFolder.getFolderWithFlags(Ci.nsMsgFolderFlags.Inbox);</span>
<a href="#l1.61"></a><span id="l1.61">       if (inboxFolder) {</span>
<a href="#l1.62"></a><span id="l1.62">         let state = this._depersistColumnStatesFromDbFolderInfo(</span>
<a href="#l1.63"></a><span id="l1.63">                       inboxFolder.msgDatabase.dBFolderInfo);</span>
<a href="#l1.64"></a><span id="l1.64">         // inbox message databases don't get closed as a matter of policy.</span>
<a href="#l1.65"></a><span id="l1.65"> </span>
<a href="#l1.66"></a><span id="l1.66">         if (state)</span>
<a href="#l1.67"></a><span id="l1.67">           return state;</span>
<a href="#l1.68"></a><span id="l1.68">       }</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineat">@@ -1900,17 +1895,17 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l1.70"></a><span id="l1.70">     // if we're doing next unread, and a collapsed thread is selected, and</span>
<a href="#l1.71"></a><span id="l1.71">     // the top level message is unread, just set the result manually to</span>
<a href="#l1.72"></a><span id="l1.72">     // the top level message, without using viewNavigate.</span>
<a href="#l1.73"></a><span id="l1.73">     if (summarizeSelection &amp;&amp;</span>
<a href="#l1.74"></a><span id="l1.74">         aNavType == nsMsgNavigationType.nextUnreadMessage &amp;&amp;</span>
<a href="#l1.75"></a><span id="l1.75">         currentIndex != -1 &amp;&amp;</span>
<a href="#l1.76"></a><span id="l1.76">         this.view.isCollapsedThreadAtIndex(currentIndex) &amp;&amp;</span>
<a href="#l1.77"></a><span id="l1.77">         !(this.view.dbView.getFlagsAt(currentIndex) &amp;</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-          nsMsgMessageFlags.Read)) {</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+          Ci.nsMsgMessageFlags.Read)) {</span>
<a href="#l1.80"></a><span id="l1.80">       viewIndex = currentIndex;</span>
<a href="#l1.81"></a><span id="l1.81">     }</span>
<a href="#l1.82"></a><span id="l1.82">     else {</span>
<a href="#l1.83"></a><span id="l1.83">       // always 'wrap' because the start index is relative to the selection.</span>
<a href="#l1.84"></a><span id="l1.84">       // (keep in mind that many forms of navigation do not care about the</span>
<a href="#l1.85"></a><span id="l1.85">       //  starting position or 'wrap' at all; for example, firstNew just finds</span>
<a href="#l1.86"></a><span id="l1.86">       //  the first new message.)</span>
<a href="#l1.87"></a><span id="l1.87">       // allegedly this does tree-expansion for us.</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineat">@@ -1996,27 +1991,27 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l1.89"></a><span id="l1.89">   },</span>
<a href="#l1.90"></a><span id="l1.90"> </span>
<a href="#l1.91"></a><span id="l1.91">   /**</span>
<a href="#l1.92"></a><span id="l1.92">    * @return true if there is a selected message and it's an IMAP message.</span>
<a href="#l1.93"></a><span id="l1.93">    */</span>
<a href="#l1.94"></a><span id="l1.94">   get selectedMessageIsImap() {</span>
<a href="#l1.95"></a><span id="l1.95">     let message = this.selectedMessage;</span>
<a href="#l1.96"></a><span id="l1.96">     return Boolean(message &amp;&amp; message.folder &amp;&amp;</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineminus">-                   message.folder.flags &amp; nsMsgFolderFlags.ImapBox);</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+                   message.folder.flags &amp; Ci.nsMsgFolderFlags.ImapBox);</span>
<a href="#l1.99"></a><span id="l1.99">   },</span>
<a href="#l1.100"></a><span id="l1.100"> </span>
<a href="#l1.101"></a><span id="l1.101">   /**</span>
<a href="#l1.102"></a><span id="l1.102">    * @return true if there is a selected message and it's a news message.  It</span>
<a href="#l1.103"></a><span id="l1.103">    *  would be great if messages knew this about themselves, but they don't.</span>
<a href="#l1.104"></a><span id="l1.104">    */</span>
<a href="#l1.105"></a><span id="l1.105">   get selectedMessageIsNews() {</span>
<a href="#l1.106"></a><span id="l1.106">     let message = this.selectedMessage;</span>
<a href="#l1.107"></a><span id="l1.107">     return Boolean(message &amp;&amp; message.folder &amp;&amp;</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineminus">-                   (message.folder.flags &amp; nsMsgFolderFlags.Newsgroup));</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineplus">+                   (message.folder.flags &amp; Ci.nsMsgFolderFlags.Newsgroup));</span>
<a href="#l1.110"></a><span id="l1.110">   },</span>
<a href="#l1.111"></a><span id="l1.111"> </span>
<a href="#l1.112"></a><span id="l1.112">   /**</span>
<a href="#l1.113"></a><span id="l1.113">    * @return true if there is a selected message and it's an external message,</span>
<a href="#l1.114"></a><span id="l1.114">    *  meaning it is loaded from an .eml file on disk or is an rfc822 attachment</span>
<a href="#l1.115"></a><span id="l1.115">    *  on a message.</span>
<a href="#l1.116"></a><span id="l1.116">    */</span>
<a href="#l1.117"></a><span id="l1.117">   get selectedMessageIsExternal() {</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineat">@@ -2043,17 +2038,17 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l1.119"></a><span id="l1.119"> </span>
<a href="#l1.120"></a><span id="l1.120">   /**</span>
<a href="#l1.121"></a><span id="l1.121">    * @return true if there is a selected message and the message is the base</span>
<a href="#l1.122"></a><span id="l1.122">    *              message for an ignored subthread.</span>
<a href="#l1.123"></a><span id="l1.123">    */</span>
<a href="#l1.124"></a><span id="l1.124">   get selectedMessageSubthreadIgnored() {</span>
<a href="#l1.125"></a><span id="l1.125">     let message = this.selectedMessage;</span>
<a href="#l1.126"></a><span id="l1.126">     return Boolean(message &amp;&amp; message.folder &amp;&amp;</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineminus">-                   (message.flags &amp; nsMsgMessageFlags.Ignored));</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineplus">+                   (message.flags &amp; Ci.nsMsgMessageFlags.Ignored));</span>
<a href="#l1.129"></a><span id="l1.129">   },</span>
<a href="#l1.130"></a><span id="l1.130"> </span>
<a href="#l1.131"></a><span id="l1.131">   /**</span>
<a href="#l1.132"></a><span id="l1.132">    * @return true if there is a selected message and the message belongs to a</span>
<a href="#l1.133"></a><span id="l1.133">    *              watched thread.</span>
<a href="#l1.134"></a><span id="l1.134">    */</span>
<a href="#l1.135"></a><span id="l1.135">   get selectedMessageThreadWatched() {</span>
<a href="#l1.136"></a><span id="l1.136">     let message = this.selectedMessage;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/folderPane.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/folderPane.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -15,18 +15,16 @@ ChromeUtils.import(&quot;resource:///modules/</span>
<a href="#l2.4"></a><span id="l2.4"> ChromeUtils.import(&quot;resource:///modules/FeedUtils.jsm&quot;);</span>
<a href="#l2.5"></a><span id="l2.5"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> if (typeof FeedMessageHandler != &quot;object&quot;)</span>
<a href="#l2.8"></a><span id="l2.8">   Services.scriptloader.loadSubScript(&quot;chrome://messenger-newsblog/content/newsblogOverlay.js&quot;);</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> var kDefaultMode = &quot;all&quot;;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-var nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-</span>
<a href="#l2.14"></a><span id="l2.14"> /**</span>
<a href="#l2.15"></a><span id="l2.15">  * This file contains the controls and functions for the folder pane.</span>
<a href="#l2.16"></a><span id="l2.16">  * The following definitions will be useful to know:</span>
<a href="#l2.17"></a><span id="l2.17">  *</span>
<a href="#l2.18"></a><span id="l2.18">  * gFolderTreeView - the controller for the folder tree.</span>
<a href="#l2.19"></a><span id="l2.19">  * ftvItem  - folder tree view item, representing a row in the tree</span>
<a href="#l2.20"></a><span id="l2.20">  * mode - folder view type, e.g., all folders, favorite folders, MRU...</span>
<a href="#l2.21"></a><span id="l2.21">  */</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -719,17 +717,17 @@ var gFolderTreeView = {</span>
<a href="#l2.23"></a><span id="l2.23">         // Don't copy within same server.</span>
<a href="#l2.24"></a><span id="l2.24">         if ((folder.server == targetFolder.server) &amp;&amp;</span>
<a href="#l2.25"></a><span id="l2.25">              (dt.dropEffect == 'copy'))</span>
<a href="#l2.26"></a><span id="l2.26">           return false;</span>
<a href="#l2.27"></a><span id="l2.27">         // Don't allow immediate child to be dropped onto its parent.</span>
<a href="#l2.28"></a><span id="l2.28">         if (targetFolder == folder.parent)</span>
<a href="#l2.29"></a><span id="l2.29">           return false;</span>
<a href="#l2.30"></a><span id="l2.30">         // Don't allow dragging of virtual folders across accounts.</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-        if ((folder.flags &amp; nsMsgFolderFlags.Virtual) &amp;&amp;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+        if ((folder.getFlag(Ci.nsMsgFolderFlags.Virtual)) &amp;&amp;</span>
<a href="#l2.33"></a><span id="l2.33">             folder.server != targetFolder.server)</span>
<a href="#l2.34"></a><span id="l2.34">           return false;</span>
<a href="#l2.35"></a><span id="l2.35">         // Don't allow parent to be dropped on its ancestors.</span>
<a href="#l2.36"></a><span id="l2.36">         if (folder.isAncestorOf(targetFolder))</span>
<a href="#l2.37"></a><span id="l2.37">           return false;</span>
<a href="#l2.38"></a><span id="l2.38">         // If there is a folder that can't be renamed, don't allow it to be</span>
<a href="#l2.39"></a><span id="l2.39">         // dropped if it is not to &quot;Local Folders&quot; or is to the same account.</span>
<a href="#l2.40"></a><span id="l2.40">         if (!folder.canRename &amp;&amp; (targetFolder.server.type != &quot;none&quot; ||</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineat">@@ -1160,17 +1158,17 @@ var gFolderTreeView = {</span>
<a href="#l2.42"></a><span id="l2.42">     let folders = [];</span>
<a href="#l2.43"></a><span id="l2.43">     for (let acct of accounts) {</span>
<a href="#l2.44"></a><span id="l2.44">       let foldersWithFlag = acct.incomingServer.rootFolder.getFoldersWithFlags(aFolderFlag);</span>
<a href="#l2.45"></a><span id="l2.45">       if (foldersWithFlag.length &gt; 0) {</span>
<a href="#l2.46"></a><span id="l2.46">         for (let folderWithFlag of fixIterator(foldersWithFlag,</span>
<a href="#l2.47"></a><span id="l2.47">                                                Ci.nsIMsgFolder)) {</span>
<a href="#l2.48"></a><span id="l2.48">           folders.push(folderWithFlag);</span>
<a href="#l2.49"></a><span id="l2.49">           // Add sub-folders of Sent and Archive to the result.</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-          if (deep &amp;&amp; (aFolderFlag &amp; (nsMsgFolderFlags.SentMail | nsMsgFolderFlags.Archive)))</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+          if (deep &amp;&amp; (aFolderFlag &amp; (Ci.nsMsgFolderFlags.SentMail | Ci.nsMsgFolderFlags.Archive)))</span>
<a href="#l2.52"></a><span id="l2.52">             this.addSubFolders(folderWithFlag, folders);</span>
<a href="#l2.53"></a><span id="l2.53">         }</span>
<a href="#l2.54"></a><span id="l2.54">       }</span>
<a href="#l2.55"></a><span id="l2.55">     }</span>
<a href="#l2.56"></a><span id="l2.56">     return folders;</span>
<a href="#l2.57"></a><span id="l2.57">   },</span>
<a href="#l2.58"></a><span id="l2.58"> </span>
<a href="#l2.59"></a><span id="l2.59">   /**</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineat">@@ -1198,17 +1196,17 @@ var gFolderTreeView = {</span>
<a href="#l2.61"></a><span id="l2.61">   _addSmartFoldersForFlag: function ftv_addSFForFlag(map, accounts, smartRootFolder,</span>
<a href="#l2.62"></a><span id="l2.62">                                                      flag, folderName, position)</span>
<a href="#l2.63"></a><span id="l2.63">   {</span>
<a href="#l2.64"></a><span id="l2.64">     // If there's only one subFolder, just put it at the root.</span>
<a href="#l2.65"></a><span id="l2.65">     let subFolders = gFolderTreeView._allSmartFolders(accounts, flag, folderName, false);</span>
<a href="#l2.66"></a><span id="l2.66">     if (flag &amp;&amp; subFolders.length == 1) {</span>
<a href="#l2.67"></a><span id="l2.67">       let folderItem = new ftvItem(subFolders[0]);</span>
<a href="#l2.68"></a><span id="l2.68">       folderItem._level = 0;</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-      if (flag &amp; nsMsgFolderFlags.Inbox)</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+      if (flag &amp; Ci.nsMsgFolderFlags.Inbox)</span>
<a href="#l2.71"></a><span id="l2.71">         folderItem.__defineGetter__(&quot;children&quot;, () =&gt; []);</span>
<a href="#l2.72"></a><span id="l2.72">       if (position == undefined)</span>
<a href="#l2.73"></a><span id="l2.73">         map.push(folderItem);</span>
<a href="#l2.74"></a><span id="l2.74">       else</span>
<a href="#l2.75"></a><span id="l2.75">         map[position] = folderItem;</span>
<a href="#l2.76"></a><span id="l2.76">       // No smart folder was added</span>
<a href="#l2.77"></a><span id="l2.77">       return null;</span>
<a href="#l2.78"></a><span id="l2.78">     }</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineat">@@ -1247,17 +1245,17 @@ var gFolderTreeView = {</span>
<a href="#l2.80"></a><span id="l2.80"> </span>
<a href="#l2.81"></a><span id="l2.81">     let prevChild = null;</span>
<a href="#l2.82"></a><span id="l2.82">     // Each child is a level one below the smartFolder</span>
<a href="#l2.83"></a><span id="l2.83">     for (let child of smartFolderItem._children) {</span>
<a href="#l2.84"></a><span id="l2.84">       child._level = smartFolderItem._level + 1;</span>
<a href="#l2.85"></a><span id="l2.85">       child._parent = smartFolderItem;</span>
<a href="#l2.86"></a><span id="l2.86">       // don't show sub-folders of the inbox, but I think Archives/Sent, etc</span>
<a href="#l2.87"></a><span id="l2.87">       // should have the sub-folders.</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-      if (flag &amp; nsMsgFolderFlags.Inbox)</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+      if (flag &amp; Ci.nsMsgFolderFlags.Inbox)</span>
<a href="#l2.90"></a><span id="l2.90">         child.__defineGetter__(&quot;children&quot;, () =&gt; []);</span>
<a href="#l2.91"></a><span id="l2.91">       // If we have consecutive children with the same server, then both</span>
<a href="#l2.92"></a><span id="l2.92">       // should display as folder - server.</span>
<a href="#l2.93"></a><span id="l2.93">       if (prevChild &amp;&amp; (child._folder.server == prevChild._folder.server)) {</span>
<a href="#l2.94"></a><span id="l2.94">         child.addServerName = true;</span>
<a href="#l2.95"></a><span id="l2.95">         prevChild.addServerName = true;</span>
<a href="#l2.96"></a><span id="l2.96">         prevChild.useServerNameOnly = false;</span>
<a href="#l2.97"></a><span id="l2.97">       }</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineat">@@ -1276,17 +1274,17 @@ var gFolderTreeView = {</span>
<a href="#l2.99"></a><span id="l2.99">                                                searchFolderURIs, folderFlag)</span>
<a href="#l2.100"></a><span id="l2.100">   {</span>
<a href="#l2.101"></a><span id="l2.101">     let newFolder;</span>
<a href="#l2.102"></a><span id="l2.102">     try {</span>
<a href="#l2.103"></a><span id="l2.103">       if (parentFolder instanceof(Ci.nsIMsgLocalMailFolder))</span>
<a href="#l2.104"></a><span id="l2.104">         newFolder = parentFolder.createLocalSubfolder(newName);</span>
<a href="#l2.105"></a><span id="l2.105">       else</span>
<a href="#l2.106"></a><span id="l2.106">         newFolder = parentFolder.addSubfolder(newName);</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-      newFolder.setFlag(nsMsgFolderFlags.Virtual);</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+      newFolder.setFlag(Ci.nsMsgFolderFlags.Virtual);</span>
<a href="#l2.109"></a><span id="l2.109">       // provide a way to make the top level folder just a container, not</span>
<a href="#l2.110"></a><span id="l2.110">       // a search folder</span>
<a href="#l2.111"></a><span id="l2.111">       let type = this._modes[&quot;smart&quot;].getSmartFolderTypeByName(newName);</span>
<a href="#l2.112"></a><span id="l2.112">       if (type[3]) { // isSearch</span>
<a href="#l2.113"></a><span id="l2.113">         let vfdb = newFolder.msgDatabase;</span>
<a href="#l2.114"></a><span id="l2.114">         let dbFolderInfo = vfdb.dBFolderInfo;</span>
<a href="#l2.115"></a><span id="l2.115">         // set the view string as a property of the db folder info</span>
<a href="#l2.116"></a><span id="l2.116">         // set the original folder name as well.</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineat">@@ -1645,17 +1643,17 @@ var gFolderTreeView = {</span>
<a href="#l2.118"></a><span id="l2.118"> </span>
<a href="#l2.119"></a><span id="l2.119">       generateMap: function ftv_favorite_generateMap(ftv) {</span>
<a href="#l2.120"></a><span id="l2.120">         let accounts = gFolderTreeView._sortedAccounts();</span>
<a href="#l2.121"></a><span id="l2.121">         // Force each root folder to do its local subfolder discovery.</span>
<a href="#l2.122"></a><span id="l2.122">         MailUtils.discoverFolders();</span>
<a href="#l2.123"></a><span id="l2.123"> </span>
<a href="#l2.124"></a><span id="l2.124">         let favRootFolders = [];</span>
<a href="#l2.125"></a><span id="l2.125">         let filterFavorite = function filterFavorite(aFolder) {</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-          return aFolder.getFolderWithFlags(nsMsgFolderFlags.Favorite) != null;</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+          return aFolder.getFolderWithFlags(Ci.nsMsgFolderFlags.Favorite) != null;</span>
<a href="#l2.128"></a><span id="l2.128">         }</span>
<a href="#l2.129"></a><span id="l2.129">         for (let acct of accounts) {</span>
<a href="#l2.130"></a><span id="l2.130">           let rootFolder = acct.incomingServer.rootFolder;</span>
<a href="#l2.131"></a><span id="l2.131">           // Add rootFolders of accounts that contain at least one Favorite folder.</span>
<a href="#l2.132"></a><span id="l2.132">           if (filterFavorite(rootFolder))</span>
<a href="#l2.133"></a><span id="l2.133">             favRootFolders.push(new ftvItem(rootFolder, filterFavorite));</span>
<a href="#l2.134"></a><span id="l2.134">         }</span>
<a href="#l2.135"></a><span id="l2.135"> </span>
<a href="#l2.136"></a><span id="l2.136" class="difflineat">@@ -1679,17 +1677,17 @@ var gFolderTreeView = {</span>
<a href="#l2.137"></a><span id="l2.137">      * and the unread folders are shown in a compact list with no hierarchy.</span>
<a href="#l2.138"></a><span id="l2.138">      */</span>
<a href="#l2.139"></a><span id="l2.139">     favorite_compact: {</span>
<a href="#l2.140"></a><span id="l2.140">       __proto__: IFolderTreeMode,</span>
<a href="#l2.141"></a><span id="l2.141"> </span>
<a href="#l2.142"></a><span id="l2.142">       generateMap: function(ftv) {</span>
<a href="#l2.143"></a><span id="l2.143">         let faves = [];</span>
<a href="#l2.144"></a><span id="l2.144">         for (let folder of ftv._enumerateFolders) {</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineminus">-          if (folder.getFlag(nsMsgFolderFlags.Favorite))</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineplus">+          if (folder.getFlag(Ci.nsMsgFolderFlags.Favorite))</span>
<a href="#l2.147"></a><span id="l2.147">             faves.push(new ftvItem(folder));</span>
<a href="#l2.148"></a><span id="l2.148">         }</span>
<a href="#l2.149"></a><span id="l2.149"> </span>
<a href="#l2.150"></a><span id="l2.150">         // We want to display the account name alongside folders that have</span>
<a href="#l2.151"></a><span id="l2.151">         // duplicated folder names.</span>
<a href="#l2.152"></a><span id="l2.152">         let uniqueNames = new Set(); // set of folder names seen at least once</span>
<a href="#l2.153"></a><span id="l2.153">         let dupeNames = new Set(); // set of folders seen at least twice</span>
<a href="#l2.154"></a><span id="l2.154">         for (let item of faves) {</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineat">@@ -1800,24 +1798,24 @@ var gFolderTreeView = {</span>
<a href="#l2.156"></a><span id="l2.156"> </span>
<a href="#l2.157"></a><span id="l2.157">       /**</span>
<a href="#l2.158"></a><span id="l2.158">        * A list of [flag, name, isDeep, isSearch] for smart folders. isDeep ==</span>
<a href="#l2.159"></a><span id="l2.159">        * false means that subfolders are displayed as subfolders of the account,</span>
<a href="#l2.160"></a><span id="l2.160">        * not of the smart folder. This list is expected to be constant through a</span>
<a href="#l2.161"></a><span id="l2.161">        * session.</span>
<a href="#l2.162"></a><span id="l2.162">        */</span>
<a href="#l2.163"></a><span id="l2.163">       _flagNameList: [</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineminus">-        [nsMsgFolderFlags.Inbox, &quot;Inbox&quot;, false, true],</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineminus">-        [nsMsgFolderFlags.Drafts, &quot;Drafts&quot;, false, true],</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineminus">-        [nsMsgFolderFlags.SentMail, &quot;Sent&quot;, true, true],</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineminus">-        [nsMsgFolderFlags.Trash, &quot;Trash&quot;, true, true],</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineminus">-        [nsMsgFolderFlags.Templates, &quot;Templates&quot;, false, true],</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineminus">-        [nsMsgFolderFlags.Archive, &quot;Archives&quot;, true, true],</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineminus">-        [nsMsgFolderFlags.Junk, &quot;Junk&quot;, false, true],</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineminus">-        [nsMsgFolderFlags.Queue, &quot;Outbox&quot;, true, true]</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineplus">+        [Ci.nsMsgFolderFlags.Inbox, &quot;Inbox&quot;, false, true],</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineplus">+        [Ci.nsMsgFolderFlags.Drafts, &quot;Drafts&quot;, false, true],</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineplus">+        [Ci.nsMsgFolderFlags.SentMail, &quot;Sent&quot;, true, true],</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineplus">+        [Ci.nsMsgFolderFlags.Trash, &quot;Trash&quot;, true, true],</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineplus">+        [Ci.nsMsgFolderFlags.Templates, &quot;Templates&quot;, false, true],</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineplus">+        [Ci.nsMsgFolderFlags.Archive, &quot;Archives&quot;, true, true],</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineplus">+        [Ci.nsMsgFolderFlags.Junk, &quot;Junk&quot;, false, true],</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineplus">+        [Ci.nsMsgFolderFlags.Queue, &quot;Outbox&quot;, true, true]</span>
<a href="#l2.180"></a><span id="l2.180">       ],</span>
<a href="#l2.181"></a><span id="l2.181"> </span>
<a href="#l2.182"></a><span id="l2.182">       /**</span>
<a href="#l2.183"></a><span id="l2.183">        * support for addons to add special folder types, this must be called</span>
<a href="#l2.184"></a><span id="l2.184">        * prior to onload.</span>
<a href="#l2.185"></a><span id="l2.185">        *</span>
<a href="#l2.186"></a><span id="l2.186">        * @param aFolderName  name of the folder</span>
<a href="#l2.187"></a><span id="l2.187">        * @param isDeep  include subfolders</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineat">@@ -2094,17 +2092,17 @@ var gFolderTreeView = {</span>
<a href="#l2.189"></a><span id="l2.189">     let parent = null;</span>
<a href="#l2.190"></a><span id="l2.190">     let parentIndex = -1;</span>
<a href="#l2.191"></a><span id="l2.191">     let newChild;</span>
<a href="#l2.192"></a><span id="l2.192">     let newChildIndex = 0;</span>
<a href="#l2.193"></a><span id="l2.193">     if (!smartFolder || this.getIndexOfFolder(smartFolder) == null) {</span>
<a href="#l2.194"></a><span id="l2.194">       newChild = new ftv_SmartItem(aItem);</span>
<a href="#l2.195"></a><span id="l2.195">       newChild._level = 0;</span>
<a href="#l2.196"></a><span id="l2.196">       while (newChildIndex &lt; this.rowCount) {</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineminus">-        if (this._rowMap[newChildIndex]._folder.flags &amp; aFlag) {</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineplus">+        if (this._rowMap[newChildIndex]._folder.getFlag(aFlag)) {</span>
<a href="#l2.199"></a><span id="l2.199">           // This type of folder seems to already exist, so replace the row</span>
<a href="#l2.200"></a><span id="l2.200">           // with a smartFolder.</span>
<a href="#l2.201"></a><span id="l2.201">           this._addSmartFoldersForFlag(this._rowMap, this._sortedAccounts(),</span>
<a href="#l2.202"></a><span id="l2.202">                                        aSmartRoot, aFlag, aName, newChildIndex);</span>
<a href="#l2.203"></a><span id="l2.203">           return;</span>
<a href="#l2.204"></a><span id="l2.204">         }</span>
<a href="#l2.205"></a><span id="l2.205">         if (this._rowMap[newChildIndex]._folder.isServer)</span>
<a href="#l2.206"></a><span id="l2.206">           break;</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineat">@@ -2118,17 +2116,17 @@ var gFolderTreeView = {</span>
<a href="#l2.208"></a><span id="l2.208"> </span>
<a href="#l2.209"></a><span id="l2.209">       newChild = new ftv_SmartItem(aItem);</span>
<a href="#l2.210"></a><span id="l2.210">       parent.children.push(newChild);</span>
<a href="#l2.211"></a><span id="l2.211">       newChild._level = parent._level + 1;</span>
<a href="#l2.212"></a><span id="l2.212">       newChild._parent = parent;</span>
<a href="#l2.213"></a><span id="l2.213">       sortFolderItems(parent._children);</span>
<a href="#l2.214"></a><span id="l2.214">       newChild.useServerNameOnly = true;</span>
<a href="#l2.215"></a><span id="l2.215">     }</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineminus">-    if (aItem.flags &amp; nsMsgFolderFlags.Inbox)</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineplus">+    if (aItem.getFlag(Ci.nsMsgFolderFlags.Inbox))</span>
<a href="#l2.218"></a><span id="l2.218">       newChild.__defineGetter__(&quot;children&quot;, () =&gt; []);</span>
<a href="#l2.219"></a><span id="l2.219">     if (parent)</span>
<a href="#l2.220"></a><span id="l2.220">       this._addChildToView(parent, parentIndex, newChild);</span>
<a href="#l2.221"></a><span id="l2.221">     else {</span>
<a href="#l2.222"></a><span id="l2.222">       this._rowMap.splice(newChildIndex, 0, newChild);</span>
<a href="#l2.223"></a><span id="l2.223">       this._tree.rowCountChanged(newChildIndex, 1);</span>
<a href="#l2.224"></a><span id="l2.224">     }</span>
<a href="#l2.225"></a><span id="l2.225">   },</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineat">@@ -2183,17 +2181,17 @@ var gFolderTreeView = {</span>
<a href="#l2.227"></a><span id="l2.227">     // Otherwise, just invalidate the parent row. Note that this code doesn't</span>
<a href="#l2.228"></a><span id="l2.228">     // get called for the smart folder case.</span>
<a href="#l2.229"></a><span id="l2.229">     if (!parent.open) {</span>
<a href="#l2.230"></a><span id="l2.230">       // Special case adding a special folder when the parent is collapsed.</span>
<a href="#l2.231"></a><span id="l2.231">       // Expand the parent so the user can see the special child.</span>
<a href="#l2.232"></a><span id="l2.232">       // Expanding the parent is sufficient to add the folder to the view,</span>
<a href="#l2.233"></a><span id="l2.233">       // because either we knew about it, or we will have added a child item</span>
<a href="#l2.234"></a><span id="l2.234">       // for it above.</span>
<a href="#l2.235"></a><span id="l2.235" class="difflineminus">-      if (newChild._folder.flags &amp; nsMsgFolderFlags.SpecialUse) {</span>
<a href="#l2.236"></a><span id="l2.236" class="difflineplus">+      if (newChild._folder.getFlag(Ci.nsMsgFolderFlags.SpecialUse)) {</span>
<a href="#l2.237"></a><span id="l2.237">         this._toggleRow(parentIndex, false);</span>
<a href="#l2.238"></a><span id="l2.238">         return;</span>
<a href="#l2.239"></a><span id="l2.239">       }</span>
<a href="#l2.240"></a><span id="l2.240">     }</span>
<a href="#l2.241"></a><span id="l2.241">     this._addChildToView(parent, parentIndex, newChild);</span>
<a href="#l2.242"></a><span id="l2.242">   },</span>
<a href="#l2.243"></a><span id="l2.243"> </span>
<a href="#l2.244"></a><span id="l2.244">   OnItemRemoved: function ftl_remove(aRDFParentItem, aItem) {</span>
<a href="#l2.245"></a><span id="l2.245" class="difflineat">@@ -2401,17 +2399,17 @@ ftvItem.prototype = {</span>
<a href="#l2.246"></a><span id="l2.246">   },</span>
<a href="#l2.247"></a><span id="l2.247"> </span>
<a href="#l2.248"></a><span id="l2.248">   getProperties: function (aColumn) {</span>
<a href="#l2.249"></a><span id="l2.249">     if (aColumn &amp;&amp; aColumn.id != &quot;folderNameCol&quot;)</span>
<a href="#l2.250"></a><span id="l2.250">       return &quot;&quot;;</span>
<a href="#l2.251"></a><span id="l2.251"> </span>
<a href="#l2.252"></a><span id="l2.252">     // From folderUtils.jsm</span>
<a href="#l2.253"></a><span id="l2.253">     let properties = getFolderProperties(this._folder, this.open);</span>
<a href="#l2.254"></a><span id="l2.254" class="difflineminus">-    if (this._folder.getFlag(nsMsgFolderFlags.Virtual)) {</span>
<a href="#l2.255"></a><span id="l2.255" class="difflineplus">+    if (this._folder.getFlag(Ci.nsMsgFolderFlags.Virtual)) {</span>
<a href="#l2.256"></a><span id="l2.256">       properties += &quot; specialFolder-Smart&quot;;</span>
<a href="#l2.257"></a><span id="l2.257">       // a second possibility for customized smart folders</span>
<a href="#l2.258"></a><span id="l2.258">       properties += &quot; specialFolder-&quot; + this._folder.name.replace(/\s+/g, &quot;&quot;);</span>
<a href="#l2.259"></a><span id="l2.259">     }</span>
<a href="#l2.260"></a><span id="l2.260">     // if there is a smartFolder name property, add it</span>
<a href="#l2.261"></a><span id="l2.261">     let smartFolderName = getSmartFolderName(this._folder);</span>
<a href="#l2.262"></a><span id="l2.262">     if (smartFolderName) {</span>
<a href="#l2.263"></a><span id="l2.263">       properties += &quot; specialFolder-&quot; + smartFolderName.replace(/\s+/g, &quot;&quot;);</span>
<a href="#l2.264"></a><span id="l2.264" class="difflineat">@@ -2515,17 +2513,17 @@ var gFolderTreeController = {</span>
<a href="#l2.265"></a><span id="l2.265">     let folder = aFolder || gFolderTreeView.getSelectedFolders()[0];</span>
<a href="#l2.266"></a><span id="l2.266"> </span>
<a href="#l2.267"></a><span id="l2.267">     // If this is actually a server, send it off to that controller</span>
<a href="#l2.268"></a><span id="l2.268">     if (folder.isServer) {</span>
<a href="#l2.269"></a><span id="l2.269">       MsgAccountManager(null, folder.server);</span>
<a href="#l2.270"></a><span id="l2.270">       return;</span>
<a href="#l2.271"></a><span id="l2.271">     }</span>
<a href="#l2.272"></a><span id="l2.272"> </span>
<a href="#l2.273"></a><span id="l2.273" class="difflineminus">-    if (folder.flags &amp; nsMsgFolderFlags.Virtual) {</span>
<a href="#l2.274"></a><span id="l2.274" class="difflineplus">+    if (folder.getFlag(Ci.nsMsgFolderFlags.Virtual)) {</span>
<a href="#l2.275"></a><span id="l2.275">       this.editVirtualFolder(folder);</span>
<a href="#l2.276"></a><span id="l2.276">       return;</span>
<a href="#l2.277"></a><span id="l2.277">     }</span>
<a href="#l2.278"></a><span id="l2.278">     let title = gFolderTreeView.messengerBundle</span>
<a href="#l2.279"></a><span id="l2.279">                                .getString(&quot;folderProperties&quot;);</span>
<a href="#l2.280"></a><span id="l2.280"> </span>
<a href="#l2.281"></a><span id="l2.281">     //xxx useless param</span>
<a href="#l2.282"></a><span id="l2.282">     function editFolderCallback(aNewName, aOldName, aUri) {</span>
<a href="#l2.283"></a><span id="l2.283" class="difflineat">@@ -2614,28 +2612,28 @@ var gFolderTreeController = {</span>
<a href="#l2.284"></a><span id="l2.284">    *</span>
<a href="#l2.285"></a><span id="l2.285">    * @param aFolder (optional) the folder to delete, if not the selected one</span>
<a href="#l2.286"></a><span id="l2.286">    */</span>
<a href="#l2.287"></a><span id="l2.287">   deleteFolder: function ftc_delete(aFolder) {</span>
<a href="#l2.288"></a><span id="l2.288">     let folders = aFolder ? [aFolder] : gFolderTreeView.getSelectedFolders();</span>
<a href="#l2.289"></a><span id="l2.289">     let folder = folders[0];</span>
<a href="#l2.290"></a><span id="l2.290"> </span>
<a href="#l2.291"></a><span id="l2.291">     // For newsgroups, &quot;delete&quot; means &quot;unsubscribe&quot;.</span>
<a href="#l2.292"></a><span id="l2.292" class="difflineminus">-    if (folder.server.type == &quot;nntp&quot; &amp;&amp; !folder.getFlag(nsMsgFolderFlags.Virtual)) {</span>
<a href="#l2.293"></a><span id="l2.293" class="difflineplus">+    if (folder.server.type == &quot;nntp&quot; &amp;&amp; !folder.getFlag(Ci.nsMsgFolderFlags.Virtual)) {</span>
<a href="#l2.294"></a><span id="l2.294">       MsgUnsubscribe(folders);</span>
<a href="#l2.295"></a><span id="l2.295">       return;</span>
<a href="#l2.296"></a><span id="l2.296">     }</span>
<a href="#l2.297"></a><span id="l2.297"> </span>
<a href="#l2.298"></a><span id="l2.298" class="difflineminus">-    var canDelete = (folder.isSpecialFolder(nsMsgFolderFlags.Junk, false)) ?</span>
<a href="#l2.299"></a><span id="l2.299" class="difflineplus">+    var canDelete = (folder.isSpecialFolder(Ci.nsMsgFolderFlags.Junk, false)) ?</span>
<a href="#l2.300"></a><span id="l2.300">       CanRenameDeleteJunkMail(folder.URI) : folder.deletable;</span>
<a href="#l2.301"></a><span id="l2.301"> </span>
<a href="#l2.302"></a><span id="l2.302">     if (!canDelete)</span>
<a href="#l2.303"></a><span id="l2.303">       throw new Error(&quot;Can't delete folder: &quot; + folder.name);</span>
<a href="#l2.304"></a><span id="l2.304"> </span>
<a href="#l2.305"></a><span id="l2.305" class="difflineminus">-    if (folder.flags &amp; nsMsgFolderFlags.Virtual) {</span>
<a href="#l2.306"></a><span id="l2.306" class="difflineplus">+    if (folder.getFlag(Ci.nsMsgFolderFlags.Virtual)) {</span>
<a href="#l2.307"></a><span id="l2.307">       let confirmation = gFolderTreeView.messengerBundle</span>
<a href="#l2.308"></a><span id="l2.308">                                         .getString(&quot;confirmSavedSearchDeleteMessage&quot;);</span>
<a href="#l2.309"></a><span id="l2.309">       let title = gFolderTreeView.messengerBundle</span>
<a href="#l2.310"></a><span id="l2.310">                                  .getString(&quot;confirmSavedSearchTitle&quot;);</span>
<a href="#l2.311"></a><span id="l2.311">       if (Services.prompt</span>
<a href="#l2.312"></a><span id="l2.312">             .confirmEx(window, title, confirmation,</span>
<a href="#l2.313"></a><span id="l2.313">                        Services.prompt.STD_YES_NO_BUTTONS + Services.prompt.BUTTON_POS_1_DEFAULT,</span>
<a href="#l2.314"></a><span id="l2.314">                        &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, {}) != 0) /* the yes button is in position 0 */</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineat">@@ -2664,17 +2662,17 @@ var gFolderTreeController = {</span>
<a href="#l2.316"></a><span id="l2.316">       return;</span>
<a href="#l2.317"></a><span id="l2.317"> </span>
<a href="#l2.318"></a><span id="l2.318">       // Check if this is a top-level smart folder. If so, we're going</span>
<a href="#l2.319"></a><span id="l2.319">       // to empty all the trash folders.</span>
<a href="#l2.320"></a><span id="l2.320">       if (folder.server.hostName == &quot;smart mailboxes&quot; &amp;&amp;</span>
<a href="#l2.321"></a><span id="l2.321">           folder.parent.isServer) {</span>
<a href="#l2.322"></a><span id="l2.322">         let subFolders = gFolderTreeView</span>
<a href="#l2.323"></a><span id="l2.323">                            ._allFoldersWithFlag(gFolderTreeView._sortedAccounts(),</span>
<a href="#l2.324"></a><span id="l2.324" class="difflineminus">-                            nsMsgFolderFlags.Trash, false);</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineplus">+                            Ci.nsMsgFolderFlags.Trash, false);</span>
<a href="#l2.326"></a><span id="l2.326">         for (let trash of subFolders)</span>
<a href="#l2.327"></a><span id="l2.327">           trash.emptyTrash(msgWindow, null);</span>
<a href="#l2.328"></a><span id="l2.328">       }</span>
<a href="#l2.329"></a><span id="l2.329">       else {</span>
<a href="#l2.330"></a><span id="l2.330">         folder.emptyTrash(msgWindow, null);</span>
<a href="#l2.331"></a><span id="l2.331">       }</span>
<a href="#l2.332"></a><span id="l2.332">   },</span>
<a href="#l2.333"></a><span id="l2.333"> </span>
<a href="#l2.334"></a><span id="l2.334" class="difflineat">@@ -2682,17 +2680,17 @@ var gFolderTreeController = {</span>
<a href="#l2.335"></a><span id="l2.335">    * Deletes everything (folders and messages) in the selected folder.</span>
<a href="#l2.336"></a><span id="l2.336">    * The folder is only emptied if it has the proper Junk flag.</span>
<a href="#l2.337"></a><span id="l2.337">    *</span>
<a href="#l2.338"></a><span id="l2.338">    * @param aFolder (optional)  the folder to empty</span>
<a href="#l2.339"></a><span id="l2.339">    */</span>
<a href="#l2.340"></a><span id="l2.340">   emptyJunk: function ftc_emptyJunk(aFolder) {</span>
<a href="#l2.341"></a><span id="l2.341">     let folder = aFolder || gFolderTreeView.getSelectedFolders()[0];</span>
<a href="#l2.342"></a><span id="l2.342"> </span>
<a href="#l2.343"></a><span id="l2.343" class="difflineminus">-    if (!folder || !folder.getFlag(nsMsgFolderFlags.Junk))</span>
<a href="#l2.344"></a><span id="l2.344" class="difflineplus">+    if (!folder || !folder.getFlag(Ci.nsMsgFolderFlags.Junk))</span>
<a href="#l2.345"></a><span id="l2.345">       return;</span>
<a href="#l2.346"></a><span id="l2.346"> </span>
<a href="#l2.347"></a><span id="l2.347">     if (!this._checkConfirmationPrompt(&quot;emptyJunk&quot;, folder))</span>
<a href="#l2.348"></a><span id="l2.348">       return;</span>
<a href="#l2.349"></a><span id="l2.349"> </span>
<a href="#l2.350"></a><span id="l2.350">     // Delete any subfolders this folder might have</span>
<a href="#l2.351"></a><span id="l2.351">     let iter = folder.subFolders;</span>
<a href="#l2.352"></a><span id="l2.352">     while (iter.hasMoreElements())</span>
<a href="#l2.353"></a><span id="l2.353" class="difflineat">@@ -2851,17 +2849,17 @@ ftv_SmartItem.prototype = {</span>
<a href="#l2.354"></a><span id="l2.354">     // We're caching our child list to save perf.</span>
<a href="#l2.355"></a><span id="l2.355">     if (!this._children) {</span>
<a href="#l2.356"></a><span id="l2.356">       this._children = [];</span>
<a href="#l2.357"></a><span id="l2.357">       let iter = fixIterator(this._folder.subFolders, Ci.nsIMsgFolder);</span>
<a href="#l2.358"></a><span id="l2.358">       for (let folder of iter) {</span>
<a href="#l2.359"></a><span id="l2.359">         if (!smartMode.isSmartFolder(folder)) {</span>
<a href="#l2.360"></a><span id="l2.360">           this._children.push(new ftv_SmartItem(folder));</span>
<a href="#l2.361"></a><span id="l2.361">         }</span>
<a href="#l2.362"></a><span id="l2.362" class="difflineminus">-        else if (folder.flags &amp; nsMsgFolderFlags.Inbox) {</span>
<a href="#l2.363"></a><span id="l2.363" class="difflineplus">+        else if (folder.getFlag(Ci.nsMsgFolderFlags.Inbox)) {</span>
<a href="#l2.364"></a><span id="l2.364">           let subIter = fixIterator(folder.subFolders, Ci.nsIMsgFolder);</span>
<a href="#l2.365"></a><span id="l2.365">           for (let subfolder of subIter) {</span>
<a href="#l2.366"></a><span id="l2.366">             if (!smartMode.isSmartFolder(subfolder))</span>
<a href="#l2.367"></a><span id="l2.367">               this._children.push(new ftv_SmartItem(subfolder));</span>
<a href="#l2.368"></a><span id="l2.368">           }</span>
<a href="#l2.369"></a><span id="l2.369">         }</span>
<a href="#l2.370"></a><span id="l2.370">       }</span>
<a href="#l2.371"></a><span id="l2.371">       sortFolderItems(this._children);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/mail3PaneWindowCommands.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/mail3PaneWindowCommands.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -92,17 +92,17 @@ var FolderPaneController =</span>
<a href="#l3.4"></a><span id="l3.4">   }</span>
<a href="#l3.5"></a><span id="l3.5"> };</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> function UpdateDeleteLabelsFromFolderCommand(folder, command)</span>
<a href="#l3.8"></a><span id="l3.8"> {</span>
<a href="#l3.9"></a><span id="l3.9">   if (command != &quot;cmd_delete&quot;)</span>
<a href="#l3.10"></a><span id="l3.10">     return;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  if (folder.getFlag(nsMsgFolderFlags.Virtual)) {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  if (folder.getFlag(Ci.nsMsgFolderFlags.Virtual)) {</span>
<a href="#l3.14"></a><span id="l3.14">     goSetMenuValue(command, &quot;valueFolder&quot;);</span>
<a href="#l3.15"></a><span id="l3.15">   }</span>
<a href="#l3.16"></a><span id="l3.16">   else if (folder.server.type == &quot;nntp&quot;) {</span>
<a href="#l3.17"></a><span id="l3.17">     goSetMenuValue(command, &quot;valueNewsgroup&quot;);</span>
<a href="#l3.18"></a><span id="l3.18">     goSetAccessKey(command, &quot;valueNewsgroupAccessKey&quot;);</span>
<a href="#l3.19"></a><span id="l3.19">   }</span>
<a href="#l3.20"></a><span id="l3.20">   else {</span>
<a href="#l3.21"></a><span id="l3.21">     goSetMenuValue(command, &quot;valueFolder&quot;);</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -287,17 +287,17 @@ var DefaultController =</span>
<a href="#l3.23"></a><span id="l3.23">         return gFolderDisplay.selectedCount == 1 &amp;&amp;</span>
<a href="#l3.24"></a><span id="l3.24">                gFolderDisplay.selectedMessageIsNews;</span>
<a href="#l3.25"></a><span id="l3.25">       case &quot;cmd_deleteFolder&quot;:</span>
<a href="#l3.26"></a><span id="l3.26">         var folders = gFolderTreeView.getSelectedFolders();</span>
<a href="#l3.27"></a><span id="l3.27">         if (folders.length == 1) {</span>
<a href="#l3.28"></a><span id="l3.28">           let folder = folders[0];</span>
<a href="#l3.29"></a><span id="l3.29">           if (folder.server.type == &quot;nntp&quot;) {</span>
<a href="#l3.30"></a><span id="l3.30">             // Just disable the command for news unless it is a Saved search folder.</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-            return folder.getFlag(nsMsgFolderFlags.Virtual);</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+            return folder.getFlag(Ci.nsMsgFolderFlags.Virtual);</span>
<a href="#l3.33"></a><span id="l3.33">           }</span>
<a href="#l3.34"></a><span id="l3.34">           return CanDeleteFolder(folder);</span>
<a href="#l3.35"></a><span id="l3.35">         }</span>
<a href="#l3.36"></a><span id="l3.36">         return false;</span>
<a href="#l3.37"></a><span id="l3.37">       case &quot;button_junk&quot;:</span>
<a href="#l3.38"></a><span id="l3.38">         UpdateJunkToolbarButton();</span>
<a href="#l3.39"></a><span id="l3.39">         return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk);</span>
<a href="#l3.40"></a><span id="l3.40">       case &quot;cmd_killThread&quot;:</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineat">@@ -526,17 +526,17 @@ var DefaultController =</span>
<a href="#l3.42"></a><span id="l3.42">         return folder &amp;&amp; folder.server.canEmptyTrashOnExit ?</span>
<a href="#l3.43"></a><span id="l3.43">                          IsMailFolderSelected() : false;</span>
<a href="#l3.44"></a><span id="l3.44">       }</span>
<a href="#l3.45"></a><span id="l3.45">       case &quot;button_compact&quot;:</span>
<a href="#l3.46"></a><span id="l3.46">       {</span>
<a href="#l3.47"></a><span id="l3.47">         let folders = gFolderTreeView.getSelectedFolders();</span>
<a href="#l3.48"></a><span id="l3.48">         let canCompact = function canCompact(folder) {</span>
<a href="#l3.49"></a><span id="l3.49">           return !folder.isServer &amp;&amp;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-            !(folder.flags &amp; Ci.nsMsgFolderFlags.Virtual) &amp;&amp;</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+            !(folder.getFlag(Ci.nsMsgFolderFlags.Virtual)) &amp;&amp;</span>
<a href="#l3.52"></a><span id="l3.52">             (folder.server.type != &quot;imap&quot; || folder.server.canCompactFoldersOnServer) &amp;&amp;</span>
<a href="#l3.53"></a><span id="l3.53">             folder.isCommandEnabled(&quot;button_compact&quot;);</span>
<a href="#l3.54"></a><span id="l3.54">         }</span>
<a href="#l3.55"></a><span id="l3.55">         return folders &amp;&amp; folders.every(canCompact);</span>
<a href="#l3.56"></a><span id="l3.56">       }</span>
<a href="#l3.57"></a><span id="l3.57">       case &quot;cmd_compactFolder&quot;:</span>
<a href="#l3.58"></a><span id="l3.58">       {</span>
<a href="#l3.59"></a><span id="l3.59">         let folders = gFolderTreeView.getSelectedFolders();</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineat">@@ -1251,17 +1251,17 @@ function IsPropertiesEnabled(command)</span>
<a href="#l3.61"></a><span id="l3.61">   var folders = GetSelectedMsgFolders();</span>
<a href="#l3.62"></a><span id="l3.62">   if (!folders.length)</span>
<a href="#l3.63"></a><span id="l3.63">     return false;</span>
<a href="#l3.64"></a><span id="l3.64">   var folder = folders[0];</span>
<a href="#l3.65"></a><span id="l3.65"> </span>
<a href="#l3.66"></a><span id="l3.66">   // when servers are selected it should be &quot;Edit | Properties...&quot;</span>
<a href="#l3.67"></a><span id="l3.67">   if (folder.isServer)</span>
<a href="#l3.68"></a><span id="l3.68">     goSetMenuValue(command, &quot;valueGeneric&quot;);</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-  else if (folder.getFlag(nsMsgFolderFlags.Virtual))</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+  else if (folder.getFlag(Ci.nsMsgFolderFlags.Virtual))</span>
<a href="#l3.71"></a><span id="l3.71">     goSetMenuValue(command, &quot;valueFolder&quot;);</span>
<a href="#l3.72"></a><span id="l3.72">   else</span>
<a href="#l3.73"></a><span id="l3.73">     goSetMenuValue(command, isNewsURI(folder.URI) ? &quot;valueNewsgroup&quot; : &quot;valueFolder&quot;);</span>
<a href="#l3.74"></a><span id="l3.74"> </span>
<a href="#l3.75"></a><span id="l3.75">    return (folders.length == 1);</span>
<a href="#l3.76"></a><span id="l3.76"> }</span>
<a href="#l3.77"></a><span id="l3.77"> </span>
<a href="#l3.78"></a><span id="l3.78"> function IsViewNavigationItemEnabled()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/mailContextMenus.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/mailContextMenus.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -293,19 +293,18 @@ function CheckForMessageIdInFolder(folde</span>
<a href="#l4.4"></a><span id="l4.4">     messageHeader = messageDatabase.getMsgHdrForMessageID(messageId);</span>
<a href="#l4.5"></a><span id="l4.5">   }</span>
<a href="#l4.6"></a><span id="l4.6">   catch (ex)</span>
<a href="#l4.7"></a><span id="l4.7">   {</span>
<a href="#l4.8"></a><span id="l4.8">     Cu.reportError(&quot;Failed to find message-id in folder; &quot; +</span>
<a href="#l4.9"></a><span id="l4.9">                    &quot;messageId=&quot; + messageId);</span>
<a href="#l4.10"></a><span id="l4.10">   }</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l4.13"></a><span id="l4.13">   if (!MailServices.mailSession.IsFolderOpenInWindow(folder) &amp;&amp;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-      !(folder.flags &amp; (nsMsgFolderFlags.Trash | nsMsgFolderFlags.Inbox)))</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+      !(folder.flags &amp; (Ci.nsMsgFolderFlags.Trash | Ci.nsMsgFolderFlags.Inbox)))</span>
<a href="#l4.16"></a><span id="l4.16">   {</span>
<a href="#l4.17"></a><span id="l4.17">     folder.msgDatabase = null;</span>
<a href="#l4.18"></a><span id="l4.18">   }</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20">   return messageHeader;</span>
<a href="#l4.21"></a><span id="l4.21"> }</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23"> function folderPaneOnPopupHiding()</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineat">@@ -339,18 +338,17 @@ function fillFolderPaneContextMenu(aEven</span>
<a href="#l4.25"></a><span id="l4.25">   var bundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l4.26"></a><span id="l4.26">   var folders = gFolderTreeView.getSelectedFolders();</span>
<a href="#l4.27"></a><span id="l4.27">   if (!folders.length)</span>
<a href="#l4.28"></a><span id="l4.28">     return false;</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30">   var numSelected = folders.length;</span>
<a href="#l4.31"></a><span id="l4.31"> </span>
<a href="#l4.32"></a><span id="l4.32">   function checkIsVirtualFolder(folder) {</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-    const kVirtualFlag = Ci.nsMsgFolderFlags.Virtual;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-    return folder.flags &amp; kVirtualFlag;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+    return folder.getFlag(Ci.nsMsgFolderFlags.Virtual);</span>
<a href="#l4.36"></a><span id="l4.36">   }</span>
<a href="#l4.37"></a><span id="l4.37">   var haveAnyVirtualFolders = folders.some(checkIsVirtualFolder);</span>
<a href="#l4.38"></a><span id="l4.38"> </span>
<a href="#l4.39"></a><span id="l4.39">   function checkIsServer(folder) {</span>
<a href="#l4.40"></a><span id="l4.40">     return folder.isServer;</span>
<a href="#l4.41"></a><span id="l4.41">   }</span>
<a href="#l4.42"></a><span id="l4.42">   var selectedServers = folders.filter(checkIsServer);</span>
<a href="#l4.43"></a><span id="l4.43"> </span>
<a href="#l4.44"></a><span id="l4.44" class="difflineat">@@ -360,44 +358,44 @@ function fillFolderPaneContextMenu(aEven</span>
<a href="#l4.45"></a><span id="l4.45">                                           getSpecialFolderString(folders[0]);</span>
<a href="#l4.46"></a><span id="l4.46"> </span>
<a href="#l4.47"></a><span id="l4.47">   function checkCanSubscribeToFolder(folder) {</span>
<a href="#l4.48"></a><span id="l4.48">     if (checkIsVirtualFolder(folder))</span>
<a href="#l4.49"></a><span id="l4.49">       return false;</span>
<a href="#l4.50"></a><span id="l4.50"> </span>
<a href="#l4.51"></a><span id="l4.51">     // All feed account folders, besides Trash, are subscribable.</span>
<a href="#l4.52"></a><span id="l4.52">     if (folder.server.type == &quot;rss&quot; &amp;&amp;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-        !(folder.flags &amp; nsMsgFolderFlags.Trash))</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+        !(folder.getFlag(Ci.nsMsgFolderFlags.Trash)))</span>
<a href="#l4.55"></a><span id="l4.55">       return true;</span>
<a href="#l4.56"></a><span id="l4.56"> </span>
<a href="#l4.57"></a><span id="l4.57">     // We only want the subscribe item on the account nodes.</span>
<a href="#l4.58"></a><span id="l4.58">     if (!folder.isServer)</span>
<a href="#l4.59"></a><span id="l4.59">       return false;</span>
<a href="#l4.60"></a><span id="l4.60"> </span>
<a href="#l4.61"></a><span id="l4.61">     return folder.server.type == &quot;nntp&quot; ||</span>
<a href="#l4.62"></a><span id="l4.62">            folder.server.type == &quot;imap&quot;;</span>
<a href="#l4.63"></a><span id="l4.63">   }</span>
<a href="#l4.64"></a><span id="l4.64">   var haveOnlySubscribableFolders = folders.every(checkCanSubscribeToFolder);</span>
<a href="#l4.65"></a><span id="l4.65"> </span>
<a href="#l4.66"></a><span id="l4.66">   function checkIsNewsgroup(folder) {</span>
<a href="#l4.67"></a><span id="l4.67">     return !folder.isServer &amp;&amp; folder.server.type == &quot;nntp&quot; &amp;&amp;</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-           !folder.getFlag(nsMsgFolderFlags.Virtual);</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+           !folder.getFlag(Ci.nsMsgFolderFlags.Virtual);</span>
<a href="#l4.70"></a><span id="l4.70">   }</span>
<a href="#l4.71"></a><span id="l4.71">   var haveOnlyNewsgroups = folders.every(checkIsNewsgroup);</span>
<a href="#l4.72"></a><span id="l4.72"> </span>
<a href="#l4.73"></a><span id="l4.73">   function checkIsMailFolder(folder) {</span>
<a href="#l4.74"></a><span id="l4.74">     return !folder.isServer &amp;&amp; folder.server.type != &quot;nntp&quot;;</span>
<a href="#l4.75"></a><span id="l4.75">   }</span>
<a href="#l4.76"></a><span id="l4.76">   var haveOnlyMailFolders = folders.every(checkIsMailFolder);</span>
<a href="#l4.77"></a><span id="l4.77"> </span>
<a href="#l4.78"></a><span id="l4.78">   function checkCanGetMessages(folder) {</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-    const kTrashFlag = Ci.nsMsgFolderFlags.Trash;</span>
<a href="#l4.80"></a><span id="l4.80">     return (folder.isServer &amp;&amp; (folder.server.type != &quot;none&quot;)) ||</span>
<a href="#l4.81"></a><span id="l4.81">            checkIsNewsgroup(folder) ||</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-           ((folder.server.type == &quot;rss&quot;) &amp;&amp; !folder.isSpecialFolder(kTrashFlag, true) &amp;&amp;</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+           ((folder.server.type == &quot;rss&quot;) &amp;&amp;</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+            !folder.isSpecialFolder(Ci.nsMsgFolderFlags.Trash, true) &amp;&amp;</span>
<a href="#l4.85"></a><span id="l4.85">              !checkIsVirtualFolder(folder));</span>
<a href="#l4.86"></a><span id="l4.86">   }</span>
<a href="#l4.87"></a><span id="l4.87">   var selectedFoldersThatCanGetMessages = folders.filter(checkCanGetMessages);</span>
<a href="#l4.88"></a><span id="l4.88"> </span>
<a href="#l4.89"></a><span id="l4.89">   // --- Set up folder properties / account settings menu item.</span>
<a href="#l4.90"></a><span id="l4.90">   if (numSelected != 1) {</span>
<a href="#l4.91"></a><span id="l4.91">     ShowMenuItem(&quot;folderPaneContext-settings&quot;, false);</span>
<a href="#l4.92"></a><span id="l4.92">     ShowMenuItem(&quot;folderPaneContext-properties&quot;, false);</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineat">@@ -487,53 +485,51 @@ function fillFolderPaneContextMenu(aEven</span>
<a href="#l4.94"></a><span id="l4.94">                    !folders[0].isServer &amp;&amp; folders[0].isCommandEnabled(&quot;cmd_renameFolder&quot;));</span>
<a href="#l4.95"></a><span id="l4.95">   }</span>
<a href="#l4.96"></a><span id="l4.96">   else {</span>
<a href="#l4.97"></a><span id="l4.97">     ShowMenuItem(&quot;folderPaneContext-rename&quot;, false);</span>
<a href="#l4.98"></a><span id="l4.98">   }</span>
<a href="#l4.99"></a><span id="l4.99"> </span>
<a href="#l4.100"></a><span id="l4.100">   // --- Set up the delete folder menu item.</span>
<a href="#l4.101"></a><span id="l4.101">   function checkCanDeleteFolder(folder) {</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineminus">-    if (folder.isSpecialFolder(nsMsgFolderFlags.Junk, false))</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineplus">+    if (folder.isSpecialFolder(Ci.nsMsgFolderFlags.Junk, false))</span>
<a href="#l4.104"></a><span id="l4.104">       return CanRenameDeleteJunkMail(folder.URI);</span>
<a href="#l4.105"></a><span id="l4.105">     return folder.deletable;</span>
<a href="#l4.106"></a><span id="l4.106">   }</span>
<a href="#l4.107"></a><span id="l4.107">   var haveOnlyDeletableFolders = folders.every(checkCanDeleteFolder);</span>
<a href="#l4.108"></a><span id="l4.108">   ShowMenuItem(&quot;folderPaneContext-remove&quot;, haveOnlyDeletableFolders &amp;&amp; numSelected == 1);</span>
<a href="#l4.109"></a><span id="l4.109"> </span>
<a href="#l4.110"></a><span id="l4.110">   function checkIsDeleteEnabled(folder) {</span>
<a href="#l4.111"></a><span id="l4.111">     return folder.isCommandEnabled(&quot;cmd_delete&quot;);</span>
<a href="#l4.112"></a><span id="l4.112">   }</span>
<a href="#l4.113"></a><span id="l4.113">   var haveOnlyDeleteEnabledFolders = folders.every(checkIsDeleteEnabled);</span>
<a href="#l4.114"></a><span id="l4.114">   EnableMenuItem(&quot;folderPaneContext-remove&quot;, haveOnlyDeleteEnabledFolders);</span>
<a href="#l4.115"></a><span id="l4.115"> </span>
<a href="#l4.116"></a><span id="l4.116">   // --- Set up the compact folder menu item.</span>
<a href="#l4.117"></a><span id="l4.117">   function checkCanCompactFolder(folder) {</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineminus">-    const kVirtualFlag = Ci.nsMsgFolderFlags.Virtual;</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineminus">-    return folder.canCompact &amp;&amp; !(folder.flags &amp; kVirtualFlag) &amp;&amp;</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+    return folder.canCompact &amp;&amp; !(folder.getFlag(Ci.nsMsgFolderFlags.Virtual)) &amp;&amp;</span>
<a href="#l4.121"></a><span id="l4.121">            folder.isCommandEnabled(&quot;cmd_compactFolder&quot;);</span>
<a href="#l4.122"></a><span id="l4.122">   }</span>
<a href="#l4.123"></a><span id="l4.123">   var haveOnlyCompactableFolders = folders.every(checkCanCompactFolder);</span>
<a href="#l4.124"></a><span id="l4.124">   ShowMenuItem(&quot;folderPaneContext-compact&quot;, haveOnlyCompactableFolders);</span>
<a href="#l4.125"></a><span id="l4.125"> </span>
<a href="#l4.126"></a><span id="l4.126">   function checkIsCompactEnabled(folder) {</span>
<a href="#l4.127"></a><span id="l4.127">     return folder.isCommandEnabled(&quot;cmd_compactFolder&quot;);</span>
<a href="#l4.128"></a><span id="l4.128">   }</span>
<a href="#l4.129"></a><span id="l4.129">   var haveOnlyCompactEnabledFolders = folders.every(checkIsCompactEnabled);</span>
<a href="#l4.130"></a><span id="l4.130">   EnableMenuItem(&quot;folderPaneContext-compact&quot;, haveOnlyCompactEnabledFolders);</span>
<a href="#l4.131"></a><span id="l4.131"> </span>
<a href="#l4.132"></a><span id="l4.132">   // --- Set up favorite folder menu item.</span>
<a href="#l4.133"></a><span id="l4.133">   ShowMenuItem(&quot;folderPaneContext-favoriteFolder&quot;,</span>
<a href="#l4.134"></a><span id="l4.134">                numSelected == 1 &amp;&amp; !folders[0].isServer);</span>
<a href="#l4.135"></a><span id="l4.135">   if (numSelected == 1 &amp;&amp; !folders[0].isServer)</span>
<a href="#l4.136"></a><span id="l4.136">   {</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineminus">-    const kFavoriteFlag = Ci.nsMsgFolderFlags.Favorite;</span>
<a href="#l4.138"></a><span id="l4.138">      // Adjust the checked state on the menu item.</span>
<a href="#l4.139"></a><span id="l4.139">     document.getElementById(&quot;folderPaneContext-favoriteFolder&quot;)</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineminus">-            .setAttribute(&quot;checked&quot;, folders[0].getFlag(kFavoriteFlag));</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineplus">+            .setAttribute(&quot;checked&quot;, folders[0].getFlag(Ci.nsMsgFolderFlags.Favorite));</span>
<a href="#l4.142"></a><span id="l4.142">   }</span>
<a href="#l4.143"></a><span id="l4.143"> </span>
<a href="#l4.144"></a><span id="l4.144">   // --- Set up the empty trash menu item.</span>
<a href="#l4.145"></a><span id="l4.145">   ShowMenuItem(&quot;folderPaneContext-emptyTrash&quot;,</span>
<a href="#l4.146"></a><span id="l4.146">                numSelected == 1 &amp;&amp; specialFolder == &quot;Trash&quot;);</span>
<a href="#l4.147"></a><span id="l4.147"> </span>
<a href="#l4.148"></a><span id="l4.148">   // --- Set up the empty junk menu item.</span>
<a href="#l4.149"></a><span id="l4.149">   ShowMenuItem(&quot;folderPaneContext-emptyJunk&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -70,20 +70,19 @@ function menu_new_init()</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">   let folder = gFolderDisplay.displayedFolder;</span>
<a href="#l5.6"></a><span id="l5.6">   if (!folder)</span>
<a href="#l5.7"></a><span id="l5.7">     return;</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">   if (Services.prefs.prefIsLocked(&quot;mail.disable_new_account_addition&quot;))</span>
<a href="#l5.10"></a><span id="l5.10">     document.getElementById(&quot;newAccountMenuItem&quot;).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-  var isInbox = folder.isSpecialFolder(nsMsgFolderFlags.Inbox);</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+  var isInbox = folder.isSpecialFolder(Ci.nsMsgFolderFlags.Inbox);</span>
<a href="#l5.15"></a><span id="l5.15">   var showNew = (folder.canCreateSubfolders ||</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-                 (isInbox &amp;&amp; !(folder.flags &amp; nsMsgFolderFlags.Virtual))) &amp;&amp;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+                 (isInbox &amp;&amp; !(folder.getFlag(Ci.nsMsgFolderFlags.Virtual)))) &amp;&amp;</span>
<a href="#l5.18"></a><span id="l5.18">                 (document.getElementById(&quot;cmd_newFolder&quot;).getAttribute(&quot;disabled&quot;) != &quot;true&quot;);</span>
<a href="#l5.19"></a><span id="l5.19">   ShowMenuItem(&quot;menu_newFolder&quot;, showNew);</span>
<a href="#l5.20"></a><span id="l5.20">   ShowMenuItem(&quot;menu_newVirtualFolder&quot;, showNew);</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22">   EnableMenuItem(&quot;menu_newFolder&quot;, folder.server.type != &quot;imap&quot; || MailOfflineMgr.isOnline());</span>
<a href="#l5.23"></a><span id="l5.23">   if (showNew)</span>
<a href="#l5.24"></a><span id="l5.24">   {</span>
<a href="#l5.25"></a><span id="l5.25">     var bundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineat">@@ -131,19 +130,19 @@ function InitEditMessagesMenu()</span>
<a href="#l5.27"></a><span id="l5.27">   goSetAccessKey('cmd_delete', 'valueDefaultAccessKey');</span>
<a href="#l5.28"></a><span id="l5.28">   document.commandDispatcher.updateCommands('create-menu-edit');</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30">   // initialize the favorite Folder checkbox in the edit menu</span>
<a href="#l5.31"></a><span id="l5.31">   let favoriteFolderMenu = document.getElementById('menu_favoriteFolder');</span>
<a href="#l5.32"></a><span id="l5.32">   if (!favoriteFolderMenu.hasAttribute(&quot;disabled&quot;)) {</span>
<a href="#l5.33"></a><span id="l5.33">     let folders = gFolderTreeView.getSelectedFolders();</span>
<a href="#l5.34"></a><span id="l5.34">     if (folders.length == 1 &amp;&amp; !folders[0].isServer) {</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-      const kFavoriteFlag = Ci.nsMsgFolderFlags.Favorite;</span>
<a href="#l5.36"></a><span id="l5.36">       // Adjust the checked state on the menu item.</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-      favoriteFolderMenu.setAttribute(&quot;checked&quot;, folders[0].getFlag(kFavoriteFlag));</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+      favoriteFolderMenu.setAttribute(&quot;checked&quot;,</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+        folders[0].getFlag(Ci.nsMsgFolderFlags.Favorite));</span>
<a href="#l5.40"></a><span id="l5.40">       favoriteFolderMenu.hidden = false;</span>
<a href="#l5.41"></a><span id="l5.41">     } else {</span>
<a href="#l5.42"></a><span id="l5.42">       favoriteFolderMenu.hidden = true;</span>
<a href="#l5.43"></a><span id="l5.43">     }</span>
<a href="#l5.44"></a><span id="l5.44">   }</span>
<a href="#l5.45"></a><span id="l5.45"> }</span>
<a href="#l5.46"></a><span id="l5.46"> </span>
<a href="#l5.47"></a><span id="l5.47"> function InitAppFolderViewsMenu()</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineat">@@ -152,19 +151,19 @@ function InitAppFolderViewsMenu()</span>
<a href="#l5.49"></a><span id="l5.49">   goSetAccessKey('cmd_delete', 'valueDefaultAccessKey');</span>
<a href="#l5.50"></a><span id="l5.50">   document.commandDispatcher.updateCommands('create-menu-edit');</span>
<a href="#l5.51"></a><span id="l5.51"> </span>
<a href="#l5.52"></a><span id="l5.52">   // initialize the favorite Folder checkbox in the appmenu menu</span>
<a href="#l5.53"></a><span id="l5.53">   let favoriteAppFolderMenu = document.getElementById('appmenu_favoriteFolder');</span>
<a href="#l5.54"></a><span id="l5.54">   if (!favoriteAppFolderMenu.hasAttribute(&quot;disabled&quot;)) {</span>
<a href="#l5.55"></a><span id="l5.55">     let folders = gFolderTreeView.getSelectedFolders();</span>
<a href="#l5.56"></a><span id="l5.56">     if (folders.length == 1 &amp;&amp; !folders[0].isServer) {</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-      const kFavoriteFlag = Ci.nsMsgFolderFlags.Favorite;</span>
<a href="#l5.58"></a><span id="l5.58">       // Adjust the checked state on the menu item.</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-      favoriteAppFolderMenu.setAttribute(&quot;checked&quot;, folders[0].getFlag(kFavoriteFlag));</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+      favoriteAppFolderMenu.setAttribute(&quot;checked&quot;,</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+        folders[0].getFlag(Ci.nsMsgFolderFlags.Favorite));</span>
<a href="#l5.62"></a><span id="l5.62">       favoriteAppFolderMenu.hidden = false;</span>
<a href="#l5.63"></a><span id="l5.63">     } else {</span>
<a href="#l5.64"></a><span id="l5.64">       favoriteAppFolderMenu.hidden = true;</span>
<a href="#l5.65"></a><span id="l5.65">     }</span>
<a href="#l5.66"></a><span id="l5.66">   }</span>
<a href="#l5.67"></a><span id="l5.67"> }</span>
<a href="#l5.68"></a><span id="l5.68"> </span>
<a href="#l5.69"></a><span id="l5.69"> function InitGoMessagesMenu()</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineat">@@ -1425,18 +1424,17 @@ function GetFirstSelectedMsgFolder()</span>
<a href="#l5.71"></a><span id="l5.71"> }</span>
<a href="#l5.72"></a><span id="l5.72"> </span>
<a href="#l5.73"></a><span id="l5.73"> function GetInboxFolder(server)</span>
<a href="#l5.74"></a><span id="l5.74"> {</span>
<a href="#l5.75"></a><span id="l5.75">   try {</span>
<a href="#l5.76"></a><span id="l5.76">     var rootMsgFolder = server.rootMsgFolder;</span>
<a href="#l5.77"></a><span id="l5.77"> </span>
<a href="#l5.78"></a><span id="l5.78">     // Now find the Inbox.</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-    const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-    return rootMsgFolder.getFolderWithFlags(nsMsgFolderFlags.Inbox);</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+    return rootMsgFolder.getFolderWithFlags(Ci.nsMsgFolderFlags.Inbox);</span>
<a href="#l5.82"></a><span id="l5.82">   }</span>
<a href="#l5.83"></a><span id="l5.83">   catch (ex) {</span>
<a href="#l5.84"></a><span id="l5.84">     dump(ex + &quot;\n&quot;);</span>
<a href="#l5.85"></a><span id="l5.85">   }</span>
<a href="#l5.86"></a><span id="l5.86">   return null;</span>
<a href="#l5.87"></a><span id="l5.87"> }</span>
<a href="#l5.88"></a><span id="l5.88"> </span>
<a href="#l5.89"></a><span id="l5.89"> function GetMessagesForInboxOnServer(server)</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineat">@@ -2840,18 +2838,17 @@ function SendUnsentMessages()</span>
<a href="#l5.91"></a><span id="l5.91">   }</span>
<a href="#l5.92"></a><span id="l5.92"> }</span>
<a href="#l5.93"></a><span id="l5.93"> </span>
<a href="#l5.94"></a><span id="l5.94"> function CoalesceGetMsgsForPop3ServersByDestFolder(currentServer,</span>
<a href="#l5.95"></a><span id="l5.95">                                                    pop3DownloadServersArray,</span>
<a href="#l5.96"></a><span id="l5.96">                                                    localFoldersToDownloadTo)</span>
<a href="#l5.97"></a><span id="l5.97"> {</span>
<a href="#l5.98"></a><span id="l5.98">   var outNumFolders = new Object();</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineminus">-  const kInboxFlag = Ci.nsMsgFolderFlags.Inbox;</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-  var inboxFolder = currentServer.rootMsgFolder.getFolderWithFlags(kInboxFlag);</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+  var inboxFolder = currentServer.rootMsgFolder.getFolderWithFlags(Ci.nsMsgFolderFlags.Inbox);</span>
<a href="#l5.102"></a><span id="l5.102">   // coalesce the servers that download into the same folder...</span>
<a href="#l5.103"></a><span id="l5.103">   var index = localFoldersToDownloadTo.indexOf(inboxFolder);</span>
<a href="#l5.104"></a><span id="l5.104">   if (index == -1)</span>
<a href="#l5.105"></a><span id="l5.105">   {</span>
<a href="#l5.106"></a><span id="l5.106">     if (inboxFolder)</span>
<a href="#l5.107"></a><span id="l5.107">     {</span>
<a href="#l5.108"></a><span id="l5.108">       inboxFolder.biffState =  Ci.nsIMsgFolder.nsMsgBiffState_NoMail;</span>
<a href="#l5.109"></a><span id="l5.109">       inboxFolder.clearNewMessages();</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineat">@@ -2998,20 +2995,19 @@ function HandleJunkStatusChanged(folder)</span>
<a href="#l5.111"></a><span id="l5.111">       // unsanitized. Otherwise we wouldn't see the reloaded version anyway.</span>
<a href="#l5.112"></a><span id="l5.112">       // 1) When marking as non-junk from the Junk folder, the msg would move</span>
<a href="#l5.113"></a><span id="l5.113">       //    back to the Inbox -&gt; no reload needed</span>
<a href="#l5.114"></a><span id="l5.114">       //    When marking as non-junk from a folder other than the Junk folder,</span>
<a href="#l5.115"></a><span id="l5.115">       //    the message isn't moved back to Inbox -&gt; reload needed</span>
<a href="#l5.116"></a><span id="l5.116">       //    (see nsMsgDBView::DetermineActionsForJunkChange)</span>
<a href="#l5.117"></a><span id="l5.117">       // 2) When marking as junk, the msg will move or delete, if manualMark is set.</span>
<a href="#l5.118"></a><span id="l5.118">       // 3) Marking as junk in the junk folder just changes the junk status.</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineminus">-      const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineminus">-      if ((!isJunk &amp;&amp; !folder.isSpecialFolder(nsMsgFolderFlags.Junk)) ||</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineplus">+      if ((!isJunk &amp;&amp; !folder.isSpecialFolder(Ci.nsMsgFolderFlags.Junk)) ||</span>
<a href="#l5.122"></a><span id="l5.122">           (isJunk &amp;&amp; !folder.server.spamSettings.manualMark) ||</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineminus">-          (isJunk &amp;&amp; folder.isSpecialFolder(nsMsgFolderFlags.Junk)))</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineplus">+          (isJunk &amp;&amp; folder.isSpecialFolder(Ci.nsMsgFolderFlags.Junk)))</span>
<a href="#l5.125"></a><span id="l5.125">         ReloadMessage();</span>
<a href="#l5.126"></a><span id="l5.126">     }</span>
<a href="#l5.127"></a><span id="l5.127">   }</span>
<a href="#l5.128"></a><span id="l5.128"> }</span>
<a href="#l5.129"></a><span id="l5.129"> </span>
<a href="#l5.130"></a><span id="l5.130"> /**</span>
<a href="#l5.131"></a><span id="l5.131">  * Object to handle message related notifications that are showing in a</span>
<a href="#l5.132"></a><span id="l5.132">  * notificationbox above the message content.</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineat">@@ -3204,18 +3200,17 @@ var gMessageNotificationBar =</span>
<a href="#l5.134"></a><span id="l5.134">       null, this.msgNotificationBar.PRIORITY_INFO_MEDIUM, buttons);</span>
<a href="#l5.135"></a><span id="l5.135">   },</span>
<a href="#l5.136"></a><span id="l5.136"> </span>
<a href="#l5.137"></a><span id="l5.137">   setDraftEditMessage: function() {</span>
<a href="#l5.138"></a><span id="l5.138">    let msgHdr = gFolderDisplay.selectedMessage;</span>
<a href="#l5.139"></a><span id="l5.139">    if (!msgHdr || !msgHdr.folder)</span>
<a href="#l5.140"></a><span id="l5.140">      return;</span>
<a href="#l5.141"></a><span id="l5.141"> </span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-   const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineminus">-   if (msgHdr.folder.isSpecialFolder(nsMsgFolderFlags.Drafts, true))</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+   if (msgHdr.folder.isSpecialFolder(Ci.nsMsgFolderFlags.Drafts, true))</span>
<a href="#l5.145"></a><span id="l5.145">    {</span>
<a href="#l5.146"></a><span id="l5.146">     let draftMsgNote = this.stringBundle.getString(&quot;draftMessageMsg&quot;);</span>
<a href="#l5.147"></a><span id="l5.147"> </span>
<a href="#l5.148"></a><span id="l5.148">     let buttons = [{</span>
<a href="#l5.149"></a><span id="l5.149">       label: this.stringBundle.getString(&quot;draftMessageButton&quot;),</span>
<a href="#l5.150"></a><span id="l5.150">       accessKey: this.stringBundle.getString(&quot;draftMessageButtonKey&quot;),</span>
<a href="#l5.151"></a><span id="l5.151">       popup: null,</span>
<a href="#l5.152"></a><span id="l5.152">       callback: function(aNotification, aButton) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -910,19 +910,17 @@ function loadStartFolder(initialUri)</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5">             // Get the user pref to see if the login at startup is enabled for default account</span>
<a href="#l6.6"></a><span id="l6.6">             isLoginAtStartUpEnabled = defaultServer.loginAtStartUp;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">             // Get Inbox only if login at startup is enabled.</span>
<a href="#l6.9"></a><span id="l6.9">             if (isLoginAtStartUpEnabled)</span>
<a href="#l6.10"></a><span id="l6.10">             {</span>
<a href="#l6.11"></a><span id="l6.11">                 //now find Inbox</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                var outNumFolders = new Object();</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                const kInboxFlag = Ci.nsMsgFolderFlags.Inbox;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-                var inboxFolder = rootMsgFolder.getFolderWithFlags(kInboxFlag);</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+                var inboxFolder = rootMsgFolder.getFolderWithFlags(Ci.nsMsgFolderFlags.Inbox);</span>
<a href="#l6.16"></a><span id="l6.16">                 if (!inboxFolder) return;</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18">                 startFolder = inboxFolder;</span>
<a href="#l6.19"></a><span id="l6.19">             }</span>
<a href="#l6.20"></a><span id="l6.20">         }</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22">         // it is possible we were given an initial uri and we need to subscribe or try to add</span>
<a href="#l6.23"></a><span id="l6.23">         // the folder. i.e. the user just clicked on a news folder they aren't subscribed to from a browser</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/content/msgViewNavigation.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/content/msgViewNavigation.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -38,20 +38,19 @@ function FindNextChildFolder(aParent, aA</span>
<a href="#l7.4"></a><span id="l7.4">     var subFolders = GetSubFoldersInFolderPaneOrder(aParent);</span>
<a href="#l7.5"></a><span id="l7.5">     var i = 0;</span>
<a href="#l7.6"></a><span id="l7.6">     var folder = null;</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">     // Skip folders until after the specified child</span>
<a href="#l7.9"></a><span id="l7.9">     while (folder != aAfter)</span>
<a href="#l7.10"></a><span id="l7.10">       folder = subFolders[i++];</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-    let ignoreFlags = nsMsgFolderFlags.Trash | nsMsgFolderFlags.SentMail |</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-                      nsMsgFolderFlags.Drafts | nsMsgFolderFlags.Queue |</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-                      nsMsgFolderFlags.Templates | nsMsgFolderFlags.Junk;</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+    let ignoreFlags = Ci.nsMsgFolderFlags.Trash | Ci.nsMsgFolderFlags.SentMail |</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+                      Ci.nsMsgFolderFlags.Drafts | Ci.nsMsgFolderFlags.Queue |</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+                      Ci.nsMsgFolderFlags.Templates | Ci.nsMsgFolderFlags.Junk;</span>
<a href="#l7.19"></a><span id="l7.19">     while (i &lt; subFolders.length) {</span>
<a href="#l7.20"></a><span id="l7.20">       folder = subFolders[i++];</span>
<a href="#l7.21"></a><span id="l7.21">       // If there is unread mail in the trash, sent, drafts, unsent messages</span>
<a href="#l7.22"></a><span id="l7.22">       // templates or junk special folder,</span>
<a href="#l7.23"></a><span id="l7.23">       // we ignore it when doing cross folder &quot;next&quot; navigation.</span>
<a href="#l7.24"></a><span id="l7.24">       if (!folder.isSpecialFolder(ignoreFlags, true)) {</span>
<a href="#l7.25"></a><span id="l7.25">         if (folder.getNumUnread(false) &gt; 0)</span>
<a href="#l7.26"></a><span id="l7.26">           return folder;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/content/phishingDetector.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/content/phishingDetector.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -55,19 +55,18 @@ var gPhishingDetector = {</span>
<a href="#l8.4"></a><span id="l8.4">       // we are opening an .eml file.</span>
<a href="#l8.5"></a><span id="l8.5">       var folder = aUrl.folder;</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7">       // Ignore nntp and RSS messages.</span>
<a href="#l8.8"></a><span id="l8.8">       if (folder.server.type == 'nntp' || folder.server.type == 'rss')</span>
<a href="#l8.9"></a><span id="l8.9">         return;</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">       // Also ignore messages in Sent/Drafts/Templates/Outbox.</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-      let outgoingFlags = nsMsgFolderFlags.SentMail | nsMsgFolderFlags.Drafts |</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-                          nsMsgFolderFlags.Templates | nsMsgFolderFlags.Queue;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+      let outgoingFlags = Ci.nsMsgFolderFlags.SentMail | Ci.nsMsgFolderFlags.Drafts |</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+                          Ci.nsMsgFolderFlags.Templates | Ci.nsMsgFolderFlags.Queue;</span>
<a href="#l8.17"></a><span id="l8.17">       if (folder.isSpecialFolder(outgoingFlags, true))</span>
<a href="#l8.18"></a><span id="l8.18">         return;</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">     } catch (ex) {</span>
<a href="#l8.21"></a><span id="l8.21">         if (ex.result != Cr.NS_ERROR_FAILURE)</span>
<a href="#l8.22"></a><span id="l8.22">           throw ex;</span>
<a href="#l8.23"></a><span id="l8.23">     }</span>
<a href="#l8.24"></a><span id="l8.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/base/content/threadPane.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/base/content/threadPane.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -131,21 +131,20 @@ function HandleColumnClick(columnID)</span>
<a href="#l9.4"></a><span id="l9.4">   }</span>
<a href="#l9.5"></a><span id="l9.5">   else {</span>
<a href="#l9.6"></a><span id="l9.6">     MsgSortThreadPane(sortType);</span>
<a href="#l9.7"></a><span id="l9.7">   }</span>
<a href="#l9.8"></a><span id="l9.8"> }</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10"> function ThreadPaneDoubleClick()</span>
<a href="#l9.11"></a><span id="l9.11"> {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-  if (IsSpecialFolderSelected(nsMsgFolderFlags.Drafts, true)) {</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  if (IsSpecialFolderSelected(Ci.nsMsgFolderFlags.Drafts, true)) {</span>
<a href="#l9.15"></a><span id="l9.15">     MsgComposeDraftMessage();</span>
<a href="#l9.16"></a><span id="l9.16">   }</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-  else if(IsSpecialFolderSelected(nsMsgFolderFlags.Templates, true)) {</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+  else if (IsSpecialFolderSelected(Ci.nsMsgFolderFlags.Templates, true)) {</span>
<a href="#l9.19"></a><span id="l9.19">     ComposeMessage(Ci.nsIMsgCompType.Template,</span>
<a href="#l9.20"></a><span id="l9.20">                    Ci.nsIMsgCompFormat.Default,</span>
<a href="#l9.21"></a><span id="l9.21">                    gFolderDisplay.displayedFolder,</span>
<a href="#l9.22"></a><span id="l9.22">                    gFolderDisplay.selectedMessageUris);</span>
<a href="#l9.23"></a><span id="l9.23">   }</span>
<a href="#l9.24"></a><span id="l9.24">   else {</span>
<a href="#l9.25"></a><span id="l9.25">     MsgOpenSelectedMessages();</span>
<a href="#l9.26"></a><span id="l9.26">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/activity/modules/moveCopy.jsm</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/activity/modules/moveCopy.jsm</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -2,17 +2,16 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.5"></a><span id="l10.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.6"></a><span id="l10.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> this.EXPORTED_SYMBOLS = [&quot;moveCopyModule&quot;];</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10"> var nsActEvent = Components.Constructor(&quot;@mozilla.org/activity-event;1&quot;,</span>
<a href="#l10.11"></a><span id="l10.11">                                           &quot;nsIActivityEvent&quot;, &quot;init&quot;);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-var nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l10.13"></a><span id="l10.13"> </span>
<a href="#l10.14"></a><span id="l10.14"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l10.15"></a><span id="l10.15"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l10.16"></a><span id="l10.16"> ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l10.17"></a><span id="l10.17"> const { Log4Moz } = ChromeUtils.import(&quot;resource:///modules/gloda/log4moz.js&quot;, null);</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19"> // This module provides a link between the move/copy code and the activity</span>
<a href="#l10.20"></a><span id="l10.20"> // manager.</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -179,17 +178,17 @@ var moveCopyModule =</span>
<a href="#l10.22"></a><span id="l10.22">       MailServices.accounts.FindServer(server.username, server.hostName, server.type);</span>
<a href="#l10.23"></a><span id="l10.23">     } catch (ex) { return; }</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25">     let displayText;</span>
<a href="#l10.26"></a><span id="l10.26">     let statusText = server.prettyName;</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">     // Display a different message depending on whether we emptied the trash</span>
<a href="#l10.29"></a><span id="l10.29">     // or actually deleted a folder</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-    if (aFolder.isSpecialFolder(nsMsgFolderFlags.Trash, false))</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+    if (aFolder.isSpecialFolder(Ci.nsMsgFolderFlags.Trash, false))</span>
<a href="#l10.32"></a><span id="l10.32">       displayText = this.getString(&quot;emptiedTrash&quot;);</span>
<a href="#l10.33"></a><span id="l10.33">     else</span>
<a href="#l10.34"></a><span id="l10.34">       displayText = this.getString(&quot;deletedFolder&quot;).replace(&quot;#1&quot;, aFolder.prettyName);</span>
<a href="#l10.35"></a><span id="l10.35"> </span>
<a href="#l10.36"></a><span id="l10.36">     // create an activity event</span>
<a href="#l10.37"></a><span id="l10.37">     let event = new nsActEvent(displayText,</span>
<a href="#l10.38"></a><span id="l10.38">                                server,</span>
<a href="#l10.39"></a><span id="l10.39">                                statusText,</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineat">@@ -244,17 +243,17 @@ var moveCopyModule =</span>
<a href="#l10.41"></a><span id="l10.41">     this.log.info(&quot;in folderRenamed, aOrigFolder = &quot; + aOrigFolder.prettyName +</span>
<a href="#l10.42"></a><span id="l10.42">                   &quot;, aNewFolder = &quot; + aNewFolder.prettyName);</span>
<a href="#l10.43"></a><span id="l10.43"> </span>
<a href="#l10.44"></a><span id="l10.44">     let displayText;</span>
<a href="#l10.45"></a><span id="l10.45">     let statusText = aNewFolder.server.prettyName;</span>
<a href="#l10.46"></a><span id="l10.46"> </span>
<a href="#l10.47"></a><span id="l10.47">     // Display a different message depending on whether we moved the folder</span>
<a href="#l10.48"></a><span id="l10.48">     // to the trash or actually renamed the folder.</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-    if (aNewFolder.isSpecialFolder(nsMsgFolderFlags.Trash, true)) {</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+    if (aNewFolder.isSpecialFolder(Ci.nsMsgFolderFlags.Trash, true)) {</span>
<a href="#l10.51"></a><span id="l10.51">       displayText = this.getString(&quot;movedFolderToTrash&quot;);</span>
<a href="#l10.52"></a><span id="l10.52">       displayText = displayText.replace(&quot;#1&quot;, aOrigFolder.prettyName);</span>
<a href="#l10.53"></a><span id="l10.53">     } else {</span>
<a href="#l10.54"></a><span id="l10.54">       displayText = this.getString(&quot;renamedFolder&quot;);</span>
<a href="#l10.55"></a><span id="l10.55">       displayText = displayText.replace(&quot;#1&quot;, aOrigFolder.prettyName);</span>
<a href="#l10.56"></a><span id="l10.56">       displayText = displayText.replace(&quot;#2&quot;, aNewFolder.prettyName);</span>
<a href="#l10.57"></a><span id="l10.57">     }</span>
<a href="#l10.58"></a><span id="l10.58"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/test/mozmill/folder-pane/test-display-message-with-folder-modes.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/test/mozmill/folder-pane/test-display-message-with-folder-modes.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -80,20 +80,20 @@ function test_display_message_with_folde</span>
<a href="#l11.4"></a><span id="l11.4"> }</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6"> /**</span>
<a href="#l11.7"></a><span id="l11.7">  * Test that displaying a message _does not_ cause a switch to the default</span>
<a href="#l11.8"></a><span id="l11.8">  * folder mode if the folder is present in the current folder mode.</span>
<a href="#l11.9"></a><span id="l11.9">  */</span>
<a href="#l11.10"></a><span id="l11.10"> function test_display_message_with_folder_present_in_current_folder_mode() {</span>
<a href="#l11.11"></a><span id="l11.11">   // Mark the folder as a favorite</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  folder.flags |= Ci.nsMsgFolderFlags.Favorite;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  folder.setFlag(Ci.nsMsgFolderFlags.Favorite);</span>
<a href="#l11.14"></a><span id="l11.14">   // Also mark the dummy folder as a favorite, in preparation for</span>
<a href="#l11.15"></a><span id="l11.15">   // test_display_message_in_smart_folder_mode_works</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-  dummyFolder.flags |= Ci.nsMsgFolderFlags.Favorite;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+  dummyFolder.setFlag(Ci.nsMsgFolderFlags.Favorite);</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19">   // Make sure the folder doesn't appear in the favorite folder mode just</span>
<a href="#l11.20"></a><span id="l11.20">   // because it was selected last before switching</span>
<a href="#l11.21"></a><span id="l11.21">   be_in_folder(inboxFolder);</span>
<a href="#l11.22"></a><span id="l11.22"> </span>
<a href="#l11.23"></a><span id="l11.23">   // Switch to favorite folders. Check that the folder is now in the view, as is</span>
<a href="#l11.24"></a><span id="l11.24">   // the dummy folder</span>
<a href="#l11.25"></a><span id="l11.25">   mc.folderTreeView.mode = &quot;favorite&quot;;</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineat">@@ -107,18 +107,18 @@ function test_display_message_with_folde</span>
<a href="#l11.27"></a><span id="l11.27">   // Try displaying a message</span>
<a href="#l11.28"></a><span id="l11.28">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l11.29"></a><span id="l11.29"> </span>
<a href="#l11.30"></a><span id="l11.30">   assert_folder_mode(&quot;favorite&quot;);</span>
<a href="#l11.31"></a><span id="l11.31">   assert_folder_selected_and_displayed(folder);</span>
<a href="#l11.32"></a><span id="l11.32">   assert_selected_and_displayed(msgHdr);</span>
<a href="#l11.33"></a><span id="l11.33"> </span>
<a href="#l11.34"></a><span id="l11.34">   // Now unset the flags so that we don't affect later tests.</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-  folder.flags &amp;= ~Ci.nsMsgFolderFlags.Favorite;</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-  dummyFolder.flags &amp;= ~Ci.nsMsgFolderFlags.Favorite;</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+  folder.clearFlag(Ci.nsMsgFolderFlags.Favorite);</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+  dummyFolder.clearFlag(Ci.nsMsgFolderFlags.Favorite);</span>
<a href="#l11.39"></a><span id="l11.39"> }</span>
<a href="#l11.40"></a><span id="l11.40"> </span>
<a href="#l11.41"></a><span id="l11.41"> /**</span>
<a href="#l11.42"></a><span id="l11.42">  * Test that displaying a message in smart folders mode causes the parent in the</span>
<a href="#l11.43"></a><span id="l11.43">  * view to expand.</span>
<a href="#l11.44"></a><span id="l11.44">  */</span>
<a href="#l11.45"></a><span id="l11.45"> function test_display_message_in_smart_folder_mode_works() {</span>
<a href="#l11.46"></a><span id="l11.46">   // Clear the message selection, otherwise msgHdr will still be displayed and</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/test/mozmill/folder-tree-modes/test-mode-switching.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/test/mozmill/folder-tree-modes/test-mode-switching.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -40,17 +40,17 @@ function setupModule(module) {</span>
<a href="#l12.4"></a><span id="l12.4">   // Create one folder with unread messages and one favorite folder.</span>
<a href="#l12.5"></a><span id="l12.5">   inboxFolder.createSubfolder(&quot;UnreadFolder&quot;, null);</span>
<a href="#l12.6"></a><span id="l12.6">   unreadFolder = inboxFolder.getChildNamed(&quot;UnreadFolder&quot;);</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8">   inboxFolder.createSubfolder(&quot;FavoriteFolder&quot;, null);</span>
<a href="#l12.9"></a><span id="l12.9">   favoriteFolder = inboxFolder.getChildNamed(&quot;FavoriteFolder&quot;);</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11">   make_new_sets_in_folder(unreadFolder, [{count: 1}]);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  favoriteFolder.flags |= Ci.nsMsgFolderFlags.Favorite;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  favoriteFolder.setFlag(Ci.nsMsgFolderFlags.Favorite);</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15">   toggle_menu = mc.e(&quot;menu_compactFolderView&quot;);</span>
<a href="#l12.16"></a><span id="l12.16">   toggle_appmenu = mc.e(&quot;appmenu_compactFolderView&quot;);</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18">   modeList_menu = mc.e(&quot;menu_FolderViewsPopup&quot;);</span>
<a href="#l12.19"></a><span id="l12.19">   modeList_appmenu = mc.e(&quot;appmenu_FolderViewsPopup&quot;);</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21">   view_menu = mc.eid(&quot;menu_View&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/test/mozmill/folder-tree-modes/test-smart-folders.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/test/mozmill/folder-tree-modes/test-smart-folders.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -19,30 +19,28 @@ var rootFolder;</span>
<a href="#l13.4"></a><span id="l13.4"> var inboxSubfolder;</span>
<a href="#l13.5"></a><span id="l13.5"> var trashFolder;</span>
<a href="#l13.6"></a><span id="l13.6"> var trashSubfolder;</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> var smartInboxFolder;</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10"> var inboxSet;</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-var nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-</span>
<a href="#l13.14"></a><span id="l13.14"> function setupModule(module) {</span>
<a href="#l13.15"></a><span id="l13.15">   let fdh = collector.getModule(&quot;folder-display-helpers&quot;);</span>
<a href="#l13.16"></a><span id="l13.16">   fdh.installInto(module);</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18">   rootFolder = inboxFolder.server.rootFolder;</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20">   // Create a folder as a subfolder of the inbox</span>
<a href="#l13.21"></a><span id="l13.21">   inboxFolder.createSubfolder(&quot;SmartFoldersA&quot;, null);</span>
<a href="#l13.22"></a><span id="l13.22">   inboxSubfolder = inboxFolder.getChildNamed(&quot;SmartFoldersA&quot;);</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24">   trashFolder = inboxFolder.server.rootFolder.getFolderWithFlags(</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">-    nsMsgFolderFlags.Trash);</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+    Ci.nsMsgFolderFlags.Trash);</span>
<a href="#l13.27"></a><span id="l13.27">   trashFolder.createSubfolder(&quot;SmartFoldersB&quot;, null);</span>
<a href="#l13.28"></a><span id="l13.28">   trashSubfolder = trashFolder.getChildNamed(&quot;SmartFoldersB&quot;);</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30">   // The message itself doesn't really matter, as long as there's at least one</span>
<a href="#l13.31"></a><span id="l13.31">   // in the folder.</span>
<a href="#l13.32"></a><span id="l13.32">   [inboxSet] = make_new_sets_in_folder(inboxFolder, [{count: 1}]);</span>
<a href="#l13.33"></a><span id="l13.33">   make_new_sets_in_folder(inboxSubfolder, [{count: 1}]);</span>
<a href="#l13.34"></a><span id="l13.34"> }</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineat">@@ -173,17 +171,17 @@ function test_folder_flag_changes() {</span>
<a href="#l13.36"></a><span id="l13.36">   rootFolder = inboxFolder.server.rootFolder;</span>
<a href="#l13.37"></a><span id="l13.37">   let archiveFolder = rootFolder.getChildNamed(&quot;Archives&quot;);</span>
<a href="#l13.38"></a><span id="l13.38">   assert_folder_and_children_in_scope(archiveFolder, archiveScope);</span>
<a href="#l13.39"></a><span id="l13.39">   archiveFolder = pop3Server.rootFolder.getChildNamed(&quot;Archives&quot;);</span>
<a href="#l13.40"></a><span id="l13.40">   assert_folder_and_children_in_scope(archiveFolder, archiveScope);</span>
<a href="#l13.41"></a><span id="l13.41"> </span>
<a href="#l13.42"></a><span id="l13.42">   // Remove the archive flag, and make sure the archive folder and</span>
<a href="#l13.43"></a><span id="l13.43">   // its children are no longer in the search scope.</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-  archiveFolder.clearFlag(nsMsgFolderFlags.Archive);</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+  archiveFolder.clearFlag(Ci.nsMsgFolderFlags.Archive);</span>
<a href="#l13.46"></a><span id="l13.46"> </span>
<a href="#l13.47"></a><span id="l13.47">   // Refresh the archive scope because clearing the flag should have</span>
<a href="#l13.48"></a><span id="l13.48">   // changed it.</span>
<a href="#l13.49"></a><span id="l13.49">   archiveScope = &quot;|&quot; + smartArchiveFolder.msgDatabase.dBFolderInfo</span>
<a href="#l13.50"></a><span id="l13.50">                  .getCharProperty(&quot;searchFolderUri&quot;) + &quot;|&quot;;</span>
<a href="#l13.51"></a><span id="l13.51"> </span>
<a href="#l13.52"></a><span id="l13.52">   // figure out what we expect the archiveScope to now be.</span>
<a href="#l13.53"></a><span id="l13.53">   rootFolder = inboxFolder.server.rootFolder;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/test/mozmill/folder-tree-modes/test-unread-folders.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/test/mozmill/folder-tree-modes/test-unread-folders.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -16,30 +16,28 @@ var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l14.4"></a><span id="l14.4"> var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;];</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6"> var rootFolder;</span>
<a href="#l14.7"></a><span id="l14.7"> var inboxSubfolder;</span>
<a href="#l14.8"></a><span id="l14.8"> var trashFolder;</span>
<a href="#l14.9"></a><span id="l14.9"> var trashSubfolder;</span>
<a href="#l14.10"></a><span id="l14.10"> var inboxSet;</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-var nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-</span>
<a href="#l14.14"></a><span id="l14.14"> function setupModule(module) {</span>
<a href="#l14.15"></a><span id="l14.15">   let fdh = collector.getModule(&quot;folder-display-helpers&quot;);</span>
<a href="#l14.16"></a><span id="l14.16">   fdh.installInto(module);</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18">   rootFolder = inboxFolder.server.rootFolder;</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20">   // Create a folder as a subfolder of the inbox</span>
<a href="#l14.21"></a><span id="l14.21">   inboxFolder.createSubfolder(&quot;UnreadFoldersA&quot;, null);</span>
<a href="#l14.22"></a><span id="l14.22">   inboxSubfolder = inboxFolder.getChildNamed(&quot;UnreadFoldersA&quot;);</span>
<a href="#l14.23"></a><span id="l14.23"> </span>
<a href="#l14.24"></a><span id="l14.24">   trashFolder = inboxFolder.server.rootFolder.getFolderWithFlags(</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-    nsMsgFolderFlags.Trash);</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+    Ci.nsMsgFolderFlags.Trash);</span>
<a href="#l14.27"></a><span id="l14.27">   trashFolder.createSubfolder(&quot;UnreadFoldersB&quot;, null);</span>
<a href="#l14.28"></a><span id="l14.28">   trashSubfolder = trashFolder.getChildNamed(&quot;UnreadFoldersB&quot;);</span>
<a href="#l14.29"></a><span id="l14.29"> </span>
<a href="#l14.30"></a><span id="l14.30">   // The message itself doesn't really matter, as long as there's at least one</span>
<a href="#l14.31"></a><span id="l14.31">   // in the folder.</span>
<a href="#l14.32"></a><span id="l14.32">   [ inboxSet ] = make_new_sets_in_folder(inboxFolder, [{count: 1}]);</span>
<a href="#l14.33"></a><span id="l14.33">   make_new_sets_in_folder(inboxSubfolder, [{count: 1}]);</span>
<a href="#l14.34"></a><span id="l14.34"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/content/folderProps.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/content/folderProps.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -99,17 +99,16 @@ function doEnabling()</span>
<a href="#l15.4"></a><span id="l15.4">   var nameTextbox = document.getElementById(&quot;name&quot;);</span>
<a href="#l15.5"></a><span id="l15.5">   document.documentElement.getButton(&quot;accept&quot;).disabled = !nameTextbox.value;</span>
<a href="#l15.6"></a><span id="l15.6"> }</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> function folderPropsOKButton()</span>
<a href="#l15.9"></a><span id="l15.9"> {</span>
<a href="#l15.10"></a><span id="l15.10">   if (gMsgFolder)</span>
<a href="#l15.11"></a><span id="l15.11">   {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l15.13"></a><span id="l15.13">     // set charset attributes</span>
<a href="#l15.14"></a><span id="l15.14">     var folderCharsetList = document.getElementById(&quot;folderCharsetList&quot;);</span>
<a href="#l15.15"></a><span id="l15.15"> </span>
<a href="#l15.16"></a><span id="l15.16">     // Log to the Error Console the charset value for the folder</span>
<a href="#l15.17"></a><span id="l15.17">     // if it is unknown to us. Value will be preserved by the menu-item.</span>
<a href="#l15.18"></a><span id="l15.18">     if (folderCharsetList.selectedIndex == -1)</span>
<a href="#l15.19"></a><span id="l15.19">     {</span>
<a href="#l15.20"></a><span id="l15.20">       Cu.reportError(&quot;Unknown folder encoding; folder=&quot; +</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineat">@@ -117,24 +116,24 @@ function folderPropsOKButton()</span>
<a href="#l15.22"></a><span id="l15.22">     }</span>
<a href="#l15.23"></a><span id="l15.23"> </span>
<a href="#l15.24"></a><span id="l15.24">     gMsgFolder.charset = folderCharsetList.getAttribute(&quot;value&quot;);</span>
<a href="#l15.25"></a><span id="l15.25">     gMsgFolder.charsetOverride = document.getElementById(&quot;folderCharsetOverride&quot;)</span>
<a href="#l15.26"></a><span id="l15.26">                                          .checked;</span>
<a href="#l15.27"></a><span id="l15.27"> </span>
<a href="#l15.28"></a><span id="l15.28">     if(document.getElementById(&quot;offline.selectForOfflineFolder&quot;).checked ||</span>
<a href="#l15.29"></a><span id="l15.29">       document.getElementById(&quot;offline.selectForOfflineNewsgroup&quot;).checked)</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-      gMsgFolder.setFlag(nsMsgFolderFlags.Offline);</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+      gMsgFolder.setFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l15.32"></a><span id="l15.32">     else</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-      gMsgFolder.clearFlag(nsMsgFolderFlags.Offline);</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+      gMsgFolder.clearFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36">     if(document.getElementById(&quot;folderCheckForNewMessages&quot;).checked)</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-      gMsgFolder.setFlag(nsMsgFolderFlags.CheckNew);</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+      gMsgFolder.setFlag(Ci.nsMsgFolderFlags.CheckNew);</span>
<a href="#l15.39"></a><span id="l15.39">     else</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-      gMsgFolder.clearFlag(nsMsgFolderFlags.CheckNew);</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+      gMsgFolder.clearFlag(Ci.nsMsgFolderFlags.CheckNew);</span>
<a href="#l15.42"></a><span id="l15.42"> </span>
<a href="#l15.43"></a><span id="l15.43">     let glodaCheckbox = document.getElementById(&quot;folderIncludeInGlobalSearch&quot;);</span>
<a href="#l15.44"></a><span id="l15.44">     if (!glodaCheckbox.hidden) {</span>
<a href="#l15.45"></a><span id="l15.45">       if(glodaCheckbox.checked) {</span>
<a href="#l15.46"></a><span id="l15.46">         // We pass true here so that folders such as trash and junk can still</span>
<a href="#l15.47"></a><span id="l15.47">         // have a priority set.</span>
<a href="#l15.48"></a><span id="l15.48">         Gloda.resetFolderIndexingPriority(gMsgFolder, true);</span>
<a href="#l15.49"></a><span id="l15.49">       } else {</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineat">@@ -189,17 +188,16 @@ function folderPropsOnLoad()</span>
<a href="#l15.51"></a><span id="l15.51">     // when the dialog is accepted.</span>
<a href="#l15.52"></a><span id="l15.52">     var nameTextbox = document.getElementById(&quot;name&quot;);</span>
<a href="#l15.53"></a><span id="l15.53">     nameTextbox.value = window.arguments[0].name;</span>
<a href="#l15.54"></a><span id="l15.54"> </span>
<a href="#l15.55"></a><span id="l15.55"> //  name.setSelectionRange(0,-1);</span>
<a href="#l15.56"></a><span id="l15.56"> //  name.focusTextField();</span>
<a href="#l15.57"></a><span id="l15.57">   }</span>
<a href="#l15.58"></a><span id="l15.58"> </span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-  const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l15.60"></a><span id="l15.60">   const serverType = window.arguments[0].serverType;</span>
<a href="#l15.61"></a><span id="l15.61"> </span>
<a href="#l15.62"></a><span id="l15.62">   // Do this first, because of gloda we may want to override some of the hidden</span>
<a href="#l15.63"></a><span id="l15.63">   // statuses.</span>
<a href="#l15.64"></a><span id="l15.64">   hideShowControls(serverType);</span>
<a href="#l15.65"></a><span id="l15.65"> </span>
<a href="#l15.66"></a><span id="l15.66">   if (gMsgFolder) {</span>
<a href="#l15.67"></a><span id="l15.67">     // We really need a functioning database, so we'll detect problems</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineat">@@ -216,17 +214,17 @@ function folderPropsOnLoad()</span>
<a href="#l15.69"></a><span id="l15.69">     // Decode the displayed mailbox:// URL as it's useful primarily for debugging,</span>
<a href="#l15.70"></a><span id="l15.70">     // whereas imap and news urls are sent around.</span>
<a href="#l15.71"></a><span id="l15.71">     locationTextbox.value = (serverType == &quot;imap&quot; || serverType == &quot;nntp&quot;) ?</span>
<a href="#l15.72"></a><span id="l15.72">         gMsgFolder.folderURL : decodeURI(gMsgFolder.folderURL);</span>
<a href="#l15.73"></a><span id="l15.73"> </span>
<a href="#l15.74"></a><span id="l15.74">     if (gMsgFolder.canRename)</span>
<a href="#l15.75"></a><span id="l15.75">       document.getElementById(&quot;name&quot;).removeAttribute(&quot;readonly&quot;);</span>
<a href="#l15.76"></a><span id="l15.76"> </span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-    if (gMsgFolder.flags &amp; nsMsgFolderFlags.Offline) {</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+    if (gMsgFolder.getFlag(Ci.nsMsgFolderFlags.Offline)) {</span>
<a href="#l15.79"></a><span id="l15.79"> </span>
<a href="#l15.80"></a><span id="l15.80">       if(serverType == &quot;imap&quot; || serverType == &quot;pop3&quot;)</span>
<a href="#l15.81"></a><span id="l15.81">         document.getElementById(&quot;offline.selectForOfflineFolder&quot;).checked = true;</span>
<a href="#l15.82"></a><span id="l15.82"> </span>
<a href="#l15.83"></a><span id="l15.83">       if(serverType == &quot;nntp&quot;)</span>
<a href="#l15.84"></a><span id="l15.84">         document.getElementById(&quot;offline.selectForOfflineNewsgroup&quot;).checked = true;</span>
<a href="#l15.85"></a><span id="l15.85">     }</span>
<a href="#l15.86"></a><span id="l15.86">     else {</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineat">@@ -240,24 +238,25 @@ function folderPropsOnLoad()</span>
<a href="#l15.88"></a><span id="l15.88">     // select the menu item</span>
<a href="#l15.89"></a><span id="l15.89">     var folderCharsetList = document.getElementById(&quot;folderCharsetList&quot;);</span>
<a href="#l15.90"></a><span id="l15.90">     folderCharsetList.value = gMsgFolder.charset;</span>
<a href="#l15.91"></a><span id="l15.91"> </span>
<a href="#l15.92"></a><span id="l15.92">     // set override checkbox</span>
<a href="#l15.93"></a><span id="l15.93">     document.getElementById(&quot;folderCharsetOverride&quot;).checked = gMsgFolder.charsetOverride;</span>
<a href="#l15.94"></a><span id="l15.94"> </span>
<a href="#l15.95"></a><span id="l15.95">     // set check for new mail checkbox</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineminus">-    document.getElementById(&quot;folderCheckForNewMessages&quot;).checked = gMsgFolder.flags &amp; nsMsgFolderFlags.CheckNew;</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineplus">+    document.getElementById(&quot;folderCheckForNewMessages&quot;).checked =</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineplus">+      gMsgFolder.getFlag(Ci.nsMsgFolderFlags.CheckNew);</span>
<a href="#l15.99"></a><span id="l15.99"> </span>
<a href="#l15.100"></a><span id="l15.100">     // if gloda indexing is off, hide the related checkbox</span>
<a href="#l15.101"></a><span id="l15.101">     var glodaCheckbox = document.getElementById(&quot;folderIncludeInGlobalSearch&quot;);</span>
<a href="#l15.102"></a><span id="l15.102">     var glodaEnabled = Services.prefs</span>
<a href="#l15.103"></a><span id="l15.103">       .getBoolPref(&quot;mailnews.database.global.indexer.enabled&quot;);</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-    if (!glodaEnabled || (gMsgFolder.flags &amp; (nsMsgFolderFlags.Queue |</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineminus">-                                              nsMsgFolderFlags.Newsgroup))) {</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineplus">+    if (!glodaEnabled || (gMsgFolder.flags &amp; (Ci.nsMsgFolderFlags.Queue |</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineplus">+                                              Ci.nsMsgFolderFlags.Newsgroup))) {</span>
<a href="#l15.108"></a><span id="l15.108">       glodaCheckbox.hidden = true;</span>
<a href="#l15.109"></a><span id="l15.109">     } else {</span>
<a href="#l15.110"></a><span id="l15.110">       // otherwise, the user can choose whether this file gets indexed</span>
<a href="#l15.111"></a><span id="l15.111">       let glodaFolder = Gloda.getFolderForFolder(gMsgFolder);</span>
<a href="#l15.112"></a><span id="l15.112">       glodaCheckbox.checked =</span>
<a href="#l15.113"></a><span id="l15.113">         glodaFolder.indexingPriority != glodaFolder.kIndexingNeverPriority;</span>
<a href="#l15.114"></a><span id="l15.114">     }</span>
<a href="#l15.115"></a><span id="l15.115">   }</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineat">@@ -333,24 +332,23 @@ function hideShowControls(serverType)</span>
<a href="#l15.117"></a><span id="l15.117">           privilegesButton.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l15.118"></a><span id="l15.118">       }</span>
<a href="#l15.119"></a><span id="l15.119">     }</span>
<a href="#l15.120"></a><span id="l15.120">   }</span>
<a href="#l15.121"></a><span id="l15.121">   catch (ex) {}</span>
<a href="#l15.122"></a><span id="l15.122"> </span>
<a href="#l15.123"></a><span id="l15.123">   if (gMsgFolder)</span>
<a href="#l15.124"></a><span id="l15.124">   {</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineminus">-    const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l15.126"></a><span id="l15.126">     // Hide &quot;check for new mail&quot; checkbox if this is an Inbox.</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineminus">-    if (gMsgFolder.flags &amp; nsMsgFolderFlags.Inbox)</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineplus">+    if (gMsgFolder.getFlag(Ci.nsMsgFolderFlags.Inbox))</span>
<a href="#l15.129"></a><span id="l15.129">       document.getElementById(&quot;folderCheckForNewMessages&quot;).hidden = true;</span>
<a href="#l15.130"></a><span id="l15.130">     // Retention policy doesn't apply to Drafts/Templates/Outbox.</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineminus">-    if (gMsgFolder.isSpecialFolder(nsMsgFolderFlags.Drafts |</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineminus">-                                   nsMsgFolderFlags.Templates |</span>
<a href="#l15.133"></a><span id="l15.133" class="difflineminus">-                                   nsMsgFolderFlags.Queue, true))</span>
<a href="#l15.134"></a><span id="l15.134" class="difflineplus">+    if (gMsgFolder.isSpecialFolder(Ci.nsMsgFolderFlags.Drafts |</span>
<a href="#l15.135"></a><span id="l15.135" class="difflineplus">+                                   Ci.nsMsgFolderFlags.Templates |</span>
<a href="#l15.136"></a><span id="l15.136" class="difflineplus">+                                   Ci.nsMsgFolderFlags.Queue, true))</span>
<a href="#l15.137"></a><span id="l15.137">       document.getElementById(&quot;Retention&quot;).hidden = true;</span>
<a href="#l15.138"></a><span id="l15.138">   }</span>
<a href="#l15.139"></a><span id="l15.139"> }</span>
<a href="#l15.140"></a><span id="l15.140"> </span>
<a href="#l15.141"></a><span id="l15.141"> function onOfflineFolderDownload()</span>
<a href="#l15.142"></a><span id="l15.142"> {</span>
<a href="#l15.143"></a><span id="l15.143">   // we need to create a progress window and pass that in as the second parameter here.</span>
<a href="#l15.144"></a><span id="l15.144">   gMsgFolder.downloadAllForOffline(null, window.arguments[0].msgWindow);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/content/msgSelectOfflineFolders.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/content/msgSelectOfflineFolders.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -12,17 +12,17 @@ var gSelectOffline = {</span>
<a href="#l16.4"></a><span id="l16.4">       if (!aColumn || aColumn.id != &quot;syncCol&quot;)</span>
<a href="#l16.5"></a><span id="l16.5">         return oldProps.call(this, aColumn);</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7">       let properties = &quot;syncCol&quot;;</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9">       if (this._folder.isServer)</span>
<a href="#l16.10"></a><span id="l16.10">         return &quot; isServer-true&quot;;</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-      if (this._folder.getFlag(nsMsgFolderFlags.Offline))</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+      if (this._folder.getFlag(Ci.nsMsgFolderFlags.Offline))</span>
<a href="#l16.14"></a><span id="l16.14">         properties += &quot; synchronize-true&quot;;</span>
<a href="#l16.15"></a><span id="l16.15"> </span>
<a href="#l16.16"></a><span id="l16.16">       return properties;</span>
<a href="#l16.17"></a><span id="l16.17">     }</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">     let modeOffline = {</span>
<a href="#l16.20"></a><span id="l16.20">       __proto__: IFolderTreeMode,</span>
<a href="#l16.21"></a><span id="l16.21"> </span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -82,26 +82,26 @@ var gSelectOffline = {</span>
<a href="#l16.23"></a><span id="l16.23">   _toggle: function(aRow) {</span>
<a href="#l16.24"></a><span id="l16.24">     let folder = gFolderTreeView._rowMap[aRow]._folder;</span>
<a href="#l16.25"></a><span id="l16.25"> </span>
<a href="#l16.26"></a><span id="l16.26">     if (folder.isServer)</span>
<a href="#l16.27"></a><span id="l16.27">       return;</span>
<a href="#l16.28"></a><span id="l16.28"> </span>
<a href="#l16.29"></a><span id="l16.29">     // Save our current state for rollback, if necessary.</span>
<a href="#l16.30"></a><span id="l16.30">     if (!this._rollbackMap.has(folder))</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-      this._rollbackMap.set(folder, folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+      this._rollbackMap.set(folder, folder.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l16.33"></a><span id="l16.33"> </span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-    folder.toggleFlag(nsMsgFolderFlags.Offline);</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+    folder.toggleFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l16.36"></a><span id="l16.36">     gFolderTreeView._tree.invalidateRow(aRow);</span>
<a href="#l16.37"></a><span id="l16.37">   },</span>
<a href="#l16.38"></a><span id="l16.38"> </span>
<a href="#l16.39"></a><span id="l16.39">   onAccept: function() {</span>
<a href="#l16.40"></a><span id="l16.40">     gFolderTreeView.unload();</span>
<a href="#l16.41"></a><span id="l16.41">   },</span>
<a href="#l16.42"></a><span id="l16.42"> </span>
<a href="#l16.43"></a><span id="l16.43">   onCancel: function() {</span>
<a href="#l16.44"></a><span id="l16.44">     gFolderTreeView.unload();</span>
<a href="#l16.45"></a><span id="l16.45">     for (let [folder, value] of this._rollbackMap) {</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineminus">-      if (value != folder.getFlag(nsMsgFolderFlags.Offline))</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-        folder.toggleFlag(nsMsgFolderFlags.Offline);</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineplus">+      if (value != folder.getFlag(Ci.nsMsgFolderFlags.Offline))</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineplus">+        folder.toggleFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l16.50"></a><span id="l16.50">     }</span>
<a href="#l16.51"></a><span id="l16.51">   }</span>
<a href="#l16.52"></a><span id="l16.52"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/util/folderUtils.jsm</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/util/folderUtils.jsm</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -13,35 +13,34 @@ ChromeUtils.import(&quot;resource:///modules/</span>
<a href="#l17.4"></a><span id="l17.4"> ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6"> /**</span>
<a href="#l17.7"></a><span id="l17.7">  * Returns a string representation of a folder's &quot;special&quot; type.</span>
<a href="#l17.8"></a><span id="l17.8">  *</span>
<a href="#l17.9"></a><span id="l17.9">  * @param aFolder  the nsIMsgFolder whose special type should be returned</span>
<a href="#l17.10"></a><span id="l17.10">  */</span>
<a href="#l17.11"></a><span id="l17.11"> function getSpecialFolderString(aFolder) {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l17.13"></a><span id="l17.13">   let flags = aFolder.flags;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-  if (flags &amp; nsMsgFolderFlags.Inbox)</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+  if (flags &amp; Ci.nsMsgFolderFlags.Inbox)</span>
<a href="#l17.16"></a><span id="l17.16">     return &quot;Inbox&quot;;</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-  if (flags &amp; nsMsgFolderFlags.Trash)</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+  if (flags &amp; Ci.nsMsgFolderFlags.Trash)</span>
<a href="#l17.19"></a><span id="l17.19">     return &quot;Trash&quot;;</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineminus">-  if (flags &amp; nsMsgFolderFlags.Queue)</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+  if (flags &amp; Ci.nsMsgFolderFlags.Queue)</span>
<a href="#l17.22"></a><span id="l17.22">     return &quot;Outbox&quot;;</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-  if (flags &amp; nsMsgFolderFlags.SentMail)</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+  if (flags &amp; Ci.nsMsgFolderFlags.SentMail)</span>
<a href="#l17.25"></a><span id="l17.25">     return &quot;Sent&quot;;</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineminus">-  if (flags &amp; nsMsgFolderFlags.Drafts)</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+  if (flags &amp; Ci.nsMsgFolderFlags.Drafts)</span>
<a href="#l17.28"></a><span id="l17.28">     return &quot;Drafts&quot;;</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineminus">-  if (flags &amp; nsMsgFolderFlags.Templates)</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+  if (flags &amp; Ci.nsMsgFolderFlags.Templates)</span>
<a href="#l17.31"></a><span id="l17.31">     return &quot;Templates&quot;;</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-  if (flags &amp; nsMsgFolderFlags.Junk)</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+  if (flags &amp; Ci.nsMsgFolderFlags.Junk)</span>
<a href="#l17.34"></a><span id="l17.34">     return &quot;Junk&quot;;</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-  if (flags &amp; nsMsgFolderFlags.Archive)</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+  if (flags &amp; Ci.nsMsgFolderFlags.Archive)</span>
<a href="#l17.37"></a><span id="l17.37">     return &quot;Archive&quot;;</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-  if (flags &amp; nsMsgFolderFlags.Virtual)</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+  if (flags &amp; Ci.nsMsgFolderFlags.Virtual)</span>
<a href="#l17.40"></a><span id="l17.40">     return &quot;Virtual&quot;;</span>
<a href="#l17.41"></a><span id="l17.41">   return &quot;none&quot;;</span>
<a href="#l17.42"></a><span id="l17.42"> }</span>
<a href="#l17.43"></a><span id="l17.43"> </span>
<a href="#l17.44"></a><span id="l17.44"> /**</span>
<a href="#l17.45"></a><span id="l17.45">  * This function is meant to be used with trees. It returns the property list</span>
<a href="#l17.46"></a><span id="l17.46">  * for all of the common properties that css styling is based off of.</span>
<a href="#l17.47"></a><span id="l17.47">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/db/gloda/modules/index_msg.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/index_msg.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -65,33 +65,24 @@ var GLODA_BAD_MESSAGE_ID = 2;</span>
<a href="#l18.4"></a><span id="l18.4">  */</span>
<a href="#l18.5"></a><span id="l18.5"> var GLODA_OLD_BAD_MESSAGE_ID = 1;</span>
<a href="#l18.6"></a><span id="l18.6"> var GLODA_FIRST_VALID_MESSAGE_ID = 32;</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8"> var JUNK_SCORE_PROPERTY = &quot;junkscore&quot;;</span>
<a href="#l18.9"></a><span id="l18.9"> var JUNK_SPAM_SCORE_STR = Ci.nsIJunkMailPlugin.IS_SPAM_SCORE.toString();</span>
<a href="#l18.10"></a><span id="l18.10"> var JUNK_HAM_SCORE_STR = Ci.nsIJunkMailPlugin.IS_HAM_SCORE.toString();</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-var nsIArray = Ci.nsIArray;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-var nsIMsgFolder = Ci.nsIMsgFolder;</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-var nsIMsgLocalMailFolder = Ci.nsIMsgLocalMailFolder;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-var nsIMsgImapMailFolder = Ci.nsIMsgImapMailFolder;</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-var nsIMsgDBHdr = Ci.nsIMsgDBHdr;</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">-var nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-var nsMsgMessageFlags = Ci.nsMsgMessageFlags;</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">-var nsMsgProcessingFlags = Ci.nsMsgProcessingFlags;</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineminus">-</span>
<a href="#l18.21"></a><span id="l18.21"> /**</span>
<a href="#l18.22"></a><span id="l18.22">  * The processing flags that tell us that a message header has not yet been</span>
<a href="#l18.23"></a><span id="l18.23">  *  reported to us via msgsClassified.  If it has one of these flags, it is</span>
<a href="#l18.24"></a><span id="l18.24">  *  still being processed.</span>
<a href="#l18.25"></a><span id="l18.25">  */</span>
<a href="#l18.26"></a><span id="l18.26"> var NOT_YET_REPORTED_PROCESSING_FLAGS =</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineminus">-  nsMsgProcessingFlags.NotReportedClassified |</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineminus">-  nsMsgProcessingFlags.ClassifyJunk;</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineplus">+  Ci.nsMsgProcessingFlags.NotReportedClassified |</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+  Ci.nsMsgProcessingFlags.ClassifyJunk;</span>
<a href="#l18.31"></a><span id="l18.31"> </span>
<a href="#l18.32"></a><span id="l18.32"> // for list comprehension fun</span>
<a href="#l18.33"></a><span id="l18.33"> function* range(begin, end) {</span>
<a href="#l18.34"></a><span id="l18.34">   for (let i = begin; i &lt; end; ++i) {</span>
<a href="#l18.35"></a><span id="l18.35">     yield i;</span>
<a href="#l18.36"></a><span id="l18.36">   }</span>
<a href="#l18.37"></a><span id="l18.37"> }</span>
<a href="#l18.38"></a><span id="l18.38"> </span>
<a href="#l18.39"></a><span id="l18.39" class="difflineat">@@ -598,17 +589,17 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.40"></a><span id="l18.40"> </span>
<a href="#l18.41"></a><span id="l18.41">     if (this._indexingFolder)</span>
<a href="#l18.42"></a><span id="l18.42">       this._log.debug(&quot;Entering folder: &quot; + this._indexingFolder.URI);</span>
<a href="#l18.43"></a><span id="l18.43"> </span>
<a href="#l18.44"></a><span id="l18.44">     try {</span>
<a href="#l18.45"></a><span id="l18.45">       // The msf may need to be created or otherwise updated for local folders.</span>
<a href="#l18.46"></a><span id="l18.46">       // This may require yielding until such time as the msf has been created.</span>
<a href="#l18.47"></a><span id="l18.47">       try {</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineminus">-        if (this._indexingFolder instanceof nsIMsgLocalMailFolder) {</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineplus">+        if (this._indexingFolder instanceof Ci.nsIMsgLocalMailFolder) {</span>
<a href="#l18.50"></a><span id="l18.50">           this._indexingDatabase =</span>
<a href="#l18.51"></a><span id="l18.51">             this._indexingFolder.getDatabaseWithReparse(null,</span>
<a href="#l18.52"></a><span id="l18.52">                                                         null);</span>
<a href="#l18.53"></a><span id="l18.53">         }</span>
<a href="#l18.54"></a><span id="l18.54">         // we need do nothing special for IMAP, news, or other</span>
<a href="#l18.55"></a><span id="l18.55">       }</span>
<a href="#l18.56"></a><span id="l18.56">       // getDatabaseWithReparse can return either NS_ERROR_NOT_INITIALIZED or</span>
<a href="#l18.57"></a><span id="l18.57">       //  NS_MSG_ERROR_FOLDER_SUMMARY_OUT_OF_DATE if the net result is that it</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineat">@@ -715,17 +706,17 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.59"></a><span id="l18.59">       // If the folder !isLocal we add the terms:</span>
<a href="#l18.60"></a><span id="l18.60">       //  - if the folder is offline -- &amp;&amp; (Status Is nsMsgMessageFlags.Offline)</span>
<a href="#l18.61"></a><span id="l18.61">       //  - &amp;&amp; (Status Isnt nsMsgMessageFlags.Expunged)</span>
<a href="#l18.62"></a><span id="l18.62"> </span>
<a href="#l18.63"></a><span id="l18.63">       let searchSession = Cc[&quot;@mozilla.org/messenger/searchSession;1&quot;]</span>
<a href="#l18.64"></a><span id="l18.64">                             .createInstance(Ci.nsIMsgSearchSession);</span>
<a href="#l18.65"></a><span id="l18.65">       let searchTerms = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l18.66"></a><span id="l18.66">                          .createInstance(Ci.nsIMutableArray);</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineminus">-      let isLocal = this._indexingFolder instanceof nsIMsgLocalMailFolder;</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineplus">+      let isLocal = this._indexingFolder instanceof Ci.nsIMsgLocalMailFolder;</span>
<a href="#l18.69"></a><span id="l18.69"> </span>
<a href="#l18.70"></a><span id="l18.70">       searchSession.addScopeTerm(Ci.nsMsgSearchScope.offlineMail,</span>
<a href="#l18.71"></a><span id="l18.71">                                  this._indexingFolder);</span>
<a href="#l18.72"></a><span id="l18.72">       let nsMsgSearchAttrib = Ci.nsMsgSearchAttrib;</span>
<a href="#l18.73"></a><span id="l18.73">       let nsMsgSearchOp = Ci.nsMsgSearchOp;</span>
<a href="#l18.74"></a><span id="l18.74"> </span>
<a href="#l18.75"></a><span id="l18.75">       // first term: (GLODA_MESSAGE_ID_PROPERTY Is 0</span>
<a href="#l18.76"></a><span id="l18.76">       let searchTerm = searchSession.createTerm();</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineat">@@ -777,37 +768,37 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.78"></a><span id="l18.78">       value.str = JUNK_SPAM_SCORE_STR;</span>
<a href="#l18.79"></a><span id="l18.79">       searchTerm.value = value;</span>
<a href="#l18.80"></a><span id="l18.80">       searchTerm.hdrProperty = JUNK_SCORE_PROPERTY;</span>
<a href="#l18.81"></a><span id="l18.81">       searchTerms.appendElement(searchTerm);</span>
<a href="#l18.82"></a><span id="l18.82"> </span>
<a href="#l18.83"></a><span id="l18.83">       if (!isLocal)</span>
<a href="#l18.84"></a><span id="l18.84">       {</span>
<a href="#l18.85"></a><span id="l18.85">         // If the folder is offline, then the message should be too</span>
<a href="#l18.86"></a><span id="l18.86" class="difflineminus">-        if (this._indexingFolder.flags &amp; Ci.nsMsgFolderFlags.Offline) {</span>
<a href="#l18.87"></a><span id="l18.87" class="difflineplus">+        if (this._indexingFolder.getFlag(Ci.nsMsgFolderFlags.Offline)) {</span>
<a href="#l18.88"></a><span id="l18.88">           // third term: &amp;&amp; Status Is nsMsgMessageFlags.Offline</span>
<a href="#l18.89"></a><span id="l18.89">           searchTerm = searchSession.createTerm();</span>
<a href="#l18.90"></a><span id="l18.90">           searchTerm.booleanAnd = true;</span>
<a href="#l18.91"></a><span id="l18.91">           searchTerm.attrib = nsMsgSearchAttrib.MsgStatus;</span>
<a href="#l18.92"></a><span id="l18.92">           searchTerm.op = nsMsgSearchOp.Is;</span>
<a href="#l18.93"></a><span id="l18.93">           value = searchTerm.value;</span>
<a href="#l18.94"></a><span id="l18.94">           value.attrib = searchTerm.attrib;</span>
<a href="#l18.95"></a><span id="l18.95" class="difflineminus">-          value.status = nsMsgMessageFlags.Offline;</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineplus">+          value.status = Ci.nsMsgMessageFlags.Offline;</span>
<a href="#l18.97"></a><span id="l18.97">           searchTerm.value = value;</span>
<a href="#l18.98"></a><span id="l18.98">           searchTerms.appendElement(searchTerm);</span>
<a href="#l18.99"></a><span id="l18.99">         }</span>
<a href="#l18.100"></a><span id="l18.100"> </span>
<a href="#l18.101"></a><span id="l18.101">         // fourth term: &amp;&amp; Status Isnt nsMsgMessageFlags.Expunged</span>
<a href="#l18.102"></a><span id="l18.102">         searchTerm = searchSession.createTerm();</span>
<a href="#l18.103"></a><span id="l18.103">         searchTerm.booleanAnd = true;</span>
<a href="#l18.104"></a><span id="l18.104">         searchTerm.attrib = nsMsgSearchAttrib.MsgStatus;</span>
<a href="#l18.105"></a><span id="l18.105">         searchTerm.op = nsMsgSearchOp.Isnt;</span>
<a href="#l18.106"></a><span id="l18.106">         value = searchTerm.value;</span>
<a href="#l18.107"></a><span id="l18.107">         value.attrib = searchTerm.attrib;</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineminus">-        value.status = nsMsgMessageFlags.Expunged;</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineplus">+        value.status = Ci.nsMsgMessageFlags.Expunged;</span>
<a href="#l18.110"></a><span id="l18.110">         searchTerm.value = value;</span>
<a href="#l18.111"></a><span id="l18.111">         searchTerms.appendElement(searchTerm);</span>
<a href="#l18.112"></a><span id="l18.112">       }</span>
<a href="#l18.113"></a><span id="l18.113"> </span>
<a href="#l18.114"></a><span id="l18.114">       this._indexingEnumerator =</span>
<a href="#l18.115"></a><span id="l18.115">         this._indexingDatabase.getFilterEnumerator(searchTerms, true);</span>
<a href="#l18.116"></a><span id="l18.116">     }</span>
<a href="#l18.117"></a><span id="l18.117">     else if (aEnumKind == this.kEnumIndexedMsgs) {</span>
<a href="#l18.118"></a><span id="l18.118" class="difflineat">@@ -1347,17 +1338,17 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.119"></a><span id="l18.119">     //  everyone in one go in a filthy context because if we have to terminate</span>
<a href="#l18.120"></a><span id="l18.120">     //  indexing before we quit, we don't want to have to re-index messages next</span>
<a href="#l18.121"></a><span id="l18.121">     //  time.  (This could even lead to never completing indexing in a</span>
<a href="#l18.122"></a><span id="l18.122">     //  pathological situation.)</span>
<a href="#l18.123"></a><span id="l18.123">     let glodaFolder = GlodaDatastore._mapFolder(this._indexingFolder);</span>
<a href="#l18.124"></a><span id="l18.124">     if (glodaFolder.dirtyStatus == glodaFolder.kFolderFilthy) {</span>
<a href="#l18.125"></a><span id="l18.125">       this._indexerGetEnumerator(this.kEnumIndexedMsgs, true);</span>
<a href="#l18.126"></a><span id="l18.126">       let count = 0;</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineminus">-      for (let msgHdr of fixIterator(this._indexingEnumerator, nsIMsgDBHdr)) {</span>
<a href="#l18.128"></a><span id="l18.128" class="difflineplus">+      for (let msgHdr of fixIterator(this._indexingEnumerator, Ci.nsIMsgDBHdr)) {</span>
<a href="#l18.129"></a><span id="l18.129">         // we still need to avoid locking up the UI, pause periodically...</span>
<a href="#l18.130"></a><span id="l18.130">         if (++count % HEADER_CHECK_SYNC_BLOCK_SIZE == 0)</span>
<a href="#l18.131"></a><span id="l18.131">           yield this.kWorkSync;</span>
<a href="#l18.132"></a><span id="l18.132"> </span>
<a href="#l18.133"></a><span id="l18.133">         if (count % HEADER_CHECK_GC_BLOCK_SIZE == 0)</span>
<a href="#l18.134"></a><span id="l18.134">           GlodaUtils.considerHeaderBasedGC(HEADER_CHECK_GC_BLOCK_SIZE);</span>
<a href="#l18.135"></a><span id="l18.135"> </span>
<a href="#l18.136"></a><span id="l18.136">         let glodaMessageId = msgHdr.getUint32Property(</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineat">@@ -1405,17 +1396,17 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.138"></a><span id="l18.138">     aJob.goal = numMessagesToIndex;</span>
<a href="#l18.139"></a><span id="l18.139"> </span>
<a href="#l18.140"></a><span id="l18.140">     if (numMessagesToIndex &gt; 0) {</span>
<a href="#l18.141"></a><span id="l18.141">       // We used up the iterator, get a new one.</span>
<a href="#l18.142"></a><span id="l18.142">       this._indexerGetEnumerator(enumeratorType);</span>
<a href="#l18.143"></a><span id="l18.143"> </span>
<a href="#l18.144"></a><span id="l18.144">       // Pass 2: index the messages.</span>
<a href="#l18.145"></a><span id="l18.145">       let count = 0;</span>
<a href="#l18.146"></a><span id="l18.146" class="difflineminus">-      for (let msgHdr of fixIterator(this._indexingEnumerator, nsIMsgDBHdr)) {</span>
<a href="#l18.147"></a><span id="l18.147" class="difflineplus">+      for (let msgHdr of fixIterator(this._indexingEnumerator, Ci.nsIMsgDBHdr)) {</span>
<a href="#l18.148"></a><span id="l18.148">         // per above, we want to periodically release control while doing all</span>
<a href="#l18.149"></a><span id="l18.149">         // this header traversal/investigation.</span>
<a href="#l18.150"></a><span id="l18.150">         if (++count % HEADER_CHECK_SYNC_BLOCK_SIZE == 0)</span>
<a href="#l18.151"></a><span id="l18.151">           yield this.kWorkSync;</span>
<a href="#l18.152"></a><span id="l18.152"> </span>
<a href="#l18.153"></a><span id="l18.153">         if (count % HEADER_CHECK_GC_BLOCK_SIZE == 0)</span>
<a href="#l18.154"></a><span id="l18.154">           GlodaUtils.considerHeaderBasedGC(HEADER_CHECK_GC_BLOCK_SIZE);</span>
<a href="#l18.155"></a><span id="l18.155"> </span>
<a href="#l18.156"></a><span id="l18.156" class="difflineat">@@ -2038,17 +2029,17 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.157"></a><span id="l18.157">    *     after the first notification, we would likely just mistakenly treat</span>
<a href="#l18.158"></a><span id="l18.158">    *     the msgsClassified notification as something dirtying, so it would</span>
<a href="#l18.159"></a><span id="l18.159">    *     still work out...)</span>
<a href="#l18.160"></a><span id="l18.160">    */</span>
<a href="#l18.161"></a><span id="l18.161">   _reindexChangedMessages: function gloda_indexer_reindexChangedMessage(</span>
<a href="#l18.162"></a><span id="l18.162">                                       aMsgHdrs, aDirtyingEvent) {</span>
<a href="#l18.163"></a><span id="l18.163">     let glodaIdsNeedingDeletion = null;</span>
<a href="#l18.164"></a><span id="l18.164">     let messageKeyChangedIds = null, messageKeyChangedNewKeys = null;</span>
<a href="#l18.165"></a><span id="l18.165" class="difflineminus">-    for (let msgHdr of fixIterator(aMsgHdrs, nsIMsgDBHdr)) {</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineplus">+    for (let msgHdr of fixIterator(aMsgHdrs, Ci.nsIMsgDBHdr)) {</span>
<a href="#l18.167"></a><span id="l18.167">       // -- Index this folder?</span>
<a href="#l18.168"></a><span id="l18.168">       let msgFolder = msgHdr.folder;</span>
<a href="#l18.169"></a><span id="l18.169">       if (!this.shouldIndexFolder(msgFolder)) {</span>
<a href="#l18.170"></a><span id="l18.170">         continue;</span>
<a href="#l18.171"></a><span id="l18.171">       }</span>
<a href="#l18.172"></a><span id="l18.172">       // -- Ignore messages in filthy folders!</span>
<a href="#l18.173"></a><span id="l18.173">       // A filthy folder can only be processed by an indexing sweep, and at</span>
<a href="#l18.174"></a><span id="l18.174">       //  that point the message will get indexed.</span>
<a href="#l18.175"></a><span id="l18.175" class="difflineat">@@ -2081,20 +2072,20 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.176"></a><span id="l18.176">           if (!keyChangedInfo.isDirty)</span>
<a href="#l18.177"></a><span id="l18.177">             continue;</span>
<a href="#l18.178"></a><span id="l18.178">         }</span>
<a href="#l18.179"></a><span id="l18.179">       }</span>
<a href="#l18.180"></a><span id="l18.180"> </span>
<a href="#l18.181"></a><span id="l18.181">       // -- Index this message?</span>
<a href="#l18.182"></a><span id="l18.182">       // We index local messages, IMAP messages that are offline, and IMAP</span>
<a href="#l18.183"></a><span id="l18.183">       // messages that aren't offline but whose folders aren't offline either</span>
<a href="#l18.184"></a><span id="l18.184" class="difflineminus">-      let isFolderLocal = msgFolder instanceof nsIMsgLocalMailFolder;</span>
<a href="#l18.185"></a><span id="l18.185" class="difflineplus">+      let isFolderLocal = msgFolder instanceof Ci.nsIMsgLocalMailFolder;</span>
<a href="#l18.186"></a><span id="l18.186">       if (!isFolderLocal) {</span>
<a href="#l18.187"></a><span id="l18.187" class="difflineminus">-        if (!(msgHdr.flags &amp; nsMsgMessageFlags.Offline) &amp;&amp;</span>
<a href="#l18.188"></a><span id="l18.188" class="difflineminus">-            (msgFolder.flags &amp; nsMsgFolderFlags.Offline)) {</span>
<a href="#l18.189"></a><span id="l18.189" class="difflineplus">+        if (!(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Offline) &amp;&amp;</span>
<a href="#l18.190"></a><span id="l18.190" class="difflineplus">+            (msgFolder.getFlag(Ci.nsMsgFolderFlags.Offline))) {</span>
<a href="#l18.191"></a><span id="l18.191">           continue;</span>
<a href="#l18.192"></a><span id="l18.192">         }</span>
<a href="#l18.193"></a><span id="l18.193">       }</span>
<a href="#l18.194"></a><span id="l18.194">       // Ignore messages whose processing flags indicate it has not yet been</span>
<a href="#l18.195"></a><span id="l18.195">       //  classified.  In the IMAP case if the Offline flag is going to get set</span>
<a href="#l18.196"></a><span id="l18.196">       //  we are going to see it before the msgsClassified event so this is</span>
<a href="#l18.197"></a><span id="l18.197">       //  very important.</span>
<a href="#l18.198"></a><span id="l18.198">       if (msgFolder.getProcessingFlags(msgHdr.messageKey) &amp;</span>
<a href="#l18.199"></a><span id="l18.199" class="difflineat">@@ -2226,17 +2217,17 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.200"></a><span id="l18.200">      *  back, the fact that deletion is thus deferred can be handy, as we can</span>
<a href="#l18.201"></a><span id="l18.201">      *  reuse the existing gloda message.</span>
<a href="#l18.202"></a><span id="l18.202">      */</span>
<a href="#l18.203"></a><span id="l18.203">     msgsDeleted: function gloda_indexer_msgsDeleted(aMsgHdrs) {</span>
<a href="#l18.204"></a><span id="l18.204">       this.indexer._log.debug(&quot;msgsDeleted notification&quot;);</span>
<a href="#l18.205"></a><span id="l18.205">       let glodaMessageIds = [];</span>
<a href="#l18.206"></a><span id="l18.206"> </span>
<a href="#l18.207"></a><span id="l18.207">       for (let iMsgHdr = 0; iMsgHdr &lt; aMsgHdrs.length; iMsgHdr++) {</span>
<a href="#l18.208"></a><span id="l18.208" class="difflineminus">-        let msgHdr = aMsgHdrs.queryElementAt(iMsgHdr, nsIMsgDBHdr);</span>
<a href="#l18.209"></a><span id="l18.209" class="difflineplus">+        let msgHdr = aMsgHdrs.queryElementAt(iMsgHdr, Ci.nsIMsgDBHdr);</span>
<a href="#l18.210"></a><span id="l18.210">         let [glodaId, glodaDirty] = PendingCommitTracker.getGlodaState(msgHdr);</span>
<a href="#l18.211"></a><span id="l18.211">         if (glodaId &gt;= GLODA_FIRST_VALID_MESSAGE_ID &amp;&amp;</span>
<a href="#l18.212"></a><span id="l18.212">             glodaDirty != GlodaMsgIndexer.kMessageFilthy)</span>
<a href="#l18.213"></a><span id="l18.213">           glodaMessageIds.push(glodaId);</span>
<a href="#l18.214"></a><span id="l18.214">       }</span>
<a href="#l18.215"></a><span id="l18.215"> </span>
<a href="#l18.216"></a><span id="l18.216">       if (glodaMessageIds.length) {</span>
<a href="#l18.217"></a><span id="l18.217">         GlodaMsgIndexer._datastore.markMessagesDeletedByIDs(glodaMessageIds);</span>
<a href="#l18.218"></a><span id="l18.218" class="difflineat">@@ -2305,23 +2296,23 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.219"></a><span id="l18.219">           }</span>
<a href="#l18.220"></a><span id="l18.220"> </span>
<a href="#l18.221"></a><span id="l18.221">           // -- Avoid propagation of filthy gloda-id's.</span>
<a href="#l18.222"></a><span id="l18.222">           // If the source folder is filthy or should not be indexed (and so</span>
<a href="#l18.223"></a><span id="l18.223">           //  any gloda-id's found in there are gibberish), our only job is to</span>
<a href="#l18.224"></a><span id="l18.224">           //  strip the gloda-id's off of all the destination headers because</span>
<a href="#l18.225"></a><span id="l18.225">           //  none of the gloda-id's are valid (and so we certainly don't want</span>
<a href="#l18.226"></a><span id="l18.226">           //  to try and use them as a basis for updating message keys.)</span>
<a href="#l18.227"></a><span id="l18.227" class="difflineminus">-          let srcMsgFolder = aSrcMsgHdrs.queryElementAt(0, nsIMsgDBHdr).folder;</span>
<a href="#l18.228"></a><span id="l18.228" class="difflineplus">+          let srcMsgFolder = aSrcMsgHdrs.queryElementAt(0, Ci.nsIMsgDBHdr).folder;</span>
<a href="#l18.229"></a><span id="l18.229">           if (!this.indexer.shouldIndexFolder(srcMsgFolder) ||</span>
<a href="#l18.230"></a><span id="l18.230">               (GlodaDatastore._mapFolder(srcMsgFolder).dirtyStatus ==</span>
<a href="#l18.231"></a><span id="l18.231">                  GlodaFolder.prototype.kFolderFilthy)) {</span>
<a href="#l18.232"></a><span id="l18.232">             // Local case, just modify the destination headers directly.</span>
<a href="#l18.233"></a><span id="l18.233">             if (aDestMsgHdrs) {</span>
<a href="#l18.234"></a><span id="l18.234" class="difflineminus">-              for (let destMsgHdr of fixIterator(aDestMsgHdrs, nsIMsgDBHdr)) {</span>
<a href="#l18.235"></a><span id="l18.235" class="difflineplus">+              for (let destMsgHdr of fixIterator(aDestMsgHdrs, Ci.nsIMsgDBHdr)) {</span>
<a href="#l18.236"></a><span id="l18.236">                 // zero it out if it exists</span>
<a href="#l18.237"></a><span id="l18.237">                 // (no need to deal with pending commit issues here; a filthy</span>
<a href="#l18.238"></a><span id="l18.238">                 //  folder by definition has nothing indexed in it.)</span>
<a href="#l18.239"></a><span id="l18.239">                 let glodaId = destMsgHdr.getUint32Property(</span>
<a href="#l18.240"></a><span id="l18.240">                                 GLODA_MESSAGE_ID_PROPERTY);</span>
<a href="#l18.241"></a><span id="l18.241">                 if (glodaId)</span>
<a href="#l18.242"></a><span id="l18.242">                   destMsgHdr.setUint32Property(GLODA_MESSAGE_ID_PROPERTY,</span>
<a href="#l18.243"></a><span id="l18.243">                                                0);</span>
<a href="#l18.244"></a><span id="l18.244" class="difflineat">@@ -2343,17 +2334,17 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.245"></a><span id="l18.245">                 destDb = aDestFolder.msgDatabase;</span>
<a href="#l18.246"></a><span id="l18.246">               } catch (ex) {</span>
<a href="#l18.247"></a><span id="l18.247">                 this.indexer._log.warn(&quot;Destination database for &quot; +</span>
<a href="#l18.248"></a><span id="l18.248">                                        aDestFolder.prettyName +</span>
<a href="#l18.249"></a><span id="l18.249">                                        &quot; not ready on IMAP move.&quot; +</span>
<a href="#l18.250"></a><span id="l18.250">                                        &quot; Gloda corruption possible.&quot;);</span>
<a href="#l18.251"></a><span id="l18.251">                 return;</span>
<a href="#l18.252"></a><span id="l18.252">               }</span>
<a href="#l18.253"></a><span id="l18.253" class="difflineminus">-              for (let srcMsgHdr of fixIterator(aSrcMsgHdrs, nsIMsgDBHdr)) {</span>
<a href="#l18.254"></a><span id="l18.254" class="difflineplus">+              for (let srcMsgHdr of fixIterator(aSrcMsgHdrs, Ci.nsIMsgDBHdr)) {</span>
<a href="#l18.255"></a><span id="l18.255">                 // zero it out if it exists</span>
<a href="#l18.256"></a><span id="l18.256">                 // (no need to deal with pending commit issues here; a filthy</span>
<a href="#l18.257"></a><span id="l18.257">                 //  folder by definition has nothing indexed in it.)</span>
<a href="#l18.258"></a><span id="l18.258">                 let glodaId = srcMsgHdr.getUint32Property(</span>
<a href="#l18.259"></a><span id="l18.259">                                 GLODA_MESSAGE_ID_PROPERTY);</span>
<a href="#l18.260"></a><span id="l18.260">                 if (glodaId)</span>
<a href="#l18.261"></a><span id="l18.261">                   destDb.setUint32AttributeOnPendingHdr(</span>
<a href="#l18.262"></a><span id="l18.262">                     srcMsgHdr, GLODA_MESSAGE_ID_PROPERTY, 0);</span>
<a href="#l18.263"></a><span id="l18.263" class="difflineat">@@ -2367,24 +2358,24 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.264"></a><span id="l18.264"> </span>
<a href="#l18.265"></a><span id="l18.265"> </span>
<a href="#l18.266"></a><span id="l18.266">           // --- Have destination headers (local case):</span>
<a href="#l18.267"></a><span id="l18.267">           if (aDestMsgHdrs) {</span>
<a href="#l18.268"></a><span id="l18.268">             // -- Update message keys for valid gloda-id's.</span>
<a href="#l18.269"></a><span id="l18.269">             // (Which means ignore filthy gloda-id's.)</span>
<a href="#l18.270"></a><span id="l18.270">             let glodaIds = [];</span>
<a href="#l18.271"></a><span id="l18.271">             let newMessageKeys = [];</span>
<a href="#l18.272"></a><span id="l18.272" class="difflineminus">-            aSrcMsgHdrs.QueryInterface(nsIArray);</span>
<a href="#l18.273"></a><span id="l18.273" class="difflineminus">-            aDestMsgHdrs.QueryInterface(nsIArray);</span>
<a href="#l18.274"></a><span id="l18.274" class="difflineplus">+            aSrcMsgHdrs.QueryInterface(Ci.nsIArray);</span>
<a href="#l18.275"></a><span id="l18.275" class="difflineplus">+            aDestMsgHdrs.QueryInterface(Ci.nsIArray);</span>
<a href="#l18.276"></a><span id="l18.276">             // Track whether we see any messages that are not gloda indexed so</span>
<a href="#l18.277"></a><span id="l18.277">             //  we know if we have to mark the destination folder dirty.</span>
<a href="#l18.278"></a><span id="l18.278">             let sawNonGlodaMessage = false;</span>
<a href="#l18.279"></a><span id="l18.279">             for (let iMsg = 0; iMsg &lt; aSrcMsgHdrs.length; iMsg++) {</span>
<a href="#l18.280"></a><span id="l18.280" class="difflineminus">-              let srcMsgHdr = aSrcMsgHdrs.queryElementAt(iMsg, nsIMsgDBHdr);</span>
<a href="#l18.281"></a><span id="l18.281" class="difflineminus">-              let destMsgHdr = aDestMsgHdrs.queryElementAt(iMsg, nsIMsgDBHdr);</span>
<a href="#l18.282"></a><span id="l18.282" class="difflineplus">+              let srcMsgHdr = aSrcMsgHdrs.queryElementAt(iMsg, Ci.nsIMsgDBHdr);</span>
<a href="#l18.283"></a><span id="l18.283" class="difflineplus">+              let destMsgHdr = aDestMsgHdrs.queryElementAt(iMsg, Ci.nsIMsgDBHdr);</span>
<a href="#l18.284"></a><span id="l18.284"> </span>
<a href="#l18.285"></a><span id="l18.285">               let [glodaId, dirtyStatus] =</span>
<a href="#l18.286"></a><span id="l18.286">                 PendingCommitTracker.getGlodaState(srcMsgHdr);</span>
<a href="#l18.287"></a><span id="l18.287">               if (glodaId &gt;= GLODA_FIRST_VALID_MESSAGE_ID &amp;&amp;</span>
<a href="#l18.288"></a><span id="l18.288">                   dirtyStatus != GlodaMsgIndexer.kMessageFilthy) {</span>
<a href="#l18.289"></a><span id="l18.289">                 // we may need to update the pending commit map (it checks)</span>
<a href="#l18.290"></a><span id="l18.290">                 PendingCommitTracker.noteMove(srcMsgHdr, destMsgHdr);</span>
<a href="#l18.291"></a><span id="l18.291">                 // but we always need to update our database</span>
<a href="#l18.292"></a><span id="l18.292" class="difflineat">@@ -2413,19 +2404,19 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.293"></a><span id="l18.293">           // --- No dest headers (IMAP case):</span>
<a href="#l18.294"></a><span id="l18.294">           // Update any valid gloda indexed messages into their new folder to</span>
<a href="#l18.295"></a><span id="l18.295">           //  make the indexer's life easier when it sees the messages in their</span>
<a href="#l18.296"></a><span id="l18.296">           //  new folder.</span>
<a href="#l18.297"></a><span id="l18.297">           else {</span>
<a href="#l18.298"></a><span id="l18.298">             let glodaIds = [];</span>
<a href="#l18.299"></a><span id="l18.299"> </span>
<a href="#l18.300"></a><span id="l18.300">             let srcFolderIsLocal =</span>
<a href="#l18.301"></a><span id="l18.301" class="difflineminus">-              (srcMsgFolder instanceof nsIMsgLocalMailFolder);</span>
<a href="#l18.302"></a><span id="l18.302" class="difflineplus">+              (srcMsgFolder instanceof Ci.nsIMsgLocalMailFolder);</span>
<a href="#l18.303"></a><span id="l18.303">             for (let iMsgHdr = 0; iMsgHdr &lt; aSrcMsgHdrs.length; iMsgHdr++) {</span>
<a href="#l18.304"></a><span id="l18.304" class="difflineminus">-              let msgHdr = aSrcMsgHdrs.queryElementAt(iMsgHdr, nsIMsgDBHdr);</span>
<a href="#l18.305"></a><span id="l18.305" class="difflineplus">+              let msgHdr = aSrcMsgHdrs.queryElementAt(iMsgHdr, Ci.nsIMsgDBHdr);</span>
<a href="#l18.306"></a><span id="l18.306"> </span>
<a href="#l18.307"></a><span id="l18.307">               let [glodaId, dirtyStatus] =</span>
<a href="#l18.308"></a><span id="l18.308">                 PendingCommitTracker.getGlodaState(msgHdr);</span>
<a href="#l18.309"></a><span id="l18.309">               if (glodaId &gt;= GLODA_FIRST_VALID_MESSAGE_ID &amp;&amp;</span>
<a href="#l18.310"></a><span id="l18.310">                   dirtyStatus != GlodaMsgIndexer.kMessageFilthy) {</span>
<a href="#l18.311"></a><span id="l18.311">                 // we may need to update the pending commit map (it checks)</span>
<a href="#l18.312"></a><span id="l18.312">                 PendingCommitTracker.noteBlindMove(msgHdr);</span>
<a href="#l18.313"></a><span id="l18.313">                 // but we always need to update our database</span>
<a href="#l18.314"></a><span id="l18.314" class="difflineat">@@ -2458,17 +2449,17 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.315"></a><span id="l18.315">             //  message added events will cause that to happen.</span>
<a href="#l18.316"></a><span id="l18.316">           }</span>
<a href="#l18.317"></a><span id="l18.317">         }</span>
<a href="#l18.318"></a><span id="l18.318">         // ---- Copy case</span>
<a href="#l18.319"></a><span id="l18.319">         else {</span>
<a href="#l18.320"></a><span id="l18.320">           // -- Do not propagate gloda-id's for copies</span>
<a href="#l18.321"></a><span id="l18.321">           // (Only applies if we have the destination header, which means local)</span>
<a href="#l18.322"></a><span id="l18.322">           if (aDestMsgHdrs) {</span>
<a href="#l18.323"></a><span id="l18.323" class="difflineminus">-            for (let destMsgHdr of fixIterator(aDestMsgHdrs, nsIMsgDBHdr)) {</span>
<a href="#l18.324"></a><span id="l18.324" class="difflineplus">+            for (let destMsgHdr of fixIterator(aDestMsgHdrs, Ci.nsIMsgDBHdr)) {</span>
<a href="#l18.325"></a><span id="l18.325">               let glodaId = destMsgHdr.getUint32Property(</span>
<a href="#l18.326"></a><span id="l18.326">                 GLODA_MESSAGE_ID_PROPERTY);</span>
<a href="#l18.327"></a><span id="l18.327">               if (glodaId)</span>
<a href="#l18.328"></a><span id="l18.328">                 destMsgHdr.setUint32Property(GLODA_MESSAGE_ID_PROPERTY, 0);</span>
<a href="#l18.329"></a><span id="l18.329">             }</span>
<a href="#l18.330"></a><span id="l18.330">           }</span>
<a href="#l18.331"></a><span id="l18.331"> </span>
<a href="#l18.332"></a><span id="l18.332">           // mark the folder as dirty; we'll get to it later.</span>
<a href="#l18.333"></a><span id="l18.333" class="difflineat">@@ -2678,17 +2669,17 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.334"></a><span id="l18.334">      * - JunkStatusChanged: We mark the messages that have had their junk</span>
<a href="#l18.335"></a><span id="l18.335">      *    state change to be reindexed.</span>
<a href="#l18.336"></a><span id="l18.336">      */</span>
<a href="#l18.337"></a><span id="l18.337">     itemEvent: function gloda_indexer_itemEvent(aItem, aEvent, aData, aString) {</span>
<a href="#l18.338"></a><span id="l18.338">       // Compact and Reindex are close enough that we can reuse the same code</span>
<a href="#l18.339"></a><span id="l18.339">       //  with one minor difference.</span>
<a href="#l18.340"></a><span id="l18.340">       if (aEvent == &quot;FolderCompactStart&quot; ||</span>
<a href="#l18.341"></a><span id="l18.341">           aEvent == &quot;FolderReindexTriggered&quot;) {</span>
<a href="#l18.342"></a><span id="l18.342" class="difflineminus">-        let aMsgFolder = aItem.QueryInterface(nsIMsgFolder);</span>
<a href="#l18.343"></a><span id="l18.343" class="difflineplus">+        let aMsgFolder = aItem.QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l18.344"></a><span id="l18.344">         // ignore folders we ignore...</span>
<a href="#l18.345"></a><span id="l18.345">         if (!GlodaMsgIndexer.shouldIndexFolder(aMsgFolder))</span>
<a href="#l18.346"></a><span id="l18.346">           return;</span>
<a href="#l18.347"></a><span id="l18.347"> </span>
<a href="#l18.348"></a><span id="l18.348">         let glodaFolder = GlodaDatastore._mapFolder(aMsgFolder);</span>
<a href="#l18.349"></a><span id="l18.349">         if (aEvent == &quot;FolderCompactStart&quot;)</span>
<a href="#l18.350"></a><span id="l18.350">           glodaFolder.compacting = true;</span>
<a href="#l18.351"></a><span id="l18.351"> </span>
<a href="#l18.352"></a><span id="l18.352" class="difflineat">@@ -2708,17 +2699,17 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.353"></a><span id="l18.353">         //  about the folder.  We will pick up the pieces in the compaction</span>
<a href="#l18.354"></a><span id="l18.354">         //  pass.</span>
<a href="#l18.355"></a><span id="l18.355">         PendingCommitTracker.noteFolderDatabaseGettingBlownAway(aMsgFolder);</span>
<a href="#l18.356"></a><span id="l18.356"> </span>
<a href="#l18.357"></a><span id="l18.357">         // (We do not need to mark the folder dirty because if we were indexing</span>
<a href="#l18.358"></a><span id="l18.358">         //  it, it already must have been marked dirty.)</span>
<a href="#l18.359"></a><span id="l18.359">       }</span>
<a href="#l18.360"></a><span id="l18.360">       else if (aEvent == &quot;FolderCompactFinish&quot;) {</span>
<a href="#l18.361"></a><span id="l18.361" class="difflineminus">-        let aMsgFolder = aItem.QueryInterface(nsIMsgFolder);</span>
<a href="#l18.362"></a><span id="l18.362" class="difflineplus">+        let aMsgFolder = aItem.QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l18.363"></a><span id="l18.363">         // ignore folders we ignore...</span>
<a href="#l18.364"></a><span id="l18.364">         if (!GlodaMsgIndexer.shouldIndexFolder(aMsgFolder))</span>
<a href="#l18.365"></a><span id="l18.365">           return;</span>
<a href="#l18.366"></a><span id="l18.366"> </span>
<a href="#l18.367"></a><span id="l18.367">         let glodaFolder = GlodaDatastore._mapFolder(aMsgFolder);</span>
<a href="#l18.368"></a><span id="l18.368">         glodaFolder.compacting = false;</span>
<a href="#l18.369"></a><span id="l18.369">         glodaFolder._setCompactedState(true);</span>
<a href="#l18.370"></a><span id="l18.370"> </span>
<a href="#l18.371"></a><span id="l18.371" class="difflineat">@@ -2795,20 +2786,20 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.372"></a><span id="l18.372">      * Notice when user activity adds/removes tags or changes a message's</span>
<a href="#l18.373"></a><span id="l18.373">      *  status.</span>
<a href="#l18.374"></a><span id="l18.374">      */</span>
<a href="#l18.375"></a><span id="l18.375">     OnItemPropertyFlagChanged: function gloda_indexer_OnItemPropertyFlagChanged(</span>
<a href="#l18.376"></a><span id="l18.376">                                 aMsgHdr, aProperty, aOldValue, aNewValue) {</span>
<a href="#l18.377"></a><span id="l18.377">       if (aProperty == &quot;Keywords&quot; ||</span>
<a href="#l18.378"></a><span id="l18.378">           // We could care less about the new flag changing.</span>
<a href="#l18.379"></a><span id="l18.379">           (aProperty == &quot;Status&quot; &amp;&amp;</span>
<a href="#l18.380"></a><span id="l18.380" class="difflineminus">-           (aOldValue ^ aNewValue) != nsMsgMessageFlags.New &amp;&amp;</span>
<a href="#l18.381"></a><span id="l18.381" class="difflineplus">+           (aOldValue ^ aNewValue) != Ci.nsMsgMessageFlags.New &amp;&amp;</span>
<a href="#l18.382"></a><span id="l18.382">            // We do care about IMAP deletion, but msgsDeleted tells us that, so</span>
<a href="#l18.383"></a><span id="l18.383">            //  ignore IMAPDeleted too...</span>
<a href="#l18.384"></a><span id="l18.384" class="difflineminus">-           (aOldValue ^ aNewValue) != nsMsgMessageFlags.IMAPDeleted) ||</span>
<a href="#l18.385"></a><span id="l18.385" class="difflineplus">+           (aOldValue ^ aNewValue) != Ci.nsMsgMessageFlags.IMAPDeleted) ||</span>
<a href="#l18.386"></a><span id="l18.386">           aProperty == &quot;Flagged&quot;) {</span>
<a href="#l18.387"></a><span id="l18.387">         GlodaMsgIndexer._reindexChangedMessages([aMsgHdr], true);</span>
<a href="#l18.388"></a><span id="l18.388">       }</span>
<a href="#l18.389"></a><span id="l18.389">     },</span>
<a href="#l18.390"></a><span id="l18.390"> </span>
<a href="#l18.391"></a><span id="l18.391">     /**</span>
<a href="#l18.392"></a><span id="l18.392">      * Get folder loaded notifications for folders that had to do some</span>
<a href="#l18.393"></a><span id="l18.393">      *  (asynchronous) processing before they could be opened.</span>
<a href="#l18.394"></a><span id="l18.394" class="difflineat">@@ -2946,18 +2937,18 @@ var GlodaMsgIndexer = {</span>
<a href="#l18.395"></a><span id="l18.395">     let logDebug = this._log.level &lt;= Log4Moz.Level.Debug;</span>
<a href="#l18.396"></a><span id="l18.396">     if (logDebug)</span>
<a href="#l18.397"></a><span id="l18.397">       this._log.debug(&quot;*** Indexing message: &quot; + aMsgHdr.messageKey + &quot; : &quot; +</span>
<a href="#l18.398"></a><span id="l18.398">                       aMsgHdr.subject);</span>
<a href="#l18.399"></a><span id="l18.399"> </span>
<a href="#l18.400"></a><span id="l18.400">     // If the message is offline, then get the message body as well</span>
<a href="#l18.401"></a><span id="l18.401">     let isMsgOffline = false;</span>
<a href="#l18.402"></a><span id="l18.402">     let aMimeMsg;</span>
<a href="#l18.403"></a><span id="l18.403" class="difflineminus">-    if ((aMsgHdr.flags &amp; nsMsgMessageFlags.Offline) ||</span>
<a href="#l18.404"></a><span id="l18.404" class="difflineminus">-        (aMsgHdr.folder instanceof nsIMsgLocalMailFolder)) {</span>
<a href="#l18.405"></a><span id="l18.405" class="difflineplus">+    if ((aMsgHdr.flags &amp; Ci.nsMsgMessageFlags.Offline) ||</span>
<a href="#l18.406"></a><span id="l18.406" class="difflineplus">+        (aMsgHdr.folder instanceof Ci.nsIMsgLocalMailFolder)) {</span>
<a href="#l18.407"></a><span id="l18.407">       isMsgOffline = true;</span>
<a href="#l18.408"></a><span id="l18.408">       this._MsgHdrToMimeMessageFunc(aMsgHdr, aCallbackHandle.callbackThis,</span>
<a href="#l18.409"></a><span id="l18.409">           aCallbackHandle.callback, false, {saneBodySize: true});</span>
<a href="#l18.410"></a><span id="l18.410">       aMimeMsg = (yield this.kWorkAsync)[1];</span>
<a href="#l18.411"></a><span id="l18.411">     }</span>
<a href="#l18.412"></a><span id="l18.412">     else {</span>
<a href="#l18.413"></a><span id="l18.413">       if (logDebug)</span>
<a href="#l18.414"></a><span id="l18.414">         this._log.debug(&quot;  * Message is not offline -- only headers indexed&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/db/msgdb/test/unit/test_filter_enumerator.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/db/msgdb/test/unit/test_filter_enumerator.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,19 +1,14 @@</span>
<a href="#l19.4"></a><span id="l19.4"> load(&quot;../../../../resources/messageGenerator.js&quot;);</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6"> var gMessages = [];</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineminus">-var nsMsgSearchScope  = Ci.nsMsgSearchScope;</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineminus">-var nsMsgSearchAttrib = Ci.nsMsgSearchAttrib;</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineminus">-var nsMsgSearchOp     = Ci.nsMsgSearchOp;</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineminus">-var nsMsgMessageFlags = Ci.nsMsgMessageFlags;</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineminus">-var nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l19.12"></a><span id="l19.12"> </span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-var kSetCount = 13;</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-var kNumExpectedMatches = 10;</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+const kSetCount = 13;</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+const kNumExpectedMatches = 10;</span>
<a href="#l19.17"></a><span id="l19.17"> </span>
<a href="#l19.18"></a><span id="l19.18"> function setupGlobals()</span>
<a href="#l19.19"></a><span id="l19.19"> {</span>
<a href="#l19.20"></a><span id="l19.20">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l19.21"></a><span id="l19.21">   // Create a message generator</span>
<a href="#l19.22"></a><span id="l19.22">   let messageGenerator = new MessageGenerator();</span>
<a href="#l19.23"></a><span id="l19.23">   let localInbox = localAccountUtils.inboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l19.24"></a><span id="l19.24"> </span>
<a href="#l19.25"></a><span id="l19.25" class="difflineat">@@ -47,43 +42,43 @@ function run_test() {</span>
<a href="#l19.26"></a><span id="l19.26">   let searchTerm = searchSession.createTerm();</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">   // Create the following search term:</span>
<a href="#l19.29"></a><span id="l19.29">   // (folderFlag &amp; Mail &amp;&amp; folderFlag != ImapBox) &amp;&amp;</span>
<a href="#l19.30"></a><span id="l19.30">   //    msg property.gloda-id isEmpty</span>
<a href="#l19.31"></a><span id="l19.31"> </span>
<a href="#l19.32"></a><span id="l19.32">   searchTerm.beginsGrouping = true;</span>
<a href="#l19.33"></a><span id="l19.33">   searchTerm.booleanAnd = true;</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">-  searchTerm.attrib = nsMsgSearchAttrib.FolderFlag;</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineminus">-  searchTerm.op = nsMsgSearchOp.Is;</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+  searchTerm.attrib = Ci.nsMsgSearchAttrib.FolderFlag;</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+  searchTerm.op = Ci.nsMsgSearchOp.Is;</span>
<a href="#l19.38"></a><span id="l19.38">   let value = searchTerm.value;</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineminus">-  value.status = nsMsgFolderFlags.Mail;</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineminus">-  value.attrib = nsMsgSearchAttrib.FolderFlag;</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineplus">+  value.status = Ci.nsMsgFolderFlags.Mail;</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+  value.attrib = Ci.nsMsgSearchAttrib.FolderFlag;</span>
<a href="#l19.43"></a><span id="l19.43">   searchTerm.value = value;</span>
<a href="#l19.44"></a><span id="l19.44">   searchTerms.appendElement(searchTerm);</span>
<a href="#l19.45"></a><span id="l19.45"> </span>
<a href="#l19.46"></a><span id="l19.46">   searchTerm = searchSession.createTerm();</span>
<a href="#l19.47"></a><span id="l19.47">   searchTerm.booleanAnd = true;</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineminus">-  searchTerm.attrib = nsMsgSearchAttrib.FolderFlag;</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineminus">-  searchTerm.op = nsMsgSearchOp.Isnt;</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+  searchTerm.attrib = Ci.nsMsgSearchAttrib.FolderFlag;</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+  searchTerm.op = Ci.nsMsgSearchOp.Isnt;</span>
<a href="#l19.52"></a><span id="l19.52">   value = searchTerm.value;</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineminus">-  value.status = nsMsgFolderFlags.ImapBox;</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-  value.attrib = nsMsgSearchAttrib.FolderFlag;</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineplus">+  value.status = Ci.nsMsgFolderFlags.ImapBox;</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineplus">+  value.attrib = Ci.nsMsgSearchAttrib.FolderFlag;</span>
<a href="#l19.57"></a><span id="l19.57">   searchTerm.value = value;</span>
<a href="#l19.58"></a><span id="l19.58">   searchTerm.endsGrouping = true;</span>
<a href="#l19.59"></a><span id="l19.59">   searchTerms.appendElement(searchTerm);</span>
<a href="#l19.60"></a><span id="l19.60"> </span>
<a href="#l19.61"></a><span id="l19.61">   searchTerm = searchSession.createTerm();</span>
<a href="#l19.62"></a><span id="l19.62">   searchTerm.booleanAnd = true;</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineminus">-  searchTerm.attrib = nsMsgSearchAttrib.HdrProperty;</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineplus">+  searchTerm.attrib = Ci.nsMsgSearchAttrib.HdrProperty;</span>
<a href="#l19.65"></a><span id="l19.65">   searchTerm.hdrProperty = &quot;gloda-id&quot;;</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineminus">-  searchTerm.op = nsMsgSearchOp.IsEmpty;</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineplus">+  searchTerm.op = Ci.nsMsgSearchOp.IsEmpty;</span>
<a href="#l19.68"></a><span id="l19.68">   value = searchTerm.value;</span>
<a href="#l19.69"></a><span id="l19.69">   value.str = &quot;gloda-id&quot;;</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineminus">-  value.attrib = nsMsgSearchAttrib.HdrProperty;</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineplus">+  value.attrib = Ci.nsMsgSearchAttrib.HdrProperty;</span>
<a href="#l19.72"></a><span id="l19.72">   searchTerm.value = value;</span>
<a href="#l19.73"></a><span id="l19.73">   searchTerms.appendElement(searchTerm);</span>
<a href="#l19.74"></a><span id="l19.74"> </span>
<a href="#l19.75"></a><span id="l19.75">   let filterEnumerator = inboxDB.getFilterEnumerator(searchTerms);</span>
<a href="#l19.76"></a><span id="l19.76">   let numMatches = {};</span>
<a href="#l19.77"></a><span id="l19.77">   let keepGoing = inboxDB.nextMatchingHdrs(filterEnumerator, 100, 100, null, numMatches);</span>
<a href="#l19.78"></a><span id="l19.78">   Assert.equal(kNumExpectedMatches, numMatches.value);</span>
<a href="#l19.79"></a><span id="l19.79">   Assert.ok(!keepGoing);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapContentLength.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapContentLength.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -45,17 +45,17 @@ var msgFolderListener = {</span>
<a href="#l20.4"></a><span id="l20.4"> };</span>
<a href="#l20.5"></a><span id="l20.5"> </span>
<a href="#l20.6"></a><span id="l20.6"> function setup() {</span>
<a href="#l20.7"></a><span id="l20.7">   setupIMAPPump();</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9">   // Set up nsIMsgFolderListener to get the header when it's received</span>
<a href="#l20.10"></a><span id="l20.10">   MailServices.mfn.addListener(msgFolderListener, MailServices.mfn.msgAdded);</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  IMAPPump.inbox.flags &amp;= ~Ci.nsMsgFolderFlags.Offline;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  IMAPPump.inbox.clearFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l20.14"></a><span id="l20.14"> }</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16"> function verifyContentLength() {</span>
<a href="#l20.17"></a><span id="l20.17">   let messageUri = IMAPPump.inbox.getUriForMsg(gMsgHdr);</span>
<a href="#l20.18"></a><span id="l20.18">   // Convert this to a URI that necko can run</span>
<a href="#l20.19"></a><span id="l20.19">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l20.20"></a><span id="l20.20">   let neckoURL = {};</span>
<a href="#l20.21"></a><span id="l20.21">   let messageService = messenger.messageServiceFromURI(messageUri);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_listSubscribed.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_listSubscribed.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -17,17 +17,16 @@ load(&quot;../../../resources/logHelper.js&quot;);</span>
<a href="#l21.4"></a><span id="l21.4"> load(&quot;../../../resources/asyncTestUtils.js&quot;);</span>
<a href="#l21.5"></a><span id="l21.5"> load(&quot;../../../resources/alertTestUtils.js&quot;);</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7"> // IMAP pump</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11"> // Globals</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-var nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l21.13"></a><span id="l21.13"> </span>
<a href="#l21.14"></a><span id="l21.14"> // Zimbra is one of the servers that supports LIST-EXTENDED</span>
<a href="#l21.15"></a><span id="l21.15"> // it also has a bug that causes a server crash in certain setups</span>
<a href="#l21.16"></a><span id="l21.16"> setupIMAPPump(&quot;Zimbra&quot;);</span>
<a href="#l21.17"></a><span id="l21.17"> </span>
<a href="#l21.18"></a><span id="l21.18"> // Definition of tests</span>
<a href="#l21.19"></a><span id="l21.19"> var tests = [</span>
<a href="#l21.20"></a><span id="l21.20">   setupMailboxes,</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineat">@@ -52,34 +51,34 @@ function* setupMailboxes()</span>
<a href="#l21.22"></a><span id="l21.22"> </span>
<a href="#l21.23"></a><span id="l21.23"> // tests that LIST (SUBSCRIBED) returns the proper response</span>
<a href="#l21.24"></a><span id="l21.24"> function* testListSubscribed()</span>
<a href="#l21.25"></a><span id="l21.25"> {</span>
<a href="#l21.26"></a><span id="l21.26">   // check that we have \Noselect and \Noinferiors flags - these would not have</span>
<a href="#l21.27"></a><span id="l21.27">   // been returned if we had used LSUB instead of LIST(SUBSCRIBED)</span>
<a href="#l21.28"></a><span id="l21.28">   let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l21.29"></a><span id="l21.29">   let folder1 = rootFolder.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-  Assert.ok(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-  Assert.ok(!folder1.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+  Assert.ok(folder1.getFlag(Ci.nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+  Assert.ok(!folder1.getFlag(Ci.nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l21.34"></a><span id="l21.34"> </span>
<a href="#l21.35"></a><span id="l21.35">   // make sure the above test was not a fluke</span>
<a href="#l21.36"></a><span id="l21.36">   let folder11 = folder1.getChildNamed(&quot;folder11&quot;);</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-  Assert.ok(!folder11.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">-  Assert.ok(folder11.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+  Assert.ok(!folder11.getFlag(Ci.nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+  Assert.ok(folder11.getFlag(Ci.nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l21.41"></a><span id="l21.41"> </span>
<a href="#l21.42"></a><span id="l21.42">   // test that \NonExistent implies \Noselect</span>
<a href="#l21.43"></a><span id="l21.43">   let folder2 = rootFolder.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineminus">-  Assert.ok(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineplus">+  Assert.ok(folder1.getFlag(Ci.nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l21.46"></a><span id="l21.46"> </span>
<a href="#l21.47"></a><span id="l21.47">   // should not get a folder3 since it is not subscribed</span>
<a href="#l21.48"></a><span id="l21.48">   let folder3;</span>
<a href="#l21.49"></a><span id="l21.49">   try {</span>
<a href="#l21.50"></a><span id="l21.50">     folder3 = rootFolder.getChildNamed(&quot;folder3&quot;);</span>
<a href="#l21.51"></a><span id="l21.51">   } catch (ex) {}</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineminus">-  //do_check_false(folder1.getFlag(nsMsgFolderFlags.Subscribed));</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+  //do_check_false(folder1.getFlag(Ci.nsMsgFolderFlags.Subscribed));</span>
<a href="#l21.54"></a><span id="l21.54">   Assert.equal(null, folder3);</span>
<a href="#l21.55"></a><span id="l21.55"> </span>
<a href="#l21.56"></a><span id="l21.56">   yield true;</span>
<a href="#l21.57"></a><span id="l21.57"> }</span>
<a href="#l21.58"></a><span id="l21.58"> </span>
<a href="#l21.59"></a><span id="l21.59"> function* testZimbraServerVersions() {</span>
<a href="#l21.60"></a><span id="l21.60">   // older versions of Zimbra can crash if we send LIST (SUBSCRIBED) so we want</span>
<a href="#l21.61"></a><span id="l21.61">   // to make sure that we are checking for versions</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineat">@@ -100,17 +99,18 @@ function* testZimbraServerVersions() {</span>
<a href="#l21.63"></a><span id="l21.63">     IMAPPump.incomingServer.closeCachedConnections();</span>
<a href="#l21.64"></a><span id="l21.64">     IMAPPump.incomingServer.performExpand(null);</span>
<a href="#l21.65"></a><span id="l21.65">     // select inbox is just to wait on performExpand since performExpand does not have listener</span>
<a href="#l21.66"></a><span id="l21.66">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l21.67"></a><span id="l21.67">     yield false;</span>
<a href="#l21.68"></a><span id="l21.68">     // if we send LSUB instead of LIST(SUBSCRIBED), then we should not have \NoSelect flag</span>
<a href="#l21.69"></a><span id="l21.69">     let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l21.70"></a><span id="l21.70">     let folder1 = rootFolder.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineminus">-    Assert.equal(folder1.getFlag(nsMsgFolderFlags.ImapNoselect), testValues[i].expectedResult);</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+    Assert.equal(folder1.getFlag(Ci.nsMsgFolderFlags.ImapNoselect),</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineplus">+                 testValues[i].expectedResult);</span>
<a href="#l21.74"></a><span id="l21.74">   }</span>
<a href="#l21.75"></a><span id="l21.75"> }</span>
<a href="#l21.76"></a><span id="l21.76"> </span>
<a href="#l21.77"></a><span id="l21.77"> // Cleanup at end</span>
<a href="#l21.78"></a><span id="l21.78"> function endTest()</span>
<a href="#l21.79"></a><span id="l21.79"> {</span>
<a href="#l21.80"></a><span id="l21.80">   teardownIMAPPump();</span>
<a href="#l21.81"></a><span id="l21.81"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_lsub.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_lsub.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -40,40 +40,38 @@ function* setupMailboxes()</span>
<a href="#l22.4"></a><span id="l22.4">   // select the inbox to force folder discovery, etc.</span>
<a href="#l22.5"></a><span id="l22.5">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l22.6"></a><span id="l22.6">   yield false;</span>
<a href="#l22.7"></a><span id="l22.7"> }</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9"> // tests that LSUB returns the proper response</span>
<a href="#l22.10"></a><span id="l22.10"> function* testLsub()</span>
<a href="#l22.11"></a><span id="l22.11"> {</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  let nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-</span>
<a href="#l22.14"></a><span id="l22.14">   // check that we have \Noselect and \Noinferiors flags - these would not have</span>
<a href="#l22.15"></a><span id="l22.15">   // been returned if we had used LSUB instead of LIST(SUBSCRIBED)</span>
<a href="#l22.16"></a><span id="l22.16">   let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l22.17"></a><span id="l22.17">   let folder1 = rootFolder.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-  Assert.ok(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-  Assert.ok(!folder1.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+  Assert.ok(folder1.getFlag(Ci.nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+  Assert.ok(!folder1.getFlag(Ci.nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l22.22"></a><span id="l22.22"> </span>
<a href="#l22.23"></a><span id="l22.23">   // make sure the above test was not a fluke</span>
<a href="#l22.24"></a><span id="l22.24">   let folder11 = folder1.getChildNamed(&quot;folder11&quot;);</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineminus">-  Assert.ok(!folder11.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineminus">-  Assert.ok(folder11.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineplus">+  Assert.ok(!folder11.getFlag(Ci.nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineplus">+  Assert.ok(folder11.getFlag(Ci.nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l22.29"></a><span id="l22.29"> </span>
<a href="#l22.30"></a><span id="l22.30">   // test that \NonExistent implies \Noselect</span>
<a href="#l22.31"></a><span id="l22.31">   let folder2 = rootFolder.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">-  Assert.ok(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+  Assert.ok(folder1.getFlag(Ci.nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l22.34"></a><span id="l22.34"> </span>
<a href="#l22.35"></a><span id="l22.35">   // should not get a folder3 since it is not subscribed</span>
<a href="#l22.36"></a><span id="l22.36">   let folder3;</span>
<a href="#l22.37"></a><span id="l22.37">   try {</span>
<a href="#l22.38"></a><span id="l22.38">     folder3 = rootFolder.getChildNamed(&quot;folder3&quot;);</span>
<a href="#l22.39"></a><span id="l22.39">   } catch (ex) {}</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineminus">-  //do_check_false(folder1.getFlag(nsMsgFolderFlags.Subscribed));</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+  //do_check_false(folder1.getFlag(Ci.nsMsgFolderFlags.Subscribed));</span>
<a href="#l22.42"></a><span id="l22.42">   Assert.equal(null, folder3);</span>
<a href="#l22.43"></a><span id="l22.43"> </span>
<a href="#l22.44"></a><span id="l22.44">   yield true;</span>
<a href="#l22.45"></a><span id="l22.45"> }</span>
<a href="#l22.46"></a><span id="l22.46"> </span>
<a href="#l22.47"></a><span id="l22.47"> // Cleanup at end</span>
<a href="#l22.48"></a><span id="l22.48"> function endTest()</span>
<a href="#l22.49"></a><span id="l22.49"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -157,17 +157,17 @@ var gTestArray =</span>
<a href="#l23.4"></a><span id="l23.4">   function testAddFolder2() { addFolder(gRootFolder, &quot;folder3&quot;, &quot;gIMAPFolder3&quot;) },</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6">   // Adding messages to folders</span>
<a href="#l23.7"></a><span id="l23.7">   function testCopyFileMessage1()</span>
<a href="#l23.8"></a><span id="l23.8">   {</span>
<a href="#l23.9"></a><span id="l23.9">     // Make sure the offline flag is not set for any of the folders</span>
<a href="#l23.10"></a><span id="l23.10">     [gIMAPInbox, gIMAPFolder2, gIMAPFolder3].forEach(function (folder)</span>
<a href="#l23.11"></a><span id="l23.11">     {</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-      folder.flags &amp;= ~Ci.nsMsgFolderFlags.Offline;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+      folder.clearFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l23.14"></a><span id="l23.14">     });</span>
<a href="#l23.15"></a><span id="l23.15">     copyFileMessage(gMsgFile1, gMsgId1, gIMAPInbox)</span>
<a href="#l23.16"></a><span id="l23.16">   },</span>
<a href="#l23.17"></a><span id="l23.17">   function testCopyFileMessage2() { copyFileMessage(gMsgFile2, gMsgId2, gIMAPInbox) },</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19">   // Add message straight to the server, so that we get a message added</span>
<a href="#l23.20"></a><span id="l23.20">   // notification on the next folder update</span>
<a href="#l23.21"></a><span id="l23.21">   function testNewMessageArrival1() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -126,40 +126,38 @@ function subtest_folder_operations(root)</span>
<a href="#l24.4"></a><span id="l24.4">   // Test - isAncestorOf</span>
<a href="#l24.5"></a><span id="l24.5"> </span>
<a href="#l24.6"></a><span id="l24.6">   Assert.ok(folder.isAncestorOf(folder2));</span>
<a href="#l24.7"></a><span id="l24.7">   Assert.ok(root.isAncestorOf(folder2));</span>
<a href="#l24.8"></a><span id="l24.8">   Assert.ok(!folder.isAncestorOf(root));</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10">   // Test - FoldersWithFlag</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+  folder.setFlag(Ci.nsMsgFolderFlags.CheckNew);</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+  Assert.ok(folder.getFlag(Ci.nsMsgFolderFlags.CheckNew));</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+  Assert.ok(!folder.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l24.16"></a><span id="l24.16"> </span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">-  folder.setFlag(nsMsgFolderFlags.CheckNew);</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-  Assert.ok(folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">-  Assert.ok(!folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineminus">-</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineminus">-  folder.setFlag(nsMsgFolderFlags.Offline);</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-  Assert.ok(folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineminus">-  Assert.ok(folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineplus">+  folder.setFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+  Assert.ok(folder.getFlag(Ci.nsMsgFolderFlags.CheckNew));</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineplus">+  Assert.ok(folder.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l24.27"></a><span id="l24.27"> </span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">-  folder.toggleFlag(nsMsgFolderFlags.CheckNew);</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">-  Assert.ok(!folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">-  Assert.ok(folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+  folder.toggleFlag(Ci.nsMsgFolderFlags.CheckNew);</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+  Assert.ok(!folder.getFlag(Ci.nsMsgFolderFlags.CheckNew));</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineplus">+  Assert.ok(folder.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l24.34"></a><span id="l24.34"> </span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-  folder.clearFlag(nsMsgFolderFlags.Offline);</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-  Assert.ok(!folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-  Assert.ok(!folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+  folder.clearFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineplus">+  Assert.ok(!folder.getFlag(Ci.nsMsgFolderFlags.CheckNew));</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+  Assert.ok(!folder.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l24.41"></a><span id="l24.41"> </span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">-  folder.setFlag(nsMsgFolderFlags.Favorite);</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-  folder2.setFlag(nsMsgFolderFlags.Favorite);</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineminus">-  folder.setFlag(nsMsgFolderFlags.CheckNew);</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineminus">-  folder2.setFlag(nsMsgFolderFlags.Offline);</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineplus">+  folder.setFlag(Ci.nsMsgFolderFlags.Favorite);</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineplus">+  folder2.setFlag(Ci.nsMsgFolderFlags.Favorite);</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineplus">+  folder.setFlag(Ci.nsMsgFolderFlags.CheckNew);</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineplus">+  folder2.setFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l24.50"></a><span id="l24.50"> </span>
<a href="#l24.51"></a><span id="l24.51" class="difflineminus">-  Assert.equal(root.getFolderWithFlags(nsMsgFolderFlags.CheckNew),</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineplus">+  Assert.equal(root.getFolderWithFlags(Ci.nsMsgFolderFlags.CheckNew),</span>
<a href="#l24.53"></a><span id="l24.53">                folder);</span>
<a href="#l24.54"></a><span id="l24.54"> </span>
<a href="#l24.55"></a><span id="l24.55">   // Test - Move folders around</span>
<a href="#l24.56"></a><span id="l24.56"> </span>
<a href="#l24.57"></a><span id="l24.57">   var folder3 = root.createLocalSubfolder(&quot;folder3&quot;);</span>
<a href="#l24.58"></a><span id="l24.58">   var folder3Local = folder3.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l24.59"></a><span id="l24.59">   var folder1Local = folder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l24.60"></a><span id="l24.60"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

