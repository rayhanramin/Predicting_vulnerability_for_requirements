<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26541:e52fa180949cfe4f74737c5e9767a2299e045399</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ e52fa180949cfe4f74737c5e9767a2299e045399" />
<meta property="og:url" content="/comm-central/rev/e52fa180949cfe4f74737c5e9767a2299e045399" />
<meta property="og:description" content="Bug 1532388 - implement full support for IMAP and SMTP CLIENTID. r=gds,jorgk,mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / e52fa180949cfe4f74737c5e9767a2299e045399 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/e52fa180949cfe4f74737c5e9767a2299e045399">shortlog</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/e52fa180949cfe4f74737c5e9767a2299e045399">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399">files</a> |
changeset |
<a href="/comm-central/raw-rev/e52fa180949cfe4f74737c5e9767a2299e045399">raw</a>  | <a href="/comm-central/archive/e52fa180949cfe4f74737c5e9767a2299e045399.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1532388">Bug 1532388</a> - implement full support for IMAP and SMTP CLIENTID. r=gds,jorgk,mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#97;&#110;&#105;&#101;&#108;&#32;&#70;&#114;&#97;&#115;&#101;&#114;&#32;&#60;&#100;&#97;&#110;&#105;&#101;&#108;&#102;&#64;&#108;&#105;&#110;&#117;&#120;&#109;&#97;&#103;&#105;&#99;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 08 May 2019 13:37:47 +0200</td></tr>

<tr>
 <td>changeset 26541</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/e52fa180949cfe4f74737c5e9767a2299e045399">e52fa180949cfe4f74737c5e9767a2299e045399</a></td>
</tr>



<tr>
<td>parent 26540</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/28431fe1f4aa4de6afd79769412eeafe64c09873">28431fe1f4aa4de6afd79769412eeafe64c09873</a>
</td>
</tr>

<tr>
<td>child 26542</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0dc1aefd12e5ff6252d0f224cbe672ae4cf0e8ff">0dc1aefd12e5ff6252d0f224cbe672ae4cf0e8ff</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=e52fa180949cfe4f74737c5e9767a2299e045399">15888</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 08 May 2019 12:36:38 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0dc1aefd12e5 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0dc1aefd12e5ff6252d0f224cbe672ae4cf0e8ff">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0dc1aefd12e5ff6252d0f224cbe672ae4cf0e8ff&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0dc1aefd12e5ff6252d0f224cbe672ae4cf0e8ff&newProject=comm-central&newRevision=28431fe1f4aa4de6afd79769412eeafe64c09873&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0dc1aefd12e5ff6252d0f224cbe672ae4cf0e8ff&newProject=comm-central&newRevision=28431fe1f4aa4de6afd79769412eeafe64c09873&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0dc1aefd12e5ff6252d0f224cbe672ae4cf0e8ff&newProject=comm-central&newRevision=28431fe1f4aa4de6afd79769412eeafe64c09873&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28gds%29&revcount=50">gds</a>, <a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a>, <a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1532388">1532388</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1532388">Bug 1532388</a> - implement full support for IMAP and SMTP CLIENTID. r=gds,jorgk,mkmelin

IMAP RFC Draft: https://tools.ietf.org/html/draft-yu-imap-client-id-01
SMTP RFC Draft: https://tools.ietf.org/html/draft-storey-smtp-client-id-05</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/public/nsIMsgIncomingServer.idl">mailnews/base/public/nsIMsgIncomingServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/public/nsIMsgIncomingServer.idl">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/public/nsIMsgIncomingServer.idl">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/public/nsIMsgIncomingServer.idl">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/public/nsIMsgIncomingServer.idl">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/public/nsIMsgIncomingServer.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/mailnewsMigrator.js">mailnews/base/util/mailnewsMigrator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/mailnewsMigrator.js">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/mailnewsMigrator.js">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/mailnewsMigrator.js">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/mailnewsMigrator.js">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/mailnewsMigrator.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/public/nsISmtpServer.idl">mailnews/compose/public/nsISmtpServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/public/nsISmtpServer.idl">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/public/nsISmtpServer.idl">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/public/nsISmtpServer.idl">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/public/nsISmtpServer.idl">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/public/nsISmtpServer.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.cpp">mailnews/compose/src/nsComposeStrings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.cpp">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.cpp">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.cpp">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.cpp">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.h">mailnews/compose/src/nsComposeStrings.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.h">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.h">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.h">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.h">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsComposeStrings.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.h">mailnews/compose/src/nsSmtpProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.h">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.h">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.h">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.h">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpServer.cpp">mailnews/compose/src/nsSmtpServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpServer.cpp">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpServer.cpp">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpServer.cpp">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpServer.cpp">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/compose/src/nsSmtpServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapCore.h">mailnews/imap/src/nsImapCore.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapCore.h">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapCore.h">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapCore.h">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapCore.h">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapCore.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.h">mailnews/imap/src/nsImapProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.h">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.h">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.h">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.h">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapServerResponseParser.cpp">mailnews/imap/src/nsImapServerResponseParser.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapServerResponseParser.cpp">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapServerResponseParser.cpp">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapServerResponseParser.cpp">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapServerResponseParser.cpp">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/imap/src/nsImapServerResponseParser.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/mailnews.js">mailnews/mailnews.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/mailnews.js">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/mailnews.js">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/mailnews.js">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/mailnews.js">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/mailnews/mailnews.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e52fa180949cfe4f74737c5e9767a2299e045399/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">file</a> |
<a href="/comm-central/annotate/e52fa180949cfe4f74737c5e9767a2299e045399/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">annotate</a> |
<a href="/comm-central/diff/e52fa180949cfe4f74737c5e9767a2299e045399/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">diff</a> |
<a href="/comm-central/comparison/e52fa180949cfe4f74737c5e9767a2299e045399/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">comparison</a> |
<a href="/comm-central/log/e52fa180949cfe4f74737c5e9767a2299e045399/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -69,16 +69,22 @@ startTlsFailed=An error occurred while s</span>
<a href="#l1.4"></a><span id="l1.4"> smtpPasswordUndefined=An error occurred while sending mail: Could not get password for %S. The message was not sent.</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> ## LOCALIZATION NOTE (smtpSendNotAllowed): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l1.7"></a><span id="l1.7"> smtpSendNotAllowed=An error occurred while sending mail. The mail server responded:\n%s.\nPlease ensure that you are using the correct identity to send and that the used authentication method is correct. Verify that you are allowed to send via this SMTP server with your current credentials from your current network.</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> ## LOCALIZATION NOTE (smtpTempSizeExceeded): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l1.10"></a><span id="l1.10"> smtpTempSizeExceeded=The size of the message you are trying to send exceeds a temporary size limit of the server. The message was not sent; try to reduce the message size or wait some time and try again. The server responded:  %s.</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+## LOCALIZATION NOTE (smtpClientid): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+smtpClientid=The outgoing server (SMTP) detected an error in the CLIENTID command. The message was not sent. The server responded: %s</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+## LOCALIZATION NOTE (smtpClientidPermission): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+smtpClientidPermission=The outgoing server (SMTP) response to the CLIENTID command indicates that your device is not permitted to send mail. The server responded: %s</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+</span>
<a href="#l1.18"></a><span id="l1.18"> ## LOCALIZATION NOTE (smtpPermSizeExceeded1): argument %d is the Outgoing server (SMTP) size limit</span>
<a href="#l1.19"></a><span id="l1.19"> smtpPermSizeExceeded1=The size of the message you are trying to send exceeds the global size limit (%d bytes) of the server. The message was not sent; reduce the message size and try again.</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21"> ## LOCALIZATION NOTE (smtpPermSizeExceeded2): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l1.22"></a><span id="l1.22"> smtpPermSizeExceeded2=The size of the message you are trying to send exceeds the global size limit of the server. The message was not sent; reduce the message size and try again. The server responded:  %s.</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24"> ## LOCALIZATION NOTE (smtpSendFailedUnknownServer): argument %S is the Outgoing server (SMTP)</span>
<a href="#l1.25"></a><span id="l1.25"> smtpSendFailedUnknownServer=An error occurred while sending mail: Outgoing server (SMTP) %S is unknown. The server may be incorrectly configured. Please verify that your Outgoing server (SMTP) settings are correct and try again.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgIncomingServer.idl</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgIncomingServer.idl</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -72,16 +72,22 @@ interface nsIMsgIncomingServer : nsISupp</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">   /**</span>
<a href="#l2.6"></a><span id="l2.6">    * protocol type, i.e. &quot;pop3&quot;, &quot;imap&quot;, &quot;nntp&quot;, &quot;none&quot;, etc</span>
<a href="#l2.7"></a><span id="l2.7">    * used to construct URLs</span>
<a href="#l2.8"></a><span id="l2.8">    */</span>
<a href="#l2.9"></a><span id="l2.9">   attribute ACString type;</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">   /**</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+   * The CLIENTID to use for this server.</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+   * @see https://tools.ietf.org/html/draft-yu-imap-client-id-01</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+   */</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+  attribute ACString clientid;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+  /**</span>
<a href="#l2.18"></a><span id="l2.18">    * The proper instance of nsIMsgProtocolInfo corresponding to this server type.</span>
<a href="#l2.19"></a><span id="l2.19">    */</span>
<a href="#l2.20"></a><span id="l2.20">   readonly attribute nsIMsgProtocolInfo protocolInfo;</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22">   readonly attribute AString accountManagerChrome;</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24">   /**</span>
<a href="#l2.25"></a><span id="l2.25">    * The schema for the local mail store, such as &quot;mailbox&quot;, &quot;imap&quot;, or &quot;news&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/util/mailnewsMigrator.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/util/mailnewsMigrator.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -17,16 +17,22 @@ var {Services} = ChromeUtils.import(&quot;res</span>
<a href="#l3.4"></a><span id="l3.4"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l3.5"></a><span id="l3.5"> var kServerPrefVersion = 1;</span>
<a href="#l3.6"></a><span id="l3.6"> var kSmtpPrefVersion = 1;</span>
<a href="#l3.7"></a><span id="l3.7"> var kABRemoteContentPrefVersion = 1;</span>
<a href="#l3.8"></a><span id="l3.8"> var kDefaultCharsetsPrefVersion = 1;</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10"> function migrateMailnews() {</span>
<a href="#l3.11"></a><span id="l3.11">   try {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+    MigrateProfileClientid();</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  } catch (e) {</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+    logException(e);</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+  }</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+  try {</span>
<a href="#l3.18"></a><span id="l3.18">     MigrateServerAuthPref();</span>
<a href="#l3.19"></a><span id="l3.19">   } catch (e) {</span>
<a href="#l3.20"></a><span id="l3.20">     logException(e);</span>
<a href="#l3.21"></a><span id="l3.21">   }</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23">   try {</span>
<a href="#l3.24"></a><span id="l3.24">     MigrateABRemoteContentSettings();</span>
<a href="#l3.25"></a><span id="l3.25">   } catch (e) {</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineat">@@ -36,16 +42,32 @@ function migrateMailnews() {</span>
<a href="#l3.27"></a><span id="l3.27">   try {</span>
<a href="#l3.28"></a><span id="l3.28">     MigrateDefaultCharsets();</span>
<a href="#l3.29"></a><span id="l3.29">   } catch (e) {</span>
<a href="#l3.30"></a><span id="l3.30">     logException(e);</span>
<a href="#l3.31"></a><span id="l3.31">   }</span>
<a href="#l3.32"></a><span id="l3.32"> }</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34"> /**</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+ * Creates the server specific default 'clientid' prefs.</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+ */</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+function MigrateProfileClientid() {</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+  // First generate a uuid without braces.</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+  let uuidGen = Cc[&quot;@mozilla.org/uuid-generator;1&quot;].getService(Ci.nsIUUIDGenerator);</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+  let defaultClientid = uuidGen.generateUUID().toString().replace(/[{}]/g, &quot;&quot;);</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+  // We need to populate our default clientid preferences if they are missing.</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+  if (!Services.prefs.getCharPref(&quot;mail.server.default.clientid&quot;)) {</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+    Services.prefs.setCharPref(&quot;mail.server.default.clientid&quot;, defaultClientid);</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+  }</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+  if (!Services.prefs.getCharPref(&quot;mail.smtpserver.default.clientid&quot;)) {</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+    Services.prefs.setCharPref(&quot;mail.smtpserver.default.clientid&quot;, defaultClientid);</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+  }</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+}</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+/**</span>
<a href="#l3.51"></a><span id="l3.51">  * Migrates from pref useSecAuth to pref authMethod</span>
<a href="#l3.52"></a><span id="l3.52">  */</span>
<a href="#l3.53"></a><span id="l3.53"> function MigrateServerAuthPref() {</span>
<a href="#l3.54"></a><span id="l3.54">   try {</span>
<a href="#l3.55"></a><span id="l3.55">     // comma-separated list of all accounts.</span>
<a href="#l3.56"></a><span id="l3.56">     var accounts = Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;)</span>
<a href="#l3.57"></a><span id="l3.57">         .split(&quot;,&quot;);</span>
<a href="#l3.58"></a><span id="l3.58">     for (let i = 0; i &lt; accounts.length; i++) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1702,16 +1702,17 @@ nsMsgIncomingServer::GetIsSecure(bool *a</span>
<a href="#l4.4"></a><span id="l4.4">   return NS_OK;</span>
<a href="#l4.5"></a><span id="l4.5"> }</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> // use the convenience macros to implement the accessors</span>
<a href="#l4.8"></a><span id="l4.8"> NS_IMPL_SERVERPREF_STR(nsMsgIncomingServer, Username, &quot;userName&quot;)</span>
<a href="#l4.9"></a><span id="l4.9"> NS_IMPL_SERVERPREF_INT(nsMsgIncomingServer, AuthMethod, &quot;authMethod&quot;)</span>
<a href="#l4.10"></a><span id="l4.10"> NS_IMPL_SERVERPREF_INT(nsMsgIncomingServer, BiffMinutes, &quot;check_time&quot;)</span>
<a href="#l4.11"></a><span id="l4.11"> NS_IMPL_SERVERPREF_STR(nsMsgIncomingServer, Type, &quot;type&quot;)</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+NS_IMPL_SERVERPREF_STR(nsMsgIncomingServer, Clientid, &quot;clientid&quot;)</span>
<a href="#l4.13"></a><span id="l4.13"> NS_IMPL_SERVERPREF_BOOL(nsMsgIncomingServer, DownloadOnBiff, &quot;download_on_biff&quot;)</span>
<a href="#l4.14"></a><span id="l4.14"> NS_IMPL_SERVERPREF_BOOL(nsMsgIncomingServer, Valid, &quot;valid&quot;)</span>
<a href="#l4.15"></a><span id="l4.15"> NS_IMPL_SERVERPREF_BOOL(nsMsgIncomingServer, EmptyTrashOnExit,</span>
<a href="#l4.16"></a><span id="l4.16">                         &quot;empty_trash_on_exit&quot;)</span>
<a href="#l4.17"></a><span id="l4.17"> NS_IMPL_SERVERPREF_BOOL(nsMsgIncomingServer, CanDelete, &quot;canDelete&quot;)</span>
<a href="#l4.18"></a><span id="l4.18"> NS_IMPL_SERVERPREF_BOOL(nsMsgIncomingServer, LoginAtStartUp, &quot;login_at_startup&quot;)</span>
<a href="#l4.19"></a><span id="l4.19"> NS_IMPL_SERVERPREF_BOOL(nsMsgIncomingServer,</span>
<a href="#l4.20"></a><span id="l4.20">                         DefaultCopiesAndFoldersPrefsToServer,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/compose/public/nsISmtpServer.idl</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/compose/public/nsISmtpServer.idl</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -31,16 +31,20 @@ interface nsISmtpServer : nsISupports {</span>
<a href="#l5.4"></a><span id="l5.4">   attribute ACString hostname;</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6">   /// The server's port.</span>
<a href="#l5.7"></a><span id="l5.7">   attribute int32_t port;</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">   /// The username to access the server with (if required)</span>
<a href="#l5.10"></a><span id="l5.10">   attribute ACString username;</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+  /// The CLIENTID to use for this server (if required).</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  /// @see https://tools.ietf.org/html/draft-storey-smtp-client-id-05</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+  attribute ACString clientid;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+</span>
<a href="#l5.16"></a><span id="l5.16">   /**</span>
<a href="#l5.17"></a><span id="l5.17">    * The password to access the server with (if required).</span>
<a href="#l5.18"></a><span id="l5.18">    *</span>
<a href="#l5.19"></a><span id="l5.19">    * @note this is stored within the server instance but not within preferences.</span>
<a href="#l5.20"></a><span id="l5.20">    * It can be specified/saved here to avoid prompting the user constantly for</span>
<a href="#l5.21"></a><span id="l5.21">    * the sending password.</span>
<a href="#l5.22"></a><span id="l5.22">    */</span>
<a href="#l5.23"></a><span id="l5.23">   attribute AString password;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/compose/src/nsComposeStrings.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/compose/src/nsComposeStrings.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -92,15 +92,19 @@ const char* errorStringNameForErrorCode(</span>
<a href="#l6.4"></a><span id="l6.4">     case NS_ERROR_SMTP_AUTH_FAILURE:</span>
<a href="#l6.5"></a><span id="l6.5">       return &quot;smtpAuthFailure&quot;;</span>
<a href="#l6.6"></a><span id="l6.6">     case NS_ERROR_SMTP_AUTH_GSSAPI:</span>
<a href="#l6.7"></a><span id="l6.7">       return &quot;smtpAuthGssapi&quot;;</span>
<a href="#l6.8"></a><span id="l6.8">     case NS_ERROR_SMTP_AUTH_MECH_NOT_SUPPORTED:</span>
<a href="#l6.9"></a><span id="l6.9">       return &quot;smtpAuthMechNotSupported&quot;;</span>
<a href="#l6.10"></a><span id="l6.10">     case NS_ERROR_ILLEGAL_LOCALPART:</span>
<a href="#l6.11"></a><span id="l6.11">       return &quot;errorIllegalLocalPart&quot;;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+    case NS_ERROR_CLIENTID:</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+      return &quot;smtpClientid&quot;;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+    case NS_ERROR_CLIENTID_PERMISSION:</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+      return &quot;smtpClientidPermission&quot;;</span>
<a href="#l6.16"></a><span id="l6.16">     default:</span>
<a href="#l6.17"></a><span id="l6.17">       return &quot;sendFailed&quot;;</span>
<a href="#l6.18"></a><span id="l6.18">   }</span>
<a href="#l6.19"></a><span id="l6.19"> #ifdef __GNUC__</span>
<a href="#l6.20"></a><span id="l6.20"> #pragma GCC diagnostic pop</span>
<a href="#l6.21"></a><span id="l6.21"> #endif</span>
<a href="#l6.22"></a><span id="l6.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/compose/src/nsComposeStrings.h</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/compose/src/nsComposeStrings.h</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -61,11 +61,14 @@</span>
<a href="#l7.4"></a><span id="l7.4"> #define NS_ERROR_SMTP_AUTH_CHANGE_ENCRYPT_TO_PLAIN_SSL     NS_MSG_GENERATE_FAILURE(12595)</span>
<a href="#l7.5"></a><span id="l7.5"> #define NS_ERROR_SMTP_AUTH_CHANGE_PLAIN_TO_ENCRYPT         NS_MSG_GENERATE_FAILURE(12596)</span>
<a href="#l7.6"></a><span id="l7.6"> #define NS_ERROR_SMTP_AUTH_FAILURE                  NS_MSG_GENERATE_FAILURE(12597)</span>
<a href="#l7.7"></a><span id="l7.7"> #define NS_ERROR_SMTP_AUTH_GSSAPI                   NS_MSG_GENERATE_FAILURE(12598)</span>
<a href="#l7.8"></a><span id="l7.8"> #define NS_ERROR_SMTP_AUTH_MECH_NOT_SUPPORTED       NS_MSG_GENERATE_FAILURE(12599)</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10"> #define NS_ERROR_ILLEGAL_LOCALPART                  NS_MSG_GENERATE_FAILURE(12601)</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+#define NS_ERROR_CLIENTID                           NS_MSG_GENERATE_FAILURE(12610)</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+#define NS_ERROR_CLIENTID_PERMISSION                NS_MSG_GENERATE_FAILURE(12611)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+</span>
<a href="#l7.15"></a><span id="l7.15"> const char* errorStringNameForErrorCode(nsresult aCode);</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17"> #endif /* _nsComposeStrings_H__ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -110,16 +110,18 @@ nsresult nsExplainErrorDetails(nsISmtpUr</span>
<a href="#l8.4"></a><span id="l8.4">     case NS_ERROR_SMTP_TEMP_SIZE_EXCEEDED:</span>
<a href="#l8.5"></a><span id="l8.5">     case NS_ERROR_SMTP_PERM_SIZE_EXCEEDED_1:</span>
<a href="#l8.6"></a><span id="l8.6">     case NS_ERROR_SMTP_PERM_SIZE_EXCEEDED_2:</span>
<a href="#l8.7"></a><span id="l8.7">     case NS_ERROR_SENDING_FROM_COMMAND:</span>
<a href="#l8.8"></a><span id="l8.8">     case NS_ERROR_SENDING_RCPT_COMMAND:</span>
<a href="#l8.9"></a><span id="l8.9">     case NS_ERROR_SENDING_DATA_COMMAND:</span>
<a href="#l8.10"></a><span id="l8.10">     case NS_ERROR_SENDING_MESSAGE:</span>
<a href="#l8.11"></a><span id="l8.11">     case NS_ERROR_SMTP_GREETING:</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+    case NS_ERROR_CLIENTID:</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    case NS_ERROR_CLIENTID_PERMISSION:</span>
<a href="#l8.14"></a><span id="l8.14">       exitString = errorStringNameForErrorCode(aCode);</span>
<a href="#l8.15"></a><span id="l8.15">       bundle-&gt;GetStringFromName(exitString, eMsg);</span>
<a href="#l8.16"></a><span id="l8.16">       if (aCode == NS_ERROR_SMTP_PERM_SIZE_EXCEEDED_1) {</span>
<a href="#l8.17"></a><span id="l8.17">         // Convert the error message argument back to integer since the error</span>
<a href="#l8.18"></a><span id="l8.18">         // message string smtpPermSizeExceeded1 contains a %d.</span>
<a href="#l8.19"></a><span id="l8.19">         // (The special case can be removed if that string ever changes, then</span>
<a href="#l8.20"></a><span id="l8.20">         // %d should be changed to %S.)</span>
<a href="#l8.21"></a><span id="l8.21">         nsTextFormatter::ssprintf(msg, eMsg.get(), atoi(arg1), arg2);</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -240,16 +242,17 @@ nsresult nsSmtpProtocol::Initialize(nsIU</span>
<a href="#l8.23"></a><span id="l8.23"> </span>
<a href="#l8.24"></a><span id="l8.24">     m_flags = 0;</span>
<a href="#l8.25"></a><span id="l8.25">     m_prefAuthMethods = 0;</span>
<a href="#l8.26"></a><span id="l8.26">     m_failedAuthMethods = 0;</span>
<a href="#l8.27"></a><span id="l8.27">     m_currentAuthMethod = 0;</span>
<a href="#l8.28"></a><span id="l8.28">     m_usernamePrompted = false;</span>
<a href="#l8.29"></a><span id="l8.29">     m_prefSocketType = nsMsgSocketType::trySTARTTLS;</span>
<a href="#l8.30"></a><span id="l8.30">     m_tlsInitiated = false;</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+    m_clientIDInitialized = false;</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33">     m_url = aURL; // Needed in nsMsgAsyncWriteProtocol::UpdateProgress().</span>
<a href="#l8.34"></a><span id="l8.34">     m_urlErrorState = NS_ERROR_FAILURE;</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36">     if (aURL)</span>
<a href="#l8.37"></a><span id="l8.37">         m_runningURL = do_QueryInterface(aURL);</span>
<a href="#l8.38"></a><span id="l8.38"> </span>
<a href="#l8.39"></a><span id="l8.39">     // extract out message feedback if there is any.</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineat">@@ -286,16 +289,17 @@ nsresult nsSmtpProtocol::Initialize(nsIU</span>
<a href="#l8.41"></a><span id="l8.41">     // round trip communication between the client and server</span>
<a href="#l8.42"></a><span id="l8.42">     int32_t authMethod = 0;</span>
<a href="#l8.43"></a><span id="l8.43">     nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l8.44"></a><span id="l8.44">     m_runningURL-&gt;GetSmtpServer(getter_AddRefs(smtpServer));</span>
<a href="#l8.45"></a><span id="l8.45">     if (smtpServer) {</span>
<a href="#l8.46"></a><span id="l8.46">         smtpServer-&gt;GetAuthMethod(&amp;authMethod);</span>
<a href="#l8.47"></a><span id="l8.47">         smtpServer-&gt;GetSocketType(&amp;m_prefSocketType);</span>
<a href="#l8.48"></a><span id="l8.48">         smtpServer-&gt;GetHelloArgument(m_helloArgument);</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+        smtpServer-&gt;GetClientid(m_clientId);</span>
<a href="#l8.50"></a><span id="l8.50"> </span>
<a href="#l8.51"></a><span id="l8.51">         // Query for OAuth2 support. If the SMTP server preferences don't allow</span>
<a href="#l8.52"></a><span id="l8.52">         // for OAuth2, then don't carry around the OAuth2 module any longer</span>
<a href="#l8.53"></a><span id="l8.53">         // since we won't need it.</span>
<a href="#l8.54"></a><span id="l8.54">         mOAuth2Support = do_CreateInstance(MSGIOAUTH2MODULE_CONTRACTID);</span>
<a href="#l8.55"></a><span id="l8.55">         if (mOAuth2Support)</span>
<a href="#l8.56"></a><span id="l8.56">         {</span>
<a href="#l8.57"></a><span id="l8.57">           bool supportsOAuth = false;</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineat">@@ -905,16 +909,23 @@ nsresult nsSmtpProtocol::SendEhloRespons</span>
<a href="#l8.59"></a><span id="l8.59">         if (responseLine.LowerCaseEqualsLiteral(&quot;starttls&quot;))</span>
<a href="#l8.60"></a><span id="l8.60">         {</span>
<a href="#l8.61"></a><span id="l8.61">             SetFlag(SMTP_EHLO_STARTTLS_ENABLED);</span>
<a href="#l8.62"></a><span id="l8.62">         }</span>
<a href="#l8.63"></a><span id="l8.63">         else if (responseLine.LowerCaseEqualsLiteral(&quot;dsn&quot;))</span>
<a href="#l8.64"></a><span id="l8.64">         {</span>
<a href="#l8.65"></a><span id="l8.65">             SetFlag(SMTP_EHLO_DSN_ENABLED);</span>
<a href="#l8.66"></a><span id="l8.66">         }</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+        else if (responseLine.LowerCaseEqualsLiteral(&quot;clientid&quot;))</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+        {</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+            SetFlag(SMTP_EHLO_CLIENTID_ENABLED);</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+            // If we have &quot;clientid&quot; in the ehlo response, then TLS must be present.</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+            if (m_prefSocketType == nsMsgSocketType::SSL)</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+                m_tlsEnabled = true;</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+        }</span>
<a href="#l8.74"></a><span id="l8.74">         else if (StringBeginsWith(responseLine, NS_LITERAL_CSTRING(&quot;AUTH&quot;), nsCaseInsensitiveCStringComparator()))</span>
<a href="#l8.75"></a><span id="l8.75">         {</span>
<a href="#l8.76"></a><span id="l8.76">           SetFlag(SMTP_AUTH);</span>
<a href="#l8.77"></a><span id="l8.77"> </span>
<a href="#l8.78"></a><span id="l8.78">           if (responseLine.Find(NS_LITERAL_CSTRING(&quot;GSSAPI&quot;),</span>
<a href="#l8.79"></a><span id="l8.79">                                 /* ignoreCase = */ true) &gt;= 0)</span>
<a href="#l8.80"></a><span id="l8.80">             SetFlag(SMTP_AUTH_GSSAPI_ENABLED);</span>
<a href="#l8.81"></a><span id="l8.81"> </span>
<a href="#l8.82"></a><span id="l8.82" class="difflineat">@@ -1012,16 +1023,54 @@ nsresult nsSmtpProtocol::SendTLSResponse</span>
<a href="#l8.83"></a><span id="l8.83"> </span>
<a href="#l8.84"></a><span id="l8.84">   ClearFlag(SMTP_EHLO_STARTTLS_ENABLED);</span>
<a href="#l8.85"></a><span id="l8.85">   m_tlsInitiated = false;</span>
<a href="#l8.86"></a><span id="l8.86">   m_nextState = SMTP_AUTH_PROCESS_STATE;</span>
<a href="#l8.87"></a><span id="l8.87"> </span>
<a href="#l8.88"></a><span id="l8.88">   return rv;</span>
<a href="#l8.89"></a><span id="l8.89"> }</span>
<a href="#l8.90"></a><span id="l8.90"> </span>
<a href="#l8.91"></a><span id="l8.91" class="difflineplus">+nsresult nsSmtpProtocol::SendClientIDResponse()</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineplus">+{</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineplus">+  if (m_responseCode/10 == 25)</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineplus">+  {</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineplus">+    // ClientID success!</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineplus">+    m_clientIDInitialized = true;</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineplus">+    ClearFlag(SMTP_EHLO_CLIENTID_ENABLED);</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineplus">+    m_nextState = SMTP_AUTH_PROCESS_STATE;</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineplus">+    return NS_OK;</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineplus">+  }</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineplus">+  // ClientID failed</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineplus">+  nsresult errorCode;</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineplus">+  if (m_responseCode == 550)</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineplus">+  {</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineplus">+    // 'You are not permitted to access this'</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineplus">+    // 'Access Denied' + server response</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineplus">+    errorCode = NS_ERROR_CLIENTID_PERMISSION;</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineplus">+  }</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineplus">+  else</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineplus">+  {</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineplus">+    if (MOZ_LOG_TEST(SMTPLogModule, mozilla::LogLevel::Error))</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineplus">+    {</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineplus">+      if (m_responseCode != 501 &amp;&amp; m_responseCode != 503 &amp;&amp;</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineplus">+          m_responseCode != 504 &amp;&amp; m_responseCode/100 != 4)</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineplus">+      {</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineplus">+        // If not 501, 503, 504 or 4xx, log an error.</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineplus">+        MOZ_LOG(SMTPLogModule, mozilla::LogLevel::Error,</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+                (&quot;SendClientIDResponse: Unexpected error occurred, server responded: %s\n&quot;,</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineplus">+                m_responseText.get()));</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineplus">+      }</span>
<a href="#l8.121"></a><span id="l8.121" class="difflineplus">+    }</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineplus">+    errorCode = NS_ERROR_CLIENTID;</span>
<a href="#l8.123"></a><span id="l8.123" class="difflineplus">+  }</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineplus">+  nsExplainErrorDetails(m_runningURL, errorCode, m_responseText.get(), nullptr);</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineplus">+  m_urlErrorState = NS_ERROR_BUT_DONT_SHOW_ALERT;</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineplus">+  return NS_ERROR_SMTP_AUTH_FAILURE;</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineplus">+}</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineplus">+</span>
<a href="#l8.129"></a><span id="l8.129"> void nsSmtpProtocol::InitPrefAuthMethods(int32_t authMethodPrefValue)</span>
<a href="#l8.130"></a><span id="l8.130"> {</span>
<a href="#l8.131"></a><span id="l8.131">   // for m_prefAuthMethods, using the same flags as server capabilities.</span>
<a href="#l8.132"></a><span id="l8.132">   switch (authMethodPrefValue)</span>
<a href="#l8.133"></a><span id="l8.133">   {</span>
<a href="#l8.134"></a><span id="l8.134">     case nsMsgAuthMethod::none:</span>
<a href="#l8.135"></a><span id="l8.135">       m_prefAuthMethods = SMTP_AUTH_NONE_ENABLED;</span>
<a href="#l8.136"></a><span id="l8.136">       break;</span>
<a href="#l8.137"></a><span id="l8.137" class="difflineat">@@ -1169,16 +1218,33 @@ nsresult nsSmtpProtocol::ProcessAuth()</span>
<a href="#l8.138"></a><span id="l8.138">         {</span>
<a href="#l8.139"></a><span id="l8.139">             m_nextState = SMTP_ERROR_DONE;</span>
<a href="#l8.140"></a><span id="l8.140">             m_urlErrorState = NS_ERROR_STARTTLS_FAILED_EHLO_STARTTLS;</span>
<a href="#l8.141"></a><span id="l8.141">             return NS_ERROR_STARTTLS_FAILED_EHLO_STARTTLS;</span>
<a href="#l8.142"></a><span id="l8.142">         }</span>
<a href="#l8.143"></a><span id="l8.143">     }</span>
<a href="#l8.144"></a><span id="l8.144">   // (wrong indentation until here)</span>
<a href="#l8.145"></a><span id="l8.145"> </span>
<a href="#l8.146"></a><span id="l8.146" class="difflineplus">+  if (!m_clientIDInitialized &amp;&amp; m_tlsEnabled &amp;&amp; !m_clientId.IsEmpty())</span>
<a href="#l8.147"></a><span id="l8.147" class="difflineplus">+  {</span>
<a href="#l8.148"></a><span id="l8.148" class="difflineplus">+    if (TestFlag(SMTP_EHLO_CLIENTID_ENABLED))</span>
<a href="#l8.149"></a><span id="l8.149" class="difflineplus">+    {</span>
<a href="#l8.150"></a><span id="l8.150" class="difflineplus">+      buffer = &quot;CLIENTID TB-UUID &quot;;</span>
<a href="#l8.151"></a><span id="l8.151" class="difflineplus">+      buffer += m_clientId;</span>
<a href="#l8.152"></a><span id="l8.152" class="difflineplus">+      buffer += CRLF;</span>
<a href="#l8.153"></a><span id="l8.153" class="difflineplus">+</span>
<a href="#l8.154"></a><span id="l8.154" class="difflineplus">+      status = SendData(buffer.get());</span>
<a href="#l8.155"></a><span id="l8.155" class="difflineplus">+</span>
<a href="#l8.156"></a><span id="l8.156" class="difflineplus">+      m_nextState = SMTP_RESPONSE;</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineplus">+      m_nextStateAfterResponse = SMTP_CLIENTID_RESPONSE;</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineplus">+      SetFlag(SMTP_PAUSE_FOR_READ);</span>
<a href="#l8.159"></a><span id="l8.159" class="difflineplus">+      return status;</span>
<a href="#l8.160"></a><span id="l8.160" class="difflineplus">+    }</span>
<a href="#l8.161"></a><span id="l8.161" class="difflineplus">+  }</span>
<a href="#l8.162"></a><span id="l8.162" class="difflineplus">+</span>
<a href="#l8.163"></a><span id="l8.163">   (void) ChooseAuthMethod(); // advance m_currentAuthMethod</span>
<a href="#l8.164"></a><span id="l8.164"> </span>
<a href="#l8.165"></a><span id="l8.165">    // We don't need to auth, per pref, or the server doesn't advertise AUTH,</span>
<a href="#l8.166"></a><span id="l8.166">   // so skip auth and try to send message.</span>
<a href="#l8.167"></a><span id="l8.167">   if (m_prefAuthMethods == SMTP_AUTH_NONE_ENABLED || !TestFlag(SMTP_AUTH))</span>
<a href="#l8.168"></a><span id="l8.168">   {</span>
<a href="#l8.169"></a><span id="l8.169">     m_nextState = SMTP_SEND_HELO_RESPONSE;</span>
<a href="#l8.170"></a><span id="l8.170">     // fake to 250 because SendHeloResponse() tests for this</span>
<a href="#l8.171"></a><span id="l8.171" class="difflineat">@@ -2084,16 +2150,22 @@ nsresult nsSmtpProtocol::ProcessProtocol</span>
<a href="#l8.172"></a><span id="l8.172">          status = SendHeloResponse(inputStream, length);</span>
<a href="#l8.173"></a><span id="l8.173">        break;</span>
<a href="#l8.174"></a><span id="l8.174">      case SMTP_SEND_EHLO_RESPONSE:</span>
<a href="#l8.175"></a><span id="l8.175">        if (inputStream == nullptr)</span>
<a href="#l8.176"></a><span id="l8.176">          SetFlag(SMTP_PAUSE_FOR_READ);</span>
<a href="#l8.177"></a><span id="l8.177">        else</span>
<a href="#l8.178"></a><span id="l8.178">          status = SendEhloResponse(inputStream, length);</span>
<a href="#l8.179"></a><span id="l8.179">        break;</span>
<a href="#l8.180"></a><span id="l8.180" class="difflineplus">+     case SMTP_CLIENTID_RESPONSE:</span>
<a href="#l8.181"></a><span id="l8.181" class="difflineplus">+       if (inputStream == nullptr)</span>
<a href="#l8.182"></a><span id="l8.182" class="difflineplus">+         SetFlag(SMTP_PAUSE_FOR_READ);</span>
<a href="#l8.183"></a><span id="l8.183" class="difflineplus">+       else</span>
<a href="#l8.184"></a><span id="l8.184" class="difflineplus">+         status = SendClientIDResponse();</span>
<a href="#l8.185"></a><span id="l8.185" class="difflineplus">+       break;</span>
<a href="#l8.186"></a><span id="l8.186">      case SMTP_AUTH_PROCESS_STATE:</span>
<a href="#l8.187"></a><span id="l8.187">        status = ProcessAuth();</span>
<a href="#l8.188"></a><span id="l8.188">        break;</span>
<a href="#l8.189"></a><span id="l8.189"> </span>
<a href="#l8.190"></a><span id="l8.190">       case SMTP_SEND_AUTH_GSSAPI_FIRST:</span>
<a href="#l8.191"></a><span id="l8.191">         status = AuthGSSAPIFirst();</span>
<a href="#l8.192"></a><span id="l8.192">         break;</span>
<a href="#l8.193"></a><span id="l8.193"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.h</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.h</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -48,27 +48,29 @@ SMTP_TLS_RESPONSE,                      </span>
<a href="#l9.4"></a><span id="l9.4"> SMTP_AUTH_EXTERNAL_RESPONSE,                        // 20</span>
<a href="#l9.5"></a><span id="l9.5"> SMTP_AUTH_PROCESS_STATE,                            // 21</span>
<a href="#l9.6"></a><span id="l9.6"> SMTP_AUTH_CRAM_MD5_CHALLENGE_RESPONSE,              // 22</span>
<a href="#l9.7"></a><span id="l9.7"> SMTP_SEND_AUTH_GSSAPI_FIRST,                        // 23</span>
<a href="#l9.8"></a><span id="l9.8"> SMTP_SEND_AUTH_GSSAPI_STEP,                         // 24</span>
<a href="#l9.9"></a><span id="l9.9"> SMTP_SUSPENDED,                                     // 25</span>
<a href="#l9.10"></a><span id="l9.10"> SMTP_AUTH_OAUTH2_STEP,                              // 26</span>
<a href="#l9.11"></a><span id="l9.11"> SMTP_AUTH_OAUTH2_RESPONSE,                          // 27</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+SMTP_CLIENTID_RESPONSE,                             // 28</span>
<a href="#l9.13"></a><span id="l9.13"> } SmtpState;</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15"> // State Flags (Note, I use the word state in terms of storing</span>
<a href="#l9.16"></a><span id="l9.16"> // state information about the connection (authentication, have we sent</span>
<a href="#l9.17"></a><span id="l9.17"> // commands, etc. I do not intend it to refer to protocol state)</span>
<a href="#l9.18"></a><span id="l9.18"> #define SMTP_PAUSE_FOR_READ             0x00000001  /* should we pause for the next read */</span>
<a href="#l9.19"></a><span id="l9.19"> #define SMTP_ESMTP_SERVER               0x00000002</span>
<a href="#l9.20"></a><span id="l9.20"> #define SMTP_EHLO_DSN_ENABLED           0x00000004</span>
<a href="#l9.21"></a><span id="l9.21"> #define SMTP_EHLO_STARTTLS_ENABLED      0x00000008</span>
<a href="#l9.22"></a><span id="l9.22"> #define SMTP_EHLO_SIZE_ENABLED          0x00000010</span>
<a href="#l9.23"></a><span id="l9.23"> #define SMTP_EHLO_8BIT_ENABLED          0x00000020</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+#define SMTP_EHLO_CLIENTID_ENABLED      0x00000040</span>
<a href="#l9.25"></a><span id="l9.25"> </span>
<a href="#l9.26"></a><span id="l9.26"> // insecure mechanisms follow</span>
<a href="#l9.27"></a><span id="l9.27"> #define SMTP_AUTH_LOGIN_ENABLED         0x00000100</span>
<a href="#l9.28"></a><span id="l9.28"> #define SMTP_AUTH_PLAIN_ENABLED         0x00000200</span>
<a href="#l9.29"></a><span id="l9.29"> #define SMTP_AUTH_EXTERNAL_ENABLED      0x00000400</span>
<a href="#l9.30"></a><span id="l9.30"> // secure mechanisms follow</span>
<a href="#l9.31"></a><span id="l9.31"> #define SMTP_AUTH_GSSAPI_ENABLED        0x00000800</span>
<a href="#l9.32"></a><span id="l9.32"> #define SMTP_AUTH_DIGEST_MD5_ENABLED    0x00001000</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineat">@@ -129,26 +131,29 @@ private:</span>
<a href="#l9.34"></a><span id="l9.34">     int32_t m_continuationResponse;</span>
<a href="#l9.35"></a><span id="l9.35">     nsCString m_responseText;   /* text returned from Smtp server */</span>
<a href="#l9.36"></a><span id="l9.36">     RefPtr&lt;nsMsgLineStreamBuffer&gt; m_lineStreamBuffer; // used to efficiently extract lines from the incoming data stream</span>
<a href="#l9.37"></a><span id="l9.37"> </span>
<a href="#l9.38"></a><span id="l9.38">     nsTArray&lt;nsCString&gt; m_addresses;</span>
<a href="#l9.39"></a><span id="l9.39">     uint32_t       m_addressesLeft;</span>
<a href="#l9.40"></a><span id="l9.40">     nsCString m_mailAddr;</span>
<a href="#l9.41"></a><span id="l9.41">     nsCString m_helloArgument;</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+    nsCString m_clientId;</span>
<a href="#l9.43"></a><span id="l9.43">     int32_t        m_sizelimit;</span>
<a href="#l9.44"></a><span id="l9.44"> </span>
<a href="#l9.45"></a><span id="l9.45">     // *** the following should move to the smtp server when we support</span>
<a href="#l9.46"></a><span id="l9.46">     // multiple smtp servers</span>
<a href="#l9.47"></a><span id="l9.47">     bool m_usernamePrompted;</span>
<a href="#l9.48"></a><span id="l9.48">     int32_t m_prefSocketType;</span>
<a href="#l9.49"></a><span id="l9.49">     bool m_tlsEnabled;</span>
<a href="#l9.50"></a><span id="l9.50"> </span>
<a href="#l9.51"></a><span id="l9.51">     bool m_tlsInitiated;</span>
<a href="#l9.52"></a><span id="l9.52"> </span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+    bool m_clientIDInitialized;</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+</span>
<a href="#l9.55"></a><span id="l9.55">     bool m_sendDone;</span>
<a href="#l9.56"></a><span id="l9.56"> </span>
<a href="#l9.57"></a><span id="l9.57">     int32_t m_totalAmountRead;</span>
<a href="#l9.58"></a><span id="l9.58">     int64_t m_totalMessageSize;</span>
<a href="#l9.59"></a><span id="l9.59"> </span>
<a href="#l9.60"></a><span id="l9.60">     char *m_dataBuf;</span>
<a href="#l9.61"></a><span id="l9.61">     uint32_t m_dataBufSize;</span>
<a href="#l9.62"></a><span id="l9.62"> </span>
<a href="#l9.63"></a><span id="l9.63" class="difflineat">@@ -185,16 +190,17 @@ private:</span>
<a href="#l9.64"></a><span id="l9.64">     nsresult AuthLoginStep0();</span>
<a href="#l9.65"></a><span id="l9.65">     void     AuthLoginStep0Response();</span>
<a href="#l9.66"></a><span id="l9.66">     nsresult AuthLoginStep1();</span>
<a href="#l9.67"></a><span id="l9.67">     nsresult AuthLoginStep2();</span>
<a href="#l9.68"></a><span id="l9.68">     nsresult AuthLoginResponse(nsIInputStream * stream, uint32_t length);</span>
<a href="#l9.69"></a><span id="l9.69">     nsresult AuthOAuth2Step1();</span>
<a href="#l9.70"></a><span id="l9.70"> </span>
<a href="#l9.71"></a><span id="l9.71">     nsresult SendTLSResponse();</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+    nsresult SendClientIDResponse();</span>
<a href="#l9.73"></a><span id="l9.73">     nsresult SendMailResponse();</span>
<a href="#l9.74"></a><span id="l9.74">     nsresult SendRecipientResponse();</span>
<a href="#l9.75"></a><span id="l9.75">     nsresult SendDataResponse();</span>
<a href="#l9.76"></a><span id="l9.76">     void     SendPostData();</span>
<a href="#l9.77"></a><span id="l9.77">     nsresult SendMessageResponse();</span>
<a href="#l9.78"></a><span id="l9.78">     nsresult ProcessAuth();</span>
<a href="#l9.79"></a><span id="l9.79"> </span>
<a href="#l9.80"></a><span id="l9.80"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -289,16 +289,42 @@ nsSmtpServer::SetUsername(const nsACStri</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5">   // If the pref value is already empty, ClearUserPref will return</span>
<a href="#l10.6"></a><span id="l10.6">   // NS_ERROR_UNEXPECTED, so don't check the rv here.</span>
<a href="#l10.7"></a><span id="l10.7">   mPrefBranch-&gt;ClearUserPref(&quot;username&quot;);</span>
<a href="#l10.8"></a><span id="l10.8">   return NS_OK;</span>
<a href="#l10.9"></a><span id="l10.9"> }</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11"> NS_IMETHODIMP</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+nsSmtpServer::GetClientid(nsACString &amp;aClientid)</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+{</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+  nsresult rv;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+  rv = mPrefBranch-&gt;GetCharPref(&quot;clientid&quot;, aClientid);</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+  {</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+    rv = mDefPrefBranch-&gt;GetCharPref(&quot;clientid&quot;, aClientid);</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+    if (NS_FAILED(rv))</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+      aClientid.Truncate();</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+  }</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+  return NS_OK;</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+}</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+nsSmtpServer::SetClientid(const nsACString &amp;aClientid)</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+{</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+  if (!aClientid.IsEmpty())</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+    return mPrefBranch-&gt;SetCharPref(&quot;clientid&quot;, aClientid);</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+  // If the pref value is already empty, ClearUserPref will return</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+  // NS_ERROR_UNEXPECTED, so don't check the rv here.</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+  mPrefBranch-&gt;ClearUserPref(&quot;clientid&quot;);</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+  return NS_OK;</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+}</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l10.38"></a><span id="l10.38"> nsSmtpServer::GetPassword(nsAString&amp; aPassword)</span>
<a href="#l10.39"></a><span id="l10.39"> {</span>
<a href="#l10.40"></a><span id="l10.40">     if (m_password.IsEmpty() &amp;&amp; !m_logonFailed)</span>
<a href="#l10.41"></a><span id="l10.41">     {</span>
<a href="#l10.42"></a><span id="l10.42">       // try to avoid prompting the user for another password. If the user has set</span>
<a href="#l10.43"></a><span id="l10.43">       // the appropriate pref, we'll use the password from an incoming server, if</span>
<a href="#l10.44"></a><span id="l10.44">       // the user has already logged onto that server.</span>
<a href="#l10.45"></a><span id="l10.45"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/imap/src/nsImapCore.h</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapCore.h</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -138,16 +138,17 @@ const eIMAPCapabilityFlag kHasCompressDe</span>
<a href="#l11.4"></a><span id="l11.4"> const eIMAPCapabilityFlag kHasAuthExternalCapability =    0x20000000;  /* RFC 2222 SASL AUTH EXTERNAL */</span>
<a href="#l11.5"></a><span id="l11.5"> const eIMAPCapabilityFlag kHasMoveCapability =            0x40000000;  /* Proposed MOVE RFC */</span>
<a href="#l11.6"></a><span id="l11.6"> const eIMAPCapabilityFlag kHasHighestModSeqCapability =   0x80000000;  /* Subset of RFC 3551 */</span>
<a href="#l11.7"></a><span id="l11.7"> // above are 32bit; below start the uint64_t bits 33-64</span>
<a href="#l11.8"></a><span id="l11.8"> const eIMAPCapabilityFlag kHasListExtendedCapability =    0x100000000LL;  /* RFC 5258 */</span>
<a href="#l11.9"></a><span id="l11.9"> const eIMAPCapabilityFlag kHasSpecialUseCapability =      0x200000000LL;  /* RFC 6154: Sent, Draft etc. folders */</span>
<a href="#l11.10"></a><span id="l11.10"> const eIMAPCapabilityFlag kGmailImapCapability =          0x400000000LL;  /* X-GM-EXT-1 capability extension for gmail */</span>
<a href="#l11.11"></a><span id="l11.11"> const eIMAPCapabilityFlag kHasXOAuth2Capability =         0x800000000LL;  /* AUTH XOAUTH2 extension */</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+const eIMAPCapabilityFlag kHasClientIDCapability =        0x1000000000LL; /* ClientID capability */</span>
<a href="#l11.13"></a><span id="l11.13"> </span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15"> // this used to be part of the connection object class - maybe we should move it into</span>
<a href="#l11.16"></a><span id="l11.16"> // something similar</span>
<a href="#l11.17"></a><span id="l11.17"> typedef enum {</span>
<a href="#l11.18"></a><span id="l11.18">     kEveryThingRFC822,</span>
<a href="#l11.19"></a><span id="l11.19">     kEveryThingRFC822Peek,</span>
<a href="#l11.20"></a><span id="l11.20">     kHeadersRFC822andUid,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -870,16 +870,18 @@ nsresult nsImapProtocol::SetupWithUrl(ns</span>
<a href="#l12.4"></a><span id="l12.4">                               &amp;preferPlainText);</span>
<a href="#l12.5"></a><span id="l12.5">       // If the pref has changed since the last time we ran a url,</span>
<a href="#l12.6"></a><span id="l12.6">       // clear the shell cache for this host.</span>
<a href="#l12.7"></a><span id="l12.7">       if (preferPlainText != m_preferPlainText) {</span>
<a href="#l12.8"></a><span id="l12.8">         m_hostSessionList-&gt;ClearShellCacheForHost(GetImapServerKey());</span>
<a href="#l12.9"></a><span id="l12.9">         m_preferPlainText = preferPlainText;</span>
<a href="#l12.10"></a><span id="l12.10">       }</span>
<a href="#l12.11"></a><span id="l12.11">     }</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+    // Retrieve the clientid so that we can use it later.</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    server-&gt;GetClientid(m_clientId);</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15">     bool proxyCallback = false;</span>
<a href="#l12.16"></a><span id="l12.16">     if (m_runningUrl &amp;&amp; !m_transport /* and we don't have a transport yet */) {</span>
<a href="#l12.17"></a><span id="l12.17">       if (m_mockChannel) {</span>
<a href="#l12.18"></a><span id="l12.18">         rv = MsgExamineForProxyAsync(m_mockChannel, this,</span>
<a href="#l12.19"></a><span id="l12.19">                                      getter_AddRefs(m_proxyRequest));</span>
<a href="#l12.20"></a><span id="l12.20">         if (NS_FAILED(rv)) {</span>
<a href="#l12.21"></a><span id="l12.21">           rv = SetupWithUrlCallback(nullptr);</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -5568,16 +5570,30 @@ nsresult nsImapProtocol::SendDataParseIM</span>
<a href="#l12.23"></a><span id="l12.23">       break;</span>
<a href="#l12.24"></a><span id="l12.24">     }</span>
<a href="#l12.25"></a><span id="l12.25">     isResend = true;</span>
<a href="#l12.26"></a><span id="l12.26">   }</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">   return rv;</span>
<a href="#l12.29"></a><span id="l12.29"> }</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+nsresult nsImapProtocol::ClientID() {</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+  IncrementCommandTagNumber();</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+  nsCString command(GetServerCommandTag());</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+  command += &quot; CLIENTID TB-UUID &quot;;</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+  command += m_clientId;</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+  command += CRLF;</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+  nsresult rv = SendDataParseIMAPandCheckForNewMail(command.get(), nullptr);</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+  if (!GetServerStateParser().LastCommandSuccessful()) {</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+    return NS_ERROR_FAILURE;</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+  }</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+  return NS_OK;</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+}</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+</span>
<a href="#l12.45"></a><span id="l12.45"> nsresult nsImapProtocol::AuthLogin(const char *userName,</span>
<a href="#l12.46"></a><span id="l12.46">                                    const nsString &amp;aPassword,</span>
<a href="#l12.47"></a><span id="l12.47">                                    eIMAPCapabilityFlag flag) {</span>
<a href="#l12.48"></a><span id="l12.48">   ProgressEventFunctionUsingName(&quot;imapStatusSendingAuthLogin&quot;);</span>
<a href="#l12.49"></a><span id="l12.49">   IncrementCommandTagNumber();</span>
<a href="#l12.50"></a><span id="l12.50"> </span>
<a href="#l12.51"></a><span id="l12.51">   char *currentCommand = nullptr;</span>
<a href="#l12.52"></a><span id="l12.52">   nsresult rv;</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineat">@@ -8130,16 +8146,34 @@ bool nsImapProtocol::TryToLogon() {</span>
<a href="#l12.54"></a><span id="l12.54">         MOZ_LOG(IMAP, LogLevel::Error,</span>
<a href="#l12.55"></a><span id="l12.55">                 (&quot;huch? there are auth methods, and we reset failed ones, but &quot;</span>
<a href="#l12.56"></a><span id="l12.56">                  &quot;ChooseAuthMethod still fails.&quot;));</span>
<a href="#l12.57"></a><span id="l12.57">         return false;</span>
<a href="#l12.58"></a><span id="l12.58">       }</span>
<a href="#l12.59"></a><span id="l12.59">     }</span>
<a href="#l12.60"></a><span id="l12.60">   }</span>
<a href="#l12.61"></a><span id="l12.61"> </span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+  // Before running the ClientID command we check for clientid</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+  // support by checking the server capability flags for the</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineplus">+  // flag kHasClientIDCapability.</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+  // We also check that the m_clientId string is not empty,</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineplus">+  // and we also ensure tls/ssl is running by checking if</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+  // m_connectionType contains &quot;starttls&quot; or &quot;ssl&quot;.</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+  if ((GetServerStateParser().GetCapabilityFlag() &amp; kHasClientIDCapability) &amp;&amp;</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+      !m_clientId.IsEmpty() &amp;&amp;</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+      (m_connectionType.EqualsLiteral(&quot;starttls&quot;) ||</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+       m_connectionType.EqualsLiteral(&quot;ssl&quot;))) {</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+    rv = ClientID();</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+    if (NS_FAILED(rv)) {</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineplus">+      MOZ_LOG(IMAP, LogLevel::Error,</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineplus">+              (&quot;TryToLogon: Could not issue CLIENTID command&quot;));</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineplus">+      skipLoop = true;</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineplus">+    }</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineplus">+  }</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineplus">+</span>
<a href="#l12.80"></a><span id="l12.80">   // Get username, either the stored one or from user</span>
<a href="#l12.81"></a><span id="l12.81">   rv = m_imapServerSink-&gt;GetLoginUsername(userName);</span>
<a href="#l12.82"></a><span id="l12.82">   if (NS_FAILED(rv) || userName.IsEmpty()) {</span>
<a href="#l12.83"></a><span id="l12.83">     // The user hit &quot;Cancel&quot; on the dialog box</span>
<a href="#l12.84"></a><span id="l12.84">     skipLoop = true;</span>
<a href="#l12.85"></a><span id="l12.85">   }</span>
<a href="#l12.86"></a><span id="l12.86"> </span>
<a href="#l12.87"></a><span id="l12.87">   // clang-format off</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -532,16 +532,17 @@ class nsImapProtocol : public nsIImapPro</span>
<a href="#l13.4"></a><span id="l13.4">   void Capability();  // query host for capabilities.</span>
<a href="#l13.5"></a><span id="l13.5">   void ID();          // send RFC 2971 app info to server</span>
<a href="#l13.6"></a><span id="l13.6">   void EnableCondStore();</span>
<a href="#l13.7"></a><span id="l13.7">   void StartCompressDeflate();</span>
<a href="#l13.8"></a><span id="l13.8">   nsresult BeginCompressing();</span>
<a href="#l13.9"></a><span id="l13.9">   void Language();  // set the language on the server if it supports it</span>
<a href="#l13.10"></a><span id="l13.10">   void Namespace();</span>
<a href="#l13.11"></a><span id="l13.11">   void InsecureLogin(const char *userName, const nsCString &amp;password);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+  nsresult ClientID();</span>
<a href="#l13.13"></a><span id="l13.13">   nsresult AuthLogin(const char *userName, const nsString &amp;password,</span>
<a href="#l13.14"></a><span id="l13.14">                      eIMAPCapabilityFlag flag);</span>
<a href="#l13.15"></a><span id="l13.15">   nsresult SendDataParseIMAPandCheckForNewMail(const char *data,</span>
<a href="#l13.16"></a><span id="l13.16">                                                const char *command);</span>
<a href="#l13.17"></a><span id="l13.17">   void ProcessAuthenticatedStateURL();</span>
<a href="#l13.18"></a><span id="l13.18">   void ProcessAfterAuthenticated();</span>
<a href="#l13.19"></a><span id="l13.19">   void ProcessSelectedStateURL();</span>
<a href="#l13.20"></a><span id="l13.20">   bool TryToLogon();</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineat">@@ -678,16 +679,18 @@ class nsImapProtocol : public nsIImapPro</span>
<a href="#l13.22"></a><span id="l13.22">   nsDataHashtable&lt;nsCStringHashKey, int32_t&gt; m_specialXListMailboxes;</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24">   nsCOMPtr&lt;nsIImapHostSessionList&gt; m_hostSessionList;</span>
<a href="#l13.25"></a><span id="l13.25"> </span>
<a href="#l13.26"></a><span id="l13.26">   bool m_fromHeaderSeen;</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28">   nsString mAcceptLanguages;</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+  nsCString m_clientId;</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+</span>
<a href="#l13.32"></a><span id="l13.32">   // progress stuff</span>
<a href="#l13.33"></a><span id="l13.33">   void SetProgressString(uint32_t aStringIndex);</span>
<a href="#l13.34"></a><span id="l13.34"> </span>
<a href="#l13.35"></a><span id="l13.35">   nsCString m_progressStringName;</span>
<a href="#l13.36"></a><span id="l13.36">   uint32_t m_stringIndex;</span>
<a href="#l13.37"></a><span id="l13.37">   int32_t m_progressCurrentNumber[IMAP_NUMBER_OF_PROGRESS_STRINGS];</span>
<a href="#l13.38"></a><span id="l13.38">   int32_t m_progressExpectedNumber;</span>
<a href="#l13.39"></a><span id="l13.39">   nsCString m_lastProgressStringName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -2019,16 +2019,18 @@ void nsImapServerResponseParser::capabil</span>
<a href="#l14.4"></a><span id="l14.4">       else if (token.Equals(&quot;COMPRESS=DEFLATE&quot;,</span>
<a href="#l14.5"></a><span id="l14.5">                             nsCaseInsensitiveCStringComparator()))</span>
<a href="#l14.6"></a><span id="l14.6">         fCapabilityFlag |= kHasCompressDeflateCapability;</span>
<a href="#l14.7"></a><span id="l14.7">       else if (token.Equals(&quot;MOVE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l14.8"></a><span id="l14.8">         fCapabilityFlag |= kHasMoveCapability;</span>
<a href="#l14.9"></a><span id="l14.9">       else if (token.Equals(&quot;HIGHESTMODSEQ&quot;,</span>
<a href="#l14.10"></a><span id="l14.10">                             nsCaseInsensitiveCStringComparator()))</span>
<a href="#l14.11"></a><span id="l14.11">         fCapabilityFlag |= kHasHighestModSeqCapability;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+      else if (token.Equals(&quot;CLIENTID&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+        fCapabilityFlag |= kHasClientIDCapability;</span>
<a href="#l14.14"></a><span id="l14.14">     }</span>
<a href="#l14.15"></a><span id="l14.15">   } while (fNextToken &amp;&amp; endToken &lt; 0 &amp;&amp; !fAtEndOfLine &amp;&amp; ContinueParse());</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">   nsImapProtocol *navCon = &amp;fServerConnection;</span>
<a href="#l14.18"></a><span id="l14.18">   NS_ASSERTION(navCon,</span>
<a href="#l14.19"></a><span id="l14.19">                &quot;null imap protocol connection while parsing capability &quot;</span>
<a href="#l14.20"></a><span id="l14.20">                &quot;response&quot;);  // we should always have this</span>
<a href="#l14.21"></a><span id="l14.21">   if (navCon) navCon-&gt;CommitCapability();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/mailnews.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/mailnews.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -450,16 +450,19 @@ pref(&quot;mail.collect_email_address_incomin</span>
<a href="#l15.4"></a><span id="l15.4"> pref(&quot;mail.collect_email_address_newsgroup&quot;, false);</span>
<a href="#l15.5"></a><span id="l15.5"> #endif</span>
<a href="#l15.6"></a><span id="l15.6"> pref(&quot;mail.collect_email_address_outgoing&quot;, true);</span>
<a href="#l15.7"></a><span id="l15.7"> // by default, use the Collected Addressbook for collection</span>
<a href="#l15.8"></a><span id="l15.8"> pref(&quot;mail.collect_addressbook&quot;, &quot;moz-abmdbdirectory://history.mab&quot;);</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10"> pref(&quot;mail.default_sendlater_uri&quot;, &quot;mailbox://nobody@Local%20Folders/Unsent%20Messages&quot;);</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+pref(&quot;mail.server.default.clientid&quot;, &quot;&quot;);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+pref(&quot;mail.smtpserver.default.clientid&quot;, &quot;&quot;);</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+</span>
<a href="#l15.15"></a><span id="l15.15"> pref(&quot;mail.smtpservers&quot;, &quot;&quot;);</span>
<a href="#l15.16"></a><span id="l15.16"> pref(&quot;mail.accountmanager.accounts&quot;, &quot;&quot;);</span>
<a href="#l15.17"></a><span id="l15.17"> </span>
<a href="#l15.18"></a><span id="l15.18"> // Last used account key value</span>
<a href="#l15.19"></a><span id="l15.19"> pref(&quot;mail.account.lastKey&quot;, 0);</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21"> pref(&quot;mail.server.default.port&quot;, -1);</span>
<a href="#l15.22"></a><span id="l15.22"> pref(&quot;mail.server.default.offline_support_level&quot;, -1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -68,16 +68,22 @@ startTlsFailed=An error occurred while s</span>
<a href="#l16.4"></a><span id="l16.4"> smtpPasswordUndefined=An error occurred while sending mail: Could not get password for %S. The message was not sent.</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> ## LOCALIZATION NOTE (smtpSendNotAllowed): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l16.7"></a><span id="l16.7"> smtpSendNotAllowed=An error occurred while sending mail. The mail server responded:\n%s.\nPlease ensure that you are using the correct identity to send and that the used authentication method is correct. Verify that you are allowed to send via this SMTP server with your current credentials from your current network.</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9"> ## LOCALIZATION NOTE (smtpTempSizeExceeded): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l16.10"></a><span id="l16.10"> smtpTempSizeExceeded=The size of the message you are trying to send exceeds a temporary size limit of the server. The message was not sent; try to reduce the message size or wait some time and try again. The server responded:  %s.</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+## LOCALIZATION NOTE (smtpClientid): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+smtpClientid=The outgoing server (SMTP) detected an error in the CLIENTID command. The message was not sent. The server responded: %s</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+## LOCALIZATION NOTE (smtpClientidPermission): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+smtpClientidPermission=The outgoing server (SMTP) response to the CLIENTID command indicates that your device is not permitted to send mail. The server responded: %s</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+</span>
<a href="#l16.18"></a><span id="l16.18"> ## LOCALIZATION NOTE (smtpPermSizeExceeded1): argument %d is the Outgoing server (SMTP) size limit</span>
<a href="#l16.19"></a><span id="l16.19"> smtpPermSizeExceeded1=The size of the message you are trying to send exceeds the global size limit (%d bytes) of the server. The message was not sent; reduce the message size and try again.</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21"> ## LOCALIZATION NOTE (smtpPermSizeExceeded2): argument %s is the server's response</span>
<a href="#l16.22"></a><span id="l16.22"> smtpPermSizeExceeded2=The size of the message you are trying to send exceeds the global size limit of the server. The message was not sent; reduce the message size and try again. The server responded:  %s.</span>
<a href="#l16.23"></a><span id="l16.23"> </span>
<a href="#l16.24"></a><span id="l16.24"> ## LOCALIZATION NOTE (smtpSendFailedUnknownServer): argument %S is the Outgoing server (SMTP)</span>
<a href="#l16.25"></a><span id="l16.25"> smtpSendFailedUnknownServer=An error occurred while sending mail: Outgoing server (SMTP) %S is unknown. The server may be incorrectly configured. Please verify that your Outgoing server (SMTP) settings are correct and try again.</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

