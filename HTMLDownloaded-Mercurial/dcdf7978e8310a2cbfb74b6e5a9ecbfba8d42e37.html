<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27959:dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37" />
<meta property="og:url" content="/comm-central/rev/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37" />
<meta property="og:description" content="Bug 1588876 - Part 1: Use Services obs and prefs if possible in SeaMonkey. r=IanN" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37">shortlog</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37">files</a> |
changeset |
<a href="/comm-central/raw-rev/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37">raw</a>  | <a href="/comm-central/archive/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1588876">Bug 1588876</a> - Part 1: Use Services obs and prefs if possible in SeaMonkey. r=IanN
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#114;&#97;&#110;&#107;&#45;&#82;&#97;&#105;&#110;&#101;&#114;&#32;&#71;&#114;&#97;&#104;&#108;&#32;&#60;&#102;&#114;&#103;&#114;&#97;&#104;&#108;&#64;&#103;&#109;&#120;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 20 Oct 2019 17:40:58 +0200</td></tr>

<tr>
 <td>changeset 27959</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37">dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37</a></td>
</tr>



<tr>
<td>parent 27958</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/01dcc0cc8f07406220436186fd13c22d56380916">01dcc0cc8f07406220436186fd13c22d56380916</a>
</td>
</tr>

<tr>
<td>child 27960</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b7054ece21742ae4ae0f6e85aff2ff7eb02c5b4f">b7054ece21742ae4ae0f6e85aff2ff7eb02c5b4f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37">16580</a></td></tr>
<tr><td>push user</td><td>frgrahl@gmx.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 20 Oct 2019 15:42:12 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@6bd51ba5b088 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6bd51ba5b088386e8b2b02cf7246949e47d017a2">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&newProject=comm-central&newRevision=2abc5e2495fc83ffa438def667bac604c4b8be22&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&newProject=comm-central&newRevision=2abc5e2495fc83ffa438def667bac604c4b8be22&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&newProject=comm-central&newRevision=2abc5e2495fc83ffa438def667bac604c4b8be22&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28IanN%29&revcount=50">IanN</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1588876">1588876</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1588876">Bug 1588876</a> - Part 1: Use Services obs and prefs if possible in SeaMonkey. r=IanN</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/nsTypeAheadFind.js">suite/browser/nsTypeAheadFind.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/nsTypeAheadFind.js">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/nsTypeAheadFind.js">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/nsTypeAheadFind.js">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/nsTypeAheadFind.js">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/nsTypeAheadFind.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/tabbrowser.xml">suite/browser/tabbrowser.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/tabbrowser.xml">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/tabbrowser.xml">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/tabbrowser.xml">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/tabbrowser.xml">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/browser/tabbrowser.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/bindings/notification.xml">suite/components/bindings/notification.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/bindings/notification.xml">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/bindings/notification.xml">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/bindings/notification.xml">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/bindings/notification.xml">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/bindings/notification.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_basic_functionality.xul">suite/components/downloads/tests/chrome/test_basic_functionality.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_basic_functionality.xul">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_basic_functionality.xul">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_basic_functionality.xul">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_basic_functionality.xul">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_basic_functionality.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">suite/components/downloads/tests/chrome/test_delete_key_cancels.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">suite/components/downloads/tests/chrome/test_delete_key_removes.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_drag.xul">suite/components/downloads/tests/chrome/test_drag.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_drag.xul">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_drag.xul">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_drag.xul">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_drag.xul">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_drag.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_search_keys.xul">suite/components/downloads/tests/chrome/test_search_keys.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_search_keys.xul">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_search_keys.xul">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_search_keys.xul">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_search_keys.xul">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_search_keys.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_retries.xul">suite/components/downloads/tests/chrome/test_space_key_retries.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_retries.xul">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_retries.xul">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_retries.xul">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_retries.xul">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_space_key_retries.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_ui_stays_open_on_alert_clickback.xul">suite/components/downloads/tests/chrome/test_ui_stays_open_on_alert_clickback.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_ui_stays_open_on_alert_clickback.xul">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_ui_stays_open_on_alert_clickback.xul">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_ui_stays_open_on_alert_clickback.xul">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_ui_stays_open_on_alert_clickback.xul">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/downloads/tests/chrome/test_ui_stays_open_on_alert_clickback.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/nsPlacesAutoComplete.js">suite/components/places/nsPlacesAutoComplete.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/nsPlacesAutoComplete.js">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/nsPlacesAutoComplete.js">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/nsPlacesAutoComplete.js">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/nsPlacesAutoComplete.js">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/nsPlacesAutoComplete.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_prefs.js">suite/components/places/tests/unit/test_browserGlue_prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_prefs.js">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_prefs.js">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_prefs.js">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_prefs.js">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_prefs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_shutdown.js">suite/components/places/tests/unit/test_browserGlue_shutdown.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_shutdown.js">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_shutdown.js">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_shutdown.js">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_shutdown.js">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/components/places/tests/unit/test_browserGlue_shutdown.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/modules/Sanitizer.jsm">suite/modules/Sanitizer.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/modules/Sanitizer.jsm">file</a> |
<a href="/comm-central/annotate/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/modules/Sanitizer.jsm">annotate</a> |
<a href="/comm-central/diff/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/modules/Sanitizer.jsm">diff</a> |
<a href="/comm-central/comparison/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/modules/Sanitizer.jsm">comparison</a> |
<a href="/comm-central/log/dcdf7978e8310a2cbfb74b6e5a9ecbfba8d42e37/suite/modules/Sanitizer.jsm">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/browser/nsTypeAheadFind.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/browser/nsTypeAheadFind.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -76,19 +76,17 @@ typeAheadFind.prototype = {</span>
<a href="#l1.4"></a><span id="l1.4">   /* nsIObserver */</span>
<a href="#l1.5"></a><span id="l1.5">   observe: function(aSubject, aTopic, aData) {</span>
<a href="#l1.6"></a><span id="l1.6">     if (aTopic == &quot;app-startup&quot;) {</span>
<a href="#l1.7"></a><span id="l1.7">       // It's now safe to get our pref branch.</span>
<a href="#l1.8"></a><span id="l1.8">       this.mPrefs = Services.prefs.getBranch(&quot;accessibility.typeaheadfind.&quot;);</span>
<a href="#l1.9"></a><span id="l1.9">       // We need to add our event listeners to all windows.</span>
<a href="#l1.10"></a><span id="l1.10">       Services.ww.registerNotification(this);</span>
<a href="#l1.11"></a><span id="l1.11">       // We also need to listen for find again commands</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-        .getService(Ci.nsIObserverService)</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-        .addObserver(this, &quot;nsWebBrowserFind_FindAgain&quot;, true);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+      Services.obs.addObserver(this, &quot;nsWebBrowserFind_FindAgain&quot;, true);</span>
<a href="#l1.16"></a><span id="l1.16">     }</span>
<a href="#l1.17"></a><span id="l1.17">     if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l1.18"></a><span id="l1.18">       // Add our listeners. They get automatically removed on window teardown.</span>
<a href="#l1.19"></a><span id="l1.19">       aSubject.controllers.appendController(new findTypeController(this, aSubject));</span>
<a href="#l1.20"></a><span id="l1.20">       Cc[&quot;@mozilla.org/eventlistenerservice;1&quot;]</span>
<a href="#l1.21"></a><span id="l1.21">         .getService(Ci.nsIEventListenerService)</span>
<a href="#l1.22"></a><span id="l1.22">         .addSystemEventListener(aSubject, &quot;keypress&quot;, this, false);</span>
<a href="#l1.23"></a><span id="l1.23">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/browser/tabbrowser.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/browser/tabbrowser.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -3096,19 +3096,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">           t.style.maxWidth = Services.prefs.getIntPref(&quot;browser.tabs.tabMaxWidth&quot;) + &quot;px&quot;;</span>
<a href="#l2.5"></a><span id="l2.5">           t.style.minWidth = Services.prefs.getIntPref(&quot;browser.tabs.tabMinWidth&quot;) + &quot;px&quot;;</span>
<a href="#l2.6"></a><span id="l2.6">           t.width = 0;</span>
<a href="#l2.7"></a><span id="l2.7">           t.flex = 100;</span>
<a href="#l2.8"></a><span id="l2.8">           t.setAttribute(&quot;validate&quot;, &quot;never&quot;);</span>
<a href="#l2.9"></a><span id="l2.9">           t.setAttribute(&quot;onerror&quot;, &quot;this.parentNode.parentNode.parentNode.parentNode.addToMissedIconCache(this.getAttribute('image')); this.removeAttribute('image');&quot;);</span>
<a href="#l2.10"></a><span id="l2.10">           this.referenceTab = t;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-          var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-                     .getService(Ci.nsIObserverService);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-          os.addObserver(this, &quot;browser:purge-session-history&quot;);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+          Services.obs.addObserver(this, &quot;browser:purge-session-history&quot;);</span>
<a href="#l2.16"></a><span id="l2.16">           Services.prefs.addObserver(&quot;browser.tabs.max_tabs_undo&quot;, this);</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18">           var onclick = this.getAttribute(&quot;oncontentclick&quot;);</span>
<a href="#l2.19"></a><span id="l2.19">           if (onclick)</span>
<a href="#l2.20"></a><span id="l2.20">             this.onContentClick = new Function(&quot;event&quot;, onclick);</span>
<a href="#l2.21"></a><span id="l2.21">         ]]&gt;</span>
<a href="#l2.22"></a><span id="l2.22">       &lt;/constructor&gt;</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24" class="difflineat">@@ -3122,19 +3120,17 @@</span>
<a href="#l2.25"></a><span id="l2.25">           for (var i = 0; i &lt; this.mTabListeners.length; ++i) {</span>
<a href="#l2.26"></a><span id="l2.26">             this.browsers[i].webProgress.removeProgressListener(this.mTabFilters[i]);</span>
<a href="#l2.27"></a><span id="l2.27">             this.mTabFilters[i].removeProgressListener(this.mTabListeners[i]);</span>
<a href="#l2.28"></a><span id="l2.28">             this.mTabFilters[i] = null;</span>
<a href="#l2.29"></a><span id="l2.29">             this.mTabListeners[i] = null;</span>
<a href="#l2.30"></a><span id="l2.30">             // eventListeners are removed from the browsers in display order of the browsers</span>
<a href="#l2.31"></a><span id="l2.31">             this.browsers[i].removeEventListener(&quot;DOMTitleChanged&quot;, this.onTitleChanged, true);</span>
<a href="#l2.32"></a><span id="l2.32">           }</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-          var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-                     .getService(Ci.nsIObserverService);</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-          os.removeObserver(this, &quot;browser:purge-session-history&quot;);</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+          Services.obs.removeObserver(this, &quot;browser:purge-session-history&quot;);</span>
<a href="#l2.37"></a><span id="l2.37">           Services.prefs.removeObserver(&quot;browser.tabs.max_tabs_undo&quot;, this);</span>
<a href="#l2.38"></a><span id="l2.38">           this.savedBrowsers.forEach(function(aTabData) {</span>
<a href="#l2.39"></a><span id="l2.39">             delete aTabData.browserData;</span>
<a href="#l2.40"></a><span id="l2.40">           });</span>
<a href="#l2.41"></a><span id="l2.41">         ]]&gt;</span>
<a href="#l2.42"></a><span id="l2.42">       &lt;/destructor&gt;</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44">       &lt;!-- Deprecated stuff, implemented for backwards compatibility. --&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/components/bindings/notification.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/components/bindings/notification.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -36,23 +36,16 @@</span>
<a href="#l3.4"></a><span id="l3.4">       &lt;/field&gt;</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">       &lt;field name=&quot;_placesBundle&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l3.7"></a><span id="l3.7">         &lt;![CDATA[</span>
<a href="#l3.8"></a><span id="l3.8">          Services.strings.createBundle(&quot;chrome://communicator/locale/places/places.properties&quot;);</span>
<a href="#l3.9"></a><span id="l3.9">         ]]&gt;</span>
<a href="#l3.10"></a><span id="l3.10">       &lt;/field&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-      &lt;field name=&quot;_prefs&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-          Cc[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-            .getService(Ci.nsIPrefBranch);</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-        ]]&gt;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-</span>
<a href="#l3.19"></a><span id="l3.19">       &lt;field name=&quot;_urlFormatter&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l3.20"></a><span id="l3.20">         &lt;![CDATA[</span>
<a href="#l3.21"></a><span id="l3.21">           Cc[&quot;@mozilla.org/toolkit/URLFormatterService;1&quot;]</span>
<a href="#l3.22"></a><span id="l3.22">             .getService(Ci.nsIURLFormatter);</span>
<a href="#l3.23"></a><span id="l3.23">         ]]&gt;</span>
<a href="#l3.24"></a><span id="l3.24">       &lt;/field&gt;</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">       &lt;field name=&quot;wrappedJSObject&quot;&gt;this&lt;/field&gt;</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineat">@@ -147,22 +140,22 @@</span>
<a href="#l3.28"></a><span id="l3.28">               priority = this.PRIORITY_INFO_LOW;</span>
<a href="#l3.29"></a><span id="l3.29">             } else if (aState &amp; nsIWebProgressListener.STATE_IS_BROKEN) {</span>
<a href="#l3.30"></a><span id="l3.30">               pref = &quot;security.warn_viewing_mixed&quot;;</span>
<a href="#l3.31"></a><span id="l3.31">               message = &quot;MixedContentMessage&quot;;</span>
<a href="#l3.32"></a><span id="l3.32">               priority = this.PRIORITY_CRITICAL_LOW;</span>
<a href="#l3.33"></a><span id="l3.33">             }</span>
<a href="#l3.34"></a><span id="l3.34"> </span>
<a href="#l3.35"></a><span id="l3.35">             if (aState &amp; nsIWebProgressListener.STATE_LOADED_MIXED_ACTIVE_CONTENT &amp;&amp;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-                this._prefs.getBoolPref(&quot;security.warn_mixed_active_content&quot;)) {</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+                Services.prefs.getBoolPref(&quot;security.warn_mixed_active_content&quot;)) {</span>
<a href="#l3.38"></a><span id="l3.38">               pref = &quot;security.warn_mixed_active_content&quot;;</span>
<a href="#l3.39"></a><span id="l3.39">               message = &quot;MixedActiveContentMessage&quot;;</span>
<a href="#l3.40"></a><span id="l3.40">               priority = this.PRIORITY_CRITICAL_LOW;</span>
<a href="#l3.41"></a><span id="l3.41">             } else if (aState &amp; nsIWebProgressListener.STATE_BLOCKED_MIXED_ACTIVE_CONTENT &amp;&amp;</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-                this._prefs.getBoolPref(&quot;security.warn_mixed_active_content&quot;)) {</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+                Services.prefs.getBoolPref(&quot;security.warn_mixed_active_content&quot;)) {</span>
<a href="#l3.44"></a><span id="l3.44">               pref = &quot;security.warn_mixed_active_content&quot;;</span>
<a href="#l3.45"></a><span id="l3.45">               message = &quot;BlockedActiveContentMessage&quot;;</span>
<a href="#l3.46"></a><span id="l3.46">               priority = this.PRIORITY_INFO_LOW;</span>
<a href="#l3.47"></a><span id="l3.47">               this.lastState = aState &amp; ~nsIWebProgressListener.STATE_BLOCKED_MIXED_ACTIVE_CONTENT;</span>
<a href="#l3.48"></a><span id="l3.48">               const nsIWebNavigation = Ci.nsIWebNavigation;</span>
<a href="#l3.49"></a><span id="l3.49">               buttons = [{</span>
<a href="#l3.50"></a><span id="l3.50">                 label: this._stringBundle.GetStringFromName(&quot;SecurityKeepBlocking.label&quot;),</span>
<a href="#l3.51"></a><span id="l3.51">                 accessKey: this._stringBundle.GetStringFromName(&quot;SecurityKeepBlocking.accesskey&quot;),</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineat">@@ -170,23 +163,23 @@</span>
<a href="#l3.53"></a><span id="l3.53">               }, {</span>
<a href="#l3.54"></a><span id="l3.54">                 label: this._stringBundle.GetStringFromName(&quot;SecurityUnblock.label&quot;),</span>
<a href="#l3.55"></a><span id="l3.55">                 accessKey: this._stringBundle.GetStringFromName(&quot;SecurityUnblock.accesskey&quot;),</span>
<a href="#l3.56"></a><span id="l3.56">                 callback: this.reloadPage.bind(this,</span>
<a href="#l3.57"></a><span id="l3.57">                               nsIWebNavigation.LOAD_FLAGS_ALLOW_MIXED_CONTENT |</span>
<a href="#l3.58"></a><span id="l3.58">                               nsIWebNavigation.LOAD_FLAGS_BYPASS_CACHE)</span>
<a href="#l3.59"></a><span id="l3.59">               }];</span>
<a href="#l3.60"></a><span id="l3.60">             } else if (aState &amp; nsIWebProgressListener.STATE_LOADED_TRACKING_CONTENT &amp;&amp;</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-                this._prefs.getBoolPref(&quot;privacy.warn_tracking_content&quot;)) {</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+                Services.prefs.getBoolPref(&quot;privacy.warn_tracking_content&quot;)) {</span>
<a href="#l3.63"></a><span id="l3.63">               pref = &quot;privacy.warn_tracking_content&quot;;</span>
<a href="#l3.64"></a><span id="l3.64">               message = &quot;TrackingContentMessage&quot;;</span>
<a href="#l3.65"></a><span id="l3.65">               priority = this.PRIORITY_WARNING_LOW;</span>
<a href="#l3.66"></a><span id="l3.66">               pane = &quot;security_pane&quot;;</span>
<a href="#l3.67"></a><span id="l3.67">             } else if (aState &amp; nsIWebProgressListener.STATE_BLOCKED_TRACKING_CONTENT &amp;&amp;</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-                this._prefs.getBoolPref(&quot;privacy.warn_tracking_content&quot;)) {</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+                Services.prefs.getBoolPref(&quot;privacy.warn_tracking_content&quot;)) {</span>
<a href="#l3.70"></a><span id="l3.70">               pref = &quot;privacy.warn_tracking_content&quot;;</span>
<a href="#l3.71"></a><span id="l3.71">               message = &quot;BlockedTrackingContentMessage&quot;;</span>
<a href="#l3.72"></a><span id="l3.72">               priority = this.PRIORITY_INFO_LOW;</span>
<a href="#l3.73"></a><span id="l3.73">               pane = &quot;security_pane&quot;;</span>
<a href="#l3.74"></a><span id="l3.74">               if (!this.usePrivateBrowsing) {</span>
<a href="#l3.75"></a><span id="l3.75">                 this.lastState = aState &amp; ~nsIWebProgressListener.STATE_BLOCKED_TRACKING_CONTENT;</span>
<a href="#l3.76"></a><span id="l3.76">                 buttons = [{</span>
<a href="#l3.77"></a><span id="l3.77">                   label: this._stringBundle.GetStringFromName(&quot;SecurityKeepBlocking.label&quot;),</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineat">@@ -202,37 +195,37 @@</span>
<a href="#l3.79"></a><span id="l3.79">                       .add(this.activeBrowser.currentURI,</span>
<a href="#l3.80"></a><span id="l3.80">                                    &quot;trackingprotection&quot;,</span>
<a href="#l3.81"></a><span id="l3.81">                                    nsIPermissionManager.ALLOW_ACTION);</span>
<a href="#l3.82"></a><span id="l3.82">                     this.reloadPage();</span>
<a href="#l3.83"></a><span id="l3.83">                   }</span>
<a href="#l3.84"></a><span id="l3.84">                 }];</span>
<a href="#l3.85"></a><span id="l3.85">               }</span>
<a href="#l3.86"></a><span id="l3.86">             } else if (aState &amp; nsIWebProgressListener.STATE_LOADED_MIXED_DISPLAY_CONTENT &amp;&amp;</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-                this._prefs.getBoolPref(&quot;security.warn_mixed_display_content&quot;)) {</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+                Services.prefs.getBoolPref(&quot;security.warn_mixed_display_content&quot;)) {</span>
<a href="#l3.89"></a><span id="l3.89">               pref = &quot;security.warn_mixed_display_content&quot;;</span>
<a href="#l3.90"></a><span id="l3.90">               message = &quot;MixedDisplayContentMessage&quot;;</span>
<a href="#l3.91"></a><span id="l3.91">               priority = this.PRIORITY_WARNING_LOW;</span>
<a href="#l3.92"></a><span id="l3.92">             } else if (aState &amp; nsIWebProgressListener.STATE_BLOCKED_MIXED_DISPLAY_CONTENT &amp;&amp;</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-                this._prefs.getBoolPref(&quot;security.warn_mixed_display_content&quot;)) {</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+                Services.prefs.getBoolPref(&quot;security.warn_mixed_display_content&quot;)) {</span>
<a href="#l3.95"></a><span id="l3.95">               pref = &quot;security.warn_mixed_display_content&quot;;</span>
<a href="#l3.96"></a><span id="l3.96">               message = &quot;BlockedDisplayContentMessage&quot;;</span>
<a href="#l3.97"></a><span id="l3.97">               priority = this.PRIORITY_INFO_LOW;</span>
<a href="#l3.98"></a><span id="l3.98">             }</span>
<a href="#l3.99"></a><span id="l3.99"> </span>
<a href="#l3.100"></a><span id="l3.100">             if (this.lastMessage == message)</span>
<a href="#l3.101"></a><span id="l3.101">               return false;</span>
<a href="#l3.102"></a><span id="l3.102"> </span>
<a href="#l3.103"></a><span id="l3.103">             var box = this.getNotificationWithValue(this.lastMessage);</span>
<a href="#l3.104"></a><span id="l3.104">             if (box)</span>
<a href="#l3.105"></a><span id="l3.105">               box.close();</span>
<a href="#l3.106"></a><span id="l3.106"> </span>
<a href="#l3.107"></a><span id="l3.107">             this.lastMessage = message;</span>
<a href="#l3.108"></a><span id="l3.108"> </span>
<a href="#l3.109"></a><span id="l3.109" class="difflineminus">-            if (!this._prefs.getBoolPref(pref))</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+            if (!Services.prefs.getBoolPref(pref))</span>
<a href="#l3.111"></a><span id="l3.111">               return true;</span>
<a href="#l3.112"></a><span id="l3.112"> </span>
<a href="#l3.113"></a><span id="l3.113">             if (&quot;goPreferences&quot; in window) {</span>
<a href="#l3.114"></a><span id="l3.114">               buttons.push({</span>
<a href="#l3.115"></a><span id="l3.115">                 label: this._stringBundle.GetStringFromName(&quot;SecurityPreferences.label&quot;),</span>
<a href="#l3.116"></a><span id="l3.116">                 accessKey: this._stringBundle.GetStringFromName(&quot;SecurityPreferences.accesskey&quot;),</span>
<a href="#l3.117"></a><span id="l3.117">                 callback: function() {</span>
<a href="#l3.118"></a><span id="l3.118">                   goPreferences(pane);</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineat">@@ -266,17 +259,17 @@</span>
<a href="#l3.120"></a><span id="l3.120"> </span>
<a href="#l3.121"></a><span id="l3.121">       &lt;method name=&quot;onRefreshAttempted&quot;&gt;</span>
<a href="#l3.122"></a><span id="l3.122">         &lt;parameter name=&quot;aWebProgress&quot; /&gt;</span>
<a href="#l3.123"></a><span id="l3.123">         &lt;parameter name=&quot;aURI&quot; /&gt;</span>
<a href="#l3.124"></a><span id="l3.124">         &lt;parameter name=&quot;aDelay&quot; /&gt;</span>
<a href="#l3.125"></a><span id="l3.125">         &lt;parameter name=&quot;aSameURI&quot; /&gt;</span>
<a href="#l3.126"></a><span id="l3.126">         &lt;body&gt;</span>
<a href="#l3.127"></a><span id="l3.127">           &lt;![CDATA[</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineminus">-            if (this._prefs.getBoolPref(&quot;accessibility.blockautorefresh&quot;)) {</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+            if (Services.prefs.getBoolPref(&quot;accessibility.blockautorefresh&quot;)) {</span>
<a href="#l3.130"></a><span id="l3.130">               let brandShortName = this._brandStringBundle.GetStringFromName(&quot;brandShortName&quot;);</span>
<a href="#l3.131"></a><span id="l3.131">               let refreshButtonText =</span>
<a href="#l3.132"></a><span id="l3.132">                 this._stringBundle.GetStringFromName(&quot;refreshBlocked.goButton&quot;);</span>
<a href="#l3.133"></a><span id="l3.133">               let refreshButtonAccesskey =</span>
<a href="#l3.134"></a><span id="l3.134">                 this._stringBundle.GetStringFromName(&quot;refreshBlocked.goButton.accesskey&quot;);</span>
<a href="#l3.135"></a><span id="l3.135">               let message =</span>
<a href="#l3.136"></a><span id="l3.136">                 this._stringBundle.formatStringFromName(aSameURI ? &quot;refreshBlocked.refreshLabel&quot;</span>
<a href="#l3.137"></a><span id="l3.137">                                                                  : &quot;refreshBlocked.redirectLabel&quot;,</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineat">@@ -334,17 +327,17 @@</span>
<a href="#l3.139"></a><span id="l3.139">             if (!browser || !browser.docShell || !browser.docShell.securityUI)</span>
<a href="#l3.140"></a><span id="l3.140">               return;</span>
<a href="#l3.141"></a><span id="l3.141"> </span>
<a href="#l3.142"></a><span id="l3.142">             // not our window:</span>
<a href="#l3.143"></a><span id="l3.143">             if (aWindow.top != browser.contentWindow)</span>
<a href="#l3.144"></a><span id="l3.144">               return;</span>
<a href="#l3.145"></a><span id="l3.145"> </span>
<a href="#l3.146"></a><span id="l3.146">             // pref disabled:</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-            if (!this._prefs.getBoolPref(&quot;security.warn_submit_insecure&quot;))</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+            if (!Services.prefs.getBoolPref(&quot;security.warn_submit_insecure&quot;))</span>
<a href="#l3.149"></a><span id="l3.149">               return;</span>
<a href="#l3.150"></a><span id="l3.150"> </span>
<a href="#l3.151"></a><span id="l3.151">             // HTTPS uninteresting:</span>
<a href="#l3.152"></a><span id="l3.152">             if (aActionURI.schemeIs(&quot;https&quot;))</span>
<a href="#l3.153"></a><span id="l3.153">               return;</span>
<a href="#l3.154"></a><span id="l3.154"> </span>
<a href="#l3.155"></a><span id="l3.155">             // javascript doesn't hit the network:</span>
<a href="#l3.156"></a><span id="l3.156">             if (aActionURI.schemeIs(&quot;javascript&quot;))</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineat">@@ -368,17 +361,17 @@</span>
<a href="#l3.158"></a><span id="l3.158">               this._stringBundle.GetStringFromName(&quot;PostToInsecureFromInsecureMessage&quot;),</span>
<a href="#l3.159"></a><span id="l3.159">               prompt.BUTTON_TITLE_IS_STRING * prompt.BUTTON_POS_0 +</span>
<a href="#l3.160"></a><span id="l3.160">               prompt.BUTTON_TITLE_CANCEL * prompt.BUTTON_POS_1,</span>
<a href="#l3.161"></a><span id="l3.161">               this._stringBundle.GetStringFromName(&quot;PostToInsecureContinue&quot;),</span>
<a href="#l3.162"></a><span id="l3.162">               null, null,</span>
<a href="#l3.163"></a><span id="l3.163">               this._stringBundle.GetStringFromName(&quot;PostToInsecureFromInsecureShowAgain&quot;),</span>
<a href="#l3.164"></a><span id="l3.164">               warn) != 0;</span>
<a href="#l3.165"></a><span id="l3.165">             if (!aCancel.value)</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineminus">-              this._prefs.setBoolPref(&quot;security.warn_submit_insecure&quot;, warn.value);</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+              Services.prefs.setBoolPref(&quot;security.warn_submit_insecure&quot;, warn.value);</span>
<a href="#l3.168"></a><span id="l3.168">           ]]&gt;</span>
<a href="#l3.169"></a><span id="l3.169">         &lt;/body&gt;</span>
<a href="#l3.170"></a><span id="l3.170">       &lt;/method&gt;</span>
<a href="#l3.171"></a><span id="l3.171"> </span>
<a href="#l3.172"></a><span id="l3.172">       &lt;method name=&quot;observe&quot;&gt;</span>
<a href="#l3.173"></a><span id="l3.173">         &lt;parameter name=&quot;aSubject&quot; /&gt;</span>
<a href="#l3.174"></a><span id="l3.174">         &lt;parameter name=&quot;aTopic&quot; /&gt;</span>
<a href="#l3.175"></a><span id="l3.175">         &lt;parameter name=&quot;aData&quot; /&gt;</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineat">@@ -460,44 +453,44 @@</span>
<a href="#l3.177"></a><span id="l3.177">                     this.checkUsage(manifestURI);</span>
<a href="#l3.178"></a><span id="l3.178">                 } catch (e) {</span>
<a href="#l3.179"></a><span id="l3.179">                   alert(e);</span>
<a href="#l3.180"></a><span id="l3.180">                 }</span>
<a href="#l3.181"></a><span id="l3.181">                 break;</span>
<a href="#l3.182"></a><span id="l3.182"> </span>
<a href="#l3.183"></a><span id="l3.183">               case &quot;nsPref:changed&quot;:</span>
<a href="#l3.184"></a><span id="l3.184">                 if (aData == &quot;privacy.popups.showBrowserMessage&quot;) {</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineminus">-                  if (this._prefs.getBoolPref(aData))</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineplus">+                  if (Services.prefs.getBoolPref(aData))</span>
<a href="#l3.187"></a><span id="l3.187">                     return;</span>
<a href="#l3.188"></a><span id="l3.188"> </span>
<a href="#l3.189"></a><span id="l3.189">                   var popupNotification = this.getNotificationWithValue(&quot;popup-blocked&quot;);</span>
<a href="#l3.190"></a><span id="l3.190">                   if (popupNotification)</span>
<a href="#l3.191"></a><span id="l3.191">                     this.removeNotification(popupNotification);</span>
<a href="#l3.192"></a><span id="l3.192">                 }</span>
<a href="#l3.193"></a><span id="l3.193"> </span>
<a href="#l3.194"></a><span id="l3.194">                 if (aData == &quot;plugins.hide_infobar_for_outdated_plugin&quot;) {</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineminus">-                  if (!this._prefs.getBoolPref(aData))</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineplus">+                  if (!Services.prefs.getBoolPref(aData))</span>
<a href="#l3.197"></a><span id="l3.197">                     return;</span>
<a href="#l3.198"></a><span id="l3.198"> </span>
<a href="#l3.199"></a><span id="l3.199">                   var outdatedNotification = this.getNotificationWithValue(&quot;outdated-plugins&quot;);</span>
<a href="#l3.200"></a><span id="l3.200">                   if (outdatedNotification)</span>
<a href="#l3.201"></a><span id="l3.201">                     this.removeNotification(outdatedNotification);</span>
<a href="#l3.202"></a><span id="l3.202">                 }</span>
<a href="#l3.203"></a><span id="l3.203"> </span>
<a href="#l3.204"></a><span id="l3.204">                 if (aData == &quot;plugins.hide_infobar_for_carbon_failure_plugin&quot;) {</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineminus">-                  if (!this._prefs.getBoolPref(aData))</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineplus">+                  if (!Services.prefs.getBoolPref(aData))</span>
<a href="#l3.207"></a><span id="l3.207">                     return;</span>
<a href="#l3.208"></a><span id="l3.208"> </span>
<a href="#l3.209"></a><span id="l3.209">                   var carbonfailureNotification = this.getNotificationWithValue(&quot;carbon-failure-plugins&quot;);</span>
<a href="#l3.210"></a><span id="l3.210">                   if (carbonfailureNotification)</span>
<a href="#l3.211"></a><span id="l3.211">                     this.removeNotification(carbonfailureNotification);</span>
<a href="#l3.212"></a><span id="l3.212">                 }</span>
<a href="#l3.213"></a><span id="l3.213"> </span>
<a href="#l3.214"></a><span id="l3.214">                 if (aData == &quot;plugins.hide_infobar_for_missing_plugin&quot;) {</span>
<a href="#l3.215"></a><span id="l3.215" class="difflineminus">-                  if (!this._prefs.getBoolPref(aData))</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineplus">+                  if (!Services.prefs.getBoolPref(aData))</span>
<a href="#l3.217"></a><span id="l3.217">                     return;</span>
<a href="#l3.218"></a><span id="l3.218"> </span>
<a href="#l3.219"></a><span id="l3.219">                   var missingNotification = this.getNotificationWithValue(&quot;missing-plugins&quot;);</span>
<a href="#l3.220"></a><span id="l3.220">                   if (missingNotification)</span>
<a href="#l3.221"></a><span id="l3.221">                     this.removeNotification(missingNotification);</span>
<a href="#l3.222"></a><span id="l3.222"> </span>
<a href="#l3.223"></a><span id="l3.223">                   var disabledNotification = this.getNotificationWithValue(&quot;disabled-plugins&quot;);</span>
<a href="#l3.224"></a><span id="l3.224">                   if (disabledNotification)</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineat">@@ -505,17 +498,17 @@</span>
<a href="#l3.226"></a><span id="l3.226"> </span>
<a href="#l3.227"></a><span id="l3.227">                   var blockedNotification = this.getNotificationWithValue(&quot;blocked-plugins&quot;);</span>
<a href="#l3.228"></a><span id="l3.228">                   if (blockedNotification)</span>
<a href="#l3.229"></a><span id="l3.229">                     this.removeNotification(blockedNotification);</span>
<a href="#l3.230"></a><span id="l3.230">                 }</span>
<a href="#l3.231"></a><span id="l3.231"> </span>
<a href="#l3.232"></a><span id="l3.232">                 if (aData == &quot;dom.disable_open_during_load&quot;) {</span>
<a href="#l3.233"></a><span id="l3.233">                   // remove notifications when popup blocking has been turned off</span>
<a href="#l3.234"></a><span id="l3.234" class="difflineminus">-                  if (this._prefs.getBoolPref(aData) || !this.popupCount)</span>
<a href="#l3.235"></a><span id="l3.235" class="difflineplus">+                  if (Services.prefs.getBoolPref(aData) || !this.popupCount)</span>
<a href="#l3.236"></a><span id="l3.236">                     return;</span>
<a href="#l3.237"></a><span id="l3.237"> </span>
<a href="#l3.238"></a><span id="l3.238">                   var popupNotification = this.getNotificationWithValue(&quot;popup-blocked&quot;);</span>
<a href="#l3.239"></a><span id="l3.239">                   if (popupNotification)</span>
<a href="#l3.240"></a><span id="l3.240">                     this.removeNotification(popupNotification);</span>
<a href="#l3.241"></a><span id="l3.241">                   this.popupCount = 0;</span>
<a href="#l3.242"></a><span id="l3.242">                   this.notifyPopupCountChanged();</span>
<a href="#l3.243"></a><span id="l3.243">                 }</span>
<a href="#l3.244"></a><span id="l3.244" class="difflineat">@@ -600,17 +593,17 @@</span>
<a href="#l3.245"></a><span id="l3.245">           &lt;![CDATA[</span>
<a href="#l3.246"></a><span id="l3.246">             // Show the in-content UI if it's not too big. The crashed plugin handler already does this.</span>
<a href="#l3.247"></a><span id="l3.247">             var overlay = this.getPluginUI(aPlugin, &quot;main&quot;);</span>
<a href="#l3.248"></a><span id="l3.248">             aPlugin.addEventListener(&quot;overflow&quot;, this);</span>
<a href="#l3.249"></a><span id="l3.249">             aPlugin.addEventListener(&quot;underflow&quot;, this);</span>
<a href="#l3.250"></a><span id="l3.250">             overlay.classList.toggle(&quot;visible&quot;,</span>
<a href="#l3.251"></a><span id="l3.251">                                      !this.isTooSmall(aPlugin, overlay));</span>
<a href="#l3.252"></a><span id="l3.252"> </span>
<a href="#l3.253"></a><span id="l3.253" class="difflineminus">-            if (this._prefs.getBoolPref(aPref || &quot;plugins.hide_infobar_for_missing_plugin&quot;))</span>
<a href="#l3.254"></a><span id="l3.254" class="difflineplus">+            if (Services.prefs.getBoolPref(aPref || &quot;plugins.hide_infobar_for_missing_plugin&quot;))</span>
<a href="#l3.255"></a><span id="l3.255">               return;</span>
<a href="#l3.256"></a><span id="l3.256"> </span>
<a href="#l3.257"></a><span id="l3.257">             var notification;</span>
<a href="#l3.258"></a><span id="l3.258">             var notifications = [</span>
<a href="#l3.259"></a><span id="l3.259">               &quot;blocked-plugins&quot;,</span>
<a href="#l3.260"></a><span id="l3.260">               &quot;disabled-plugins&quot;,</span>
<a href="#l3.261"></a><span id="l3.261">               &quot;missing-plugins&quot;,</span>
<a href="#l3.262"></a><span id="l3.262">               &quot;carbon-failure-plugins&quot;,</span>
<a href="#l3.263"></a><span id="l3.263" class="difflineat">@@ -744,26 +737,26 @@</span>
<a href="#l3.264"></a><span id="l3.264">       &lt;method name=&quot;openURLPref&quot;&gt;</span>
<a href="#l3.265"></a><span id="l3.265">         &lt;parameter name=&quot;aPref&quot;/&gt;</span>
<a href="#l3.266"></a><span id="l3.266">         &lt;body&gt;</span>
<a href="#l3.267"></a><span id="l3.267">           &lt;![CDATA[</span>
<a href="#l3.268"></a><span id="l3.268">             var url = this._urlFormatter.formatURLPref(aPref);</span>
<a href="#l3.269"></a><span id="l3.269">             var nsIBrowserDOMWindow = Ci.nsIBrowserDOMWindow;</span>
<a href="#l3.270"></a><span id="l3.270"> </span>
<a href="#l3.271"></a><span id="l3.271">             var browserWin;</span>
<a href="#l3.272"></a><span id="l3.272" class="difflineminus">-            var whereToOpen = this._prefs.getIntPref(&quot;browser.link.open_external&quot;);</span>
<a href="#l3.273"></a><span id="l3.273" class="difflineplus">+            var whereToOpen = Services.prefs.getIntPref(&quot;browser.link.open_external&quot;);</span>
<a href="#l3.274"></a><span id="l3.274"> </span>
<a href="#l3.275"></a><span id="l3.275">             if (whereToOpen != nsIBrowserDOMWindow.OPEN_NEWWINDOW) {</span>
<a href="#l3.276"></a><span id="l3.276">               browserWin = Services.wm.getMostRecentWindow(&quot;navigator:browser&quot;);</span>
<a href="#l3.277"></a><span id="l3.277">             }</span>
<a href="#l3.278"></a><span id="l3.278"> </span>
<a href="#l3.279"></a><span id="l3.279">             if (!browserWin) {</span>
<a href="#l3.280"></a><span id="l3.280">               var browserURL = &quot;chrome://navigator/content/navigator.xul&quot;;</span>
<a href="#l3.281"></a><span id="l3.281">               try {</span>
<a href="#l3.282"></a><span id="l3.282" class="difflineminus">-                browserURL = this._prefs.getCharPref(&quot;browser.chromeURL&quot;);</span>
<a href="#l3.283"></a><span id="l3.283" class="difflineplus">+                browserURL = Services.prefs.getCharPref(&quot;browser.chromeURL&quot;);</span>
<a href="#l3.284"></a><span id="l3.284">               } catch (ex) {}</span>
<a href="#l3.285"></a><span id="l3.285"> </span>
<a href="#l3.286"></a><span id="l3.286">               window.openDialog(browserURL, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;, url);</span>
<a href="#l3.287"></a><span id="l3.287">             } else {</span>
<a href="#l3.288"></a><span id="l3.288">               if (whereToOpen == nsIBrowserDOMWindow.OPEN_CURRENTWINDOW)</span>
<a href="#l3.289"></a><span id="l3.289">                 browserWin.loadURI(url);</span>
<a href="#l3.290"></a><span id="l3.290">               else {</span>
<a href="#l3.291"></a><span id="l3.291">                 // new tab</span>
<a href="#l3.292"></a><span id="l3.292" class="difflineat">@@ -1024,25 +1017,25 @@</span>
<a href="#l3.293"></a><span id="l3.293">           ]]&gt;</span>
<a href="#l3.294"></a><span id="l3.294">         &lt;/body&gt;</span>
<a href="#l3.295"></a><span id="l3.295">       &lt;/method&gt;</span>
<a href="#l3.296"></a><span id="l3.296"> </span>
<a href="#l3.297"></a><span id="l3.297">       &lt;method name=&quot;playSoundForBlockedPopup&quot;&gt;</span>
<a href="#l3.298"></a><span id="l3.298">         &lt;body&gt;</span>
<a href="#l3.299"></a><span id="l3.299">           &lt;![CDATA[</span>
<a href="#l3.300"></a><span id="l3.300">             const kCustomSound = 1;</span>
<a href="#l3.301"></a><span id="l3.301" class="difflineminus">-            var playSound = this._prefs.getBoolPref(&quot;privacy.popups.sound_enabled&quot;);</span>
<a href="#l3.302"></a><span id="l3.302" class="difflineplus">+            var playSound = Services.prefs.getBoolPref(&quot;privacy.popups.sound_enabled&quot;);</span>
<a href="#l3.303"></a><span id="l3.303"> </span>
<a href="#l3.304"></a><span id="l3.304">             if (playSound) {</span>
<a href="#l3.305"></a><span id="l3.305">               var sound = Cc[&quot;@mozilla.org/sound;1&quot;]</span>
<a href="#l3.306"></a><span id="l3.306">                             .createInstance(Ci.nsISound);</span>
<a href="#l3.307"></a><span id="l3.307"> </span>
<a href="#l3.308"></a><span id="l3.308" class="difflineminus">-              var soundType = this._prefs.getIntPref(&quot;privacy.popups.sound_type&quot;);</span>
<a href="#l3.309"></a><span id="l3.309" class="difflineplus">+              var soundType = Services.prefs.getIntPref(&quot;privacy.popups.sound_type&quot;);</span>
<a href="#l3.310"></a><span id="l3.310">               if (soundType == kCustomSound) {</span>
<a href="#l3.311"></a><span id="l3.311" class="difflineminus">-                var soundUrlSpec = this._prefs.getCharPref(&quot;privacy.popups.sound_url&quot;);</span>
<a href="#l3.312"></a><span id="l3.312" class="difflineplus">+                var soundUrlSpec = Services.prefs.getCharPref(&quot;privacy.popups.sound_url&quot;);</span>
<a href="#l3.313"></a><span id="l3.313">                 var fileHandler = Cc[&quot;@mozilla.org/network/protocol;1?name=file&quot;]</span>
<a href="#l3.314"></a><span id="l3.314">                                     .getService(Ci.nsIFileProtocolHandler);</span>
<a href="#l3.315"></a><span id="l3.315">                 var file = fileHandler.getFileFromURLSpec(soundUrlSpec);</span>
<a href="#l3.316"></a><span id="l3.316">                 if (file.exists()) {</span>
<a href="#l3.317"></a><span id="l3.317">                   var soundUrl = fileHandler.newFileURI(file);</span>
<a href="#l3.318"></a><span id="l3.318">                   sound.play(soundUrl);</span>
<a href="#l3.319"></a><span id="l3.319">                   return;</span>
<a href="#l3.320"></a><span id="l3.320">                 }</span>
<a href="#l3.321"></a><span id="l3.321" class="difflineat">@@ -1167,17 +1160,17 @@</span>
<a href="#l3.322"></a><span id="l3.322">                               .getService(Ci.nsIIOService);</span>
<a href="#l3.323"></a><span id="l3.323">             var cacheService = Cc[&quot;@mozilla.org/network/application-cache-service;1&quot;]</span>
<a href="#l3.324"></a><span id="l3.324">                                  .getService(Ci.nsIApplicationCacheService);</span>
<a href="#l3.325"></a><span id="l3.325">             cacheService.getGroups().forEach(function(aGroup) {</span>
<a href="#l3.326"></a><span id="l3.326">               var uri = ioService.newURI(aGroup);</span>
<a href="#l3.327"></a><span id="l3.327">               if (uri.asciiHost == host)</span>
<a href="#l3.328"></a><span id="l3.328">                 usage += cacheService.getActiveCache(aGroup).usage;</span>
<a href="#l3.329"></a><span id="l3.329">             });</span>
<a href="#l3.330"></a><span id="l3.330" class="difflineminus">-            var warnQuota = this._prefs.getIntPref(&quot;offline-apps.quota.warn&quot;);</span>
<a href="#l3.331"></a><span id="l3.331" class="difflineplus">+            var warnQuota = Services.prefs.getIntPref(&quot;offline-apps.quota.warn&quot;);</span>
<a href="#l3.332"></a><span id="l3.332">             if (usage &lt; warnQuota * 1024)</span>
<a href="#l3.333"></a><span id="l3.333">               return;</span>
<a href="#l3.334"></a><span id="l3.334"> </span>
<a href="#l3.335"></a><span id="l3.335">             var message = this._stringBundle.formatStringFromName(&quot;offlineApps.quota&quot;, [host, warnQuota / 1024], 2);</span>
<a href="#l3.336"></a><span id="l3.336">             var priority = this.PRIORITY_WARNING_MEDIUM;</span>
<a href="#l3.337"></a><span id="l3.337">             this.appendNotification(message, &quot;offline-app-usage&quot;, null,</span>
<a href="#l3.338"></a><span id="l3.338">                                     priority, null);</span>
<a href="#l3.339"></a><span id="l3.339">             pm.add(aURI, &quot;offline-app&quot;,</span>
<a href="#l3.340"></a><span id="l3.340" class="difflineat">@@ -1693,31 +1686,31 @@</span>
<a href="#l3.341"></a><span id="l3.341">           ]]&gt;</span>
<a href="#l3.342"></a><span id="l3.342">         &lt;/body&gt;</span>
<a href="#l3.343"></a><span id="l3.343">       &lt;/method&gt;</span>
<a href="#l3.344"></a><span id="l3.344"> </span>
<a href="#l3.345"></a><span id="l3.345">       &lt;method name=&quot;addonInstallDisabled&quot;&gt;</span>
<a href="#l3.346"></a><span id="l3.346">         &lt;parameter name=&quot;installInfo&quot;/&gt;</span>
<a href="#l3.347"></a><span id="l3.347">         &lt;body&gt;</span>
<a href="#l3.348"></a><span id="l3.348">           &lt;![CDATA[</span>
<a href="#l3.349"></a><span id="l3.349" class="difflineminus">-            var messageString, buttons;</span>
<a href="#l3.350"></a><span id="l3.350" class="difflineminus">-            var prefBranch = this._prefs; // used by editPrefs callback</span>
<a href="#l3.351"></a><span id="l3.351" class="difflineplus">+            var messageString;</span>
<a href="#l3.352"></a><span id="l3.352" class="difflineplus">+            var buttons;</span>
<a href="#l3.353"></a><span id="l3.353"> </span>
<a href="#l3.354"></a><span id="l3.354">             var notificationName = &quot;addon-install-disabled&quot;;</span>
<a href="#l3.355"></a><span id="l3.355" class="difflineminus">-            if (prefBranch.prefIsLocked(&quot;xpinstall.enabled&quot;)) {</span>
<a href="#l3.356"></a><span id="l3.356" class="difflineplus">+            if (Services.prefs.prefIsLocked(&quot;xpinstall.enabled&quot;)) {</span>
<a href="#l3.357"></a><span id="l3.357">               messageString = this._stringBundle.GetStringFromName(&quot;xpinstallDisabledMessageLocked&quot;);</span>
<a href="#l3.358"></a><span id="l3.358">               buttons = [];</span>
<a href="#l3.359"></a><span id="l3.359">             } else {</span>
<a href="#l3.360"></a><span id="l3.360">               messageString = this._stringBundle.GetStringFromName(&quot;xpinstallDisabledMessage&quot;);</span>
<a href="#l3.361"></a><span id="l3.361">               buttons = [{</span>
<a href="#l3.362"></a><span id="l3.362">                 label: this._stringBundle.GetStringFromName(&quot;xpinstallDisabledButton&quot;),</span>
<a href="#l3.363"></a><span id="l3.363">                 accessKey: this._stringBundle.GetStringFromName(&quot;xpinstallDisabledButton.accesskey&quot;),</span>
<a href="#l3.364"></a><span id="l3.364">                 popup: null,</span>
<a href="#l3.365"></a><span id="l3.365">                 callback: function editPrefs() {</span>
<a href="#l3.366"></a><span id="l3.366" class="difflineminus">-                  prefBranch.setBoolPref(&quot;xpinstall.enabled&quot;, true);</span>
<a href="#l3.367"></a><span id="l3.367" class="difflineplus">+                  Services.prefs.setBoolPref(&quot;xpinstall.enabled&quot;, true);</span>
<a href="#l3.368"></a><span id="l3.368">                   return false;</span>
<a href="#l3.369"></a><span id="l3.369">                 }</span>
<a href="#l3.370"></a><span id="l3.370">               }];</span>
<a href="#l3.371"></a><span id="l3.371">             }</span>
<a href="#l3.372"></a><span id="l3.372"> </span>
<a href="#l3.373"></a><span id="l3.373">             if (!this.getNotificationWithValue(notificationName)) {</span>
<a href="#l3.374"></a><span id="l3.374">               var priority = this.PRIORITY_WARNING_MEDIUM;</span>
<a href="#l3.375"></a><span id="l3.375">               this.appendNotification(messageString, notificationName,</span>
<a href="#l3.376"></a><span id="l3.376" class="difflineat">@@ -1885,35 +1878,33 @@</span>
<a href="#l3.377"></a><span id="l3.377">           ]]&gt;</span>
<a href="#l3.378"></a><span id="l3.378">         &lt;/body&gt;</span>
<a href="#l3.379"></a><span id="l3.379">       &lt;/method&gt;</span>
<a href="#l3.380"></a><span id="l3.380">       &lt;constructor&gt;</span>
<a href="#l3.381"></a><span id="l3.381">         &lt;![CDATA[</span>
<a href="#l3.382"></a><span id="l3.382">           var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.383"></a><span id="l3.383">           ChromeUtils.import(&quot;resource://gre/modules/BrowserUtils.jsm&quot;);</span>
<a href="#l3.384"></a><span id="l3.384"> </span>
<a href="#l3.385"></a><span id="l3.385" class="difflineminus">-          var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l3.386"></a><span id="l3.386" class="difflineminus">-                     .getService(Ci.nsIObserverService);</span>
<a href="#l3.387"></a><span id="l3.387" class="difflineminus">-          os.addObserver(this, &quot;indexedDB-permissions-prompt&quot;);</span>
<a href="#l3.388"></a><span id="l3.388" class="difflineminus">-          os.addObserver(this, &quot;indexedDB-quota-prompt&quot;);</span>
<a href="#l3.389"></a><span id="l3.389" class="difflineminus">-          os.addObserver(this, &quot;indexedDB-quota-cancel&quot;);</span>
<a href="#l3.390"></a><span id="l3.390" class="difflineminus">-          os.addObserver(this, &quot;addon-install-blocked&quot;);</span>
<a href="#l3.391"></a><span id="l3.391" class="difflineminus">-          os.addObserver(this, &quot;addon-install-complete&quot;);</span>
<a href="#l3.392"></a><span id="l3.392" class="difflineminus">-          os.addObserver(this, &quot;addon-install-disabled&quot;);</span>
<a href="#l3.393"></a><span id="l3.393" class="difflineminus">-          os.addObserver(this, &quot;addon-install-failed&quot;);</span>
<a href="#l3.394"></a><span id="l3.394" class="difflineminus">-          os.addObserver(this, &quot;addon-install-started&quot;);</span>
<a href="#l3.395"></a><span id="l3.395" class="difflineminus">-          os.addObserver(this, &quot;offline-cache-update-completed&quot;);</span>
<a href="#l3.396"></a><span id="l3.396" class="difflineminus">-          os.addObserver(this, &quot;perm-changed&quot;);</span>
<a href="#l3.397"></a><span id="l3.397" class="difflineminus">-          os.addObserver(this, &quot;formsubmit&quot;);</span>
<a href="#l3.398"></a><span id="l3.398" class="difflineminus">-</span>
<a href="#l3.399"></a><span id="l3.399" class="difflineminus">-          this._prefs.addObserver(&quot;plugins.hide_infobar_for_outdated_plugin&quot;, this);</span>
<a href="#l3.400"></a><span id="l3.400" class="difflineminus">-          this._prefs.addObserver(&quot;plugins.hide_infobar_for_carbon_failure_plugin&quot;, this);</span>
<a href="#l3.401"></a><span id="l3.401" class="difflineminus">-          this._prefs.addObserver(&quot;plugins.hide_infobar_for_missing_plugin&quot;, this);</span>
<a href="#l3.402"></a><span id="l3.402" class="difflineminus">-          this._prefs.addObserver(&quot;privacy.popups.showBrowserMessage&quot;, this);</span>
<a href="#l3.403"></a><span id="l3.403" class="difflineminus">-          this._prefs.addObserver(&quot;dom.disable_open_during_load&quot;, this);</span>
<a href="#l3.404"></a><span id="l3.404" class="difflineplus">+          Services.obs.addObserver(this, &quot;indexedDB-permissions-prompt&quot;);</span>
<a href="#l3.405"></a><span id="l3.405" class="difflineplus">+          Services.obs.addObserver(this, &quot;indexedDB-quota-prompt&quot;);</span>
<a href="#l3.406"></a><span id="l3.406" class="difflineplus">+          Services.obs.addObserver(this, &quot;indexedDB-quota-cancel&quot;);</span>
<a href="#l3.407"></a><span id="l3.407" class="difflineplus">+          Services.obs.addObserver(this, &quot;addon-install-blocked&quot;);</span>
<a href="#l3.408"></a><span id="l3.408" class="difflineplus">+          Services.obs.addObserver(this, &quot;addon-install-complete&quot;);</span>
<a href="#l3.409"></a><span id="l3.409" class="difflineplus">+          Services.obs.addObserver(this, &quot;addon-install-disabled&quot;);</span>
<a href="#l3.410"></a><span id="l3.410" class="difflineplus">+          Services.obs.addObserver(this, &quot;addon-install-failed&quot;);</span>
<a href="#l3.411"></a><span id="l3.411" class="difflineplus">+          Services.obs.addObserver(this, &quot;addon-install-started&quot;);</span>
<a href="#l3.412"></a><span id="l3.412" class="difflineplus">+          Services.obs.addObserver(this, &quot;offline-cache-update-completed&quot;);</span>
<a href="#l3.413"></a><span id="l3.413" class="difflineplus">+          Services.obs.addObserver(this, &quot;perm-changed&quot;);</span>
<a href="#l3.414"></a><span id="l3.414" class="difflineplus">+          Services.obs.addObserver(this, &quot;formsubmit&quot;);</span>
<a href="#l3.415"></a><span id="l3.415" class="difflineplus">+</span>
<a href="#l3.416"></a><span id="l3.416" class="difflineplus">+          Services.prefs.addObserver(&quot;plugins.hide_infobar_for_outdated_plugin&quot;, this);</span>
<a href="#l3.417"></a><span id="l3.417" class="difflineplus">+          Services.prefs.addObserver(&quot;plugins.hide_infobar_for_carbon_failure_plugin&quot;, this);</span>
<a href="#l3.418"></a><span id="l3.418" class="difflineplus">+          Services.prefs.addObserver(&quot;plugins.hide_infobar_for_missing_plugin&quot;, this);</span>
<a href="#l3.419"></a><span id="l3.419" class="difflineplus">+          Services.prefs.addObserver(&quot;privacy.popups.showBrowserMessage&quot;, this);</span>
<a href="#l3.420"></a><span id="l3.420" class="difflineplus">+          Services.prefs.addObserver(&quot;dom.disable_open_during_load&quot;, this);</span>
<a href="#l3.421"></a><span id="l3.421"> </span>
<a href="#l3.422"></a><span id="l3.422">           this.addProgressListener();</span>
<a href="#l3.423"></a><span id="l3.423"> </span>
<a href="#l3.424"></a><span id="l3.424">           if (&quot;nsICrashReporter&quot; in Ci)</span>
<a href="#l3.425"></a><span id="l3.425">             ChromeUtils.import(&quot;resource://gre/modules/CrashSubmit.jsm&quot;, this);</span>
<a href="#l3.426"></a><span id="l3.426">         ]]&gt;</span>
<a href="#l3.427"></a><span id="l3.427">       &lt;/constructor&gt;</span>
<a href="#l3.428"></a><span id="l3.428"> </span>
<a href="#l3.429"></a><span id="l3.429" class="difflineat">@@ -1935,66 +1926,64 @@</span>
<a href="#l3.430"></a><span id="l3.430">             this.mDestroyed = true;</span>
<a href="#l3.431"></a><span id="l3.431"> </span>
<a href="#l3.432"></a><span id="l3.432">             if (this._addedProgressListener) {</span>
<a href="#l3.433"></a><span id="l3.433">               this.activeBrowser.webProgress.removeProgressListener(this);</span>
<a href="#l3.434"></a><span id="l3.434">               this._addedProgressListener = false;</span>
<a href="#l3.435"></a><span id="l3.435">             }</span>
<a href="#l3.436"></a><span id="l3.436"> </span>
<a href="#l3.437"></a><span id="l3.437">             this._activeBrowser = null;</span>
<a href="#l3.438"></a><span id="l3.438" class="difflineminus">-            var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l3.439"></a><span id="l3.439" class="difflineminus">-                                .getService(Ci.nsIObserverService);</span>
<a href="#l3.440"></a><span id="l3.440">             try {</span>
<a href="#l3.441"></a><span id="l3.441" class="difflineminus">-              os.removeObserver(this, &quot;indexedDB-permissions-prompt&quot;);</span>
<a href="#l3.442"></a><span id="l3.442" class="difflineplus">+              Services.obs.removeObserver(this, &quot;indexedDB-permissions-prompt&quot;);</span>
<a href="#l3.443"></a><span id="l3.443" class="difflineplus">+            } catch (ex) {}</span>
<a href="#l3.444"></a><span id="l3.444" class="difflineplus">+            try {</span>
<a href="#l3.445"></a><span id="l3.445" class="difflineplus">+              Services.obs.removeObserver(this, &quot;indexedDB-quota-prompt&quot;);</span>
<a href="#l3.446"></a><span id="l3.446">             } catch (ex) {}</span>
<a href="#l3.447"></a><span id="l3.447">             try {</span>
<a href="#l3.448"></a><span id="l3.448" class="difflineminus">-              os.removeObserver(this, &quot;indexedDB-quota-prompt&quot;);</span>
<a href="#l3.449"></a><span id="l3.449" class="difflineplus">+              Services.obs.removeObserver(this, &quot;indexedDB-quota-cancel&quot;);</span>
<a href="#l3.450"></a><span id="l3.450">             } catch (ex) {}</span>
<a href="#l3.451"></a><span id="l3.451">             try {</span>
<a href="#l3.452"></a><span id="l3.452" class="difflineminus">-              os.removeObserver(this, &quot;indexedDB-quota-cancel&quot;);</span>
<a href="#l3.453"></a><span id="l3.453" class="difflineplus">+              Services.obs.removeObserver(this, &quot;addon-install-blocked&quot;);</span>
<a href="#l3.454"></a><span id="l3.454">             } catch (ex) {}</span>
<a href="#l3.455"></a><span id="l3.455">             try {</span>
<a href="#l3.456"></a><span id="l3.456" class="difflineminus">-              os.removeObserver(this, &quot;addon-install-blocked&quot;);</span>
<a href="#l3.457"></a><span id="l3.457" class="difflineplus">+              Services.obs.removeObserver(this, &quot;addon-install-complete&quot;);</span>
<a href="#l3.458"></a><span id="l3.458">             } catch (ex) {}</span>
<a href="#l3.459"></a><span id="l3.459">             try {</span>
<a href="#l3.460"></a><span id="l3.460" class="difflineminus">-              os.removeObserver(this, &quot;addon-install-complete&quot;);</span>
<a href="#l3.461"></a><span id="l3.461" class="difflineplus">+              Services.obs.removeObserver(this, &quot;addon-install-disabled&quot;);</span>
<a href="#l3.462"></a><span id="l3.462">             } catch (ex) {}</span>
<a href="#l3.463"></a><span id="l3.463">             try {</span>
<a href="#l3.464"></a><span id="l3.464" class="difflineminus">-              os.removeObserver(this, &quot;addon-install-disabled&quot;);</span>
<a href="#l3.465"></a><span id="l3.465" class="difflineminus">-            } catch (ex) {}</span>
<a href="#l3.466"></a><span id="l3.466" class="difflineminus">-            try {</span>
<a href="#l3.467"></a><span id="l3.467" class="difflineminus">-              os.removeObserver(this, &quot;addon-install-failed&quot;);</span>
<a href="#l3.468"></a><span id="l3.468" class="difflineplus">+              Services.obs.removeObserver(this, &quot;addon-install-failed&quot;);</span>
<a href="#l3.469"></a><span id="l3.469">             } catch (ex) {}</span>
<a href="#l3.470"></a><span id="l3.470">             try {</span>
<a href="#l3.471"></a><span id="l3.471" class="difflineminus">-              os.removeObserver(this, &quot;addon-install-started&quot;);</span>
<a href="#l3.472"></a><span id="l3.472" class="difflineplus">+              Services.obs.removeObserver(this, &quot;addon-install-started&quot;);</span>
<a href="#l3.473"></a><span id="l3.473">             } catch (ex) {}</span>
<a href="#l3.474"></a><span id="l3.474">             try {</span>
<a href="#l3.475"></a><span id="l3.475" class="difflineminus">-              os.removeObserver(this, &quot;offline-cache-update-completed&quot;);</span>
<a href="#l3.476"></a><span id="l3.476" class="difflineplus">+              Services.obs.removeObserver(this, &quot;offline-cache-update-completed&quot;);</span>
<a href="#l3.477"></a><span id="l3.477">             } catch (ex) {}</span>
<a href="#l3.478"></a><span id="l3.478">             try {</span>
<a href="#l3.479"></a><span id="l3.479" class="difflineminus">-              os.removeObserver(this, &quot;perm-changed&quot;);</span>
<a href="#l3.480"></a><span id="l3.480" class="difflineplus">+              Services.obs.removeObserver(this, &quot;perm-changed&quot;);</span>
<a href="#l3.481"></a><span id="l3.481">             } catch (ex) {}</span>
<a href="#l3.482"></a><span id="l3.482">             try {</span>
<a href="#l3.483"></a><span id="l3.483" class="difflineminus">-              os.removeObserver(this, &quot;formsubmit&quot;);</span>
<a href="#l3.484"></a><span id="l3.484" class="difflineplus">+              Services.obs.removeObserver(this, &quot;formsubmit&quot;);</span>
<a href="#l3.485"></a><span id="l3.485">             } catch (ex) {}</span>
<a href="#l3.486"></a><span id="l3.486"> </span>
<a href="#l3.487"></a><span id="l3.487">             try {</span>
<a href="#l3.488"></a><span id="l3.488" class="difflineminus">-              this._prefs.removeObserver(&quot;plugins.hide_infobar_for_outdated_plugin&quot;, this);</span>
<a href="#l3.489"></a><span id="l3.489" class="difflineplus">+              Services.prefs.removeObserver(&quot;plugins.hide_infobar_for_outdated_plugin&quot;, this);</span>
<a href="#l3.490"></a><span id="l3.490">             } catch (ex) {}</span>
<a href="#l3.491"></a><span id="l3.491">             try {</span>
<a href="#l3.492"></a><span id="l3.492" class="difflineminus">-              this._prefs.removeObserver(&quot;plugins.hide_infobar_for_carbon_failure_plugin&quot;, this);</span>
<a href="#l3.493"></a><span id="l3.493" class="difflineplus">+              Services.prefs.removeObserver(&quot;plugins.hide_infobar_for_carbon_failure_plugin&quot;, this);</span>
<a href="#l3.494"></a><span id="l3.494">             } catch (ex) {}</span>
<a href="#l3.495"></a><span id="l3.495">             try {</span>
<a href="#l3.496"></a><span id="l3.496" class="difflineminus">-              this._prefs.removeObserver(&quot;plugins.hide_infobar_for_missing_plugin&quot;, this);</span>
<a href="#l3.497"></a><span id="l3.497" class="difflineplus">+              Services.prefs.removeObserver(&quot;plugins.hide_infobar_for_missing_plugin&quot;, this);</span>
<a href="#l3.498"></a><span id="l3.498">             } catch (ex) {}</span>
<a href="#l3.499"></a><span id="l3.499">             try {</span>
<a href="#l3.500"></a><span id="l3.500" class="difflineminus">-              this._prefs.removeObserver(&quot;privacy.popups.showBrowserMessage&quot;, this);</span>
<a href="#l3.501"></a><span id="l3.501" class="difflineplus">+              Services.prefs.removeObserver(&quot;privacy.popups.showBrowserMessage&quot;, this);</span>
<a href="#l3.502"></a><span id="l3.502">             } catch (ex) {}</span>
<a href="#l3.503"></a><span id="l3.503">             try {</span>
<a href="#l3.504"></a><span id="l3.504" class="difflineminus">-              this._prefs.removeObserver(&quot;dom.disable_open_during_load&quot;, this);</span>
<a href="#l3.505"></a><span id="l3.505" class="difflineplus">+              Services.prefs.removeObserver(&quot;dom.disable_open_during_load&quot;, this);</span>
<a href="#l3.506"></a><span id="l3.506">             } catch (ex) {}</span>
<a href="#l3.507"></a><span id="l3.507">           ]]&gt;</span>
<a href="#l3.508"></a><span id="l3.508">         &lt;/body&gt;</span>
<a href="#l3.509"></a><span id="l3.509">       &lt;/method&gt;</span>
<a href="#l3.510"></a><span id="l3.510">     &lt;/implementation&gt;</span>
<a href="#l3.511"></a><span id="l3.511"> </span>
<a href="#l3.512"></a><span id="l3.512">     &lt;handlers&gt;</span>
<a href="#l3.513"></a><span id="l3.513">       &lt;handler event=&quot;DOMContentLoaded&quot; phase=&quot;capturing&quot;&gt;</span>
<a href="#l3.514"></a><span id="l3.514" class="difflineat">@@ -2021,17 +2010,17 @@</span>
<a href="#l3.515"></a><span id="l3.515">           } else {</span>
<a href="#l3.516"></a><span id="l3.516">             this.popupCount++;</span>
<a href="#l3.517"></a><span id="l3.517">           }</span>
<a href="#l3.518"></a><span id="l3.518">           this.playSoundForBlockedPopup();</span>
<a href="#l3.519"></a><span id="l3.519">           this.notifyPopupCountChanged();</span>
<a href="#l3.520"></a><span id="l3.520"> </span>
<a href="#l3.521"></a><span id="l3.521">           var tmp = {};</span>
<a href="#l3.522"></a><span id="l3.522">           ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;, tmp);</span>
<a href="#l3.523"></a><span id="l3.523" class="difflineminus">-          if (this._prefs.getBoolPref(&quot;privacy.popups.showBrowserMessage&quot;))</span>
<a href="#l3.524"></a><span id="l3.524" class="difflineplus">+          if (Services.prefs.getBoolPref(&quot;privacy.popups.showBrowserMessage&quot;))</span>
<a href="#l3.525"></a><span id="l3.525">           {</span>
<a href="#l3.526"></a><span id="l3.526">             var brandShortName = this._brandStringBundle.GetStringFromName(&quot;brandShortName&quot;);</span>
<a href="#l3.527"></a><span id="l3.527">             var message = this._stringBundle.GetStringFromName(&quot;popupWarning.message&quot;);</span>
<a href="#l3.528"></a><span id="l3.528">             message = tmp.PluralForm.get(this.popupCount, message)</span>
<a href="#l3.529"></a><span id="l3.529">                                     .replace(&quot;#1&quot;, brandShortName)</span>
<a href="#l3.530"></a><span id="l3.530">                                     .replace(&quot;#2&quot;, this.popupCount);</span>
<a href="#l3.531"></a><span id="l3.531"> </span>
<a href="#l3.532"></a><span id="l3.532">             var notification = this.getNotificationWithValue(&quot;popup-blocked&quot;);</span>
<a href="#l3.533"></a><span id="l3.533" class="difflineat">@@ -2193,20 +2182,20 @@</span>
<a href="#l3.534"></a><span id="l3.534">             }</span>
<a href="#l3.535"></a><span id="l3.535">             else { // doPrompt</span>
<a href="#l3.536"></a><span id="l3.536">               status = &quot;please&quot;;</span>
<a href="#l3.537"></a><span id="l3.537">               this.getPluginUI(plugin, &quot;submitButton&quot;).addEventListener(&quot;click&quot;,</span>
<a href="#l3.538"></a><span id="l3.538">                 function (event) {</span>
<a href="#l3.539"></a><span id="l3.539">                   if (event.button != 0 || !event.isTrusted)</span>
<a href="#l3.540"></a><span id="l3.540">                     return;</span>
<a href="#l3.541"></a><span id="l3.541">                   this.submitReport(pluginDumpID, browserDumpID, plugin);</span>
<a href="#l3.542"></a><span id="l3.542" class="difflineminus">-                  this._prefs.setBoolPref(&quot;dom.ipc.plugins.reportCrashURL&quot;, optInCB.checked);</span>
<a href="#l3.543"></a><span id="l3.543" class="difflineplus">+                  Services.prefs.setBoolPref(&quot;dom.ipc.plugins.reportCrashURL&quot;, optInCB.checked);</span>
<a href="#l3.544"></a><span id="l3.544">                 }.bind(this));</span>
<a href="#l3.545"></a><span id="l3.545">                 let optInCB = this.getPluginUI(plugin, &quot;submitURLOptIn&quot;);</span>
<a href="#l3.546"></a><span id="l3.546" class="difflineminus">-                optInCB.checked = this._prefs.getBoolPref(&quot;dom.ipc.plugins.reportCrashURL&quot;);</span>
<a href="#l3.547"></a><span id="l3.547" class="difflineplus">+                optInCB.checked = Services.prefs.getBoolPref(&quot;dom.ipc.plugins.reportCrashURL&quot;);</span>
<a href="#l3.548"></a><span id="l3.548">             }</span>
<a href="#l3.549"></a><span id="l3.549"> </span>
<a href="#l3.550"></a><span id="l3.550">             // If we're showing the link to manually trigger report submission, we'll</span>
<a href="#l3.551"></a><span id="l3.551">             // want to be able to update all the instances of the UI for this crash to</span>
<a href="#l3.552"></a><span id="l3.552">             // show an updated message when a report is submitted.</span>
<a href="#l3.553"></a><span id="l3.553">             if (doPrompt) {</span>
<a href="#l3.554"></a><span id="l3.554">               let observer = {</span>
<a href="#l3.555"></a><span id="l3.555">                 QueryInterface: XPCOMUtils.generateQI([Ci.nsIObserver,</span>
<a href="#l3.556"></a><span id="l3.556" class="difflineat">@@ -2292,19 +2281,18 @@</span>
<a href="#l3.557"></a><span id="l3.557">           var plugin = event.target;</span>
<a href="#l3.558"></a><span id="l3.558">           // Force a style flush, so that we ensure our binding is attached.</span>
<a href="#l3.559"></a><span id="l3.559">           plugin.clientTop;</span>
<a href="#l3.560"></a><span id="l3.560"> </span>
<a href="#l3.561"></a><span id="l3.561">           function callback() {</span>
<a href="#l3.562"></a><span id="l3.562">             // Notify all windows that an application quit has been requested.</span>
<a href="#l3.563"></a><span id="l3.563">             var cancelQuit = Cc[&quot;@mozilla.org/supports-PRBool;1&quot;]</span>
<a href="#l3.564"></a><span id="l3.564">                                .createInstance(Ci.nsISupportsPRBool);</span>
<a href="#l3.565"></a><span id="l3.565" class="difflineminus">-            var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l3.566"></a><span id="l3.566" class="difflineminus">-                       .getService(Ci.nsIObserverService);</span>
<a href="#l3.567"></a><span id="l3.567" class="difflineminus">-            os.notifyObservers(cancelQuit, &quot;quit-application-requested&quot;);</span>
<a href="#l3.568"></a><span id="l3.568" class="difflineplus">+            Services.obs.notifyObservers(cancelQuit,</span>
<a href="#l3.569"></a><span id="l3.569" class="difflineplus">+                                         &quot;quit-application-requested&quot;);</span>
<a href="#l3.570"></a><span id="l3.570"> </span>
<a href="#l3.571"></a><span id="l3.571">             // Something aborted the quit process.</span>
<a href="#l3.572"></a><span id="l3.572">             if (cancelQuit.data)</span>
<a href="#l3.573"></a><span id="l3.573">               return;</span>
<a href="#l3.574"></a><span id="l3.574"> </span>
<a href="#l3.575"></a><span id="l3.575">             var nsIAppStartup = Ci.nsIAppStartup;</span>
<a href="#l3.576"></a><span id="l3.576">             Cc[&quot;@mozilla.org/toolkit/app-startup;1&quot;]</span>
<a href="#l3.577"></a><span id="l3.577">               .getService(nsIAppStartup)</span>
<a href="#l3.578"></a><span id="l3.578" class="difflineat">@@ -2334,21 +2322,21 @@</span>
<a href="#l3.579"></a><span id="l3.579">           }];</span>
<a href="#l3.580"></a><span id="l3.580"> </span>
<a href="#l3.581"></a><span id="l3.581">           this.pluginUnavailable(plugin, notification, message, buttons, pref);</span>
<a href="#l3.582"></a><span id="l3.582">         ]]&gt;</span>
<a href="#l3.583"></a><span id="l3.583">       &lt;/handler&gt;</span>
<a href="#l3.584"></a><span id="l3.584"> </span>
<a href="#l3.585"></a><span id="l3.585">       &lt;handler event=&quot;MozApplicationManifest&quot; phase=&quot;capturing&quot;&gt;</span>
<a href="#l3.586"></a><span id="l3.586">         &lt;![CDATA[</span>
<a href="#l3.587"></a><span id="l3.587" class="difflineminus">-          if (!this._prefs.getBoolPref(&quot;browser.offline-apps.notify&quot;))</span>
<a href="#l3.588"></a><span id="l3.588" class="difflineplus">+          if (!Services.prefs.getBoolPref(&quot;browser.offline-apps.notify&quot;))</span>
<a href="#l3.589"></a><span id="l3.589">             return;</span>
<a href="#l3.590"></a><span id="l3.590"> </span>
<a href="#l3.591"></a><span id="l3.591">           try {</span>
<a href="#l3.592"></a><span id="l3.592" class="difflineminus">-            if (this._prefs.getBoolPref(&quot;offline-apps.allow_by_default&quot;))</span>
<a href="#l3.593"></a><span id="l3.593" class="difflineplus">+            if (Services.prefs.getBoolPref(&quot;offline-apps.allow_by_default&quot;))</span>
<a href="#l3.594"></a><span id="l3.594">               return;</span>
<a href="#l3.595"></a><span id="l3.595">           } catch (e) {</span>
<a href="#l3.596"></a><span id="l3.596">           }</span>
<a href="#l3.597"></a><span id="l3.597"> </span>
<a href="#l3.598"></a><span id="l3.598">           this.offlineAppRequested(event.originalTarget);</span>
<a href="#l3.599"></a><span id="l3.599">         ]]&gt;</span>
<a href="#l3.600"></a><span id="l3.600">       &lt;/handler&gt;</span>
<a href="#l3.601"></a><span id="l3.601"> </span>
<a href="#l3.602"></a><span id="l3.602" class="difflineat">@@ -2802,27 +2790,26 @@</span>
<a href="#l3.603"></a><span id="l3.603">       &lt;/method&gt;</span>
<a href="#l3.604"></a><span id="l3.604"> </span>
<a href="#l3.605"></a><span id="l3.605">       &lt;method name=&quot;addonInstallDisabled&quot;&gt;</span>
<a href="#l3.606"></a><span id="l3.606">         &lt;parameter name=&quot;installInfo&quot;/&gt;</span>
<a href="#l3.607"></a><span id="l3.607">         &lt;body&gt;</span>
<a href="#l3.608"></a><span id="l3.608">           &lt;![CDATA[</span>
<a href="#l3.609"></a><span id="l3.609">             var messageString;</span>
<a href="#l3.610"></a><span id="l3.610">             var action = null;</span>
<a href="#l3.611"></a><span id="l3.611" class="difflineminus">-            var prefBranch = this._prefs; // used by editPrefs callback</span>
<a href="#l3.612"></a><span id="l3.612" class="difflineminus">-</span>
<a href="#l3.613"></a><span id="l3.613" class="difflineminus">-            if (prefBranch.prefIsLocked(&quot;xpinstall.enabled&quot;))</span>
<a href="#l3.614"></a><span id="l3.614" class="difflineplus">+</span>
<a href="#l3.615"></a><span id="l3.615" class="difflineplus">+            if (Services.prefs.prefIsLocked(&quot;xpinstall.enabled&quot;))</span>
<a href="#l3.616"></a><span id="l3.616">               messageString = this._stringBundle.GetStringFromName(&quot;xpinstallDisabledMessageLocked&quot;);</span>
<a href="#l3.617"></a><span id="l3.617">             else {</span>
<a href="#l3.618"></a><span id="l3.618">               messageString = this._stringBundle.GetStringFromName(&quot;xpinstallDisabledMessage&quot;);</span>
<a href="#l3.619"></a><span id="l3.619">               action = {</span>
<a href="#l3.620"></a><span id="l3.620">                 label: this._stringBundle.GetStringFromName(&quot;xpinstallDisabledButton&quot;),</span>
<a href="#l3.621"></a><span id="l3.621">                 accessKey: this._stringBundle.GetStringFromName(&quot;xpinstallDisabledButton.accesskey&quot;),</span>
<a href="#l3.622"></a><span id="l3.622">                 callback: function editPrefs() {</span>
<a href="#l3.623"></a><span id="l3.623" class="difflineminus">-                  prefBranch.setBoolPref(&quot;xpinstall.enabled&quot;, true);</span>
<a href="#l3.624"></a><span id="l3.624" class="difflineplus">+                  Services.prefs.setBoolPref(&quot;xpinstall.enabled&quot;, true);</span>
<a href="#l3.625"></a><span id="l3.625">                 }</span>
<a href="#l3.626"></a><span id="l3.626">               };</span>
<a href="#l3.627"></a><span id="l3.627">             }</span>
<a href="#l3.628"></a><span id="l3.628"> </span>
<a href="#l3.629"></a><span id="l3.629">             // Make notifications persist a minimum of 30 seconds</span>
<a href="#l3.630"></a><span id="l3.630">             var options = {</span>
<a href="#l3.631"></a><span id="l3.631">               timeout: Date.now() + 30000</span>
<a href="#l3.632"></a><span id="l3.632">             };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_basic_functionality.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_basic_functionality.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -241,41 +241,39 @@ function test()</span>
<a href="#l4.4"></a><span id="l4.4">   }</span>
<a href="#l4.5"></a><span id="l4.5">   stmt.finalize();</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7">   // See if the DM is already open, and if it is, close it!</span>
<a href="#l4.8"></a><span id="l4.8">   var win = Services.wm.getMostRecentWindow(&quot;Download:Manager&quot;);</span>
<a href="#l4.9"></a><span id="l4.9">   if (win)</span>
<a href="#l4.10"></a><span id="l4.10">     win.close();</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-             .getService(Ci.nsIObserverService);</span>
<a href="#l4.14"></a><span id="l4.14">   const DLMGR_UI_DONE = &quot;download-manager-ui-done&quot;;</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">   var testObs = {</span>
<a href="#l4.17"></a><span id="l4.17">     observe: function(aSubject, aTopic, aData)</span>
<a href="#l4.18"></a><span id="l4.18">     {</span>
<a href="#l4.19"></a><span id="l4.19">       if (aTopic != DLMGR_UI_DONE)</span>
<a href="#l4.20"></a><span id="l4.20">         return;</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22">       var win = aSubject;</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24">       // Now we can run our tests</span>
<a href="#l4.25"></a><span id="l4.25">       for (let t of testFuncs)</span>
<a href="#l4.26"></a><span id="l4.26">         t(win);</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">       win.close();</span>
<a href="#l4.29"></a><span id="l4.29">       dmFile.remove(false);</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-      os.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+      Services.obs.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l4.32"></a><span id="l4.32">       SimpleTest.finish();</span>
<a href="#l4.33"></a><span id="l4.33">     }</span>
<a href="#l4.34"></a><span id="l4.34">   };</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36">   // Register with the observer service</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-  os.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+  Services.obs.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40">   // Show the Download Manager UI</span>
<a href="#l4.41"></a><span id="l4.41">   Cc[&quot;@mozilla.org/download-manager-ui;1&quot;]</span>
<a href="#l4.42"></a><span id="l4.42">     .getService(Ci.nsISuiteDownloadManagerUI)</span>
<a href="#l4.43"></a><span id="l4.43">     .showManager();</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45">   SimpleTest.waitForExplicitFinish();</span>
<a href="#l4.46"></a><span id="l4.46"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -158,18 +158,16 @@ function test()</span>
<a href="#l5.4"></a><span id="l5.4">   // First, we clear out the database</span>
<a href="#l5.5"></a><span id="l5.5">   dm.DBConnection.executeSimpleSQL(&quot;DELETE FROM moz_downloads&quot;);</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7">   // See if the DM is already open, and if it is, close it!</span>
<a href="#l5.8"></a><span id="l5.8">   var win = Services.wm.getMostRecentWindow(&quot;Download:Manager&quot;);</span>
<a href="#l5.9"></a><span id="l5.9">   if (win)</span>
<a href="#l5.10"></a><span id="l5.10">     win.close();</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-             .getService(Ci.nsIObserverService);</span>
<a href="#l5.14"></a><span id="l5.14">   const DLMGR_UI_DONE = &quot;download-manager-ui-done&quot;;</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16">   var testObs = {</span>
<a href="#l5.17"></a><span id="l5.17">     observe: function(aSubject, aTopic, aData)</span>
<a href="#l5.18"></a><span id="l5.18">     {</span>
<a href="#l5.19"></a><span id="l5.19">       if (aTopic != DLMGR_UI_DONE)</span>
<a href="#l5.20"></a><span id="l5.20">         return;</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -179,21 +177,21 @@ function test()</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">   function cancelDL(win) {</span>
<a href="#l5.25"></a><span id="l5.25">       var doc = win.document;</span>
<a href="#l5.26"></a><span id="l5.26">       dm.addListener(new dlObs(win));</span>
<a href="#l5.27"></a><span id="l5.27"> </span>
<a href="#l5.28"></a><span id="l5.28">       addDownload();</span>
<a href="#l5.29"></a><span id="l5.29">       // we need to focus the download as well</span>
<a href="#l5.30"></a><span id="l5.30">       doc.getElementById(&quot;downloadTree&quot;).view.selection.select(0);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-      os.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+      Services.obs.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l5.33"></a><span id="l5.33">   }</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35">   // Register with the observer service</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-  os.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+  Services.obs.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">   // Show the Download Manager UI</span>
<a href="#l5.40"></a><span id="l5.40">   Cc[&quot;@mozilla.org/download-manager-ui;1&quot;]</span>
<a href="#l5.41"></a><span id="l5.41">     .getService(Ci.nsISuiteDownloadManagerUI)</span>
<a href="#l5.42"></a><span id="l5.42">     .showManager();</span>
<a href="#l5.43"></a><span id="l5.43"> </span>
<a href="#l5.44"></a><span id="l5.44">   SimpleTest.waitForExplicitFinish();</span>
<a href="#l5.45"></a><span id="l5.45"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_delete_key_removes.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_delete_key_removes.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -134,18 +134,16 @@ function test()</span>
<a href="#l6.4"></a><span id="l6.4">   }</span>
<a href="#l6.5"></a><span id="l6.5">   stmt.finalize();</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">   // See if the DM is already open, and if it is, close it!</span>
<a href="#l6.8"></a><span id="l6.8">   var win = Services.wm.getMostRecentWindow(&quot;Download:Manager&quot;);</span>
<a href="#l6.9"></a><span id="l6.9">   if (win)</span>
<a href="#l6.10"></a><span id="l6.10">     win.close();</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-             .getService(Ci.nsIObserverService);</span>
<a href="#l6.14"></a><span id="l6.14">   const DLMGR_UI_DONE = &quot;download-manager-ui-done&quot;;</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16">   var testObs = {</span>
<a href="#l6.17"></a><span id="l6.17">     observe: function(aSubject, aTopic, aData)</span>
<a href="#l6.18"></a><span id="l6.18">     {</span>
<a href="#l6.19"></a><span id="l6.19">       if (aTopic != DLMGR_UI_DONE)</span>
<a href="#l6.20"></a><span id="l6.20">         return;</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -176,22 +174,22 @@ function test()</span>
<a href="#l6.23"></a><span id="l6.23">       }</span>
<a href="#l6.24"></a><span id="l6.24">       finally {</span>
<a href="#l6.25"></a><span id="l6.25">         stmt.reset();</span>
<a href="#l6.26"></a><span id="l6.26">         stmt.finalize();</span>
<a href="#l6.27"></a><span id="l6.27">       }</span>
<a href="#l6.28"></a><span id="l6.28"> </span>
<a href="#l6.29"></a><span id="l6.29">       win.close();</span>
<a href="#l6.30"></a><span id="l6.30">       dmFile.remove(false);</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-      os.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+      Services.obs.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l6.33"></a><span id="l6.33">       SimpleTest.finish();</span>
<a href="#l6.34"></a><span id="l6.34">   }</span>
<a href="#l6.35"></a><span id="l6.35"> </span>
<a href="#l6.36"></a><span id="l6.36">   // Register with the observer service</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-  os.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+  Services.obs.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40">   // Show the Download Manager UI</span>
<a href="#l6.41"></a><span id="l6.41">   Cc[&quot;@mozilla.org/download-manager-ui;1&quot;]</span>
<a href="#l6.42"></a><span id="l6.42">     .getService(Ci.nsISuiteDownloadManagerUI)</span>
<a href="#l6.43"></a><span id="l6.43">     .showManager();</span>
<a href="#l6.44"></a><span id="l6.44"> </span>
<a href="#l6.45"></a><span id="l6.45">   SimpleTest.waitForExplicitFinish();</span>
<a href="#l6.46"></a><span id="l6.46"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_drag.xul</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_drag.xul</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -141,18 +141,16 @@ function test()</span>
<a href="#l7.4"></a><span id="l7.4">   var dm = Cc[&quot;@mozilla.org/download-manager;1&quot;]</span>
<a href="#l7.5"></a><span id="l7.5">              .getService(Ci.nsIDownloadManager);</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">   // See if the DM is already open, and if it is, close it!</span>
<a href="#l7.8"></a><span id="l7.8">   var win = Services.wm.getMostRecentWindow(&quot;Download:Manager&quot;);</span>
<a href="#l7.9"></a><span id="l7.9">   if (win)</span>
<a href="#l7.10"></a><span id="l7.10">     win.close();</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-             .getService(Ci.nsIObserverService);</span>
<a href="#l7.14"></a><span id="l7.14">   const DLMGR_UI_DONE = &quot;download-manager-ui-done&quot;;</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">   // load files into db</span>
<a href="#l7.17"></a><span id="l7.17">   var db = dm.DBConnection;</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">   var stmt = db.createStatement(</span>
<a href="#l7.20"></a><span id="l7.20">     &quot;INSERT INTO moz_downloads ( name,  source,  target,  state)&quot; +</span>
<a href="#l7.21"></a><span id="l7.21">     &quot;VALUES                    (:name, :source, :target, :state)&quot;);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -179,23 +177,23 @@ function test()</span>
<a href="#l7.23"></a><span id="l7.23">       var result = mouseDragStartOnCell(downloadTree, 0, 4, win, dragRealFile);</span>
<a href="#l7.24"></a><span id="l7.24">       is(result, null, &quot;Checking for Real file match&quot;);</span>
<a href="#l7.25"></a><span id="l7.25">       result = mouseDragStartOnCell(downloadTree, 1, 4, win, dragMissingFile);</span>
<a href="#l7.26"></a><span id="l7.26">       isnot(result, null, &quot;Drag start did not return item for missing file&quot;);</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28">       // Done.</span>
<a href="#l7.29"></a><span id="l7.29">       win.close();</span>
<a href="#l7.30"></a><span id="l7.30">       realFile.remove(false);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-      os.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+      Services.obs.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l7.33"></a><span id="l7.33">       SimpleTest.finish();</span>
<a href="#l7.34"></a><span id="l7.34">     }</span>
<a href="#l7.35"></a><span id="l7.35">   };</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37">   // Register with the observer service</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-  os.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+  Services.obs.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l7.40"></a><span id="l7.40"> </span>
<a href="#l7.41"></a><span id="l7.41">   // Show the Download Manager UI</span>
<a href="#l7.42"></a><span id="l7.42">   Cc[&quot;@mozilla.org/download-manager-ui;1&quot;]</span>
<a href="#l7.43"></a><span id="l7.43">     .getService(Ci.nsISuiteDownloadManagerUI)</span>
<a href="#l7.44"></a><span id="l7.44">     .showManager();</span>
<a href="#l7.45"></a><span id="l7.45"> </span>
<a href="#l7.46"></a><span id="l7.46">   SimpleTest.waitForExplicitFinish();</span>
<a href="#l7.47"></a><span id="l7.47"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -94,18 +94,16 @@ function test()</span>
<a href="#l8.4"></a><span id="l8.4">   }</span>
<a href="#l8.5"></a><span id="l8.5">   stmt.finalize();</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7">   // See if the DM is already open, and if it is, close it!</span>
<a href="#l8.8"></a><span id="l8.8">   var win = Services.wm.getMostRecentWindow(&quot;Download:Manager&quot;);</span>
<a href="#l8.9"></a><span id="l8.9">   if (win)</span>
<a href="#l8.10"></a><span id="l8.10">     win.close();</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-             .getService(Ci.nsIObserverService);</span>
<a href="#l8.14"></a><span id="l8.14">   const DLMGR_UI_DONE = &quot;download-manager-ui-done&quot;;</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16">   var testObs = {</span>
<a href="#l8.17"></a><span id="l8.17">     observe: function(aSubject, aTopic, aData)</span>
<a href="#l8.18"></a><span id="l8.18">     {</span>
<a href="#l8.19"></a><span id="l8.19">       if (aTopic != DLMGR_UI_DONE)</span>
<a href="#l8.20"></a><span id="l8.20">         return;</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -126,23 +124,23 @@ function test()</span>
<a href="#l8.23"></a><span id="l8.23"> </span>
<a href="#l8.24"></a><span id="l8.24">       dm.removeDownload(id);</span>
<a href="#l8.25"></a><span id="l8.25">       var dlTreeView = doc.getElementById(&quot;downloadTree&quot;).view;</span>
<a href="#l8.26"></a><span id="l8.26">       is(dlTreeView.rowCount, 0,</span>
<a href="#l8.27"></a><span id="l8.27">          &quot;The download was properly removed&quot;);</span>
<a href="#l8.28"></a><span id="l8.28"> </span>
<a href="#l8.29"></a><span id="l8.29">       win.close();</span>
<a href="#l8.30"></a><span id="l8.30">       dmFile.remove(false);</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-      os.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+      Services.obs.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l8.33"></a><span id="l8.33">       SimpleTest.finish();</span>
<a href="#l8.34"></a><span id="l8.34">     }</span>
<a href="#l8.35"></a><span id="l8.35">   }</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37">   // Register with the observer service</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-  os.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+  Services.obs.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l8.40"></a><span id="l8.40"> </span>
<a href="#l8.41"></a><span id="l8.41">   // Show the Download Manager UI</span>
<a href="#l8.42"></a><span id="l8.42">   Cc[&quot;@mozilla.org/download-manager-ui;1&quot;]</span>
<a href="#l8.43"></a><span id="l8.43">     .getService(Ci.nsISuiteDownloadManagerUI)</span>
<a href="#l8.44"></a><span id="l8.44">     .showManager();</span>
<a href="#l8.45"></a><span id="l8.45"> </span>
<a href="#l8.46"></a><span id="l8.46">   SimpleTest.waitForExplicitFinish();</span>
<a href="#l8.47"></a><span id="l8.47"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_search_keys.xul</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_search_keys.xul</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -82,18 +82,16 @@ function test()</span>
<a href="#l9.4"></a><span id="l9.4">   var dm = Cc[&quot;@mozilla.org/download-manager;1&quot;]</span>
<a href="#l9.5"></a><span id="l9.5">              .getService(Ci.nsIDownloadManager);</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7">   // See if the DM is already open, and if it is, close it!</span>
<a href="#l9.8"></a><span id="l9.8">   var win = Services.wm.getMostRecentWindow(&quot;Download:Manager&quot;);</span>
<a href="#l9.9"></a><span id="l9.9">   if (win)</span>
<a href="#l9.10"></a><span id="l9.10">     win.close();</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-             .getService(Ci.nsIObserverService);</span>
<a href="#l9.14"></a><span id="l9.14">   const DLMGR_UI_DONE = &quot;download-manager-ui-done&quot;;</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16">   var testObs = {</span>
<a href="#l9.17"></a><span id="l9.17">     observe: function(aSubject, aTopic, aData)</span>
<a href="#l9.18"></a><span id="l9.18">     {</span>
<a href="#l9.19"></a><span id="l9.19">       if (aTopic != DLMGR_UI_DONE)</span>
<a href="#l9.20"></a><span id="l9.20">         return;</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -102,22 +100,22 @@ function test()</span>
<a href="#l9.23"></a><span id="l9.23">   };</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25">   function continueTest(win) {</span>
<a href="#l9.26"></a><span id="l9.26">       // Now we can run our tests</span>
<a href="#l9.27"></a><span id="l9.27">       for (let t of testFuncs)</span>
<a href="#l9.28"></a><span id="l9.28">         t(win);</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30">       win.close();</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-      os.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+      Services.obs.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l9.33"></a><span id="l9.33">       SimpleTest.finish();</span>
<a href="#l9.34"></a><span id="l9.34">   }</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36">   // Register with the observer service</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-  os.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+  Services.obs.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40">   // Show the Download Manager UI</span>
<a href="#l9.41"></a><span id="l9.41">   Cc[&quot;@mozilla.org/download-manager-ui;1&quot;]</span>
<a href="#l9.42"></a><span id="l9.42">     .getService(Ci.nsISuiteDownloadManagerUI)</span>
<a href="#l9.43"></a><span id="l9.43">     .showManager();</span>
<a href="#l9.44"></a><span id="l9.44"> </span>
<a href="#l9.45"></a><span id="l9.45">   SimpleTest.waitForExplicitFinish();</span>
<a href="#l9.46"></a><span id="l9.46"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -179,18 +179,16 @@ function test()</span>
<a href="#l10.4"></a><span id="l10.4">   // First, we clear out the database</span>
<a href="#l10.5"></a><span id="l10.5">   dm.DBConnection.executeSimpleSQL(&quot;DELETE FROM moz_downloads&quot;);</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7">   // See if the DM is already open, and if it is, close it!</span>
<a href="#l10.8"></a><span id="l10.8">   var win = Services.wm.getMostRecentWindow(&quot;Download:Manager&quot;);</span>
<a href="#l10.9"></a><span id="l10.9">   if (win)</span>
<a href="#l10.10"></a><span id="l10.10">     win.close();</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-             .getService(Ci.nsIObserverService);</span>
<a href="#l10.14"></a><span id="l10.14">   const DLMGR_UI_DONE = &quot;download-manager-ui-done&quot;;</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16">   var testObs = {</span>
<a href="#l10.17"></a><span id="l10.17">     observe: function(aSubject, aTopic, aData)</span>
<a href="#l10.18"></a><span id="l10.18">     {</span>
<a href="#l10.19"></a><span id="l10.19">       if (aTopic != DLMGR_UI_DONE)</span>
<a href="#l10.20"></a><span id="l10.20">         return;</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -200,21 +198,21 @@ function test()</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24">   function continueTest(win) {</span>
<a href="#l10.25"></a><span id="l10.25">       var doc = win.document;</span>
<a href="#l10.26"></a><span id="l10.26">       dm.addListener(new bug413985obs(win));</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">       addDownload();</span>
<a href="#l10.29"></a><span id="l10.29">       // we need to focus the download as well</span>
<a href="#l10.30"></a><span id="l10.30">       doc.getElementById(&quot;downloadTree&quot;).view.selection.select(0);</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-      os.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+      Services.obs.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l10.33"></a><span id="l10.33">   }</span>
<a href="#l10.34"></a><span id="l10.34"> </span>
<a href="#l10.35"></a><span id="l10.35">   // Register with the observer service</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-  os.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+  Services.obs.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l10.38"></a><span id="l10.38"> </span>
<a href="#l10.39"></a><span id="l10.39">   // Show the Download Manager UI</span>
<a href="#l10.40"></a><span id="l10.40">   Cc[&quot;@mozilla.org/download-manager-ui;1&quot;]</span>
<a href="#l10.41"></a><span id="l10.41">     .getService(Ci.nsISuiteDownloadManagerUI)</span>
<a href="#l10.42"></a><span id="l10.42">     .showManager();</span>
<a href="#l10.43"></a><span id="l10.43"> </span>
<a href="#l10.44"></a><span id="l10.44">   SimpleTest.waitForExplicitFinish();</span>
<a href="#l10.45"></a><span id="l10.45"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_space_key_retries.xul</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_space_key_retries.xul</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -156,18 +156,16 @@ function test()</span>
<a href="#l11.4"></a><span id="l11.4">   // First, we clear out the database</span>
<a href="#l11.5"></a><span id="l11.5">   dm.DBConnection.executeSimpleSQL(&quot;DELETE FROM moz_downloads&quot;);</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7">   // See if the DM is already open, and if it is, close it!</span>
<a href="#l11.8"></a><span id="l11.8">   var win = Services.wm.getMostRecentWindow(&quot;Download:Manager&quot;);</span>
<a href="#l11.9"></a><span id="l11.9">   if (win)</span>
<a href="#l11.10"></a><span id="l11.10">     win.close();</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-             .getService(Ci.nsIObserverService);</span>
<a href="#l11.14"></a><span id="l11.14">   const DLMGR_UI_DONE = &quot;download-manager-ui-done&quot;;</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16">   var testObs = {</span>
<a href="#l11.17"></a><span id="l11.17">     observe: function(aSubject, aTopic, aData)</span>
<a href="#l11.18"></a><span id="l11.18">     {</span>
<a href="#l11.19"></a><span id="l11.19">       if (aTopic != DLMGR_UI_DONE)</span>
<a href="#l11.20"></a><span id="l11.20">         return;</span>
<a href="#l11.21"></a><span id="l11.21"> </span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -177,21 +175,21 @@ function test()</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24">   function continueTest(win) {</span>
<a href="#l11.25"></a><span id="l11.25">       var doc = win.document;</span>
<a href="#l11.26"></a><span id="l11.26">       dm.addListener(new dlObs(win));</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28">       addDownload();</span>
<a href="#l11.29"></a><span id="l11.29">       // we need to focus the download as well</span>
<a href="#l11.30"></a><span id="l11.30">       doc.getElementById(&quot;downloadTree&quot;).view.selection.select(0);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-      os.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+      Services.obs.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l11.33"></a><span id="l11.33">   }</span>
<a href="#l11.34"></a><span id="l11.34"> </span>
<a href="#l11.35"></a><span id="l11.35">   // Register with the observer service</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-  os.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+  Services.obs.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l11.38"></a><span id="l11.38"> </span>
<a href="#l11.39"></a><span id="l11.39">   // Show the Download Manager UI</span>
<a href="#l11.40"></a><span id="l11.40">   Cc[&quot;@mozilla.org/download-manager-ui;1&quot;]</span>
<a href="#l11.41"></a><span id="l11.41">     .getService(Ci.nsISuiteDownloadManagerUI)</span>
<a href="#l11.42"></a><span id="l11.42">     .showManager();</span>
<a href="#l11.43"></a><span id="l11.43"> </span>
<a href="#l11.44"></a><span id="l11.44">   SimpleTest.waitForExplicitFinish();</span>
<a href="#l11.45"></a><span id="l11.45"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_ui_stays_open_on_alert_clickback.xul</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_ui_stays_open_on_alert_clickback.xul</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -66,18 +66,16 @@ function test()</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5">   var setClose = aVal =&gt;</span>
<a href="#l12.6"></a><span id="l12.6">     Services.prefs.setBoolPref(&quot;browser.download.manager.closeWhenDone&quot;, aVal);</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8">   // Close the UI if necessary</span>
<a href="#l12.9"></a><span id="l12.9">   var win = Services.wm.getMostRecentWindow(&quot;Download:Manager&quot;);</span>
<a href="#l12.10"></a><span id="l12.10">   if (win) win.close();</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-             .getService(Ci.nsIObserverService);</span>
<a href="#l12.14"></a><span id="l12.14">   const DLMGR_UI_DONE = &quot;download-manager-ui-done&quot;;</span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16">   var testObs = {</span>
<a href="#l12.17"></a><span id="l12.17">     observe: function(aSubject, aTopic, aData)</span>
<a href="#l12.18"></a><span id="l12.18">     {</span>
<a href="#l12.19"></a><span id="l12.19">       if (aTopic != DLMGR_UI_DONE)</span>
<a href="#l12.20"></a><span id="l12.20">         return;</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -87,23 +85,23 @@ function test()</span>
<a href="#l12.23"></a><span id="l12.23">       //        synchronously in Startup in downloads.js</span>
<a href="#l12.24"></a><span id="l12.24">       // Make sure the window stays open</span>
<a href="#l12.25"></a><span id="l12.25">       var dmui = Cc[&quot;@mozilla.org/download-manager-ui;1&quot;]</span>
<a href="#l12.26"></a><span id="l12.26">                    .getService(Ci.nsIDownloadManagerUI);</span>
<a href="#l12.27"></a><span id="l12.27">       ok(dmui.visible, &quot;Download Manager stays open on alert click&quot;);</span>
<a href="#l12.28"></a><span id="l12.28"> </span>
<a href="#l12.29"></a><span id="l12.29">       win.close();</span>
<a href="#l12.30"></a><span id="l12.30">       setClose(false);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-      os.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+      Services.obs.removeObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l12.33"></a><span id="l12.33">       SimpleTest.finish();</span>
<a href="#l12.34"></a><span id="l12.34">     }</span>
<a href="#l12.35"></a><span id="l12.35">   };</span>
<a href="#l12.36"></a><span id="l12.36"> </span>
<a href="#l12.37"></a><span id="l12.37">   // Register with the observer service</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-  os.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+  Services.obs.addObserver(testObs, DLMGR_UI_DONE);</span>
<a href="#l12.40"></a><span id="l12.40"> </span>
<a href="#l12.41"></a><span id="l12.41">   // Simulate an alert click with pref set to true</span>
<a href="#l12.42"></a><span id="l12.42">   setClose(true);</span>
<a href="#l12.43"></a><span id="l12.43">   dm.QueryInterface(Ci.nsIObserver)</span>
<a href="#l12.44"></a><span id="l12.44">     .observe(null, &quot;alertclickcallback&quot;, null);</span>
<a href="#l12.45"></a><span id="l12.45"> </span>
<a href="#l12.46"></a><span id="l12.46">   SimpleTest.waitForExplicitFinish();</span>
<a href="#l12.47"></a><span id="l12.47"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/suite/components/places/nsPlacesAutoComplete.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/suite/components/places/nsPlacesAutoComplete.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -455,20 +455,17 @@ function nsPlacesAutoComplete()</span>
<a href="#l13.4"></a><span id="l13.4">   // load preferences</span>
<a href="#l13.5"></a><span id="l13.5">   this._prefs = Cc[&quot;@mozilla.org/preferences-service;1&quot;].</span>
<a href="#l13.6"></a><span id="l13.6">                 getService(Ci.nsIPrefService).</span>
<a href="#l13.7"></a><span id="l13.7">                 getBranch(kBrowserUrlbarBranch);</span>
<a href="#l13.8"></a><span id="l13.8">   this._syncEnabledPref();</span>
<a href="#l13.9"></a><span id="l13.9">   this._loadPrefs(true);</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11">   // register observers</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  this._os = Cc[&quot;@mozilla.org/observer-service;1&quot;].</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-              getService(Ci.nsIObserverService);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-  this._os.addObserver(this, kTopicShutdown);</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+  Services.obs.addObserver(this, kTopicShutdown);</span>
<a href="#l13.17"></a><span id="l13.17"> }</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19"> nsPlacesAutoComplete.prototype = {</span>
<a href="#l13.20"></a><span id="l13.20">   //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.21"></a><span id="l13.21">   //// nsIAutoCompleteSearch</span>
<a href="#l13.22"></a><span id="l13.22"> </span>
<a href="#l13.23"></a><span id="l13.23">   startSearch: function PAC_startSearch(aSearchString, aSearchParam,</span>
<a href="#l13.24"></a><span id="l13.24">                                         aPreviousResult, aListener)</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineat">@@ -650,17 +647,17 @@ nsPlacesAutoComplete.prototype = {</span>
<a href="#l13.26"></a><span id="l13.26">   },</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28">   //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.29"></a><span id="l13.29">   //// nsIObserver</span>
<a href="#l13.30"></a><span id="l13.30"> </span>
<a href="#l13.31"></a><span id="l13.31">   observe: function PAC_observe(aSubject, aTopic, aData)</span>
<a href="#l13.32"></a><span id="l13.32">   {</span>
<a href="#l13.33"></a><span id="l13.33">     if (aTopic == kTopicShutdown) {</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-      this._os.removeObserver(this, kTopicShutdown);</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+      Services.obs.removeObserver(this, kTopicShutdown);</span>
<a href="#l13.36"></a><span id="l13.36"> </span>
<a href="#l13.37"></a><span id="l13.37">       // Remove our preference observer.</span>
<a href="#l13.38"></a><span id="l13.38">       this._prefs.removeObserver(&quot;&quot;, this);</span>
<a href="#l13.39"></a><span id="l13.39">       delete this._prefs;</span>
<a href="#l13.40"></a><span id="l13.40"> </span>
<a href="#l13.41"></a><span id="l13.41">       // Finalize the statements that we have used.</span>
<a href="#l13.42"></a><span id="l13.42">       let stmts = [</span>
<a href="#l13.43"></a><span id="l13.43">         &quot;_defaultQuery&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/suite/components/places/tests/unit/test_browserGlue_prefs.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/suite/components/places/tests/unit/test_browserGlue_prefs.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -17,19 +17,16 @@ var bg = Cc[&quot;@mozilla.org/suite/suiteglu</span>
<a href="#l14.4"></a><span id="l14.4">          getService(Ci.nsISuiteGlue);</span>
<a href="#l14.5"></a><span id="l14.5"> */</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> // Initialize Places through Bookmarks Service.</span>
<a href="#l14.8"></a><span id="l14.8"> var bs = Cc[&quot;@mozilla.org/browser/nav-bookmarks-service;1&quot;].</span>
<a href="#l14.9"></a><span id="l14.9">          getService(Ci.nsINavBookmarksService);</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> // Get other services.</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-var os = Cc[&quot;@mozilla.org/observer-service;1&quot;].</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-         getService(Ci.nsIObserverService);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-</span>
<a href="#l14.15"></a><span id="l14.15"> const PREF_IMPORT_BOOKMARKS_HTML = &quot;browser.places.importBookmarksHTML&quot;;</span>
<a href="#l14.16"></a><span id="l14.16"> const PREF_RESTORE_DEFAULT_BOOKMARKS = &quot;browser.bookmarks.restore_default_bookmarks&quot;;</span>
<a href="#l14.17"></a><span id="l14.17"> const PREF_SMART_BOOKMARKS_VERSION = &quot;browser.places.smartBookmarksVersion&quot;;</span>
<a href="#l14.18"></a><span id="l14.18"> const PREF_AUTO_EXPORT_HTML = &quot;browser.bookmarks.autoExportHTML&quot;;</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20"> function waitForImportAndSmartBookmarks(aCallback) {</span>
<a href="#l14.21"></a><span id="l14.21">   Services.obs.addObserver(function waitImport() {</span>
<a href="#l14.22"></a><span id="l14.22">     Services.obs.removeObserver(waitImport, &quot;bookmarks-restore-success&quot;);</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineat">@@ -229,20 +226,20 @@ function finish_test() {</span>
<a href="#l14.24"></a><span id="l14.24">   do_test_finished();</span>
<a href="#l14.25"></a><span id="l14.25"> }</span>
<a href="#l14.26"></a><span id="l14.26"> var testIndex = 0;</span>
<a href="#l14.27"></a><span id="l14.27"> function next_test() {</span>
<a href="#l14.28"></a><span id="l14.28">   // Clean up database from all bookmarks.</span>
<a href="#l14.29"></a><span id="l14.29">   remove_all_bookmarks();</span>
<a href="#l14.30"></a><span id="l14.30">   // nsSuiteGlue stops observing topics after first notification,</span>
<a href="#l14.31"></a><span id="l14.31">   // so we add back the observer to test additional runs.</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-  os.addObserver(bg.QueryInterface(Ci.nsIObserver),</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-                 PlacesUtils.TOPIC_INIT_COMPLETE);</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-  os.addObserver(bg.QueryInterface(Ci.nsIObserver),</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-                 PlacesUtils.TOPIC_DATABASE_LOCKED);</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+  Services.obs.addObserver(bg.QueryInterface(Ci.nsIObserver),</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+                           PlacesUtils.TOPIC_INIT_COMPLETE);</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+  Services.obs.addObserver(bg.QueryInterface(Ci.nsIObserver),</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+                           PlacesUtils.TOPIC_DATABASE_LOCKED);</span>
<a href="#l14.40"></a><span id="l14.40">   // Execute next test.</span>
<a href="#l14.41"></a><span id="l14.41">   let test = tests.shift();</span>
<a href="#l14.42"></a><span id="l14.42">   print(&quot;\nTEST &quot; + (++testIndex) + &quot;: &quot; + test.description);</span>
<a href="#l14.43"></a><span id="l14.43">   test.exec();</span>
<a href="#l14.44"></a><span id="l14.44"> }</span>
<a href="#l14.45"></a><span id="l14.45"> function run_test() {</span>
<a href="#l14.46"></a><span id="l14.46">   // Bug 539067: disabled due to random failures and timeouts.</span>
<a href="#l14.47"></a><span id="l14.47">   return;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/components/places/tests/unit/test_browserGlue_shutdown.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/components/places/tests/unit/test_browserGlue_shutdown.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -12,63 +12,60 @@</span>
<a href="#l15.4"></a><span id="l15.4"> // Initialize nsSuiteGlue after Places.</span>
<a href="#l15.5"></a><span id="l15.5"> var bg = Cc[&quot;@mozilla.org/suite/suiteglue;1&quot;].</span>
<a href="#l15.6"></a><span id="l15.6">          getService(Ci.nsISuiteGlue);</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> // Initialize Places through Bookmarks Service.</span>
<a href="#l15.9"></a><span id="l15.9"> var bs = PlacesUtils.bookmarks;</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11"> // Get other services.</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-var ps = Services.prefs;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-var os = Services.obs;</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-</span>
<a href="#l15.15"></a><span id="l15.15"> const PREF_AUTO_EXPORT_HTML = &quot;browser.bookmarks.autoExportHTML&quot;;</span>
<a href="#l15.16"></a><span id="l15.16"> </span>
<a href="#l15.17"></a><span id="l15.17"> var tests = [];</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19"> //------------------------------------------------------------------------------</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21"> tests.push({</span>
<a href="#l15.22"></a><span id="l15.22">   description: &quot;Export to bookmarks.html if autoExportHTML is true.&quot;,</span>
<a href="#l15.23"></a><span id="l15.23">   exec: function() {</span>
<a href="#l15.24"></a><span id="l15.24">     // Sanity check: we should have bookmarks on the toolbar.</span>
<a href="#l15.25"></a><span id="l15.25">     do_check_true(bs.getIdForItemAt(bs.toolbarFolder, 0) &gt; 0);</span>
<a href="#l15.26"></a><span id="l15.26"> </span>
<a href="#l15.27"></a><span id="l15.27">     // Set preferences.</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-    ps.setBoolPref(PREF_AUTO_EXPORT_HTML, true);</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+    Services.prefs.setBoolPref(PREF_AUTO_EXPORT_HTML);</span>
<a href="#l15.30"></a><span id="l15.30"> </span>
<a href="#l15.31"></a><span id="l15.31">     // Force nsSuiteGlue::_shutdownPlaces().</span>
<a href="#l15.32"></a><span id="l15.32">     bg.QueryInterface(Ci.nsIObserver).observe(null,</span>
<a href="#l15.33"></a><span id="l15.33">                                               PlacesUtils.TOPIC_SHUTDOWN,</span>
<a href="#l15.34"></a><span id="l15.34">                                               null);</span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36">     // Check bookmarks.html has been created.</span>
<a href="#l15.37"></a><span id="l15.37">     check_bookmarks_html();</span>
<a href="#l15.38"></a><span id="l15.38">     // Check JSON backup has been created.</span>
<a href="#l15.39"></a><span id="l15.39">     check_JSON_backup();</span>
<a href="#l15.40"></a><span id="l15.40"> </span>
<a href="#l15.41"></a><span id="l15.41">     // Check preferences have not been reverted.</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-    do_check_true(ps.getBoolPref(PREF_AUTO_EXPORT_HTML));</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+    do_check_true(Services.prefs.getBoolPref(PREF_AUTO_EXPORT_HTML));</span>
<a href="#l15.44"></a><span id="l15.44">     // Reset preferences.</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-    ps.setBoolPref(PREF_AUTO_EXPORT_HTML, false);</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+    Services.prefs.setBoolPref(PREF_AUTO_EXPORT_HTML, false);</span>
<a href="#l15.47"></a><span id="l15.47"> </span>
<a href="#l15.48"></a><span id="l15.48">     next_test();</span>
<a href="#l15.49"></a><span id="l15.49">   }</span>
<a href="#l15.50"></a><span id="l15.50"> });</span>
<a href="#l15.51"></a><span id="l15.51"> </span>
<a href="#l15.52"></a><span id="l15.52"> //------------------------------------------------------------------------------</span>
<a href="#l15.53"></a><span id="l15.53"> </span>
<a href="#l15.54"></a><span id="l15.54"> tests.push({</span>
<a href="#l15.55"></a><span id="l15.55">   description: &quot;Export to bookmarks.html if autoExportHTML is true and a bookmarks.html exists.&quot;,</span>
<a href="#l15.56"></a><span id="l15.56">   exec: function() {</span>
<a href="#l15.57"></a><span id="l15.57">     // Sanity check: we should have bookmarks on the toolbar.</span>
<a href="#l15.58"></a><span id="l15.58">     do_check_true(bs.getIdForItemAt(bs.toolbarFolder, 0) &gt; 0);</span>
<a href="#l15.59"></a><span id="l15.59"> </span>
<a href="#l15.60"></a><span id="l15.60">     // Set preferences.</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-    ps.setBoolPref(PREF_AUTO_EXPORT_HTML, true);</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineplus">+    Services.prefs.setBoolPref(PREF_AUTO_EXPORT_HTML, true);</span>
<a href="#l15.63"></a><span id="l15.63"> </span>
<a href="#l15.64"></a><span id="l15.64">     // Create a bookmarks.html in the profile.</span>
<a href="#l15.65"></a><span id="l15.65">     let profileBookmarksHTMLFile = create_bookmarks_html(&quot;bookmarks.glue.html&quot;);</span>
<a href="#l15.66"></a><span id="l15.66">     // Get file lastModified and size.</span>
<a href="#l15.67"></a><span id="l15.67">     let lastMod = profileBookmarksHTMLFile.lastModifiedTime;</span>
<a href="#l15.68"></a><span id="l15.68">     let fileSize = profileBookmarksHTMLFile.fileSize;</span>
<a href="#l15.69"></a><span id="l15.69"> </span>
<a href="#l15.70"></a><span id="l15.70">     // Force nsSuiteGlue::_shutdownPlaces().</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineat">@@ -78,19 +75,19 @@ tests.push({</span>
<a href="#l15.72"></a><span id="l15.72"> </span>
<a href="#l15.73"></a><span id="l15.73">     // Check a new bookmarks.html has been created.</span>
<a href="#l15.74"></a><span id="l15.74">     let profileBookmarksHTMLFile = check_bookmarks_html();</span>
<a href="#l15.75"></a><span id="l15.75">     //XXX not working on Linux unit boxes. Could be filestats caching issue.</span>
<a href="#l15.76"></a><span id="l15.76">     //do_check_true(profileBookmarksHTMLFile.lastModifiedTime &gt; lastMod);</span>
<a href="#l15.77"></a><span id="l15.77">     do_check_neq(profileBookmarksHTMLFile.fileSize, fileSize);</span>
<a href="#l15.78"></a><span id="l15.78"> </span>
<a href="#l15.79"></a><span id="l15.79">     // Check preferences have not been reverted.</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineminus">-    do_check_true(ps.getBoolPref(PREF_AUTO_EXPORT_HTML));</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+    do_check_true(Services.prefs.getBoolPref(PREF_AUTO_EXPORT_HTML));</span>
<a href="#l15.82"></a><span id="l15.82">     // Reset preferences.</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineminus">-    ps.setBoolPref(PREF_AUTO_EXPORT_HTML, false);</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineplus">+    Services.prefs.setBoolPref(PREF_AUTO_EXPORT_HTML, false);</span>
<a href="#l15.85"></a><span id="l15.85"> </span>
<a href="#l15.86"></a><span id="l15.86">     next_test();</span>
<a href="#l15.87"></a><span id="l15.87">   }</span>
<a href="#l15.88"></a><span id="l15.88"> });</span>
<a href="#l15.89"></a><span id="l15.89"> </span>
<a href="#l15.90"></a><span id="l15.90"> //------------------------------------------------------------------------------</span>
<a href="#l15.91"></a><span id="l15.91"> </span>
<a href="#l15.92"></a><span id="l15.92"> tests.push({</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/modules/Sanitizer.jsm</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/modules/Sanitizer.jsm</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -189,19 +189,17 @@ var Sanitizer = {</span>
<a href="#l16.4"></a><span id="l16.4">         const {PlacesUtils} = ChromeUtils.import(&quot;resource://gre/modules/PlacesUtils.jsm&quot;);</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6">         // use try/catch for everything but the last task so we clear as much as possible</span>
<a href="#l16.7"></a><span id="l16.7">         try {</span>
<a href="#l16.8"></a><span id="l16.8">           PlacesUtils.history.clear();</span>
<a href="#l16.9"></a><span id="l16.9">         } catch(ex) {}</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11">         try {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-          var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-                     .getService(Ci.nsIObserverService);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-          os.notifyObservers(null, &quot;browser:purge-session-history&quot;);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+          Services.obs.notifyObservers(null, &quot;browser:purge-session-history&quot;);</span>
<a href="#l16.16"></a><span id="l16.16">         } catch(ex) {}</span>
<a href="#l16.17"></a><span id="l16.17">       },</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">         // bug 347231: Always allow clearing history due to dependencies on</span>
<a href="#l16.20"></a><span id="l16.20">         // the browser:purge-session-history notification. (like error console)</span>
<a href="#l16.21"></a><span id="l16.21">       canClear: true</span>
<a href="#l16.22"></a><span id="l16.22">     },</span>
<a href="#l16.23"></a><span id="l16.23"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

