<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 11824:3b6458d6554349de71931b0ec8bcef15f60a0c88</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 3b6458d6554349de71931b0ec8bcef15f60a0c88" />
<meta property="og:url" content="/comm-central/rev/3b6458d6554349de71931b0ec8bcef15f60a0c88" />
<meta property="og:description" content="Bug 404580 Provide information like preview text, subject and sender in mail notification window - as in Thunderbird ui-r=Neil r=Neil." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 3b6458d6554349de71931b0ec8bcef15f60a0c88 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/3b6458d6554349de71931b0ec8bcef15f60a0c88">shortlog</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/3b6458d6554349de71931b0ec8bcef15f60a0c88">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88">files</a> |
changeset |
<a href="/comm-central/raw-rev/3b6458d6554349de71931b0ec8bcef15f60a0c88">raw</a>  | <a href="/comm-central/archive/3b6458d6554349de71931b0ec8bcef15f60a0c88.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=404580">Bug 404580</a> Provide information like preview text, subject and sender in mail notification window - as in Thunderbird ui-r=Neil r=Neil.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#32;&#67;&#104;&#101;&#101;&#32;&#60;&#112;&#104;&#105;&#108;&#105;&#112;&#46;&#99;&#104;&#101;&#101;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 17 Jan 2013 21:37:34 +0800</td></tr>

<tr>
 <td>changeset 11824</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/3b6458d6554349de71931b0ec8bcef15f60a0c88">3b6458d6554349de71931b0ec8bcef15f60a0c88</a></td>
</tr>



<tr>
<td>parent 11823</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9876dc5fd5072688c0841347793a6c6388cb9904">9876dc5fd5072688c0841347793a6c6388cb9904</a>
</td>
</tr>

<tr>
<td>child 11825</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/393bcf57ae3143521729b1741e997c7b6cc76ea1">393bcf57ae3143521729b1741e997c7b6cc76ea1</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=3b6458d6554349de71931b0ec8bcef15f60a0c88">8805</a></td></tr>
<tr><td>push user</td><td>philip.chee@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 17 Jan 2013 13:41:27 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@3b6458d65543 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3b6458d6554349de71931b0ec8bcef15f60a0c88">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3b6458d6554349de71931b0ec8bcef15f60a0c88&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3b6458d6554349de71931b0ec8bcef15f60a0c88&newProject=comm-central&newRevision=3b6458d6554349de71931b0ec8bcef15f60a0c88&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3b6458d6554349de71931b0ec8bcef15f60a0c88&newProject=comm-central&newRevision=3b6458d6554349de71931b0ec8bcef15f60a0c88&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3b6458d6554349de71931b0ec8bcef15f60a0c88&newProject=comm-central&newRevision=3b6458d6554349de71931b0ec8bcef15f60a0c88&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a>, <a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=404580">404580</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=404580">Bug 404580</a> Provide information like preview text, subject and sender in mail notification window - as in Thunderbird ui-r=Neil r=Neil.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.cpp">mailnews/base/src/nsMessengerUnixIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.cpp">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.cpp">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.h">mailnews/base/src/nsMessengerUnixIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.h">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.h">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.h">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.h">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerUnixIntegration.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.cpp">mailnews/base/src/nsMessengerWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.h">mailnews/base/src/nsMessengerWinIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.h">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.h">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.h">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.h">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/mailnews/base/src/nsMessengerWinIntegration.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/browser/browser-prefs.js">suite/browser/browser-prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/browser/browser-prefs.js">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/browser/browser-prefs.js">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/browser/browser-prefs.js">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/browser/browser-prefs.js">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/browser/browser-prefs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/locales/en-US/chrome/mailnews/messenger.properties">suite/locales/en-US/chrome/mailnews/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/locales/en-US/chrome/mailnews/messenger.properties">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/locales/en-US/chrome/mailnews/messenger.properties">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/locales/en-US/chrome/mailnews/messenger.properties">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/locales/en-US/chrome/mailnews/messenger.properties">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/locales/en-US/chrome/mailnews/messenger.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/jar.mn">suite/mailnews/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/jar.mn">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/jar.mn">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/jar.mn">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/jar.mn">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.css">suite/mailnews/newmailalert.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.css">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.css">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.css">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.css">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.js">suite/mailnews/newmailalert.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.js">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.js">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.js">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.js">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.xul">suite/mailnews/newmailalert.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.xul">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.xul">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.xul">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.xul">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/mailnews/newmailalert.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/jar.mn">suite/themes/classic/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/jar.mn">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/jar.mn">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/jar.mn">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/jar.mn">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/messenger/newmailalert.css">suite/themes/classic/messenger/newmailalert.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/messenger/newmailalert.css">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/messenger/newmailalert.css">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/messenger/newmailalert.css">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/messenger/newmailalert.css">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/classic/messenger/newmailalert.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/jar.mn">suite/themes/modern/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/jar.mn">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/jar.mn">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/jar.mn">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/jar.mn">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/messenger/newmailalert.css">suite/themes/modern/messenger/newmailalert.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/messenger/newmailalert.css">file</a> |
<a href="/comm-central/annotate/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/messenger/newmailalert.css">annotate</a> |
<a href="/comm-central/diff/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/messenger/newmailalert.css">diff</a> |
<a href="/comm-central/comparison/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/messenger/newmailalert.css">comparison</a> |
<a href="/comm-central/log/3b6458d6554349de71931b0ec8bcef15f60a0c88/suite/themes/modern/messenger/newmailalert.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -145,17 +145,16 @@ nsresult nsMessengerUnixIntegration::Get</span>
<a href="#l1.4"></a><span id="l1.4">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l1.5"></a><span id="l1.5">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l1.6"></a><span id="l1.6">   bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l1.7"></a><span id="l1.7">                               getter_AddRefs(bundle));</span>
<a href="#l1.8"></a><span id="l1.8">   bundle.swap(*aBundle);</span>
<a href="#l1.9"></a><span id="l1.9">   return NS_OK;</span>
<a href="#l1.10"></a><span id="l1.10"> }</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-#ifdef MOZ_THUNDERBIRD</span>
<a href="#l1.13"></a><span id="l1.13"> bool</span>
<a href="#l1.14"></a><span id="l1.14"> nsMessengerUnixIntegration::BuildNotificationTitle(nsIMsgFolder *aFolder, nsIStringBundle *aBundle, nsString &amp;aTitle)</span>
<a href="#l1.15"></a><span id="l1.15"> {</span>
<a href="#l1.16"></a><span id="l1.16">   nsString accountName;</span>
<a href="#l1.17"></a><span id="l1.17">   aFolder-&gt;GetPrettiestName(accountName);</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19">   int32_t numNewMessages = 0;</span>
<a href="#l1.20"></a><span id="l1.20">   aFolder-&gt;GetNumNewMessages(true, &amp;numNewMessages);</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -329,68 +328,55 @@ nsMessengerUnixIntegration::BuildNotific</span>
<a href="#l1.22"></a><span id="l1.22">     alertBody.Append(StringHead(previewString, previewLength));</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24">   if (alertBody.IsEmpty())</span>
<a href="#l1.25"></a><span id="l1.25">     return false;</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">   aBody.Assign(alertBody);</span>
<a href="#l1.28"></a><span id="l1.28">   return true;</span>
<a href="#l1.29"></a><span id="l1.29"> }</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-#endif</span>
<a href="#l1.31"></a><span id="l1.31"> </span>
<a href="#l1.32"></a><span id="l1.32"> nsresult nsMessengerUnixIntegration::ShowAlertMessage(const nsAString&amp; aAlertTitle, const nsAString&amp; aAlertText, const nsACString&amp; aFolderURI)</span>
<a href="#l1.33"></a><span id="l1.33"> {</span>
<a href="#l1.34"></a><span id="l1.34">   nsresult rv;</span>
<a href="#l1.35"></a><span id="l1.35">   // if we are already in the process of showing an alert, don't try to show another....</span>
<a href="#l1.36"></a><span id="l1.36">   if (mAlertInProgress)</span>
<a href="#l1.37"></a><span id="l1.37">     return NS_OK;</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l1.40"></a><span id="l1.40">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.41"></a><span id="l1.41">   bool showAlert = true;</span>
<a href="#l1.42"></a><span id="l1.42">   prefBranch-&gt;GetBoolPref(SHOW_ALERT_PREF, &amp;showAlert);</span>
<a href="#l1.43"></a><span id="l1.43"> </span>
<a href="#l1.44"></a><span id="l1.44">   if (showAlert)</span>
<a href="#l1.45"></a><span id="l1.45">   {</span>
<a href="#l1.46"></a><span id="l1.46">     mAlertInProgress = true;</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-#ifdef MOZ_THUNDERBIRD</span>
<a href="#l1.48"></a><span id="l1.48">     nsCOMPtr&lt;nsIAlertsService&gt; alertsService(do_GetService(NS_SYSTEMALERTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l1.49"></a><span id="l1.49">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l1.50"></a><span id="l1.50">       rv = alertsService-&gt;ShowAlertNotification(NS_LITERAL_STRING(NEW_MAIL_ALERT_ICON),</span>
<a href="#l1.51"></a><span id="l1.51">                                                 aAlertTitle,</span>
<a href="#l1.52"></a><span id="l1.52">                                                 aAlertText,</span>
<a href="#l1.53"></a><span id="l1.53">                                                 false,</span>
<a href="#l1.54"></a><span id="l1.54">                                                 NS_ConvertASCIItoUTF16(aFolderURI),</span>
<a href="#l1.55"></a><span id="l1.55">                                                 this,</span>
<a href="#l1.56"></a><span id="l1.56">                                                 EmptyString());</span>
<a href="#l1.57"></a><span id="l1.57">       if (NS_SUCCEEDED(rv))</span>
<a href="#l1.58"></a><span id="l1.58">         return rv;</span>
<a href="#l1.59"></a><span id="l1.59">     }</span>
<a href="#l1.60"></a><span id="l1.60">     AlertFinished();</span>
<a href="#l1.61"></a><span id="l1.61">     rv = ShowNewAlertNotification(false);</span>
<a href="#l1.62"></a><span id="l1.62"> </span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-#else</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-    nsCOMPtr&lt;nsIAlertsService&gt; alertsService (do_GetService(NS_ALERTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-    {</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-      rv = alertsService-&gt;ShowAlertNotification(NS_LITERAL_STRING(NEW_MAIL_ALERT_ICON), aAlertTitle,</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-                                                aAlertText, true,</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-                                                NS_ConvertASCIItoUTF16(aFolderURI), this,</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-                                                EmptyString());</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-    }</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-#endif</span>
<a href="#l1.73"></a><span id="l1.73">   }</span>
<a href="#l1.74"></a><span id="l1.74"> </span>
<a href="#l1.75"></a><span id="l1.75">   if (NS_FAILED(rv)) // go straight to showing the system tray icon.</span>
<a href="#l1.76"></a><span id="l1.76">     AlertFinished();</span>
<a href="#l1.77"></a><span id="l1.77"> </span>
<a href="#l1.78"></a><span id="l1.78">   return rv;</span>
<a href="#l1.79"></a><span id="l1.79"> }</span>
<a href="#l1.80"></a><span id="l1.80"> </span>
<a href="#l1.81"></a><span id="l1.81" class="difflineminus">-#ifdef MOZ_THUNDERBIRD</span>
<a href="#l1.82"></a><span id="l1.82"> // Opening Thunderbird's new mail alert notification window for not supporting libnotify</span>
<a href="#l1.83"></a><span id="l1.83"> // aUserInitiated --&gt; true if we are opening the alert notification in response to a user action</span>
<a href="#l1.84"></a><span id="l1.84"> //                    like clicking on the biff icon</span>
<a href="#l1.85"></a><span id="l1.85"> nsresult nsMessengerUnixIntegration::ShowNewAlertNotification(bool aUserInitiated)</span>
<a href="#l1.86"></a><span id="l1.86"> {</span>
<a href="#l1.87"></a><span id="l1.87"> </span>
<a href="#l1.88"></a><span id="l1.88">   nsresult rv;</span>
<a href="#l1.89"></a><span id="l1.89"> </span>
<a href="#l1.90"></a><span id="l1.90" class="difflineat">@@ -440,17 +426,16 @@ nsresult nsMessengerUnixIntegration::Sho</span>
<a href="#l1.91"></a><span id="l1.91">                             getter_AddRefs(newWindow));</span>
<a href="#l1.92"></a><span id="l1.92"> </span>
<a href="#l1.93"></a><span id="l1.93">     if (NS_FAILED(rv))</span>
<a href="#l1.94"></a><span id="l1.94">       AlertFinished();</span>
<a href="#l1.95"></a><span id="l1.95">   }</span>
<a href="#l1.96"></a><span id="l1.96"> </span>
<a href="#l1.97"></a><span id="l1.97">   return rv;</span>
<a href="#l1.98"></a><span id="l1.98"> }</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineminus">-#endif</span>
<a href="#l1.100"></a><span id="l1.100"> </span>
<a href="#l1.101"></a><span id="l1.101"> nsresult nsMessengerUnixIntegration::AlertFinished()</span>
<a href="#l1.102"></a><span id="l1.102"> {</span>
<a href="#l1.103"></a><span id="l1.103">   mAlertInProgress = false;</span>
<a href="#l1.104"></a><span id="l1.104">   return NS_OK;</span>
<a href="#l1.105"></a><span id="l1.105"> }</span>
<a href="#l1.106"></a><span id="l1.106"> </span>
<a href="#l1.107"></a><span id="l1.107"> nsresult nsMessengerUnixIntegration::AlertClicked()</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineat">@@ -491,17 +476,16 @@ void nsMessengerUnixIntegration::FillToo</span>
<a href="#l1.109"></a><span id="l1.109">     weakReference = do_QueryElementAt(mFoldersWithNewMail, i);</span>
<a href="#l1.110"></a><span id="l1.110">     folder = do_QueryReferent(weakReference);</span>
<a href="#l1.111"></a><span id="l1.111">     folder-&gt;GetChildWithURI(folderUri, true, true,</span>
<a href="#l1.112"></a><span id="l1.112">                             getter_AddRefs(folderWithNewMail));</span>
<a href="#l1.113"></a><span id="l1.113">   }</span>
<a href="#l1.114"></a><span id="l1.114"> </span>
<a href="#l1.115"></a><span id="l1.115">   if (folder &amp;&amp; folderWithNewMail)</span>
<a href="#l1.116"></a><span id="l1.116">   {</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineminus">-#ifdef MOZ_THUNDERBIRD</span>
<a href="#l1.118"></a><span id="l1.118">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l1.119"></a><span id="l1.119">     GetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l1.120"></a><span id="l1.120"> </span>
<a href="#l1.121"></a><span id="l1.121">     if (!bundle)</span>
<a href="#l1.122"></a><span id="l1.122">       return;</span>
<a href="#l1.123"></a><span id="l1.123"> </span>
<a href="#l1.124"></a><span id="l1.124">     // Create the notification title</span>
<a href="#l1.125"></a><span id="l1.125">     nsString alertTitle;</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineat">@@ -573,43 +557,16 @@ void nsMessengerUnixIntegration::FillToo</span>
<a href="#l1.127"></a><span id="l1.127"> </span>
<a href="#l1.128"></a><span id="l1.128">     uint32_t dateInSeconds = 0;</span>
<a href="#l1.129"></a><span id="l1.129">     if (NS_FAILED(lastMsgHdr-&gt;GetDateInSeconds(&amp;dateInSeconds)))</span>
<a href="#l1.130"></a><span id="l1.130">       return;</span>
<a href="#l1.131"></a><span id="l1.131"> </span>
<a href="#l1.132"></a><span id="l1.132">     // Write the newest message timestamp to the appropriate</span>
<a href="#l1.133"></a><span id="l1.133">     // mapping in our hashtable of MRUTime's.</span>
<a href="#l1.134"></a><span id="l1.134">     PutMRUTimestampForFolder(folder, dateInSeconds);</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineminus">-#else</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineminus">-    nsString accountName;</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineminus">-    folder-&gt;GetPrettiestName(accountName);</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineminus">-</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineminus">-    GetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineminus">-    if (bundle)</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineminus">-    {</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineminus">-      int32_t numNewMessages = 0;</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineminus">-      folder-&gt;GetNumNewMessages(true, &amp;numNewMessages);</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineminus">-      nsAutoString numNewMsgsText;</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineminus">-      numNewMsgsText.AppendInt(numNewMessages);</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineminus">-</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineminus">-      const PRUnichar *formatStrings[] =</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineminus">-      {</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineminus">-        numNewMsgsText.get(),</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineminus">-      };</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineminus">-</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineminus">-      nsString finalText;</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineminus">-      if (numNewMessages == 1)</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineminus">-        bundle-&gt;FormatStringFromName(NS_LITERAL_STRING(&quot;biffNotification_message&quot;).get(), formatStrings, 1, getter_Copies(finalText));</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineminus">-      else</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineminus">-        bundle-&gt;FormatStringFromName(NS_LITERAL_STRING(&quot;biffNotification_messages&quot;).get(), formatStrings, 1, getter_Copies(finalText));</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineminus">-</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineminus">-      ShowAlertMessage(accountName, finalText, EmptyCString());</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineminus">-    } // if we got a bundle</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineminus">-#endif</span>
<a href="#l1.162"></a><span id="l1.162">   } // if we got a folder</span>
<a href="#l1.163"></a><span id="l1.163"> }</span>
<a href="#l1.164"></a><span id="l1.164"> </span>
<a href="#l1.165"></a><span id="l1.165"> // get the first top level folder which we know has new mail, then enumerate over all the subfolders</span>
<a href="#l1.166"></a><span id="l1.166"> // looking for the first real folder with new mail. Return the folderURI for that folder.</span>
<a href="#l1.167"></a><span id="l1.167"> nsresult nsMessengerUnixIntegration::GetFirstFolderWithNewMail(nsACString&amp; aFolderURI)</span>
<a href="#l1.168"></a><span id="l1.168"> {</span>
<a href="#l1.169"></a><span id="l1.169">   nsresult rv;</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineat">@@ -770,21 +727,19 @@ NS_IMETHODIMP</span>
<a href="#l1.171"></a><span id="l1.171"> nsMessengerUnixIntegration::OnStartRunningUrl(nsIURI *aUrl)</span>
<a href="#l1.172"></a><span id="l1.172"> {</span>
<a href="#l1.173"></a><span id="l1.173">   return NS_OK;</span>
<a href="#l1.174"></a><span id="l1.174"> }</span>
<a href="#l1.175"></a><span id="l1.175"> </span>
<a href="#l1.176"></a><span id="l1.176"> NS_IMETHODIMP</span>
<a href="#l1.177"></a><span id="l1.177"> nsMessengerUnixIntegration::OnStopRunningUrl(nsIURI *aUrl, nsresult aExitCode)</span>
<a href="#l1.178"></a><span id="l1.178"> {</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineminus">-#ifdef MOZ_THUNDERBIRD</span>
<a href="#l1.180"></a><span id="l1.180">   if (NS_SUCCEEDED(aExitCode))</span>
<a href="#l1.181"></a><span id="l1.181">     // preview fetch is done.</span>
<a href="#l1.182"></a><span id="l1.182">     FillToolTipInfo();</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineminus">-#endif</span>
<a href="#l1.184"></a><span id="l1.184">   return NS_OK;</span>
<a href="#l1.185"></a><span id="l1.185"> }</span>
<a href="#l1.186"></a><span id="l1.186"> </span>
<a href="#l1.187"></a><span id="l1.187"> nsresult</span>
<a href="#l1.188"></a><span id="l1.188"> nsMessengerUnixIntegration::GetMRUTimestampForFolder(nsIMsgFolder *aFolder,</span>
<a href="#l1.189"></a><span id="l1.189">                                                      uint32_t *aLastMRUTime)</span>
<a href="#l1.190"></a><span id="l1.190"> {</span>
<a href="#l1.191"></a><span id="l1.191">   nsCOMPtr&lt;nsIMsgFolder&gt; rootFolder = nullptr;</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineat">@@ -794,26 +749,23 @@ nsMessengerUnixIntegration::GetMRUTimest</span>
<a href="#l1.193"></a><span id="l1.193">   nsCString rootFolderURI;</span>
<a href="#l1.194"></a><span id="l1.194">   rootFolder-&gt;GetURI(rootFolderURI);</span>
<a href="#l1.195"></a><span id="l1.195">   if (!mLastMRUTimes.Get(rootFolderURI, aLastMRUTime))</span>
<a href="#l1.196"></a><span id="l1.196">     aLastMRUTime = 0;</span>
<a href="#l1.197"></a><span id="l1.197"> </span>
<a href="#l1.198"></a><span id="l1.198">   return NS_OK;</span>
<a href="#l1.199"></a><span id="l1.199"> }</span>
<a href="#l1.200"></a><span id="l1.200"> </span>
<a href="#l1.201"></a><span id="l1.201" class="difflineminus">-#ifdef MOZ_THUNDERBIRD</span>
<a href="#l1.202"></a><span id="l1.202"> nsresult</span>
<a href="#l1.203"></a><span id="l1.203"> nsMessengerUnixIntegration::PutMRUTimestampForFolder(nsIMsgFolder *aFolder,</span>
<a href="#l1.204"></a><span id="l1.204">                                                      uint32_t aLastMRUTime)</span>
<a href="#l1.205"></a><span id="l1.205"> {</span>
<a href="#l1.206"></a><span id="l1.206">   nsresult rv;</span>
<a href="#l1.207"></a><span id="l1.207">   nsCOMPtr&lt;nsIMsgFolder&gt; rootFolder = nullptr;</span>
<a href="#l1.208"></a><span id="l1.208">   rv = aFolder-&gt;GetRootFolder(getter_AddRefs(rootFolder));</span>
<a href="#l1.209"></a><span id="l1.209">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.210"></a><span id="l1.210"> </span>
<a href="#l1.211"></a><span id="l1.211">   nsCString rootFolderURI;</span>
<a href="#l1.212"></a><span id="l1.212">   rootFolder-&gt;GetURI(rootFolderURI);</span>
<a href="#l1.213"></a><span id="l1.213">   mLastMRUTimes.Put(rootFolderURI, aLastMRUTime);</span>
<a href="#l1.214"></a><span id="l1.214"> </span>
<a href="#l1.215"></a><span id="l1.215">   return NS_OK;</span>
<a href="#l1.216"></a><span id="l1.216"> }</span>
<a href="#l1.217"></a><span id="l1.217" class="difflineminus">-#endif</span>
<a href="#l1.218"></a><span id="l1.218" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerUnixIntegration.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerUnixIntegration.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -40,22 +40,20 @@ private:</span>
<a href="#l2.4"></a><span id="l2.4">   nsresult ShowAlertMessage(const nsAString&amp; aAlertTitle, const nsAString&amp; aAlertText, const nsACString&amp; aFolderURI);</span>
<a href="#l2.5"></a><span id="l2.5">   nsresult GetFirstFolderWithNewMail(nsACString&amp; aFolderURI);</span>
<a href="#l2.6"></a><span id="l2.6">   nsresult GetStringBundle(nsIStringBundle **aBundle);</span>
<a href="#l2.7"></a><span id="l2.7">   nsresult AlertFinished();</span>
<a href="#l2.8"></a><span id="l2.8">   nsresult AlertClicked();</span>
<a href="#l2.9"></a><span id="l2.9">   void FillToolTipInfo();</span>
<a href="#l2.10"></a><span id="l2.10">   nsresult GetMRUTimestampForFolder(nsIMsgFolder *aFolder, uint32_t *aLastMRUTime);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-#ifdef MOZ_THUNDERBIRD</span>
<a href="#l2.13"></a><span id="l2.13">   bool BuildNotificationBody(nsIMsgDBHdr *aHdr, nsIStringBundle *Bundle, nsString &amp;aBody);</span>
<a href="#l2.14"></a><span id="l2.14">   bool BuildNotificationTitle(nsIMsgFolder *aFolder, nsIStringBundle *aBundle, nsString &amp;aTitle);</span>
<a href="#l2.15"></a><span id="l2.15">   nsresult ShowNewAlertNotification(bool aUserInitiated);</span>
<a href="#l2.16"></a><span id="l2.16">   nsresult PutMRUTimestampForFolder(nsIMsgFolder *aFolder, uint32_t aLastMRUTime);</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-#endif</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">   nsCOMPtr&lt;nsISupportsArray&gt; mFoldersWithNewMail;  // keep track of all the root folders with pending new mail</span>
<a href="#l2.20"></a><span id="l2.20">   nsCOMPtr&lt;nsIAtom&gt; mBiffStateAtom;</span>
<a href="#l2.21"></a><span id="l2.21">   nsCOMPtr&lt;nsIAtom&gt; mNewMailReceivedAtom;</span>
<a href="#l2.22"></a><span id="l2.22">   bool mAlertInProgress;</span>
<a href="#l2.23"></a><span id="l2.23">   nsDataHashtable&lt;nsCStringHashKey, uint32_t&gt; mLastMRUTimes; // We keep track of the last time we did a new mail notification for each account</span>
<a href="#l2.24"></a><span id="l2.24">   nsTArray&lt;nsCString&gt; mFetchingURIs;</span>
<a href="#l2.25"></a><span id="l2.25"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -63,16 +63,18 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #define MAIL_COMMANDLINE_ARG &quot; -mail&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #define IDI_MAILBIFF 32576</span>
<a href="#l3.6"></a><span id="l3.6"> #define UNREAD_UPDATE_INTERVAL	(20 * 1000)	// 20 seconds</span>
<a href="#l3.7"></a><span id="l3.7"> #define ALERT_CHROME_URL &quot;chrome://messenger/content/newmailalert.xul&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> #define NEW_MAIL_ALERT_ICON &quot;chrome://messenger/skin/icons/new-mail-alert.png&quot;</span>
<a href="#l3.9"></a><span id="l3.9"> #define SHOW_ALERT_PREF     &quot;mail.biff.show_alert&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #define SHOW_TRAY_ICON_PREF &quot;mail.biff.show_tray_icon&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #define SHOW_BALLOON_PREF   &quot;mail.biff.show_balloon&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+#define SHOW_NEW_ALERT_PREF &quot;mail.biff.show_new_alert&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+#define ALERT_ORIGIN_PREF   &quot;ui.alertNotificationOrigin&quot;</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> // since we are including windows.h in this file, undefine get user name....</span>
<a href="#l3.16"></a><span id="l3.16"> #ifdef GetUserName</span>
<a href="#l3.17"></a><span id="l3.17"> #undef GetUserName</span>
<a href="#l3.18"></a><span id="l3.18"> #endif</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20"> #ifndef NIIF_USER</span>
<a href="#l3.21"></a><span id="l3.21"> #define NIIF_USER       0x00000004</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -81,16 +83,23 @@</span>
<a href="#l3.23"></a><span id="l3.23"> #ifndef NIIF_NOSOUND</span>
<a href="#l3.24"></a><span id="l3.24"> #define NIIF_NOSOUND    0x00000010</span>
<a href="#l3.25"></a><span id="l3.25"> #endif</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27"> #ifndef NIN_BALOONUSERCLICK</span>
<a href="#l3.28"></a><span id="l3.28"> #define NIN_BALLOONUSERCLICK (WM_USER + 5)</span>
<a href="#l3.29"></a><span id="l3.29"> #endif</span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+#ifndef MOZ_THUNDERBIRD</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+// from LookAndFeel.h</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+#define NS_ALERT_HORIZONTAL 1</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+#define NS_ALERT_LEFT       2</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+#define NS_ALERT_TOP        4</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+#endif</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+</span>
<a href="#l3.38"></a><span id="l3.38"> using namespace mozilla;</span>
<a href="#l3.39"></a><span id="l3.39"> </span>
<a href="#l3.40"></a><span id="l3.40"> // begin shameless copying from nsNativeAppSupportWin</span>
<a href="#l3.41"></a><span id="l3.41"> HWND hwndForDOMWindow( nsISupports *window )</span>
<a href="#l3.42"></a><span id="l3.42"> {</span>
<a href="#l3.43"></a><span id="l3.43">   nsCOMPtr&lt;nsPIDOMWindow&gt; win( do_QueryInterface(window) );</span>
<a href="#l3.44"></a><span id="l3.44">   if ( !win )</span>
<a href="#l3.45"></a><span id="l3.45">       return 0;</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineat">@@ -160,29 +169,27 @@ static void openMailWindow(const nsACStr</span>
<a href="#l3.47"></a><span id="l3.47">                                 &quot;mail:3pane&quot;, nsCString(aFolderUri).get(), nsMsgKey_None);</span>
<a href="#l3.48"></a><span id="l3.48">   }</span>
<a href="#l3.49"></a><span id="l3.49"> }</span>
<a href="#l3.50"></a><span id="l3.50"> </span>
<a href="#l3.51"></a><span id="l3.51"> static void CALLBACK delayedSingleClick(HWND msgWindow, UINT msg, INT_PTR idEvent, DWORD dwTime)</span>
<a href="#l3.52"></a><span id="l3.52"> {</span>
<a href="#l3.53"></a><span id="l3.53">   ::KillTimer(msgWindow, idEvent);</span>
<a href="#l3.54"></a><span id="l3.54"> </span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-#ifdef MOZ_THUNDERBIRD</span>
<a href="#l3.56"></a><span id="l3.56">   // single clicks on the biff icon should re-open the alert notification</span>
<a href="#l3.57"></a><span id="l3.57">   nsresult rv = NS_OK;</span>
<a href="#l3.58"></a><span id="l3.58">   nsCOMPtr&lt;nsIMessengerOSIntegration&gt; integrationService =</span>
<a href="#l3.59"></a><span id="l3.59">     do_GetService(NS_MESSENGEROSINTEGRATION_CONTRACTID, &amp;rv);</span>
<a href="#l3.60"></a><span id="l3.60">   if (NS_SUCCEEDED(rv))</span>
<a href="#l3.61"></a><span id="l3.61">   {</span>
<a href="#l3.62"></a><span id="l3.62">     // we know we are dealing with the windows integration object</span>
<a href="#l3.63"></a><span id="l3.63">     nsMessengerWinIntegration * winIntegrationService = static_cast&lt;nsMessengerWinIntegration*&gt;</span>
<a href="#l3.64"></a><span id="l3.64">                                                                    (static_cast&lt;nsIMessengerOSIntegration*&gt;(integrationService.get()));</span>
<a href="#l3.65"></a><span id="l3.65">     winIntegrationService-&gt;ShowNewAlertNotification(true, EmptyString(), EmptyString());</span>
<a href="#l3.66"></a><span id="l3.66">   }</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-#endif</span>
<a href="#l3.68"></a><span id="l3.68"> }</span>
<a href="#l3.69"></a><span id="l3.69"> </span>
<a href="#l3.70"></a><span id="l3.70"> // Window proc.</span>
<a href="#l3.71"></a><span id="l3.71"> static LRESULT CALLBACK MessageWindowProc( HWND msgWindow, UINT msg, WPARAM wp, LPARAM lp )</span>
<a href="#l3.72"></a><span id="l3.72"> {</span>
<a href="#l3.73"></a><span id="l3.73">   if (msg == WM_USER)</span>
<a href="#l3.74"></a><span id="l3.74">   {</span>
<a href="#l3.75"></a><span id="l3.75">     if (lp == WM_LBUTTONDOWN)</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineat">@@ -443,17 +450,17 @@ nsresult nsMessengerWinIntegration::Show</span>
<a href="#l3.77"></a><span id="l3.77">     }</span>
<a href="#l3.78"></a><span id="l3.78">   }</span>
<a href="#l3.79"></a><span id="l3.79"> </span>
<a href="#l3.80"></a><span id="l3.80">   if (!showAlert || NS_FAILED(rv)) // go straight to showing the system tray icon.</span>
<a href="#l3.81"></a><span id="l3.81">     AlertFinished();</span>
<a href="#l3.82"></a><span id="l3.82"> </span>
<a href="#l3.83"></a><span id="l3.83">   return rv;</span>
<a href="#l3.84"></a><span id="l3.84"> }</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-#else</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+#endif</span>
<a href="#l3.87"></a><span id="l3.87"> // Opening Thunderbird's new mail alert notification window</span>
<a href="#l3.88"></a><span id="l3.88"> // aUserInitiated --&gt; true if we are opening the alert notification in response to a user action</span>
<a href="#l3.89"></a><span id="l3.89"> //                    like clicking on the biff icon</span>
<a href="#l3.90"></a><span id="l3.90"> nsresult nsMessengerWinIntegration::ShowNewAlertNotification(bool aUserInitiated, const nsString&amp; aAlertTitle, const nsString&amp; aAlertText)</span>
<a href="#l3.91"></a><span id="l3.91"> {</span>
<a href="#l3.92"></a><span id="l3.92">   nsresult rv;</span>
<a href="#l3.93"></a><span id="l3.93"> </span>
<a href="#l3.94"></a><span id="l3.94">   // if we are already in the process of showing an alert, don't try to show another....</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineat">@@ -514,19 +521,57 @@ nsresult nsMessengerWinIntegration::Show</span>
<a href="#l3.96"></a><span id="l3.96">     scriptableUserInitiated-&gt;SetData(aUserInitiated);</span>
<a href="#l3.97"></a><span id="l3.97">     rv = argsArray-&gt;AppendElement(scriptableUserInitiated, false);</span>
<a href="#l3.98"></a><span id="l3.98">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.99"></a><span id="l3.99"> </span>
<a href="#l3.100"></a><span id="l3.100">     // pass in the alert origin</span>
<a href="#l3.101"></a><span id="l3.101">     nsCOMPtr&lt;nsISupportsPRUint8&gt; scriptableOrigin (do_CreateInstance(NS_SUPPORTS_PRUINT8_CONTRACTID));</span>
<a href="#l3.102"></a><span id="l3.102">     NS_ENSURE_TRUE(scriptableOrigin, NS_ERROR_FAILURE);</span>
<a href="#l3.103"></a><span id="l3.103">     scriptableOrigin-&gt;SetData(0);</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-    int32_t origin = LookAndFeel::GetInt(LookAndFeel::eIntID_AlertNotificationOrigin);</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineminus">-    if (origin &amp;&amp; origin &gt;= 0 &amp;&amp; origin &lt;= 7)</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-      scriptableOrigin-&gt;SetData(origin);</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+    int32_t origin = 0;</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+#ifdef MOZ_THUNDERBIRD</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+    origin = LookAndFeel::GetInt(LookAndFeel::eIntID_AlertNotificationOrigin);</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+#else</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineplus">+    // Get task bar window handle</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+    HWND shellWindow = FindWindowW(L&quot;Shell_TrayWnd&quot;, NULL);</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineplus">+</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineplus">+    rv = prefBranch-&gt;GetIntPref(ALERT_ORIGIN_PREF, &amp;origin);</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineplus">+    if (NS_FAILED(rv) &amp;&amp; (shellWindow != NULL))</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineplus">+    {</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineplus">+      // Determine position</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+      APPBARDATA appBarData;</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+      appBarData.hWnd = shellWindow;</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineplus">+      appBarData.cbSize = sizeof(appBarData);</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineplus">+      if (SHAppBarMessage(ABM_GETTASKBARPOS, &amp;appBarData))</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineplus">+      {</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineplus">+        // Set alert origin as a bit field - see LookAndFeel.h</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+        // 0 represents bottom right, sliding vertically.</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+        switch(appBarData.uEdge)</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+        {</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+          case ABE_LEFT:</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+            origin = NS_ALERT_HORIZONTAL | NS_ALERT_LEFT;</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+            break;</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+          case ABE_RIGHT:</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+            origin = NS_ALERT_HORIZONTAL;</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+            break;</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineplus">+          case ABE_TOP:</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineplus">+            origin = NS_ALERT_TOP;</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+            // fall through for the right-to-left handling.</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+          case ABE_BOTTOM:</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+            // If the task bar is right-to-left,</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+            // move the origin to the left</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+            if (::GetWindowLong(shellWindow, GWL_EXSTYLE) &amp;</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+                  WS_EX_LAYOUTRTL)</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineplus">+              origin |= NS_ALERT_LEFT;</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineplus">+            break;</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineplus">+        }</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineplus">+      }</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+    }</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+#endif</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+    scriptableOrigin-&gt;SetData(origin);</span>
<a href="#l3.148"></a><span id="l3.148"> </span>
<a href="#l3.149"></a><span id="l3.149">     rv = argsArray-&gt;AppendElement(scriptableOrigin, false);</span>
<a href="#l3.150"></a><span id="l3.150">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.151"></a><span id="l3.151"> </span>
<a href="#l3.152"></a><span id="l3.152">     nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch(do_GetService(NS_WINDOWWATCHER_CONTRACTID));</span>
<a href="#l3.153"></a><span id="l3.153">     nsCOMPtr&lt;nsIDOMWindow&gt; newWindow;</span>
<a href="#l3.154"></a><span id="l3.154">     rv = wwatch-&gt;OpenWindow(0, ALERT_CHROME_URL, &quot;_blank&quot;,</span>
<a href="#l3.155"></a><span id="l3.155">                 &quot;chrome,dialog=yes,titlebar=no,popup=yes&quot;, argsArray,</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineat">@@ -537,17 +582,16 @@ nsresult nsMessengerWinIntegration::Show</span>
<a href="#l3.157"></a><span id="l3.157"> </span>
<a href="#l3.158"></a><span id="l3.158">   // if the user has turned off the mail alert, or  openWindow generated an error,</span>
<a href="#l3.159"></a><span id="l3.159">   // then go straight to the system tray.</span>
<a href="#l3.160"></a><span id="l3.160">   if (!showAlert || NS_FAILED(rv))</span>
<a href="#l3.161"></a><span id="l3.161">     AlertFinished();</span>
<a href="#l3.162"></a><span id="l3.162"> </span>
<a href="#l3.163"></a><span id="l3.163">   return rv;</span>
<a href="#l3.164"></a><span id="l3.164"> }</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineminus">-#endif</span>
<a href="#l3.166"></a><span id="l3.166"> </span>
<a href="#l3.167"></a><span id="l3.167"> nsresult nsMessengerWinIntegration::AlertFinished()</span>
<a href="#l3.168"></a><span id="l3.168"> {</span>
<a href="#l3.169"></a><span id="l3.169">   // okay, we are done showing the alert</span>
<a href="#l3.170"></a><span id="l3.170">   // now put an icon in the system tray, if allowed</span>
<a href="#l3.171"></a><span id="l3.171">   bool showTrayIcon = !mSuppressBiffIcon;</span>
<a href="#l3.172"></a><span id="l3.172">   if (showTrayIcon)</span>
<a href="#l3.173"></a><span id="l3.173">   {</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineat">@@ -562,33 +606,31 @@ nsresult nsMessengerWinIntegration::Aler</span>
<a href="#l3.175"></a><span id="l3.175">   }</span>
<a href="#l3.176"></a><span id="l3.176">   mSuppressBiffIcon = false;</span>
<a href="#l3.177"></a><span id="l3.177">   mAlertInProgress = false;</span>
<a href="#l3.178"></a><span id="l3.178">   return NS_OK;</span>
<a href="#l3.179"></a><span id="l3.179"> }</span>
<a href="#l3.180"></a><span id="l3.180"> </span>
<a href="#l3.181"></a><span id="l3.181"> nsresult nsMessengerWinIntegration::AlertClicked()</span>
<a href="#l3.182"></a><span id="l3.182"> {</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineminus">-#ifdef MOZ_THUNDERBIRD</span>
<a href="#l3.184"></a><span id="l3.184">   nsresult rv;</span>
<a href="#l3.185"></a><span id="l3.185">   nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l3.186"></a><span id="l3.186">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.187"></a><span id="l3.187">   nsCOMPtr&lt;nsIMsgWindow&gt; topMostMsgWindow;</span>
<a href="#l3.188"></a><span id="l3.188">   rv = mailSession-&gt;GetTopmostMsgWindow(getter_AddRefs(topMostMsgWindow));</span>
<a href="#l3.189"></a><span id="l3.189">   if (topMostMsgWindow)</span>
<a href="#l3.190"></a><span id="l3.190">   {</span>
<a href="#l3.191"></a><span id="l3.191">     nsCOMPtr&lt;nsIDOMWindow&gt; domWindow;</span>
<a href="#l3.192"></a><span id="l3.192">     topMostMsgWindow-&gt;GetDomWindow(getter_AddRefs(domWindow));</span>
<a href="#l3.193"></a><span id="l3.193">     if (domWindow)</span>
<a href="#l3.194"></a><span id="l3.194">     {</span>
<a href="#l3.195"></a><span id="l3.195">       activateWindow(domWindow);</span>
<a href="#l3.196"></a><span id="l3.196">       return NS_OK;</span>
<a href="#l3.197"></a><span id="l3.197">     }</span>
<a href="#l3.198"></a><span id="l3.198">   }</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineminus">-#endif</span>
<a href="#l3.200"></a><span id="l3.200">   // make sure we don't insert the icon in the system tray since the user clicked on the alert.</span>
<a href="#l3.201"></a><span id="l3.201">   mSuppressBiffIcon = true;</span>
<a href="#l3.202"></a><span id="l3.202">   nsCString folderURI;</span>
<a href="#l3.203"></a><span id="l3.203">   GetFirstFolderWithNewMail(folderURI);</span>
<a href="#l3.204"></a><span id="l3.204">   openMailWindow(folderURI);</span>
<a href="#l3.205"></a><span id="l3.205">   return NS_OK;</span>
<a href="#l3.206"></a><span id="l3.206"> }</span>
<a href="#l3.207"></a><span id="l3.207"> </span>
<a href="#l3.208"></a><span id="l3.208" class="difflineat">@@ -695,20 +737,27 @@ void nsMessengerWinIntegration::FillTool</span>
<a href="#l3.209"></a><span id="l3.209">     } // if we got a folder</span>
<a href="#l3.210"></a><span id="l3.210">   } // for each folder</span>
<a href="#l3.211"></a><span id="l3.211"> </span>
<a href="#l3.212"></a><span id="l3.212">   ::wcsncpy( sBiffIconData.szTip, toolTipText.get(), kMaxTooltipSize);</span>
<a href="#l3.213"></a><span id="l3.213"> </span>
<a href="#l3.214"></a><span id="l3.214">   if (!mBiffIconVisible)</span>
<a href="#l3.215"></a><span id="l3.215">   {</span>
<a href="#l3.216"></a><span id="l3.216"> #ifndef MOZ_THUNDERBIRD</span>
<a href="#l3.217"></a><span id="l3.217" class="difflineplus">+  nsresult rv;</span>
<a href="#l3.218"></a><span id="l3.218" class="difflineplus">+  bool showNewAlert = false;</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineplus">+  nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineplus">+  NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineplus">+</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineplus">+  prefBranch-&gt;GetBoolPref(SHOW_NEW_ALERT_PREF, &amp;showNewAlert);</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineplus">+  if (!showNewAlert)</span>
<a href="#l3.224"></a><span id="l3.224">     ShowAlertMessage(accountName, animatedAlertText, EmptyCString());</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineminus">-#else</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineplus">+  else</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineplus">+#endif</span>
<a href="#l3.228"></a><span id="l3.228">     ShowNewAlertNotification(false, accountName, animatedAlertText);</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineminus">-#endif</span>
<a href="#l3.230"></a><span id="l3.230">   }</span>
<a href="#l3.231"></a><span id="l3.231">   else</span>
<a href="#l3.232"></a><span id="l3.232">    GenericShellNotify( NIM_MODIFY);</span>
<a href="#l3.233"></a><span id="l3.233"> }</span>
<a href="#l3.234"></a><span id="l3.234"> </span>
<a href="#l3.235"></a><span id="l3.235"> // get the first top level folder which we know has new mail, then enumerate over all the subfolders</span>
<a href="#l3.236"></a><span id="l3.236"> // looking for the first real folder with new mail. Return the folderURI for that folder.</span>
<a href="#l3.237"></a><span id="l3.237"> nsresult nsMessengerWinIntegration::GetFirstFolderWithNewMail(nsACString&amp; aFolderURI)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -51,19 +51,18 @@ public:</span>
<a href="#l4.4"></a><span id="l4.4">   virtual ~nsMessengerWinIntegration();</span>
<a href="#l4.5"></a><span id="l4.5">   virtual nsresult Init();</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7">   NS_DECL_ISUPPORTS</span>
<a href="#l4.8"></a><span id="l4.8">   NS_DECL_NSIMESSENGEROSINTEGRATION</span>
<a href="#l4.9"></a><span id="l4.9">   NS_DECL_NSIFOLDERLISTENER</span>
<a href="#l4.10"></a><span id="l4.10">   NS_DECL_NSIOBSERVER</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-#ifdef MOZ_THUNDERBIRD</span>
<a href="#l4.13"></a><span id="l4.13">   nsresult ShowNewAlertNotification(bool aUserInitiated, const nsString&amp; aAlertTitle, const nsString&amp; aAlertText);</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-#else</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+#ifndef MOZ_THUNDERBIRD</span>
<a href="#l4.16"></a><span id="l4.16">   nsresult ShowAlertMessage(const nsString&amp; aAlertTitle, const nsString&amp; aAlertText, const nsACString&amp; aFolderURI);</span>
<a href="#l4.17"></a><span id="l4.17"> #endif</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19"> private:</span>
<a href="#l4.20"></a><span id="l4.20">   nsresult AlertFinished();</span>
<a href="#l4.21"></a><span id="l4.21">   nsresult AlertClicked();</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23">   void InitializeBiffStatusIcon(); </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/browser/browser-prefs.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/browser/browser-prefs.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -324,16 +324,17 @@ pref(&quot;offline.download.download_messages</span>
<a href="#l5.4"></a><span id="l5.4"> pref(&quot;browser.offline-apps.notify&quot;, true);</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6"> pref(&quot;browser.formfill.expire_days&quot;,        180);</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> pref(&quot;mail.biff.alert.show_preview&quot;, true);</span>
<a href="#l5.9"></a><span id="l5.9"> pref(&quot;mail.biff.alert.show_subject&quot;, true);</span>
<a href="#l5.10"></a><span id="l5.10"> pref(&quot;mail.biff.alert.show_sender&quot;,  true);</span>
<a href="#l5.11"></a><span id="l5.11"> pref(&quot;mail.biff.alert.preview_length&quot;, 40);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+pref(&quot;mail.biff.show_new_alert&quot;,     true);</span>
<a href="#l5.13"></a><span id="l5.13"> </span>
<a href="#l5.14"></a><span id="l5.14"> pref(&quot;mailnews.ui.deleteMarksRead&quot;, true);</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> // The maximum amount of decoded image data we'll willingly keep around (we</span>
<a href="#l5.17"></a><span id="l5.17"> // might keep around more than this, but we'll try to get down to this value).</span>
<a href="#l5.18"></a><span id="l5.18"> // (This is intentionally on the high side; see bugs 746055 and 768015.)</span>
<a href="#l5.19"></a><span id="l5.19"> pref(&quot;image.mem.max_decoded_image_kb&quot;, 256000);</span>
<a href="#l5.20"></a><span id="l5.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -318,16 +318,22 @@ biffNotification_messages=has %1$S new m</span>
<a href="#l6.4"></a><span id="l6.4"> #  %2$S is a list of names and/or email addresses separated by biffNotification_separator</span>
<a href="#l6.5"></a><span id="l6.5"> #  %3$S is the number of new messages not displayed in the biff alert</span>
<a href="#l6.6"></a><span id="l6.6"> macBiffNotification_message=%1$S new message from %2$S.</span>
<a href="#l6.7"></a><span id="l6.7"> macBiffNotification_messages=%1$S new messages from %2$S.</span>
<a href="#l6.8"></a><span id="l6.8"> macBiffNotification_messages_extra=%1$S new messages from %2$S and %3$S more.</span>
<a href="#l6.9"></a><span id="l6.9"> # Used to separate names/email addresses in a list.  Note the trailing space ', '</span>
<a href="#l6.10"></a><span id="l6.10"> macBiffNotification_separator=,\u0020</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+# LOCALIZATION NOTE(newMailNotification_message): %1$S is the name of the account %2$S is the number of new messages  </span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+newMailNotification_message=%1$S received %2$S new message</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+# LOCALIZATION NOTE(newMailNotification_messages): %1$S is the name of the account %2$S is the number of new messages  </span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+newMailNotification_messages=%1$S received %2$S new messages</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+</span>
<a href="#l6.18"></a><span id="l6.18"> # For the Quota tab in the mail folder properties dialog</span>
<a href="#l6.19"></a><span id="l6.19"> quotaUsedFree=%S of %S KB used</span>
<a href="#l6.20"></a><span id="l6.20"> quotaPercentUsed=%S%% full</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22"> # for message views</span>
<a href="#l6.23"></a><span id="l6.23"> confirmViewDeleteTitle=Confirm</span>
<a href="#l6.24"></a><span id="l6.24"> confirmViewDeleteMessage=Are you sure you want to delete this view?</span>
<a href="#l6.25"></a><span id="l6.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/mailnews/jar.mn</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/mailnews/jar.mn</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -53,16 +53,19 @@ messenger.jar:</span>
<a href="#l7.4"></a><span id="l7.4">     content/messenger/mailEditorOverlay.xul</span>
<a href="#l7.5"></a><span id="l7.5">     content/messenger/mailKeysOverlay.xul</span>
<a href="#l7.6"></a><span id="l7.6">     content/messenger/phishingDetector.js</span>
<a href="#l7.7"></a><span id="l7.7">     content/messenger/mailOverlay.xul</span>
<a href="#l7.8"></a><span id="l7.8">     content/messenger/mailOverlay.js</span>
<a href="#l7.9"></a><span id="l7.9">     content/messenger/mail-offline.js</span>
<a href="#l7.10"></a><span id="l7.10">     content/messenger/mailContextMenus.js</span>
<a href="#l7.11"></a><span id="l7.11">     content/messenger/msgFolderPickerOverlay.xul</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+    content/messenger/newmailalert.css</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    content/messenger/newmailalert.js</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+    content/messenger/newmailalert.xul</span>
<a href="#l7.15"></a><span id="l7.15">     content/messenger/start.xhtml</span>
<a href="#l7.16"></a><span id="l7.16">     content/messenger/messengerdnd.js</span>
<a href="#l7.17"></a><span id="l7.17">     content/messenger/mailPrefsOverlay.xul                                     (prefs/mailPrefsOverlay.xul)</span>
<a href="#l7.18"></a><span id="l7.18">     content/messenger/pref-mailnews.xul                                        (prefs/pref-mailnews.xul)</span>
<a href="#l7.19"></a><span id="l7.19">     content/messenger/pref-mailnews.js                                         (prefs/pref-mailnews.js)</span>
<a href="#l7.20"></a><span id="l7.20">     content/messenger/pref-notifications.xul                                   (prefs/pref-notifications.xul)</span>
<a href="#l7.21"></a><span id="l7.21">     content/messenger/pref-notifications.js                                    (prefs/pref-notifications.js)</span>
<a href="#l7.22"></a><span id="l7.22">     content/messenger/pref-junk.xul                                            (prefs/pref-junk.xul)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- /dev/null</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ b/suite/mailnews/newmailalert.css</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -0,0 +1,23 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineplus">+</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineplus">+#alertContainer {</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+  opacity: 0;</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+}</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+#alertContainer[noanimation] {</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+  opacity: 1;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+}</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+#alertContainer[animate] {</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+  animation-timing-function: ease-out;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+  animation-duration: 4s;</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+  animation-fill-mode: both;</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+  animation-name: alert-animation;</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+}</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+@keyframes alert-animation {</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+  from {opacity: 0;}</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+  to {opacity: 1;}</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">copy from mail/base/content/newmailalert.js</span>
<a href="#l9.2"></a><span id="l9.2">copy to suite/mailnews/newmailalert.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineminus">--- a/mail/base/content/newmailalert.js</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineplus">+++ b/suite/mailnews/newmailalert.js</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineat">@@ -1,26 +1,26 @@</span>
<a href="#l9.6"></a><span id="l9.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.7"></a><span id="l9.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.8"></a><span id="l9.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-const HORIZONTAL = 1;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-const LEFT = 2;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-const TOP = 4;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+// Copied from nsILookAndFeel.h, see comments on eMetric_AlertNotificationOrigin</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+const NS_ALERT_HORIZONTAL = 1;</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+const NS_ALERT_LEFT = 2;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+const NS_ALERT_TOP = 4;</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-var gSlideTime = 50;</span>
<a href="#l9.21"></a><span id="l9.21"> var gNumNewMsgsToShowInAlert = 4; // the more messages we show in the alert, the larger it will be</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-var gOpenTime = 3000; // total time the alert should stay up once we are done animating.</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+var gOpenTime = 4000; // total time the alert should stay up once we are done animating.</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+</span>
<a href="#l9.25"></a><span id="l9.25"> var gAlertListener = null;</span>
<a href="#l9.26"></a><span id="l9.26"> var gPendingPreviewFetchRequests = 0;</span>
<a href="#l9.27"></a><span id="l9.27"> var gUserInitiated = false;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-var gFadeIncrement = .05;</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-var gOrigin = 0;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+var gOrigin = 0; // Default value: alert from bottom right.</span>
<a href="#l9.31"></a><span id="l9.31"> </span>
<a href="#l9.32"></a><span id="l9.32"> function prefillAlertInfo()</span>
<a href="#l9.33"></a><span id="l9.33"> {</span>
<a href="#l9.34"></a><span id="l9.34">   // unwrap all the args....</span>
<a href="#l9.35"></a><span id="l9.35">   // arguments[0] --&gt; array of folders with new mail</span>
<a href="#l9.36"></a><span id="l9.36">   // arguments[1] --&gt; the observer to call back with notifications about the alert</span>
<a href="#l9.37"></a><span id="l9.37">   // arguments[2] --&gt; user initiated boolean. true if the user initiated opening the alert </span>
<a href="#l9.38"></a><span id="l9.38">   //                 (which means skip the fade effect and don't auto close the alert)</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineat">@@ -28,81 +28,85 @@ function prefillAlertInfo()</span>
<a href="#l9.40"></a><span id="l9.40">   var foldersWithNewMail = window.arguments[0];  </span>
<a href="#l9.41"></a><span id="l9.41">   gAlertListener = window.arguments[1];</span>
<a href="#l9.42"></a><span id="l9.42">   gUserInitiated = window.arguments[2];</span>
<a href="#l9.43"></a><span id="l9.43">   gOrigin = window.arguments[3];</span>
<a href="#l9.44"></a><span id="l9.44"> </span>
<a href="#l9.45"></a><span id="l9.45">   // For now just grab the first folder which should be a root folder</span>
<a href="#l9.46"></a><span id="l9.46">   // for the account that has new mail. If we can't find a folder, just</span>
<a href="#l9.47"></a><span id="l9.47">   // return to avoid the exception and empty dialog in upper left-hand corner.</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineminus">-  let rootFolder;</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-  if (foldersWithNewMail &amp;&amp; foldersWithNewMail.Count() &gt; 0)</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-     rootFolder = foldersWithNewMail.GetElementAt(0)</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-                    .QueryInterface(Components.interfaces.nsIWeakReference)</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">-                    .QueryReferent(Components.interfaces.nsIMsgFolder);</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">-  else</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">-   return;</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+  var rootFolder;</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+  if (!foldersWithNewMail || foldersWithNewMail.Count() &lt; 1)</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+    return;</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+  rootFolder = foldersWithNewMail.GetElementAt(0)</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+                                 .QueryInterface(Components.interfaces.nsIWeakReference)</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+                                 .QueryReferent(Components.interfaces.nsIMsgFolder);</span>
<a href="#l9.61"></a><span id="l9.61"> </span>
<a href="#l9.62"></a><span id="l9.62" class="difflineminus">-  // generate an account label string based on the root folder</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+  // Generate an account label string based on the root folder.</span>
<a href="#l9.64"></a><span id="l9.64">   var label = document.getElementById('alertTitle');</span>
<a href="#l9.65"></a><span id="l9.65">   var totalNumNewMessages = rootFolder.getNumNewMessages(true);</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">-  label.value = document.getElementById('bundle_messenger').getFormattedString(totalNumNewMessages == 1 ? &quot;newMailNotification_message&quot; : &quot;newMailNotification_messages&quot;, </span>
<a href="#l9.67"></a><span id="l9.67" class="difflineminus">-                                                                                     [rootFolder.prettiestName, totalNumNewMessages]);</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+  var message = totalNumNewMessages == 1 ? &quot;newMailNotification_message&quot;</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+                                         : &quot;newMailNotification_messages&quot;;</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+  label.value = document.getElementById('bundle_messenger')</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+                        .getFormattedString(message, </span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+                                            [rootFolder.prettiestName, totalNumNewMessages]);</span>
<a href="#l9.73"></a><span id="l9.73"> </span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-  // this is really the root folder and we have to walk through the list to find the real folder that has new mail in it...:(</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineminus">-  var allFolders = Components.classes[&quot;@mozilla.org/supports-array;1&quot;].createInstance(Components.interfaces.nsISupportsArray);</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+  // This is really the root folder and we have to walk through the list to</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+  // find the real folder that has new mail in it...:(</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+  var allFolders = Components.classes[&quot;@mozilla.org/supports-array;1&quot;]</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+                             .createInstance(Components.interfaces.nsISupportsArray);</span>
<a href="#l9.80"></a><span id="l9.80">   rootFolder.ListDescendents(allFolders);</span>
<a href="#l9.81"></a><span id="l9.81">   var numFolders = allFolders.Count();</span>
<a href="#l9.82"></a><span id="l9.82">   var folderSummaryInfoEl = document.getElementById('folderSummaryInfo');</span>
<a href="#l9.83"></a><span id="l9.83">   folderSummaryInfoEl.mMaxMsgHdrsInPopup = gNumNewMsgsToShowInAlert;</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">-  for (var folderIndex = 0; folderIndex &lt; numFolders; folderIndex++)</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+  for (let folderIndex = 0; folderIndex &lt; numFolders; folderIndex++)</span>
<a href="#l9.86"></a><span id="l9.86">   {</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineminus">-    var folder = allFolders.GetElementAt(folderIndex).QueryInterface(Components.interfaces.nsIMsgFolder);</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+    var folder = allFolders.GetElementAt(folderIndex)</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+                           .QueryInterface(Components.interfaces.nsIMsgFolder);</span>
<a href="#l9.90"></a><span id="l9.90">     const nsMsgFolderFlags = Components.interfaces.nsMsgFolderFlags;</span>
<a href="#l9.91"></a><span id="l9.91">     if (folder.hasNewMessages &amp;&amp; !(folder.flags &amp; nsMsgFolderFlags.Virtual))</span>
<a href="#l9.92"></a><span id="l9.92">     {</span>
<a href="#l9.93"></a><span id="l9.93">       var asyncFetch = {};</span>
<a href="#l9.94"></a><span id="l9.94">       folderSummaryInfoEl.parseFolder(folder, new urlListener(folder), asyncFetch);</span>
<a href="#l9.95"></a><span id="l9.95">       if (asyncFetch.value)</span>
<a href="#l9.96"></a><span id="l9.96">         gPendingPreviewFetchRequests++;</span>
<a href="#l9.97"></a><span id="l9.97">     }</span>
<a href="#l9.98"></a><span id="l9.98">   }</span>
<a href="#l9.99"></a><span id="l9.99"> }</span>
<a href="#l9.100"></a><span id="l9.100"> </span>
<a href="#l9.101"></a><span id="l9.101"> function urlListener(aFolder)</span>
<a href="#l9.102"></a><span id="l9.102"> {</span>
<a href="#l9.103"></a><span id="l9.103">   this.mFolder = aFolder;</span>
<a href="#l9.104"></a><span id="l9.104"> }</span>
<a href="#l9.105"></a><span id="l9.105"> </span>
<a href="#l9.106"></a><span id="l9.106" class="difflineminus">-urlListener.prototype = {</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+urlListener.prototype =</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineplus">+{</span>
<a href="#l9.109"></a><span id="l9.109">   OnStartRunningUrl: function(aUrl)</span>
<a href="#l9.110"></a><span id="l9.110">   {</span>
<a href="#l9.111"></a><span id="l9.111">   },</span>
<a href="#l9.112"></a><span id="l9.112"> </span>
<a href="#l9.113"></a><span id="l9.113">   OnStopRunningUrl: function(aUrl, aExitCode)</span>
<a href="#l9.114"></a><span id="l9.114">   {</span>
<a href="#l9.115"></a><span id="l9.115">     var folderSummaryInfoEl = document.getElementById('folderSummaryInfo');</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineminus">-    var asyncFetch = {};</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineminus">-    folderSummaryInfoEl.parseFolder(this.mFolder, null, asyncFetch);</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineplus">+    folderSummaryInfoEl.parseFolder(this.mFolder, null, {});</span>
<a href="#l9.119"></a><span id="l9.119">     gPendingPreviewFetchRequests--;</span>
<a href="#l9.120"></a><span id="l9.120"> </span>
<a href="#l9.121"></a><span id="l9.121">     // when we are done running all of our urls for fetching the preview text,</span>
<a href="#l9.122"></a><span id="l9.122">     // start the alert.</span>
<a href="#l9.123"></a><span id="l9.123">     if (!gPendingPreviewFetchRequests)</span>
<a href="#l9.124"></a><span id="l9.124">       showAlert();</span>
<a href="#l9.125"></a><span id="l9.125">   }</span>
<a href="#l9.126"></a><span id="l9.126"> }</span>
<a href="#l9.127"></a><span id="l9.127"> </span>
<a href="#l9.128"></a><span id="l9.128"> function onAlertLoad()</span>
<a href="#l9.129"></a><span id="l9.129"> {</span>
<a href="#l9.130"></a><span id="l9.130">   prefillAlertInfo();</span>
<a href="#l9.131"></a><span id="l9.131">   // read out our initial settings from prefs.</span>
<a href="#l9.132"></a><span id="l9.132">   try </span>
<a href="#l9.133"></a><span id="l9.133">   {</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineminus">-    gSlideTime = Services.prefs.getIntPref(&quot;alerts.slideIncrementTime&quot;);</span>
<a href="#l9.135"></a><span id="l9.135">     gOpenTime = Services.prefs.getIntPref(&quot;alerts.totalOpenTime&quot;);</span>
<a href="#l9.136"></a><span id="l9.136">   } catch (ex) {}</span>
<a href="#l9.137"></a><span id="l9.137">   </span>
<a href="#l9.138"></a><span id="l9.138">   // bogus call to make sure the window is moved offscreen until we are ready for it.</span>
<a href="#l9.139"></a><span id="l9.139">   resizeAlert(true);</span>
<a href="#l9.140"></a><span id="l9.140"> </span>
<a href="#l9.141"></a><span id="l9.141">   // if we aren't waiting to fetch preview text, then go ahead and </span>
<a href="#l9.142"></a><span id="l9.142">   // start showing the alert.</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineat">@@ -110,81 +114,68 @@ function onAlertLoad()</span>
<a href="#l9.144"></a><span id="l9.144">     setTimeout(showAlert, 0); // let the JS thread unwind, to give layout </span>
<a href="#l9.145"></a><span id="l9.145">                               // a chance to recompute the styles and widths for our alert text.</span>
<a href="#l9.146"></a><span id="l9.146"> }</span>
<a href="#l9.147"></a><span id="l9.147"> </span>
<a href="#l9.148"></a><span id="l9.148"> // If the user initiated the alert, show it right away, otherwise start opening the alert with</span>
<a href="#l9.149"></a><span id="l9.149"> // the fade effect. </span>
<a href="#l9.150"></a><span id="l9.150"> function showAlert()</span>
<a href="#l9.151"></a><span id="l9.151"> {</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineminus">-  if (!gUserInitiated) // set the initial opacity before we resize the window</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineminus">-    document.getElementById('alertContainer').style.opacity = 0;</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineminus">-  </span>
<a href="#l9.155"></a><span id="l9.155">   // resize the alert based on our current content  </span>
<a href="#l9.156"></a><span id="l9.156">   resizeAlert(false);</span>
<a href="#l9.157"></a><span id="l9.157">   </span>
<a href="#l9.158"></a><span id="l9.158" class="difflineplus">+  var alertContainer = document.getElementById(&quot;alertContainer&quot;);</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineplus">+  // Don't fade in if the user opened the alert or the pref is true.</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineplus">+  if (gUserInitiated ||</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineplus">+      Services.prefs.getBoolPref(&quot;alerts.disableSlidingEffect&quot;)) {</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineplus">+    alertContainer.setAttribute(&quot;noanimation&quot;, true);</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineplus">+    setTimeout(closeAlert, gOpenTime);</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineplus">+    return;</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineplus">+  }</span>
<a href="#l9.166"></a><span id="l9.166" class="difflineplus">+  </span>
<a href="#l9.167"></a><span id="l9.167">   if (document.getElementById('folderSummaryInfo').hasMessages)</span>
<a href="#l9.168"></a><span id="l9.168">   {</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineminus">-    if (!gUserInitiated) // don't fade in if the user opened the alert</span>
<a href="#l9.170"></a><span id="l9.170" class="difflineminus">-      setTimeout(fadeOpen, gSlideTime);</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineplus">+    alertContainer.addEventListener(&quot;animationend&quot;, function hideAlert(event) {</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineplus">+      if (event.animationName == &quot;alert-animation&quot;) {</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+        alertContainer.removeEventListener(&quot;animationend&quot;, hideAlert, false);</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineplus">+        let remaining = Math.max(Math.round(gOpenTime - event.elapsedTime * 1000), 0);</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineplus">+        setTimeout(closeAlert, remaining);</span>
<a href="#l9.176"></a><span id="l9.176" class="difflineplus">+      }</span>
<a href="#l9.177"></a><span id="l9.177" class="difflineplus">+    }, false);</span>
<a href="#l9.178"></a><span id="l9.178" class="difflineplus">+    alertContainer.setAttribute(&quot;animate&quot;, true);</span>
<a href="#l9.179"></a><span id="l9.179">   }</span>
<a href="#l9.180"></a><span id="l9.180">   else</span>
<a href="#l9.181"></a><span id="l9.181" class="difflineplus">+  {</span>
<a href="#l9.182"></a><span id="l9.182">     closeAlert(); // no mail, so don't bother showing the alert...</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineplus">+  }</span>
<a href="#l9.184"></a><span id="l9.184"> }</span>
<a href="#l9.185"></a><span id="l9.185"> </span>
<a href="#l9.186"></a><span id="l9.186"> function resizeAlert(aMoveOffScreen)</span>
<a href="#l9.187"></a><span id="l9.187"> {</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineminus">-  // sizeToContent is not working. It isn't honoring the max widths we are attaching to our inner</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineminus">-  // objects like the folder summary element. While the folder summary element is cropping, </span>
<a href="#l9.190"></a><span id="l9.190" class="difflineminus">-  // sizeToContent ends up thinking the window needs to be much wider than it should be. </span>
<a href="#l9.191"></a><span id="l9.191" class="difflineminus">-  // use resizeTo and make up our measurements...</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineminus">-  //sizeToContent();</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineminus">-  </span>
<a href="#l9.194"></a><span id="l9.194" class="difflineminus">-  // Use the wider of the alert groove and the folderSummaryInfo box, then </span>
<a href="#l9.195"></a><span id="l9.195" class="difflineminus">-  // add on the width of alertImageBox + some small amount of fudge. For the height, </span>
<a href="#l9.196"></a><span id="l9.196" class="difflineminus">-  // just use the size of the alertBox, that appears to be pretty accurate.</span>
<a href="#l9.197"></a><span id="l9.197" class="difflineminus">-  var windowWidth = Math.max (document.getBoxObjectFor(document.getElementById('alertGroove')).width,</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineminus">-                              document.getBoxObjectFor(document.getElementById('folderSummaryInfo')).width);</span>
<a href="#l9.199"></a><span id="l9.199" class="difflineminus">-  resizeTo(windowWidth + document.getBoxObjectFor(document.getElementById('alertImageBox')).width + 30, </span>
<a href="#l9.200"></a><span id="l9.200" class="difflineminus">-           document.getBoxObjectFor(document.getElementById('alertBox')).height + 10);                     </span>
<a href="#l9.201"></a><span id="l9.201" class="difflineplus">+  var alertTextBox = document.getElementById(&quot;alertTextBox&quot;);</span>
<a href="#l9.202"></a><span id="l9.202" class="difflineplus">+  var alertImageBox = document.getElementById(&quot;alertImageBox&quot;);</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineplus">+  alertImageBox.style.minHeight = alertTextBox.scrollHeight + &quot;px&quot;;</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineplus">+</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineplus">+  sizeToContent();</span>
<a href="#l9.206"></a><span id="l9.206">   </span>
<a href="#l9.207"></a><span id="l9.207">   // leftover hack to get the window properly hidden when we first open it</span>
<a href="#l9.208"></a><span id="l9.208">   if (aMoveOffScreen)</span>
<a href="#l9.209"></a><span id="l9.209">     window.outerHeight = 1;</span>
<a href="#l9.210"></a><span id="l9.210"> </span>
<a href="#l9.211"></a><span id="l9.211" class="difflineminus">-  // Determine position and move window</span>
<a href="#l9.212"></a><span id="l9.212" class="difflineminus">-  var x = gOrigin &amp; LEFT ? screen.availLeft :</span>
<a href="#l9.213"></a><span id="l9.213" class="difflineminus">-          (screen.availLeft + screen.availWidth - window.outerWidth);</span>
<a href="#l9.214"></a><span id="l9.214" class="difflineminus">-  var y = gOrigin &amp; TOP ? screen.availTop :</span>
<a href="#l9.215"></a><span id="l9.215" class="difflineminus">-          (screen.availTop + screen.availHeight - window.outerHeight);</span>
<a href="#l9.216"></a><span id="l9.216" class="difflineminus">-  window.moveTo(x, y);</span>
<a href="#l9.217"></a><span id="l9.217" class="difflineminus">-}</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineplus">+  // Determine position</span>
<a href="#l9.219"></a><span id="l9.219" class="difflineplus">+  var x = gOrigin &amp; NS_ALERT_LEFT ? screen.availLeft :</span>
<a href="#l9.220"></a><span id="l9.220" class="difflineplus">+          screen.availLeft + screen.availWidth - window.outerWidth;</span>
<a href="#l9.221"></a><span id="l9.221" class="difflineplus">+  var y = gOrigin &amp; NS_ALERT_TOP ? screen.availTop :</span>
<a href="#l9.222"></a><span id="l9.222" class="difflineplus">+          screen.availTop + screen.availHeight - window.outerHeight;</span>
<a href="#l9.223"></a><span id="l9.223"> </span>
<a href="#l9.224"></a><span id="l9.224" class="difflineminus">-function fadeOpen()</span>
<a href="#l9.225"></a><span id="l9.225" class="difflineminus">-{</span>
<a href="#l9.226"></a><span id="l9.226" class="difflineminus">-  var alertContainer = document.getElementById('alertContainer');</span>
<a href="#l9.227"></a><span id="l9.227" class="difflineminus">-  var newOpacity = parseFloat(window.getComputedStyle(alertContainer, &quot;&quot;).opacity) + gFadeIncrement;</span>
<a href="#l9.228"></a><span id="l9.228" class="difflineminus">-  alertContainer.style.opacity = newOpacity;</span>
<a href="#l9.229"></a><span id="l9.229" class="difflineminus">-  </span>
<a href="#l9.230"></a><span id="l9.230" class="difflineminus">-  if (newOpacity &lt; 1.0)    </span>
<a href="#l9.231"></a><span id="l9.231" class="difflineminus">-    setTimeout(fadeOpen, gSlideTime);</span>
<a href="#l9.232"></a><span id="l9.232" class="difflineminus">-  else // switch gears and start closing the alert</span>
<a href="#l9.233"></a><span id="l9.233" class="difflineminus">-    setTimeout(fadeClose, gOpenTime);  </span>
<a href="#l9.234"></a><span id="l9.234" class="difflineminus">-}</span>
<a href="#l9.235"></a><span id="l9.235" class="difflineplus">+  // Offset the alert by 10 pixels from the edge of the screen</span>
<a href="#l9.236"></a><span id="l9.236" class="difflineplus">+  y += gOrigin &amp; NS_ALERT_TOP ? 10 : -10;</span>
<a href="#l9.237"></a><span id="l9.237" class="difflineplus">+  x += gOrigin &amp; NS_ALERT_LEFT ? 10 : -10;</span>
<a href="#l9.238"></a><span id="l9.238"> </span>
<a href="#l9.239"></a><span id="l9.239" class="difflineminus">-function fadeClose()</span>
<a href="#l9.240"></a><span id="l9.240" class="difflineminus">-{</span>
<a href="#l9.241"></a><span id="l9.241" class="difflineminus">-  var alertContainer = document.getElementById('alertContainer');</span>
<a href="#l9.242"></a><span id="l9.242" class="difflineminus">-  var newOpacity = parseFloat(window.getComputedStyle(alertContainer, &quot;&quot;).opacity) - gFadeIncrement;</span>
<a href="#l9.243"></a><span id="l9.243" class="difflineminus">-  alertContainer.style.opacity = newOpacity;</span>
<a href="#l9.244"></a><span id="l9.244" class="difflineminus">-  </span>
<a href="#l9.245"></a><span id="l9.245" class="difflineminus">-  if (newOpacity &lt;= 0)</span>
<a href="#l9.246"></a><span id="l9.246" class="difflineminus">-    closeAlert();</span>
<a href="#l9.247"></a><span id="l9.247" class="difflineminus">-  else</span>
<a href="#l9.248"></a><span id="l9.248" class="difflineminus">-    setTimeout(fadeClose, gSlideTime);</span>
<a href="#l9.249"></a><span id="l9.249" class="difflineplus">+  window.moveTo(x, y);</span>
<a href="#l9.250"></a><span id="l9.250"> }</span>
<a href="#l9.251"></a><span id="l9.251"> </span>
<a href="#l9.252"></a><span id="l9.252"> function closeAlert()</span>
<a href="#l9.253"></a><span id="l9.253"> {</span>
<a href="#l9.254"></a><span id="l9.254">   if (gAlertListener)</span>
<a href="#l9.255"></a><span id="l9.255">     gAlertListener.observe(null, &quot;alertfinished&quot;, &quot;&quot;); </span>
<a href="#l9.256"></a><span id="l9.256">   window.close(); </span>
<a href="#l9.257"></a><span id="l9.257"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">copy from mail/base/content/newmailalert.xul</span>
<a href="#l10.2"></a><span id="l10.2">copy to suite/mailnews/newmailalert.xul</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineminus">--- a/mail/base/content/newmailalert.xul</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineplus">+++ b/suite/mailnews/newmailalert.xul</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineat">@@ -1,37 +1,35 @@</span>
<a href="#l10.6"></a><span id="l10.6"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.9"></a><span id="l10.9">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.10"></a><span id="l10.10">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/content/newmailalert.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l10.13"></a><span id="l10.13"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/newmailalert.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15"> &lt;window id=&quot;newMailAlertNotification&quot;</span>
<a href="#l10.16"></a><span id="l10.16">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l10.17"></a><span id="l10.17">         windowtype=&quot;alert:alert&quot;</span>
<a href="#l10.18"></a><span id="l10.18">         role=&quot;alert&quot;</span>
<a href="#l10.19"></a><span id="l10.19">         align=&quot;start&quot;</span>
<a href="#l10.20"></a><span id="l10.20">         onload=&quot;onAlertLoad()&quot;&gt;</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22">   &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l10.23"></a><span id="l10.23">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/newmailalert.js&quot;/&gt;</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25">   &lt;stack id=&quot;alertContainer&quot; mousethrough=&quot;always&quot;&gt;</span>
<a href="#l10.26"></a><span id="l10.26">     &lt;hbox id=&quot;alertBox&quot;&gt;</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">-      &lt;hbox id =&quot;alertImageBox&quot; align=&quot;center&quot; valign=&quot;center&quot;&gt;</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+      &lt;hbox id =&quot;alertImageBox&quot; align=&quot;center&quot; pack=&quot;center&quot;&gt;</span>
<a href="#l10.29"></a><span id="l10.29">         &lt;image id=&quot;alertImage&quot;/&gt;</span>
<a href="#l10.30"></a><span id="l10.30">       &lt;/hbox&gt;</span>
<a href="#l10.31"></a><span id="l10.31"> </span>
<a href="#l10.32"></a><span id="l10.32">       &lt;vbox id=&quot;alertTextBox&quot;&gt;</span>
<a href="#l10.33"></a><span id="l10.33">         &lt;label id=&quot;alertTitle&quot;/&gt;</span>
<a href="#l10.34"></a><span id="l10.34">         &lt;separator id=&quot;alertGroove&quot; class=&quot;groove&quot;/&gt;</span>
<a href="#l10.35"></a><span id="l10.35">         &lt;folderSummary id=&quot;folderSummaryInfo&quot; mousethrough=&quot;never&quot;/&gt;</span>
<a href="#l10.36"></a><span id="l10.36">       &lt;/vbox&gt;</span>
<a href="#l10.37"></a><span id="l10.37">     &lt;/hbox&gt;</span>
<a href="#l10.38"></a><span id="l10.38"> </span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-    &lt;hbox align=&quot;top&quot;&gt;</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">-      &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-      &lt;toolbarbutton id=&quot;closeButton&quot; onclick=&quot;closeAlert();&quot;/&gt;</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-    &lt;/hbox&gt;</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+    &lt;toolbarbutton id=&quot;closeButton&quot; top=&quot;0&quot; right=&quot;0&quot; onclick=&quot;closeAlert();&quot;/&gt;</span>
<a href="#l10.44"></a><span id="l10.44">   &lt;/stack&gt;</span>
<a href="#l10.45"></a><span id="l10.45"> &lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/themes/classic/jar.mn</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/themes/classic/jar.mn</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -251,16 +251,17 @@ classic.jar:</span>
<a href="#l11.4"></a><span id="l11.4">   skin/classic/messenger/dialogs.css                                    (messenger/dialogs.css)</span>
<a href="#l11.5"></a><span id="l11.5">   skin/classic/messenger/accountWizard.css                              (messenger/accountWizard.css)</span>
<a href="#l11.6"></a><span id="l11.6">   skin/classic/messenger/folderMenus.css                                (messenger/folderMenus.css)</span>
<a href="#l11.7"></a><span id="l11.7">   skin/classic/messenger/folderPane.css                                 (messenger/folderPane.css)</span>
<a href="#l11.8"></a><span id="l11.8">   skin/classic/messenger/accountCentral.css                             (messenger/accountCentral.css)</span>
<a href="#l11.9"></a><span id="l11.9">   skin/classic/messenger/addressingWidget.css                           (messenger/addressingWidget.css)</span>
<a href="#l11.10"></a><span id="l11.10">   skin/classic/messenger/messageWindow.css                              (messenger/messageWindow.css)</span>
<a href="#l11.11"></a><span id="l11.11">   skin/classic/messenger/messenger.css                                  (messenger/messenger.css)</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+  skin/classic/messenger/newmailalert.css                               (messenger/newmailalert.css)</span>
<a href="#l11.13"></a><span id="l11.13">   skin/classic/messenger/prefPanels.css                                 (messenger/prefPanels.css)</span>
<a href="#l11.14"></a><span id="l11.14">   skin/classic/messenger/subscribe.css                                  (messenger/subscribe.css)</span>
<a href="#l11.15"></a><span id="l11.15">   skin/classic/messenger/threadPane.css                                 (messenger/threadPane.css)</span>
<a href="#l11.16"></a><span id="l11.16">   skin/classic/messenger/threadPaneLabels.css                           (messenger/threadPaneLabels.css)</span>
<a href="#l11.17"></a><span id="l11.17">   skin/classic/messenger/messageBody.css                                (messenger/messageBody.css)</span>
<a href="#l11.18"></a><span id="l11.18">   skin/classic/messenger/start.css                                      (messenger/start.css)</span>
<a href="#l11.19"></a><span id="l11.19">   skin/classic/messenger/virtualFolderListDialog.css                    (messenger/virtualFolderListDialog.css)</span>
<a href="#l11.20"></a><span id="l11.20">   skin/classic/messenger/icons/acct-compose.png                         (messenger/icons/acct-compose.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">copy from mail/themes/qute/mail/newmailalert.css</span>
<a href="#l12.2"></a><span id="l12.2">copy to suite/themes/classic/messenger/newmailalert.css</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineminus">--- a/mail/themes/qute/mail/newmailalert.css</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineplus">+++ b/suite/themes/classic/messenger/newmailalert.css</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineat">@@ -8,44 +8,34 @@</span>
<a href="#l12.6"></a><span id="l12.6">   ======================================================================= */</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8"> @import url(&quot;chrome://messenger/skin/&quot;);</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12"> #newMailAlertNotification {</span>
<a href="#l12.13"></a><span id="l12.13">   min-height: 60px;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-  border: ridge #5486DA 4px;</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-  background-color: -moz-Dialog;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-  color: -moz-DialogText;</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+  border: ridge SteelBlue 4px;</span>
<a href="#l12.18"></a><span id="l12.18"> }</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20"> #alertImage {</span>
<a href="#l12.21"></a><span id="l12.21">   list-style-image: url(&quot;chrome://branding/content/icon64.png&quot;);</span>
<a href="#l12.22"></a><span id="l12.22"> }</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24"> #alertImageBox {</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-  -moz-margin-start: 4px;</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-  -moz-margin-end: 6px;</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-  min-height: 46px;</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+  padding: 4px;</span>
<a href="#l12.29"></a><span id="l12.29"> }</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31"> #alertTitle {</span>
<a href="#l12.32"></a><span id="l12.32">   font-weight: bold;</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-  text-align: center;</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-  /* this right margin keeps us from overlapping with the</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-     close button. It's value should be related to the width</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-     of the closeButtonImage</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-  */</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-  -moz-margin-end: 16px;</span>
<a href="#l12.39"></a><span id="l12.39"> }</span>
<a href="#l12.40"></a><span id="l12.40"> </span>
<a href="#l12.41"></a><span id="l12.41"> #alertTextBox {</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-  -moz-padding-end: 10px;</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-  padding-top: 5px;</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+  padding: 4px;</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+  -moz-padding-end: 16px;</span>
<a href="#l12.46"></a><span id="l12.46"> }</span>
<a href="#l12.47"></a><span id="l12.47"> </span>
<a href="#l12.48"></a><span id="l12.48"> .folderSummary-message-row</span>
<a href="#l12.49"></a><span id="l12.49"> {</span>
<a href="#l12.50"></a><span id="l12.50">   /* This max width ends up dictating the overall width of the alert window</span>
<a href="#l12.51"></a><span id="l12.51">      because it controls how large the preview, subject and sender text can be</span>
<a href="#l12.52"></a><span id="l12.52">      before cropping kicks in */</span>
<a href="#l12.53"></a><span id="l12.53">   max-width: 450px;</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineat">@@ -65,26 +55,13 @@</span>
<a href="#l12.55"></a><span id="l12.55"> }</span>
<a href="#l12.56"></a><span id="l12.56"> </span>
<a href="#l12.57"></a><span id="l12.57"> .folderSummaryMessage:hover &gt; .folderSummary-message-row {</span>
<a href="#l12.58"></a><span id="l12.58">   cursor: pointer;</span>
<a href="#l12.59"></a><span id="l12.59">   color: blue;</span>
<a href="#l12.60"></a><span id="l12.60"> }</span>
<a href="#l12.61"></a><span id="l12.61"> </span>
<a href="#l12.62"></a><span id="l12.62"> #closeButton {</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineminus">-  list-style-image: url(&quot;chrome://messenger/skin/icons/close-button.png&quot;);</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-  -moz-image-region: rect(0px, 16px, 16px, 0px);</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+  list-style-image: url(&quot;chrome://navigator/skin/icons/close.gif&quot;);</span>
<a href="#l12.66"></a><span id="l12.66">   -moz-appearance: none;</span>
<a href="#l12.67"></a><span id="l12.67">   border: none !important;</span>
<a href="#l12.68"></a><span id="l12.68">   padding: 2px 0px 0px;</span>
<a href="#l12.69"></a><span id="l12.69"> }</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineminus">-#closeButton &gt; .toolbarbutton-icon {</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-  -moz-margin-end: 0px; /* override toolkit's default value */</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-}</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-#closeButton:hover {</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-  -moz-image-region: rect(0px, 32px, 16px, 16px);</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineminus">-}</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-#closeButton:hover:active {</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-  -moz-image-region: rect(0px, 48px, 16px, 32px);</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/suite/themes/modern/jar.mn</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/suite/themes/modern/jar.mn</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -382,16 +382,17 @@ modern.jar:</span>
<a href="#l13.4"></a><span id="l13.4">   skin/modern/messenger/folderPaneExtras.css                       (messenger/folderPaneExtras.css)</span>
<a href="#l13.5"></a><span id="l13.5">   skin/modern/messenger/threadPaneExtras.css                       (messenger/threadPaneExtras.css)</span>
<a href="#l13.6"></a><span id="l13.6">   skin/modern/messenger/messageBody.css                            (messenger/messageBody.css)</span>
<a href="#l13.7"></a><span id="l13.7">   skin/modern/messenger/virtualFolderListDialog.css                (messenger/virtualFolderListDialog.css)</span>
<a href="#l13.8"></a><span id="l13.8">   skin/modern/messenger/messageHeader.css                          (messenger/messageHeader.css)</span>
<a href="#l13.9"></a><span id="l13.9">   skin/modern/messenger/messageKeywords.css                        (messenger/messageKeywords.css)</span>
<a href="#l13.10"></a><span id="l13.10">   skin/modern/messenger/messageWindow.css                          (messenger/messageWindow.css)</span>
<a href="#l13.11"></a><span id="l13.11">   skin/modern/messenger/messenger.css                              (messenger/messenger.css)</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+  skin/modern/messenger/newmailalert.css                           (messenger/newmailalert.css)</span>
<a href="#l13.13"></a><span id="l13.13">   skin/modern/messenger/prefPanels.css                             (messenger/prefPanels.css)</span>
<a href="#l13.14"></a><span id="l13.14">   skin/modern/messenger/searchDialog.css                           (messenger/searchDialog.css)</span>
<a href="#l13.15"></a><span id="l13.15">   skin/modern/messenger/subscribe.css                              (messenger/subscribe.css)</span>
<a href="#l13.16"></a><span id="l13.16">   skin/modern/messenger/mailWindow1.css                            (messenger/mailWindow1.css)</span>
<a href="#l13.17"></a><span id="l13.17">   skin/modern/messenger/threadPane.css                             (messenger/threadPane.css)</span>
<a href="#l13.18"></a><span id="l13.18">   skin/modern/messenger/primaryToolbar.css                         (messenger/primaryToolbar.css)</span>
<a href="#l13.19"></a><span id="l13.19">   skin/modern/messenger/start.css                                  (messenger/start.css)</span>
<a href="#l13.20"></a><span id="l13.20">   skin/modern/messenger/addressbook/abResultsPane.css              (messenger/addressbook/abResultsPane.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">copy from mail/themes/qute/mail/newmailalert.css</span>
<a href="#l14.2"></a><span id="l14.2">copy to suite/themes/modern/messenger/newmailalert.css</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineminus">--- a/mail/themes/qute/mail/newmailalert.css</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineplus">+++ b/suite/themes/modern/messenger/newmailalert.css</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineat">@@ -9,43 +9,33 @@</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> @import url(&quot;chrome://messenger/skin/&quot;);</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> #newMailAlertNotification {</span>
<a href="#l14.12"></a><span id="l14.12">   min-height: 60px;</span>
<a href="#l14.13"></a><span id="l14.13">   border: ridge #5486DA 4px;</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-  background-color: -moz-Dialog;</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-  color: -moz-DialogText;</span>
<a href="#l14.16"></a><span id="l14.16"> }</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18"> #alertImage {</span>
<a href="#l14.19"></a><span id="l14.19">   list-style-image: url(&quot;chrome://branding/content/icon64.png&quot;);</span>
<a href="#l14.20"></a><span id="l14.20"> }</span>
<a href="#l14.21"></a><span id="l14.21"> </span>
<a href="#l14.22"></a><span id="l14.22"> #alertImageBox {</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-  -moz-margin-start: 4px;</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-  -moz-margin-end: 6px;</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-  min-height: 46px;</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+  padding: 4px;</span>
<a href="#l14.27"></a><span id="l14.27"> }</span>
<a href="#l14.28"></a><span id="l14.28"> </span>
<a href="#l14.29"></a><span id="l14.29"> #alertTitle {</span>
<a href="#l14.30"></a><span id="l14.30">   font-weight: bold;</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-  text-align: center;</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-  /* this right margin keeps us from overlapping with the</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-     close button. It's value should be related to the width</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-     of the closeButtonImage</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-  */</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-  -moz-margin-end: 16px;</span>
<a href="#l14.37"></a><span id="l14.37"> }</span>
<a href="#l14.38"></a><span id="l14.38"> </span>
<a href="#l14.39"></a><span id="l14.39"> #alertTextBox {</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-  -moz-padding-end: 10px;</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-  padding-top: 5px;</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+  padding: 4px;</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+  -moz-padding-end: 16px;</span>
<a href="#l14.44"></a><span id="l14.44"> }</span>
<a href="#l14.45"></a><span id="l14.45"> </span>
<a href="#l14.46"></a><span id="l14.46"> .folderSummary-message-row</span>
<a href="#l14.47"></a><span id="l14.47"> {</span>
<a href="#l14.48"></a><span id="l14.48">   /* This max width ends up dictating the overall width of the alert window</span>
<a href="#l14.49"></a><span id="l14.49">      because it controls how large the preview, subject and sender text can be</span>
<a href="#l14.50"></a><span id="l14.50">      before cropping kicks in */</span>
<a href="#l14.51"></a><span id="l14.51">   max-width: 450px;</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineat">@@ -56,35 +46,22 @@</span>
<a href="#l14.53"></a><span id="l14.53">   font-weight: bold;</span>
<a href="#l14.54"></a><span id="l14.54"> }</span>
<a href="#l14.55"></a><span id="l14.55"> </span>
<a href="#l14.56"></a><span id="l14.56"> .folderSummary-sender, .folderSummary-subject {</span>
<a href="#l14.57"></a><span id="l14.57">   cursor: inherit;</span>
<a href="#l14.58"></a><span id="l14.58"> }</span>
<a href="#l14.59"></a><span id="l14.59"> </span>
<a href="#l14.60"></a><span id="l14.60"> .folderSummary-previewText {</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">-  color: grey;</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+  color: #8C99AB;</span>
<a href="#l14.63"></a><span id="l14.63"> }</span>
<a href="#l14.64"></a><span id="l14.64"> </span>
<a href="#l14.65"></a><span id="l14.65"> .folderSummaryMessage:hover &gt; .folderSummary-message-row {</span>
<a href="#l14.66"></a><span id="l14.66">   cursor: pointer;</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineminus">-  color: blue;</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+  color: #0000FF;</span>
<a href="#l14.69"></a><span id="l14.69"> }</span>
<a href="#l14.70"></a><span id="l14.70"> </span>
<a href="#l14.71"></a><span id="l14.71"> #closeButton {</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineminus">-  list-style-image: url(&quot;chrome://messenger/skin/icons/close-button.png&quot;);</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineminus">-  -moz-image-region: rect(0px, 16px, 16px, 0px);</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/closebox.gif&quot;);</span>
<a href="#l14.75"></a><span id="l14.75">   -moz-appearance: none;</span>
<a href="#l14.76"></a><span id="l14.76">   border: none !important;</span>
<a href="#l14.77"></a><span id="l14.77">   padding: 2px 0px 0px;</span>
<a href="#l14.78"></a><span id="l14.78"> }</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineminus">-</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-#closeButton &gt; .toolbarbutton-icon {</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-  -moz-margin-end: 0px; /* override toolkit's default value */</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineminus">-}</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineminus">-</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-#closeButton:hover {</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-  -moz-image-region: rect(0px, 32px, 16px, 16px);</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineminus">-}</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-#closeButton:hover:active {</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-  -moz-image-region: rect(0px, 48px, 16px, 32px);</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-}</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

