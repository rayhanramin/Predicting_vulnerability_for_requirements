<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 57:81120c50a9b3859e2efb1a6732afd0f0c38b9b68</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 81120c50a9b3859e2efb1a6732afd0f0c38b9b68" />
<meta property="og:url" content="/comm-central/rev/81120c50a9b3859e2efb1a6732afd0f0c38b9b68" />
<meta property="og:description" content="Bug 447860 GetMsgTextFromStream should use more libmime. r=Standard8 (unit tests),r/sr=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 81120c50a9b3859e2efb1a6732afd0f0c38b9b68 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/81120c50a9b3859e2efb1a6732afd0f0c38b9b68">shortlog</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/81120c50a9b3859e2efb1a6732afd0f0c38b9b68">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68">files</a> |
changeset |
<a href="/comm-central/raw-rev/81120c50a9b3859e2efb1a6732afd0f0c38b9b68">raw</a>  | <a href="/comm-central/archive/81120c50a9b3859e2efb1a6732afd0f0c38b9b68.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=447860">Bug 447860</a> GetMsgTextFromStream should use more libmime. r=Standard8 (unit tests),r/sr=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#105;&#100;&#100;&#104;&#97;&#114;&#116;&#104;&#32;&#65;&#103;&#97;&#114;&#119;&#97;&#108;&#32;&#60;&#115;&#105;&#100;&#49;&#51;&#51;&#55;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 05 Aug 2008 18:20:49 +0100</td></tr>

<tr>
 <td>changeset 57</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/81120c50a9b3859e2efb1a6732afd0f0c38b9b68">81120c50a9b3859e2efb1a6732afd0f0c38b9b68</a></td>
</tr>



<tr>
<td>parent 56</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9dcf6fd54ed9d8a011f6fa44fa098ed7268e5cd9">9dcf6fd54ed9d8a011f6fa44fa098ed7268e5cd9</a>
</td>
</tr>

<tr>
<td>child 58</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/bca234658e11c20e4ba8603ebdaf50aeda9af2ad">bca234658e11c20e4ba8603ebdaf50aeda9af2ad</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=81120c50a9b3859e2efb1a6732afd0f0c38b9b68">51</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 05 Aug 2008 17:21:21 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@81120c50a9b3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=81120c50a9b3859e2efb1a6732afd0f0c38b9b68">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=81120c50a9b3859e2efb1a6732afd0f0c38b9b68&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=81120c50a9b3859e2efb1a6732afd0f0c38b9b68&newProject=comm-central&newRevision=9dcf6fd54ed9d8a011f6fa44fa098ed7268e5cd9&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=81120c50a9b3859e2efb1a6732afd0f0c38b9b68&newProject=comm-central&newRevision=9dcf6fd54ed9d8a011f6fa44fa098ed7268e5cd9&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=81120c50a9b3859e2efb1a6732afd0f0c38b9b68&newProject=comm-central&newRevision=9dcf6fd54ed9d8a011f6fa44fa098ed7268e5cd9&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=447860">447860</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=447860">Bug 447860</a> GetMsgTextFromStream should use more libmime. r=Standard8 (unit tests),r/sr=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mail/components/search/nsSpotlightIntegration.js">mail/components/search/nsSpotlightIntegration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mail/components/search/nsSpotlightIntegration.js">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mail/components/search/nsSpotlightIntegration.js">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mail/components/search/nsSpotlightIntegration.js">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mail/components/search/nsSpotlightIntegration.js">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mail/components/search/nsSpotlightIntegration.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/public/nsIMsgFolder.idl">mailnews/base/public/nsIMsgFolder.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/public/nsIMsgFolder.idl">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/public/nsIMsgFolder.idl">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/public/nsIMsgFolder.idl">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/public/nsIMsgFolder.idl">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/public/nsIMsgFolder.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/test/unit/test_getMsgTextFromStream.js">mailnews/base/test/unit/test_getMsgTextFromStream.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/test/unit/test_getMsgTextFromStream.js">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/test/unit/test_getMsgTextFromStream.js">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/test/unit/test_getMsgTextFromStream.js">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/test/unit/test_getMsgTextFromStream.js">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/test/unit/test_getMsgTextFromStream.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1">mailnews/test/data/base64-1</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1.out">mailnews/test/data/base64-1.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-1.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2">mailnews/test/data/base64-2</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2.out">mailnews/test/data/base64-2.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-2.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3">mailnews/test/data/base64-3</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3.out">mailnews/test/data/base64-3.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/base64-3.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1">mailnews/test/data/basic1</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1.out">mailnews/test/data/basic1.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic1.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2">mailnews/test/data/basic2</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2.out">mailnews/test/data/basic2.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic2.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3">mailnews/test/data/basic3</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3.out">mailnews/test/data/basic3.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic3.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4">mailnews/test/data/basic4</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4.out">mailnews/test/data/basic4.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic4.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5">mailnews/test/data/basic5</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5.out">mailnews/test/data/basic5.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/basic5.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1">mailnews/test/data/multipart-base64-1</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1.out">mailnews/test/data/multipart-base64-1.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-1.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2">mailnews/test/data/multipart-base64-2</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2.out">mailnews/test/data/multipart-base64-2.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-2.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3">mailnews/test/data/multipart-base64-3</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3.out">mailnews/test/data/multipart-base64-3.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-base64-3.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1">mailnews/test/data/multipart-complex1</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1.out">mailnews/test/data/multipart-complex1.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex1.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2">mailnews/test/data/multipart-complex2</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2.out">mailnews/test/data/multipart-complex2.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart-complex2.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1">mailnews/test/data/multipart1</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1.out">mailnews/test/data/multipart1.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart1.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2">mailnews/test/data/multipart2</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2.out">mailnews/test/data/multipart2.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart2.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3">mailnews/test/data/multipart3</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3.out">mailnews/test/data/multipart3.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart3.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4">mailnews/test/data/multipart4</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4.out">mailnews/test/data/multipart4.out</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4.out">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4.out">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4.out">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4.out">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/data/multipart4.out">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/resources/mailTestUtils.js">mailnews/test/resources/mailTestUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/resources/mailTestUtils.js">file</a> |
<a href="/comm-central/annotate/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/resources/mailTestUtils.js">annotate</a> |
<a href="/comm-central/diff/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/resources/mailTestUtils.js">diff</a> |
<a href="/comm-central/comparison/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/resources/mailTestUtils.js">comparison</a> |
<a href="/comm-central/log/81120c50a9b3859e2efb1a6732afd0f0c38b9b68/mailnews/test/resources/mailTestUtils.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/search/nsSpotlightIntegration.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/search/nsSpotlightIntegration.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -167,17 +167,17 @@ onStopRequest: function(request, context</span>
<a href="#l1.4"></a><span id="l1.4">   try</span>
<a href="#l1.5"></a><span id="l1.5">   {</span>
<a href="#l1.6"></a><span id="l1.6">     // we want to write out the from, to, cc, and subject headers into the</span>
<a href="#l1.7"></a><span id="l1.7">     // Text Content value, so they'll be indexed.</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">     var stringStream = Cc[&quot;@mozilla.org/io/string-input-stream;1&quot;].</span>
<a href="#l1.10"></a><span id="l1.10">       createInstance(Ci.nsIStringInputStream);</span>
<a href="#l1.11"></a><span id="l1.11">     stringStream.setData(this.message, this.message.length);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    var temp = this.msgHdr.folder.getMsgTextFromStream(this.msgHdr, stringStream, 20000, 20000, false);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    var temp = this.msgHdr.folder.getMsgTextFromStream(stringStream, this.msgHdr.Charset, 20000, 20000, false, true, {});</span>
<a href="#l1.14"></a><span id="l1.14">     temp = xmlEscapeString(temp);</span>
<a href="#l1.15"></a><span id="l1.15">     SIDump(&quot;utf8 text = *****************\n&quot;+ temp + &quot;\n&quot;);</span>
<a href="#l1.16"></a><span id="l1.16">     this.outputStream.write(temp, temp.length);</span>
<a href="#l1.17"></a><span id="l1.17">     // close out the content, dict, and plist</span>
<a href="#l1.18"></a><span id="l1.18">     this.outputStream.write(&quot;&lt;/string&gt;\n&lt;/dict&gt;\n&lt;/plist&gt;\n&quot;, 26);</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">     this.outputStream.close();</span>
<a href="#l1.21"></a><span id="l1.21">    // this.outputFile.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgFolder.idl</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgFolder.idl</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -63,17 +63,17 @@ interface nsIMsgIdentity;</span>
<a href="#l2.4"></a><span id="l2.4"> interface nsIArray;</span>
<a href="#l2.5"></a><span id="l2.5"> interface nsIMutableArray;</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> typedef long nsMsgBiffState;</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> // enumerated type for determining if a message has been replied to, forwarded, etc.</span>
<a href="#l2.10"></a><span id="l2.10"> typedef long nsMsgDispositionState;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-[scriptable, uuid(3f7232c5-2b63-457a-bda9-585f3a9eee7c)]</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+[scriptable, uuid(68b5b459-bb89-4ea1-9513-60e763770908)]</span>
<a href="#l2.14"></a><span id="l2.14"> interface nsIMsgFolder : nsISupports {</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16">   const nsMsgBiffState nsMsgBiffState_NewMail = 0; // User has new mail waiting.</span>
<a href="#l2.17"></a><span id="l2.17">   const nsMsgBiffState nsMsgBiffState_NoMail =  1; // No new mail is waiting.</span>
<a href="#l2.18"></a><span id="l2.18">   const nsMsgBiffState nsMsgBiffState_Unknown = 2; // We dunno whether there is new mail.</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20">   nsISimpleEnumerator getMessages(in nsIMsgWindow aMsgWindow);</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -581,26 +581,32 @@ interface nsIMsgFolder : nsISupports {</span>
<a href="#l2.23"></a><span id="l2.23">                       in nsIUrlListener aUrlListener);</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25">   // used to set/clear tags - we could have a single method to setKeywords which</span>
<a href="#l2.26"></a><span id="l2.26">   // would figure out the diffs, but these methods might be more convenient.</span>
<a href="#l2.27"></a><span id="l2.27">   // keywords are space delimited, in the case of multiple keywords</span>
<a href="#l2.28"></a><span id="l2.28">   void addKeywordsToMessages(in nsIArray aMessages, in ACString aKeywords);</span>
<a href="#l2.29"></a><span id="l2.29">   void removeKeywordsFromMessages(in nsIArray aMessages, in ACString aKeywords);</span>
<a href="#l2.30"></a><span id="l2.30">   /**</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-   * Extract the message preview text from aStream, storing it as a string property</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-   * on aMsgHdr.</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+   * Extract the message text from aStream.</span>
<a href="#l2.34"></a><span id="l2.34">    *</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-   * @param aMsgHdr</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-   * @param aStream</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-   * @param aBytesToRead number of bytes to read from the stream</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+   * @param aStream stream to read from</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+   * @param aCharset character set to use to interpret the body. If an empty string, then the</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+   *        charset is retrieved from the headers. msgHdr.charset is recommended in case you have it.</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+   * @param aBytesToRead number of bytes to read from the stream. The function will read till the end</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+   *        of the line, and there will also be some read ahead due to NS_ReadLine</span>
<a href="#l2.43"></a><span id="l2.43">    * @param aMaxOutputLen desired length of the converted message text. Used to control how many characters</span>
<a href="#l2.44"></a><span id="l2.44">    *        of msg text we want to store.</span>
<a href="#l2.45"></a><span id="l2.45">    * @param aCompressQuotes Replace quotes and citations with &quot; ... &quot; in the preview text</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+   * @param aStripHTMLTags strip HTML tags from the output, if present</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+   * @param[out] aContentType the content type of the MIME part that was used to generate the text --</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+   *             for an HTML part, this will be &quot;text/html&quot; even though aStripHTMLTags might be true</span>
<a href="#l2.49"></a><span id="l2.49">    */</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-  AUTF8String getMsgTextFromStream(in nsIMsgDBHdr aMsgHdr, in nsIInputStream aStream,</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-                                   in long aBytesToRead, in long aMaxOutputLen, in boolean aCompressQuotes);</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+  AUTF8String getMsgTextFromStream(in nsIInputStream aStream, in ACString aCharset,</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+                                   in unsigned long aBytesToRead, in unsigned long aMaxOutputLen, </span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+                                   in boolean aCompressQuotes, in boolean aStripHTMLTags,</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+                                   out ACString aContentType);</span>
<a href="#l2.56"></a><span id="l2.56"> </span>
<a href="#l2.57"></a><span id="l2.57">   // this allows a folder to have a special identity. E.g., you might want to</span>
<a href="#l2.58"></a><span id="l2.58">   // associate an identity with a particular newsgroup, or for IMAP shared folders in</span>
<a href="#l2.59"></a><span id="l2.59">   // the other users namespace, you might want to create a delegated identity</span>
<a href="#l2.60"></a><span id="l2.60">   readonly attribute nsIMsgIdentity customIdentity;</span>
<a href="#l2.61"></a><span id="l2.61"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/mailnews/base/test/unit/test_getMsgTextFromStream.js</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,79 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+ *</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+ * Any copyright is dedicated to the Public Domain.</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+ * http://creativecommons.org/licenses/publicdomain/</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+ *</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+/**</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+ * Test suite for GetMsgTextFromStream.</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+ *</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+ * Currently tests: text/plain, text/html -- with tags stripped and without,</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+ * base64, multipart.</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+ * Does not currently test: quoted-printable, stripping quotes, UTF-8, small values of</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+ * bytesToRead.</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+ */</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+const kDataRoot = &quot;../mailnews/test/data/&quot;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+function create(fileName, bytes, compressQuotes, stripHTML, outContentType)</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+{</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+  return {name: fileName, bytesToRead: bytes, compressQuotes: compressQuotes, stripHTML: stripHTML,</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+          contentType: outContentType};</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+}</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+const gTestFiles =</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+[</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+  create(&quot;basic1&quot;, 1024, false, false, &quot;text/plain&quot;), // Simple plain text</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+  create(&quot;basic1&quot;, 1024, false, true, &quot;text/plain&quot;), // should be same as above</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+  create(&quot;basic2&quot;, 1024, false, false, &quot;text/html&quot;), // Simple HTML</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+  create(&quot;basic3&quot;, 1024, false, true, &quot;text/html&quot;), // HTML with tags stripped out</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+  create(&quot;basic4&quot;, 1024, false, false, &quot;text/plain&quot;), // No content type, should be assumed to be text/plain</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+  create(&quot;basic4&quot;, 1024, false, true, &quot;text/plain&quot;),</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+  create(&quot;basic5&quot;, 1024, false, false, &quot;text/plain&quot;), // HTML content in text/plain</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+  create(&quot;basic5&quot;, 1024, false, true, &quot;text/plain&quot;),</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+  create(&quot;base64-1&quot;, 1024, false, false, &quot;text/plain&quot;), // base64 text/plain</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+  create(&quot;base64-1&quot;, 1024, false, true, &quot;text/plain&quot;),</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+  create(&quot;base64-2&quot;, 1024, false, false, &quot;text/html&quot;), // base64 text/html</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+  create(&quot;base64-3&quot;, 1024, false, true, &quot;text/html&quot;), // strip out tags here</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+  create(&quot;multipart1&quot;, 1024, false, false, &quot;text/plain&quot;), // basic multipart message</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+  create(&quot;multipart1&quot;, 1024, false, true, &quot;text/plain&quot;),</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+  create(&quot;multipart2&quot;, 1024, false, false, &quot;text/html&quot;), // multipart HTML</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+  create(&quot;multipart3&quot;, 1024, false, true, &quot;text/html&quot;),</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+  create(&quot;multipart4&quot;, 1024, false, false, &quot;text/plain&quot;), // text with no headers</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+  create(&quot;multipart4&quot;, 1024, false, true, &quot;text/plain&quot;),</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+  create(&quot;multipart-base64-1&quot;, 1024, false, false, &quot;text/plain&quot;), // base64 encoded text</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+  create(&quot;multipart-base64-1&quot;, 1024, false, true, &quot;text/plain&quot;),</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+  create(&quot;multipart-base64-2&quot;, 1024, false, false, &quot;text/html&quot;),</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+  create(&quot;multipart-base64-3&quot;, 1024, false, true, &quot;text/html&quot;),</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+  create(&quot;multipart-complex1&quot;, 1024, false, true, &quot;text/html&quot;), // Things get more complex here</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+  create(&quot;multipart-complex2&quot;, 1024, false, false, &quot;text/plain&quot;),</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+  create(&quot;multipart-complex2&quot;, 1024, false, true, &quot;text/plain&quot;),</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+]</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+function run_test()</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+{</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+  loadLocalMailAccount();</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+  var folder = gLocalIncomingServer.rootMsgFolder;</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineplus">+  gTestFiles.forEach(function (test)</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+  {</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+    dump(&quot;Testing &quot;+test.name+&quot;\n&quot;);</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+    var inFile = do_get_file(kDataRoot + test.name);</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+    var inStream = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+                     .createInstance(Ci.nsIFileInputStream);</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+    inStream.init(inFile, -1, -1, Ci.nsIFileInputStream.CLOSE_ON_EOF);</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+    // Now get the message body using getMsgTextFromStream</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+    var contentType = {};</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+    var body = folder.getMsgTextFromStream(inStream, &quot;&quot;, test.bytesToRead, 65536,</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+                                           test.compressQuotes, test.stripHTML, contentType);</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+    // Now we need to compare the output</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+    do_check_eq(test.contentType, contentType.value);</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+    var resultFile = do_get_file(kDataRoot + test.name + &quot;.out&quot;);</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+    var actualBody = loadFileToString(resultFile, &quot;UTF-8&quot;);</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+    do_check_eq(body, actualBody);</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+  });</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -85,16 +85,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l4.5"></a><span id="l4.5"> #include &quot;nsIMIMEHeaderParam.h&quot;</span>
<a href="#l4.6"></a><span id="l4.6"> #include &quot;plbase64.h&quot;</span>
<a href="#l4.7"></a><span id="l4.7"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l4.8"></a><span id="l4.8"> #include &lt;time.h&gt;</span>
<a href="#l4.9"></a><span id="l4.9"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l4.10"></a><span id="l4.10"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l4.11"></a><span id="l4.11"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+#include &quot;nsIMimeHeaders.h&quot;</span>
<a href="#l4.13"></a><span id="l4.13"> </span>
<a href="#l4.14"></a><span id="l4.14"> #define oneHour 3600000000U</span>
<a href="#l4.15"></a><span id="l4.15"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17"> static PRTime gtimeOfLastPurgeCheck;    //variable to know when to check for purge_threshhold</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19"> #define PREF_MAIL_PROMPT_PURGE_THRESHOLD &quot;mail.prompt_purge_threshhold&quot;</span>
<a href="#l4.20"></a><span id="l4.20"> #define PREF_MAIL_PURGE_THRESHOLD &quot;mail.purge_threshhold&quot;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -4581,187 +4582,244 @@ NS_IMETHODIMP nsMsgDBFolder::FetchMsgPre</span>
<a href="#l4.22"></a><span id="l4.22">                                                  PRBool aLocalOnly, nsIUrlListener *aUrlListener,</span>
<a href="#l4.23"></a><span id="l4.23">                                                  PRBool *aAsyncResults)</span>
<a href="#l4.24"></a><span id="l4.24"> {</span>
<a href="#l4.25"></a><span id="l4.25">   NS_ENSURE_ARG_POINTER(aKeysToFetch);</span>
<a href="#l4.26"></a><span id="l4.26">   NS_ENSURE_ARG_POINTER(aAsyncResults);</span>
<a href="#l4.27"></a><span id="l4.27">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l4.28"></a><span id="l4.28"> }</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-NS_IMETHODIMP nsMsgDBFolder::GetMsgTextFromStream(nsIMsgDBHdr *msgHdr, nsIInputStream *stream,</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-                                                  PRInt32 bytesToRead,</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-                                                  PRInt32 aMaxOutputLen,</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-                                                  PRBool aCompressQuotes,</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-                                                  nsACString &amp;aMsgText)</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+NS_IMETHODIMP nsMsgDBFolder::GetMsgTextFromStream(nsIInputStream *stream, const nsACString &amp;aCharset,</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+                                                  PRUint32 bytesToRead, PRUint32 aMaxOutputLen,</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+                                                  PRBool aCompressQuotes, PRBool aStripHTMLTags,</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+                                                  nsACString &amp;aContentType, nsACString &amp;aMsgText)</span>
<a href="#l4.39"></a><span id="l4.39"> {</span>
<a href="#l4.40"></a><span id="l4.40">   /*</span>
<a href="#l4.41"></a><span id="l4.41">    1. non mime message - the message body starts after the blank line following the headers.</span>
<a href="#l4.42"></a><span id="l4.42">    2. mime message, multipart/alternative - we could simply scan for the boundary line,</span>
<a href="#l4.43"></a><span id="l4.43">    advance past its headers, and treat the next few lines as the text.</span>
<a href="#l4.44"></a><span id="l4.44">    3. mime message, text/plain - body follows headers</span>
<a href="#l4.45"></a><span id="l4.45">    4. multipart/mixed - scan past boundary, treat next part as body.</span>
<a href="#l4.46"></a><span id="l4.46">    */</span>
<a href="#l4.47"></a><span id="l4.47"> </span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-  // If we've got a header charset use it, otherwise look for one in the mime parts.</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-  PRUint32 len;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-  msgHdr-&gt;GetMessageSize(&amp;len);</span>
<a href="#l4.51"></a><span id="l4.51">   nsLineBuffer&lt;char&gt; *lineBuffer;</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-</span>
<a href="#l4.53"></a><span id="l4.53">   nsresult rv = NS_InitLineBuffer(&amp;lineBuffer);</span>
<a href="#l4.54"></a><span id="l4.54">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.55"></a><span id="l4.55"> </span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-  nsCString strCharset;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-  msgHdr-&gt;GetCharset(getter_Copies(strCharset));</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-  nsAutoString charset;</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-  CopyUTF8toUTF16(strCharset, charset);</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-  nsCString msgText;</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-  nsCAutoString encoding;</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-  nsCAutoString boundary;</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+  nsCAutoString msgText;</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+  nsAutoString contentType;</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+  nsAutoString encoding;</span>
<a href="#l4.67"></a><span id="l4.67">   nsCAutoString curLine;</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineplus">+  nsCAutoString charset(aCharset);</span>
<a href="#l4.69"></a><span id="l4.69"> </span>
<a href="#l4.70"></a><span id="l4.70">   // might want to use a state var instead of bools.</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-  PRBool inMsgBody = PR_FALSE, msgBodyIsHtml = PR_FALSE, lookingForBoundary = PR_FALSE;</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-  PRBool lookingForCharset = PR_FALSE;</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-  PRBool haveBoundary = PR_FALSE;</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-  PRBool isBase64 = PR_FALSE;</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-  PRBool reachedEndBody = bytesToRead &gt;= len;</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineplus">+  PRBool msgBodyIsHtml = PR_FALSE;</span>
<a href="#l4.77"></a><span id="l4.77">   PRBool more = PR_TRUE;</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-  while (len &gt; 0 &amp;&amp; more)</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+  PRBool reachedEndBody = PR_FALSE;</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+  PRBool isBase64 = PR_FALSE;</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+  PRBool inMsgBody = PR_FALSE;</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+  PRBool justPassedEndBoundary = PR_FALSE;</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+  PRUint32 bytesRead = 0;</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineplus">+</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineplus">+  // Both are used to extract data from the headers</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineplus">+  nsCOMPtr&lt;nsIMimeHeaders&gt; mimeHeaders(do_CreateInstance(NS_IMIMEHEADERS_CONTRACTID, &amp;rv));</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+  nsCOMPtr&lt;nsIMIMEHeaderParam&gt; mimeHdrParam(do_GetService(NS_MIMEHEADERPARAM_CONTRACTID, &amp;rv));</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+  // Stack of boundaries, used to figure out where we are</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineplus">+  nsTArray&lt;nsCString&gt; boundaryStack;</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineplus">+</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineplus">+  while (!inMsgBody &amp;&amp; bytesRead &lt;= bytesToRead)</span>
<a href="#l4.96"></a><span id="l4.96">   {</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">-    // might be on same line as content-type, so look before</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-    // we read the next line.</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineminus">-    if (lookingForBoundary)</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineplus">+    nsCAutoString msgHeaders;</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+    // We want to NS_ReadLine until we get to a blank line (the end of the headers)</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+    while (more)</span>
<a href="#l4.103"></a><span id="l4.103">     {</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-      // Mail.app doesn't wrap the boundary id in quotes so we need</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-      // to be sure to handle an unquoted boundary.</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-      PRInt32 boundaryIndex = curLine.Find(&quot;boundary=&quot;, PR_TRUE /* ignore case*/);</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-      if (boundaryIndex != -1)</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+      rv = NS_ReadLine(stream, lineBuffer, curLine, &amp;more);</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+      if (curLine.IsEmpty())</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineplus">+        break;</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineplus">+      msgHeaders.Append(curLine);</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+      msgHeaders.Append(NS_LITERAL_CSTRING(&quot;\r\n&quot;));</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineplus">+      bytesRead += curLine.Length();</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineplus">+      if (bytesRead &gt; bytesToRead)</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineplus">+        break;</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineplus">+    }</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineplus">+</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineplus">+    // There's no point in processing if we can't get the body</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+    if (bytesRead &gt; bytesToRead)</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineplus">+      break;</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineplus">+</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineplus">+    // Process the headers, looking for things we need</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineplus">+    rv = mimeHeaders-&gt;Initialize(msgHeaders.get(), msgHeaders.Length());</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineplus">+</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+    nsCAutoString contentTypeHdr;</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineplus">+    mimeHeaders-&gt;ExtractHeader(&quot;Content-Type&quot;, PR_FALSE, getter_Copies(contentTypeHdr));</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineplus">+</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+    // Get the content type</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineplus">+    // If we don't have a content type, then we assign text/plain</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineplus">+    // this is in violation of the RFC for multipart/digest, though</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineplus">+    // Also, if we've just passed an end boundary, we're going to ignore this.</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineplus">+    if (!justPassedEndBoundary &amp;&amp; contentTypeHdr.IsEmpty())</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineplus">+      contentType.Assign(NS_LITERAL_STRING(&quot;text/plain&quot;));</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+    else</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineplus">+      mimeHdrParam-&gt;GetParameter(contentTypeHdr, nsnull, EmptyCString(), PR_FALSE, nsnull, contentType);</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineplus">+</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineplus">+    justPassedEndBoundary = PR_FALSE;</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineplus">+</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineplus">+    // If we are multipart, then we need to get the boundary</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineplus">+    if (StringBeginsWith(contentType, NS_LITERAL_STRING(&quot;multipart/&quot;), nsCaseInsensitiveStringComparator()))</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineplus">+#else</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineplus">+    if (StringBeginsWith(contentType, NS_LITERAL_STRING(&quot;multipart/&quot;), CaseInsensitiveCompare))</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineplus">+#endif</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineplus">+    {</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineplus">+      nsAutoString boundaryParam;</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineplus">+      mimeHdrParam-&gt;GetParameter(contentTypeHdr, &quot;boundary&quot;, EmptyCString(), PR_FALSE, nsnull, boundaryParam);</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineplus">+      if (!boundaryParam.IsEmpty())</span>
<a href="#l4.151"></a><span id="l4.151">       {</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineminus">-        boundaryIndex += 9;</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineminus">-        if (curLine[boundaryIndex] == '\&quot;')</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineminus">-          boundaryIndex++;</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineminus">-</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineminus">-        PRInt32 endBoundaryIndex = curLine.RFindChar('&quot;');</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">-        if (endBoundaryIndex == -1)</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineminus">-          endBoundaryIndex = curLine.Length(); // no trailing quote? assume the boundary runs to the end of the line</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineminus">-</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineminus">-        // prepend &quot;--&quot; to boundary, and then boundary delimiter, minus the trailing &quot;</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineminus">-        boundary.Assign(&quot;--&quot;);</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineminus">-        boundary.Append(Substring(curLine, boundaryIndex, endBoundaryIndex - boundaryIndex));</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineminus">-        haveBoundary = PR_TRUE;</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-        lookingForBoundary = PR_FALSE;</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineplus">+        nsCAutoString boundary(NS_LITERAL_CSTRING(&quot;--&quot;));</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineplus">+        boundary.Append(NS_ConvertUTF16toUTF8(boundaryParam));</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineplus">+        boundaryStack.AppendElement(boundary);</span>
<a href="#l4.168"></a><span id="l4.168">       }</span>
<a href="#l4.169"></a><span id="l4.169">     }</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineminus">-    rv = NS_ReadLine(stream, lineBuffer, curLine, &amp;more);</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineplus">+</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineplus">+    // If we are message/rfc822, then there's another header block coming up</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineplus">+    else if (contentType.Equals(NS_LITERAL_STRING(&quot;message/rfc822&quot;), nsCaseInsensitiveStringComparator()))</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineplus">+#else</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineplus">+    else if (contentType.Equals(NS_LITERAL_STRING(&quot;message/rfc822&quot;), CaseInsensitiveCompare))</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineplus">+#endif</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineplus">+      continue;</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineplus">+</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineplus">+    // If we are a text part, then we want it</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineplus">+    else if (StringBeginsWith(contentType, NS_LITERAL_STRING(&quot;text/&quot;), nsCaseInsensitiveStringComparator()))</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineplus">+#else</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineplus">+    else if (StringBeginsWith(contentType, NS_LITERAL_STRING(&quot;text/&quot;), CaseInsensitiveCompare))</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineplus">+#endif</span>
<a href="#l4.187"></a><span id="l4.187">     {</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineminus">-      len -= MSG_LINEBREAK_LEN;</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineminus">-      len -= curLine.Length();</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineplus">+      inMsgBody = PR_TRUE;</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineplus">+</span>
<a href="#l4.192"></a><span id="l4.192" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineplus">+      if (contentType.Equals(NS_LITERAL_STRING(&quot;text/html&quot;), nsCaseInsensitiveStringComparator()))</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineplus">+#else</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineplus">+      if (contentType.Equals(NS_LITERAL_STRING(&quot;text/html&quot;), CaseInsensitiveCompare))</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineplus">+#endif</span>
<a href="#l4.197"></a><span id="l4.197" class="difflineplus">+        msgBodyIsHtml = PR_TRUE;</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineplus">+</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineplus">+      // Also get the charset if required</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineplus">+      if (charset.IsEmpty())</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineplus">+      {</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineplus">+        nsAutoString charsetW;</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineplus">+        mimeHdrParam-&gt;GetParameter(contentTypeHdr, &quot;charset&quot;, EmptyCString(), PR_FALSE, nsnull, charsetW);</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineplus">+        charset.Assign(NS_ConvertUTF16toUTF8(charsetW));</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineplus">+      }</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineplus">+</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineplus">+      // Finally, get the encoding</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineplus">+      nsCAutoString encodingHdr;</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineplus">+      mimeHeaders-&gt;ExtractHeader(&quot;Content-Transfer-Encoding&quot;, PR_FALSE, getter_Copies(encodingHdr));</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineplus">+      if (!encodingHdr.IsEmpty())</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineplus">+        mimeHdrParam-&gt;GetParameter(encodingHdr, nsnull, EmptyCString(), PR_FALSE, nsnull, encoding);</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineplus">+</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineplus">+      if (encoding.Equals(NS_LITERAL_STRING(&quot;base64&quot;), nsCaseInsensitiveStringComparator()))</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineplus">+#else</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineplus">+      if (encoding.Equals(NS_LITERAL_STRING(&quot;base64&quot;), CaseInsensitiveCompare))</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineplus">+#endif</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineplus">+        isBase64 = PR_TRUE;</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineplus">+    }</span>
<a href="#l4.220"></a><span id="l4.220" class="difflineplus">+</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineplus">+    // We need to consume the rest, until the next headers</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineplus">+    PRUint32 count = boundaryStack.Length();</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineplus">+    nsCAutoString boundary;</span>
<a href="#l4.224"></a><span id="l4.224" class="difflineplus">+    nsCAutoString endBoundary;</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineplus">+    if (count)</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineplus">+    {</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineplus">+      boundary.Assign(boundaryStack.ElementAt(count - 1));</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineplus">+      endBoundary.Assign(boundary);</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineplus">+      endBoundary.Append(NS_LITERAL_CSTRING(&quot;--&quot;));</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineplus">+    }</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineplus">+    while (more)</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineplus">+    {</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineplus">+      rv = NS_ReadLine(stream, lineBuffer, curLine, &amp;more);</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineplus">+</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineplus">+      if (count)</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineplus">+      {</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineplus">+        // If we've reached a MIME final delimiter, pop and break</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineplus">+        if (StringBeginsWith(curLine, endBoundary))</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineplus">+        {</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineplus">+          if (inMsgBody)</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineplus">+            reachedEndBody = PR_TRUE;</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineplus">+          boundaryStack.RemoveElementAt(count - 1);</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineplus">+          justPassedEndBoundary = PR_TRUE;</span>
<a href="#l4.245"></a><span id="l4.245" class="difflineplus">+          break;</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineplus">+        }</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineplus">+        // If we've reached the end of this MIME part, we can break</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineplus">+        if (StringBeginsWith(curLine, boundary))</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineplus">+        {</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineplus">+          if (inMsgBody)</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineplus">+            reachedEndBody = PR_TRUE;</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineplus">+          break;</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineplus">+        }</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineplus">+      }</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineplus">+</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineplus">+      // Only append the text if we're actually in the message body</span>
<a href="#l4.257"></a><span id="l4.257">       if (inMsgBody)</span>
<a href="#l4.258"></a><span id="l4.258">       {</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineminus">-        if (!boundary.IsEmpty() &amp;&amp; boundary.Equals(curLine))</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineminus">-        {</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineminus">-          reachedEndBody = PR_TRUE;</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineminus">-          break;</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-        }</span>
<a href="#l4.264"></a><span id="l4.264">         msgText.Append(curLine);</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineminus">-        if (!isBase64) // don't append a LF for base64 encoded text</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineminus">-          msgText.Append('\n'); // put a LF back, we'll strip this out later</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineminus">-</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineminus">-        if (msgText.Length() &gt; bytesToRead)</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineminus">-          break;</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineminus">-        continue;</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineminus">-      }</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineminus">-      if (haveBoundary)</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineminus">-      {</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineminus">-        // this line is the boundary; continue and fall into code that looks</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineminus">-        // for msg body after headers</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineminus">-        if (curLine.Equals(boundary))</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineminus">-          haveBoundary = PR_FALSE;</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineminus">-        continue;</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineminus">-      }</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineminus">-      if (curLine.IsEmpty())</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineminus">-      {</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineminus">-        inMsgBody = PR_TRUE;</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineminus">-        continue;</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineplus">+        if (!isBase64)</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineplus">+          msgText.Append(NS_LITERAL_CSTRING(&quot;\r\n&quot;));</span>
<a href="#l4.286"></a><span id="l4.286">       }</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineminus">-#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineminus">-      if (StringBeginsWith(curLine, NS_LITERAL_CSTRING(&quot;Content-Type:&quot;),</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineminus">-                           nsCaseInsensitiveCStringComparator()) ||</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineminus">-                           lookingForCharset)</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineminus">-#else</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineminus">-      if (StringBeginsWith(curLine, NS_LITERAL_CSTRING(&quot;Content-Type:&quot;),</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineminus">-                           CaseInsensitiveCompare) ||</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineminus">-                           lookingForCharset)</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineminus">-#endif</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineminus">-      {</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineminus">-        // look for a charset in the Content-Type header line, we'll take the first one we find.</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineminus">-        nsCOMPtr&lt;nsIMIMEHeaderParam&gt; mimehdrpar = do_GetService(NS_MIMEHEADERPARAM_CONTRACTID, &amp;rv);</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineminus">-        if (NS_SUCCEEDED(rv) &amp;&amp; charset.IsEmpty())</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineminus">-          mimehdrpar-&gt;GetParameter(curLine, &quot;charset&quot;, EmptyCString(), false, nsnull, charset);</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineminus">-        // if the Content-Type header is multiline, look for a charset in other lines</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineminus">-        if (charset.IsEmpty())</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineminus">-          lookingForCharset = PR_TRUE;</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineminus">-        else if (lookingForCharset || (curLine[0] != ' ' &amp;&amp; curLine[0] != '\t'))</span>
<a href="#l4.305"></a><span id="l4.305" class="difflineminus">-          lookingForCharset = PR_FALSE;</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineminus">-        if (curLine.Find(&quot;text/html&quot;, PR_TRUE) &gt;= 0)</span>
<a href="#l4.307"></a><span id="l4.307" class="difflineminus">-          msgBodyIsHtml = PR_TRUE;</span>
<a href="#l4.308"></a><span id="l4.308" class="difflineminus">-        else if (curLine.Find(&quot;multipart/&quot;, PR_TRUE) &gt;= 0)</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineminus">-          lookingForBoundary = PR_TRUE;</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineminus">-      }</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineminus">-#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineminus">-      else if (StringBeginsWith(curLine, NS_LITERAL_CSTRING(&quot;Content-Transfer-Encoding:&quot;),</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineminus">-               nsCaseInsensitiveCStringComparator()))</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineminus">-#else</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineminus">-      else if (StringBeginsWith(curLine, NS_LITERAL_CSTRING(&quot;Content-Transfer-Encoding:&quot;),</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineminus">-               CaseInsensitiveCompare))</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineminus">-#endif</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineminus">-      {</span>
<a href="#l4.319"></a><span id="l4.319" class="difflineminus">-        encoding = StringTail(curLine, curLine.Length() - 27);</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineminus">-#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineminus">-        if (encoding.LowerCaseEqualsLiteral(&quot;base64&quot;))</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineminus">-#else</span>
<a href="#l4.323"></a><span id="l4.323" class="difflineminus">-        if (encoding.Equals(&quot;base64&quot;, CaseInsensitiveCompare))</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineminus">-#endif</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineminus">-          isBase64 = PR_TRUE;</span>
<a href="#l4.326"></a><span id="l4.326" class="difflineminus">-      }</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineplus">+</span>
<a href="#l4.328"></a><span id="l4.328" class="difflineplus">+      bytesRead += curLine.Length();</span>
<a href="#l4.329"></a><span id="l4.329" class="difflineplus">+      if (bytesRead &gt; bytesToRead)</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineplus">+        break;</span>
<a href="#l4.331"></a><span id="l4.331">     }</span>
<a href="#l4.332"></a><span id="l4.332">   }</span>
<a href="#l4.333"></a><span id="l4.333"> </span>
<a href="#l4.334"></a><span id="l4.334">   // if the snippet is encoded, decode it</span>
<a href="#l4.335"></a><span id="l4.335">   if (!encoding.IsEmpty())</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineminus">-    decodeMsgSnippet(encoding, !reachedEndBody, msgText);</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineplus">+    decodeMsgSnippet(NS_ConvertUTF16toUTF8(encoding), !reachedEndBody, msgText);</span>
<a href="#l4.338"></a><span id="l4.338"> </span>
<a href="#l4.339"></a><span id="l4.339">   // In order to turn our snippet into unicode, we need to convert it from the charset we</span>
<a href="#l4.340"></a><span id="l4.340">   // detected earlier.</span>
<a href="#l4.341"></a><span id="l4.341">   nsString unicodeMsgBodyStr;</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineminus">-  ConvertToUnicode(NS_ConvertUTF16toUTF8(charset).get(), msgText, unicodeMsgBodyStr);</span>
<a href="#l4.343"></a><span id="l4.343" class="difflineplus">+  ConvertToUnicode(charset.get(), msgText, unicodeMsgBodyStr);</span>
<a href="#l4.344"></a><span id="l4.344"> </span>
<a href="#l4.345"></a><span id="l4.345">   // now we've got a msg body. If it's html, convert it to plain text.</span>
<a href="#l4.346"></a><span id="l4.346" class="difflineminus">-  // Then, set the previewProperty on the msg hdr to the plain text.</span>
<a href="#l4.347"></a><span id="l4.347" class="difflineminus">-  if (msgBodyIsHtml)</span>
<a href="#l4.348"></a><span id="l4.348" class="difflineplus">+  if (msgBodyIsHtml &amp;&amp; aStripHTMLTags)</span>
<a href="#l4.349"></a><span id="l4.349">     convertMsgSnippetToPlainText(unicodeMsgBodyStr);</span>
<a href="#l4.350"></a><span id="l4.350"> </span>
<a href="#l4.351"></a><span id="l4.351" class="difflineplus">+  // We want to remove any whitespace from the beginning and end of the string</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineplus">+  unicodeMsgBodyStr.Trim(&quot; \t\r\n&quot;, PR_TRUE, PR_TRUE);</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineplus">+</span>
<a href="#l4.354"></a><span id="l4.354">   // step 3, optionally remove quoted text from the snippet</span>
<a href="#l4.355"></a><span id="l4.355">   nsString compressedQuotesMsgStr;</span>
<a href="#l4.356"></a><span id="l4.356">   if (aCompressQuotes)</span>
<a href="#l4.357"></a><span id="l4.357">     compressQuotesInMsgSnippet(unicodeMsgBodyStr, compressedQuotesMsgStr);</span>
<a href="#l4.358"></a><span id="l4.358"> </span>
<a href="#l4.359"></a><span id="l4.359">   // now convert back to utf-8 which is more convenient for storage</span>
<a href="#l4.360"></a><span id="l4.360">   CopyUTF16toUTF8(aCompressQuotes ? compressedQuotesMsgStr : unicodeMsgBodyStr, aMsgText);</span>
<a href="#l4.361"></a><span id="l4.361"> </span>
<a href="#l4.362"></a><span id="l4.362">   // finally, truncate the string based on aMaxOutputLen</span>
<a href="#l4.363"></a><span id="l4.363">   if (aMsgText.Length() &gt; aMaxOutputLen) {</span>
<a href="#l4.364"></a><span id="l4.364">     if (NS_IsAscii(aMsgText.BeginReading()))</span>
<a href="#l4.365"></a><span id="l4.365">       aMsgText.SetLength(aMaxOutputLen);</span>
<a href="#l4.366"></a><span id="l4.366">     else</span>
<a href="#l4.367"></a><span id="l4.367">       nsMsgI18NShrinkUTF8Str(nsCString(aMsgText),</span>
<a href="#l4.368"></a><span id="l4.368">                              aMaxOutputLen, aMsgText);</span>
<a href="#l4.369"></a><span id="l4.369">   }</span>
<a href="#l4.370"></a><span id="l4.370" class="difflineplus">+</span>
<a href="#l4.371"></a><span id="l4.371" class="difflineplus">+  // Also assign the content type being returned</span>
<a href="#l4.372"></a><span id="l4.372" class="difflineplus">+  aContentType.Assign(NS_ConvertUTF16toUTF8(contentType));</span>
<a href="#l4.373"></a><span id="l4.373">   return rv;</span>
<a href="#l4.374"></a><span id="l4.374"> }</span>
<a href="#l4.375"></a><span id="l4.375"> </span>
<a href="#l4.376"></a><span id="l4.376"> /**</span>
<a href="#l4.377"></a><span id="l4.377">  * decodeMsgSnippet - helper function which applies the appropriate transfer decoding</span>
<a href="#l4.378"></a><span id="l4.378">  *                    to the message snippet based on aEncodingType. Currently handles</span>
<a href="#l4.379"></a><span id="l4.379">  *                    base64 and quoted-printable. If aEncodingType refers to an encoding we don't</span>
<a href="#l4.380"></a><span id="l4.380">  *                    handle, the message data is passed back unmodified.</span>
<a href="#l4.381"></a><span id="l4.381" class="difflineat">@@ -4779,23 +4837,16 @@ void nsMsgDBFolder::decodeMsgSnippet(con</span>
<a href="#l4.382"></a><span id="l4.382"> #endif</span>
<a href="#l4.383"></a><span id="l4.383">   {</span>
<a href="#l4.384"></a><span id="l4.384">     PRInt32 base64Len = aMsgSnippet.Length();</span>
<a href="#l4.385"></a><span id="l4.385">     if (aIsComplete)</span>
<a href="#l4.386"></a><span id="l4.386">       base64Len -= base64Len % 4;</span>
<a href="#l4.387"></a><span id="l4.387">     char *decodedBody = PL_Base64Decode(aMsgSnippet.get(), base64Len, nsnull);</span>
<a href="#l4.388"></a><span id="l4.388">     if (decodedBody)</span>
<a href="#l4.389"></a><span id="l4.389">       aMsgSnippet.Adopt(decodedBody);</span>
<a href="#l4.390"></a><span id="l4.390" class="difflineminus">-</span>
<a href="#l4.391"></a><span id="l4.391" class="difflineminus">-    // base64 encoded message haven't had line endings converted to LFs yet.</span>
<a href="#l4.392"></a><span id="l4.392" class="difflineminus">-    PRInt32 offset = aMsgSnippet.FindChar('\r');</span>
<a href="#l4.393"></a><span id="l4.393" class="difflineminus">-    while (offset != -1) {</span>
<a href="#l4.394"></a><span id="l4.394" class="difflineminus">-      aMsgSnippet.Replace(offset, 1, '\n');</span>
<a href="#l4.395"></a><span id="l4.395" class="difflineminus">-      offset = aMsgSnippet.FindChar('\r', offset);</span>
<a href="#l4.396"></a><span id="l4.396" class="difflineminus">-    }</span>
<a href="#l4.397"></a><span id="l4.397">   }</span>
<a href="#l4.398"></a><span id="l4.398"> #ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.399"></a><span id="l4.399">   else if (aEncodingType.LowerCaseEqualsLiteral(&quot;quoted-printable&quot;))</span>
<a href="#l4.400"></a><span id="l4.400"> #else</span>
<a href="#l4.401"></a><span id="l4.401">   else if (aEncodingType.Equals(&quot;quoted-printable&quot;, CaseInsensitiveCompare))</span>
<a href="#l4.402"></a><span id="l4.402"> #endif</span>
<a href="#l4.403"></a><span id="l4.403">   {</span>
<a href="#l4.404"></a><span id="l4.404">     // giant hack - decode in place, and truncate string.</span>
<a href="#l4.405"></a><span id="l4.405" class="difflineat">@@ -4885,17 +4936,20 @@ nsresult nsMsgDBFolder::convertMsgSnippe</span>
<a href="#l4.406"></a><span id="l4.406">   rv = parser-&gt;Parse(aMessageText, 0, NS_LITERAL_CSTRING(&quot;text/html&quot;), PR_TRUE);</span>
<a href="#l4.407"></a><span id="l4.407">   aMessageText.Assign(bodyText);</span>
<a href="#l4.408"></a><span id="l4.408">   return rv;</span>
<a href="#l4.409"></a><span id="l4.409"> }</span>
<a href="#l4.410"></a><span id="l4.410"> </span>
<a href="#l4.411"></a><span id="l4.411"> nsresult nsMsgDBFolder::GetMsgPreviewTextFromStream(nsIMsgDBHdr *msgHdr, nsIInputStream *stream)</span>
<a href="#l4.412"></a><span id="l4.412"> {</span>
<a href="#l4.413"></a><span id="l4.413">   nsCString msgBody;</span>
<a href="#l4.414"></a><span id="l4.414" class="difflineminus">-  nsresult rv = GetMsgTextFromStream(msgHdr, stream, 2048, 255, PR_TRUE, msgBody);</span>
<a href="#l4.415"></a><span id="l4.415" class="difflineplus">+  nsCAutoString charset;</span>
<a href="#l4.416"></a><span id="l4.416" class="difflineplus">+  msgHdr-&gt;GetCharset(getter_Copies(charset));</span>
<a href="#l4.417"></a><span id="l4.417" class="difflineplus">+  nsCAutoString contentType;</span>
<a href="#l4.418"></a><span id="l4.418" class="difflineplus">+  nsresult rv = GetMsgTextFromStream(stream, charset, 4096, 255, PR_TRUE, PR_TRUE, contentType, msgBody);</span>
<a href="#l4.419"></a><span id="l4.419">   // replaces all tabs and line returns with a space, </span>
<a href="#l4.420"></a><span id="l4.420">   // then trims off leading and trailing white space</span>
<a href="#l4.421"></a><span id="l4.421">   MsgCompressWhitespace(msgBody);</span>
<a href="#l4.422"></a><span id="l4.422">   msgHdr-&gt;SetStringProperty(&quot;preview&quot;, msgBody.get());</span>
<a href="#l4.423"></a><span id="l4.423">   return rv;</span>
<a href="#l4.424"></a><span id="l4.424"> }</span>
<a href="#l4.425"></a><span id="l4.425"> </span>
<a href="#l4.426"></a><span id="l4.426"> void nsMsgDBFolder::SetMRUTime()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">new file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- /dev/null</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ b/mailnews/test/data/base64-1</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -0,0 +1,7 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+Content-Type: text/plain; charset=iso-8859-1</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+Content-Transfer-Encoding: base64</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+DQpIZWxsbywgd29ybGQhIChBZ2Fpbi4uLikNCg0KTGV0J3Mgc2VlIGhvdyB3ZWxsIGJhc2U2NCB0ZXh</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+0IGlzIGhhbmRsZWQuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFlheSwgbG90cyBvZiBzcGFjZX</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+MhIFRoZXJlJ3MgZXZlbiBhIENSTEYgYXQgdGhlIGVuZCBhbmQgb25lIGF0IHRoZSBiZWdpbm5pbmcsI</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+GJ1dCB0aGUgb3V0cHV0IHNob3VsZG4ndCBoYXZlIGl0Lg0K</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/mailnews/test/data/base64-1.out</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,3 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+Hello, world! (Again...)</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+Let's see how well base64 text is handled.                            Yay, lots of spaces! There's even a CRLF at the end and one at the beginning, but the output shouldn't have it.</span>
<a href="#l6.8"></a><span id="l6.8">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">new file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- /dev/null</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ b/mailnews/test/data/base64-2</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -0,0 +1,6 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineplus">+Content-Type: text/html; encoding=iso-8859-1</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineplus">+Content-Transfer-Encoding: base64</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineplus">+</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+PGh0bWw+PGJvZHk+VGhpcyBpcyBiYXNlNjQgZW5jb2RlZCBIVE1MIHRleHQsIGFuZCB0aGUgdGFncyB</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineplus">+zaG91bGRuJ3QgYmUgc3RyaXBwZWQuDQo8Yj5Cb2xkIHRleHQgaXMgYm9sZCE8L2I+PC9ib2R5PjwvaH</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineplus">+RtbD4NCg==</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- /dev/null</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ b/mailnews/test/data/base64-2.out</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -0,0 +1,2 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+&lt;html&gt;&lt;body&gt;This is base64 encoded HTML text, and the tags shouldn't be stripped.</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+&lt;b&gt;Bold text is bold!&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;</span>
<a href="#l8.7"></a><span id="l8.7">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mailnews/test/data/base64-3</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,4 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+Content-Type: text/html</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+Content-Transfer-Encoding: base64</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+PGh0bWw+PGhlYWQ+VGhlIHRhZ3MgPGI+c2hvdWxkPC9iPiBiZSA8aT4gc3RyaXBwZWQgPC9pPiBpbiB0aGlzIGNhc2UhDQpObywgPHU+c2VyaW91c2x5LjwvdT48L2hlYWQ+PC9odG1sPg==</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/mailnews/test/data/base64-3.out</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+The tags should be  stripped  in this case! No, seriously.</span>
<a href="#l10.6"></a><span id="l10.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/mailnews/test/data/basic1</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,3 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+Content-Type: text/plain; charset=iso-8859-1</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+Hello, world!</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- /dev/null</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ b/mailnews/test/data/basic1.out</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineplus">+Hello, world!</span>
<a href="#l12.6"></a><span id="l12.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- /dev/null</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ b/mailnews/test/data/basic2</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -0,0 +1,3 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineplus">+Content-Type: text/html; charset=iso-8859-1</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+&lt;html&gt;&lt;body&gt;&lt;h1&gt;The HTML tags here should remain intact.&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">new file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- /dev/null</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ b/mailnews/test/data/basic2.out</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineplus">+&lt;html&gt;&lt;body&gt;&lt;h1&gt;The HTML tags here should remain intact.&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span>
<a href="#l14.6"></a><span id="l14.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">new file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- /dev/null</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ b/mailnews/test/data/basic3</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -0,0 +1,3 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineplus">+Content-Type: text/html; charset=iso-8859-1</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineplus">+</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineplus">+&lt;html&gt;&lt;body&gt;&lt;h1&gt;The HTML tags here &lt;b&gt;are&lt;/b&gt; supposed to be stripped out.&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">new file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- /dev/null</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ b/mailnews/test/data/basic3.out</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineplus">+The HTML tags here are supposed to be stripped out.</span>
<a href="#l16.6"></a><span id="l16.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/mailnews/test/data/basic4</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,2 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+This message has no content type. This should be assumed to be text/plain.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">new file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- /dev/null</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ b/mailnews/test/data/basic4.out</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineplus">+This message has no content type. This should be assumed to be text/plain.</span>
<a href="#l18.6"></a><span id="l18.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">new file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- /dev/null</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ b/mailnews/test/data/basic5</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -0,0 +1,4 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineplus">+</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineplus">+&lt;html&gt;&lt;body&gt;Since this message has no content type, it should be assumed to be</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineplus">+&lt;b&gt;text/plain&lt;/b&gt;. This means that asking to strip HTML tags should not have a</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineplus">+difference.&lt;/body&gt;&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">new file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- /dev/null</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ b/mailnews/test/data/basic5.out</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -0,0 +1,3 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineplus">+&lt;html&gt;&lt;body&gt;Since this message has no content type, it should be assumed to be</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineplus">+&lt;b&gt;text/plain&lt;/b&gt;. This means that asking to strip HTML tags should not have a</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineplus">+difference.&lt;/body&gt;&lt;/html&gt;</span>
<a href="#l20.8"></a><span id="l20.8">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">new file mode 100644</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineminus">--- /dev/null</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineplus">+++ b/mailnews/test/data/multipart-base64-1</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineat">@@ -0,0 +1,11 @@</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineplus">+Content-Type: multipart/mixed; boundary=boundary</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineplus">+Content-Transfer-Encoding: base64</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineplus">+</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineplus">+This part shouldn't appear</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineplus">+--boundary</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineplus">+Content-Type: text/plain</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineplus">+Content-Transfer-Encoding: base64</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+TXVsdGlwYXJ0IGJhc2U2NCBlbmNvZGVkIHRleHQu</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+--boundary--</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">new file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- /dev/null</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ b/mailnews/test/data/multipart-base64-1.out</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineplus">+Multipart base64 encoded text.</span>
<a href="#l22.6"></a><span id="l22.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">new file mode 100644</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineminus">--- /dev/null</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineplus">+++ b/mailnews/test/data/multipart-base64-2</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineat">@@ -0,0 +1,12 @@</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineplus">+Content-Type: multipart/mixed; boundary=boundary</span>
<a href="#l23.6"></a><span id="l23.6" class="difflineplus">+</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineplus">+yadda yadda</span>
<a href="#l23.8"></a><span id="l23.8" class="difflineplus">+</span>
<a href="#l23.9"></a><span id="l23.9" class="difflineplus">+--boundary</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineplus">+Content-Type: text/html</span>
<a href="#l23.11"></a><span id="l23.11" class="difflineplus">+Content-Transfer-Encoding: base64</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+PGh0bWw+PGhlYWQ+YmFzZTY0ZW5jb2RlZCBIVE1MIHRleHQgaW5zaWRlIGEgbXVsdGlwYXJ0IG1lc3N</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+hZ2UuPC9oZWFkPjwvaHRtbD4=</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+--boundary--</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">new file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- /dev/null</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ b/mailnews/test/data/multipart-base64-2.out</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineplus">+&lt;html&gt;&lt;head&gt;base64encoded HTML text inside a multipart message.&lt;/head&gt;&lt;/html&gt;</span>
<a href="#l24.6"></a><span id="l24.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1">new file mode 100644</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineminus">--- /dev/null</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineplus">+++ b/mailnews/test/data/multipart-base64-3</span>
<a href="#l25.4"></a><span id="l25.4" class="difflineat">@@ -0,0 +1,10 @@</span>
<a href="#l25.5"></a><span id="l25.5" class="difflineplus">+Content-Type: multipart/mixed; boundary=boundary</span>
<a href="#l25.6"></a><span id="l25.6" class="difflineplus">+</span>
<a href="#l25.7"></a><span id="l25.7" class="difflineplus">+etc etc</span>
<a href="#l25.8"></a><span id="l25.8" class="difflineplus">+--boundary</span>
<a href="#l25.9"></a><span id="l25.9" class="difflineplus">+Content-Type: text/html</span>
<a href="#l25.10"></a><span id="l25.10" class="difflineplus">+Content-Transfer-Encoding: base64</span>
<a href="#l25.11"></a><span id="l25.11" class="difflineplus">+</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+PGh0bWw+PGhlYWQ+VGhpcyB0aW1lLCB0aGUgdGFncw0Kc2hvdWxkIGJlIHN0cmlwcGVkIG91dC48L2hlYWQ+PC9odG1sPg==</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+--boundary--</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1">new file mode 100644</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineminus">--- /dev/null</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineplus">+++ b/mailnews/test/data/multipart-base64-3.out</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l26.5"></a><span id="l26.5" class="difflineplus">+This time, the tags should be stripped out.</span>
<a href="#l26.6"></a><span id="l26.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1">new file mode 100644</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineminus">--- /dev/null</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineplus">+++ b/mailnews/test/data/multipart-complex1</span>
<a href="#l27.4"></a><span id="l27.4" class="difflineat">@@ -0,0 +1,35 @@</span>
<a href="#l27.5"></a><span id="l27.5" class="difflineplus">+Content-Type: multipart/mixed; boundary=&quot;boundary&quot;</span>
<a href="#l27.6"></a><span id="l27.6" class="difflineplus">+</span>
<a href="#l27.7"></a><span id="l27.7" class="difflineplus">+This shouldn't appear.</span>
<a href="#l27.8"></a><span id="l27.8" class="difflineplus">+--boundary</span>
<a href="#l27.9"></a><span id="l27.9" class="difflineplus">+Content-Type: application/octet-stream</span>
<a href="#l27.10"></a><span id="l27.10" class="difflineplus">+Content-Transfer-Encoding: base64</span>
<a href="#l27.11"></a><span id="l27.11" class="difflineplus">+</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+VGhpcyBpc24ndCByZWFsbHkgYW4gYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtLiA7KQ=='</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+--boundary</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+Content-Type: image/png</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineplus">+Content-Transfer-Encoding: base64</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineplus">+</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineplus">+TmVpdGhlciBpcyB0aGlzIGFuIGltYWdlL3BuZy4=</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineplus">+</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineplus">+--boundary</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineplus">+Content-Type: multipart/related; boundary=&quot;boundary2&quot;</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineplus">+</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineplus">+--boundary2</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineplus">+Content-Type: text/html</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineplus">+</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineplus">+&lt;html&gt;&lt;head&gt;This part should be returned.&lt;/head&gt;&lt;/html&gt;</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineplus">+</span>
<a href="#l27.28"></a><span id="l27.28" class="difflineplus">+--boundary2--</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineplus">+</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineplus">+--boundary</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineplus">+Content-Type: text/plain</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineplus">+This part shouldn't.</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineplus">+</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineplus">+--boundary</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineplus">+</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineplus">+Neither should this part!</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineplus">+</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineplus">+--boundary--</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1">new file mode 100644</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineminus">--- /dev/null</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineplus">+++ b/mailnews/test/data/multipart-complex1.out</span>
<a href="#l28.4"></a><span id="l28.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l28.5"></a><span id="l28.5" class="difflineplus">+This part should be returned.</span>
<a href="#l28.6"></a><span id="l28.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1">new file mode 100644</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineminus">--- /dev/null</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineplus">+++ b/mailnews/test/data/multipart-complex2</span>
<a href="#l29.4"></a><span id="l29.4" class="difflineat">@@ -0,0 +1,60 @@</span>
<a href="#l29.5"></a><span id="l29.5" class="difflineplus">+Content-Type: multipart/mixed; boundary=&quot;bou&quot;</span>
<a href="#l29.6"></a><span id="l29.6" class="difflineplus">+</span>
<a href="#l29.7"></a><span id="l29.7" class="difflineplus">+Part 1</span>
<a href="#l29.8"></a><span id="l29.8" class="difflineplus">+--bou                       </span>
<a href="#l29.9"></a><span id="l29.9" class="difflineplus">+Content-Type: multipart/related; boundary=&quot;bound&quot;</span>
<a href="#l29.10"></a><span id="l29.10" class="difflineplus">+</span>
<a href="#l29.11"></a><span id="l29.11" class="difflineplus">+Part 2</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+--bound</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+Content-Type: multipart/digest; boundary=&quot;boundar&quot;</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+Part 3</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+--boundar</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineplus">+Content-Type: multipart/alternative; boundary=&quot;boundary&quot;</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineplus">+</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+Part 4</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineplus">+--boundary</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineplus">+Content-Type: application/octet-stream</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineplus">+</span>
<a href="#l29.23"></a><span id="l29.23" class="difflineplus">+Wow, what alternatives!</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineplus">+</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineplus">+We're trying to confuse the parser here.</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineplus">+</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineplus">+--bou</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineplus">+</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineplus">+--bound</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineplus">+</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineplus">+--boundar</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineplus">+--boundary</span>
<a href="#l29.34"></a><span id="l29.34" class="difflineplus">+Content-Type: application/pdf</span>
<a href="#l29.35"></a><span id="l29.35" class="difflineplus">+</span>
<a href="#l29.36"></a><span id="l29.36" class="difflineplus">+A choice between a PDF and an octet stream! How marvellous!</span>
<a href="#l29.37"></a><span id="l29.37" class="difflineplus">+</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineplus">+--boundary--</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineplus">+</span>
<a href="#l29.40"></a><span id="l29.40" class="difflineplus">+--boundar</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineplus">+Content-Type: multipart/mixed; boundary=&quot;boundary123456&quot;</span>
<a href="#l29.42"></a><span id="l29.42" class="difflineplus">+</span>
<a href="#l29.43"></a><span id="l29.43" class="difflineplus">+--boundary123456</span>
<a href="#l29.44"></a><span id="l29.44" class="difflineplus">+Content-Type: text/plain</span>
<a href="#l29.45"></a><span id="l29.45" class="difflineplus">+</span>
<a href="#l29.46"></a><span id="l29.46" class="difflineplus">+This is the correct answer.</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineplus">+</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineplus">+--boundary123456--</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineplus">+</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineplus">+--boundar--</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineplus">+</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineplus">+--bound</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineplus">+Content-Type: text/plain</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineplus">+</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineplus">+One last attempt at confusing the parser.</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineplus">+</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineplus">+--bound--</span>
<a href="#l29.58"></a><span id="l29.58" class="difflineplus">+</span>
<a href="#l29.59"></a><span id="l29.59" class="difflineplus">+--bou</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineplus">+Content-Type: text/html</span>
<a href="#l29.61"></a><span id="l29.61" class="difflineplus">+</span>
<a href="#l29.62"></a><span id="l29.62" class="difflineplus">+&lt;html&gt;&lt;body&gt;No harm in making another.&lt;/body&gt;&lt;/html&gt;</span>
<a href="#l29.63"></a><span id="l29.63" class="difflineplus">+</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineplus">+--bou--</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1">new file mode 100644</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineminus">--- /dev/null</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineplus">+++ b/mailnews/test/data/multipart-complex2.out</span>
<a href="#l30.4"></a><span id="l30.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l30.5"></a><span id="l30.5" class="difflineplus">+This is the correct answer.</span>
<a href="#l30.6"></a><span id="l30.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1">new file mode 100644</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineminus">--- /dev/null</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineplus">+++ b/mailnews/test/data/multipart1</span>
<a href="#l31.4"></a><span id="l31.4" class="difflineat">@@ -0,0 +1,12 @@</span>
<a href="#l31.5"></a><span id="l31.5" class="difflineplus">+Content-Type: multipart/mixed;</span>
<a href="#l31.6"></a><span id="l31.6" class="difflineplus">+ boundary=&quot;boundary&quot;</span>
<a href="#l31.7"></a><span id="l31.7" class="difflineplus">+</span>
<a href="#l31.8"></a><span id="l31.8" class="difflineplus">+This is a text message in MIME format.</span>
<a href="#l31.9"></a><span id="l31.9" class="difflineplus">+This part shouldn't appear in the output.</span>
<a href="#l31.10"></a><span id="l31.10" class="difflineplus">+</span>
<a href="#l31.11"></a><span id="l31.11" class="difflineplus">+--boundary</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+Content-Type: text/plain</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+Hello, world! (yet again...)</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+--boundary--</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1">new file mode 100644</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineminus">--- /dev/null</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineplus">+++ b/mailnews/test/data/multipart1.out</span>
<a href="#l32.4"></a><span id="l32.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l32.5"></a><span id="l32.5" class="difflineplus">+Hello, world! (yet again...)</span>
<a href="#l32.6"></a><span id="l32.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1">new file mode 100644</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineminus">--- /dev/null</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineplus">+++ b/mailnews/test/data/multipart2</span>
<a href="#l33.4"></a><span id="l33.4" class="difflineat">@@ -0,0 +1,13 @@</span>
<a href="#l33.5"></a><span id="l33.5" class="difflineplus">+Content-Type: multipart/mixed; boundary=boundary</span>
<a href="#l33.6"></a><span id="l33.6" class="difflineplus">+</span>
<a href="#l33.7"></a><span id="l33.7" class="difflineplus">+This is a text/html message. This part shouldn't appear at all!</span>
<a href="#l33.8"></a><span id="l33.8" class="difflineplus">+</span>
<a href="#l33.9"></a><span id="l33.9" class="difflineplus">+--boundary</span>
<a href="#l33.10"></a><span id="l33.10" class="difflineplus">+Content-Type: text/html</span>
<a href="#l33.11"></a><span id="l33.11" class="difflineplus">+</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+&lt;html&gt;&lt;body&gt;Multipart HTML message with just a single part!</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+&lt;/body&gt;&lt;/html&gt;</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineplus">+</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineplus">+--boundary--</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineplus">+</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineplus">+Actually, this part shouldn't appear either.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1">new file mode 100644</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineminus">--- /dev/null</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineplus">+++ b/mailnews/test/data/multipart2.out</span>
<a href="#l34.4"></a><span id="l34.4" class="difflineat">@@ -0,0 +1,2 @@</span>
<a href="#l34.5"></a><span id="l34.5" class="difflineplus">+&lt;html&gt;&lt;body&gt;Multipart HTML message with just a single part!</span>
<a href="#l34.6"></a><span id="l34.6" class="difflineplus">+&lt;/body&gt;&lt;/html&gt;</span>
<a href="#l34.7"></a><span id="l34.7">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1">new file mode 100644</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineminus">--- /dev/null</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineplus">+++ b/mailnews/test/data/multipart3</span>
<a href="#l35.4"></a><span id="l35.4" class="difflineat">@@ -0,0 +1,29 @@</span>
<a href="#l35.5"></a><span id="l35.5" class="difflineplus">+Content-Type: multipart/mixed; boundary=boundary</span>
<a href="#l35.6"></a><span id="l35.6" class="difflineplus">+</span>
<a href="#l35.7"></a><span id="l35.7" class="difflineplus">+--boundary</span>
<a href="#l35.8"></a><span id="l35.8" class="difflineplus">+Content-Type: text/html</span>
<a href="#l35.9"></a><span id="l35.9" class="difflineplus">+</span>
<a href="#l35.10"></a><span id="l35.10" class="difflineplus">+&lt;html&gt;</span>
<a href="#l35.11"></a><span id="l35.11" class="difflineplus">+</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineplus">+</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+&lt;body&gt;</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineplus">+</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineplus">+Here, the HTML tags should be stripped out.</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineplus">+</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineplus">+&lt;/body&gt;</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineplus">+</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineplus">+</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineplus">+</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineplus">+&lt;/html&gt;</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineplus">+</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineplus">+</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineplus">+</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineplus">+</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineplus">+</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineplus">+</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+--boundary--</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1">new file mode 100644</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineminus">--- /dev/null</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineplus">+++ b/mailnews/test/data/multipart3.out</span>
<a href="#l36.4"></a><span id="l36.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l36.5"></a><span id="l36.5" class="difflineplus">+Here, the HTML tags should be stripped out.</span>
<a href="#l36.6"></a><span id="l36.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1">new file mode 100644</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineminus">--- /dev/null</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineplus">+++ b/mailnews/test/data/multipart4</span>
<a href="#l37.4"></a><span id="l37.4" class="difflineat">@@ -0,0 +1,7 @@</span>
<a href="#l37.5"></a><span id="l37.5" class="difflineplus">+Content-Type: multipart/mixed; boundary=boundary</span>
<a href="#l37.6"></a><span id="l37.6" class="difflineplus">+</span>
<a href="#l37.7"></a><span id="l37.7" class="difflineplus">+--boundary</span>
<a href="#l37.8"></a><span id="l37.8" class="difflineplus">+</span>
<a href="#l37.9"></a><span id="l37.9" class="difflineplus">+This has no headers, so should be recognized as plain text.</span>
<a href="#l37.10"></a><span id="l37.10" class="difflineplus">+</span>
<a href="#l37.11"></a><span id="l37.11" class="difflineplus">+--boundary--</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1">new file mode 100644</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineminus">--- /dev/null</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineplus">+++ b/mailnews/test/data/multipart4.out</span>
<a href="#l38.4"></a><span id="l38.4" class="difflineat">@@ -0,0 +1,1 @@</span>
<a href="#l38.5"></a><span id="l38.5" class="difflineplus">+This has no headers, so should be recognized as plain text.</span>
<a href="#l38.6"></a><span id="l38.6">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/test/resources/mailTestUtils.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/test/resources/mailTestUtils.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -54,29 +54,46 @@ function loadLocalMailAccount()</span>
<a href="#l39.4"></a><span id="l39.4">   // so we need to create it.</span>
<a href="#l39.5"></a><span id="l39.5">   gLocalInboxFolder = rootFolder.addSubfolder(&quot;Inbox&quot;);</span>
<a href="#l39.6"></a><span id="l39.6"> </span>
<a href="#l39.7"></a><span id="l39.7">   // Force an initialization of the Inbox folder database.</span>
<a href="#l39.8"></a><span id="l39.8">   var folderName = gLocalInboxFolder.prettiestName;</span>
<a href="#l39.9"></a><span id="l39.9"> }</span>
<a href="#l39.10"></a><span id="l39.10"> </span>
<a href="#l39.11"></a><span id="l39.11"> // Loads a file to a string</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-function loadFileToString(aFile) {</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+// If aCharset is specified, treats the file as being of that charset</span>
<a href="#l39.14"></a><span id="l39.14" class="difflineplus">+function loadFileToString(aFile, aCharset) {</span>
<a href="#l39.15"></a><span id="l39.15">   var data = &quot;&quot;;</span>
<a href="#l39.16"></a><span id="l39.16">   var fstream = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l39.17"></a><span id="l39.17">                   .createInstance(Ci.nsIFileInputStream);</span>
<a href="#l39.18"></a><span id="l39.18" class="difflineminus">-  var sstream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l39.19"></a><span id="l39.19" class="difflineminus">-                  .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l39.20"></a><span id="l39.20" class="difflineplus">+  fstream.init(aFile, -1, 0, 0);</span>
<a href="#l39.21"></a><span id="l39.21" class="difflineplus">+</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineplus">+  if (aCharset)</span>
<a href="#l39.23"></a><span id="l39.23" class="difflineplus">+  {</span>
<a href="#l39.24"></a><span id="l39.24" class="difflineplus">+    var cstream = Cc[&quot;@mozilla.org/intl/converter-input-stream;1&quot;]</span>
<a href="#l39.25"></a><span id="l39.25" class="difflineplus">+                    .createInstance(Ci.nsIConverterInputStream);</span>
<a href="#l39.26"></a><span id="l39.26" class="difflineplus">+    cstream.init(fstream, aCharset, 4096, 0x0000);</span>
<a href="#l39.27"></a><span id="l39.27" class="difflineplus">+    var str = {};</span>
<a href="#l39.28"></a><span id="l39.28" class="difflineplus">+    while (cstream.readString(4096, str) != 0)</span>
<a href="#l39.29"></a><span id="l39.29" class="difflineplus">+      data += str.value;</span>
<a href="#l39.30"></a><span id="l39.30"> </span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-  fstream.init(aFile, -1, 0, 0);</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineminus">-  sstream.init(fstream); </span>
<a href="#l39.33"></a><span id="l39.33" class="difflineplus">+    cstream.close();</span>
<a href="#l39.34"></a><span id="l39.34" class="difflineplus">+  }</span>
<a href="#l39.35"></a><span id="l39.35" class="difflineplus">+  else</span>
<a href="#l39.36"></a><span id="l39.36" class="difflineplus">+  {</span>
<a href="#l39.37"></a><span id="l39.37" class="difflineplus">+    var sstream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l39.38"></a><span id="l39.38" class="difflineplus">+                    .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l39.39"></a><span id="l39.39"> </span>
<a href="#l39.40"></a><span id="l39.40" class="difflineminus">-  var str = sstream.read(4096);</span>
<a href="#l39.41"></a><span id="l39.41" class="difflineminus">-  while (str.length &gt; 0) {</span>
<a href="#l39.42"></a><span id="l39.42" class="difflineminus">-    data += str;</span>
<a href="#l39.43"></a><span id="l39.43" class="difflineminus">-    str = sstream.read(4096);</span>
<a href="#l39.44"></a><span id="l39.44" class="difflineplus">+    sstream.init(fstream);</span>
<a href="#l39.45"></a><span id="l39.45" class="difflineplus">+</span>
<a href="#l39.46"></a><span id="l39.46" class="difflineplus">+    var str = sstream.read(4096);</span>
<a href="#l39.47"></a><span id="l39.47" class="difflineplus">+    while (str.length &gt; 0) {</span>
<a href="#l39.48"></a><span id="l39.48" class="difflineplus">+      data += str;</span>
<a href="#l39.49"></a><span id="l39.49" class="difflineplus">+      str = sstream.read(4096);</span>
<a href="#l39.50"></a><span id="l39.50" class="difflineplus">+    }</span>
<a href="#l39.51"></a><span id="l39.51" class="difflineplus">+</span>
<a href="#l39.52"></a><span id="l39.52" class="difflineplus">+    sstream.close();</span>
<a href="#l39.53"></a><span id="l39.53">   }</span>
<a href="#l39.54"></a><span id="l39.54"> </span>
<a href="#l39.55"></a><span id="l39.55" class="difflineminus">-  sstream.close();</span>
<a href="#l39.56"></a><span id="l39.56">   fstream.close();</span>
<a href="#l39.57"></a><span id="l39.57"> </span>
<a href="#l39.58"></a><span id="l39.58">   return data;</span>
<a href="#l39.59"></a><span id="l39.59"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

