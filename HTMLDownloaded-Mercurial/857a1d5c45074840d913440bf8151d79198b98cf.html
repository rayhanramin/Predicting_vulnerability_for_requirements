<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28626:857a1d5c45074840d913440bf8151d79198b98cf</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 857a1d5c45074840d913440bf8151d79198b98cf" />
<meta property="og:url" content="/comm-central/rev/857a1d5c45074840d913440bf8151d79198b98cf" />
<meta property="og:description" content="Bug 1540043 - part 2: Make comm-central stop using `nsIPlaintextEditor` interface r=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 857a1d5c45074840d913440bf8151d79198b98cf 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/857a1d5c45074840d913440bf8151d79198b98cf">shortlog</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/857a1d5c45074840d913440bf8151d79198b98cf">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf">files</a> |
changeset |
<a href="/comm-central/raw-rev/857a1d5c45074840d913440bf8151d79198b98cf">raw</a>  | <a href="/comm-central/archive/857a1d5c45074840d913440bf8151d79198b98cf.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1540043">Bug 1540043</a> - part 2: Make comm-central stop using `nsIPlaintextEditor` interface r=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#115;&#97;&#121;&#117;&#107;&#105;&#32;&#78;&#97;&#107;&#97;&#110;&#111;&#32;&#60;&#109;&#97;&#115;&#97;&#121;&#117;&#107;&#105;&#64;&#100;&#45;&#116;&#111;&#121;&#98;&#111;&#120;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 27 Jan 2020 15:51:12 +0900</td></tr>

<tr>
 <td>changeset 28626</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/857a1d5c45074840d913440bf8151d79198b98cf">857a1d5c45074840d913440bf8151d79198b98cf</a></td>
</tr>



<tr>
<td>parent 28625</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/779c55ffd47b1ced2db5ba5397c4c42b9300ad47">779c55ffd47b1ced2db5ba5397c4c42b9300ad47</a>
</td>
</tr>

<tr>
<td>child 28627</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a2cc7c9b4a0635baabcb037cc89c1c5a59f1d4fa">a2cc7c9b4a0635baabcb037cc89c1c5a59f1d4fa</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=857a1d5c45074840d913440bf8151d79198b98cf">16967</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Thu, 30 Jan 2020 22:39:25 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@a2cc7c9b4a06 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a2cc7c9b4a0635baabcb037cc89c1c5a59f1d4fa">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a2cc7c9b4a0635baabcb037cc89c1c5a59f1d4fa&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a2cc7c9b4a0635baabcb037cc89c1c5a59f1d4fa&newProject=comm-central&newRevision=857a1d5c45074840d913440bf8151d79198b98cf&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a2cc7c9b4a0635baabcb037cc89c1c5a59f1d4fa&newProject=comm-central&newRevision=857a1d5c45074840d913440bf8151d79198b98cf&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a2cc7c9b4a0635baabcb037cc89c1c5a59f1d4fa&newProject=comm-central&newRevision=857a1d5c45074840d913440bf8151d79198b98cf&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1540043">1540043</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1540043">Bug 1540043</a> - part 2: Make comm-central stop using `nsIPlaintextEditor` interface r=jorgk</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/ComposerCommands.js">editor/ui/composer/content/ComposerCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/ComposerCommands.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/ComposerCommands.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/ComposerCommands.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/ComposerCommands.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/ComposerCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editingOverlay.js">editor/ui/composer/content/editingOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editingOverlay.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editingOverlay.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editingOverlay.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editingOverlay.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editingOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editor.js">editor/ui/composer/content/editor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editor.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editor.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editor.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editor.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editor.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editorUtilities.js">editor/ui/composer/content/editorUtilities.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editorUtilities.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editorUtilities.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editorUtilities.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editorUtilities.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/composer/content/editorUtilities.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdDialogCommon.js">editor/ui/dialogs/content/EdDialogCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdDialogCommon.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdDialogCommon.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdDialogCommon.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdDialogCommon.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdDialogCommon.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdImageLinkLoader.js">editor/ui/dialogs/content/EdImageLinkLoader.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdImageLinkLoader.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdImageLinkLoader.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdImageLinkLoader.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdImageLinkLoader.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdImageLinkLoader.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertMath.js">editor/ui/dialogs/content/EdInsertMath.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertMath.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertMath.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertMath.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertMath.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertMath.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertTable.js">editor/ui/dialogs/content/EdInsertTable.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertTable.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertTable.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertTable.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertTable.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/editor/ui/dialogs/content/EdInsertTable.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/ComposerCommands.js">mail/components/compose/content/ComposerCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/ComposerCommands.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/ComposerCommands.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/ComposerCommands.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/ComposerCommands.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/ComposerCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdDialogCommon.js">mail/components/compose/content/dialogs/EdDialogCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdDialogCommon.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdDialogCommon.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdDialogCommon.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdDialogCommon.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdDialogCommon.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdImageLinkLoader.js">mail/components/compose/content/dialogs/EdImageLinkLoader.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdImageLinkLoader.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdImageLinkLoader.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdImageLinkLoader.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdImageLinkLoader.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdImageLinkLoader.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertMath.js">mail/components/compose/content/dialogs/EdInsertMath.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertMath.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertMath.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertMath.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertMath.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertMath.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertTable.js">mail/components/compose/content/dialogs/EdInsertTable.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertTable.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertTable.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertTable.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertTable.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/dialogs/EdInsertTable.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editor.js">mail/components/compose/content/editor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editor.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editor.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editor.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editor.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editor.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editorUtilities.js">mail/components/compose/content/editorUtilities.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editorUtilities.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editorUtilities.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editorUtilities.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editorUtilities.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/compose/content/editorUtilities.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/im/content/chat-messenger.js">mail/components/im/content/chat-messenger.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/im/content/chat-messenger.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/im/content/chat-messenger.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/im/content/chat-messenger.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/im/content/chat-messenger.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/mail/components/im/content/chat-messenger.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/suite/components/bindings/textbox.xml">suite/components/bindings/textbox.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/suite/components/bindings/textbox.xml">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/suite/components/bindings/textbox.xml">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/suite/components/bindings/textbox.xml">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/suite/components/bindings/textbox.xml">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/suite/components/bindings/textbox.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/suite/mailnews/components/compose/content/MsgComposeCommands.js">suite/mailnews/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/857a1d5c45074840d913440bf8151d79198b98cf/suite/mailnews/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/857a1d5c45074840d913440bf8151d79198b98cf/suite/mailnews/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/857a1d5c45074840d913440bf8151d79198b98cf/suite/mailnews/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/857a1d5c45074840d913440bf8151d79198b98cf/suite/mailnews/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/857a1d5c45074840d913440bf8151d79198b98cf/suite/mailnews/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/editor/ui/composer/content/ComposerCommands.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/editor/ui/composer/content/ComposerCommands.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -2229,18 +2229,18 @@ function SetSaveAndPublishUI(urlstring) </span>
<a href="#l1.4"></a><span id="l1.4"> }</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> function SetDocumentEditable(isDocEditable) {</span>
<a href="#l1.7"></a><span id="l1.7">   var editor = GetCurrentEditor();</span>
<a href="#l1.8"></a><span id="l1.8">   if (editor &amp;&amp; editor.document) {</span>
<a href="#l1.9"></a><span id="l1.9">     try {</span>
<a href="#l1.10"></a><span id="l1.10">       var flags = editor.flags;</span>
<a href="#l1.11"></a><span id="l1.11">       editor.flags = isDocEditable</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        ? (flags &amp;= ~nsIPlaintextEditor.eEditorReadonlyMask)</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-        : flags | nsIPlaintextEditor.eEditorReadonlyMask;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+        ? (flags &amp;= ~Ci.nsIEditor.eEditorReadonlyMask)</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+        : flags | Ci.nsIEditor.eEditorReadonlyMask;</span>
<a href="#l1.16"></a><span id="l1.16">     } catch (e) {}</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18">     // update all commands</span>
<a href="#l1.19"></a><span id="l1.19">     window.updateCommands(&quot;create&quot;);</span>
<a href="#l1.20"></a><span id="l1.20">   }</span>
<a href="#l1.21"></a><span id="l1.21"> }</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23"> // ****** end of save / publish **********//</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/editor/ui/composer/content/editingOverlay.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/editor/ui/composer/content/editingOverlay.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -59,17 +59,16 @@ function EditorOnLoad()</span>
<a href="#l2.4"></a><span id="l2.4">       cmd.collapsed = true;</span>
<a href="#l2.5"></a><span id="l2.5">   }</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">   // Initialize our source text &lt;editor&gt;</span>
<a href="#l2.8"></a><span id="l2.8">   try {</span>
<a href="#l2.9"></a><span id="l2.9">     gSourceContentWindow = document.getElementById(&quot;content-source&quot;);</span>
<a href="#l2.10"></a><span id="l2.10">     gSourceContentWindow.makeEditable(&quot;text&quot;, false);</span>
<a href="#l2.11"></a><span id="l2.11">     gSourceTextEditor = gSourceContentWindow.getEditor(gSourceContentWindow.contentWindow);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    gSourceTextEditor.QueryInterface(Ci.nsIPlaintextEditor);</span>
<a href="#l2.13"></a><span id="l2.13">     gSourceTextEditor.enableUndo(false);</span>
<a href="#l2.14"></a><span id="l2.14">     gSourceTextEditor.rootElement.style.fontFamily = &quot;-moz-fixed&quot;;</span>
<a href="#l2.15"></a><span id="l2.15">     gSourceTextEditor.rootElement.style.whiteSpace = &quot;pre&quot;;</span>
<a href="#l2.16"></a><span id="l2.16">     gSourceTextEditor.rootElement.style.margin = 0;</span>
<a href="#l2.17"></a><span id="l2.17">     var controller = Cc[&quot;@mozilla.org/embedcomp/base-command-controller;1&quot;]</span>
<a href="#l2.18"></a><span id="l2.18">                        .createInstance(Ci.nsIControllerContext);</span>
<a href="#l2.19"></a><span id="l2.19">     controller.setCommandContext(gSourceContentWindow);</span>
<a href="#l2.20"></a><span id="l2.20">     gSourceContentWindow.contentWindow.controllers.insertControllerAt(0, controller);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/editor/ui/composer/content/editor.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/editor/ui/composer/content/editor.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -2805,20 +2805,17 @@ function goUpdateTableMenuItems(commands</span>
<a href="#l3.4"></a><span id="l3.4">     dump(&quot;goUpdateTableMenuItems: too early, not initialized\n&quot;);</span>
<a href="#l3.5"></a><span id="l3.5">     return;</span>
<a href="#l3.6"></a><span id="l3.6">   }</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">   var enabled = false;</span>
<a href="#l3.9"></a><span id="l3.9">   var enabledIfTable = false;</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   var flags = editor.flags;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  if (</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-    !(flags &amp; nsIPlaintextEditor.eEditorReadonlyMask) &amp;&amp;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-    IsEditingRenderedHTML()</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-  ) {</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+  if (!(flags &amp; Ci.nsIEditor.eEditorReadonlyMask) &amp;&amp; IsEditingRenderedHTML()) {</span>
<a href="#l3.17"></a><span id="l3.17">     var tagNameObj = { value: &quot;&quot; };</span>
<a href="#l3.18"></a><span id="l3.18">     var element;</span>
<a href="#l3.19"></a><span id="l3.19">     try {</span>
<a href="#l3.20"></a><span id="l3.20">       element = editor.getSelectedOrParentTableElement(tagNameObj, {</span>
<a href="#l3.21"></a><span id="l3.21">         value: 0,</span>
<a href="#l3.22"></a><span id="l3.22">       });</span>
<a href="#l3.23"></a><span id="l3.23">     } catch (e) {}</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25" class="difflineat">@@ -2863,31 +2860,31 @@ function goUpdateTableMenuItems(commands</span>
<a href="#l3.26"></a><span id="l3.26"> // Helpers for inserting and editing tables:</span>
<a href="#l3.27"></a><span id="l3.27"> </span>
<a href="#l3.28"></a><span id="l3.28"> function IsInTable() {</span>
<a href="#l3.29"></a><span id="l3.29">   var editor = GetCurrentEditor();</span>
<a href="#l3.30"></a><span id="l3.30">   try {</span>
<a href="#l3.31"></a><span id="l3.31">     var flags = editor.flags;</span>
<a href="#l3.32"></a><span id="l3.32">     return (</span>
<a href="#l3.33"></a><span id="l3.33">       IsHTMLEditor() &amp;&amp;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-      !(flags &amp; nsIPlaintextEditor.eEditorReadonlyMask) &amp;&amp;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+      !(flags &amp; Ci.nsIEditor.eEditorReadonlyMask) &amp;&amp;</span>
<a href="#l3.36"></a><span id="l3.36">       IsEditingRenderedHTML() &amp;&amp;</span>
<a href="#l3.37"></a><span id="l3.37">       null != editor.getElementOrParentByTagName(&quot;table&quot;, null)</span>
<a href="#l3.38"></a><span id="l3.38">     );</span>
<a href="#l3.39"></a><span id="l3.39">   } catch (e) {}</span>
<a href="#l3.40"></a><span id="l3.40">   return false;</span>
<a href="#l3.41"></a><span id="l3.41"> }</span>
<a href="#l3.42"></a><span id="l3.42"> </span>
<a href="#l3.43"></a><span id="l3.43"> function IsInTableCell() {</span>
<a href="#l3.44"></a><span id="l3.44">   try {</span>
<a href="#l3.45"></a><span id="l3.45">     var editor = GetCurrentEditor();</span>
<a href="#l3.46"></a><span id="l3.46">     var flags = editor.flags;</span>
<a href="#l3.47"></a><span id="l3.47">     return (</span>
<a href="#l3.48"></a><span id="l3.48">       IsHTMLEditor() &amp;&amp;</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-      !(flags &amp; nsIPlaintextEditor.eEditorReadonlyMask) &amp;&amp;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+      !(flags &amp; Ci.nsIEditor.eEditorReadonlyMask) &amp;&amp;</span>
<a href="#l3.51"></a><span id="l3.51">       IsEditingRenderedHTML() &amp;&amp;</span>
<a href="#l3.52"></a><span id="l3.52">       null != editor.getElementOrParentByTagName(&quot;td&quot;, null)</span>
<a href="#l3.53"></a><span id="l3.53">     );</span>
<a href="#l3.54"></a><span id="l3.54">   } catch (e) {}</span>
<a href="#l3.55"></a><span id="l3.55">   return false;</span>
<a href="#l3.56"></a><span id="l3.56"> }</span>
<a href="#l3.57"></a><span id="l3.57"> </span>
<a href="#l3.58"></a><span id="l3.58"> function IsSelectionInOneCell() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/editor/ui/composer/content/editorUtilities.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/editor/ui/composer/content/editorUtilities.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -163,17 +163,16 @@ function GetSelectionAsText() {</span>
<a href="#l4.4"></a><span id="l4.4">       kOutputSelectionOnly</span>
<a href="#l4.5"></a><span id="l4.5">     );</span>
<a href="#l4.6"></a><span id="l4.6">   } catch (e) {}</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">   return &quot;&quot;;</span>
<a href="#l4.9"></a><span id="l4.9"> }</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11"> /** *********** Get Current Editor and associated interfaces or info ***************/</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-const nsIPlaintextEditor = Ci.nsIPlaintextEditor;</span>
<a href="#l4.13"></a><span id="l4.13"> const nsIHTMLEditor = Ci.nsIHTMLEditor;</span>
<a href="#l4.14"></a><span id="l4.14"> const nsITableEditor = Ci.nsITableEditor;</span>
<a href="#l4.15"></a><span id="l4.15"> const nsIEditorStyleSheets = Ci.nsIEditorStyleSheets;</span>
<a href="#l4.16"></a><span id="l4.16"> const nsIEditingSession = Ci.nsIEditingSession;</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18"> function GetCurrentEditor() {</span>
<a href="#l4.19"></a><span id="l4.19">   // Get the active editor from the &lt;editor&gt; tag</span>
<a href="#l4.20"></a><span id="l4.20">   // XXX This will probably change if we support &gt; 1 editor in main Composer window</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -182,17 +181,16 @@ function GetCurrentEditor() {</span>
<a href="#l4.22"></a><span id="l4.22">   // For dialogs: Search up parent chain to find top window with editor</span>
<a href="#l4.23"></a><span id="l4.23">   var editor;</span>
<a href="#l4.24"></a><span id="l4.24">   try {</span>
<a href="#l4.25"></a><span id="l4.25">     var editorElement = GetCurrentEditorElement();</span>
<a href="#l4.26"></a><span id="l4.26">     editor = editorElement.getEditor(editorElement.contentWindow);</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">     // Do QIs now so editor users won't have to figure out which interface to use</span>
<a href="#l4.29"></a><span id="l4.29">     // Using &quot;instanceof&quot; does the QI for us.</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-    editor instanceof Ci.nsIPlaintextEditor;</span>
<a href="#l4.31"></a><span id="l4.31">     editor instanceof Ci.nsIHTMLEditor;</span>
<a href="#l4.32"></a><span id="l4.32">   } catch (e) {</span>
<a href="#l4.33"></a><span id="l4.33">     dump(e) + &quot;\n&quot;;</span>
<a href="#l4.34"></a><span id="l4.34">   }</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36">   return editor;</span>
<a href="#l4.37"></a><span id="l4.37"> }</span>
<a href="#l4.38"></a><span id="l4.38"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/editor/ui/dialogs/content/EdDialogCommon.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/editor/ui/dialogs/content/EdDialogCommon.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -579,17 +579,17 @@ function SetRelativeCheckbox(checkbox) {</span>
<a href="#l5.4"></a><span id="l5.4">     checkbox = document.getElementById(&quot;MakeRelativeCheckbox&quot;);</span>
<a href="#l5.5"></a><span id="l5.5">     if (!checkbox) {</span>
<a href="#l5.6"></a><span id="l5.6">       return;</span>
<a href="#l5.7"></a><span id="l5.7">     }</span>
<a href="#l5.8"></a><span id="l5.8">   }</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10">   var editor = GetCurrentEditor();</span>
<a href="#l5.11"></a><span id="l5.11">   // Mail never allows relative URLs, so hide the checkbox</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  if (editor &amp;&amp; editor.flags &amp; Ci.nsIPlaintextEditor.eEditorMailMask) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  if (editor &amp;&amp; editor.flags &amp; Ci.nsIEditor.eEditorMailMask) {</span>
<a href="#l5.14"></a><span id="l5.14">     checkbox.collapsed = true;</span>
<a href="#l5.15"></a><span id="l5.15">     return;</span>
<a href="#l5.16"></a><span id="l5.16">   }</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18">   var input = document.getElementById(checkbox.getAttribute(&quot;for&quot;));</span>
<a href="#l5.19"></a><span id="l5.19">   if (!input) {</span>
<a href="#l5.20"></a><span id="l5.20">     return;</span>
<a href="#l5.21"></a><span id="l5.21">   }</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -991,17 +991,17 @@ function FillLinkMenulist(linkMenulist, </span>
<a href="#l5.23"></a><span id="l5.23">         return 0;</span>
<a href="#l5.24"></a><span id="l5.24">       });</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26">       for (i = 0; i &lt; anchorList.length; i++) {</span>
<a href="#l5.27"></a><span id="l5.27">         createMenuItem(menupopup, anchorList[i].anchor);</span>
<a href="#l5.28"></a><span id="l5.28">       }</span>
<a href="#l5.29"></a><span id="l5.29">     } else {</span>
<a href="#l5.30"></a><span id="l5.30">       // Don't bother with named anchors in Mail.</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-      if (editor &amp;&amp; editor.flags &amp; Ci.nsIPlaintextEditor.eEditorMailMask) {</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+      if (editor &amp;&amp; editor.flags &amp; Ci.nsIEditor.eEditorMailMask) {</span>
<a href="#l5.33"></a><span id="l5.33">         menupopup.remove();</span>
<a href="#l5.34"></a><span id="l5.34">         linkMenulist.removeAttribute(&quot;enablehistory&quot;);</span>
<a href="#l5.35"></a><span id="l5.35">         return;</span>
<a href="#l5.36"></a><span id="l5.36">       }</span>
<a href="#l5.37"></a><span id="l5.37">       var item = createMenuItem(</span>
<a href="#l5.38"></a><span id="l5.38">         menupopup,</span>
<a href="#l5.39"></a><span id="l5.39">         GetString(&quot;NoNamedAnchorsOrHeadings&quot;)</span>
<a href="#l5.40"></a><span id="l5.40">       );</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/editor/ui/dialogs/content/EdImageLinkLoader.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/editor/ui/dialogs/content/EdImageLinkLoader.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -14,17 +14,17 @@ var gMsgCompPrevMozDoNotSendAttribute;</span>
<a href="#l6.4"></a><span id="l6.4"> var gMsgCompAttachSourceElement = null;</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> function OnLoadDialog() {</span>
<a href="#l6.7"></a><span id="l6.7">   gMsgCompAttachSourceElement = document.getElementById(&quot;AttachSourceToMail&quot;);</span>
<a href="#l6.8"></a><span id="l6.8">   var editor = GetCurrentEditor();</span>
<a href="#l6.9"></a><span id="l6.9">   if (</span>
<a href="#l6.10"></a><span id="l6.10">     gMsgCompAttachSourceElement &amp;&amp;</span>
<a href="#l6.11"></a><span id="l6.11">     editor &amp;&amp;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    editor.flags &amp; Ci.nsIPlaintextEditor.eEditorMailMask</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    editor.flags &amp; Ci.nsIEditor.eEditorMailMask</span>
<a href="#l6.14"></a><span id="l6.14">   ) {</span>
<a href="#l6.15"></a><span id="l6.15">     SetRelativeCheckbox = function() {</span>
<a href="#l6.16"></a><span id="l6.16">       SetAttachCheckbox();</span>
<a href="#l6.17"></a><span id="l6.17">     };</span>
<a href="#l6.18"></a><span id="l6.18">     // initialize the AttachSourceToMail checkbox</span>
<a href="#l6.19"></a><span id="l6.19">     gMsgCompAttachSourceElement.hidden = false;</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">     switch (document.documentElement.id) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/editor/ui/dialogs/content/EdInsertMath.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/editor/ui/dialogs/content/EdInsertMath.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -114,19 +114,17 @@ function Startup() {</span>
<a href="#l7.4"></a><span id="l7.4">   SetWindowLocation();</span>
<a href="#l7.5"></a><span id="l7.5"> }</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> function insertLaTeXCommand(aButton) {</span>
<a href="#l7.8"></a><span id="l7.8">   gDialog.input.focus();</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">   // For a single math symbol, just use the insertText command.</span>
<a href="#l7.11"></a><span id="l7.11">   if (aButton.label) {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    gDialog.input.editor</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-      .QueryInterface(Ci.nsIPlaintextEditor)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-      .insertText(aButton.label);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    gDialog.input.editor.insertText(aButton.label);</span>
<a href="#l7.16"></a><span id="l7.16">     return;</span>
<a href="#l7.17"></a><span id="l7.17">   }</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">   // Otherwise, it's a LaTeX command with at least one argument...</span>
<a href="#l7.20"></a><span id="l7.20">   var latex = TeXZilla.getTeXSource(aButton.firstChild);</span>
<a href="#l7.21"></a><span id="l7.21">   var selectionStart = gDialog.input.selectionStart;</span>
<a href="#l7.22"></a><span id="l7.22">   var selectionEnd = gDialog.input.selectionEnd;</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24" class="difflineat">@@ -147,17 +145,17 @@ function insertLaTeXCommand(aButton) {</span>
<a href="#l7.25"></a><span id="l7.25">     latexNewStart = 0;</span>
<a href="#l7.26"></a><span id="l7.26">     latexNewEnd = latex.length;</span>
<a href="#l7.27"></a><span id="l7.27">   } else {</span>
<a href="#l7.28"></a><span id="l7.28">     // Otherwise, select the dots representing the next argument.</span>
<a href="#l7.29"></a><span id="l7.29">     latexNewEnd = latexNewStart + 1;</span>
<a href="#l7.30"></a><span id="l7.30">   }</span>
<a href="#l7.31"></a><span id="l7.31"> </span>
<a href="#l7.32"></a><span id="l7.32">   // Update the input text and selection.</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-  gDialog.input.editor.QueryInterface(Ci.nsIPlaintextEditor).insertText(latex);</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+  gDialog.input.editor.insertText(latex);</span>
<a href="#l7.35"></a><span id="l7.35">   gDialog.input.setSelectionRange(</span>
<a href="#l7.36"></a><span id="l7.36">     selectionStart + latexNewStart,</span>
<a href="#l7.37"></a><span id="l7.37">     selectionStart + latexNewEnd</span>
<a href="#l7.38"></a><span id="l7.38">   );</span>
<a href="#l7.39"></a><span id="l7.39"> </span>
<a href="#l7.40"></a><span id="l7.40">   updateMath();</span>
<a href="#l7.41"></a><span id="l7.41"> }</span>
<a href="#l7.42"></a><span id="l7.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/editor/ui/dialogs/content/EdInsertTable.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/editor/ui/dialogs/content/EdInsertTable.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -44,17 +44,17 @@ function Startup() {</span>
<a href="#l8.4"></a><span id="l8.4">   gDialog.OkButton = document.documentElement.getButton(&quot;accept&quot;);</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6">   // Make a copy to use for AdvancedEdit</span>
<a href="#l8.7"></a><span id="l8.7">   globalElement = gTableElement.cloneNode(false);</span>
<a href="#l8.8"></a><span id="l8.8">   try {</span>
<a href="#l8.9"></a><span id="l8.9">     if (</span>
<a href="#l8.10"></a><span id="l8.10">       Services.prefs.getBoolPref(&quot;editor.use_css&quot;) &amp;&amp;</span>
<a href="#l8.11"></a><span id="l8.11">       IsHTMLEditor() &amp;&amp;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      !(gActiveEditor.flags &amp; Ci.nsIPlaintextEditor.eEditorMailMask)</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+      !(gActiveEditor.flags &amp; Ci.nsIEditor.eEditorMailMask)</span>
<a href="#l8.14"></a><span id="l8.14">     ) {</span>
<a href="#l8.15"></a><span id="l8.15">       // only for Composer and not for htmlmail</span>
<a href="#l8.16"></a><span id="l8.16">       globalElement.setAttribute(&quot;style&quot;, &quot;text-align: left;&quot;);</span>
<a href="#l8.17"></a><span id="l8.17">     }</span>
<a href="#l8.18"></a><span id="l8.18">   } catch (e) {}</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">   // Initialize all widgets with image attributes</span>
<a href="#l8.21"></a><span id="l8.21">   InitDialog();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/compose/content/ComposerCommands.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/compose/content/ComposerCommands.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -2023,18 +2023,18 @@ function GetDocUrlFromPublishData(publis</span>
<a href="#l9.4"></a><span id="l9.4"> }</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6"> function SetDocumentEditable(isDocEditable) {</span>
<a href="#l9.7"></a><span id="l9.7">   var editor = GetCurrentEditor();</span>
<a href="#l9.8"></a><span id="l9.8">   if (editor &amp;&amp; editor.document) {</span>
<a href="#l9.9"></a><span id="l9.9">     try {</span>
<a href="#l9.10"></a><span id="l9.10">       var flags = editor.flags;</span>
<a href="#l9.11"></a><span id="l9.11">       editor.flags = isDocEditable</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-        ? (flags &amp;= ~nsIPlaintextEditor.eEditorReadonlyMask)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-        : flags | nsIPlaintextEditor.eEditorReadonlyMask;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+        ? (flags &amp;= ~Ci.nsIEditor.eEditorReadonlyMask)</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+        : flags | Ci.nsIEditor.eEditorReadonlyMask;</span>
<a href="#l9.16"></a><span id="l9.16">     } catch (e) {}</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18">     // update all commands</span>
<a href="#l9.19"></a><span id="l9.19">     window.updateCommands(&quot;create&quot;);</span>
<a href="#l9.20"></a><span id="l9.20">   }</span>
<a href="#l9.21"></a><span id="l9.21"> }</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23"> var nsCloseCommand = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -235,19 +235,19 @@ function getPrettyKey(aKeyId) {</span>
<a href="#l10.4"></a><span id="l10.4">  * @param aDisable  true = disable items. false = enable items.</span>
<a href="#l10.5"></a><span id="l10.5">  */</span>
<a href="#l10.6"></a><span id="l10.6"> function updateEditableFields(aDisable) {</span>
<a href="#l10.7"></a><span id="l10.7">   if (!gMsgCompose) {</span>
<a href="#l10.8"></a><span id="l10.8">     return;</span>
<a href="#l10.9"></a><span id="l10.9">   }</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11">   if (aDisable) {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    gMsgCompose.editor.flags |= Ci.nsIPlaintextEditor.eEditorReadonlyMask;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    gMsgCompose.editor.flags |= Ci.nsIEditor.eEditorReadonlyMask;</span>
<a href="#l10.14"></a><span id="l10.14">   } else {</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-    gMsgCompose.editor.flags &amp;= ~Ci.nsIPlaintextEditor.eEditorReadonlyMask;</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+    gMsgCompose.editor.flags &amp;= ~Ci.nsIEditor.eEditorReadonlyMask;</span>
<a href="#l10.17"></a><span id="l10.17">   }</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19">   let elements = document.querySelectorAll('[disableonsend=&quot;true&quot;]');</span>
<a href="#l10.20"></a><span id="l10.20">   for (let i = 0; i &lt; elements.length; i++) {</span>
<a href="#l10.21"></a><span id="l10.21">     elements[i].disabled = aDisable;</span>
<a href="#l10.22"></a><span id="l10.22">   }</span>
<a href="#l10.23"></a><span id="l10.23"> }</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25" class="difflineat">@@ -2337,18 +2337,17 @@ function ComposeFieldsReady() {</span>
<a href="#l10.26"></a><span id="l10.26">   } catch (e) {</span>
<a href="#l10.27"></a><span id="l10.27">     charset = gMsgCompose.compFields.defaultCharacterSet;</span>
<a href="#l10.28"></a><span id="l10.28">   }</span>
<a href="#l10.29"></a><span id="l10.29">   SetDocumentCharacterSet(charset);</span>
<a href="#l10.30"></a><span id="l10.30"> </span>
<a href="#l10.31"></a><span id="l10.31">   // If we are in plain text, we need to set the wrap column</span>
<a href="#l10.32"></a><span id="l10.32">   if (!gMsgCompose.composeHTML) {</span>
<a href="#l10.33"></a><span id="l10.33">     try {</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-      gMsgCompose.editor.QueryInterface(Ci.nsIPlaintextEditor).wrapWidth =</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">-        gMsgCompose.wrapLength;</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+      gMsgCompose.editor.wrapWidth = gMsgCompose.wrapLength;</span>
<a href="#l10.37"></a><span id="l10.37">     } catch (e) {</span>
<a href="#l10.38"></a><span id="l10.38">       dump(&quot;### textEditor.wrapWidth exception text: &quot; + e + &quot; - failed\n&quot;);</span>
<a href="#l10.39"></a><span id="l10.39">     }</span>
<a href="#l10.40"></a><span id="l10.40">   }</span>
<a href="#l10.41"></a><span id="l10.41"> </span>
<a href="#l10.42"></a><span id="l10.42">   CompFields2Recipients(gMsgCompose.compFields);</span>
<a href="#l10.43"></a><span id="l10.43">   SetComposeWindowTitle();</span>
<a href="#l10.44"></a><span id="l10.44">   updateEditableFields(false);</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineat">@@ -7688,17 +7687,17 @@ function removeQueryPart(aURL, aQuery) {</span>
<a href="#l10.46"></a><span id="l10.46"> }</span>
<a href="#l10.47"></a><span id="l10.47"> </span>
<a href="#l10.48"></a><span id="l10.48"> function InitEditor() {</span>
<a href="#l10.49"></a><span id="l10.49">   var editor = GetCurrentEditor();</span>
<a href="#l10.50"></a><span id="l10.50"> </span>
<a href="#l10.51"></a><span id="l10.51">   // Set eEditorMailMask flag to avoid using content prefs for spell checker,</span>
<a href="#l10.52"></a><span id="l10.52">   // otherwise dictionary setting in preferences is ignored and dictionary is</span>
<a href="#l10.53"></a><span id="l10.53">   // inconsistent in subject and message body.</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-  let eEditorMailMask = Ci.nsIPlaintextEditor.eEditorMailMask;</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+  let eEditorMailMask = Ci.nsIEditor.eEditorMailMask;</span>
<a href="#l10.56"></a><span id="l10.56">   editor.flags |= eEditorMailMask;</span>
<a href="#l10.57"></a><span id="l10.57">   document.getElementById(&quot;msgSubject&quot;).editor.flags |= eEditorMailMask;</span>
<a href="#l10.58"></a><span id="l10.58"> </span>
<a href="#l10.59"></a><span id="l10.59">   // Control insertion of line breaks.</span>
<a href="#l10.60"></a><span id="l10.60">   editor.returnInParagraphCreatesNewParagraph = Services.prefs.getBoolPref(</span>
<a href="#l10.61"></a><span id="l10.61">     &quot;editor.CR_creates_new_p&quot;</span>
<a href="#l10.62"></a><span id="l10.62">   );</span>
<a href="#l10.63"></a><span id="l10.63">   editor.document.execCommand(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/compose/content/dialogs/EdDialogCommon.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/compose/content/dialogs/EdDialogCommon.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -463,17 +463,17 @@ function SetRelativeCheckbox(checkbox) {</span>
<a href="#l11.4"></a><span id="l11.4">     checkbox = document.getElementById(&quot;MakeRelativeCheckbox&quot;);</span>
<a href="#l11.5"></a><span id="l11.5">     if (!checkbox) {</span>
<a href="#l11.6"></a><span id="l11.6">       return;</span>
<a href="#l11.7"></a><span id="l11.7">     }</span>
<a href="#l11.8"></a><span id="l11.8">   }</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10">   var editor = GetCurrentEditor();</span>
<a href="#l11.11"></a><span id="l11.11">   // Mail never allows relative URLs, so hide the checkbox</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  if (editor &amp;&amp; editor.flags &amp; Ci.nsIPlaintextEditor.eEditorMailMask) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  if (editor &amp;&amp; editor.flags &amp; Ci.nsIEditor.eEditorMailMask) {</span>
<a href="#l11.14"></a><span id="l11.14">     checkbox.collapsed = true;</span>
<a href="#l11.15"></a><span id="l11.15">     return;</span>
<a href="#l11.16"></a><span id="l11.16">   }</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18">   var input = document.getElementById(checkbox.getAttribute(&quot;for&quot;));</span>
<a href="#l11.19"></a><span id="l11.19">   if (!input) {</span>
<a href="#l11.20"></a><span id="l11.20">     return;</span>
<a href="#l11.21"></a><span id="l11.21">   }</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -657,17 +657,17 @@ function FillLinkMenulist(linkMenulist, </span>
<a href="#l11.23"></a><span id="l11.23">         }</span>
<a href="#l11.24"></a><span id="l11.24">         return 0;</span>
<a href="#l11.25"></a><span id="l11.25">       });</span>
<a href="#l11.26"></a><span id="l11.26">       for (i = 0; i &lt; anchorList.length; i++) {</span>
<a href="#l11.27"></a><span id="l11.27">         menuItems.push(createMenuItem(anchorList[i].anchor));</span>
<a href="#l11.28"></a><span id="l11.28">       }</span>
<a href="#l11.29"></a><span id="l11.29">     } else {</span>
<a href="#l11.30"></a><span id="l11.30">       // Don't bother with named anchors in Mail.</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-      if (editor &amp;&amp; editor.flags &amp; Ci.nsIPlaintextEditor.eEditorMailMask) {</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+      if (editor &amp;&amp; editor.flags &amp; Ci.nsIEditor.eEditorMailMask) {</span>
<a href="#l11.33"></a><span id="l11.33">         linkMenulist.removeAttribute(&quot;enablehistory&quot;);</span>
<a href="#l11.34"></a><span id="l11.34">         return;</span>
<a href="#l11.35"></a><span id="l11.35">       }</span>
<a href="#l11.36"></a><span id="l11.36">       let item = createMenuItem(GetString(&quot;NoNamedAnchorsOrHeadings&quot;));</span>
<a href="#l11.37"></a><span id="l11.37">       item.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l11.38"></a><span id="l11.38">       menuItems.push(item);</span>
<a href="#l11.39"></a><span id="l11.39">     }</span>
<a href="#l11.40"></a><span id="l11.40">     window.addEventListener(&quot;contextmenu&quot;, event =&gt; {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/compose/content/dialogs/EdImageLinkLoader.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/compose/content/dialogs/EdImageLinkLoader.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -14,17 +14,17 @@ var gMsgCompPrevMozDoNotSendAttribute;</span>
<a href="#l12.4"></a><span id="l12.4"> var gMsgCompAttachSourceElement = null;</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> function OnLoadDialog() {</span>
<a href="#l12.7"></a><span id="l12.7">   gMsgCompAttachSourceElement = document.getElementById(&quot;AttachSourceToMail&quot;);</span>
<a href="#l12.8"></a><span id="l12.8">   var editor = GetCurrentEditor();</span>
<a href="#l12.9"></a><span id="l12.9">   if (</span>
<a href="#l12.10"></a><span id="l12.10">     gMsgCompAttachSourceElement &amp;&amp;</span>
<a href="#l12.11"></a><span id="l12.11">     editor &amp;&amp;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    editor.flags &amp; Ci.nsIPlaintextEditor.eEditorMailMask</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    editor.flags &amp; Ci.nsIEditor.eEditorMailMask</span>
<a href="#l12.14"></a><span id="l12.14">   ) {</span>
<a href="#l12.15"></a><span id="l12.15">     SetRelativeCheckbox = function() {</span>
<a href="#l12.16"></a><span id="l12.16">       SetAttachCheckbox();</span>
<a href="#l12.17"></a><span id="l12.17">     };</span>
<a href="#l12.18"></a><span id="l12.18">     // initialize the AttachSourceToMail checkbox</span>
<a href="#l12.19"></a><span id="l12.19">     gMsgCompAttachSourceElement.hidden = false;</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21">     switch (document.querySelector(&quot;dialog&quot;).id) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/compose/content/dialogs/EdInsertMath.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/compose/content/dialogs/EdInsertMath.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -114,19 +114,17 @@ function Startup() {</span>
<a href="#l13.4"></a><span id="l13.4">   SetWindowLocation();</span>
<a href="#l13.5"></a><span id="l13.5"> }</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> function insertLaTeXCommand(aButton) {</span>
<a href="#l13.8"></a><span id="l13.8">   gDialog.input.focus();</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10">   // For a single math symbol, just use the insertText command.</span>
<a href="#l13.11"></a><span id="l13.11">   if (aButton.label) {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    gDialog.input.editor</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-      .QueryInterface(Ci.nsIPlaintextEditor)</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-      .insertText(aButton.label);</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+    gDialog.input.editor.insertText(aButton.label);</span>
<a href="#l13.16"></a><span id="l13.16">     return;</span>
<a href="#l13.17"></a><span id="l13.17">   }</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19">   // Otherwise, it's a LaTeX command with at least one argument...</span>
<a href="#l13.20"></a><span id="l13.20">   var latex = TeXZilla.getTeXSource(aButton.firstElementChild);</span>
<a href="#l13.21"></a><span id="l13.21">   var selectionStart = gDialog.input.selectionStart;</span>
<a href="#l13.22"></a><span id="l13.22">   var selectionEnd = gDialog.input.selectionEnd;</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24" class="difflineat">@@ -147,17 +145,17 @@ function insertLaTeXCommand(aButton) {</span>
<a href="#l13.25"></a><span id="l13.25">     latexNewStart = 0;</span>
<a href="#l13.26"></a><span id="l13.26">     latexNewEnd = latex.length;</span>
<a href="#l13.27"></a><span id="l13.27">   } else {</span>
<a href="#l13.28"></a><span id="l13.28">     // Otherwise, select the dots representing the next argument.</span>
<a href="#l13.29"></a><span id="l13.29">     latexNewEnd = latexNewStart + 1;</span>
<a href="#l13.30"></a><span id="l13.30">   }</span>
<a href="#l13.31"></a><span id="l13.31"> </span>
<a href="#l13.32"></a><span id="l13.32">   // Update the input text and selection.</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-  gDialog.input.editor.QueryInterface(Ci.nsIPlaintextEditor).insertText(latex);</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+  gDialog.input.editor.insertText(latex);</span>
<a href="#l13.35"></a><span id="l13.35">   gDialog.input.setSelectionRange(</span>
<a href="#l13.36"></a><span id="l13.36">     selectionStart + latexNewStart,</span>
<a href="#l13.37"></a><span id="l13.37">     selectionStart + latexNewEnd</span>
<a href="#l13.38"></a><span id="l13.38">   );</span>
<a href="#l13.39"></a><span id="l13.39"> </span>
<a href="#l13.40"></a><span id="l13.40">   updateMath();</span>
<a href="#l13.41"></a><span id="l13.41"> }</span>
<a href="#l13.42"></a><span id="l13.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/compose/content/dialogs/EdInsertTable.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/compose/content/dialogs/EdInsertTable.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -44,17 +44,17 @@ function Startup() {</span>
<a href="#l14.4"></a><span id="l14.4">   gDialog.OkButton = document.querySelector(&quot;dialog&quot;).getButton(&quot;accept&quot;);</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6">   // Make a copy to use for AdvancedEdit</span>
<a href="#l14.7"></a><span id="l14.7">   globalElement = gTableElement.cloneNode(false);</span>
<a href="#l14.8"></a><span id="l14.8">   try {</span>
<a href="#l14.9"></a><span id="l14.9">     if (</span>
<a href="#l14.10"></a><span id="l14.10">       Services.prefs.getBoolPref(&quot;editor.use_css&quot;) &amp;&amp;</span>
<a href="#l14.11"></a><span id="l14.11">       IsHTMLEditor() &amp;&amp;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-      !(gActiveEditor.flags &amp; Ci.nsIPlaintextEditor.eEditorMailMask)</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+      !(gActiveEditor.flags &amp; Ci.nsIEditor.eEditorMailMask)</span>
<a href="#l14.14"></a><span id="l14.14">     ) {</span>
<a href="#l14.15"></a><span id="l14.15">       // only for Composer and not for htmlmail</span>
<a href="#l14.16"></a><span id="l14.16">       globalElement.setAttribute(&quot;style&quot;, &quot;text-align: left;&quot;);</span>
<a href="#l14.17"></a><span id="l14.17">     }</span>
<a href="#l14.18"></a><span id="l14.18">   } catch (e) {}</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20">   // Initialize all widgets with image attributes</span>
<a href="#l14.21"></a><span id="l14.21">   InitDialog();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/compose/content/editor.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/compose/content/editor.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -2111,20 +2111,17 @@ function goUpdateTableMenuItems(commands</span>
<a href="#l15.4"></a><span id="l15.4">     dump(&quot;goUpdateTableMenuItems: too early, not initialized\n&quot;);</span>
<a href="#l15.5"></a><span id="l15.5">     return;</span>
<a href="#l15.6"></a><span id="l15.6">   }</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8">   var enabled = false;</span>
<a href="#l15.9"></a><span id="l15.9">   var enabledIfTable = false;</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11">   var flags = editor.flags;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  if (</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-    !(flags &amp; nsIPlaintextEditor.eEditorReadonlyMask) &amp;&amp;</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-    IsEditingRenderedHTML()</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-  ) {</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+  if (!(flags &amp; Ci.nsIEditor.eEditorReadonlyMask) &amp;&amp; IsEditingRenderedHTML()) {</span>
<a href="#l15.17"></a><span id="l15.17">     var tagNameObj = { value: &quot;&quot; };</span>
<a href="#l15.18"></a><span id="l15.18">     var element;</span>
<a href="#l15.19"></a><span id="l15.19">     try {</span>
<a href="#l15.20"></a><span id="l15.20">       element = editor.getSelectedOrParentTableElement(tagNameObj, {</span>
<a href="#l15.21"></a><span id="l15.21">         value: 0,</span>
<a href="#l15.22"></a><span id="l15.22">       });</span>
<a href="#l15.23"></a><span id="l15.23">     } catch (e) {}</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25" class="difflineat">@@ -2168,31 +2165,31 @@ function goUpdateTableMenuItems(commands</span>
<a href="#l15.26"></a><span id="l15.26"> // Helpers for inserting and editing tables:</span>
<a href="#l15.27"></a><span id="l15.27"> </span>
<a href="#l15.28"></a><span id="l15.28"> function IsInTable() {</span>
<a href="#l15.29"></a><span id="l15.29">   var editor = GetCurrentEditor();</span>
<a href="#l15.30"></a><span id="l15.30">   try {</span>
<a href="#l15.31"></a><span id="l15.31">     var flags = editor.flags;</span>
<a href="#l15.32"></a><span id="l15.32">     return (</span>
<a href="#l15.33"></a><span id="l15.33">       IsHTMLEditor() &amp;&amp;</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-      !(flags &amp; nsIPlaintextEditor.eEditorReadonlyMask) &amp;&amp;</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+      !(flags &amp; Ci.nsIEditor.eEditorReadonlyMask) &amp;&amp;</span>
<a href="#l15.36"></a><span id="l15.36">       IsEditingRenderedHTML() &amp;&amp;</span>
<a href="#l15.37"></a><span id="l15.37">       null != editor.getElementOrParentByTagName(&quot;table&quot;, null)</span>
<a href="#l15.38"></a><span id="l15.38">     );</span>
<a href="#l15.39"></a><span id="l15.39">   } catch (e) {}</span>
<a href="#l15.40"></a><span id="l15.40">   return false;</span>
<a href="#l15.41"></a><span id="l15.41"> }</span>
<a href="#l15.42"></a><span id="l15.42"> </span>
<a href="#l15.43"></a><span id="l15.43"> function IsInTableCell() {</span>
<a href="#l15.44"></a><span id="l15.44">   try {</span>
<a href="#l15.45"></a><span id="l15.45">     var editor = GetCurrentEditor();</span>
<a href="#l15.46"></a><span id="l15.46">     var flags = editor.flags;</span>
<a href="#l15.47"></a><span id="l15.47">     return (</span>
<a href="#l15.48"></a><span id="l15.48">       IsHTMLEditor() &amp;&amp;</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-      !(flags &amp; nsIPlaintextEditor.eEditorReadonlyMask) &amp;&amp;</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineplus">+      !(flags &amp; Ci.nsIEditor.eEditorReadonlyMask) &amp;&amp;</span>
<a href="#l15.51"></a><span id="l15.51">       IsEditingRenderedHTML() &amp;&amp;</span>
<a href="#l15.52"></a><span id="l15.52">       null != editor.getElementOrParentByTagName(&quot;td&quot;, null)</span>
<a href="#l15.53"></a><span id="l15.53">     );</span>
<a href="#l15.54"></a><span id="l15.54">   } catch (e) {}</span>
<a href="#l15.55"></a><span id="l15.55">   return false;</span>
<a href="#l15.56"></a><span id="l15.56"> }</span>
<a href="#l15.57"></a><span id="l15.57"> </span>
<a href="#l15.58"></a><span id="l15.58"> function IsSelectionInOneCell() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/components/compose/content/editorUtilities.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/components/compose/content/editorUtilities.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -163,17 +163,16 @@ function GetSelectionAsText() {</span>
<a href="#l16.4"></a><span id="l16.4">       kOutputSelectionOnly</span>
<a href="#l16.5"></a><span id="l16.5">     );</span>
<a href="#l16.6"></a><span id="l16.6">   } catch (e) {}</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8">   return &quot;&quot;;</span>
<a href="#l16.9"></a><span id="l16.9"> }</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11"> /** *********** Get Current Editor and associated interfaces or info ***************/</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-const nsIPlaintextEditor = Ci.nsIPlaintextEditor;</span>
<a href="#l16.13"></a><span id="l16.13"> const nsIHTMLEditor = Ci.nsIHTMLEditor;</span>
<a href="#l16.14"></a><span id="l16.14"> const nsITableEditor = Ci.nsITableEditor;</span>
<a href="#l16.15"></a><span id="l16.15"> const nsIEditorStyleSheets = Ci.nsIEditorStyleSheets;</span>
<a href="#l16.16"></a><span id="l16.16"> const nsIEditingSession = Ci.nsIEditingSession;</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18"> function GetCurrentEditor() {</span>
<a href="#l16.19"></a><span id="l16.19">   // Get the active editor from the &lt;editor&gt; tag</span>
<a href="#l16.20"></a><span id="l16.20">   // XXX This will probably change if we support &gt; 1 editor in main Composer window</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineat">@@ -182,17 +181,16 @@ function GetCurrentEditor() {</span>
<a href="#l16.22"></a><span id="l16.22">   // For dialogs: Search up parent chain to find top window with editor</span>
<a href="#l16.23"></a><span id="l16.23">   var editor;</span>
<a href="#l16.24"></a><span id="l16.24">   try {</span>
<a href="#l16.25"></a><span id="l16.25">     var editorElement = GetCurrentEditorElement();</span>
<a href="#l16.26"></a><span id="l16.26">     editor = editorElement.getEditor(editorElement.contentWindow);</span>
<a href="#l16.27"></a><span id="l16.27"> </span>
<a href="#l16.28"></a><span id="l16.28">     // Do QIs now so editor users won't have to figure out which interface to use</span>
<a href="#l16.29"></a><span id="l16.29">     // Using &quot;instanceof&quot; does the QI for us.</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-    editor instanceof Ci.nsIPlaintextEditor;</span>
<a href="#l16.31"></a><span id="l16.31">     editor instanceof Ci.nsIHTMLEditor;</span>
<a href="#l16.32"></a><span id="l16.32">   } catch (e) {</span>
<a href="#l16.33"></a><span id="l16.33">     dump(e) + &quot;\n&quot;;</span>
<a href="#l16.34"></a><span id="l16.34">   }</span>
<a href="#l16.35"></a><span id="l16.35"> </span>
<a href="#l16.36"></a><span id="l16.36">   return editor;</span>
<a href="#l16.37"></a><span id="l16.37"> }</span>
<a href="#l16.38"></a><span id="l16.38"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/components/im/content/chat-messenger.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/components/im/content/chat-messenger.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -890,17 +890,17 @@ var chatHandler = {</span>
<a href="#l17.4"></a><span id="l17.4">           let popup = document.getElementById(&quot;chatContextMenu&quot;);</span>
<a href="#l17.5"></a><span id="l17.5">           popup.openPopupAtScreen(e.screenX, e.screenY, true);</span>
<a href="#l17.6"></a><span id="l17.6">           e.preventDefault();</span>
<a href="#l17.7"></a><span id="l17.7">         });</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9">         // Set &quot;mail editor mask&quot; so changing the language doesn't</span>
<a href="#l17.10"></a><span id="l17.10">         // affect the global preference and multiple chats can have</span>
<a href="#l17.11"></a><span id="l17.11">         // individual languages.</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-        conv.editor.editor.flags |= Ci.nsIPlaintextEditor.eEditorMailMask;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+        conv.editor.editor.flags |= Ci.nsIEditor.eEditorMailMask;</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15">         // Initialise language to the default.</span>
<a href="#l17.16"></a><span id="l17.16">         conv.editor.setAttribute(</span>
<a href="#l17.17"></a><span id="l17.17">           &quot;lang&quot;,</span>
<a href="#l17.18"></a><span id="l17.18">           Services.prefs.getStringPref(&quot;spellchecker.dictionary&quot;)</span>
<a href="#l17.19"></a><span id="l17.19">         );</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21">         // Attach listener so we hear about language changes.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -3089,32 +3089,31 @@ Enigmail.msg = {</span>
<a href="#l18.4"></a><span id="l18.4">    */</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">   wrapInLine: function(wrapresultObj) {</span>
<a href="#l18.7"></a><span id="l18.7">     EnigmailLog.DEBUG(&quot;enigmailMsgComposeOverlay.js: WrapInLine\n&quot;);</span>
<a href="#l18.8"></a><span id="l18.8">     wrapresultObj.cancelled = false;</span>
<a href="#l18.9"></a><span id="l18.9">     wrapresultObj.usePpgMime = false;</span>
<a href="#l18.10"></a><span id="l18.10">     try {</span>
<a href="#l18.11"></a><span id="l18.11">       const dce = Components.interfaces.nsIDocumentEncoder;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-      var wrapper = gMsgCompose.editor.QueryInterface(Components.interfaces.nsIEditorMailSupport);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-      var editor = gMsgCompose.editor.QueryInterface(Components.interfaces.nsIPlaintextEditor);</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+      var editor = gMsgCompose.editor.QueryInterface(Components.interfaces.nsIEditorMailSupport);</span>
<a href="#l18.15"></a><span id="l18.15">       var encoderFlags = dce.OutputFormatted | dce.OutputLFLineBreak;</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17">       var wrapWidth = this.getMailPref(&quot;mailnews.wraplength&quot;);</span>
<a href="#l18.18"></a><span id="l18.18">       if (wrapWidth &gt; 0 &amp;&amp; wrapWidth &lt; 68 &amp;&amp; editor.wrapWidth &gt; 0) {</span>
<a href="#l18.19"></a><span id="l18.19">         if (EnigmailDialog.confirmDlg(window, EnigmailLocale.getString(&quot;minimalLineWrapping&quot;, [wrapWidth]))) {</span>
<a href="#l18.20"></a><span id="l18.20">           wrapWidth = 68;</span>
<a href="#l18.21"></a><span id="l18.21">           EnigmailPrefs.getPrefRoot().setIntPref(&quot;mailnews.wraplength&quot;, wrapWidth);</span>
<a href="#l18.22"></a><span id="l18.22">         }</span>
<a href="#l18.23"></a><span id="l18.23">       }</span>
<a href="#l18.24"></a><span id="l18.24"> </span>
<a href="#l18.25"></a><span id="l18.25">       if (wrapWidth &amp;&amp; editor.wrapWidth &gt; 0) {</span>
<a href="#l18.26"></a><span id="l18.26">         // First use standard editor wrap mechanism:</span>
<a href="#l18.27"></a><span id="l18.27">         editor.wrapWidth = wrapWidth - 2;</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineminus">-        wrapper.rewrap(true);</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineplus">+        editor.rewrap(true);</span>
<a href="#l18.30"></a><span id="l18.30">         editor.wrapWidth = wrapWidth;</span>
<a href="#l18.31"></a><span id="l18.31"> </span>
<a href="#l18.32"></a><span id="l18.32">         // Now get plaintext from editor</span>
<a href="#l18.33"></a><span id="l18.33">         var wrapText = this.editorGetContentAs(&quot;text/plain&quot;, encoderFlags);</span>
<a href="#l18.34"></a><span id="l18.34"> </span>
<a href="#l18.35"></a><span id="l18.35">         // split the lines into an array</span>
<a href="#l18.36"></a><span id="l18.36">         wrapText = wrapText.split(/\r\n|\r|\n/g);</span>
<a href="#l18.37"></a><span id="l18.37"> </span>
<a href="#l18.38"></a><span id="l18.38" class="difflineat">@@ -4099,18 +4098,17 @@ Enigmail.msg = {</span>
<a href="#l18.39"></a><span id="l18.39">     try {</span>
<a href="#l18.40"></a><span id="l18.40">       sendFlowed = this.getMailPref(&quot;mailnews.send_plaintext_flowed&quot;);</span>
<a href="#l18.41"></a><span id="l18.41">     }</span>
<a href="#l18.42"></a><span id="l18.42">     catch (ex) {</span>
<a href="#l18.43"></a><span id="l18.43">       sendFlowed = true;</span>
<a href="#l18.44"></a><span id="l18.44">     }</span>
<a href="#l18.45"></a><span id="l18.45">     var encoderFlags = dce.OutputFormatted | dce.OutputLFLineBreak;</span>
<a href="#l18.46"></a><span id="l18.46"> </span>
<a href="#l18.47"></a><span id="l18.47" class="difflineminus">-    var wrapper = gMsgCompose.editor.QueryInterface(Components.interfaces.nsIEditorMailSupport);</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineminus">-    var editor = gMsgCompose.editor.QueryInterface(Components.interfaces.nsIPlaintextEditor);</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineplus">+    var editor = gMsgCompose.editor.QueryInterface(Components.interfaces.nsIEditorMailSupport);</span>
<a href="#l18.50"></a><span id="l18.50">     var wrapWidth = 72;</span>
<a href="#l18.51"></a><span id="l18.51"> </span>
<a href="#l18.52"></a><span id="l18.52">     if (!(sendInfo.sendFlags &amp; ENCRYPT)) {</span>
<a href="#l18.53"></a><span id="l18.53">       // signed messages only</span>
<a href="#l18.54"></a><span id="l18.54">       if (gMsgCompose.composeHTML) {</span>
<a href="#l18.55"></a><span id="l18.55">         // enforce line wrapping here</span>
<a href="#l18.56"></a><span id="l18.56">         // otherwise the message isn't signed correctly</span>
<a href="#l18.57"></a><span id="l18.57">         try {</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineat">@@ -4119,17 +4117,17 @@ Enigmail.msg = {</span>
<a href="#l18.59"></a><span id="l18.59">           if (wrapWidth &gt; 0 &amp;&amp; wrapWidth &lt; 68 &amp;&amp; gMsgCompose.wrapLength &gt; 0) {</span>
<a href="#l18.60"></a><span id="l18.60">             if (EnigmailDialog.confirmDlg(window, EnigmailLocale.getString(&quot;minimalLineWrapping&quot;, [wrapWidth]))) {</span>
<a href="#l18.61"></a><span id="l18.61">               EnigmailPrefs.getPrefRoot().setIntPref(&quot;editor.htmlWrapColumn&quot;, 68);</span>
<a href="#l18.62"></a><span id="l18.62">             }</span>
<a href="#l18.63"></a><span id="l18.63">           }</span>
<a href="#l18.64"></a><span id="l18.64">           if (EnigmailPrefs.getPref(&quot;wrapHtmlBeforeSend&quot;)) {</span>
<a href="#l18.65"></a><span id="l18.65">             if (wrapWidth) {</span>
<a href="#l18.66"></a><span id="l18.66">               editor.wrapWidth = wrapWidth - 2; // prepare for the worst case: a 72 char's long line starting with '-'</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineminus">-              wrapper.rewrap(false);</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineplus">+              editor.rewrap(false);</span>
<a href="#l18.69"></a><span id="l18.69">             }</span>
<a href="#l18.70"></a><span id="l18.70">           }</span>
<a href="#l18.71"></a><span id="l18.71">         }</span>
<a href="#l18.72"></a><span id="l18.72">         catch (ex) {}</span>
<a href="#l18.73"></a><span id="l18.73">       }</span>
<a href="#l18.74"></a><span id="l18.74">       else {</span>
<a href="#l18.75"></a><span id="l18.75">         // plaintext: Wrapping code has been moved to superordinate function encryptMsg to enable interactive format switch</span>
<a href="#l18.76"></a><span id="l18.76">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -17,17 +17,16 @@</span>
<a href="#l19.4"></a><span id="l19.4"> #include &quot;nsMsgCompUtils.h&quot;</span>
<a href="#l19.5"></a><span id="l19.5"> #include &quot;nsComposeStrings.h&quot;</span>
<a href="#l19.6"></a><span id="l19.6"> #include &quot;nsIMsgSend.h&quot;</span>
<a href="#l19.7"></a><span id="l19.7"> #include &quot;nsMailHeaders.h&quot;</span>
<a href="#l19.8"></a><span id="l19.8"> #include &quot;nsMsgPrompts.h&quot;</span>
<a href="#l19.9"></a><span id="l19.9"> #include &quot;nsMimeTypes.h&quot;</span>
<a href="#l19.10"></a><span id="l19.10"> #include &quot;nsICharsetConverterManager.h&quot;</span>
<a href="#l19.11"></a><span id="l19.11"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-#include &quot;nsIPlaintextEditor.h&quot;</span>
<a href="#l19.13"></a><span id="l19.13"> #include &quot;nsIHTMLEditor.h&quot;</span>
<a href="#l19.14"></a><span id="l19.14"> #include &quot;nsIEditor.h&quot;</span>
<a href="#l19.15"></a><span id="l19.15"> #include &quot;plstr.h&quot;</span>
<a href="#l19.16"></a><span id="l19.16"> #include &quot;prmem.h&quot;</span>
<a href="#l19.17"></a><span id="l19.17"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l19.18"></a><span id="l19.18"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l19.19"></a><span id="l19.19"> #include &quot;nsCExternalHandlerService.h&quot;</span>
<a href="#l19.20"></a><span id="l19.20"> #include &quot;nsIMIMEService.h&quot;</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineat">@@ -613,17 +612,16 @@ nsMsgCompose::ConvertAndLoadComposeWindo</span>
<a href="#l19.22"></a><span id="l19.22">   // Ok - now we need to figure out the charset of the aBuf we are going to send</span>
<a href="#l19.23"></a><span id="l19.23">   // into the editor shell. There are I18N calls to sniff the data and then we</span>
<a href="#l19.24"></a><span id="l19.24">   // need to call the new routine in the editor that will allow us to send in</span>
<a href="#l19.25"></a><span id="l19.25">   // the charset</span>
<a href="#l19.26"></a><span id="l19.26">   //</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">   // Now, insert it into the editor...</span>
<a href="#l19.29"></a><span id="l19.29">   RefPtr&lt;HTMLEditor&gt; htmlEditor = m_editor-&gt;AsHTMLEditor();</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-  nsCOMPtr&lt;nsIPlaintextEditor&gt; textEditor(do_QueryInterface(m_editor));</span>
<a href="#l19.31"></a><span id="l19.31">   int32_t reply_on_top = 0;</span>
<a href="#l19.32"></a><span id="l19.32">   bool sig_bottom = true;</span>
<a href="#l19.33"></a><span id="l19.33">   m_identity-&gt;GetReplyOnTop(&amp;reply_on_top);</span>
<a href="#l19.34"></a><span id="l19.34">   m_identity-&gt;GetSigBottom(&amp;sig_bottom);</span>
<a href="#l19.35"></a><span id="l19.35">   bool sigOnTop = (reply_on_top == 1 &amp;&amp; !sig_bottom);</span>
<a href="#l19.36"></a><span id="l19.36">   bool isForwarded = (mType == nsIMsgCompType::ForwardInline);</span>
<a href="#l19.37"></a><span id="l19.37"> </span>
<a href="#l19.38"></a><span id="l19.38">   // When in paragraph mode, don't call InsertLineBreak() since that inserts</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineat">@@ -636,35 +634,35 @@ nsMsgCompose::ConvertAndLoadComposeWindo</span>
<a href="#l19.40"></a><span id="l19.40">     mInsertingQuotedContent = true;</span>
<a href="#l19.41"></a><span id="l19.41">     if (!aPrefix.IsEmpty()) {</span>
<a href="#l19.42"></a><span id="l19.42">       if (!aHTMLEditor) aPrefix.AppendLiteral(&quot;\n&quot;);</span>
<a href="#l19.43"></a><span id="l19.43"> </span>
<a href="#l19.44"></a><span id="l19.44">       int32_t reply_on_top = 0;</span>
<a href="#l19.45"></a><span id="l19.45">       m_identity-&gt;GetReplyOnTop(&amp;reply_on_top);</span>
<a href="#l19.46"></a><span id="l19.46">       if (reply_on_top == 1) {</span>
<a href="#l19.47"></a><span id="l19.47">         // HTML editor eats one line break but not a whole paragraph.</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineminus">-        if (aHTMLEditor &amp;&amp; !paragraphMode) textEditor-&gt;InsertLineBreak();</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+        if (aHTMLEditor &amp;&amp; !paragraphMode) htmlEditor-&gt;InsertLineBreak();</span>
<a href="#l19.50"></a><span id="l19.50"> </span>
<a href="#l19.51"></a><span id="l19.51">         // add one newline if a signature comes before the quote, two otherwise</span>
<a href="#l19.52"></a><span id="l19.52">         bool includeSignature = true;</span>
<a href="#l19.53"></a><span id="l19.53">         bool sig_bottom = true;</span>
<a href="#l19.54"></a><span id="l19.54">         bool attachFile = false;</span>
<a href="#l19.55"></a><span id="l19.55">         nsString prefSigText;</span>
<a href="#l19.56"></a><span id="l19.56"> </span>
<a href="#l19.57"></a><span id="l19.57">         m_identity-&gt;GetSigOnReply(&amp;includeSignature);</span>
<a href="#l19.58"></a><span id="l19.58">         m_identity-&gt;GetSigBottom(&amp;sig_bottom);</span>
<a href="#l19.59"></a><span id="l19.59">         m_identity-&gt;GetHtmlSigText(prefSigText);</span>
<a href="#l19.60"></a><span id="l19.60">         nsresult rv = m_identity-&gt;GetAttachSignature(&amp;attachFile);</span>
<a href="#l19.61"></a><span id="l19.61">         if (!paragraphMode || !aHTMLEditor) {</span>
<a href="#l19.62"></a><span id="l19.62">           if (includeSignature &amp;&amp; !sig_bottom &amp;&amp;</span>
<a href="#l19.63"></a><span id="l19.63">               ((NS_SUCCEEDED(rv) &amp;&amp; attachFile) || !prefSigText.IsEmpty()))</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineminus">-            textEditor-&gt;InsertLineBreak();</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineplus">+            htmlEditor-&gt;InsertLineBreak();</span>
<a href="#l19.66"></a><span id="l19.66">           else {</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineminus">-            textEditor-&gt;InsertLineBreak();</span>
<a href="#l19.68"></a><span id="l19.68" class="difflineminus">-            textEditor-&gt;InsertLineBreak();</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineplus">+            htmlEditor-&gt;InsertLineBreak();</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineplus">+            htmlEditor-&gt;InsertLineBreak();</span>
<a href="#l19.71"></a><span id="l19.71">           }</span>
<a href="#l19.72"></a><span id="l19.72">         }</span>
<a href="#l19.73"></a><span id="l19.73">       }</span>
<a href="#l19.74"></a><span id="l19.74"> </span>
<a href="#l19.75"></a><span id="l19.75">       InsertDivWrappedTextAtSelection(aPrefix,</span>
<a href="#l19.76"></a><span id="l19.76">                                       NS_LITERAL_STRING(&quot;moz-cite-prefix&quot;));</span>
<a href="#l19.77"></a><span id="l19.77">     }</span>
<a href="#l19.78"></a><span id="l19.78"> </span>
<a href="#l19.79"></a><span id="l19.79" class="difflineat">@@ -677,32 +675,32 @@ nsMsgCompose::ConvertAndLoadComposeWindo</span>
<a href="#l19.80"></a><span id="l19.80">                                            getter_AddRefs(nodeInserted));</span>
<a href="#l19.81"></a><span id="l19.81">       } else {</span>
<a href="#l19.82"></a><span id="l19.82">         htmlEditor-&gt;InsertAsQuotation(aBuf, getter_AddRefs(nodeInserted));</span>
<a href="#l19.83"></a><span id="l19.83">       }</span>
<a href="#l19.84"></a><span id="l19.84">     }</span>
<a href="#l19.85"></a><span id="l19.85"> </span>
<a href="#l19.86"></a><span id="l19.86">     mInsertingQuotedContent = false;</span>
<a href="#l19.87"></a><span id="l19.87"> </span>
<a href="#l19.88"></a><span id="l19.88" class="difflineminus">-    (void)TagEmbeddedObjects(m_editor);</span>
<a href="#l19.89"></a><span id="l19.89" class="difflineplus">+    (void)TagEmbeddedObjects(htmlEditor);</span>
<a href="#l19.90"></a><span id="l19.90"> </span>
<a href="#l19.91"></a><span id="l19.91">     if (!aSignature.IsEmpty()) {</span>
<a href="#l19.92"></a><span id="l19.92">       // we cannot add it on top earlier, because TagEmbeddedObjects will mark</span>
<a href="#l19.93"></a><span id="l19.93">       // all images in the signature as &quot;moz-do-not-send&quot;</span>
<a href="#l19.94"></a><span id="l19.94">       if (sigOnTop) MoveToBeginningOfDocument();</span>
<a href="#l19.95"></a><span id="l19.95"> </span>
<a href="#l19.96"></a><span id="l19.96">       if (aHTMLEditor)</span>
<a href="#l19.97"></a><span id="l19.97">         htmlEditor-&gt;InsertHTML(aSignature);</span>
<a href="#l19.98"></a><span id="l19.98">       else {</span>
<a href="#l19.99"></a><span id="l19.99" class="difflineminus">-        textEditor-&gt;InsertLineBreak();</span>
<a href="#l19.100"></a><span id="l19.100" class="difflineplus">+        htmlEditor-&gt;InsertLineBreak();</span>
<a href="#l19.101"></a><span id="l19.101">         InsertDivWrappedTextAtSelection(aSignature,</span>
<a href="#l19.102"></a><span id="l19.102">                                         NS_LITERAL_STRING(&quot;moz-signature&quot;));</span>
<a href="#l19.103"></a><span id="l19.103">       }</span>
<a href="#l19.104"></a><span id="l19.104"> </span>
<a href="#l19.105"></a><span id="l19.105" class="difflineminus">-      if (sigOnTop) m_editor-&gt;EndOfDocument();</span>
<a href="#l19.106"></a><span id="l19.106" class="difflineplus">+      if (sigOnTop) htmlEditor-&gt;EndOfDocument();</span>
<a href="#l19.107"></a><span id="l19.107">     }</span>
<a href="#l19.108"></a><span id="l19.108">   } else {</span>
<a href="#l19.109"></a><span id="l19.109">     if (aHTMLEditor) {</span>
<a href="#l19.110"></a><span id="l19.110">       mInsertingQuotedContent = true;</span>
<a href="#l19.111"></a><span id="l19.111">       if (isForwarded &amp;&amp;</span>
<a href="#l19.112"></a><span id="l19.112">           Substring(aBuf, 0, sizeof(MIME_FORWARD_HTML_PREFIX) - 1)</span>
<a href="#l19.113"></a><span id="l19.113">               .EqualsLiteral(MIME_FORWARD_HTML_PREFIX)) {</span>
<a href="#l19.114"></a><span id="l19.114">         // We assign the opening tag inside &quot;&lt;HTML&gt;&lt;BODY&gt;&lt;BR&gt;&lt;BR&gt;&quot; before the</span>
<a href="#l19.115"></a><span id="l19.115" class="difflineat">@@ -730,40 +728,40 @@ nsMsgCompose::ConvertAndLoadComposeWindo</span>
<a href="#l19.116"></a><span id="l19.116">       }</span>
<a href="#l19.117"></a><span id="l19.117"> </span>
<a href="#l19.118"></a><span id="l19.118">       mInsertingQuotedContent = false;</span>
<a href="#l19.119"></a><span id="l19.119"> </span>
<a href="#l19.120"></a><span id="l19.120">       // When forwarding a message as inline, or editing as new (which could</span>
<a href="#l19.121"></a><span id="l19.121">       // contain unsanitized remote content), tag any embedded objects</span>
<a href="#l19.122"></a><span id="l19.122">       // with moz-do-not-send=true so they don't get attached upon send.</span>
<a href="#l19.123"></a><span id="l19.123">       if (isForwarded || mType == nsIMsgCompType::EditAsNew)</span>
<a href="#l19.124"></a><span id="l19.124" class="difflineminus">-        (void)TagEmbeddedObjects(m_editor);</span>
<a href="#l19.125"></a><span id="l19.125" class="difflineplus">+        (void)TagEmbeddedObjects(htmlEditor);</span>
<a href="#l19.126"></a><span id="l19.126"> </span>
<a href="#l19.127"></a><span id="l19.127">       if (!aSignature.IsEmpty()) {</span>
<a href="#l19.128"></a><span id="l19.128">         if (isForwarded &amp;&amp; sigOnTop) {</span>
<a href="#l19.129"></a><span id="l19.129">           // Use our own function, nsEditor::BeginningOfDocument() would</span>
<a href="#l19.130"></a><span id="l19.130">           // position into the &lt;div class=&quot;moz-forward-container&quot;&gt; we've just</span>
<a href="#l19.131"></a><span id="l19.131">           // created.</span>
<a href="#l19.132"></a><span id="l19.132">           MoveToBeginningOfDocument();</span>
<a href="#l19.133"></a><span id="l19.133">         } else {</span>
<a href="#l19.134"></a><span id="l19.134">           // Use our own function, nsEditor::EndOfDocument() would position</span>
<a href="#l19.135"></a><span id="l19.135">           // into the &lt;div class=&quot;moz-forward-container&quot;&gt; we've just created.</span>
<a href="#l19.136"></a><span id="l19.136">           MoveToEndOfDocument();</span>
<a href="#l19.137"></a><span id="l19.137">         }</span>
<a href="#l19.138"></a><span id="l19.138">         htmlEditor-&gt;InsertHTML(aSignature);</span>
<a href="#l19.139"></a><span id="l19.139" class="difflineminus">-        if (isForwarded &amp;&amp; sigOnTop) m_editor-&gt;EndOfDocument();</span>
<a href="#l19.140"></a><span id="l19.140" class="difflineplus">+        if (isForwarded &amp;&amp; sigOnTop) htmlEditor-&gt;EndOfDocument();</span>
<a href="#l19.141"></a><span id="l19.141">       } else</span>
<a href="#l19.142"></a><span id="l19.142" class="difflineminus">-        m_editor-&gt;EndOfDocument();</span>
<a href="#l19.143"></a><span id="l19.143" class="difflineplus">+        htmlEditor-&gt;EndOfDocument();</span>
<a href="#l19.144"></a><span id="l19.144">     } else {</span>
<a href="#l19.145"></a><span id="l19.145">       bool sigOnTopInserted = false;</span>
<a href="#l19.146"></a><span id="l19.146">       if (isForwarded &amp;&amp; sigOnTop &amp;&amp; !aSignature.IsEmpty()) {</span>
<a href="#l19.147"></a><span id="l19.147" class="difflineminus">-        textEditor-&gt;InsertLineBreak();</span>
<a href="#l19.148"></a><span id="l19.148" class="difflineplus">+        htmlEditor-&gt;InsertLineBreak();</span>
<a href="#l19.149"></a><span id="l19.149">         InsertDivWrappedTextAtSelection(aSignature,</span>
<a href="#l19.150"></a><span id="l19.150">                                         NS_LITERAL_STRING(&quot;moz-signature&quot;));</span>
<a href="#l19.151"></a><span id="l19.151" class="difflineminus">-        m_editor-&gt;EndOfDocument();</span>
<a href="#l19.152"></a><span id="l19.152" class="difflineplus">+        htmlEditor-&gt;EndOfDocument();</span>
<a href="#l19.153"></a><span id="l19.153">         sigOnTopInserted = true;</span>
<a href="#l19.154"></a><span id="l19.154">       }</span>
<a href="#l19.155"></a><span id="l19.155"> </span>
<a href="#l19.156"></a><span id="l19.156">       if (!aBuf.IsEmpty()) {</span>
<a href="#l19.157"></a><span id="l19.157">         nsresult rv;</span>
<a href="#l19.158"></a><span id="l19.158">         RefPtr&lt;Element&gt; divElem;</span>
<a href="#l19.159"></a><span id="l19.159">         RefPtr&lt;Element&gt; extraBr;</span>
<a href="#l19.160"></a><span id="l19.160"> </span>
<a href="#l19.161"></a><span id="l19.161" class="difflineat">@@ -793,129 +791,128 @@ nsMsgCompose::ConvertAndLoadComposeWindo</span>
<a href="#l19.162"></a><span id="l19.162">           }</span>
<a href="#l19.163"></a><span id="l19.163"> </span>
<a href="#l19.164"></a><span id="l19.164">           // Insert the non-empty &lt;div&gt; into the DOM.</span>
<a href="#l19.165"></a><span id="l19.165">           rv = htmlEditor-&gt;InsertElementAtSelection(divElem, false);</span>
<a href="#l19.166"></a><span id="l19.166">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.167"></a><span id="l19.167"> </span>
<a href="#l19.168"></a><span id="l19.168">           // Position into the div, so out content goes there.</span>
<a href="#l19.169"></a><span id="l19.169">           RefPtr&lt;Selection&gt; selection;</span>
<a href="#l19.170"></a><span id="l19.170" class="difflineminus">-          m_editor-&gt;GetSelection(getter_AddRefs(selection));</span>
<a href="#l19.171"></a><span id="l19.171" class="difflineplus">+          htmlEditor-&gt;GetSelection(getter_AddRefs(selection));</span>
<a href="#l19.172"></a><span id="l19.172">           rv = selection-&gt;Collapse(divElem, 0);</span>
<a href="#l19.173"></a><span id="l19.173">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.174"></a><span id="l19.174">         }</span>
<a href="#l19.175"></a><span id="l19.175"> </span>
<a href="#l19.176"></a><span id="l19.176">         rv = htmlEditor-&gt;InsertTextWithQuotations(aBuf);</span>
<a href="#l19.177"></a><span id="l19.177">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.178"></a><span id="l19.178"> </span>
<a href="#l19.179"></a><span id="l19.179">         if (isForwarded) {</span>
<a href="#l19.180"></a><span id="l19.180" class="difflineminus">-          nsCOMPtr&lt;nsIEditor&gt; editor(m_editor);  // Strong reference.</span>
<a href="#l19.181"></a><span id="l19.181">           // Special treatment for forwarded messages: Part 2.</span>
<a href="#l19.182"></a><span id="l19.182">           if (sigOnTopInserted) {</span>
<a href="#l19.183"></a><span id="l19.183">             // Sadly the M-C editor inserts a &lt;br&gt; between the &lt;div&gt; for the</span>
<a href="#l19.184"></a><span id="l19.184">             // signature and this &lt;div&gt;, so remove the &lt;br&gt; we don't want.</span>
<a href="#l19.185"></a><span id="l19.185">             nsCOMPtr&lt;nsINode&gt; brBeforeDiv;</span>
<a href="#l19.186"></a><span id="l19.186">             nsAutoString tagLocalName;</span>
<a href="#l19.187"></a><span id="l19.187">             brBeforeDiv = divElem-&gt;GetPreviousSibling();</span>
<a href="#l19.188"></a><span id="l19.188">             if (brBeforeDiv) {</span>
<a href="#l19.189"></a><span id="l19.189">               tagLocalName = brBeforeDiv-&gt;LocalName();</span>
<a href="#l19.190"></a><span id="l19.190">               if (tagLocalName.EqualsLiteral(&quot;br&quot;)) {</span>
<a href="#l19.191"></a><span id="l19.191" class="difflineminus">-                rv = editor-&gt;DeleteNode(brBeforeDiv);</span>
<a href="#l19.192"></a><span id="l19.192" class="difflineplus">+                rv = htmlEditor-&gt;DeleteNode(brBeforeDiv);</span>
<a href="#l19.193"></a><span id="l19.193">                 NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.194"></a><span id="l19.194">               }</span>
<a href="#l19.195"></a><span id="l19.195">             }</span>
<a href="#l19.196"></a><span id="l19.196">           }</span>
<a href="#l19.197"></a><span id="l19.197"> </span>
<a href="#l19.198"></a><span id="l19.198">           // Clean up the &lt;br&gt; we inserted.</span>
<a href="#l19.199"></a><span id="l19.199" class="difflineminus">-          rv = editor-&gt;DeleteNode(extraBr);</span>
<a href="#l19.200"></a><span id="l19.200" class="difflineplus">+          rv = htmlEditor-&gt;DeleteNode(extraBr);</span>
<a href="#l19.201"></a><span id="l19.201">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.202"></a><span id="l19.202">         }</span>
<a href="#l19.203"></a><span id="l19.203"> </span>
<a href="#l19.204"></a><span id="l19.204">         // Use our own function instead of nsEditor::EndOfDocument() because</span>
<a href="#l19.205"></a><span id="l19.205">         // we don't want to position at the end of the div we've just created.</span>
<a href="#l19.206"></a><span id="l19.206">         // It's OK to use, even if we're not forwarding and didn't create a</span>
<a href="#l19.207"></a><span id="l19.207">         // &lt;div&gt;.</span>
<a href="#l19.208"></a><span id="l19.208">         rv = MoveToEndOfDocument();</span>
<a href="#l19.209"></a><span id="l19.209">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.210"></a><span id="l19.210">       }</span>
<a href="#l19.211"></a><span id="l19.211"> </span>
<a href="#l19.212"></a><span id="l19.212">       if ((!isForwarded || !sigOnTop) &amp;&amp; !aSignature.IsEmpty()) {</span>
<a href="#l19.213"></a><span id="l19.213" class="difflineminus">-        textEditor-&gt;InsertLineBreak();</span>
<a href="#l19.214"></a><span id="l19.214" class="difflineplus">+        htmlEditor-&gt;InsertLineBreak();</span>
<a href="#l19.215"></a><span id="l19.215">         InsertDivWrappedTextAtSelection(aSignature,</span>
<a href="#l19.216"></a><span id="l19.216">                                         NS_LITERAL_STRING(&quot;moz-signature&quot;));</span>
<a href="#l19.217"></a><span id="l19.217">       }</span>
<a href="#l19.218"></a><span id="l19.218">     }</span>
<a href="#l19.219"></a><span id="l19.219">   }</span>
<a href="#l19.220"></a><span id="l19.220"> </span>
<a href="#l19.221"></a><span id="l19.221">   if (aBuf.IsEmpty())</span>
<a href="#l19.222"></a><span id="l19.222" class="difflineminus">-    m_editor-&gt;BeginningOfDocument();</span>
<a href="#l19.223"></a><span id="l19.223" class="difflineplus">+    htmlEditor-&gt;BeginningOfDocument();</span>
<a href="#l19.224"></a><span id="l19.224">   else {</span>
<a href="#l19.225"></a><span id="l19.225">     switch (reply_on_top) {</span>
<a href="#l19.226"></a><span id="l19.226">       // This should set the cursor after the body but before the sig</span>
<a href="#l19.227"></a><span id="l19.227">       case 0: {</span>
<a href="#l19.228"></a><span id="l19.228" class="difflineminus">-        if (!textEditor) {</span>
<a href="#l19.229"></a><span id="l19.229" class="difflineminus">-          m_editor-&gt;BeginningOfDocument();</span>
<a href="#l19.230"></a><span id="l19.230" class="difflineplus">+        if (!htmlEditor) {</span>
<a href="#l19.231"></a><span id="l19.231" class="difflineplus">+          htmlEditor-&gt;BeginningOfDocument();</span>
<a href="#l19.232"></a><span id="l19.232">           break;</span>
<a href="#l19.233"></a><span id="l19.233">         }</span>
<a href="#l19.234"></a><span id="l19.234"> </span>
<a href="#l19.235"></a><span id="l19.235">         RefPtr&lt;Selection&gt; selection;</span>
<a href="#l19.236"></a><span id="l19.236">         nsCOMPtr&lt;nsINode&gt; parent;</span>
<a href="#l19.237"></a><span id="l19.237">         int32_t offset;</span>
<a href="#l19.238"></a><span id="l19.238">         nsresult rv;</span>
<a href="#l19.239"></a><span id="l19.239"> </span>
<a href="#l19.240"></a><span id="l19.240">         // get parent and offset of mailcite</span>
<a href="#l19.241"></a><span id="l19.241">         rv = GetNodeLocation(nodeInserted, address_of(parent), &amp;offset);</span>
<a href="#l19.242"></a><span id="l19.242">         if (NS_FAILED(rv) || (!parent)) {</span>
<a href="#l19.243"></a><span id="l19.243" class="difflineminus">-          m_editor-&gt;BeginningOfDocument();</span>
<a href="#l19.244"></a><span id="l19.244" class="difflineplus">+          htmlEditor-&gt;BeginningOfDocument();</span>
<a href="#l19.245"></a><span id="l19.245">           break;</span>
<a href="#l19.246"></a><span id="l19.246">         }</span>
<a href="#l19.247"></a><span id="l19.247"> </span>
<a href="#l19.248"></a><span id="l19.248">         // get selection</span>
<a href="#l19.249"></a><span id="l19.249" class="difflineminus">-        m_editor-&gt;GetSelection(getter_AddRefs(selection));</span>
<a href="#l19.250"></a><span id="l19.250" class="difflineplus">+        htmlEditor-&gt;GetSelection(getter_AddRefs(selection));</span>
<a href="#l19.251"></a><span id="l19.251">         if (!selection) {</span>
<a href="#l19.252"></a><span id="l19.252" class="difflineminus">-          m_editor-&gt;BeginningOfDocument();</span>
<a href="#l19.253"></a><span id="l19.253" class="difflineplus">+          htmlEditor-&gt;BeginningOfDocument();</span>
<a href="#l19.254"></a><span id="l19.254">           break;</span>
<a href="#l19.255"></a><span id="l19.255">         }</span>
<a href="#l19.256"></a><span id="l19.256"> </span>
<a href="#l19.257"></a><span id="l19.257">         // place selection after mailcite</span>
<a href="#l19.258"></a><span id="l19.258">         selection-&gt;Collapse(parent, offset + 1);</span>
<a href="#l19.259"></a><span id="l19.259"> </span>
<a href="#l19.260"></a><span id="l19.260">         // insert a break at current selection</span>
<a href="#l19.261"></a><span id="l19.261" class="difflineminus">-        if (!paragraphMode || !aHTMLEditor) textEditor-&gt;InsertLineBreak();</span>
<a href="#l19.262"></a><span id="l19.262" class="difflineplus">+        if (!paragraphMode || !aHTMLEditor) htmlEditor-&gt;InsertLineBreak();</span>
<a href="#l19.263"></a><span id="l19.263"> </span>
<a href="#l19.264"></a><span id="l19.264">         // i'm not sure if you need to move the selection back to before the</span>
<a href="#l19.265"></a><span id="l19.265">         // break. expirement.</span>
<a href="#l19.266"></a><span id="l19.266">         selection-&gt;Collapse(parent, offset + 1);</span>
<a href="#l19.267"></a><span id="l19.267"> </span>
<a href="#l19.268"></a><span id="l19.268">         break;</span>
<a href="#l19.269"></a><span id="l19.269">       }</span>
<a href="#l19.270"></a><span id="l19.270"> </span>
<a href="#l19.271"></a><span id="l19.271">       case 2: {</span>
<a href="#l19.272"></a><span id="l19.272" class="difflineminus">-        nsCOMPtr&lt;nsIEditor&gt; editor(m_editor);  // Strong reference.</span>
<a href="#l19.273"></a><span id="l19.273" class="difflineplus">+        nsCOMPtr&lt;nsIEditor&gt; editor(htmlEditor);  // Strong reference.</span>
<a href="#l19.274"></a><span id="l19.274">         editor-&gt;SelectAll();</span>
<a href="#l19.275"></a><span id="l19.275">         break;</span>
<a href="#l19.276"></a><span id="l19.276">       }</span>
<a href="#l19.277"></a><span id="l19.277"> </span>
<a href="#l19.278"></a><span id="l19.278">       // This should set the cursor to the top!</span>
<a href="#l19.279"></a><span id="l19.279">       default: {</span>
<a href="#l19.280"></a><span id="l19.280">         MoveToBeginningOfDocument();</span>
<a href="#l19.281"></a><span id="l19.281">         break;</span>
<a href="#l19.282"></a><span id="l19.282">       }</span>
<a href="#l19.283"></a><span id="l19.283">     }</span>
<a href="#l19.284"></a><span id="l19.284">   }</span>
<a href="#l19.285"></a><span id="l19.285"> </span>
<a href="#l19.286"></a><span id="l19.286">   nsCOMPtr&lt;nsISelectionController&gt; selCon;</span>
<a href="#l19.287"></a><span id="l19.287" class="difflineminus">-  m_editor-&gt;GetSelectionController(getter_AddRefs(selCon));</span>
<a href="#l19.288"></a><span id="l19.288" class="difflineplus">+  htmlEditor-&gt;GetSelectionController(getter_AddRefs(selCon));</span>
<a href="#l19.289"></a><span id="l19.289"> </span>
<a href="#l19.290"></a><span id="l19.290">   if (selCon)</span>
<a href="#l19.291"></a><span id="l19.291">     selCon-&gt;ScrollSelectionIntoView(</span>
<a href="#l19.292"></a><span id="l19.292">         nsISelectionController::SELECTION_NORMAL,</span>
<a href="#l19.293"></a><span id="l19.293">         nsISelectionController::SELECTION_ANCHOR_REGION, true);</span>
<a href="#l19.294"></a><span id="l19.294"> </span>
<a href="#l19.295"></a><span id="l19.295" class="difflineminus">-  m_editor-&gt;EnableUndo(true);</span>
<a href="#l19.296"></a><span id="l19.296" class="difflineplus">+  htmlEditor-&gt;EnableUndo(true);</span>
<a href="#l19.297"></a><span id="l19.297">   SetBodyModified(false);</span>
<a href="#l19.298"></a><span id="l19.298"> </span>
<a href="#l19.299"></a><span id="l19.299"> #ifdef MSGCOMP_TRACE_PERFORMANCE</span>
<a href="#l19.300"></a><span id="l19.300">   nsCOMPtr&lt;nsIMsgComposeService&gt; composeService(</span>
<a href="#l19.301"></a><span id="l19.301">       do_GetService(NS_MSGCOMPOSESERVICE_CONTRACTID));</span>
<a href="#l19.302"></a><span id="l19.302">   composeService-&gt;TimeStamp(</span>
<a href="#l19.303"></a><span id="l19.303">       &quot;Finished inserting data into the editor. The window is finally ready!&quot;,</span>
<a href="#l19.304"></a><span id="l19.304">       false);</span>
<a href="#l19.305"></a><span id="l19.305" class="difflineat">@@ -2848,51 +2845,49 @@ MOZ_CAN_RUN_SCRIPT nsresult QuotingOutpu</span>
<a href="#l19.306"></a><span id="l19.306">   // Now, insert it into the editor...</span>
<a href="#l19.307"></a><span id="l19.307">   if (aEditor) aEditor-&gt;EnableUndo(true);</span>
<a href="#l19.308"></a><span id="l19.308"> </span>
<a href="#l19.309"></a><span id="l19.309">   nsCOMPtr&lt;nsIMsgCompose&gt; compose = do_QueryReferent(mWeakComposeObj);</span>
<a href="#l19.310"></a><span id="l19.310">   if (!mMsgBody.IsEmpty() &amp;&amp; compose) {</span>
<a href="#l19.311"></a><span id="l19.311">     compose-&gt;SetInsertingQuotedContent(true);</span>
<a href="#l19.312"></a><span id="l19.312">     if (!mCitePrefix.IsEmpty()) {</span>
<a href="#l19.313"></a><span id="l19.313">       if (!aHTMLEditor) mCitePrefix.AppendLiteral(&quot;\n&quot;);</span>
<a href="#l19.314"></a><span id="l19.314" class="difflineminus">-      nsCOMPtr&lt;nsIPlaintextEditor&gt; textEditor(do_QueryInterface(aEditor));</span>
<a href="#l19.315"></a><span id="l19.315" class="difflineminus">-      if (textEditor) textEditor-&gt;InsertText(mCitePrefix);</span>
<a href="#l19.316"></a><span id="l19.316" class="difflineplus">+      if (aEditor) aEditor-&gt;InsertText(mCitePrefix);</span>
<a href="#l19.317"></a><span id="l19.317">     }</span>
<a href="#l19.318"></a><span id="l19.318"> </span>
<a href="#l19.319"></a><span id="l19.319">     RefPtr&lt;mozilla::HTMLEditor&gt; htmlEditor = aEditor-&gt;AsHTMLEditor();</span>
<a href="#l19.320"></a><span id="l19.320">     if (aHTMLEditor) {</span>
<a href="#l19.321"></a><span id="l19.321">       nsAutoString body(mMsgBody);</span>
<a href="#l19.322"></a><span id="l19.322">       remove_plaintext_tag(body);</span>
<a href="#l19.323"></a><span id="l19.323">       htmlEditor-&gt;InsertAsCitedQuotation(body, EmptyString(), true,</span>
<a href="#l19.324"></a><span id="l19.324">                                          getter_AddRefs(nodeInserted));</span>
<a href="#l19.325"></a><span id="l19.325">     } else {</span>
<a href="#l19.326"></a><span id="l19.326">       htmlEditor-&gt;InsertAsQuotation(mMsgBody, getter_AddRefs(nodeInserted));</span>
<a href="#l19.327"></a><span id="l19.327">     }</span>
<a href="#l19.328"></a><span id="l19.328">     compose-&gt;SetInsertingQuotedContent(false);</span>
<a href="#l19.329"></a><span id="l19.329">   }</span>
<a href="#l19.330"></a><span id="l19.330"> </span>
<a href="#l19.331"></a><span id="l19.331">   if (aEditor) {</span>
<a href="#l19.332"></a><span id="l19.332" class="difflineminus">-    nsCOMPtr&lt;nsIPlaintextEditor&gt; textEditor = do_QueryInterface(aEditor);</span>
<a href="#l19.333"></a><span id="l19.333" class="difflineminus">-    if (textEditor) {</span>
<a href="#l19.334"></a><span id="l19.334" class="difflineplus">+    if (aEditor) {</span>
<a href="#l19.335"></a><span id="l19.335">       RefPtr&lt;Selection&gt; selection;</span>
<a href="#l19.336"></a><span id="l19.336">       nsCOMPtr&lt;nsINode&gt; parent;</span>
<a href="#l19.337"></a><span id="l19.337">       int32_t offset;</span>
<a href="#l19.338"></a><span id="l19.338">       nsresult rv;</span>
<a href="#l19.339"></a><span id="l19.339"> </span>
<a href="#l19.340"></a><span id="l19.340">       // get parent and offset of mailcite</span>
<a href="#l19.341"></a><span id="l19.341">       rv = GetNodeLocation(nodeInserted, address_of(parent), &amp;offset);</span>
<a href="#l19.342"></a><span id="l19.342">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.343"></a><span id="l19.343"> </span>
<a href="#l19.344"></a><span id="l19.344">       // get selection</span>
<a href="#l19.345"></a><span id="l19.345">       aEditor-&gt;GetSelection(getter_AddRefs(selection));</span>
<a href="#l19.346"></a><span id="l19.346">       if (selection) {</span>
<a href="#l19.347"></a><span id="l19.347">         // place selection after mailcite</span>
<a href="#l19.348"></a><span id="l19.348">         selection-&gt;Collapse(parent, offset + 1);</span>
<a href="#l19.349"></a><span id="l19.349">         // insert a break at current selection</span>
<a href="#l19.350"></a><span id="l19.350" class="difflineminus">-        textEditor-&gt;InsertLineBreak();</span>
<a href="#l19.351"></a><span id="l19.351" class="difflineplus">+        aEditor-&gt;InsertLineBreak();</span>
<a href="#l19.352"></a><span id="l19.352">         selection-&gt;Collapse(parent, offset + 1);</span>
<a href="#l19.353"></a><span id="l19.353">       }</span>
<a href="#l19.354"></a><span id="l19.354">       nsCOMPtr&lt;nsISelectionController&gt; selCon;</span>
<a href="#l19.355"></a><span id="l19.355">       aEditor-&gt;GetSelectionController(getter_AddRefs(selCon));</span>
<a href="#l19.356"></a><span id="l19.356"> </span>
<a href="#l19.357"></a><span id="l19.357">       if (selCon)</span>
<a href="#l19.358"></a><span id="l19.358">         // After ScrollSelectionIntoView(), the pending notifications might be</span>
<a href="#l19.359"></a><span id="l19.359">         // flushed and PresShell/PresContext/Frames may be dead. See bug 418470.</span>
<a href="#l19.360"></a><span id="l19.360" class="difflineat">@@ -5395,21 +5390,19 @@ nsMsgCompose::SetIdentity(nsIMsgIdentity</span>
<a href="#l19.361"></a><span id="l19.361">       rv = MoveToAboveQuote();</span>
<a href="#l19.362"></a><span id="l19.362">     } else {</span>
<a href="#l19.363"></a><span id="l19.363">       // Note: New messages aren't quoted so we always move to the end.</span>
<a href="#l19.364"></a><span id="l19.364">       rv = MoveToEndOfDocument();</span>
<a href="#l19.365"></a><span id="l19.365">     }</span>
<a href="#l19.366"></a><span id="l19.366"> </span>
<a href="#l19.367"></a><span id="l19.367">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l19.368"></a><span id="l19.368">       if (m_composeHTML) {</span>
<a href="#l19.369"></a><span id="l19.369" class="difflineminus">-        nsCOMPtr&lt;nsIHTMLEditor&gt; htmlEditor(do_QueryInterface(editor));</span>
<a href="#l19.370"></a><span id="l19.370" class="difflineminus">-        rv = htmlEditor-&gt;InsertHTML(aSignature);</span>
<a href="#l19.371"></a><span id="l19.371" class="difflineplus">+        rv = MOZ_KnownLive(editor-&gt;AsHTMLEditor())-&gt;InsertHTML(aSignature);</span>
<a href="#l19.372"></a><span id="l19.372">       } else {</span>
<a href="#l19.373"></a><span id="l19.373" class="difflineminus">-        nsCOMPtr&lt;nsIPlaintextEditor&gt; textEditor(do_QueryInterface(editor));</span>
<a href="#l19.374"></a><span id="l19.374" class="difflineminus">-        rv = textEditor-&gt;InsertLineBreak();</span>
<a href="#l19.375"></a><span id="l19.375" class="difflineplus">+        rv = editor-&gt;InsertLineBreak();</span>
<a href="#l19.376"></a><span id="l19.376">         InsertDivWrappedTextAtSelection(aSignature,</span>
<a href="#l19.377"></a><span id="l19.377">                                         NS_LITERAL_STRING(&quot;moz-signature&quot;));</span>
<a href="#l19.378"></a><span id="l19.378">       }</span>
<a href="#l19.379"></a><span id="l19.379">     }</span>
<a href="#l19.380"></a><span id="l19.380">     editor-&gt;EndTransaction();</span>
<a href="#l19.381"></a><span id="l19.381">   }</span>
<a href="#l19.382"></a><span id="l19.382"> </span>
<a href="#l19.383"></a><span id="l19.383">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/suite/components/bindings/textbox.xml</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/suite/components/bindings/textbox.xml</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -125,21 +125,20 @@</span>
<a href="#l20.4"></a><span id="l20.4">           this.inputField.setSelectionRange(aSelectionStart, aSelectionEnd);</span>
<a href="#l20.5"></a><span id="l20.5">         &lt;/body&gt;</span>
<a href="#l20.6"></a><span id="l20.6">       &lt;/method&gt;</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8">       &lt;method name=&quot;_setNewlineHandling&quot;&gt;</span>
<a href="#l20.9"></a><span id="l20.9">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l20.10"></a><span id="l20.10">           var str = this.getAttribute(&quot;newlines&quot;);</span>
<a href="#l20.11"></a><span id="l20.11">           if (str &amp;&amp; this.editor) {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-            for (let x in Ci.nsIPlaintextEditor) {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+            for (let x in Ci.nsIEditor) {</span>
<a href="#l20.14"></a><span id="l20.14">               if (/^eNewlines/.test(x)) {</span>
<a href="#l20.15"></a><span id="l20.15">                 if (str == RegExp.rightContext.toLowerCase()) {</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-                  this.editor.QueryInterface(Ci.nsIPlaintextEditor)</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-                      .newlineHandling = Ci.nsIPlaintextEditor[x];</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+                  this.editor.newlineHandling = Ci.nsIEditor[x];</span>
<a href="#l20.19"></a><span id="l20.19">                   break;</span>
<a href="#l20.20"></a><span id="l20.20">                 }</span>
<a href="#l20.21"></a><span id="l20.21">               }</span>
<a href="#l20.22"></a><span id="l20.22">             }</span>
<a href="#l20.23"></a><span id="l20.23">           }</span>
<a href="#l20.24"></a><span id="l20.24">         ]]&gt;&lt;/body&gt;</span>
<a href="#l20.25"></a><span id="l20.25">       &lt;/method&gt;</span>
<a href="#l20.26"></a><span id="l20.26"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/suite/mailnews/components/compose/content/MsgComposeCommands.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/suite/mailnews/components/compose/content/MsgComposeCommands.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -15,17 +15,16 @@ const {MailServices} = ChromeUtils.impor</span>
<a href="#l21.4"></a><span id="l21.4">  * interfaces</span>
<a href="#l21.5"></a><span id="l21.5">  */</span>
<a href="#l21.6"></a><span id="l21.6"> var nsIMsgCompDeliverMode = Ci.nsIMsgCompDeliverMode;</span>
<a href="#l21.7"></a><span id="l21.7"> var nsIMsgCompSendFormat = Ci.nsIMsgCompSendFormat;</span>
<a href="#l21.8"></a><span id="l21.8"> var nsIMsgCompConvertible = Ci.nsIMsgCompConvertible;</span>
<a href="#l21.9"></a><span id="l21.9"> var nsIMsgCompType = Ci.nsIMsgCompType;</span>
<a href="#l21.10"></a><span id="l21.10"> var nsIMsgCompFormat = Ci.nsIMsgCompFormat;</span>
<a href="#l21.11"></a><span id="l21.11"> var nsIAbPreferMailFormat = Ci.nsIAbPreferMailFormat;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-var nsIPlaintextEditorMail = Ci.nsIPlaintextEditor;</span>
<a href="#l21.13"></a><span id="l21.13"> var mozISpellCheckingEngine = Ci.mozISpellCheckingEngine;</span>
<a href="#l21.14"></a><span id="l21.14"> </span>
<a href="#l21.15"></a><span id="l21.15"> /**</span>
<a href="#l21.16"></a><span id="l21.16">  * In order to distinguish clearly globals that are initialized once when js load (static globals) and those that need to be</span>
<a href="#l21.17"></a><span id="l21.17">  * initialize every time a compose window open (globals), I (ducarroz) have decided to prefix by s... the static one and</span>
<a href="#l21.18"></a><span id="l21.18">  * by g... the other one. Please try to continue and repect this rule in the future. Thanks.</span>
<a href="#l21.19"></a><span id="l21.19">  */</span>
<a href="#l21.20"></a><span id="l21.20"> /**</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineat">@@ -129,26 +128,26 @@ function ReleaseGlobalVariables()</span>
<a href="#l21.22"></a><span id="l21.22">   gCharsetConvertManager = null;</span>
<a href="#l21.23"></a><span id="l21.23">   gMsgCompose = null;</span>
<a href="#l21.24"></a><span id="l21.24">   gOriginalMsgURI = null;</span>
<a href="#l21.25"></a><span id="l21.25">   gMailSession = null;</span>
<a href="#l21.26"></a><span id="l21.26"> }</span>
<a href="#l21.27"></a><span id="l21.27"> </span>
<a href="#l21.28"></a><span id="l21.28"> function disableEditableFields()</span>
<a href="#l21.29"></a><span id="l21.29"> {</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-  gMsgCompose.editor.flags |= nsIPlaintextEditorMail.eEditorReadonlyMask;</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+  gMsgCompose.editor.flags |= Ci.nsIEditor.eEditorReadonlyMask;</span>
<a href="#l21.32"></a><span id="l21.32">   var disableElements = document.getElementsByAttribute(&quot;disableonsend&quot;, &quot;true&quot;);</span>
<a href="#l21.33"></a><span id="l21.33">   for (let i = 0; i &lt; disableElements.length; i++)</span>
<a href="#l21.34"></a><span id="l21.34">     disableElements[i].setAttribute('disabled', 'true');</span>
<a href="#l21.35"></a><span id="l21.35"> </span>
<a href="#l21.36"></a><span id="l21.36"> }</span>
<a href="#l21.37"></a><span id="l21.37"> </span>
<a href="#l21.38"></a><span id="l21.38"> function enableEditableFields()</span>
<a href="#l21.39"></a><span id="l21.39"> {</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineminus">-  gMsgCompose.editor.flags &amp;= ~nsIPlaintextEditorMail.eEditorReadonlyMask;</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+  gMsgCompose.editor.flags &amp;= ~Ci.nsIEditor.eEditorReadonlyMask;</span>
<a href="#l21.42"></a><span id="l21.42">   var enableElements = document.getElementsByAttribute(&quot;disableonsend&quot;, &quot;true&quot;);</span>
<a href="#l21.43"></a><span id="l21.43">   for (let i = 0; i &lt; enableElements.length; i++)</span>
<a href="#l21.44"></a><span id="l21.44">     enableElements[i].removeAttribute('disabled');</span>
<a href="#l21.45"></a><span id="l21.45"> </span>
<a href="#l21.46"></a><span id="l21.46"> }</span>
<a href="#l21.47"></a><span id="l21.47"> </span>
<a href="#l21.48"></a><span id="l21.48"> /**</span>
<a href="#l21.49"></a><span id="l21.49">  * Small helper function to check whether the node passed in is a signature.</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineat">@@ -977,18 +976,17 @@ function GetArgs(originalData)</span>
<a href="#l21.51"></a><span id="l21.51">   return args;</span>
<a href="#l21.52"></a><span id="l21.52"> }</span>
<a href="#l21.53"></a><span id="l21.53"> </span>
<a href="#l21.54"></a><span id="l21.54"> function ComposeFieldsReady()</span>
<a href="#l21.55"></a><span id="l21.55"> {</span>
<a href="#l21.56"></a><span id="l21.56">   //If we are in plain text, we need to set the wrap column</span>
<a href="#l21.57"></a><span id="l21.57">   if (! gMsgCompose.composeHTML) {</span>
<a href="#l21.58"></a><span id="l21.58">     try {</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineminus">-      gMsgCompose.editor.QueryInterface(nsIPlaintextEditorMail).wrapWidth</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-          = gMsgCompose.wrapLength;</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+      gMsgCompose.editor.wrapWidth = gMsgCompose.wrapLength;</span>
<a href="#l21.62"></a><span id="l21.62">     }</span>
<a href="#l21.63"></a><span id="l21.63">     catch (e) {</span>
<a href="#l21.64"></a><span id="l21.64">       dump(&quot;### textEditor.wrapWidth exception text: &quot; + e + &quot; - failed\n&quot;);</span>
<a href="#l21.65"></a><span id="l21.65">     }</span>
<a href="#l21.66"></a><span id="l21.66">   }</span>
<a href="#l21.67"></a><span id="l21.67">   CompFields2Recipients(gMsgCompose.compFields);</span>
<a href="#l21.68"></a><span id="l21.68">   SetComposeWindowTitle();</span>
<a href="#l21.69"></a><span id="l21.69">   enableEditableFields();</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineat">@@ -3323,17 +3321,17 @@ function removeQueryPart(aURL, aQuery)</span>
<a href="#l21.71"></a><span id="l21.71">   return aURL.substr(0, indexQM + 1) + queryParts.join(&quot;&amp;&quot;);</span>
<a href="#l21.72"></a><span id="l21.72"> }</span>
<a href="#l21.73"></a><span id="l21.73"> </span>
<a href="#l21.74"></a><span id="l21.74"> function InitEditor(editor)</span>
<a href="#l21.75"></a><span id="l21.75"> {</span>
<a href="#l21.76"></a><span id="l21.76">   // Set the eEditorMailMask flag to avoid using content prefs for the spell</span>
<a href="#l21.77"></a><span id="l21.77">   // checker, otherwise the dictionary setting in preferences is ignored and</span>
<a href="#l21.78"></a><span id="l21.78">   // the dictionary is inconsistent between the subject and message body.</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineminus">-  var eEditorMailMask = Ci.nsIPlaintextEditor.eEditorMailMask;</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineplus">+  var eEditorMailMask = Ci.nsIEditor.eEditorMailMask;</span>
<a href="#l21.81"></a><span id="l21.81">   editor.flags |= eEditorMailMask;</span>
<a href="#l21.82"></a><span id="l21.82">   GetMsgSubjectElement().editor.flags |= eEditorMailMask;</span>
<a href="#l21.83"></a><span id="l21.83"> </span>
<a href="#l21.84"></a><span id="l21.84">   // Control insertion of line breaks.</span>
<a href="#l21.85"></a><span id="l21.85">   editor.returnInParagraphCreatesNewParagraph =</span>
<a href="#l21.86"></a><span id="l21.86">     Services.prefs.getBoolPref(&quot;mail.compose.default_to_paragraph&quot;) ||</span>
<a href="#l21.87"></a><span id="l21.87">     Services.prefs.getBoolPref(&quot;editor.CR_creates_new_p&quot;);</span>
<a href="#l21.88"></a><span id="l21.88">   editor.document.execCommand(&quot;defaultparagraphseparator&quot;, false,</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

