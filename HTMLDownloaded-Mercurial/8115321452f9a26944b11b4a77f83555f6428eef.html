<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 528:8115321452f9a26944b11b4a77f83555f6428eef</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 8115321452f9a26944b11b4a77f83555f6428eef" />
<meta property="og:url" content="/comm-central/rev/8115321452f9a26944b11b4a77f83555f6428eef" />
<meta property="og:description" content="Bug 458692 Drop charset parameter from nsIMsgHeaderParser interfaces. r=bienvenu,sr=Neil" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 8115321452f9a26944b11b4a77f83555f6428eef 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/8115321452f9a26944b11b4a77f83555f6428eef">shortlog</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/8115321452f9a26944b11b4a77f83555f6428eef">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef">files</a> |
changeset |
<a href="/comm-central/raw-rev/8115321452f9a26944b11b4a77f83555f6428eef">raw</a>  | <a href="/comm-central/archive/8115321452f9a26944b11b4a77f83555f6428eef.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=458692">Bug 458692</a> Drop charset parameter from nsIMsgHeaderParser interfaces. r=bienvenu,sr=Neil
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 06 Oct 2008 18:03:03 +0100</td></tr>

<tr>
 <td>changeset 528</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/8115321452f9a26944b11b4a77f83555f6428eef">8115321452f9a26944b11b4a77f83555f6428eef</a></td>
</tr>



<tr>
<td>parent 527</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/70c3c9246deca61f9c9324ce336af43ab47e7a9f">70c3c9246deca61f9c9324ce336af43ab47e7a9f</a>
</td>
</tr>

<tr>
<td>child 529</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/70420d2ee44cbf67502237a2adf13757f767b497">70420d2ee44cbf67502237a2adf13757f767b497</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=8115321452f9a26944b11b4a77f83555f6428eef">466</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 06 Oct 2008 17:04:03 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@70420d2ee44c [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=70420d2ee44cbf67502237a2adf13757f767b497">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=70420d2ee44cbf67502237a2adf13757f767b497&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=70420d2ee44cbf67502237a2adf13757f767b497&newProject=comm-central&newRevision=8115321452f9a26944b11b4a77f83555f6428eef&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=70420d2ee44cbf67502237a2adf13757f767b497&newProject=comm-central&newRevision=8115321452f9a26944b11b4a77f83555f6428eef&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=70420d2ee44cbf67502237a2adf13757f767b497&newProject=comm-central&newRevision=8115321452f9a26944b11b4a77f83555f6428eef&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a>, <a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=458692">458692</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=458692">Bug 458692</a> Drop charset parameter from nsIMsgHeaderParser interfaces. r=bienvenu,sr=Neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/mailWindowOverlay.js">mail/base/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/msgHdrViewOverlay.js">mail/base/content/msgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/msgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/msgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/msgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/msgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mail/base/content/msgHdrViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/addrbook/src/nsAbAddressCollecter.cpp">mailnews/addrbook/src/nsAbAddressCollecter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/addrbook/src/nsAbAddressCollecter.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/addrbook/src/nsAbAddressCollecter.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/addrbook/src/nsAbAddressCollecter.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/addrbook/src/nsAbAddressCollecter.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/addrbook/src/nsAbAddressCollecter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/junkCommands.js">mailnews/base/resources/content/junkCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/junkCommands.js">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/junkCommands.js">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/junkCommands.js">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/junkCommands.js">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/junkCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/mailWindowOverlay.js">mailnews/base/resources/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/msgHdrViewOverlay.js">mailnews/base/resources/content/msgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/msgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/msgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/msgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/msgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/resources/content/msgHdrViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgContentPolicy.cpp">mailnews/base/src/nsMsgContentPolicy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgContentPolicy.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgContentPolicy.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgContentPolicy.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgContentPolicy.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgContentPolicy.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompFields.cpp">mailnews/compose/src/nsMsgCompFields.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompFields.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompFields.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompFields.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompFields.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompFields.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompUtils.cpp">mailnews/compose/src/nsMsgCompUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompUtils.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompUtils.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompUtils.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompUtils.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">mailnews/extensions/smime/src/nsSMimeJSHelper.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/public/nsIMsgHeaderParser.idl">mailnews/mime/public/nsIMsgHeaderParser.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/public/nsIMsgHeaderParser.idl">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/public/nsIMsgHeaderParser.idl">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/public/nsIMsgHeaderParser.idl">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/public/nsIMsgHeaderParser.idl">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/public/nsIMsgHeaderParser.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/mimecms.cpp">mailnews/mime/src/mimecms.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/mimecms.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/mimecms.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/mimecms.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/mimecms.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/mimecms.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/nsMsgHeaderParser.cpp">mailnews/mime/src/nsMsgHeaderParser.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/nsMsgHeaderParser.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/nsMsgHeaderParser.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/nsMsgHeaderParser.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/nsMsgHeaderParser.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/mime/src/nsMsgHeaderParser.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/news/src/nsNNTPProtocol.cpp">mailnews/news/src/nsNNTPProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/news/src/nsNNTPProtocol.cpp">file</a> |
<a href="/comm-central/annotate/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/news/src/nsNNTPProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/news/src/nsNNTPProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/news/src/nsNNTPProtocol.cpp">comparison</a> |
<a href="/comm-central/log/8115321452f9a26944b11b4a77f83555f6428eef/mailnews/news/src/nsNNTPProtocol.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1136,17 +1136,17 @@ function MsgEditMessageAsNew()</span>
<a href="#l1.4"></a><span id="l1.4">   composeMsgByType(Components.interfaces.nsIMsgCompType.Template);</span>
<a href="#l1.5"></a><span id="l1.5"> }</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> function MsgCreateFilter()</span>
<a href="#l1.8"></a><span id="l1.8"> {</span>
<a href="#l1.9"></a><span id="l1.9">   // retrieve Sender direct from selected message's headers</span>
<a href="#l1.10"></a><span id="l1.10">   var msgHdr = gDBView.hdrForFirstSelectedMessage;</span>
<a href="#l1.11"></a><span id="l1.11">   var headerParser = Components.classes[&quot;@mozilla.org/messenger/headerparser;1&quot;].getService(Components.interfaces.nsIMsgHeaderParser);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  var emailAddress = headerParser.extractHeaderAddressMailboxes(null, msgHdr.author);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  var emailAddress = headerParser.extractHeaderAddressMailboxes(msgHdr.author);</span>
<a href="#l1.14"></a><span id="l1.14">   if (emailAddress)</span>
<a href="#l1.15"></a><span id="l1.15">     top.MsgFilters(emailAddress, null);</span>
<a href="#l1.16"></a><span id="l1.16"> }</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> function MsgHome(url)</span>
<a href="#l1.20"></a><span id="l1.20"> {</span>
<a href="#l1.21"></a><span id="l1.21">   window.open(url, &quot;_blank&quot;, &quot;chrome,dependent=yes,all&quot;);</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -2501,17 +2501,17 @@ var gMessageNotificationBar =</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24">     goUpdateCommand('button_junk');</span>
<a href="#l1.25"></a><span id="l1.25">   },</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">   setRemoteContentMsg: function(aMsgHdr)</span>
<a href="#l1.28"></a><span id="l1.28">   {  </span>
<a href="#l1.29"></a><span id="l1.29">     // update the allow remote content for sender string</span>
<a href="#l1.30"></a><span id="l1.30">     var headerParser = Components.classes[&quot;@mozilla.org/messenger/headerparser;1&quot;].getService(Components.interfaces.nsIMsgHeaderParser);</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-    var emailAddress = headerParser.extractHeaderAddressMailboxes(null, aMsgHdr.author);</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+    var emailAddress = headerParser.extractHeaderAddressMailboxes(aMsgHdr.author);</span>
<a href="#l1.33"></a><span id="l1.33">     document.getElementById('allowRemoteContentForAuthorDesc').value = </span>
<a href="#l1.34"></a><span id="l1.34">       gMessengerBundle.getFormattedString('alwaysLoadRemoteContentForSender1', [emailAddress ? emailAddress : aMsgHdr.author]);</span>
<a href="#l1.35"></a><span id="l1.35">     this.updateMsgNotificationBar(kMsgNotificationRemoteImages, true);</span>
<a href="#l1.36"></a><span id="l1.36">   },</span>
<a href="#l1.37"></a><span id="l1.37"> </span>
<a href="#l1.38"></a><span id="l1.38">   setPhishingMsg: function()</span>
<a href="#l1.39"></a><span id="l1.39">   {</span>
<a href="#l1.40"></a><span id="l1.40">     this.updateMsgNotificationBar(kMsgNotificationPhishingBar, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -473,20 +473,22 @@ var messageHeaderSink = {</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">       // process message tags as if they were headers in the message</span>
<a href="#l2.6"></a><span id="l2.6">       SetTagHeader();</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8">       if ((&quot;from&quot; in currentHeaderData) &amp;&amp; (&quot;sender&quot; in currentHeaderData))</span>
<a href="#l2.9"></a><span id="l2.9">       {</span>
<a href="#l2.10"></a><span id="l2.10">         var msgHeaderParser = Components.classes[&quot;@mozilla.org/messenger/headerparser;1&quot;]</span>
<a href="#l2.11"></a><span id="l2.11">                                         .getService(Components.interfaces.nsIMsgHeaderParser);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        var senderMailbox = kMailboxSeparator + msgHeaderParser.extractHeaderAddressMailboxes(null,</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-                            currentHeaderData.sender.headerValue) + kMailboxSeparator;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-        var fromMailboxes = kMailboxSeparator + msgHeaderParser.extractHeaderAddressMailboxes(null,</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-                            currentHeaderData.from.headerValue) + kMailboxSeparator;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+        var senderMailbox = kMailboxSeparator +</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+          msgHeaderParser.extractHeaderAddressMailboxes(</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+            currentHeaderData.sender.headerValue) + kMailboxSeparator;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+        var fromMailboxes = kMailboxSeparator +</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+          msgHeaderParser.extractHeaderAddressMailboxes(</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+            currentHeaderData.from.headerValue) + kMailboxSeparator;</span>
<a href="#l2.22"></a><span id="l2.22">         if (fromMailboxes.indexOf(senderMailbox) &gt;= 0)</span>
<a href="#l2.23"></a><span id="l2.23">           delete currentHeaderData.sender;</span>
<a href="#l2.24"></a><span id="l2.24">       }</span>
<a href="#l2.25"></a><span id="l2.25"> </span>
<a href="#l2.26"></a><span id="l2.26">       this.onEndHeaders();</span>
<a href="#l2.27"></a><span id="l2.27">     },</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29">     handleAttachment: function(contentType, url, displayName, uri, isExternalAttachment)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbAddressCollecter.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbAddressCollecter.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -93,17 +93,17 @@ nsAbAddressCollecter::CollectAddress(con</span>
<a href="#l3.4"></a><span id="l3.4">   PRUint32 numAddresses;</span>
<a href="#l3.5"></a><span id="l3.5">   char *names;</span>
<a href="#l3.6"></a><span id="l3.6">   char *addresses;</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">   nsresult rv;</span>
<a href="#l3.9"></a><span id="l3.9">   nsCOMPtr&lt;nsIMsgHeaderParser&gt; pHeader = do_GetService(NS_MAILNEWS_MIME_HEADER_PARSER_CONTRACTID, &amp;rv);</span>
<a href="#l3.10"></a><span id="l3.10">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  rv = pHeader-&gt;ParseHeaderAddresses(nsnull, PromiseFlatCString(aAddresses).get(),</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  rv = pHeader-&gt;ParseHeaderAddresses(PromiseFlatCString(aAddresses).get(),</span>
<a href="#l3.14"></a><span id="l3.14">                                      &amp;names, &amp;addresses, &amp;numAddresses);</span>
<a href="#l3.15"></a><span id="l3.15">   NS_ASSERTION(NS_SUCCEEDED(rv), &quot;failed to parse, so can't collect&quot;);</span>
<a href="#l3.16"></a><span id="l3.16">   if (NS_FAILED(rv))</span>
<a href="#l3.17"></a><span id="l3.17">     return NS_OK;</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">   char *curNamePtr = names;</span>
<a href="#l3.20"></a><span id="l3.20">   char *curAddressPtr = addresses;</span>
<a href="#l3.21"></a><span id="l3.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/resources/content/junkCommands.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/resources/content/junkCommands.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -198,17 +198,17 @@ MessageClassifier.prototype =</span>
<a href="#l4.4"></a><span id="l4.4">     if (junkscoreorigin == &quot;user&quot;) // don't override user-set junk status</span>
<a href="#l4.5"></a><span id="l4.5">       return;</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7">     // if a whitelist addressbook was specified, check if the email address is in it</span>
<a href="#l4.8"></a><span id="l4.8">     if (aWhiteListDirectories.length)</span>
<a href="#l4.9"></a><span id="l4.9">     {</span>
<a href="#l4.10"></a><span id="l4.10">       var headerParser = Components.classes[&quot;@mozilla.org/messenger/headerparser;1&quot;]</span>
<a href="#l4.11"></a><span id="l4.11">                                    .getService(Components.interfaces.nsIMsgHeaderParser);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      var authorEmailAddress = headerParser.extractHeaderAddressMailboxes(null, aMsgHdr.author);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+      var authorEmailAddress = headerParser.extractHeaderAddressMailboxes(aMsgHdr.author);</span>
<a href="#l4.14"></a><span id="l4.14">       var abCard = false;</span>
<a href="#l4.15"></a><span id="l4.15">       for (var abCount = 0; abCount &lt; aWhiteListDirectories.length; abCount++)</span>
<a href="#l4.16"></a><span id="l4.16">       {</span>
<a href="#l4.17"></a><span id="l4.17">         try {</span>
<a href="#l4.18"></a><span id="l4.18">           if (aWhiteListDirectories[abCount].cardForEmailAddress(authorEmailAddress))</span>
<a href="#l4.19"></a><span id="l4.19">           {</span>
<a href="#l4.20"></a><span id="l4.20">             // message is ham from whitelist</span>
<a href="#l4.21"></a><span id="l4.21">             var db = aMsgHdr.folder.getMsgDatabase(msgWindow);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/resources/content/mailWindowOverlay.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/resources/content/mailWindowOverlay.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1114,17 +1114,17 @@ function MsgEditMessageAsNew()</span>
<a href="#l5.4"></a><span id="l5.4">     ComposeMessage(msgComposeType.Template, msgComposeFormat.Default, loadedFolder, messageArray);</span>
<a href="#l5.5"></a><span id="l5.5"> }</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> function MsgCreateFilter()</span>
<a href="#l5.8"></a><span id="l5.8"> {</span>
<a href="#l5.9"></a><span id="l5.9">   // retrieve Sender direct from selected message's headers</span>
<a href="#l5.10"></a><span id="l5.10">   var msgHdr = gDBView.hdrForFirstSelectedMessage;</span>
<a href="#l5.11"></a><span id="l5.11">   var headerParser = Components.classes[&quot;@mozilla.org/messenger/headerparser;1&quot;].getService(Components.interfaces.nsIMsgHeaderParser);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  var emailAddress = headerParser.extractHeaderAddressMailboxes(null, msgHdr.author);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  var emailAddress = headerParser.extractHeaderAddressMailboxes(msgHdr.author);</span>
<a href="#l5.14"></a><span id="l5.14">   var accountKey = msgHdr.accountKey;</span>
<a href="#l5.15"></a><span id="l5.15">   var folder;</span>
<a href="#l5.16"></a><span id="l5.16">   if (accountKey.length &gt; 0)</span>
<a href="#l5.17"></a><span id="l5.17">   {</span>
<a href="#l5.18"></a><span id="l5.18">     var account = accountManager.getAccount(accountKey);</span>
<a href="#l5.19"></a><span id="l5.19">     if (account)</span>
<a href="#l5.20"></a><span id="l5.20">     {</span>
<a href="#l5.21"></a><span id="l5.21">       server = account.incomingServer;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -2239,17 +2239,17 @@ var gMessageNotificationBar =</span>
<a href="#l5.23"></a><span id="l5.23">     goUpdateCommand('button_junk');</span>
<a href="#l5.24"></a><span id="l5.24">   },</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26">   setRemoteContentMsg: function(aMsgHdr)</span>
<a href="#l5.27"></a><span id="l5.27">   {  </span>
<a href="#l5.28"></a><span id="l5.28">     // update the allow remote content for sender string</span>
<a href="#l5.29"></a><span id="l5.29">     var headerParser = Components.classes[&quot;@mozilla.org/messenger/headerparser;1&quot;]</span>
<a href="#l5.30"></a><span id="l5.30">                                  .getService(Components.interfaces.nsIMsgHeaderParser);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-    var emailAddress = headerParser.extractHeaderAddressMailboxes(null, aMsgHdr.author);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+    var emailAddress = headerParser.extractHeaderAddressMailboxes(aMsgHdr.author);</span>
<a href="#l5.33"></a><span id="l5.33">     document.getElementById('allowRemoteContentForAuthorDesc').textContent =</span>
<a href="#l5.34"></a><span id="l5.34">       gMessengerBundle.getFormattedString('alwaysLoadRemoteContentForSender', [emailAddress ? emailAddress : aMsgHdr.author]);</span>
<a href="#l5.35"></a><span id="l5.35">     this.updateMsgNotificationBar(kMsgNotificationRemoteImages, true);</span>
<a href="#l5.36"></a><span id="l5.36">   },</span>
<a href="#l5.37"></a><span id="l5.37"> </span>
<a href="#l5.38"></a><span id="l5.38">   // aUrl is the nsIURI for the message currently loaded in the message pane</span>
<a href="#l5.39"></a><span id="l5.39">   setPhishingMsg: function(aUrl)</span>
<a href="#l5.40"></a><span id="l5.40">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/resources/content/msgHdrViewOverlay.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/resources/content/msgHdrViewOverlay.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -442,20 +442,22 @@ var messageHeaderSink = {</span>
<a href="#l6.4"></a><span id="l6.4">         } // if lowerCaseHeaderName == &quot;from&quot;</span>
<a href="#l6.5"></a><span id="l6.5">       } // while we have more headers to parse</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">       // process message tags as if they were headers in the message</span>
<a href="#l6.8"></a><span id="l6.8">       SetTagHeader();      </span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10">       if ((&quot;from&quot; in currentHeaderData) &amp;&amp; (&quot;sender&quot; in currentHeaderData) &amp;&amp; msgHeaderParser)</span>
<a href="#l6.11"></a><span id="l6.11">       {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        var senderMailbox = kMailboxSeparator + msgHeaderParser.extractHeaderAddressMailboxes(null,</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                            currentHeaderData.sender.headerValue) + kMailboxSeparator;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-        var fromMailboxes = kMailboxSeparator + msgHeaderParser.extractHeaderAddressMailboxes(null,</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-                            currentHeaderData.from.headerValue) + kMailboxSeparator;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+        var senderMailbox = kMailboxSeparator +</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+          msgHeaderParser.extractHeaderAddressMailboxes(</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+            currentHeaderData.sender.headerValue) + kMailboxSeparator;</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+        var fromMailboxes = kMailboxSeparator +</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+          msgHeaderParser.extractHeaderAddressMailboxes(</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+            currentHeaderData.from.headerValue) + kMailboxSeparator;</span>
<a href="#l6.22"></a><span id="l6.22">         if (fromMailboxes.indexOf(senderMailbox) &gt;= 0)</span>
<a href="#l6.23"></a><span id="l6.23">           delete currentHeaderData.sender;</span>
<a href="#l6.24"></a><span id="l6.24">       }</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26">       this.onEndHeaders();</span>
<a href="#l6.27"></a><span id="l6.27">     },</span>
<a href="#l6.28"></a><span id="l6.28"> </span>
<a href="#l6.29"></a><span id="l6.29">     handleAttachment: function(contentType, url, displayName, uri, isExternalAttachment) </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1086,17 +1086,20 @@ NS_IMETHODIMP nsMsgSearchTerm::GetMatchA</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5">    // Change the sense of the loop so we don't bail out prematurely</span>
<a href="#l7.6"></a><span id="l7.6">    // on negative terms. i.e. opDoesntContain must look at all recipients</span>
<a href="#l7.7"></a><span id="l7.7">    PRBool boolContinueLoop;</span>
<a href="#l7.8"></a><span id="l7.8">    GetMatchAllBeforeDeciding(&amp;boolContinueLoop);</span>
<a href="#l7.9"></a><span id="l7.9">    result = boolContinueLoop;</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">    PRUint32 count;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-   nsresult parseErr = m_headerAddressParser-&gt;ParseHeaderAddresses(charset, string, &amp;names, &amp;addresses, &amp;count) ;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+   nsresult parseErr = m_headerAddressParser-&gt;ParseHeaderAddresses(string,</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+                                                                   &amp;names,</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+                                                                   &amp;addresses,</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+                                                                   &amp;count);</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18">    if (NS_SUCCEEDED(parseErr) &amp;&amp; count &gt; 0)</span>
<a href="#l7.19"></a><span id="l7.19">    {</span>
<a href="#l7.20"></a><span id="l7.20">      NS_ASSERTION(names, &quot;couldn't get names&quot;);</span>
<a href="#l7.21"></a><span id="l7.21">      NS_ASSERTION(addresses, &quot;couldn't get addresses&quot;);</span>
<a href="#l7.22"></a><span id="l7.22">      if (!names || !addresses)</span>
<a href="#l7.23"></a><span id="l7.23">        return err;</span>
<a href="#l7.24"></a><span id="l7.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -143,17 +143,18 @@ nsresult nsMsgContentPolicy::AllowRemote</span>
<a href="#l8.4"></a><span id="l8.4">   nsCString author;</span>
<a href="#l8.5"></a><span id="l8.5">   rv = aMsgHdr-&gt;GetAuthor(getter_Copies(author));</span>
<a href="#l8.6"></a><span id="l8.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">   nsCOMPtr&lt;nsIMsgHeaderParser&gt; headerParser = do_GetService(&quot;@mozilla.org/messenger/headerparser;1&quot;, &amp;rv);</span>
<a href="#l8.9"></a><span id="l8.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">   nsCString emailAddress; </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  rv = headerParser-&gt;ExtractHeaderAddressMailboxes(nsnull, author.get(), getter_Copies(emailAddress));</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  rv = headerParser-&gt;ExtractHeaderAddressMailboxes(author.get(),</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+                                                   getter_Copies(emailAddress));</span>
<a href="#l8.15"></a><span id="l8.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">   nsCOMPtr&lt;nsIAbManager&gt; abManager = do_GetService(&quot;@mozilla.org/abmanager;1&quot;,</span>
<a href="#l8.18"></a><span id="l8.18">                                                    &amp;rv);</span>
<a href="#l8.19"></a><span id="l8.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">   nsCOMPtr&lt;nsISimpleEnumerator&gt; enumerator;</span>
<a href="#l8.22"></a><span id="l8.22">   rv = abManager-&gt;GetDirectories(getter_AddRefs(enumerator));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -380,17 +380,17 @@ nsresult nsMsgDBView::FetchAuthor(nsIMsg</span>
<a href="#l9.4"></a><span id="l9.4">   nsresult rv = aHdr-&gt;GetMime2DecodedAuthor(unparsedAuthor);</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6">   // *sigh* how sad, we need to convert our beautiful unicode string to utf8</span>
<a href="#l9.7"></a><span id="l9.7">   // so we can extract the name part of the address...then convert it back to</span>
<a href="#l9.8"></a><span id="l9.8">   // unicode again.</span>
<a href="#l9.9"></a><span id="l9.9">   if (mHeaderParser)</span>
<a href="#l9.10"></a><span id="l9.10">   {</span>
<a href="#l9.11"></a><span id="l9.11">     nsCString name;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    rv = mHeaderParser-&gt;ExtractHeaderAddressName(&quot;UTF-8&quot;, NS_ConvertUTF16toUTF8(unparsedAuthor).get(), getter_Copies(name));</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    rv = mHeaderParser-&gt;ExtractHeaderAddressName(NS_ConvertUTF16toUTF8(unparsedAuthor).get(), getter_Copies(name));</span>
<a href="#l9.14"></a><span id="l9.14">     if (NS_SUCCEEDED(rv) &amp;&amp; !name.IsEmpty())</span>
<a href="#l9.15"></a><span id="l9.15">     {</span>
<a href="#l9.16"></a><span id="l9.16">       CopyUTF8toUTF16(name, aSenderString);</span>
<a href="#l9.17"></a><span id="l9.17">       return NS_OK;</span>
<a href="#l9.18"></a><span id="l9.18">     }</span>
<a href="#l9.19"></a><span id="l9.19">   }</span>
<a href="#l9.20"></a><span id="l9.20">   // if we got here then just return the original string</span>
<a href="#l9.21"></a><span id="l9.21">   aSenderString = unparsedAuthor;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -430,17 +430,17 @@ nsresult nsMsgDBView::FetchRecipients(ns</span>
<a href="#l9.23"></a><span id="l9.23">   nsresult rv = aHdr-&gt;GetMime2DecodedRecipients(unparsedRecipients);</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25">   // *sigh* how sad, we need to convert our beautiful unicode string to utf8</span>
<a href="#l9.26"></a><span id="l9.26">   // so we can extract the name part of the address...then convert it back to</span>
<a href="#l9.27"></a><span id="l9.27">   // unicode again.</span>
<a href="#l9.28"></a><span id="l9.28">   if (mHeaderParser)</span>
<a href="#l9.29"></a><span id="l9.29">   {</span>
<a href="#l9.30"></a><span id="l9.30">     nsCString names;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-    rv = mHeaderParser-&gt;ExtractHeaderAddressNames(&quot;UTF-8&quot;, NS_ConvertUTF16toUTF8(unparsedRecipients).get(), getter_Copies(names));</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+    rv = mHeaderParser-&gt;ExtractHeaderAddressNames(NS_ConvertUTF16toUTF8(unparsedRecipients).get(), getter_Copies(names));</span>
<a href="#l9.33"></a><span id="l9.33">     if (NS_SUCCEEDED(rv) &amp;&amp; !names.IsEmpty())</span>
<a href="#l9.34"></a><span id="l9.34">     {</span>
<a href="#l9.35"></a><span id="l9.35">       CopyUTF8toUTF16(names, aRecipientsString);</span>
<a href="#l9.36"></a><span id="l9.36">       return NS_OK;</span>
<a href="#l9.37"></a><span id="l9.37">     }</span>
<a href="#l9.38"></a><span id="l9.38">   }</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40">   aRecipientsString = unparsedRecipients;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1908,17 +1908,18 @@ nsMsgDBFolder::CallFilterPlugins(nsIMsgW</span>
<a href="#l10.4"></a><span id="l10.4">     rv = mDatabase-&gt;GetMsgHdrForKey(msgKey, getter_AddRefs(msgHdr));</span>
<a href="#l10.5"></a><span id="l10.5">     if (!NS_SUCCEEDED(rv))</span>
<a href="#l10.6"></a><span id="l10.6">       continue;</span>
<a href="#l10.7"></a><span id="l10.7">     nsCString author;</span>
<a href="#l10.8"></a><span id="l10.8">     nsCString authorEmailAddress;</span>
<a href="#l10.9"></a><span id="l10.9">     if (whiteListDirArray.Count() != 0 || !trustedMailDomains.IsEmpty())</span>
<a href="#l10.10"></a><span id="l10.10">     {</span>
<a href="#l10.11"></a><span id="l10.11">       msgHdr-&gt;GetAuthor(getter_Copies(author));</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-      rv = headerParser-&gt;ExtractHeaderAddressMailboxes(nsnull, author.get(), getter_Copies(authorEmailAddress));</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+      rv = headerParser-&gt;ExtractHeaderAddressMailboxes(author.get(),</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+                                                       getter_Copies(authorEmailAddress));</span>
<a href="#l10.15"></a><span id="l10.15">     }</span>
<a href="#l10.16"></a><span id="l10.16"> </span>
<a href="#l10.17"></a><span id="l10.17">     if (!trustedMailDomains.IsEmpty())</span>
<a href="#l10.18"></a><span id="l10.18">     {</span>
<a href="#l10.19"></a><span id="l10.19">       nsCAutoString domain;</span>
<a href="#l10.20"></a><span id="l10.20">       PRInt32 atPos = authorEmailAddress.FindChar('@');</span>
<a href="#l10.21"></a><span id="l10.21">       if (atPos &gt;= 0)</span>
<a href="#l10.22"></a><span id="l10.22">         domain = Substring(authorEmailAddress, atPos + 1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompFields.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompFields.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -554,17 +554,17 @@ NS_IMETHODIMP nsMsgCompFields::SplitReci</span>
<a href="#l11.4"></a><span id="l11.4">     {</span>
<a href="#l11.5"></a><span id="l11.5">       nsCAutoString recipientsStr;</span>
<a href="#l11.6"></a><span id="l11.6">       char * names;</span>
<a href="#l11.7"></a><span id="l11.7">       char * addresses;</span>
<a href="#l11.8"></a><span id="l11.8">       PRUint32 numAddresses;</span>
<a href="#l11.9"></a><span id="l11.9">       </span>
<a href="#l11.10"></a><span id="l11.10">       CopyUTF16toUTF8(aRecipients, recipientsStr);</span>
<a href="#l11.11"></a><span id="l11.11">       </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-      rv= parser-&gt;ParseHeaderAddresses(&quot;UTF-8&quot;, recipientsStr.get(), &amp;names, </span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+      rv= parser-&gt;ParseHeaderAddresses(recipientsStr.get(), &amp;names, </span>
<a href="#l11.14"></a><span id="l11.14">                                        &amp;addresses, &amp;numAddresses);</span>
<a href="#l11.15"></a><span id="l11.15">       if (NS_SUCCEEDED(rv))</span>
<a href="#l11.16"></a><span id="l11.16">       {</span>
<a href="#l11.17"></a><span id="l11.17">         PRUint32 i=0;</span>
<a href="#l11.18"></a><span id="l11.18">         char * pNames = names;</span>
<a href="#l11.19"></a><span id="l11.19">         char * pAddresses = addresses;</span>
<a href="#l11.20"></a><span id="l11.20">         PRBool aBool;</span>
<a href="#l11.21"></a><span id="l11.21">         </span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -615,17 +615,17 @@ nsresult nsMsgCompFields::SplitRecipient</span>
<a href="#l11.23"></a><span id="l11.23">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.24"></a><span id="l11.24"> </span>
<a href="#l11.25"></a><span id="l11.25">   nsCAutoString recipientsStr;</span>
<a href="#l11.26"></a><span id="l11.26">   char *names;</span>
<a href="#l11.27"></a><span id="l11.27">   char *addresses;</span>
<a href="#l11.28"></a><span id="l11.28">   PRUint32 numAddresses;</span>
<a href="#l11.29"></a><span id="l11.29">       </span>
<a href="#l11.30"></a><span id="l11.30">   CopyUTF16toUTF8(recipients, recipientsStr);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-  rv = parser-&gt;ParseHeaderAddresses(&quot;UTF-8&quot;, recipientsStr.get(), &amp;names,</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+  rv = parser-&gt;ParseHeaderAddresses(recipientsStr.get(), &amp;names,</span>
<a href="#l11.33"></a><span id="l11.33">                                     &amp;addresses, &amp;numAddresses);</span>
<a href="#l11.34"></a><span id="l11.34">   if (NS_SUCCEEDED(rv))</span>
<a href="#l11.35"></a><span id="l11.35">   {</span>
<a href="#l11.36"></a><span id="l11.36">     char *pNames = names;</span>
<a href="#l11.37"></a><span id="l11.37">     char *pAddresses = addresses;</span>
<a href="#l11.38"></a><span id="l11.38"> </span>
<a href="#l11.39"></a><span id="l11.39">     for (PRUint32 i = 0; i &lt; numAddresses; ++i)</span>
<a href="#l11.40"></a><span id="l11.40">     {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1399,17 +1399,17 @@ mime_fix_header_1 (const char *string, P</span>
<a href="#l12.4"></a><span id="l12.4">   if (!string || !*string)</span>
<a href="#l12.5"></a><span id="l12.5">     return 0;</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7">   if (addr_p) {</span>
<a href="#l12.8"></a><span id="l12.8">     nsresult rv = NS_OK;</span>
<a href="#l12.9"></a><span id="l12.9">     nsCOMPtr&lt;nsIMsgHeaderParser&gt; pHeader = do_GetService(NS_MAILNEWS_MIME_HEADER_PARSER_CONTRACTID, &amp;rv);</span>
<a href="#l12.10"></a><span id="l12.10">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l12.11"></a><span id="l12.11">       char *n;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-      pHeader-&gt;ReformatHeaderAddresses(nsnull, string, &amp;n);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+      pHeader-&gt;ReformatHeaderAddresses(string, &amp;n);</span>
<a href="#l12.14"></a><span id="l12.14">       if (n)        return n;</span>
<a href="#l12.15"></a><span id="l12.15">     }</span>
<a href="#l12.16"></a><span id="l12.16">   }</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18">   old_size = PL_strlen (string);</span>
<a href="#l12.19"></a><span id="l12.19">   new_size = old_size;</span>
<a href="#l12.20"></a><span id="l12.20">   for (i = 0; i &lt; old_size; i++)</span>
<a href="#l12.21"></a><span id="l12.21">     if (string[i] == '\r' || string[i] == '\n')</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -141,17 +141,18 @@ static void GetReplyHeaderInfo(PRInt32* </span>
<a href="#l13.4"></a><span id="l13.4"> }</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> static nsresult RemoveDuplicateAddresses(const char * addresses, const char * anothersAddresses, PRBool removeAliasesToMe, char** newAddress)</span>
<a href="#l13.7"></a><span id="l13.7"> {</span>
<a href="#l13.8"></a><span id="l13.8">   nsresult rv;</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10">   nsCOMPtr&lt;nsIMsgHeaderParser&gt; parser (do_GetService(NS_MAILNEWS_MIME_HEADER_PARSER_CONTRACTID));</span>
<a href="#l13.11"></a><span id="l13.11">   if (parser)</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    rv= parser-&gt;RemoveDuplicateAddresses(&quot;UTF-8&quot;, addresses, anothersAddresses, removeAliasesToMe, newAddress);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    rv = parser-&gt;RemoveDuplicateAddresses(addresses, anothersAddresses,</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+                                          removeAliasesToMe, newAddress);</span>
<a href="#l13.15"></a><span id="l13.15">   else</span>
<a href="#l13.16"></a><span id="l13.16">     rv = NS_ERROR_FAILURE;</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18">   return rv;</span>
<a href="#l13.19"></a><span id="l13.19"> }</span>
<a href="#l13.20"></a><span id="l13.20"> </span>
<a href="#l13.21"></a><span id="l13.21"> static void TranslateLineEnding(nsString&amp; data)</span>
<a href="#l13.22"></a><span id="l13.22"> {</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineat">@@ -1871,25 +1872,25 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l13.24"></a><span id="l13.24">             msgHdr-&gt;GetRecipients(getter_Copies(recipients));</span>
<a href="#l13.25"></a><span id="l13.25"> </span>
<a href="#l13.26"></a><span id="l13.26">             nsCString ccList, ccListEmailAddresses;</span>
<a href="#l13.27"></a><span id="l13.27">             msgHdr-&gt;GetCcList(getter_Copies(ccList));</span>
<a href="#l13.28"></a><span id="l13.28"> </span>
<a href="#l13.29"></a><span id="l13.29">             nsCOMPtr&lt;nsIMsgHeaderParser&gt; parser (do_GetService(NS_MAILNEWS_MIME_HEADER_PARSER_CONTRACTID));</span>
<a href="#l13.30"></a><span id="l13.30">             if (parser) {</span>
<a href="#l13.31"></a><span id="l13.31">               // convert to UTF8 before passing to MakeFullAddress</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-              rv = parser-&gt;ExtractHeaderAddressMailboxes(nsnull, author.get(),</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+              rv = parser-&gt;ExtractHeaderAddressMailboxes(author.get(),</span>
<a href="#l13.34"></a><span id="l13.34">                                                          getter_Copies(authorEmailAddress));</span>
<a href="#l13.35"></a><span id="l13.35">               NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l13.36"></a><span id="l13.36"> </span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-              rv = parser-&gt;ExtractHeaderAddressMailboxes(nsnull, recipients.get(),</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+              rv = parser-&gt;ExtractHeaderAddressMailboxes(recipients.get(),</span>
<a href="#l13.39"></a><span id="l13.39">                                                          getter_Copies(recipientsEmailAddresses));</span>
<a href="#l13.40"></a><span id="l13.40">               NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l13.41"></a><span id="l13.41"> </span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-              rv = parser-&gt;ExtractHeaderAddressMailboxes(nsnull, ccList.get(),</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+              rv = parser-&gt;ExtractHeaderAddressMailboxes(ccList.get(),</span>
<a href="#l13.44"></a><span id="l13.44">                                                          getter_Copies(ccListEmailAddresses));</span>
<a href="#l13.45"></a><span id="l13.45">               NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l13.46"></a><span id="l13.46">             }</span>
<a href="#l13.47"></a><span id="l13.47"> </span>
<a href="#l13.48"></a><span id="l13.48">             PRBool replyToSelfCheckAll = PR_FALSE;</span>
<a href="#l13.49"></a><span id="l13.49">             nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l13.50"></a><span id="l13.50">             if (NS_SUCCEEDED(rv))</span>
<a href="#l13.51"></a><span id="l13.51">               prefBranch-&gt;GetBoolPref(&quot;mailnews.reply_to_self_check_all_ident&quot;, &amp;replyToSelfCheckAll);</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineat">@@ -2277,17 +2278,17 @@ QuotingOutputStreamListener::QuotingOutp</span>
<a href="#l13.53"></a><span id="l13.53">           mMimeConverter-&gt;DecodeMimeHeaderToCharPtr(author.get(), charset,</span>
<a href="#l13.54"></a><span id="l13.54">             charetOverride, PR_TRUE, getter_Copies(decodedCString));</span>
<a href="#l13.55"></a><span id="l13.55"> </span>
<a href="#l13.56"></a><span id="l13.56">         nsCOMPtr&lt;nsIMsgHeaderParser&gt; parser (do_GetService(NS_MAILNEWS_MIME_HEADER_PARSER_CONTRACTID));</span>
<a href="#l13.57"></a><span id="l13.57"> </span>
<a href="#l13.58"></a><span id="l13.58">         if (parser)</span>
<a href="#l13.59"></a><span id="l13.59">         {</span>
<a href="#l13.60"></a><span id="l13.60">           nsCString authorName;</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-          rv = parser-&gt;ExtractHeaderAddressName(&quot;UTF-8&quot;, !decodedCString.IsEmpty() ? decodedCString.get() : author.get(),</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+          rv = parser-&gt;ExtractHeaderAddressName(!decodedCString.IsEmpty() ? decodedCString.get() : author.get(),</span>
<a href="#l13.63"></a><span id="l13.63">                                                 getter_Copies(authorName));</span>
<a href="#l13.64"></a><span id="l13.64">           // take care &quot;%s wrote&quot;</span>
<a href="#l13.65"></a><span id="l13.65">           PRUnichar *formatedString = nsnull;</span>
<a href="#l13.66"></a><span id="l13.66">           if (NS_SUCCEEDED(rv) &amp;&amp; !authorName.IsEmpty())</span>
<a href="#l13.67"></a><span id="l13.67">             formatedString = nsTextFormatter::smprintf(replyHeaderAuthorwrote.get(), authorName.get());</span>
<a href="#l13.68"></a><span id="l13.68">           else</span>
<a href="#l13.69"></a><span id="l13.69">             formatedString = nsTextFormatter::smprintf(replyHeaderAuthorwrote.get(), author.get());</span>
<a href="#l13.70"></a><span id="l13.70">           if (formatedString)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1642,26 +1642,28 @@ nsresult nsSmtpProtocol::LoadUrl(nsIURI </span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5"> 			nsCString addresses;</span>
<a href="#l14.6"></a><span id="l14.6"> 			nsCOMPtr&lt;nsIMsgHeaderParser&gt; parser = do_GetService(NS_MAILNEWS_MIME_HEADER_PARSER_CONTRACTID);</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> 			m_runningURL-&gt;GetRecipients(getter_Copies(addresses));</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10"> 			if (NS_SUCCEEDED(rv) &amp;&amp; parser)</span>
<a href="#l14.11"></a><span id="l14.11"> 			{</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-				parser-&gt;RemoveDuplicateAddresses(nsnull, addresses.get(), nsnull, PR_FALSE, &amp;addrs1);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+                parser-&gt;RemoveDuplicateAddresses(addresses.get(), nsnull,</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+                                                 PR_FALSE, &amp;addrs1);</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> 				/* Extract just the mailboxes from the full RFC822 address list.</span>
<a href="#l14.17"></a><span id="l14.17"> 				   This means that people can post to mailto: URLs which contain</span>
<a href="#l14.18"></a><span id="l14.18"> 				   full RFC822 address specs, and we will still send the right</span>
<a href="#l14.19"></a><span id="l14.19"> 				   thing in the SMTP RCPT command.</span>
<a href="#l14.20"></a><span id="l14.20"> 				*/</span>
<a href="#l14.21"></a><span id="l14.21"> 				if (addrs1 &amp;&amp; *addrs1)</span>
<a href="#l14.22"></a><span id="l14.22"> 				{</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-					rv = parser-&gt;ParseHeaderAddresses(nsnull, addrs1, nsnull, &amp;addrs2, &amp;m_addressesLeft);</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+                    rv = parser-&gt;ParseHeaderAddresses(addrs1, nsnull, &amp;addrs2,</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+                                                      &amp;m_addressesLeft);</span>
<a href="#l14.26"></a><span id="l14.26"> 					PR_FREEIF (addrs1);</span>
<a href="#l14.27"></a><span id="l14.27"> 				}</span>
<a href="#l14.28"></a><span id="l14.28"> </span>
<a href="#l14.29"></a><span id="l14.29"> 				if (m_addressesLeft == 0 || addrs2 == nsnull || CHECK_SIMULATED_ERROR(SIMULATED_SEND_ERROR_8)) // hmm no addresses to send message to...</span>
<a href="#l14.30"></a><span id="l14.30"> 				{</span>
<a href="#l14.31"></a><span id="l14.31"> 					m_nextState = SMTP_ERROR_DONE;</span>
<a href="#l14.32"></a><span id="l14.32"> 					ClearFlag(SMTP_PAUSE_FOR_READ);</span>
<a href="#l14.33"></a><span id="l14.33"> 					status = NS_MSG_NO_RECIPIENTS;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -3173,19 +3173,21 @@ nsresult nsMsgDatabase::RowCellColumnToA</span>
<a href="#l15.4"></a><span id="l15.4">             characterSetOverride)</span>
<a href="#l15.5"></a><span id="l15.5">         {</span>
<a href="#l15.6"></a><span id="l15.6">           m_dbFolderInfo-&gt;GetEffectiveCharacterSet(charset);</span>
<a href="#l15.7"></a><span id="l15.7">         }</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9">         ret = converter-&gt;DecodeMimeHeaderToCharPtr(cSender, charset.get(),</span>
<a href="#l15.10"></a><span id="l15.10">           characterSetOverride, PR_TRUE, getter_Copies(resultStr));</span>
<a href="#l15.11"></a><span id="l15.11">         if (NS_SUCCEEDED(ret) &amp;&amp; !resultStr.IsEmpty())</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-          ret = headerParser-&gt;ExtractHeaderAddressName (&quot;UTF-8&quot;, resultStr.get(), getter_Copies(name));</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+          ret = headerParser-&gt;ExtractHeaderAddressName(resultStr.get(),</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+                                                       getter_Copies(name));</span>
<a href="#l15.15"></a><span id="l15.15">         else</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-          ret = headerParser-&gt;ExtractHeaderAddressName (&quot;UTF-8&quot;, cSender, getter_Copies(name));</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+          ret = headerParser-&gt;ExtractHeaderAddressName(cSender,</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+                                                       getter_Copies(name));</span>
<a href="#l15.19"></a><span id="l15.19">       }</span>
<a href="#l15.20"></a><span id="l15.20">     }</span>
<a href="#l15.21"></a><span id="l15.21">   }</span>
<a href="#l15.22"></a><span id="l15.22">   if (NS_SUCCEEDED(ret))</span>
<a href="#l15.23"></a><span id="l15.23">     ret = CreateCollationKey(NS_ConvertUTF8toUTF16(name), result, len);</span>
<a href="#l15.24"></a><span id="l15.24">   return ret;</span>
<a href="#l15.25"></a><span id="l15.25"> }</span>
<a href="#l15.26"></a><span id="l15.26"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -899,25 +899,25 @@ nsresult nsMsgComposeSecure::MimeCryptoH</span>
<a href="#l16.4"></a><span id="l16.4">   }</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6">   if ((mSelfEncryptionCert == nsnull) &amp;&amp; aEncrypt) {</span>
<a href="#l16.7"></a><span id="l16.7">     SetError(sendReport, NS_LITERAL_STRING(&quot;NoSenderEncryptionCert&quot;).get());</span>
<a href="#l16.8"></a><span id="l16.8">     res = NS_ERROR_FAILURE;</span>
<a href="#l16.9"></a><span id="l16.9">     goto FAIL;</span>
<a href="#l16.10"></a><span id="l16.10">   }</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  pHeader-&gt;ExtractHeaderAddressMailboxes(nsnull,aRecipients, &amp;all_mailboxes);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-  pHeader-&gt;RemoveDuplicateAddresses(nsnull, all_mailboxes, 0, PR_FALSE /*removeAliasesToMe*/, &amp;mailboxes);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+  pHeader-&gt;ExtractHeaderAddressMailboxes(aRecipients, &amp;all_mailboxes);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+  pHeader-&gt;RemoveDuplicateAddresses(all_mailboxes, 0, PR_FALSE, &amp;mailboxes);</span>
<a href="#l16.16"></a><span id="l16.16">   if (all_mailboxes) {</span>
<a href="#l16.17"></a><span id="l16.17">     nsMemory::Free(all_mailboxes);</span>
<a href="#l16.18"></a><span id="l16.18">     all_mailboxes = nsnull;</span>
<a href="#l16.19"></a><span id="l16.19">   }</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21">   if (mailboxes) {</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">-    pHeader-&gt;ParseHeaderAddresses (nsnull, mailboxes, 0, &amp;mailbox_list, &amp;count);</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+    pHeader-&gt;ParseHeaderAddresses(mailboxes, 0, &amp;mailbox_list, &amp;count);</span>
<a href="#l16.24"></a><span id="l16.24">     nsMemory::Free(mailboxes);</span>
<a href="#l16.25"></a><span id="l16.25">     mailboxes = nsnull;</span>
<a href="#l16.26"></a><span id="l16.26">   }</span>
<a href="#l16.27"></a><span id="l16.27">   if (count &lt; 0) return count;</span>
<a href="#l16.28"></a><span id="l16.28"> </span>
<a href="#l16.29"></a><span id="l16.29">   if (aEncrypt &amp;&amp; mSelfEncryptionCert) {</span>
<a href="#l16.30"></a><span id="l16.30">     // Make sure self's configured cert is prepared for being used</span>
<a href="#l16.31"></a><span id="l16.31">     // as an email recipient cert.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -1,8 +1,9 @@</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l17.5"></a><span id="l17.5"> /* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l17.6"></a><span id="l17.6">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l17.7"></a><span id="l17.7">  *</span>
<a href="#l17.8"></a><span id="l17.8">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l17.9"></a><span id="l17.9">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l17.10"></a><span id="l17.10">  * the License. You may obtain a copy of the License at</span>
<a href="#l17.11"></a><span id="l17.11">  * http://www.mozilla.org/MPL/</span>
<a href="#l17.12"></a><span id="l17.12">  *</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineat">@@ -429,25 +430,27 @@ nsresult nsSMimeJSHelper::getMailboxList</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15">     if (!ng.IsEmpty())</span>
<a href="#l17.16"></a><span id="l17.16">       all_recipients.Append(NS_ConvertUTF16toUTF8(ng));</span>
<a href="#l17.17"></a><span id="l17.17"> </span>
<a href="#l17.18"></a><span id="l17.18">     char *unique_mailboxes = nsnull;</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20">     {</span>
<a href="#l17.21"></a><span id="l17.21">       char *all_mailboxes = nsnull;</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-      parser-&gt;ExtractHeaderAddressMailboxes(nsnull, all_recipients.get(), &amp;all_mailboxes);</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-      parser-&gt;RemoveDuplicateAddresses(nsnull, all_mailboxes, 0, PR_FALSE /*removeAliasesToMe*/, &amp;unique_mailboxes);</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+      parser-&gt;ExtractHeaderAddressMailboxes(all_recipients.get(), &amp;all_mailboxes);</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+      parser-&gt;RemoveDuplicateAddresses(all_mailboxes, 0, PR_FALSE,</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+                                       &amp;unique_mailboxes);</span>
<a href="#l17.27"></a><span id="l17.27">       if (all_mailboxes) {</span>
<a href="#l17.28"></a><span id="l17.28">         nsMemory::Free(all_mailboxes);</span>
<a href="#l17.29"></a><span id="l17.29">       }</span>
<a href="#l17.30"></a><span id="l17.30">     }</span>
<a href="#l17.31"></a><span id="l17.31">     if (unique_mailboxes)</span>
<a href="#l17.32"></a><span id="l17.32">     {</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineminus">-      parser-&gt;ParseHeaderAddresses(nsnull, unique_mailboxes, 0, mailbox_list, mailbox_count);</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+      parser-&gt;ParseHeaderAddresses(unique_mailboxes, 0, mailbox_list,</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+                                   mailbox_count);</span>
<a href="#l17.36"></a><span id="l17.36">     }</span>
<a href="#l17.37"></a><span id="l17.37">     if (unique_mailboxes) {</span>
<a href="#l17.38"></a><span id="l17.38">       nsMemory::Free(unique_mailboxes);</span>
<a href="#l17.39"></a><span id="l17.39">     }</span>
<a href="#l17.40"></a><span id="l17.40">   }</span>
<a href="#l17.41"></a><span id="l17.41"> </span>
<a href="#l17.42"></a><span id="l17.42">   return NS_OK;</span>
<a href="#l17.43"></a><span id="l17.43"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -1180,17 +1180,17 @@ nsresult nsParseMailMessageState::Intern</span>
<a href="#l18.4"></a><span id="l18.4">   if (!header || header-&gt;length == 0)</span>
<a href="#l18.5"></a><span id="l18.5">     return NS_OK;</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7">   NS_ASSERTION (header-&gt;length == (short) strlen (header-&gt;value), &quot;invalid message_header&quot;);</span>
<a href="#l18.8"></a><span id="l18.8">   NS_ASSERTION (ret_name != nsnull, &quot;null ret_name&quot;);</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">   if (m_HeaderAddressParser)</span>
<a href="#l18.11"></a><span id="l18.11">   {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    ret = m_HeaderAddressParser-&gt;ExtractHeaderAddressName (nsnull, header-&gt;value, &amp;s);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    ret = m_HeaderAddressParser-&gt;ExtractHeaderAddressName(header-&gt;value, &amp;s);</span>
<a href="#l18.14"></a><span id="l18.14">     if (! s)</span>
<a href="#l18.15"></a><span id="l18.15">       return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17">     *ret_name = s;</span>
<a href="#l18.18"></a><span id="l18.18">   }</span>
<a href="#l18.19"></a><span id="l18.19">   return ret;</span>
<a href="#l18.20"></a><span id="l18.20"> }</span>
<a href="#l18.21"></a><span id="l18.21"> </span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -1355,34 +1355,38 @@ int nsParseMailMessageState::FinalizeHea</span>
<a href="#l18.23"></a><span id="l18.23">       else if (recipient)</span>
<a href="#l18.24"></a><span id="l18.24">       {</span>
<a href="#l18.25"></a><span id="l18.25">         // note that we're now setting the whole recipient list,</span>
<a href="#l18.26"></a><span id="l18.26">         // not just the pretty name of the first recipient.</span>
<a href="#l18.27"></a><span id="l18.27">         PRUint32 numAddresses;</span>
<a href="#l18.28"></a><span id="l18.28">         char  *names;</span>
<a href="#l18.29"></a><span id="l18.29">         char  *addresses;</span>
<a href="#l18.30"></a><span id="l18.30"> </span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-        ret = m_HeaderAddressParser-&gt;ParseHeaderAddresses (nsnull, recipient-&gt;value, &amp;names, &amp;addresses, &amp;numAddresses);</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+        ret = m_HeaderAddressParser-&gt;ParseHeaderAddresses(recipient-&gt;value,</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+                                                          &amp;names, &amp;addresses,</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+                                                          &amp;numAddresses);</span>
<a href="#l18.35"></a><span id="l18.35">         if (ret == NS_OK)</span>
<a href="#l18.36"></a><span id="l18.36">         {</span>
<a href="#l18.37"></a><span id="l18.37">           m_newMsgHdr-&gt;SetRecipientsArray(names, addresses, numAddresses);</span>
<a href="#l18.38"></a><span id="l18.38">           PR_Free(addresses);</span>
<a href="#l18.39"></a><span id="l18.39">           PR_Free(names);</span>
<a href="#l18.40"></a><span id="l18.40">         }</span>
<a href="#l18.41"></a><span id="l18.41">         else {  // hmm, should we just use the original string?</span>
<a href="#l18.42"></a><span id="l18.42">           m_newMsgHdr-&gt;SetRecipients(recipient-&gt;value);</span>
<a href="#l18.43"></a><span id="l18.43">         }</span>
<a href="#l18.44"></a><span id="l18.44">       }</span>
<a href="#l18.45"></a><span id="l18.45">       if (ccList)</span>
<a href="#l18.46"></a><span id="l18.46">       {</span>
<a href="#l18.47"></a><span id="l18.47">         PRUint32 numAddresses;</span>
<a href="#l18.48"></a><span id="l18.48">         char  *names;</span>
<a href="#l18.49"></a><span id="l18.49">         char  *addresses;</span>
<a href="#l18.50"></a><span id="l18.50"> </span>
<a href="#l18.51"></a><span id="l18.51" class="difflineminus">-        ret = m_HeaderAddressParser-&gt;ParseHeaderAddresses (nsnull, ccList-&gt;value, &amp;names, &amp;addresses, &amp;numAddresses);</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineplus">+        ret = m_HeaderAddressParser-&gt;ParseHeaderAddresses(ccList-&gt;value,</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineplus">+                                                          &amp;names, &amp;addresses,</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineplus">+                                                          &amp;numAddresses);</span>
<a href="#l18.55"></a><span id="l18.55">         if (ret == NS_OK)</span>
<a href="#l18.56"></a><span id="l18.56">         {</span>
<a href="#l18.57"></a><span id="l18.57">           m_newMsgHdr-&gt;SetCCListArray(names, addresses, numAddresses);</span>
<a href="#l18.58"></a><span id="l18.58">           PR_Free(addresses);</span>
<a href="#l18.59"></a><span id="l18.59">           PR_Free(names);</span>
<a href="#l18.60"></a><span id="l18.60">         }</span>
<a href="#l18.61"></a><span id="l18.61">         else  // hmm, should we just use the original string?</span>
<a href="#l18.62"></a><span id="l18.62">           m_newMsgHdr-&gt;SetCcList(ccList-&gt;value);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/mime/public/nsIMsgHeaderParser.idl</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/mime/public/nsIMsgHeaderParser.idl</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -44,103 +44,111 @@ interface nsISimpleEnumerator;</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5"> #define NS_MAILNEWS_MIME_HEADER_PARSER_CONTRACTID \</span>
<a href="#l19.6"></a><span id="l19.6">   &quot;@mozilla.org/messenger/headerparser;1&quot;</span>
<a href="#l19.7"></a><span id="l19.7"> %}</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9"> /* </span>
<a href="#l19.10"></a><span id="l19.10">  * nsIMsgRFCParser Interface declaration </span>
<a href="#l19.11"></a><span id="l19.11">  */ </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-[scriptable, uuid(dda9b90c-4c05-464c-82d0-c5901f40d93c)]</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+[scriptable, uuid(a6f865a2-eb19-4072-bd44-6720e69adbc6)]</span>
<a href="#l19.14"></a><span id="l19.14"> interface nsIMsgHeaderParser : nsISupports {</span>
<a href="#l19.15"></a><span id="l19.15"> </span>
<a href="#l19.16"></a><span id="l19.16">   void parseHeadersWithArray(in wstring aLine, </span>
<a href="#l19.17"></a><span id="l19.17">                              [array, size_is(count)] out wstring aEmailAddresses,</span>
<a href="#l19.18"></a><span id="l19.18">                              [array, size_is(count)] out wstring aNames,</span>
<a href="#l19.19"></a><span id="l19.19">                              [array, size_is(count)] out wstring aFullNames,</span>
<a href="#l19.20"></a><span id="l19.20">                              [retval] out unsigned long count);</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22"> </span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">-  /* Given a string which contains a list of Header addresses, parses it into</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineminus">-     their component names and mailboxes.</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineminus">-</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineminus">-     The returned value is the number of addresses, or a negative error code;</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineminus">-     the names and addresses are returned into the provided pointers as</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineminus">-     consecutive null-terminated strings.  It is up to the caller to free them.</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineminus">-     Note that some of the strings may be zero-length.</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-     The caller may pass nsnull for charset and it will be interpreted as &quot;us-ascii&quot;.</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+  /**</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+   * Given a string which contains a list of Header addresses, parses it into</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineplus">+   * their component names and mailboxes.</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+   *</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+   * @param aLine          The header line to parse.</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+   * @param aNames         A string of the names in the header line. The names</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineplus">+   *                       are separated by null-terminators.</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+   *                       This param may be null if the caller does not want</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineplus">+   *                       this part of the result.</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineplus">+   * @param aAddresses     A string of the addresses in the header line. The</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+   *                       addresses are separated by null-terminators.</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+   *                       This param may be null if the caller does not want</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+   *                       this part of the result.</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineplus">+   * @param aNumAddresses  The number of addresses in the header. If this is</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineplus">+   *                       negative, there has been an error parsing the</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineplus">+   *                       header.</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+   */</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+  [noscript] void parseHeaderAddresses(in string aLine, out string aNames, </span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+                                       out string aAddresses,</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+                                       out PRUint32 aNumAddresses);</span>
<a href="#l19.52"></a><span id="l19.52"> </span>
<a href="#l19.53"></a><span id="l19.53" class="difflineminus">-     Either of the provided pointers may be NULL if the caller is not interested</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-     in those components.</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineminus">-  */</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineminus">-  [noscript] void parseHeaderAddresses (in string charset, in string line, out string names, </span>
<a href="#l19.57"></a><span id="l19.57" class="difflineminus">-                             out string addresses, out PRUint32 numAddresses);</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineminus">-</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineminus">-  /* Given a string which contains a list of Header addresses, returns a</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineminus">-     comma-separated list of just the `mailbox' portions.</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineminus">-</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineminus">-     The caller may pass nsnull for charset and it will be interpreted as &quot;us-ascii&quot;.</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineminus">-</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineminus">-     Caller must call PL_strfree on returnValue (which is allocated by the function)</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineminus">-  */</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineminus">-  string extractHeaderAddressMailboxes (in string charset, in string line);</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineplus">+  /**</span>
<a href="#l19.68"></a><span id="l19.68" class="difflineplus">+   * Given a string which contains a list of Header addresses, returns a</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineplus">+   * comma-separated list of just the `mailbox' portions.</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineplus">+   *</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineplus">+   * @param aLine          The header line to parse.</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineplus">+   * @return               A comma-separated list of just the mailbox parts</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineplus">+   *                       of the email-addresses.</span>
<a href="#l19.74"></a><span id="l19.74" class="difflineplus">+   */</span>
<a href="#l19.75"></a><span id="l19.75" class="difflineplus">+  string extractHeaderAddressMailboxes(in string aLine);</span>
<a href="#l19.76"></a><span id="l19.76"> </span>
<a href="#l19.77"></a><span id="l19.77"> </span>
<a href="#l19.78"></a><span id="l19.78" class="difflineminus">-  /* Given a string which contains a list of Header addresses, returns a</span>
<a href="#l19.79"></a><span id="l19.79" class="difflineminus">-     comma-separated list of just the `user name' portions.  If any of</span>
<a href="#l19.80"></a><span id="l19.80" class="difflineminus">-     the addresses doesn't have a name, then the mailbox is used instead.</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineminus">-</span>
<a href="#l19.82"></a><span id="l19.82" class="difflineminus">-     The caller may pass nsnull for charset and it will be interpreted as &quot;us-ascii&quot;.</span>
<a href="#l19.83"></a><span id="l19.83" class="difflineminus">-</span>
<a href="#l19.84"></a><span id="l19.84" class="difflineminus">-     Caller must NS_Free the return value.</span>
<a href="#l19.85"></a><span id="l19.85" class="difflineminus">-  */</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineminus">-  [noscript] string extractHeaderAddressNames (in string charset, in string line);</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineplus">+  /**</span>
<a href="#l19.88"></a><span id="l19.88" class="difflineplus">+   * Given a string which contains a list of Header addresses, returns a</span>
<a href="#l19.89"></a><span id="l19.89" class="difflineplus">+   * comma-separated list of just the `user name' portions.  If any of</span>
<a href="#l19.90"></a><span id="l19.90" class="difflineplus">+   * the addresses doesn't have a name, then the mailbox is used instead.</span>
<a href="#l19.91"></a><span id="l19.91" class="difflineplus">+   *</span>
<a href="#l19.92"></a><span id="l19.92" class="difflineplus">+   * @param aLine          The header line to parse.</span>
<a href="#l19.93"></a><span id="l19.93" class="difflineplus">+   * @return               A comma-separated list of just the name parts</span>
<a href="#l19.94"></a><span id="l19.94" class="difflineplus">+   *                       of the addresses.</span>
<a href="#l19.95"></a><span id="l19.95" class="difflineplus">+   */</span>
<a href="#l19.96"></a><span id="l19.96" class="difflineplus">+  [noscript] string extractHeaderAddressNames(in string aLine);</span>
<a href="#l19.97"></a><span id="l19.97"> </span>
<a href="#l19.98"></a><span id="l19.98" class="difflineminus">-  /* Like MSG_ExtractHeaderAddressNames(), but only returns the first name</span>
<a href="#l19.99"></a><span id="l19.99" class="difflineminus">-     in the list, if there is more than one. </span>
<a href="#l19.100"></a><span id="l19.100" class="difflineminus">-     </span>
<a href="#l19.101"></a><span id="l19.101" class="difflineminus">-     The caller may pass nsnull for charset and it will be interpreted as &quot;us-ascii&quot;.</span>
<a href="#l19.102"></a><span id="l19.102" class="difflineminus">-</span>
<a href="#l19.103"></a><span id="l19.103" class="difflineminus">-     Caller must NS_Free the return value.</span>
<a href="#l19.104"></a><span id="l19.104" class="difflineminus">-  */</span>
<a href="#l19.105"></a><span id="l19.105" class="difflineminus">-  [noscript] string extractHeaderAddressName (in string charset, in string line);</span>
<a href="#l19.106"></a><span id="l19.106" class="difflineminus">-</span>
<a href="#l19.107"></a><span id="l19.107" class="difflineminus">-  /* Given a string which contains a list of Header addresses, returns a new</span>
<a href="#l19.108"></a><span id="l19.108" class="difflineminus">-     string with the same data, but inserts missing commas, parses and reformats</span>
<a href="#l19.109"></a><span id="l19.109" class="difflineminus">-     it, and wraps long lines with newline-tab.</span>
<a href="#l19.110"></a><span id="l19.110" class="difflineminus">-</span>
<a href="#l19.111"></a><span id="l19.111" class="difflineminus">-     The caller may pass nsnull for charset and it will be interpreted as &quot;us-ascii&quot;.</span>
<a href="#l19.112"></a><span id="l19.112" class="difflineplus">+  /*</span>
<a href="#l19.113"></a><span id="l19.113" class="difflineplus">+   * Like extractHeaderAddressNames, but only returns the first name in the</span>
<a href="#l19.114"></a><span id="l19.114" class="difflineplus">+   * header if there is one.</span>
<a href="#l19.115"></a><span id="l19.115" class="difflineplus">+   *</span>
<a href="#l19.116"></a><span id="l19.116" class="difflineplus">+   * @param aLine          The header line to parse.</span>
<a href="#l19.117"></a><span id="l19.117" class="difflineplus">+   * @return               The first name found in the list.</span>
<a href="#l19.118"></a><span id="l19.118" class="difflineplus">+   */</span>
<a href="#l19.119"></a><span id="l19.119" class="difflineplus">+  [noscript] string extractHeaderAddressName(in string aLine);</span>
<a href="#l19.120"></a><span id="l19.120"> </span>
<a href="#l19.121"></a><span id="l19.121" class="difflineminus">-     Caller must NS_Free the return value.</span>
<a href="#l19.122"></a><span id="l19.122" class="difflineminus">-  */</span>
<a href="#l19.123"></a><span id="l19.123" class="difflineminus">-  [noscript] string reformatHeaderAddresses (in string charset, in string line);</span>
<a href="#l19.124"></a><span id="l19.124" class="difflineminus">-</span>
<a href="#l19.125"></a><span id="l19.125" class="difflineminus">-  /* Returns a copy of ADDRS which may have had some addresses removed.</span>
<a href="#l19.126"></a><span id="l19.126" class="difflineminus">-     Addresses are removed if they are already in either ADDRS or OTHER_ADDRS.</span>
<a href="#l19.127"></a><span id="l19.127" class="difflineminus">-     (If OTHER_ADDRS contain addresses which are not in ADDRS, they are not</span>
<a href="#l19.128"></a><span id="l19.128" class="difflineminus">-     added.  That argument is for passing in addresses that were already</span>
<a href="#l19.129"></a><span id="l19.129" class="difflineminus">-     mentioned in other header fields.)</span>
<a href="#l19.130"></a><span id="l19.130" class="difflineminus">-</span>
<a href="#l19.131"></a><span id="l19.131" class="difflineminus">-     Addresses are considered to be the same if they contain the same mailbox</span>
<a href="#l19.132"></a><span id="l19.132" class="difflineminus">-     part (case-insensitive.)  Real names and other comments are not compared.</span>
<a href="#l19.133"></a><span id="l19.133" class="difflineplus">+  /**</span>
<a href="#l19.134"></a><span id="l19.134" class="difflineplus">+   * Given a string which contains a list of Header addresses, returns a new</span>
<a href="#l19.135"></a><span id="l19.135" class="difflineplus">+   * string with the same data, but inserts missing commas, parses and reformats</span>
<a href="#l19.136"></a><span id="l19.136" class="difflineplus">+   * it, and wraps long lines with newline-tab.</span>
<a href="#l19.137"></a><span id="l19.137" class="difflineplus">+   *</span>
<a href="#l19.138"></a><span id="l19.138" class="difflineplus">+   * @param aLine          The header line to parse.</span>
<a href="#l19.139"></a><span id="l19.139" class="difflineplus">+   * @return               The reformatted header line.</span>
<a href="#l19.140"></a><span id="l19.140" class="difflineplus">+   */</span>
<a href="#l19.141"></a><span id="l19.141" class="difflineplus">+  [noscript] string reformatHeaderAddresses(in string aLine);</span>
<a href="#l19.142"></a><span id="l19.142"> </span>
<a href="#l19.143"></a><span id="l19.143" class="difflineminus">-     removeAliasesToMe allows the address parser to use the preference which</span>
<a href="#l19.144"></a><span id="l19.144" class="difflineminus">-     contains regular expressions which also mean 'me' for the purpose of</span>
<a href="#l19.145"></a><span id="l19.145" class="difflineminus">-     stripping the user's email address(es) out of addrs</span>
<a href="#l19.146"></a><span id="l19.146" class="difflineminus">-</span>
<a href="#l19.147"></a><span id="l19.147" class="difflineminus">-     The caller may pass nsnull for charset and it will be interpreted as &quot;us-ascii&quot;.</span>
<a href="#l19.148"></a><span id="l19.148" class="difflineminus">-</span>
<a href="#l19.149"></a><span id="l19.149" class="difflineminus">-     Caller must NS_Free the return value.</span>
<a href="#l19.150"></a><span id="l19.150" class="difflineminus">-  */</span>
<a href="#l19.151"></a><span id="l19.151" class="difflineminus">-  [noscript] string removeDuplicateAddresses (in string charset,</span>
<a href="#l19.152"></a><span id="l19.152" class="difflineminus">-                                              in string addrs,</span>
<a href="#l19.153"></a><span id="l19.153" class="difflineminus">-                                              in string other_addrs,</span>
<a href="#l19.154"></a><span id="l19.154" class="difflineminus">-                                              in boolean removeAliasesToMe);</span>
<a href="#l19.155"></a><span id="l19.155" class="difflineminus">-</span>
<a href="#l19.156"></a><span id="l19.156" class="difflineplus">+  /**</span>
<a href="#l19.157"></a><span id="l19.157" class="difflineplus">+   * Returns a copy of the input which may have had some addresses removed.</span>
<a href="#l19.158"></a><span id="l19.158" class="difflineplus">+   * Addresses are removed if they are already in either of the supplied</span>
<a href="#l19.159"></a><span id="l19.159" class="difflineplus">+   * address lists.</span>
<a href="#l19.160"></a><span id="l19.160" class="difflineplus">+   *</span>
<a href="#l19.161"></a><span id="l19.161" class="difflineplus">+   * Addresses are considered to be the same if they contain the same mailbox</span>
<a href="#l19.162"></a><span id="l19.162" class="difflineplus">+   * part (case-insensitive.)  Real names and other comments are not compared.</span>
<a href="#l19.163"></a><span id="l19.163" class="difflineplus">+   *</span>
<a href="#l19.164"></a><span id="l19.164" class="difflineplus">+   * @param aAddrs              The addresses to remove duplicates from.</span>
<a href="#l19.165"></a><span id="l19.165" class="difflineplus">+   * @param aOtherAddrs         Other addresses that the duplicate removal</span>
<a href="#l19.166"></a><span id="l19.166" class="difflineplus">+   *                            process also checks for duplicates against.</span>
<a href="#l19.167"></a><span id="l19.167" class="difflineplus">+   *                            Addresses in this list will not be added to the</span>
<a href="#l19.168"></a><span id="l19.168" class="difflineplus">+   *                            result.</span>
<a href="#l19.169"></a><span id="l19.169" class="difflineplus">+   * @param aRemoveAliasesToMe  Allows the address parser to use the preference</span>
<a href="#l19.170"></a><span id="l19.170" class="difflineplus">+   *                            which contains regular expressions which also</span>
<a href="#l19.171"></a><span id="l19.171" class="difflineplus">+   *                            mean 'me' for the purpose of stripping the</span>
<a href="#l19.172"></a><span id="l19.172" class="difflineplus">+   *                            user's email address(es) out of addrs.</span>
<a href="#l19.173"></a><span id="l19.173" class="difflineplus">+   * @return                    A string based on the original without the</span>
<a href="#l19.174"></a><span id="l19.174" class="difflineplus">+   *                            duplicate addresses.</span>
<a href="#l19.175"></a><span id="l19.175" class="difflineplus">+   */</span>
<a href="#l19.176"></a><span id="l19.176" class="difflineplus">+  [noscript] string removeDuplicateAddresses(in string aAddrs,</span>
<a href="#l19.177"></a><span id="l19.177" class="difflineplus">+                                             in string aOtherAddrs,</span>
<a href="#l19.178"></a><span id="l19.178" class="difflineplus">+                                             in boolean aRemoveAliasesToMe);</span>
<a href="#l19.179"></a><span id="l19.179"> </span>
<a href="#l19.180"></a><span id="l19.180">   /**</span>
<a href="#l19.181"></a><span id="l19.181">    * Given an e-mail address and a person's name, cons them together into a</span>
<a href="#l19.182"></a><span id="l19.182">    * single string, doing all the necessary quoting.</span>
<a href="#l19.183"></a><span id="l19.183">    *</span>
<a href="#l19.184"></a><span id="l19.184">    * @param  aName     The name of the sender.</span>
<a href="#l19.185"></a><span id="l19.185">    * @param  aAddress  The address of the sender.</span>
<a href="#l19.186"></a><span id="l19.186">    * @return           A string of the form name &lt;address&gt;.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/mime/src/mimecms.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/mime/src/mimecms.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -174,17 +174,18 @@ PRBool MimeEncryptedCMS_encrypted_p (Mim</span>
<a href="#l20.4"></a><span id="l20.4"> static void ParseRFC822Addresses (const char *line, nsCString &amp;names, nsCString &amp;addresses)</span>
<a href="#l20.5"></a><span id="l20.5"> {</span>
<a href="#l20.6"></a><span id="l20.6">   PRUint32 numAddresses;</span>
<a href="#l20.7"></a><span id="l20.7">   nsresult res;</span>
<a href="#l20.8"></a><span id="l20.8">   nsCOMPtr&lt;nsIMsgHeaderParser&gt; pHeader = do_GetService(NS_MAILNEWS_MIME_HEADER_PARSER_CONTRACTID, &amp;res);</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10">   if (NS_SUCCEEDED(res))</span>
<a href="#l20.11"></a><span id="l20.11">   {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    pHeader-&gt;ParseHeaderAddresses(nsnull, line, getter_Copies(names), getter_Copies(addresses), &amp;numAddresses);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+    pHeader-&gt;ParseHeaderAddresses(line, getter_Copies(names),</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+                                  getter_Copies(addresses), &amp;numAddresses);</span>
<a href="#l20.15"></a><span id="l20.15">   }</span>
<a href="#l20.16"></a><span id="l20.16"> }</span>
<a href="#l20.17"></a><span id="l20.17"> </span>
<a href="#l20.18"></a><span id="l20.18"> PRBool MimeCMSHeadersAndCertsMatch(nsICMSMessage *content_info, </span>
<a href="#l20.19"></a><span id="l20.19">                                    nsIX509Cert *signerCert,</span>
<a href="#l20.20"></a><span id="l20.20">                                    const char *from_addr,</span>
<a href="#l20.21"></a><span id="l20.21">                                    const char *from_name,</span>
<a href="#l20.22"></a><span id="l20.22">                                    const char *sender_addr,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/mime/src/nsMsgHeaderParser.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/mime/src/nsMsgHeaderParser.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -146,17 +146,17 @@ NS_IMETHODIMP nsMsgHeaderParser::ParseHe</span>
<a href="#l21.4"></a><span id="l21.4">   char * addresses = nsnull;</span>
<a href="#l21.5"></a><span id="l21.5">   PRUint32 numAddresses = 0;</span>
<a href="#l21.6"></a><span id="l21.6">   nsresult rv = NS_OK;</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8">   // need to convert unicode to UTF-8...</span>
<a href="#l21.9"></a><span id="l21.9">   nsAutoString tempString (aLine);</span>
<a href="#l21.10"></a><span id="l21.10">   char * utf8String = ToNewUTF8String(tempString);</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  rv = ParseHeaderAddresses(&quot;UTF-8&quot;, utf8String, &amp;names, &amp;addresses, &amp;numAddresses);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  rv = ParseHeaderAddresses(utf8String, &amp;names, &amp;addresses, &amp;numAddresses);</span>
<a href="#l21.14"></a><span id="l21.14">   NS_Free(utf8String);</span>
<a href="#l21.15"></a><span id="l21.15">   if (NS_SUCCEEDED(rv) &amp;&amp; numAddresses)</span>
<a href="#l21.16"></a><span id="l21.16">   {</span>
<a href="#l21.17"></a><span id="l21.17">     // allocate space for our arrays....</span>
<a href="#l21.18"></a><span id="l21.18">     *aEmailAddresses = (PRUnichar **) PR_MALLOC(sizeof(PRUnichar *) * numAddresses);</span>
<a href="#l21.19"></a><span id="l21.19">     *aNames = (PRUnichar **) PR_MALLOC(sizeof(PRUnichar *) * numAddresses);</span>
<a href="#l21.20"></a><span id="l21.20">     *aFullNames = (PRUnichar **) PR_MALLOC(sizeof(PRUnichar *) * numAddresses);</span>
<a href="#l21.21"></a><span id="l21.21"> </span>
<a href="#l21.22"></a><span id="l21.22" class="difflineat">@@ -185,77 +185,70 @@ NS_IMETHODIMP nsMsgHeaderParser::ParseHe</span>
<a href="#l21.23"></a><span id="l21.23">   }</span>
<a href="#l21.24"></a><span id="l21.24"> </span>
<a href="#l21.25"></a><span id="l21.25">   *aNumAddresses = numAddresses;</span>
<a href="#l21.26"></a><span id="l21.26">   PR_FREEIF(names);</span>
<a href="#l21.27"></a><span id="l21.27">   PR_FREEIF(addresses);</span>
<a href="#l21.28"></a><span id="l21.28">   return rv;</span>
<a href="#l21.29"></a><span id="l21.29"> }</span>
<a href="#l21.30"></a><span id="l21.30"> </span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-nsresult nsMsgHeaderParser::ParseHeaderAddresses (const char *charset, const char *line, char **names, char **addresses, PRUint32 *numAddresses)</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+nsMsgHeaderParser::ParseHeaderAddresses(const char *aLine, char **aNames,</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+                                        char **aAddresses,</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+                                        PRUint32 *aNumAddresses)</span>
<a href="#l21.36"></a><span id="l21.36"> {</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-  *numAddresses = msg_parse_Header_addresses(line, names, addresses);</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aNumAddresses);</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+  *aNumAddresses = msg_parse_Header_addresses(aLine, aNames, aAddresses);</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+  return NS_OK;</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+}</span>
<a href="#l21.42"></a><span id="l21.42"> </span>
<a href="#l21.43"></a><span id="l21.43" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineplus">+nsMsgHeaderParser::ExtractHeaderAddressMailboxes(const char *aLine,</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineplus">+                                                 char **aMailboxes)</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineplus">+{</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aMailboxes);</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineplus">+  *aMailboxes = msg_extract_Header_address_mailboxes(aLine);</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+  return NS_OK;</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+}</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+nsMsgHeaderParser::ExtractHeaderAddressNames(const char *aLine, char **aNames)</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineplus">+{</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aNames);</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+  *aNames = msg_extract_Header_address_names(aLine);</span>
<a href="#l21.57"></a><span id="l21.57">   return NS_OK;</span>
<a href="#l21.58"></a><span id="l21.58"> }</span>
<a href="#l21.59"></a><span id="l21.59"> </span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-nsresult nsMsgHeaderParser::ExtractHeaderAddressMailboxes (const char *charset, const char *line, char ** mailboxes)</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineplus">+nsMsgHeaderParser::ExtractHeaderAddressName(const char *aLine, char **aName)</span>
<a href="#l21.63"></a><span id="l21.63"> {</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineminus">-  if (mailboxes)</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineminus">-  {</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineminus">-    *mailboxes = msg_extract_Header_address_mailboxes(line);</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineminus">-    return NS_OK;</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineminus">-  }</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineminus">-  else</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineminus">-}</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineminus">-</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineminus">-nsresult nsMsgHeaderParser::ExtractHeaderAddressNames (const char *charset, const char *line, char ** names)</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineminus">-{</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineminus">-  if (names)</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineminus">-  {</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineminus">-    *names = msg_extract_Header_address_names(line);</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineminus">-    return NS_OK;</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineminus">-  }</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineminus">-  else</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aName);</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+  *aName = msg_extract_Header_address_name(aLine);</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineplus">+  return NS_OK;</span>
<a href="#l21.85"></a><span id="l21.85"> }</span>
<a href="#l21.86"></a><span id="l21.86"> </span>
<a href="#l21.87"></a><span id="l21.87" class="difflineminus">-</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineminus">-nsresult nsMsgHeaderParser::ExtractHeaderAddressName (const char *charset, const char *line, char ** name)</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineplus">+nsMsgHeaderParser::ReformatHeaderAddresses(const char *aLine,</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineplus">+                                           char **aReformattedAddress)</span>
<a href="#l21.92"></a><span id="l21.92"> {</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineminus">-  if (name)</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineminus">-  {</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineminus">-    *name = msg_extract_Header_address_name(line);</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineminus">-    return NS_OK;</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineminus">-  }</span>
<a href="#l21.98"></a><span id="l21.98" class="difflineminus">-  else</span>
<a href="#l21.99"></a><span id="l21.99" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aReformattedAddress);</span>
<a href="#l21.101"></a><span id="l21.101" class="difflineplus">+  *aReformattedAddress = msg_reformat_Header_addresses(aLine);</span>
<a href="#l21.102"></a><span id="l21.102" class="difflineplus">+  return NS_OK;</span>
<a href="#l21.103"></a><span id="l21.103"> }</span>
<a href="#l21.104"></a><span id="l21.104"> </span>
<a href="#l21.105"></a><span id="l21.105" class="difflineminus">-nsresult nsMsgHeaderParser::ReformatHeaderAddresses (const char *charset, const char *line, char ** reformattedAddress)</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l21.107"></a><span id="l21.107" class="difflineplus">+nsMsgHeaderParser::RemoveDuplicateAddresses(const char *aAddrs,</span>
<a href="#l21.108"></a><span id="l21.108" class="difflineplus">+                                            const char *aOtherAddrs,</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineplus">+                                            PRBool aRemoveAliasesToMe,</span>
<a href="#l21.110"></a><span id="l21.110" class="difflineplus">+                                            char **aResult)</span>
<a href="#l21.111"></a><span id="l21.111"> {</span>
<a href="#l21.112"></a><span id="l21.112" class="difflineminus">-  if (reformattedAddress)</span>
<a href="#l21.113"></a><span id="l21.113" class="difflineminus">-  {</span>
<a href="#l21.114"></a><span id="l21.114" class="difflineminus">-    *reformattedAddress = msg_reformat_Header_addresses(line);</span>
<a href="#l21.115"></a><span id="l21.115" class="difflineminus">-    return NS_OK;</span>
<a href="#l21.116"></a><span id="l21.116" class="difflineminus">-  }</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineminus">-  else</span>
<a href="#l21.118"></a><span id="l21.118" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l21.119"></a><span id="l21.119" class="difflineminus">-}</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineminus">-</span>
<a href="#l21.121"></a><span id="l21.121" class="difflineminus">-nsresult nsMsgHeaderParser::RemoveDuplicateAddresses (const char *charset, const char *addrs, const char *other_addrs, PRBool removeAliasesToMe, char ** newOutput)</span>
<a href="#l21.122"></a><span id="l21.122" class="difflineminus">-{</span>
<a href="#l21.123"></a><span id="l21.123" class="difflineminus">-  if (newOutput)</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineminus">-  {</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineminus">-    *newOutput = msg_remove_duplicate_addresses(addrs, other_addrs, removeAliasesToMe);</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineminus">-    return NS_OK;</span>
<a href="#l21.127"></a><span id="l21.127" class="difflineminus">-  }</span>
<a href="#l21.128"></a><span id="l21.128" class="difflineminus">-  else</span>
<a href="#l21.129"></a><span id="l21.129" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l21.130"></a><span id="l21.130" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l21.131"></a><span id="l21.131" class="difflineplus">+  *aResult = msg_remove_duplicate_addresses(aAddrs, aOtherAddrs,</span>
<a href="#l21.132"></a><span id="l21.132" class="difflineplus">+                                            aRemoveAliasesToMe);</span>
<a href="#l21.133"></a><span id="l21.133" class="difflineplus">+  return NS_OK;</span>
<a href="#l21.134"></a><span id="l21.134"> }</span>
<a href="#l21.135"></a><span id="l21.135"> </span>
<a href="#l21.136"></a><span id="l21.136"> NS_IMETHODIMP</span>
<a href="#l21.137"></a><span id="l21.137"> nsMsgHeaderParser::MakeFullAddressString(const char *aName,</span>
<a href="#l21.138"></a><span id="l21.138">                                          const char *aAddress, char **aResult)</span>
<a href="#l21.139"></a><span id="l21.139"> {</span>
<a href="#l21.140"></a><span id="l21.140">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l21.141"></a><span id="l21.141">   *aResult = msg_make_full_address(aName, aAddress);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -4141,18 +4141,18 @@ PRBool nsNNTPProtocol::CheckIfAuthor(nsI</span>
<a href="#l22.4"></a><span id="l22.4"> </span>
<a href="#l22.5"></a><span id="l22.5">     if (NS_FAILED(rv)) {</span>
<a href="#l22.6"></a><span id="l22.6">         cancelInfo-&gt;from.Truncate();</span>
<a href="#l22.7"></a><span id="l22.7">         return PR_TRUE;</span>
<a href="#l22.8"></a><span id="l22.8">     }</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10">     nsCString us;</span>
<a href="#l22.11"></a><span id="l22.11">     nsCString them;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    nsresult rv1 = parser-&gt;ExtractHeaderAddressMailboxes(nsnull, cancelInfo-&gt;from.get(), getter_Copies(us));</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-    nsresult rv2 = parser-&gt;ExtractHeaderAddressMailboxes(nsnull, cancelInfo-&gt;old_from.get(), getter_Copies(them));</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+    nsresult rv1 = parser-&gt;ExtractHeaderAddressMailboxes(cancelInfo-&gt;from.get(), getter_Copies(us));</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+    nsresult rv2 = parser-&gt;ExtractHeaderAddressMailboxes(cancelInfo-&gt;old_from.get(), getter_Copies(them));</span>
<a href="#l22.16"></a><span id="l22.16"> </span>
<a href="#l22.17"></a><span id="l22.17">     PR_LOG(NNTP,PR_LOG_ALWAYS,(&quot;us = %s, them = %s&quot;, us.get(), them.get()));</span>
<a href="#l22.18"></a><span id="l22.18"> </span>
<a href="#l22.19"></a><span id="l22.19">     if (NS_FAILED(rv1) || NS_FAILED(rv2) || !us.Equals(them, nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l22.20"></a><span id="l22.20">         //no match.  don't set cancel email</span>
<a href="#l22.21"></a><span id="l22.21">         cancelInfo-&gt;from.Truncate();</span>
<a href="#l22.22"></a><span id="l22.22">         return PR_TRUE;</span>
<a href="#l22.23"></a><span id="l22.23">     }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

