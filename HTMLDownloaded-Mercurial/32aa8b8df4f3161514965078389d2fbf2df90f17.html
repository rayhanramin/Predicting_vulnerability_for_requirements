<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27848:32aa8b8df4f3161514965078389d2fbf2df90f17</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 32aa8b8df4f3161514965078389d2fbf2df90f17" />
<meta property="og:url" content="/comm-central/rev/32aa8b8df4f3161514965078389d2fbf2df90f17" />
<meta property="og:description" content="Bug 1584211 - Avoid false positive errors from awTestRowSequence. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 32aa8b8df4f3161514965078389d2fbf2df90f17 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/32aa8b8df4f3161514965078389d2fbf2df90f17">shortlog</a> |
<a href="/comm-central/log/32aa8b8df4f3161514965078389d2fbf2df90f17">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/32aa8b8df4f3161514965078389d2fbf2df90f17">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/32aa8b8df4f3161514965078389d2fbf2df90f17">files</a> |
changeset |
<a href="/comm-central/raw-rev/32aa8b8df4f3161514965078389d2fbf2df90f17">raw</a>  | <a href="/comm-central/archive/32aa8b8df4f3161514965078389d2fbf2df90f17.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1584211">Bug 1584211</a> - Avoid false positive errors from awTestRowSequence. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#97;&#117;&#108;&#32;&#77;&#111;&#114;&#114;&#105;&#115;&#32;&#60;&#112;&#97;&#117;&#108;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 04 Oct 2019 13:43:21 -0400</td></tr>

<tr>
 <td>changeset 27848</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/32aa8b8df4f3161514965078389d2fbf2df90f17">32aa8b8df4f3161514965078389d2fbf2df90f17</a></td>
</tr>



<tr>
<td>parent 27847</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5462c8d4451abb572f3c36afae2e2b043100d076">5462c8d4451abb572f3c36afae2e2b043100d076</a>
</td>
</tr>

<tr>
<td>child 27849</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6ff5305dadb925e7904cb5d4a3368a473d46cc95">6ff5305dadb925e7904cb5d4a3368a473d46cc95</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=32aa8b8df4f3161514965078389d2fbf2df90f17">16513</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 04 Oct 2019 22:01:48 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@5fcde2aba579 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=5fcde2aba579886c6c1598314ec65211023e7d85">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=5fcde2aba579886c6c1598314ec65211023e7d85&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=5fcde2aba579886c6c1598314ec65211023e7d85&newProject=comm-central&newRevision=b1d22780fc37de740014210bbb93bda19a69f9bd&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=5fcde2aba579886c6c1598314ec65211023e7d85&newProject=comm-central&newRevision=b1d22780fc37de740014210bbb93bda19a69f9bd&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=5fcde2aba579886c6c1598314ec65211023e7d85&newProject=comm-central&newRevision=b1d22780fc37de740014210bbb93bda19a69f9bd&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1584211">1584211</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1584211">Bug 1584211</a> - Avoid false positive errors from awTestRowSequence. r=mkmelin

This debugging function is written to test UIs like the compose
dialog where each row has a drop down menu (to,cc,bcc). Those menus
have an ID attached that has to be kept in sequence. But in the
mailing list dialog the rows have no drop down menus, so this
function was generating false positive errors there. Adjust it
so it works for cases where there is no drop down menu.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/32aa8b8df4f3161514965078389d2fbf2df90f17/mail/components/compose/content/addressingWidgetOverlay.js">mail/components/compose/content/addressingWidgetOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/32aa8b8df4f3161514965078389d2fbf2df90f17/mail/components/compose/content/addressingWidgetOverlay.js">file</a> |
<a href="/comm-central/annotate/32aa8b8df4f3161514965078389d2fbf2df90f17/mail/components/compose/content/addressingWidgetOverlay.js">annotate</a> |
<a href="/comm-central/diff/32aa8b8df4f3161514965078389d2fbf2df90f17/mail/components/compose/content/addressingWidgetOverlay.js">diff</a> |
<a href="/comm-central/comparison/32aa8b8df4f3161514965078389d2fbf2df90f17/mail/components/compose/content/addressingWidgetOverlay.js">comparison</a> |
<a href="/comm-central/log/32aa8b8df4f3161514965078389d2fbf2df90f17/mail/components/compose/content/addressingWidgetOverlay.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/compose/content/addressingWidgetOverlay.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/compose/content/addressingWidgetOverlay.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -485,39 +485,34 @@ function awTestRowSequence() {</span>
<a href="#l1.4"></a><span id="l1.4">   let listbox = document.getElementById(&quot;addressingWidget&quot;);</span>
<a href="#l1.5"></a><span id="l1.5">   let listitems = listbox.itemChildren;</span>
<a href="#l1.6"></a><span id="l1.6">   if (listitems.length &gt;= top.MAX_RECIPIENTS) {</span>
<a href="#l1.7"></a><span id="l1.7">     for (let i = 1; i &lt;= listitems.length; i++) {</span>
<a href="#l1.8"></a><span id="l1.8">       let item = listitems[i - 1];</span>
<a href="#l1.9"></a><span id="l1.9">       let inputID = item</span>
<a href="#l1.10"></a><span id="l1.10">         .querySelector(`input[is=&quot;autocomplete-input&quot;]`)</span>
<a href="#l1.11"></a><span id="l1.11">         .id.split(&quot;#&quot;)[1];</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      let popupID = item.querySelector(&quot;menulist&quot;).id.split(&quot;#&quot;)[1];</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-      if (inputID != i || popupID != i) {</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+      let menulist = item.querySelector(&quot;menulist&quot;);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+      // In some places like the mailing list dialog there is no menulist,</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+      // and so no popupID that needs to be kept in sequence.</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+      let popupID = menulist &amp;&amp; menulist.id.split(&quot;#&quot;)[1];</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+      if (inputID != i || (popupID &amp;&amp; popupID != i)) {</span>
<a href="#l1.19"></a><span id="l1.19">         dump(</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-          &quot;#ERROR: sequence broken at row &quot; +</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-            i +</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-            &quot;, inputID=&quot; +</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-            inputID +</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-            &quot;, popupID=&quot; +</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-            popupID +</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-            &quot;\n&quot;</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+          `#ERROR: sequence broken at row ${i}, ` +</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+            `inputID=${inputID}, popupID=${popupID}\n`</span>
<a href="#l1.29"></a><span id="l1.29">         );</span>
<a href="#l1.30"></a><span id="l1.30">         return false;</span>
<a href="#l1.31"></a><span id="l1.31">       }</span>
<a href="#l1.32"></a><span id="l1.32">       dump(&quot;---SEQUENCE OK---\n&quot;);</span>
<a href="#l1.33"></a><span id="l1.33">       return true;</span>
<a href="#l1.34"></a><span id="l1.34">     }</span>
<a href="#l1.35"></a><span id="l1.35">   } else {</span>
<a href="#l1.36"></a><span id="l1.36">     dump(</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-      &quot;#ERROR: listitems.length(&quot; +</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-        listitems.length +</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-        &quot;) &lt; top.MAX_RECIPIENTS(&quot; +</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-        top.MAX_RECIPIENTS +</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-        &quot;)\n&quot;</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+      `#ERROR: listitems.length(${listitems.length}) &lt; ` +</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+        `top.MAX_RECIPIENTS(${top.MAX_RECIPIENTS})\n`</span>
<a href="#l1.44"></a><span id="l1.44">     );</span>
<a href="#l1.45"></a><span id="l1.45">   }</span>
<a href="#l1.46"></a><span id="l1.46"> </span>
<a href="#l1.47"></a><span id="l1.47">   return false;</span>
<a href="#l1.48"></a><span id="l1.48"> }</span>
<a href="#l1.49"></a><span id="l1.49"> </span>
<a href="#l1.50"></a><span id="l1.50"> function awCleanupRows() {</span>
<a href="#l1.51"></a><span id="l1.51">   var maxRecipients = top.MAX_RECIPIENTS;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

