<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 7283:d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35" />
<meta property="og:url" content="/comm-central/rev/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35" />
<meta property="og:description" content="Bug 626076 - Add spellcheck UI in the context menu, à la Firefox, for all HTML Textareas r=sid0 ui-r=clarkbw" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35">shortlog</a> |
<a href="/comm-central/log/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35">files</a> |
changeset |
<a href="/comm-central/raw-rev/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35">raw</a>  | <a href="/comm-central/archive/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=626076">Bug 626076</a> - Add spellcheck UI in the context menu, à la Firefox, for all HTML Textareas r=sid0 ui-r=clarkbw
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#110;&#97;&#116;&#104;&#97;&#110;&#32;&#80;&#114;&#111;&#116;&#122;&#101;&#110;&#107;&#111;&#32;&#60;&#106;&#111;&#110;&#97;&#116;&#104;&#97;&#110;&#46;&#112;&#114;&#111;&#116;&#122;&#101;&#110;&#107;&#111;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 08 Mar 2011 17:12:38 +0100</td></tr>

<tr>
 <td>changeset 7283</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35">d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35</a></td>
</tr>



<tr>
<td>parent 7282</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ef7477439a051877edc96613a184757ab43cd8d3">ef7477439a051877edc96613a184757ab43cd8d3</a>
</td>
</tr>

<tr>
<td>child 7284</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/19ab09dcea5566cd86e192e1676a176ae30c1ae3">19ab09dcea5566cd86e192e1676a176ae30c1ae3</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35">5590</a></td></tr>
<tr><td>push user</td><td>jonathan.protzenko@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 08 Mar 2011 16:13:03 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d02ad4f0a6db [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35&newProject=comm-central&newRevision=d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35&newProject=comm-central&newRevision=d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35&newProject=comm-central&newRevision=d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28sid0%29&revcount=50">sid0</a>, <a href="/comm-central/log?rev=reviewer%28clarkbw%29&revcount=50">clarkbw</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=626076">626076</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=626076">Bug 626076</a> - Add spellcheck UI in the context menu, à la Firefox, for all HTML Textareas r=sid0 ui-r=clarkbw

This bug add entries in the context menu to choose a different language when
spellchecking textareas. This works for content tabs, but also for in-3-pane
HTML textareas, the main use case being Thunderbird Conversation's quick reply
faeture, of course.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/mailWindowOverlay.xul">mail/base/content/mailWindowOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/mailWindowOverlay.xul">file</a> |
<a href="/comm-central/annotate/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/mailWindowOverlay.xul">annotate</a> |
<a href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/mailWindowOverlay.xul">diff</a> |
<a href="/comm-central/comparison/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/mailWindowOverlay.xul">comparison</a> |
<a href="/comm-central/log/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/mailWindowOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/messenger.xul">mail/base/content/messenger.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/messenger.xul">file</a> |
<a href="/comm-central/annotate/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/messenger.xul">annotate</a> |
<a href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/messenger.xul">diff</a> |
<a href="/comm-central/comparison/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/messenger.xul">comparison</a> |
<a href="/comm-central/log/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/messenger.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/nsContextMenu.js">mail/base/content/nsContextMenu.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/nsContextMenu.js">file</a> |
<a href="/comm-central/annotate/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/nsContextMenu.js">annotate</a> |
<a href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/nsContextMenu.js">diff</a> |
<a href="/comm-central/comparison/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/nsContextMenu.js">comparison</a> |
<a href="/comm-central/log/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/base/content/nsContextMenu.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/locales/en-US/chrome/messenger/messenger.dtd">mail/locales/en-US/chrome/messenger/messenger.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/locales/en-US/chrome/messenger/messenger.dtd">file</a> |
<a href="/comm-central/annotate/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/locales/en-US/chrome/messenger/messenger.dtd">annotate</a> |
<a href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/locales/en-US/chrome/messenger/messenger.dtd">diff</a> |
<a href="/comm-central/comparison/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/locales/en-US/chrome/messenger/messenger.dtd">comparison</a> |
<a href="/comm-central/log/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/locales/en-US/chrome/messenger/messenger.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/html/whatsnew.html">mail/test/mozmill/content-tabs/html/whatsnew.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/html/whatsnew.html">file</a> |
<a href="/comm-central/annotate/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/html/whatsnew.html">annotate</a> |
<a href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/html/whatsnew.html">diff</a> |
<a href="/comm-central/comparison/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/html/whatsnew.html">comparison</a> |
<a href="/comm-central/log/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/html/whatsnew.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-about-support.js">mail/test/mozmill/content-tabs/test-about-support.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-about-support.js">file</a> |
<a href="/comm-central/annotate/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-about-support.js">annotate</a> |
<a href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-about-support.js">diff</a> |
<a href="/comm-central/comparison/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-about-support.js">comparison</a> |
<a href="/comm-central/log/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-about-support.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-content-tab.js">mail/test/mozmill/content-tabs/test-content-tab.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-content-tab.js">file</a> |
<a href="/comm-central/annotate/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-content-tab.js">annotate</a> |
<a href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-content-tab.js">diff</a> |
<a href="/comm-central/comparison/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-content-tab.js">comparison</a> |
<a href="/comm-central/log/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/content-tabs/test-content-tab.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">mail/test/mozmill/shared-modules/test-content-tab-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">file</a> |
<a href="/comm-central/annotate/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">annotate</a> |
<a href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">diff</a> |
<a href="/comm-central/comparison/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">comparison</a> |
<a href="/comm-central/log/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-dom-helpers.js">mail/test/mozmill/shared-modules/test-dom-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-dom-helpers.js">file</a> |
<a href="/comm-central/annotate/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-dom-helpers.js">annotate</a> |
<a href="/comm-central/diff/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-dom-helpers.js">diff</a> |
<a href="/comm-central/comparison/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-dom-helpers.js">comparison</a> |
<a href="/comm-central/log/d02ad4f0a6dbc01bd187d32dd0ac991ed25bca35/mail/test/mozmill/shared-modules/test-dom-helpers.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -56,16 +56,18 @@</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> &lt;!DOCTYPE overlay [</span>
<a href="#l1.6"></a><span id="l1.6">   &lt;!ENTITY % messengerDTD SYSTEM &quot;chrome://messenger/locale/messenger.dtd&quot;&gt;</span>
<a href="#l1.7"></a><span id="l1.7">   %messengerDTD;</span>
<a href="#l1.8"></a><span id="l1.8">   &lt;!ENTITY % msgViewPickerDTD SYSTEM &quot;chrome://messenger/locale/msgViewPickerOverlay.dtd&quot; &gt;</span>
<a href="#l1.9"></a><span id="l1.9">   %msgViewPickerDTD;</span>
<a href="#l1.10"></a><span id="l1.10">   &lt;!ENTITY % brandDTD SYSTEM &quot;chrome://branding/locale/brand.dtd&quot;&gt;</span>
<a href="#l1.11"></a><span id="l1.11">   %brandDTD;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+  &lt;!ENTITY % textcontextDTD SYSTEM &quot;chrome://global/locale/textcontext.dtd&quot;&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  %textcontextDTD;</span>
<a href="#l1.14"></a><span id="l1.14"> ]&gt;</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> &lt;overlay xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/mailCommands.js&quot;/&gt;</span>
<a href="#l1.19"></a><span id="l1.19"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/junkCommands.js&quot;/&gt;</span>
<a href="#l1.20"></a><span id="l1.20"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/mailWindowOverlay.js&quot;/&gt;</span>
<a href="#l1.21"></a><span id="l1.21"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/mailTabs.js&quot;/&gt;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -792,16 +794,48 @@</span>
<a href="#l1.23"></a><span id="l1.23">               label=&quot;&amp;saveImageAsCmd.label;&quot;</span>
<a href="#l1.24"></a><span id="l1.24">               accesskey=&quot;&amp;saveImageAsCmd.accesskey;&quot;</span>
<a href="#l1.25"></a><span id="l1.25">               oncommand=&quot;gContextMenu.saveImage();&quot;/&gt;</span>
<a href="#l1.26"></a><span id="l1.26">     &lt;menuseparator id=&quot;mailContext-sep-reportPhishing&quot;/&gt;</span>
<a href="#l1.27"></a><span id="l1.27">     &lt;menuitem id=&quot;mailContext-reportPhishingURL&quot;</span>
<a href="#l1.28"></a><span id="l1.28">               label=&quot;&amp;reportPhishingURL.label;&quot;</span>
<a href="#l1.29"></a><span id="l1.29">               accesskey=&quot;&amp;reportPhishingURL.accesskey;&quot;</span>
<a href="#l1.30"></a><span id="l1.30">               oncommand=&quot;gPhishingDetector.reportPhishingURL(gContextMenu.linkURL);&quot;/&gt;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+    &lt;!-- Spellchecking menu items --&gt;</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+    &lt;menuseparator id=&quot;mailContext-spell-suggestions-separator&quot;/&gt;</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+    &lt;menuitem id=&quot;mailContext-spell-no-suggestions&quot;</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+              disabled=&quot;true&quot;</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+              label=&quot;&amp;spellNoSuggestions.label;&quot;/&gt;</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+    &lt;menuitem id=&quot;mailContext-spell-add-to-dictionary&quot;</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+              label=&quot;&amp;spellAddToDictionary.label;&quot;</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+              accesskey=&quot;&amp;spellAddToDictionary.accesskey;&quot;</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+              oncommand=&quot;gSpellChecker.addToDictionary();&quot;/&gt;</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+    &lt;menuseparator id=&quot;mailContext-spell-separator&quot;/&gt;</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+    &lt;menuitem id=&quot;mailContext-spell-check-enabled&quot;</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+              label=&quot;&amp;spellCheckEnable.label;&quot;</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+              type=&quot;checkbox&quot;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+              accesskey=&quot;&amp;spellCheckEnable.accesskey;&quot;</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+              oncommand=&quot;gSpellChecker.toggleEnabled();&quot;/&gt;</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+    &lt;menuitem id=&quot;mailContext-spell-add-dictionaries-main&quot;</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+              label=&quot;&amp;spellAddDictionaries.label;&quot;</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+              accesskey=&quot;&amp;spellAddDictionaries.accesskey;&quot;</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+              oncommand=&quot;gContextMenu.addDictionaries();&quot;/&gt;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+    &lt;menu id=&quot;mailContext-spell-dictionaries&quot;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+          label=&quot;&amp;spellDictionaries.label;&quot;</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+          accesskey=&quot;&amp;spellDictionaries.accesskey;&quot;&gt;</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+        &lt;menupopup id=&quot;mailContext-spell-dictionaries-menu&quot;&gt;</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+            &lt;menuseparator id=&quot;mailContext-spell-language-separator&quot;/&gt;</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+            &lt;menuitem id=&quot;mailContext-spell-add-dictionaries&quot;</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+                      label=&quot;&amp;spellAddDictionaries.label;&quot;</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+                      accesskey=&quot;&amp;spellAddDictionaries.accesskey;&quot;</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+                      oncommand=&quot;gContextMenu.addDictionaries();&quot;/&gt;</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+        &lt;/menupopup&gt;</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+    &lt;/menu&gt;</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+</span>
<a href="#l1.63"></a><span id="l1.63">   &lt;/menupopup&gt;</span>
<a href="#l1.64"></a><span id="l1.64"> </span>
<a href="#l1.65"></a><span id="l1.65">   &lt;menupopup id=&quot;folderPaneContext&quot;</span>
<a href="#l1.66"></a><span id="l1.66">              onpopupshowing=&quot;return fillFolderPaneContextMenu();&quot;</span>
<a href="#l1.67"></a><span id="l1.67">              onpopuphiding=&quot;if (event.target == this) folderPaneOnPopupHiding();&quot;&gt;</span>
<a href="#l1.68"></a><span id="l1.68">     &lt;menuitem id=&quot;folderPaneContext-getMessages&quot;</span>
<a href="#l1.69"></a><span id="l1.69">               label=&quot;&amp;folderContextGetMessages.label;&quot;</span>
<a href="#l1.70"></a><span id="l1.70">               accesskey=&quot;&amp;folderContextGetMessages.accesskey;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/messenger.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/messenger.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -54,16 +54,18 @@</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> &lt;!DOCTYPE window [</span>
<a href="#l2.6"></a><span id="l2.6"> &lt;!ENTITY % brandDTD SYSTEM &quot;chrome://branding/locale/brand.dtd&quot; &gt;</span>
<a href="#l2.7"></a><span id="l2.7"> %brandDTD;</span>
<a href="#l2.8"></a><span id="l2.8"> &lt;!ENTITY % messengerDTD SYSTEM &quot;chrome://messenger/locale/messenger.dtd&quot; &gt;</span>
<a href="#l2.9"></a><span id="l2.9"> %messengerDTD;</span>
<a href="#l2.10"></a><span id="l2.10"> &lt;!ENTITY % customizeToolbarDTD SYSTEM &quot;chrome://global/locale/customizeToolbar.dtd&quot;&gt;</span>
<a href="#l2.11"></a><span id="l2.11"> %customizeToolbarDTD;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+&lt;!ENTITY % textcontextDTD SYSTEM &quot;chrome://global/locale/textcontext.dtd&quot;&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+%textcontextDTD;</span>
<a href="#l2.14"></a><span id="l2.14"> ]&gt;</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16"> &lt;!--</span>
<a href="#l2.17"></a><span id="l2.17">   - The 'what you think of when you think of thunderbird' window;</span>
<a href="#l2.18"></a><span id="l2.18">   -  3-pane view inside of tabs.</span>
<a href="#l2.19"></a><span id="l2.19">   --&gt;</span>
<a href="#l2.20"></a><span id="l2.20"> &lt;window id=&quot;messengerWindow&quot;</span>
<a href="#l2.21"></a><span id="l2.21">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/nsContextMenu.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/nsContextMenu.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -35,16 +35,25 @@</span>
<a href="#l3.4"></a><span id="l3.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l3.5"></a><span id="l3.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l3.6"></a><span id="l3.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l3.7"></a><span id="l3.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l3.8"></a><span id="l3.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l3.9"></a><span id="l3.9">  *</span>
<a href="#l3.10"></a><span id="l3.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/InlineSpellChecker.jsm&quot;);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+var gSpellChecker = new InlineSpellChecker();</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+function getDictionaryURL() {</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+  let formatter = Components.classes[&quot;@mozilla.org/toolkit/URLFormatterService;1&quot;]</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+                  .getService(Components.interfaces.nsIURLFormatter);</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+  return formatter.formatURLPref(&quot;spellchecker.dictionaries.download.url&quot;);</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+}</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+</span>
<a href="#l3.21"></a><span id="l3.21"> function nsContextMenu(aXulMenu) {</span>
<a href="#l3.22"></a><span id="l3.22">   this.target         = null;</span>
<a href="#l3.23"></a><span id="l3.23">   this.menu           = null;</span>
<a href="#l3.24"></a><span id="l3.24">   this.onTextInput    = false;</span>
<a href="#l3.25"></a><span id="l3.25">   this.onImage        = false;</span>
<a href="#l3.26"></a><span id="l3.26">   this.onLoadedImage  = false;</span>
<a href="#l3.27"></a><span id="l3.27">   this.onCanvas       = false;</span>
<a href="#l3.28"></a><span id="l3.28">   this.onVideo        = false;</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineat">@@ -90,18 +99,63 @@ nsContextMenu.prototype = {</span>
<a href="#l3.30"></a><span id="l3.30">     this.initItems();</span>
<a href="#l3.31"></a><span id="l3.31">   },</span>
<a href="#l3.32"></a><span id="l3.32">   initItems : function CM_initItems() {</span>
<a href="#l3.33"></a><span id="l3.33">     this.initSaveItems();</span>
<a href="#l3.34"></a><span id="l3.34">     this.initClipboardItems();</span>
<a href="#l3.35"></a><span id="l3.35">     this.initMediaPlayerItems();</span>
<a href="#l3.36"></a><span id="l3.36">     this.initBrowserItems();</span>
<a href="#l3.37"></a><span id="l3.37">     this.initMessageItems();</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+    this.initSpellingItems();</span>
<a href="#l3.39"></a><span id="l3.39">     this.initSeparators();</span>
<a href="#l3.40"></a><span id="l3.40">   },</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+  addDictionaries: function CM_addDictionaries() {</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+    openURL(getDictionaryURL());</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+  },</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+  initSpellingItems: function CM_initSpellingItems() {</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+    let canSpell = gSpellChecker.canSpellCheck;</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+    let onMisspelling = gSpellChecker.overMisspelling;</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+    this.showItem(&quot;mailContext-spell-check-enabled&quot;, canSpell);</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+    this.showItem(&quot;mailContext-spell-separator&quot;, canSpell || this.onEditableArea);</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+    if (canSpell) {</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+      document.getElementById(&quot;mailContext-spell-check-enabled&quot;)</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+              .setAttribute(&quot;checked&quot;, gSpellChecker.enabled);</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+    }</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+    this.showItem(&quot;mailContext-spell-add-to-dictionary&quot;, onMisspelling);</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+    // suggestion list</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+    this.showItem(&quot;mailContext-spell-suggestions-separator&quot;, onMisspelling);</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+    if (onMisspelling) {</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+      let addMenuItem =</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+        document.getElementById(&quot;mailContext-spell-add-to-dictionary&quot;);</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+      let suggestionCount =</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+        gSpellChecker.addSuggestionsToMenu(addMenuItem.parentNode,</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineplus">+                                           addMenuItem, 5);</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+      this.showItem(&quot;mailContext-spell-no-suggestions&quot;, suggestionCount == 0);</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+    } else {</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+      this.showItem(&quot;mailContext-spell-no-suggestions&quot;, false);</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+    }</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+    // dictionary list</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+    this.showItem(&quot;mailContext-spell-dictionaries&quot;, gSpellChecker.enabled);</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+    if (canSpell) {</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+      let dictMenu = document.getElementById(&quot;mailContext-spell-dictionaries-menu&quot;);</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+      let dictSep = document.getElementById(&quot;mailContext-spell-language-separator&quot;);</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+      gSpellChecker.addDictionaryListToMenu(dictMenu, dictSep);</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+      this.showItem(&quot;mailContext-spell-add-dictionaries-main&quot;, false);</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+    } else if (this.onEditableArea) {</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+      // when there is no spellchecker but we might be able to spellcheck</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+      // add the add to dictionaries item. This will ensure that people</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+      // with no dictionaries will be able to download them</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+      this.showItem(&quot;mailContext-spell-add-dictionaries-main&quot;, true);</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+    } else {</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+      this.showItem(&quot;mailContext-spell-add-dictionaries-main&quot;, false);</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+    }</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+  },</span>
<a href="#l3.85"></a><span id="l3.85">   initSaveItems : function CM_initSaveItems() {</span>
<a href="#l3.86"></a><span id="l3.86">     this.showItem(&quot;mailContext-savelink&quot;, this.onSaveableLink);</span>
<a href="#l3.87"></a><span id="l3.87">     this.showItem(&quot;mailContext-saveimage&quot;, this.onLoadedImage);</span>
<a href="#l3.88"></a><span id="l3.88">   },</span>
<a href="#l3.89"></a><span id="l3.89">   initClipboardItems : function CM_initClipboardItems() {</span>
<a href="#l3.90"></a><span id="l3.90">     // Copy depends on whether there is selected text.</span>
<a href="#l3.91"></a><span id="l3.91">     // Enabling this context menu item is now done through the global</span>
<a href="#l3.92"></a><span id="l3.92">     // command updating system.</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineat">@@ -286,28 +340,41 @@ nsContextMenu.prototype = {</span>
<a href="#l3.94"></a><span id="l3.94">   initSeparators: function CM_initSeparators() {</span>
<a href="#l3.95"></a><span id="l3.95">     const mailContextSeparators = [</span>
<a href="#l3.96"></a><span id="l3.96">       &quot;mailContext-sep-open-browser&quot;, &quot;mailContext-sep-link&quot;,</span>
<a href="#l3.97"></a><span id="l3.97">       &quot;mailContext-sep-open&quot;, &quot;mailContext-sep-open2&quot;,</span>
<a href="#l3.98"></a><span id="l3.98">       &quot;mailContext-sep-reply&quot;, &quot;paneContext-afterMove&quot;,</span>
<a href="#l3.99"></a><span id="l3.99">       &quot;mailContext-sep-afterTagAddNew&quot;, &quot;mailContext-sep-afterTagRemoveAll&quot;,</span>
<a href="#l3.100"></a><span id="l3.100">       &quot;mailContext-sep-afterMarkAllRead&quot;, &quot;mailContext-sep-afterMarkFlagged&quot;,</span>
<a href="#l3.101"></a><span id="l3.101">       &quot;mailContext-sep-afterMarkMenu&quot;, &quot;mailContext-sep-edit&quot;,</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-      &quot;mailContext-sep-copy&quot;, &quot;mailContext-sep-reportPhishing&quot;</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+      &quot;mailContext-sep-copy&quot;, &quot;mailContext-sep-reportPhishing&quot;,</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+      &quot;mailContext-spell-suggestions-separator&quot;, &quot;mailContext-spell-separator&quot;,</span>
<a href="#l3.105"></a><span id="l3.105">     ];</span>
<a href="#l3.106"></a><span id="l3.106">     mailContextSeparators.forEach(this.hideIfAppropriate, this);</span>
<a href="#l3.107"></a><span id="l3.107"> </span>
<a href="#l3.108"></a><span id="l3.108">     this.checkLastSeparator(this.menu);</span>
<a href="#l3.109"></a><span id="l3.109">   },</span>
<a href="#l3.110"></a><span id="l3.110"> </span>
<a href="#l3.111"></a><span id="l3.111">   /**</span>
<a href="#l3.112"></a><span id="l3.112">    * Set the nsContextMenu properties based on the selected node and</span>
<a href="#l3.113"></a><span id="l3.113">    * its ancestors.</span>
<a href="#l3.114"></a><span id="l3.114">    */</span>
<a href="#l3.115"></a><span id="l3.115">   setTarget : function CM_setTarget(aNode) {</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineplus">+    // Clear any old spellchecking items from the menu, this used to</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineplus">+    // be in the menu hiding code but wasn't getting called in all</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+    // situations. Here, we can ensure it gets cleaned up any time the</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+    // menu is shown. Note: must be before uninit because that clears the</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineplus">+    // internal vars</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineplus">+    // We also need to do that before we possibly bail because we just clicked</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineplus">+    // on some XUL node. Otherwise, dictionary choices just accumulate until we</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineplus">+    // right-click on some HTML element again.</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+    gSpellChecker.clearSuggestionsFromMenu();</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+    gSpellChecker.clearDictionaryListFromMenu();</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+    gSpellChecker.uninit();</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+</span>
<a href="#l3.128"></a><span id="l3.128">     const xulNS =</span>
<a href="#l3.129"></a><span id="l3.129">       &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;;</span>
<a href="#l3.130"></a><span id="l3.130">     if (aNode.namespaceURI == xulNS) {</span>
<a href="#l3.131"></a><span id="l3.131">       if (aNode.localName == &quot;treecol&quot;) {</span>
<a href="#l3.132"></a><span id="l3.132">         // The column header was clicked, show the column picker.</span>
<a href="#l3.133"></a><span id="l3.133">         let treecols = aNode.parentNode;</span>
<a href="#l3.134"></a><span id="l3.134">         let nodeList = document.getAnonymousNodes(treecols);</span>
<a href="#l3.135"></a><span id="l3.135">         let treeColPicker;</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineat">@@ -351,16 +418,21 @@ nsContextMenu.prototype = {</span>
<a href="#l3.137"></a><span id="l3.137">         if (request &amp;&amp; (request.imageStatus &amp; request.STATUS_SIZE_AVAILABLE))</span>
<a href="#l3.138"></a><span id="l3.138">           this.onLoadedImage = true;</span>
<a href="#l3.139"></a><span id="l3.139"> </span>
<a href="#l3.140"></a><span id="l3.140">         this.imageURL = this.target.currentURI.spec;</span>
<a href="#l3.141"></a><span id="l3.141">       } else if (this.target instanceof HTMLInputElement) {</span>
<a href="#l3.142"></a><span id="l3.142">         this.onTextInput = this.isTargetATextBox(this.target);</span>
<a href="#l3.143"></a><span id="l3.143">       } else if (this.target instanceof HTMLTextAreaElement) {</span>
<a href="#l3.144"></a><span id="l3.144">         this.onTextInput = true;</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+        if (!this.target.readOnly) {</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+          this.onEditableArea = true;</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+          gSpellChecker.init(this.target.QueryInterface(Components.interfaces.nsIDOMNSEditableElement).editor);</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+          gSpellChecker.initFromEvent(document.popupRangeParent, document.popupRangeOffset);</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+        }</span>
<a href="#l3.150"></a><span id="l3.150">       } else if (this.target instanceof HTMLCanvasElement) {</span>
<a href="#l3.151"></a><span id="l3.151">         this.onCanvas = true;</span>
<a href="#l3.152"></a><span id="l3.152">       } else if (this.target instanceof HTMLVideoElement) {</span>
<a href="#l3.153"></a><span id="l3.153">         this.onVideo = true;</span>
<a href="#l3.154"></a><span id="l3.154">         this.onPlayableMedia = true;</span>
<a href="#l3.155"></a><span id="l3.155">         this.mediaURL = this.target.currentSrc || this.target.src;</span>
<a href="#l3.156"></a><span id="l3.156">       } else if (this.target instanceof HTMLAudioElement) {</span>
<a href="#l3.157"></a><span id="l3.157">         this.onAudio = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.dtd</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.dtd</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -645,16 +645,20 @@ you can use these alternative items. Oth</span>
<a href="#l4.4"></a><span id="l4.4"> &lt;!ENTITY starredColumn.tooltip &quot;Click to sort by star&quot;&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> &lt;!ENTITY locationColumn.tooltip &quot;Click to sort by location&quot;&gt;</span>
<a href="#l4.6"></a><span id="l4.6"> &lt;!ENTITY idColumn.tooltip &quot;Click to sort by order received&quot;&gt;</span>
<a href="#l4.7"></a><span id="l4.7"> &lt;!ENTITY attachmentColumn.tooltip &quot;Click to sort by attachments&quot;&gt;</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9"> &lt;!-- Thread Pane Context Menu --&gt;</span>
<a href="#l4.10"></a><span id="l4.10"> &lt;!ENTITY contextOpenNewWindow.label &quot;Open Message in New Window&quot;&gt;</span>
<a href="#l4.11"></a><span id="l4.11"> &lt;!ENTITY contextOpenNewWindow.accesskey &quot;W&quot;&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+&lt;!-- The key potentially conflicts with cutCmd.accessKey which is defined in</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+     textcontext.dtd from toolkit. Right now, both menu items can't be visible</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+     at the same time, but should someone enable copy/paste of message, this key</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+     would probably need to be changed. --&gt;</span>
<a href="#l4.16"></a><span id="l4.16"> &lt;!ENTITY contextOpenNewTab.label &quot;Open Message in New Tab&quot;&gt;</span>
<a href="#l4.17"></a><span id="l4.17"> &lt;!ENTITY contextOpenNewTab.accesskey &quot;T&quot;&gt;</span>
<a href="#l4.18"></a><span id="l4.18"> &lt;!ENTITY contextOpenConversation.label &quot;Open Message in Conversation&quot;&gt;</span>
<a href="#l4.19"></a><span id="l4.19"> &lt;!ENTITY contextOpenConversation.accesskey &quot;n&quot;&gt;</span>
<a href="#l4.20"></a><span id="l4.20"> &lt;!ENTITY contextEditAsNew.label &quot;Edit As New…&quot;&gt;</span>
<a href="#l4.21"></a><span id="l4.21"> &lt;!ENTITY contextEditAsNew.accesskey &quot;E&quot;&gt;</span>
<a href="#l4.22"></a><span id="l4.22"> &lt;!ENTITY contextArchive.label &quot;Archive&quot;&gt;</span>
<a href="#l4.23"></a><span id="l4.23"> &lt;!ENTITY contextArchive.accesskey &quot;h&quot;&gt;</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineat">@@ -807,29 +811,25 @@ you can use these alternative items. Oth</span>
<a href="#l4.25"></a><span id="l4.25"> &lt;!ENTITY CopyNewsgroupName.accesskey &quot;C&quot;&gt;</span>
<a href="#l4.26"></a><span id="l4.26"> &lt;!ENTITY CopyNewsgroupURL.label &quot;Copy Newsgroup URL&quot;&gt;</span>
<a href="#l4.27"></a><span id="l4.27"> &lt;!ENTITY CopyNewsgroupURL.accesskey &quot;U&quot;&gt;</span>
<a href="#l4.28"></a><span id="l4.28"> &lt;!ENTITY CreateFilterFrom.label &quot;Create Filter From…&quot;&gt;</span>
<a href="#l4.29"></a><span id="l4.29"> &lt;!ENTITY CreateFilterFrom.accesskey &quot;F&quot;&gt;</span>
<a href="#l4.30"></a><span id="l4.30"> &lt;!ENTITY reportPhishingURL.label &quot;Report Email Scam&quot;&gt;</span>
<a href="#l4.31"></a><span id="l4.31"> &lt;!ENTITY reportPhishingURL.accesskey &quot;o&quot;&gt;</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+&lt;!-- Spell checker context menu items --&gt;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+&lt;!ENTITY spellAddDictionaries.label &quot;Add Dictionaries…&quot;&gt;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+&lt;!ENTITY spellAddDictionaries.accesskey &quot;A&quot;&gt;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+</span>
<a href="#l4.37"></a><span id="l4.37"> &lt;!-- Content Pane Context Menu --&gt;</span>
<a href="#l4.38"></a><span id="l4.38"> &lt;!ENTITY saveLinkAsCmd.label &quot;Save Link As…&quot;&gt;</span>
<a href="#l4.39"></a><span id="l4.39"> &lt;!ENTITY saveLinkAsCmd.accesskey &quot;k&quot;&gt;</span>
<a href="#l4.40"></a><span id="l4.40"> &lt;!ENTITY saveImageAsCmd.label &quot;Save Image As…&quot;&gt;</span>
<a href="#l4.41"></a><span id="l4.41"> &lt;!ENTITY saveImageAsCmd.accesskey &quot;v&quot;&gt;</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-&lt;!ENTITY cutCmd.label &quot;Cut&quot;&gt;</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-&lt;!ENTITY cutCmd.accesskey &quot;u&quot;&gt;</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-&lt;!ENTITY copyCmd.label &quot;Copy&quot;&gt;</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-&lt;!ENTITY copyCmd.accesskey &quot;C&quot;&gt;</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-&lt;!ENTITY pasteCmd.label &quot;Paste&quot;&gt;</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-&lt;!ENTITY pasteCmd.accesskey &quot;P&quot;&gt;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-&lt;!ENTITY selectAllCmd.label &quot;Select All&quot;&gt;</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-&lt;!ENTITY selectAllCmd.accesskey &quot;A&quot;&gt;</span>
<a href="#l4.50"></a><span id="l4.50"> &lt;!ENTITY copyLinkCmd.label &quot;Copy Link Location&quot;&gt;</span>
<a href="#l4.51"></a><span id="l4.51"> &lt;!ENTITY copyLinkCmd.accesskey &quot;C&quot;&gt;</span>
<a href="#l4.52"></a><span id="l4.52"> &lt;!ENTITY copyImageAllCmd.label &quot;Copy Image&quot;&gt;</span>
<a href="#l4.53"></a><span id="l4.53"> &lt;!ENTITY copyImageAllCmd.accesskey &quot;I&quot;&gt;</span>
<a href="#l4.54"></a><span id="l4.54"> &lt;!ENTITY copyEmailCmd.label &quot;Copy Email Address&quot;&gt;</span>
<a href="#l4.55"></a><span id="l4.55"> &lt;!ENTITY copyEmailCmd.accesskey &quot;E&quot;&gt;</span>
<a href="#l4.56"></a><span id="l4.56"> &lt;!ENTITY stopCmd.label &quot;Stop&quot;&gt;</span>
<a href="#l4.57"></a><span id="l4.57"> &lt;!ENTITY stopCmd.accesskey &quot;S&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/test/mozmill/content-tabs/html/whatsnew.html</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/html/whatsnew.html</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,9 +1,10 @@</span>
<a href="#l5.4"></a><span id="l5.4"> &lt;html&gt;</span>
<a href="#l5.5"></a><span id="l5.5">   &lt;head&gt;</span>
<a href="#l5.6"></a><span id="l5.6">     &lt;title&gt;What's New Content Test&lt;/title&gt; </span>
<a href="#l5.7"></a><span id="l5.7">     &lt;link rel=&quot;icon shortcut&quot; href=&quot;whatsnew.png&quot;/&gt;</span>
<a href="#l5.8"></a><span id="l5.8">   &lt;/head&gt;</span>
<a href="#l5.9"></a><span id="l5.9">   &lt;body bgcolor=&quot;#FFFFFF&quot;&gt;</span>
<a href="#l5.10"></a><span id="l5.10">     &lt;h1&gt;What's New Content Test&lt;/h1&gt;</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+    &lt;textarea&gt;Zombocom&lt;/textarea&gt;</span>
<a href="#l5.12"></a><span id="l5.12">   &lt;/body&gt;</span>
<a href="#l5.13"></a><span id="l5.13"> &lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/test/mozmill/content-tabs/test-about-support.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/test-about-support.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -210,23 +210,23 @@ function test_private_data() {</span>
<a href="#l6.4"></a><span id="l6.4">   let tab = open_about_support();</span>
<a href="#l6.5"></a><span id="l6.5">   let checkbox = content_tab_e(tab, &quot;check-show-private-data&quot;);</span>
<a href="#l6.6"></a><span id="l6.6">   // We use the profile button's div as an example of a public-only element, and</span>
<a href="#l6.7"></a><span id="l6.7">   // the profile directory display as an example of a private-only element.</span>
<a href="#l6.8"></a><span id="l6.8">   let privateElem = content_tab_e(tab, &quot;profile-dir-box&quot;);</span>
<a href="#l6.9"></a><span id="l6.9">   let publicElem = content_tab_e(tab, &quot;profile-dir-button-box&quot;);</span>
<a href="#l6.10"></a><span id="l6.10">   assert_true(!checkbox.checked,</span>
<a href="#l6.11"></a><span id="l6.11">               &quot;Private data checkbox shouldn't be checked by default&quot;);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  assert_element_visible(tab, publicElem);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-  assert_element_hidden(tab, privateElem);</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  assert_content_tab_element_visible(tab, publicElem);</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+  assert_content_tab_element_hidden(tab, privateElem);</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17">   // Now check the checkbox and see what happens</span>
<a href="#l6.18"></a><span id="l6.18">   checkbox.click();</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-  wait_for_element_display_value(tab, publicElem, &quot;none&quot;);</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-  wait_for_element_display_value(tab, privateElem, &quot;inline&quot;);</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+  wait_for_content_tab_element_display_value(tab, publicElem, &quot;none&quot;);</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+  wait_for_content_tab_element_display_value(tab, privateElem, &quot;inline&quot;);</span>
<a href="#l6.23"></a><span id="l6.23">   close_tab(tab);</span>
<a href="#l6.24"></a><span id="l6.24"> }</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26"> /**</span>
<a href="#l6.27"></a><span id="l6.27">  * Test (well, sort of) the copy to clipboard function with public data.</span>
<a href="#l6.28"></a><span id="l6.28">  */</span>
<a href="#l6.29"></a><span id="l6.29"> function test_copy_to_clipboard_public() {</span>
<a href="#l6.30"></a><span id="l6.30">   let tab = open_about_support();</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineat">@@ -264,17 +264,17 @@ function test_copy_to_clipboard_private(</span>
<a href="#l6.32"></a><span id="l6.32">     &quot;chrome://messenger/locale/aboutSupportMail.properties&quot;);</span>
<a href="#l6.33"></a><span id="l6.33">   let warningText = bundle.GetStringFromName(&quot;warningText&quot;);</span>
<a href="#l6.34"></a><span id="l6.34"> </span>
<a href="#l6.35"></a><span id="l6.35">   let tab = open_about_support();</span>
<a href="#l6.36"></a><span id="l6.36"> </span>
<a href="#l6.37"></a><span id="l6.37">   // Display private data.</span>
<a href="#l6.38"></a><span id="l6.38">   let privateElem = content_tab_e(tab, &quot;profile-dir-box&quot;);</span>
<a href="#l6.39"></a><span id="l6.39">   content_tab_e(tab, &quot;check-show-private-data&quot;).click();</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-  wait_for_element_display_value(tab, privateElem, &quot;inline&quot;);</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+  wait_for_content_tab_element_display_value(tab, privateElem, &quot;inline&quot;);</span>
<a href="#l6.42"></a><span id="l6.42"> </span>
<a href="#l6.43"></a><span id="l6.43">   // To avoid destroying the current contents of the clipboard, instead of</span>
<a href="#l6.44"></a><span id="l6.44">   // actually copying to it, we just retrieve what would have been copied to it</span>
<a href="#l6.45"></a><span id="l6.45">   let transferable = tab.browser.contentWindow.getClipboardTransferable();</span>
<a href="#l6.46"></a><span id="l6.46">   for (let [, flavor] in Iterator([&quot;text/html&quot;, &quot;text/unicode&quot;])) {</span>
<a href="#l6.47"></a><span id="l6.47">     let data = {};</span>
<a href="#l6.48"></a><span id="l6.48">     transferable.getTransferData(flavor, data, {});</span>
<a href="#l6.49"></a><span id="l6.49">     let text = data.value.data;</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineat">@@ -338,17 +338,17 @@ function test_send_via_email_private() {</span>
<a href="#l6.51"></a><span id="l6.51">     &quot;chrome://messenger/locale/aboutSupportMail.properties&quot;);</span>
<a href="#l6.52"></a><span id="l6.52">   let warningText = bundle.GetStringFromName(&quot;warningText&quot;);</span>
<a href="#l6.53"></a><span id="l6.53"> </span>
<a href="#l6.54"></a><span id="l6.54">   let tab = open_about_support();</span>
<a href="#l6.55"></a><span id="l6.55"> </span>
<a href="#l6.56"></a><span id="l6.56">   // Display private data.</span>
<a href="#l6.57"></a><span id="l6.57">   let privateElem = content_tab_e(tab, &quot;profile-dir-box&quot;);</span>
<a href="#l6.58"></a><span id="l6.58">   content_tab_e(tab, &quot;check-show-private-data&quot;).click();</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-  wait_for_element_display_value(tab, privateElem, &quot;inline&quot;);</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+  wait_for_content_tab_element_display_value(tab, privateElem, &quot;inline&quot;);</span>
<a href="#l6.61"></a><span id="l6.61"> </span>
<a href="#l6.62"></a><span id="l6.62">   let cwc = open_send_via_email(tab);</span>
<a href="#l6.63"></a><span id="l6.63"> </span>
<a href="#l6.64"></a><span id="l6.64">   let contentFrame = cwc.e(&quot;content-frame&quot;);</span>
<a href="#l6.65"></a><span id="l6.65">   let text = contentFrame.contentDocument.body.innerHTML;</span>
<a href="#l6.66"></a><span id="l6.66"> </span>
<a href="#l6.67"></a><span id="l6.67">   for (let [, str] in Iterator(ABOUT_SUPPORT_STRINGS)) {</span>
<a href="#l6.68"></a><span id="l6.68">     if (text.indexOf(str) == -1)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/test/mozmill/content-tabs/test-content-tab.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/test-content-tab.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -36,18 +36,17 @@</span>
<a href="#l7.4"></a><span id="l7.4">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> var MODULE_NAME = 'test-content-tab';</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l7.9"></a><span id="l7.9"> var MODULE_REQUIRES = ['folder-display-helpers', 'content-tab-helpers'];</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> var controller = {};</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-Components.utils.import('resource://mozmill/modules/controller.js', controller)</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+Components.utils.import('resource://mozmill/modules/controller.js', controller);</span>
<a href="#l7.15"></a><span id="l7.15"> var mozmill = {};</span>
<a href="#l7.16"></a><span id="l7.16"> Components.utils.import('resource://mozmill/modules/mozmill.js', mozmill);</span>
<a href="#l7.17"></a><span id="l7.17"> var elementslib = {};</span>
<a href="#l7.18"></a><span id="l7.18"> Components.utils.import('resource://mozmill/modules/elementslib.js', elementslib);</span>
<a href="#l7.19"></a><span id="l7.19"> Components.utils.import('resource://gre/modules/Services.jsm');</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21"> // RELATIVE_ROOT messes with the collector, so we have to bring the path back</span>
<a href="#l7.22"></a><span id="l7.22"> // so we get the right path for the resources.</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineat">@@ -56,16 +55,18 @@ Components.utils.import('resource://gre/</span>
<a href="#l7.24"></a><span id="l7.24"> var url = collector.addHttpResource('../content-tabs/html', '');</span>
<a href="#l7.25"></a><span id="l7.25"> var whatsUrl = url + &quot;whatsnew.html&quot;;</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27"> var setupModule = function (module) {</span>
<a href="#l7.28"></a><span id="l7.28">   let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l7.29"></a><span id="l7.29">   fdh.installInto(module);</span>
<a href="#l7.30"></a><span id="l7.30">   let cth = collector.getModule('content-tab-helpers');</span>
<a href="#l7.31"></a><span id="l7.31">   cth.installInto(module);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  let dh = collector.getModule('dom-helpers');</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+  dh.installInto(module);</span>
<a href="#l7.34"></a><span id="l7.34"> };</span>
<a href="#l7.35"></a><span id="l7.35"> </span>
<a href="#l7.36"></a><span id="l7.36"> function test_content_tab_open() {</span>
<a href="#l7.37"></a><span id="l7.37">   // Set the pref so that what's new opens a local url</span>
<a href="#l7.38"></a><span id="l7.38">   Services.prefs.setCharPref(&quot;mailnews.start_page.override_url&quot;, whatsUrl);</span>
<a href="#l7.39"></a><span id="l7.39"> </span>
<a href="#l7.40"></a><span id="l7.40">   let tab = open_content_tab_with_click(mc.menus.helpMenu.whatsNew);</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42" class="difflineat">@@ -74,16 +75,55 @@ function test_content_tab_open() {</span>
<a href="#l7.43"></a><span id="l7.43">   // Check the location of the what's new image, this is via the link element</span>
<a href="#l7.44"></a><span id="l7.44">   // and therefore should be set and not favicon.png.</span>
<a href="#l7.45"></a><span id="l7.45">   assert_content_tab_has_favicon(tab, url + &quot;whatsnew.png&quot;);</span>
<a href="#l7.46"></a><span id="l7.46"> </span>
<a href="#l7.47"></a><span id="l7.47">   // Check that window.content is set up correctly wrt content-primary and</span>
<a href="#l7.48"></a><span id="l7.48">   // content-targetable.</span>
<a href="#l7.49"></a><span id="l7.49">   if (mc.window.content.location != whatsUrl)</span>
<a href="#l7.50"></a><span id="l7.50">     throw new Error(&quot;window.content is not set to the url loaded, incorrect type=\&quot;...\&quot;?&quot;);</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+}</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+/**</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+ * Just make sure that the context menu does what we expect in content tabs wrt.</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+ * spell checking options.</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+ */</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+function test_spellcheck_in_content_tabs() {</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+  let tabmail = mc.tabmail;</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+  let w = tabmail.selectedTab.browser.contentWindow;</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+  let textarea = w.document.getElementsByTagName(&quot;textarea&quot;)[0];</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+  // Test a few random items</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+  mc.rightClick(new elementslib.Elem(textarea));</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+  assert_element_visible(&quot;mailContext-spell-dictionaries&quot;);</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+  assert_element_visible(&quot;mailContext-spell-check-enabled&quot;);</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+  assert_element_not_visible(&quot;mailContext-replySender&quot;); // we're in a content tab!</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+  close_popup();</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+  // Different test</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+  mc.rightClick(new elementslib.Elem(w.document.body.firstElementChild));</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+  assert_element_not_visible(&quot;mailContext-spell-dictionaries&quot;);</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+  assert_element_not_visible(&quot;mailContext-spell-check-enabled&quot;);</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineplus">+  close_popup();</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineplus">+</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+  // Right-click on &quot;zombocom&quot; and add to dictionary</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+  EventUtils.synthesizeMouse(textarea, 5, 5,</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+                             {type: &quot;contextmenu&quot;, button: 2}, w);</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+  let suggestions = mc.window.document.getElementsByClassName(&quot;spell-suggestion&quot;);</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+  assert_true(suggestions.length &gt; 0, &quot;What, is zombocom a registered word now?&quot;);</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineplus">+  mc.click(mc.eid(&quot;mailContext-spell-add-to-dictionary&quot;));</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+  close_popup();</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineplus">+  // Now check we don't have any suggestionss</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineplus">+  EventUtils.synthesizeMouse(textarea, 5, 5,</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+                             {type: &quot;contextmenu&quot;, button: 2}, w);</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+  let suggestions = mc.window.document.getElementsByClassName(&quot;spell-suggestion&quot;);</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineplus">+  assert_true(suggestions.length == 0, &quot;But I just taught you this word!&quot;);</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+  close_popup();</span>
<a href="#l7.90"></a><span id="l7.90"> }</span>
<a href="#l7.91"></a><span id="l7.91"> </span>
<a href="#l7.92"></a><span id="l7.92"> function test_content_tab_open_same() {</span>
<a href="#l7.93"></a><span id="l7.93">   let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l7.94"></a><span id="l7.94"> </span>
<a href="#l7.95"></a><span id="l7.95">   mc.click(new elementslib.Elem(mc.menus.helpMenu.whatsNew));</span>
<a href="#l7.96"></a><span id="l7.96"> </span>
<a href="#l7.97"></a><span id="l7.97">   controller.sleep(0);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-content-tab-helpers.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-content-tab-helpers.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -76,20 +76,20 @@ function installInto(module) {</span>
<a href="#l8.4"></a><span id="l8.4">   module.open_content_tab_with_url = open_content_tab_with_url;</span>
<a href="#l8.5"></a><span id="l8.5">   module.open_content_tab_with_click = open_content_tab_with_click;</span>
<a href="#l8.6"></a><span id="l8.6">   module.plan_for_content_tab_load = plan_for_content_tab_load;</span>
<a href="#l8.7"></a><span id="l8.7">   module.wait_for_content_tab_load = wait_for_content_tab_load;</span>
<a href="#l8.8"></a><span id="l8.8">   module.assert_content_tab_has_url = assert_content_tab_has_url;</span>
<a href="#l8.9"></a><span id="l8.9">   module.assert_content_tab_has_favicon = assert_content_tab_has_favicon;</span>
<a href="#l8.10"></a><span id="l8.10">   module.content_tab_e = content_tab_e;</span>
<a href="#l8.11"></a><span id="l8.11">   module.content_tab_eid = content_tab_eid;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  module.get_element_display = get_element_display;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-  module.assert_element_hidden = assert_element_hidden;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-  module.assert_element_visible = assert_element_visible;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-  module.wait_for_element_display_value = wait_for_element_display_value;</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+  module.get_content_tab_element_display = get_content_tab_element_display;</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+  module.assert_content_tab_element_hidden = assert_content_tab_element_hidden;</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+  module.assert_content_tab_element_visible = assert_content_tab_element_visible;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+  module.wait_for_content_tab_element_display_value = wait_for_content_tab_element_display_value;</span>
<a href="#l8.20"></a><span id="l8.20">   module.assert_content_tab_text_present = assert_content_tab_text_present;</span>
<a href="#l8.21"></a><span id="l8.21">   module.assert_content_tab_text_absent = assert_content_tab_text_absent;</span>
<a href="#l8.22"></a><span id="l8.22"> }</span>
<a href="#l8.23"></a><span id="l8.23"> </span>
<a href="#l8.24"></a><span id="l8.24"> /**</span>
<a href="#l8.25"></a><span id="l8.25">  * Opens a content tab with the given URL.</span>
<a href="#l8.26"></a><span id="l8.26">  *</span>
<a href="#l8.27"></a><span id="l8.27">  * @param aURL The URL to load (string).</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineat">@@ -230,49 +230,49 @@ function assert_content_tab_has_favicon(</span>
<a href="#l8.29"></a><span id="l8.29">  */</span>
<a href="#l8.30"></a><span id="l8.30"> function content_tab_eid(aTab, aId) {</span>
<a href="#l8.31"></a><span id="l8.31">   return new elib.Elem(content_tab_e(aTab, aId));</span>
<a href="#l8.32"></a><span id="l8.32"> }</span>
<a href="#l8.33"></a><span id="l8.33"> </span>
<a href="#l8.34"></a><span id="l8.34"> /**</span>
<a href="#l8.35"></a><span id="l8.35">  * Returns the current &quot;display&quot; style property of an element.</span>
<a href="#l8.36"></a><span id="l8.36">  */</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-function get_element_display(aTab, aElem) {</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+function get_content_tab_element_display(aTab, aElem) {</span>
<a href="#l8.39"></a><span id="l8.39">   let style = aTab.browser.contentWindow.getComputedStyle(aElem);</span>
<a href="#l8.40"></a><span id="l8.40">   return style.getPropertyValue(&quot;display&quot;);</span>
<a href="#l8.41"></a><span id="l8.41"> }</span>
<a href="#l8.42"></a><span id="l8.42"> </span>
<a href="#l8.43"></a><span id="l8.43"> /**</span>
<a href="#l8.44"></a><span id="l8.44">  * Asserts that the given element is hidden from view on the page.</span>
<a href="#l8.45"></a><span id="l8.45">  */</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-function assert_element_hidden(aTab, aElem) {</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-  let display = get_element_display(aTab, aElem);</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+function assert_content_tab_element_hidden(aTab, aElem) {</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+  let display = get_content_tab_element_display(aTab, aElem);</span>
<a href="#l8.50"></a><span id="l8.50">   if (display != &quot;none&quot;) {</span>
<a href="#l8.51"></a><span id="l8.51">     mark_failure([&quot;Element&quot;, aElem, &quot;should be hidden but has display&quot;, display,</span>
<a href="#l8.52"></a><span id="l8.52">                   &quot;instead&quot;]);</span>
<a href="#l8.53"></a><span id="l8.53">   }</span>
<a href="#l8.54"></a><span id="l8.54"> }</span>
<a href="#l8.55"></a><span id="l8.55"> </span>
<a href="#l8.56"></a><span id="l8.56"> /**</span>
<a href="#l8.57"></a><span id="l8.57">  * Asserts that the given element is visible on the page.</span>
<a href="#l8.58"></a><span id="l8.58">  */</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-function assert_element_visible(aTab, aElem) {</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-  let display = get_element_display(aTab, aElem);</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+function assert_content_tab_element_visible(aTab, aElem) {</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+  let display = get_content_tab_element_display(aTab, aElem);</span>
<a href="#l8.63"></a><span id="l8.63">   if (display != &quot;inline&quot;) {</span>
<a href="#l8.64"></a><span id="l8.64">     mark_failure([&quot;Element&quot;, aElem, &quot;should be visible but has display&quot;, display,</span>
<a href="#l8.65"></a><span id="l8.65">                   &quot;instead&quot;]);</span>
<a href="#l8.66"></a><span id="l8.66">   }</span>
<a href="#l8.67"></a><span id="l8.67"> }</span>
<a href="#l8.68"></a><span id="l8.68"> </span>
<a href="#l8.69"></a><span id="l8.69"> /**</span>
<a href="#l8.70"></a><span id="l8.70">  * Waits for the element's display property to be the given value.</span>
<a href="#l8.71"></a><span id="l8.71">  */</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-function wait_for_element_display_value(aTab, aElem, aValue) {</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+function wait_for_content_tab_element_display_value(aTab, aElem, aValue) {</span>
<a href="#l8.74"></a><span id="l8.74">   function isValue() {</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineminus">-    return get_element_display(aTab, aElem) == aValue;</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+    return get_content_tab_element_display(aTab, aElem) == aValue;</span>
<a href="#l8.77"></a><span id="l8.77">   }</span>
<a href="#l8.78"></a><span id="l8.78">   if (!controller.waitForEval(&quot;subject()&quot;, NORMAL_TIMEOUT, FAST_INTERVAL,</span>
<a href="#l8.79"></a><span id="l8.79">                               isValue)) {</span>
<a href="#l8.80"></a><span id="l8.80">     mark_failure([&quot;Timeout waiting for element&quot;, aElem, &quot;to have display value&quot;,</span>
<a href="#l8.81"></a><span id="l8.81">                   aValue]);</span>
<a href="#l8.82"></a><span id="l8.82">   }</span>
<a href="#l8.83"></a><span id="l8.83"> }</span>
<a href="#l8.84"></a><span id="l8.84"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-dom-helpers.js</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,113 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+ *   Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+ *</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+ *</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+ * License.</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+ *</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+ * The Original Code is Thunderbird Mail Client.</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+ *</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+ * The Initial Developer of the Original Code is the Mozilla Foundation.</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+ *</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+ * Contributor(s):</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+ *   Jonathan Protzenko &lt;jonathan.protzenko@gmail.com&gt;</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+ *</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+ *</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+var Ci = Components.interfaces;</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+var Cc = Components.classes;</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+var Cu = Components.utils;</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+var elib = {};</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+Cu.import('resource://mozmill/modules/elementslib.js', elib);</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+var mozmill = {};</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+Cu.import('resource://mozmill/modules/mozmill.js', mozmill);</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+var controller = {};</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+Cu.import('resource://mozmill/modules/controller.js', controller);</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+const MODULE_NAME = 'dom-helpers';</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+const RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+// we need this for the main controller</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+const MODULE_REQUIRES = ['folder-display-helpers'];</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+const NORMAL_TIMEOUT = 6000;</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+const FAST_TIMEOUT = 1000;</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+const FAST_INTERVAL = 100;</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+var folderDisplayHelper;</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+var mc;</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+// logHelper (and therefore folderDisplayHelper) exports</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+var mark_failure;</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+function setupModule() {</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+  folderDisplayHelper = collector.getModule('folder-display-helpers');</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+  mc = folderDisplayHelper.mc;</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+  mark_failure = folderDisplayHelper.mark_failure;</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+}</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+function installInto(module) {</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+  setupModule();</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+  // Now copy helper functions</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+  module.assert_element_visible = assert_element_visible;</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+  module.assert_element_not_visible = assert_element_not_visible;</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+}</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+/**</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+ * This function takes either a string or an elementlibs.Elem, and returns</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+ * whether it is hidden or not (simply by poking at its hidden property). It</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+ * doesn't try to do anything smart, like is it not into view, or whatever.</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+ *</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+ * @param aElt The element to query.</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+ * @return Whether the element is visible or not.</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineplus">+ */</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineplus">+function element_visible(aElt) {</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineplus">+  let e;</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineplus">+  if (typeof aElt == &quot;string&quot;) {</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineplus">+    e = mc.eid(aElt);</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+  } else {</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+    e = aElt;</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineplus">+  }</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineplus">+  return !e.getNode().hidden;</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineplus">+}</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineplus">+</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineplus">+/**</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineplus">+ * Assert that en element's visible.</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineplus">+ * @param aElt The element, an ID or an elementlibs.Elem</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineplus">+ * @param aWhy The error message in case of failure</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineplus">+ */</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+function assert_element_visible(aElt, aWhy) {</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+  folderDisplayHelper.assert_true(element_visible(aElt), aWhy);</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineplus">+}</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineplus">+</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineplus">+/**</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineplus">+ * Assert that en element's not visible.</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineplus">+ * @param aElt The element, an ID or an elementlibs.Elem</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineplus">+ * @param aWhy The error message in case of failure</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineplus">+ */</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineplus">+function assert_element_not_visible(aElt, aWhy) {</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineplus">+  folderDisplayHelper.assert_true(!element_visible(aElt), aWhy);</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineplus">+}</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

