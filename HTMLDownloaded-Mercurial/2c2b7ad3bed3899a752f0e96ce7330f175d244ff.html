<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 11428:2c2b7ad3bed3899a752f0e96ce7330f175d244ff</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 2c2b7ad3bed3899a752f0e96ce7330f175d244ff" />
<meta property="og:url" content="/comm-central/rev/2c2b7ad3bed3899a752f0e96ce7330f175d244ff" />
<meta property="og:description" content="Part of bug 511079. If send in background is turned on, don't send in background if the compose window is the last window open on Linux and Windows, to ensure that the message is sent. r=Standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 2c2b7ad3bed3899a752f0e96ce7330f175d244ff 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/2c2b7ad3bed3899a752f0e96ce7330f175d244ff">shortlog</a> |
<a href="/comm-central/log/2c2b7ad3bed3899a752f0e96ce7330f175d244ff">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/2c2b7ad3bed3899a752f0e96ce7330f175d244ff">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/2c2b7ad3bed3899a752f0e96ce7330f175d244ff">files</a> |
changeset |
<a href="/comm-central/raw-rev/2c2b7ad3bed3899a752f0e96ce7330f175d244ff">raw</a>  | <a href="/comm-central/archive/2c2b7ad3bed3899a752f0e96ce7330f175d244ff.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Part of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=511079">bug 511079</a>. If send in background is turned on, don't send in background if the compose window is the last window open on Linux and Windows, to ensure that the message is sent. r=Standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#97;&#118;&#105;&#100;&#32;&#66;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#100;&#97;&#118;&#105;&#100;&#98;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 01 Nov 2012 13:58:51 +0000</td></tr>

<tr>
 <td>changeset 11428</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/2c2b7ad3bed3899a752f0e96ce7330f175d244ff">2c2b7ad3bed3899a752f0e96ce7330f175d244ff</a></td>
</tr>



<tr>
<td>parent 11427</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9494ce4e9eff564721f4f13924b0910119a00323">9494ce4e9eff564721f4f13924b0910119a00323</a>
</td>
</tr>

<tr>
<td>child 11429</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d94324488af96b29092578783c603a6aba2e6a8b">d94324488af96b29092578783c603a6aba2e6a8b</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=2c2b7ad3bed3899a752f0e96ce7330f175d244ff">8541</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 01 Nov 2012 13:59:06 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@2c2b7ad3bed3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2c2b7ad3bed3899a752f0e96ce7330f175d244ff">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2c2b7ad3bed3899a752f0e96ce7330f175d244ff&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2c2b7ad3bed3899a752f0e96ce7330f175d244ff&newProject=comm-central&newRevision=2c2b7ad3bed3899a752f0e96ce7330f175d244ff&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2c2b7ad3bed3899a752f0e96ce7330f175d244ff&newProject=comm-central&newRevision=2c2b7ad3bed3899a752f0e96ce7330f175d244ff&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2c2b7ad3bed3899a752f0e96ce7330f175d244ff&newProject=comm-central&newRevision=2c2b7ad3bed3899a752f0e96ce7330f175d244ff&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=511079">511079</a></td></tr>




</table></div>

<div class="page_body description">Part of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=511079">bug 511079</a>. If send in background is turned on, don't send in background if the compose window is the last window open on Linux and Windows, to ensure that the message is sent. r=Standard8</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2c2b7ad3bed3899a752f0e96ce7330f175d244ff/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2c2b7ad3bed3899a752f0e96ce7330f175d244ff/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/2c2b7ad3bed3899a752f0e96ce7330f175d244ff/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/2c2b7ad3bed3899a752f0e96ce7330f175d244ff/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/2c2b7ad3bed3899a752f0e96ce7330f175d244ff/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/2c2b7ad3bed3899a752f0e96ce7330f175d244ff/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -2936,19 +2936,27 @@ function CheckValidEmailAddress(to, cc, </span>
<a href="#l1.4"></a><span id="l1.4">     return false;</span>
<a href="#l1.5"></a><span id="l1.5">   }</span>
<a href="#l1.6"></a><span id="l1.6">   return true;</span>
<a href="#l1.7"></a><span id="l1.7"> }</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> function SendMessage()</span>
<a href="#l1.10"></a><span id="l1.10"> {</span>
<a href="#l1.11"></a><span id="l1.11">   let sendInBackground =</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-              .getService(Components.interfaces.nsIPrefBranch)</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-              .getBoolPref(&quot;mailnews.sendInBackground&quot;);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    Services.prefs.getBoolPref(&quot;mailnews.sendInBackground&quot;);</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+  if (sendInBackground &amp;&amp; !Application.platformIsMac) {</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+    let enumerator = Services.wm.getEnumerator(null);</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+    let count = 0;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+    while (enumerator.hasMoreElements() &amp;&amp; count &lt; 2) {</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+      let win = enumerator.getNext();</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+      count++;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+    }</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+    if (count == 1)</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+      sendInBackground = false;</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+  }</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">   GenericSendMessage(sendInBackground ?</span>
<a href="#l1.28"></a><span id="l1.28">                      nsIMsgCompDeliverMode.Background :</span>
<a href="#l1.29"></a><span id="l1.29">                      nsIMsgCompDeliverMode.Now);</span>
<a href="#l1.30"></a><span id="l1.30"> }</span>
<a href="#l1.31"></a><span id="l1.31"> </span>
<a href="#l1.32"></a><span id="l1.32"> function SendMessageWithCheck()</span>
<a href="#l1.33"></a><span id="l1.33"> {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

