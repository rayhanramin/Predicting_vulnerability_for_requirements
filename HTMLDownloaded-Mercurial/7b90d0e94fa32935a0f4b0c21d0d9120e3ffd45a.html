<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29162:7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a" />
<meta property="og:url" content="/comm-central/rev/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a" />
<meta property="og:description" content="Bug 1626066 - Replace gLastShownCalendarView global variable with an object. r=darktrojan" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a">shortlog</a> |
<a href="/comm-central/log/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a">files</a> |
changeset |
<a href="/comm-central/raw-rev/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a">raw</a>  | <a href="/comm-central/archive/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1626066">Bug 1626066</a> - Replace gLastShownCalendarView global variable with an object. r=darktrojan
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#97;&#117;&#108;&#32;&#77;&#111;&#114;&#114;&#105;&#115;&#32;&#60;&#112;&#97;&#117;&#108;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 02 Apr 2020 13:42:10 +0300</td></tr>

<tr>
 <td>changeset 29162</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a">7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a</a></td>
</tr>



<tr>
<td>parent 29161</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c368a253924a4515cb915d17715a0a154bf685f9">c368a253924a4515cb915d17715a0a154bf685f9</a>
</td>
</tr>

<tr>
<td>child 29163</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e9593a4b546ce716c4389b54307d4152dbd5791f">e9593a4b546ce716c4389b54307d4152dbd5791f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a">17231</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Thu, 02 Apr 2020 10:45:36 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0c36d6c1e2e9 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0c36d6c1e2e922266833edeb49ca1f77b30a2012">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0c36d6c1e2e922266833edeb49ca1f77b30a2012&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0c36d6c1e2e922266833edeb49ca1f77b30a2012&newProject=comm-central&newRevision=43a129b74441061e812b31cf0b40fa59205f5dee&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0c36d6c1e2e922266833edeb49ca1f77b30a2012&newProject=comm-central&newRevision=43a129b74441061e812b31cf0b40fa59205f5dee&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0c36d6c1e2e922266833edeb49ca1f77b30a2012&newProject=comm-central&newRevision=43a129b74441061e812b31cf0b40fa59205f5dee&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28darktrojan%29&revcount=50">darktrojan</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1626066">1626066</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1626066">Bug 1626066</a> - Replace gLastShownCalendarView global variable with an object. r=darktrojan

If we want to use it in more than one file then it needs to
become an eslint global variable, but then it cannot be changed
according to eslint rules. But if it's a global object we can
call its methods without breaking any rules.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/base/content/calendar-views-utils.js">calendar/base/content/calendar-views-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/base/content/calendar-views-utils.js">file</a> |
<a href="/comm-central/annotate/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/base/content/calendar-views-utils.js">annotate</a> |
<a href="/comm-central/diff/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/base/content/calendar-views-utils.js">diff</a> |
<a href="/comm-central/comparison/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/base/content/calendar-views-utils.js">comparison</a> |
<a href="/comm-central/log/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/base/content/calendar-views-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/lightning/content/messenger-overlay-sidebar.js">calendar/lightning/content/messenger-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/lightning/content/messenger-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/lightning/content/messenger-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/lightning/content/messenger-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/lightning/content/messenger-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/7b90d0e94fa32935a0f4b0c21d0d9120e3ffd45a/calendar/lightning/content/messenger-overlay-sidebar.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-views-utils.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-views-utils.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.5"></a><span id="l1.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.6"></a><span id="l1.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> /* exported switchToView, getSelectedDay, scheduleMidnightUpdate, minimonthPick,</span>
<a href="#l1.9"></a><span id="l1.9">  *          observeViewDaySelect, toggleOrientation,</span>
<a href="#l1.10"></a><span id="l1.10">  *          toggleWorkdaysOnly, toggleTasksInView, toggleShowCompletedInView,</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineminus">- *          goToDate, getLastCalendarView, deleteSelectedEvents,</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+ *          goToDate, gLastShownCalendarView, deleteSelectedEvents,</span>
<a href="#l1.13"></a><span id="l1.13">  *          editSelectedEvents, selectAllEvents, calendarNavigationBar</span>
<a href="#l1.14"></a><span id="l1.14">  */</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> /* import-globals-from calendar-chrome-startup.js */</span>
<a href="#l1.17"></a><span id="l1.17"> /* import-globals-from calendar-item-editing.js */</span>
<a href="#l1.18"></a><span id="l1.18"> /* global gCurrentMode */</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> var { cal } = ChromeUtils.import(&quot;resource:///modules/calendar/calUtils.jsm&quot;);</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -508,37 +508,48 @@ function toggleShowCompletedInView() {</span>
<a href="#l1.22"></a><span id="l1.22">  *</span>
<a href="#l1.23"></a><span id="l1.23">  * @param date     The date to go.</span>
<a href="#l1.24"></a><span id="l1.24">  */</span>
<a href="#l1.25"></a><span id="l1.25"> function goToDate(date) {</span>
<a href="#l1.26"></a><span id="l1.26">   getMinimonth().value = cal.dtz.dateTimeToJsDate(date);</span>
<a href="#l1.27"></a><span id="l1.27">   currentView().goToDay(date);</span>
<a href="#l1.28"></a><span id="l1.28"> }</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-/**</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">- * Returns the calendar view that was selected before restart, or the current</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">- * calendar view if it has already been set in this session</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">- *</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">- * @return          The last calendar view.</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">- */</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-function getLastCalendarView() {</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-  if (Services.xulStore.hasValue(document.location.href, &quot;view-deck&quot;, &quot;selectedIndex&quot;)) {</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-    let deck = getViewDeck();</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-    let selectedIndex = Services.xulStore.getValue(</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-      document.location.href,</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-      &quot;view-deck&quot;,</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-      &quot;selectedIndex&quot;</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-    );</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-    let viewNode = deck.children[selectedIndex];</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-    return viewNode.id.replace(/-view/, &quot;&quot;);</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-  }</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+var gLastShownCalendarView = {</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+  _lastView: null,</span>
<a href="#l1.49"></a><span id="l1.49"> </span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-  // No deck item was selected beforehand, default to week view.</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-  return &quot;week&quot;;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-}</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+  /**</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+   * Returns the calendar view that was selected before restart, or the current</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+   * calendar view if it has already been set in this session.</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+   *</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+   * @return {string} The last calendar view.</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+   */</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+  get() {</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+    if (!this._lastView) {</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+      if (Services.xulStore.hasValue(document.location.href, &quot;view-deck&quot;, &quot;selectedIndex&quot;)) {</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+        let deck = getViewDeck();</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+        let selectedIndex = Services.xulStore.getValue(</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+          document.location.href,</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+          &quot;view-deck&quot;,</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+          &quot;selectedIndex&quot;</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+        );</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+        let viewNode = deck.children[selectedIndex];</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+        this._lastView = viewNode.id.replace(/-view/, &quot;&quot;);</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+      } else {</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+        // No deck item was selected beforehand, default to week view.</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+        this._lastView = &quot;week&quot;;</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+      }</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+    }</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+    return this._lastView;</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+  },</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+  set(view) {</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+    this._lastView = view;</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+  },</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+};</span>
<a href="#l1.82"></a><span id="l1.82"> </span>
<a href="#l1.83"></a><span id="l1.83"> /**</span>
<a href="#l1.84"></a><span id="l1.84">  * Deletes items currently selected in the view and clears selection.</span>
<a href="#l1.85"></a><span id="l1.85">  */</span>
<a href="#l1.86"></a><span id="l1.86"> function deleteSelectedEvents() {</span>
<a href="#l1.87"></a><span id="l1.87">   let selectedItems = currentView().getSelectedItems();</span>
<a href="#l1.88"></a><span id="l1.88">   calendarViewController.deleteOccurrences(selectedItems, false, false);</span>
<a href="#l1.89"></a><span id="l1.89">   // clear selection</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -8,22 +8,22 @@</span>
<a href="#l2.4"></a><span id="l2.4">  *          rescheduleInvitationsUpdate, switchCalendarView</span>
<a href="#l2.5"></a><span id="l2.5">  */</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> /* import-globals-from ../../base/content/calendar-command-controller.js */</span>
<a href="#l2.8"></a><span id="l2.8"> /* import-globals-from ../../base/content/calendar-invitations-manager.js */</span>
<a href="#l2.9"></a><span id="l2.9"> /* import-globals-from ../../base/content/today-pane.js */</span>
<a href="#l2.10"></a><span id="l2.10"> /* import-globals-from lightning-item-panel.js */</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+/* globals gLastShownCalendarView */</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+</span>
<a href="#l2.14"></a><span id="l2.14"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.15"></a><span id="l2.15"> var { AddonManager } = ChromeUtils.import(&quot;resource://gre/modules/AddonManager.jsm&quot;);</span>
<a href="#l2.16"></a><span id="l2.16"> var { cal } = ChromeUtils.import(&quot;resource:///modules/calendar/calUtils.jsm&quot;);</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-var gLastShownCalendarView = null;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-</span>
<a href="#l2.20"></a><span id="l2.20"> var calendarTabMonitor = {</span>
<a href="#l2.21"></a><span id="l2.21">   monitorName: &quot;lightning&quot;,</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23">   // Unused, but needed functions</span>
<a href="#l2.24"></a><span id="l2.24">   onTabTitleChanged() {},</span>
<a href="#l2.25"></a><span id="l2.25">   onTabOpened() {},</span>
<a href="#l2.26"></a><span id="l2.26">   onTabClosing() {},</span>
<a href="#l2.27"></a><span id="l2.27">   onTabPersist() {},</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineat">@@ -78,17 +78,17 @@ var calendarTabMonitor = {</span>
<a href="#l2.29"></a><span id="l2.29"> var calendarTabType = {</span>
<a href="#l2.30"></a><span id="l2.30">   name: &quot;calendar&quot;,</span>
<a href="#l2.31"></a><span id="l2.31">   panelId: &quot;calendarTabPanel&quot;,</span>
<a href="#l2.32"></a><span id="l2.32">   modes: {</span>
<a href="#l2.33"></a><span id="l2.33">     calendar: {</span>
<a href="#l2.34"></a><span id="l2.34">       type: &quot;calendar&quot;,</span>
<a href="#l2.35"></a><span id="l2.35">       maxTabs: 1,</span>
<a href="#l2.36"></a><span id="l2.36">       openTab(aTab, aArgs) {</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-        gLastShownCalendarView = getLastCalendarView();</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+        gLastShownCalendarView.get();</span>
<a href="#l2.39"></a><span id="l2.39">         aTab.title = aArgs.title;</span>
<a href="#l2.40"></a><span id="l2.40">       },</span>
<a href="#l2.41"></a><span id="l2.41">       showTab(tab) {},</span>
<a href="#l2.42"></a><span id="l2.42">       closeTab(tab) {},</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44">       persistTab(aTab) {</span>
<a href="#l2.45"></a><span id="l2.45">         let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l2.46"></a><span id="l2.46">         return {</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineat">@@ -530,17 +530,17 @@ function updateTodayPaneButtonDate() {</span>
<a href="#l2.48"></a><span id="l2.48"> /**</span>
<a href="#l2.49"></a><span id="l2.49">  * Switch the calendar view, and optionally switch to calendar mode.</span>
<a href="#l2.50"></a><span id="l2.50">  *</span>
<a href="#l2.51"></a><span id="l2.51">  * @param aType     The type of view to select.</span>
<a href="#l2.52"></a><span id="l2.52">  * @param aShow     If true, the mode will be switched to calendar if not</span>
<a href="#l2.53"></a><span id="l2.53">  *                    already there.</span>
<a href="#l2.54"></a><span id="l2.54">  */</span>
<a href="#l2.55"></a><span id="l2.55"> function switchCalendarView(aType, aShow) {</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-  gLastShownCalendarView = aType;</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+  gLastShownCalendarView.set(aType);</span>
<a href="#l2.58"></a><span id="l2.58"> </span>
<a href="#l2.59"></a><span id="l2.59">   if (aShow &amp;&amp; gCurrentMode != &quot;calendar&quot;) {</span>
<a href="#l2.60"></a><span id="l2.60">     // This function in turn calls switchToView(), so return afterwards.</span>
<a href="#l2.61"></a><span id="l2.61">     calSwitchToCalendarMode();</span>
<a href="#l2.62"></a><span id="l2.62">     return;</span>
<a href="#l2.63"></a><span id="l2.63">   }</span>
<a href="#l2.64"></a><span id="l2.64"> </span>
<a href="#l2.65"></a><span id="l2.65">   switchToView(aType);</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineat">@@ -727,17 +727,17 @@ function calSwitchToCalendarMode() {</span>
<a href="#l2.67"></a><span id="l2.67">   if (gCurrentMode != &quot;calendar&quot;) {</span>
<a href="#l2.68"></a><span id="l2.68">     changeMode(&quot;calendar&quot;);</span>
<a href="#l2.69"></a><span id="l2.69"> </span>
<a href="#l2.70"></a><span id="l2.70">     // display the calendar panel on the display deck</span>
<a href="#l2.71"></a><span id="l2.71">     let deck = document.getElementById(&quot;calendarDisplayDeck&quot;);</span>
<a href="#l2.72"></a><span id="l2.72">     deck.selectedPanel = document.getElementById(&quot;calendar-view-box&quot;);</span>
<a href="#l2.73"></a><span id="l2.73"> </span>
<a href="#l2.74"></a><span id="l2.74">     // show the last displayed type of calendar view</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-    switchToView(gLastShownCalendarView);</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+    switchToView(gLastShownCalendarView.get());</span>
<a href="#l2.77"></a><span id="l2.77">     document.getElementById(&quot;calMinimonth&quot;).setAttribute(&quot;freebusy&quot;, &quot;true&quot;);</span>
<a href="#l2.78"></a><span id="l2.78"> </span>
<a href="#l2.79"></a><span id="l2.79">     document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l2.80"></a><span id="l2.80">     window.setCursor(&quot;auto&quot;);</span>
<a href="#l2.81"></a><span id="l2.81"> </span>
<a href="#l2.82"></a><span id="l2.82">     // make sure the view is sized correctly</span>
<a href="#l2.83"></a><span id="l2.83">     document.dispatchEvent(new CustomEvent(&quot;viewresize&quot;, { bubbles: true }));</span>
<a href="#l2.84"></a><span id="l2.84"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

