<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 24894:93daa9a87d526f51aa749070a5c33e54142ec49a</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 93daa9a87d526f51aa749070a5c33e54142ec49a" />
<meta property="og:url" content="/comm-central/rev/93daa9a87d526f51aa749070a5c33e54142ec49a" />
<meta property="og:description" content="Bug 1496598 - Port bug 1493226: remove needless QueryInterface calls in JS delegation. r=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 93daa9a87d526f51aa749070a5c33e54142ec49a 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/93daa9a87d526f51aa749070a5c33e54142ec49a">shortlog</a> |
<a href="/comm-central/log/93daa9a87d526f51aa749070a5c33e54142ec49a">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/93daa9a87d526f51aa749070a5c33e54142ec49a">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/93daa9a87d526f51aa749070a5c33e54142ec49a">files</a> |
changeset |
<a href="/comm-central/raw-rev/93daa9a87d526f51aa749070a5c33e54142ec49a">raw</a>  | <a href="/comm-central/archive/93daa9a87d526f51aa749070a5c33e54142ec49a.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1496598">Bug 1496598</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1493226">bug 1493226</a>: remove needless QueryInterface calls in JS delegation. r=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#66;&#101;&#110;&#32;&#67;&#97;&#109;&#112;&#98;&#101;&#108;&#108;&#32;&#60;&#98;&#101;&#110;&#99;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 05 Oct 2018 17:57:24 +1300</td></tr>

<tr>
 <td>changeset 24894</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/93daa9a87d526f51aa749070a5c33e54142ec49a">93daa9a87d526f51aa749070a5c33e54142ec49a</a></td>
</tr>



<tr>
<td>parent 24893</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f77c18acceafaa7e9fed65ab27e293cf117850a4">f77c18acceafaa7e9fed65ab27e293cf117850a4</a>
</td>
</tr>

<tr>
<td>child 24895</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f386902fa7325f359d24b88ae5751948b2cae42d">f386902fa7325f359d24b88ae5751948b2cae42d</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=93daa9a87d526f51aa749070a5c33e54142ec49a">14974</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 05 Oct 2018 12:24:17 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@93daa9a87d52 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=93daa9a87d526f51aa749070a5c33e54142ec49a">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=93daa9a87d526f51aa749070a5c33e54142ec49a&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=93daa9a87d526f51aa749070a5c33e54142ec49a&newProject=comm-central&newRevision=9766dccdd8b8e23e7ac26f3bfa94449e8b5bf40d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=93daa9a87d526f51aa749070a5c33e54142ec49a&newProject=comm-central&newRevision=9766dccdd8b8e23e7ac26f3bfa94449e8b5bf40d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=93daa9a87d526f51aa749070a5c33e54142ec49a&newProject=comm-central&newRevision=9766dccdd8b8e23e7ac26f3bfa94449e8b5bf40d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1496598">1496598</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1493226">1493226</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1496598">Bug 1496598</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1493226">bug 1493226</a>: remove needless QueryInterface calls in JS delegation. r=jorgk

This changes the DELEGATE_JS helper macro, replacing QueryInterface
usage with raw pointers (or implicit casts to descendent types)
in cases where the object type is known at compile time.

In fact, the remaining QueryInterface uses could also be removed
- in all cases, we _know_ that the mCppBase is an instance of the
&quot;Super&quot; helper class, which is always castable to the interfaces
we're opening to delegation. But at the moment, mCppBase is always
stored as a nsCOMPtr&lt;&gt; to one of the interfaces, and we can't get
to the others without using a runtime QueryInterface().</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/DelegateList.h">mailnews/jsaccount/src/DelegateList.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/DelegateList.h">file</a> |
<a href="/comm-central/annotate/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/DelegateList.h">annotate</a> |
<a href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/DelegateList.h">diff</a> |
<a href="/comm-central/comparison/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/DelegateList.h">comparison</a> |
<a href="/comm-central/log/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/DelegateList.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaAbDirectory.h">mailnews/jsaccount/src/JaAbDirectory.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaAbDirectory.h">file</a> |
<a href="/comm-central/annotate/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaAbDirectory.h">annotate</a> |
<a href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaAbDirectory.h">diff</a> |
<a href="/comm-central/comparison/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaAbDirectory.h">comparison</a> |
<a href="/comm-central/log/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaAbDirectory.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaCompose.h">mailnews/jsaccount/src/JaCompose.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaCompose.h">file</a> |
<a href="/comm-central/annotate/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaCompose.h">annotate</a> |
<a href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaCompose.h">diff</a> |
<a href="/comm-central/comparison/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaCompose.h">comparison</a> |
<a href="/comm-central/log/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaCompose.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaIncomingServer.h">mailnews/jsaccount/src/JaIncomingServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaIncomingServer.h">file</a> |
<a href="/comm-central/annotate/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaIncomingServer.h">annotate</a> |
<a href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaIncomingServer.h">diff</a> |
<a href="/comm-central/comparison/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaIncomingServer.h">comparison</a> |
<a href="/comm-central/log/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaIncomingServer.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaMsgFolder.h">mailnews/jsaccount/src/JaMsgFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaMsgFolder.h">file</a> |
<a href="/comm-central/annotate/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaMsgFolder.h">annotate</a> |
<a href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaMsgFolder.h">diff</a> |
<a href="/comm-central/comparison/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaMsgFolder.h">comparison</a> |
<a href="/comm-central/log/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaMsgFolder.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaSend.h">mailnews/jsaccount/src/JaSend.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaSend.h">file</a> |
<a href="/comm-central/annotate/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaSend.h">annotate</a> |
<a href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaSend.h">diff</a> |
<a href="/comm-central/comparison/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaSend.h">comparison</a> |
<a href="/comm-central/log/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaSend.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaUrl.h">mailnews/jsaccount/src/JaUrl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaUrl.h">file</a> |
<a href="/comm-central/annotate/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaUrl.h">annotate</a> |
<a href="/comm-central/diff/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaUrl.h">diff</a> |
<a href="/comm-central/comparison/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaUrl.h">comparison</a> |
<a href="/comm-central/log/93daa9a87d526f51aa749070a5c33e54142ec49a/mailnews/jsaccount/src/JaUrl.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/jsaccount/src/DelegateList.h</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/jsaccount/src/DelegateList.h</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -31,23 +31,22 @@ protected:</span>
<a href="#l1.4"></a><span id="l1.4">   nsCString mPrefix; // Windows decorated method prefix.</span>
<a href="#l1.5"></a><span id="l1.5"> };</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> } // namespace mailnews</span>
<a href="#l1.8"></a><span id="l1.8"> } // namespace mozilla</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> /*</span>
<a href="#l1.11"></a><span id="l1.11">  * This macro is used in forwarding functions.</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">- *   _interface: the interface being forwarded.</span>
<a href="#l1.13"></a><span id="l1.13">  *   _jsdelegate: the name of the JS pointer that implements a particular</span>
<a href="#l1.14"></a><span id="l1.14">  *                interface.</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+ *   _jsmethods:  the DelegateList object</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+ *   _cppbase:    the C++ base instance (used when call not delegated to js)</span>
<a href="#l1.17"></a><span id="l1.17">  *</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">- * You must follow the naming convention:</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">- *   1) use mCppBase as the name of the C++ base class instance.</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">- *   2) use mMethod as the name of the DelegateList object.</span>
<a href="#l1.21"></a><span id="l1.21">  **/</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-#define DELEGATE_JS(_interface, _jsdelegate) (\</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-    _jsdelegate &amp;&amp; mMethods &amp;&amp; \</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-    mMethods-&gt;Contains(nsLiteralCString(__FUNCTION__)) ? \</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-       _jsdelegate : nsCOMPtr&lt;_interface&gt;(do_QueryInterface(mCppBase)))</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+#define DELEGATE_JS(_jsdelegate, _jsmethods, _cppbase) (\</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+    _jsdelegate &amp;&amp; _jsmethods &amp;&amp; \</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+    _jsmethods-&gt;Contains(nsLiteralCString(__FUNCTION__)) ? \</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+       _jsdelegate : (_cppbase))</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/jsaccount/src/JaAbDirectory.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/jsaccount/src/JaAbDirectory.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -40,27 +40,30 @@ protected:</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> class JaCppAbDirectoryDelegator : public JaBaseCppAbDirectory,</span>
<a href="#l2.6"></a><span id="l2.6">                                   public msgIOverride</span>
<a href="#l2.7"></a><span id="l2.7"> {</span>
<a href="#l2.8"></a><span id="l2.8"> public:</span>
<a href="#l2.9"></a><span id="l2.9">   NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l2.10"></a><span id="l2.10">   NS_DECL_MSGIOVERRIDE</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  NS_FORWARD_NSIABDIRECTORY(DELEGATE_JS(nsIAbDirectory, mJsIAbDirectory)-&gt;)</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-  NS_FORWARD_NSIABCOLLECTION(DELEGATE_JS(nsIAbCollection, mJsIAbCollection)-&gt;)</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-  NS_FORWARD_NSIABITEM(DELEGATE_JS(nsIAbItem, mJsIAbItem)-&gt;)</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-  NS_FORWARD_NSIINTERFACEREQUESTOR(DELEGATE_JS(nsIInterfaceRequestor, mJsIInterfaceRequestor)-&gt;)</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+  // use mCppBase as a raw pointer where possible</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+  NS_FORWARD_NSIABDIRECTORY(DELEGATE_JS(mJsIAbDirectory, mMethods, mCppBase)-&gt;)</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+  NS_FORWARD_NSIABCOLLECTION(DELEGATE_JS(mJsIAbCollection, mMethods, (mCppBase.get()))-&gt;)</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+  NS_FORWARD_NSIABITEM(DELEGATE_JS(mJsIAbItem, mMethods, (mCppBase.get()))-&gt;)</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+  NS_FORWARD_NSIINTERFACEREQUESTOR(DELEGATE_JS(mJsIInterfaceRequestor, mMethods,</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+    (nsCOMPtr&lt;nsIInterfaceRequestor&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23">   JaCppAbDirectoryDelegator();</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25"> private:</span>
<a href="#l2.26"></a><span id="l2.26">   virtual ~JaCppAbDirectoryDelegator() {</span>
<a href="#l2.27"></a><span id="l2.27">   }</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+  // nsIAbDirectory inherits from nsIAbCollection which inherits from nsIAbItem.</span>
<a href="#l2.30"></a><span id="l2.30">   class Super : public nsIAbDirectory,</span>
<a href="#l2.31"></a><span id="l2.31">                 public nsIInterfaceRequestor</span>
<a href="#l2.32"></a><span id="l2.32">   {</span>
<a href="#l2.33"></a><span id="l2.33">     public:</span>
<a href="#l2.34"></a><span id="l2.34">       explicit Super(JaCppAbDirectoryDelegator* aFakeThis) {mFakeThis = aFakeThis;}</span>
<a href="#l2.35"></a><span id="l2.35">       NS_DECL_ISUPPORTS</span>
<a href="#l2.36"></a><span id="l2.36">       NS_FORWARD_NSIABDIRECTORY(mFakeThis-&gt;JaBaseCppAbDirectory::)</span>
<a href="#l2.37"></a><span id="l2.37">       NS_FORWARD_NSIABCOLLECTION(mFakeThis-&gt;JaBaseCppAbDirectory::)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/jsaccount/src/JaCompose.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/jsaccount/src/JaCompose.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -41,19 +41,21 @@ protected:</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> class JaCppComposeDelegator : public JaBaseCppCompose,</span>
<a href="#l3.6"></a><span id="l3.6">                                      public msgIOverride</span>
<a href="#l3.7"></a><span id="l3.7"> {</span>
<a href="#l3.8"></a><span id="l3.8"> public:</span>
<a href="#l3.9"></a><span id="l3.9">   NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l3.10"></a><span id="l3.10">   NS_DECL_MSGIOVERRIDE</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  NS_FORWARD_NSIMSGCOMPOSE(DELEGATE_JS(nsIMsgCompose, mJsIMsgCompose)-&gt;)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-  NS_FORWARD_NSIMSGSENDLISTENER(DELEGATE_JS(nsIMsgSendListener, mJsIMsgSendListener)-&gt;)</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-  NS_FORWARD_NSIINTERFACEREQUESTOR(DELEGATE_JS(nsIInterfaceRequestor, mJsIInterfaceRequestor)-&gt;)</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+  NS_FORWARD_NSIMSGCOMPOSE(DELEGATE_JS(mJsIMsgCompose, mMethods, mCppBase)-&gt;)</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+  NS_FORWARD_NSIMSGSENDLISTENER(DELEGATE_JS(mJsIMsgSendListener, mMethods, mCppBase.get())-&gt;)</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+  NS_FORWARD_NSIINTERFACEREQUESTOR(</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+    DELEGATE_JS(mJsIInterfaceRequestor, mMethods,</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+      (nsCOMPtr&lt;nsIInterfaceRequestor&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">   JaCppComposeDelegator();</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23"> private:</span>
<a href="#l3.24"></a><span id="l3.24">   virtual ~JaCppComposeDelegator() {</span>
<a href="#l3.25"></a><span id="l3.25">   }</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27">   // This class will call a method on the delegator, but force the use of the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/jsaccount/src/JaIncomingServer.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/jsaccount/src/JaIncomingServer.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -45,18 +45,20 @@ protected:</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> class JaCppIncomingServerDelegator : public JaBaseCppIncomingServer,</span>
<a href="#l4.6"></a><span id="l4.6">                                      public msgIOverride</span>
<a href="#l4.7"></a><span id="l4.7"> {</span>
<a href="#l4.8"></a><span id="l4.8"> public:</span>
<a href="#l4.9"></a><span id="l4.9">   NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l4.10"></a><span id="l4.10">   NS_DECL_MSGIOVERRIDE</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  NS_FORWARD_NSIMSGINCOMINGSERVER(DELEGATE_JS(nsIMsgIncomingServer, mJsIMsgIncomingServer)-&gt;)</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-  NS_FORWARD_NSIINTERFACEREQUESTOR(DELEGATE_JS(nsIInterfaceRequestor, mJsIInterfaceRequestor)-&gt;)</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+  // use mCppBase as a raw pointer where possible</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+  NS_FORWARD_NSIMSGINCOMINGSERVER(DELEGATE_JS(mJsIMsgIncomingServer, mMethods, mCppBase)-&gt;)</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+  NS_FORWARD_NSIINTERFACEREQUESTOR(DELEGATE_JS(mJsIInterfaceRequestor, mMethods,</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+    (nsCOMPtr&lt;nsIInterfaceRequestor&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">   JaCppIncomingServerDelegator();</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21"> private:</span>
<a href="#l4.22"></a><span id="l4.22">   virtual ~JaCppIncomingServerDelegator() {</span>
<a href="#l4.23"></a><span id="l4.23">   }</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">   // This class will call a method on the delegator, but force the use of the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/jsaccount/src/JaMsgFolder.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/jsaccount/src/JaMsgFolder.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -59,28 +59,33 @@ class JaCppMsgFolderDelegator : public J</span>
<a href="#l5.4"></a><span id="l5.4"> {</span>
<a href="#l5.5"></a><span id="l5.5"> public:</span>
<a href="#l5.6"></a><span id="l5.6">   NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l5.7"></a><span id="l5.7">   NS_DECL_MSGIOVERRIDE</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">   // Note that we do not support override of RDF methods.</span>
<a href="#l5.10"></a><span id="l5.10">   NS_FORWARD_NSIRDFRESOURCE(JaBaseCppMsgFolder::)</span>
<a href="#l5.11"></a><span id="l5.11">   NS_FORWARD_NSIRDFNODE(JaBaseCppMsgFolder::)</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  NS_FORWARD_NSIMSGFOLDER(DELEGATE_JS(nsIMsgFolder, mJsIMsgFolder)-&gt;)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  NS_FORWARD_NSIMSGFOLDER(</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+    DELEGATE_JS(mJsIMsgFolder, mMethods, mCppBase)-&gt;)</span>
<a href="#l5.15"></a><span id="l5.15">   NS_FORWARD_NSIDBCHANGELISTENER(</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-    DELEGATE_JS(nsIDBChangeListener, mJsIDBChangeListener)-&gt;)</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-  NS_FORWARD_NSIURLLISTENER(DELEGATE_JS(nsIUrlListener, mJsIUrlListener)-&gt;)</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+    DELEGATE_JS(mJsIDBChangeListener, mMethods,</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+      (nsCOMPtr&lt;nsIDBChangeListener&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+  NS_FORWARD_NSIURLLISTENER(</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+    DELEGATE_JS(mJsIUrlListener, mMethods,</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+      (nsCOMPtr&lt;nsIUrlListener&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l5.23"></a><span id="l5.23">   NS_FORWARD_NSIJUNKMAILCLASSIFICATIONLISTENER(</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-      DELEGATE_JS(nsIJunkMailClassificationListener,</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-                  mJsIJunkMailClassificationListener)-&gt;)</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+    DELEGATE_JS(mJsIJunkMailClassificationListener, mMethods,</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+      (nsCOMPtr&lt;nsIJunkMailClassificationListener&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l5.28"></a><span id="l5.28">   NS_FORWARD_NSIMSGTRAITCLASSIFICATIONLISTENER(</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-      DELEGATE_JS(nsIMsgTraitClassificationListener,</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-                  mJsIMsgTraitClassificationListener)-&gt;)</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+    DELEGATE_JS(mJsIMsgTraitClassificationListener, mMethods,</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+      (nsCOMPtr&lt;nsIMsgTraitClassificationListener&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l5.33"></a><span id="l5.33">   NS_FORWARD_NSIINTERFACEREQUESTOR(</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-      DELEGATE_JS(nsIInterfaceRequestor, mJsIInterfaceRequestor)-&gt;)</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+    DELEGATE_JS(mJsIInterfaceRequestor, mMethods,</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+      (nsCOMPtr&lt;nsIInterfaceRequestor&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l5.37"></a><span id="l5.37"> </span>
<a href="#l5.38"></a><span id="l5.38">   JaCppMsgFolderDelegator();</span>
<a href="#l5.39"></a><span id="l5.39"> </span>
<a href="#l5.40"></a><span id="l5.40"> private:</span>
<a href="#l5.41"></a><span id="l5.41">   virtual ~JaCppMsgFolderDelegator() {</span>
<a href="#l5.42"></a><span id="l5.42">   }</span>
<a href="#l5.43"></a><span id="l5.43"> </span>
<a href="#l5.44"></a><span id="l5.44">   class Super : public nsIMsgFolder,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/jsaccount/src/JaSend.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/jsaccount/src/JaSend.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -42,21 +42,23 @@ protected:</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5"> class JaCppSendDelegator : public JaBaseCppSend,</span>
<a href="#l6.6"></a><span id="l6.6">                            public msgIOverride</span>
<a href="#l6.7"></a><span id="l6.7"> {</span>
<a href="#l6.8"></a><span id="l6.8"> public:</span>
<a href="#l6.9"></a><span id="l6.9">   NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l6.10"></a><span id="l6.10">   NS_DECL_MSGIOVERRIDE</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  NS_FORWARD_NSIMSGSEND(DELEGATE_JS(nsIMsgSend, mJsIMsgSend)-&gt;)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  NS_FORWARD_NSIMSGSEND(DELEGATE_JS(mJsIMsgSend, mMethods, mCppBase)-&gt;)</span>
<a href="#l6.14"></a><span id="l6.14">   NS_FORWARD_NSIMSGOPERATIONLISTENER(</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-      DELEGATE_JS(nsIMsgOperationListener, mJsIMsgOperationListener)-&gt;)</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+    DELEGATE_JS(mJsIMsgOperationListener, mMethods,</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+      (nsCOMPtr&lt;nsIMsgOperationListener&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l6.18"></a><span id="l6.18">   NS_FORWARD_NSIINTERFACEREQUESTOR(</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-      DELEGATE_JS(nsIInterfaceRequestor, mJsIInterfaceRequestor)-&gt;)</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+    DELEGATE_JS(mJsIInterfaceRequestor, mMethods,</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+      (nsCOMPtr&lt;nsIInterfaceRequestor&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23">   JaCppSendDelegator();</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25"> private:</span>
<a href="#l6.26"></a><span id="l6.26">   virtual ~JaCppSendDelegator() {</span>
<a href="#l6.27"></a><span id="l6.27">   }</span>
<a href="#l6.28"></a><span id="l6.28"> </span>
<a href="#l6.29"></a><span id="l6.29">   // This class will call a method on the delegator, but force the use of the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/jsaccount/src/JaUrl.h</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/jsaccount/src/JaUrl.h</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -71,18 +71,20 @@ protected:</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> class JaCppUrlDelegator : public JaBaseCppUrl,</span>
<a href="#l7.6"></a><span id="l7.6">                           public msgIOverride</span>
<a href="#l7.7"></a><span id="l7.7"> {</span>
<a href="#l7.8"></a><span id="l7.8"> public:</span>
<a href="#l7.9"></a><span id="l7.9">   NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l7.10"></a><span id="l7.10">   NS_DECL_MSGIOVERRIDE</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  NS_FORWARD_NSIMSGMESSAGEURL(DELEGATE_JS(nsIMsgMessageUrl, mJsIMsgMessageUrl)-&gt;)</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-  NS_FORWARD_NSIINTERFACEREQUESTOR(DELEGATE_JS(nsIInterfaceRequestor, mJsIInterfaceRequestor)-&gt;)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+  NS_FORWARD_NSIMSGMESSAGEURL(DELEGATE_JS(mJsIMsgMessageUrl, mMethods,</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    (nsCOMPtr&lt;nsIMsgMessageUrl&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+  NS_FORWARD_NSIINTERFACEREQUESTOR(DELEGATE_JS(mJsIInterfaceRequestor, mMethods,</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+    (nsCOMPtr&lt;nsIInterfaceRequestor&gt;(do_QueryInterface(mCppBase))))-&gt;)</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">   JaCppUrlDelegator();</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">   class Super : public nsIMsgMailNewsUrl,</span>
<a href="#l7.22"></a><span id="l7.22">                 public nsIURIWithSpecialOrigin,</span>
<a href="#l7.23"></a><span id="l7.23">                 public nsIMsgMessageUrl,</span>
<a href="#l7.24"></a><span id="l7.24">                 public msgIJaUrl,</span>
<a href="#l7.25"></a><span id="l7.25">                 public nsIInterfaceRequestor,</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

