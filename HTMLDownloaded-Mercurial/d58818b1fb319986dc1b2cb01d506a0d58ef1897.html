<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 5521:d58818b1fb319986dc1b2cb01d506a0d58ef1897</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ d58818b1fb319986dc1b2cb01d506a0d58ef1897" />
<meta property="og:url" content="/comm-central/rev/d58818b1fb319986dc1b2cb01d506a0d58ef1897" />
<meta property="og:description" content="Bug 394687 need to import settings from Windows Mail on Vista and Windows Live Mail on XP/Vista/Windows 7. r=Neil,sr=bienvenu. r=Standard8 for the unit test. a=blocker" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / d58818b1fb319986dc1b2cb01d506a0d58ef1897 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/d58818b1fb319986dc1b2cb01d506a0d58ef1897">shortlog</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/d58818b1fb319986dc1b2cb01d506a0d58ef1897">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897">files</a> |
changeset |
<a href="/comm-central/raw-rev/d58818b1fb319986dc1b2cb01d506a0d58ef1897">raw</a>  | <a href="/comm-central/archive/d58818b1fb319986dc1b2cb01d506a0d58ef1897.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=394687">Bug 394687</a> need to import settings from Windows Mail on Vista and Windows Live Mail on XP/Vista/Windows 7. r=Neil,sr=bienvenu. r=Standard8 for the unit test. a=blocker
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#32;&#76;&#97;&#99;&#121;&#32;&#60;&#112;&#104;&#105;&#108;&#98;&#97;&#115;&#101;&#108;&#101;&#115;&#115;&#45;&#102;&#105;&#114;&#101;&#102;&#111;&#120;&#64;&#121;&#97;&#104;&#111;&#111;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 23 Apr 2010 11:33:57 +0100</td></tr>

<tr>
 <td>changeset 5521</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/d58818b1fb319986dc1b2cb01d506a0d58ef1897">d58818b1fb319986dc1b2cb01d506a0d58ef1897</a></td>
</tr>



<tr>
<td>parent 5520</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/43670c7cbad1943f897080fc6fbe20ba012f8226">43670c7cbad1943f897080fc6fbe20ba012f8226</a>
</td>
</tr>

<tr>
<td>child 5522</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9ee938f84566d0640abac14bc42dc8970a35a408">9ee938f84566d0640abac14bc42dc8970a35a408</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=d58818b1fb319986dc1b2cb01d506a0d58ef1897">4271</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 23 Apr 2010 10:34:31 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d58818b1fb31 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d58818b1fb319986dc1b2cb01d506a0d58ef1897">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d58818b1fb319986dc1b2cb01d506a0d58ef1897&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d58818b1fb319986dc1b2cb01d506a0d58ef1897&newProject=comm-central&newRevision=d58818b1fb319986dc1b2cb01d506a0d58ef1897&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d58818b1fb319986dc1b2cb01d506a0d58ef1897&newProject=comm-central&newRevision=d58818b1fb319986dc1b2cb01d506a0d58ef1897&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d58818b1fb319986dc1b2cb01d506a0d58ef1897&newProject=comm-central&newRevision=d58818b1fb319986dc1b2cb01d506a0d58ef1897&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a>, <a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a>, <a href="/comm-central/log?rev=reviewer%28blocker%29&revcount=50">blocker</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=394687">394687</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=394687">Bug 394687</a> need to import settings from Windows Mail on Vista and Windows Live Mail on XP/Vista/Windows 7. r=Neil,sr=bienvenu. r=Standard8 for the unit test. a=blocker</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/en-US/chrome/messenger/wmImportMsgs.properties">mail/locales/en-US/chrome/messenger/wmImportMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/en-US/chrome/messenger/wmImportMsgs.properties">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/en-US/chrome/messenger/wmImportMsgs.properties">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/en-US/chrome/messenger/wmImportMsgs.properties">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/en-US/chrome/messenger/wmImportMsgs.properties">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/en-US/chrome/messenger/wmImportMsgs.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/jar.mn">mail/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mail/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/Makefile.in">mailnews/import/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/Makefile.in">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/Makefile.in">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/Makefile.in">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/Makefile.in">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/Makefile.in">mailnews/import/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/nsImportModule.cpp">mailnews/import/build/nsImportModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/nsImportModule.cpp">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/nsImportModule.cpp">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/nsImportModule.cpp">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/nsImportModule.cpp">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/build/nsImportModule.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/MicrosoftCommunities/account%7B2E23%7D.oeaccount">mailnews/import/test/unit/resources/WindowsLiveMail/MicrosoftCommunities/account{2E23}.oeaccount</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/MicrosoftCommunities/account%7B2E23%7D.oeaccount">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/MicrosoftCommunities/account%7B2E23%7D.oeaccount">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/MicrosoftCommunities/account%7B2E23%7D.oeaccount">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/MicrosoftCommunities/account%7B2E23%7D.oeaccount">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/MicrosoftCommunities/account%7B2E23%7D.oeaccount">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallimap/donhallimap%7Btestimap%7D.oeaccount">mailnews/import/test/unit/resources/WindowsLiveMail/donhallimap/donhallimap{testimap}.oeaccount</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallimap/donhallimap%7Btestimap%7D.oeaccount">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallimap/donhallimap%7Btestimap%7D.oeaccount">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallimap/donhallimap%7Btestimap%7D.oeaccount">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallimap/donhallimap%7Btestimap%7D.oeaccount">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallimap/donhallimap%7Btestimap%7D.oeaccount">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallnntp/donhallnntp%7Btestnntp%7D.oeaccount">mailnews/import/test/unit/resources/WindowsLiveMail/donhallnntp/donhallnntp{testnntp}.oeaccount</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallnntp/donhallnntp%7Btestnntp%7D.oeaccount">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallnntp/donhallnntp%7Btestnntp%7D.oeaccount">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallnntp/donhallnntp%7Btestnntp%7D.oeaccount">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallnntp/donhallnntp%7Btestnntp%7D.oeaccount">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/donhallnntp/donhallnntp%7Btestnntp%7D.oeaccount">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/news.mozilla.org/account%7BB3B3%7D.oeaccount">mailnews/import/test/unit/resources/WindowsLiveMail/news.mozilla.org/account{B3B3}.oeaccount</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/news.mozilla.org/account%7BB3B3%7D.oeaccount">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/news.mozilla.org/account%7BB3B3%7D.oeaccount">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/news.mozilla.org/account%7BB3B3%7D.oeaccount">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/news.mozilla.org/account%7BB3B3%7D.oeaccount">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/news.mozilla.org/account%7BB3B3%7D.oeaccount">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/pop3.test.test/account%7BD244%7D.oeaccount">mailnews/import/test/unit/resources/WindowsLiveMail/pop3.test.test/account{D244}.oeaccount</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/pop3.test.test/account%7BD244%7D.oeaccount">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/pop3.test.test/account%7BD244%7D.oeaccount">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/pop3.test.test/account%7BD244%7D.oeaccount">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/pop3.test.test/account%7BD244%7D.oeaccount">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/resources/WindowsLiveMail/pop3.test.test/account%7BD244%7D.oeaccount">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/test_winmail.js">mailnews/import/test/unit/test_winmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/test_winmail.js">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/test_winmail.js">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/test_winmail.js">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/test_winmail.js">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/test/unit/test_winmail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/Makefile.in">mailnews/import/winlivemail/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/Makefile.in">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/Makefile.in">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/Makefile.in">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/Makefile.in">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/WMDebugLog.h">mailnews/import/winlivemail/WMDebugLog.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/WMDebugLog.h">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/WMDebugLog.h">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/WMDebugLog.h">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/WMDebugLog.h">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/WMDebugLog.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.cpp">mailnews/import/winlivemail/nsWMImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.cpp">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.cpp">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.cpp">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.cpp">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.h">mailnews/import/winlivemail/nsWMImport.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.h">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.h">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.h">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.h">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMImport.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.cpp">mailnews/import/winlivemail/nsWMSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.cpp">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.cpp">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.cpp">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.cpp">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.h">mailnews/import/winlivemail/nsWMSettings.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.h">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.h">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.h">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.h">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMSettings.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.cpp">mailnews/import/winlivemail/nsWMStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.h">mailnews/import/winlivemail/nsWMStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.h">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.h">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.h">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.h">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/import/winlivemail/nsWMStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/makefiles.sh">mailnews/makefiles.sh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/makefiles.sh">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/makefiles.sh">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/makefiles.sh">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/makefiles.sh">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/mailnews/makefiles.sh">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/en-US/chrome/mailnews/wmImportMsgs.properties">suite/locales/en-US/chrome/mailnews/wmImportMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/en-US/chrome/mailnews/wmImportMsgs.properties">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/en-US/chrome/mailnews/wmImportMsgs.properties">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/en-US/chrome/mailnews/wmImportMsgs.properties">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/en-US/chrome/mailnews/wmImportMsgs.properties">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/en-US/chrome/mailnews/wmImportMsgs.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/jar.mn">suite/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/d58818b1fb319986dc1b2cb01d506a0d58ef1897/suite/locales/jar.mn">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1">copy from mail/locales/en-US/chrome/messenger/oeImportMsgs.properties</span>
<a href="#l1.2"></a><span id="l1.2">copy to mail/locales/en-US/chrome/messenger/wmImportMsgs.properties</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/oeImportMsgs.properties</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/wmImportMsgs.properties</span>
<a href="#l1.5"></a><span id="l1.5" class="difflineat">@@ -30,79 +30,79 @@</span>
<a href="#l1.6"></a><span id="l1.6"> # decision by deleting the provisions above and replace them with the notice</span>
<a href="#l1.7"></a><span id="l1.7"> # and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l1.8"></a><span id="l1.8"> # the provisions above, a recipient may use your version of this file under</span>
<a href="#l1.9"></a><span id="l1.9"> # the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l1.10"></a><span id="l1.10"> #</span>
<a href="#l1.11"></a><span id="l1.11"> # ***** END LICENSE BLOCK *****</span>
<a href="#l1.12"></a><span id="l1.12"> </span>
<a href="#l1.13"></a><span id="l1.13"> #</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-# The following are used by the outlook express import code to display status/error </span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+# The following are used by the windows live mail import code to display status/error</span>
<a href="#l1.16"></a><span id="l1.16"> # and informational messages</span>
<a href="#l1.17"></a><span id="l1.17"> #</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> # Short name of import module</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-## @name OEIMPORT_NAME</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+## @name WMIMPORT_NAME</span>
<a href="#l1.22"></a><span id="l1.22"> ## @loc None</span>
<a href="#l1.23"></a><span id="l1.23"> ## LOCALIZATION NOTE (2000): DONT_TRANSLATE</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-2000=Outlook Express</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+2000=Windows Live Mail</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27"> # Description of import module</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-## @name OEIMPORT_DESCRIPTION</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+## @name WMIMPORT_DESCRIPTION</span>
<a href="#l1.30"></a><span id="l1.30"> ## @loc None</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-## LOCALIZATION NOTE (2011): In this item, don't translate &quot;Outlook Express&quot;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-2011=Outlook Express mail, address books, and settings</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+## LOCALIZATION NOTE (2001): In this item, don't translate &quot;Windows Live Mail&quot;</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+2001=Windows Live Mail settings</span>
<a href="#l1.35"></a><span id="l1.35"> </span>
<a href="#l1.36"></a><span id="l1.36"> # Success message</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-## @name OEIMPORT_MAILBOX_SUCCESS</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+## @name WMIMPORT_MAILBOX_SUCCESS</span>
<a href="#l1.39"></a><span id="l1.39"> ## @loc None</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-## LOCALIZATION NOTE (2002): In this item, don't translate &quot;%S&quot; or &quot;%d&quot;</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-## The variable %S will contain the name of the Mailbox</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-## The variable %d will contain the number of messages</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-2002=Mailbox %S, imported %d messages</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+## LOCALIZATION NOTE (2002): In this item, don't translate &quot;%1$S&quot; or &quot;%2$d&quot;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+## The variable %1$S will contain the name of the Mailbox</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+## The variable %2$d will contain the number of messages</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+2002=Mailbox %1$S, imported %2$d messages</span>
<a href="#l1.48"></a><span id="l1.48"> </span>
<a href="#l1.49"></a><span id="l1.49"> # Error message</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-## @name OEIMPORT_MAILBOX_BADPARAM</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+## @name WMIMPORT_MAILBOX_BADPARAM</span>
<a href="#l1.52"></a><span id="l1.52"> ## @loc None</span>
<a href="#l1.53"></a><span id="l1.53"> 2003=Bad parameter passed to import mailbox.</span>
<a href="#l1.54"></a><span id="l1.54"> </span>
<a href="#l1.55"></a><span id="l1.55"> # Error message</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-## @name OEIMPORT_MAILBOX_BADSOURCEFILE</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+## @name WMIMPORT_MAILBOX_BADSOURCEFILE</span>
<a href="#l1.58"></a><span id="l1.58"> ## @loc None</span>
<a href="#l1.59"></a><span id="l1.59"> ## LOCALIZATION NOTE (2004): In this item, don't translate &quot;%S&quot;</span>
<a href="#l1.60"></a><span id="l1.60"> ## The variable %S will contain the name of the Mailbox</span>
<a href="#l1.61"></a><span id="l1.61"> 2004=Error accessing file for mailbox %S.</span>
<a href="#l1.62"></a><span id="l1.62"> </span>
<a href="#l1.63"></a><span id="l1.63"> # Error message</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-## @name OEIMPORT_MAILBOX_CONVERTERROR</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+## @name WMIMPORT_MAILBOX_CONVERTERROR</span>
<a href="#l1.66"></a><span id="l1.66"> ## @loc None</span>
<a href="#l1.67"></a><span id="l1.67"> ## LOCALIZATION NOTE (2005): In this item, don't translate &quot;%S&quot;</span>
<a href="#l1.68"></a><span id="l1.68"> ## The variable %S will contain the name of the Mailbox</span>
<a href="#l1.69"></a><span id="l1.69"> 2005=Error importing mailbox %S, all messages may not be imported from this mailbox.</span>
<a href="#l1.70"></a><span id="l1.70"> </span>
<a href="#l1.71"></a><span id="l1.71"> # Default name of imported addressbook</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-## @name OEIMPORT_DEFAULT_NAME</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+## @name WMIMPORT_DEFAULT_NAME</span>
<a href="#l1.74"></a><span id="l1.74"> ## @loc None</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineminus">-2006=Outlook Express Address Book</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+2006=Windows Live Mail Address Book</span>
<a href="#l1.77"></a><span id="l1.77"> </span>
<a href="#l1.78"></a><span id="l1.78"> # Autofind description</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-## @name OEIMPORT_AUTOFIND</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+## @name WMIMPORT_AUTOFIND</span>
<a href="#l1.81"></a><span id="l1.81"> ## @loc None</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-2007=Outlook Express address book (windows address book)</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+2007=Windows Live Mail address book (windows address book)</span>
<a href="#l1.84"></a><span id="l1.84"> </span>
<a href="#l1.85"></a><span id="l1.85"> # Description</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineminus">-## @name OEIMPORT_ADDRESS_SUCCESS</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+## @name WMIMPORT_ADDRESS_SUCCESS</span>
<a href="#l1.88"></a><span id="l1.88"> ## @loc None</span>
<a href="#l1.89"></a><span id="l1.89"> ## LOCALIZATION NOTE (2006): In this item, don't translate &quot;%S&quot;</span>
<a href="#l1.90"></a><span id="l1.90"> ## The variable %S will receive the name of the address book</span>
<a href="#l1.91"></a><span id="l1.91"> 2008=Imported address book %S</span>
<a href="#l1.92"></a><span id="l1.92"> </span>
<a href="#l1.93"></a><span id="l1.93"> # Error message</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineminus">-## @name OEIMPORT_ADDRESS_CONVERTERROR</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+## @name WMIMPORT_ADDRESS_CONVERTERROR</span>
<a href="#l1.96"></a><span id="l1.96"> ## @loc None</span>
<a href="#l1.97"></a><span id="l1.97"> ## LOCALIZATION NOTE (2009): In this item, don't translate &quot;%S&quot;</span>
<a href="#l1.98"></a><span id="l1.98"> ## The variable %S will receive the name of the address book</span>
<a href="#l1.99"></a><span id="l1.99"> 2009=Error importing address book %S, all addresses may not have been imported.</span>
<a href="#l1.100"></a><span id="l1.100"> </span>
<a href="#l1.101"></a><span id="l1.101"> # Error message</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineminus">-## @name OEIMPORT_ADDRESS_BADPARAM</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+## @name WMIMPORT_ADDRESS_BADPARAM</span>
<a href="#l1.104"></a><span id="l1.104"> ## @loc None</span>
<a href="#l1.105"></a><span id="l1.105"> 2010=Bad parameter passed to import addressbook.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/locales/jar.mn</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/locales/jar.mn</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -88,16 +88,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">   locale/@AB_CD@/messenger/importMsgs.properties                        (%chrome/messenger/importMsgs.properties)</span>
<a href="#l2.5"></a><span id="l2.5">   locale/@AB_CD@/messenger/importDialog.dtd                             (%chrome/messenger/importDialog.dtd)</span>
<a href="#l2.6"></a><span id="l2.6">   locale/@AB_CD@/messenger/fieldMapImport.dtd                           (%chrome/messenger/fieldMapImport.dtd)</span>
<a href="#l2.7"></a><span id="l2.7">   locale/@AB_CD@/messenger/textImportMsgs.properties                    (%chrome/messenger/textImportMsgs.properties)</span>
<a href="#l2.8"></a><span id="l2.8">   locale/@AB_CD@/messenger/appleMailImportMsgs.properties               (%chrome/messenger/appleMailImportMsgs.properties)</span>
<a href="#l2.9"></a><span id="l2.9">   locale/@AB_CD@/messenger/comm4xMailImportMsgs.properties              (%chrome/messenger/comm4xMailImportMsgs.properties)</span>
<a href="#l2.10"></a><span id="l2.10">   locale/@AB_CD@/messenger/eudoraImportMsgs.properties                  (%chrome/messenger/eudoraImportMsgs.properties)</span>
<a href="#l2.11"></a><span id="l2.11">   locale/@AB_CD@/messenger/oeImportMsgs.properties                      (%chrome/messenger/oeImportMsgs.properties)</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  locale/@AB_CD@/messenger/wmImportMsgs.properties                      (%chrome/messenger/wmImportMsgs.properties)</span>
<a href="#l2.13"></a><span id="l2.13">   locale/@AB_CD@/messenger/outlookImportMsgs.properties                 (%chrome/messenger/outlookImportMsgs.properties)</span>
<a href="#l2.14"></a><span id="l2.14">   locale/@AB_CD@/messenger/shutdownWindow.properties                    (%chrome/messenger/shutdownWindow.properties)</span>
<a href="#l2.15"></a><span id="l2.15">   locale/@AB_CD@/messenger/featureConfigurator.dtd                      (%chrome/messenger/featureConfigurator.dtd)</span>
<a href="#l2.16"></a><span id="l2.16">   locale/@AB_CD@/messenger/configEditorOverlay.dtd                      (%chrome/messenger/configEditorOverlay.dtd)</span>
<a href="#l2.17"></a><span id="l2.17">   locale/@AB_CD@/messenger/gloda.properties                             (%chrome/messenger/gloda.properties)</span>
<a href="#l2.18"></a><span id="l2.18">   locale/@AB_CD@/messenger/glodaComplete.properties                     (%chrome/messenger/glodaComplete.properties)</span>
<a href="#l2.19"></a><span id="l2.19">   locale/@AB_CD@/messenger/templateUtils.properties                     (%chrome/messenger/templateUtils.properties)</span>
<a href="#l2.20"></a><span id="l2.20">   locale/@AB_CD@/messenger/glodaFacetView.properties                    (%chrome/messenger/glodaFacetView.properties)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/import/Makefile.in</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/import/Makefile.in</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -48,17 +48,17 @@ PARALLEL_DIRS	= public src text/src comm</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l3.6"></a><span id="l3.6"> PARALLEL_DIRS	+= eudora/src applemail/src</span>
<a href="#l3.7"></a><span id="l3.7"> endif</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l3.10"></a><span id="l3.10"> PARALLEL_DIRS	+= eudora/src</span>
<a href="#l3.11"></a><span id="l3.11"> ifndef GNU_CC</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-PARALLEL_DIRS	+= oexpress outlook/src</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+PARALLEL_DIRS	+= oexpress outlook/src winlivemail</span>
<a href="#l3.14"></a><span id="l3.14"> endif</span>
<a href="#l3.15"></a><span id="l3.15"> endif</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> ifdef ENABLE_TESTS</span>
<a href="#l3.18"></a><span id="l3.18"> PARALLEL_DIRS	+= test</span>
<a href="#l3.19"></a><span id="l3.19"> endif</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21"> DIRS = build</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/import/build/Makefile.in</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/import/build/Makefile.in</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -64,41 +64,42 @@ ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l4.4"></a><span id="l4.4"> REQUIRES += impEudra impapplemail</span>
<a href="#l4.5"></a><span id="l4.5"> endif</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l4.8"></a><span id="l4.8"> REQUIRES += impEudra</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10"> ifndef GNU_CC</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-REQUIRES += importOE impOutlk</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+REQUIRES += importOE impOutlk importWM</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15"> endif</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17"> endif</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-CPPSRCS		=  nsImportModule.cpp  </span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+CPPSRCS		=  nsImportModule.cpp</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22"> SHARED_LIBRARY_LIBS = \</span>
<a href="#l4.23"></a><span id="l4.23"> 		../src/$(LIB_PREFIX)import_s.$(LIB_SUFFIX) \</span>
<a href="#l4.24"></a><span id="l4.24"> 		../text/src/$(LIB_PREFIX)imptext_s.$(LIB_SUFFIX) \</span>
<a href="#l4.25"></a><span id="l4.25"> 		../comm4x/src/$(LIB_PREFIX)imp4mail_s.$(LIB_SUFFIX) \</span>
<a href="#l4.26"></a><span id="l4.26"> 		$(NULL)</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28"> ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l4.29"></a><span id="l4.29"> SHARED_LIBRARY_LIBS += ../eudora/src/$(LIB_PREFIX)impEudra_s.$(LIB_SUFFIX)</span>
<a href="#l4.30"></a><span id="l4.30"> SHARED_LIBRARY_LIBS += ../applemail/src/$(LIB_PREFIX)applmail_s.$(LIB_SUFFIX)</span>
<a href="#l4.31"></a><span id="l4.31"> endif</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-SHARED_LIBRARY_LIBS += ../eudora/src/$(LIB_PREFIX)impEudra_s.$(LIB_SUFFIX) </span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+SHARED_LIBRARY_LIBS += ../eudora/src/$(LIB_PREFIX)impEudra_s.$(LIB_SUFFIX)</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37"> ifndef GNU_CC</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-SHARED_LIBRARY_LIBS += ../oexpress/$(LIB_PREFIX)importOE_s.$(LIB_SUFFIX) </span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-SHARED_LIBRARY_LIBS += ../outlook/src/$(LIB_PREFIX)impOutlk_s.$(LIB_SUFFIX) </span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+SHARED_LIBRARY_LIBS += ../oexpress/$(LIB_PREFIX)importOE_s.$(LIB_SUFFIX)</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+SHARED_LIBRARY_LIBS += ../outlook/src/$(LIB_PREFIX)impOutlk_s.$(LIB_SUFFIX)</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+SHARED_LIBRARY_LIBS += ../winlivemail/$(LIB_PREFIX)importWM_s.$(LIB_SUFFIX)</span>
<a href="#l4.43"></a><span id="l4.43"> endif</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45"> endif</span>
<a href="#l4.46"></a><span id="l4.46"> </span>
<a href="#l4.47"></a><span id="l4.47"> LOCAL_INCLUDES += -I$(srcdir)/../src \</span>
<a href="#l4.48"></a><span id="l4.48"> 	-I$(srcdir)/../comm4x/src \</span>
<a href="#l4.49"></a><span id="l4.49"> 	-I$(srcdir)/../text/src \</span>
<a href="#l4.50"></a><span id="l4.50"> 	$(NULL)</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineat">@@ -109,16 +110,17 @@ LOCAL_INCLUDES += -I$(srcdir)/../eudora/</span>
<a href="#l4.52"></a><span id="l4.52"> 									$(NULL)</span>
<a href="#l4.53"></a><span id="l4.53"> endif</span>
<a href="#l4.54"></a><span id="l4.54"> </span>
<a href="#l4.55"></a><span id="l4.55"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l4.56"></a><span id="l4.56"> LOCAL_INCLUDES += -I$(srcdir)/../eudora/src</span>
<a href="#l4.57"></a><span id="l4.57"> ifndef GNU_CC</span>
<a href="#l4.58"></a><span id="l4.58"> LOCAL_INCLUDES += -I$(srcdir)/../oexpress \</span>
<a href="#l4.59"></a><span id="l4.59"> 	-I$(srcdir)/../outlook/src \</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+	-I$(srcdir)/../winlivemail  \</span>
<a href="#l4.61"></a><span id="l4.61"> 	$(NULL)</span>
<a href="#l4.62"></a><span id="l4.62"> endif</span>
<a href="#l4.63"></a><span id="l4.63"> endif</span>
<a href="#l4.64"></a><span id="l4.64"> </span>
<a href="#l4.65"></a><span id="l4.65"> ifdef MOZ_STATIC_MAIL_BUILD</span>
<a href="#l4.66"></a><span id="l4.66"> EXTRA_DSO_LDOPTS += ../../base/util/$(LIB_PREFIX)msgbsutl_s.$(LIB_SUFFIX)</span>
<a href="#l4.67"></a><span id="l4.67"> else</span>
<a href="#l4.68"></a><span id="l4.68"> ifeq ($(USE_SHORT_LIBNAME),1)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/import/build/nsImportModule.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/import/build/nsImportModule.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -90,19 +90,22 @@ static NS_DEFINE_CID(kAppleMailImportCID</span>
<a href="#l5.4"></a><span id="l5.4"> // outlook import Include Files</span>
<a href="#l5.5"></a><span id="l5.5"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l5.6"></a><span id="l5.6"> #ifdef XP_WIN</span>
<a href="#l5.7"></a><span id="l5.7"> #if defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= 1100</span>
<a href="#l5.8"></a><span id="l5.8"> #include &quot;nsOEImport.h&quot;</span>
<a href="#l5.9"></a><span id="l5.9"> #include &quot;nsOEStringBundle.h&quot;</span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;nsOutlookImport.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11"> #include &quot;nsOutlookStringBundle.h&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+#include &quot;nsWMImport.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+#include &quot;nsWMStringBundle.h&quot;</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15"> static NS_DEFINE_CID(kOEImportCID,         NS_OEIMPORT_CID);</span>
<a href="#l5.16"></a><span id="l5.16"> static NS_DEFINE_CID(kOutlookImportCID,      NS_OUTLOOKIMPORT_CID);</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+static NS_DEFINE_CID(kWMImportCID,         NS_WMIMPORT_CID);</span>
<a href="#l5.18"></a><span id="l5.18"> #endif</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> #endif // XP_WIN</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l5.23"></a><span id="l5.23"> // core import factories</span>
<a href="#l5.24"></a><span id="l5.24"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l5.25"></a><span id="l5.25"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsImportService)</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineat">@@ -211,16 +214,17 @@ NS_METHOD AppleMailRegister(nsIComponent</span>
<a href="#l5.27"></a><span id="l5.27"> // outlook import factories</span>
<a href="#l5.28"></a><span id="l5.28"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l5.29"></a><span id="l5.29"> #ifdef XP_WIN</span>
<a href="#l5.30"></a><span id="l5.30"> </span>
<a href="#l5.31"></a><span id="l5.31"> #if defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= 1100</span>
<a href="#l5.32"></a><span id="l5.32"> </span>
<a href="#l5.33"></a><span id="l5.33"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsOEImport)</span>
<a href="#l5.34"></a><span id="l5.34"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsOutlookImport)</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+NS_GENERIC_FACTORY_CONSTRUCTOR(nsWMImport)</span>
<a href="#l5.36"></a><span id="l5.36"> </span>
<a href="#l5.37"></a><span id="l5.37"> NS_METHOD OERegister(nsIComponentManager *aCompMgr,</span>
<a href="#l5.38"></a><span id="l5.38">                      nsIFile *aPath,</span>
<a href="#l5.39"></a><span id="l5.39">                      const char *registryLocation,</span>
<a href="#l5.40"></a><span id="l5.40">                      const char *componentType,</span>
<a href="#l5.41"></a><span id="l5.41">                      const nsModuleComponentInfo *info)</span>
<a href="#l5.42"></a><span id="l5.42"> {</span>
<a href="#l5.43"></a><span id="l5.43">   nsresult rv;</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineat">@@ -231,16 +235,37 @@ NS_METHOD OERegister(nsIComponentManager</span>
<a href="#l5.45"></a><span id="l5.45">     char *theCID = kOEImportCID.ToString();</span>
<a href="#l5.46"></a><span id="l5.46">     rv = catMan-&gt;AddCategoryEntry( &quot;mailnewsimport&quot;, theCID, kOESupportsString, PR_TRUE, PR_TRUE, getter_Copies( replace));</span>
<a href="#l5.47"></a><span id="l5.47">     NS_Free( theCID);</span>
<a href="#l5.48"></a><span id="l5.48">   }</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50">     return( rv);</span>
<a href="#l5.51"></a><span id="l5.51"> }</span>
<a href="#l5.52"></a><span id="l5.52"> </span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+NS_METHOD WMRegister(nsIComponentManager *aCompMgr,</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+                     nsIFile *aPath,</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+                     const char *registryLocation,</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+                     const char *componentType,</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+                     const nsModuleComponentInfo *info)</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+{</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+  nsresult rv;</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+  nsCOMPtr&lt;nsICategoryManager&gt; catMan = do_GetService(NS_CATEGORYMANAGER_CONTRACTID,</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+                                                      &amp;rv);</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+  if (NS_SUCCEEDED(rv)) {</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+    nsCString replace;</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+    char *theCID = kWMImportCID.ToString();</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+    rv = catMan-&gt;AddCategoryEntry(&quot;mailnewsimport&quot;, theCID, kWMSupportsString,</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+                                  PR_TRUE, PR_TRUE, getter_Copies(replace));</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+    NS_Free(theCID);</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+  }</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+    return( rv);</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+}</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+</span>
<a href="#l5.74"></a><span id="l5.74"> NS_METHOD OutlookRegister(nsIComponentManager *aCompMgr,</span>
<a href="#l5.75"></a><span id="l5.75">                           nsIFile *aPath, const char *registryLocation,</span>
<a href="#l5.76"></a><span id="l5.76">                           const char *componentType,</span>
<a href="#l5.77"></a><span id="l5.77">                           const nsModuleComponentInfo *info)</span>
<a href="#l5.78"></a><span id="l5.78"> {</span>
<a href="#l5.79"></a><span id="l5.79">   nsresult rv;</span>
<a href="#l5.80"></a><span id="l5.80"> </span>
<a href="#l5.81"></a><span id="l5.81">   nsCOMPtr&lt;nsICategoryManager&gt; catMan = do_GetService( NS_CATEGORYMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineat">@@ -302,16 +327,18 @@ static const nsModuleComponentInfo compo</span>
<a href="#l5.83"></a><span id="l5.83"> </span>
<a href="#l5.84"></a><span id="l5.84"> #ifdef XP_WIN</span>
<a href="#l5.85"></a><span id="l5.85"> #if defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= 1100</span>
<a href="#l5.86"></a><span id="l5.86">     ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l5.87"></a><span id="l5.87">     // oexpress import components</span>
<a href="#l5.88"></a><span id="l5.88">     ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l5.89"></a><span id="l5.89">     ,{ &quot;Outlook Express Import Component&quot;, NS_OEIMPORT_CID,</span>
<a href="#l5.90"></a><span id="l5.90">     &quot;@mozilla.org/import/import-oe;1&quot;, nsOEImportConstructor,  OERegister,  nsnull },</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+    { &quot;Windows Live Mail Import Component&quot;, NS_WMIMPORT_CID,</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+    &quot;@mozilla.org/import/import-wm;1&quot;, nsWMImportConstructor,  WMRegister,  nsnull },</span>
<a href="#l5.93"></a><span id="l5.93">     { &quot;Outlook Import Component&quot;, NS_OUTLOOKIMPORT_CID,</span>
<a href="#l5.94"></a><span id="l5.94">     &quot;@mozilla.org/import/import-outlook;1&quot;, nsOutlookImportConstructor, OutlookRegister, nsnull }</span>
<a href="#l5.95"></a><span id="l5.95"> #endif</span>
<a href="#l5.96"></a><span id="l5.96"> #endif</span>
<a href="#l5.97"></a><span id="l5.97"> </span>
<a href="#l5.98"></a><span id="l5.98"> };</span>
<a href="#l5.99"></a><span id="l5.99"> </span>
<a href="#l5.100"></a><span id="l5.100"> </span>
<a href="#l5.101"></a><span id="l5.101" class="difflineat">@@ -320,16 +347,17 @@ static void importModuleDtor(nsIModule* </span>
<a href="#l5.102"></a><span id="l5.102"> #if defined(XP_WIN) || defined(XP_MACOSX)</span>
<a href="#l5.103"></a><span id="l5.103">     nsEudoraStringBundle::Cleanup();</span>
<a href="#l5.104"></a><span id="l5.104"> #endif</span>
<a href="#l5.105"></a><span id="l5.105"> </span>
<a href="#l5.106"></a><span id="l5.106"> #ifdef XP_WIN</span>
<a href="#l5.107"></a><span id="l5.107"> </span>
<a href="#l5.108"></a><span id="l5.108"> #if defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= 1100</span>
<a href="#l5.109"></a><span id="l5.109">     nsOEStringBundle::Cleanup();</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+    nsWMStringBundle::Cleanup();</span>
<a href="#l5.111"></a><span id="l5.111">     nsOutlookStringBundle::Cleanup();</span>
<a href="#l5.112"></a><span id="l5.112"> #endif</span>
<a href="#l5.113"></a><span id="l5.113"> </span>
<a href="#l5.114"></a><span id="l5.114"> #endif</span>
<a href="#l5.115"></a><span id="l5.115"> }</span>
<a href="#l5.116"></a><span id="l5.116"> </span>
<a href="#l5.117"></a><span id="l5.117"> NS_IMPL_NSGETMODULE_WITH_DTOR( nsImportServiceModule, components, importModuleDtor)</span>
<a href="#l5.118"></a><span id="l5.118"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..545d6470daa4afb357602a857c5b241e8a6d43c2</span>
<a href="#l6.3"></a><span id="l6.3">GIT binary patch
literal 690
zc$|%r-Ae*d5XH}P(Eo7hy;T#+U{g$Ag0e^&gt;&gt;_y7eSZKF!*FOIF&gt;UYQO!Hb3r_hV+x
z%sKbt=Q~zMpUU(ir+3Y?P@z&lt;&gt;%5|m#H594N&gt;d54p5&gt;LqHdbaFRrRF*Wb!?c9+S=Ei
zVqJkRut$(Hb*c2VODf9&gt;&lt;0^}T&gt;_h{qGO8Tjm)_WUuAv^7+jLGrFTfX!IT)uNyA1Ok
zQX;9bJB@5D;izq83DsN@FAQ-9cY;@fN&amp;+?Kx}ZZ&gt;w;G$OBjQb+7{0}LLRrfgPr1K_
zDcIIIRM4~A&amp;&amp;f^gEZ&amp;=NmKFQDj=t`7jf%dhsIOVmSpV-9au2YPZa@s}FRXsV=9eg|
d+s&amp;AL{}0v(FMOZK?maU#oBRL$n%WNk&lt;`+c{aaI5T</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">new file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..7ff7a664d9143fc911045e1e9bbb4668ddd2cd10</span>
<a href="#l7.3"></a><span id="l7.3">GIT binary patch
literal 4422
zc$~dhTWi}e6h6;`{Rgx6UP9SmkhKj&lt;#xl00BpHFd7&amp;mr1GsiJ;dfSiR_UYKBk&gt;Vpu
zWDJ9ySm(P)I!99S=Xakj=#f^GQ9$&gt;U(1uD%X-zr3qgT|UV&gt;-n%Kub&lt;bypPeE(=E5&amp;
z(UxxL2vKi1=7P@YCB2|NeL;MQD?(&amp;K10WUl4#;gC6VzAVXbtHrP%EGUe0!n-pOn^&amp;
zzT&lt;uledX;3VlrGQA|u4~=|to)_1-f&gt;j+Q0js=kIaueEg5AuVV^Q#_USsdk;Qs-4Z$
z9%Ez%bcKi+k99TT?LAdJOVP(;dZ@=-@fWzS5nbZF&gt;g|eMwDZd9-+)&amp;UZlkR$&gt;|?uh
zl&amp;chORd1fGBiw7%(($s|72IyXZc{kJTT`XM*=K8s%-XP&lt;wmJ9dRX3aLWX?ICaGu+H
z`W98G&gt;*`opV~U71*U$$%Gh~6BrDM3gM%1IB)y`p`yQ-p9ru&amp;Shj&lt;n6;JsceI`WDw&amp;
zRq&amp;{%yqf4vOV1hg&lt;F;p7wSJ9pPcUDl(&gt;ye|U&lt;bFKb#`Xi)ex-_*7~iZo85Tbh0J8j
zjSa7K1-rlDYE^F|-eVs4d)%&gt;dn&gt;pjcXd91|R}A}VW~x4;y6Ygs_w2x|?BcTZFF{&lt;w
zc@lf)qK=j`(p5$F`H6S?pZGLF^))-Di^m2TXh_|k3%lv&lt;Gu}qL|Aydc5EDKX$a{X&lt;
zJi0QO4yHVY&gt;l(ShSt((RIV)ZIZal8)BkT|b=l@~qI*+No+p3&amp;Kd{VNhy=Jv`oXI}J
zJj@+WZzbGs@z&amp;+^*3K)d`=8!y*e)I4)0-VHtGS%sdN|eS8q(QKAJaq6Za!?X6aTZD
zgq1ba9#euf;~ehFkYU~bkM-{&lt;T~p$c)h8I2TSVnR{=)P57m?k^LaUJgY*m%$e!AIZ
zXQQ3&lt;dw|M_c?Qe9)j_YFORwscHDq6Eoh!I9Lhkkdaq6RLtE?1yInP8@5$z85Yskde
TR)v3a_VZ&lt;I{&gt;eCT_%GuxCLhbr</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..e9b5fc8196d4209d1c93c099259f5b803f076392</span>
<a href="#l8.3"></a><span id="l8.3">GIT binary patch
literal 2696
zc$}S9%TB^T6g_Jb|DkcOq9m&gt;mHDc6-LI7jpra?d@p`|Gz;&gt;W9J?zGVvJJZ%o(%0O3
z&amp;V5h6K3h1!J0i&gt;x;0;rxSYn0+VjN=!2iQY{_kcSw#{53vZj5KyUEvi^*rn8w$ef^!
zZET^18_F-aMwFc5jG9V!Ma|btCdgLH+6{3_t%zCy-!@42q__rn;I&amp;PDW!np7=3KGp
zBt+SF;@EuWf)I0OOgZgqh+)QMvUYHfF8aJH?uN0N!s&lt;t}xo^3K=uu)IvDOhU_Ecf6
z8N)qZb&lt;7oh!s~+4&gt;bvqb5-W;v-RyVNR}$5tZ8H4TE#pyE&amp;1mh68QXXxd{D?`&gt;bu!`
zv^FKWkKvGcYg#P1o&lt;Cb-R#qz36y&gt;~*SLJAKONNwCF&lt;(gc`B&lt;C8GkHy2H%EtZOQO!1
z-%V+abTa?1vYs?KU081RF5~h{shFA{y#I8S-;R5uO9G&lt;lJ~8bnM|WFx!Tpg`VaRDS
z;YzbP=j)!+TK((haNE_VL?XQrir3XGH7n*n_SWIHJ;=NJk`k&amp;W6R8&amp;^JLVV7t+V5|
zTlZHTH2(}yRjeaWr&gt;jj(Kf_XNDPuS+VEEDWO{*FAW2tUEWs2*w@n&lt;gCdOj~wsfI+(
z+9#Qy&gt;gz}{y_WY$$!ThPR|T=?G&gt;^De($Ok5(@ND+tY@R=&gt;`8V)gz{$-;jzZ)`Qq%T
oyib02R#nC-XZtldbsQsO(hc~mbL@|leNNUx&amp;i@7XEBp&lt;916&gt;WfI{*Lx</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..f17de718ae534bca763ca26fd1ec9ed3bf9555f7</span>
<a href="#l9.3"></a><span id="l9.3">GIT binary patch
literal 960
zc$|%s%}T&gt;i5QWcL@EwAC+epA7#MWwD2wKHfL^mNMQG_H)lUD1)t6y$YF(FYI@-s7M
z&lt;{akE{rqq&gt;(wkBxvb0pJxpF&lt;}S(y&amp;CqdoOx^R&gt;ui3W-N#Gd-H@LWLf*3u@nBMjC2c
zTXJ;)KF0!(vBp%EwF@eX3S(8~HnP4ZRHal|cq_f|S8`2t&amp;wEJjCpxRJDUo-SC0IZ-
z)+_9;`kmdID$a@L25|#tgjaxy8Y+%;Mu)Mkb!XHJn9czxhbP8!;2JQKkf_aEN(Eh=
zn+i_M)JyFli1iuxnpNy|9iDD=i3-oCuxsWR*5A7|xhL36S0JWl2iBX=egcI#+v0o5
zy~gx=cyrFZRMFnIo86;J4rAG8_2({Zl+&gt;BJdUUg%k`Ii2pR&lt;jyd9}aoyzSd|WNyZi
WNWx#l9O`~uWjE*M4)y&lt;Wi@pG8U7oN2</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..5ec08c49452850dca2a3973c025b2f1873e2bbfa</span>
<a href="#l10.3"></a><span id="l10.3">GIT binary patch
literal 1478
zc$}qFO;3YB6r8h(|ABb7rD@^`TaERo5?f&gt;9g^&lt;!3A_c-nl|Qe}F5B3pY@sommSx|Y
znYY8+{rPq&lt;#TPb+U}1|DGUN!6AjUN=Fv0*fpB5uAmRt`Qjqxs{B?_!@$*e1xGsOhw
zID&gt;-+=I0zfGgr7JQeaCW3zcK3;WVNi9*NozW$~&gt;-%9+rb&lt;Bk6lt_kLX&gt;j{6phK&amp;`{
z!O+OsRKJsZjTu=ouim+bg;LgQnBf&amp;qc;-`7Vrye8RgbeZwOz8gM0(tvaK84xec$zd
z$NU~U2mWS4xt+_b_(G(}IL+@;q4u3V#@VGWstxH?$o{KNaNBNG*4d7^{lT1+Grddt
z&gt;yHjRZ)Y^u;L@jr9;LE7*PLf^)tBeyQ@#iPsHh)*v%Wb`?t)o;Ix;7_=!=2s4ZR=R
znap}K`j?X&gt;Vue*_SJsMwhS~4QZeDXG_l*0phs4(mI5Ksc^*JFo@_yWsA&gt;u5cEBd=$
Nomp#llMZ{_rN5|l@7DkT</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/mailnews/import/test/unit/test_winmail.js</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,214 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+const IMPORTNAME = 'Windows Live Mail';</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+const IMPORTTYPE = 'settings';</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+function run_test()</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+{</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+  if (!(&quot;nsIWindowsRegKey&quot; in Ci))</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+    return;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+//////////////// -- Modified nsIWindowsRegKey implementation ---</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+  Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+  function MockWindowsRegKey() {</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+  }</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+  MockWindowsRegKey.prototype = {</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Ci.nsIWindowsRegKey]),</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+    open: function(aRootKey, aRelPath, aMode) {</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+      var f = do_get_file(&quot;resources/WindowsLiveMail&quot;);</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+      this._rootkey = aRootKey;</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+      this._keypath = aRelPath;</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+      if (aRelPath == &quot;Software\\Microsoft\\Windows Live Mail&quot; ||</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+          aRelPath == &quot;Software\\Microsoft\\Windows Mail&quot;) {</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+        this[&quot;Default Mail Account&quot;] = &quot;fill in mail account&quot;;</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+        this[&quot;Default News Account&quot;] = &quot;fill in news account&quot;;</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+        this[&quot;Store Root&quot;] = f.path;</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+      }</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+    },</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+    close: function() {</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+    },</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+    openChild: function(aRelPath, aMode) {</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+      child = new MockWindowsRegKey();</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+      child._rootkey = this._rootkey;</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+      child._keypath = this._keypath + &quot;\\&quot; + aRelPath;</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+      if (aRelPath == &quot;mail&quot;)</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+        child[&quot;Poll For Mail&quot;] = 123456;</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+      return child;</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+    },</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+    readIntValue: function(aName) {</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+      return this[aName];</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+    },</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+    readStringValue: function(aName) {</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+      return this[aName];</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineplus">+    }</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+  };</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+  var factory = {</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+    createInstance: function(aOuter, aIid) {</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+      if (aOuter != null)</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+        do_throw(Cr.NS_ERROR_NO_AGGREGATION);</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+      var key = new MockWindowsRegKey();</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+      return key.QueryInterface(aIid);</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+    }</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+  };</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineplus">+</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+  Components.manager.QueryInterface(Ci.nsIComponentRegistrar)</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+            .registerFactory(Components.ID(&quot;{0478de5b-0f38-4edb-851d-4c99f1ed8eba}&quot;),</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineplus">+                             &quot;Mock Windows Registry Implementation&quot;,</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineplus">+                             &quot;@mozilla.org/windows-registry-key;1&quot;, factory);</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineplus">+//////////////// -- Modified nsIWindowsRegKey implementation ---</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineplus">+</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineplus">+  var importedPrefs = [];</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineplus">+  var prefS = Cc[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineplus">+               .getService(Ci.nsIPrefBranch2);</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineplus">+  var obs = {</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineplus">+      if (aIID.equals(Ci.nsIObserver) || aaIID.equals(Ci.nsISupports))</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineplus">+        return this;</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+      do_throw(Cr.NS_NOINTERFACE);</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+    },</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+    observe: function observe(aSubj, aTopic, aData) {</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+      let prefSetting = {};</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineplus">+      prefSetting.name = aData;</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineplus">+      switch (prefS.getPrefType(aData)) {</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineplus">+        case prefS.PREF_BOOL:</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineplus">+          prefSetting.data = prefS.getBoolPref(aData);</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineplus">+          break;</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineplus">+        case prefS.PREF_INT:</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineplus">+          prefSetting.data = prefS.getIntPref(adata);</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineplus">+          break;</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineplus">+        case prefS.PREF_STRING:</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineplus">+          prefSetting.data = prefS.getCharPref(aData);</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineplus">+          break;</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+        case prefS.PREF_INVALID:</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+        default :</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineplus">+          prefSetting.data = null;</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+      }</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineplus">+      importedPrefs.push(prefSetting);</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+    }</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+  };</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+  prefS.addObserver('', obs, false);</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineplus">+</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineplus">+  var impS = Cc[&quot;@mozilla.org/import/import-service;1&quot;]</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineplus">+              .getService(Ci.nsIImportService);</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineplus">+</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineplus">+/////// import</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineplus">+  // There's probably a more direct way to import a known module and type but this</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineplus">+  // discovery method is used by the import dialog so we'll do it this way thereby</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineplus">+  // testing from the UI.</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineplus">+  var c = impS.GetModuleCount(IMPORTTYPE);</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineplus">+  for (var i = 0; i &lt; c; i++) {</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineplus">+    if (impS.GetModuleName(IMPORTTYPE, i) == IMPORTNAME) {</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineplus">+      var mod = impS.GetModule(IMPORTTYPE, i);</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineplus">+      break;</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineplus">+    }</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineplus">+  }</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineplus">+  if (!mod)</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineplus">+    do_throw(&quot;No import module&quot;);</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineplus">+  var settingsI = mod.GetImportInterface(IMPORTTYPE);</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineplus">+  if (settingsI)</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineplus">+    settingsI = settingsI.QueryInterface(Ci.nsIImportSettings);</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineplus">+  if (!settingsI)</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineplus">+    do_throw(&quot;No settings interface&quot;);</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineplus">+  var acct = {};</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineplus">+  if (!settingsI.Import(acct))</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineplus">+    do_throw(&quot;Import failed&quot;);</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineplus">+///////</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineplus">+  importedPrefs.sort(</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineplus">+    function(a,b){</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineplus">+      return (a.name &lt; b.name ? -1 : (a.name &gt; b.name ? 1 : 0));</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineplus">+    });</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineplus">+var test = &quot;&quot;;</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineplus">+// testing data--if new accounts are added, replace this with the dump 'test'.</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineplus">+// change all '\' to '\\' and replace this data. This test data needs to go</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineplus">+// to a file and probably be binary since we may have other invalid string</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineplus">+// characters in future checks.</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineplus">+</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineplus">+var testdata = &quot;mail.account.account1.serverserver2mail.account.account2.ide&quot; +</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineplus">+&quot;ntitiesid1mail.account.account2.serverserver1mail.account.account3.identiti&quot; +</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineplus">+&quot;esid2mail.account.account3.serverserver3mail.account.account4.identitiesid3&quot; +</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineplus">+&quot;mail.account.account4.serverserver4mail.account.account5.identitiesid4mail.&quot; +</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineplus">+&quot;account.account5.serverserver5mail.account.account6.identitiesid5mail.accou&quot; +</span>
<a href="#l11.137"></a><span id="l11.137" class="difflineplus">+&quot;nt.account6.serverserver6mail.accountmanager.accountsaccount1mail.accountma&quot; +</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineplus">+&quot;nager.accountsaccount1,account2mail.accountmanager.accountsaccount1,account&quot; +</span>
<a href="#l11.139"></a><span id="l11.139" class="difflineplus">+&quot;2,account3mail.accountmanager.accountsaccount1,account2,account3,account4ma&quot; +</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineplus">+&quot;il.accountmanager.accountsaccount1,account2,account3,account4,account5mail.&quot; +</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineplus">+&quot;accountmanager.accountsaccount1,account2,account3,account4,account5,account&quot; +</span>
<a href="#l11.142"></a><span id="l11.142" class="difflineplus">+&quot;6mail.accountmanager.defaultaccountaccount1mail.accountmanager.localfolders&quot; +</span>
<a href="#l11.143"></a><span id="l11.143" class="difflineplus">+&quot;serverserver2mail.identity.id1.fullNamepopdisplaynamemail.identity.id1.orga&quot; +</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineplus">+&quot;nizationpopdisplaynamemail.identity.id1.reply_totestpop@invalid.invalidmail&quot; +</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineplus">+&quot;.identity.id1.smtpServersmtp1mail.identity.id1.useremailtestpop@invalid.inv&quot; +</span>
<a href="#l11.146"></a><span id="l11.146" class="difflineplus">+&quot;alidmail.identity.id2.fullNametestmail.identity.id2.organizationtestmail.id&quot; +</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineplus">+&quot;entity.id2.reply_tomozillanews@invalid.invalidmail.identity.id2.useremailmo&quot; +</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineplus">+&quot;zillanews@invalid.invalidmail.identity.id4.fullNameDon Hallmail.identity.id&quot; +</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineplus">+&quot;4.organizationWingtip Toysmail.identity.id4.reply_todon@wingtiptoys.commail&quot; +</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineplus">+&quot;.identity.id4.useremaildon@wingtiptoys.commail.identity.id5.fullNameDon Hal&quot; +</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineplus">+&quot;lmail.identity.id5.organizationWingtip Toysmail.identity.id5.reply_todon@wi&quot; +</span>
<a href="#l11.152"></a><span id="l11.152" class="difflineplus">+&quot;ngtiptoys.commail.identity.id5.smtpServersmtp2mail.identity.id5.useremaildo&quot; +</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineplus">+&quot;n@wingtiptoys.commail.newsrc_root-rel[ProfD]Newsmail.root.imap-rel[Pr&quot; +</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineplus">+&quot;ofD]ImapMailmail.root.nntp-rel[ProfD]Newsmail.root.none-rel[ProfD]Mailmail.&quot; +</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineplus">+&quot;root.pop3-rel[ProfD]Mailmail.server.server1.check_new_mailtruemail.server.s&quot; +</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineplus">+&quot;erver1.defer_get_new_mailfalsemail.server.server1.deferred_to_accountaccoun&quot; +</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineplus">+&quot;t1mail.server.server1.delete_by_age_from_servertruemail.server.server1.dele&quot; +</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineplus">+&quot;te_mail_left_on_servertruemail.server.server&quot; +</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineplus">+&quot;1.directory-rel[ProfD]Mail/pop3.test.testmail.server.server1.hostnamepop3.t&quot; +</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineplus">+&quot;est.testmail.server.server1.leave_on_servertruemail.server.server1.nametest&quot; +</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineplus">+&quot;popaccountnamemail.server.server1.typepop3mail.server.server1.userNametestp&quot; +</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineplus">+&quot;opusernamemail.server.server2.directory-rel[P&quot; +</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineplus">+&quot;rofD]Mail/Local Foldersmail.server.server2.hostnameLocal Foldersmail.server&quot; +</span>
<a href="#l11.164"></a><span id="l11.164" class="difflineplus">+&quot;.server2.nameLocal Foldersmail.server.server2.typenonemail.server.server2.u&quot; +</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineplus">+&quot;serNamenobodymail.server.server3.direc&quot; +</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineplus">+&quot;tory-rel[ProfD]News/testnews.mozilla.orgmail.server.server3.hostnametestnew&quot; +</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineplus">+&quot;s.mozilla.orgmail.server.server3.nameaccountnamemozillanewsmail.server.serv&quot; +</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineplus">+&quot;er3.newsrc.file-rel[ProfD]News/te&quot; +</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineplus">+&quot;stnews.mozilla.org.rcmail.server.server3.typenntpmail.server.server4.direct&quot; +</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineplus">+&quot;ory-rel[ProfD]News/testmsnews.micr&quot; +</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineplus">+&quot;osoft.commail.server.server4.hostnametestmsnews.microsoft.commail.server.se&quot; +</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineplus">+&quot;rver4.nameMicrosoft Communities Testmail.server.server4.newsrc.file-rel[Pro&quot; +</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineplus">+&quot;fD]News/testmsnews.microsoft.&quot; +</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineplus">+&quot;com.rcmail.server.server4.typenntpmail.server.server5.always_authenticatetr&quot; +</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineplus">+&quot;uemail.server.server5.directory-rel[Pr&quot; +</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineplus">+&quot;ofD]News/news.wingtiptoys.commail.server.server5.hostnamenews.wingtiptoys.c&quot; +</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineplus">+&quot;ommail.server.server5.namedonhallnntpmail.server.server5.newsrc.file-rel[Pr&quot; +</span>
<a href="#l11.178"></a><span id="l11.178" class="difflineplus">+&quot;ofD]News/news.wingtiptoys.com.rcm&quot; +</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineplus">+&quot;ail.server.server5.typenntpmail.server.server5.userNamedonmail.server.serve&quot; +</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineplus">+&quot;r6.check_new_mailtruemail.server.s&quot; +</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineplus">+&quot;erver6.directory-rel[ProfD]ImapMail/mail.wingtiptoys.commail.server.server6&quot; +</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineplus">+&quot;.hostnamemail.wingtiptoys.commail.server.server6.namedonhallimapmail.server&quot; +</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineplus">+&quot;.server6.server_sub_directoryInboxmail.server.server6.typeimapmail.server.s&quot; +</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineplus">+&quot;erver6.userNamedonmail.smtpserver.smtp1.hostnamesmtp.pop.testmail.smtpserve&quot; +</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineplus">+&quot;r.smtp2.hostnamesmtp.wingtiptoys.commail.smtpserver.smtp2.usernamedonmail.s&quot; +</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineplus">+&quot;mtpserverssmtp1mail.smtpserverssmtp1,smtp2&quot;;</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineplus">+</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineplus">+  // XXX These prefs are excluded from being checked because they contain</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineplus">+  // relative directories, and hence make the results dependent on where</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineplus">+  // the tests are run. The prefs do have relative versions which are checked.</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineplus">+  const excludedPrefs = [</span>
<a href="#l11.192"></a><span id="l11.192" class="difflineplus">+    &quot;mail.newsrc_root&quot;, &quot;mail.root.imap&quot;, &quot;mail.root.nntp&quot;, &quot;mail.root.none&quot;,</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineplus">+    &quot;mail.root.pop3&quot;, &quot;mail.server.server1.directory&quot;,</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineplus">+    &quot;mail.server.server2.directory&quot;,</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineplus">+    &quot;mail.server.server3.directory&quot;, &quot;mail.server.server3.newsrc.file&quot;,</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineplus">+    &quot;mail.server.server4.directory&quot;, &quot;mail.server.server4.newsrc.file&quot;,</span>
<a href="#l11.197"></a><span id="l11.197" class="difflineplus">+    &quot;mail.server.server5.directory&quot;, &quot;mail.server.server5.newsrc.file&quot;,</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineplus">+    &quot;mail.server.server6.directory&quot;</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineplus">+  ];</span>
<a href="#l11.200"></a><span id="l11.200" class="difflineplus">+  dump(excludedPrefs + &quot;\n&quot;);</span>
<a href="#l11.201"></a><span id="l11.201" class="difflineplus">+  for ( let i = 0; i &lt; importedPrefs.length ; i++){</span>
<a href="#l11.202"></a><span id="l11.202" class="difflineplus">+    if (excludedPrefs.indexOf(importedPrefs[i].name) != -1)</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineplus">+      continue;</span>
<a href="#l11.204"></a><span id="l11.204" class="difflineplus">+    dump(importedPrefs[i].name+&quot;--&quot;+importedPrefs[i].data+&quot;\n&quot;);</span>
<a href="#l11.205"></a><span id="l11.205" class="difflineplus">+    test += importedPrefs[i].name + importedPrefs[i].data;</span>
<a href="#l11.206"></a><span id="l11.206" class="difflineplus">+  }</span>
<a href="#l11.207"></a><span id="l11.207" class="difflineplus">+// uncomment following to get valid test data when changing test data files.</span>
<a href="#l11.208"></a><span id="l11.208" class="difflineplus">+// dump(&quot;\nStart test dump\n&quot; + test + &quot;\nend test dump\n&quot;)</span>
<a href="#l11.209"></a><span id="l11.209" class="difflineplus">+</span>
<a href="#l11.210"></a><span id="l11.210" class="difflineplus">+  do_check_true(test == testdata);</span>
<a href="#l11.211"></a><span id="l11.211" class="difflineplus">+</span>
<a href="#l11.212"></a><span id="l11.212" class="difflineplus">+//////////////// -- Modified nsIWindowsRegKey implementation ---</span>
<a href="#l11.213"></a><span id="l11.213" class="difflineplus">+  Components.manager</span>
<a href="#l11.214"></a><span id="l11.214" class="difflineplus">+            .unregisterFactory(Components.ID(&quot;{0478de5b-0f38-4edb-851d-4c99f1ed8eba}&quot;),</span>
<a href="#l11.215"></a><span id="l11.215" class="difflineplus">+                                             factory);</span>
<a href="#l11.216"></a><span id="l11.216" class="difflineplus">+//////////////// -- Modified nsIWindowsRegKey implementation ---</span>
<a href="#l11.217"></a><span id="l11.217" class="difflineplus">+}</span>
<a href="#l11.218"></a><span id="l11.218" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">copy from mailnews/import/oexpress/Makefile.in</span>
<a href="#l12.2"></a><span id="l12.2">copy to mailnews/import/winlivemail/Makefile.in</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineminus">--- a/mailnews/import/oexpress/Makefile.in</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineplus">+++ b/mailnews/import/winlivemail/Makefile.in</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineat">@@ -30,56 +30,52 @@</span>
<a href="#l12.6"></a><span id="l12.6"> # use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l12.7"></a><span id="l12.7"> # decision by deleting the provisions above and replace them with the notice</span>
<a href="#l12.8"></a><span id="l12.8"> # and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l12.9"></a><span id="l12.9"> # the provisions above, a recipient may use your version of this file under</span>
<a href="#l12.10"></a><span id="l12.10"> # the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l12.11"></a><span id="l12.11"> #</span>
<a href="#l12.12"></a><span id="l12.12"> # ***** END LICENSE BLOCK *****</span>
<a href="#l12.13"></a><span id="l12.13"> </span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-DEPTH		= ../../..</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-topsrcdir	= @top_srcdir@</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-srcdir		= @srcdir@</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-VPATH		= @srcdir@</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+DEPTH       =   ../../..</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+topsrcdir   =   @top_srcdir@</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+srcdir      =   @srcdir@</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+VPATH       =   @srcdir@</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l12.24"></a><span id="l12.24"> </span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-MODULE		= importOE</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-LIBRARY_NAME   = importOE_s</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-ifndef MOZ_INCOMPLETE_EXTERNAL_LINKAGE</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-MOZILLA_INTERNAL_API = 1</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-endif</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-META_COMPONENT	= mail</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+MODULE      =           importWM</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+LIBRARY_NAME   =        importWM_s</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+MOZILLA_INTERNAL_API =  1</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+META_COMPONENT  =       mail</span>
<a href="#l12.35"></a><span id="l12.35"> </span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-REQUIRES	= xpcom \</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-		  string \</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-		  import \</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-		  addrbook \</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-		  mork \</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-		  intl \</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-		  msgbase \</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-		  pref \</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-		  necko \</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-		  msgdb \</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-		  msgbaseutil \</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-		  msgcompose \</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-		  msglocal \</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-		  msgimap \</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-		  msgnews \</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-		  unicharutil \</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-		  $(NULL)</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+REQUIRES    = \</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+                        xpcom \</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+                        string \</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+                        content   \</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+                        widget    \</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+                        dom       \</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+                        import \</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+                        addrbook \</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+                        mork \</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+                        intl \</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+                        msgbase \</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineplus">+                        pref \</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+                        necko \</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineplus">+                        msgdb \</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+                        msgbaseutil \</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+                        msgcompose \</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+                        msglocal \</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+                        msgimap \</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+                        msgnews \</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+                        unicharutil \</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+                        $(NULL)</span>
<a href="#l12.74"></a><span id="l12.74"> </span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-CPPSRCS		= \</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-		nsOEImport.cpp			\</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineminus">-		nsOEScanBoxes.cpp		\</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-		nsOEMailbox.cpp			\</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-		nsOEAddressIterator.cpp		\</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-		WabObject.cpp			\</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-		nsOERegUtil.cpp			\</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-		nsOE5File.cpp			\</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-		nsOESettings.cpp		\</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-		nsOEStringBundle.cpp		\</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineminus">-		$(NULL)</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineplus">+CPPSRCS     = \</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineplus">+                        nsWMSettings.cpp        \</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineplus">+                        nsWMImport.cpp  \</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+                        nsWMStringBundle.cpp    \</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineplus">+                        $(NULL)</span>
<a href="#l12.91"></a><span id="l12.91"> </span>
<a href="#l12.92"></a><span id="l12.92"> # we don't want the shared lib, but we want to force the creation of a static lib.</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-FORCE_STATIC_LIB = 1</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineplus">+FORCE_STATIC_LIB =      1</span>
<a href="#l12.95"></a><span id="l12.95"> </span>
<a href="#l12.96"></a><span id="l12.96"> include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">copy from mailnews/import/oexpress/OEDebugLog.h</span>
<a href="#l13.2"></a><span id="l13.2">copy to mailnews/import/winlivemail/WMDebugLog.h</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineminus">--- a/mailnews/import/oexpress/OEDebugLog.h</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineplus">+++ b/mailnews/import/winlivemail/WMDebugLog.h</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineat">@@ -30,23 +30,23 @@</span>
<a href="#l13.6"></a><span id="l13.6">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l13.7"></a><span id="l13.7">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l13.8"></a><span id="l13.8">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l13.9"></a><span id="l13.9">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l13.10"></a><span id="l13.10">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l13.11"></a><span id="l13.11">  *</span>
<a href="#l13.12"></a><span id="l13.12">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l13.13"></a><span id="l13.13"> </span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-#ifndef OEDebugLog_h___</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-#define OEDebugLog_h___</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+#ifndef WMDebugLog_h___</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+#define WMDebugLog_h___</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19"> // Use PR_LOG for logging.</span>
<a href="#l13.20"></a><span id="l13.20"> #include &quot;prlog.h&quot;</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">-extern PRLogModuleInfo *OELOGMODULE;  // Logging module</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+extern PRLogModuleInfo *WMLOGMODULE;  // Logging module</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-#define IMPORT_LOG0(x)          PR_LOG(OELOGMODULE, PR_LOG_DEBUG, (x))</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">-#define IMPORT_LOG1(x, y)       PR_LOG(OELOGMODULE, PR_LOG_DEBUG, (x, y))</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">-#define IMPORT_LOG2(x, y, z)    PR_LOG(OELOGMODULE, PR_LOG_DEBUG, (x, y, z))</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineminus">-#define IMPORT_LOG3(a, b, c, d) PR_LOG(OELOGMODULE, PR_LOG_DEBUG, (a, b, c, d))</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+#define IMPORT_LOG0(x)          PR_LOG(WMLOGMODULE, PR_LOG_DEBUG, (x))</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+#define IMPORT_LOG1(x, y)       PR_LOG(WMLOGMODULE, PR_LOG_DEBUG, (x, y))</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+#define IMPORT_LOG2(x, y, z)    PR_LOG(WMLOGMODULE, PR_LOG_DEBUG, (x, y, z))</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+#define IMPORT_LOG3(a, b, c, d) PR_LOG(WMLOGMODULE, PR_LOG_DEBUG, (a, b, c, d))</span>
<a href="#l13.32"></a><span id="l13.32"> </span>
<a href="#l13.33"></a><span id="l13.33"> </span>
<a href="#l13.34"></a><span id="l13.34"> </span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-#endif /* OEDebugLog_h___ */</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+#endif /* WMDebugLog_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">copy from mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l14.2"></a><span id="l14.2">copy to mailnews/import/winlivemail/nsWMImport.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineminus">--- a/mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMImport.cpp</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineat">@@ -34,63 +34,58 @@</span>
<a href="#l14.6"></a><span id="l14.6">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.7"></a><span id="l14.7">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.8"></a><span id="l14.8">  *</span>
<a href="#l14.9"></a><span id="l14.9">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12"> /*</span>
<a href="#l14.13"></a><span id="l14.13"> </span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-  Outlook Express (Win32) import mail and addressbook interfaces</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+  Windows Live Mail (Win32) import mail and addressbook interfaces</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17"> */</span>
<a href="#l14.18"></a><span id="l14.18"> #ifdef MOZ_LOGGING</span>
<a href="#l14.19"></a><span id="l14.19"> // sorry, this has to be before the pre-compiled header</span>
<a href="#l14.20"></a><span id="l14.20"> #define FORCE_PR_LOG /* Allow logging in the release build */</span>
<a href="#l14.21"></a><span id="l14.21"> #endif</span>
<a href="#l14.22"></a><span id="l14.22"> </span>
<a href="#l14.23"></a><span id="l14.23"> #include &quot;nscore.h&quot;</span>
<a href="#l14.24"></a><span id="l14.24"> #include &quot;nsString.h&quot;</span>
<a href="#l14.25"></a><span id="l14.25"> #include &quot;nsReadableUtils.h&quot;</span>
<a href="#l14.26"></a><span id="l14.26"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l14.27"></a><span id="l14.27"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-#include &quot;nsOEImport.h&quot;</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+#include &quot;nsWMImport.h&quot;</span>
<a href="#l14.30"></a><span id="l14.30"> #include &quot;nsIMemory.h&quot;</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-#include &quot;nsOEScanBoxes.h&quot;</span>
<a href="#l14.32"></a><span id="l14.32"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l14.33"></a><span id="l14.33"> #include &quot;nsIImportMail.h&quot;</span>
<a href="#l14.34"></a><span id="l14.34"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l14.35"></a><span id="l14.35"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-#include &quot;nsOEMailbox.h&quot;</span>
<a href="#l14.37"></a><span id="l14.37"> #include &quot;nsIImportAddressBooks.h&quot;</span>
<a href="#l14.38"></a><span id="l14.38"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l14.39"></a><span id="l14.39"> #include &quot;nsIImportFieldMap.h&quot;</span>
<a href="#l14.40"></a><span id="l14.40"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l14.41"></a><span id="l14.41"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-#include &quot;WabObject.h&quot;</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-#include &quot;nsOEAddressIterator.h&quot;</span>
<a href="#l14.44"></a><span id="l14.44"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-#include &quot;nsOE5File.h&quot;</span>
<a href="#l14.46"></a><span id="l14.46"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-#include &quot;nsOESettings.h&quot;</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+#include &quot;nsWMSettings.h&quot;</span>
<a href="#l14.49"></a><span id="l14.49"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-#include &quot;nsOEStringBundle.h&quot;</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+#include &quot;nsWMStringBundle.h&quot;</span>
<a href="#l14.52"></a><span id="l14.52"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l14.53"></a><span id="l14.53"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l14.54"></a><span id="l14.54"> </span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-#include &quot;OEDebugLog.h&quot;</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+#include &quot;WMDebugLog.h&quot;</span>
<a href="#l14.57"></a><span id="l14.57"> </span>
<a href="#l14.58"></a><span id="l14.58"> static NS_DEFINE_IID(kISupportsIID, NS_ISUPPORTS_IID);</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">-PRLogModuleInfo *OELOGMODULE = nsnull;</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+PRLogModuleInfo *WMLOGMODULE = nsnull;</span>
<a href="#l14.61"></a><span id="l14.61"> </span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-class ImportOEMailImpl : public nsIImportMail</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+class ImportWMMailImpl : public nsIImportMail</span>
<a href="#l14.64"></a><span id="l14.64"> {</span>
<a href="#l14.65"></a><span id="l14.65"> public:</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">-  ImportOEMailImpl();</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineminus">-  virtual ~ImportOEMailImpl();</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+  ImportWMMailImpl();</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+  virtual ~ImportWMMailImpl();</span>
<a href="#l14.70"></a><span id="l14.70"> </span>
<a href="#l14.71"></a><span id="l14.71">   static nsresult Create(nsIImportMail** aImport);</span>
<a href="#l14.72"></a><span id="l14.72"> </span>
<a href="#l14.73"></a><span id="l14.73">   // nsISupports interface</span>
<a href="#l14.74"></a><span id="l14.74">   NS_DECL_ISUPPORTS</span>
<a href="#l14.75"></a><span id="l14.75"> </span>
<a href="#l14.76"></a><span id="l14.76">   // nsIImportmail interface</span>
<a href="#l14.77"></a><span id="l14.77"> </span>
<a href="#l14.78"></a><span id="l14.78" class="difflineat">@@ -114,573 +109,181 @@ public:</span>
<a href="#l14.79"></a><span id="l14.79">   static void ReportError( PRInt32 errorNum, nsString&amp; name, nsString *pStream);</span>
<a href="#l14.80"></a><span id="l14.80">   static void AddLinebreak( nsString *pStream);</span>
<a href="#l14.81"></a><span id="l14.81">   static void SetLogs( nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess);</span>
<a href="#l14.82"></a><span id="l14.82"> </span>
<a href="#l14.83"></a><span id="l14.83"> private:</span>
<a href="#l14.84"></a><span id="l14.84">   PRUint32 m_bytesDone;</span>
<a href="#l14.85"></a><span id="l14.85"> };</span>
<a href="#l14.86"></a><span id="l14.86"> </span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-class ImportOEAddressImpl : public nsIImportAddressBooks</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-{</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-public:</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineminus">-    ImportOEAddressImpl();</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineminus">-    virtual ~ImportOEAddressImpl();</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineminus">-</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineminus">-  static nsresult Create(nsIImportAddressBooks** aImport);</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineminus">-</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineminus">-    // nsISupports interface</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-    NS_DECL_ISUPPORTS</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineminus">-</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineminus">-    // nsIImportAddressBooks interface</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-  /* PRBool GetSupportsMultiple (); */</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-  NS_IMETHOD GetSupportsMultiple(PRBool *_retval) { *_retval = PR_FALSE; return( NS_OK);}</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-  /* PRBool GetAutoFind (out wstring description); */</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-  NS_IMETHOD GetAutoFind(PRUnichar **description, PRBool *_retval);</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-  /* PRBool GetNeedsFieldMap ( nsIFile *location); */</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-  NS_IMETHOD GetNeedsFieldMap(nsIFile *pLoc, PRBool *_retval) { *_retval = PR_FALSE; return( NS_OK);}</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineminus">-</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineminus">-  /* void GetDefaultLocation (out nsIFile location, out boolean found, out boolean userVerify); */</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-  NS_IMETHOD GetDefaultLocation(nsIFile **location, PRBool *found, PRBool *userVerify)</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineminus">-    { return( NS_ERROR_FAILURE);}</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineminus">-</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineminus">-  /* nsISupportsArray FindAddressBooks (in nsIFile location); */</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineminus">-  NS_IMETHOD FindAddressBooks(nsIFile *location, nsISupportsArray **_retval);</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineminus">-</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineminus">-  /* nsISupports InitFieldMap(nsIImportFieldMap *fieldMap); */</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineminus">-  NS_IMETHOD InitFieldMap(nsIImportFieldMap *fieldMap)</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineminus">-    { return( NS_ERROR_FAILURE); }</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineminus">-</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineminus">-  NS_IMETHOD ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineminus">-                               nsIAddrDatabase *destination,</span>
<a href="#l14.123"></a><span id="l14.123" class="difflineminus">-                               nsIImportFieldMap *fieldMap,</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineminus">-                               nsISupports *aSupportService,</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineminus">-                               PRBool isAddrLocHome,</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineminus">-                               PRUnichar **errorLog,</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineminus">-                               PRUnichar **successLog,</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineminus">-                               PRBool *fatalError);</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineminus">-</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineminus">-  /* unsigned long GetImportProgress (); */</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineminus">-  NS_IMETHOD GetImportProgress(PRUint32 *_retval);</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineminus">-</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineminus">-  NS_IMETHOD GetSampleData( PRInt32 index, PRBool *pFound, PRUnichar **pStr)</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineminus">-    { return( NS_ERROR_FAILURE);}</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineminus">-</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineminus">-  NS_IMETHOD SetSampleLocation( nsIFile *) { return( NS_OK); }</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineminus">-</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineminus">-private:</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineminus">-  static void ReportSuccess( nsString&amp; name, nsString *pStream);</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineminus">-</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineminus">-private:</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineminus">-  CWAB * m_pWab;</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineminus">-  int m_doneSoFar;</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineminus">-};</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineminus">-////////////////////////////////////////////////////////////////////////</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineminus">-</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineminus">-</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineminus">-////////////////////////////////////////////////////////////////////////</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineminus">-</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineminus">-</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineminus">-nsOEImport::nsOEImport()</span>
<a href="#l14.152"></a><span id="l14.152" class="difflineplus">+nsWMImport::nsWMImport()</span>
<a href="#l14.153"></a><span id="l14.153"> {</span>
<a href="#l14.154"></a><span id="l14.154">   // Init logging module.</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineminus">-  if (!OELOGMODULE)</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineminus">-    OELOGMODULE = PR_NewLogModule(&quot;IMPORT&quot;);</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineminus">-  IMPORT_LOG0( &quot;nsOEImport Module Created\n&quot;);</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineminus">-  nsOEStringBundle::GetStringBundle();</span>
<a href="#l14.159"></a><span id="l14.159" class="difflineplus">+  if (!WMLOGMODULE)</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineplus">+    WMLOGMODULE = PR_NewLogModule(&quot;IMPORT&quot;);</span>
<a href="#l14.161"></a><span id="l14.161" class="difflineplus">+  IMPORT_LOG0( &quot;nsWMImport Module Created\n&quot;);</span>
<a href="#l14.162"></a><span id="l14.162" class="difflineplus">+  nsWMStringBundle::GetStringBundle();</span>
<a href="#l14.163"></a><span id="l14.163"> }</span>
<a href="#l14.164"></a><span id="l14.164"> </span>
<a href="#l14.165"></a><span id="l14.165" class="difflineminus">-</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineminus">-nsOEImport::~nsOEImport()</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineplus">+nsWMImport::~nsWMImport()</span>
<a href="#l14.168"></a><span id="l14.168"> {</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineminus">-  IMPORT_LOG0( &quot;nsOEImport Module Deleted\n&quot;);</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineplus">+  IMPORT_LOG0( &quot;nsWMImport Module Deleted\n&quot;);</span>
<a href="#l14.171"></a><span id="l14.171"> }</span>
<a href="#l14.172"></a><span id="l14.172"> </span>
<a href="#l14.173"></a><span id="l14.173" class="difflineminus">-NS_IMPL_ISUPPORTS1(nsOEImport, nsIImportModule)</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineplus">+NS_IMPL_ISUPPORTS1(nsWMImport, nsIImportModule)</span>
<a href="#l14.175"></a><span id="l14.175"> </span>
<a href="#l14.176"></a><span id="l14.176" class="difflineminus">-NS_IMETHODIMP nsOEImport::GetName( PRUnichar **name)</span>
<a href="#l14.177"></a><span id="l14.177" class="difflineplus">+NS_IMETHODIMP nsWMImport::GetName( PRUnichar **name)</span>
<a href="#l14.178"></a><span id="l14.178"> {</span>
<a href="#l14.179"></a><span id="l14.179">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineminus">-</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineminus">-  *name = nsOEStringBundle::GetStringByID( OEIMPORT_NAME);</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineplus">+  // nsString  title = &quot;Windows Live Mail&quot;;</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineplus">+  // *name = ToNewUnicode(title);</span>
<a href="#l14.184"></a><span id="l14.184" class="difflineplus">+  *name = nsWMStringBundle::GetStringByID( WMIMPORT_NAME);</span>
<a href="#l14.185"></a><span id="l14.185"> </span>
<a href="#l14.186"></a><span id="l14.186">     return NS_OK;</span>
<a href="#l14.187"></a><span id="l14.187"> }</span>
<a href="#l14.188"></a><span id="l14.188"> </span>
<a href="#l14.189"></a><span id="l14.189" class="difflineminus">-NS_IMETHODIMP nsOEImport::GetDescription( PRUnichar **name)</span>
<a href="#l14.190"></a><span id="l14.190" class="difflineplus">+NS_IMETHODIMP nsWMImport::GetDescription( PRUnichar **name)</span>
<a href="#l14.191"></a><span id="l14.191"> {</span>
<a href="#l14.192"></a><span id="l14.192">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l14.193"></a><span id="l14.193"> </span>
<a href="#l14.194"></a><span id="l14.194" class="difflineminus">-  *name = nsOEStringBundle::GetStringByID( OEIMPORT_DESCRIPTION);</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineplus">+  // nsString  desc = &quot;Windows Live Mail mail and address books&quot;;</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineplus">+  // *name = ToNewUnicode(desc);</span>
<a href="#l14.197"></a><span id="l14.197" class="difflineplus">+  *name = nsWMStringBundle::GetStringByID( WMIMPORT_DESCRIPTION);</span>
<a href="#l14.198"></a><span id="l14.198">   return NS_OK;</span>
<a href="#l14.199"></a><span id="l14.199"> }</span>
<a href="#l14.200"></a><span id="l14.200"> </span>
<a href="#l14.201"></a><span id="l14.201" class="difflineminus">-NS_IMETHODIMP nsOEImport::GetSupports( char **supports)</span>
<a href="#l14.202"></a><span id="l14.202" class="difflineplus">+NS_IMETHODIMP nsWMImport::GetSupports( char **supports)</span>
<a href="#l14.203"></a><span id="l14.203"> {</span>
<a href="#l14.204"></a><span id="l14.204">   NS_PRECONDITION(supports != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.205"></a><span id="l14.205">   if (! supports)</span>
<a href="#l14.206"></a><span id="l14.206">       return NS_ERROR_NULL_POINTER;</span>
<a href="#l14.207"></a><span id="l14.207"> </span>
<a href="#l14.208"></a><span id="l14.208" class="difflineminus">-  *supports = strdup( kOESupportsString);</span>
<a href="#l14.209"></a><span id="l14.209" class="difflineplus">+  *supports = strdup( kWMSupportsString);</span>
<a href="#l14.210"></a><span id="l14.210">   return( NS_OK);</span>
<a href="#l14.211"></a><span id="l14.211"> }</span>
<a href="#l14.212"></a><span id="l14.212"> </span>
<a href="#l14.213"></a><span id="l14.213" class="difflineminus">-</span>
<a href="#l14.214"></a><span id="l14.214" class="difflineminus">-NS_IMETHODIMP nsOEImport::GetSupportsUpgrade( PRBool *pUpgrade)</span>
<a href="#l14.215"></a><span id="l14.215" class="difflineplus">+NS_IMETHODIMP nsWMImport::GetSupportsUpgrade( PRBool *pUpgrade)</span>
<a href="#l14.216"></a><span id="l14.216"> {</span>
<a href="#l14.217"></a><span id="l14.217">   NS_PRECONDITION(pUpgrade != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.218"></a><span id="l14.218">   if (! pUpgrade)</span>
<a href="#l14.219"></a><span id="l14.219">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l14.220"></a><span id="l14.220"> </span>
<a href="#l14.221"></a><span id="l14.221">   *pUpgrade = PR_TRUE;</span>
<a href="#l14.222"></a><span id="l14.222">   return( NS_OK);</span>
<a href="#l14.223"></a><span id="l14.223"> }</span>
<a href="#l14.224"></a><span id="l14.224"> </span>
<a href="#l14.225"></a><span id="l14.225" class="difflineminus">-NS_IMETHODIMP nsOEImport::GetImportInterface( const char *pImportType, nsISupports **ppInterface)</span>
<a href="#l14.226"></a><span id="l14.226" class="difflineplus">+NS_IMETHODIMP nsWMImport::GetImportInterface(const char *pImportType,</span>
<a href="#l14.227"></a><span id="l14.227" class="difflineplus">+                                             nsISupports **ppInterface)</span>
<a href="#l14.228"></a><span id="l14.228"> {</span>
<a href="#l14.229"></a><span id="l14.229">   NS_ENSURE_ARG_POINTER(pImportType);</span>
<a href="#l14.230"></a><span id="l14.230">   NS_ENSURE_ARG_POINTER(ppInterface);</span>
<a href="#l14.231"></a><span id="l14.231"> </span>
<a href="#l14.232"></a><span id="l14.232">   *ppInterface = nsnull;</span>
<a href="#l14.233"></a><span id="l14.233">   nsresult rv;</span>
<a href="#l14.234"></a><span id="l14.234" class="difflineminus">-  if (!strcmp( pImportType, &quot;mail&quot;)) {</span>
<a href="#l14.235"></a><span id="l14.235" class="difflineminus">-    // create the nsIImportMail interface and return it!</span>
<a href="#l14.236"></a><span id="l14.236" class="difflineminus">-    nsIImportMail *  pMail = nsnull;</span>
<a href="#l14.237"></a><span id="l14.237" class="difflineminus">-    nsIImportGeneric *pGeneric = nsnull;</span>
<a href="#l14.238"></a><span id="l14.238" class="difflineminus">-    rv = ImportOEMailImpl::Create( &amp;pMail);</span>
<a href="#l14.239"></a><span id="l14.239" class="difflineminus">-    if (NS_SUCCEEDED( rv)) {</span>
<a href="#l14.240"></a><span id="l14.240" class="difflineminus">-      nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l14.241"></a><span id="l14.241" class="difflineminus">-      if (NS_SUCCEEDED( rv)) {</span>
<a href="#l14.242"></a><span id="l14.242" class="difflineminus">-        rv = impSvc-&gt;CreateNewGenericMail( &amp;pGeneric);</span>
<a href="#l14.243"></a><span id="l14.243" class="difflineminus">-        if (NS_SUCCEEDED( rv)) {</span>
<a href="#l14.244"></a><span id="l14.244" class="difflineminus">-          pGeneric-&gt;SetData( &quot;mailInterface&quot;, pMail);</span>
<a href="#l14.245"></a><span id="l14.245" class="difflineminus">-          nsString name;</span>
<a href="#l14.246"></a><span id="l14.246" class="difflineminus">-          nsOEStringBundle::GetStringByID( OEIMPORT_NAME, name);</span>
<a href="#l14.247"></a><span id="l14.247" class="difflineminus">-          nsCOMPtr&lt;nsISupportsString&gt; nameString (do_CreateInstance(NS_SUPPORTS_STRING_CONTRACTID, &amp;rv));</span>
<a href="#l14.248"></a><span id="l14.248" class="difflineminus">-          if (NS_SUCCEEDED(rv)) {</span>
<a href="#l14.249"></a><span id="l14.249" class="difflineminus">-            nameString-&gt;SetData(name);</span>
<a href="#l14.250"></a><span id="l14.250" class="difflineminus">-            pGeneric-&gt;SetData( &quot;name&quot;, nameString);</span>
<a href="#l14.251"></a><span id="l14.251" class="difflineminus">-            rv = pGeneric-&gt;QueryInterface( kISupportsIID, (void **)ppInterface);</span>
<a href="#l14.252"></a><span id="l14.252" class="difflineminus">-          }</span>
<a href="#l14.253"></a><span id="l14.253" class="difflineminus">-        }</span>
<a href="#l14.254"></a><span id="l14.254" class="difflineminus">-      }</span>
<a href="#l14.255"></a><span id="l14.255" class="difflineminus">-    }</span>
<a href="#l14.256"></a><span id="l14.256" class="difflineminus">-    NS_IF_RELEASE( pMail);</span>
<a href="#l14.257"></a><span id="l14.257" class="difflineminus">-    NS_IF_RELEASE( pGeneric);</span>
<a href="#l14.258"></a><span id="l14.258" class="difflineminus">-    return( rv);</span>
<a href="#l14.259"></a><span id="l14.259" class="difflineminus">-  }</span>
<a href="#l14.260"></a><span id="l14.260" class="difflineminus">-</span>
<a href="#l14.261"></a><span id="l14.261" class="difflineminus">-  if (!strcmp( pImportType, &quot;addressbook&quot;)) {</span>
<a href="#l14.262"></a><span id="l14.262" class="difflineminus">-    // create the nsIImportMail interface and return it!</span>
<a href="#l14.263"></a><span id="l14.263" class="difflineminus">-    nsIImportAddressBooks * pAddress = nsnull;</span>
<a href="#l14.264"></a><span id="l14.264" class="difflineminus">-    nsIImportGeneric * pGeneric = nsnull;</span>
<a href="#l14.265"></a><span id="l14.265" class="difflineminus">-    rv = ImportOEAddressImpl::Create( &amp;pAddress);</span>
<a href="#l14.266"></a><span id="l14.266" class="difflineminus">-    if (NS_SUCCEEDED( rv)) {</span>
<a href="#l14.267"></a><span id="l14.267" class="difflineminus">-      nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l14.268"></a><span id="l14.268" class="difflineminus">-      if (NS_SUCCEEDED( rv)) {</span>
<a href="#l14.269"></a><span id="l14.269" class="difflineminus">-        rv = impSvc-&gt;CreateNewGenericAddressBooks( &amp;pGeneric);</span>
<a href="#l14.270"></a><span id="l14.270" class="difflineminus">-        if (NS_SUCCEEDED( rv)) {</span>
<a href="#l14.271"></a><span id="l14.271" class="difflineminus">-          pGeneric-&gt;SetData( &quot;addressInterface&quot;, pAddress);</span>
<a href="#l14.272"></a><span id="l14.272" class="difflineminus">-          rv = pGeneric-&gt;QueryInterface( kISupportsIID, (void **)ppInterface);</span>
<a href="#l14.273"></a><span id="l14.273" class="difflineminus">-        }</span>
<a href="#l14.274"></a><span id="l14.274" class="difflineminus">-      }</span>
<a href="#l14.275"></a><span id="l14.275" class="difflineminus">-    }</span>
<a href="#l14.276"></a><span id="l14.276" class="difflineminus">-    NS_IF_RELEASE( pAddress);</span>
<a href="#l14.277"></a><span id="l14.277" class="difflineminus">-    NS_IF_RELEASE( pGeneric);</span>
<a href="#l14.278"></a><span id="l14.278" class="difflineminus">-    return( rv);</span>
<a href="#l14.279"></a><span id="l14.279" class="difflineminus">-  }</span>
<a href="#l14.280"></a><span id="l14.280"> </span>
<a href="#l14.281"></a><span id="l14.281">   if (!strcmp( pImportType, &quot;settings&quot;)) {</span>
<a href="#l14.282"></a><span id="l14.282">     nsIImportSettings *pSettings = nsnull;</span>
<a href="#l14.283"></a><span id="l14.283" class="difflineminus">-    rv = nsOESettings::Create( &amp;pSettings);</span>
<a href="#l14.284"></a><span id="l14.284" class="difflineplus">+    rv = nsWMSettings::Create( &amp;pSettings);</span>
<a href="#l14.285"></a><span id="l14.285">     if (NS_SUCCEEDED( rv)) {</span>
<a href="#l14.286"></a><span id="l14.286">       pSettings-&gt;QueryInterface( kISupportsIID, (void **)ppInterface);</span>
<a href="#l14.287"></a><span id="l14.287">     }</span>
<a href="#l14.288"></a><span id="l14.288">     NS_IF_RELEASE( pSettings);</span>
<a href="#l14.289"></a><span id="l14.289">     return( rv);</span>
<a href="#l14.290"></a><span id="l14.290">   }</span>
<a href="#l14.291"></a><span id="l14.291"> </span>
<a href="#l14.292"></a><span id="l14.292">   return( NS_ERROR_NOT_AVAILABLE);</span>
<a href="#l14.293"></a><span id="l14.293"> }</span>
<a href="#l14.294"></a><span id="l14.294"> </span>
<a href="#l14.295"></a><span id="l14.295"> /////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l14.296"></a><span id="l14.296" class="difflineminus">-nsresult ImportOEMailImpl::Create(nsIImportMail** aImport)</span>
<a href="#l14.297"></a><span id="l14.297" class="difflineplus">+nsresult ImportWMMailImpl::Create(nsIImportMail** aImport)</span>
<a href="#l14.298"></a><span id="l14.298"> {</span>
<a href="#l14.299"></a><span id="l14.299">   NS_ENSURE_ARG_POINTER(aImport);</span>
<a href="#l14.300"></a><span id="l14.300" class="difflineminus">-  *aImport = new ImportOEMailImpl();</span>
<a href="#l14.301"></a><span id="l14.301" class="difflineplus">+  *aImport = new ImportWMMailImpl();</span>
<a href="#l14.302"></a><span id="l14.302">   NS_ENSURE_TRUE(*aImport, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l14.303"></a><span id="l14.303">   NS_ADDREF(*aImport);</span>
<a href="#l14.304"></a><span id="l14.304">   return NS_OK;</span>
<a href="#l14.305"></a><span id="l14.305"> }</span>
<a href="#l14.306"></a><span id="l14.306"> </span>
<a href="#l14.307"></a><span id="l14.307" class="difflineminus">-ImportOEMailImpl::ImportOEMailImpl()</span>
<a href="#l14.308"></a><span id="l14.308" class="difflineplus">+ImportWMMailImpl::ImportWMMailImpl()</span>
<a href="#l14.309"></a><span id="l14.309"> {</span>
<a href="#l14.310"></a><span id="l14.310"> }</span>
<a href="#l14.311"></a><span id="l14.311"> </span>
<a href="#l14.312"></a><span id="l14.312" class="difflineminus">-</span>
<a href="#l14.313"></a><span id="l14.313" class="difflineminus">-ImportOEMailImpl::~ImportOEMailImpl()</span>
<a href="#l14.314"></a><span id="l14.314" class="difflineplus">+ImportWMMailImpl::~ImportWMMailImpl()</span>
<a href="#l14.315"></a><span id="l14.315"> {</span>
<a href="#l14.316"></a><span id="l14.316"> }</span>
<a href="#l14.317"></a><span id="l14.317"> </span>
<a href="#l14.318"></a><span id="l14.318" class="difflineminus">-NS_IMPL_THREADSAFE_ISUPPORTS1(ImportOEMailImpl, nsIImportMail)</span>
<a href="#l14.319"></a><span id="l14.319" class="difflineplus">+NS_IMPL_THREADSAFE_ISUPPORTS1(ImportWMMailImpl, nsIImportMail)</span>
<a href="#l14.320"></a><span id="l14.320"> </span>
<a href="#l14.321"></a><span id="l14.321" class="difflineminus">-NS_IMETHODIMP ImportOEMailImpl::TranslateFolderName(const nsAString &amp; aFolderName, nsAString &amp; _retval)</span>
<a href="#l14.322"></a><span id="l14.322" class="difflineplus">+NS_IMETHODIMP ImportWMMailImpl::TranslateFolderName(const nsAString &amp; aFolderName, nsAString &amp; _retval)</span>
<a href="#l14.323"></a><span id="l14.323"> {</span>
<a href="#l14.324"></a><span id="l14.324" class="difflineminus">-  if (aFolderName.Equals(NS_LITERAL_STRING(&quot;Deleted Items&quot;), nsCaseInsensitiveStringComparator()))</span>
<a href="#l14.325"></a><span id="l14.325" class="difflineminus">-      _retval = NS_LITERAL_STRING(kDestTrashFolderName);</span>
<a href="#l14.326"></a><span id="l14.326" class="difflineminus">-  else if (aFolderName.Equals(NS_LITERAL_STRING(&quot;Sent Items&quot;), nsCaseInsensitiveStringComparator()))</span>
<a href="#l14.327"></a><span id="l14.327" class="difflineminus">-      _retval = NS_LITERAL_STRING(kDestSentFolderName);</span>
<a href="#l14.328"></a><span id="l14.328" class="difflineminus">-  else if (aFolderName.Equals(NS_LITERAL_STRING(&quot;Outbox&quot;), nsCaseInsensitiveStringComparator()))</span>
<a href="#l14.329"></a><span id="l14.329" class="difflineminus">-      _retval = NS_LITERAL_STRING(kDestUnsentMessagesFolderName);</span>
<a href="#l14.330"></a><span id="l14.330" class="difflineminus">-  else</span>
<a href="#l14.331"></a><span id="l14.331" class="difflineminus">-      _retval = aFolderName;</span>
<a href="#l14.332"></a><span id="l14.332" class="difflineminus">-</span>
<a href="#l14.333"></a><span id="l14.333" class="difflineminus">-  return NS_OK;</span>
<a href="#l14.334"></a><span id="l14.334" class="difflineplus">+  return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l14.335"></a><span id="l14.335"> }</span>
<a href="#l14.336"></a><span id="l14.336"> </span>
<a href="#l14.337"></a><span id="l14.337" class="difflineminus">-NS_IMETHODIMP ImportOEMailImpl::GetDefaultLocation( nsIFile **ppLoc, PRBool *found, PRBool *userVerify)</span>
<a href="#l14.338"></a><span id="l14.338" class="difflineplus">+NS_IMETHODIMP ImportWMMailImpl::GetDefaultLocation(nsIFile **ppLoc, PRBool *found,</span>
<a href="#l14.339"></a><span id="l14.339" class="difflineplus">+                                                   PRBool *userVerify)</span>
<a href="#l14.340"></a><span id="l14.340"> {</span>
<a href="#l14.341"></a><span id="l14.341" class="difflineminus">-  NS_PRECONDITION(ppLoc != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.342"></a><span id="l14.342" class="difflineminus">-  NS_PRECONDITION(found != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.343"></a><span id="l14.343" class="difflineminus">-  NS_PRECONDITION(userVerify != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.344"></a><span id="l14.344" class="difflineminus">-  if (!ppLoc || !found || !userVerify)</span>
<a href="#l14.345"></a><span id="l14.345" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l14.346"></a><span id="l14.346" class="difflineminus">-</span>
<a href="#l14.347"></a><span id="l14.347" class="difflineminus">-  // use scanboxes to find the location.</span>
<a href="#l14.348"></a><span id="l14.348" class="difflineminus">-  nsresult rv;</span>
<a href="#l14.349"></a><span id="l14.349" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l14.350"></a><span id="l14.350" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l14.351"></a><span id="l14.351" class="difflineminus">-    return rv;</span>
<a href="#l14.352"></a><span id="l14.352" class="difflineminus">-</span>
<a href="#l14.353"></a><span id="l14.353" class="difflineminus">-  if (nsOEScanBoxes::FindMail(file)) {</span>
<a href="#l14.354"></a><span id="l14.354" class="difflineminus">-    *found = PR_TRUE;</span>
<a href="#l14.355"></a><span id="l14.355" class="difflineminus">-    NS_IF_ADDREF(*ppLoc = file);</span>
<a href="#l14.356"></a><span id="l14.356" class="difflineminus">-  }</span>
<a href="#l14.357"></a><span id="l14.357" class="difflineminus">-  else {</span>
<a href="#l14.358"></a><span id="l14.358" class="difflineminus">-    *found = PR_FALSE;</span>
<a href="#l14.359"></a><span id="l14.359" class="difflineminus">-    *ppLoc = nsnull;</span>
<a href="#l14.360"></a><span id="l14.360" class="difflineminus">-  }</span>
<a href="#l14.361"></a><span id="l14.361" class="difflineminus">-  *userVerify = PR_TRUE;</span>
<a href="#l14.362"></a><span id="l14.362" class="difflineminus">-  return( NS_OK);</span>
<a href="#l14.363"></a><span id="l14.363" class="difflineplus">+  return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l14.364"></a><span id="l14.364"> }</span>
<a href="#l14.365"></a><span id="l14.365"> </span>
<a href="#l14.366"></a><span id="l14.366" class="difflineminus">-</span>
<a href="#l14.367"></a><span id="l14.367" class="difflineminus">-NS_IMETHODIMP ImportOEMailImpl::FindMailboxes( nsIFile *pLoc, nsISupportsArray **ppArray)</span>
<a href="#l14.368"></a><span id="l14.368" class="difflineplus">+NS_IMETHODIMP ImportWMMailImpl::FindMailboxes(nsIFile *pLoc,</span>
<a href="#l14.369"></a><span id="l14.369" class="difflineplus">+                                              nsISupportsArray **ppArray)</span>
<a href="#l14.370"></a><span id="l14.370"> {</span>
<a href="#l14.371"></a><span id="l14.371" class="difflineminus">-    NS_PRECONDITION(pLoc != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.372"></a><span id="l14.372" class="difflineminus">-    NS_PRECONDITION(ppArray != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.373"></a><span id="l14.373" class="difflineminus">-    if (!pLoc || !ppArray)</span>
<a href="#l14.374"></a><span id="l14.374" class="difflineminus">-        return NS_ERROR_NULL_POINTER;</span>
<a href="#l14.375"></a><span id="l14.375" class="difflineminus">-</span>
<a href="#l14.376"></a><span id="l14.376" class="difflineminus">-  PRBool exists = PR_FALSE;</span>
<a href="#l14.377"></a><span id="l14.377" class="difflineminus">-  nsresult rv = pLoc-&gt;Exists( &amp;exists);</span>
<a href="#l14.378"></a><span id="l14.378" class="difflineminus">-  if (NS_FAILED( rv) || !exists)</span>
<a href="#l14.379"></a><span id="l14.379" class="difflineminus">-    return( NS_ERROR_FAILURE);</span>
<a href="#l14.380"></a><span id="l14.380" class="difflineminus">-</span>
<a href="#l14.381"></a><span id="l14.381" class="difflineminus">-  nsOEScanBoxes  scan;</span>
<a href="#l14.382"></a><span id="l14.382" class="difflineminus">-</span>
<a href="#l14.383"></a><span id="l14.383" class="difflineminus">-  if (!scan.GetMailboxes( pLoc, ppArray))</span>
<a href="#l14.384"></a><span id="l14.384" class="difflineminus">-    *ppArray = nsnull;</span>
<a href="#l14.385"></a><span id="l14.385" class="difflineminus">-</span>
<a href="#l14.386"></a><span id="l14.386" class="difflineminus">-  return( NS_OK);</span>
<a href="#l14.387"></a><span id="l14.387" class="difflineplus">+  return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l14.388"></a><span id="l14.388"> }</span>
<a href="#l14.389"></a><span id="l14.389"> </span>
<a href="#l14.390"></a><span id="l14.390" class="difflineminus">-void ImportOEMailImpl::AddLinebreak( nsString *pStream)</span>
<a href="#l14.391"></a><span id="l14.391" class="difflineplus">+void ImportWMMailImpl::AddLinebreak( nsString *pStream)</span>
<a href="#l14.392"></a><span id="l14.392"> {</span>
<a href="#l14.393"></a><span id="l14.393">   if (pStream)</span>
<a href="#l14.394"></a><span id="l14.394">     pStream-&gt;Append( PRUnichar('\n'));</span>
<a href="#l14.395"></a><span id="l14.395"> }</span>
<a href="#l14.396"></a><span id="l14.396"> </span>
<a href="#l14.397"></a><span id="l14.397" class="difflineminus">-void ImportOEMailImpl::ReportSuccess( nsString&amp; name, PRInt32 count, nsString *pStream)</span>
<a href="#l14.398"></a><span id="l14.398" class="difflineplus">+void ImportWMMailImpl::ReportSuccess( nsString&amp; name, PRInt32 count, nsString *pStream)</span>
<a href="#l14.399"></a><span id="l14.399"> {</span>
<a href="#l14.400"></a><span id="l14.400">   if (!pStream)</span>
<a href="#l14.401"></a><span id="l14.401">     return;</span>
<a href="#l14.402"></a><span id="l14.402">   // load the success string</span>
<a href="#l14.403"></a><span id="l14.403" class="difflineminus">-  nsIStringBundle *pBundle = nsOEStringBundle::GetStringBundleProxy();</span>
<a href="#l14.404"></a><span id="l14.404" class="difflineminus">-  PRUnichar *pFmt = nsOEStringBundle::GetStringByID( OEIMPORT_MAILBOX_SUCCESS, pBundle);</span>
<a href="#l14.405"></a><span id="l14.405" class="difflineplus">+  nsIStringBundle *pBundle = nsWMStringBundle::GetStringBundleProxy();</span>
<a href="#l14.406"></a><span id="l14.406" class="difflineplus">+  PRUnichar *pFmt = nsWMStringBundle::GetStringByID( WMIMPORT_MAILBOX_SUCCESS, pBundle);</span>
<a href="#l14.407"></a><span id="l14.407">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get(), count);</span>
<a href="#l14.408"></a><span id="l14.408">   pStream-&gt;Append( pText);</span>
<a href="#l14.409"></a><span id="l14.409">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l14.410"></a><span id="l14.410" class="difflineminus">-  nsOEStringBundle::FreeString( pFmt);</span>
<a href="#l14.411"></a><span id="l14.411" class="difflineplus">+  nsWMStringBundle::FreeString( pFmt);</span>
<a href="#l14.412"></a><span id="l14.412">   AddLinebreak( pStream);</span>
<a href="#l14.413"></a><span id="l14.413">   NS_IF_RELEASE( pBundle);</span>
<a href="#l14.414"></a><span id="l14.414"> }</span>
<a href="#l14.415"></a><span id="l14.415"> </span>
<a href="#l14.416"></a><span id="l14.416" class="difflineminus">-void ImportOEMailImpl::ReportError( PRInt32 errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l14.417"></a><span id="l14.417" class="difflineplus">+void ImportWMMailImpl::ReportError( PRInt32 errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l14.418"></a><span id="l14.418"> {</span>
<a href="#l14.419"></a><span id="l14.419">   if (!pStream)</span>
<a href="#l14.420"></a><span id="l14.420">     return;</span>
<a href="#l14.421"></a><span id="l14.421">   // load the error string</span>
<a href="#l14.422"></a><span id="l14.422" class="difflineminus">-  nsIStringBundle *pBundle = nsOEStringBundle::GetStringBundleProxy();</span>
<a href="#l14.423"></a><span id="l14.423" class="difflineminus">-  PRUnichar *pFmt = nsOEStringBundle::GetStringByID( errorNum, pBundle);</span>
<a href="#l14.424"></a><span id="l14.424" class="difflineplus">+  nsIStringBundle *pBundle = nsWMStringBundle::GetStringBundleProxy();</span>
<a href="#l14.425"></a><span id="l14.425" class="difflineplus">+  PRUnichar *pFmt = nsWMStringBundle::GetStringByID( errorNum, pBundle);</span>
<a href="#l14.426"></a><span id="l14.426">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get());</span>
<a href="#l14.427"></a><span id="l14.427">   pStream-&gt;Append( pText);</span>
<a href="#l14.428"></a><span id="l14.428">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l14.429"></a><span id="l14.429" class="difflineminus">-  nsOEStringBundle::FreeString( pFmt);</span>
<a href="#l14.430"></a><span id="l14.430" class="difflineplus">+  nsWMStringBundle::FreeString( pFmt);</span>
<a href="#l14.431"></a><span id="l14.431">   AddLinebreak( pStream);</span>
<a href="#l14.432"></a><span id="l14.432">   NS_IF_RELEASE( pBundle);</span>
<a href="#l14.433"></a><span id="l14.433"> }</span>
<a href="#l14.434"></a><span id="l14.434"> </span>
<a href="#l14.435"></a><span id="l14.435" class="difflineminus">-</span>
<a href="#l14.436"></a><span id="l14.436" class="difflineminus">-void ImportOEMailImpl::SetLogs( nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l14.437"></a><span id="l14.437" class="difflineplus">+void ImportWMMailImpl::SetLogs(nsString&amp; success, nsString&amp; error,</span>
<a href="#l14.438"></a><span id="l14.438" class="difflineplus">+                               PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l14.439"></a><span id="l14.439"> {</span>
<a href="#l14.440"></a><span id="l14.440">   if (pError)</span>
<a href="#l14.441"></a><span id="l14.441">     *pError = ToNewUnicode(error);</span>
<a href="#l14.442"></a><span id="l14.442">   if (pSuccess)</span>
<a href="#l14.443"></a><span id="l14.443">     *pSuccess = ToNewUnicode(success);</span>
<a href="#l14.444"></a><span id="l14.444"> }</span>
<a href="#l14.445"></a><span id="l14.445"> </span>
<a href="#l14.446"></a><span id="l14.446" class="difflineminus">-NS_IMETHODIMP ImportOEMailImpl::ImportMailbox(nsIImportMailboxDescriptor *pSource,</span>
<a href="#l14.447"></a><span id="l14.447" class="difflineplus">+NS_IMETHODIMP ImportWMMailImpl::ImportMailbox(nsIImportMailboxDescriptor *pSource,</span>
<a href="#l14.448"></a><span id="l14.448">                                               nsIFile *pDestination,</span>
<a href="#l14.449"></a><span id="l14.449">                                               PRUnichar **pErrorLog,</span>
<a href="#l14.450"></a><span id="l14.450">                                               PRUnichar **pSuccessLog,</span>
<a href="#l14.451"></a><span id="l14.451">                                               PRBool *fatalError)</span>
<a href="#l14.452"></a><span id="l14.452"> {</span>
<a href="#l14.453"></a><span id="l14.453" class="difflineminus">-  NS_PRECONDITION(pSource != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.454"></a><span id="l14.454" class="difflineminus">-  NS_PRECONDITION(pDestination != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.455"></a><span id="l14.455" class="difflineminus">-  NS_PRECONDITION(fatalError != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.456"></a><span id="l14.456" class="difflineminus">-</span>
<a href="#l14.457"></a><span id="l14.457" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; bundle( dont_AddRef( nsOEStringBundle::GetStringBundleProxy()));</span>
<a href="#l14.458"></a><span id="l14.458" class="difflineminus">-</span>
<a href="#l14.459"></a><span id="l14.459" class="difflineminus">-  nsString success;</span>
<a href="#l14.460"></a><span id="l14.460" class="difflineminus">-  nsString error;</span>
<a href="#l14.461"></a><span id="l14.461" class="difflineminus">-  if (!pSource || !pDestination || !fatalError) {</span>
<a href="#l14.462"></a><span id="l14.462" class="difflineminus">-    nsOEStringBundle::GetStringByID( OEIMPORT_MAILBOX_BADPARAM, error, bundle);</span>
<a href="#l14.463"></a><span id="l14.463" class="difflineminus">-    if (fatalError)</span>
<a href="#l14.464"></a><span id="l14.464" class="difflineminus">-      *fatalError = PR_TRUE;</span>
<a href="#l14.465"></a><span id="l14.465" class="difflineminus">-    SetLogs( success, error, pErrorLog, pSuccessLog);</span>
<a href="#l14.466"></a><span id="l14.466" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l14.467"></a><span id="l14.467" class="difflineminus">-  }</span>
<a href="#l14.468"></a><span id="l14.468" class="difflineminus">-</span>
<a href="#l14.469"></a><span id="l14.469" class="difflineminus">-  PRBool abort = PR_FALSE;</span>
<a href="#l14.470"></a><span id="l14.470" class="difflineminus">-  nsString name;</span>
<a href="#l14.471"></a><span id="l14.471" class="difflineminus">-  nsString pName;</span>
<a href="#l14.472"></a><span id="l14.472" class="difflineminus">-  if (NS_SUCCEEDED( pSource-&gt;GetDisplayName( getter_Copies(pName))))</span>
<a href="#l14.473"></a><span id="l14.473" class="difflineminus">-    name = pName;</span>
<a href="#l14.474"></a><span id="l14.474" class="difflineminus">-</span>
<a href="#l14.475"></a><span id="l14.475" class="difflineminus">-  PRUint32 mailSize = 0;</span>
<a href="#l14.476"></a><span id="l14.476" class="difflineminus">-  pSource-&gt;GetSize( &amp;mailSize);</span>
<a href="#l14.477"></a><span id="l14.477" class="difflineminus">-  if (mailSize == 0) {</span>
<a href="#l14.478"></a><span id="l14.478" class="difflineminus">-    ReportSuccess( name, 0, &amp;success);</span>
<a href="#l14.479"></a><span id="l14.479" class="difflineminus">-    SetLogs( success, error, pErrorLog, pSuccessLog);</span>
<a href="#l14.480"></a><span id="l14.480" class="difflineminus">-    return( NS_OK);</span>
<a href="#l14.481"></a><span id="l14.481" class="difflineminus">-  }</span>
<a href="#l14.482"></a><span id="l14.482" class="difflineminus">-</span>
<a href="#l14.483"></a><span id="l14.483" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; inFile;</span>
<a href="#l14.484"></a><span id="l14.484" class="difflineminus">-  if (NS_FAILED( pSource-&gt;GetFile(getter_AddRefs(inFile)))) {</span>
<a href="#l14.485"></a><span id="l14.485" class="difflineminus">-    ReportError( OEIMPORT_MAILBOX_BADSOURCEFILE, name, &amp;error);</span>
<a href="#l14.486"></a><span id="l14.486" class="difflineminus">-    SetLogs( success, error, pErrorLog, pSuccessLog);</span>
<a href="#l14.487"></a><span id="l14.487" class="difflineminus">-    return( NS_ERROR_FAILURE);</span>
<a href="#l14.488"></a><span id="l14.488" class="difflineminus">-  }</span>
<a href="#l14.489"></a><span id="l14.489" class="difflineminus">-</span>
<a href="#l14.490"></a><span id="l14.490" class="difflineminus">-  nsCString pPath;</span>
<a href="#l14.491"></a><span id="l14.491" class="difflineminus">-  inFile-&gt;GetNativePath(pPath);</span>
<a href="#l14.492"></a><span id="l14.492" class="difflineminus">-  IMPORT_LOG1( &quot;Importing Outlook Express mailbox: %s\n&quot;, pPath.get());</span>
<a href="#l14.493"></a><span id="l14.493" class="difflineminus">-</span>
<a href="#l14.494"></a><span id="l14.494" class="difflineminus">-  m_bytesDone = 0;</span>
<a href="#l14.495"></a><span id="l14.495" class="difflineminus">-  PRUint32 msgCount = 0;</span>
<a href="#l14.496"></a><span id="l14.496" class="difflineminus">-  nsresult rv;</span>
<a href="#l14.497"></a><span id="l14.497" class="difflineminus">-  if (nsOE5File::IsLocalMailFile( inFile)) {</span>
<a href="#l14.498"></a><span id="l14.498" class="difflineminus">-    IMPORT_LOG1( &quot;Importing OE5 mailbox: %s!\n&quot;, NS_LossyConvertUTF16toASCII(name.get()));</span>
<a href="#l14.499"></a><span id="l14.499" class="difflineminus">-    rv = nsOE5File::ImportMailbox( &amp;m_bytesDone, &amp;abort, name, inFile, pDestination, &amp;msgCount);</span>
<a href="#l14.500"></a><span id="l14.500" class="difflineminus">-  }</span>
<a href="#l14.501"></a><span id="l14.501" class="difflineminus">-  else {</span>
<a href="#l14.502"></a><span id="l14.502" class="difflineminus">-    if (CImportMailbox::ImportMailbox( &amp;m_bytesDone, &amp;abort, name, inFile, pDestination, &amp;msgCount))</span>
<a href="#l14.503"></a><span id="l14.503" class="difflineminus">-      rv = NS_OK;</span>
<a href="#l14.504"></a><span id="l14.504" class="difflineminus">-    else</span>
<a href="#l14.505"></a><span id="l14.505" class="difflineminus">-      rv = NS_ERROR_FAILURE;</span>
<a href="#l14.506"></a><span id="l14.506" class="difflineminus">-  }</span>
<a href="#l14.507"></a><span id="l14.507" class="difflineminus">-</span>
<a href="#l14.508"></a><span id="l14.508" class="difflineminus">-  if (NS_SUCCEEDED( rv)) {</span>
<a href="#l14.509"></a><span id="l14.509" class="difflineminus">-    ReportSuccess( name, msgCount, &amp;success);</span>
<a href="#l14.510"></a><span id="l14.510" class="difflineminus">-  }</span>
<a href="#l14.511"></a><span id="l14.511" class="difflineminus">-  else {</span>
<a href="#l14.512"></a><span id="l14.512" class="difflineminus">-    ReportError( OEIMPORT_MAILBOX_CONVERTERROR, name, &amp;error);</span>
<a href="#l14.513"></a><span id="l14.513" class="difflineminus">-  }</span>
<a href="#l14.514"></a><span id="l14.514" class="difflineminus">-</span>
<a href="#l14.515"></a><span id="l14.515" class="difflineminus">-  SetLogs( success, error, pErrorLog, pSuccessLog);</span>
<a href="#l14.516"></a><span id="l14.516" class="difflineminus">-</span>
<a href="#l14.517"></a><span id="l14.517" class="difflineminus">-  return( rv);</span>
<a href="#l14.518"></a><span id="l14.518" class="difflineminus">-}</span>
<a href="#l14.519"></a><span id="l14.519" class="difflineminus">-</span>
<a href="#l14.520"></a><span id="l14.520" class="difflineminus">-NS_IMETHODIMP ImportOEMailImpl::GetImportProgress( PRUint32 *pDoneSoFar)</span>
<a href="#l14.521"></a><span id="l14.521" class="difflineminus">-{</span>
<a href="#l14.522"></a><span id="l14.522" class="difflineminus">-  NS_ENSURE_ARG_POINTER(pDoneSoFar);</span>
<a href="#l14.523"></a><span id="l14.523" class="difflineminus">-  *pDoneSoFar = m_bytesDone;</span>
<a href="#l14.524"></a><span id="l14.524" class="difflineminus">-  return( NS_OK);</span>
<a href="#l14.525"></a><span id="l14.525" class="difflineminus">-}</span>
<a href="#l14.526"></a><span id="l14.526" class="difflineminus">-</span>
<a href="#l14.527"></a><span id="l14.527" class="difflineminus">-nsresult ImportOEAddressImpl::Create(nsIImportAddressBooks** aImport)</span>
<a href="#l14.528"></a><span id="l14.528" class="difflineminus">-{</span>
<a href="#l14.529"></a><span id="l14.529" class="difflineminus">-  NS_ENSURE_ARG_POINTER(aImport);</span>
<a href="#l14.530"></a><span id="l14.530" class="difflineminus">-</span>
<a href="#l14.531"></a><span id="l14.531" class="difflineminus">-  *aImport = new ImportOEAddressImpl();</span>
<a href="#l14.532"></a><span id="l14.532" class="difflineminus">-  NS_ENSURE_TRUE(*aImport, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l14.533"></a><span id="l14.533" class="difflineminus">-  NS_ADDREF(*aImport);</span>
<a href="#l14.534"></a><span id="l14.534" class="difflineminus">-  return NS_OK;</span>
<a href="#l14.535"></a><span id="l14.535" class="difflineminus">-}</span>
<a href="#l14.536"></a><span id="l14.536" class="difflineminus">-</span>
<a href="#l14.537"></a><span id="l14.537" class="difflineminus">-ImportOEAddressImpl::ImportOEAddressImpl()</span>
<a href="#l14.538"></a><span id="l14.538" class="difflineminus">-{</span>
<a href="#l14.539"></a><span id="l14.539" class="difflineminus">-  m_pWab = nsnull;</span>
<a href="#l14.540"></a><span id="l14.540" class="difflineminus">-}</span>
<a href="#l14.541"></a><span id="l14.541" class="difflineminus">-</span>
<a href="#l14.542"></a><span id="l14.542" class="difflineminus">-</span>
<a href="#l14.543"></a><span id="l14.543" class="difflineminus">-ImportOEAddressImpl::~ImportOEAddressImpl()</span>
<a href="#l14.544"></a><span id="l14.544" class="difflineminus">-{</span>
<a href="#l14.545"></a><span id="l14.545" class="difflineminus">-  if (m_pWab)</span>
<a href="#l14.546"></a><span id="l14.546" class="difflineminus">-    delete m_pWab;</span>
<a href="#l14.547"></a><span id="l14.547" class="difflineminus">-}</span>
<a href="#l14.548"></a><span id="l14.548" class="difflineminus">-</span>
<a href="#l14.549"></a><span id="l14.549" class="difflineminus">-NS_IMPL_THREADSAFE_ISUPPORTS1(ImportOEAddressImpl, nsIImportAddressBooks)</span>
<a href="#l14.550"></a><span id="l14.550" class="difflineminus">-</span>
<a href="#l14.551"></a><span id="l14.551" class="difflineminus">-NS_IMETHODIMP ImportOEAddressImpl::GetAutoFind(PRUnichar **description, PRBool *_retval)</span>
<a href="#l14.552"></a><span id="l14.552" class="difflineminus">-{</span>
<a href="#l14.553"></a><span id="l14.553" class="difflineminus">-  NS_PRECONDITION(description != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.554"></a><span id="l14.554" class="difflineminus">-  NS_PRECONDITION(_retval != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.555"></a><span id="l14.555" class="difflineminus">-  if (! description || !_retval)</span>
<a href="#l14.556"></a><span id="l14.556" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l14.557"></a><span id="l14.557" class="difflineminus">-</span>
<a href="#l14.558"></a><span id="l14.558" class="difflineminus">-  *_retval = PR_TRUE;</span>
<a href="#l14.559"></a><span id="l14.559" class="difflineminus">-  nsString str;</span>
<a href="#l14.560"></a><span id="l14.560" class="difflineminus">-  str.Append(nsOEStringBundle::GetStringByID(OEIMPORT_AUTOFIND));</span>
<a href="#l14.561"></a><span id="l14.561" class="difflineminus">-  *description = ToNewUnicode(str);</span>
<a href="#l14.562"></a><span id="l14.562" class="difflineminus">-  return( NS_OK);</span>
<a href="#l14.563"></a><span id="l14.563" class="difflineplus">+  return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l14.564"></a><span id="l14.564"> }</span>
<a href="#l14.565"></a><span id="l14.565"> </span>
<a href="#l14.566"></a><span id="l14.566" class="difflineminus">-</span>
<a href="#l14.567"></a><span id="l14.567" class="difflineminus">-</span>
<a href="#l14.568"></a><span id="l14.568" class="difflineminus">-NS_IMETHODIMP ImportOEAddressImpl::FindAddressBooks(nsIFile *location, nsISupportsArray **_retval)</span>
<a href="#l14.569"></a><span id="l14.569" class="difflineminus">-{</span>
<a href="#l14.570"></a><span id="l14.570" class="difflineminus">-  NS_PRECONDITION(_retval != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.571"></a><span id="l14.571" class="difflineminus">-  if (!_retval)</span>
<a href="#l14.572"></a><span id="l14.572" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l14.573"></a><span id="l14.573" class="difflineminus">-</span>
<a href="#l14.574"></a><span id="l14.574" class="difflineminus">-  nsresult rv = NS_NewISupportsArray( _retval);</span>
<a href="#l14.575"></a><span id="l14.575" class="difflineminus">-  if (NS_FAILED( rv))</span>
<a href="#l14.576"></a><span id="l14.576" class="difflineminus">-    return( rv);</span>
<a href="#l14.577"></a><span id="l14.577" class="difflineminus">-</span>
<a href="#l14.578"></a><span id="l14.578" class="difflineminus">-  // Make sure we can load up the windows address book...</span>
<a href="#l14.579"></a><span id="l14.579" class="difflineminus">-  rv = NS_ERROR_FAILURE;</span>
<a href="#l14.580"></a><span id="l14.580" class="difflineminus">-</span>
<a href="#l14.581"></a><span id="l14.581" class="difflineminus">-  if (m_pWab)</span>
<a href="#l14.582"></a><span id="l14.582" class="difflineminus">-    delete m_pWab;</span>
<a href="#l14.583"></a><span id="l14.583" class="difflineminus">-  m_pWab = new CWAB( nsnull);</span>
<a href="#l14.584"></a><span id="l14.584" class="difflineminus">-</span>
<a href="#l14.585"></a><span id="l14.585" class="difflineminus">-  nsIImportABDescriptor * pID;</span>
<a href="#l14.586"></a><span id="l14.586" class="difflineminus">-  nsISupports * pInterface;</span>
<a href="#l14.587"></a><span id="l14.587" class="difflineminus">-  nsString str;</span>
<a href="#l14.588"></a><span id="l14.588" class="difflineminus">-  str.Append(nsOEStringBundle::GetStringByID( OEIMPORT_DEFAULT_NAME));</span>
<a href="#l14.589"></a><span id="l14.589" class="difflineminus">-</span>
<a href="#l14.590"></a><span id="l14.590" class="difflineminus">-  if (m_pWab-&gt;Loaded()) {</span>
<a href="#l14.591"></a><span id="l14.591" class="difflineminus">-    // create a new nsIImportABDescriptor and add it to the array</span>
<a href="#l14.592"></a><span id="l14.592" class="difflineminus">-    nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l14.593"></a><span id="l14.593" class="difflineminus">-    if (NS_SUCCEEDED( rv)) {</span>
<a href="#l14.594"></a><span id="l14.594" class="difflineminus">-      rv = impSvc-&gt;CreateNewABDescriptor( &amp;pID);</span>
<a href="#l14.595"></a><span id="l14.595" class="difflineminus">-      if (NS_SUCCEEDED( rv)) {</span>
<a href="#l14.596"></a><span id="l14.596" class="difflineminus">-        pID-&gt;SetIdentifier( 0x4F453334);</span>
<a href="#l14.597"></a><span id="l14.597" class="difflineminus">-        pID-&gt;SetRef( 1);</span>
<a href="#l14.598"></a><span id="l14.598" class="difflineminus">-        pID-&gt;SetSize( 100);</span>
<a href="#l14.599"></a><span id="l14.599" class="difflineminus">-        pID-&gt;SetPreferredName(str);</span>
<a href="#l14.600"></a><span id="l14.600" class="difflineminus">-        rv = pID-&gt;QueryInterface( kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l14.601"></a><span id="l14.601" class="difflineminus">-        (*_retval)-&gt;AppendElement( pInterface);</span>
<a href="#l14.602"></a><span id="l14.602" class="difflineminus">-        pInterface-&gt;Release();</span>
<a href="#l14.603"></a><span id="l14.603" class="difflineminus">-        pID-&gt;Release();</span>
<a href="#l14.604"></a><span id="l14.604" class="difflineminus">-      }</span>
<a href="#l14.605"></a><span id="l14.605" class="difflineminus">-    }</span>
<a href="#l14.606"></a><span id="l14.606" class="difflineminus">-  }</span>
<a href="#l14.607"></a><span id="l14.607" class="difflineminus">-</span>
<a href="#l14.608"></a><span id="l14.608" class="difflineminus">-  if (NS_FAILED( rv)) {</span>
<a href="#l14.609"></a><span id="l14.609" class="difflineminus">-    delete m_pWab;</span>
<a href="#l14.610"></a><span id="l14.610" class="difflineminus">-    m_pWab = nsnull;</span>
<a href="#l14.611"></a><span id="l14.611" class="difflineminus">-  }</span>
<a href="#l14.612"></a><span id="l14.612" class="difflineminus">-  return( NS_OK);</span>
<a href="#l14.613"></a><span id="l14.613" class="difflineminus">-}</span>
<a href="#l14.614"></a><span id="l14.614" class="difflineminus">-</span>
<a href="#l14.615"></a><span id="l14.615" class="difflineminus">-</span>
<a href="#l14.616"></a><span id="l14.616" class="difflineminus">-</span>
<a href="#l14.617"></a><span id="l14.617" class="difflineminus">-NS_IMETHODIMP ImportOEAddressImpl::ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l14.618"></a><span id="l14.618" class="difflineminus">-                                                     nsIAddrDatabase *destination,</span>
<a href="#l14.619"></a><span id="l14.619" class="difflineminus">-                                                     nsIImportFieldMap *fieldMap,</span>
<a href="#l14.620"></a><span id="l14.620" class="difflineminus">-                                                     nsISupports *aSupportService,</span>
<a href="#l14.621"></a><span id="l14.621" class="difflineminus">-                                                     PRBool isAddrLocHome,</span>
<a href="#l14.622"></a><span id="l14.622" class="difflineminus">-                                                     PRUnichar **errorLog,</span>
<a href="#l14.623"></a><span id="l14.623" class="difflineminus">-                                                     PRUnichar **successLog,</span>
<a href="#l14.624"></a><span id="l14.624" class="difflineminus">-                                                     PRBool *fatalError)</span>
<a href="#l14.625"></a><span id="l14.625" class="difflineplus">+NS_IMETHODIMP ImportWMMailImpl::GetImportProgress( PRUint32 *pDoneSoFar)</span>
<a href="#l14.626"></a><span id="l14.626"> {</span>
<a href="#l14.627"></a><span id="l14.627" class="difflineminus">-    NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.628"></a><span id="l14.628" class="difflineminus">-    // NS_PRECONDITION(destination != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.629"></a><span id="l14.629" class="difflineminus">-    // NS_PRECONDITION(fieldMap != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.630"></a><span id="l14.630" class="difflineminus">-    NS_PRECONDITION(fatalError != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.631"></a><span id="l14.631" class="difflineminus">-    if (!source || !fatalError)</span>
<a href="#l14.632"></a><span id="l14.632" class="difflineminus">-        return NS_ERROR_NULL_POINTER;</span>
<a href="#l14.633"></a><span id="l14.633" class="difflineminus">-</span>
<a href="#l14.634"></a><span id="l14.634" class="difflineminus">-  // we assume it is our one and only address book.</span>
<a href="#l14.635"></a><span id="l14.635" class="difflineminus">-  if (!m_pWab) {</span>
<a href="#l14.636"></a><span id="l14.636" class="difflineminus">-    IMPORT_LOG0( &quot;Wab not loaded in ImportAddressBook call\n&quot;);</span>
<a href="#l14.637"></a><span id="l14.637" class="difflineminus">-    return( NS_ERROR_FAILURE);</span>
<a href="#l14.638"></a><span id="l14.638" class="difflineminus">-  }</span>
<a href="#l14.639"></a><span id="l14.639" class="difflineminus">-</span>
<a href="#l14.640"></a><span id="l14.640" class="difflineminus">-  IMPORT_LOG0( &quot;IMPORTING OUTLOOK EXPRESS ADDRESS BOOK\n&quot;);</span>
<a href="#l14.641"></a><span id="l14.641" class="difflineminus">-</span>
<a href="#l14.642"></a><span id="l14.642" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt;  bundle( dont_AddRef( nsOEStringBundle::GetStringBundleProxy()));</span>
<a href="#l14.643"></a><span id="l14.643" class="difflineminus">-  nsString success;</span>
<a href="#l14.644"></a><span id="l14.644" class="difflineminus">-  nsString error;</span>
<a href="#l14.645"></a><span id="l14.645" class="difflineminus">-  if (!source || !destination || !fatalError)</span>
<a href="#l14.646"></a><span id="l14.646" class="difflineminus">-  {</span>
<a href="#l14.647"></a><span id="l14.647" class="difflineminus">-    nsOEStringBundle::GetStringByID( OEIMPORT_ADDRESS_BADPARAM, error, bundle);</span>
<a href="#l14.648"></a><span id="l14.648" class="difflineminus">-    if (fatalError)</span>
<a href="#l14.649"></a><span id="l14.649" class="difflineminus">-      *fatalError = PR_TRUE;</span>
<a href="#l14.650"></a><span id="l14.650" class="difflineminus">-    ImportOEMailImpl::SetLogs( success, error, errorLog, successLog);</span>
<a href="#l14.651"></a><span id="l14.651" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l14.652"></a><span id="l14.652" class="difflineminus">-  }</span>
<a href="#l14.653"></a><span id="l14.653" class="difflineminus">-</span>
<a href="#l14.654"></a><span id="l14.654" class="difflineminus">-  m_doneSoFar = 0;</span>
<a href="#l14.655"></a><span id="l14.655" class="difflineminus">-  nsOEAddressIterator * pIter = new nsOEAddressIterator( m_pWab, destination);</span>
<a href="#l14.656"></a><span id="l14.656" class="difflineminus">-  HRESULT hr = m_pWab-&gt;IterateWABContents( pIter, &amp;m_doneSoFar);</span>
<a href="#l14.657"></a><span id="l14.657" class="difflineminus">-  delete pIter;</span>
<a href="#l14.658"></a><span id="l14.658" class="difflineminus">-</span>
<a href="#l14.659"></a><span id="l14.659" class="difflineminus">-  nsString name;</span>
<a href="#l14.660"></a><span id="l14.660" class="difflineminus">-  if (SUCCEEDED(hr))</span>
<a href="#l14.661"></a><span id="l14.661" class="difflineminus">-  {</span>
<a href="#l14.662"></a><span id="l14.662" class="difflineminus">-    if (NS_SUCCEEDED(source-&gt;GetPreferredName(name)))</span>
<a href="#l14.663"></a><span id="l14.663" class="difflineminus">-    {</span>
<a href="#l14.664"></a><span id="l14.664" class="difflineminus">-      ReportSuccess( name, &amp;success);</span>
<a href="#l14.665"></a><span id="l14.665" class="difflineminus">-    }</span>
<a href="#l14.666"></a><span id="l14.666" class="difflineminus">-  }</span>
<a href="#l14.667"></a><span id="l14.667" class="difflineminus">-  else</span>
<a href="#l14.668"></a><span id="l14.668" class="difflineminus">-    ImportOEMailImpl::ReportError( OEIMPORT_ADDRESS_CONVERTERROR, name, &amp;error);</span>
<a href="#l14.669"></a><span id="l14.669" class="difflineminus">-</span>
<a href="#l14.670"></a><span id="l14.670" class="difflineminus">-  ImportOEMailImpl::SetLogs( success, error, errorLog, successLog);</span>
<a href="#l14.671"></a><span id="l14.671" class="difflineminus">-</span>
<a href="#l14.672"></a><span id="l14.672" class="difflineminus">-  nsresult rv = destination-&gt;Commit(nsAddrDBCommitType::kLargeCommit);</span>
<a href="#l14.673"></a><span id="l14.673" class="difflineminus">-  return rv;</span>
<a href="#l14.674"></a><span id="l14.674" class="difflineplus">+  return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l14.675"></a><span id="l14.675"> }</span>
<a href="#l14.676"></a><span id="l14.676" class="difflineminus">-</span>
<a href="#l14.677"></a><span id="l14.677" class="difflineminus">-</span>
<a href="#l14.678"></a><span id="l14.678" class="difflineminus">-NS_IMETHODIMP ImportOEAddressImpl::GetImportProgress(PRUint32 *_retval)</span>
<a href="#l14.679"></a><span id="l14.679" class="difflineminus">-{</span>
<a href="#l14.680"></a><span id="l14.680" class="difflineminus">-  NS_PRECONDITION(_retval != nsnull, &quot;null ptr&quot;);</span>
<a href="#l14.681"></a><span id="l14.681" class="difflineminus">-  if (! _retval)</span>
<a href="#l14.682"></a><span id="l14.682" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l14.683"></a><span id="l14.683" class="difflineminus">-</span>
<a href="#l14.684"></a><span id="l14.684" class="difflineminus">-  *_retval = (PRUint32) m_doneSoFar;</span>
<a href="#l14.685"></a><span id="l14.685" class="difflineminus">-  return( NS_OK);</span>
<a href="#l14.686"></a><span id="l14.686" class="difflineminus">-}</span>
<a href="#l14.687"></a><span id="l14.687" class="difflineminus">-</span>
<a href="#l14.688"></a><span id="l14.688" class="difflineminus">-void ImportOEAddressImpl::ReportSuccess( nsString&amp; name, nsString *pStream)</span>
<a href="#l14.689"></a><span id="l14.689" class="difflineminus">-{</span>
<a href="#l14.690"></a><span id="l14.690" class="difflineminus">-  if (!pStream)</span>
<a href="#l14.691"></a><span id="l14.691" class="difflineminus">-    return;</span>
<a href="#l14.692"></a><span id="l14.692" class="difflineminus">-  // load the success string</span>
<a href="#l14.693"></a><span id="l14.693" class="difflineminus">-  nsIStringBundle *pBundle = nsOEStringBundle::GetStringBundleProxy();</span>
<a href="#l14.694"></a><span id="l14.694" class="difflineminus">-  PRUnichar *pFmt = nsOEStringBundle::GetStringByID( OEIMPORT_ADDRESS_SUCCESS, pBundle);</span>
<a href="#l14.695"></a><span id="l14.695" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get());</span>
<a href="#l14.696"></a><span id="l14.696" class="difflineminus">-  pStream-&gt;Append( pText);</span>
<a href="#l14.697"></a><span id="l14.697" class="difflineminus">-  nsTextFormatter::smprintf_free( pText);</span>
<a href="#l14.698"></a><span id="l14.698" class="difflineminus">-  nsOEStringBundle::FreeString( pFmt);</span>
<a href="#l14.699"></a><span id="l14.699" class="difflineminus">-  ImportOEMailImpl::AddLinebreak( pStream);</span>
<a href="#l14.700"></a><span id="l14.700" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l14.701"></a><span id="l14.701" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">copy from mailnews/import/oexpress/nsOEImport.h</span>
<a href="#l15.2"></a><span id="l15.2">copy to mailnews/import/winlivemail/nsWMImport.h</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineminus">--- a/mailnews/import/oexpress/nsOEImport.h</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMImport.h</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineat">@@ -30,45 +30,41 @@</span>
<a href="#l15.6"></a><span id="l15.6">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l15.7"></a><span id="l15.7">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l15.8"></a><span id="l15.8">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l15.9"></a><span id="l15.9">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l15.10"></a><span id="l15.10">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l15.11"></a><span id="l15.11">  *</span>
<a href="#l15.12"></a><span id="l15.12">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l15.13"></a><span id="l15.13"> </span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-#ifndef nsOEImport_h___</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-#define nsOEImport_h___</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+#ifndef nsWMImport_h___</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+#define nsWMImport_h___</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19"> #include &quot;nsIImportModule.h&quot;</span>
<a href="#l15.20"></a><span id="l15.20"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-#define NS_OEIMPORT_CID              \</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-{ /* be0bc880-1742-11d3-a206-00a0cc26da63 */      \</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">-   0xbe0bc880, 0x1742, 0x11d3,                   \</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">-   {0xa2, 0x06, 0x0, 0xa0, 0xcc, 0x26, 0xda, 0x63}}</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineplus">+#define NS_WMIMPORT_CID   \</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+{ /* 42bc82bc-8e9f-4597-8b6e-e529daaf3af1 */      \</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineplus">+   0x42bc82bc, 0x8e9f, 0x4597,   \</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+   {0x8b, 0x6e, 0xe5, 0x29, 0xda, 0xaf, 0x3a, 0xf1}}</span>
<a href="#l15.30"></a><span id="l15.30"> </span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+// currently only support setting import</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+#define kWMSupportsString NS_IMPORT_SETTINGS_STR</span>
<a href="#l15.34"></a><span id="l15.34"> </span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-#define kOESupportsString NS_IMPORT_MAIL_STR &quot;,&quot; NS_IMPORT_ADDRESS_STR &quot;,&quot; NS_IMPORT_SETTINGS_STR</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-class nsOEImport : public nsIImportModule</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+class nsWMImport : public nsIImportModule</span>
<a href="#l15.39"></a><span id="l15.39"> {</span>
<a href="#l15.40"></a><span id="l15.40"> public:</span>
<a href="#l15.41"></a><span id="l15.41"> </span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-  nsOEImport();</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-  virtual ~nsOEImport();</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+  nsWMImport();</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+  virtual ~nsWMImport();</span>
<a href="#l15.46"></a><span id="l15.46"> </span>
<a href="#l15.47"></a><span id="l15.47">   NS_DECL_ISUPPORTS</span>
<a href="#l15.48"></a><span id="l15.48"> </span>
<a href="#l15.49"></a><span id="l15.49">   ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l15.50"></a><span id="l15.50">   // we suppport the nsIImportModule interface</span>
<a href="#l15.51"></a><span id="l15.51">   ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l15.52"></a><span id="l15.52"> </span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-</span>
<a href="#l15.54"></a><span id="l15.54">   NS_DECL_NSIIMPORTMODULE</span>
<a href="#l15.55"></a><span id="l15.55"> </span>
<a href="#l15.56"></a><span id="l15.56"> protected:</span>
<a href="#l15.57"></a><span id="l15.57"> };</span>
<a href="#l15.58"></a><span id="l15.58"> </span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineminus">-</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-#endif /* nsOEImport_h___ */</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineplus">+#endif /* nsWMImport_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">copy from mailnews/import/oexpress/nsOESettings.cpp</span>
<a href="#l16.2"></a><span id="l16.2">copy to mailnews/import/winlivemail/nsWMSettings.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineminus">--- a/mailnews/import/oexpress/nsOESettings.cpp</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMSettings.cpp</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineat">@@ -33,865 +33,819 @@</span>
<a href="#l16.6"></a><span id="l16.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l16.7"></a><span id="l16.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l16.8"></a><span id="l16.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l16.9"></a><span id="l16.9">  *</span>
<a href="#l16.10"></a><span id="l16.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12"> /*</span>
<a href="#l16.13"></a><span id="l16.13"> </span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-  Outlook Express (Win32) settings</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+  Windows Live Mail (Win32) settings</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17"> */</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l16.20"></a><span id="l16.20"> #include &quot;nscore.h&quot;</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">-#include &quot;nsOEImport.h&quot;</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+#include &quot;nsWMImport.h&quot;</span>
<a href="#l16.25"></a><span id="l16.25"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l16.26"></a><span id="l16.26"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-#include &quot;nsOERegUtil.h&quot;</span>
<a href="#l16.28"></a><span id="l16.28"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l16.29"></a><span id="l16.29"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l16.30"></a><span id="l16.30"> #include &quot;nsIImportSettings.h&quot;</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-#include &quot;nsOESettings.h&quot;</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+#include &quot;nsWMSettings.h&quot;</span>
<a href="#l16.33"></a><span id="l16.33"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l16.34"></a><span id="l16.34"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l16.35"></a><span id="l16.35"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l16.36"></a><span id="l16.36"> #include &quot;nsISmtpService.h&quot;</span>
<a href="#l16.37"></a><span id="l16.37"> #include &quot;nsISmtpServer.h&quot;</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-#include &quot;nsOEStringBundle.h&quot;</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineminus">-#include &quot;OEDebugLog.h&quot;</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+#include &quot;nsWMStringBundle.h&quot;</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineplus">+#include &quot;WMDebugLog.h&quot;</span>
<a href="#l16.42"></a><span id="l16.42"> #include &quot;nsIPop3IncomingServer.h&quot;</span>
<a href="#l16.43"></a><span id="l16.43"> #include &quot;nsIImapIncomingServer.h&quot;</span>
<a href="#l16.44"></a><span id="l16.44"> #include &quot;nsINntpIncomingServer.h&quot;</span>
<a href="#l16.45"></a><span id="l16.45"> #include &quot;stdlib.h&quot;</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineminus">-</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-class OESettings {</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineminus">-public:</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-  static HKEY Find50Key( void);</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-  static HKEY Find40Key( void);</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineminus">-  static HKEY FindAccountsKey( void);</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineminus">-  static PRBool DoImport( nsIMsgAccount **ppAccount);</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+#include &quot;nsILocalFile.h&quot;</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+#include &quot;nsISimpleEnumerator.h&quot;</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineplus">+#include &quot;nsIDOMDocument.h&quot;</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+#include &quot;nsNetUtil.h&quot;</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+#include &quot;nsIDOMNodeList.h&quot;</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineplus">+#include &quot;nsIFileStreams.h&quot;</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineplus">+#include &quot;nsIDOMParser.h&quot;</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineplus">+#include &quot;nsIDOMElement.h&quot;</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineplus">+#include &quot;nsIDOM3Node.h&quot;</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineplus">+#include &quot;nsTArray.h&quot;</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineplus">+#include &lt;windows.h&gt;</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineplus">+#include &quot;nsIWindowsRegKey.h&quot;</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+#include &quot;nsCOMArray.h&quot;</span>
<a href="#l16.68"></a><span id="l16.68"> </span>
<a href="#l16.69"></a><span id="l16.69" class="difflineminus">-  static PRBool DoIMAPServer( nsIMsgAccountManager *pMgr, HKEY hKey, char *pServerName, nsIMsgAccount **ppAccount);</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineminus">-  static PRBool DoPOP3Server( nsIMsgAccountManager *pMgr, HKEY hKey, char *pServerName, nsIMsgAccount **ppAccount);</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineminus">-  static PRBool DoNNTPServer( nsIMsgAccountManager *pMgr, HKEY hKey, char *pServerName, nsIMsgAccount **ppAccount);</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineminus">-</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineminus">-  static void SetIdentities( nsIMsgAccountManager *pMgr, nsIMsgAccount *pAcc, HKEY hKey,</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineminus">-                             char *pIncomgUserName, PRInt32 authMethodIncoming, PRBool isNNTP);</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineminus">-  static void SetSmtpServer( char *pSmtpServer, HKEY hKey, nsIMsgIdentity *id,</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineminus">-                             char *pIncomgUserName, PRInt32 authMethodIncoming);</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineminus">-  static nsresult GetAccountName(HKEY hKey, char *defaultName, nsString &amp;acctName);</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+class WMSettings {</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineplus">+public:</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineplus">+  static nsresult FindWMKey(nsIWindowsRegKey* akey);</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineplus">+  static PRBool getOEacctFiles(nsILocalFile* file, nsCOMArray&lt;nsILocalFile&gt;&amp; fileArray);</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineplus">+  static nsresult GetValueForTag(nsIDOMDocument *xmlDoc,</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineplus">+                                 const nsAString&amp; tagName,</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineplus">+                                 nsAString &amp;value);</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineplus">+  static nsresult MakeXMLdoc(nsIDOMDocument** xmlDoc,</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineplus">+                             nsILocalFile* file);</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineplus">+  static PRBool DoImport(nsIMsgAccount **ppAccount);</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineplus">+  static PRBool DoIMAPServer(nsIMsgAccountManager *pMgr,</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineplus">+                             nsIDOMDocument *xmlDoc,</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineplus">+                             const nsString&amp; serverName,</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineplus">+                             nsIMsgAccount **ppAccount);</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineplus">+  static PRBool DoPOP3Server(nsIMsgAccountManager *pMgr,</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+                             nsIDOMDocument *xmlDoc,</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineplus">+                             const nsString&amp; serverName,</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineplus">+                             nsIMsgAccount **ppAccount);</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineplus">+  static PRBool DoNNTPServer(nsIMsgAccountManager *pMgr,</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineplus">+                             nsIDOMDocument *xmlDoc,</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+                             const nsString&amp; serverName,</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineplus">+                             nsIMsgAccount **ppAccount);</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineplus">+  static void SetIdentities(nsIMsgAccountManager *pMgr, nsIMsgAccount *pAcc,</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineplus">+                            nsIDOMDocument *xmlDoc, nsAutoString &amp;userName,</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineplus">+                            PRInt32 authMethodIncoming, PRBool isNNTP );</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+  static void SetSmtpServer(nsIDOMDocument *xmlDoc, nsIMsgIdentity *id,</span>
<a href="#l16.104"></a><span id="l16.104" class="difflineplus">+                            nsAutoString&amp; inUserName, PRInt32 authMethodIncoming);</span>
<a href="#l16.105"></a><span id="l16.105"> };</span>
<a href="#l16.106"></a><span id="l16.106"> </span>
<a href="#l16.107"></a><span id="l16.107" class="difflineminus">-static PRInt32 checkNewMailTime;// OE global setting, let's default to 30</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineminus">-static PRBool  checkNewMail;    // OE global setting, let's default to PR_FALSE</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineplus">+static PRInt32 checkNewMailTime;// WM global setting, let's default to 30</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineplus">+static PRBool  checkNewMail;    // WM global setting, let's default to PR_FALSE</span>
<a href="#l16.111"></a><span id="l16.111">                                 // This won't cause unwanted autodownloads-</span>
<a href="#l16.112"></a><span id="l16.112">                                 // user can set prefs after import</span>
<a href="#l16.113"></a><span id="l16.113"> </span>
<a href="#l16.114"></a><span id="l16.114"> ////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineminus">-nsresult nsOESettings::Create(nsIImportSettings** aImport)</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineplus">+nsresult nsWMSettings::Create(nsIImportSettings** aImport)</span>
<a href="#l16.117"></a><span id="l16.117"> {</span>
<a href="#l16.118"></a><span id="l16.118">     NS_PRECONDITION(aImport != nsnull, &quot;null ptr&quot;);</span>
<a href="#l16.119"></a><span id="l16.119">     if (! aImport)</span>
<a href="#l16.120"></a><span id="l16.120">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l16.121"></a><span id="l16.121"> </span>
<a href="#l16.122"></a><span id="l16.122" class="difflineminus">-    *aImport = new nsOESettings();</span>
<a href="#l16.123"></a><span id="l16.123" class="difflineplus">+    *aImport = new nsWMSettings();</span>
<a href="#l16.124"></a><span id="l16.124">     if (! *aImport)</span>
<a href="#l16.125"></a><span id="l16.125">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l16.126"></a><span id="l16.126"> </span>
<a href="#l16.127"></a><span id="l16.127">     NS_ADDREF(*aImport);</span>
<a href="#l16.128"></a><span id="l16.128">     return NS_OK;</span>
<a href="#l16.129"></a><span id="l16.129"> }</span>
<a href="#l16.130"></a><span id="l16.130"> </span>
<a href="#l16.131"></a><span id="l16.131" class="difflineminus">-nsOESettings::nsOESettings()</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineplus">+nsWMSettings::nsWMSettings()</span>
<a href="#l16.133"></a><span id="l16.133"> {</span>
<a href="#l16.134"></a><span id="l16.134"> }</span>
<a href="#l16.135"></a><span id="l16.135"> </span>
<a href="#l16.136"></a><span id="l16.136" class="difflineminus">-nsOESettings::~nsOESettings()</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineplus">+nsWMSettings::~nsWMSettings()</span>
<a href="#l16.138"></a><span id="l16.138"> {</span>
<a href="#l16.139"></a><span id="l16.139"> }</span>
<a href="#l16.140"></a><span id="l16.140"> </span>
<a href="#l16.141"></a><span id="l16.141" class="difflineminus">-NS_IMPL_ISUPPORTS1(nsOESettings, nsIImportSettings)</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineplus">+NS_IMPL_ISUPPORTS1(nsWMSettings, nsIImportSettings)</span>
<a href="#l16.143"></a><span id="l16.143"> </span>
<a href="#l16.144"></a><span id="l16.144" class="difflineminus">-NS_IMETHODIMP nsOESettings::AutoLocate(PRUnichar **description, nsIFile **location, PRBool *_retval)</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineplus">+NS_IMETHODIMP nsWMSettings::AutoLocate(PRUnichar **description,</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineplus">+                                       nsIFile **location, PRBool *_retval)</span>
<a href="#l16.147"></a><span id="l16.147"> {</span>
<a href="#l16.148"></a><span id="l16.148">   NS_PRECONDITION(description != nsnull, &quot;null ptr&quot;);</span>
<a href="#l16.149"></a><span id="l16.149">   NS_PRECONDITION(_retval != nsnull, &quot;null ptr&quot;);</span>
<a href="#l16.150"></a><span id="l16.150">   if (!description || !_retval)</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineminus">-    return( NS_ERROR_NULL_POINTER);</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineplus">+    return NS_ERROR_NULL_POINTER;</span>
<a href="#l16.153"></a><span id="l16.153"> </span>
<a href="#l16.154"></a><span id="l16.154" class="difflineminus">-  *description = nsOEStringBundle::GetStringByID( OEIMPORT_NAME);</span>
<a href="#l16.155"></a><span id="l16.155" class="difflineplus">+  *description = nsWMStringBundle::GetStringByID(WMIMPORT_NAME);</span>
<a href="#l16.156"></a><span id="l16.156">   *_retval = PR_FALSE;</span>
<a href="#l16.157"></a><span id="l16.157"> </span>
<a href="#l16.158"></a><span id="l16.158" class="difflineplus">+  nsCOMPtr&lt;nsIWindowsRegKey&gt; key =</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineplus">+    do_CreateInstance(&quot;@mozilla.org/windows-registry-key;1&quot;);</span>
<a href="#l16.160"></a><span id="l16.160">   if (location)</span>
<a href="#l16.161"></a><span id="l16.161">     *location = nsnull;</span>
<a href="#l16.162"></a><span id="l16.162" class="difflineminus">-  HKEY  key;</span>
<a href="#l16.163"></a><span id="l16.163" class="difflineminus">-  key = OESettings::Find50Key();</span>
<a href="#l16.164"></a><span id="l16.164" class="difflineminus">-  if (key != nsnull) {</span>
<a href="#l16.165"></a><span id="l16.165" class="difflineplus">+  if (NS_SUCCEEDED(WMSettings::FindWMKey(key)))</span>
<a href="#l16.166"></a><span id="l16.166">     *_retval = PR_TRUE;</span>
<a href="#l16.167"></a><span id="l16.167" class="difflineminus">-    ::RegCloseKey( key);</span>
<a href="#l16.168"></a><span id="l16.168" class="difflineminus">-  }</span>
<a href="#l16.169"></a><span id="l16.169" class="difflineminus">-  else {</span>
<a href="#l16.170"></a><span id="l16.170" class="difflineminus">-    key = OESettings::Find40Key();</span>
<a href="#l16.171"></a><span id="l16.171" class="difflineminus">-    if (key != nsnull) {</span>
<a href="#l16.172"></a><span id="l16.172" class="difflineminus">-      *_retval = PR_TRUE;</span>
<a href="#l16.173"></a><span id="l16.173" class="difflineminus">-      ::RegCloseKey( key);</span>
<a href="#l16.174"></a><span id="l16.174" class="difflineminus">-    }</span>
<a href="#l16.175"></a><span id="l16.175" class="difflineminus">-  }</span>
<a href="#l16.176"></a><span id="l16.176" class="difflineminus">-  if (*_retval) {</span>
<a href="#l16.177"></a><span id="l16.177" class="difflineminus">-    key = OESettings::FindAccountsKey();</span>
<a href="#l16.178"></a><span id="l16.178" class="difflineminus">-    if (key == nsnull) {</span>
<a href="#l16.179"></a><span id="l16.179" class="difflineminus">-      *_retval = PR_FALSE;</span>
<a href="#l16.180"></a><span id="l16.180" class="difflineminus">-    }</span>
<a href="#l16.181"></a><span id="l16.181" class="difflineminus">-    else {</span>
<a href="#l16.182"></a><span id="l16.182" class="difflineminus">-      ::RegCloseKey( key);</span>
<a href="#l16.183"></a><span id="l16.183" class="difflineminus">-    }</span>
<a href="#l16.184"></a><span id="l16.184" class="difflineminus">-  }</span>
<a href="#l16.185"></a><span id="l16.185"> </span>
<a href="#l16.186"></a><span id="l16.186" class="difflineminus">-  return( NS_OK);</span>
<a href="#l16.187"></a><span id="l16.187" class="difflineplus">+  return NS_OK;</span>
<a href="#l16.188"></a><span id="l16.188"> }</span>
<a href="#l16.189"></a><span id="l16.189"> </span>
<a href="#l16.190"></a><span id="l16.190" class="difflineminus">-NS_IMETHODIMP nsOESettings::SetLocation(nsIFile *location)</span>
<a href="#l16.191"></a><span id="l16.191" class="difflineplus">+NS_IMETHODIMP nsWMSettings::SetLocation(nsIFile *location)</span>
<a href="#l16.192"></a><span id="l16.192"> {</span>
<a href="#l16.193"></a><span id="l16.193" class="difflineminus">-  return( NS_OK);</span>
<a href="#l16.194"></a><span id="l16.194" class="difflineplus">+  return NS_OK;</span>
<a href="#l16.195"></a><span id="l16.195"> }</span>
<a href="#l16.196"></a><span id="l16.196"> </span>
<a href="#l16.197"></a><span id="l16.197" class="difflineminus">-NS_IMETHODIMP nsOESettings::Import(nsIMsgAccount **localMailAccount, PRBool *_retval)</span>
<a href="#l16.198"></a><span id="l16.198" class="difflineplus">+NS_IMETHODIMP nsWMSettings::Import(nsIMsgAccount **localMailAccount,</span>
<a href="#l16.199"></a><span id="l16.199" class="difflineplus">+                                   PRBool *_retval)</span>
<a href="#l16.200"></a><span id="l16.200"> {</span>
<a href="#l16.201"></a><span id="l16.201" class="difflineminus">-  NS_PRECONDITION( _retval != nsnull, &quot;null ptr&quot;);</span>
<a href="#l16.202"></a><span id="l16.202" class="difflineplus">+  NS_PRECONDITION(_retval != nsnull, &quot;null ptr&quot;);</span>
<a href="#l16.203"></a><span id="l16.203"> </span>
<a href="#l16.204"></a><span id="l16.204" class="difflineminus">-  if (OESettings::DoImport( localMailAccount)) {</span>
<a href="#l16.205"></a><span id="l16.205" class="difflineplus">+  if (WMSettings::DoImport(localMailAccount)) {</span>
<a href="#l16.206"></a><span id="l16.206">     *_retval = PR_TRUE;</span>
<a href="#l16.207"></a><span id="l16.207" class="difflineminus">-    IMPORT_LOG0( &quot;Settings import appears successful\n&quot;);</span>
<a href="#l16.208"></a><span id="l16.208" class="difflineplus">+    IMPORT_LOG0(&quot;Settings import appears successful\n&quot;);</span>
<a href="#l16.209"></a><span id="l16.209">   }</span>
<a href="#l16.210"></a><span id="l16.210">   else {</span>
<a href="#l16.211"></a><span id="l16.211">     *_retval = PR_FALSE;</span>
<a href="#l16.212"></a><span id="l16.212" class="difflineminus">-    IMPORT_LOG0( &quot;Settings import returned FALSE\n&quot;);</span>
<a href="#l16.213"></a><span id="l16.213" class="difflineminus">-  }</span>
<a href="#l16.214"></a><span id="l16.214" class="difflineminus">-</span>
<a href="#l16.215"></a><span id="l16.215" class="difflineminus">-  return( NS_OK);</span>
<a href="#l16.216"></a><span id="l16.216" class="difflineminus">-}</span>
<a href="#l16.217"></a><span id="l16.217" class="difflineminus">-</span>
<a href="#l16.218"></a><span id="l16.218" class="difflineminus">-HKEY OESettings::FindAccountsKey( void)</span>
<a href="#l16.219"></a><span id="l16.219" class="difflineminus">-{</span>
<a href="#l16.220"></a><span id="l16.220" class="difflineminus">-  HKEY  sKey;</span>
<a href="#l16.221"></a><span id="l16.221" class="difflineminus">-</span>
<a href="#l16.222"></a><span id="l16.222" class="difflineminus">-  if (::RegOpenKeyEx( HKEY_CURRENT_USER, &quot;Identities&quot;, 0, KEY_QUERY_VALUE, &amp;sKey) == ERROR_SUCCESS) {</span>
<a href="#l16.223"></a><span id="l16.223" class="difflineminus">-    BYTE *  pBytes = nsOERegUtil::GetValueBytes( sKey, &quot;Default User ID&quot;);</span>
<a href="#l16.224"></a><span id="l16.224" class="difflineminus">-    ::RegCloseKey( sKey);</span>
<a href="#l16.225"></a><span id="l16.225" class="difflineminus">-    if (pBytes) {</span>
<a href="#l16.226"></a><span id="l16.226" class="difflineminus">-      nsCString  key( &quot;Identities\\&quot;);</span>
<a href="#l16.227"></a><span id="l16.227" class="difflineminus">-      key += (const char *)pBytes;</span>
<a href="#l16.228"></a><span id="l16.228" class="difflineminus">-      nsOERegUtil::FreeValueBytes( pBytes);</span>
<a href="#l16.229"></a><span id="l16.229" class="difflineminus">-      key += &quot;\\Software\\Microsoft\\Internet Account Manager\\Accounts&quot;;</span>
<a href="#l16.230"></a><span id="l16.230" class="difflineminus">-      if (::RegOpenKeyEx( HKEY_CURRENT_USER, key.get(), 0, KEY_QUERY_VALUE | KEY_ENUMERATE_SUB_KEYS, &amp;sKey) == ERROR_SUCCESS) {</span>
<a href="#l16.231"></a><span id="l16.231" class="difflineminus">-        return( sKey);</span>
<a href="#l16.232"></a><span id="l16.232" class="difflineminus">-      }</span>
<a href="#l16.233"></a><span id="l16.233" class="difflineminus">-    }</span>
<a href="#l16.234"></a><span id="l16.234" class="difflineminus">-  }</span>
<a href="#l16.235"></a><span id="l16.235" class="difflineminus">-</span>
<a href="#l16.236"></a><span id="l16.236" class="difflineminus">-  if (::RegOpenKeyEx( HKEY_CURRENT_USER, &quot;Software\\Microsoft\\Internet Account Manager\\Accounts&quot;, 0, KEY_QUERY_VALUE | KEY_ENUMERATE_SUB_KEYS, &amp;sKey) == ERROR_SUCCESS) {</span>
<a href="#l16.237"></a><span id="l16.237" class="difflineminus">-    return( sKey);</span>
<a href="#l16.238"></a><span id="l16.238" class="difflineminus">-  }</span>
<a href="#l16.239"></a><span id="l16.239" class="difflineminus">-</span>
<a href="#l16.240"></a><span id="l16.240" class="difflineminus">-  return( nsnull);</span>
<a href="#l16.241"></a><span id="l16.241" class="difflineminus">-}</span>
<a href="#l16.242"></a><span id="l16.242" class="difflineminus">-</span>
<a href="#l16.243"></a><span id="l16.243" class="difflineminus">-HKEY OESettings::Find50Key( void)</span>
<a href="#l16.244"></a><span id="l16.244" class="difflineminus">-{</span>
<a href="#l16.245"></a><span id="l16.245" class="difflineminus">-  PRBool    success = PR_FALSE;</span>
<a href="#l16.246"></a><span id="l16.246" class="difflineminus">-  HKEY    sKey;</span>
<a href="#l16.247"></a><span id="l16.247" class="difflineminus">-</span>
<a href="#l16.248"></a><span id="l16.248" class="difflineminus">-  if (::RegOpenKeyEx( HKEY_CURRENT_USER, &quot;Identities&quot;, 0, KEY_QUERY_VALUE, &amp;sKey) == ERROR_SUCCESS) {</span>
<a href="#l16.249"></a><span id="l16.249" class="difflineminus">-    BYTE *  pBytes = nsOERegUtil::GetValueBytes( sKey, &quot;Default User ID&quot;);</span>
<a href="#l16.250"></a><span id="l16.250" class="difflineminus">-    ::RegCloseKey( sKey);</span>
<a href="#l16.251"></a><span id="l16.251" class="difflineminus">-    if (pBytes) {</span>
<a href="#l16.252"></a><span id="l16.252" class="difflineminus">-      nsCString  key( &quot;Identities\\&quot;);</span>
<a href="#l16.253"></a><span id="l16.253" class="difflineminus">-      key += (const char *)pBytes;</span>
<a href="#l16.254"></a><span id="l16.254" class="difflineminus">-      nsOERegUtil::FreeValueBytes( pBytes);</span>
<a href="#l16.255"></a><span id="l16.255" class="difflineminus">-      key += &quot;\\Software\\Microsoft\\Outlook Express\\5.0&quot;;</span>
<a href="#l16.256"></a><span id="l16.256" class="difflineminus">-      if (::RegOpenKeyEx( HKEY_CURRENT_USER, key.get(), 0, KEY_QUERY_VALUE, &amp;sKey) == ERROR_SUCCESS) {</span>
<a href="#l16.257"></a><span id="l16.257" class="difflineminus">-        return( sKey);</span>
<a href="#l16.258"></a><span id="l16.258" class="difflineminus">-      }</span>
<a href="#l16.259"></a><span id="l16.259" class="difflineminus">-    }</span>
<a href="#l16.260"></a><span id="l16.260" class="difflineminus">-  }</span>
<a href="#l16.261"></a><span id="l16.261" class="difflineminus">-</span>
<a href="#l16.262"></a><span id="l16.262" class="difflineminus">-  return( nsnull);</span>
<a href="#l16.263"></a><span id="l16.263" class="difflineminus">-}</span>
<a href="#l16.264"></a><span id="l16.264" class="difflineminus">-</span>
<a href="#l16.265"></a><span id="l16.265" class="difflineminus">-HKEY OESettings::Find40Key( void)</span>
<a href="#l16.266"></a><span id="l16.266" class="difflineminus">-{</span>
<a href="#l16.267"></a><span id="l16.267" class="difflineminus">-  HKEY  sKey;</span>
<a href="#l16.268"></a><span id="l16.268" class="difflineminus">-  if (::RegOpenKeyEx( HKEY_CURRENT_USER, &quot;Software\\Microsoft\\Outlook Express&quot;, 0, KEY_QUERY_VALUE, &amp;sKey) == ERROR_SUCCESS) {</span>
<a href="#l16.269"></a><span id="l16.269" class="difflineminus">-    return( sKey);</span>
<a href="#l16.270"></a><span id="l16.270" class="difflineminus">-  }</span>
<a href="#l16.271"></a><span id="l16.271" class="difflineminus">-</span>
<a href="#l16.272"></a><span id="l16.272" class="difflineminus">-  return( nsnull);</span>
<a href="#l16.273"></a><span id="l16.273" class="difflineminus">-}</span>
<a href="#l16.274"></a><span id="l16.274" class="difflineminus">-</span>
<a href="#l16.275"></a><span id="l16.275" class="difflineminus">-PRBool OESettings::DoImport( nsIMsgAccount **ppAccount)</span>
<a href="#l16.276"></a><span id="l16.276" class="difflineminus">-{</span>
<a href="#l16.277"></a><span id="l16.277" class="difflineminus">-  HKEY  hKey = FindAccountsKey();</span>
<a href="#l16.278"></a><span id="l16.278" class="difflineminus">-  if (hKey == nsnull) {</span>
<a href="#l16.279"></a><span id="l16.279" class="difflineminus">-    IMPORT_LOG0( &quot;*** Error finding Outlook Express registry account keys\n&quot;);</span>
<a href="#l16.280"></a><span id="l16.280" class="difflineminus">-    return( PR_FALSE);</span>
<a href="#l16.281"></a><span id="l16.281" class="difflineminus">-  }</span>
<a href="#l16.282"></a><span id="l16.282" class="difflineminus">-</span>
<a href="#l16.283"></a><span id="l16.283" class="difflineminus">-  nsresult  rv;</span>
<a href="#l16.284"></a><span id="l16.284" class="difflineminus">-</span>
<a href="#l16.285"></a><span id="l16.285" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccountManager&gt; accMgr =</span>
<a href="#l16.286"></a><span id="l16.286" class="difflineminus">-           do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l16.287"></a><span id="l16.287" class="difflineminus">-    if (NS_FAILED(rv)) {</span>
<a href="#l16.288"></a><span id="l16.288" class="difflineminus">-    IMPORT_LOG0( &quot;*** Failed to create a account manager!\n&quot;);</span>
<a href="#l16.289"></a><span id="l16.289" class="difflineminus">-    ::RegCloseKey( hKey);</span>
<a href="#l16.290"></a><span id="l16.290" class="difflineminus">-    return( PR_FALSE);</span>
<a href="#l16.291"></a><span id="l16.291" class="difflineplus">+    IMPORT_LOG0(&quot;Settings import returned FALSE\n&quot;);</span>
<a href="#l16.292"></a><span id="l16.292">   }</span>
<a href="#l16.293"></a><span id="l16.293"> </span>
<a href="#l16.294"></a><span id="l16.294" class="difflineminus">-  HKEY    subKey;</span>
<a href="#l16.295"></a><span id="l16.295" class="difflineminus">-  nsCString  defMailName;</span>
<a href="#l16.296"></a><span id="l16.296" class="difflineminus">-  // OE has default mail account here when it has been</span>
<a href="#l16.297"></a><span id="l16.297" class="difflineminus">-  // set up by transfer or has multiple identities</span>
<a href="#l16.298"></a><span id="l16.298" class="difflineminus">-  // look below for orig code that looked in new OE installs</span>
<a href="#l16.299"></a><span id="l16.299" class="difflineminus">-  if (::RegOpenKeyEx(HKEY_CURRENT_USER, &quot;Identities&quot;, 0,</span>
<a href="#l16.300"></a><span id="l16.300" class="difflineminus">-                     KEY_QUERY_VALUE, &amp;subKey) == ERROR_SUCCESS) {</span>
<a href="#l16.301"></a><span id="l16.301" class="difflineminus">-    BYTE *  pBytes = nsOERegUtil::GetValueBytes(subKey, &quot;Default User ID&quot;);</span>
<a href="#l16.302"></a><span id="l16.302" class="difflineminus">-    ::RegCloseKey( subKey);</span>
<a href="#l16.303"></a><span id="l16.303" class="difflineminus">-    if (pBytes) {</span>
<a href="#l16.304"></a><span id="l16.304" class="difflineminus">-      nsCString  key( &quot;Identities\\&quot;);</span>
<a href="#l16.305"></a><span id="l16.305" class="difflineminus">-      key += (const char *)pBytes;</span>
<a href="#l16.306"></a><span id="l16.306" class="difflineminus">-      nsOERegUtil::FreeValueBytes( pBytes);</span>
<a href="#l16.307"></a><span id="l16.307" class="difflineminus">-      key += &quot;\\Software\\Microsoft\\Internet Account Manager&quot;;</span>
<a href="#l16.308"></a><span id="l16.308" class="difflineminus">-      if (::RegOpenKeyEx(HKEY_CURRENT_USER, key.get(), 0,</span>
<a href="#l16.309"></a><span id="l16.309" class="difflineminus">-                         KEY_QUERY_VALUE , &amp;subKey) == ERROR_SUCCESS) {</span>
<a href="#l16.310"></a><span id="l16.310" class="difflineminus">-        BYTE * pBytes = nsOERegUtil::GetValueBytes(subKey,</span>
<a href="#l16.311"></a><span id="l16.311" class="difflineminus">-                                                   &quot;Default Mail Account&quot;);</span>
<a href="#l16.312"></a><span id="l16.312" class="difflineminus">-        ::RegCloseKey( subKey);</span>
<a href="#l16.313"></a><span id="l16.313" class="difflineminus">-        if (pBytes) {</span>
<a href="#l16.314"></a><span id="l16.314" class="difflineminus">-          defMailName = (const char *)pBytes;</span>
<a href="#l16.315"></a><span id="l16.315" class="difflineminus">-          nsOERegUtil::FreeValueBytes( pBytes);</span>
<a href="#l16.316"></a><span id="l16.316" class="difflineminus">-        }</span>
<a href="#l16.317"></a><span id="l16.317" class="difflineminus">-      }</span>
<a href="#l16.318"></a><span id="l16.318" class="difflineplus">+  return NS_OK;</span>
<a href="#l16.319"></a><span id="l16.319" class="difflineplus">+}</span>
<a href="#l16.320"></a><span id="l16.320" class="difflineplus">+</span>
<a href="#l16.321"></a><span id="l16.321" class="difflineplus">+nsresult WMSettings::FindWMKey(nsIWindowsRegKey* akey)</span>
<a href="#l16.322"></a><span id="l16.322" class="difflineplus">+{</span>
<a href="#l16.323"></a><span id="l16.323" class="difflineplus">+  nsresult rv;</span>
<a href="#l16.324"></a><span id="l16.324" class="difflineplus">+  NS_ENSURE_ARG(akey);</span>
<a href="#l16.325"></a><span id="l16.325" class="difflineplus">+  rv = akey-&gt;Open(nsIWindowsRegKey::ROOT_KEY_CURRENT_USER,</span>
<a href="#l16.326"></a><span id="l16.326" class="difflineplus">+                  NS_LITERAL_STRING(&quot;Software\\Microsoft\\Windows Live Mail&quot;),</span>
<a href="#l16.327"></a><span id="l16.327" class="difflineplus">+                  nsIWindowsRegKey::ACCESS_QUERY_VALUE);</span>
<a href="#l16.328"></a><span id="l16.328" class="difflineplus">+  if (NS_SUCCEEDED(rv))</span>
<a href="#l16.329"></a><span id="l16.329" class="difflineplus">+    return rv;</span>
<a href="#l16.330"></a><span id="l16.330" class="difflineplus">+  rv = akey-&gt;Open(nsIWindowsRegKey::ROOT_KEY_CURRENT_USER,</span>
<a href="#l16.331"></a><span id="l16.331" class="difflineplus">+                  NS_LITERAL_STRING(&quot;Software\\Microsoft\\Windows Mail&quot;),</span>
<a href="#l16.332"></a><span id="l16.332" class="difflineplus">+                  nsIWindowsRegKey::ACCESS_QUERY_VALUE);</span>
<a href="#l16.333"></a><span id="l16.333" class="difflineplus">+  return rv;</span>
<a href="#l16.334"></a><span id="l16.334" class="difflineplus">+}</span>
<a href="#l16.335"></a><span id="l16.335" class="difflineplus">+</span>
<a href="#l16.336"></a><span id="l16.336" class="difflineplus">+PRBool WMSettings::getOEacctFiles(nsILocalFile* file,</span>
<a href="#l16.337"></a><span id="l16.337" class="difflineplus">+                                  nsCOMArray&lt;nsILocalFile&gt;&amp; fileArray)</span>
<a href="#l16.338"></a><span id="l16.338" class="difflineplus">+{</span>
<a href="#l16.339"></a><span id="l16.339" class="difflineplus">+  nsresult rv;</span>
<a href="#l16.340"></a><span id="l16.340" class="difflineplus">+  nsCOMPtr&lt;nsISimpleEnumerator&gt; entries;</span>
<a href="#l16.341"></a><span id="l16.341" class="difflineplus">+  rv = file-&gt;GetDirectoryEntries(getter_AddRefs(entries));</span>
<a href="#l16.342"></a><span id="l16.342" class="difflineplus">+  if (NS_FAILED(rv) || !entries)</span>
<a href="#l16.343"></a><span id="l16.343" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l16.344"></a><span id="l16.344" class="difflineplus">+</span>
<a href="#l16.345"></a><span id="l16.345" class="difflineplus">+  PRBool hasMore;</span>
<a href="#l16.346"></a><span id="l16.346" class="difflineplus">+  while (NS_SUCCEEDED(entries-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l16.347"></a><span id="l16.347" class="difflineplus">+    nsCOMPtr&lt;nsISupports&gt; sup;</span>
<a href="#l16.348"></a><span id="l16.348" class="difflineplus">+    entries-&gt;GetNext(getter_AddRefs(sup));</span>
<a href="#l16.349"></a><span id="l16.349" class="difflineplus">+    if (!sup)</span>
<a href="#l16.350"></a><span id="l16.350" class="difflineplus">+      return PR_FALSE;</span>
<a href="#l16.351"></a><span id="l16.351" class="difflineplus">+    nsCOMPtr&lt;nsILocalFile&gt; fileX = do_QueryInterface(sup);</span>
<a href="#l16.352"></a><span id="l16.352" class="difflineplus">+    if (!fileX)</span>
<a href="#l16.353"></a><span id="l16.353" class="difflineplus">+      return PR_FALSE;</span>
<a href="#l16.354"></a><span id="l16.354" class="difflineplus">+    nsString name;</span>
<a href="#l16.355"></a><span id="l16.355" class="difflineplus">+    if (NS_FAILED(fileX-&gt;GetLeafName(name)))</span>
<a href="#l16.356"></a><span id="l16.356" class="difflineplus">+      return PR_FALSE;</span>
<a href="#l16.357"></a><span id="l16.357" class="difflineplus">+    PRBool isDir;</span>
<a href="#l16.358"></a><span id="l16.358" class="difflineplus">+    if (NS_FAILED(fileX-&gt;IsDirectory(&amp;isDir)))</span>
<a href="#l16.359"></a><span id="l16.359" class="difflineplus">+      return PR_FALSE;</span>
<a href="#l16.360"></a><span id="l16.360" class="difflineplus">+    if (isDir) {</span>
<a href="#l16.361"></a><span id="l16.361" class="difflineplus">+      getOEacctFiles(fileX, fileArray);</span>
<a href="#l16.362"></a><span id="l16.362" class="difflineplus">+    }</span>
<a href="#l16.363"></a><span id="l16.363" class="difflineplus">+    else {</span>
<a href="#l16.364"></a><span id="l16.364" class="difflineplus">+      if (StringEndsWith(name, NS_LITERAL_STRING(&quot;.oeaccount&quot;)))</span>
<a href="#l16.365"></a><span id="l16.365" class="difflineplus">+        fileArray.AppendObject(fileX);</span>
<a href="#l16.366"></a><span id="l16.366">     }</span>
<a href="#l16.367"></a><span id="l16.367">   }</span>
<a href="#l16.368"></a><span id="l16.368" class="difflineplus">+  return PR_TRUE;</span>
<a href="#l16.369"></a><span id="l16.369" class="difflineplus">+}</span>
<a href="#l16.370"></a><span id="l16.370"> </span>
<a href="#l16.371"></a><span id="l16.371" class="difflineminus">-  // else it must be here in original install location from orig code</span>
<a href="#l16.372"></a><span id="l16.372" class="difflineminus">-  if (defMailName.IsEmpty()) {</span>
<a href="#l16.373"></a><span id="l16.373" class="difflineminus">-    if (::RegOpenKeyEx(HKEY_CURRENT_USER,</span>
<a href="#l16.374"></a><span id="l16.374" class="difflineminus">-                       &quot;Software\\Microsoft\\Outlook Express&quot;,  0,</span>
<a href="#l16.375"></a><span id="l16.375" class="difflineminus">-                       KEY_QUERY_VALUE, &amp;subKey) == ERROR_SUCCESS) {</span>
<a href="#l16.376"></a><span id="l16.376" class="difflineminus">-      BYTE *  pBytes = nsOERegUtil::GetValueBytes(subKey,</span>
<a href="#l16.377"></a><span id="l16.377" class="difflineminus">-                                                  &quot;Default Mail Account&quot;);</span>
<a href="#l16.378"></a><span id="l16.378" class="difflineminus">-      ::RegCloseKey( subKey);</span>
<a href="#l16.379"></a><span id="l16.379" class="difflineminus">-      if (pBytes) {</span>
<a href="#l16.380"></a><span id="l16.380" class="difflineminus">-        defMailName = (const char *)pBytes;</span>
<a href="#l16.381"></a><span id="l16.381" class="difflineminus">-        nsOERegUtil::FreeValueBytes( pBytes);</span>
<a href="#l16.382"></a><span id="l16.382" class="difflineminus">-      }</span>
<a href="#l16.383"></a><span id="l16.383" class="difflineminus">-    }</span>
<a href="#l16.384"></a><span id="l16.384" class="difflineplus">+nsresult WMSettings::GetValueForTag(nsIDOMDocument *xmlDoc,</span>
<a href="#l16.385"></a><span id="l16.385" class="difflineplus">+                                    const nsAString&amp; tagName,</span>
<a href="#l16.386"></a><span id="l16.386" class="difflineplus">+                                    nsAString &amp;value)</span>
<a href="#l16.387"></a><span id="l16.387" class="difflineplus">+{</span>
<a href="#l16.388"></a><span id="l16.388" class="difflineplus">+  nsCOMPtr&lt;nsIDOMNodeList&gt; list;</span>
<a href="#l16.389"></a><span id="l16.389" class="difflineplus">+  if (NS_FAILED(xmlDoc-&gt;GetElementsByTagName(tagName, getter_AddRefs(list))))</span>
<a href="#l16.390"></a><span id="l16.390" class="difflineplus">+    return NS_ERROR_FAILURE;</span>
<a href="#l16.391"></a><span id="l16.391" class="difflineplus">+  nsCOMPtr&lt;nsIDOMNode&gt; domNode;</span>
<a href="#l16.392"></a><span id="l16.392" class="difflineplus">+  list-&gt;Item(0, getter_AddRefs(domNode));</span>
<a href="#l16.393"></a><span id="l16.393" class="difflineplus">+  if (!domNode)</span>
<a href="#l16.394"></a><span id="l16.394" class="difflineplus">+    return NS_ERROR_FAILURE;</span>
<a href="#l16.395"></a><span id="l16.395" class="difflineplus">+  nsCOMPtr&lt;nsIDOM3Node&gt; domChildNode(do_QueryInterface(domNode));</span>
<a href="#l16.396"></a><span id="l16.396" class="difflineplus">+  return domChildNode-&gt;GetTextContent(value);</span>
<a href="#l16.397"></a><span id="l16.397" class="difflineplus">+}</span>
<a href="#l16.398"></a><span id="l16.398" class="difflineplus">+</span>
<a href="#l16.399"></a><span id="l16.399" class="difflineplus">+nsresult WMSettings::MakeXMLdoc(nsIDOMDocument** xmlDoc,</span>
<a href="#l16.400"></a><span id="l16.400" class="difflineplus">+                                nsILocalFile* file)</span>
<a href="#l16.401"></a><span id="l16.401" class="difflineplus">+{</span>
<a href="#l16.402"></a><span id="l16.402" class="difflineplus">+  nsresult rv;</span>
<a href="#l16.403"></a><span id="l16.403" class="difflineplus">+  nsCOMPtr&lt;nsIFileInputStream&gt; stream =</span>
<a href="#l16.404"></a><span id="l16.404" class="difflineplus">+    do_CreateInstance(NS_LOCALFILEINPUTSTREAM_CONTRACTID, &amp;rv);</span>
<a href="#l16.405"></a><span id="l16.405" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.406"></a><span id="l16.406" class="difflineplus">+</span>
<a href="#l16.407"></a><span id="l16.407" class="difflineplus">+  rv = stream-&gt;Init(file, PR_RDONLY, -1, 0);</span>
<a href="#l16.408"></a><span id="l16.408" class="difflineplus">+  nsCOMPtr&lt;nsIDOMParser&gt; parser = do_CreateInstance(NS_DOMPARSER_CONTRACTID);</span>
<a href="#l16.409"></a><span id="l16.409" class="difflineplus">+  NS_ENSURE_STATE(parser);</span>
<a href="#l16.410"></a><span id="l16.410" class="difflineplus">+  PRInt64 filesize;</span>
<a href="#l16.411"></a><span id="l16.411" class="difflineplus">+  file-&gt;GetFileSize(&amp;filesize);</span>
<a href="#l16.412"></a><span id="l16.412" class="difflineplus">+  return parser-&gt;ParseFromStream(stream, nsnull, PRInt32(filesize),</span>
<a href="#l16.413"></a><span id="l16.413" class="difflineplus">+                                 &quot;application/xml&quot;, xmlDoc);</span>
<a href="#l16.414"></a><span id="l16.414" class="difflineplus">+}</span>
<a href="#l16.415"></a><span id="l16.415" class="difflineplus">+</span>
<a href="#l16.416"></a><span id="l16.416" class="difflineplus">+PRBool WMSettings::DoImport(nsIMsgAccount **ppAccount)</span>
<a href="#l16.417"></a><span id="l16.417" class="difflineplus">+{</span>
<a href="#l16.418"></a><span id="l16.418" class="difflineplus">+  nsresult rv;</span>
<a href="#l16.419"></a><span id="l16.419" class="difflineplus">+</span>
<a href="#l16.420"></a><span id="l16.420" class="difflineplus">+  // do the windows registry stuff first</span>
<a href="#l16.421"></a><span id="l16.421" class="difflineplus">+  nsCOMPtr&lt;nsIWindowsRegKey&gt; key =</span>
<a href="#l16.422"></a><span id="l16.422" class="difflineplus">+    do_CreateInstance(&quot;@mozilla.org/windows-registry-key;1&quot;);</span>
<a href="#l16.423"></a><span id="l16.423" class="difflineplus">+  if (NS_FAILED(FindWMKey(key))) {</span>
<a href="#l16.424"></a><span id="l16.424" class="difflineplus">+    IMPORT_LOG0(&quot;*** Error finding Windows Live Mail registry account keys\n&quot;);</span>
<a href="#l16.425"></a><span id="l16.425" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l16.426"></a><span id="l16.426">   }</span>
<a href="#l16.427"></a><span id="l16.427" class="difflineminus">-  // else defmailname will be &quot;&quot;.  No big deal.</span>
<a href="#l16.428"></a><span id="l16.428" class="difflineminus">-</span>
<a href="#l16.429"></a><span id="l16.429" class="difflineminus">-  // 'poll for messages' setting in OE is a global setting</span>
<a href="#l16.430"></a><span id="l16.430" class="difflineminus">-  // in OE options general tab and in following global OE</span>
<a href="#l16.431"></a><span id="l16.431" class="difflineminus">-  // registry location.</span>
<a href="#l16.432"></a><span id="l16.432" class="difflineminus">-  // for all accounts poll interval is a 32 bit value, 0 for</span>
<a href="#l16.433"></a><span id="l16.433" class="difflineminus">-  // &quot;don't poll&quot;, else milliseconds</span>
<a href="#l16.434"></a><span id="l16.434" class="difflineminus">-  HKEY    subSubKey;</span>
<a href="#l16.435"></a><span id="l16.435" class="difflineminus">-</span>
<a href="#l16.436"></a><span id="l16.436" class="difflineminus">-  subKey = Find50Key();</span>
<a href="#l16.437"></a><span id="l16.437" class="difflineminus">-  if (!subKey )</span>
<a href="#l16.438"></a><span id="l16.438" class="difflineminus">-    subKey = Find40Key();</span>
<a href="#l16.439"></a><span id="l16.439" class="difflineminus">-  // above key not critical</span>
<a href="#l16.440"></a><span id="l16.440" class="difflineminus">-</span>
<a href="#l16.441"></a><span id="l16.441" class="difflineplus">+  // 'poll for messages' setting in WM is a global setting-Like OE</span>
<a href="#l16.442"></a><span id="l16.442" class="difflineplus">+  // for all accounts dword ==0xffffffff for don't poll else 1/60000 = minutes</span>
<a href="#l16.443"></a><span id="l16.443">   checkNewMailTime = 30;</span>
<a href="#l16.444"></a><span id="l16.444">   checkNewMail = PR_FALSE;</span>
<a href="#l16.445"></a><span id="l16.445" class="difflineminus">-  if (subKey){</span>
<a href="#l16.446"></a><span id="l16.446" class="difflineminus">-    if (::RegOpenKeyEx(subKey, &quot;Mail&quot;, 0, KEY_QUERY_VALUE,</span>
<a href="#l16.447"></a><span id="l16.447" class="difflineminus">-                       &amp;subSubKey) == ERROR_SUCCESS) {</span>
<a href="#l16.448"></a><span id="l16.448" class="difflineminus">-      ::RegCloseKey( subKey);</span>
<a href="#l16.449"></a><span id="l16.449" class="difflineminus">-      BYTE *  pBytes = nsOERegUtil::GetValueBytes( subSubKey, &quot;Poll For Mail&quot;);</span>
<a href="#l16.450"></a><span id="l16.450" class="difflineminus">-      ::RegCloseKey( subSubKey);</span>
<a href="#l16.451"></a><span id="l16.451" class="difflineminus">-      if (pBytes) {</span>
<a href="#l16.452"></a><span id="l16.452" class="difflineminus">-        if (*(PRInt32 *)pBytes != -1){</span>
<a href="#l16.453"></a><span id="l16.453" class="difflineminus">-          checkNewMail = PR_TRUE;</span>
<a href="#l16.454"></a><span id="l16.454" class="difflineminus">-          checkNewMailTime = *(PRInt32 *)pBytes / 60000;</span>
<a href="#l16.455"></a><span id="l16.455" class="difflineminus">-        }</span>
<a href="#l16.456"></a><span id="l16.456" class="difflineminus">-        nsOERegUtil::FreeValueBytes( pBytes);</span>
<a href="#l16.457"></a><span id="l16.457" class="difflineminus">-      }</span>
<a href="#l16.458"></a><span id="l16.458" class="difflineplus">+  nsCOMPtr&lt;nsIWindowsRegKey&gt; subKey;</span>
<a href="#l16.459"></a><span id="l16.459" class="difflineplus">+  if (NS_SUCCEEDED(key-&gt;OpenChild(NS_LITERAL_STRING(&quot;mail&quot;),</span>
<a href="#l16.460"></a><span id="l16.460" class="difflineplus">+                                  nsIWindowsRegKey::ACCESS_QUERY_VALUE,</span>
<a href="#l16.461"></a><span id="l16.461" class="difflineplus">+                                  getter_AddRefs(subKey)))) {</span>
<a href="#l16.462"></a><span id="l16.462" class="difflineplus">+    PRUint32 dwordResult = -1;</span>
<a href="#l16.463"></a><span id="l16.463" class="difflineplus">+    rv = subKey-&gt;ReadIntValue(NS_LITERAL_STRING(&quot;Poll For Mail&quot;), &amp;dwordResult); // reg_dword</span>
<a href="#l16.464"></a><span id="l16.464" class="difflineplus">+    subKey-&gt;Close();</span>
<a href="#l16.465"></a><span id="l16.465" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; dwordResult != -1){</span>
<a href="#l16.466"></a><span id="l16.466" class="difflineplus">+      checkNewMail = PR_TRUE;</span>
<a href="#l16.467"></a><span id="l16.467" class="difflineplus">+      checkNewMailTime = dwordResult / 60000;</span>
<a href="#l16.468"></a><span id="l16.468">     }</span>
<a href="#l16.469"></a><span id="l16.469">   }</span>
<a href="#l16.470"></a><span id="l16.470" class="difflineplus">+  // these are in main windowsmail key and if they don't exist-not to worry</span>
<a href="#l16.471"></a><span id="l16.471" class="difflineplus">+  // (less than 64 chars) e.g. account{4A18B81E-83CA-472A-8D7F-5301C0B97B8D}.oeaccount</span>
<a href="#l16.472"></a><span id="l16.472" class="difflineplus">+  nsAutoString  defMailAcct, defNewsAcct;</span>
<a href="#l16.473"></a><span id="l16.473" class="difflineplus">+  key-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;Default Mail Account&quot;), defMailAcct); // ref_sz</span>
<a href="#l16.474"></a><span id="l16.474" class="difflineplus">+  key-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;Default News Account&quot;), defNewsAcct); // ref_sz</span>
<a href="#l16.475"></a><span id="l16.475" class="difflineplus">+</span>
<a href="#l16.476"></a><span id="l16.476" class="difflineplus">+  // This is essential to proceed; it is the location on disk of xml-type account files;</span>
<a href="#l16.477"></a><span id="l16.477" class="difflineplus">+  // it is in reg_expand_sz so it will need expanding to absolute path.</span>
<a href="#l16.478"></a><span id="l16.478" class="difflineplus">+  nsString  storeRoot;</span>
<a href="#l16.479"></a><span id="l16.479" class="difflineplus">+  rv = key-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;Store Root&quot;), storeRoot);</span>
<a href="#l16.480"></a><span id="l16.480" class="difflineplus">+  key-&gt;Close();  // Finished with windows registry key. We do not want to return before this closing</span>
<a href="#l16.481"></a><span id="l16.481" class="difflineplus">+  if (NS_FAILED(rv) || storeRoot.IsEmpty()) {</span>
<a href="#l16.482"></a><span id="l16.482" class="difflineplus">+    IMPORT_LOG0(&quot;*** Error finding Windows Live Mail Store Root\n&quot;);</span>
<a href="#l16.483"></a><span id="l16.483" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l16.484"></a><span id="l16.484" class="difflineplus">+  }</span>
<a href="#l16.485"></a><span id="l16.485" class="difflineplus">+</span>
<a href="#l16.486"></a><span id="l16.486" class="difflineplus">+  nsCOMPtr&lt;nsILocalFile&gt; file(do_CreateInstance(NS_LOCAL_FILE_CONTRACTID));</span>
<a href="#l16.487"></a><span id="l16.487" class="difflineplus">+  if (!file) {</span>
<a href="#l16.488"></a><span id="l16.488" class="difflineplus">+    IMPORT_LOG0(&quot;*** Failed to create an nsILocalFile!\n&quot;);</span>
<a href="#l16.489"></a><span id="l16.489" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l16.490"></a><span id="l16.490" class="difflineplus">+  }</span>
<a href="#l16.491"></a><span id="l16.491" class="difflineplus">+  nsCOMPtr&lt;nsIMsgAccountManager&gt; accMgr =</span>
<a href="#l16.492"></a><span id="l16.492" class="difflineplus">+           do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l16.493"></a><span id="l16.493" class="difflineplus">+  if (NS_FAILED(rv)) {</span>
<a href="#l16.494"></a><span id="l16.494" class="difflineplus">+    IMPORT_LOG0(&quot;*** Failed to create an account manager!\n&quot;);</span>
<a href="#l16.495"></a><span id="l16.495" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l16.496"></a><span id="l16.496" class="difflineplus">+  }</span>
<a href="#l16.497"></a><span id="l16.497"> </span>
<a href="#l16.498"></a><span id="l16.498" class="difflineminus">-  // Iterate the accounts looking for POP3 &amp; IMAP accounts...</span>
<a href="#l16.499"></a><span id="l16.499" class="difflineminus">-  // Ignore LDAP for now!</span>
<a href="#l16.500"></a><span id="l16.500" class="difflineminus">-  DWORD      index = 0;</span>
<a href="#l16.501"></a><span id="l16.501" class="difflineminus">-  DWORD      numChars;</span>
<a href="#l16.502"></a><span id="l16.502" class="difflineminus">-  TCHAR      keyName[256];</span>
<a href="#l16.503"></a><span id="l16.503" class="difflineminus">-  LONG       result = ERROR_SUCCESS;</span>
<a href="#l16.504"></a><span id="l16.504" class="difflineminus">-  BYTE *     pBytes;</span>
<a href="#l16.505"></a><span id="l16.505" class="difflineminus">-  int        accounts = 0;</span>
<a href="#l16.506"></a><span id="l16.506" class="difflineminus">-  nsCString  keyComp;</span>
<a href="#l16.507"></a><span id="l16.507" class="difflineplus">+  PRUint32 size = ::ExpandEnvironmentStringsW((LPCWSTR)storeRoot.get(), nsnull, 0);</span>
<a href="#l16.508"></a><span id="l16.508" class="difflineplus">+  nsString expandedStoreRoot;</span>
<a href="#l16.509"></a><span id="l16.509" class="difflineplus">+  expandedStoreRoot.SetLength(size - 1);</span>
<a href="#l16.510"></a><span id="l16.510" class="difflineplus">+  if (expandedStoreRoot.Length() != size - 1)</span>
<a href="#l16.511"></a><span id="l16.511" class="difflineplus">+    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l16.512"></a><span id="l16.512" class="difflineplus">+  ::ExpandEnvironmentStringsW((LPCWSTR)storeRoot.get(),</span>
<a href="#l16.513"></a><span id="l16.513" class="difflineplus">+                              (LPWSTR)expandedStoreRoot.BeginWriting(),</span>
<a href="#l16.514"></a><span id="l16.514" class="difflineplus">+                              size);</span>
<a href="#l16.515"></a><span id="l16.515" class="difflineplus">+  storeRoot = expandedStoreRoot;</span>
<a href="#l16.516"></a><span id="l16.516"> </span>
<a href="#l16.517"></a><span id="l16.517" class="difflineminus">-  while (result == ERROR_SUCCESS) {</span>
<a href="#l16.518"></a><span id="l16.518" class="difflineminus">-    numChars = 256;</span>
<a href="#l16.519"></a><span id="l16.519" class="difflineminus">-    result = ::RegEnumKeyEx( hKey, index, keyName, &amp;numChars, NULL, NULL, NULL, NULL);</span>
<a href="#l16.520"></a><span id="l16.520" class="difflineminus">-    index++;</span>
<a href="#l16.521"></a><span id="l16.521" class="difflineminus">-    if (result == ERROR_SUCCESS) {</span>
<a href="#l16.522"></a><span id="l16.522" class="difflineminus">-      if (::RegOpenKeyEx( hKey, keyName, 0, KEY_QUERY_VALUE, &amp;subKey) == ERROR_SUCCESS) {</span>
<a href="#l16.523"></a><span id="l16.523" class="difflineminus">-        // Get the values for this account.</span>
<a href="#l16.524"></a><span id="l16.524" class="difflineminus">-        IMPORT_LOG1( &quot;Opened Outlook Express account: %s\n&quot;, (char *)keyName);</span>
<a href="#l16.525"></a><span id="l16.525" class="difflineplus">+  if (NS_FAILED(file-&gt;InitWithPath(storeRoot))) {</span>
<a href="#l16.526"></a><span id="l16.526" class="difflineplus">+    IMPORT_LOG0(&quot;*** Failed get store root!\n&quot;);</span>
<a href="#l16.527"></a><span id="l16.527" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l16.528"></a><span id="l16.528" class="difflineplus">+  }</span>
<a href="#l16.529"></a><span id="l16.529" class="difflineplus">+  nsCOMArray&lt;nsILocalFile&gt; fileArray;</span>
<a href="#l16.530"></a><span id="l16.530" class="difflineplus">+  if (!getOEacctFiles(file, fileArray)) {</span>
<a href="#l16.531"></a><span id="l16.531" class="difflineplus">+    IMPORT_LOG0(&quot;*** Failed to get OEacctFiles!\n&quot;);</span>
<a href="#l16.532"></a><span id="l16.532" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l16.533"></a><span id="l16.533" class="difflineplus">+  }</span>
<a href="#l16.534"></a><span id="l16.534"> </span>
<a href="#l16.535"></a><span id="l16.535" class="difflineminus">-        nsIMsgAccount  *anAccount = nsnull;</span>
<a href="#l16.536"></a><span id="l16.536" class="difflineminus">-        pBytes = nsOERegUtil::GetValueBytes( subKey, &quot;IMAP Server&quot;);</span>
<a href="#l16.537"></a><span id="l16.537" class="difflineminus">-        if (pBytes) {</span>
<a href="#l16.538"></a><span id="l16.538" class="difflineminus">-          if (DoIMAPServer( accMgr, subKey, (char *)pBytes, &amp;anAccount))</span>
<a href="#l16.539"></a><span id="l16.539" class="difflineminus">-            accounts++;</span>
<a href="#l16.540"></a><span id="l16.540" class="difflineminus">-          nsOERegUtil::FreeValueBytes( pBytes);</span>
<a href="#l16.541"></a><span id="l16.541" class="difflineminus">-        }</span>
<a href="#l16.542"></a><span id="l16.542" class="difflineplus">+  // Loop through *.oeaccounts files looking for POP3 &amp; IMAP &amp; NNTP accounts</span>
<a href="#l16.543"></a><span id="l16.543" class="difflineplus">+  // Ignore LDAP for now!</span>
<a href="#l16.544"></a><span id="l16.544" class="difflineplus">+  int accounts = 0;</span>
<a href="#l16.545"></a><span id="l16.545" class="difflineplus">+  nsCOMPtr&lt;nsIDOMDocument&gt; xmlDoc;</span>
<a href="#l16.546"></a><span id="l16.546"> </span>
<a href="#l16.547"></a><span id="l16.547" class="difflineminus">-        pBytes = nsOERegUtil::GetValueBytes( subKey, &quot;NNTP Server&quot;);</span>
<a href="#l16.548"></a><span id="l16.548" class="difflineminus">-        if (pBytes) {</span>
<a href="#l16.549"></a><span id="l16.549" class="difflineminus">-          if (DoNNTPServer( accMgr, subKey, (char *)pBytes, &amp;anAccount))</span>
<a href="#l16.550"></a><span id="l16.550" class="difflineminus">-            accounts++;</span>
<a href="#l16.551"></a><span id="l16.551" class="difflineminus">-          nsOERegUtil::FreeValueBytes( pBytes);</span>
<a href="#l16.552"></a><span id="l16.552" class="difflineminus">-        }</span>
<a href="#l16.553"></a><span id="l16.553" class="difflineplus">+  for (PRInt32 i = fileArray.Count() - 1 ; i &gt;= 0; i--){</span>
<a href="#l16.554"></a><span id="l16.554" class="difflineplus">+    MakeXMLdoc(getter_AddRefs(xmlDoc), fileArray[i]);</span>
<a href="#l16.555"></a><span id="l16.555"> </span>
<a href="#l16.556"></a><span id="l16.556" class="difflineminus">-        pBytes = nsOERegUtil::GetValueBytes( subKey, &quot;POP3 Server&quot;);</span>
<a href="#l16.557"></a><span id="l16.557" class="difflineminus">-        if (pBytes) {</span>
<a href="#l16.558"></a><span id="l16.558" class="difflineminus">-            if (DoPOP3Server( accMgr, subKey, (char *)pBytes, &amp;anAccount)) {</span>
<a href="#l16.559"></a><span id="l16.559" class="difflineminus">-              accounts++;</span>
<a href="#l16.560"></a><span id="l16.560" class="difflineminus">-          }</span>
<a href="#l16.561"></a><span id="l16.561" class="difflineminus">-          nsOERegUtil::FreeValueBytes( pBytes);</span>
<a href="#l16.562"></a><span id="l16.562" class="difflineminus">-        }</span>
<a href="#l16.563"></a><span id="l16.563" class="difflineplus">+    nsAutoString value;</span>
<a href="#l16.564"></a><span id="l16.564" class="difflineplus">+    nsCOMPtr&lt;nsIMsgAccount&gt; anAccount;</span>
<a href="#l16.565"></a><span id="l16.565" class="difflineplus">+    if (NS_SUCCEEDED(GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;IMAP_Server&quot;),</span>
<a href="#l16.566"></a><span id="l16.566" class="difflineplus">+        value)))</span>
<a href="#l16.567"></a><span id="l16.567" class="difflineplus">+      if (DoIMAPServer(accMgr, xmlDoc, value, getter_AddRefs(anAccount)))</span>
<a href="#l16.568"></a><span id="l16.568" class="difflineplus">+        accounts++;</span>
<a href="#l16.569"></a><span id="l16.569" class="difflineplus">+    if (NS_SUCCEEDED(GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;NNTP_Server&quot;),</span>
<a href="#l16.570"></a><span id="l16.570" class="difflineplus">+        value)))</span>
<a href="#l16.571"></a><span id="l16.571" class="difflineplus">+      if (DoNNTPServer(accMgr, xmlDoc, value, getter_AddRefs(anAccount)))</span>
<a href="#l16.572"></a><span id="l16.572" class="difflineplus">+        accounts++;</span>
<a href="#l16.573"></a><span id="l16.573" class="difflineplus">+    if (NS_SUCCEEDED(GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;POP3_Server&quot;),</span>
<a href="#l16.574"></a><span id="l16.574" class="difflineplus">+        value)))</span>
<a href="#l16.575"></a><span id="l16.575" class="difflineplus">+      if (DoPOP3Server(accMgr, xmlDoc, value, getter_AddRefs(anAccount)))</span>
<a href="#l16.576"></a><span id="l16.576" class="difflineplus">+        accounts++;</span>
<a href="#l16.577"></a><span id="l16.577"> </span>
<a href="#l16.578"></a><span id="l16.578" class="difflineminus">-        if (anAccount) {</span>
<a href="#l16.579"></a><span id="l16.579" class="difflineminus">-          // Is this the default account?</span>
<a href="#l16.580"></a><span id="l16.580" class="difflineminus">-          keyComp = keyName;</span>
<a href="#l16.581"></a><span id="l16.581" class="difflineminus">-          if (keyComp.Equals( defMailName)) {</span>
<a href="#l16.582"></a><span id="l16.582" class="difflineminus">-            accMgr-&gt;SetDefaultAccount( anAccount);</span>
<a href="#l16.583"></a><span id="l16.583" class="difflineminus">-          }</span>
<a href="#l16.584"></a><span id="l16.584" class="difflineminus">-          NS_RELEASE( anAccount);</span>
<a href="#l16.585"></a><span id="l16.585" class="difflineminus">-        }</span>
<a href="#l16.586"></a><span id="l16.586" class="difflineminus">-</span>
<a href="#l16.587"></a><span id="l16.587" class="difflineminus">-        ::RegCloseKey( subKey);</span>
<a href="#l16.588"></a><span id="l16.588" class="difflineminus">-      }</span>
<a href="#l16.589"></a><span id="l16.589" class="difflineplus">+    if (anAccount) {</span>
<a href="#l16.590"></a><span id="l16.590" class="difflineplus">+      nsString name;</span>
<a href="#l16.591"></a><span id="l16.591" class="difflineplus">+      // Is this the default account?</span>
<a href="#l16.592"></a><span id="l16.592" class="difflineplus">+      fileArray[i]-&gt;GetLeafName(name);</span>
<a href="#l16.593"></a><span id="l16.593" class="difflineplus">+      if (defMailAcct.Equals(name))</span>
<a href="#l16.594"></a><span id="l16.594" class="difflineplus">+        accMgr-&gt;SetDefaultAccount(anAccount);</span>
<a href="#l16.595"></a><span id="l16.595">     }</span>
<a href="#l16.596"></a><span id="l16.596">   }</span>
<a href="#l16.597"></a><span id="l16.597" class="difflineminus">-  ::RegCloseKey( hKey);</span>
<a href="#l16.598"></a><span id="l16.598"> </span>
<a href="#l16.599"></a><span id="l16.599">   // Now save the new acct info to pref file.</span>
<a href="#l16.600"></a><span id="l16.600">   rv = accMgr-&gt;SaveAccountInfo();</span>
<a href="#l16.601"></a><span id="l16.601">   NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Can't save account info to pref file&quot;);</span>
<a href="#l16.602"></a><span id="l16.602"> </span>
<a href="#l16.603"></a><span id="l16.603">   return( accounts != 0);</span>
<a href="#l16.604"></a><span id="l16.604"> }</span>
<a href="#l16.605"></a><span id="l16.605"> </span>
<a href="#l16.606"></a><span id="l16.606" class="difflineminus">-nsresult OESettings::GetAccountName(HKEY hKey, char *defaultName, nsString &amp;acctName)</span>
<a href="#l16.607"></a><span id="l16.607" class="difflineplus">+PRBool WMSettings::DoIMAPServer(nsIMsgAccountManager *pMgr,</span>
<a href="#l16.608"></a><span id="l16.608" class="difflineplus">+                                nsIDOMDocument *xmlDoc,</span>
<a href="#l16.609"></a><span id="l16.609" class="difflineplus">+                                const nsString&amp; serverName,</span>
<a href="#l16.610"></a><span id="l16.610" class="difflineplus">+                                nsIMsgAccount **ppAccount)</span>
<a href="#l16.611"></a><span id="l16.611"> {</span>
<a href="#l16.612"></a><span id="l16.612" class="difflineminus">-  BYTE *pAccName = nsOERegUtil::GetValueBytes( hKey, &quot;Account Name&quot;);</span>
<a href="#l16.613"></a><span id="l16.613" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l16.614"></a><span id="l16.614" class="difflineminus">-  if (pAccName) {</span>
<a href="#l16.615"></a><span id="l16.615" class="difflineminus">-    rv = nsMsgI18NConvertToUnicode(nsMsgI18NFileSystemCharset(),</span>
<a href="#l16.616"></a><span id="l16.616" class="difflineminus">-                                   nsDependentCString((const char *)pAccName), acctName);</span>
<a href="#l16.617"></a><span id="l16.617" class="difflineminus">-    nsOERegUtil::FreeValueBytes( pAccName);</span>
<a href="#l16.618"></a><span id="l16.618" class="difflineminus">-  }</span>
<a href="#l16.619"></a><span id="l16.619" class="difflineminus">-  else</span>
<a href="#l16.620"></a><span id="l16.620" class="difflineminus">-    acctName.AssignASCII(defaultName);</span>
<a href="#l16.621"></a><span id="l16.621" class="difflineminus">-  return rv;</span>
<a href="#l16.622"></a><span id="l16.622" class="difflineminus">-}</span>
<a href="#l16.623"></a><span id="l16.623" class="difflineminus">-</span>
<a href="#l16.624"></a><span id="l16.624" class="difflineminus">-PRBool OESettings::DoIMAPServer( nsIMsgAccountManager *pMgr, HKEY hKey, char *pServerName, nsIMsgAccount **ppAccount)</span>
<a href="#l16.625"></a><span id="l16.625" class="difflineminus">-{</span>
<a href="#l16.626"></a><span id="l16.626" class="difflineminus">-  PRInt32 authMethod;</span>
<a href="#l16.627"></a><span id="l16.627" class="difflineplus">+  PRInt32 authMethod;   // Secure Password Authentication (SPA)</span>
<a href="#l16.628"></a><span id="l16.628" class="difflineplus">+  PRInt32 errorCode;</span>
<a href="#l16.629"></a><span id="l16.629">   if (ppAccount)</span>
<a href="#l16.630"></a><span id="l16.630">     *ppAccount = nsnull;</span>
<a href="#l16.631"></a><span id="l16.631"> </span>
<a href="#l16.632"></a><span id="l16.632" class="difflineminus">-  char * pUserName;</span>
<a href="#l16.633"></a><span id="l16.633" class="difflineminus">-  pUserName = (char *)nsOERegUtil::GetValueBytes(hKey, &quot;IMAP User Name&quot;);</span>
<a href="#l16.634"></a><span id="l16.634" class="difflineminus">-  if (!pUserName)</span>
<a href="#l16.635"></a><span id="l16.635" class="difflineminus">-    return( PR_FALSE);</span>
<a href="#l16.636"></a><span id="l16.636" class="difflineminus">-</span>
<a href="#l16.637"></a><span id="l16.637" class="difflineplus">+  nsAutoString userName, value;</span>
<a href="#l16.638"></a><span id="l16.638" class="difflineplus">+  if (NS_FAILED(GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;IMAP_User_Name&quot;),</span>
<a href="#l16.639"></a><span id="l16.639" class="difflineplus">+                               userName)))</span>
<a href="#l16.640"></a><span id="l16.640" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l16.641"></a><span id="l16.641">   PRBool result = PR_FALSE;</span>
<a href="#l16.642"></a><span id="l16.642" class="difflineminus">-</span>
<a href="#l16.643"></a><span id="l16.643">   // I now have a user name/server name pair, find out if it already exists?</span>
<a href="#l16.644"></a><span id="l16.644">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; in;</span>
<a href="#l16.645"></a><span id="l16.645" class="difflineminus">-  nsresult rv = pMgr-&gt;FindServer(nsDependentCString(pUserName),</span>
<a href="#l16.646"></a><span id="l16.646" class="difflineminus">-                                 nsDependentCString(pServerName),</span>
<a href="#l16.647"></a><span id="l16.647" class="difflineplus">+  nsresult rv = pMgr-&gt;FindServer(NS_ConvertUTF16toUTF8(userName),</span>
<a href="#l16.648"></a><span id="l16.648" class="difflineplus">+                                 NS_ConvertUTF16toUTF8(serverName),</span>
<a href="#l16.649"></a><span id="l16.649">                                  NS_LITERAL_CSTRING(&quot;imap&quot;),</span>
<a href="#l16.650"></a><span id="l16.650">                                  getter_AddRefs(in));</span>
<a href="#l16.651"></a><span id="l16.651" class="difflineminus">-  if (NS_FAILED( rv) || (in == nsnull)) {</span>
<a href="#l16.652"></a><span id="l16.652" class="difflineplus">+  if (NS_FAILED(rv) || (in == nsnull)) {</span>
<a href="#l16.653"></a><span id="l16.653">     // Create the incoming server and an account for it?</span>
<a href="#l16.654"></a><span id="l16.654" class="difflineminus">-    rv = pMgr-&gt;CreateIncomingServer(nsDependentCString(pUserName),</span>
<a href="#l16.655"></a><span id="l16.655" class="difflineminus">-                                    nsDependentCString(pServerName),</span>
<a href="#l16.656"></a><span id="l16.656" class="difflineplus">+    rv = pMgr-&gt;CreateIncomingServer(NS_ConvertUTF16toUTF8(userName),</span>
<a href="#l16.657"></a><span id="l16.657" class="difflineplus">+                                    NS_ConvertUTF16toUTF8(serverName),</span>
<a href="#l16.658"></a><span id="l16.658">                                     NS_LITERAL_CSTRING(&quot;imap&quot;),</span>
<a href="#l16.659"></a><span id="l16.659">                                     getter_AddRefs(in));</span>
<a href="#l16.660"></a><span id="l16.660" class="difflineminus">-    if (NS_SUCCEEDED( rv) &amp;&amp; in) {</span>
<a href="#l16.661"></a><span id="l16.661" class="difflineminus">-      BYTE * pRootFolder = nsOERegUtil::GetValueBytes(hKey, &quot;IMAP Root Folder&quot;);</span>
<a href="#l16.662"></a><span id="l16.662" class="difflineminus">-      if (pRootFolder)</span>
<a href="#l16.663"></a><span id="l16.663" class="difflineminus">-      {</span>
<a href="#l16.664"></a><span id="l16.664" class="difflineminus">-        nsCOMPtr&lt;nsIImapIncomingServer&gt; imapServer = do_QueryInterface(in);</span>
<a href="#l16.665"></a><span id="l16.665" class="difflineminus">-        imapServer-&gt;SetServerDirectory(nsDependentCString((const char *) pRootFolder));</span>
<a href="#l16.666"></a><span id="l16.666" class="difflineminus">-        nsOERegUtil::FreeValueBytes(pRootFolder);</span>
<a href="#l16.667"></a><span id="l16.667" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; in) {</span>
<a href="#l16.668"></a><span id="l16.668" class="difflineplus">+      nsCOMPtr&lt;nsIImapIncomingServer&gt; imapServer = do_QueryInterface(in);</span>
<a href="#l16.669"></a><span id="l16.669" class="difflineplus">+      if (!imapServer){</span>
<a href="#l16.670"></a><span id="l16.670" class="difflineplus">+        IMPORT_LOG1(&quot;*** Failed to create nsIImapIncomingServer for %S!\n&quot;,</span>
<a href="#l16.671"></a><span id="l16.671" class="difflineplus">+                    serverName.get());</span>
<a href="#l16.672"></a><span id="l16.672" class="difflineplus">+        return PR_FALSE;</span>
<a href="#l16.673"></a><span id="l16.673">       }</span>
<a href="#l16.674"></a><span id="l16.674" class="difflineminus">-</span>
<a href="#l16.675"></a><span id="l16.675" class="difflineminus">-      BYTE * pSecureConnection = nsOERegUtil::GetValueBytes(hKey, &quot;IMAP Secure Connection&quot;);</span>
<a href="#l16.676"></a><span id="l16.676" class="difflineminus">-      if (pSecureConnection)</span>
<a href="#l16.677"></a><span id="l16.677" class="difflineminus">-      {</span>
<a href="#l16.678"></a><span id="l16.678" class="difflineminus">-        if (*pSecureConnection)</span>
<a href="#l16.679"></a><span id="l16.679" class="difflineminus">-          in-&gt;SetSocketType(nsMsgSocketType::SSL);</span>
<a href="#l16.680"></a><span id="l16.680" class="difflineminus">-        nsOERegUtil::FreeValueBytes(pSecureConnection);</span>
<a href="#l16.681"></a><span id="l16.681" class="difflineminus">-      }</span>
<a href="#l16.682"></a><span id="l16.682" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;IMAP_Root_Folder&quot;), value);</span>
<a href="#l16.683"></a><span id="l16.683" class="difflineplus">+      if (!value.IsEmpty())</span>
<a href="#l16.684"></a><span id="l16.684" class="difflineplus">+        imapServer-&gt;SetServerDirectory(NS_ConvertUTF16toUTF8(value));</span>
<a href="#l16.685"></a><span id="l16.685"> </span>
<a href="#l16.686"></a><span id="l16.686" class="difflineminus">-      BYTE * pPort = nsOERegUtil::GetValueBytes(hKey, &quot;IMAP Port&quot;);</span>
<a href="#l16.687"></a><span id="l16.687" class="difflineminus">-      if (pPort)</span>
<a href="#l16.688"></a><span id="l16.688" class="difflineminus">-      {</span>
<a href="#l16.689"></a><span id="l16.689" class="difflineminus">-        in-&gt;SetPort(*(PRInt32 *) pPort);</span>
<a href="#l16.690"></a><span id="l16.690" class="difflineminus">-        nsOERegUtil::FreeValueBytes(pPort);</span>
<a href="#l16.691"></a><span id="l16.691" class="difflineminus">-      }</span>
<a href="#l16.692"></a><span id="l16.692" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;IMAP_Secure_Connection&quot;), value);</span>
<a href="#l16.693"></a><span id="l16.693" class="difflineplus">+      if (value.ToInteger(&amp;errorCode, 16))</span>
<a href="#l16.694"></a><span id="l16.694" class="difflineplus">+        in-&gt;SetSocketType(nsMsgSocketType::SSL);</span>
<a href="#l16.695"></a><span id="l16.695"> </span>
<a href="#l16.696"></a><span id="l16.696" class="difflineminus">-      BYTE * pBytesTemp = nsOERegUtil::GetValueBytes(hKey, &quot;IMAP Use Sicily&quot;);</span>
<a href="#l16.697"></a><span id="l16.697" class="difflineminus">-      if (pBytesTemp)</span>
<a href="#l16.698"></a><span id="l16.698" class="difflineminus">-      {</span>
<a href="#l16.699"></a><span id="l16.699" class="difflineminus">-        PRBool secAuth = *(PRBool *)pBytesTemp;</span>
<a href="#l16.700"></a><span id="l16.700" class="difflineminus">-        nsOERegUtil::FreeValueBytes(pBytesTemp);</span>
<a href="#l16.701"></a><span id="l16.701" class="difflineminus">-        authMethod = secAuth ? nsMsgAuthMethod::secure</span>
<a href="#l16.702"></a><span id="l16.702" class="difflineminus">-            : nsMsgAuthMethod::passwordCleartext;</span>
<a href="#l16.703"></a><span id="l16.703" class="difflineminus">-      }</span>
<a href="#l16.704"></a><span id="l16.704" class="difflineminus">-      else {</span>
<a href="#l16.705"></a><span id="l16.705" class="difflineminus">-        authMethod = nsMsgAuthMethod::passwordCleartext;</span>
<a href="#l16.706"></a><span id="l16.706" class="difflineminus">-      }</span>
<a href="#l16.707"></a><span id="l16.707" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;IMAP_Use_Sicily&quot;), value);</span>
<a href="#l16.708"></a><span id="l16.708" class="difflineplus">+      PRBool secAuth = (PRBool)value.ToInteger(&amp;errorCode, 16);</span>
<a href="#l16.709"></a><span id="l16.709" class="difflineplus">+      authMethod = secAuth ? nsMsgAuthMethod::secure :</span>
<a href="#l16.710"></a><span id="l16.710" class="difflineplus">+                             nsMsgAuthMethod::passwordCleartext;</span>
<a href="#l16.711"></a><span id="l16.711">       in-&gt;SetAuthMethod(authMethod);</span>
<a href="#l16.712"></a><span id="l16.712"> </span>
<a href="#l16.713"></a><span id="l16.713" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;IMAP_Port&quot;), value);</span>
<a href="#l16.714"></a><span id="l16.714" class="difflineplus">+      if (!value.IsEmpty())</span>
<a href="#l16.715"></a><span id="l16.715" class="difflineplus">+        in-&gt;SetPort(value.ToInteger(&amp;errorCode, 16));</span>
<a href="#l16.716"></a><span id="l16.716" class="difflineplus">+</span>
<a href="#l16.717"></a><span id="l16.717" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;Account_Name&quot;), value);</span>
<a href="#l16.718"></a><span id="l16.718" class="difflineplus">+      if (!value.IsEmpty())</span>
<a href="#l16.719"></a><span id="l16.719" class="difflineplus">+        rv = in-&gt;SetPrettyName(value);</span>
<a href="#l16.720"></a><span id="l16.720">       in-&gt;SetDoBiff(checkNewMail);</span>
<a href="#l16.721"></a><span id="l16.721">       in-&gt;SetBiffMinutes(checkNewMailTime);</span>
<a href="#l16.722"></a><span id="l16.722"> </span>
<a href="#l16.723"></a><span id="l16.723" class="difflineminus">-      IMPORT_LOG2(&quot;Created IMAP server named: %s, userName: %s\n&quot;,</span>
<a href="#l16.724"></a><span id="l16.724" class="difflineminus">-                   pServerName, pUserName);</span>
<a href="#l16.725"></a><span id="l16.725" class="difflineminus">-</span>
<a href="#l16.726"></a><span id="l16.726" class="difflineminus">-      nsString prettyName;</span>
<a href="#l16.727"></a><span id="l16.727" class="difflineminus">-      if (NS_SUCCEEDED(GetAccountName(hKey, pServerName, prettyName)))</span>
<a href="#l16.728"></a><span id="l16.728" class="difflineminus">-        rv = in-&gt;SetPrettyName(prettyName);</span>
<a href="#l16.729"></a><span id="l16.729" class="difflineplus">+      IMPORT_LOG2(&quot;Created IMAP server named: %S, userName: %S\n&quot;,</span>
<a href="#l16.730"></a><span id="l16.730" class="difflineplus">+                  serverName.get(), userName.get());</span>
<a href="#l16.731"></a><span id="l16.731"> </span>
<a href="#l16.732"></a><span id="l16.732">       // We have a server, create an account.</span>
<a href="#l16.733"></a><span id="l16.733">       nsCOMPtr&lt;nsIMsgAccount&gt; account;</span>
<a href="#l16.734"></a><span id="l16.734" class="difflineminus">-      rv = pMgr-&gt;CreateAccount(getter_AddRefs( account));</span>
<a href="#l16.735"></a><span id="l16.735" class="difflineminus">-      if (NS_SUCCEEDED( rv) &amp;&amp; account) {</span>
<a href="#l16.736"></a><span id="l16.736" class="difflineplus">+      rv = pMgr-&gt;CreateAccount(getter_AddRefs(account));</span>
<a href="#l16.737"></a><span id="l16.737" class="difflineplus">+      if (NS_SUCCEEDED(rv) &amp;&amp; account) {</span>
<a href="#l16.738"></a><span id="l16.738">         rv = account-&gt;SetIncomingServer(in);</span>
<a href="#l16.739"></a><span id="l16.739"> </span>
<a href="#l16.740"></a><span id="l16.740" class="difflineminus">-        IMPORT_LOG0(&quot;Created an account and set the IMAP server as the incoming server\n&quot;);</span>
<a href="#l16.741"></a><span id="l16.741" class="difflineplus">+        IMPORT_LOG0(&quot;Created an account and set the IMAP server &quot;</span>
<a href="#l16.742"></a><span id="l16.742" class="difflineplus">+                    &quot;as the incoming server\n&quot;);</span>
<a href="#l16.743"></a><span id="l16.743"> </span>
<a href="#l16.744"></a><span id="l16.744">         // Fiddle with the identities</span>
<a href="#l16.745"></a><span id="l16.745" class="difflineminus">-        SetIdentities(pMgr, account, hKey, pUserName, authMethod, PR_FALSE);</span>
<a href="#l16.746"></a><span id="l16.746" class="difflineplus">+        SetIdentities(pMgr, account, xmlDoc, userName, authMethod, PR_FALSE);</span>
<a href="#l16.747"></a><span id="l16.747">         result = PR_TRUE;</span>
<a href="#l16.748"></a><span id="l16.748">         if (ppAccount)</span>
<a href="#l16.749"></a><span id="l16.749" class="difflineminus">-          account-&gt;QueryInterface(NS_GET_IID(nsIMsgAccount), (void **)ppAccount);</span>
<a href="#l16.750"></a><span id="l16.750" class="difflineplus">+          account.forget(ppAccount);</span>
<a href="#l16.751"></a><span id="l16.751">       }</span>
<a href="#l16.752"></a><span id="l16.752">     }</span>
<a href="#l16.753"></a><span id="l16.753">   }</span>
<a href="#l16.754"></a><span id="l16.754">   else if (NS_SUCCEEDED(rv) &amp;&amp; in) {</span>
<a href="#l16.755"></a><span id="l16.755">     // for an existing server we create another identity,</span>
<a href="#l16.756"></a><span id="l16.756">     //  TB lists under 'manage identities'</span>
<a href="#l16.757"></a><span id="l16.757">     nsCOMPtr&lt;nsIMsgAccount&gt; account;</span>
<a href="#l16.758"></a><span id="l16.758" class="difflineminus">-    rv = pMgr-&gt;FindAccountForServer(in, getter_AddRefs( account));</span>
<a href="#l16.759"></a><span id="l16.759" class="difflineminus">-    if (NS_SUCCEEDED( rv) &amp;&amp; account) {</span>
<a href="#l16.760"></a><span id="l16.760" class="difflineminus">-      IMPORT_LOG0(&quot;Created an identity and added to existing IMAP incoming server\n&quot;);</span>
<a href="#l16.761"></a><span id="l16.761" class="difflineplus">+    rv = pMgr-&gt;FindAccountForServer(in, getter_AddRefs(account));</span>
<a href="#l16.762"></a><span id="l16.762" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; account) {</span>
<a href="#l16.763"></a><span id="l16.763" class="difflineplus">+      IMPORT_LOG0(&quot;Created an identity and added to existing &quot;</span>
<a href="#l16.764"></a><span id="l16.764" class="difflineplus">+                  &quot;IMAP incoming server\n&quot;);</span>
<a href="#l16.765"></a><span id="l16.765">       // Fiddle with the identities</span>
<a href="#l16.766"></a><span id="l16.766">       in-&gt;GetAuthMethod(&amp;authMethod);</span>
<a href="#l16.767"></a><span id="l16.767" class="difflineminus">-      SetIdentities(pMgr, account, hKey, pUserName, authMethod, PR_FALSE);</span>
<a href="#l16.768"></a><span id="l16.768" class="difflineplus">+      SetIdentities(pMgr, account, xmlDoc, userName, authMethod, PR_FALSE);</span>
<a href="#l16.769"></a><span id="l16.769">       result = PR_TRUE;</span>
<a href="#l16.770"></a><span id="l16.770">       if (ppAccount)</span>
<a href="#l16.771"></a><span id="l16.771" class="difflineminus">-        account-&gt;QueryInterface(NS_GET_IID(nsIMsgAccount),</span>
<a href="#l16.772"></a><span id="l16.772" class="difflineminus">-                                 (void **)ppAccount);</span>
<a href="#l16.773"></a><span id="l16.773" class="difflineplus">+        account.forget(ppAccount);</span>
<a href="#l16.774"></a><span id="l16.774">     }</span>
<a href="#l16.775"></a><span id="l16.775">   }</span>
<a href="#l16.776"></a><span id="l16.776">   else</span>
<a href="#l16.777"></a><span id="l16.777">     result = PR_TRUE;</span>
<a href="#l16.778"></a><span id="l16.778" class="difflineminus">-  nsOERegUtil::FreeValueBytes((BYTE *) pUserName);</span>
<a href="#l16.779"></a><span id="l16.779" class="difflineminus">-  return( result);</span>
<a href="#l16.780"></a><span id="l16.780" class="difflineplus">+  return result;</span>
<a href="#l16.781"></a><span id="l16.781"> }</span>
<a href="#l16.782"></a><span id="l16.782"> </span>
<a href="#l16.783"></a><span id="l16.783" class="difflineminus">-PRBool OESettings::DoPOP3Server( nsIMsgAccountManager *pMgr, HKEY hKey, char *pServerName, nsIMsgAccount **ppAccount)</span>
<a href="#l16.784"></a><span id="l16.784" class="difflineplus">+PRBool WMSettings::DoPOP3Server(nsIMsgAccountManager *pMgr,</span>
<a href="#l16.785"></a><span id="l16.785" class="difflineplus">+                                nsIDOMDocument *xmlDoc,</span>
<a href="#l16.786"></a><span id="l16.786" class="difflineplus">+                                const nsString&amp; serverName,</span>
<a href="#l16.787"></a><span id="l16.787" class="difflineplus">+                                nsIMsgAccount **ppAccount)</span>
<a href="#l16.788"></a><span id="l16.788"> {</span>
<a href="#l16.789"></a><span id="l16.789" class="difflineminus">-  PRInt32 authMethod;    // Secure Password Authentication</span>
<a href="#l16.790"></a><span id="l16.790" class="difflineplus">+  PRInt32 authMethod;   // Secure Password Authentication (SPA)</span>
<a href="#l16.791"></a><span id="l16.791" class="difflineplus">+  PRInt32 errorCode;</span>
<a href="#l16.792"></a><span id="l16.792">   if (ppAccount)</span>
<a href="#l16.793"></a><span id="l16.793">     *ppAccount = nsnull;</span>
<a href="#l16.794"></a><span id="l16.794"> </span>
<a href="#l16.795"></a><span id="l16.795" class="difflineminus">-  char * pUserName;</span>
<a href="#l16.796"></a><span id="l16.796" class="difflineminus">-  pUserName = (char *)nsOERegUtil::GetValueBytes( hKey, &quot;POP3 User Name&quot;);</span>
<a href="#l16.797"></a><span id="l16.797" class="difflineminus">-  if (!pUserName)</span>
<a href="#l16.798"></a><span id="l16.798" class="difflineminus">-    return( PR_FALSE);</span>
<a href="#l16.799"></a><span id="l16.799" class="difflineminus">-</span>
<a href="#l16.800"></a><span id="l16.800" class="difflineplus">+  nsAutoString userName, value;</span>
<a href="#l16.801"></a><span id="l16.801" class="difflineplus">+  if (NS_FAILED(GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;POP3_User_Name&quot;),</span>
<a href="#l16.802"></a><span id="l16.802" class="difflineplus">+                               userName)))</span>
<a href="#l16.803"></a><span id="l16.803" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l16.804"></a><span id="l16.804">   PRBool result = PR_FALSE;</span>
<a href="#l16.805"></a><span id="l16.805" class="difflineminus">-</span>
<a href="#l16.806"></a><span id="l16.806">   // I now have a user name/server name pair, find out if it already exists?</span>
<a href="#l16.807"></a><span id="l16.807">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; in;</span>
<a href="#l16.808"></a><span id="l16.808" class="difflineminus">-  nsresult rv = pMgr-&gt;FindServer(nsDependentCString(pUserName),</span>
<a href="#l16.809"></a><span id="l16.809" class="difflineminus">-                                 nsDependentCString(pServerName),</span>
<a href="#l16.810"></a><span id="l16.810" class="difflineplus">+  nsresult rv = pMgr-&gt;FindServer(NS_ConvertUTF16toUTF8(userName),</span>
<a href="#l16.811"></a><span id="l16.811" class="difflineplus">+                                 NS_ConvertUTF16toUTF8(serverName),</span>
<a href="#l16.812"></a><span id="l16.812">                                  NS_LITERAL_CSTRING(&quot;pop3&quot;),</span>
<a href="#l16.813"></a><span id="l16.813" class="difflineminus">-                                 getter_AddRefs( in));</span>
<a href="#l16.814"></a><span id="l16.814" class="difflineminus">-  if (NS_FAILED( rv) || (in == nsnull)) {</span>
<a href="#l16.815"></a><span id="l16.815" class="difflineplus">+                                 getter_AddRefs(in));</span>
<a href="#l16.816"></a><span id="l16.816" class="difflineplus">+  if (NS_FAILED(rv) || (in == nsnull)) {</span>
<a href="#l16.817"></a><span id="l16.817">     // Create the incoming server and an account for it?</span>
<a href="#l16.818"></a><span id="l16.818" class="difflineminus">-    rv = pMgr-&gt;CreateIncomingServer(nsDependentCString(pUserName),</span>
<a href="#l16.819"></a><span id="l16.819" class="difflineminus">-                                    nsDependentCString(pServerName),</span>
<a href="#l16.820"></a><span id="l16.820" class="difflineplus">+    rv = pMgr-&gt;CreateIncomingServer(NS_ConvertUTF16toUTF8(userName),</span>
<a href="#l16.821"></a><span id="l16.821" class="difflineplus">+                                    NS_ConvertUTF16toUTF8(serverName),</span>
<a href="#l16.822"></a><span id="l16.822">                                     NS_LITERAL_CSTRING(&quot;pop3&quot;),</span>
<a href="#l16.823"></a><span id="l16.823" class="difflineminus">-                                    getter_AddRefs( in));</span>
<a href="#l16.824"></a><span id="l16.824" class="difflineminus">-    if (NS_SUCCEEDED( rv) &amp;&amp; in) {</span>
<a href="#l16.825"></a><span id="l16.825" class="difflineminus">-      BYTE * pSecureConnection = nsOERegUtil::GetValueBytes( hKey, &quot;POP3 Secure Connection&quot;);</span>
<a href="#l16.826"></a><span id="l16.826" class="difflineminus">-      if (pSecureConnection)</span>
<a href="#l16.827"></a><span id="l16.827" class="difflineminus">-      {</span>
<a href="#l16.828"></a><span id="l16.828" class="difflineminus">-        if (*pSecureConnection)</span>
<a href="#l16.829"></a><span id="l16.829" class="difflineminus">-          in-&gt;SetSocketType(nsMsgSocketType::SSL);</span>
<a href="#l16.830"></a><span id="l16.830" class="difflineminus">-        nsOERegUtil::FreeValueBytes(pSecureConnection);</span>
<a href="#l16.831"></a><span id="l16.831" class="difflineplus">+                                    getter_AddRefs(in));</span>
<a href="#l16.832"></a><span id="l16.832" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; in) {</span>
<a href="#l16.833"></a><span id="l16.833" class="difflineplus">+      nsCOMPtr&lt;nsIPop3IncomingServer&gt; pop3Server = do_QueryInterface(in);</span>
<a href="#l16.834"></a><span id="l16.834" class="difflineplus">+      if (!pop3Server){</span>
<a href="#l16.835"></a><span id="l16.835" class="difflineplus">+        IMPORT_LOG1(&quot;*** Failed to create nsIPop3IncomingServer for %S!\n&quot;,</span>
<a href="#l16.836"></a><span id="l16.836" class="difflineplus">+          serverName.get());</span>
<a href="#l16.837"></a><span id="l16.837" class="difflineplus">+        return PR_FALSE;</span>
<a href="#l16.838"></a><span id="l16.838">       }</span>
<a href="#l16.839"></a><span id="l16.839"> </span>
<a href="#l16.840"></a><span id="l16.840" class="difflineminus">-      BYTE * pPort = nsOERegUtil::GetValueBytes( hKey, &quot;POP3 Port&quot;);</span>
<a href="#l16.841"></a><span id="l16.841" class="difflineminus">-      if (pPort)</span>
<a href="#l16.842"></a><span id="l16.842" class="difflineminus">-      {</span>
<a href="#l16.843"></a><span id="l16.843" class="difflineminus">-        in-&gt;SetPort(*(PRInt32 *) pPort);</span>
<a href="#l16.844"></a><span id="l16.844" class="difflineminus">-        nsOERegUtil::FreeValueBytes(pPort);</span>
<a href="#l16.845"></a><span id="l16.845" class="difflineminus">-      }</span>
<a href="#l16.846"></a><span id="l16.846" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;POP3_Secure_Connection&quot;), value);</span>
<a href="#l16.847"></a><span id="l16.847" class="difflineplus">+      if (value.ToInteger(&amp;errorCode, 16))</span>
<a href="#l16.848"></a><span id="l16.848" class="difflineplus">+        in-&gt;SetSocketType(nsMsgSocketType::SSL);</span>
<a href="#l16.849"></a><span id="l16.849" class="difflineplus">+</span>
<a href="#l16.850"></a><span id="l16.850" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;POP3_Use_Sicily&quot;), value);</span>
<a href="#l16.851"></a><span id="l16.851" class="difflineplus">+      PRBool secAuth = (PRBool)value.ToInteger(&amp;errorCode, 16);</span>
<a href="#l16.852"></a><span id="l16.852" class="difflineplus">+      authMethod = secAuth ? nsMsgAuthMethod::secure :</span>
<a href="#l16.853"></a><span id="l16.853" class="difflineplus">+                             nsMsgAuthMethod::passwordCleartext;</span>
<a href="#l16.854"></a><span id="l16.854" class="difflineplus">+      in-&gt;SetAuthMethod(authMethod);</span>
<a href="#l16.855"></a><span id="l16.855" class="difflineplus">+</span>
<a href="#l16.856"></a><span id="l16.856" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;POP3_Port&quot;), value);</span>
<a href="#l16.857"></a><span id="l16.857" class="difflineplus">+      if (!value.IsEmpty())</span>
<a href="#l16.858"></a><span id="l16.858" class="difflineplus">+        in-&gt;SetPort(value.ToInteger(&amp;errorCode, 16));</span>
<a href="#l16.859"></a><span id="l16.859"> </span>
<a href="#l16.860"></a><span id="l16.860" class="difflineminus">-      BYTE * pBytesTemp = nsOERegUtil::GetValueBytes( hKey, &quot;POP3 Use Sicily&quot;);</span>
<a href="#l16.861"></a><span id="l16.861" class="difflineminus">-      if (pBytesTemp)</span>
<a href="#l16.862"></a><span id="l16.862" class="difflineminus">-      {</span>
<a href="#l16.863"></a><span id="l16.863" class="difflineminus">-        PRBool secAuth = *(PRBool *)pBytesTemp;</span>
<a href="#l16.864"></a><span id="l16.864" class="difflineminus">-        nsOERegUtil::FreeValueBytes(pBytesTemp);</span>
<a href="#l16.865"></a><span id="l16.865" class="difflineminus">-        authMethod = secAuth ? nsMsgAuthMethod::secure</span>
<a href="#l16.866"></a><span id="l16.866" class="difflineminus">-            : nsMsgAuthMethod::passwordCleartext;</span>
<a href="#l16.867"></a><span id="l16.867" class="difflineminus">-      }</span>
<a href="#l16.868"></a><span id="l16.868" class="difflineminus">-      else {</span>
<a href="#l16.869"></a><span id="l16.869" class="difflineminus">-        authMethod = nsMsgAuthMethod::passwordCleartext;</span>
<a href="#l16.870"></a><span id="l16.870" class="difflineminus">-      }</span>
<a href="#l16.871"></a><span id="l16.871" class="difflineminus">-      in-&gt;SetAuthMethod(authMethod);</span>
<a href="#l16.872"></a><span id="l16.872" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;POP3_Skip_Account&quot;), value);</span>
<a href="#l16.873"></a><span id="l16.873" class="difflineplus">+      if (!value.IsEmpty())</span>
<a href="#l16.874"></a><span id="l16.874" class="difflineplus">+        // OE:0=='Include this account when receiving mail or synchronizing'==</span>
<a href="#l16.875"></a><span id="l16.875" class="difflineplus">+        // TB:1==ActMgr:Server:advanced:Include this server when getting new mail</span>
<a href="#l16.876"></a><span id="l16.876" class="difflineplus">+        pop3Server-&gt;SetDeferGetNewMail(value.ToInteger(&amp;errorCode, 16) == 0);</span>
<a href="#l16.877"></a><span id="l16.877" class="difflineplus">+      else</span>
<a href="#l16.878"></a><span id="l16.878" class="difflineplus">+        pop3Server-&gt;SetDeferGetNewMail(PR_FALSE);</span>
<a href="#l16.879"></a><span id="l16.879" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;Leave_Mail_On_Server&quot;), value);</span>
<a href="#l16.880"></a><span id="l16.880" class="difflineplus">+      if (!value.IsEmpty())</span>
<a href="#l16.881"></a><span id="l16.881" class="difflineplus">+        pop3Server-&gt;SetLeaveMessagesOnServer((PRBool)value.ToInteger(&amp;errorCode, 16));</span>
<a href="#l16.882"></a><span id="l16.882" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;Remove_When_Deleted&quot;), value);</span>
<a href="#l16.883"></a><span id="l16.883" class="difflineplus">+      if (!value.IsEmpty())</span>
<a href="#l16.884"></a><span id="l16.884" class="difflineplus">+        pop3Server-&gt;SetDeleteMailLeftOnServer((PRBool)value.ToInteger(&amp;errorCode, 16));</span>
<a href="#l16.885"></a><span id="l16.885" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;Remove_When_Expired&quot;), value);</span>
<a href="#l16.886"></a><span id="l16.886" class="difflineplus">+      if (!value.IsEmpty())</span>
<a href="#l16.887"></a><span id="l16.887" class="difflineplus">+        pop3Server-&gt;SetDeleteByAgeFromServer((PRBool)value.ToInteger(&amp;errorCode, 16));</span>
<a href="#l16.888"></a><span id="l16.888" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;Expire_Days&quot;), value);</span>
<a href="#l16.889"></a><span id="l16.889" class="difflineplus">+      if (!value.IsEmpty())</span>
<a href="#l16.890"></a><span id="l16.890" class="difflineplus">+        pop3Server-&gt;SetNumDaysToLeaveOnServer(value.ToInteger(&amp;errorCode, 16));</span>
<a href="#l16.891"></a><span id="l16.891" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;Account_Name&quot;), value);</span>
<a href="#l16.892"></a><span id="l16.892" class="difflineplus">+      if (!value.IsEmpty())</span>
<a href="#l16.893"></a><span id="l16.893" class="difflineplus">+        rv = in-&gt;SetPrettyName(value);</span>
<a href="#l16.894"></a><span id="l16.894"> </span>
<a href="#l16.895"></a><span id="l16.895">       in-&gt;SetDoBiff(checkNewMail);</span>
<a href="#l16.896"></a><span id="l16.896">       in-&gt;SetBiffMinutes(checkNewMailTime);</span>
<a href="#l16.897"></a><span id="l16.897" class="difflineminus">-      nsCOMPtr&lt;nsIPop3IncomingServer&gt; pop3Server = do_QueryInterface(in);</span>
<a href="#l16.898"></a><span id="l16.898" class="difflineminus">-      if (pop3Server) {</span>
<a href="#l16.899"></a><span id="l16.899" class="difflineminus">-        // set local folders as the Inbox to use for this POP3 server</span>
<a href="#l16.900"></a><span id="l16.900" class="difflineminus">-        nsCOMPtr&lt;nsIMsgIncomingServer&gt; localFoldersServer;</span>
<a href="#l16.901"></a><span id="l16.901" class="difflineminus">-        pMgr-&gt;GetLocalFoldersServer(getter_AddRefs(localFoldersServer));</span>
<a href="#l16.902"></a><span id="l16.902" class="difflineminus">-</span>
<a href="#l16.903"></a><span id="l16.903" class="difflineminus">-        if (!localFoldersServer)</span>
<a href="#l16.904"></a><span id="l16.904" class="difflineminus">-        {</span>
<a href="#l16.905"></a><span id="l16.905" class="difflineminus">-          // If Local Folders does not exist already, create it</span>
<a href="#l16.906"></a><span id="l16.906" class="difflineminus">-</span>
<a href="#l16.907"></a><span id="l16.907" class="difflineminus">-          if (NS_FAILED(pMgr-&gt;CreateLocalMailAccount())) {</span>
<a href="#l16.908"></a><span id="l16.908" class="difflineminus">-            IMPORT_LOG0(&quot;*** Failed to create Local Folders!\n&quot;);</span>
<a href="#l16.909"></a><span id="l16.909" class="difflineminus">-            return PR_FALSE;</span>
<a href="#l16.910"></a><span id="l16.910" class="difflineminus">-          }</span>
<a href="#l16.911"></a><span id="l16.911" class="difflineminus">-</span>
<a href="#l16.912"></a><span id="l16.912" class="difflineminus">-          pMgr-&gt;GetLocalFoldersServer(getter_AddRefs(localFoldersServer));</span>
<a href="#l16.913"></a><span id="l16.913" class="difflineminus">-        }</span>
<a href="#l16.914"></a><span id="l16.914" class="difflineminus">-</span>
<a href="#l16.915"></a><span id="l16.915" class="difflineminus">-        // now get the account for this server</span>
<a href="#l16.916"></a><span id="l16.916" class="difflineminus">-        nsCOMPtr&lt;nsIMsgAccount&gt; localFoldersAccount;</span>
<a href="#l16.917"></a><span id="l16.917" class="difflineminus">-        pMgr-&gt;FindAccountForServer(localFoldersServer, getter_AddRefs(localFoldersAccount));</span>
<a href="#l16.918"></a><span id="l16.918" class="difflineminus">-        if (localFoldersAccount)</span>
<a href="#l16.919"></a><span id="l16.919" class="difflineminus">-        {</span>
<a href="#l16.920"></a><span id="l16.920" class="difflineminus">-          nsCString localFoldersAcctKey;</span>
<a href="#l16.921"></a><span id="l16.921" class="difflineminus">-          localFoldersAccount-&gt;GetKey(localFoldersAcctKey);</span>
<a href="#l16.922"></a><span id="l16.922" class="difflineminus">-          pop3Server-&gt;SetDeferredToAccount(localFoldersAcctKey);</span>
<a href="#l16.923"></a><span id="l16.923" class="difflineminus">-        }</span>
<a href="#l16.924"></a><span id="l16.924"> </span>
<a href="#l16.925"></a><span id="l16.925" class="difflineminus">-        pBytesTemp = nsOERegUtil::GetValueBytes(hKey, &quot;POP3 Skip Account&quot;);</span>
<a href="#l16.926"></a><span id="l16.926" class="difflineminus">-        if (pBytesTemp)</span>
<a href="#l16.927"></a><span id="l16.927" class="difflineminus">-        {</span>
<a href="#l16.928"></a><span id="l16.928" class="difflineminus">-        // OE:0=='Include this account when receiving mail or synchronizing'==</span>
<a href="#l16.929"></a><span id="l16.929" class="difflineminus">-        // TB:1==AM:Server:advanced:Include this server when getting new mail</span>
<a href="#l16.930"></a><span id="l16.930" class="difflineminus">-          pop3Server-&gt;SetDeferGetNewMail(*pBytesTemp == 0);</span>
<a href="#l16.931"></a><span id="l16.931" class="difflineminus">-          nsOERegUtil::FreeValueBytes(pBytesTemp);</span>
<a href="#l16.932"></a><span id="l16.932" class="difflineminus">-        }</span>
<a href="#l16.933"></a><span id="l16.933" class="difflineminus">-        else</span>
<a href="#l16.934"></a><span id="l16.934" class="difflineminus">-          pop3Server-&gt;SetDeferGetNewMail(PR_FALSE);</span>
<a href="#l16.935"></a><span id="l16.935" class="difflineminus">-        pBytesTemp = nsOERegUtil::GetValueBytes(hKey, &quot;Leave Mail On Server&quot;);</span>
<a href="#l16.936"></a><span id="l16.936" class="difflineminus">-        if (pBytesTemp)</span>
<a href="#l16.937"></a><span id="l16.937" class="difflineminus">-        {</span>
<a href="#l16.938"></a><span id="l16.938" class="difflineminus">-          pop3Server-&gt;SetLeaveMessagesOnServer(*pBytesTemp == 1);</span>
<a href="#l16.939"></a><span id="l16.939" class="difflineminus">-          nsOERegUtil::FreeValueBytes(pBytesTemp);</span>
<a href="#l16.940"></a><span id="l16.940" class="difflineplus">+      // set local folders as the Inbox to use for this POP3 server</span>
<a href="#l16.941"></a><span id="l16.941" class="difflineplus">+      nsCOMPtr&lt;nsIMsgIncomingServer&gt; localFoldersServer;</span>
<a href="#l16.942"></a><span id="l16.942" class="difflineplus">+      pMgr-&gt;GetLocalFoldersServer(getter_AddRefs(localFoldersServer));</span>
<a href="#l16.943"></a><span id="l16.943" class="difflineplus">+      if (!localFoldersServer) {</span>
<a href="#l16.944"></a><span id="l16.944" class="difflineplus">+        // XXX: We may need to move this local folder creation</span>
<a href="#l16.945"></a><span id="l16.945" class="difflineplus">+        // code to the generic nsImportSettings code</span>
<a href="#l16.946"></a><span id="l16.946" class="difflineplus">+        // if the other import modules end up needing to do this too.</span>
<a href="#l16.947"></a><span id="l16.947" class="difflineplus">+        // if Local Folders does not exist already, create it</span>
<a href="#l16.948"></a><span id="l16.948" class="difflineplus">+        rv = pMgr-&gt;CreateLocalMailAccount();</span>
<a href="#l16.949"></a><span id="l16.949" class="difflineplus">+        if (NS_FAILED(rv)) {</span>
<a href="#l16.950"></a><span id="l16.950" class="difflineplus">+          IMPORT_LOG0(&quot;*** Failed to create Local Folders!\n&quot;);</span>
<a href="#l16.951"></a><span id="l16.951" class="difflineplus">+          return PR_FALSE;</span>
<a href="#l16.952"></a><span id="l16.952">         }</span>
<a href="#l16.953"></a><span id="l16.953" class="difflineminus">-        pBytesTemp = nsOERegUtil::GetValueBytes(hKey, &quot;Remove When Deleted&quot;);</span>
<a href="#l16.954"></a><span id="l16.954" class="difflineminus">-        if (pBytesTemp)</span>
<a href="#l16.955"></a><span id="l16.955" class="difflineminus">-        {</span>
<a href="#l16.956"></a><span id="l16.956" class="difflineminus">-          pop3Server-&gt;SetDeleteMailLeftOnServer(*pBytesTemp == 1);</span>
<a href="#l16.957"></a><span id="l16.957" class="difflineminus">-          nsOERegUtil::FreeValueBytes(pBytesTemp);</span>
<a href="#l16.958"></a><span id="l16.958" class="difflineminus">-        }</span>
<a href="#l16.959"></a><span id="l16.959" class="difflineminus">-        pBytesTemp = nsOERegUtil::GetValueBytes(hKey, &quot;Remove When Expired&quot;);</span>
<a href="#l16.960"></a><span id="l16.960" class="difflineminus">-        if (pBytesTemp)</span>
<a href="#l16.961"></a><span id="l16.961" class="difflineminus">-        {</span>
<a href="#l16.962"></a><span id="l16.962" class="difflineminus">-          pop3Server-&gt;SetDeleteByAgeFromServer(*pBytesTemp == 1);</span>
<a href="#l16.963"></a><span id="l16.963" class="difflineminus">-          nsOERegUtil::FreeValueBytes(pBytesTemp);</span>
<a href="#l16.964"></a><span id="l16.964" class="difflineminus">-        }</span>
<a href="#l16.965"></a><span id="l16.965" class="difflineminus">-        pBytesTemp = nsOERegUtil::GetValueBytes(hKey, &quot;Expire Days&quot;);</span>
<a href="#l16.966"></a><span id="l16.966" class="difflineminus">-        if (pBytesTemp)</span>
<a href="#l16.967"></a><span id="l16.967" class="difflineminus">-        {</span>
<a href="#l16.968"></a><span id="l16.968" class="difflineminus">-          pop3Server-&gt;SetNumDaysToLeaveOnServer(*(PRInt32*)pBytesTemp );</span>
<a href="#l16.969"></a><span id="l16.969" class="difflineminus">-          nsOERegUtil::FreeValueBytes(pBytesTemp);</span>
<a href="#l16.970"></a><span id="l16.970" class="difflineminus">-        }</span>
<a href="#l16.971"></a><span id="l16.971" class="difflineplus">+        pMgr-&gt;GetLocalFoldersServer(getter_AddRefs(localFoldersServer));</span>
<a href="#l16.972"></a><span id="l16.972">       }</span>
<a href="#l16.973"></a><span id="l16.973" class="difflineminus">-      IMPORT_LOG2(&quot;Created POP3 server named: %s, userName: %s\n&quot;,</span>
<a href="#l16.974"></a><span id="l16.974" class="difflineminus">-                   pServerName, pUserName);</span>
<a href="#l16.975"></a><span id="l16.975" class="difflineminus">-      nsString prettyName;</span>
<a href="#l16.976"></a><span id="l16.976" class="difflineminus">-      if (NS_SUCCEEDED(GetAccountName(hKey, pServerName, prettyName)))</span>
<a href="#l16.977"></a><span id="l16.977" class="difflineminus">-        rv = in-&gt;SetPrettyName( prettyName);</span>
<a href="#l16.978"></a><span id="l16.978" class="difflineplus">+</span>
<a href="#l16.979"></a><span id="l16.979" class="difflineplus">+      // now get the account for this server</span>
<a href="#l16.980"></a><span id="l16.980" class="difflineplus">+      nsCOMPtr&lt;nsIMsgAccount&gt; localFoldersAccount;</span>
<a href="#l16.981"></a><span id="l16.981" class="difflineplus">+      pMgr-&gt;FindAccountForServer(localFoldersServer,</span>
<a href="#l16.982"></a><span id="l16.982" class="difflineplus">+                                 getter_AddRefs(localFoldersAccount));</span>
<a href="#l16.983"></a><span id="l16.983" class="difflineplus">+      if (localFoldersAccount) {</span>
<a href="#l16.984"></a><span id="l16.984" class="difflineplus">+        nsCString localFoldersAcctKey;</span>
<a href="#l16.985"></a><span id="l16.985" class="difflineplus">+        localFoldersAccount-&gt;GetKey(localFoldersAcctKey);</span>
<a href="#l16.986"></a><span id="l16.986" class="difflineplus">+        pop3Server-&gt;SetDeferredToAccount(localFoldersAcctKey);</span>
<a href="#l16.987"></a><span id="l16.987" class="difflineplus">+      }</span>
<a href="#l16.988"></a><span id="l16.988" class="difflineplus">+</span>
<a href="#l16.989"></a><span id="l16.989" class="difflineplus">+      IMPORT_LOG2(&quot;Created POP3 server named: %S, userName: %S\n&quot;,</span>
<a href="#l16.990"></a><span id="l16.990" class="difflineplus">+                  serverName.get(), userName.get());</span>
<a href="#l16.991"></a><span id="l16.991"> </span>
<a href="#l16.992"></a><span id="l16.992">       // We have a server, create an account.</span>
<a href="#l16.993"></a><span id="l16.993" class="difflineminus">-      nsCOMPtr&lt;nsIMsgAccount&gt;  account;</span>
<a href="#l16.994"></a><span id="l16.994" class="difflineminus">-      rv = pMgr-&gt;CreateAccount(getter_AddRefs( account));</span>
<a href="#l16.995"></a><span id="l16.995" class="difflineminus">-      if (NS_SUCCEEDED( rv) &amp;&amp; account) {</span>
<a href="#l16.996"></a><span id="l16.996" class="difflineplus">+      nsCOMPtr&lt;nsIMsgAccount&gt; account;</span>
<a href="#l16.997"></a><span id="l16.997" class="difflineplus">+      rv = pMgr-&gt;CreateAccount(getter_AddRefs(account));</span>
<a href="#l16.998"></a><span id="l16.998" class="difflineplus">+      if (NS_SUCCEEDED(rv) &amp;&amp; account) {</span>
<a href="#l16.999"></a><span id="l16.999">         rv = account-&gt;SetIncomingServer(in);</span>
<a href="#l16.1000"></a><span id="l16.1000" class="difflineminus">-        IMPORT_LOG0(&quot;Created a new account and set the incoming server to the POP3 server.\n&quot;);</span>
<a href="#l16.1001"></a><span id="l16.1001" class="difflineplus">+        IMPORT_LOG0(&quot;Created a new account and set the incoming &quot;</span>
<a href="#l16.1002"></a><span id="l16.1002" class="difflineplus">+                    &quot;server to the POP3 server.\n&quot;);</span>
<a href="#l16.1003"></a><span id="l16.1003"> </span>
<a href="#l16.1004"></a><span id="l16.1004">         // Fiddle with the identities</span>
<a href="#l16.1005"></a><span id="l16.1005" class="difflineminus">-        SetIdentities(pMgr, account, hKey, pUserName, authMethod, PR_FALSE);</span>
<a href="#l16.1006"></a><span id="l16.1006" class="difflineplus">+        SetIdentities(pMgr, account, xmlDoc, userName, authMethod, PR_FALSE);</span>
<a href="#l16.1007"></a><span id="l16.1007">         result = PR_TRUE;</span>
<a href="#l16.1008"></a><span id="l16.1008">         if (ppAccount)</span>
<a href="#l16.1009"></a><span id="l16.1009" class="difflineminus">-          account-&gt;QueryInterface(NS_GET_IID(nsIMsgAccount),</span>
<a href="#l16.1010"></a><span id="l16.1010" class="difflineminus">-                                   (void **)ppAccount);</span>
<a href="#l16.1011"></a><span id="l16.1011" class="difflineplus">+          account.forget(ppAccount);</span>
<a href="#l16.1012"></a><span id="l16.1012">       }</span>
<a href="#l16.1013"></a><span id="l16.1013">     }</span>
<a href="#l16.1014"></a><span id="l16.1014" class="difflineminus">-  } </span>
<a href="#l16.1015"></a><span id="l16.1015" class="difflineplus">+  }</span>
<a href="#l16.1016"></a><span id="l16.1016">   else if (NS_SUCCEEDED(rv) &amp;&amp; in) {</span>
<a href="#l16.1017"></a><span id="l16.1017" class="difflineminus">-    IMPORT_LOG2(&quot;Existing POP3 server named: %s, userName: %s\n&quot;,</span>
<a href="#l16.1018"></a><span id="l16.1018" class="difflineminus">-                pServerName, pUserName);</span>
<a href="#l16.1019"></a><span id="l16.1019" class="difflineplus">+    IMPORT_LOG2(&quot;Existing POP3 server named: %S, userName: %S\n&quot;,</span>
<a href="#l16.1020"></a><span id="l16.1020" class="difflineplus">+                serverName.get(), userName.get());</span>
<a href="#l16.1021"></a><span id="l16.1021">     // for an existing server we create another identity,</span>
<a href="#l16.1022"></a><span id="l16.1022">     // TB listed under 'manage identities'</span>
<a href="#l16.1023"></a><span id="l16.1023">     nsCOMPtr&lt;nsIMsgAccount&gt;  account;</span>
<a href="#l16.1024"></a><span id="l16.1024" class="difflineminus">-    rv = pMgr-&gt;FindAccountForServer(in, getter_AddRefs( account));</span>
<a href="#l16.1025"></a><span id="l16.1025" class="difflineplus">+    rv = pMgr-&gt;FindAccountForServer(in, getter_AddRefs(account));</span>
<a href="#l16.1026"></a><span id="l16.1026">     if (NS_SUCCEEDED(rv) &amp;&amp; account) {</span>
<a href="#l16.1027"></a><span id="l16.1027">       IMPORT_LOG0(&quot;Created identity and added to existing POP3 incoming server.\n&quot;);</span>
<a href="#l16.1028"></a><span id="l16.1028">       // Fiddle with the identities</span>
<a href="#l16.1029"></a><span id="l16.1029">       in-&gt;GetAuthMethod(&amp;authMethod);</span>
<a href="#l16.1030"></a><span id="l16.1030" class="difflineminus">-      SetIdentities(pMgr, account, hKey, pUserName, authMethod, PR_FALSE);</span>
<a href="#l16.1031"></a><span id="l16.1031" class="difflineplus">+      SetIdentities(pMgr, account, xmlDoc, userName, authMethod, PR_FALSE);</span>
<a href="#l16.1032"></a><span id="l16.1032">       result = PR_TRUE;</span>
<a href="#l16.1033"></a><span id="l16.1033">       if (ppAccount)</span>
<a href="#l16.1034"></a><span id="l16.1034" class="difflineminus">-        account-&gt;QueryInterface(NS_GET_IID(nsIMsgAccount), (void **)ppAccount);</span>
<a href="#l16.1035"></a><span id="l16.1035" class="difflineplus">+        account.forget(ppAccount);</span>
<a href="#l16.1036"></a><span id="l16.1036">     }</span>
<a href="#l16.1037"></a><span id="l16.1037">   }</span>
<a href="#l16.1038"></a><span id="l16.1038">   else</span>
<a href="#l16.1039"></a><span id="l16.1039">     result = PR_TRUE;</span>
<a href="#l16.1040"></a><span id="l16.1040" class="difflineminus">-  nsOERegUtil::FreeValueBytes((BYTE *) pUserName);</span>
<a href="#l16.1041"></a><span id="l16.1041">   return result;</span>
<a href="#l16.1042"></a><span id="l16.1042"> }</span>
<a href="#l16.1043"></a><span id="l16.1043"> </span>
<a href="#l16.1044"></a><span id="l16.1044" class="difflineminus">-PRBool OESettings::DoNNTPServer( nsIMsgAccountManager *pMgr, HKEY hKey,</span>
<a href="#l16.1045"></a><span id="l16.1045" class="difflineminus">-                                char *pServerName, nsIMsgAccount **ppAccount)</span>
<a href="#l16.1046"></a><span id="l16.1046" class="difflineplus">+PRBool WMSettings::DoNNTPServer(nsIMsgAccountManager *pMgr,</span>
<a href="#l16.1047"></a><span id="l16.1047" class="difflineplus">+                                nsIDOMDocument *xmlDoc,</span>
<a href="#l16.1048"></a><span id="l16.1048" class="difflineplus">+                                const nsString&amp; serverName,</span>
<a href="#l16.1049"></a><span id="l16.1049" class="difflineplus">+                                nsIMsgAccount **ppAccount)</span>
<a href="#l16.1050"></a><span id="l16.1050"> {</span>
<a href="#l16.1051"></a><span id="l16.1051" class="difflineplus">+  PRBool authMethod;</span>
<a href="#l16.1052"></a><span id="l16.1052" class="difflineplus">+  PRInt32 errorCode;</span>
<a href="#l16.1053"></a><span id="l16.1053">   if (ppAccount)</span>
<a href="#l16.1054"></a><span id="l16.1054">     *ppAccount = nsnull;</span>
<a href="#l16.1055"></a><span id="l16.1055"> </span>
<a href="#l16.1056"></a><span id="l16.1056" class="difflineminus">-  char * pUserName;</span>
<a href="#l16.1057"></a><span id="l16.1057" class="difflineminus">-  // this only exists if NNTP server requires it or not anon login</span>
<a href="#l16.1058"></a><span id="l16.1058" class="difflineminus">-  pUserName = (char *)nsOERegUtil::GetValueBytes(hKey, &quot;NNTP User Name&quot;);</span>
<a href="#l16.1059"></a><span id="l16.1059" class="difflineminus">-</span>
<a href="#l16.1060"></a><span id="l16.1060" class="difflineplus">+  nsAutoString userName, value;</span>
<a href="#l16.1061"></a><span id="l16.1061" class="difflineplus">+  // this only exists if NNTP server requires it or not, anonymous login</span>
<a href="#l16.1062"></a><span id="l16.1062" class="difflineplus">+  GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;NNTP_User_Name&quot;), userName);</span>
<a href="#l16.1063"></a><span id="l16.1063">   PRBool result = PR_FALSE;</span>
<a href="#l16.1064"></a><span id="l16.1064"> </span>
<a href="#l16.1065"></a><span id="l16.1065">   // I now have a user name/server name pair, find out if it already exists?</span>
<a href="#l16.1066"></a><span id="l16.1066">   // NNTP can have empty user name.  This is wild card in findserver</span>
<a href="#l16.1067"></a><span id="l16.1067">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; in;</span>
<a href="#l16.1068"></a><span id="l16.1068">   nsresult rv = pMgr-&gt;FindServer(EmptyCString(),</span>
<a href="#l16.1069"></a><span id="l16.1069" class="difflineminus">-                                 nsDependentCString(pServerName),</span>
<a href="#l16.1070"></a><span id="l16.1070" class="difflineminus">-                                 NS_LITERAL_CSTRING(&quot;nntp&quot;),</span>
<a href="#l16.1071"></a><span id="l16.1071" class="difflineminus">-                                 getter_AddRefs(in));</span>
<a href="#l16.1072"></a><span id="l16.1072" class="difflineminus">-  if (NS_FAILED( rv) || (in == nsnull)) {</span>
<a href="#l16.1073"></a><span id="l16.1073" class="difflineplus">+                         NS_ConvertUTF16toUTF8(serverName),</span>
<a href="#l16.1074"></a><span id="l16.1074" class="difflineplus">+                         NS_LITERAL_CSTRING(&quot;nntp&quot;),</span>
<a href="#l16.1075"></a><span id="l16.1075" class="difflineplus">+                         getter_AddRefs(in));</span>
<a href="#l16.1076"></a><span id="l16.1076" class="difflineplus">+  if (NS_FAILED(rv) || (in == nsnull)) {</span>
<a href="#l16.1077"></a><span id="l16.1077">     // Create the incoming server and an account for it?</span>
<a href="#l16.1078"></a><span id="l16.1078" class="difflineminus">-    rv = pMgr-&gt;CreateIncomingServer(EmptyCString(),</span>
<a href="#l16.1079"></a><span id="l16.1079" class="difflineminus">-                                    nsDependentCString(pServerName),</span>
<a href="#l16.1080"></a><span id="l16.1080" class="difflineplus">+    rv = pMgr-&gt;CreateIncomingServer(nsDependentCString(&quot;&quot;),</span>
<a href="#l16.1081"></a><span id="l16.1081" class="difflineplus">+                                    NS_ConvertUTF16toUTF8(serverName),</span>
<a href="#l16.1082"></a><span id="l16.1082">                                     NS_LITERAL_CSTRING(&quot;nntp&quot;),</span>
<a href="#l16.1083"></a><span id="l16.1083">                                     getter_AddRefs(in));</span>
<a href="#l16.1084"></a><span id="l16.1084" class="difflineminus">-    if (NS_SUCCEEDED( rv) &amp;&amp; in) {</span>
<a href="#l16.1085"></a><span id="l16.1085" class="difflineminus">-      BYTE * pBytesTemp = nsOERegUtil::GetValueBytes(hKey, &quot;NNTP Port&quot;);</span>
<a href="#l16.1086"></a><span id="l16.1086" class="difflineminus">-      if (pBytesTemp &amp;&amp; *(PRInt32 *)pBytesTemp != 119)</span>
<a href="#l16.1087"></a><span id="l16.1087" class="difflineminus">-        in-&gt;SetPort(*(PRInt32 *) pBytesTemp);</span>
<a href="#l16.1088"></a><span id="l16.1088" class="difflineminus">-      nsOERegUtil::FreeValueBytes(pBytesTemp);</span>
<a href="#l16.1089"></a><span id="l16.1089" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; in) {</span>
<a href="#l16.1090"></a><span id="l16.1090"> </span>
<a href="#l16.1091"></a><span id="l16.1091" class="difflineminus">-      // do nntpincomingserver stuff</span>
<a href="#l16.1092"></a><span id="l16.1092">       nsCOMPtr&lt;nsINntpIncomingServer&gt; nntpServer = do_QueryInterface(in);</span>
<a href="#l16.1093"></a><span id="l16.1093" class="difflineminus">-      if (nntpServer &amp;&amp; pUserName &amp;&amp; *pUserName) {</span>
<a href="#l16.1094"></a><span id="l16.1094" class="difflineplus">+      if (!nntpServer) {</span>
<a href="#l16.1095"></a><span id="l16.1095" class="difflineplus">+        IMPORT_LOG1(&quot;*** Failed to create nsINnntpIncomingServer for %S!\n&quot;,</span>
<a href="#l16.1096"></a><span id="l16.1096" class="difflineplus">+          serverName.get());</span>
<a href="#l16.1097"></a><span id="l16.1097" class="difflineplus">+        return PR_FALSE;</span>
<a href="#l16.1098"></a><span id="l16.1098" class="difflineplus">+      }</span>
<a href="#l16.1099"></a><span id="l16.1099" class="difflineplus">+      if (!userName.IsEmpty()) {  // if username req'd then auth req'd</span>
<a href="#l16.1100"></a><span id="l16.1100">         nntpServer-&gt;SetPushAuth(PR_TRUE);</span>
<a href="#l16.1101"></a><span id="l16.1101" class="difflineminus">-        in-&gt;SetUsername(nsDependentCString(pUserName));</span>
<a href="#l16.1102"></a><span id="l16.1102" class="difflineplus">+        in-&gt;SetUsername(NS_ConvertUTF16toUTF8(userName));</span>
<a href="#l16.1103"></a><span id="l16.1103">       }</span>
<a href="#l16.1104"></a><span id="l16.1104"> </span>
<a href="#l16.1105"></a><span id="l16.1105" class="difflineminus">-      IMPORT_LOG2(&quot;Created NNTP server named: %s, userName: %s\n&quot;,</span>
<a href="#l16.1106"></a><span id="l16.1106" class="difflineminus">-                   pServerName, pUserName? pUserName : &quot;&quot;);</span>
<a href="#l16.1107"></a><span id="l16.1107" class="difflineplus">+      nsAutoString value;</span>
<a href="#l16.1108"></a><span id="l16.1108" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;NNTP_Port&quot;), value);</span>
<a href="#l16.1109"></a><span id="l16.1109" class="difflineplus">+      if (!value.IsEmpty()) {</span>
<a href="#l16.1110"></a><span id="l16.1110" class="difflineplus">+        in-&gt;SetPort(value.ToInteger(&amp;errorCode, 16));</span>
<a href="#l16.1111"></a><span id="l16.1111" class="difflineplus">+      }</span>
<a href="#l16.1112"></a><span id="l16.1112"> </span>
<a href="#l16.1113"></a><span id="l16.1113" class="difflineminus">-      nsString prettyName;</span>
<a href="#l16.1114"></a><span id="l16.1114" class="difflineminus">-      if (NS_SUCCEEDED(GetAccountName(hKey, pServerName, prettyName)))</span>
<a href="#l16.1115"></a><span id="l16.1115" class="difflineminus">-        rv = in-&gt;SetPrettyName(prettyName);</span>
<a href="#l16.1116"></a><span id="l16.1116" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;Account_Name&quot;), value);</span>
<a href="#l16.1117"></a><span id="l16.1117" class="difflineplus">+      if (!value.IsEmpty()) {</span>
<a href="#l16.1118"></a><span id="l16.1118" class="difflineplus">+        in-&gt;SetPrettyName(value);</span>
<a href="#l16.1119"></a><span id="l16.1119" class="difflineplus">+      }</span>
<a href="#l16.1120"></a><span id="l16.1120" class="difflineplus">+</span>
<a href="#l16.1121"></a><span id="l16.1121" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;NNTP_Use_Sicily&quot;), value);</span>
<a href="#l16.1122"></a><span id="l16.1122" class="difflineplus">+      PRBool secAuth = (PRBool)value.ToInteger(&amp;errorCode, 16);</span>
<a href="#l16.1123"></a><span id="l16.1123" class="difflineplus">+      authMethod = secAuth ? nsMsgAuthMethod::secure :</span>
<a href="#l16.1124"></a><span id="l16.1124" class="difflineplus">+                             nsMsgAuthMethod::passwordCleartext;</span>
<a href="#l16.1125"></a><span id="l16.1125" class="difflineplus">+      in-&gt;SetAuthMethod(authMethod);</span>
<a href="#l16.1126"></a><span id="l16.1126" class="difflineplus">+</span>
<a href="#l16.1127"></a><span id="l16.1127" class="difflineplus">+      IMPORT_LOG2(&quot;Created NNTP server named: %S, userName: %S\n&quot;,</span>
<a href="#l16.1128"></a><span id="l16.1128" class="difflineplus">+                  serverName.get(), userName.get());</span>
<a href="#l16.1129"></a><span id="l16.1129"> </span>
<a href="#l16.1130"></a><span id="l16.1130">       // We have a server, create an account.</span>
<a href="#l16.1131"></a><span id="l16.1131">       nsCOMPtr&lt;nsIMsgAccount&gt; account;</span>
<a href="#l16.1132"></a><span id="l16.1132" class="difflineminus">-      rv = pMgr-&gt;CreateAccount(getter_AddRefs( account));</span>
<a href="#l16.1133"></a><span id="l16.1133" class="difflineplus">+      rv = pMgr-&gt;CreateAccount(getter_AddRefs(account));</span>
<a href="#l16.1134"></a><span id="l16.1134">       if (NS_SUCCEEDED(rv) &amp;&amp; account) {</span>
<a href="#l16.1135"></a><span id="l16.1135">         rv = account-&gt;SetIncomingServer(in);</span>
<a href="#l16.1136"></a><span id="l16.1136"> </span>
<a href="#l16.1137"></a><span id="l16.1137" class="difflineminus">-        IMPORT_LOG0(&quot;Created an account and set the NNTP server as the incoming server\n&quot;);</span>
<a href="#l16.1138"></a><span id="l16.1138" class="difflineplus">+        IMPORT_LOG0(&quot;Created an account and set the NNTP server &quot;</span>
<a href="#l16.1139"></a><span id="l16.1139" class="difflineplus">+                    &quot;as the incoming server\n&quot;);</span>
<a href="#l16.1140"></a><span id="l16.1140"> </span>
<a href="#l16.1141"></a><span id="l16.1141">         // Fiddle with the identities</span>
<a href="#l16.1142"></a><span id="l16.1142" class="difflineminus">-        SetIdentities(pMgr, account, hKey, pUserName, 0, PR_TRUE);</span>
<a href="#l16.1143"></a><span id="l16.1143" class="difflineplus">+        SetIdentities(pMgr, account, xmlDoc, userName, authMethod, PR_TRUE);</span>
<a href="#l16.1144"></a><span id="l16.1144">         result = PR_TRUE;</span>
<a href="#l16.1145"></a><span id="l16.1145">         if (ppAccount)</span>
<a href="#l16.1146"></a><span id="l16.1146" class="difflineminus">-          account-&gt;QueryInterface(NS_GET_IID(nsIMsgAccount), (void **)ppAccount);</span>
<a href="#l16.1147"></a><span id="l16.1147" class="difflineplus">+          account.forget(ppAccount);</span>
<a href="#l16.1148"></a><span id="l16.1148">       }</span>
<a href="#l16.1149"></a><span id="l16.1149">     }</span>
<a href="#l16.1150"></a><span id="l16.1150">   }</span>
<a href="#l16.1151"></a><span id="l16.1151">   else if (NS_SUCCEEDED(rv) &amp;&amp; in) {</span>
<a href="#l16.1152"></a><span id="l16.1152">     // for the existing server...</span>
<a href="#l16.1153"></a><span id="l16.1153">     nsCOMPtr&lt;nsIMsgAccount&gt; account;</span>
<a href="#l16.1154"></a><span id="l16.1154" class="difflineminus">-    rv = pMgr-&gt;FindAccountForServer(in, getter_AddRefs( account));</span>
<a href="#l16.1155"></a><span id="l16.1155" class="difflineminus">-    if (NS_SUCCEEDED( rv) &amp;&amp; account) {</span>
<a href="#l16.1156"></a><span id="l16.1156" class="difflineminus">-      IMPORT_LOG0(&quot;Using existing account and set the NNTP server as the incoming server\n&quot;);</span>
<a href="#l16.1157"></a><span id="l16.1157" class="difflineplus">+    rv = pMgr-&gt;FindAccountForServer(in, getter_AddRefs(account));</span>
<a href="#l16.1158"></a><span id="l16.1158" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; account) {</span>
<a href="#l16.1159"></a><span id="l16.1159" class="difflineplus">+      IMPORT_LOG0(&quot;Using existing account and set the &quot;</span>
<a href="#l16.1160"></a><span id="l16.1160" class="difflineplus">+                  &quot;NNTP server as the incoming server\n&quot;);</span>
<a href="#l16.1161"></a><span id="l16.1161">       // Fiddle with the identities</span>
<a href="#l16.1162"></a><span id="l16.1162" class="difflineminus">-      SetIdentities(pMgr, account, hKey, pUserName, 0, PR_TRUE);</span>
<a href="#l16.1163"></a><span id="l16.1163" class="difflineplus">+      in-&gt;GetAuthMethod(&amp;authMethod);</span>
<a href="#l16.1164"></a><span id="l16.1164" class="difflineplus">+      SetIdentities(pMgr, account, xmlDoc, userName, authMethod, PR_TRUE);</span>
<a href="#l16.1165"></a><span id="l16.1165">       result = PR_TRUE;</span>
<a href="#l16.1166"></a><span id="l16.1166">       if (ppAccount)</span>
<a href="#l16.1167"></a><span id="l16.1167" class="difflineminus">-        account-&gt;QueryInterface(NS_GET_IID(nsIMsgAccount),</span>
<a href="#l16.1168"></a><span id="l16.1168" class="difflineminus">-                                 (void **)ppAccount);</span>
<a href="#l16.1169"></a><span id="l16.1169" class="difflineplus">+        account.forget(ppAccount);</span>
<a href="#l16.1170"></a><span id="l16.1170">     }</span>
<a href="#l16.1171"></a><span id="l16.1171">   }</span>
<a href="#l16.1172"></a><span id="l16.1172">   else</span>
<a href="#l16.1173"></a><span id="l16.1173">     result = PR_TRUE;</span>
<a href="#l16.1174"></a><span id="l16.1174" class="difflineminus">-  nsOERegUtil::FreeValueBytes((BYTE *) pUserName);</span>
<a href="#l16.1175"></a><span id="l16.1175">   return result;</span>
<a href="#l16.1176"></a><span id="l16.1176"> }</span>
<a href="#l16.1177"></a><span id="l16.1177"> </span>
<a href="#l16.1178"></a><span id="l16.1178" class="difflineminus">-void OESettings::SetIdentities(nsIMsgAccountManager *pMgr, nsIMsgAccount *pAcc,</span>
<a href="#l16.1179"></a><span id="l16.1179" class="difflineminus">-                               HKEY hKey, char *pIncomgUserName,</span>
<a href="#l16.1180"></a><span id="l16.1180" class="difflineplus">+void WMSettings::SetIdentities(nsIMsgAccountManager *pMgr, nsIMsgAccount *pAcc,</span>
<a href="#l16.1181"></a><span id="l16.1181" class="difflineplus">+                               nsIDOMDocument *xmlDoc, nsAutoString &amp;inUserName,</span>
<a href="#l16.1182"></a><span id="l16.1182">                                PRInt32 authMethodIncoming, PRBool isNNTP )</span>
<a href="#l16.1183"></a><span id="l16.1183"> {</span>
<a href="#l16.1184"></a><span id="l16.1184">   // Get the relevant information for an identity</span>
<a href="#l16.1185"></a><span id="l16.1185" class="difflineminus">-  char *pSmtpServer = (char *)nsOERegUtil::GetValueBytes(hKey, &quot;SMTP Server&quot;);</span>
<a href="#l16.1186"></a><span id="l16.1186" class="difflineminus">-  char *pName = (char *)nsOERegUtil::GetValueBytes(hKey, isNNTP ? &quot;NNTP Display Name&quot; : &quot;SMTP Display Name&quot;);</span>
<a href="#l16.1187"></a><span id="l16.1187" class="difflineminus">-  char *pEmail = (char *)nsOERegUtil::GetValueBytes(hKey, isNNTP ? &quot;NNTP Email Address&quot; : &quot;SMTP Email Address&quot;);</span>
<a href="#l16.1188"></a><span id="l16.1188" class="difflineminus">-  char *pReply = (char *)nsOERegUtil::GetValueBytes(hKey, isNNTP ? &quot;NNTP Reply To Email Address&quot; : &quot;SMTP Reply To Email Address&quot;);</span>
<a href="#l16.1189"></a><span id="l16.1189" class="difflineminus">-  char *pOrgName = (char *)nsOERegUtil::GetValueBytes(hKey, isNNTP ? &quot;NNTP Organization Name&quot; : &quot;SMTP Organization Name&quot;);</span>
<a href="#l16.1190"></a><span id="l16.1190" class="difflineminus">-</span>
<a href="#l16.1191"></a><span id="l16.1191" class="difflineplus">+  // BUG 470587. Don't set this: id-&gt;SetIdentityName(fullName);</span>
<a href="#l16.1192"></a><span id="l16.1192">   nsresult rv;</span>
<a href="#l16.1193"></a><span id="l16.1193" class="difflineplus">+  nsAutoString value;</span>
<a href="#l16.1194"></a><span id="l16.1194"> </span>
<a href="#l16.1195"></a><span id="l16.1195" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIdentity&gt; id;</span>
<a href="#l16.1196"></a><span id="l16.1196" class="difflineminus">-    rv = pMgr-&gt;CreateIdentity(getter_AddRefs(id));</span>
<a href="#l16.1197"></a><span id="l16.1197" class="difflineminus">-    if (id) {</span>
<a href="#l16.1198"></a><span id="l16.1198" class="difflineminus">-      nsAutoString fullName, organization;</span>
<a href="#l16.1199"></a><span id="l16.1199" class="difflineminus">-      rv = nsMsgI18NConvertToUnicode(nsMsgI18NFileSystemCharset(),</span>
<a href="#l16.1200"></a><span id="l16.1200" class="difflineminus">-                                     nsCString(pName), fullName);</span>
<a href="#l16.1201"></a><span id="l16.1201" class="difflineminus">-      if (NS_SUCCEEDED(rv))</span>
<a href="#l16.1202"></a><span id="l16.1202" class="difflineminus">-        id-&gt;SetFullName(fullName);</span>
<a href="#l16.1203"></a><span id="l16.1203" class="difflineminus">-// BUG 470587. Don't set this: id-&gt;SetIdentityName(fullName);</span>
<a href="#l16.1204"></a><span id="l16.1204" class="difflineplus">+  nsCOMPtr&lt;nsIMsgIdentity&gt; id;</span>
<a href="#l16.1205"></a><span id="l16.1205" class="difflineplus">+  rv = pMgr-&gt;CreateIdentity(getter_AddRefs(id));</span>
<a href="#l16.1206"></a><span id="l16.1206" class="difflineplus">+  if (id) {</span>
<a href="#l16.1207"></a><span id="l16.1207" class="difflineplus">+    IMPORT_LOG0(&quot;Created identity and added to the account\n&quot;);</span>
<a href="#l16.1208"></a><span id="l16.1208" class="difflineplus">+    GetValueForTag(xmlDoc, isNNTP ?</span>
<a href="#l16.1209"></a><span id="l16.1209" class="difflineplus">+      NS_LITERAL_STRING(&quot;NNTP_Display_Name&quot;) :</span>
<a href="#l16.1210"></a><span id="l16.1210" class="difflineplus">+      NS_LITERAL_STRING(&quot;SMTP_Display_Name&quot;), value);</span>
<a href="#l16.1211"></a><span id="l16.1211" class="difflineplus">+    id-&gt;SetFullName(value);</span>
<a href="#l16.1212"></a><span id="l16.1212" class="difflineplus">+    IMPORT_LOG1(&quot;\tname: %S\n&quot;, value.get());</span>
<a href="#l16.1213"></a><span id="l16.1213"> </span>
<a href="#l16.1214"></a><span id="l16.1214" class="difflineminus">-      rv = nsMsgI18NConvertToUnicode(nsMsgI18NFileSystemCharset(),</span>
<a href="#l16.1215"></a><span id="l16.1215" class="difflineminus">-                                     nsCString(pOrgName), organization);</span>
<a href="#l16.1216"></a><span id="l16.1216" class="difflineminus">-      if (NS_SUCCEEDED(rv))</span>
<a href="#l16.1217"></a><span id="l16.1217" class="difflineminus">-        id-&gt;SetOrganization(organization);</span>
<a href="#l16.1218"></a><span id="l16.1218" class="difflineminus">-</span>
<a href="#l16.1219"></a><span id="l16.1219" class="difflineminus">-      id-&gt;SetEmail(nsCString(pEmail));</span>
<a href="#l16.1220"></a><span id="l16.1220" class="difflineminus">-      if (pReply)</span>
<a href="#l16.1221"></a><span id="l16.1221" class="difflineminus">-        id-&gt;SetReplyTo(nsCString(pReply));</span>
<a href="#l16.1222"></a><span id="l16.1222" class="difflineplus">+    GetValueForTag(xmlDoc, isNNTP ?</span>
<a href="#l16.1223"></a><span id="l16.1223" class="difflineplus">+      NS_LITERAL_STRING(&quot;NNTP_Organization_Name&quot;) :</span>
<a href="#l16.1224"></a><span id="l16.1224" class="difflineplus">+      NS_LITERAL_STRING(&quot;SMTP_Organization_Name&quot;), value);</span>
<a href="#l16.1225"></a><span id="l16.1225" class="difflineplus">+    id-&gt;SetOrganization(value);</span>
<a href="#l16.1226"></a><span id="l16.1226"> </span>
<a href="#l16.1227"></a><span id="l16.1227" class="difflineminus">-      // Outlook Express users are used to top style quoting.</span>
<a href="#l16.1228"></a><span id="l16.1228" class="difflineminus">-      id-&gt;SetReplyOnTop(isNNTP ? 0 : 1);</span>
<a href="#l16.1229"></a><span id="l16.1229" class="difflineminus">-      pAcc-&gt;AddIdentity(id);</span>
<a href="#l16.1230"></a><span id="l16.1230" class="difflineplus">+    GetValueForTag(xmlDoc, isNNTP ?</span>
<a href="#l16.1231"></a><span id="l16.1231" class="difflineplus">+      NS_LITERAL_STRING(&quot;NNTP_Email_Address&quot;) :</span>
<a href="#l16.1232"></a><span id="l16.1232" class="difflineplus">+      NS_LITERAL_STRING(&quot;SMTP_Email_Address&quot;), value);</span>
<a href="#l16.1233"></a><span id="l16.1233" class="difflineplus">+    id-&gt;SetEmail(NS_ConvertUTF16toUTF8(value));</span>
<a href="#l16.1234"></a><span id="l16.1234" class="difflineplus">+    IMPORT_LOG1(&quot;\temail: %S\n&quot;, value.get());</span>
<a href="#l16.1235"></a><span id="l16.1235"> </span>
<a href="#l16.1236"></a><span id="l16.1236" class="difflineminus">-      IMPORT_LOG0(&quot;Created identity and added to the account\n&quot;);</span>
<a href="#l16.1237"></a><span id="l16.1237" class="difflineminus">-      IMPORT_LOG1(&quot;\tname: %s\n&quot;, pName);</span>
<a href="#l16.1238"></a><span id="l16.1238" class="difflineminus">-      IMPORT_LOG1(&quot;\temail: %s\n&quot;, pEmail);</span>
<a href="#l16.1239"></a><span id="l16.1239" class="difflineminus">-    }</span>
<a href="#l16.1240"></a><span id="l16.1240" class="difflineplus">+    GetValueForTag(xmlDoc,  isNNTP ?</span>
<a href="#l16.1241"></a><span id="l16.1241" class="difflineplus">+      NS_LITERAL_STRING(&quot;NNTP_Reply_To_Email_Address&quot;) :</span>
<a href="#l16.1242"></a><span id="l16.1242" class="difflineplus">+      NS_LITERAL_STRING(&quot;SMTP_Reply_To_Email_Address&quot;), value);</span>
<a href="#l16.1243"></a><span id="l16.1243" class="difflineplus">+    id-&gt;SetReplyTo(NS_ConvertUTF16toUTF8(value));</span>
<a href="#l16.1244"></a><span id="l16.1244" class="difflineplus">+</span>
<a href="#l16.1245"></a><span id="l16.1245" class="difflineplus">+    // Windows users are used to top style quoting.</span>
<a href="#l16.1246"></a><span id="l16.1246" class="difflineplus">+    id-&gt;SetReplyOnTop(isNNTP ? 0 : 1);</span>
<a href="#l16.1247"></a><span id="l16.1247" class="difflineplus">+    pAcc-&gt;AddIdentity(id);</span>
<a href="#l16.1248"></a><span id="l16.1248" class="difflineplus">+  }</span>
<a href="#l16.1249"></a><span id="l16.1249"> </span>
<a href="#l16.1250"></a><span id="l16.1250">   if (!isNNTP)  // NNTP does not use SMTP in OE or TB</span>
<a href="#l16.1251"></a><span id="l16.1251" class="difflineminus">-    SetSmtpServer(pSmtpServer, hKey, id, pIncomgUserName, authMethodIncoming);</span>
<a href="#l16.1252"></a><span id="l16.1252" class="difflineminus">-</span>
<a href="#l16.1253"></a><span id="l16.1253" class="difflineminus">-  nsOERegUtil::FreeValueBytes((BYTE *)pName);</span>
<a href="#l16.1254"></a><span id="l16.1254" class="difflineminus">-  nsOERegUtil::FreeValueBytes((BYTE *)pSmtpServer);</span>
<a href="#l16.1255"></a><span id="l16.1255" class="difflineminus">-  nsOERegUtil::FreeValueBytes((BYTE *)pEmail);</span>
<a href="#l16.1256"></a><span id="l16.1256" class="difflineminus">-  nsOERegUtil::FreeValueBytes((BYTE *)pReply);</span>
<a href="#l16.1257"></a><span id="l16.1257" class="difflineplus">+    SetSmtpServer(xmlDoc, id, inUserName, authMethodIncoming);</span>
<a href="#l16.1258"></a><span id="l16.1258"> }</span>
<a href="#l16.1259"></a><span id="l16.1259"> </span>
<a href="#l16.1260"></a><span id="l16.1260" class="difflineminus">-void OESettings::SetSmtpServer(char *pSmtpServer, HKEY hKey,</span>
<a href="#l16.1261"></a><span id="l16.1261" class="difflineminus">-                               nsIMsgIdentity *id, char *pIncomgUserName,</span>
<a href="#l16.1262"></a><span id="l16.1262" class="difflineminus">-                               PRInt32 authMethodIncoming)</span>
<a href="#l16.1263"></a><span id="l16.1263" class="difflineplus">+void WMSettings::SetSmtpServer(nsIDOMDocument *xmlDoc, nsIMsgIdentity *id,</span>
<a href="#l16.1264"></a><span id="l16.1264" class="difflineplus">+                               nsAutoString&amp; inUserName, PRInt32 authMethodIncoming)</span>
<a href="#l16.1265"></a><span id="l16.1265"> {</span>
<a href="#l16.1266"></a><span id="l16.1266" class="difflineplus">+  PRInt32 errorCode;</span>
<a href="#l16.1267"></a><span id="l16.1267" class="difflineplus">+</span>
<a href="#l16.1268"></a><span id="l16.1268">   // set the id.smtpserver accordingly</span>
<a href="#l16.1269"></a><span id="l16.1269" class="difflineminus">-  // first we have to calculate the smtp user name which is based on sicily</span>
<a href="#l16.1270"></a><span id="l16.1270" class="difflineminus">-  if (!hKey || !id || !pIncomgUserName || !pSmtpServer)</span>
<a href="#l16.1271"></a><span id="l16.1271" class="difflineplus">+  if (!id)</span>
<a href="#l16.1272"></a><span id="l16.1272">     return;</span>
<a href="#l16.1273"></a><span id="l16.1273">   nsCString smtpServerKey, userName;</span>
<a href="#l16.1274"></a><span id="l16.1274" class="difflineminus">-  BYTE *pBytes;</span>
<a href="#l16.1275"></a><span id="l16.1275" class="difflineplus">+  nsAutoString value, smtpName;</span>
<a href="#l16.1276"></a><span id="l16.1276" class="difflineplus">+  if (NS_FAILED(GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;SMTP_Server&quot;), smtpName)))</span>
<a href="#l16.1277"></a><span id="l16.1277" class="difflineplus">+    return;</span>
<a href="#l16.1278"></a><span id="l16.1278" class="difflineplus">+</span>
<a href="#l16.1279"></a><span id="l16.1279" class="difflineplus">+  // first we have to calculate the smtp user name which is based on sicily</span>
<a href="#l16.1280"></a><span id="l16.1280">   // smtp user name depends on sicily which may or not exist</span>
<a href="#l16.1281"></a><span id="l16.1281">   PRInt32 useSicily = 0;</span>
<a href="#l16.1282"></a><span id="l16.1282" class="difflineminus">-  if (pBytes = nsOERegUtil::GetValueBytes(hKey, &quot;SMTP Use Sicily&quot;)){</span>
<a href="#l16.1283"></a><span id="l16.1283" class="difflineminus">-    useSicily = *(PRInt32 *)pBytes;</span>
<a href="#l16.1284"></a><span id="l16.1284" class="difflineminus">-    nsOERegUtil::FreeValueBytes(pBytes);</span>
<a href="#l16.1285"></a><span id="l16.1285" class="difflineminus">-  }</span>
<a href="#l16.1286"></a><span id="l16.1286" class="difflineplus">+  GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;SMTP_Use_Sicily&quot;), value);</span>
<a href="#l16.1287"></a><span id="l16.1287" class="difflineplus">+  useSicily = (PRInt32)value.ToInteger(&amp;errorCode,16);</span>
<a href="#l16.1288"></a><span id="l16.1288" class="difflineplus">+</span>
<a href="#l16.1289"></a><span id="l16.1289">   switch (useSicily) {</span>
<a href="#l16.1290"></a><span id="l16.1290">     case 1 : case 3 :</span>
<a href="#l16.1291"></a><span id="l16.1291" class="difflineminus">-      // has to go in whether empty or no</span>
<a href="#l16.1292"></a><span id="l16.1292" class="difflineminus">-      // shouldn't be empty but better safe than sorry</span>
<a href="#l16.1293"></a><span id="l16.1293" class="difflineminus">-      if (pBytes = nsOERegUtil::GetValueBytes(hKey, &quot;SMTP User Name&quot;)){</span>
<a href="#l16.1294"></a><span id="l16.1294" class="difflineminus">-        userName = (char *)pBytes;  // this may be empty; shouldn't be non-existent</span>
<a href="#l16.1295"></a><span id="l16.1295" class="difflineminus">-        nsOERegUtil::FreeValueBytes(pBytes);</span>
<a href="#l16.1296"></a><span id="l16.1296" class="difflineminus">-      }</span>
<a href="#l16.1297"></a><span id="l16.1297" class="difflineplus">+      GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;SMTP_User_Name&quot;), value);</span>
<a href="#l16.1298"></a><span id="l16.1298" class="difflineplus">+      CopyUTF16toUTF8(value, userName);</span>
<a href="#l16.1299"></a><span id="l16.1299">       break;</span>
<a href="#l16.1300"></a><span id="l16.1300">     case 2 :</span>
<a href="#l16.1301"></a><span id="l16.1301" class="difflineminus">-      userName = pIncomgUserName;</span>
<a href="#l16.1302"></a><span id="l16.1302" class="difflineplus">+      CopyUTF16toUTF8(inUserName, userName);</span>
<a href="#l16.1303"></a><span id="l16.1303">       break;</span>
<a href="#l16.1304"></a><span id="l16.1304">     default :</span>
<a href="#l16.1305"></a><span id="l16.1305">       break; // initial userName == &quot;&quot;</span>
<a href="#l16.1306"></a><span id="l16.1306">   }</span>
<a href="#l16.1307"></a><span id="l16.1307"> </span>
<a href="#l16.1308"></a><span id="l16.1308">   nsresult rv;</span>
<a href="#l16.1309"></a><span id="l16.1309" class="difflineminus">-  nsCOMPtr&lt;nsISmtpService&gt; smtpService(do_GetService(NS_SMTPSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l16.1310"></a><span id="l16.1310" class="difflineplus">+  nsCOMPtr&lt;nsISmtpService&gt;</span>
<a href="#l16.1311"></a><span id="l16.1311" class="difflineplus">+    smtpService(do_GetService(NS_SMTPSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l16.1312"></a><span id="l16.1312">   if (NS_SUCCEEDED(rv) &amp;&amp; smtpService) {</span>
<a href="#l16.1313"></a><span id="l16.1313" class="difflineminus">-    nsCOMPtr&lt;nsISmtpServer&gt; foundServer;</span>
<a href="#l16.1314"></a><span id="l16.1314" class="difflineplus">+    nsCOMPtr&lt;nsISmtpServer&gt; extgServer;</span>
<a href="#l16.1315"></a><span id="l16.1315">     // don't try to make another server</span>
<a href="#l16.1316"></a><span id="l16.1316">     // regardless if username doesn't match</span>
<a href="#l16.1317"></a><span id="l16.1317" class="difflineminus">-    rv = smtpService-&gt;FindServer(userName.get(), pSmtpServer,</span>
<a href="#l16.1318"></a><span id="l16.1318" class="difflineminus">-                                 getter_AddRefs( foundServer));</span>
<a href="#l16.1319"></a><span id="l16.1319" class="difflineminus">-    if (NS_SUCCEEDED( rv) &amp;&amp; foundServer) {</span>
<a href="#l16.1320"></a><span id="l16.1320" class="difflineplus">+    rv = smtpService-&gt;FindServer(userName.get(),</span>
<a href="#l16.1321"></a><span id="l16.1321" class="difflineplus">+                                 NS_ConvertUTF16toUTF8(smtpName).get(),</span>
<a href="#l16.1322"></a><span id="l16.1322" class="difflineplus">+                                 getter_AddRefs(extgServer));</span>
<a href="#l16.1323"></a><span id="l16.1323" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; extgServer) {</span>
<a href="#l16.1324"></a><span id="l16.1324">       // set our account keyed to this smptserver key</span>
<a href="#l16.1325"></a><span id="l16.1325" class="difflineminus">-      foundServer-&gt;GetKey(getter_Copies(smtpServerKey));</span>
<a href="#l16.1326"></a><span id="l16.1326" class="difflineplus">+      extgServer-&gt;GetKey(getter_Copies(smtpServerKey));</span>
<a href="#l16.1327"></a><span id="l16.1327">       id-&gt;SetSmtpServerKey(smtpServerKey);</span>
<a href="#l16.1328"></a><span id="l16.1328"> </span>
<a href="#l16.1329"></a><span id="l16.1329" class="difflineminus">-      IMPORT_LOG1(&quot;SMTP server already exists: %s\n&quot;, pSmtpServer);</span>
<a href="#l16.1330"></a><span id="l16.1330" class="difflineplus">+      IMPORT_LOG1(&quot;SMTP server already exists: %S\n&quot;, smtpName);</span>
<a href="#l16.1331"></a><span id="l16.1331">     }</span>
<a href="#l16.1332"></a><span id="l16.1332">     else {</span>
<a href="#l16.1333"></a><span id="l16.1333">       nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l16.1334"></a><span id="l16.1334" class="difflineminus">-      rv = smtpService-&gt;CreateSmtpServer(getter_AddRefs( smtpServer));</span>
<a href="#l16.1335"></a><span id="l16.1335" class="difflineminus">-      if (NS_SUCCEEDED( rv) &amp;&amp; smtpServer) {</span>
<a href="#l16.1336"></a><span id="l16.1336" class="difflineminus">-        pBytes = nsOERegUtil::GetValueBytes(hKey, &quot;SMTP Port&quot;);</span>
<a href="#l16.1337"></a><span id="l16.1337" class="difflineminus">-        if (pBytes)</span>
<a href="#l16.1338"></a><span id="l16.1338" class="difflineminus">-        {</span>
<a href="#l16.1339"></a><span id="l16.1339" class="difflineminus">-          smtpServer-&gt;SetPort(*(PRInt32 *) pBytes);</span>
<a href="#l16.1340"></a><span id="l16.1340" class="difflineminus">-          nsOERegUtil::FreeValueBytes(pBytes);</span>
<a href="#l16.1341"></a><span id="l16.1341" class="difflineplus">+      rv = smtpService-&gt;CreateSmtpServer(getter_AddRefs(smtpServer));</span>
<a href="#l16.1342"></a><span id="l16.1342" class="difflineplus">+      if (NS_SUCCEEDED(rv) &amp;&amp; smtpServer) {</span>
<a href="#l16.1343"></a><span id="l16.1343" class="difflineplus">+        GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;SMTP_Port&quot;), value);</span>
<a href="#l16.1344"></a><span id="l16.1344" class="difflineplus">+        if (!value.IsEmpty()) {</span>
<a href="#l16.1345"></a><span id="l16.1345" class="difflineplus">+          smtpServer-&gt;SetPort(value.ToInteger(&amp;errorCode,16));</span>
<a href="#l16.1346"></a><span id="l16.1346">         }</span>
<a href="#l16.1347"></a><span id="l16.1347" class="difflineminus">-        pBytes = nsOERegUtil::GetValueBytes(hKey,&quot;SMTP Secure Connection&quot;);</span>
<a href="#l16.1348"></a><span id="l16.1348" class="difflineminus">-        if (pBytes)</span>
<a href="#l16.1349"></a><span id="l16.1349" class="difflineminus">-        {</span>
<a href="#l16.1350"></a><span id="l16.1350" class="difflineminus">-          if (*(PRInt32 *)pBytes == 1)</span>
<a href="#l16.1351"></a><span id="l16.1351" class="difflineplus">+</span>
<a href="#l16.1352"></a><span id="l16.1352" class="difflineplus">+        GetValueForTag(xmlDoc, NS_LITERAL_STRING(&quot;SMTP_Secure_Connection&quot;),</span>
<a href="#l16.1353"></a><span id="l16.1353" class="difflineplus">+                       value);</span>
<a href="#l16.1354"></a><span id="l16.1354" class="difflineplus">+        if (!value.IsEmpty()) {</span>
<a href="#l16.1355"></a><span id="l16.1355" class="difflineplus">+          if (value.ToInteger(&amp;errorCode, 16) == 1)</span>
<a href="#l16.1356"></a><span id="l16.1356">             smtpServer-&gt;SetSocketType(nsMsgSocketType::SSL);</span>
<a href="#l16.1357"></a><span id="l16.1357">           else</span>
<a href="#l16.1358"></a><span id="l16.1358">             smtpServer-&gt;SetSocketType(nsMsgSocketType::plain);</span>
<a href="#l16.1359"></a><span id="l16.1359" class="difflineminus">-          nsOERegUtil::FreeValueBytes(pBytes);</span>
<a href="#l16.1360"></a><span id="l16.1360">         }</span>
<a href="#l16.1361"></a><span id="l16.1361">         smtpServer-&gt;SetUsername(userName);</span>
<a href="#l16.1362"></a><span id="l16.1362">         switch (useSicily) {</span>
<a href="#l16.1363"></a><span id="l16.1363">           case 1 :</span>
<a href="#l16.1364"></a><span id="l16.1364">             smtpServer-&gt;SetAuthMethod(nsMsgAuthMethod::secure);</span>
<a href="#l16.1365"></a><span id="l16.1365">             break;</span>
<a href="#l16.1366"></a><span id="l16.1366" class="difflineminus">-          case 2 : // requires SMTP authentication to use the incoming server settings</span>
<a href="#l16.1367"></a><span id="l16.1367" class="difflineplus">+           case 2 : // requires SMTP authentication to use the incoming server settings</span>
<a href="#l16.1368"></a><span id="l16.1368">             smtpServer-&gt;SetAuthMethod(authMethodIncoming);</span>
<a href="#l16.1369"></a><span id="l16.1369">             break;</span>
<a href="#l16.1370"></a><span id="l16.1370">           case 3 :</span>
<a href="#l16.1371"></a><span id="l16.1371">             smtpServer-&gt;SetAuthMethod(nsMsgAuthMethod::passwordCleartext);</span>
<a href="#l16.1372"></a><span id="l16.1372">             break;</span>
<a href="#l16.1373"></a><span id="l16.1373">           default:</span>
<a href="#l16.1374"></a><span id="l16.1374">             smtpServer-&gt;SetAuthMethod(nsMsgAuthMethod::none);</span>
<a href="#l16.1375"></a><span id="l16.1375">         }</span>
<a href="#l16.1376"></a><span id="l16.1376"> </span>
<a href="#l16.1377"></a><span id="l16.1377" class="difflineminus">-        smtpServer-&gt;SetHostname(nsDependentCString(pSmtpServer));</span>
<a href="#l16.1378"></a><span id="l16.1378" class="difflineplus">+        smtpServer-&gt;SetHostname(NS_ConvertUTF16toUTF8(smtpName));</span>
<a href="#l16.1379"></a><span id="l16.1379"> </span>
<a href="#l16.1380"></a><span id="l16.1380">         smtpServer-&gt;GetKey(getter_Copies(smtpServerKey));</span>
<a href="#l16.1381"></a><span id="l16.1381">         id-&gt;SetSmtpServerKey(smtpServerKey);</span>
<a href="#l16.1382"></a><span id="l16.1382"> </span>
<a href="#l16.1383"></a><span id="l16.1383" class="difflineminus">-        IMPORT_LOG1(&quot;Created new SMTP server: %s\n&quot;, pSmtpServer);</span>
<a href="#l16.1384"></a><span id="l16.1384" class="difflineplus">+        IMPORT_LOG1(&quot;Created new SMTP server: %S\n&quot;, smtpName);</span>
<a href="#l16.1385"></a><span id="l16.1385">       }</span>
<a href="#l16.1386"></a><span id="l16.1386">     }</span>
<a href="#l16.1387"></a><span id="l16.1387">   }</span>
<a href="#l16.1388"></a><span id="l16.1388"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">copy from mailnews/import/oexpress/nsOESettings.h</span>
<a href="#l17.2"></a><span id="l17.2">copy to mailnews/import/winlivemail/nsWMSettings.h</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineminus">--- a/mailnews/import/oexpress/nsOESettings.h</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMSettings.h</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineat">@@ -30,25 +30,25 @@</span>
<a href="#l17.6"></a><span id="l17.6">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l17.7"></a><span id="l17.7">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l17.8"></a><span id="l17.8">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l17.9"></a><span id="l17.9">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l17.10"></a><span id="l17.10">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l17.11"></a><span id="l17.11">  *</span>
<a href="#l17.12"></a><span id="l17.12">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l17.13"></a><span id="l17.13"> </span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-#ifndef nsOESettings_h___</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-#define nsOESettings_h___</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+#ifndef nsWMSettings_h___</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+#define nsWMSettings_h___</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19"> #include &quot;nsIImportSettings.h&quot;</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">-class nsOESettings : public nsIImportSettings {</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+class nsWMSettings : public nsIImportSettings {</span>
<a href="#l17.23"></a><span id="l17.23"> public:</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-  nsOESettings();</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">-  virtual ~nsOESettings();</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+  nsWMSettings();</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+  virtual ~nsWMSettings();</span>
<a href="#l17.28"></a><span id="l17.28">   static nsresult Create(nsIImportSettings** aImport);</span>
<a href="#l17.29"></a><span id="l17.29">   NS_DECL_ISUPPORTS</span>
<a href="#l17.30"></a><span id="l17.30">   NS_DECL_NSIIMPORTSETTINGS</span>
<a href="#l17.31"></a><span id="l17.31"> </span>
<a href="#l17.32"></a><span id="l17.32"> private:</span>
<a href="#l17.33"></a><span id="l17.33"> };</span>
<a href="#l17.34"></a><span id="l17.34"> </span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-#endif /* nsOESettings_h___ */</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+#endif /* nsWMSettings_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">copy from mailnews/import/oexpress/nsOEStringBundle.cpp</span>
<a href="#l18.2"></a><span id="l18.2">copy to mailnews/import/winlivemail/nsWMStringBundle.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineminus">--- a/mailnews/import/oexpress/nsOEStringBundle.cpp</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMStringBundle.cpp</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineat">@@ -34,69 +34,69 @@</span>
<a href="#l18.6"></a><span id="l18.6">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l18.7"></a><span id="l18.7">  *</span>
<a href="#l18.8"></a><span id="l18.8">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.9"></a><span id="l18.9"> #include &quot;prprf.h&quot;</span>
<a href="#l18.10"></a><span id="l18.10"> #include &quot;prmem.h&quot;</span>
<a href="#l18.11"></a><span id="l18.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l18.12"></a><span id="l18.12"> #include &quot;nsReadableUtils.h&quot;</span>
<a href="#l18.13"></a><span id="l18.13"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-#include &quot;nsOEStringBundle.h&quot;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+#include &quot;nsWMStringBundle.h&quot;</span>
<a href="#l18.16"></a><span id="l18.16"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l18.17"></a><span id="l18.17"> #include &quot;nsIProxyObjectManager.h&quot;</span>
<a href="#l18.18"></a><span id="l18.18"> #include &quot;nsIURI.h&quot;</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20" class="difflineminus">-#define OE_MSGS_URL       &quot;chrome://messenger/locale/oeImportMsgs.properties&quot;</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+#define WM_MSGS_URL       &quot;chrome://messenger/locale/wmImportMsgs.properties&quot;</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">-nsIStringBundle *  nsOEStringBundle::m_pBundle = nsnull;</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineplus">+nsIStringBundle *  nsWMStringBundle::m_pBundle = nsnull;</span>
<a href="#l18.25"></a><span id="l18.25"> </span>
<a href="#l18.26"></a><span id="l18.26" class="difflineminus">-nsIStringBundle *nsOEStringBundle::GetStringBundle( void)</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineplus">+nsIStringBundle *nsWMStringBundle::GetStringBundle( void)</span>
<a href="#l18.28"></a><span id="l18.28"> {</span>
<a href="#l18.29"></a><span id="l18.29">   if (m_pBundle)</span>
<a href="#l18.30"></a><span id="l18.30">     return( m_pBundle);</span>
<a href="#l18.31"></a><span id="l18.31"> </span>
<a href="#l18.32"></a><span id="l18.32">   nsresult      rv;</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-  char*        propertyURL = OE_MSGS_URL;</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+  char*        propertyURL = WM_MSGS_URL;</span>
<a href="#l18.35"></a><span id="l18.35">   nsIStringBundle*  sBundle = nsnull;</span>
<a href="#l18.36"></a><span id="l18.36"> </span>
<a href="#l18.37"></a><span id="l18.37"> </span>
<a href="#l18.38"></a><span id="l18.38">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l18.39"></a><span id="l18.39">            do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l18.40"></a><span id="l18.40">   if (NS_SUCCEEDED(rv) &amp;&amp; (nsnull != sBundleService)) {</span>
<a href="#l18.41"></a><span id="l18.41">     rv = sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l18.42"></a><span id="l18.42">   }</span>
<a href="#l18.43"></a><span id="l18.43"> </span>
<a href="#l18.44"></a><span id="l18.44">   m_pBundle = sBundle;</span>
<a href="#l18.45"></a><span id="l18.45"> </span>
<a href="#l18.46"></a><span id="l18.46">   return( sBundle);</span>
<a href="#l18.47"></a><span id="l18.47"> }</span>
<a href="#l18.48"></a><span id="l18.48"> </span>
<a href="#l18.49"></a><span id="l18.49" class="difflineminus">-nsIStringBundle *nsOEStringBundle::GetStringBundleProxy( void)</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineplus">+nsIStringBundle *nsWMStringBundle::GetStringBundleProxy( void)</span>
<a href="#l18.51"></a><span id="l18.51"> {</span>
<a href="#l18.52"></a><span id="l18.52">   if (!m_pBundle)</span>
<a href="#l18.53"></a><span id="l18.53">     return( nsnull);</span>
<a href="#l18.54"></a><span id="l18.54"> </span>
<a href="#l18.55"></a><span id="l18.55">   nsIStringBundle *strProxy = nsnull;</span>
<a href="#l18.56"></a><span id="l18.56">   // create a proxy object if we aren't on the same thread?</span>
<a href="#l18.57"></a><span id="l18.57">   NS_GetProxyForObject(NS_PROXY_TO_MAIN_THREAD, NS_GET_IID(nsIStringBundle),</span>
<a href="#l18.58"></a><span id="l18.58">                        m_pBundle, NS_PROXY_SYNC | NS_PROXY_ALWAYS,</span>
<a href="#l18.59"></a><span id="l18.59">                        (void **) &amp;strProxy);</span>
<a href="#l18.60"></a><span id="l18.60"> </span>
<a href="#l18.61"></a><span id="l18.61">   return( strProxy);</span>
<a href="#l18.62"></a><span id="l18.62"> }</span>
<a href="#l18.63"></a><span id="l18.63"> </span>
<a href="#l18.64"></a><span id="l18.64" class="difflineminus">-void nsOEStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result, nsIStringBundle *pBundle)</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineplus">+void nsWMStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result, nsIStringBundle *pBundle)</span>
<a href="#l18.66"></a><span id="l18.66"> {</span>
<a href="#l18.67"></a><span id="l18.67"> </span>
<a href="#l18.68"></a><span id="l18.68">   PRUnichar *ptrv = GetStringByID( stringID, pBundle);</span>
<a href="#l18.69"></a><span id="l18.69">   result = ptrv;</span>
<a href="#l18.70"></a><span id="l18.70">   FreeString( ptrv);</span>
<a href="#l18.71"></a><span id="l18.71"> }</span>
<a href="#l18.72"></a><span id="l18.72"> </span>
<a href="#l18.73"></a><span id="l18.73" class="difflineminus">-PRUnichar *nsOEStringBundle::GetStringByID(PRInt32 stringID, nsIStringBundle *pBundle)</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineplus">+PRUnichar *nsWMStringBundle::GetStringByID(PRInt32 stringID, nsIStringBundle *pBundle)</span>
<a href="#l18.75"></a><span id="l18.75"> {</span>
<a href="#l18.76"></a><span id="l18.76">   if (!pBundle) {</span>
<a href="#l18.77"></a><span id="l18.77">     pBundle = GetStringBundle();</span>
<a href="#l18.78"></a><span id="l18.78">   }</span>
<a href="#l18.79"></a><span id="l18.79"> </span>
<a href="#l18.80"></a><span id="l18.80">   if (pBundle) {</span>
<a href="#l18.81"></a><span id="l18.81">     PRUnichar *ptrv = nsnull;</span>
<a href="#l18.82"></a><span id="l18.82">     nsresult rv = pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineat">@@ -108,14 +108,14 @@ PRUnichar *nsOEStringBundle::GetStringBy</span>
<a href="#l18.84"></a><span id="l18.84">   nsString resultString;</span>
<a href="#l18.85"></a><span id="l18.85">   resultString.AppendLiteral(&quot;[StringID &quot;);</span>
<a href="#l18.86"></a><span id="l18.86">   resultString.AppendInt(stringID);</span>
<a href="#l18.87"></a><span id="l18.87">   resultString.AppendLiteral(&quot;?]&quot;);</span>
<a href="#l18.88"></a><span id="l18.88"> </span>
<a href="#l18.89"></a><span id="l18.89">   return( ToNewUnicode(resultString));</span>
<a href="#l18.90"></a><span id="l18.90"> }</span>
<a href="#l18.91"></a><span id="l18.91"> </span>
<a href="#l18.92"></a><span id="l18.92" class="difflineminus">-void nsOEStringBundle::Cleanup( void)</span>
<a href="#l18.93"></a><span id="l18.93" class="difflineplus">+void nsWMStringBundle::Cleanup( void)</span>
<a href="#l18.94"></a><span id="l18.94"> {</span>
<a href="#l18.95"></a><span id="l18.95">   if (m_pBundle)</span>
<a href="#l18.96"></a><span id="l18.96">     m_pBundle-&gt;Release();</span>
<a href="#l18.97"></a><span id="l18.97">   m_pBundle = nsnull;</span>
<a href="#l18.98"></a><span id="l18.98"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">copy from mailnews/import/oexpress/nsOEStringBundle.h</span>
<a href="#l19.2"></a><span id="l19.2">copy to mailnews/import/winlivemail/nsWMStringBundle.h</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineminus">--- a/mailnews/import/oexpress/nsOEStringBundle.h</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMStringBundle.h</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineat">@@ -29,43 +29,43 @@</span>
<a href="#l19.6"></a><span id="l19.6">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l19.7"></a><span id="l19.7">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l19.8"></a><span id="l19.8">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l19.9"></a><span id="l19.9">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l19.10"></a><span id="l19.10">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l19.11"></a><span id="l19.11">  *</span>
<a href="#l19.12"></a><span id="l19.12">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l19.13"></a><span id="l19.13"> </span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-#ifndef _nsOEStringBundle_H__</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-#define _nsOEStringBundle_H__</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+#ifndef _nsWMStringBundle_H__</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+#define _nsWMStringBundle_H__</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19"> #include &quot;nsString.h&quot;</span>
<a href="#l19.20"></a><span id="l19.20"> </span>
<a href="#l19.21"></a><span id="l19.21"> class nsIStringBundle;</span>
<a href="#l19.22"></a><span id="l19.22"> </span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">-class nsOEStringBundle {</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+class nsWMStringBundle {</span>
<a href="#l19.25"></a><span id="l19.25"> public:</span>
<a href="#l19.26"></a><span id="l19.26">   static PRUnichar     *    GetStringByID(PRInt32 stringID, nsIStringBundle *pBundle = nsnull);</span>
<a href="#l19.27"></a><span id="l19.27">   static void          GetStringByID(PRInt32 stringID, nsString&amp; result, nsIStringBundle *pBundle = nsnull);</span>
<a href="#l19.28"></a><span id="l19.28">   static nsIStringBundle *  GetStringBundle( void); // don't release</span>
<a href="#l19.29"></a><span id="l19.29">   static void          FreeString( PRUnichar *pStr) { NS_Free( pStr);}</span>
<a href="#l19.30"></a><span id="l19.30">   static void          Cleanup( void);</span>
<a href="#l19.31"></a><span id="l19.31">   static nsIStringBundle *  GetStringBundleProxy( void); // release</span>
<a href="#l19.32"></a><span id="l19.32"> </span>
<a href="#l19.33"></a><span id="l19.33"> private:</span>
<a href="#l19.34"></a><span id="l19.34">   static nsIStringBundle *  m_pBundle;</span>
<a href="#l19.35"></a><span id="l19.35"> };</span>
<a href="#l19.36"></a><span id="l19.36"> </span>
<a href="#l19.37"></a><span id="l19.37"> </span>
<a href="#l19.38"></a><span id="l19.38"> </span>
<a href="#l19.39"></a><span id="l19.39" class="difflineminus">-#define OEIMPORT_NAME                     2000</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineminus">-#define OEIMPORT_DESCRIPTION              2011</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">-#define OEIMPORT_MAILBOX_SUCCESS          2002</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-#define OEIMPORT_MAILBOX_BADPARAM         2003</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineminus">-#define OEIMPORT_MAILBOX_BADSOURCEFILE    2004</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineminus">-#define OEIMPORT_MAILBOX_CONVERTERROR     2005</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineminus">-#define OEIMPORT_DEFAULT_NAME             2006</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineminus">-#define OEIMPORT_AUTOFIND                 2007</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineminus">-#define OEIMPORT_ADDRESS_SUCCESS          2008</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineminus">-#define OEIMPORT_ADDRESS_CONVERTERROR     2009</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineminus">-#define OEIMPORT_ADDRESS_BADPARAM         2010</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+#define WMIMPORT_NAME                     2000</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+#define WMIMPORT_DESCRIPTION              2001</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineplus">+#define WMIMPORT_MAILBOX_SUCCESS          2002</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineplus">+#define WMIMPORT_MAILBOX_BADPARAM         2003</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineplus">+#define WMIMPORT_MAILBOX_BADSOURCEFILE    2004</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineplus">+#define WMIMPORT_MAILBOX_CONVERTERROR     2005</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineplus">+#define WMIMPORT_DEFAULT_NAME             2006</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineplus">+#define WMIMPORT_AUTOFIND                 2007</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineplus">+#define WMIMPORT_ADDRESS_SUCCESS          2008</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineplus">+#define WMIMPORT_ADDRESS_CONVERTERROR     2009</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineplus">+#define WMIMPORT_ADDRESS_BADPARAM         2010</span>
<a href="#l19.61"></a><span id="l19.61"> </span>
<a href="#l19.62"></a><span id="l19.62" class="difflineminus">-#endif /* _nsOEStringBundle_H__ */</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineplus">+#endif /* _nsWMStringBundle_H__ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/makefiles.sh</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/makefiles.sh</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -103,16 +103,17 @@ mailnews/import/comm4x/public/Makefile</span>
<a href="#l20.4"></a><span id="l20.4"> mailnews/import/comm4x/src/Makefile</span>
<a href="#l20.5"></a><span id="l20.5"> mailnews/import/eudora/src/Makefile</span>
<a href="#l20.6"></a><span id="l20.6"> mailnews/import/oexpress/Makefile</span>
<a href="#l20.7"></a><span id="l20.7"> mailnews/import/outlook/src/Makefile</span>
<a href="#l20.8"></a><span id="l20.8"> mailnews/import/public/Makefile</span>
<a href="#l20.9"></a><span id="l20.9"> mailnews/import/src/Makefile</span>
<a href="#l20.10"></a><span id="l20.10"> mailnews/import/test/Makefile</span>
<a href="#l20.11"></a><span id="l20.11"> mailnews/import/text/src/Makefile</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+mailnews/import/winlivemail/Makefile</span>
<a href="#l20.13"></a><span id="l20.13"> mailnews/local/Makefile</span>
<a href="#l20.14"></a><span id="l20.14"> mailnews/local/build/Makefile</span>
<a href="#l20.15"></a><span id="l20.15"> mailnews/local/public/Makefile</span>
<a href="#l20.16"></a><span id="l20.16"> mailnews/local/src/Makefile</span>
<a href="#l20.17"></a><span id="l20.17"> mailnews/local/test/Makefile</span>
<a href="#l20.18"></a><span id="l20.18"> mailnews/mapi/mapiDll/Makefile</span>
<a href="#l20.19"></a><span id="l20.19"> mailnews/mapi/mapihook/Makefile</span>
<a href="#l20.20"></a><span id="l20.20"> mailnews/mapi/mapihook/build/Makefile</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">copy from suite/locales/en-US/chrome/mailnews/oeImportMsgs.properties</span>
<a href="#l21.2"></a><span id="l21.2">copy to suite/locales/en-US/chrome/mailnews/wmImportMsgs.properties</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/oeImportMsgs.properties</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/wmImportMsgs.properties</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineat">@@ -16,94 +16,93 @@</span>
<a href="#l21.6"></a><span id="l21.6"> # The Initial Developer of the Original Code is</span>
<a href="#l21.7"></a><span id="l21.7"> # Netscape Communications Corporation.</span>
<a href="#l21.8"></a><span id="l21.8"> # Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l21.9"></a><span id="l21.9"> # the Initial Developer. All Rights Reserved.</span>
<a href="#l21.10"></a><span id="l21.10"> #</span>
<a href="#l21.11"></a><span id="l21.11"> # Contributor(s):</span>
<a href="#l21.12"></a><span id="l21.12"> #</span>
<a href="#l21.13"></a><span id="l21.13"> # Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l21.18"></a><span id="l21.18"> # in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l21.19"></a><span id="l21.19"> # of those above. If you wish to allow use of your version of this file only</span>
<a href="#l21.20"></a><span id="l21.20"> # under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l21.21"></a><span id="l21.21"> # use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l21.22"></a><span id="l21.22"> # decision by deleting the provisions above and replace them with the notice</span>
<a href="#l21.23"></a><span id="l21.23"> # and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l21.24"></a><span id="l21.24"> # the provisions above, a recipient may use your version of this file under</span>
<a href="#l21.25"></a><span id="l21.25"> # the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.26"></a><span id="l21.26"> #</span>
<a href="#l21.27"></a><span id="l21.27"> # ***** END LICENSE BLOCK *****</span>
<a href="#l21.28"></a><span id="l21.28"> </span>
<a href="#l21.29"></a><span id="l21.29"> #</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-# The following are used by the outlook express import code to display status/error </span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+# The following are used by the windows live mail import code to display status/error</span>
<a href="#l21.32"></a><span id="l21.32"> # and informational messages</span>
<a href="#l21.33"></a><span id="l21.33"> #</span>
<a href="#l21.34"></a><span id="l21.34"> </span>
<a href="#l21.35"></a><span id="l21.35"> # Short name of import module</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineminus">-## @name OEIMPORT_NAME</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+## @name WMIMPORT_NAME</span>
<a href="#l21.38"></a><span id="l21.38"> ## @loc None</span>
<a href="#l21.39"></a><span id="l21.39"> ## LOCALIZATION NOTE (2000): DONT_TRANSLATE</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineminus">-2000=Outlook Express</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+2000=Windows Live Mail</span>
<a href="#l21.42"></a><span id="l21.42"> </span>
<a href="#l21.43"></a><span id="l21.43"> # Description of import module</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineminus">-## @name OEIMPORT_DESCRIPTION</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineplus">+## @name WMIMPORT_DESCRIPTION</span>
<a href="#l21.46"></a><span id="l21.46"> ## @loc None</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineminus">-## LOCALIZATION NOTE (2011): In this item, don't translate &quot;Outlook Express&quot;</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-2011=Outlook Express mail, address books, and settings</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+## LOCALIZATION NOTE (2001): In this item, don't translate &quot;Windows Live Mail&quot;</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+2001=Windows Live Mail settings</span>
<a href="#l21.51"></a><span id="l21.51"> </span>
<a href="#l21.52"></a><span id="l21.52"> # Success message</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineminus">-## @name OEIMPORT_MAILBOX_SUCCESS</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineplus">+## @name WMIMPORT_MAILBOX_SUCCESS</span>
<a href="#l21.55"></a><span id="l21.55"> ## @loc None</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-## LOCALIZATION NOTE (2002): In this item, don't translate &quot;%S&quot; or &quot;%d&quot;</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineminus">-## The variable %S will contain the name of the Mailbox</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineminus">-## The variable %d will contain the number of messages</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineminus">-</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-2002=Mailbox %S, imported %d messages</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+## LOCALIZATION NOTE (2002): In this item, don't translate &quot;%1$S&quot; or &quot;%2$d&quot;</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineplus">+## The variable %1$S will contain the name of the Mailbox</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineplus">+## The variable %2$d will contain the number of messages</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineplus">+2002=Mailbox %1$S, imported %2$d messages</span>
<a href="#l21.65"></a><span id="l21.65"> </span>
<a href="#l21.66"></a><span id="l21.66"> # Error message</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineminus">-## @name OEIMPORT_MAILBOX_BADPARAM</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineplus">+## @name WMIMPORT_MAILBOX_BADPARAM</span>
<a href="#l21.69"></a><span id="l21.69"> ## @loc None</span>
<a href="#l21.70"></a><span id="l21.70"> 2003=Bad parameter passed to import mailbox.</span>
<a href="#l21.71"></a><span id="l21.71"> </span>
<a href="#l21.72"></a><span id="l21.72"> # Error message</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineminus">-## @name OEIMPORT_MAILBOX_BADSOURCEFILE</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineplus">+## @name WMIMPORT_MAILBOX_BADSOURCEFILE</span>
<a href="#l21.75"></a><span id="l21.75"> ## @loc None</span>
<a href="#l21.76"></a><span id="l21.76"> ## LOCALIZATION NOTE (2004): In this item, don't translate &quot;%S&quot;</span>
<a href="#l21.77"></a><span id="l21.77"> ## The variable %S will contain the name of the Mailbox</span>
<a href="#l21.78"></a><span id="l21.78"> 2004=Error accessing file for mailbox %S.</span>
<a href="#l21.79"></a><span id="l21.79"> </span>
<a href="#l21.80"></a><span id="l21.80"> # Error message</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineminus">-## @name OEIMPORT_MAILBOX_CONVERTERROR</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineplus">+## @name WMIMPORT_MAILBOX_CONVERTERROR</span>
<a href="#l21.83"></a><span id="l21.83"> ## @loc None</span>
<a href="#l21.84"></a><span id="l21.84"> ## LOCALIZATION NOTE (2005): In this item, don't translate &quot;%S&quot;</span>
<a href="#l21.85"></a><span id="l21.85"> ## The variable %S will contain the name of the Mailbox</span>
<a href="#l21.86"></a><span id="l21.86"> 2005=Error importing mailbox %S, all messages may not be imported from this mailbox.</span>
<a href="#l21.87"></a><span id="l21.87"> </span>
<a href="#l21.88"></a><span id="l21.88"> # Default name of imported addressbook</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineminus">-## @name OEIMPORT_DEFAULT_NAME</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineplus">+## @name WMIMPORT_DEFAULT_NAME</span>
<a href="#l21.91"></a><span id="l21.91"> ## @loc None</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineminus">-2006=Outlook Express Address Book</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineplus">+2006=Windows Live Mail Address Book</span>
<a href="#l21.94"></a><span id="l21.94"> </span>
<a href="#l21.95"></a><span id="l21.95"> # Autofind description</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineminus">-## @name OEIMPORT_AUTOFIND</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineplus">+## @name WMIMPORT_AUTOFIND</span>
<a href="#l21.98"></a><span id="l21.98"> ## @loc None</span>
<a href="#l21.99"></a><span id="l21.99" class="difflineminus">-2007=Outlook Express address book (windows address book)</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineplus">+2007=Windows Live Mail address book (windows address book)</span>
<a href="#l21.101"></a><span id="l21.101"> </span>
<a href="#l21.102"></a><span id="l21.102"> # Description</span>
<a href="#l21.103"></a><span id="l21.103" class="difflineminus">-## @name OEIMPORT_ADDRESS_SUCCESS</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineplus">+## @name WMIMPORT_ADDRESS_SUCCESS</span>
<a href="#l21.105"></a><span id="l21.105"> ## @loc None</span>
<a href="#l21.106"></a><span id="l21.106"> ## LOCALIZATION NOTE (2006): In this item, don't translate &quot;%S&quot;</span>
<a href="#l21.107"></a><span id="l21.107"> ## The variable %S will receive the name of the address book</span>
<a href="#l21.108"></a><span id="l21.108"> 2008=Imported address book %S</span>
<a href="#l21.109"></a><span id="l21.109"> </span>
<a href="#l21.110"></a><span id="l21.110"> # Error message</span>
<a href="#l21.111"></a><span id="l21.111" class="difflineminus">-## @name OEIMPORT_ADDRESS_CONVERTERROR</span>
<a href="#l21.112"></a><span id="l21.112" class="difflineplus">+## @name WMIMPORT_ADDRESS_CONVERTERROR</span>
<a href="#l21.113"></a><span id="l21.113"> ## @loc None</span>
<a href="#l21.114"></a><span id="l21.114"> ## LOCALIZATION NOTE (2009): In this item, don't translate &quot;%S&quot;</span>
<a href="#l21.115"></a><span id="l21.115"> ## The variable %S will receive the name of the address book</span>
<a href="#l21.116"></a><span id="l21.116"> 2009=Error importing address book %S, all addresses may not have been imported.</span>
<a href="#l21.117"></a><span id="l21.117"> </span>
<a href="#l21.118"></a><span id="l21.118"> # Error message</span>
<a href="#l21.119"></a><span id="l21.119" class="difflineminus">-## @name OEIMPORT_ADDRESS_BADPARAM</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineplus">+## @name WMIMPORT_ADDRESS_BADPARAM</span>
<a href="#l21.121"></a><span id="l21.121"> ## @loc None</span>
<a href="#l21.122"></a><span id="l21.122"> 2010=Bad parameter passed to import addressbook.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/suite/locales/jar.mn</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/suite/locales/jar.mn</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -297,16 +297,17 @@</span>
<a href="#l22.4"></a><span id="l22.4">   locale/@AB_CD@/messenger/subscribe.dtd                                    (%chrome/mailnews/subscribe.dtd)</span>
<a href="#l22.5"></a><span id="l22.5">   locale/@AB_CD@/messenger/subscribe.properties                             (%chrome/mailnews/subscribe.properties)</span>
<a href="#l22.6"></a><span id="l22.6">   locale/@AB_CD@/messenger/textImportMsgs.properties                        (%chrome/mailnews/textImportMsgs.properties)</span>
<a href="#l22.7"></a><span id="l22.7">   locale/@AB_CD@/messenger/threadpane.dtd                                   (%chrome/mailnews/threadpane.dtd)</span>
<a href="#l22.8"></a><span id="l22.8">   locale/@AB_CD@/messenger/vcard.properties                                 (%chrome/mailnews/vcard.properties)</span>
<a href="#l22.9"></a><span id="l22.9">   locale/@AB_CD@/messenger/viewLog.dtd                                      (%chrome/mailnews/viewLog.dtd)</span>
<a href="#l22.10"></a><span id="l22.10">   locale/@AB_CD@/messenger/virtualFolderProperties.dtd                      (%chrome/mailnews/virtualFolderProperties.dtd)</span>
<a href="#l22.11"></a><span id="l22.11">   locale/@AB_CD@/messenger/virtualFolderListDialog.dtd                      (%chrome/mailnews/virtualFolderListDialog.dtd)</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+  locale/@AB_CD@/messenger/wmImportMsgs.properties                          (%chrome/mailnews/wmImportMsgs.properties)</span>
<a href="#l22.13"></a><span id="l22.13">   locale/@AB_CD@/messenger-mapi/mapi.properties                             (%chrome/mailnews/mapi/mapi.properties)</span>
<a href="#l22.14"></a><span id="l22.14">   locale/@AB_CD@/messenger-region/region.properties                         (%chrome/mailnews/region.properties)</span>
<a href="#l22.15"></a><span id="l22.15"> #ifdef MOZ_PSM</span>
<a href="#l22.16"></a><span id="l22.16">   locale/@AB_CD@/messenger/am-smime.dtd                                     (%chrome/mailnews/smime/am-smime.dtd)</span>
<a href="#l22.17"></a><span id="l22.17">   locale/@AB_CD@/messenger/am-smime.properties                              (%chrome/mailnews/smime/am-smime.properties)</span>
<a href="#l22.18"></a><span id="l22.18">   locale/@AB_CD@/messenger-smime/certFetchingStatus.dtd                     (%chrome/mailnews/smime/certFetchingStatus.dtd)</span>
<a href="#l22.19"></a><span id="l22.19">   locale/@AB_CD@/messenger-smime/msgCompSecurityInfo.dtd                    (%chrome/mailnews/smime/msgCompSecurityInfo.dtd)</span>
<a href="#l22.20"></a><span id="l22.20">   locale/@AB_CD@/messenger-smime/msgCompSecurityInfo.properties             (%chrome/mailnews/smime/msgCompSecurityInfo.properties)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

