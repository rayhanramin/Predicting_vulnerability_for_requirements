<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 491:b74e327573cf2d0bfd51b2b276de28fa248a7c1d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ b74e327573cf2d0bfd51b2b276de28fa248a7c1d" />
<meta property="og:url" content="/comm-central/rev/b74e327573cf2d0bfd51b2b276de28fa248a7c1d" />
<meta property="og:description" content="Bug 227649 - Remove obsolete &lt;mailnews/mapi/old/*&gt;; r+sr=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / b74e327573cf2d0bfd51b2b276de28fa248a7c1d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/b74e327573cf2d0bfd51b2b276de28fa248a7c1d">shortlog</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/b74e327573cf2d0bfd51b2b276de28fa248a7c1d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/b74e327573cf2d0bfd51b2b276de28fa248a7c1d">files</a> |
changeset |
<a href="/comm-central/raw-rev/b74e327573cf2d0bfd51b2b276de28fa248a7c1d">raw</a>  | <a href="/comm-central/archive/b74e327573cf2d0bfd51b2b276de28fa248a7c1d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=227649">Bug 227649</a> - Remove obsolete &lt;mailnews/mapi/old/*&gt;; r+sr=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#101;&#114;&#103;&#101;&#32;&#71;&#97;&#117;&#116;&#104;&#101;&#114;&#105;&#101;&#32;&#60;&#115;&#103;&#97;&#117;&#116;&#104;&#101;&#114;&#105;&#101;&#46;&#98;&#122;&#64;&#102;&#114;&#101;&#101;&#46;&#102;&#114;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 04 Oct 2008 04:17:40 +0200</td></tr>

<tr>
 <td>changeset 491</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/b74e327573cf2d0bfd51b2b276de28fa248a7c1d">b74e327573cf2d0bfd51b2b276de28fa248a7c1d</a></td>
</tr>



<tr>
<td>parent 490</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f14c3be7ed511ef50a0d6f4fcf7443200ef955e6">f14c3be7ed511ef50a0d6f4fcf7443200ef955e6</a>
</td>
</tr>

<tr>
<td>child 492</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/013280d40b69a3ee9da6767f01d2573fb182c59b">013280d40b69a3ee9da6767f01d2573fb182c59b</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=b74e327573cf2d0bfd51b2b276de28fa248a7c1d">432</a></td></tr>
<tr><td>push user</td><td>sgautherie.bz@free.fr</td></tr>
<tr><td>push date</td><td class="date age">Sat, 04 Oct 2008 02:18:50 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@b74e327573cf [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b74e327573cf2d0bfd51b2b276de28fa248a7c1d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b74e327573cf2d0bfd51b2b276de28fa248a7c1d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b74e327573cf2d0bfd51b2b276de28fa248a7c1d&newProject=comm-central&newRevision=b74e327573cf2d0bfd51b2b276de28fa248a7c1d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b74e327573cf2d0bfd51b2b276de28fa248a7c1d&newProject=comm-central&newRevision=b74e327573cf2d0bfd51b2b276de28fa248a7c1d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b74e327573cf2d0bfd51b2b276de28fa248a7c1d&newProject=comm-central&newRevision=b74e327573cf2d0bfd51b2b276de28fa248a7c1d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=227649">227649</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=227649">Bug 227649</a> - Remove obsolete &lt;mailnews/mapi/old/*&gt;; r+sr=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/makefile.win">mailnews/mapi/old/hook/makefile.win</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/makefile.win">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/makefile.win">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/makefile.win">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapihook.cpp">mailnews/mapi/old/hook/mapihook.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapihook.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapihook.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapihook.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapihook.h">mailnews/mapi/old/hook/mapihook.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapihook.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapihook.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapihook.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapimail.cpp">mailnews/mapi/old/hook/mapimail.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapimail.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapimail.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapimail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapimail.h">mailnews/mapi/old/hook/mapimail.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapimail.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapimail.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/hook/mapimail.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/Makefile.win">mailnews/mapi/old/lib/Makefile.win</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/Makefile.win">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/Makefile.win">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/Makefile.win">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/mapismem.cpp">mailnews/mapi/old/lib/mapismem.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/mapismem.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/mapismem.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/mapismem.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/mapismem.h">mailnews/mapi/old/lib/mapismem.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/mapismem.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/mapismem.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/mapismem.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/nsstrseq.cpp">mailnews/mapi/old/lib/nsstrseq.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/nsstrseq.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/nsstrseq.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/nsstrseq.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/nsstrseq.h">mailnews/mapi/old/lib/nsstrseq.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/nsstrseq.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/nsstrseq.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/lib/nsstrseq.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/makefile.win">mailnews/mapi/old/makefile.win</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/makefile.win">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/makefile.win">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/makefile.win">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/maindll.cpp">mailnews/mapi/old/mapi32/maindll.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/maindll.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/maindll.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/maindll.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/makefile.win">mailnews/mapi/old/mapi32/makefile.win</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/makefile.win">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/makefile.win">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/makefile.win">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.cpp">mailnews/mapi/old/mapi32/mapi32.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.def">mailnews/mapi/old/mapi32/mapi32.def</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.def">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.def">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.def">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.rc">mailnews/mapi/old/mapi32/mapi32.rc</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.rc">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.rc">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapi32.rc">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiipc.cpp">mailnews/mapi/old/mapi32/mapiipc.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiipc.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiipc.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiipc.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiipc.h">mailnews/mapi/old/mapi32/mapiipc.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiipc.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiipc.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiipc.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapimem.cpp">mailnews/mapi/old/mapi32/mapimem.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapimem.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapimem.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapimem.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapimem.h">mailnews/mapi/old/mapi32/mapimem.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapimem.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapimem.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapimem.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiutl.cpp">mailnews/mapi/old/mapi32/mapiutl.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiutl.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiutl.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiutl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiutl.h">mailnews/mapi/old/mapi32/mapiutl.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiutl.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiutl.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/mapiutl.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/port.h">mailnews/mapi/old/mapi32/port.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/port.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/port.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/port.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/resource.h">mailnews/mapi/old/mapi32/resource.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/resource.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/resource.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/resource.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/smem.cpp">mailnews/mapi/old/mapi32/smem.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/smem.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/smem.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/smem.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/trace.cpp">mailnews/mapi/old/mapi32/trace.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/trace.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/trace.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/trace.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/trace.h">mailnews/mapi/old/mapi32/trace.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/trace.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/trace.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/trace.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/xpapi.cpp">mailnews/mapi/old/mapi32/xpapi.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/xpapi.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/xpapi.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/xpapi.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/xpapi.h">mailnews/mapi/old/mapi32/xpapi.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/xpapi.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/xpapi.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/mapi32/xpapi.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/public/makefile.win">mailnews/mapi/old/public/makefile.win</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/public/makefile.win">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/public/makefile.win">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/public/makefile.win">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/public/nscpmapi.h">mailnews/mapi/old/public/nscpmapi.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/public/nscpmapi.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/public/nscpmapi.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/public/nscpmapi.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/makefile.win">mailnews/mapi/old/tests/makefile.win</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/makefile.win">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/makefile.win">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/makefile.win">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/main.cpp">mailnews/mapi/old/tests/mapitest/main.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/main.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/main.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/main.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/makefile.win">mailnews/mapi/old/tests/mapitest/makefile.win</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/makefile.win">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/makefile.win">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/makefile.win">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapimail.cpp">mailnews/mapi/old/tests/mapitest/mapimail.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapimail.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapimail.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapimail.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapiproc.cpp">mailnews/mapi/old/tests/mapitest/mapiproc.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapiproc.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapiproc.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapiproc.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dep">mailnews/mapi/old/tests/mapitest/mapitest.dep</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dep">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dep">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dep">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dsp">mailnews/mapi/old/tests/mapitest/mapitest.dsp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dsp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dsp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dsp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dsw">mailnews/mapi/old/tests/mapitest/mapitest.dsw</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dsw">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dsw">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.dsw">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.ncb">mailnews/mapi/old/tests/mapitest/mapitest.ncb</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.ncb">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.ncb">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.ncb">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.opt">mailnews/mapi/old/tests/mapitest/mapitest.opt</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.opt">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.opt">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.opt">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.plg">mailnews/mapi/old/tests/mapitest/mapitest.plg</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.plg">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.plg">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mapitest.plg">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mtest32.rc">mailnews/mapi/old/tests/mapitest/mtest32.rc</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mtest32.rc">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mtest32.rc">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/mtest32.rc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/nscicon.ico">mailnews/mapi/old/tests/mapitest/nscicon.ico</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/nscicon.ico">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/nscicon.ico">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/nscicon.ico">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/port.h">mailnews/mapi/old/tests/mapitest/port.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/port.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/port.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/port.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/readmail.cpp">mailnews/mapi/old/tests/mapitest/readmail.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/readmail.cpp">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/readmail.cpp">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/readmail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/resource.h">mailnews/mapi/old/tests/mapitest/resource.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/resource.h">diff</a> |
<a href="/comm-central/comparison/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/resource.h">comparison</a> |
<a href="/comm-central/log/b74e327573cf2d0bfd51b2b276de28fa248a7c1d/mailnews/mapi/old/tests/mapitest/resource.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1">deleted file mode 100644</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineminus">--- a/mailnews/mapi/old/hook/makefile.win</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineplus">+++ /dev/null</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineat">@@ -1,80 +0,0 @@</span>
<a href="#l1.5"></a><span id="l1.5" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineminus">-#</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-#</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-# License.</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-#</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-#</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-#</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-# Contributor(s):</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-#</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-#</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-DEPTH=..\..\..</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-MODULE=mapiguts</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-################################################################################</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-## exports</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-#EXPORTS =</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-################################################################################</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-## library</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-LIBNAME = .\$(OBJDIR)\mapiguts</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-!ifdef MOZ_STATIC_COMPONENT_LIBS</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-LIB = $(LIBNAME).lib</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineminus">-!else</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-DLL = $(LIBNAME).dll</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-!endif</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineminus">-DEFINES= -NS_DEBUG</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-OBJS=										\</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-    .\$(OBJDIR)\mapihook.obj  \</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineminus">-    .\$(OBJDIR)\mapimail.obj  \</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-		$(NULL)</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-LLIBS=										\</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-			$(LLIBS)						\</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-			$(LIBNSPR)						\</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-			$(DIST)\lib\xppref32.lib		\</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-			$(DIST)\lib\xpcom.lib       	\</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-			$(DIST)\lib\mapiutils_s.lib  \</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineminus">-			$(NULL)</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineminus">-</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineminus">-include &lt;$(DEPTH)\config\rules.mak&gt;</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-!ifdef MOZ_STATIC_COMPONENT_LIBS</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-libs:: $(LIb)</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineminus">-	$(MAKE_INSTALL)  $(LIBNAME).$(LIB_SUFFIX) $(DIST)\bin\components</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineminus">-!else</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-libs:: $(DLL)</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineminus">-	$(MAKE_INSTALL)  $(LIBNAME).$(DLL_SUFFIX) $(DIST)\bin\components</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineminus">-!endif</span>
<a href="#l1.85"></a><span id="l1.85">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">deleted file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- a/mailnews/mapi/old/hook/mapihook.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ /dev/null</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -1,1579 +0,0 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineminus">- *</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">- *</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">- * License.</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">- *</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">- *</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">- *</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">- *</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">- *</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-//</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-//  MAPI Hooks for Communicator</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-//  Note: THIS LIVES IN COMMUNICATOR THOUGH IT IS IN THE MAPIDLL FOR</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-//        BUILD REASONS</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineminus">-//  November 1997</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-#include &lt;trace.h&gt;</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-#include &lt;stdio.h&gt;    </span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-#include &lt;stdlib.h&gt;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-#include &lt;sys/stat.h&gt;</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-#include &quot;wfemsg.h&quot;     // for WFE_MSGGetMaster()</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-#include &quot;msgmapi.h&quot;    // For enumerating messages...</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-#include &quot;nsstrseq.h&quot;</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-#include &quot;mapihook.h&quot;</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-#include &quot;nscpmapi.h&quot;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-#include &quot;mapismem.h&quot;</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-#include &quot;mapimail.h&quot;</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-#include &quot;hiddenfr.h&quot;</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-#include &quot;msgcom.h&quot;</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-#define   DELIMIT         &quot;-{|}-&quot;    // DON'T I18N THIS!</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-//</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-// Static defines for the MAPI support...</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-//</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-static CMAPIConnection *mapiConnections[MAX_CON] = {NULL, NULL, NULL, NULL};</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-//</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-// Forward declarations...</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-//</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-LONG    ProcessMAPILogon(MAPILogonType *logonInfo);</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-LONG    ProcessMAPILogoff(MAPILogoffType *logoffInfo);</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineminus">-LONG    ProcessMAPISendMail(MAPISendMailType *sendMailPtr);</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-LONG    ProcessMAPISaveMail(MAPISendMailType *sendMailPtr);</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-LONG    ProcessMAPISendDocuments(MAPISendDocumentsType *sendDocPtr);</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-LONG    ProcessMAPIFindNext(MAPIFindNextType *findInfo);</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-LONG    ProcessMAPIDeleteMail(MAPIDeleteMailType *delInfo);</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineminus">-LONG    ProcessMAPIResolveName(MAPIResolveNameType *nameInfo);</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-LONG    ProcessMAPIDetails(MAPIDetailsType *detailInfo);</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-LONG    ProcessMAPIReadMail(MAPIReadMailType *readInfo);</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-LONG    ProcessMAPIAddress(MAPIAddressType *addrInfo);</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-//</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-// This will store the CFrameWnd we startup for MAPI and if we do start</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineminus">-// an instance of the browser, we will close it out when we leave.</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineminus">-//</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-static CFrameWnd  *pMAPIFrameWnd = NULL;</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineminus">-</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineminus">-void </span>
<a href="#l2.95"></a><span id="l2.95" class="difflineminus">-StoreMAPIFrameWnd(CFrameWnd *pFrameWnd)</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineminus">-{</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineminus">-  pMAPIFrameWnd = pFrameWnd;</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineminus">-}</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineminus">-</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineminus">-// This is the result of a WM_COPYDATA message. This will be used to send requests</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineminus">-// into Communicator for Simple MAPI commands.</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineminus">-//</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineminus">-// The description of the parameters coming into this call are:</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineminus">-//</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineminus">-//    wParam = (WPARAM) (HWND) hwnd;            // handle of sending window </span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-//    lParam = (LPARAM) (PCOPYDATASTRUCT) pcds; // pointer to structure with data </span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-//    context= needed for the context we will use in Communicator</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineminus">-//</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineminus">-//		typedef struct tagCOPYDATASTRUCT {  // cds  </span>
<a href="#l2.110"></a><span id="l2.110" class="difflineminus">-//			DWORD dwData;			// the ID of the request</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineminus">-//			DWORD cbData;			// the size of the argument</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineminus">-//			PVOID lpData;			// Chunk of information defined specifically for each of the</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineminus">-//                        // Simple MAPI Calls.</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineminus">-//		} COPYDATASTRUCT; </span>
<a href="#l2.115"></a><span id="l2.115" class="difflineminus">-//</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineminus">-// Returns: The MAPI Return code for the operation:</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineminus">-//</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineminus">-//</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineminus">-LONG ProcessNetscapeMAPIHook(WPARAM wParam, LPARAM lParam)</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineminus">-{</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-  PCOPYDATASTRUCT	  pcds = (PCOPYDATASTRUCT) lParam;</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineminus">-  MAPIIPCType       *ipcInfo; </span>
<a href="#l2.123"></a><span id="l2.123" class="difflineminus">-#ifdef WIN32   </span>
<a href="#l2.124"></a><span id="l2.124" class="difflineminus">-  HANDLE            hSharedMemory;</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-#endif</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineminus">-	if (lParam == NULL)</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineminus">-	{</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineminus">-		return(MAPI_E_FAILURE);</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineminus">-	}</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineminus">-</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineminus">-  //</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineminus">-  // Get shared memory info structure pointer...</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineminus">-  //</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineminus">-  ipcInfo = (MAPIIPCType *)pcds-&gt;lpData;</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineminus">-  if (ipcInfo == NULL)</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineminus">-	{</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineminus">-		return(MAPI_E_FAILURE);</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineminus">-	}</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineminus">-</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineminus">-  //</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineminus">-  // Now connect to shared memory...or just set the</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineminus">-  // pointer for Win16</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineminus">-  //</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-  CSharedMem *sMem = NSOpenExistingSharedMemory((LPCTSTR) ipcInfo-&gt;smemName, &amp;hSharedMemory);</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-  if (!sMem)</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineminus">-	{</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-		return(MAPI_E_FAILURE);</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-	}</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineminus">-#else</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineminus">-  if (!ipcInfo-&gt;lpsmem)</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineminus">-  {</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineminus">-  }</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineminus">-#endif</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineminus">-</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineminus">-  TRACE(&quot;MAPI: MAPIHook Message ID = %d\n&quot;, pcds-&gt;dwData);</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineminus">-	switch (pcds-&gt;dwData) </span>
<a href="#l2.160"></a><span id="l2.160" class="difflineminus">-	{</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineminus">-  // MAPILogon</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineminus">-  case NSCP_MAPILogon:</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineminus">-    {</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineminus">-     MAPILogonType     *logonInfo;</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineminus">-    logonInfo = (MAPILogonType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineminus">-#else    </span>
<a href="#l2.170"></a><span id="l2.170" class="difflineminus">-    logonInfo = (MAPILogonType *) ipcInfo-&gt;lpsmem;</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineminus">-#endif</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineminus">-</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineminus">-    if (!logonInfo)</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineminus">-    {</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineminus">-    }</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineminus">-  </span>
<a href="#l2.178"></a><span id="l2.178" class="difflineminus">-    logonInfo-&gt;ipcWorked = 1;         // Set the worked flag</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineminus">-    return(ProcessMAPILogon(logonInfo));</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineminus">-    break;</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineminus">-    }</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineminus">-</span>
<a href="#l2.183"></a><span id="l2.183" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.184"></a><span id="l2.184" class="difflineminus">-  // MAPILogoff</span>
<a href="#l2.185"></a><span id="l2.185" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.186"></a><span id="l2.186" class="difflineminus">-  case NSCP_MAPILogoff:</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineminus">-    {</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineminus">-    MAPILogoffType     *logoffInfo;</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineminus">- </span>
<a href="#l2.190"></a><span id="l2.190" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.191"></a><span id="l2.191" class="difflineminus">-    logoffInfo = (MAPILogoffType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l2.192"></a><span id="l2.192" class="difflineminus">-#else    </span>
<a href="#l2.193"></a><span id="l2.193" class="difflineminus">-    logoffInfo = (MAPILogoffType *) ipcInfo-&gt;lpsmem;</span>
<a href="#l2.194"></a><span id="l2.194" class="difflineminus">-#endif</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineminus">-</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineminus">-    if (!logoffInfo)</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineminus">-    {</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineminus">-    }</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineminus">-</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineminus">-    logoffInfo-&gt;ipcWorked = 1;         // Set the worked flag</span>
<a href="#l2.202"></a><span id="l2.202" class="difflineminus">-    return(ProcessMAPILogoff(logoffInfo));</span>
<a href="#l2.203"></a><span id="l2.203" class="difflineminus">-    break;</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineminus">-    }</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineminus">-</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineminus">-  // NSCP_MAPISendMail</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.209"></a><span id="l2.209" class="difflineminus">-  case NSCP_MAPISendMail:</span>
<a href="#l2.210"></a><span id="l2.210" class="difflineminus">-     {</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineminus">-     MAPISendMailType     *sendMailPtr;</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineminus">-    sendMailPtr = (MAPISendMailType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineminus">-#else    </span>
<a href="#l2.215"></a><span id="l2.215" class="difflineminus">-    sendMailPtr = (MAPISendMailType *) ipcInfo-&gt;lpsmem;</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineminus">-#endif</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineminus">-</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineminus">-    if (!sendMailPtr)</span>
<a href="#l2.219"></a><span id="l2.219" class="difflineminus">-    {</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.221"></a><span id="l2.221" class="difflineminus">-    }</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineminus">-</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineminus">-    sendMailPtr-&gt;ipcWorked = 1;         // Set the worked flag</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineminus">-    return(ProcessMAPISendMail(sendMailPtr));</span>
<a href="#l2.225"></a><span id="l2.225" class="difflineminus">-    break;</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineminus">-    }</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineminus">-</span>
<a href="#l2.228"></a><span id="l2.228" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.229"></a><span id="l2.229" class="difflineminus">-  // MAPISendDocuments</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineminus">-  case NSCP_MAPISendDocuments:</span>
<a href="#l2.232"></a><span id="l2.232" class="difflineminus">-     {</span>
<a href="#l2.233"></a><span id="l2.233" class="difflineminus">-     MAPISendDocumentsType     *sendDocPtr;</span>
<a href="#l2.234"></a><span id="l2.234" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.235"></a><span id="l2.235" class="difflineminus">-    sendDocPtr = (MAPISendDocumentsType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l2.236"></a><span id="l2.236" class="difflineminus">-#else    </span>
<a href="#l2.237"></a><span id="l2.237" class="difflineminus">-    sendDocPtr = (MAPISendDocumentsType *) ipcInfo-&gt;lpsmem;</span>
<a href="#l2.238"></a><span id="l2.238" class="difflineminus">-#endif</span>
<a href="#l2.239"></a><span id="l2.239" class="difflineminus">-</span>
<a href="#l2.240"></a><span id="l2.240" class="difflineminus">-    if (!sendDocPtr)</span>
<a href="#l2.241"></a><span id="l2.241" class="difflineminus">-    {</span>
<a href="#l2.242"></a><span id="l2.242" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.243"></a><span id="l2.243" class="difflineminus">-    }</span>
<a href="#l2.244"></a><span id="l2.244" class="difflineminus">-</span>
<a href="#l2.245"></a><span id="l2.245" class="difflineminus">-    sendDocPtr-&gt;ipcWorked = 1;         // Set the worked flag</span>
<a href="#l2.246"></a><span id="l2.246" class="difflineminus">-    return(ProcessMAPISendDocuments(sendDocPtr));</span>
<a href="#l2.247"></a><span id="l2.247" class="difflineminus">-    break;</span>
<a href="#l2.248"></a><span id="l2.248" class="difflineminus">-    }</span>
<a href="#l2.249"></a><span id="l2.249" class="difflineminus">-</span>
<a href="#l2.250"></a><span id="l2.250" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.251"></a><span id="l2.251" class="difflineminus">-  // MAPIFindNext</span>
<a href="#l2.252"></a><span id="l2.252" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.253"></a><span id="l2.253" class="difflineminus">-  case NSCP_MAPIFindNext:</span>
<a href="#l2.254"></a><span id="l2.254" class="difflineminus">-    {</span>
<a href="#l2.255"></a><span id="l2.255" class="difflineminus">-    MAPIFindNextType    *findInfo;</span>
<a href="#l2.256"></a><span id="l2.256" class="difflineminus">- </span>
<a href="#l2.257"></a><span id="l2.257" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.258"></a><span id="l2.258" class="difflineminus">-    findInfo = (MAPIFindNextType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l2.259"></a><span id="l2.259" class="difflineminus">-#else    </span>
<a href="#l2.260"></a><span id="l2.260" class="difflineminus">-    findInfo = (MAPIFindNextType *) ipcInfo-&gt;lpsmem;</span>
<a href="#l2.261"></a><span id="l2.261" class="difflineminus">-#endif</span>
<a href="#l2.262"></a><span id="l2.262" class="difflineminus">-</span>
<a href="#l2.263"></a><span id="l2.263" class="difflineminus">-    if (!findInfo)</span>
<a href="#l2.264"></a><span id="l2.264" class="difflineminus">-    {</span>
<a href="#l2.265"></a><span id="l2.265" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.266"></a><span id="l2.266" class="difflineminus">-    }</span>
<a href="#l2.267"></a><span id="l2.267" class="difflineminus">-</span>
<a href="#l2.268"></a><span id="l2.268" class="difflineminus">-    findInfo-&gt;ipcWorked = 1;         // Set the worked flag</span>
<a href="#l2.269"></a><span id="l2.269" class="difflineminus">-    return(ProcessMAPIFindNext(findInfo));</span>
<a href="#l2.270"></a><span id="l2.270" class="difflineminus">-    break;</span>
<a href="#l2.271"></a><span id="l2.271" class="difflineminus">-    }</span>
<a href="#l2.272"></a><span id="l2.272" class="difflineminus">-</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.274"></a><span id="l2.274" class="difflineminus">-  // MAPIDeleteMail</span>
<a href="#l2.275"></a><span id="l2.275" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.276"></a><span id="l2.276" class="difflineminus">-  case NSCP_MAPIDeleteMail:</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineminus">-    {</span>
<a href="#l2.278"></a><span id="l2.278" class="difflineminus">-    MAPIDeleteMailType    *delInfo;</span>
<a href="#l2.279"></a><span id="l2.279" class="difflineminus">- </span>
<a href="#l2.280"></a><span id="l2.280" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.281"></a><span id="l2.281" class="difflineminus">-    delInfo = (MAPIDeleteMailType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l2.282"></a><span id="l2.282" class="difflineminus">-#else    </span>
<a href="#l2.283"></a><span id="l2.283" class="difflineminus">-    delInfo = (MAPIDeleteMailType *) ipcInfo-&gt;lpsmem;</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineminus">-#endif</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineminus">-</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineminus">-    if (!delInfo)</span>
<a href="#l2.287"></a><span id="l2.287" class="difflineminus">-    {</span>
<a href="#l2.288"></a><span id="l2.288" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.289"></a><span id="l2.289" class="difflineminus">-    }</span>
<a href="#l2.290"></a><span id="l2.290" class="difflineminus">-</span>
<a href="#l2.291"></a><span id="l2.291" class="difflineminus">-    delInfo-&gt;ipcWorked = 1;         // Set the worked flag</span>
<a href="#l2.292"></a><span id="l2.292" class="difflineminus">-    return(ProcessMAPIDeleteMail(delInfo));</span>
<a href="#l2.293"></a><span id="l2.293" class="difflineminus">-    break;</span>
<a href="#l2.294"></a><span id="l2.294" class="difflineminus">-    }</span>
<a href="#l2.295"></a><span id="l2.295" class="difflineminus">-</span>
<a href="#l2.296"></a><span id="l2.296" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.297"></a><span id="l2.297" class="difflineminus">-  // MAPIResolveName</span>
<a href="#l2.298"></a><span id="l2.298" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.299"></a><span id="l2.299" class="difflineminus">-  case NSCP_MAPIResolveName:</span>
<a href="#l2.300"></a><span id="l2.300" class="difflineminus">-    {</span>
<a href="#l2.301"></a><span id="l2.301" class="difflineminus">-    MAPIResolveNameType    *nameInfo;</span>
<a href="#l2.302"></a><span id="l2.302" class="difflineminus">- </span>
<a href="#l2.303"></a><span id="l2.303" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.304"></a><span id="l2.304" class="difflineminus">-    nameInfo = (MAPIResolveNameType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l2.305"></a><span id="l2.305" class="difflineminus">-#else    </span>
<a href="#l2.306"></a><span id="l2.306" class="difflineminus">-    nameInfo = (MAPIResolveNameType *) ipcInfo-&gt;lpsmem;</span>
<a href="#l2.307"></a><span id="l2.307" class="difflineminus">-#endif</span>
<a href="#l2.308"></a><span id="l2.308" class="difflineminus">-</span>
<a href="#l2.309"></a><span id="l2.309" class="difflineminus">-    if (!nameInfo)</span>
<a href="#l2.310"></a><span id="l2.310" class="difflineminus">-    {</span>
<a href="#l2.311"></a><span id="l2.311" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.312"></a><span id="l2.312" class="difflineminus">-    }</span>
<a href="#l2.313"></a><span id="l2.313" class="difflineminus">-</span>
<a href="#l2.314"></a><span id="l2.314" class="difflineminus">-    nameInfo-&gt;ipcWorked = 1;         // Set the worked flag</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineminus">-    return(ProcessMAPIResolveName(nameInfo));</span>
<a href="#l2.316"></a><span id="l2.316" class="difflineminus">-    break;</span>
<a href="#l2.317"></a><span id="l2.317" class="difflineminus">-    }</span>
<a href="#l2.318"></a><span id="l2.318" class="difflineminus">-</span>
<a href="#l2.319"></a><span id="l2.319" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.320"></a><span id="l2.320" class="difflineminus">-  // MAPIDetails</span>
<a href="#l2.321"></a><span id="l2.321" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.322"></a><span id="l2.322" class="difflineminus">-  case NSCP_MAPIDetails:</span>
<a href="#l2.323"></a><span id="l2.323" class="difflineminus">-    {</span>
<a href="#l2.324"></a><span id="l2.324" class="difflineminus">-    MAPIDetailsType    *detailInfo;</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineminus">- </span>
<a href="#l2.326"></a><span id="l2.326" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.327"></a><span id="l2.327" class="difflineminus">-    detailInfo = (MAPIDetailsType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineminus">-#else    </span>
<a href="#l2.329"></a><span id="l2.329" class="difflineminus">-    detailInfo = (MAPIDetailsType *) ipcInfo-&gt;lpsmem;</span>
<a href="#l2.330"></a><span id="l2.330" class="difflineminus">-#endif</span>
<a href="#l2.331"></a><span id="l2.331" class="difflineminus">-</span>
<a href="#l2.332"></a><span id="l2.332" class="difflineminus">-    if (!detailInfo)</span>
<a href="#l2.333"></a><span id="l2.333" class="difflineminus">-    {</span>
<a href="#l2.334"></a><span id="l2.334" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.335"></a><span id="l2.335" class="difflineminus">-    }</span>
<a href="#l2.336"></a><span id="l2.336" class="difflineminus">-</span>
<a href="#l2.337"></a><span id="l2.337" class="difflineminus">-    detailInfo-&gt;ipcWorked = 1;         // Set the worked flag</span>
<a href="#l2.338"></a><span id="l2.338" class="difflineminus">-    return(ProcessMAPIDetails(detailInfo));</span>
<a href="#l2.339"></a><span id="l2.339" class="difflineminus">-    break;</span>
<a href="#l2.340"></a><span id="l2.340" class="difflineminus">-    }</span>
<a href="#l2.341"></a><span id="l2.341" class="difflineminus">-</span>
<a href="#l2.342"></a><span id="l2.342" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.343"></a><span id="l2.343" class="difflineminus">-  // MAPIReadMail</span>
<a href="#l2.344"></a><span id="l2.344" class="difflineminus">-  //////////////////////////////////////////////////////////////////////  </span>
<a href="#l2.345"></a><span id="l2.345" class="difflineminus">-  case NSCP_MAPIReadMail:</span>
<a href="#l2.346"></a><span id="l2.346" class="difflineminus">-    {</span>
<a href="#l2.347"></a><span id="l2.347" class="difflineminus">-    MAPIReadMailType    *readInfo;</span>
<a href="#l2.348"></a><span id="l2.348" class="difflineminus">- </span>
<a href="#l2.349"></a><span id="l2.349" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.350"></a><span id="l2.350" class="difflineminus">-    readInfo = (MAPIReadMailType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l2.351"></a><span id="l2.351" class="difflineminus">-#else    </span>
<a href="#l2.352"></a><span id="l2.352" class="difflineminus">-    readInfo = (MAPIReadMailType *) ipcInfo-&gt;lpsmem;</span>
<a href="#l2.353"></a><span id="l2.353" class="difflineminus">-#endif</span>
<a href="#l2.354"></a><span id="l2.354" class="difflineminus">-</span>
<a href="#l2.355"></a><span id="l2.355" class="difflineminus">-    if (!readInfo)</span>
<a href="#l2.356"></a><span id="l2.356" class="difflineminus">-    {</span>
<a href="#l2.357"></a><span id="l2.357" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.358"></a><span id="l2.358" class="difflineminus">-    }</span>
<a href="#l2.359"></a><span id="l2.359" class="difflineminus">-</span>
<a href="#l2.360"></a><span id="l2.360" class="difflineminus">-    readInfo-&gt;ipcWorked = 1;         // Set the worked flag</span>
<a href="#l2.361"></a><span id="l2.361" class="difflineminus">-    return(ProcessMAPIReadMail(readInfo));</span>
<a href="#l2.362"></a><span id="l2.362" class="difflineminus">-    break;</span>
<a href="#l2.363"></a><span id="l2.363" class="difflineminus">-    }</span>
<a href="#l2.364"></a><span id="l2.364" class="difflineminus">-</span>
<a href="#l2.365"></a><span id="l2.365" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.366"></a><span id="l2.366" class="difflineminus">-  // NSCP_MAPISaveMail</span>
<a href="#l2.367"></a><span id="l2.367" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.368"></a><span id="l2.368" class="difflineminus">-  case NSCP_MAPISaveMail:</span>
<a href="#l2.369"></a><span id="l2.369" class="difflineminus">-     {</span>
<a href="#l2.370"></a><span id="l2.370" class="difflineminus">-     MAPISendMailType     *sendMailPtr;</span>
<a href="#l2.371"></a><span id="l2.371" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.372"></a><span id="l2.372" class="difflineminus">-    sendMailPtr = (MAPISendMailType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l2.373"></a><span id="l2.373" class="difflineminus">-#else    </span>
<a href="#l2.374"></a><span id="l2.374" class="difflineminus">-    sendMailPtr = (MAPISendMailType *) ipcInfo-&gt;lpsmem;</span>
<a href="#l2.375"></a><span id="l2.375" class="difflineminus">-#endif</span>
<a href="#l2.376"></a><span id="l2.376" class="difflineminus">-</span>
<a href="#l2.377"></a><span id="l2.377" class="difflineminus">-    if (!sendMailPtr)</span>
<a href="#l2.378"></a><span id="l2.378" class="difflineminus">-    {</span>
<a href="#l2.379"></a><span id="l2.379" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.380"></a><span id="l2.380" class="difflineminus">-    }</span>
<a href="#l2.381"></a><span id="l2.381" class="difflineminus">-</span>
<a href="#l2.382"></a><span id="l2.382" class="difflineminus">-    sendMailPtr-&gt;ipcWorked = 1;         // Set the worked flag</span>
<a href="#l2.383"></a><span id="l2.383" class="difflineminus">-    return(ProcessMAPISaveMail(sendMailPtr));</span>
<a href="#l2.384"></a><span id="l2.384" class="difflineminus">-    break;</span>
<a href="#l2.385"></a><span id="l2.385" class="difflineminus">-    }</span>
<a href="#l2.386"></a><span id="l2.386" class="difflineminus">-</span>
<a href="#l2.387"></a><span id="l2.387" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.388"></a><span id="l2.388" class="difflineminus">-  // MAPIAddress</span>
<a href="#l2.389"></a><span id="l2.389" class="difflineminus">-  //////////////////////////////////////////////////////////////////////</span>
<a href="#l2.390"></a><span id="l2.390" class="difflineminus">-  case NSCP_MAPIAddress:</span>
<a href="#l2.391"></a><span id="l2.391" class="difflineminus">-    {</span>
<a href="#l2.392"></a><span id="l2.392" class="difflineminus">-    MAPIAddressType    *addrInfo;</span>
<a href="#l2.393"></a><span id="l2.393" class="difflineminus">- </span>
<a href="#l2.394"></a><span id="l2.394" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.395"></a><span id="l2.395" class="difflineminus">-    addrInfo = (MAPIAddressType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l2.396"></a><span id="l2.396" class="difflineminus">-#else    </span>
<a href="#l2.397"></a><span id="l2.397" class="difflineminus">-    addrInfo = (MAPIAddressType *) ipcInfo-&gt;lpsmem;</span>
<a href="#l2.398"></a><span id="l2.398" class="difflineminus">-#endif</span>
<a href="#l2.399"></a><span id="l2.399" class="difflineminus">-</span>
<a href="#l2.400"></a><span id="l2.400" class="difflineminus">-    if (!addrInfo)</span>
<a href="#l2.401"></a><span id="l2.401" class="difflineminus">-    {</span>
<a href="#l2.402"></a><span id="l2.402" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.403"></a><span id="l2.403" class="difflineminus">-    }</span>
<a href="#l2.404"></a><span id="l2.404" class="difflineminus">-</span>
<a href="#l2.405"></a><span id="l2.405" class="difflineminus">-    addrInfo-&gt;ipcWorked = 1;         // Set the worked flag</span>
<a href="#l2.406"></a><span id="l2.406" class="difflineminus">-    return(ProcessMAPIAddress(addrInfo));</span>
<a href="#l2.407"></a><span id="l2.407" class="difflineminus">-    }</span>
<a href="#l2.408"></a><span id="l2.408" class="difflineminus">-  </span>
<a href="#l2.409"></a><span id="l2.409" class="difflineminus">-  case NSCP_MAPIFree:   // This should never hit Communicator, but if it does</span>
<a href="#l2.410"></a><span id="l2.410" class="difflineminus">-#ifdef WIN16</span>
<a href="#l2.411"></a><span id="l2.411" class="difflineminus">-    return(SUCCESS_SUCCESS);       // Just return</span>
<a href="#l2.412"></a><span id="l2.412" class="difflineminus">-#else</span>
<a href="#l2.413"></a><span id="l2.413" class="difflineminus">-    return(S_OK);       // Just return </span>
<a href="#l2.414"></a><span id="l2.414" class="difflineminus">-#endif</span>
<a href="#l2.415"></a><span id="l2.415" class="difflineminus">-</span>
<a href="#l2.416"></a><span id="l2.416" class="difflineminus">-	default:</span>
<a href="#l2.417"></a><span id="l2.417" class="difflineminus">-    return(MAPI_E_NOT_SUPPORTED);     // Should never hit here!</span>
<a href="#l2.418"></a><span id="l2.418" class="difflineminus">-		break;</span>
<a href="#l2.419"></a><span id="l2.419" class="difflineminus">-	}</span>
<a href="#l2.420"></a><span id="l2.420" class="difflineminus">-</span>
<a href="#l2.421"></a><span id="l2.421" class="difflineminus">-	return(SUCCESS_SUCCESS);</span>
<a href="#l2.422"></a><span id="l2.422" class="difflineminus">-}</span>
<a href="#l2.423"></a><span id="l2.423" class="difflineminus">-</span>
<a href="#l2.424"></a><span id="l2.424" class="difflineminus">-//</span>
<a href="#l2.425"></a><span id="l2.425" class="difflineminus">-// Find the default session for Communicator...</span>
<a href="#l2.426"></a><span id="l2.426" class="difflineminus">-//</span>
<a href="#l2.427"></a><span id="l2.427" class="difflineminus">-CMAPIConnection </span>
<a href="#l2.428"></a><span id="l2.428" class="difflineminus">-*GetDefaultSession(void)</span>
<a href="#l2.429"></a><span id="l2.429" class="difflineminus">-{</span>
<a href="#l2.430"></a><span id="l2.430" class="difflineminus">-  int i;</span>
<a href="#l2.431"></a><span id="l2.431" class="difflineminus">-  </span>
<a href="#l2.432"></a><span id="l2.432" class="difflineminus">-  for (i=0; i &lt; MAX_CON; i++)</span>
<a href="#l2.433"></a><span id="l2.433" class="difflineminus">-  {</span>
<a href="#l2.434"></a><span id="l2.434" class="difflineminus">-    if (mapiConnections[i] != NULL)</span>
<a href="#l2.435"></a><span id="l2.435" class="difflineminus">-    {</span>
<a href="#l2.436"></a><span id="l2.436" class="difflineminus">-      if (mapiConnections[i]-&gt;IsDefault())</span>
<a href="#l2.437"></a><span id="l2.437" class="difflineminus">-      {</span>
<a href="#l2.438"></a><span id="l2.438" class="difflineminus">-        return mapiConnections[i];</span>
<a href="#l2.439"></a><span id="l2.439" class="difflineminus">-      }</span>
<a href="#l2.440"></a><span id="l2.440" class="difflineminus">-    }</span>
<a href="#l2.441"></a><span id="l2.441" class="difflineminus">-  }</span>
<a href="#l2.442"></a><span id="l2.442" class="difflineminus">-</span>
<a href="#l2.443"></a><span id="l2.443" class="difflineminus">-  return(NULL);</span>
<a href="#l2.444"></a><span id="l2.444" class="difflineminus">-}</span>
<a href="#l2.445"></a><span id="l2.445" class="difflineminus">-</span>
<a href="#l2.446"></a><span id="l2.446" class="difflineminus">-//</span>
<a href="#l2.447"></a><span id="l2.447" class="difflineminus">-// Find an open session slot...</span>
<a href="#l2.448"></a><span id="l2.448" class="difflineminus">-//</span>
<a href="#l2.449"></a><span id="l2.449" class="difflineminus">-LONG</span>
<a href="#l2.450"></a><span id="l2.450" class="difflineminus">-GetOpenSessionSlot( void )</span>
<a href="#l2.451"></a><span id="l2.451" class="difflineminus">-{</span>
<a href="#l2.452"></a><span id="l2.452" class="difflineminus">-  int i;</span>
<a href="#l2.453"></a><span id="l2.453" class="difflineminus">-  </span>
<a href="#l2.454"></a><span id="l2.454" class="difflineminus">-  for (i=0; i &lt; MAX_CON; i++)</span>
<a href="#l2.455"></a><span id="l2.455" class="difflineminus">-  {</span>
<a href="#l2.456"></a><span id="l2.456" class="difflineminus">-    if (mapiConnections[i] == NULL)</span>
<a href="#l2.457"></a><span id="l2.457" class="difflineminus">-    {</span>
<a href="#l2.458"></a><span id="l2.458" class="difflineminus">-      return(i);</span>
<a href="#l2.459"></a><span id="l2.459" class="difflineminus">-    }</span>
<a href="#l2.460"></a><span id="l2.460" class="difflineminus">-  }</span>
<a href="#l2.461"></a><span id="l2.461" class="difflineminus">-</span>
<a href="#l2.462"></a><span id="l2.462" class="difflineminus">-  return(-1);</span>
<a href="#l2.463"></a><span id="l2.463" class="difflineminus">-}</span>
<a href="#l2.464"></a><span id="l2.464" class="difflineminus">-</span>
<a href="#l2.465"></a><span id="l2.465" class="difflineminus">-//</span>
<a href="#l2.466"></a><span id="l2.466" class="difflineminus">-// Returns TRUE if it was reassigned and FALSE if not.</span>
<a href="#l2.467"></a><span id="l2.467" class="difflineminus">-//</span>
<a href="#l2.468"></a><span id="l2.468" class="difflineminus">-BOOL</span>
<a href="#l2.469"></a><span id="l2.469" class="difflineminus">-TryDefaultReassignment(void)</span>
<a href="#l2.470"></a><span id="l2.470" class="difflineminus">-{</span>
<a href="#l2.471"></a><span id="l2.471" class="difflineminus">-  int   i;</span>
<a href="#l2.472"></a><span id="l2.472" class="difflineminus">-  int   loc = -1;</span>
<a href="#l2.473"></a><span id="l2.473" class="difflineminus">-</span>
<a href="#l2.474"></a><span id="l2.474" class="difflineminus">-  // Find any sessions left?</span>
<a href="#l2.475"></a><span id="l2.475" class="difflineminus">-  for (i=0; i &lt; MAX_CON; i++)</span>
<a href="#l2.476"></a><span id="l2.476" class="difflineminus">-  {</span>
<a href="#l2.477"></a><span id="l2.477" class="difflineminus">-    if (mapiConnections[i] != NULL)</span>
<a href="#l2.478"></a><span id="l2.478" class="difflineminus">-    {</span>
<a href="#l2.479"></a><span id="l2.479" class="difflineminus">-      loc = i;</span>
<a href="#l2.480"></a><span id="l2.480" class="difflineminus">-      break;</span>
<a href="#l2.481"></a><span id="l2.481" class="difflineminus">-    }</span>
<a href="#l2.482"></a><span id="l2.482" class="difflineminus">-  }</span>
<a href="#l2.483"></a><span id="l2.483" class="difflineminus">-</span>
<a href="#l2.484"></a><span id="l2.484" class="difflineminus">-  // Set default state on the object to true</span>
<a href="#l2.485"></a><span id="l2.485" class="difflineminus">-  if (loc &gt;= 0)</span>
<a href="#l2.486"></a><span id="l2.486" class="difflineminus">-  {</span>
<a href="#l2.487"></a><span id="l2.487" class="difflineminus">-    mapiConnections[loc]-&gt;SetDefault(TRUE);</span>
<a href="#l2.488"></a><span id="l2.488" class="difflineminus">-    return(TRUE);</span>
<a href="#l2.489"></a><span id="l2.489" class="difflineminus">-  }</span>
<a href="#l2.490"></a><span id="l2.490" class="difflineminus">-  else    </span>
<a href="#l2.491"></a><span id="l2.491" class="difflineminus">-  {</span>
<a href="#l2.492"></a><span id="l2.492" class="difflineminus">-    return(FALSE);</span>
<a href="#l2.493"></a><span id="l2.493" class="difflineminus">-  }</span>
<a href="#l2.494"></a><span id="l2.494" class="difflineminus">-}</span>
<a href="#l2.495"></a><span id="l2.495" class="difflineminus">-</span>
<a href="#l2.496"></a><span id="l2.496" class="difflineminus">-LONG</span>
<a href="#l2.497"></a><span id="l2.497" class="difflineminus">-ProcessMAPILogon(MAPILogonType *logonInfo)</span>
<a href="#l2.498"></a><span id="l2.498" class="difflineminus">-{</span>
<a href="#l2.499"></a><span id="l2.499" class="difflineminus">-  CMAPIConnection *defSession = GetDefaultSession();</span>
<a href="#l2.500"></a><span id="l2.500" class="difflineminus">-  NSstringSeq strSeq = (LPSTR) logonInfo + sizeof(MAPILogonType);</span>
<a href="#l2.501"></a><span id="l2.501" class="difflineminus">-  LPSTR lpszProfileName = NSStrSeqGet(strSeq, 0);</span>
<a href="#l2.502"></a><span id="l2.502" class="difflineminus">-  LPSTR lpszPassword    = NSStrSeqGet(strSeq, 1);</span>
<a href="#l2.503"></a><span id="l2.503" class="difflineminus">-</span>
<a href="#l2.504"></a><span id="l2.504" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPILogon() ProfileName = [%s] Password = [%s]\n&quot;, </span>
<a href="#l2.505"></a><span id="l2.505" class="difflineminus">-                            lpszProfileName, lpszPassword);</span>
<a href="#l2.506"></a><span id="l2.506" class="difflineminus">-  //</span>
<a href="#l2.507"></a><span id="l2.507" class="difflineminus">-  // This is a query if lpszProfileName is NULL, lpszPassword is NULL and </span>
<a href="#l2.508"></a><span id="l2.508" class="difflineminus">-  // the MAPI_LOGON_UI is not set </span>
<a href="#l2.509"></a><span id="l2.509" class="difflineminus">-  //</span>
<a href="#l2.510"></a><span id="l2.510" class="difflineminus">-  if ((lpszProfileName[0] == '\0') &amp;&amp; (lpszPassword[0] == '\0') &amp;&amp; </span>
<a href="#l2.511"></a><span id="l2.511" class="difflineminus">-    (!(logonInfo-&gt;flFlags &amp; MAPI_LOGON_UI)) )</span>
<a href="#l2.512"></a><span id="l2.512" class="difflineminus">-  {</span>
<a href="#l2.513"></a><span id="l2.513" class="difflineminus">-    if (defSession == NULL)</span>
<a href="#l2.514"></a><span id="l2.514" class="difflineminus">-    {</span>
<a href="#l2.515"></a><span id="l2.515" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.516"></a><span id="l2.516" class="difflineminus">-    }</span>
<a href="#l2.517"></a><span id="l2.517" class="difflineminus">-    else</span>
<a href="#l2.518"></a><span id="l2.518" class="difflineminus">-    {</span>
<a href="#l2.519"></a><span id="l2.519" class="difflineminus">-      defSession-&gt;IncrementSessionCount();</span>
<a href="#l2.520"></a><span id="l2.520" class="difflineminus">-      logonInfo-&gt;lhSession = defSession-&gt;GetID();</span>
<a href="#l2.521"></a><span id="l2.521" class="difflineminus">-      return(SUCCESS_SUCCESS);</span>
<a href="#l2.522"></a><span id="l2.522" class="difflineminus">-    }</span>
<a href="#l2.523"></a><span id="l2.523" class="difflineminus">-  }</span>
<a href="#l2.524"></a><span id="l2.524" class="difflineminus">-</span>
<a href="#l2.525"></a><span id="l2.525" class="difflineminus">-  //</span>
<a href="#l2.526"></a><span id="l2.526" class="difflineminus">-  // Only allow for sessions by a single profile name...</span>
<a href="#l2.527"></a><span id="l2.527" class="difflineminus">-  //</span>
<a href="#l2.528"></a><span id="l2.528" class="difflineminus">-  if ( ( defSession != NULL ) &amp;&amp;</span>
<a href="#l2.529"></a><span id="l2.529" class="difflineminus">-       (</span>
<a href="#l2.530"></a><span id="l2.530" class="difflineminus">-        (lstrcmp(lpszProfileName, defSession-&gt;GetProfileName() ) != 0) ||</span>
<a href="#l2.531"></a><span id="l2.531" class="difflineminus">-        (lstrcmp(lpszPassword, defSession-&gt;GetPassword() ) != 0)</span>
<a href="#l2.532"></a><span id="l2.532" class="difflineminus">-       )</span>
<a href="#l2.533"></a><span id="l2.533" class="difflineminus">-     )</span>
<a href="#l2.534"></a><span id="l2.534" class="difflineminus">-  {</span>
<a href="#l2.535"></a><span id="l2.535" class="difflineminus">-    return(MAPI_E_TOO_MANY_SESSIONS);</span>
<a href="#l2.536"></a><span id="l2.536" class="difflineminus">-  }</span>
<a href="#l2.537"></a><span id="l2.537" class="difflineminus">-</span>
<a href="#l2.538"></a><span id="l2.538" class="difflineminus">-  //</span>
<a href="#l2.539"></a><span id="l2.539" class="difflineminus">-  // Now create the new MAPI session if we have to...</span>
<a href="#l2.540"></a><span id="l2.540" class="difflineminus">-  //</span>
<a href="#l2.541"></a><span id="l2.541" class="difflineminus">-  BOOL createNew = FALSE;</span>
<a href="#l2.542"></a><span id="l2.542" class="difflineminus">-  if ( </span>
<a href="#l2.543"></a><span id="l2.543" class="difflineminus">-      ( defSession == NULL ) ||</span>
<a href="#l2.544"></a><span id="l2.544" class="difflineminus">-      // Indicates an attempt should be made to create a new session rather than acquire </span>
<a href="#l2.545"></a><span id="l2.545" class="difflineminus">-      // the environment's shared session. If the MAPI_NEW_SESSION flag is not set, MAPILogon </span>
<a href="#l2.546"></a><span id="l2.546" class="difflineminus">-      // uses an existing shared session.</span>
<a href="#l2.547"></a><span id="l2.547" class="difflineminus">-      (logonInfo-&gt;flFlags &amp; MAPI_NEW_SESSION) ||</span>
<a href="#l2.548"></a><span id="l2.548" class="difflineminus">-      (defSession == NULL)      // No default session exists!</span>
<a href="#l2.549"></a><span id="l2.549" class="difflineminus">-     ) </span>
<a href="#l2.550"></a><span id="l2.550" class="difflineminus">-  {</span>
<a href="#l2.551"></a><span id="l2.551" class="difflineminus">-    createNew = TRUE;</span>
<a href="#l2.552"></a><span id="l2.552" class="difflineminus">-  }</span>
<a href="#l2.553"></a><span id="l2.553" class="difflineminus">-</span>
<a href="#l2.554"></a><span id="l2.554" class="difflineminus">-  //</span>
<a href="#l2.555"></a><span id="l2.555" class="difflineminus">-  // Make sure only 4 max are allowed...</span>
<a href="#l2.556"></a><span id="l2.556" class="difflineminus">-  //</span>
<a href="#l2.557"></a><span id="l2.557" class="difflineminus">-  LONG  slot; </span>
<a href="#l2.558"></a><span id="l2.558" class="difflineminus">-  if ((createNew) &amp;&amp; ((slot = GetOpenSessionSlot()) == -1))</span>
<a href="#l2.559"></a><span id="l2.559" class="difflineminus">-  {</span>
<a href="#l2.560"></a><span id="l2.560" class="difflineminus">-    return(MAPI_E_TOO_MANY_SESSIONS);</span>
<a href="#l2.561"></a><span id="l2.561" class="difflineminus">-  }</span>
<a href="#l2.562"></a><span id="l2.562" class="difflineminus">-</span>
<a href="#l2.563"></a><span id="l2.563" class="difflineminus">-  //</span>
<a href="#l2.564"></a><span id="l2.564" class="difflineminus">-  // If we don't have to create a new session, just return the ID and</span>
<a href="#l2.565"></a><span id="l2.565" class="difflineminus">-  // move on with life</span>
<a href="#l2.566"></a><span id="l2.566" class="difflineminus">-  //</span>
<a href="#l2.567"></a><span id="l2.567" class="difflineminus">-  if (!createNew)</span>
<a href="#l2.568"></a><span id="l2.568" class="difflineminus">-  {</span>
<a href="#l2.569"></a><span id="l2.569" class="difflineminus">-    if (defSession == NULL)</span>
<a href="#l2.570"></a><span id="l2.570" class="difflineminus">-    {</span>
<a href="#l2.571"></a><span id="l2.571" class="difflineminus">-      return(MAPI_E_FAILURE);</span>
<a href="#l2.572"></a><span id="l2.572" class="difflineminus">-    }</span>
<a href="#l2.573"></a><span id="l2.573" class="difflineminus">-</span>
<a href="#l2.574"></a><span id="l2.574" class="difflineminus">-    defSession-&gt;IncrementSessionCount();</span>
<a href="#l2.575"></a><span id="l2.575" class="difflineminus">-    logonInfo-&gt;lhSession = defSession-&gt;GetID();</span>
<a href="#l2.576"></a><span id="l2.576" class="difflineminus">-    return(SUCCESS_SUCCESS);</span>
<a href="#l2.577"></a><span id="l2.577" class="difflineminus">-  }</span>
<a href="#l2.578"></a><span id="l2.578" class="difflineminus">-</span>
<a href="#l2.579"></a><span id="l2.579" class="difflineminus">-  //</span>
<a href="#l2.580"></a><span id="l2.580" class="difflineminus">-  // Finally, create a new session!</span>
<a href="#l2.581"></a><span id="l2.581" class="difflineminus">-  //</span>
<a href="#l2.582"></a><span id="l2.582" class="difflineminus">-  mapiConnections[slot] = new CMAPIConnection(slot, lpszProfileName, lpszPassword);</span>
<a href="#l2.583"></a><span id="l2.583" class="difflineminus">-  if (defSession == NULL)</span>
<a href="#l2.584"></a><span id="l2.584" class="difflineminus">-  {</span>
<a href="#l2.585"></a><span id="l2.585" class="difflineminus">-    mapiConnections[slot]-&gt;SetDefault(TRUE);</span>
<a href="#l2.586"></a><span id="l2.586" class="difflineminus">-  }</span>
<a href="#l2.587"></a><span id="l2.587" class="difflineminus">-</span>
<a href="#l2.588"></a><span id="l2.588" class="difflineminus">-  logonInfo-&gt;lhSession = mapiConnections[slot]-&gt;GetID();</span>
<a href="#l2.589"></a><span id="l2.589" class="difflineminus">-</span>
<a href="#l2.590"></a><span id="l2.590" class="difflineminus">-  //</span>
<a href="#l2.591"></a><span id="l2.591" class="difflineminus">-  // Process Flags...</span>
<a href="#l2.592"></a><span id="l2.592" class="difflineminus">-  //</span>
<a href="#l2.593"></a><span id="l2.593" class="difflineminus">-  // Indicates an attempt should be made to download all of the user's messages before </span>
<a href="#l2.594"></a><span id="l2.594" class="difflineminus">-  // returning. If the MAPI_FORCE_DOWNLOAD flag is not set, messages can be downloaded </span>
<a href="#l2.595"></a><span id="l2.595" class="difflineminus">-  // in the background after the function call returns.</span>
<a href="#l2.596"></a><span id="l2.596" class="difflineminus">-  if (logonInfo-&gt;flFlags &amp; MAPI_FORCE_DOWNLOAD) </span>
<a href="#l2.597"></a><span id="l2.597" class="difflineminus">-  {</span>
<a href="#l2.598"></a><span id="l2.598" class="difflineminus">-    MAPIGetNewMessagesInBackground();</span>
<a href="#l2.599"></a><span id="l2.599" class="difflineminus">-  }</span>
<a href="#l2.600"></a><span id="l2.600" class="difflineminus">-</span>
<a href="#l2.601"></a><span id="l2.601" class="difflineminus">-  // Indicates that a logon dialog box should be displayed to prompt the user for </span>
<a href="#l2.602"></a><span id="l2.602" class="difflineminus">-  // logon information. If the user needs to provide a password and profile name </span>
<a href="#l2.603"></a><span id="l2.603" class="difflineminus">-  // to enable a successful logon, MAPI_LOGON_UI must be set.</span>
<a href="#l2.604"></a><span id="l2.604" class="difflineminus">-  if (logonInfo-&gt;flFlags &amp; MAPI_LOGON_UI) </span>
<a href="#l2.605"></a><span id="l2.605" class="difflineminus">-  {</span>
<a href="#l2.606"></a><span id="l2.606" class="difflineminus">-    TRACE(&quot;MAPI: ProcessMAPILogon() MAPI_LOGON_UI Unsupported.\n&quot;);</span>
<a href="#l2.607"></a><span id="l2.607" class="difflineminus">-  }</span>
<a href="#l2.608"></a><span id="l2.608" class="difflineminus">-</span>
<a href="#l2.609"></a><span id="l2.609" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.610"></a><span id="l2.610" class="difflineminus">-  // Indicates that MAPILogon should only prompt for a password and not allow the user </span>
<a href="#l2.611"></a><span id="l2.611" class="difflineminus">-  // to change the profile name. Either MAPI_PASSWORD_UI or MAPI_LOGON_UI should not be </span>
<a href="#l2.612"></a><span id="l2.612" class="difflineminus">-  // set, since the intent is to select between two different dialog boxes for logon.</span>
<a href="#l2.613"></a><span id="l2.613" class="difflineminus">-  if (logonInfo-&gt;flFlags &amp; MAPI_PASSWORD_UI)</span>
<a href="#l2.614"></a><span id="l2.614" class="difflineminus">-  {</span>
<a href="#l2.615"></a><span id="l2.615" class="difflineminus">-    TRACE(&quot;MAPI: ProcessMAPILogon() MAPI_PASSWORD_UI Unsupported.\n&quot;);</span>
<a href="#l2.616"></a><span id="l2.616" class="difflineminus">-  }         </span>
<a href="#l2.617"></a><span id="l2.617" class="difflineminus">-#endif  </span>
<a href="#l2.618"></a><span id="l2.618" class="difflineminus">-  </span>
<a href="#l2.619"></a><span id="l2.619" class="difflineminus">-  return(SUCCESS_SUCCESS);</span>
<a href="#l2.620"></a><span id="l2.620" class="difflineminus">-}</span>
<a href="#l2.621"></a><span id="l2.621" class="difflineminus">-</span>
<a href="#l2.622"></a><span id="l2.622" class="difflineminus">-LONG    </span>
<a href="#l2.623"></a><span id="l2.623" class="difflineminus">-ProcessMAPILogoff(MAPILogoffType *logoffInfo)</span>
<a href="#l2.624"></a><span id="l2.624" class="difflineminus">-{</span>
<a href="#l2.625"></a><span id="l2.625" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPILogoff() Session ID = [%d]\n&quot;, logoffInfo-&gt;lhSession);</span>
<a href="#l2.626"></a><span id="l2.626" class="difflineminus">-  //</span>
<a href="#l2.627"></a><span id="l2.627" class="difflineminus">-  // Verify the session handle...</span>
<a href="#l2.628"></a><span id="l2.628" class="difflineminus">-  //</span>
<a href="#l2.629"></a><span id="l2.629" class="difflineminus">-  if (( (logoffInfo-&gt;lhSession-1) &gt;= MAX_CON) || ( (logoffInfo-&gt;lhSession-1) &lt; 0))</span>
<a href="#l2.630"></a><span id="l2.630" class="difflineminus">-  {</span>
<a href="#l2.631"></a><span id="l2.631" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.632"></a><span id="l2.632" class="difflineminus">-  }</span>
<a href="#l2.633"></a><span id="l2.633" class="difflineminus">-</span>
<a href="#l2.634"></a><span id="l2.634" class="difflineminus">-  CMAPIConnection *logoffSession = mapiConnections[(logoffInfo-&gt;lhSession - 1)];</span>
<a href="#l2.635"></a><span id="l2.635" class="difflineminus">-  if (logoffSession == NULL)</span>
<a href="#l2.636"></a><span id="l2.636" class="difflineminus">-  {</span>
<a href="#l2.637"></a><span id="l2.637" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.638"></a><span id="l2.638" class="difflineminus">-  }</span>
<a href="#l2.639"></a><span id="l2.639" class="difflineminus">-  </span>
<a href="#l2.640"></a><span id="l2.640" class="difflineminus">-  //</span>
<a href="#l2.641"></a><span id="l2.641" class="difflineminus">-  // Decrement the session count, then if this is the last one </span>
<a href="#l2.642"></a><span id="l2.642" class="difflineminus">-  // connected to this session, then kill it...</span>
<a href="#l2.643"></a><span id="l2.643" class="difflineminus">-  //</span>
<a href="#l2.644"></a><span id="l2.644" class="difflineminus">-  logoffSession-&gt;DecrementSessionCount();</span>
<a href="#l2.645"></a><span id="l2.645" class="difflineminus">-  if (logoffSession-&gt;GetSessionCount() &lt;= 0)</span>
<a href="#l2.646"></a><span id="l2.646" class="difflineminus">-  {</span>
<a href="#l2.647"></a><span id="l2.647" class="difflineminus">-    //</span>
<a href="#l2.648"></a><span id="l2.648" class="difflineminus">-    // If this was the default session &quot;holder&quot;, then we need to </span>
<a href="#l2.649"></a><span id="l2.649" class="difflineminus">-    // assign that task to a new one if it exists, if not, then</span>
<a href="#l2.650"></a><span id="l2.650" class="difflineminus">-    // it is all back to null.</span>
<a href="#l2.651"></a><span id="l2.651" class="difflineminus">-    //</span>
<a href="#l2.652"></a><span id="l2.652" class="difflineminus">-    BOOL needToReassign = logoffSession-&gt;IsDefault();</span>
<a href="#l2.653"></a><span id="l2.653" class="difflineminus">-</span>
<a href="#l2.654"></a><span id="l2.654" class="difflineminus">-    delete logoffSession;</span>
<a href="#l2.655"></a><span id="l2.655" class="difflineminus">-    mapiConnections[logoffInfo-&gt;lhSession - 1] = NULL;</span>
<a href="#l2.656"></a><span id="l2.656" class="difflineminus">-</span>
<a href="#l2.657"></a><span id="l2.657" class="difflineminus">-    if (needToReassign)</span>
<a href="#l2.658"></a><span id="l2.658" class="difflineminus">-    {</span>
<a href="#l2.659"></a><span id="l2.659" class="difflineminus">-      TRACE(&quot;MAPI: ProcessMAPILogoff() Need to reassign default\n&quot;);</span>
<a href="#l2.660"></a><span id="l2.660" class="difflineminus">-      if (!TryDefaultReassignment())</span>
<a href="#l2.661"></a><span id="l2.661" class="difflineminus">-      {</span>
<a href="#l2.662"></a><span id="l2.662" class="difflineminus">-        if (pMAPIFrameWnd != NULL)</span>
<a href="#l2.663"></a><span id="l2.663" class="difflineminus">-        {</span>
<a href="#l2.664"></a><span id="l2.664" class="difflineminus">-          pMAPIFrameWnd-&gt;PostMessage(WM_CLOSE);</span>
<a href="#l2.665"></a><span id="l2.665" class="difflineminus">-          pMAPIFrameWnd = NULL;</span>
<a href="#l2.666"></a><span id="l2.666" class="difflineminus">-        }</span>
<a href="#l2.667"></a><span id="l2.667" class="difflineminus">-      }</span>
<a href="#l2.668"></a><span id="l2.668" class="difflineminus">-    }</span>
<a href="#l2.669"></a><span id="l2.669" class="difflineminus">-  }</span>
<a href="#l2.670"></a><span id="l2.670" class="difflineminus">-</span>
<a href="#l2.671"></a><span id="l2.671" class="difflineminus">-  return(SUCCESS_SUCCESS);</span>
<a href="#l2.672"></a><span id="l2.672" class="difflineminus">-}</span>
<a href="#l2.673"></a><span id="l2.673" class="difflineminus">-</span>
<a href="#l2.674"></a><span id="l2.674" class="difflineminus">-//</span>
<a href="#l2.675"></a><span id="l2.675" class="difflineminus">-// Actually process the send mail operation...</span>
<a href="#l2.676"></a><span id="l2.676" class="difflineminus">-//</span>
<a href="#l2.677"></a><span id="l2.677" class="difflineminus">-LONG    </span>
<a href="#l2.678"></a><span id="l2.678" class="difflineminus">-ProcessMAPISendMail(MAPISendMailType *sendMailPtr)</span>
<a href="#l2.679"></a><span id="l2.679" class="difflineminus">-{</span>
<a href="#l2.680"></a><span id="l2.680" class="difflineminus">-  CMAPIConnection *mySession;</span>
<a href="#l2.681"></a><span id="l2.681" class="difflineminus">-  NSstringSeq     mailInfoSeq;</span>
<a href="#l2.682"></a><span id="l2.682" class="difflineminus">-</span>
<a href="#l2.683"></a><span id="l2.683" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPISendMail() Session ID = [%d]\n&quot;, sendMailPtr-&gt;lhSession);</span>
<a href="#l2.684"></a><span id="l2.684" class="difflineminus">-  //</span>
<a href="#l2.685"></a><span id="l2.685" class="difflineminus">-  // Verify the session handle...</span>
<a href="#l2.686"></a><span id="l2.686" class="difflineminus">-  //</span>
<a href="#l2.687"></a><span id="l2.687" class="difflineminus">-  if (((sendMailPtr-&gt;lhSession-1) &gt;= MAX_CON) || ((sendMailPtr-&gt;lhSession-1) &lt; 0))</span>
<a href="#l2.688"></a><span id="l2.688" class="difflineminus">-  {</span>
<a href="#l2.689"></a><span id="l2.689" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l2.690"></a><span id="l2.690" class="difflineminus">-  }</span>
<a href="#l2.691"></a><span id="l2.691" class="difflineminus">-</span>
<a href="#l2.692"></a><span id="l2.692" class="difflineminus">-  mySession = mapiConnections[(sendMailPtr-&gt;lhSession - 1)];</span>
<a href="#l2.693"></a><span id="l2.693" class="difflineminus">-  if (mySession == NULL)</span>
<a href="#l2.694"></a><span id="l2.694" class="difflineminus">-  {</span>
<a href="#l2.695"></a><span id="l2.695" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l2.696"></a><span id="l2.696" class="difflineminus">-  }</span>
<a href="#l2.697"></a><span id="l2.697" class="difflineminus">-</span>
<a href="#l2.698"></a><span id="l2.698" class="difflineminus">-  //</span>
<a href="#l2.699"></a><span id="l2.699" class="difflineminus">-  // Before we start, make sure things make sense...</span>
<a href="#l2.700"></a><span id="l2.700" class="difflineminus">-  //</span>
<a href="#l2.701"></a><span id="l2.701" class="difflineminus">-  if ( (!(sendMailPtr-&gt;flFlags &amp; MAPI_DIALOG)) &amp;&amp; (sendMailPtr-&gt;MSG_nRecipCount == 0) )</span>
<a href="#l2.702"></a><span id="l2.702" class="difflineminus">-  {</span>
<a href="#l2.703"></a><span id="l2.703" class="difflineminus">-    return(MAPI_E_UNKNOWN_RECIPIENT);</span>
<a href="#l2.704"></a><span id="l2.704" class="difflineminus">-  }</span>
<a href="#l2.705"></a><span id="l2.705" class="difflineminus">-</span>
<a href="#l2.706"></a><span id="l2.706" class="difflineminus">-  mailInfoSeq = (NSstringSeq) &amp;(sendMailPtr-&gt;dataBuf[0]);</span>
<a href="#l2.707"></a><span id="l2.707" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPISendMail() Session ID = [%d]\n&quot;, sendMailPtr-&gt;lhSession);</span>
<a href="#l2.708"></a><span id="l2.708" class="difflineminus">-</span>
<a href="#l2.709"></a><span id="l2.709" class="difflineminus">-  //</span>
<a href="#l2.710"></a><span id="l2.710" class="difflineminus">-  // Now set the show window flag...</span>
<a href="#l2.711"></a><span id="l2.711" class="difflineminus">-  //</span>
<a href="#l2.712"></a><span id="l2.712" class="difflineminus">-  BOOL showWindow = (( sendMailPtr-&gt;flFlags &amp; MAPI_DIALOG ) != 0);</span>
<a href="#l2.713"></a><span id="l2.713" class="difflineminus">-  LONG rc = DoFullMAPIMailOperation(sendMailPtr, </span>
<a href="#l2.714"></a><span id="l2.714" class="difflineminus">-                                    NSStrSeqGet(mailInfoSeq, 1),</span>
<a href="#l2.715"></a><span id="l2.715" class="difflineminus">-                                    showWindow);</span>
<a href="#l2.716"></a><span id="l2.716" class="difflineminus">-  return(rc);</span>
<a href="#l2.717"></a><span id="l2.717" class="difflineminus">-}</span>
<a href="#l2.718"></a><span id="l2.718" class="difflineminus">-</span>
<a href="#l2.719"></a><span id="l2.719" class="difflineminus">-//</span>
<a href="#l2.720"></a><span id="l2.720" class="difflineminus">-// Actually process the send mail operation...</span>
<a href="#l2.721"></a><span id="l2.721" class="difflineminus">-//</span>
<a href="#l2.722"></a><span id="l2.722" class="difflineminus">-LONG    </span>
<a href="#l2.723"></a><span id="l2.723" class="difflineminus">-ProcessMAPISaveMail(MAPISendMailType *sendMailPtr)</span>
<a href="#l2.724"></a><span id="l2.724" class="difflineminus">-{</span>
<a href="#l2.725"></a><span id="l2.725" class="difflineminus">-  CMAPIConnection *mySession;</span>
<a href="#l2.726"></a><span id="l2.726" class="difflineminus">-  NSstringSeq     mailInfoSeq;</span>
<a href="#l2.727"></a><span id="l2.727" class="difflineminus">-</span>
<a href="#l2.728"></a><span id="l2.728" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPISaveMail() Session ID = [%d]\n&quot;, sendMailPtr-&gt;lhSession);</span>
<a href="#l2.729"></a><span id="l2.729" class="difflineminus">-  //</span>
<a href="#l2.730"></a><span id="l2.730" class="difflineminus">-  // Verify the session handle...</span>
<a href="#l2.731"></a><span id="l2.731" class="difflineminus">-  //</span>
<a href="#l2.732"></a><span id="l2.732" class="difflineminus">-  if (((sendMailPtr-&gt;lhSession-1) &gt;= MAX_CON) || ((sendMailPtr-&gt;lhSession-1) &lt; 0))</span>
<a href="#l2.733"></a><span id="l2.733" class="difflineminus">-  {</span>
<a href="#l2.734"></a><span id="l2.734" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l2.735"></a><span id="l2.735" class="difflineminus">-  }</span>
<a href="#l2.736"></a><span id="l2.736" class="difflineminus">-</span>
<a href="#l2.737"></a><span id="l2.737" class="difflineminus">-  mySession = mapiConnections[(sendMailPtr-&gt;lhSession - 1)];</span>
<a href="#l2.738"></a><span id="l2.738" class="difflineminus">-  if (mySession == NULL)</span>
<a href="#l2.739"></a><span id="l2.739" class="difflineminus">-  {</span>
<a href="#l2.740"></a><span id="l2.740" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l2.741"></a><span id="l2.741" class="difflineminus">-  }</span>
<a href="#l2.742"></a><span id="l2.742" class="difflineminus">-</span>
<a href="#l2.743"></a><span id="l2.743" class="difflineminus">-  mailInfoSeq = (NSstringSeq) &amp;(sendMailPtr-&gt;dataBuf[0]);</span>
<a href="#l2.744"></a><span id="l2.744" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPISaveMail() Session ID = [%d]\n&quot;, sendMailPtr-&gt;lhSession);</span>
<a href="#l2.745"></a><span id="l2.745" class="difflineminus">-</span>
<a href="#l2.746"></a><span id="l2.746" class="difflineminus">-  //</span>
<a href="#l2.747"></a><span id="l2.747" class="difflineminus">-  // Now process the save mail operation...</span>
<a href="#l2.748"></a><span id="l2.748" class="difflineminus">-  //</span>
<a href="#l2.749"></a><span id="l2.749" class="difflineminus">-  LONG rc = DoMAPISaveMailOperation(sendMailPtr, </span>
<a href="#l2.750"></a><span id="l2.750" class="difflineminus">-                                    NSStrSeqGet(mailInfoSeq, 1));</span>
<a href="#l2.751"></a><span id="l2.751" class="difflineminus">-  return(rc);</span>
<a href="#l2.752"></a><span id="l2.752" class="difflineminus">-}</span>
<a href="#l2.753"></a><span id="l2.753" class="difflineminus">-</span>
<a href="#l2.754"></a><span id="l2.754" class="difflineminus">-//</span>
<a href="#l2.755"></a><span id="l2.755" class="difflineminus">-// Actually process the send documents operation...</span>
<a href="#l2.756"></a><span id="l2.756" class="difflineminus">-//</span>
<a href="#l2.757"></a><span id="l2.757" class="difflineminus">-LONG    </span>
<a href="#l2.758"></a><span id="l2.758" class="difflineminus">-ProcessMAPISendDocuments(MAPISendDocumentsType *sendDocPtr)</span>
<a href="#l2.759"></a><span id="l2.759" class="difflineminus">-{</span>
<a href="#l2.760"></a><span id="l2.760" class="difflineminus">-  LONG rc = DoPartialMAPIMailOperation(sendDocPtr);    </span>
<a href="#l2.761"></a><span id="l2.761" class="difflineminus">-  return(rc);</span>
<a href="#l2.762"></a><span id="l2.762" class="difflineminus">-}</span>
<a href="#l2.763"></a><span id="l2.763" class="difflineminus">-</span>
<a href="#l2.764"></a><span id="l2.764" class="difflineminus">-//</span>
<a href="#l2.765"></a><span id="l2.765" class="difflineminus">-// This is an ENUM procedure for messages that are in the system</span>
<a href="#l2.766"></a><span id="l2.766" class="difflineminus">-//</span>
<a href="#l2.767"></a><span id="l2.767" class="difflineminus">-LONG    </span>
<a href="#l2.768"></a><span id="l2.768" class="difflineminus">-ProcessMAPIFindNext(MAPIFindNextType *findInfo)</span>
<a href="#l2.769"></a><span id="l2.769" class="difflineminus">-{</span>
<a href="#l2.770"></a><span id="l2.770" class="difflineminus">-  CMAPIConnection *mySession;</span>
<a href="#l2.771"></a><span id="l2.771" class="difflineminus">-</span>
<a href="#l2.772"></a><span id="l2.772" class="difflineminus">-  //</span>
<a href="#l2.773"></a><span id="l2.773" class="difflineminus">-  // Verify the session handle...</span>
<a href="#l2.774"></a><span id="l2.774" class="difflineminus">-  //</span>
<a href="#l2.775"></a><span id="l2.775" class="difflineminus">-  if (((findInfo-&gt;lhSession-1) &gt;= MAX_CON) || ((findInfo-&gt;lhSession-1) &lt; 0))</span>
<a href="#l2.776"></a><span id="l2.776" class="difflineminus">-  {</span>
<a href="#l2.777"></a><span id="l2.777" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.778"></a><span id="l2.778" class="difflineminus">-  }</span>
<a href="#l2.779"></a><span id="l2.779" class="difflineminus">-</span>
<a href="#l2.780"></a><span id="l2.780" class="difflineminus">-  mySession = mapiConnections[(findInfo-&gt;lhSession - 1)];</span>
<a href="#l2.781"></a><span id="l2.781" class="difflineminus">-  if (mySession == NULL)</span>
<a href="#l2.782"></a><span id="l2.782" class="difflineminus">-  {</span>
<a href="#l2.783"></a><span id="l2.783" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.784"></a><span id="l2.784" class="difflineminus">-  }</span>
<a href="#l2.785"></a><span id="l2.785" class="difflineminus">-</span>
<a href="#l2.786"></a><span id="l2.786" class="difflineminus">-  //</span>
<a href="#l2.787"></a><span id="l2.787" class="difflineminus">-  // If this is true, then this is the first call to this FindNext function</span>
<a href="#l2.788"></a><span id="l2.788" class="difflineminus">-  // and we should start the enumeration operation.</span>
<a href="#l2.789"></a><span id="l2.789" class="difflineminus">-  //</span>
<a href="#l2.790"></a><span id="l2.790" class="difflineminus">-	MSG_FolderInfo  *inboxFolder = NULL;</span>
<a href="#l2.791"></a><span id="l2.791" class="difflineminus">-	int32           folderRC = MSG_GetFoldersWithFlag(WFE_MSGGetMaster(),</span>
<a href="#l2.792"></a><span id="l2.792" class="difflineminus">-        										MSG_FOLDER_FLAG_INBOX, &amp;inboxFolder, 1);</span>
<a href="#l2.793"></a><span id="l2.793" class="difflineminus">-  if (folderRC &lt;= 0)</span>
<a href="#l2.794"></a><span id="l2.794" class="difflineminus">-  {</span>
<a href="#l2.795"></a><span id="l2.795" class="difflineminus">-    return(MAPI_E_NO_MESSAGES);</span>
<a href="#l2.796"></a><span id="l2.796" class="difflineminus">-  }</span>
<a href="#l2.797"></a><span id="l2.797" class="difflineminus">-</span>
<a href="#l2.798"></a><span id="l2.798" class="difflineminus">-  // This is the first message</span>
<a href="#l2.799"></a><span id="l2.799" class="difflineminus">-  if (mySession-&gt;GetMessageIndex() &lt; 0)</span>
<a href="#l2.800"></a><span id="l2.800" class="difflineminus">-  {</span>
<a href="#l2.801"></a><span id="l2.801" class="difflineminus">-    MSG_MapiListContext *cookie;</span>
<a href="#l2.802"></a><span id="l2.802" class="difflineminus">-</span>
<a href="#l2.803"></a><span id="l2.803" class="difflineminus">-    MessageKey keyFound = MSG_GetFirstKeyInFolder(inboxFolder, &amp;cookie);</span>
<a href="#l2.804"></a><span id="l2.804" class="difflineminus">-    if (keyFound == MSG_MESSAGEKEYNONE)</span>
<a href="#l2.805"></a><span id="l2.805" class="difflineminus">-    {</span>
<a href="#l2.806"></a><span id="l2.806" class="difflineminus">-      mySession-&gt;SetMapiListContext(NULL);</span>
<a href="#l2.807"></a><span id="l2.807" class="difflineminus">-      mySession-&gt;SetMessageIndex(-1); // Reset to -1...</span>
<a href="#l2.808"></a><span id="l2.808" class="difflineminus">-      return(MAPI_E_NO_MESSAGES);</span>
<a href="#l2.809"></a><span id="l2.809" class="difflineminus">-    }</span>
<a href="#l2.810"></a><span id="l2.810" class="difflineminus">-</span>
<a href="#l2.811"></a><span id="l2.811" class="difflineminus">-    TRACE(&quot;MAPI: ProcessMAPIFindNext() Found message id = %d\n&quot;, keyFound);</span>
<a href="#l2.812"></a><span id="l2.812" class="difflineminus">-</span>
<a href="#l2.813"></a><span id="l2.813" class="difflineminus">-    wsprintf((LPSTR) findInfo-&gt;lpszMessageID, &quot;%d&quot;, keyFound);</span>
<a href="#l2.814"></a><span id="l2.814" class="difflineminus">-    mySession-&gt;SetMapiListContext(cookie);</span>
<a href="#l2.815"></a><span id="l2.815" class="difflineminus">-    mySession-&gt;SetMessageIndex(keyFound); // Just set to 1 and then increment from there...</span>
<a href="#l2.816"></a><span id="l2.816" class="difflineminus">-  }</span>
<a href="#l2.817"></a><span id="l2.817" class="difflineminus">-  else</span>
<a href="#l2.818"></a><span id="l2.818" class="difflineminus">-  {</span>
<a href="#l2.819"></a><span id="l2.819" class="difflineminus">-    MSG_MapiListContext *cookie = (MSG_MapiListContext *)mySession-&gt;GetMapiListContext();</span>
<a href="#l2.820"></a><span id="l2.820" class="difflineminus">-    </span>
<a href="#l2.821"></a><span id="l2.821" class="difflineminus">-    // Sanity check the cookie value...</span>
<a href="#l2.822"></a><span id="l2.822" class="difflineminus">-    if (cookie == NULL)</span>
<a href="#l2.823"></a><span id="l2.823" class="difflineminus">-    {</span>
<a href="#l2.824"></a><span id="l2.824" class="difflineminus">-      mySession-&gt;SetMapiListContext(NULL);</span>
<a href="#l2.825"></a><span id="l2.825" class="difflineminus">-      mySession-&gt;SetMessageIndex(-1); // Reset to -1...</span>
<a href="#l2.826"></a><span id="l2.826" class="difflineminus">-      return(MAPI_E_NO_MESSAGES);</span>
<a href="#l2.827"></a><span id="l2.827" class="difflineminus">-    }</span>
<a href="#l2.828"></a><span id="l2.828" class="difflineminus">-</span>
<a href="#l2.829"></a><span id="l2.829" class="difflineminus">-    MessageKey nextKey = MSG_GetNextKeyInFolder(cookie);</span>
<a href="#l2.830"></a><span id="l2.830" class="difflineminus">-    if (nextKey == MSG_MESSAGEKEYNONE)</span>
<a href="#l2.831"></a><span id="l2.831" class="difflineminus">-    {</span>
<a href="#l2.832"></a><span id="l2.832" class="difflineminus">-      mySession-&gt;SetMapiListContext(NULL);</span>
<a href="#l2.833"></a><span id="l2.833" class="difflineminus">-      mySession-&gt;SetMessageIndex(-1); // Reset to -1...</span>
<a href="#l2.834"></a><span id="l2.834" class="difflineminus">-      return(MAPI_E_NO_MESSAGES);</span>
<a href="#l2.835"></a><span id="l2.835" class="difflineminus">-    }</span>
<a href="#l2.836"></a><span id="l2.836" class="difflineminus">-</span>
<a href="#l2.837"></a><span id="l2.837" class="difflineminus">-    TRACE(&quot;MAPI: ProcessMAPIFindNext() Found message id = %d\n&quot;, nextKey);</span>
<a href="#l2.838"></a><span id="l2.838" class="difflineminus">-</span>
<a href="#l2.839"></a><span id="l2.839" class="difflineminus">-    wsprintf((LPSTR) findInfo-&gt;lpszMessageID, &quot;%d&quot;, nextKey);</span>
<a href="#l2.840"></a><span id="l2.840" class="difflineminus">-    mySession-&gt;SetMessageIndex(nextKey); // Set the key to the found one and move on...</span>
<a href="#l2.841"></a><span id="l2.841" class="difflineminus">-  }</span>
<a href="#l2.842"></a><span id="l2.842" class="difflineminus">-</span>
<a href="#l2.843"></a><span id="l2.843" class="difflineminus">-  return(SUCCESS_SUCCESS);</span>
<a href="#l2.844"></a><span id="l2.844" class="difflineminus">-}</span>
<a href="#l2.845"></a><span id="l2.845" class="difflineminus">-</span>
<a href="#l2.846"></a><span id="l2.846" class="difflineminus">-//</span>
<a href="#l2.847"></a><span id="l2.847" class="difflineminus">-// Actually process the delete mail operation!</span>
<a href="#l2.848"></a><span id="l2.848" class="difflineminus">-//</span>
<a href="#l2.849"></a><span id="l2.849" class="difflineminus">-LONG    </span>
<a href="#l2.850"></a><span id="l2.850" class="difflineminus">-ProcessMAPIDeleteMail(MAPIDeleteMailType *delInfo)</span>
<a href="#l2.851"></a><span id="l2.851" class="difflineminus">-{</span>
<a href="#l2.852"></a><span id="l2.852" class="difflineminus">-  CMAPIConnection *mySession;</span>
<a href="#l2.853"></a><span id="l2.853" class="difflineminus">-</span>
<a href="#l2.854"></a><span id="l2.854" class="difflineminus">-  //</span>
<a href="#l2.855"></a><span id="l2.855" class="difflineminus">-  // Verify the session handle...</span>
<a href="#l2.856"></a><span id="l2.856" class="difflineminus">-  //</span>
<a href="#l2.857"></a><span id="l2.857" class="difflineminus">-  if (((delInfo-&gt;lhSession-1) &gt;= MAX_CON) || ((delInfo-&gt;lhSession-1) &lt; 0))</span>
<a href="#l2.858"></a><span id="l2.858" class="difflineminus">-  {</span>
<a href="#l2.859"></a><span id="l2.859" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.860"></a><span id="l2.860" class="difflineminus">-  }</span>
<a href="#l2.861"></a><span id="l2.861" class="difflineminus">-</span>
<a href="#l2.862"></a><span id="l2.862" class="difflineminus">-  mySession = mapiConnections[(delInfo-&gt;lhSession - 1)];</span>
<a href="#l2.863"></a><span id="l2.863" class="difflineminus">-  if (mySession == NULL)</span>
<a href="#l2.864"></a><span id="l2.864" class="difflineminus">-  {</span>
<a href="#l2.865"></a><span id="l2.865" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.866"></a><span id="l2.866" class="difflineminus">-  }</span>
<a href="#l2.867"></a><span id="l2.867" class="difflineminus">-</span>
<a href="#l2.868"></a><span id="l2.868" class="difflineminus">-  BOOL    msgValid = TRUE;</span>
<a href="#l2.869"></a><span id="l2.869" class="difflineminus">-</span>
<a href="#l2.870"></a><span id="l2.870" class="difflineminus">-  TRACE(&quot;MAPI: RICHIE TODO: ProcessMAPIDeleteMail() TRY TO FIND THE MESSAGE FROM THE IDENTIFIER:\n&quot;);</span>
<a href="#l2.871"></a><span id="l2.871" class="difflineminus">-  TRACE(&quot;MAPI: RICHIE TODO: ProcessMAPIDeleteMail() [%s]\n&quot;, delInfo-&gt;lpszMessageID);</span>
<a href="#l2.872"></a><span id="l2.872" class="difflineminus">-</span>
<a href="#l2.873"></a><span id="l2.873" class="difflineminus">-  if (msgValid)</span>
<a href="#l2.874"></a><span id="l2.874" class="difflineminus">-  {</span>
<a href="#l2.875"></a><span id="l2.875" class="difflineminus">-    TRACE(&quot;MAPI: RICHIE TODO: ProcessMAPIDeleteMail() DELETE THE MESSAGE!!!\n&quot;);</span>
<a href="#l2.876"></a><span id="l2.876" class="difflineminus">-</span>
<a href="#l2.877"></a><span id="l2.877" class="difflineminus">-    return(SUCCESS_SUCCESS);</span>
<a href="#l2.878"></a><span id="l2.878" class="difflineminus">-  }</span>
<a href="#l2.879"></a><span id="l2.879" class="difflineminus">-  else</span>
<a href="#l2.880"></a><span id="l2.880" class="difflineminus">-  {</span>
<a href="#l2.881"></a><span id="l2.881" class="difflineminus">-    return(MAPI_E_INVALID_MESSAGE);</span>
<a href="#l2.882"></a><span id="l2.882" class="difflineminus">-  }</span>
<a href="#l2.883"></a><span id="l2.883" class="difflineminus">-}</span>
<a href="#l2.884"></a><span id="l2.884" class="difflineminus">-</span>
<a href="#l2.885"></a><span id="l2.885" class="difflineminus">-// </span>
<a href="#l2.886"></a><span id="l2.886" class="difflineminus">-// Process the name resolution for the address passed in.</span>
<a href="#l2.887"></a><span id="l2.887" class="difflineminus">-//</span>
<a href="#l2.888"></a><span id="l2.888" class="difflineminus">-LONG    </span>
<a href="#l2.889"></a><span id="l2.889" class="difflineminus">-ProcessMAPIResolveName(MAPIResolveNameType *nameInfo)</span>
<a href="#l2.890"></a><span id="l2.890" class="difflineminus">-{</span>
<a href="#l2.891"></a><span id="l2.891" class="difflineminus">-  CMAPIConnection *mySession;</span>
<a href="#l2.892"></a><span id="l2.892" class="difflineminus">-</span>
<a href="#l2.893"></a><span id="l2.893" class="difflineminus">-  //</span>
<a href="#l2.894"></a><span id="l2.894" class="difflineminus">-  // Verify the session handle...</span>
<a href="#l2.895"></a><span id="l2.895" class="difflineminus">-  //</span>
<a href="#l2.896"></a><span id="l2.896" class="difflineminus">-  if (((nameInfo-&gt;lhSession-1) &gt;= MAX_CON) || ((nameInfo-&gt;lhSession-1) &lt; 0))</span>
<a href="#l2.897"></a><span id="l2.897" class="difflineminus">-  {</span>
<a href="#l2.898"></a><span id="l2.898" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.899"></a><span id="l2.899" class="difflineminus">-  }</span>
<a href="#l2.900"></a><span id="l2.900" class="difflineminus">-</span>
<a href="#l2.901"></a><span id="l2.901" class="difflineminus">-  mySession = mapiConnections[(nameInfo-&gt;lhSession - 1)];</span>
<a href="#l2.902"></a><span id="l2.902" class="difflineminus">-  if (mySession == NULL)</span>
<a href="#l2.903"></a><span id="l2.903" class="difflineminus">-  {</span>
<a href="#l2.904"></a><span id="l2.904" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.905"></a><span id="l2.905" class="difflineminus">-  }</span>
<a href="#l2.906"></a><span id="l2.906" class="difflineminus">-</span>
<a href="#l2.907"></a><span id="l2.907" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPIResolveName() TRY TO IDENTIFY THE ADDRESS INFO FOR THE NAME:\n&quot;);</span>
<a href="#l2.908"></a><span id="l2.908" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPIResolveName() [%s]\n&quot;, nameInfo-&gt;lpszName);</span>
<a href="#l2.909"></a><span id="l2.909" class="difflineminus">-</span>
<a href="#l2.910"></a><span id="l2.910" class="difflineminus">-  DWORD numFound;</span>
<a href="#l2.911"></a><span id="l2.911" class="difflineminus">-  LPSTR retFullName = NULL;</span>
<a href="#l2.912"></a><span id="l2.912" class="difflineminus">-  LPSTR retAddr = NULL;</span>
<a href="#l2.913"></a><span id="l2.913" class="difflineminus">-  </span>
<a href="#l2.914"></a><span id="l2.914" class="difflineminus">-  AB_ContainerInfo  *ctr;</span>
<a href="#l2.915"></a><span id="l2.915" class="difflineminus">-  ABID              id;</span>
<a href="#l2.916"></a><span id="l2.916" class="difflineminus">-</span>
<a href="#l2.917"></a><span id="l2.917" class="difflineminus">-  numFound = AB_MAPI_ResolveName ( </span>
<a href="#l2.918"></a><span id="l2.918" class="difflineminus">-                (char *)nameInfo-&gt;lpszName, // i.e. a nickname or part of the person's name to look up. Assumes First Last </span>
<a href="#l2.919"></a><span id="l2.919" class="difflineminus">-                &amp;ctr,                       // caller allocates the ctr ptr. BE fills Caller must close container when done with it</span>
<a href="#l2.920"></a><span id="l2.920" class="difflineminus">-                &amp;id);                       // caller allocates the ABID, BE fills </span>
<a href="#l2.921"></a><span id="l2.921" class="difflineminus">-</span>
<a href="#l2.922"></a><span id="l2.922" class="difflineminus">-  if (numFound &gt; 1)</span>
<a href="#l2.923"></a><span id="l2.923" class="difflineminus">-  {</span>
<a href="#l2.924"></a><span id="l2.924" class="difflineminus">-    return(MAPI_E_AMBIGUOUS_RECIPIENT);</span>
<a href="#l2.925"></a><span id="l2.925" class="difflineminus">-  }</span>
<a href="#l2.926"></a><span id="l2.926" class="difflineminus">-  else if (numFound &lt;= 0)</span>
<a href="#l2.927"></a><span id="l2.927" class="difflineminus">-  {</span>
<a href="#l2.928"></a><span id="l2.928" class="difflineminus">-    return(MAPI_E_UNKNOWN_RECIPIENT);</span>
<a href="#l2.929"></a><span id="l2.929" class="difflineminus">-  }</span>
<a href="#l2.930"></a><span id="l2.930" class="difflineminus">-  else    // Here we found a single entry!</span>
<a href="#l2.931"></a><span id="l2.931" class="difflineminus">-  {</span>
<a href="#l2.932"></a><span id="l2.932" class="difflineminus">-    // Get the full name and email address...</span>
<a href="#l2.933"></a><span id="l2.933" class="difflineminus">-    retFullName = AB_MAPI_GetFullName(ctr, id);</span>
<a href="#l2.934"></a><span id="l2.934" class="difflineminus">-    retAddr = AB_MAPI_GetEmailAddress(ctr, id);</span>
<a href="#l2.935"></a><span id="l2.935" class="difflineminus">-</span>
<a href="#l2.936"></a><span id="l2.936" class="difflineminus">-    // null out return values just in case...</span>
<a href="#l2.937"></a><span id="l2.937" class="difflineminus">-    nameInfo-&gt;lpszABookName[0] = '\0';</span>
<a href="#l2.938"></a><span id="l2.938" class="difflineminus">-    nameInfo-&gt;lpszABookAddress[0] = '\0';</span>
<a href="#l2.939"></a><span id="l2.939" class="difflineminus">-</span>
<a href="#l2.940"></a><span id="l2.940" class="difflineminus">-    // if valid, copy the strings over...</span>
<a href="#l2.941"></a><span id="l2.941" class="difflineminus">-    if (retFullName)</span>
<a href="#l2.942"></a><span id="l2.942" class="difflineminus">-      lstrcpy((LPSTR) nameInfo-&gt;lpszABookName, retFullName);</span>
<a href="#l2.943"></a><span id="l2.943" class="difflineminus">-    if (retAddr)</span>
<a href="#l2.944"></a><span id="l2.944" class="difflineminus">-      lstrcpy((LPSTR) nameInfo-&gt;lpszABookAddress, retAddr);</span>
<a href="#l2.945"></a><span id="l2.945" class="difflineminus">-</span>
<a href="#l2.946"></a><span id="l2.946" class="difflineminus">-    // Now get the string to use for an ID later on...</span>
<a href="#l2.947"></a><span id="l2.947" class="difflineminus">-    LPSTR  abookIDString =  AB_MAPI_ConvertToDescription(ctr); </span>
<a href="#l2.948"></a><span id="l2.948" class="difflineminus">-</span>
<a href="#l2.949"></a><span id="l2.949" class="difflineminus">-    // build that string ID to pass back through the MAPI API</span>
<a href="#l2.950"></a><span id="l2.950" class="difflineminus">-    wsprintf((LPSTR) nameInfo-&gt;lpszABookID, &quot;%d%s&quot;, id, DELIMIT);</span>
<a href="#l2.951"></a><span id="l2.951" class="difflineminus">-    lstrcat((LPSTR) nameInfo-&gt;lpszABookID, abookIDString);</span>
<a href="#l2.952"></a><span id="l2.952" class="difflineminus">-    </span>
<a href="#l2.953"></a><span id="l2.953" class="difflineminus">-    // Be nice and cleanup after ourselves...</span>
<a href="#l2.954"></a><span id="l2.954" class="difflineminus">-    if (retAddr)</span>
<a href="#l2.955"></a><span id="l2.955" class="difflineminus">-      XP_FREE(retAddr);</span>
<a href="#l2.956"></a><span id="l2.956" class="difflineminus">-    if (retFullName)</span>
<a href="#l2.957"></a><span id="l2.957" class="difflineminus">-      XP_FREE(retFullName);</span>
<a href="#l2.958"></a><span id="l2.958" class="difflineminus">-    if (abookIDString)</span>
<a href="#l2.959"></a><span id="l2.959" class="difflineminus">-      XP_FREE(abookIDString);</span>
<a href="#l2.960"></a><span id="l2.960" class="difflineminus">-</span>
<a href="#l2.961"></a><span id="l2.961" class="difflineminus">-    return(SUCCESS_SUCCESS);</span>
<a href="#l2.962"></a><span id="l2.962" class="difflineminus">-  }</span>
<a href="#l2.963"></a><span id="l2.963" class="difflineminus">-}</span>
<a href="#l2.964"></a><span id="l2.964" class="difflineminus">-</span>
<a href="#l2.965"></a><span id="l2.965" class="difflineminus">-//</span>
<a href="#l2.966"></a><span id="l2.966" class="difflineminus">-// This deals with the MAPIDetails call</span>
<a href="#l2.967"></a><span id="l2.967" class="difflineminus">-//</span>
<a href="#l2.968"></a><span id="l2.968" class="difflineminus">-LONG    </span>
<a href="#l2.969"></a><span id="l2.969" class="difflineminus">-ProcessMAPIDetails(MAPIDetailsType *detailInfo)</span>
<a href="#l2.970"></a><span id="l2.970" class="difflineminus">-{</span>
<a href="#l2.971"></a><span id="l2.971" class="difflineminus">-  CMAPIConnection *mySession;</span>
<a href="#l2.972"></a><span id="l2.972" class="difflineminus">-</span>
<a href="#l2.973"></a><span id="l2.973" class="difflineminus">-  //</span>
<a href="#l2.974"></a><span id="l2.974" class="difflineminus">-  // Verify the session handle...</span>
<a href="#l2.975"></a><span id="l2.975" class="difflineminus">-  //</span>
<a href="#l2.976"></a><span id="l2.976" class="difflineminus">-  if (((detailInfo-&gt;lhSession-1) &gt;= MAX_CON) || ((detailInfo-&gt;lhSession-1) &lt; 0))</span>
<a href="#l2.977"></a><span id="l2.977" class="difflineminus">-  {</span>
<a href="#l2.978"></a><span id="l2.978" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.979"></a><span id="l2.979" class="difflineminus">-  }</span>
<a href="#l2.980"></a><span id="l2.980" class="difflineminus">-</span>
<a href="#l2.981"></a><span id="l2.981" class="difflineminus">-  mySession = mapiConnections[(detailInfo-&gt;lhSession - 1)];</span>
<a href="#l2.982"></a><span id="l2.982" class="difflineminus">-  if (mySession == NULL)</span>
<a href="#l2.983"></a><span id="l2.983" class="difflineminus">-  {</span>
<a href="#l2.984"></a><span id="l2.984" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.985"></a><span id="l2.985" class="difflineminus">-  }</span>
<a href="#l2.986"></a><span id="l2.986" class="difflineminus">-</span>
<a href="#l2.987"></a><span id="l2.987" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPIDetails() NEED TO LOCATE THE ENTRY FOR:\n&quot;);</span>
<a href="#l2.988"></a><span id="l2.988" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPIDetails() [%s]\n&quot;, detailInfo-&gt;lpszABookID);</span>
<a href="#l2.989"></a><span id="l2.989" class="difflineminus">-</span>
<a href="#l2.990"></a><span id="l2.990" class="difflineminus">-  char    workString[MAX_NAME_LEN];</span>
<a href="#l2.991"></a><span id="l2.991" class="difflineminus">-  char    *idString;</span>
<a href="#l2.992"></a><span id="l2.992" class="difflineminus">-  char    *containerString;</span>
<a href="#l2.993"></a><span id="l2.993" class="difflineminus">-</span>
<a href="#l2.994"></a><span id="l2.994" class="difflineminus">-  lstrcpy((LPSTR) workString, (LPSTR) detailInfo-&gt;lpszABookID);</span>
<a href="#l2.995"></a><span id="l2.995" class="difflineminus">-</span>
<a href="#l2.996"></a><span id="l2.996" class="difflineminus">-  //</span>
<a href="#l2.997"></a><span id="l2.997" class="difflineminus">-  // Now parse out the first and last names of the person...</span>
<a href="#l2.998"></a><span id="l2.998" class="difflineminus">-  //</span>
<a href="#l2.999"></a><span id="l2.999" class="difflineminus">-  int       totLen = lstrlen((LPSTR) workString);</span>
<a href="#l2.1000"></a><span id="l2.1000" class="difflineminus">-  int       loc = 0;</span>
<a href="#l2.1001"></a><span id="l2.1001" class="difflineminus">-  idString = &amp;(workString[0]);</span>
<a href="#l2.1002"></a><span id="l2.1002" class="difflineminus">-</span>
<a href="#l2.1003"></a><span id="l2.1003" class="difflineminus">-  while ( ( lstrlen((LPSTR) DELIMIT) + loc) &lt; totLen)</span>
<a href="#l2.1004"></a><span id="l2.1004" class="difflineminus">-  {</span>
<a href="#l2.1005"></a><span id="l2.1005" class="difflineminus">-    if (strncmp((LPSTR)(workString + loc), DELIMIT, lstrlen(DELIMIT)) == 0)</span>
<a href="#l2.1006"></a><span id="l2.1006" class="difflineminus">-    {</span>
<a href="#l2.1007"></a><span id="l2.1007" class="difflineminus">-      workString[loc] = '\0';</span>
<a href="#l2.1008"></a><span id="l2.1008" class="difflineminus">-      containerString = &amp;(workString[loc + lstrlen(DELIMIT)]);</span>
<a href="#l2.1009"></a><span id="l2.1009" class="difflineminus">-      break;</span>
<a href="#l2.1010"></a><span id="l2.1010" class="difflineminus">-    }</span>
<a href="#l2.1011"></a><span id="l2.1011" class="difflineminus">-</span>
<a href="#l2.1012"></a><span id="l2.1012" class="difflineminus">-    ++loc;</span>
<a href="#l2.1013"></a><span id="l2.1013" class="difflineminus">-  }</span>
<a href="#l2.1014"></a><span id="l2.1014" class="difflineminus">-    </span>
<a href="#l2.1015"></a><span id="l2.1015" class="difflineminus">-  if ( (lstrlen((LPSTR) DELIMIT) + loc) &gt;= totLen )</span>
<a href="#l2.1016"></a><span id="l2.1016" class="difflineminus">-  {</span>
<a href="#l2.1017"></a><span id="l2.1017" class="difflineminus">-    return(MAPI_E_INVALID_RECIPS);</span>
<a href="#l2.1018"></a><span id="l2.1018" class="difflineminus">-  }</span>
<a href="#l2.1019"></a><span id="l2.1019" class="difflineminus">-</span>
<a href="#l2.1020"></a><span id="l2.1020" class="difflineminus">-  // Now, convert the stuff to real values for the API...</span>
<a href="#l2.1021"></a><span id="l2.1021" class="difflineminus">-  ABID              id = atoi((const char *) idString);</span>
<a href="#l2.1022"></a><span id="l2.1022" class="difflineminus">-  AB_ContainerInfo  *container = AB_MAPI_ConvertToContainer(containerString);</span>
<a href="#l2.1023"></a><span id="l2.1023" class="difflineminus">-  MSG_Pane          *personPane = NULL;</span>
<a href="#l2.1024"></a><span id="l2.1024" class="difflineminus">-  extern MWContext         *GetUsableContext(void);</span>
<a href="#l2.1025"></a><span id="l2.1025" class="difflineminus">-</span>
<a href="#l2.1026"></a><span id="l2.1026" class="difflineminus">-  // Need to first create a person entry pane and then call</span>
<a href="#l2.1027"></a><span id="l2.1027" class="difflineminus">-  // FE_ShowPropertySheetAB2 on that pane - return 0 is problem</span>
<a href="#l2.1028"></a><span id="l2.1028" class="difflineminus">-  int rc = AB_MAPI_CreatePropertySheetPane( </span>
<a href="#l2.1029"></a><span id="l2.1029" class="difflineminus">-            GetUsableContext(),</span>
<a href="#l2.1030"></a><span id="l2.1030" class="difflineminus">-            WFE_MSGGetMaster(), </span>
<a href="#l2.1031"></a><span id="l2.1031" class="difflineminus">-            container, </span>
<a href="#l2.1032"></a><span id="l2.1032" class="difflineminus">-            id, </span>
<a href="#l2.1033"></a><span id="l2.1033" class="difflineminus">-            &amp;personPane);  // BE will allocate a personPane and return a ptr to it here </span>
<a href="#l2.1034"></a><span id="l2.1034" class="difflineminus">-  if (!rc)</span>
<a href="#l2.1035"></a><span id="l2.1035" class="difflineminus">-  {</span>
<a href="#l2.1036"></a><span id="l2.1036" class="difflineminus">-    return(MAPI_E_INVALID_RECIPS);</span>
<a href="#l2.1037"></a><span id="l2.1037" class="difflineminus">-  }</span>
<a href="#l2.1038"></a><span id="l2.1038" class="difflineminus">-</span>
<a href="#l2.1039"></a><span id="l2.1039" class="difflineminus">-  // Now display the address book entry for this user. If the parameter</span>
<a href="#l2.1040"></a><span id="l2.1040" class="difflineminus">-  // detailInfo-&gt;ulUIParam  is NULL, just doit and return, but if it is</span>
<a href="#l2.1041"></a><span id="l2.1041" class="difflineminus">-  // not NULL, then we should do it as application modal.</span>
<a href="#l2.1042"></a><span id="l2.1042" class="difflineminus">-  </span>
<a href="#l2.1043"></a><span id="l2.1043" class="difflineminus">-  // RICHIE - THIS IS NOT IN THE BUILD YET! MUST WAIT</span>
<a href="#l2.1044"></a><span id="l2.1044" class="difflineminus">-  //(void) FE_ShowPropertySheetForAB2(personPane, AB_Person);</span>
<a href="#l2.1045"></a><span id="l2.1045" class="difflineminus">-</span>
<a href="#l2.1046"></a><span id="l2.1046" class="difflineminus">-  // cleanup the container and person pane...</span>
<a href="#l2.1047"></a><span id="l2.1047" class="difflineminus">-  AB_MAPI_CloseContainer(&amp;container);</span>
<a href="#l2.1048"></a><span id="l2.1048" class="difflineminus">-  AB_ClosePane(personPane); </span>
<a href="#l2.1049"></a><span id="l2.1049" class="difflineminus">-</span>
<a href="#l2.1050"></a><span id="l2.1050" class="difflineminus">-  return(SUCCESS_SUCCESS);</span>
<a href="#l2.1051"></a><span id="l2.1051" class="difflineminus">-}</span>
<a href="#l2.1052"></a><span id="l2.1052" class="difflineminus">-</span>
<a href="#l2.1053"></a><span id="l2.1053" class="difflineminus">-//</span>
<a href="#l2.1054"></a><span id="l2.1054" class="difflineminus">-// CMAPIConnections object...should be in their own file...</span>
<a href="#l2.1055"></a><span id="l2.1055" class="difflineminus">-//</span>
<a href="#l2.1056"></a><span id="l2.1056" class="difflineminus">-CMAPIConnection::CMAPIConnection  ( LONG id, LPSTR name, LPSTR pw)</span>
<a href="#l2.1057"></a><span id="l2.1057" class="difflineminus">-{</span>
<a href="#l2.1058"></a><span id="l2.1058" class="difflineminus">-  m_sessionCount = 1;</span>
<a href="#l2.1059"></a><span id="l2.1059" class="difflineminus">-  m_defaultConnection = FALSE;</span>
<a href="#l2.1060"></a><span id="l2.1060" class="difflineminus">-  m_ID = (id + 1);      // since zero is invalid, but have to make sure we </span>
<a href="#l2.1061"></a><span id="l2.1061" class="difflineminus">-                        // decrement by one when it is passed in again.</span>
<a href="#l2.1062"></a><span id="l2.1062" class="difflineminus">-  m_messageIndex = -1;  // For tracing our way through the FindNext operation</span>
<a href="#l2.1063"></a><span id="l2.1063" class="difflineminus">-  m_cookie = NULL;      // For doing the enumeration of messages</span>
<a href="#l2.1064"></a><span id="l2.1064" class="difflineminus">-  m_messageFindInfo[0] = '\0';</span>
<a href="#l2.1065"></a><span id="l2.1065" class="difflineminus">-  lstrcpy((LPSTR) m_profileName, name);</span>
<a href="#l2.1066"></a><span id="l2.1066" class="difflineminus">-  lstrcpy((LPSTR) m_password, pw);  </span>
<a href="#l2.1067"></a><span id="l2.1067" class="difflineminus">-}</span>
<a href="#l2.1068"></a><span id="l2.1068" class="difflineminus">-</span>
<a href="#l2.1069"></a><span id="l2.1069" class="difflineminus">-CMAPIConnection::~CMAPIConnection ( )</span>
<a href="#l2.1070"></a><span id="l2.1070" class="difflineminus">-{</span>
<a href="#l2.1071"></a><span id="l2.1071" class="difflineminus">-}</span>
<a href="#l2.1072"></a><span id="l2.1072" class="difflineminus">-</span>
<a href="#l2.1073"></a><span id="l2.1073" class="difflineminus">-//</span>
<a href="#l2.1074"></a><span id="l2.1074" class="difflineminus">-// This is all needed to process a MAPIReadMail operation</span>
<a href="#l2.1075"></a><span id="l2.1075" class="difflineminus">-//</span>
<a href="#l2.1076"></a><span id="l2.1076" class="difflineminus">-static LPSTR</span>
<a href="#l2.1077"></a><span id="l2.1077" class="difflineminus">-CheckNull(LPSTR inStr)</span>
<a href="#l2.1078"></a><span id="l2.1078" class="difflineminus">-{</span>
<a href="#l2.1079"></a><span id="l2.1079" class="difflineminus">-  static UCHAR  str[1];</span>
<a href="#l2.1080"></a><span id="l2.1080" class="difflineminus">-</span>
<a href="#l2.1081"></a><span id="l2.1081" class="difflineminus">-  str[0] = '\0';</span>
<a href="#l2.1082"></a><span id="l2.1082" class="difflineminus">-  if (inStr == NULL)</span>
<a href="#l2.1083"></a><span id="l2.1083" class="difflineminus">-    return((LPSTR)str);</span>
<a href="#l2.1084"></a><span id="l2.1084" class="difflineminus">-  else</span>
<a href="#l2.1085"></a><span id="l2.1085" class="difflineminus">-    return(inStr);</span>
<a href="#l2.1086"></a><span id="l2.1086" class="difflineminus">-}</span>
<a href="#l2.1087"></a><span id="l2.1087" class="difflineminus">-</span>
<a href="#l2.1088"></a><span id="l2.1088" class="difflineminus">-LONG</span>
<a href="#l2.1089"></a><span id="l2.1089" class="difflineminus">-WriteTheMemoryBufferToDisk(LPSTR fName, UINT bufSize, LPSTR buf)</span>
<a href="#l2.1090"></a><span id="l2.1090" class="difflineminus">-{</span>
<a href="#l2.1091"></a><span id="l2.1091" class="difflineminus">-  if (!buf)</span>
<a href="#l2.1092"></a><span id="l2.1092" class="difflineminus">-  {</span>
<a href="#l2.1093"></a><span id="l2.1093" class="difflineminus">-    return(-1);</span>
<a href="#l2.1094"></a><span id="l2.1094" class="difflineminus">-  }</span>
<a href="#l2.1095"></a><span id="l2.1095" class="difflineminus">-</span>
<a href="#l2.1096"></a><span id="l2.1096" class="difflineminus">-  HFILE hFile = _lcreat(fName, 0);</span>
<a href="#l2.1097"></a><span id="l2.1097" class="difflineminus">-  if (hFile == HFILE_ERROR)</span>
<a href="#l2.1098"></a><span id="l2.1098" class="difflineminus">-  {</span>
<a href="#l2.1099"></a><span id="l2.1099" class="difflineminus">-    return(-1);</span>
<a href="#l2.1100"></a><span id="l2.1100" class="difflineminus">-  }</span>
<a href="#l2.1101"></a><span id="l2.1101" class="difflineminus">-</span>
<a href="#l2.1102"></a><span id="l2.1102" class="difflineminus">-  UINT writeCount = _lwrite(hFile, buf, bufSize);</span>
<a href="#l2.1103"></a><span id="l2.1103" class="difflineminus">-  _lclose(hFile);</span>
<a href="#l2.1104"></a><span id="l2.1104" class="difflineminus">-</span>
<a href="#l2.1105"></a><span id="l2.1105" class="difflineminus">-  if (writeCount != bufSize)</span>
<a href="#l2.1106"></a><span id="l2.1106" class="difflineminus">-  {</span>
<a href="#l2.1107"></a><span id="l2.1107" class="difflineminus">-    _unlink(fName);</span>
<a href="#l2.1108"></a><span id="l2.1108" class="difflineminus">-    return(-1);</span>
<a href="#l2.1109"></a><span id="l2.1109" class="difflineminus">-  }</span>
<a href="#l2.1110"></a><span id="l2.1110" class="difflineminus">-</span>
<a href="#l2.1111"></a><span id="l2.1111" class="difflineminus">-  return(0);</span>
<a href="#l2.1112"></a><span id="l2.1112" class="difflineminus">-}</span>
<a href="#l2.1113"></a><span id="l2.1113" class="difflineminus">-</span>
<a href="#l2.1114"></a><span id="l2.1114" class="difflineminus">-static LPSTR</span>
<a href="#l2.1115"></a><span id="l2.1115" class="difflineminus">-GetTheTempDirectoryOnTheSystem(void)</span>
<a href="#l2.1116"></a><span id="l2.1116" class="difflineminus">-{</span>
<a href="#l2.1117"></a><span id="l2.1117" class="difflineminus">- static UCHAR retPath[_MAX_PATH];</span>
<a href="#l2.1118"></a><span id="l2.1118" class="difflineminus">-  </span>
<a href="#l2.1119"></a><span id="l2.1119" class="difflineminus">-  if (getenv(&quot;TEMP&quot;))</span>
<a href="#l2.1120"></a><span id="l2.1120" class="difflineminus">-  {</span>
<a href="#l2.1121"></a><span id="l2.1121" class="difflineminus">-    lstrcpy((LPSTR) retPath, getenv(&quot;TEMP&quot;));  // environmental variable</span>
<a href="#l2.1122"></a><span id="l2.1122" class="difflineminus">-  } </span>
<a href="#l2.1123"></a><span id="l2.1123" class="difflineminus">-  else if (getenv(&quot;TMP&quot;))</span>
<a href="#l2.1124"></a><span id="l2.1124" class="difflineminus">-  {</span>
<a href="#l2.1125"></a><span id="l2.1125" class="difflineminus">-    lstrcpy((LPSTR) retPath, getenv(&quot;TMP&quot;));  // How about this environmental variable?</span>
<a href="#l2.1126"></a><span id="l2.1126" class="difflineminus">-  }</span>
<a href="#l2.1127"></a><span id="l2.1127" class="difflineminus">-  else</span>
<a href="#l2.1128"></a><span id="l2.1128" class="difflineminus">-  {</span>
<a href="#l2.1129"></a><span id="l2.1129" class="difflineminus">-    GetWindowsDirectory((LPSTR) retPath, sizeof(retPath));</span>
<a href="#l2.1130"></a><span id="l2.1130" class="difflineminus">-  }</span>
<a href="#l2.1131"></a><span id="l2.1131" class="difflineminus">-</span>
<a href="#l2.1132"></a><span id="l2.1132" class="difflineminus">-  return((LPSTR) &amp;(retPath[0]));</span>
<a href="#l2.1133"></a><span id="l2.1133" class="difflineminus">-}</span>
<a href="#l2.1134"></a><span id="l2.1134" class="difflineminus">-</span>
<a href="#l2.1135"></a><span id="l2.1135" class="difflineminus">-#ifdef WIN16</span>
<a href="#l2.1136"></a><span id="l2.1136" class="difflineminus">-static int ISGetTempFileName(LPCSTR a_pDummyPath,  LPCSTR a_pPrefix, UINT a_uUnique, LPSTR a_pResultName)</span>
<a href="#l2.1137"></a><span id="l2.1137" class="difflineminus">-{</span>
<a href="#l2.1138"></a><span id="l2.1138" class="difflineminus">-#ifdef GetTempFileName	// we need the real thing comming up next...</span>
<a href="#l2.1139"></a><span id="l2.1139" class="difflineminus">-#undef GetTempFileName</span>
<a href="#l2.1140"></a><span id="l2.1140" class="difflineminus">-#endif</span>
<a href="#l2.1141"></a><span id="l2.1141" class="difflineminus">-	return GetTempFileName(0, a_pPrefix, a_uUnique, a_pResultName);</span>
<a href="#l2.1142"></a><span id="l2.1142" class="difflineminus">-}</span>
<a href="#l2.1143"></a><span id="l2.1143" class="difflineminus">-#endif</span>
<a href="#l2.1144"></a><span id="l2.1144" class="difflineminus">-</span>
<a href="#l2.1145"></a><span id="l2.1145" class="difflineminus">-static DWORD </span>
<a href="#l2.1146"></a><span id="l2.1146" class="difflineminus">-ValidateFile(LPCSTR szFile) </span>
<a href="#l2.1147"></a><span id="l2.1147" class="difflineminus">-{</span>
<a href="#l2.1148"></a><span id="l2.1148" class="difflineminus">-  	struct _stat buf;</span>
<a href="#l2.1149"></a><span id="l2.1149" class="difflineminus">-    int result;</span>
<a href="#l2.1150"></a><span id="l2.1150" class="difflineminus">-</span>
<a href="#l2.1151"></a><span id="l2.1151" class="difflineminus">-    result = _stat( szFile, &amp;buf );</span>
<a href="#l2.1152"></a><span id="l2.1152" class="difflineminus">-    if (result != 0)</span>
<a href="#l2.1153"></a><span id="l2.1153" class="difflineminus">-      return(1);</span>
<a href="#l2.1154"></a><span id="l2.1154" class="difflineminus">-</span>
<a href="#l2.1155"></a><span id="l2.1155" class="difflineminus">-    if (!(buf.st_mode &amp; S_IREAD))</span>
<a href="#l2.1156"></a><span id="l2.1156" class="difflineminus">-      return(2);</span>
<a href="#l2.1157"></a><span id="l2.1157" class="difflineminus">-</span>
<a href="#l2.1158"></a><span id="l2.1158" class="difflineminus">-    return(0);</span>
<a href="#l2.1159"></a><span id="l2.1159" class="difflineminus">-}</span>
<a href="#l2.1160"></a><span id="l2.1160" class="difflineminus">-</span>
<a href="#l2.1161"></a><span id="l2.1161" class="difflineminus">-static LONG</span>
<a href="#l2.1162"></a><span id="l2.1162" class="difflineminus">-GetTempAttachmentName(LPSTR fName) </span>
<a href="#l2.1163"></a><span id="l2.1163" class="difflineminus">-{</span>
<a href="#l2.1164"></a><span id="l2.1164" class="difflineminus">-  UINT        res;</span>
<a href="#l2.1165"></a><span id="l2.1165" class="difflineminus">-  static UINT uUnique = 1;</span>
<a href="#l2.1166"></a><span id="l2.1166" class="difflineminus">-</span>
<a href="#l2.1167"></a><span id="l2.1167" class="difflineminus">-  if (!fName)</span>
<a href="#l2.1168"></a><span id="l2.1168" class="difflineminus">-    return(-1);</span>
<a href="#l2.1169"></a><span id="l2.1169" class="difflineminus">-</span>
<a href="#l2.1170"></a><span id="l2.1170" class="difflineminus">-  LPSTR szTempPath = GetTheTempDirectoryOnTheSystem();</span>
<a href="#l2.1171"></a><span id="l2.1171" class="difflineminus">-</span>
<a href="#l2.1172"></a><span id="l2.1172" class="difflineminus">-TRYAGAIN:</span>
<a href="#l2.1173"></a><span id="l2.1173" class="difflineminus">-#ifdef WIN32</span>
<a href="#l2.1174"></a><span id="l2.1174" class="difflineminus">-  res = GetTempFileName(szTempPath, &quot;MAPI&quot;, uUnique++, fName);</span>
<a href="#l2.1175"></a><span id="l2.1175" class="difflineminus">-#else</span>
<a href="#l2.1176"></a><span id="l2.1176" class="difflineminus">-  res = ISGetTempFileName(szTempPath, &quot;MAPI&quot;, uUnique++, fName);</span>
<a href="#l2.1177"></a><span id="l2.1177" class="difflineminus">-#endif</span>
<a href="#l2.1178"></a><span id="l2.1178" class="difflineminus">-</span>
<a href="#l2.1179"></a><span id="l2.1179" class="difflineminus">-  if (ValidateFile(fName) != 1) </span>
<a href="#l2.1180"></a><span id="l2.1180" class="difflineminus">-  {</span>
<a href="#l2.1181"></a><span id="l2.1181" class="difflineminus">-    if (uUnique &lt; 32000)</span>
<a href="#l2.1182"></a><span id="l2.1182" class="difflineminus">-    {</span>
<a href="#l2.1183"></a><span id="l2.1183" class="difflineminus">-      goto TRYAGAIN;</span>
<a href="#l2.1184"></a><span id="l2.1184" class="difflineminus">-    }</span>
<a href="#l2.1185"></a><span id="l2.1185" class="difflineminus">-    else</span>
<a href="#l2.1186"></a><span id="l2.1186" class="difflineminus">-    {</span>
<a href="#l2.1187"></a><span id="l2.1187" class="difflineminus">-      return(-1);</span>
<a href="#l2.1188"></a><span id="l2.1188" class="difflineminus">-    }</span>
<a href="#l2.1189"></a><span id="l2.1189" class="difflineminus">-  }</span>
<a href="#l2.1190"></a><span id="l2.1190" class="difflineminus">-</span>
<a href="#l2.1191"></a><span id="l2.1191" class="difflineminus">-  return 0;</span>
<a href="#l2.1192"></a><span id="l2.1192" class="difflineminus">-}</span>
<a href="#l2.1193"></a><span id="l2.1193" class="difflineminus">-</span>
<a href="#l2.1194"></a><span id="l2.1194" class="difflineminus">-LONG    </span>
<a href="#l2.1195"></a><span id="l2.1195" class="difflineminus">-ProcessMAPIReadMail(MAPIReadMailType *readInfo)</span>
<a href="#l2.1196"></a><span id="l2.1196" class="difflineminus">-{</span>
<a href="#l2.1197"></a><span id="l2.1197" class="difflineminus">-  CMAPIConnection *mySession;</span>
<a href="#l2.1198"></a><span id="l2.1198" class="difflineminus">-  lpMapiMessage   message;      // this is the message we will receive</span>
<a href="#l2.1199"></a><span id="l2.1199" class="difflineminus">-</span>
<a href="#l2.1200"></a><span id="l2.1200" class="difflineminus">-  //</span>
<a href="#l2.1201"></a><span id="l2.1201" class="difflineminus">-  // Verify the session handle...</span>
<a href="#l2.1202"></a><span id="l2.1202" class="difflineminus">-  //</span>
<a href="#l2.1203"></a><span id="l2.1203" class="difflineminus">-  if (((readInfo-&gt;lhSession-1) &gt;= MAX_CON) || ((readInfo-&gt;lhSession-1) &lt; 0))</span>
<a href="#l2.1204"></a><span id="l2.1204" class="difflineminus">-  {</span>
<a href="#l2.1205"></a><span id="l2.1205" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.1206"></a><span id="l2.1206" class="difflineminus">-  }</span>
<a href="#l2.1207"></a><span id="l2.1207" class="difflineminus">-</span>
<a href="#l2.1208"></a><span id="l2.1208" class="difflineminus">-  mySession = mapiConnections[(readInfo-&gt;lhSession - 1)];</span>
<a href="#l2.1209"></a><span id="l2.1209" class="difflineminus">-  if (mySession == NULL)</span>
<a href="#l2.1210"></a><span id="l2.1210" class="difflineminus">-  {</span>
<a href="#l2.1211"></a><span id="l2.1211" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.1212"></a><span id="l2.1212" class="difflineminus">-  }</span>
<a href="#l2.1213"></a><span id="l2.1213" class="difflineminus">-</span>
<a href="#l2.1214"></a><span id="l2.1214" class="difflineminus">-  // First, gotta get the inbox folder!</span>
<a href="#l2.1215"></a><span id="l2.1215" class="difflineminus">-  MSG_FolderInfo  *inboxFolder = NULL;</span>
<a href="#l2.1216"></a><span id="l2.1216" class="difflineminus">-	int32           folderRC = MSG_GetFoldersWithFlag(WFE_MSGGetMaster(),</span>
<a href="#l2.1217"></a><span id="l2.1217" class="difflineminus">-        										MSG_FOLDER_FLAG_INBOX, &amp;inboxFolder, 1);</span>
<a href="#l2.1218"></a><span id="l2.1218" class="difflineminus">-  if (folderRC &lt;= 0)</span>
<a href="#l2.1219"></a><span id="l2.1219" class="difflineminus">-  {</span>
<a href="#l2.1220"></a><span id="l2.1220" class="difflineminus">-    return(MAPI_E_INVALID_MESSAGE);</span>
<a href="#l2.1221"></a><span id="l2.1221" class="difflineminus">-  }</span>
<a href="#l2.1222"></a><span id="l2.1222" class="difflineminus">-</span>
<a href="#l2.1223"></a><span id="l2.1223" class="difflineminus">-  // Convert the message id to a number!</span>
<a href="#l2.1224"></a><span id="l2.1224" class="difflineminus">-  MessageKey lookupKey = atoi((const char *)readInfo-&gt;lpszMessageID);</span>
<a href="#l2.1225"></a><span id="l2.1225" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPIReadMail() Find this message = [%s] - [%d]\n&quot;, </span>
<a href="#l2.1226"></a><span id="l2.1226" class="difflineminus">-                          readInfo-&gt;lpszMessageID, lookupKey);</span>
<a href="#l2.1227"></a><span id="l2.1227" class="difflineminus">-</span>
<a href="#l2.1228"></a><span id="l2.1228" class="difflineminus">-  // Now see if we can find this message!</span>
<a href="#l2.1229"></a><span id="l2.1229" class="difflineminus">-  BOOL msgFound = MSG_GetMapiMessageById(inboxFolder, lookupKey, &amp;message);</span>
<a href="#l2.1230"></a><span id="l2.1230" class="difflineminus">-</span>
<a href="#l2.1231"></a><span id="l2.1231" class="difflineminus">-  // If we didn't find the message, then we need to bail!</span>
<a href="#l2.1232"></a><span id="l2.1232" class="difflineminus">-  if (!msgFound)</span>
<a href="#l2.1233"></a><span id="l2.1233" class="difflineminus">-  {</span>
<a href="#l2.1234"></a><span id="l2.1234" class="difflineminus">-    TRACE(&quot;MAPI: ProcessMAPIReadMail() MESSAGE NOT FOUND\n&quot;);</span>
<a href="#l2.1235"></a><span id="l2.1235" class="difflineminus">-    return(MAPI_E_INVALID_MESSAGE);</span>
<a href="#l2.1236"></a><span id="l2.1236" class="difflineminus">-  }</span>
<a href="#l2.1237"></a><span id="l2.1237" class="difflineminus">-</span>
<a href="#l2.1238"></a><span id="l2.1238" class="difflineminus">-  //</span>
<a href="#l2.1239"></a><span id="l2.1239" class="difflineminus">-  // Now that we have found the message, we need to populate the chunk of</span>
<a href="#l2.1240"></a><span id="l2.1240" class="difflineminus">-  // memory that we will write to disk and then move on. For now, we need</span>
<a href="#l2.1241"></a><span id="l2.1241" class="difflineminus">-  // to setup all of the variables for the information we will need for the</span>
<a href="#l2.1242"></a><span id="l2.1242" class="difflineminus">-  // message.</span>
<a href="#l2.1243"></a><span id="l2.1243" class="difflineminus">-  //</span>
<a href="#l2.1244"></a><span id="l2.1244" class="difflineminus">-  ULONG     i;</span>
<a href="#l2.1245"></a><span id="l2.1245" class="difflineminus">-  DWORD     arrayCount = 0;         // Counter for array entries!</span>
<a href="#l2.1246"></a><span id="l2.1246" class="difflineminus">-  DWORD     arrayTotal = 0;         // Total for array entries!</span>
<a href="#l2.1247"></a><span id="l2.1247" class="difflineminus">-  FLAGS     msgFlags;               // unread, return or receipt                  </span>
<a href="#l2.1248"></a><span id="l2.1248" class="difflineminus">-  ULONG     msgRecipCount = message-&gt;nRecipCount; // Number of recipients                   </span>
<a href="#l2.1249"></a><span id="l2.1249" class="difflineminus">-  ULONG     msgFileAttachCount = message-&gt;nFileCount; // # of file attachments                  </span>
<a href="#l2.1250"></a><span id="l2.1250" class="difflineminus">-</span>
<a href="#l2.1251"></a><span id="l2.1251" class="difflineminus">-  LPSTR     msgSubject = message-&gt;lpszSubject;          // Message Subject</span>
<a href="#l2.1252"></a><span id="l2.1252" class="difflineminus">-  LPSTR     msgNoteText = NULL;                         // Message Text will be</span>
<a href="#l2.1253"></a><span id="l2.1253" class="difflineminus">-  LPSTR     msgDateReceived = message-&gt;lpszDateReceived;// in YYYY/MM/DD HH:MM format</span>
<a href="#l2.1254"></a><span id="l2.1254" class="difflineminus">-  LPSTR     msgThreadID = message-&gt;lpszConversationID;  // conversation thread ID</span>
<a href="#l2.1255"></a><span id="l2.1255" class="difflineminus">-</span>
<a href="#l2.1256"></a><span id="l2.1256" class="difflineminus">-  //</span>
<a href="#l2.1257"></a><span id="l2.1257" class="difflineminus">-  // The following are for the originator of the message. Only ONE of these.</span>
<a href="#l2.1258"></a><span id="l2.1258" class="difflineminus">-  //</span>
<a href="#l2.1259"></a><span id="l2.1259" class="difflineminus">-  LPSTR     origName = NULL;    // Originator name                           </span>
<a href="#l2.1260"></a><span id="l2.1260" class="difflineminus">-  LPSTR     origAddress = NULL; // Originator address (optional)             </span>
<a href="#l2.1261"></a><span id="l2.1261" class="difflineminus">-  ULONG     origRecipClass = MAPI_TO;               // Recipient class - MAPI_TO, MAPI_CC, MAPI_BCC, MAPI_ORIG</span>
<a href="#l2.1262"></a><span id="l2.1262" class="difflineminus">-</span>
<a href="#l2.1263"></a><span id="l2.1263" class="difflineminus">-  // Now we have to make sure there is an originator and set the vars...</span>
<a href="#l2.1264"></a><span id="l2.1264" class="difflineminus">-  if (message-&gt;lpOriginator)</span>
<a href="#l2.1265"></a><span id="l2.1265" class="difflineminus">-  {</span>
<a href="#l2.1266"></a><span id="l2.1266" class="difflineminus">-    origName    = message-&gt;lpOriginator-&gt;lpszName;</span>
<a href="#l2.1267"></a><span id="l2.1267" class="difflineminus">-    origAddress = message-&gt;lpOriginator-&gt;lpszAddress;</span>
<a href="#l2.1268"></a><span id="l2.1268" class="difflineminus">-  }</span>
<a href="#l2.1269"></a><span id="l2.1269" class="difflineminus">-</span>
<a href="#l2.1270"></a><span id="l2.1270" class="difflineminus">-  if ( ! (readInfo-&gt;flFlags &amp; MAPI_ENVELOPE_ONLY))</span>
<a href="#l2.1271"></a><span id="l2.1271" class="difflineminus">-  {</span>
<a href="#l2.1272"></a><span id="l2.1272" class="difflineminus">-      TRACE(&quot;MAPI: ProcessMAPIReadMail() GET NOTE TEXT - ONLY IF WE HAVE TO!\n&quot;); </span>
<a href="#l2.1273"></a><span id="l2.1273" class="difflineminus">-      msgNoteText = message-&gt;lpszNoteText;</span>
<a href="#l2.1274"></a><span id="l2.1274" class="difflineminus">-  }</span>
<a href="#l2.1275"></a><span id="l2.1275" class="difflineminus">-</span>
<a href="#l2.1276"></a><span id="l2.1276" class="difflineminus">-  // First, figure out how many entries we need to have in a string array...</span>
<a href="#l2.1277"></a><span id="l2.1277" class="difflineminus">-  arrayTotal = 6 + 1; // 6 for the first 6 strings and 1 for the final NULL    </span>
<a href="#l2.1278"></a><span id="l2.1278" class="difflineminus">-</span>
<a href="#l2.1279"></a><span id="l2.1279" class="difflineminus">-  // Add the recipient information</span>
<a href="#l2.1280"></a><span id="l2.1280" class="difflineminus">-  arrayTotal += (msgRecipCount * 3);</span>
<a href="#l2.1281"></a><span id="l2.1281" class="difflineminus">-</span>
<a href="#l2.1282"></a><span id="l2.1282" class="difflineminus">-  // Now check to see if we are going to pass back attachments:</span>
<a href="#l2.1283"></a><span id="l2.1283" class="difflineminus">-  //</span>
<a href="#l2.1284"></a><span id="l2.1284" class="difflineminus">-  // MAPI_ENVELOPE_ONLY </span>
<a href="#l2.1285"></a><span id="l2.1285" class="difflineminus">-  // Indicates MAPIReadMail should read the message header only. File attachments are </span>
<a href="#l2.1286"></a><span id="l2.1286" class="difflineminus">-  // not copied to temporary files, and neither temporary file names nor message text </span>
<a href="#l2.1287"></a><span id="l2.1287" class="difflineminus">-  // is written. Setting this flag enhances performance. </span>
<a href="#l2.1288"></a><span id="l2.1288" class="difflineminus">-  //</span>
<a href="#l2.1289"></a><span id="l2.1289" class="difflineminus">-  // MAPI_SUPPRESS_ATTACH </span>
<a href="#l2.1290"></a><span id="l2.1290" class="difflineminus">-  // Indicates MAPIReadMail should not copy file attachments but should write message </span>
<a href="#l2.1291"></a><span id="l2.1291" class="difflineminus">-  // text into the MapiMessage structure. MAPIReadMail ignores this flag if the </span>
<a href="#l2.1292"></a><span id="l2.1292" class="difflineminus">-  // calling application has set the MAPI_ENVELOPE_ONLY flag. Setting the </span>
<a href="#l2.1293"></a><span id="l2.1293" class="difflineminus">-  // MAPI_SUPPRESS_ATTACH flag enhances performance. </span>
<a href="#l2.1294"></a><span id="l2.1294" class="difflineminus">-  //</span>
<a href="#l2.1295"></a><span id="l2.1295" class="difflineminus">-  if ((readInfo-&gt;flFlags &amp; MAPI_SUPPRESS_ATTACH) ||</span>
<a href="#l2.1296"></a><span id="l2.1296" class="difflineminus">-      (readInfo-&gt;flFlags &amp; MAPI_ENVELOPE_ONLY) )</span>
<a href="#l2.1297"></a><span id="l2.1297" class="difflineminus">-  {</span>
<a href="#l2.1298"></a><span id="l2.1298" class="difflineminus">-    msgFileAttachCount = 0;</span>
<a href="#l2.1299"></a><span id="l2.1299" class="difflineminus">-  }</span>
<a href="#l2.1300"></a><span id="l2.1300" class="difflineminus">-</span>
<a href="#l2.1301"></a><span id="l2.1301" class="difflineminus">-  arrayTotal += (msgFileAttachCount * 2);</span>
<a href="#l2.1302"></a><span id="l2.1302" class="difflineminus">-  </span>
<a href="#l2.1303"></a><span id="l2.1303" class="difflineminus">-  // now allocate the memory for the string array </span>
<a href="#l2.1304"></a><span id="l2.1304" class="difflineminus">-  LPSTR *strArray = (LPSTR *) malloc((size_t) (sizeof(LPSTR) * arrayTotal));</span>
<a href="#l2.1305"></a><span id="l2.1305" class="difflineminus">-  if (!strArray)</span>
<a href="#l2.1306"></a><span id="l2.1306" class="difflineminus">-  {</span>
<a href="#l2.1307"></a><span id="l2.1307" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l2.1308"></a><span id="l2.1308" class="difflineminus">-  }</span>
<a href="#l2.1309"></a><span id="l2.1309" class="difflineminus">-</span>
<a href="#l2.1310"></a><span id="l2.1310" class="difflineminus">-  // Now assign the easy return values to the shared memory structure</span>
<a href="#l2.1311"></a><span id="l2.1311" class="difflineminus">-  readInfo-&gt;MSG_flFlags     = msgFlags;           // unread, return or receipt                  </span>
<a href="#l2.1312"></a><span id="l2.1312" class="difflineminus">-  readInfo-&gt;MSG_nRecipCount = msgRecipCount;      // Number of recipients                   </span>
<a href="#l2.1313"></a><span id="l2.1313" class="difflineminus">-  readInfo-&gt;MSG_nFileCount  = msgFileAttachCount; // # of file attachments                  </span>
<a href="#l2.1314"></a><span id="l2.1314" class="difflineminus">-  readInfo-&gt;MSG_ORIG_ulRecipClass = origRecipClass; //  Recipient class - MAPI_TO, MAPI_CC, MAPI_BCC, MAPI_ORIG</span>
<a href="#l2.1315"></a><span id="l2.1315" class="difflineminus">-</span>
<a href="#l2.1316"></a><span id="l2.1316" class="difflineminus">-  // Now go through and fill out the array to create the string sequence</span>
<a href="#l2.1317"></a><span id="l2.1317" class="difflineminus">-  strArray[0] = CheckNull(msgSubject);</span>
<a href="#l2.1318"></a><span id="l2.1318" class="difflineminus">-  strArray[1] = CheckNull(msgNoteText);</span>
<a href="#l2.1319"></a><span id="l2.1319" class="difflineminus">-  strArray[2] = CheckNull(msgDateReceived);</span>
<a href="#l2.1320"></a><span id="l2.1320" class="difflineminus">-  strArray[3] = CheckNull(msgThreadID);</span>
<a href="#l2.1321"></a><span id="l2.1321" class="difflineminus">-  strArray[4] = CheckNull(origName);</span>
<a href="#l2.1322"></a><span id="l2.1322" class="difflineminus">-  strArray[5] = CheckNull(origAddress);</span>
<a href="#l2.1323"></a><span id="l2.1323" class="difflineminus">-</span>
<a href="#l2.1324"></a><span id="l2.1324" class="difflineminus">-  arrayCount = 6;   // counter for the rest of the needed attachments</span>
<a href="#l2.1325"></a><span id="l2.1325" class="difflineminus">-</span>
<a href="#l2.1326"></a><span id="l2.1326" class="difflineminus">-  // Now add all of the recipients</span>
<a href="#l2.1327"></a><span id="l2.1327" class="difflineminus">-  for (i=0; i&lt;msgRecipCount; i++)</span>
<a href="#l2.1328"></a><span id="l2.1328" class="difflineminus">-  {</span>
<a href="#l2.1329"></a><span id="l2.1329" class="difflineminus">-    UCHAR     tempString[128];</span>
<a href="#l2.1330"></a><span id="l2.1330" class="difflineminus">-    ULONG     messageClass = message-&gt;lpRecips[i].ulRecipClass; // Get the recipient class...</span>
<a href="#l2.1331"></a><span id="l2.1331" class="difflineminus">-</span>
<a href="#l2.1332"></a><span id="l2.1332" class="difflineminus">-    // Now get the following 3 items:</span>
<a href="#l2.1333"></a><span id="l2.1333" class="difflineminus">-    //      String x: LPSTR lpszName;             // Recipient N name                           </span>
<a href="#l2.1334"></a><span id="l2.1334" class="difflineminus">-    //      String x: LPSTR lpszAddress;          // Recipient N address (optional)             </span>
<a href="#l2.1335"></a><span id="l2.1335" class="difflineminus">-    //      String x: LPSTR lpszRecipClass        // recipient class - sprintf of ULONG</span>
<a href="#l2.1336"></a><span id="l2.1336" class="difflineminus">-    strArray[arrayCount++] = CheckNull(message-&gt;lpRecips[i].lpszName);</span>
<a href="#l2.1337"></a><span id="l2.1337" class="difflineminus">-    strArray[arrayCount++] = CheckNull(message-&gt;lpRecips[i].lpszAddress);</span>
<a href="#l2.1338"></a><span id="l2.1338" class="difflineminus">-</span>
<a href="#l2.1339"></a><span id="l2.1339" class="difflineminus">-    // 0	MAPI_ORIG	Indicates the original sender of the message. </span>
<a href="#l2.1340"></a><span id="l2.1340" class="difflineminus">-    // 1	MAPI_TO	Indicates a primary message recipient. </span>
<a href="#l2.1341"></a><span id="l2.1341" class="difflineminus">-    // 2	MAPI_CC	Indicates a recipient of a message copy. </span>
<a href="#l2.1342"></a><span id="l2.1342" class="difflineminus">-    // 3	MAPI_BCC	Indicates a recipient of a blind copy. </span>
<a href="#l2.1343"></a><span id="l2.1343" class="difflineminus">-    wsprintf((LPSTR) tempString, &quot;%d&quot;, messageClass);</span>
<a href="#l2.1344"></a><span id="l2.1344" class="difflineminus">-    strArray[arrayCount++] = CheckNull((LPSTR) tempString);</span>
<a href="#l2.1345"></a><span id="l2.1345" class="difflineminus">-  }</span>
<a href="#l2.1346"></a><span id="l2.1346" class="difflineminus">-</span>
<a href="#l2.1347"></a><span id="l2.1347" class="difflineminus">-  // Now, add all of the attachments to this blob</span>
<a href="#l2.1348"></a><span id="l2.1348" class="difflineminus">-  for (i=0; i&lt;msgFileAttachCount; i++)</span>
<a href="#l2.1349"></a><span id="l2.1349" class="difflineminus">-  {</span>
<a href="#l2.1350"></a><span id="l2.1350" class="difflineminus">-    //      String x: LPSTR lpszPathName // Fully qualified path of the attached file. </span>
<a href="#l2.1351"></a><span id="l2.1351" class="difflineminus">-    //                                   // This path should include the disk drive letter and directory name.</span>
<a href="#l2.1352"></a><span id="l2.1352" class="difflineminus">-    //      String x: LPSTR lpszFileName // The display name for the attached file</span>
<a href="#l2.1353"></a><span id="l2.1353" class="difflineminus">-    //</span>
<a href="#l2.1354"></a><span id="l2.1354" class="difflineminus">-    strArray[arrayCount++] = CheckNull(message-&gt;lpFiles[i].lpszPathName);</span>
<a href="#l2.1355"></a><span id="l2.1355" class="difflineminus">-    strArray[arrayCount++] = CheckNull(message-&gt;lpFiles[i].lpszFileName);</span>
<a href="#l2.1356"></a><span id="l2.1356" class="difflineminus">-  }</span>
<a href="#l2.1357"></a><span id="l2.1357" class="difflineminus">-</span>
<a href="#l2.1358"></a><span id="l2.1358" class="difflineminus">-  strArray[arrayCount] = NULL;</span>
<a href="#l2.1359"></a><span id="l2.1359" class="difflineminus">-</span>
<a href="#l2.1360"></a><span id="l2.1360" class="difflineminus">-  // Create the string sequence</span>
<a href="#l2.1361"></a><span id="l2.1361" class="difflineminus">-  NSstringSeq strSeq = NSStrSeqNew(strArray);</span>
<a href="#l2.1362"></a><span id="l2.1362" class="difflineminus">-</span>
<a href="#l2.1363"></a><span id="l2.1363" class="difflineminus">-  // Now just cleanup the array....</span>
<a href="#l2.1364"></a><span id="l2.1364" class="difflineminus">-  free(strArray);</span>
<a href="#l2.1365"></a><span id="l2.1365" class="difflineminus">- </span>
<a href="#l2.1366"></a><span id="l2.1366" class="difflineminus">-  if (!strSeq)</span>
<a href="#l2.1367"></a><span id="l2.1367" class="difflineminus">-  {</span>
<a href="#l2.1368"></a><span id="l2.1368" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l2.1369"></a><span id="l2.1369" class="difflineminus">-  }</span>
<a href="#l2.1370"></a><span id="l2.1370" class="difflineminus">-  </span>
<a href="#l2.1371"></a><span id="l2.1371" class="difflineminus">-  // Now get the name of the file to write the blob to!</span>
<a href="#l2.1372"></a><span id="l2.1372" class="difflineminus">-  if (GetTempAttachmentName((LPSTR)readInfo-&gt;lpszBlob) &lt; 0)</span>
<a href="#l2.1373"></a><span id="l2.1373" class="difflineminus">-  {</span>
<a href="#l2.1374"></a><span id="l2.1374" class="difflineminus">-    NSStrSeqDelete(strSeq);</span>
<a href="#l2.1375"></a><span id="l2.1375" class="difflineminus">-    return(MAPI_E_ATTACHMENT_WRITE_FAILURE);</span>
<a href="#l2.1376"></a><span id="l2.1376" class="difflineminus">-  }</span>
<a href="#l2.1377"></a><span id="l2.1377" class="difflineminus">-</span>
<a href="#l2.1378"></a><span id="l2.1378" class="difflineminus">-  // Now write the blob to disk and move on...</span>
<a href="#l2.1379"></a><span id="l2.1379" class="difflineminus">-  if (WriteTheMemoryBufferToDisk((LPSTR) readInfo-&gt;lpszBlob, </span>
<a href="#l2.1380"></a><span id="l2.1380" class="difflineminus">-                      (UINT) NSStrSeqSize(strSeq), strSeq) != 0)</span>
<a href="#l2.1381"></a><span id="l2.1381" class="difflineminus">-  {</span>
<a href="#l2.1382"></a><span id="l2.1382" class="difflineminus">-    NSStrSeqDelete(strSeq);</span>
<a href="#l2.1383"></a><span id="l2.1383" class="difflineminus">-    return(MAPI_E_ATTACHMENT_WRITE_FAILURE);</span>
<a href="#l2.1384"></a><span id="l2.1384" class="difflineminus">-  }</span>
<a href="#l2.1385"></a><span id="l2.1385" class="difflineminus">-</span>
<a href="#l2.1386"></a><span id="l2.1386" class="difflineminus">-  //</span>
<a href="#l2.1387"></a><span id="l2.1387" class="difflineminus">-  // MAPI_PEEK </span>
<a href="#l2.1388"></a><span id="l2.1388" class="difflineminus">-  // Indicates MAPIReadMail does not mark the message as read. Marking a message as </span>
<a href="#l2.1389"></a><span id="l2.1389" class="difflineminus">-  // read affects its appearance in the user interface and generates a read receipt. </span>
<a href="#l2.1390"></a><span id="l2.1390" class="difflineminus">-  // If the messaging system does not support this flag, MAPIReadMail always marks </span>
<a href="#l2.1391"></a><span id="l2.1391" class="difflineminus">-  // the message as read. If MAPIReadMail encounters an error, it leaves the </span>
<a href="#l2.1392"></a><span id="l2.1392" class="difflineminus">-  // message unread.  </span>
<a href="#l2.1393"></a><span id="l2.1393" class="difflineminus">-  if (!(readInfo-&gt;flFlags &amp; MAPI_PEEK))</span>
<a href="#l2.1394"></a><span id="l2.1394" class="difflineminus">-  {</span>
<a href="#l2.1395"></a><span id="l2.1395" class="difflineminus">-    MSG_MarkMapiMessageRead (inboxFolder, lookupKey, TRUE);</span>
<a href="#l2.1396"></a><span id="l2.1396" class="difflineminus">-  }</span>
<a href="#l2.1397"></a><span id="l2.1397" class="difflineminus">-</span>
<a href="#l2.1398"></a><span id="l2.1398" class="difflineminus">-  // Now we have to free the message and the chunk of memory...</span>
<a href="#l2.1399"></a><span id="l2.1399" class="difflineminus">-  MSG_FreeMapiMessage(message);</span>
<a href="#l2.1400"></a><span id="l2.1400" class="difflineminus">-  NSStrSeqDelete(strSeq);</span>
<a href="#l2.1401"></a><span id="l2.1401" class="difflineminus">-</span>
<a href="#l2.1402"></a><span id="l2.1402" class="difflineminus">-  return(SUCCESS_SUCCESS);</span>
<a href="#l2.1403"></a><span id="l2.1403" class="difflineminus">-}</span>
<a href="#l2.1404"></a><span id="l2.1404" class="difflineminus">-</span>
<a href="#l2.1405"></a><span id="l2.1405" class="difflineminus">-// necessary variables for </span>
<a href="#l2.1406"></a><span id="l2.1406" class="difflineminus">-int           arrayCount   = 0;         // Counter for array entries!</span>
<a href="#l2.1407"></a><span id="l2.1407" class="difflineminus">-int           addressCount = 0;         // Counter for array entries!</span>
<a href="#l2.1408"></a><span id="l2.1408" class="difflineminus">-LPSTR         *addrArray;</span>
<a href="#l2.1409"></a><span id="l2.1409" class="difflineminus">-LPSTR         toString  = &quot;1&quot;;</span>
<a href="#l2.1410"></a><span id="l2.1410" class="difflineminus">-LPSTR         ccString  = &quot;2&quot;;</span>
<a href="#l2.1411"></a><span id="l2.1411" class="difflineminus">-LPSTR         bccString = &quot;3&quot;;</span>
<a href="#l2.1412"></a><span id="l2.1412" class="difflineminus">- </span>
<a href="#l2.1413"></a><span id="l2.1413" class="difflineminus">-BOOL </span>
<a href="#l2.1414"></a><span id="l2.1414" class="difflineminus">-AddressCallback(int totalCount, int currentIndex, </span>
<a href="#l2.1415"></a><span id="l2.1415" class="difflineminus">-                int addrType, LPSTR addrString)</span>
<a href="#l2.1416"></a><span id="l2.1416" class="difflineminus">-{</span>
<a href="#l2.1417"></a><span id="l2.1417" class="difflineminus">-  LPSTR     messageClass; </span>
<a href="#l2.1418"></a><span id="l2.1418" class="difflineminus">-</span>
<a href="#l2.1419"></a><span id="l2.1419" class="difflineminus">-  TRACE(&quot;TOTAL COUNT   = %d\n&quot;, totalCount);</span>
<a href="#l2.1420"></a><span id="l2.1420" class="difflineminus">-  TRACE(&quot;CURRENT COUNT = %d\n&quot;, currentIndex);</span>
<a href="#l2.1421"></a><span id="l2.1421" class="difflineminus">-  TRACE(&quot;CURRENT ADDR  = %s\n&quot;, addrString);</span>
<a href="#l2.1422"></a><span id="l2.1422" class="difflineminus">-</span>
<a href="#l2.1423"></a><span id="l2.1423" class="difflineminus">-  // If this is the first entry, then we need to allocate the array...</span>
<a href="#l2.1424"></a><span id="l2.1424" class="difflineminus">-  if (currentIndex == 0)</span>
<a href="#l2.1425"></a><span id="l2.1425" class="difflineminus">-  {</span>
<a href="#l2.1426"></a><span id="l2.1426" class="difflineminus">-    addressCount = totalCount;</span>
<a href="#l2.1427"></a><span id="l2.1427" class="difflineminus">-    addrArray = (LPSTR *) malloc( (size_t) </span>
<a href="#l2.1428"></a><span id="l2.1428" class="difflineminus">-                            sizeof(LPSTR) * ((addressCount * 3) + 1) </span>
<a href="#l2.1429"></a><span id="l2.1429" class="difflineminus">-                          );</span>
<a href="#l2.1430"></a><span id="l2.1430" class="difflineminus">-    if (!addrArray)</span>
<a href="#l2.1431"></a><span id="l2.1431" class="difflineminus">-    {</span>
<a href="#l2.1432"></a><span id="l2.1432" class="difflineminus">-      addressCount = 0;</span>
<a href="#l2.1433"></a><span id="l2.1433" class="difflineminus">-      return FALSE;</span>
<a href="#l2.1434"></a><span id="l2.1434" class="difflineminus">-    }</span>
<a href="#l2.1435"></a><span id="l2.1435" class="difflineminus">-  }</span>
<a href="#l2.1436"></a><span id="l2.1436" class="difflineminus">-</span>
<a href="#l2.1437"></a><span id="l2.1437" class="difflineminus">-  // if the array was not allocated...</span>
<a href="#l2.1438"></a><span id="l2.1438" class="difflineminus">-  if (!addrArray)</span>
<a href="#l2.1439"></a><span id="l2.1439" class="difflineminus">-  {</span>
<a href="#l2.1440"></a><span id="l2.1440" class="difflineminus">-    addressCount = 0;</span>
<a href="#l2.1441"></a><span id="l2.1441" class="difflineminus">-    return FALSE;</span>
<a href="#l2.1442"></a><span id="l2.1442" class="difflineminus">-  }</span>
<a href="#l2.1443"></a><span id="l2.1443" class="difflineminus">-</span>
<a href="#l2.1444"></a><span id="l2.1444" class="difflineminus">-  // Deal with the address type...</span>
<a href="#l2.1445"></a><span id="l2.1445" class="difflineminus">-  if (addrType == MSG_CC_HEADER_MASK)</span>
<a href="#l2.1446"></a><span id="l2.1446" class="difflineminus">-    messageClass = ccString;</span>
<a href="#l2.1447"></a><span id="l2.1447" class="difflineminus">-  else if (addrType == MSG_BCC_HEADER_MASK)</span>
<a href="#l2.1448"></a><span id="l2.1448" class="difflineminus">-    messageClass = bccString;</span>
<a href="#l2.1449"></a><span id="l2.1449" class="difflineminus">-  else </span>
<a href="#l2.1450"></a><span id="l2.1450" class="difflineminus">-    messageClass = toString;</span>
<a href="#l2.1451"></a><span id="l2.1451" class="difflineminus">-</span>
<a href="#l2.1452"></a><span id="l2.1452" class="difflineminus">-  // Now get the following 3 items:</span>
<a href="#l2.1453"></a><span id="l2.1453" class="difflineminus">-  //      String x: LPSTR lpszName;             // Recipient N name                           </span>
<a href="#l2.1454"></a><span id="l2.1454" class="difflineminus">-  //      String x: LPSTR lpszAddress;          // Recipient N address (optional)             </span>
<a href="#l2.1455"></a><span id="l2.1455" class="difflineminus">-  //      String x: LPSTR lpszRecipClass        // recipient class - sprintf of ULONG</span>
<a href="#l2.1456"></a><span id="l2.1456" class="difflineminus">-</span>
<a href="#l2.1457"></a><span id="l2.1457" class="difflineminus">-  char *ptr = strchr(addrString, '&lt;');</span>
<a href="#l2.1458"></a><span id="l2.1458" class="difflineminus">-  if (ptr)</span>
<a href="#l2.1459"></a><span id="l2.1459" class="difflineminus">-  {</span>
<a href="#l2.1460"></a><span id="l2.1460" class="difflineminus">-    addrString[strlen(addrString) - 1] = '\0';</span>
<a href="#l2.1461"></a><span id="l2.1461" class="difflineminus">-    *(ptr-1) = '\0';</span>
<a href="#l2.1462"></a><span id="l2.1462" class="difflineminus">-  }</span>
<a href="#l2.1463"></a><span id="l2.1463" class="difflineminus">-  addrArray[arrayCount++] = CheckNull(addrString);</span>
<a href="#l2.1464"></a><span id="l2.1464" class="difflineminus">-</span>
<a href="#l2.1465"></a><span id="l2.1465" class="difflineminus">-  if (ptr)</span>
<a href="#l2.1466"></a><span id="l2.1466" class="difflineminus">-  {</span>
<a href="#l2.1467"></a><span id="l2.1467" class="difflineminus">-    ptr++;</span>
<a href="#l2.1468"></a><span id="l2.1468" class="difflineminus">-  }</span>
<a href="#l2.1469"></a><span id="l2.1469" class="difflineminus">-  else</span>
<a href="#l2.1470"></a><span id="l2.1470" class="difflineminus">-  {</span>
<a href="#l2.1471"></a><span id="l2.1471" class="difflineminus">-    ptr = (char *) addrString;</span>
<a href="#l2.1472"></a><span id="l2.1472" class="difflineminus">-  }</span>
<a href="#l2.1473"></a><span id="l2.1473" class="difflineminus">-</span>
<a href="#l2.1474"></a><span id="l2.1474" class="difflineminus">-  addrArray[arrayCount++] = CheckNull(ptr);</span>
<a href="#l2.1475"></a><span id="l2.1475" class="difflineminus">-</span>
<a href="#l2.1476"></a><span id="l2.1476" class="difflineminus">-  // 0	MAPI_ORIG	Indicates the original sender of the message. </span>
<a href="#l2.1477"></a><span id="l2.1477" class="difflineminus">-  // 1	MAPI_TO	Indicates a primary message recipient. </span>
<a href="#l2.1478"></a><span id="l2.1478" class="difflineminus">-  // 2	MAPI_CC	Indicates a recipient of a message copy. </span>
<a href="#l2.1479"></a><span id="l2.1479" class="difflineminus">-  // 3	MAPI_BCC	Indicates a recipient of a blindcopy. </span>
<a href="#l2.1480"></a><span id="l2.1480" class="difflineminus">-  addrArray[arrayCount++] = CheckNull(messageClass);</span>
<a href="#l2.1481"></a><span id="l2.1481" class="difflineminus">-</span>
<a href="#l2.1482"></a><span id="l2.1482" class="difflineminus">-  return(TRUE);</span>
<a href="#l2.1483"></a><span id="l2.1483" class="difflineminus">-}</span>
<a href="#l2.1484"></a><span id="l2.1484" class="difflineminus">-</span>
<a href="#l2.1485"></a><span id="l2.1485" class="difflineminus">-int               getAddressCount = 0;</span>
<a href="#l2.1486"></a><span id="l2.1486" class="difflineminus">-MAPIAddressType   *getAddressPtr = NULL;</span>
<a href="#l2.1487"></a><span id="l2.1487" class="difflineminus">-NSstringSeq       addrSeq = NULL;</span>
<a href="#l2.1488"></a><span id="l2.1488" class="difflineminus">-</span>
<a href="#l2.1489"></a><span id="l2.1489" class="difflineminus">-// rhp - for MAPI calls...</span>
<a href="#l2.1490"></a><span id="l2.1490" class="difflineminus">-BOOL</span>
<a href="#l2.1491"></a><span id="l2.1491" class="difflineminus">-GetNextAddress(LPSTR *name, LPSTR *address, int *addrType)</span>
<a href="#l2.1492"></a><span id="l2.1492" class="difflineminus">-{</span>
<a href="#l2.1493"></a><span id="l2.1493" class="difflineminus">-  if ( getAddressCount &gt;= (getAddressPtr-&gt;nRecips * 3) )</span>
<a href="#l2.1494"></a><span id="l2.1494" class="difflineminus">-  {</span>
<a href="#l2.1495"></a><span id="l2.1495" class="difflineminus">-    return FALSE;</span>
<a href="#l2.1496"></a><span id="l2.1496" class="difflineminus">-  }</span>
<a href="#l2.1497"></a><span id="l2.1497" class="difflineminus">-</span>
<a href="#l2.1498"></a><span id="l2.1498" class="difflineminus">-  ULONG   aType = atoi(NSStrSeqGet(addrSeq, getAddressCount++));</span>
<a href="#l2.1499"></a><span id="l2.1499" class="difflineminus">-</span>
<a href="#l2.1500"></a><span id="l2.1500" class="difflineminus">-  // return which type of address this is?</span>
<a href="#l2.1501"></a><span id="l2.1501" class="difflineminus">-  if (aType == MAPI_CC)</span>
<a href="#l2.1502"></a><span id="l2.1502" class="difflineminus">-    *addrType = MSG_CC_HEADER_MASK;</span>
<a href="#l2.1503"></a><span id="l2.1503" class="difflineminus">-  else if (aType == MAPI_BCC)</span>
<a href="#l2.1504"></a><span id="l2.1504" class="difflineminus">-    *addrType = MSG_BCC_HEADER_MASK;</span>
<a href="#l2.1505"></a><span id="l2.1505" class="difflineminus">-  else</span>
<a href="#l2.1506"></a><span id="l2.1506" class="difflineminus">-    *addrType = MSG_TO_HEADER_MASK;</span>
<a href="#l2.1507"></a><span id="l2.1507" class="difflineminus">-      </span>
<a href="#l2.1508"></a><span id="l2.1508" class="difflineminus">-  *name    = (LPSTR) NSStrSeqGet(addrSeq, getAddressCount++);</span>
<a href="#l2.1509"></a><span id="l2.1509" class="difflineminus">-  *address = (LPSTR) NSStrSeqGet(addrSeq, getAddressCount++);</span>
<a href="#l2.1510"></a><span id="l2.1510" class="difflineminus">-</span>
<a href="#l2.1511"></a><span id="l2.1511" class="difflineminus">-  return TRUE;</span>
<a href="#l2.1512"></a><span id="l2.1512" class="difflineminus">-}</span>
<a href="#l2.1513"></a><span id="l2.1513" class="difflineminus">-</span>
<a href="#l2.1514"></a><span id="l2.1514" class="difflineminus">-LONG</span>
<a href="#l2.1515"></a><span id="l2.1515" class="difflineminus">-ProcessMAPIAddress(MAPIAddressType *addrInfo)</span>
<a href="#l2.1516"></a><span id="l2.1516" class="difflineminus">-{</span>
<a href="#l2.1517"></a><span id="l2.1517" class="difflineminus">-  CMAPIConnection *mySession;</span>
<a href="#l2.1518"></a><span id="l2.1518" class="difflineminus">-</span>
<a href="#l2.1519"></a><span id="l2.1519" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPIAddress() Incomming Addrs = %d\nCaption = [%s]\n&quot;,</span>
<a href="#l2.1520"></a><span id="l2.1520" class="difflineminus">-                    addrInfo-&gt;nRecips,</span>
<a href="#l2.1521"></a><span id="l2.1521" class="difflineminus">-                    addrInfo-&gt;lpszCaption);</span>
<a href="#l2.1522"></a><span id="l2.1522" class="difflineminus">-  //</span>
<a href="#l2.1523"></a><span id="l2.1523" class="difflineminus">-  // Verify the session handle...</span>
<a href="#l2.1524"></a><span id="l2.1524" class="difflineminus">-  //</span>
<a href="#l2.1525"></a><span id="l2.1525" class="difflineminus">-  if (((addrInfo-&gt;lhSession-1) &gt;= MAX_CON) || ((addrInfo-&gt;lhSession-1) &lt; 0))</span>
<a href="#l2.1526"></a><span id="l2.1526" class="difflineminus">-  {</span>
<a href="#l2.1527"></a><span id="l2.1527" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.1528"></a><span id="l2.1528" class="difflineminus">-  }</span>
<a href="#l2.1529"></a><span id="l2.1529" class="difflineminus">-</span>
<a href="#l2.1530"></a><span id="l2.1530" class="difflineminus">-  mySession = mapiConnections[(addrInfo-&gt;lhSession - 1)];</span>
<a href="#l2.1531"></a><span id="l2.1531" class="difflineminus">-  if (mySession == NULL)</span>
<a href="#l2.1532"></a><span id="l2.1532" class="difflineminus">-  {</span>
<a href="#l2.1533"></a><span id="l2.1533" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l2.1534"></a><span id="l2.1534" class="difflineminus">-  }</span>
<a href="#l2.1535"></a><span id="l2.1535" class="difflineminus">-</span>
<a href="#l2.1536"></a><span id="l2.1536" class="difflineminus">-  // </span>
<a href="#l2.1537"></a><span id="l2.1537" class="difflineminus">-  // Put up the address dialog and do the right thing :-)</span>
<a href="#l2.1538"></a><span id="l2.1538" class="difflineminus">-  // </span>
<a href="#l2.1539"></a><span id="l2.1539" class="difflineminus">-  addrSeq = (NSstringSeq) &amp;(addrInfo-&gt;dataBuf[0]);</span>
<a href="#l2.1540"></a><span id="l2.1540" class="difflineminus">-  getAddressCount = 0;  // Make sure to reset the counter for address info...</span>
<a href="#l2.1541"></a><span id="l2.1541" class="difflineminus">-  getAddressPtr = addrInfo; // Address pointer for callback...</span>
<a href="#l2.1542"></a><span id="l2.1542" class="difflineminus">-  arrayCount = 0;       // counter for the rest of the entries...</span>
<a href="#l2.1543"></a><span id="l2.1543" class="difflineminus">-  theApp.m_pHiddenFrame-&gt;AddressDialog((LPSTR) (addrInfo-&gt;lpszCaption), </span>
<a href="#l2.1544"></a><span id="l2.1544" class="difflineminus">-                                            AddressCallback, GetNextAddress);</span>
<a href="#l2.1545"></a><span id="l2.1545" class="difflineminus">-</span>
<a href="#l2.1546"></a><span id="l2.1546" class="difflineminus">-  // If the address count is zero, then we can return early...</span>
<a href="#l2.1547"></a><span id="l2.1547" class="difflineminus">-  addrInfo-&gt;nNewRecips = addressCount;</span>
<a href="#l2.1548"></a><span id="l2.1548" class="difflineminus">-  if (addressCount == 0)</span>
<a href="#l2.1549"></a><span id="l2.1549" class="difflineminus">-  {</span>
<a href="#l2.1550"></a><span id="l2.1550" class="difflineminus">-    return(SUCCESS_SUCCESS);</span>
<a href="#l2.1551"></a><span id="l2.1551" class="difflineminus">-  }</span>
<a href="#l2.1552"></a><span id="l2.1552" class="difflineminus">-</span>
<a href="#l2.1553"></a><span id="l2.1553" class="difflineminus">-  addrArray[arrayCount] = NULL;  </span>
<a href="#l2.1554"></a><span id="l2.1554" class="difflineminus">-</span>
<a href="#l2.1555"></a><span id="l2.1555" class="difflineminus">-  // Create the string sequence</span>
<a href="#l2.1556"></a><span id="l2.1556" class="difflineminus">-  NSstringSeq strSeq = NSStrSeqNew(addrArray);</span>
<a href="#l2.1557"></a><span id="l2.1557" class="difflineminus">-  </span>
<a href="#l2.1558"></a><span id="l2.1558" class="difflineminus">-  // Now just cleanup the array....</span>
<a href="#l2.1559"></a><span id="l2.1559" class="difflineminus">-  free(addrArray);</span>
<a href="#l2.1560"></a><span id="l2.1560" class="difflineminus">-  </span>
<a href="#l2.1561"></a><span id="l2.1561" class="difflineminus">-  if (!strSeq)</span>
<a href="#l2.1562"></a><span id="l2.1562" class="difflineminus">-  {</span>
<a href="#l2.1563"></a><span id="l2.1563" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l2.1564"></a><span id="l2.1564" class="difflineminus">-  }</span>
<a href="#l2.1565"></a><span id="l2.1565" class="difflineminus">-  </span>
<a href="#l2.1566"></a><span id="l2.1566" class="difflineminus">-  // Now get the name of the file to write the blob to!</span>
<a href="#l2.1567"></a><span id="l2.1567" class="difflineminus">-  if (GetTempAttachmentName((LPSTR)addrInfo-&gt;lpszBlob) &lt; 0)</span>
<a href="#l2.1568"></a><span id="l2.1568" class="difflineminus">-  {</span>
<a href="#l2.1569"></a><span id="l2.1569" class="difflineminus">-    NSStrSeqDelete(strSeq);</span>
<a href="#l2.1570"></a><span id="l2.1570" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l2.1571"></a><span id="l2.1571" class="difflineminus">-  }</span>
<a href="#l2.1572"></a><span id="l2.1572" class="difflineminus">-</span>
<a href="#l2.1573"></a><span id="l2.1573" class="difflineminus">-  // Now write the blob to disk and move on...</span>
<a href="#l2.1574"></a><span id="l2.1574" class="difflineminus">-  if (WriteTheMemoryBufferToDisk((LPSTR) addrInfo-&gt;lpszBlob, </span>
<a href="#l2.1575"></a><span id="l2.1575" class="difflineminus">-                      (UINT) NSStrSeqSize(strSeq), strSeq) != 0)</span>
<a href="#l2.1576"></a><span id="l2.1576" class="difflineminus">-  {</span>
<a href="#l2.1577"></a><span id="l2.1577" class="difflineminus">-    NSStrSeqDelete(strSeq);</span>
<a href="#l2.1578"></a><span id="l2.1578" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l2.1579"></a><span id="l2.1579" class="difflineminus">-  }</span>
<a href="#l2.1580"></a><span id="l2.1580" class="difflineminus">-</span>
<a href="#l2.1581"></a><span id="l2.1581" class="difflineminus">-  NSStrSeqDelete(strSeq);</span>
<a href="#l2.1582"></a><span id="l2.1582" class="difflineminus">-  return(SUCCESS_SUCCESS);</span>
<a href="#l2.1583"></a><span id="l2.1583" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">deleted file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- a/mailnews/mapi/old/hook/mapihook.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ /dev/null</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -1,48 +0,0 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineminus">- *</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">- *</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">- * License.</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">- *</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">- *</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">- *</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">- *</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">- *</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-#ifndef _MAPI_HOOK_H_</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-#define _MAPI_HOOK_H_</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-#include &lt;structs.h&gt;    // for MWContext</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-//</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-// This is the entry point to the MAPI session manager that lives</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-// inside of Communicator.</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-// </span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-LONG ProcessNetscapeMAPIHook(WPARAM wParam, LPARAM lParam);</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-#endif // _MAPI_HOOK_H_</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">deleted file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- a/mailnews/mapi/old/hook/mapimail.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ /dev/null</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -1,853 +0,0 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">- *</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">- *</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">- * License.</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">- *</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">- *</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">- *</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">- *</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">- *</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-//</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-//  More MAPI Hooks for Communicator</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-//  November 1997</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-//</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-#include &quot;windows.h&quot;</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-#include &quot;template.h&quot;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-#include &quot;msgcom.h&quot;</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-#include &quot;wfemsg.h&quot;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-#include &quot;compstd.h&quot;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-#include &quot;compbar.h&quot;</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-#include &quot;compmisc.h&quot;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-#include &quot;compfrm.h&quot;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-#include &quot;prefapi.h&quot;</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-#include &quot;intl_csi.h&quot;</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-#include &quot;dlghtmrp.h&quot;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-#include &quot;dlghtmmq.h&quot;</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-// rhp - was breaking the optimized build!</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-//#include &quot;edt.h&quot;</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-//#include &quot;edview.h&quot;</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-//#include &quot;postal.h&quot;</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-//#include &quot;apiaddr.h&quot;</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-//#include &quot;mailmisc.h&quot;</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-extern &quot;C&quot; {</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineminus">-#include &quot;xpgetstr.h&quot;</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-extern int MK_MSG_MSG_COMPOSITION;</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-};</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-#include &quot;mapimail.h&quot;</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-#include &quot;nscpmapi.h&quot;</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-#include &quot;mailpriv.h&quot;</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-#include &quot;nsstrseq.h&quot;</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-MWContext             </span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-*GetUsableContext(void)</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-{</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-  CGenericFrame     *pFrame = (CGenericFrame * )FEU_GetLastActiveFrame();</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-  ASSERT(pFrame != NULL);</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-  if (pFrame == NULL)</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-  {</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-    return(NULL);</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-  }</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineminus">-  // Now return the context...</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-  return((MWContext *) pFrame-&gt;GetMainContext());</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-}</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-//</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-// This function will create a composition window and either do</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-// a blind send or pop up the compose window for the user to </span>
<a href="#l4.94"></a><span id="l4.94" class="difflineminus">-// complete the operation</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineminus">-//</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineminus">-// Return: appropriate MAPI return code...</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">-//</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-// </span>
<a href="#l4.99"></a><span id="l4.99" class="difflineminus">-extern &quot;C&quot; LONG</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-DoFullMAPIMailOperation(MAPISendMailType      *sendMailPtr,</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-											  const char            *pInitialText,</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineminus">-                        BOOL                  winShowFlag)</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-{   </span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-CGenericDoc             *pDocument;</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-LPSTR                   subject;</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-NSstringSeq             mailInfoSeq;</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-DWORD                   stringCount = 6;</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-DWORD                   i;</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineminus">-CString                 csDefault;</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineminus">-</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineminus">-  // Get a context to use for this call...</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineminus">-  MWContext *pOldContext = GetUsableContext();</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineminus">-  if (!pOldContext)</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineminus">-  {</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineminus">-  }</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineminus">-</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineminus">-  // Don't allow a compose window to be created if the user hasn't </span>
<a href="#l4.119"></a><span id="l4.119" class="difflineminus">-  // specified an email address</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineminus">-  const char *real_addr = FE_UsersMailAddress();</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineminus">-  if (MISC_ValidateReturnAddress(pOldContext, real_addr) &lt; 0)</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineminus">-  {</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-  }</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">-</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-  //</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-  // Now, we must build the fields object...</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-  //</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-  mailInfoSeq = (NSstringSeq) &amp;(sendMailPtr-&gt;dataBuf[0]);</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-  subject = NSStrSeqGet(mailInfoSeq, 0);</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineminus">-  // We should give it a subject to preven the prompt from coming</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineminus">-  // up...</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineminus">-  if ((!subject) || !(*subject))</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-  {</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineminus">-    csDefault.LoadString(IDS_COMPOSE_DEFAULTNOSUBJECT);</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineminus">-    subject = csDefault.GetBuffer(2);</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineminus">-  }</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineminus">-</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPISendMail() Subject   = [%s]\n&quot;, subject);</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPISendMail() Text Size = [%d]\n&quot;, strlen((const char *)pInitialText));</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPISendMail() # of Recipients  = [%d]\n&quot;, sendMailPtr-&gt;MSG_nRecipCount);</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineminus">-</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineminus">-</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-  char  toString[1024] = &quot;&quot;;</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineminus">-  char  ccString[1024] = &quot;&quot;;</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineminus">-  char  bccString[1024] = &quot;&quot;;</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineminus">-</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineminus">-  for (i=0; i&lt;sendMailPtr-&gt;MSG_nRecipCount; i++)</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineminus">-  {</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineminus">-    LPSTR   ptr;</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineminus">-    UCHAR   tempString[256];</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineminus">-</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineminus">-    ULONG addrType = atoi(NSStrSeqGet(mailInfoSeq, stringCount++));</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineminus">-</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineminus">-    // figure which type of address this is?</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">-    if (addrType == MAPI_CC)</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineminus">-      ptr = ccString;</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineminus">-    else if (addrType == MAPI_BCC)</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineminus">-      ptr = bccString;</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineminus">-    else</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineminus">-      ptr = toString;</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineminus">-      </span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-    LPSTR namePtr = (LPSTR) NSStrSeqGet(mailInfoSeq, stringCount++);</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-    LPSTR emailPtr = (LPSTR) NSStrSeqGet(mailInfoSeq, stringCount++);</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineminus">-    if ( (lstrlen(emailPtr) &gt; 5) &amp;&amp; (*(emailPtr + 4) == ':') )</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineminus">-    {</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineminus">-      emailPtr += 5;</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineminus">-    }</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineminus">-</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineminus">-    // Now build the temp string to tack on in the format</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineminus">-    // &quot;Rich Pizzarro&quot; &lt;rhp@netscape.com&gt;</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineminus">-    wsprintf((LPSTR) tempString, &quot;\&quot;%s\&quot; &lt;%s&gt;&quot;, namePtr, emailPtr);</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineminus">-</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineminus">-    // add a comma if not the first one</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineminus">-    if (ptr[0] != '\0')</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineminus">-      lstrcat(ptr, &quot;,&quot;);</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineminus">-</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineminus">-    // tack on string!</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineminus">-    lstrcat(ptr, (LPSTR) tempString);</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineminus">-  }</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineminus">-</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineminus">-  BOOL    bEncrypt = FALSE;</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineminus">-  BOOL    bSign    = FALSE;</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineminus">-</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineminus">-  PREF_GetBoolPref(&quot;mail.crypto_sign_outgoing_mail&quot;, &amp;bSign);</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineminus">-  PREF_GetBoolPref(&quot;mail.encrypt_outgoing_mail&quot;, &amp;bEncrypt);</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineminus">-  MSG_CompositionFields *fields =</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineminus">-      MSG_CreateCompositionFields(real_addr, real_addr, </span>
<a href="#l4.190"></a><span id="l4.190" class="difflineminus">-                  toString, </span>
<a href="#l4.191"></a><span id="l4.191" class="difflineminus">-                  ccString, </span>
<a href="#l4.192"></a><span id="l4.192" class="difflineminus">-                  bccString,</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineminus">-									&quot;&quot;, &quot;&quot;, &quot;&quot;,</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineminus">-									&quot;&quot;, subject, &quot;&quot;,</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineminus">-									&quot;&quot;, &quot;&quot;, &quot;&quot;,</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineminus">-									&quot;&quot;, </span>
<a href="#l4.197"></a><span id="l4.197" class="difflineminus">-                  bEncrypt,</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineminus">-                  bSign);</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineminus">-  if (!fields)</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineminus">-  {</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineminus">-  }</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-  // RICHIE</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineminus">-  // INTL_CharSetInfo csi = LO_GetDocumentCharacterSetInfo(pOldContext);</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineminus">-  // int16 win_csid = INTL_GetCSIWinCSID(csi);</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineminus">-  </span>
<a href="#l4.208"></a><span id="l4.208" class="difflineminus">-  pDocument = (CGenericDoc*)theApp.m_TextComposeTemplate-&gt;OpenDocumentFile(NULL, NULL, /*win_csid RICHIE*/ winShowFlag);</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineminus">-  if ( !pDocument )</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineminus">-  {</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineminus">-  }</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineminus">-  </span>
<a href="#l4.214"></a><span id="l4.214" class="difflineminus">-  CWinCX * pContext = (CWinCX*) pDocument-&gt;GetContext();</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineminus">-  if ( !pContext ) </span>
<a href="#l4.216"></a><span id="l4.216" class="difflineminus">-  {</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineminus">-  }</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineminus">-</span>
<a href="#l4.220"></a><span id="l4.220" class="difflineminus">-  MSG_CompositionPaneCallbacks Callbacks;</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineminus">-  Callbacks.CreateRecipientsDialog = CreateRecipientsDialog;</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineminus">-  Callbacks.CreateAskHTMLDialog = CreateAskHTMLDialog;</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineminus">-</span>
<a href="#l4.224"></a><span id="l4.224" class="difflineminus">-  int16 doccsid;</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineminus">-  MWContext *context = pContext-&gt;GetContext();</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineminus">-  CComposeFrame *pCompose = (CComposeFrame *) pContext-&gt;GetFrame()-&gt;GetFrameWnd();</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineminus">-</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineminus">-  pCompose-&gt;SetComposeStuff(context, fields); // squirl away stuff for post-create</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineminus">-</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineminus">-  // This needs to be set TRUE if using the old non-HTML text frame</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineminus">-  // to prevent dropping dragged URLs</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineminus">-  pContext-&gt;m_bDragging = !pCompose-&gt;UseHtml();</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineminus">-  if (!pCompose-&gt;UseHtml()) </span>
<a href="#l4.234"></a><span id="l4.234" class="difflineminus">-  {</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineminus">-    pCompose-&gt;SetMsgPane(</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineminus">-      MSG_CreateCompositionPane(pContext-&gt;GetContext(), </span>
<a href="#l4.237"></a><span id="l4.237" class="difflineminus">-                                context, </span>
<a href="#l4.238"></a><span id="l4.238" class="difflineminus">-                                g_MsgPrefs.m_pMsgPrefs, </span>
<a href="#l4.239"></a><span id="l4.239" class="difflineminus">-                                fields,</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineminus">-                                WFE_MSGGetMaster())</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineminus">-                        );</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineminus">-  }</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineminus">-</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineminus">-  ASSERT(pCompose-&gt;GetMsgPane());</span>
<a href="#l4.245"></a><span id="l4.245" class="difflineminus">-  MSG_SetFEData(pCompose-&gt;GetMsgPane(),(void *)pCompose);  </span>
<a href="#l4.246"></a><span id="l4.246" class="difflineminus">-  pCompose-&gt;UpdateAttachmentInfo();</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineminus">-</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineminus">-  // Pass doccsid info to new context for MailToWin conversion</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineminus">-  doccsid = INTL_GetCSIDocCSID(LO_GetDocumentCharacterSetInfo(context));</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineminus">-  INTL_SetCSIDocCSID(LO_GetDocumentCharacterSetInfo(context), </span>
<a href="#l4.251"></a><span id="l4.251" class="difflineminus">-    (doccsid ? doccsid : INTL_DefaultDocCharSetID(context)));</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineminus">-</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineminus">-  pCompose-&gt;DisplayHeaders(NULL);</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineminus">-</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineminus">-  CComposeBar * pBar = pCompose-&gt;GetComposeBar();</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineminus">-  ASSERT(pBar);</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineminus">-  LPADDRESSCONTROL pIAddressList = pBar-&gt;GetAddressWidgetInterface();</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineminus">-</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineminus">-  if (!pIAddressList-&gt;IsCreated()) </span>
<a href="#l4.260"></a><span id="l4.260" class="difflineminus">-  {</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineminus">-    pBar-&gt;CreateAddressingBlock();</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineminus">-  }</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineminus">-  // rhp - Deal with addressing the brute force way! This is a </span>
<a href="#l4.265"></a><span id="l4.265" class="difflineminus">-  // &quot;fix&quot; for bad behavior when creating these windows and not</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineminus">-  // showing them on the desktop.</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineminus">-  if (!winShowFlag)      // Hack to fix the window not being mapped</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineminus">-  {</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineminus">-    pCompose-&gt;AppendAddress(MSG_TO_HEADER_MASK, &quot;&quot;);</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineminus">-    pCompose-&gt;AppendAddress(MSG_CC_HEADER_MASK, &quot;&quot;);</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineminus">-    pCompose-&gt;AppendAddress(MSG_BCC_HEADER_MASK, &quot;&quot;);</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineminus">-  }</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineminus">-</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineminus">-  // Always do plain text composition!</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineminus">-  pCompose-&gt;CompleteComposeInitialization();</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineminus">-</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineminus">-  // Do this so we don't get popups on &quot;empty&quot; messages</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineminus">-  if ( (!pInitialText) || (!(*pInitialText)) )</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineminus">-    pInitialText = &quot; &quot;;</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineminus">-</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineminus">-  const char * pBody = pInitialText ? pInitialText : MSG_GetCompBody(pCompose-&gt;GetMsgPane());</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineminus">-  if (pBody)</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineminus">-  {</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineminus">-    FE_InsertMessageCompositionText(context,pBody,TRUE);</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineminus">-  }</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineminus">-</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineminus">-  // </span>
<a href="#l4.288"></a><span id="l4.288" class="difflineminus">-  // Now set the message as being edited!    </span>
<a href="#l4.289"></a><span id="l4.289" class="difflineminus">-  //</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineminus">-  pCompose-&gt;SetModified(TRUE);</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineminus">-</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineminus">-  //</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineminus">-  // Finally deal with the attachments...</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineminus">-  //</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineminus">-  if (sendMailPtr-&gt;MSG_nFileCount &gt; 0)</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineminus">-  {</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineminus">-    // Send this puppy when done with the attachments...</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineminus">-    if (!winShowFlag)</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineminus">-    {</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineminus">-      pCompose-&gt;SetMAPISendMode(MAPI_SEND);</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineminus">-    }</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineminus">-</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineminus">-    MSG_AttachmentData *pAttach = (MSG_AttachmentData *)</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineminus">-                  XP_CALLOC((sendMailPtr-&gt;MSG_nFileCount + 1),</span>
<a href="#l4.305"></a><span id="l4.305" class="difflineminus">-                  sizeof(MSG_AttachmentData));</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineminus">-    if (!pAttach)</span>
<a href="#l4.307"></a><span id="l4.307" class="difflineminus">-    {</span>
<a href="#l4.308"></a><span id="l4.308" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineminus">-    }</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineminus">-</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineminus">-    memset(pAttach, 0, (sendMailPtr-&gt;MSG_nFileCount + 1) * </span>
<a href="#l4.312"></a><span id="l4.312" class="difflineminus">-                                sizeof(MSG_AttachmentData));</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineminus">-    for (i=0; i&lt;sendMailPtr-&gt;MSG_nFileCount; i++)</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineminus">-    {</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineminus">-      CString cs;</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineminus">-      // Create URL from filename...</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineminus">-      WFE_ConvertFile2Url(cs, </span>
<a href="#l4.318"></a><span id="l4.318" class="difflineminus">-          (const char *)NSStrSeqGet(mailInfoSeq, stringCount++));</span>
<a href="#l4.319"></a><span id="l4.319" class="difflineminus">-      pAttach[i].url = XP_STRDUP(cs);</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineminus">-</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineminus">-      // Now also include the &quot;display&quot; name...</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineminus">-      StrAllocCopy(pAttach[i].real_name, NSStrSeqGet(mailInfoSeq, stringCount++));</span>
<a href="#l4.323"></a><span id="l4.323" class="difflineminus">-    }</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineminus">-</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineminus">-    // Set the list!</span>
<a href="#l4.326"></a><span id="l4.326" class="difflineminus">-    MSG_SetAttachmentList(pCompose-&gt;GetMsgPane(), pAttach);</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineminus">-</span>
<a href="#l4.328"></a><span id="l4.328" class="difflineminus">-    // Now free everything...</span>
<a href="#l4.329"></a><span id="l4.329" class="difflineminus">-    for (i=0; i&lt;sendMailPtr-&gt;MSG_nFileCount; i++)</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineminus">-    {</span>
<a href="#l4.331"></a><span id="l4.331" class="difflineminus">-      if (pAttach[i].url)</span>
<a href="#l4.332"></a><span id="l4.332" class="difflineminus">-        XP_FREE(pAttach[i].url);</span>
<a href="#l4.333"></a><span id="l4.333" class="difflineminus">-</span>
<a href="#l4.334"></a><span id="l4.334" class="difflineminus">-      if (pAttach[i].real_name)</span>
<a href="#l4.335"></a><span id="l4.335" class="difflineminus">-        XP_FREE(pAttach[i].real_name);</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineminus">-    }</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineminus">-</span>
<a href="#l4.338"></a><span id="l4.338" class="difflineminus">-    XP_FREE(pAttach);</span>
<a href="#l4.339"></a><span id="l4.339" class="difflineminus">-  }</span>
<a href="#l4.340"></a><span id="l4.340" class="difflineminus">-</span>
<a href="#l4.341"></a><span id="l4.341" class="difflineminus">-  //</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineminus">-  // Now, if we were supposed to do the blind send...do it, otherwise,</span>
<a href="#l4.343"></a><span id="l4.343" class="difflineminus">-  // just popup the window...</span>
<a href="#l4.344"></a><span id="l4.344" class="difflineminus">-  //</span>
<a href="#l4.345"></a><span id="l4.345" class="difflineminus">-  if (winShowFlag)      </span>
<a href="#l4.346"></a><span id="l4.346" class="difflineminus">-  {</span>
<a href="#l4.347"></a><span id="l4.347" class="difflineminus">-    // Post message to compose window to set the initial focus.</span>
<a href="#l4.348"></a><span id="l4.348" class="difflineminus">-    pCompose-&gt;PostMessage(WM_COMP_SET_INITIAL_FOCUS);</span>
<a href="#l4.349"></a><span id="l4.349" class="difflineminus">-  }</span>
<a href="#l4.350"></a><span id="l4.350" class="difflineminus">-  else if (sendMailPtr-&gt;MSG_nFileCount &lt;= 0)  // Send NOW if no attachments!</span>
<a href="#l4.351"></a><span id="l4.351" class="difflineminus">-  {</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineminus">-    pCompose-&gt;PostMessage(WM_COMMAND, IDM_SEND);</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineminus">-  }</span>
<a href="#l4.354"></a><span id="l4.354" class="difflineminus">-</span>
<a href="#l4.355"></a><span id="l4.355" class="difflineminus">-  return(SUCCESS_SUCCESS);</span>
<a href="#l4.356"></a><span id="l4.356" class="difflineminus">-}</span>
<a href="#l4.357"></a><span id="l4.357" class="difflineminus">-</span>
<a href="#l4.358"></a><span id="l4.358" class="difflineminus">-//</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineminus">-// This function will create a composition window and just attach</span>
<a href="#l4.360"></a><span id="l4.360" class="difflineminus">-// the attachments of interest and pop up the window...</span>
<a href="#l4.361"></a><span id="l4.361" class="difflineminus">-//</span>
<a href="#l4.362"></a><span id="l4.362" class="difflineminus">-// Return: appropriate MAPI return code...</span>
<a href="#l4.363"></a><span id="l4.363" class="difflineminus">-//</span>
<a href="#l4.364"></a><span id="l4.364" class="difflineminus">-//</span>
<a href="#l4.365"></a><span id="l4.365" class="difflineminus">-extern &quot;C&quot; LONG</span>
<a href="#l4.366"></a><span id="l4.366" class="difflineminus">-DoPartialMAPIMailOperation(MAPISendDocumentsType *sendDocPtr)</span>
<a href="#l4.367"></a><span id="l4.367" class="difflineminus">-{   </span>
<a href="#l4.368"></a><span id="l4.368" class="difflineminus">-CGenericDoc             *pDocument;</span>
<a href="#l4.369"></a><span id="l4.369" class="difflineminus">-</span>
<a href="#l4.370"></a><span id="l4.370" class="difflineminus">-  // Get a context to use for this call...</span>
<a href="#l4.371"></a><span id="l4.371" class="difflineminus">-  MWContext *pOldContext = GetUsableContext();</span>
<a href="#l4.372"></a><span id="l4.372" class="difflineminus">-  if (!pOldContext)</span>
<a href="#l4.373"></a><span id="l4.373" class="difflineminus">-  {</span>
<a href="#l4.374"></a><span id="l4.374" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.375"></a><span id="l4.375" class="difflineminus">-  }</span>
<a href="#l4.376"></a><span id="l4.376" class="difflineminus">-</span>
<a href="#l4.377"></a><span id="l4.377" class="difflineminus">-  // Don't allow a compose window to be created if the user hasn't </span>
<a href="#l4.378"></a><span id="l4.378" class="difflineminus">-  // specified an email address</span>
<a href="#l4.379"></a><span id="l4.379" class="difflineminus">-  const char *real_addr = FE_UsersMailAddress();</span>
<a href="#l4.380"></a><span id="l4.380" class="difflineminus">-  if (MISC_ValidateReturnAddress(pOldContext, real_addr) &lt; 0)</span>
<a href="#l4.381"></a><span id="l4.381" class="difflineminus">-  {</span>
<a href="#l4.382"></a><span id="l4.382" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.383"></a><span id="l4.383" class="difflineminus">-  }</span>
<a href="#l4.384"></a><span id="l4.384" class="difflineminus">-</span>
<a href="#l4.385"></a><span id="l4.385" class="difflineminus">-  //</span>
<a href="#l4.386"></a><span id="l4.386" class="difflineminus">-  // Now, build the fields object w/o much info...</span>
<a href="#l4.387"></a><span id="l4.387" class="difflineminus">-  //</span>
<a href="#l4.388"></a><span id="l4.388" class="difflineminus">-  BOOL    bEncrypt = FALSE;</span>
<a href="#l4.389"></a><span id="l4.389" class="difflineminus">-  BOOL    bSign    = FALSE;</span>
<a href="#l4.390"></a><span id="l4.390" class="difflineminus">-</span>
<a href="#l4.391"></a><span id="l4.391" class="difflineminus">-  PREF_GetBoolPref(&quot;mail.crypto_sign_outgoing_mail&quot;, &amp;bSign);</span>
<a href="#l4.392"></a><span id="l4.392" class="difflineminus">-  PREF_GetBoolPref(&quot;mail.encrypt_outgoing_mail&quot;, &amp;bEncrypt);</span>
<a href="#l4.393"></a><span id="l4.393" class="difflineminus">-</span>
<a href="#l4.394"></a><span id="l4.394" class="difflineminus">-  MSG_CompositionFields *fields =</span>
<a href="#l4.395"></a><span id="l4.395" class="difflineminus">-      MSG_CreateCompositionFields(real_addr, real_addr, NULL, </span>
<a href="#l4.396"></a><span id="l4.396" class="difflineminus">-                  &quot;&quot;, &quot;&quot;,</span>
<a href="#l4.397"></a><span id="l4.397" class="difflineminus">-									&quot;&quot;, &quot;&quot;, &quot;&quot;,</span>
<a href="#l4.398"></a><span id="l4.398" class="difflineminus">-									&quot;&quot;, &quot;&quot;, &quot;&quot;,</span>
<a href="#l4.399"></a><span id="l4.399" class="difflineminus">-									&quot;&quot;, &quot;&quot;, &quot;&quot;,</span>
<a href="#l4.400"></a><span id="l4.400" class="difflineminus">-									&quot;&quot;, </span>
<a href="#l4.401"></a><span id="l4.401" class="difflineminus">-                  bEncrypt,</span>
<a href="#l4.402"></a><span id="l4.402" class="difflineminus">-                  bSign);</span>
<a href="#l4.403"></a><span id="l4.403" class="difflineminus">-  if (!fields)</span>
<a href="#l4.404"></a><span id="l4.404" class="difflineminus">-  {</span>
<a href="#l4.405"></a><span id="l4.405" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.406"></a><span id="l4.406" class="difflineminus">-  }</span>
<a href="#l4.407"></a><span id="l4.407" class="difflineminus">-</span>
<a href="#l4.408"></a><span id="l4.408" class="difflineminus">-  // RICHIE - INTL_CharSetInfo csi = LO_GetDocumentCharacterSetInfo(pOldContext);</span>
<a href="#l4.409"></a><span id="l4.409" class="difflineminus">-  // int16 win_csid = INTL_GetCSIWinCSID(csi);</span>
<a href="#l4.410"></a><span id="l4.410" class="difflineminus">-</span>
<a href="#l4.411"></a><span id="l4.411" class="difflineminus">-  pDocument = (CGenericDoc*)theApp.m_TextComposeTemplate-&gt;OpenDocumentFile(NULL, NULL, /*RICHIE win_csid,*/ TRUE);</span>
<a href="#l4.412"></a><span id="l4.412" class="difflineminus">-  if ( !pDocument )</span>
<a href="#l4.413"></a><span id="l4.413" class="difflineminus">-  {</span>
<a href="#l4.414"></a><span id="l4.414" class="difflineminus">-    // cleanup fields object</span>
<a href="#l4.415"></a><span id="l4.415" class="difflineminus">-    MSG_DestroyCompositionFields(fields);</span>
<a href="#l4.416"></a><span id="l4.416" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.417"></a><span id="l4.417" class="difflineminus">-  }</span>
<a href="#l4.418"></a><span id="l4.418" class="difflineminus">-</span>
<a href="#l4.419"></a><span id="l4.419" class="difflineminus">-  CWinCX * pContext = (CWinCX*) pDocument-&gt;GetContext();</span>
<a href="#l4.420"></a><span id="l4.420" class="difflineminus">-  if ( !pContext ) </span>
<a href="#l4.421"></a><span id="l4.421" class="difflineminus">-  {</span>
<a href="#l4.422"></a><span id="l4.422" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.423"></a><span id="l4.423" class="difflineminus">-  }</span>
<a href="#l4.424"></a><span id="l4.424" class="difflineminus">-</span>
<a href="#l4.425"></a><span id="l4.425" class="difflineminus">-  MSG_CompositionPaneCallbacks Callbacks;</span>
<a href="#l4.426"></a><span id="l4.426" class="difflineminus">-  Callbacks.CreateRecipientsDialog = CreateRecipientsDialog;</span>
<a href="#l4.427"></a><span id="l4.427" class="difflineminus">-  Callbacks.CreateAskHTMLDialog = CreateAskHTMLDialog;</span>
<a href="#l4.428"></a><span id="l4.428" class="difflineminus">-</span>
<a href="#l4.429"></a><span id="l4.429" class="difflineminus">-  MWContext *context = pContext-&gt;GetContext();</span>
<a href="#l4.430"></a><span id="l4.430" class="difflineminus">-  CComposeFrame *pCompose = (CComposeFrame *) pContext-&gt;GetFrame()-&gt;GetFrameWnd();</span>
<a href="#l4.431"></a><span id="l4.431" class="difflineminus">-  pCompose-&gt;SetComposeStuff(context,fields); // squirl away stuff for post-create</span>
<a href="#l4.432"></a><span id="l4.432" class="difflineminus">-</span>
<a href="#l4.433"></a><span id="l4.433" class="difflineminus">-  // This needs to be set TRUE if using the old non-HTML text frame</span>
<a href="#l4.434"></a><span id="l4.434" class="difflineminus">-  // to prevent dropping dragged URLs</span>
<a href="#l4.435"></a><span id="l4.435" class="difflineminus">-  pContext-&gt;m_bDragging = !pCompose-&gt;UseHtml();</span>
<a href="#l4.436"></a><span id="l4.436" class="difflineminus">-  if (!pCompose-&gt;UseHtml()) </span>
<a href="#l4.437"></a><span id="l4.437" class="difflineminus">-  {</span>
<a href="#l4.438"></a><span id="l4.438" class="difflineminus">-    pCompose-&gt;SetMsgPane(MSG_CreateCompositionPane(</span>
<a href="#l4.439"></a><span id="l4.439" class="difflineminus">-      pContext-&gt;GetContext(), </span>
<a href="#l4.440"></a><span id="l4.440" class="difflineminus">-      context,</span>
<a href="#l4.441"></a><span id="l4.441" class="difflineminus">-      g_MsgPrefs.m_pMsgPrefs, fields,</span>
<a href="#l4.442"></a><span id="l4.442" class="difflineminus">-      WFE_MSGGetMaster()));</span>
<a href="#l4.443"></a><span id="l4.443" class="difflineminus">-  }</span>
<a href="#l4.444"></a><span id="l4.444" class="difflineminus">-</span>
<a href="#l4.445"></a><span id="l4.445" class="difflineminus">-  ASSERT(pCompose-&gt;GetMsgPane());</span>
<a href="#l4.446"></a><span id="l4.446" class="difflineminus">-  MSG_SetFEData(pCompose-&gt;GetMsgPane(),(void *)pCompose);</span>
<a href="#l4.447"></a><span id="l4.447" class="difflineminus">-</span>
<a href="#l4.448"></a><span id="l4.448" class="difflineminus">-  pCompose-&gt;UpdateAttachmentInfo();</span>
<a href="#l4.449"></a><span id="l4.449" class="difflineminus">-</span>
<a href="#l4.450"></a><span id="l4.450" class="difflineminus">-  // Pass doccsid info to new context for MailToWin conversion</span>
<a href="#l4.451"></a><span id="l4.451" class="difflineminus">-  /***</span>
<a href="#l4.452"></a><span id="l4.452" class="difflineminus">-  doccsid = INTL_GetCSIDocCSID(LO_GetDocumentCharacterSetInfo(pOldContext));</span>
<a href="#l4.453"></a><span id="l4.453" class="difflineminus">-</span>
<a href="#l4.454"></a><span id="l4.454" class="difflineminus">-  INTL_SetCSIDocCSID(LO_GetDocumentCharacterSetInfo(context), </span>
<a href="#l4.455"></a><span id="l4.455" class="difflineminus">-    (doccsid ? doccsid : INTL_DefaultDocCharSetID(pOldContext)));</span>
<a href="#l4.456"></a><span id="l4.456" class="difflineminus">-  ****/</span>
<a href="#l4.457"></a><span id="l4.457" class="difflineminus">-</span>
<a href="#l4.458"></a><span id="l4.458" class="difflineminus">-  pCompose-&gt;DisplayHeaders(NULL);</span>
<a href="#l4.459"></a><span id="l4.459" class="difflineminus">-</span>
<a href="#l4.460"></a><span id="l4.460" class="difflineminus">-  CComposeBar * pBar = pCompose-&gt;GetComposeBar();</span>
<a href="#l4.461"></a><span id="l4.461" class="difflineminus">-  ASSERT(pBar);</span>
<a href="#l4.462"></a><span id="l4.462" class="difflineminus">-  LPADDRESSCONTROL pIAddressList = pBar-&gt;GetAddressWidgetInterface();</span>
<a href="#l4.463"></a><span id="l4.463" class="difflineminus">-</span>
<a href="#l4.464"></a><span id="l4.464" class="difflineminus">-  if (!pIAddressList-&gt;IsCreated()) </span>
<a href="#l4.465"></a><span id="l4.465" class="difflineminus">-  {</span>
<a href="#l4.466"></a><span id="l4.466" class="difflineminus">-    pBar-&gt;CreateAddressingBlock();</span>
<a href="#l4.467"></a><span id="l4.467" class="difflineminus">-  }</span>
<a href="#l4.468"></a><span id="l4.468" class="difflineminus">-</span>
<a href="#l4.469"></a><span id="l4.469" class="difflineminus">-  // Always do plain text composition!</span>
<a href="#l4.470"></a><span id="l4.470" class="difflineminus">-  pCompose-&gt;CompleteComposeInitialization();</span>
<a href="#l4.471"></a><span id="l4.471" class="difflineminus">-</span>
<a href="#l4.472"></a><span id="l4.472" class="difflineminus">-  //</span>
<a href="#l4.473"></a><span id="l4.473" class="difflineminus">-  // Finally deal with the attachments...</span>
<a href="#l4.474"></a><span id="l4.474" class="difflineminus">-  //</span>
<a href="#l4.475"></a><span id="l4.475" class="difflineminus">-  NSstringSeq     mailInfoSeq = (NSstringSeq) &amp;(sendDocPtr-&gt;dataBuf[0]);</span>
<a href="#l4.476"></a><span id="l4.476" class="difflineminus">-  DWORD           stringCount = 0;</span>
<a href="#l4.477"></a><span id="l4.477" class="difflineminus">-  DWORD           i;</span>
<a href="#l4.478"></a><span id="l4.478" class="difflineminus">-</span>
<a href="#l4.479"></a><span id="l4.479" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPISendDocuments() # of Attachments = [%d]\n&quot;, sendDocPtr-&gt;nFileCount);</span>
<a href="#l4.480"></a><span id="l4.480" class="difflineminus">-</span>
<a href="#l4.481"></a><span id="l4.481" class="difflineminus">-  if (sendDocPtr-&gt;nFileCount &gt; 0)</span>
<a href="#l4.482"></a><span id="l4.482" class="difflineminus">-  {</span>
<a href="#l4.483"></a><span id="l4.483" class="difflineminus">-      MSG_AttachmentData *pAttach = (MSG_AttachmentData *)</span>
<a href="#l4.484"></a><span id="l4.484" class="difflineminus">-                    XP_CALLOC((sendDocPtr-&gt;nFileCount + 1),</span>
<a href="#l4.485"></a><span id="l4.485" class="difflineminus">-                    sizeof(MSG_AttachmentData));</span>
<a href="#l4.486"></a><span id="l4.486" class="difflineminus">-      if (!pAttach)</span>
<a href="#l4.487"></a><span id="l4.487" class="difflineminus">-      {</span>
<a href="#l4.488"></a><span id="l4.488" class="difflineminus">-        return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l4.489"></a><span id="l4.489" class="difflineminus">-      }</span>
<a href="#l4.490"></a><span id="l4.490" class="difflineminus">-</span>
<a href="#l4.491"></a><span id="l4.491" class="difflineminus">-      memset(pAttach, 0, (sendDocPtr-&gt;nFileCount + 1) * </span>
<a href="#l4.492"></a><span id="l4.492" class="difflineminus">-                                  sizeof(MSG_AttachmentData));</span>
<a href="#l4.493"></a><span id="l4.493" class="difflineminus">-      for (i=0; i&lt;sendDocPtr-&gt;nFileCount; i++)</span>
<a href="#l4.494"></a><span id="l4.494" class="difflineminus">-      {</span>
<a href="#l4.495"></a><span id="l4.495" class="difflineminus">-        CString cs;</span>
<a href="#l4.496"></a><span id="l4.496" class="difflineminus">-        // Create URL from filename...</span>
<a href="#l4.497"></a><span id="l4.497" class="difflineminus">-        WFE_ConvertFile2Url(cs, </span>
<a href="#l4.498"></a><span id="l4.498" class="difflineminus">-            (const char *)NSStrSeqGet(mailInfoSeq, stringCount++));</span>
<a href="#l4.499"></a><span id="l4.499" class="difflineminus">-        pAttach[i].url = XP_STRDUP(cs);</span>
<a href="#l4.500"></a><span id="l4.500" class="difflineminus">-</span>
<a href="#l4.501"></a><span id="l4.501" class="difflineminus">-        // Now also include the &quot;display&quot; name...</span>
<a href="#l4.502"></a><span id="l4.502" class="difflineminus">-        StrAllocCopy(pAttach[i].real_name, NSStrSeqGet(mailInfoSeq, stringCount++));</span>
<a href="#l4.503"></a><span id="l4.503" class="difflineminus">-      }</span>
<a href="#l4.504"></a><span id="l4.504" class="difflineminus">-</span>
<a href="#l4.505"></a><span id="l4.505" class="difflineminus">-      // Set the list!</span>
<a href="#l4.506"></a><span id="l4.506" class="difflineminus">-      MSG_SetAttachmentList(pCompose-&gt;GetMsgPane(), pAttach);</span>
<a href="#l4.507"></a><span id="l4.507" class="difflineminus">-</span>
<a href="#l4.508"></a><span id="l4.508" class="difflineminus">-      // Now free everything...</span>
<a href="#l4.509"></a><span id="l4.509" class="difflineminus">-      for (i=0; i&lt;sendDocPtr-&gt;nFileCount; i++)</span>
<a href="#l4.510"></a><span id="l4.510" class="difflineminus">-      {</span>
<a href="#l4.511"></a><span id="l4.511" class="difflineminus">-        if (pAttach[i].url)</span>
<a href="#l4.512"></a><span id="l4.512" class="difflineminus">-          XP_FREE(pAttach[i].url);</span>
<a href="#l4.513"></a><span id="l4.513" class="difflineminus">-</span>
<a href="#l4.514"></a><span id="l4.514" class="difflineminus">-        if (pAttach[i].real_name)</span>
<a href="#l4.515"></a><span id="l4.515" class="difflineminus">-          XP_FREE(pAttach[i].real_name);</span>
<a href="#l4.516"></a><span id="l4.516" class="difflineminus">-      }</span>
<a href="#l4.517"></a><span id="l4.517" class="difflineminus">-</span>
<a href="#l4.518"></a><span id="l4.518" class="difflineminus">-      XP_FREE(pAttach);</span>
<a href="#l4.519"></a><span id="l4.519" class="difflineminus">-  }</span>
<a href="#l4.520"></a><span id="l4.520" class="difflineminus">-    </span>
<a href="#l4.521"></a><span id="l4.521" class="difflineminus">-  // </span>
<a href="#l4.522"></a><span id="l4.522" class="difflineminus">-  // Now some checking for ... well I'm not sure...</span>
<a href="#l4.523"></a><span id="l4.523" class="difflineminus">-  //</span>
<a href="#l4.524"></a><span id="l4.524" class="difflineminus">-  if (MSG_GetAttachmentList(pCompose-&gt;GetMsgPane()))</span>
<a href="#l4.525"></a><span id="l4.525" class="difflineminus">-    pCompose-&gt;SetModified(TRUE);</span>
<a href="#l4.526"></a><span id="l4.526" class="difflineminus">-  else</span>
<a href="#l4.527"></a><span id="l4.527" class="difflineminus">-    pCompose-&gt;SetModified(FALSE);</span>
<a href="#l4.528"></a><span id="l4.528" class="difflineminus">-</span>
<a href="#l4.529"></a><span id="l4.529" class="difflineminus">-  // Post message to compose window to set the initial focus.</span>
<a href="#l4.530"></a><span id="l4.530" class="difflineminus">-  pCompose-&gt;PostMessage(WM_COMP_SET_INITIAL_FOCUS);</span>
<a href="#l4.531"></a><span id="l4.531" class="difflineminus">-</span>
<a href="#l4.532"></a><span id="l4.532" class="difflineminus">-  //</span>
<a href="#l4.533"></a><span id="l4.533" class="difflineminus">-  // Now, just popup the window...</span>
<a href="#l4.534"></a><span id="l4.534" class="difflineminus">-  //</span>
<a href="#l4.535"></a><span id="l4.535" class="difflineminus">-  pCompose-&gt;ShowWindow(TRUE);</span>
<a href="#l4.536"></a><span id="l4.536" class="difflineminus">-</span>
<a href="#l4.537"></a><span id="l4.537" class="difflineminus">-  // return pCompose-&gt;GetMsgPane(); rhp - used to return the MsgPane</span>
<a href="#l4.538"></a><span id="l4.538" class="difflineminus">-  return(SUCCESS_SUCCESS);</span>
<a href="#l4.539"></a><span id="l4.539" class="difflineminus">-}</span>
<a href="#l4.540"></a><span id="l4.540" class="difflineminus">-</span>
<a href="#l4.541"></a><span id="l4.541" class="difflineminus">-static void _GetMailCallback(HWND hwnd, MSG_Pane *pane, void *closure)</span>
<a href="#l4.542"></a><span id="l4.542" class="difflineminus">-{</span>
<a href="#l4.543"></a><span id="l4.543" class="difflineminus">-   if (pane != NULL)</span>
<a href="#l4.544"></a><span id="l4.544" class="difflineminus">-   {</span>
<a href="#l4.545"></a><span id="l4.545" class="difflineminus">-     ShowWindow(hwnd, SW_HIDE);</span>
<a href="#l4.546"></a><span id="l4.546" class="difflineminus">-     MSG_Command( pane, MSG_GetNewMail, NULL, 0 );</span>
<a href="#l4.547"></a><span id="l4.547" class="difflineminus">-   }</span>
<a href="#l4.548"></a><span id="l4.548" class="difflineminus">-}</span>
<a href="#l4.549"></a><span id="l4.549" class="difflineminus">-</span>
<a href="#l4.550"></a><span id="l4.550" class="difflineminus">-static void _GetMailDoneCallback(HWND hwnd, MSG_Pane *pane, void *closure)</span>
<a href="#l4.551"></a><span id="l4.551" class="difflineminus">-{</span>
<a href="#l4.552"></a><span id="l4.552" class="difflineminus">-	for(CGenericFrame * f = theApp.m_pFrameList; f; f = f-&gt;m_pNext)</span>
<a href="#l4.553"></a><span id="l4.553" class="difflineminus">-		f-&gt;PostMessage(WM_COMMAND, (WPARAM) ID_DONEGETTINGMAIL, (LPARAM) 0);</span>
<a href="#l4.554"></a><span id="l4.554" class="difflineminus">-}</span>
<a href="#l4.555"></a><span id="l4.555" class="difflineminus">-</span>
<a href="#l4.556"></a><span id="l4.556" class="difflineminus">-//</span>
<a href="#l4.557"></a><span id="l4.557" class="difflineminus">-// This will fire off a &quot;get mail in background operation&quot; in an</span>
<a href="#l4.558"></a><span id="l4.558" class="difflineminus">-// async. fashion.</span>
<a href="#l4.559"></a><span id="l4.559" class="difflineminus">-//</span>
<a href="#l4.560"></a><span id="l4.560" class="difflineminus">-extern &quot;C&quot; void</span>
<a href="#l4.561"></a><span id="l4.561" class="difflineminus">-MAPIGetNewMessagesInBackground(void)</span>
<a href="#l4.562"></a><span id="l4.562" class="difflineminus">-{</span>
<a href="#l4.563"></a><span id="l4.563" class="difflineminus">-CGenericFrame     *pFrame = (CGenericFrame * )FEU_GetLastActiveFrame();</span>
<a href="#l4.564"></a><span id="l4.564" class="difflineminus">-</span>
<a href="#l4.565"></a><span id="l4.565" class="difflineminus">-  // rhp - we should not hit the net if we are offline!</span>
<a href="#l4.566"></a><span id="l4.566" class="difflineminus">-  if (NET_IsOffline())</span>
<a href="#l4.567"></a><span id="l4.567" class="difflineminus">-    return;</span>
<a href="#l4.568"></a><span id="l4.568" class="difflineminus">-</span>
<a href="#l4.569"></a><span id="l4.569" class="difflineminus">-  if (!pFrame)</span>
<a href="#l4.570"></a><span id="l4.570" class="difflineminus">-    return;</span>
<a href="#l4.571"></a><span id="l4.571" class="difflineminus">-</span>
<a href="#l4.572"></a><span id="l4.572" class="difflineminus">-  MWContext *pOldContext = GetUsableContext();</span>
<a href="#l4.573"></a><span id="l4.573" class="difflineminus">-  if (!pOldContext)</span>
<a href="#l4.574"></a><span id="l4.574" class="difflineminus">-    return;</span>
<a href="#l4.575"></a><span id="l4.575" class="difflineminus">-</span>
<a href="#l4.576"></a><span id="l4.576" class="difflineminus">-  TRACE(&quot;MAPI: DOWNLOAD MAIL IN BACKGROUND\n&quot;);</span>
<a href="#l4.577"></a><span id="l4.577" class="difflineminus">-  new CProgressDialog(</span>
<a href="#l4.578"></a><span id="l4.578" class="difflineminus">-                pFrame-&gt;GetFrameWnd(), </span>
<a href="#l4.579"></a><span id="l4.579" class="difflineminus">-                NULL, </span>
<a href="#l4.580"></a><span id="l4.580" class="difflineminus">-                _GetMailCallback, NULL, NULL, </span>
<a href="#l4.581"></a><span id="l4.581" class="difflineminus">-                _GetMailDoneCallback);</span>
<a href="#l4.582"></a><span id="l4.582" class="difflineminus">-}</span>
<a href="#l4.583"></a><span id="l4.583" class="difflineminus">-</span>
<a href="#l4.584"></a><span id="l4.584" class="difflineminus">-//</span>
<a href="#l4.585"></a><span id="l4.585" class="difflineminus">-// This function will save a message into the Communicator &quot;Drafts&quot;</span>
<a href="#l4.586"></a><span id="l4.586" class="difflineminus">-// folder with no UI showing.</span>
<a href="#l4.587"></a><span id="l4.587" class="difflineminus">-//</span>
<a href="#l4.588"></a><span id="l4.588" class="difflineminus">-// Return: appropriate MAPI return code...</span>
<a href="#l4.589"></a><span id="l4.589" class="difflineminus">-//</span>
<a href="#l4.590"></a><span id="l4.590" class="difflineminus">-//</span>
<a href="#l4.591"></a><span id="l4.591" class="difflineminus">-extern &quot;C&quot; LONG </span>
<a href="#l4.592"></a><span id="l4.592" class="difflineminus">-DoMAPISaveMailOperation(MAPISendMailType      *sendMailPtr,</span>
<a href="#l4.593"></a><span id="l4.593" class="difflineminus">-											  const char            *pInitialText)</span>
<a href="#l4.594"></a><span id="l4.594" class="difflineminus">-{</span>
<a href="#l4.595"></a><span id="l4.595" class="difflineminus">-CGenericDoc             *pDocument;</span>
<a href="#l4.596"></a><span id="l4.596" class="difflineminus">-LPSTR                   subject;</span>
<a href="#l4.597"></a><span id="l4.597" class="difflineminus">-NSstringSeq             mailInfoSeq;</span>
<a href="#l4.598"></a><span id="l4.598" class="difflineminus">-DWORD                   stringCount = 6;</span>
<a href="#l4.599"></a><span id="l4.599" class="difflineminus">-DWORD                   i;</span>
<a href="#l4.600"></a><span id="l4.600" class="difflineminus">-BOOL                    winShowFlag = FALSE;</span>
<a href="#l4.601"></a><span id="l4.601" class="difflineminus">-</span>
<a href="#l4.602"></a><span id="l4.602" class="difflineminus">-  // Get a context to use for this call...</span>
<a href="#l4.603"></a><span id="l4.603" class="difflineminus">-  MWContext *pOldContext = GetUsableContext();</span>
<a href="#l4.604"></a><span id="l4.604" class="difflineminus">-  if (!pOldContext)</span>
<a href="#l4.605"></a><span id="l4.605" class="difflineminus">-  {</span>
<a href="#l4.606"></a><span id="l4.606" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.607"></a><span id="l4.607" class="difflineminus">-  }</span>
<a href="#l4.608"></a><span id="l4.608" class="difflineminus">-</span>
<a href="#l4.609"></a><span id="l4.609" class="difflineminus">-  // Don't allow a compose window to be created if the user hasn't </span>
<a href="#l4.610"></a><span id="l4.610" class="difflineminus">-  // specified an email address</span>
<a href="#l4.611"></a><span id="l4.611" class="difflineminus">-  const char *real_addr = FE_UsersMailAddress();</span>
<a href="#l4.612"></a><span id="l4.612" class="difflineminus">-  if (MISC_ValidateReturnAddress(pOldContext, real_addr) &lt; 0)</span>
<a href="#l4.613"></a><span id="l4.613" class="difflineminus">-  {</span>
<a href="#l4.614"></a><span id="l4.614" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.615"></a><span id="l4.615" class="difflineminus">-  }</span>
<a href="#l4.616"></a><span id="l4.616" class="difflineminus">-</span>
<a href="#l4.617"></a><span id="l4.617" class="difflineminus">-  //</span>
<a href="#l4.618"></a><span id="l4.618" class="difflineminus">-  // Now, we must build the fields object...</span>
<a href="#l4.619"></a><span id="l4.619" class="difflineminus">-  //</span>
<a href="#l4.620"></a><span id="l4.620" class="difflineminus">-  mailInfoSeq = (NSstringSeq) &amp;(sendMailPtr-&gt;dataBuf[0]);</span>
<a href="#l4.621"></a><span id="l4.621" class="difflineminus">-  subject = NSStrSeqGet(mailInfoSeq, 0);</span>
<a href="#l4.622"></a><span id="l4.622" class="difflineminus">-</span>
<a href="#l4.623"></a><span id="l4.623" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPISendMail() Subject   = [%s]\n&quot;, subject);</span>
<a href="#l4.624"></a><span id="l4.624" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPISendMail() Text Size = [%d]\n&quot;, strlen((const char *)pInitialText));</span>
<a href="#l4.625"></a><span id="l4.625" class="difflineminus">-  TRACE(&quot;MAPI: ProcessMAPISendMail() # of Recipients  = [%d]\n&quot;, sendMailPtr-&gt;MSG_nRecipCount);</span>
<a href="#l4.626"></a><span id="l4.626" class="difflineminus">-</span>
<a href="#l4.627"></a><span id="l4.627" class="difflineminus">-</span>
<a href="#l4.628"></a><span id="l4.628" class="difflineminus">-  char  toString[1024] = &quot;&quot;;</span>
<a href="#l4.629"></a><span id="l4.629" class="difflineminus">-  char  ccString[1024] = &quot;&quot;;</span>
<a href="#l4.630"></a><span id="l4.630" class="difflineminus">-  char  bccString[1024] = &quot;&quot;;</span>
<a href="#l4.631"></a><span id="l4.631" class="difflineminus">-</span>
<a href="#l4.632"></a><span id="l4.632" class="difflineminus">-  for (i=0; i&lt;sendMailPtr-&gt;MSG_nRecipCount; i++)</span>
<a href="#l4.633"></a><span id="l4.633" class="difflineminus">-  {</span>
<a href="#l4.634"></a><span id="l4.634" class="difflineminus">-    LPSTR   ptr;</span>
<a href="#l4.635"></a><span id="l4.635" class="difflineminus">-    UCHAR   tempString[256];</span>
<a href="#l4.636"></a><span id="l4.636" class="difflineminus">-</span>
<a href="#l4.637"></a><span id="l4.637" class="difflineminus">-    ULONG addrType = atoi(NSStrSeqGet(mailInfoSeq, stringCount++));</span>
<a href="#l4.638"></a><span id="l4.638" class="difflineminus">-</span>
<a href="#l4.639"></a><span id="l4.639" class="difflineminus">-    // figure which type of address this is?</span>
<a href="#l4.640"></a><span id="l4.640" class="difflineminus">-    if (addrType == MAPI_CC)</span>
<a href="#l4.641"></a><span id="l4.641" class="difflineminus">-      ptr = ccString;</span>
<a href="#l4.642"></a><span id="l4.642" class="difflineminus">-    else if (addrType == MAPI_BCC)</span>
<a href="#l4.643"></a><span id="l4.643" class="difflineminus">-      ptr = bccString;</span>
<a href="#l4.644"></a><span id="l4.644" class="difflineminus">-    else</span>
<a href="#l4.645"></a><span id="l4.645" class="difflineminus">-      ptr = toString;</span>
<a href="#l4.646"></a><span id="l4.646" class="difflineminus">-</span>
<a href="#l4.647"></a><span id="l4.647" class="difflineminus">-    LPSTR namePtr = (LPSTR) NSStrSeqGet(mailInfoSeq, stringCount++);</span>
<a href="#l4.648"></a><span id="l4.648" class="difflineminus">-    LPSTR emailPtr = (LPSTR) NSStrSeqGet(mailInfoSeq, stringCount++);</span>
<a href="#l4.649"></a><span id="l4.649" class="difflineminus">-</span>
<a href="#l4.650"></a><span id="l4.650" class="difflineminus">-    if ( (!emailPtr) &amp;&amp; (!namePtr))</span>
<a href="#l4.651"></a><span id="l4.651" class="difflineminus">-    {</span>
<a href="#l4.652"></a><span id="l4.652" class="difflineminus">-      return(MAPI_E_INVALID_RECIPS);</span>
<a href="#l4.653"></a><span id="l4.653" class="difflineminus">-    }</span>
<a href="#l4.654"></a><span id="l4.654" class="difflineminus">-</span>
<a href="#l4.655"></a><span id="l4.655" class="difflineminus">-    if (!emailPtr)</span>
<a href="#l4.656"></a><span id="l4.656" class="difflineminus">-      emailPtr = namePtr;</span>
<a href="#l4.657"></a><span id="l4.657" class="difflineminus">-</span>
<a href="#l4.658"></a><span id="l4.658" class="difflineminus">-    char *tptr = strchr(emailPtr, ':');</span>
<a href="#l4.659"></a><span id="l4.659" class="difflineminus">-    if (tptr != NULL)</span>
<a href="#l4.660"></a><span id="l4.660" class="difflineminus">-    {</span>
<a href="#l4.661"></a><span id="l4.661" class="difflineminus">-      if ( (*tptr != '\0') &amp;&amp; (*(tptr+1) != '\0') )</span>
<a href="#l4.662"></a><span id="l4.662" class="difflineminus">-      {</span>
<a href="#l4.663"></a><span id="l4.663" class="difflineminus">-        emailPtr = (tptr + 1);</span>
<a href="#l4.664"></a><span id="l4.664" class="difflineminus">-      }</span>
<a href="#l4.665"></a><span id="l4.665" class="difflineminus">-    }</span>
<a href="#l4.666"></a><span id="l4.666" class="difflineminus">-/**</span>
<a href="#l4.667"></a><span id="l4.667" class="difflineminus">-    if ( (lstrlen(emailPtr) &gt; 5) &amp;&amp; (*(emailPtr + 4) == ':') )</span>
<a href="#l4.668"></a><span id="l4.668" class="difflineminus">-    {</span>
<a href="#l4.669"></a><span id="l4.669" class="difflineminus">-      emailPtr += 5;</span>
<a href="#l4.670"></a><span id="l4.670" class="difflineminus">-    }</span>
<a href="#l4.671"></a><span id="l4.671" class="difflineminus">-**/</span>
<a href="#l4.672"></a><span id="l4.672" class="difflineminus">-    // Now build the temp string to tack on in the format</span>
<a href="#l4.673"></a><span id="l4.673" class="difflineminus">-    // &quot;Rich Pizzarro&quot; &lt;rhp@netscape.com&gt;</span>
<a href="#l4.674"></a><span id="l4.674" class="difflineminus">-    wsprintf((LPSTR) tempString, &quot;\&quot;%s\&quot; &lt;%s&gt;&quot;, namePtr, emailPtr);</span>
<a href="#l4.675"></a><span id="l4.675" class="difflineminus">-</span>
<a href="#l4.676"></a><span id="l4.676" class="difflineminus">-    // add a comma if not the first one</span>
<a href="#l4.677"></a><span id="l4.677" class="difflineminus">-    if (ptr[0] != '\0')</span>
<a href="#l4.678"></a><span id="l4.678" class="difflineminus">-      lstrcat(ptr, &quot;,&quot;);</span>
<a href="#l4.679"></a><span id="l4.679" class="difflineminus">-</span>
<a href="#l4.680"></a><span id="l4.680" class="difflineminus">-    // tack on string!</span>
<a href="#l4.681"></a><span id="l4.681" class="difflineminus">-    lstrcat(ptr, (LPSTR) tempString);</span>
<a href="#l4.682"></a><span id="l4.682" class="difflineminus">-  }</span>
<a href="#l4.683"></a><span id="l4.683" class="difflineminus">-</span>
<a href="#l4.684"></a><span id="l4.684" class="difflineminus">-  BOOL    bEncrypt = FALSE;</span>
<a href="#l4.685"></a><span id="l4.685" class="difflineminus">-  BOOL    bSign    = FALSE;</span>
<a href="#l4.686"></a><span id="l4.686" class="difflineminus">-</span>
<a href="#l4.687"></a><span id="l4.687" class="difflineminus">-  PREF_GetBoolPref(&quot;mail.crypto_sign_outgoing_mail&quot;, &amp;bSign);</span>
<a href="#l4.688"></a><span id="l4.688" class="difflineminus">-  PREF_GetBoolPref(&quot;mail.encrypt_outgoing_mail&quot;, &amp;bEncrypt);</span>
<a href="#l4.689"></a><span id="l4.689" class="difflineminus">-  MSG_CompositionFields *fields =</span>
<a href="#l4.690"></a><span id="l4.690" class="difflineminus">-      MSG_CreateCompositionFields(real_addr, real_addr, </span>
<a href="#l4.691"></a><span id="l4.691" class="difflineminus">-                  toString, </span>
<a href="#l4.692"></a><span id="l4.692" class="difflineminus">-                  ccString, </span>
<a href="#l4.693"></a><span id="l4.693" class="difflineminus">-                  bccString,</span>
<a href="#l4.694"></a><span id="l4.694" class="difflineminus">-									&quot;&quot;, &quot;&quot;, &quot;&quot;,</span>
<a href="#l4.695"></a><span id="l4.695" class="difflineminus">-									&quot;&quot;, subject, &quot;&quot;,</span>
<a href="#l4.696"></a><span id="l4.696" class="difflineminus">-									&quot;&quot;, &quot;&quot;, &quot;&quot;,</span>
<a href="#l4.697"></a><span id="l4.697" class="difflineminus">-									&quot;&quot;, </span>
<a href="#l4.698"></a><span id="l4.698" class="difflineminus">-                  bEncrypt,</span>
<a href="#l4.699"></a><span id="l4.699" class="difflineminus">-                  bSign);</span>
<a href="#l4.700"></a><span id="l4.700" class="difflineminus">-  if (!fields)</span>
<a href="#l4.701"></a><span id="l4.701" class="difflineminus">-  {</span>
<a href="#l4.702"></a><span id="l4.702" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.703"></a><span id="l4.703" class="difflineminus">-  }</span>
<a href="#l4.704"></a><span id="l4.704" class="difflineminus">-</span>
<a href="#l4.705"></a><span id="l4.705" class="difflineminus">-  // RICHIE</span>
<a href="#l4.706"></a><span id="l4.706" class="difflineminus">-  // INTL_CharSetInfo csi = LO_GetDocumentCharacterSetInfo(pOldContext);</span>
<a href="#l4.707"></a><span id="l4.707" class="difflineminus">-  // int16 win_csid = INTL_GetCSIWinCSID(csi);</span>
<a href="#l4.708"></a><span id="l4.708" class="difflineminus">-  </span>
<a href="#l4.709"></a><span id="l4.709" class="difflineminus">-  pDocument = (CGenericDoc*)theApp.m_TextComposeTemplate-&gt;OpenDocumentFile(NULL, NULL, /*win_csid RICHIE*/ winShowFlag);</span>
<a href="#l4.710"></a><span id="l4.710" class="difflineminus">-  if ( !pDocument )</span>
<a href="#l4.711"></a><span id="l4.711" class="difflineminus">-  {</span>
<a href="#l4.712"></a><span id="l4.712" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.713"></a><span id="l4.713" class="difflineminus">-  }</span>
<a href="#l4.714"></a><span id="l4.714" class="difflineminus">-  </span>
<a href="#l4.715"></a><span id="l4.715" class="difflineminus">-  CWinCX * pContext = (CWinCX*) pDocument-&gt;GetContext();</span>
<a href="#l4.716"></a><span id="l4.716" class="difflineminus">-  if ( !pContext ) </span>
<a href="#l4.717"></a><span id="l4.717" class="difflineminus">-  {</span>
<a href="#l4.718"></a><span id="l4.718" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l4.719"></a><span id="l4.719" class="difflineminus">-  }</span>
<a href="#l4.720"></a><span id="l4.720" class="difflineminus">-</span>
<a href="#l4.721"></a><span id="l4.721" class="difflineminus">-  MSG_CompositionPaneCallbacks Callbacks;</span>
<a href="#l4.722"></a><span id="l4.722" class="difflineminus">-  Callbacks.CreateRecipientsDialog = CreateRecipientsDialog;</span>
<a href="#l4.723"></a><span id="l4.723" class="difflineminus">-  Callbacks.CreateAskHTMLDialog = CreateAskHTMLDialog;</span>
<a href="#l4.724"></a><span id="l4.724" class="difflineminus">-</span>
<a href="#l4.725"></a><span id="l4.725" class="difflineminus">-  int16 doccsid;</span>
<a href="#l4.726"></a><span id="l4.726" class="difflineminus">-  MWContext *context = pContext-&gt;GetContext();</span>
<a href="#l4.727"></a><span id="l4.727" class="difflineminus">-  CComposeFrame *pCompose = (CComposeFrame *) pContext-&gt;GetFrame()-&gt;GetFrameWnd();</span>
<a href="#l4.728"></a><span id="l4.728" class="difflineminus">-</span>
<a href="#l4.729"></a><span id="l4.729" class="difflineminus">-  pCompose-&gt;SetComposeStuff(context, fields); // squirl away stuff for post-create</span>
<a href="#l4.730"></a><span id="l4.730" class="difflineminus">-</span>
<a href="#l4.731"></a><span id="l4.731" class="difflineminus">-  // This needs to be set TRUE if using the old non-HTML text frame</span>
<a href="#l4.732"></a><span id="l4.732" class="difflineminus">-  // to prevent dropping dragged URLs</span>
<a href="#l4.733"></a><span id="l4.733" class="difflineminus">-  pContext-&gt;m_bDragging = !pCompose-&gt;UseHtml();</span>
<a href="#l4.734"></a><span id="l4.734" class="difflineminus">-  if (!pCompose-&gt;UseHtml()) </span>
<a href="#l4.735"></a><span id="l4.735" class="difflineminus">-  {</span>
<a href="#l4.736"></a><span id="l4.736" class="difflineminus">-    pCompose-&gt;SetMsgPane(</span>
<a href="#l4.737"></a><span id="l4.737" class="difflineminus">-      MSG_CreateCompositionPane(pContext-&gt;GetContext(), </span>
<a href="#l4.738"></a><span id="l4.738" class="difflineminus">-                                context, </span>
<a href="#l4.739"></a><span id="l4.739" class="difflineminus">-                                g_MsgPrefs.m_pMsgPrefs, </span>
<a href="#l4.740"></a><span id="l4.740" class="difflineminus">-                                fields,</span>
<a href="#l4.741"></a><span id="l4.741" class="difflineminus">-                                WFE_MSGGetMaster())</span>
<a href="#l4.742"></a><span id="l4.742" class="difflineminus">-                        );</span>
<a href="#l4.743"></a><span id="l4.743" class="difflineminus">-  }</span>
<a href="#l4.744"></a><span id="l4.744" class="difflineminus">-</span>
<a href="#l4.745"></a><span id="l4.745" class="difflineminus">-  ASSERT(pCompose-&gt;GetMsgPane());</span>
<a href="#l4.746"></a><span id="l4.746" class="difflineminus">-  MSG_SetFEData(pCompose-&gt;GetMsgPane(),(void *)pCompose);  </span>
<a href="#l4.747"></a><span id="l4.747" class="difflineminus">-  pCompose-&gt;UpdateAttachmentInfo();</span>
<a href="#l4.748"></a><span id="l4.748" class="difflineminus">-</span>
<a href="#l4.749"></a><span id="l4.749" class="difflineminus">-  // Pass doccsid info to new context for MailToWin conversion</span>
<a href="#l4.750"></a><span id="l4.750" class="difflineminus">-  doccsid = INTL_GetCSIDocCSID(LO_GetDocumentCharacterSetInfo(context));</span>
<a href="#l4.751"></a><span id="l4.751" class="difflineminus">-  INTL_SetCSIDocCSID(LO_GetDocumentCharacterSetInfo(context), </span>
<a href="#l4.752"></a><span id="l4.752" class="difflineminus">-    (doccsid ? doccsid : INTL_DefaultDocCharSetID(context)));</span>
<a href="#l4.753"></a><span id="l4.753" class="difflineminus">-</span>
<a href="#l4.754"></a><span id="l4.754" class="difflineminus">-  pCompose-&gt;DisplayHeaders(NULL);</span>
<a href="#l4.755"></a><span id="l4.755" class="difflineminus">-</span>
<a href="#l4.756"></a><span id="l4.756" class="difflineminus">-  CComposeBar * pBar = pCompose-&gt;GetComposeBar();</span>
<a href="#l4.757"></a><span id="l4.757" class="difflineminus">-  ASSERT(pBar);</span>
<a href="#l4.758"></a><span id="l4.758" class="difflineminus">-  LPADDRESSCONTROL pIAddressList = pBar-&gt;GetAddressWidgetInterface();</span>
<a href="#l4.759"></a><span id="l4.759" class="difflineminus">-</span>
<a href="#l4.760"></a><span id="l4.760" class="difflineminus">-  if (!pIAddressList-&gt;IsCreated()) </span>
<a href="#l4.761"></a><span id="l4.761" class="difflineminus">-  {</span>
<a href="#l4.762"></a><span id="l4.762" class="difflineminus">-    pBar-&gt;CreateAddressingBlock();</span>
<a href="#l4.763"></a><span id="l4.763" class="difflineminus">-  }</span>
<a href="#l4.764"></a><span id="l4.764" class="difflineminus">-</span>
<a href="#l4.765"></a><span id="l4.765" class="difflineminus">-  // rhp - Deal with addressing the brute force way! This is a </span>
<a href="#l4.766"></a><span id="l4.766" class="difflineminus">-  // &quot;fix&quot; for bad behavior when creating these windows and not</span>
<a href="#l4.767"></a><span id="l4.767" class="difflineminus">-  // showing them on the desktop.</span>
<a href="#l4.768"></a><span id="l4.768" class="difflineminus">-  if (!winShowFlag)      // Hack to fix the window not being mapped</span>
<a href="#l4.769"></a><span id="l4.769" class="difflineminus">-  {</span>
<a href="#l4.770"></a><span id="l4.770" class="difflineminus">-    pCompose-&gt;AppendAddress(MSG_TO_HEADER_MASK, &quot;&quot;);</span>
<a href="#l4.771"></a><span id="l4.771" class="difflineminus">-    pCompose-&gt;AppendAddress(MSG_CC_HEADER_MASK, &quot;&quot;);</span>
<a href="#l4.772"></a><span id="l4.772" class="difflineminus">-    pCompose-&gt;AppendAddress(MSG_BCC_HEADER_MASK, &quot;&quot;);</span>
<a href="#l4.773"></a><span id="l4.773" class="difflineminus">-  }</span>
<a href="#l4.774"></a><span id="l4.774" class="difflineminus">-</span>
<a href="#l4.775"></a><span id="l4.775" class="difflineminus">-  // Always do plain text composition!</span>
<a href="#l4.776"></a><span id="l4.776" class="difflineminus">-  pCompose-&gt;CompleteComposeInitialization();</span>
<a href="#l4.777"></a><span id="l4.777" class="difflineminus">-</span>
<a href="#l4.778"></a><span id="l4.778" class="difflineminus">-  // Do this so we don't get popups on &quot;empty&quot; messages</span>
<a href="#l4.779"></a><span id="l4.779" class="difflineminus">-  if ( (!pInitialText) || (!(*pInitialText)) )</span>
<a href="#l4.780"></a><span id="l4.780" class="difflineminus">-    pInitialText = &quot; &quot;;</span>
<a href="#l4.781"></a><span id="l4.781" class="difflineminus">-</span>
<a href="#l4.782"></a><span id="l4.782" class="difflineminus">-  const char * pBody = pInitialText ? pInitialText : MSG_GetCompBody(pCompose-&gt;GetMsgPane());</span>
<a href="#l4.783"></a><span id="l4.783" class="difflineminus">-  if (pBody)</span>
<a href="#l4.784"></a><span id="l4.784" class="difflineminus">-  {</span>
<a href="#l4.785"></a><span id="l4.785" class="difflineminus">-    FE_InsertMessageCompositionText(context,pBody,TRUE);</span>
<a href="#l4.786"></a><span id="l4.786" class="difflineminus">-  }</span>
<a href="#l4.787"></a><span id="l4.787" class="difflineminus">-</span>
<a href="#l4.788"></a><span id="l4.788" class="difflineminus">-  // </span>
<a href="#l4.789"></a><span id="l4.789" class="difflineminus">-  // Now set the message as being edited!    </span>
<a href="#l4.790"></a><span id="l4.790" class="difflineminus">-  //</span>
<a href="#l4.791"></a><span id="l4.791" class="difflineminus">-  pCompose-&gt;SetModified(TRUE);</span>
<a href="#l4.792"></a><span id="l4.792" class="difflineminus">-</span>
<a href="#l4.793"></a><span id="l4.793" class="difflineminus">-  //</span>
<a href="#l4.794"></a><span id="l4.794" class="difflineminus">-  // Finally deal with the attachments...</span>
<a href="#l4.795"></a><span id="l4.795" class="difflineminus">-  //</span>
<a href="#l4.796"></a><span id="l4.796" class="difflineminus">-  if (sendMailPtr-&gt;MSG_nFileCount &gt; 0)</span>
<a href="#l4.797"></a><span id="l4.797" class="difflineminus">-  {</span>
<a href="#l4.798"></a><span id="l4.798" class="difflineminus">-    // Send this puppy when done with the attachments...</span>
<a href="#l4.799"></a><span id="l4.799" class="difflineminus">-    if (!winShowFlag)</span>
<a href="#l4.800"></a><span id="l4.800" class="difflineminus">-    {</span>
<a href="#l4.801"></a><span id="l4.801" class="difflineminus">-      pCompose-&gt;SetMAPISendMode(MAPI_SAVE);</span>
<a href="#l4.802"></a><span id="l4.802" class="difflineminus">-    }</span>
<a href="#l4.803"></a><span id="l4.803" class="difflineminus">-</span>
<a href="#l4.804"></a><span id="l4.804" class="difflineminus">-    MSG_AttachmentData *pAttach = (MSG_AttachmentData *)</span>
<a href="#l4.805"></a><span id="l4.805" class="difflineminus">-                  XP_CALLOC((sendMailPtr-&gt;MSG_nFileCount + 1),</span>
<a href="#l4.806"></a><span id="l4.806" class="difflineminus">-                  sizeof(MSG_AttachmentData));</span>
<a href="#l4.807"></a><span id="l4.807" class="difflineminus">-    if (!pAttach)</span>
<a href="#l4.808"></a><span id="l4.808" class="difflineminus">-    {</span>
<a href="#l4.809"></a><span id="l4.809" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l4.810"></a><span id="l4.810" class="difflineminus">-    }</span>
<a href="#l4.811"></a><span id="l4.811" class="difflineminus">-</span>
<a href="#l4.812"></a><span id="l4.812" class="difflineminus">-    memset(pAttach, 0, (sendMailPtr-&gt;MSG_nFileCount + 1) * </span>
<a href="#l4.813"></a><span id="l4.813" class="difflineminus">-                                sizeof(MSG_AttachmentData));</span>
<a href="#l4.814"></a><span id="l4.814" class="difflineminus">-    for (i=0; i&lt;sendMailPtr-&gt;MSG_nFileCount; i++)</span>
<a href="#l4.815"></a><span id="l4.815" class="difflineminus">-    {</span>
<a href="#l4.816"></a><span id="l4.816" class="difflineminus">-      CString cs;</span>
<a href="#l4.817"></a><span id="l4.817" class="difflineminus">-      // Create URL from filename...</span>
<a href="#l4.818"></a><span id="l4.818" class="difflineminus">-      WFE_ConvertFile2Url(cs, </span>
<a href="#l4.819"></a><span id="l4.819" class="difflineminus">-          (const char *)NSStrSeqGet(mailInfoSeq, stringCount++));</span>
<a href="#l4.820"></a><span id="l4.820" class="difflineminus">-      pAttach[i].url = XP_STRDUP(cs);</span>
<a href="#l4.821"></a><span id="l4.821" class="difflineminus">-</span>
<a href="#l4.822"></a><span id="l4.822" class="difflineminus">-      // Now also include the &quot;display&quot; name...</span>
<a href="#l4.823"></a><span id="l4.823" class="difflineminus">-      StrAllocCopy(pAttach[i].real_name, NSStrSeqGet(mailInfoSeq, stringCount++));</span>
<a href="#l4.824"></a><span id="l4.824" class="difflineminus">-    }</span>
<a href="#l4.825"></a><span id="l4.825" class="difflineminus">-</span>
<a href="#l4.826"></a><span id="l4.826" class="difflineminus">-    // Set the list!</span>
<a href="#l4.827"></a><span id="l4.827" class="difflineminus">-    MSG_SetAttachmentList(pCompose-&gt;GetMsgPane(), pAttach);</span>
<a href="#l4.828"></a><span id="l4.828" class="difflineminus">-</span>
<a href="#l4.829"></a><span id="l4.829" class="difflineminus">-    // Now free everything...</span>
<a href="#l4.830"></a><span id="l4.830" class="difflineminus">-    for (i=0; i&lt;sendMailPtr-&gt;MSG_nFileCount; i++)</span>
<a href="#l4.831"></a><span id="l4.831" class="difflineminus">-    {</span>
<a href="#l4.832"></a><span id="l4.832" class="difflineminus">-      if (pAttach[i].url)</span>
<a href="#l4.833"></a><span id="l4.833" class="difflineminus">-        XP_FREE(pAttach[i].url);</span>
<a href="#l4.834"></a><span id="l4.834" class="difflineminus">-</span>
<a href="#l4.835"></a><span id="l4.835" class="difflineminus">-      if (pAttach[i].real_name)</span>
<a href="#l4.836"></a><span id="l4.836" class="difflineminus">-        XP_FREE(pAttach[i].real_name);</span>
<a href="#l4.837"></a><span id="l4.837" class="difflineminus">-    }</span>
<a href="#l4.838"></a><span id="l4.838" class="difflineminus">-</span>
<a href="#l4.839"></a><span id="l4.839" class="difflineminus">-    XP_FREE(pAttach);</span>
<a href="#l4.840"></a><span id="l4.840" class="difflineminus">-  }</span>
<a href="#l4.841"></a><span id="l4.841" class="difflineminus">-</span>
<a href="#l4.842"></a><span id="l4.842" class="difflineminus">-  //</span>
<a href="#l4.843"></a><span id="l4.843" class="difflineminus">-  // Now, if we were supposed to do the blind send...do it, otherwise,</span>
<a href="#l4.844"></a><span id="l4.844" class="difflineminus">-  // just popup the window...</span>
<a href="#l4.845"></a><span id="l4.845" class="difflineminus">-  //</span>
<a href="#l4.846"></a><span id="l4.846" class="difflineminus">-  if (winShowFlag)      </span>
<a href="#l4.847"></a><span id="l4.847" class="difflineminus">-  {</span>
<a href="#l4.848"></a><span id="l4.848" class="difflineminus">-    // Post message to compose window to set the initial focus.</span>
<a href="#l4.849"></a><span id="l4.849" class="difflineminus">-    pCompose-&gt;PostMessage(WM_COMP_SET_INITIAL_FOCUS);</span>
<a href="#l4.850"></a><span id="l4.850" class="difflineminus">-  }</span>
<a href="#l4.851"></a><span id="l4.851" class="difflineminus">-  else if (sendMailPtr-&gt;MSG_nFileCount &lt;= 0)  // Send NOW if no attachments!</span>
<a href="#l4.852"></a><span id="l4.852" class="difflineminus">-  {</span>
<a href="#l4.853"></a><span id="l4.853" class="difflineminus">-    pCompose-&gt;PostMessage(WM_COMMAND, IDM_SAVEASDRAFT);</span>
<a href="#l4.854"></a><span id="l4.854" class="difflineminus">-  }</span>
<a href="#l4.855"></a><span id="l4.855" class="difflineminus">-</span>
<a href="#l4.856"></a><span id="l4.856" class="difflineminus">-  return(SUCCESS_SUCCESS);</span>
<a href="#l4.857"></a><span id="l4.857" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">deleted file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- a/mailnews/mapi/old/hook/mapimail.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ /dev/null</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -1,89 +0,0 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">- *</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">- *</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">- * License.</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">- *</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">- *</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">- *</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">- *</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">- *</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-#ifndef _MAPI_MAIL_H_</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-#define _MAPI_MAIL_H_</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-#include &quot;nscpmapi.h&quot;</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineminus">-#include &lt;structs.h&gt;    // for MWContext</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-//extern &quot;C&quot; {</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-//</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-// This function will create a composition window and either do</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-// a blind send or pop up the compose window for the user to </span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-// complete the operation</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-//</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-// Return: appropriate MAPI return code...</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-//</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-//</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-extern &quot;C&quot; LONG</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-DoFullMAPIMailOperation(MAPISendMailType      *sendMailPtr,</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-											  const char            *pInitialText,</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-                        BOOL                  winShowFlag);</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-//</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-// This function will create a composition window and just attach</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-// the attachments of interest and pop up the window...</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-//</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-// Return: appropriate MAPI return code...</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-//</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-//</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-extern &quot;C&quot; LONG</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-DoPartialMAPIMailOperation(MAPISendDocumentsType *sendDocPtr);</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-//</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-// This function will save a message into the Communicator &quot;Drafts&quot;</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-// folder with no UI showing.</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-//</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-// Return: appropriate MAPI return code...</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-//</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-//</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-extern &quot;C&quot; LONG </span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-DoMAPISaveMailOperation(MAPISendMailType      *sendMailPtr,</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-											  const char            *pInitialText);</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-//</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-// This will fire off a &quot;get mail in background operation&quot; in an</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-// async. fashion.</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-//</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-extern &quot;C&quot; void</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-MAPIGetNewMessagesInBackground(void);</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-// } // extern &quot;C&quot;</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-#endif // _MAPI_MAIL_H_</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">deleted file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- a/mailnews/mapi/old/lib/Makefile.win</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ /dev/null</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -1,67 +0,0 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineminus">-#!nmake</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineminus">-#</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">-#</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-#</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-# License.</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-#</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-#</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">-#</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-# Contributor(s):</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-#</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-#</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-DEPTH=..\..\..</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineminus">-MODULE=mapiutils</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">-</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineminus">-include &lt;$(DEPTH)\config\config.mak&gt;</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineminus">-</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-################################################################################</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-## exports</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-EXPORTS=	mapismem.h	\</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-    		nsstrseq.h	\</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-			$(NULL)</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineminus">-</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineminus">-################################################################################</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-## library</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineminus">-LIBRARY_NAME=mapiutils_s</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineminus">-</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-CPP_OBJS=   .\$(OBJDIR)\mapismem.obj		\</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-			.\$(OBJDIR)\nsstrseq.obj		\</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-			$(NULL)</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-include &lt;$(DEPTH)\config\rules.mak&gt;</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-install:: $(LIBRARY)</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-	$(MAKE_INSTALL) $(LIBRARY) $(DIST)\lib</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-clobber::</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-	rm -f $(DIST)\lib\$(LIBRARY_NAME).lib</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">deleted file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- a/mailnews/mapi/old/lib/mapismem.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ /dev/null</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -1,173 +0,0 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineminus">- *</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">- *</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">- * License.</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">- *</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">- *</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">- *</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">- *</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">- *</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineminus">-//</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineminus">-//  smem.cpp - This deals with all shared memory functions needed for </span>
<a href="#l7.43"></a><span id="l7.43" class="difflineminus">-//  the MAPI component of Communicator</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-//  November 1997</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-//</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-#include &lt;windowsx.h&gt;</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineminus">-</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-#include &quot;mapismem.h&quot;</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-#ifndef ZeroMemory</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-#include &lt;memory.h&gt;</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-#define ZeroMemory(PTR, SIZE) memset(PTR, 0, SIZE)</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-#endif // ZeroMemory</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-// </span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-// *create new* shared memory chunk </span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-// once this is created, use the pointer</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-// to the segment to to store data </span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-// e.g.: </span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-//     lpString = &quot;string for communicator&quot;; </span>
<a href="#l7.64"></a><span id="l7.64" class="difflineminus">-//     lstrcpy((LPSTR)pData-&gt;m_buf[0], lpString); </span>
<a href="#l7.65"></a><span id="l7.65" class="difflineminus">-//  </span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-CSharedMem *</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-NSCreateSharedMemory(DWORD memSize, LPCTSTR memName, HANDLE *hSharedMemory)</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-{</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-#ifdef WIN32</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-  BOOL bExistedBefore;</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineminus">-  CSharedMem *pData;</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineminus">-</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-  LPCTSTR szObjectName = memName; </span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-  DWORD dwSize = sizeof(CSharedMem) + memSize; </span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-  *hSharedMemory = CreateFileMapping( </span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-    (HANDLE)0xFFFFFFFF,0,PAGE_READWRITE,0,dwSize,szObjectName); </span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-  if(*hSharedMemory == 0) </span>
<a href="#l7.79"></a><span id="l7.79" class="difflineminus">-  { </span>
<a href="#l7.80"></a><span id="l7.80" class="difflineminus">-    return NULL; </span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-  } </span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-  bExistedBefore = (GetLastError() == ERROR_ALREADY_EXISTS); </span>
<a href="#l7.83"></a><span id="l7.83" class="difflineminus">-  if(bExistedBefore) </span>
<a href="#l7.84"></a><span id="l7.84" class="difflineminus">-  { </span>
<a href="#l7.85"></a><span id="l7.85" class="difflineminus">-  	return NULL;</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineminus">-  } </span>
<a href="#l7.87"></a><span id="l7.87" class="difflineminus">-</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-  pData = (CSharedMem *)MapViewOfFile( </span>
<a href="#l7.89"></a><span id="l7.89" class="difflineminus">-            *hSharedMemory, FILE_MAP_ALL_ACCESS, 0, 0, 0); </span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-  if(pData == NULL) </span>
<a href="#l7.91"></a><span id="l7.91" class="difflineminus">-  { </span>
<a href="#l7.92"></a><span id="l7.92" class="difflineminus">-    return NULL; </span>
<a href="#l7.93"></a><span id="l7.93" class="difflineminus">-  } </span>
<a href="#l7.94"></a><span id="l7.94" class="difflineminus">-</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineminus">-  ZeroMemory(pData, dwSize); </span>
<a href="#l7.96"></a><span id="l7.96" class="difflineminus">-  pData-&gt;m_dwSize = memSize; </span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-  return pData;</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineminus">-#else</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-  CSharedMem 	*sMemChunk = NULL;</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineminus">-  DWORD dwSize = memSize = (sizeof(CSharedMem) + memSize); </span>
<a href="#l7.102"></a><span id="l7.102" class="difflineminus">-</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineminus">-  if (sMemChunk != NULL)</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineminus">-	  return(sMemChunk);</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineminus">-</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineminus">-  sMemChunk = (CSharedMem *) GlobalAllocPtr(GMEM_MOVEABLE, dwSize);</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineminus">-  ZeroMemory(sMemChunk, (size_t) dwSize);</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineminus">-  sMemChunk-&gt;m_dwSize = dwSize;   // Missing in Communicator code!</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineminus">-  return(sMemChunk);</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineminus">-</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineminus">-#endif // WIN32</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineminus">-}</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineminus">-</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineminus">-// </span>
<a href="#l7.115"></a><span id="l7.115" class="difflineminus">-// *open existing* shared memory chunk </span>
<a href="#l7.116"></a><span id="l7.116" class="difflineminus">-// once you have the pointer to the new segment </span>
<a href="#l7.117"></a><span id="l7.117" class="difflineminus">-// use this pointer to access data, e.g.: </span>
<a href="#l7.118"></a><span id="l7.118" class="difflineminus">-// </span>
<a href="#l7.119"></a><span id="l7.119" class="difflineminus">-CSharedMem *</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineminus">-NSOpenExistingSharedMemory(LPCTSTR memName, HANDLE *hSharedMemory)</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineminus">-{</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineminus">-#ifdef WIN32</span>
<a href="#l7.123"></a><span id="l7.123" class="difflineminus">-  CSharedMem *pData;</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineminus">-  DWORD dwSize;</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineminus">-</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineminus">-  LPCTSTR szObjectName = memName; </span>
<a href="#l7.127"></a><span id="l7.127" class="difflineminus">-  *hSharedMemory = OpenFileMapping( </span>
<a href="#l7.128"></a><span id="l7.128" class="difflineminus">-    FILE_MAP_WRITE,FALSE,szObjectName); </span>
<a href="#l7.129"></a><span id="l7.129" class="difflineminus">-  if(*hSharedMemory == 0) </span>
<a href="#l7.130"></a><span id="l7.130" class="difflineminus">-  { </span>
<a href="#l7.131"></a><span id="l7.131" class="difflineminus">-    return NULL; </span>
<a href="#l7.132"></a><span id="l7.132" class="difflineminus">-  } </span>
<a href="#l7.133"></a><span id="l7.133" class="difflineminus">-</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineminus">-  pData = (CSharedMem *)MapViewOfFile( </span>
<a href="#l7.135"></a><span id="l7.135" class="difflineminus">-              *hSharedMemory,FILE_MAP_ALL_ACCESS,0,0,0); </span>
<a href="#l7.136"></a><span id="l7.136" class="difflineminus">-  if(pData == NULL) </span>
<a href="#l7.137"></a><span id="l7.137" class="difflineminus">-  { </span>
<a href="#l7.138"></a><span id="l7.138" class="difflineminus">-    return NULL; </span>
<a href="#l7.139"></a><span id="l7.139" class="difflineminus">-  } </span>
<a href="#l7.140"></a><span id="l7.140" class="difflineminus">-  </span>
<a href="#l7.141"></a><span id="l7.141" class="difflineminus">-  dwSize = pData-&gt;m_dwSize; </span>
<a href="#l7.142"></a><span id="l7.142" class="difflineminus">-  return pData;</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineminus">-#else</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineminus">-</span>
<a href="#l7.145"></a><span id="l7.145" class="difflineminus">-  return(NULL);   // In Win16, this is really meaningless...</span>
<a href="#l7.146"></a><span id="l7.146" class="difflineminus">-</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineminus">-#endif</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineminus">-}  </span>
<a href="#l7.149"></a><span id="l7.149" class="difflineminus">-</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineminus">-// </span>
<a href="#l7.151"></a><span id="l7.151" class="difflineminus">-// to close shared memory segment</span>
<a href="#l7.152"></a><span id="l7.152" class="difflineminus">-// </span>
<a href="#l7.153"></a><span id="l7.153" class="difflineminus">-void</span>
<a href="#l7.154"></a><span id="l7.154" class="difflineminus">-NSCloseSharedMemory(CSharedMem *pData, HANDLE hSharedMemory)</span>
<a href="#l7.155"></a><span id="l7.155" class="difflineminus">-{</span>
<a href="#l7.156"></a><span id="l7.156" class="difflineminus">-#ifdef WIN32</span>
<a href="#l7.157"></a><span id="l7.157" class="difflineminus">-  if(pData != 0) </span>
<a href="#l7.158"></a><span id="l7.158" class="difflineminus">-  { </span>
<a href="#l7.159"></a><span id="l7.159" class="difflineminus">-    UnmapViewOfFile(pData); </span>
<a href="#l7.160"></a><span id="l7.160" class="difflineminus">-    pData = 0; </span>
<a href="#l7.161"></a><span id="l7.161" class="difflineminus">-  } </span>
<a href="#l7.162"></a><span id="l7.162" class="difflineminus">-</span>
<a href="#l7.163"></a><span id="l7.163" class="difflineminus">-  if(hSharedMemory != 0) </span>
<a href="#l7.164"></a><span id="l7.164" class="difflineminus">-  { </span>
<a href="#l7.165"></a><span id="l7.165" class="difflineminus">-    CloseHandle(hSharedMemory); </span>
<a href="#l7.166"></a><span id="l7.166" class="difflineminus">-    hSharedMemory = 0; </span>
<a href="#l7.167"></a><span id="l7.167" class="difflineminus">-  } </span>
<a href="#l7.168"></a><span id="l7.168" class="difflineminus">-#else</span>
<a href="#l7.169"></a><span id="l7.169" class="difflineminus">-</span>
<a href="#l7.170"></a><span id="l7.170" class="difflineminus">-	if (pData != NULL)</span>
<a href="#l7.171"></a><span id="l7.171" class="difflineminus">-	{</span>
<a href="#l7.172"></a><span id="l7.172" class="difflineminus">-		GlobalFreePtr(pData);</span>
<a href="#l7.173"></a><span id="l7.173" class="difflineminus">-		pData = NULL;</span>
<a href="#l7.174"></a><span id="l7.174" class="difflineminus">-	}</span>
<a href="#l7.175"></a><span id="l7.175" class="difflineminus">-</span>
<a href="#l7.176"></a><span id="l7.176" class="difflineminus">-#endif // WIN32</span>
<a href="#l7.177"></a><span id="l7.177" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">deleted file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- a/mailnews/mapi/old/lib/mapismem.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ /dev/null</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -1,116 +0,0 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineminus">- *</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">- *</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">- * License.</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">- *</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">- *</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">- *</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">- *</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">- *</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-#ifndef __SMEM_HPP__</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-#define __SMEM_HPP__</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-//</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-// Need this for Win16 since it is an undocumented message</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-//</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-#ifndef WIN32</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-#define WM_COPYDATA                     0x004A</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-/*</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">- * lParam of WM_COPYDATA message points to...</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">- */</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-typedef struct tagCOPYDATASTRUCT {</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-    DWORD         dwData;</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-    DWORD         cbData;</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineminus">-    LPVOID        lpData;</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineminus">-} COPYDATASTRUCT, *PCOPYDATASTRUCT;</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-# ifndef LPCTSTR</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-#   define LPCTSTR LPCSTR</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineminus">-# endif</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-#endif // ifndef WIN32</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-// The following structure will be stored in the shared memory </span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-// and will be used to pass data back and forth </span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-#pragma pack(4) </span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-typedef struct  </span>
<a href="#l8.73"></a><span id="l8.73" class="difflineminus">-{ </span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-  DWORD m_dwSize;       // size of the shared memory block </span>
<a href="#l8.75"></a><span id="l8.75" class="difflineminus">-  BYTE  m_buf[1];       // this is the buffer of memory to be used</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">-} CSharedMem; </span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineminus">-#pragma pack(4) </span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-// ******************************************************</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-// Public routines...</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineminus">-// ******************************************************</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-// </span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">-// </span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">-// *create new* shared memory chunk </span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">-// once this is created, use the pointer</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineminus">-// to the segment to to store data </span>
<a href="#l8.88"></a><span id="l8.88" class="difflineminus">-// e.g.: </span>
<a href="#l8.89"></a><span id="l8.89" class="difflineminus">-//     lpString = &quot;string for communicator&quot;; </span>
<a href="#l8.90"></a><span id="l8.90" class="difflineminus">-//     lstrcpy((LPSTR)pData-&gt;m_buf[0], lpString); </span>
<a href="#l8.91"></a><span id="l8.91" class="difflineminus">-//     pData-&gt;m_dwBytesUsed = lstrlen(lpString) + 1; // count '\0' </span>
<a href="#l8.92"></a><span id="l8.92" class="difflineminus">-//  </span>
<a href="#l8.93"></a><span id="l8.93" class="difflineminus">-CSharedMem *</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineminus">-NSCreateSharedMemory(DWORD memSize, LPCTSTR memName, HANDLE *hSharedMemory);</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineminus">-</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineminus">-// </span>
<a href="#l8.97"></a><span id="l8.97" class="difflineminus">-// *open existing* shared memory chunk </span>
<a href="#l8.98"></a><span id="l8.98" class="difflineminus">-// once you have the pointer to the new segment </span>
<a href="#l8.99"></a><span id="l8.99" class="difflineminus">-// use this pointer to access data, e.g.: </span>
<a href="#l8.100"></a><span id="l8.100" class="difflineminus">-//</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineminus">-// This will return the pointer to the memory chunk as well as</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineminus">-// fill out the hSharedMemory argument that is needed for subsequent</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineminus">-// operations.</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineminus">-// </span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-//  if(pData-&gt;m_dwBytesUsed &gt; 0) </span>
<a href="#l8.106"></a><span id="l8.106" class="difflineminus">-//  { </span>
<a href="#l8.107"></a><span id="l8.107" class="difflineminus">-//    // use pData-&gt;m_buf here </span>
<a href="#l8.108"></a><span id="l8.108" class="difflineminus">-//  } </span>
<a href="#l8.109"></a><span id="l8.109" class="difflineminus">-//</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineminus">-CSharedMem *</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineminus">-NSOpenExistingSharedMemory(LPCTSTR memName, HANDLE *hSharedMemory);</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineminus">-</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineminus">-//</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineminus">-// You must pass in the pointer to the memory chunk as well as</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineminus">-// the hSharedMemory HANDLE to close shared memory segment</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineminus">-// </span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-void</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineminus">-NSCloseSharedMemory(CSharedMem *pData, HANDLE hSharedMemory);</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineminus">-</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineminus">-#endif  // __SMEM_HPP__</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">deleted file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- a/mailnews/mapi/old/lib/nsstrseq.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ /dev/null</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -1,230 +0,0 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineminus">- *</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">- *</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">- * License.</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">- *</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">- *</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">- *</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">- *</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">- *</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-//</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-//  This is a string sequence handling routine to take complex</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineminus">-//  structures and merge them into a chunk of memory.</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineminus">-//</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineminus">-//  November 1997</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineminus">-//</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-#include &lt;stdlib.h&gt;</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-#include &lt;windowsx.h&gt;</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">-</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">-#include &quot;nsstrseq.h&quot;</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">-</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-#ifndef NULL</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-#define NULL '\0'</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineminus">-#endif</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineminus">-</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineminus">-#define MARKER '\377'</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineminus">-</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineminus">-//</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineminus">-// Delete an existing string sequence</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-//</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineminus">-void NSStrSeqDelete(NSstringSeq seq)</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineminus">-{</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">-  if (seq != NULL)</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineminus">-    free(seq);</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-  </span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-  seq = NULL;</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineminus">-}</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineminus">-</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineminus">-//</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineminus">-// Allocate a new sequence, copying the given strings into it. </span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-//</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineminus">-NSstringSeq NSStrSeqNew(LPSTR strings[])</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineminus">-{</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineminus">-  int size;</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineminus">-  if (!strings)</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineminus">-  {</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">-    return NULL;</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineminus">-  }</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineminus">-  </span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-  {</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">-    int i;</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-    for (i=0,size=0; strings[i]; i++)</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineminus">-    {</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineminus">-      size+=strlen(strings[i])+1;</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineminus">-      switch (strings[i][0])</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineminus">-      {</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineminus">-        // Need to pad &quot;&quot; or anything starting with 255 </span>
<a href="#l9.91"></a><span id="l9.91" class="difflineminus">-        // to allow for multiple blank strings in a row</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineminus">-      case 0:</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineminus">-      case MARKER:</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineminus">-        size++;</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineminus">-        break;</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineminus">-        </span>
<a href="#l9.97"></a><span id="l9.97" class="difflineminus">-      default:</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineminus">-        break;</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineminus">-      }</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineminus">-    }</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineminus">-  }</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineminus">-  </span>
<a href="#l9.103"></a><span id="l9.103" class="difflineminus">-  {</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineminus">-    NSstringSeq s=(NSstringSeq)malloc(size+1);</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineminus">-    if (!s)</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineminus">-    {	return NULL;}</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineminus">-    </span>
<a href="#l9.108"></a><span id="l9.108" class="difflineminus">-    {</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineminus">-      int i,offset;</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineminus">-      for (i=0,offset=0; strings[i]; i++)</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineminus">-      {</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineminus">-        switch (strings[i][0])</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineminus">-        {</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineminus">-          // Need to pad &quot;&quot; or anything starting with 255</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineminus">-        case 0:</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineminus">-        case MARKER:</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineminus">-          s[offset++]=MARKER;</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineminus">-          break;</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineminus">-          </span>
<a href="#l9.120"></a><span id="l9.120" class="difflineminus">-        default:</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineminus">-          break;</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineminus">-        }</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineminus">-        strcpy(s+offset,strings[i]);</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineminus">-        offset+=strlen(strings[i])+1;</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineminus">-      }</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineminus">-      s[offset]=0;</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineminus">-    }</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineminus">-    </span>
<a href="#l9.129"></a><span id="l9.129" class="difflineminus">-    return s;</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineminus">-  }</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineminus">-}</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineminus">-</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineminus">-//</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineminus">-// Get the # of bytes required for the sequence </span>
<a href="#l9.135"></a><span id="l9.135" class="difflineminus">-//</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineminus">-LONG NSStrSeqSize(NSstringSeq seq)</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineminus">-{</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineminus">-  const char* s;</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineminus">-  if (!seq)</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineminus">-    {</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineminus">-      return -1;</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineminus">-    }</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineminus">-</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineminus">-  for (s=seq+1; ((*s) || (*(s-1))); s++)</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineminus">-    ;</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineminus">-</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineminus">-  // At this point, s points to the second 0 </span>
<a href="#l9.148"></a><span id="l9.148" class="difflineminus">-  // of the double 0 at the end </span>
<a href="#l9.149"></a><span id="l9.149" class="difflineminus">-  return (s-seq)+1;</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineminus">-}</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineminus">-</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineminus">-//</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineminus">-// Get the # of strings in the sequence </span>
<a href="#l9.154"></a><span id="l9.154" class="difflineminus">-//</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineminus">-LONG NSStrSeqNumStrs(NSstringSeq seq)</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineminus">-{</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineminus">-  const char* s;</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineminus">-  int N;</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineminus">-  if (!seq)</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineminus">-  {</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineminus">-    return -1;</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineminus">-  }</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineminus">-  </span>
<a href="#l9.164"></a><span id="l9.164" class="difflineminus">-  for (s=seq+1,N=0; ((*s) || (*(s-1))); s++)</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineminus">-  {</span>
<a href="#l9.166"></a><span id="l9.166" class="difflineminus">-    if (!(*s))</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineminus">-      N++;</span>
<a href="#l9.168"></a><span id="l9.168" class="difflineminus">-  }</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineminus">-  </span>
<a href="#l9.170"></a><span id="l9.170" class="difflineminus">-  return N;</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineminus">-}</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineminus">-</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineminus">-static LPSTR correct(LPSTR s)</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineminus">-{</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineminus">-  if (s[0]==MARKER)</span>
<a href="#l9.176"></a><span id="l9.176" class="difflineminus">-    return s+1;</span>
<a href="#l9.177"></a><span id="l9.177" class="difflineminus">-  else  // Anup , 4/96</span>
<a href="#l9.178"></a><span id="l9.178" class="difflineminus">-    return s;</span>
<a href="#l9.179"></a><span id="l9.179" class="difflineminus">-}</span>
<a href="#l9.180"></a><span id="l9.180" class="difflineminus">-</span>
<a href="#l9.181"></a><span id="l9.181" class="difflineminus">-//</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineminus">-// Extract the index'th string in the sequence</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineminus">-//</span>
<a href="#l9.184"></a><span id="l9.184" class="difflineminus">-LPSTR NSStrSeqGet(NSstringSeq seq, LONG index)</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineminus">-{</span>
<a href="#l9.186"></a><span id="l9.186" class="difflineminus">-  char* s;</span>
<a href="#l9.187"></a><span id="l9.187" class="difflineminus">-  int N;</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineminus">-</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineminus">-  if (!seq)</span>
<a href="#l9.190"></a><span id="l9.190" class="difflineminus">-  {</span>
<a href="#l9.191"></a><span id="l9.191" class="difflineminus">-    return NULL;</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineminus">-  }</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineminus">-  </span>
<a href="#l9.194"></a><span id="l9.194" class="difflineminus">-  if (index&lt;0)</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineminus">-  {</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineminus">-    return NULL;</span>
<a href="#l9.197"></a><span id="l9.197" class="difflineminus">-  }</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineminus">-  </span>
<a href="#l9.199"></a><span id="l9.199" class="difflineminus">-  if (!index)</span>
<a href="#l9.200"></a><span id="l9.200" class="difflineminus">-    return correct(seq);</span>
<a href="#l9.201"></a><span id="l9.201" class="difflineminus">-  </span>
<a href="#l9.202"></a><span id="l9.202" class="difflineminus">-  for (s=seq+1,N=0; ((*s) || (*(s-1))) &amp;&amp; (N&lt;index); s++)</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineminus">-  {</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineminus">-    if (!(*s))</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineminus">-      N++;</span>
<a href="#l9.206"></a><span id="l9.206" class="difflineminus">-  }</span>
<a href="#l9.207"></a><span id="l9.207" class="difflineminus">-  </span>
<a href="#l9.208"></a><span id="l9.208" class="difflineminus">-  if (N==index)</span>
<a href="#l9.209"></a><span id="l9.209" class="difflineminus">-    return correct(s);</span>
<a href="#l9.210"></a><span id="l9.210" class="difflineminus">-  </span>
<a href="#l9.211"></a><span id="l9.211" class="difflineminus">-  return NULL;</span>
<a href="#l9.212"></a><span id="l9.212" class="difflineminus">-}</span>
<a href="#l9.213"></a><span id="l9.213" class="difflineminus">-</span>
<a href="#l9.214"></a><span id="l9.214" class="difflineminus">-LPSTR * NSStrSeqGetAll(NSstringSeq seq)</span>
<a href="#l9.215"></a><span id="l9.215" class="difflineminus">-{</span>
<a href="#l9.216"></a><span id="l9.216" class="difflineminus">-  LONG N=NSStrSeqNumStrs(seq);</span>
<a href="#l9.217"></a><span id="l9.217" class="difflineminus">-  if (N&lt;0)</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineminus">-    return NULL;</span>
<a href="#l9.219"></a><span id="l9.219" class="difflineminus">-  </span>
<a href="#l9.220"></a><span id="l9.220" class="difflineminus">-  {</span>
<a href="#l9.221"></a><span id="l9.221" class="difflineminus">-    char** res=(char**)malloc( (size_t) ((N+1)*sizeof(char*)) );</span>
<a href="#l9.222"></a><span id="l9.222" class="difflineminus">-    int i;</span>
<a href="#l9.223"></a><span id="l9.223" class="difflineminus">-    </span>
<a href="#l9.224"></a><span id="l9.224" class="difflineminus">-    if (!res)</span>
<a href="#l9.225"></a><span id="l9.225" class="difflineminus">-    {</span>
<a href="#l9.226"></a><span id="l9.226" class="difflineminus">-      return NULL;</span>
<a href="#l9.227"></a><span id="l9.227" class="difflineminus">-    }</span>
<a href="#l9.228"></a><span id="l9.228" class="difflineminus">-    for (i=0; i&lt;N; i++)</span>
<a href="#l9.229"></a><span id="l9.229" class="difflineminus">-      res[i]=NSStrSeqGet(seq,i);</span>
<a href="#l9.230"></a><span id="l9.230" class="difflineminus">-    res[N]=NULL;</span>
<a href="#l9.231"></a><span id="l9.231" class="difflineminus">-    </span>
<a href="#l9.232"></a><span id="l9.232" class="difflineminus">-    return res;</span>
<a href="#l9.233"></a><span id="l9.233" class="difflineminus">-  }</span>
<a href="#l9.234"></a><span id="l9.234" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">deleted file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- a/mailnews/mapi/old/lib/nsstrseq.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ /dev/null</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -1,68 +0,0 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineminus">- *</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">- *</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">- * License.</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">- *</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">- *</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">- *</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">- *</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">- *</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-#ifndef __SEQUENCES_OF_STRINGS_H_</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-#define __SEQUENCES_OF_STRINGS_H	</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-typedef LPSTR NSstringSeq;</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-extern &quot;C&quot;</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-{</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-#endif</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-void NSStrSeqDelete(NSstringSeq seq);</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-NSstringSeq NSStrSeqNew(LPSTR strings[]);</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-// Get the # of bytes required for the sequence </span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">-LONG NSStrSeqSize(NSstringSeq seq);</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-// Get the # of strings in the sequence</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-LONG NSStrSeqNumStrs(NSstringSeq seq);</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineminus">-</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">-// Extract the index'th string in the sequence</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineminus">-LPSTR NSStrSeqGet(NSstringSeq seq, LONG index);</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">-</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-// Build an array of all the strings in the sequence</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">-LPSTR *NSStrSeqGetAll(NSstringSeq seq);</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineminus">-</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineminus">-}</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-#endif</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineminus">-</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineminus">-</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineminus">-#endif // __sequences_of_strings_h_</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">deleted file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- a/mailnews/mapi/old/makefile.win</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ /dev/null</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -1,43 +0,0 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineminus">-#!nmake</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineminus">-#</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineminus">-#</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-#</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-# License.</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-#</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-#</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">-#</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-# Contributor(s):</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineminus">-#</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineminus">-#</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">-</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-DEPTH=..\..</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineminus">-</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-DIRS=public lib mapi32 tests hook</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineminus">-</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-include &lt;$(DEPTH)\config\rules.mak&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">deleted file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/maindll.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ /dev/null</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -1,100 +0,0 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineminus">- *</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">- *</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">- * License.</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">- *</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">- *</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">- *</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">- *</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">- *</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-//</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-//  DLLMain to get a handle on an hInstance </span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-//  November 1997</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-//  </span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-// global variables</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-//</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-HINSTANCE hInstance;</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-//</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-// DLL entry</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-//  </span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-#ifdef WIN32</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineminus">-/****************************************************************************</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">-   FUNCTION: DllMain(HANDLE, DWORD, LPVOID)</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineminus">-</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-   PURPOSE:  DllMain is called by Windows when</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineminus">-             the DLL is initialized, Thread Attached, and other times.</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineminus">-             Refer to SDK documentation, as to the different ways this</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineminus">-             may be called.</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineminus">-             </span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-             The DllMain function should perform additional initialization</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-             tasks required by the DLL.  In this example, no initialization</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-             tasks are required.  DllMain should return a value of 1 if</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-             the initialization is successful.</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-           </span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-*******************************************************************************/</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-BOOL APIENTRY DllMain(HANDLE hInstLocal, DWORD ul_reason_being_called, LPVOID lpReserved) </span>
<a href="#l12.71"></a><span id="l12.71" class="difflineminus">-{</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-  hInstance = (HINSTANCE)hInstLocal;</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-  if (hInstance != NULL) </span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-	  return 1;</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-  else  </span>
<a href="#l12.77"></a><span id="l12.77" class="difflineminus">-	  return 0;</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-}</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-#else  // WIN16</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-//--------------------------------------------------------------------</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-// LibMain( hInstance, wDataSegment, wHeapSize, lpszCmdLine ) : WORD</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineminus">-//</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-//    hInstance      library instance handle</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-//    wDataSegment   library data segment</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-//    wHeapSize      default heap size</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineminus">-//    lpszCmdLine    command line arguments</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineminus">-//</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-//--------------------------------------------------------------------</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-int CALLBACK LibMain(HINSTANCE hInstLocal, WORD wDataSegment, WORD wHeapSize, LPSTR lpszCmdLine) </span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-{</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineminus">-  hInstance = hInstLocal;</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineminus">-  /* return result 1 = success; 0 = fail */</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineminus">-  if (hInstance != NULL) </span>
<a href="#l12.98"></a><span id="l12.98" class="difflineminus">-	  return 1;</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-  else</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineminus">-	  return 0;</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineminus">-}</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-#endif // WIN16</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">deleted file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/makefile.win</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ /dev/null</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -1,86 +0,0 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineminus">-#</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-#</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-# License.</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-#</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-#</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-#</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">-# Contributor(s):</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">-#</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-#</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-DEPTH=..\..\..</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-MODULE=mapi32</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-################################################################################</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-## exports</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-#EXPORTS =</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-################################################################################</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-## library</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineminus">-LIBNAME = .\$(OBJDIR)\mapi32</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-DEFINES= -NS_DEBUG</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineminus">-DEFFILE=MAPI32.def</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineminus">-</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-!ifdef MOZ_STATIC_COMPONENT_LIBS</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineminus">-LIB = $(LIBNAME).lib</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineminus">-!else</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-DLL = $(LIBNAME).dll</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-!endif</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineminus">-OBJS=										\</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineminus">-    .\$(OBJDIR)\maindll.obj  \</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineminus">-    .\$(OBJDIR)\mapi32.obj  \</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-    .\$(OBJDIR)\mapiipc.obj  \</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-    .\$(OBJDIR)\mapimem.obj  \</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-    .\$(OBJDIR)\mapiutl.obj  \</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-    .\$(OBJDIR)\smem.obj  \</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineminus">-    .\$(OBJDIR)\trace.obj  \</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineminus">-    .\$(OBJDIR)\xpapi.obj  \</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineminus">-		$(NULL)</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineminus">-</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineminus">-LLIBS=										\</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineminus">-			$(LLIBS)						\</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineminus">-			$(LIBNSPR)						\</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineminus">-			$(DIST)\lib\xppref32.lib		\</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineminus">-			$(DIST)\lib\xpcom.lib       	\</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineminus">-			$(DIST)\lib\mapiutils_s.lib  \</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineminus">-			$(NULL)</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineminus">-</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineminus">-include &lt;$(DEPTH)\config\rules.mak&gt;</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineminus">-</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineminus">-!ifdef MOZ_STATIC_COMPONENT_LIBS</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineminus">-libs:: $(LIB)</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineminus">-	$(MAKE_INSTALL)  $(LIBNAME).$(LIB_SUFFIX) $(DIST)\bin\components</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineminus">-!else</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-libs:: $(DLL)</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-	$(MAKE_INSTALL)  $(LIBNAME).$(DLL_SUFFIX) $(DIST)\bin\components</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-!endif</span>
<a href="#l13.91"></a><span id="l13.91">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">deleted file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/mapi32.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ /dev/null</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -1,2291 +0,0 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineminus">- *</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">- *</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">- * License.</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">- *</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">- *</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">- *</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">- *</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">- *</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-//</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-//  Simple MAPI API</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-//  November 1997</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-//</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-#include &lt;windows.h&gt;  </span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-#include &lt;string.h&gt; </span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-#include &quot;xpapi.h&quot;</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-#include &quot;trace.h&quot;</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-#include &quot;mapiipc.h&quot;</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-#include &quot;mapiutl.h&quot;</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-#include &quot;nsstrseq.h&quot;</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-#include &quot;mapismem.h&quot;</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-#include &quot;mapimem.h&quot;</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-#include &quot;nscpmapi.h&quot;</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">-#ifndef MAPI_OLE	// Because MSFT doesn't do this for us :-(</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineminus">-#include &quot;mapi.h&quot;</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">-#endif</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineminus">-//</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineminus">-// Necessary variables...</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineminus">-//</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">-memTrackerType    memArray[MAX_POINTERS];</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineminus">-</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineminus">-//</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-// For remembering memory...how ironic.</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineminus">-//</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineminus">-void</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineminus">-SetPointerArray(LPVOID ptr, BYTE type)</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineminus">-{</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineminus">-int i;</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineminus">-  </span>
<a href="#l14.76"></a><span id="l14.76" class="difflineminus">-  for (i=0; i&lt;MAX_POINTERS; i++)</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineminus">-  {</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineminus">-    if (memArray[i].lpMem == NULL)</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineminus">-    {</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-      memArray[i].lpMem = ptr;</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-      memArray[i].memType = type;</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineminus">-      break;</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineminus">-    }</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-  }</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-}</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineminus">-</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-//</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-// To have MAPI work in MS-Word on Win95, you must have </span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-// this in win.ini:</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-//</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineminus">-// [Mail]</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineminus">-// MAPIX=1</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineminus">-//</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineminus">-// To turn logging of errors on, set:</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineminus">-// HKEY_LOCAL_MACHINE\Software\Netscape\Netscape Navigator\MAPI\Logging = 1</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineminus">-</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-// </span>
<a href="#l14.98"></a><span id="l14.98" class="difflineminus">-// The MAPILogon function begins a Simple MAPI session, loading </span>
<a href="#l14.99"></a><span id="l14.99" class="difflineminus">-// the default message store and address book providers. </span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-//</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-MAPILogon(</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-    ULONG ulUIParam,</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-    LPSTR lpszProfileName,</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-    LPSTR lpszPassword,</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-    FLAGS flFlags,</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-    ULONG ulReserved,</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-    LPLHANDLE lplhSession)</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineminus">-{</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineminus">-LRESULT       result;</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-HWND          hWndIPC;</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineminus">-MAPIIPCType   ipcInfo;</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineminus">-static BOOL   firstTime = TRUE;</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineminus">-</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineminus">-	TRACE_FN(&quot;MAPILogon&quot;);</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineminus">-	TRACE(&quot;  lpszProfileName=%s, lpszPassword=%s\n&quot;, lpszProfileName, lpszPassword);  </span>
<a href="#l14.117"></a><span id="l14.117" class="difflineminus">-#ifndef WIN16</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineminus">-	TRACE(&quot;  threadID = %ld\n&quot;, GetCurrentThreadId()); </span>
<a href="#l14.119"></a><span id="l14.119" class="difflineminus">-#endif</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineminus">-</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineminus">-  // Init before we start...</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineminus">-  *lplhSession = 0;</span>
<a href="#l14.123"></a><span id="l14.123" class="difflineminus">-</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineminus">-  TRACE(&quot;MAPILogon: SET RETURN SESSION TO NULL\n&quot;); </span>
<a href="#l14.125"></a><span id="l14.125" class="difflineminus">-</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineminus">-  //</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineminus">-  // Check if diags should be turned on or off...</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineminus">-  //</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineminus">-  DWORD val = 0;</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineminus">-  if (GetConfigInfoNum(szMapiSection, &quot;Logging&quot;, &amp;val, HKEY_LOCAL_MACHINE))</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineminus">-  {</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineminus">-		SetLoggingEnabled((BOOL)val);</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineminus">-  }</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineminus">-  </span>
<a href="#l14.135"></a><span id="l14.135" class="difflineminus">-  //</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineminus">-  // Init the stuff we will need for WM_COPYDATA calls and anything else</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineminus">-  //</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineminus">-  if (!nsMAPI_OpenAPI())</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineminus">-  {</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineminus">-    TRACE(&quot;MAPILogon: Can't open API\n&quot;); </span>
<a href="#l14.141"></a><span id="l14.141" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineminus">-  }</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineminus">-</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineminus">-  //</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineminus">-  // This call locates a Communicator Window, if one is not running,</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineminus">-  // it will start up an instance of Communicator and grab that window.</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineminus">-  //</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineminus">-  hWndIPC = GetCommunicatorIPCWindow();</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineminus">-  if (NULL == hWndIPC)</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineminus">-  {</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineminus">-    TRACE(&quot;MAPILogon: Can't get Window\n&quot;); </span>
<a href="#l14.152"></a><span id="l14.152" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.153"></a><span id="l14.153" class="difflineminus">-  }</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineminus">-</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineminus">-  //</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineminus">-  // Reset the pointer arrary for future use.</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineminus">-  //</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineminus">-  if (firstTime)</span>
<a href="#l14.159"></a><span id="l14.159" class="difflineminus">-  {</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineminus">-    TRACE(&quot;MAPILogon: Reset Pointer\n&quot;); </span>
<a href="#l14.161"></a><span id="l14.161" class="difflineminus">-    memset(memArray, 0, sizeof(memTrackerType) * MAX_POINTERS);</span>
<a href="#l14.162"></a><span id="l14.162" class="difflineminus">-    firstTime = FALSE;</span>
<a href="#l14.163"></a><span id="l14.163" class="difflineminus">-  }</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineminus">-</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineminus">-  // </span>
<a href="#l14.166"></a><span id="l14.166" class="difflineminus">-  // Build the IPC structure of information that needs to be provided</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineminus">-  // to get information into Communicator</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineminus">-  //</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineminus">-  BuildMemName((LPSTR)ipcInfo.smemName, ulUIParam);</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineminus">-</span>
<a href="#l14.171"></a><span id="l14.171" class="difflineminus">-  //</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineminus">-  // Build the shared memory segment of information to pass into </span>
<a href="#l14.173"></a><span id="l14.173" class="difflineminus">-  // Communicator for the login call.</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineminus">-  //</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineminus">-  LPSTR       strings[3];</span>
<a href="#l14.176"></a><span id="l14.176" class="difflineminus">-  NSstringSeq strSeq;</span>
<a href="#l14.177"></a><span id="l14.177" class="difflineminus">-  CSharedMem  *sMem;</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineminus">-  DWORD       memSize;</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineminus">-  LONG        strSize;</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineminus">-  HANDLE      hSharedMemory;</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineminus">-  MAPILogonType   logonInfo;</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineminus">-</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineminus">-  strings[0] = CheckNullString(lpszProfileName);</span>
<a href="#l14.184"></a><span id="l14.184" class="difflineminus">-  strings[1] = CheckNullString(lpszPassword);</span>
<a href="#l14.185"></a><span id="l14.185" class="difflineminus">-  strings[2] = NULL;</span>
<a href="#l14.186"></a><span id="l14.186" class="difflineminus">-  strSeq     = NSStrSeqNew(strings);</span>
<a href="#l14.187"></a><span id="l14.187" class="difflineminus">-  strSize    = NSStrSeqSize(strSeq);</span>
<a href="#l14.188"></a><span id="l14.188" class="difflineminus">-  memSize = sizeof(MAPILogonType) + strSize;</span>
<a href="#l14.189"></a><span id="l14.189" class="difflineminus">-</span>
<a href="#l14.190"></a><span id="l14.190" class="difflineminus">-  //</span>
<a href="#l14.191"></a><span id="l14.191" class="difflineminus">-  // Create the shared memory...</span>
<a href="#l14.192"></a><span id="l14.192" class="difflineminus">-  //</span>
<a href="#l14.193"></a><span id="l14.193" class="difflineminus">-  sMem = NSCreateSharedMemory(memSize, (LPSTR) ipcInfo.smemName, &amp;hSharedMemory);</span>
<a href="#l14.194"></a><span id="l14.194" class="difflineminus">-  if (!sMem)</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineminus">-  {</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineminus">-      TRACE(&quot;MAPILogon: SMEM Failure\n&quot;); </span>
<a href="#l14.197"></a><span id="l14.197" class="difflineminus">-      NSStrSeqDelete(strSeq);</span>
<a href="#l14.198"></a><span id="l14.198" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.199"></a><span id="l14.199" class="difflineminus">-  }</span>
<a href="#l14.200"></a><span id="l14.200" class="difflineminus">-</span>
<a href="#l14.201"></a><span id="l14.201" class="difflineminus">-  //</span>
<a href="#l14.202"></a><span id="l14.202" class="difflineminus">-  // Now populate a Logon structure with the passed in information</span>
<a href="#l14.203"></a><span id="l14.203" class="difflineminus">-  //</span>
<a href="#l14.204"></a><span id="l14.204" class="difflineminus">-  logonInfo.ulUIParam = ulUIParam;</span>
<a href="#l14.205"></a><span id="l14.205" class="difflineminus">-  logonInfo.flFlags = flFlags;</span>
<a href="#l14.206"></a><span id="l14.206" class="difflineminus">-  logonInfo.lhSession = 0;</span>
<a href="#l14.207"></a><span id="l14.207" class="difflineminus">-  logonInfo.ipcWorked = 0;</span>
<a href="#l14.208"></a><span id="l14.208" class="difflineminus">-</span>
<a href="#l14.209"></a><span id="l14.209" class="difflineminus">-  //</span>
<a href="#l14.210"></a><span id="l14.210" class="difflineminus">-  // Now copy the information into the memory segment.</span>
<a href="#l14.211"></a><span id="l14.211" class="difflineminus">-  //</span>
<a href="#l14.212"></a><span id="l14.212" class="difflineminus">-  sMem-&gt;m_dwSize = memSize;</span>
<a href="#l14.213"></a><span id="l14.213" class="difflineminus">-  memcpy(sMem-&gt;m_buf, &amp;(logonInfo), sizeof(MAPILogonType));</span>
<a href="#l14.214"></a><span id="l14.214" class="difflineminus">-  memcpy(sMem-&gt;m_buf + sizeof(MAPILogonType), strSeq, (size_t) strSize);</span>
<a href="#l14.215"></a><span id="l14.215" class="difflineminus">-</span>
<a href="#l14.216"></a><span id="l14.216" class="difflineminus">-  //</span>
<a href="#l14.217"></a><span id="l14.217" class="difflineminus">-  // Now set the size of the shared memory segment for the </span>
<a href="#l14.218"></a><span id="l14.218" class="difflineminus">-  // WM_COPYDATA argument that will be sent across.</span>
<a href="#l14.219"></a><span id="l14.219" class="difflineminus">-  //</span>
<a href="#l14.220"></a><span id="l14.220" class="difflineminus">-  ipcInfo.smemSize = memSize;</span>
<a href="#l14.221"></a><span id="l14.221" class="difflineminus">-</span>
<a href="#l14.222"></a><span id="l14.222" class="difflineminus">-  // For Win16, we actually pass in the pointer to the structure,</span>
<a href="#l14.223"></a><span id="l14.223" class="difflineminus">-  // so just assign the variable here.</span>
<a href="#l14.224"></a><span id="l14.224" class="difflineminus">-#ifdef WIN16</span>
<a href="#l14.225"></a><span id="l14.225" class="difflineminus">-  ipcInfo.lpsmem = sMem;</span>
<a href="#l14.226"></a><span id="l14.226" class="difflineminus">-#else</span>
<a href="#l14.227"></a><span id="l14.227" class="difflineminus">-  ipcInfo.lpsmem = NULL;</span>
<a href="#l14.228"></a><span id="l14.228" class="difflineminus">-#endif</span>
<a href="#l14.229"></a><span id="l14.229" class="difflineminus">-</span>
<a href="#l14.230"></a><span id="l14.230" class="difflineminus">-  //</span>
<a href="#l14.231"></a><span id="l14.231" class="difflineminus">-  // Ok, time to do the SendMessage() to Communicator...</span>
<a href="#l14.232"></a><span id="l14.232" class="difflineminus">-  //</span>
<a href="#l14.233"></a><span id="l14.233" class="difflineminus">-  result = SendMAPIRequest(hWndIPC, NSCP_MAPILogon, &amp;ipcInfo);</span>
<a href="#l14.234"></a><span id="l14.234" class="difflineminus">-</span>
<a href="#l14.235"></a><span id="l14.235" class="difflineminus">-  // Check for IPC completion</span>
<a href="#l14.236"></a><span id="l14.236" class="difflineminus">-  MAPILogonType *logInfo = (MAPILogonType *) &amp;(sMem-&gt;m_buf[0]);  </span>
<a href="#l14.237"></a><span id="l14.237" class="difflineminus">-  if (!logInfo-&gt;ipcWorked)</span>
<a href="#l14.238"></a><span id="l14.238" class="difflineminus">-  {</span>
<a href="#l14.239"></a><span id="l14.239" class="difflineminus">-    result = MAPI_E_FAILURE;</span>
<a href="#l14.240"></a><span id="l14.240" class="difflineminus">-  }</span>
<a href="#l14.241"></a><span id="l14.241" class="difflineminus">-</span>
<a href="#l14.242"></a><span id="l14.242" class="difflineminus">-  // </span>
<a href="#l14.243"></a><span id="l14.243" class="difflineminus">-  // If successfull, then we need to get the information</span>
<a href="#l14.244"></a><span id="l14.244" class="difflineminus">-  if (result == SUCCESS_SUCCESS)</span>
<a href="#l14.245"></a><span id="l14.245" class="difflineminus">-  {</span>
<a href="#l14.246"></a><span id="l14.246" class="difflineminus">-    *lplhSession = logInfo-&gt;lhSession;</span>
<a href="#l14.247"></a><span id="l14.247" class="difflineminus">-  }</span>
<a href="#l14.248"></a><span id="l14.248" class="difflineminus">-</span>
<a href="#l14.249"></a><span id="l14.249" class="difflineminus">-  //</span>
<a href="#l14.250"></a><span id="l14.250" class="difflineminus">-  // Now time to do some cleanup...</span>
<a href="#l14.251"></a><span id="l14.251" class="difflineminus">-  //</span>
<a href="#l14.252"></a><span id="l14.252" class="difflineminus">-  NSStrSeqDelete(strSeq);</span>
<a href="#l14.253"></a><span id="l14.253" class="difflineminus">-  NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.254"></a><span id="l14.254" class="difflineminus">-</span>
<a href="#l14.255"></a><span id="l14.255" class="difflineminus">-  CleanupMAPITempFiles();</span>
<a href="#l14.256"></a><span id="l14.256" class="difflineminus">-	TRACE(&quot;  Returning lhSession=%lu\n&quot;, *lplhSession);</span>
<a href="#l14.257"></a><span id="l14.257" class="difflineminus">-	LogString(&quot;--MAPILogon complete\r\n&quot;);</span>
<a href="#l14.258"></a><span id="l14.258" class="difflineminus">-</span>
<a href="#l14.259"></a><span id="l14.259" class="difflineminus">-	return(result);</span>
<a href="#l14.260"></a><span id="l14.260" class="difflineminus">-}</span>
<a href="#l14.261"></a><span id="l14.261" class="difflineminus">-</span>
<a href="#l14.262"></a><span id="l14.262" class="difflineminus">-//</span>
<a href="#l14.263"></a><span id="l14.263" class="difflineminus">-// The MAPILogoff function ends a session with the messaging system. </span>
<a href="#l14.264"></a><span id="l14.264" class="difflineminus">-//</span>
<a href="#l14.265"></a><span id="l14.265" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.266"></a><span id="l14.266" class="difflineminus">-MAPILogoff(</span>
<a href="#l14.267"></a><span id="l14.267" class="difflineminus">-    LHANDLE lhSession,</span>
<a href="#l14.268"></a><span id="l14.268" class="difflineminus">-    ULONG ulUIParam,</span>
<a href="#l14.269"></a><span id="l14.269" class="difflineminus">-    FLAGS flFlags,</span>
<a href="#l14.270"></a><span id="l14.270" class="difflineminus">-    ULONG ulReserved)</span>
<a href="#l14.271"></a><span id="l14.271" class="difflineminus">-{</span>
<a href="#l14.272"></a><span id="l14.272" class="difflineminus">-LRESULT       result;</span>
<a href="#l14.273"></a><span id="l14.273" class="difflineminus">-HWND          hWndIPC;</span>
<a href="#l14.274"></a><span id="l14.274" class="difflineminus">-MAPIIPCType   ipcInfo;</span>
<a href="#l14.275"></a><span id="l14.275" class="difflineminus">-</span>
<a href="#l14.276"></a><span id="l14.276" class="difflineminus">-	TRACE_FN(&quot;MAPILogoff&quot;);</span>
<a href="#l14.277"></a><span id="l14.277" class="difflineminus">-	TRACE(&quot;lhSession Session ID = %lu\n&quot;, lhSession);</span>
<a href="#l14.278"></a><span id="l14.278" class="difflineminus">-	LogString(&quot;--MAPILogoff\r\n&quot;);</span>
<a href="#l14.279"></a><span id="l14.279" class="difflineminus">-</span>
<a href="#l14.280"></a><span id="l14.280" class="difflineminus">-  //</span>
<a href="#l14.281"></a><span id="l14.281" class="difflineminus">-  // This call locates a Communicator Window, if one is not running,</span>
<a href="#l14.282"></a><span id="l14.282" class="difflineminus">-  // it will start up an instance of Communicator and grab that window.</span>
<a href="#l14.283"></a><span id="l14.283" class="difflineminus">-  //</span>
<a href="#l14.284"></a><span id="l14.284" class="difflineminus">-  hWndIPC = GetCommunicatorIPCWindow();</span>
<a href="#l14.285"></a><span id="l14.285" class="difflineminus">-  if (NULL == hWndIPC)</span>
<a href="#l14.286"></a><span id="l14.286" class="difflineminus">-  {</span>
<a href="#l14.287"></a><span id="l14.287" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.288"></a><span id="l14.288" class="difflineminus">-  }</span>
<a href="#l14.289"></a><span id="l14.289" class="difflineminus">-</span>
<a href="#l14.290"></a><span id="l14.290" class="difflineminus">-  // </span>
<a href="#l14.291"></a><span id="l14.291" class="difflineminus">-  // Build the IPC structure of information that needs to be provided</span>
<a href="#l14.292"></a><span id="l14.292" class="difflineminus">-  // to get information into Communicator</span>
<a href="#l14.293"></a><span id="l14.293" class="difflineminus">-  //</span>
<a href="#l14.294"></a><span id="l14.294" class="difflineminus">-  BuildMemName((LPSTR)ipcInfo.smemName, ulUIParam);</span>
<a href="#l14.295"></a><span id="l14.295" class="difflineminus">-</span>
<a href="#l14.296"></a><span id="l14.296" class="difflineminus">-  //</span>
<a href="#l14.297"></a><span id="l14.297" class="difflineminus">-  // Build the shared memory segment of information to pass into </span>
<a href="#l14.298"></a><span id="l14.298" class="difflineminus">-  // Communicator for the login call.</span>
<a href="#l14.299"></a><span id="l14.299" class="difflineminus">-  //</span>
<a href="#l14.300"></a><span id="l14.300" class="difflineminus">-  CSharedMem      *sMem;</span>
<a href="#l14.301"></a><span id="l14.301" class="difflineminus">-  DWORD           memSize;</span>
<a href="#l14.302"></a><span id="l14.302" class="difflineminus">-  HANDLE          hSharedMemory;</span>
<a href="#l14.303"></a><span id="l14.303" class="difflineminus">-  MAPILogoffType  logoffInfo;</span>
<a href="#l14.304"></a><span id="l14.304" class="difflineminus">-   </span>
<a href="#l14.305"></a><span id="l14.305" class="difflineminus">-  memSize = sizeof(MAPILogoffType);</span>
<a href="#l14.306"></a><span id="l14.306" class="difflineminus">-</span>
<a href="#l14.307"></a><span id="l14.307" class="difflineminus">-  //</span>
<a href="#l14.308"></a><span id="l14.308" class="difflineminus">-  // Create the shared memory...</span>
<a href="#l14.309"></a><span id="l14.309" class="difflineminus">-  //</span>
<a href="#l14.310"></a><span id="l14.310" class="difflineminus">-  sMem = NSCreateSharedMemory(memSize, (LPSTR) ipcInfo.smemName, &amp;hSharedMemory);</span>
<a href="#l14.311"></a><span id="l14.311" class="difflineminus">-  if (!sMem)</span>
<a href="#l14.312"></a><span id="l14.312" class="difflineminus">-  {</span>
<a href="#l14.313"></a><span id="l14.313" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.314"></a><span id="l14.314" class="difflineminus">-  }</span>
<a href="#l14.315"></a><span id="l14.315" class="difflineminus">-</span>
<a href="#l14.316"></a><span id="l14.316" class="difflineminus">-  //</span>
<a href="#l14.317"></a><span id="l14.317" class="difflineminus">-  // Now populate a Logon structure with the passed in information</span>
<a href="#l14.318"></a><span id="l14.318" class="difflineminus">-  //</span>
<a href="#l14.319"></a><span id="l14.319" class="difflineminus">-  logoffInfo.lhSession  = lhSession;</span>
<a href="#l14.320"></a><span id="l14.320" class="difflineminus">-  logoffInfo.ulUIParam  = ulUIParam;</span>
<a href="#l14.321"></a><span id="l14.321" class="difflineminus">-  logoffInfo.flFlags    = flFlags;</span>
<a href="#l14.322"></a><span id="l14.322" class="difflineminus">-  logoffInfo.ipcWorked  = 0;</span>
<a href="#l14.323"></a><span id="l14.323" class="difflineminus">-</span>
<a href="#l14.324"></a><span id="l14.324" class="difflineminus">-  //</span>
<a href="#l14.325"></a><span id="l14.325" class="difflineminus">-  // Now copy the information into the memory segment.</span>
<a href="#l14.326"></a><span id="l14.326" class="difflineminus">-  //</span>
<a href="#l14.327"></a><span id="l14.327" class="difflineminus">-  sMem-&gt;m_dwSize = memSize;</span>
<a href="#l14.328"></a><span id="l14.328" class="difflineminus">-  memcpy(sMem-&gt;m_buf, &amp;(logoffInfo), sizeof(MAPILogoffType));</span>
<a href="#l14.329"></a><span id="l14.329" class="difflineminus">-</span>
<a href="#l14.330"></a><span id="l14.330" class="difflineminus">-  //</span>
<a href="#l14.331"></a><span id="l14.331" class="difflineminus">-  // Now set the size of the shared memory segment for the </span>
<a href="#l14.332"></a><span id="l14.332" class="difflineminus">-  // WM_COPYDATA argument that will be sent across.</span>
<a href="#l14.333"></a><span id="l14.333" class="difflineminus">-  //</span>
<a href="#l14.334"></a><span id="l14.334" class="difflineminus">-  ipcInfo.smemSize = memSize;</span>
<a href="#l14.335"></a><span id="l14.335" class="difflineminus">-</span>
<a href="#l14.336"></a><span id="l14.336" class="difflineminus">-  // For Win16, we actually pass in the pointer to the structure,</span>
<a href="#l14.337"></a><span id="l14.337" class="difflineminus">-  // so just assign the variable here.</span>
<a href="#l14.338"></a><span id="l14.338" class="difflineminus">-#ifdef WIN16</span>
<a href="#l14.339"></a><span id="l14.339" class="difflineminus">-  ipcInfo.lpsmem = sMem;</span>
<a href="#l14.340"></a><span id="l14.340" class="difflineminus">-#else</span>
<a href="#l14.341"></a><span id="l14.341" class="difflineminus">-  ipcInfo.lpsmem = NULL;</span>
<a href="#l14.342"></a><span id="l14.342" class="difflineminus">-#endif</span>
<a href="#l14.343"></a><span id="l14.343" class="difflineminus">-</span>
<a href="#l14.344"></a><span id="l14.344" class="difflineminus">-  //</span>
<a href="#l14.345"></a><span id="l14.345" class="difflineminus">-  // Ok, time to do the SendMessage() to Communicator...</span>
<a href="#l14.346"></a><span id="l14.346" class="difflineminus">-  //</span>
<a href="#l14.347"></a><span id="l14.347" class="difflineminus">-  result = SendMAPIRequest(hWndIPC, NSCP_MAPILogoff, &amp;ipcInfo);</span>
<a href="#l14.348"></a><span id="l14.348" class="difflineminus">-</span>
<a href="#l14.349"></a><span id="l14.349" class="difflineminus">-  // Check for IPC completion</span>
<a href="#l14.350"></a><span id="l14.350" class="difflineminus">-  MAPILogoffType *logInfo = (MAPILogoffType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.351"></a><span id="l14.351" class="difflineminus">-  if (!logInfo-&gt;ipcWorked)</span>
<a href="#l14.352"></a><span id="l14.352" class="difflineminus">-  {</span>
<a href="#l14.353"></a><span id="l14.353" class="difflineminus">-      result = MAPI_E_FAILURE;</span>
<a href="#l14.354"></a><span id="l14.354" class="difflineminus">-  }</span>
<a href="#l14.355"></a><span id="l14.355" class="difflineminus">-</span>
<a href="#l14.356"></a><span id="l14.356" class="difflineminus">-  //</span>
<a href="#l14.357"></a><span id="l14.357" class="difflineminus">-  // Now do cleanup on the way out...</span>
<a href="#l14.358"></a><span id="l14.358" class="difflineminus">-  //</span>
<a href="#l14.359"></a><span id="l14.359" class="difflineminus">-  NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.360"></a><span id="l14.360" class="difflineminus">-</span>
<a href="#l14.361"></a><span id="l14.361" class="difflineminus">-  //</span>
<a href="#l14.362"></a><span id="l14.362" class="difflineminus">-  // Close the stuff for WM_COPYDATA calls and anything else</span>
<a href="#l14.363"></a><span id="l14.363" class="difflineminus">-  //</span>
<a href="#l14.364"></a><span id="l14.364" class="difflineminus">-  nsMAPI_CloseAPI();</span>
<a href="#l14.365"></a><span id="l14.365" class="difflineminus">-</span>
<a href="#l14.366"></a><span id="l14.366" class="difflineminus">-	LogString(&quot;--MAPILogoff complete\r\n&quot;);</span>
<a href="#l14.367"></a><span id="l14.367" class="difflineminus">-</span>
<a href="#l14.368"></a><span id="l14.368" class="difflineminus">-  CleanupMAPITempFiles();</span>
<a href="#l14.369"></a><span id="l14.369" class="difflineminus">-</span>
<a href="#l14.370"></a><span id="l14.370" class="difflineminus">-  // Now just return!</span>
<a href="#l14.371"></a><span id="l14.371" class="difflineminus">-  return(result);</span>
<a href="#l14.372"></a><span id="l14.372" class="difflineminus">-}</span>
<a href="#l14.373"></a><span id="l14.373" class="difflineminus">-</span>
<a href="#l14.374"></a><span id="l14.374" class="difflineminus">-//</span>
<a href="#l14.375"></a><span id="l14.375" class="difflineminus">-// The MAPIFreeBuffer function frees a memory buffer allocated with a call to </span>
<a href="#l14.376"></a><span id="l14.376" class="difflineminus">-// the MAPIAllocateBuffer function or the MAPIAllocateMore function. </span>
<a href="#l14.377"></a><span id="l14.377" class="difflineminus">-//</span>
<a href="#l14.378"></a><span id="l14.378" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.379"></a><span id="l14.379" class="difflineminus">-MAPIFreeBuffer(LPVOID pv)</span>
<a href="#l14.380"></a><span id="l14.380" class="difflineminus">-{</span>
<a href="#l14.381"></a><span id="l14.381" class="difflineminus">-int   i;</span>
<a href="#l14.382"></a><span id="l14.382" class="difflineminus">-</span>
<a href="#l14.383"></a><span id="l14.383" class="difflineminus">-  TRACE_FN(&quot;MAPIFreeBuffer&quot;);</span>
<a href="#l14.384"></a><span id="l14.384" class="difflineminus">-</span>
<a href="#l14.385"></a><span id="l14.385" class="difflineminus">-  if (!pv)</span>
<a href="#l14.386"></a><span id="l14.386" class="difflineminus">-#ifdef WIN16     </span>
<a href="#l14.387"></a><span id="l14.387" class="difflineminus">-  	return(SUCCESS_SUCCESS);</span>
<a href="#l14.388"></a><span id="l14.388" class="difflineminus">-#else</span>
<a href="#l14.389"></a><span id="l14.389" class="difflineminus">-  	return(S_OK);</span>
<a href="#l14.390"></a><span id="l14.390" class="difflineminus">-#endif</span>
<a href="#l14.391"></a><span id="l14.391" class="difflineminus">-</span>
<a href="#l14.392"></a><span id="l14.392" class="difflineminus">-  for (i=0; i&lt;MAX_POINTERS; i++)</span>
<a href="#l14.393"></a><span id="l14.393" class="difflineminus">-  {</span>
<a href="#l14.394"></a><span id="l14.394" class="difflineminus">-    if (pv == memArray[i].lpMem)</span>
<a href="#l14.395"></a><span id="l14.395" class="difflineminus">-    {</span>
<a href="#l14.396"></a><span id="l14.396" class="difflineminus">-      if (memArray[i].memType == MAPI_MESSAGE_TYPE)</span>
<a href="#l14.397"></a><span id="l14.397" class="difflineminus">-      {</span>
<a href="#l14.398"></a><span id="l14.398" class="difflineminus">-        FreeMAPIMessage((MapiMessage *)pv);</span>
<a href="#l14.399"></a><span id="l14.399" class="difflineminus">-        memArray[i].lpMem = NULL;</span>
<a href="#l14.400"></a><span id="l14.400" class="difflineminus">-      }</span>
<a href="#l14.401"></a><span id="l14.401" class="difflineminus">-      else if (memArray[i].memType == MAPI_RECIPIENT_TYPE)</span>
<a href="#l14.402"></a><span id="l14.402" class="difflineminus">-      {</span>
<a href="#l14.403"></a><span id="l14.403" class="difflineminus">-        FreeMAPIRecipient((MapiRecipDesc *)pv);</span>
<a href="#l14.404"></a><span id="l14.404" class="difflineminus">-        memArray[i].lpMem = NULL;</span>
<a href="#l14.405"></a><span id="l14.405" class="difflineminus">-      }</span>
<a href="#l14.406"></a><span id="l14.406" class="difflineminus">-    }</span>
<a href="#l14.407"></a><span id="l14.407" class="difflineminus">-  }</span>
<a href="#l14.408"></a><span id="l14.408" class="difflineminus">-</span>
<a href="#l14.409"></a><span id="l14.409" class="difflineminus">-  pv = NULL;</span>
<a href="#l14.410"></a><span id="l14.410" class="difflineminus">-#ifdef WIN16     </span>
<a href="#l14.411"></a><span id="l14.411" class="difflineminus">-	return(SUCCESS_SUCCESS);</span>
<a href="#l14.412"></a><span id="l14.412" class="difflineminus">-#else</span>
<a href="#l14.413"></a><span id="l14.413" class="difflineminus">-  	return(S_OK);</span>
<a href="#l14.414"></a><span id="l14.414" class="difflineminus">-#endif</span>
<a href="#l14.415"></a><span id="l14.415" class="difflineminus">-}</span>
<a href="#l14.416"></a><span id="l14.416" class="difflineminus">-</span>
<a href="#l14.417"></a><span id="l14.417" class="difflineminus">-//</span>
<a href="#l14.418"></a><span id="l14.418" class="difflineminus">-// The MAPISendMail function sends a message. This function differs </span>
<a href="#l14.419"></a><span id="l14.419" class="difflineminus">-// from the MAPISendDocuments function in that it allows greater </span>
<a href="#l14.420"></a><span id="l14.420" class="difflineminus">-// flexibility in message generation. </span>
<a href="#l14.421"></a><span id="l14.421" class="difflineminus">-//</span>
<a href="#l14.422"></a><span id="l14.422" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.423"></a><span id="l14.423" class="difflineminus">-MAPISendMail(</span>
<a href="#l14.424"></a><span id="l14.424" class="difflineminus">-             LHANDLE lhSession, </span>
<a href="#l14.425"></a><span id="l14.425" class="difflineminus">-             ULONG UIParam, </span>
<a href="#l14.426"></a><span id="l14.426" class="difflineminus">-             lpMapiMessage lpMessage, </span>
<a href="#l14.427"></a><span id="l14.427" class="difflineminus">-             FLAGS flags, </span>
<a href="#l14.428"></a><span id="l14.428" class="difflineminus">-             ULONG ulReserved)</span>
<a href="#l14.429"></a><span id="l14.429" class="difflineminus">-{  </span>
<a href="#l14.430"></a><span id="l14.430" class="difflineminus">-#ifdef _DEBUG</span>
<a href="#l14.431"></a><span id="l14.431" class="difflineminus">-	TRACE_FN(&quot;MapiSendMail&quot;);</span>
<a href="#l14.432"></a><span id="l14.432" class="difflineminus">-	TRACE(&quot;  lhSession=%lu\n&quot;, lhSession);</span>
<a href="#l14.433"></a><span id="l14.433" class="difflineminus">-	if (lpMessage)</span>
<a href="#l14.434"></a><span id="l14.434" class="difflineminus">-	{</span>
<a href="#l14.435"></a><span id="l14.435" class="difflineminus">-		TRACE(&quot;  lpMessage-&gt;lpszSubject = '%s'\n&quot;, lpMessage-&gt;lpszSubject);</span>
<a href="#l14.436"></a><span id="l14.436" class="difflineminus">-		TRACE(&quot;  lpMessage-&gt;nRecipCount = %lu\n  lpMessage-&gt;nFileCount=%lu\n&quot;, lpMessage-&gt;nRecipCount, lpMessage-&gt;nFileCount);</span>
<a href="#l14.437"></a><span id="l14.437" class="difflineminus">-		lpMapiFileDesc pFiles = lpMessage-&gt;lpFiles;</span>
<a href="#l14.438"></a><span id="l14.438" class="difflineminus">-		for (ULONG i = 0; i &lt; lpMessage-&gt;nFileCount; i++)</span>
<a href="#l14.439"></a><span id="l14.439" class="difflineminus">-		{</span>
<a href="#l14.440"></a><span id="l14.440" class="difflineminus">-			TRACE(&quot;    lpszPathName='%s', lpszFileName='%s'\n&quot;, pFiles[i].lpszPathName, pFiles[i].lpszFileName);</span>
<a href="#l14.441"></a><span id="l14.441" class="difflineminus">-		}</span>
<a href="#l14.442"></a><span id="l14.442" class="difflineminus">-	}</span>
<a href="#l14.443"></a><span id="l14.443" class="difflineminus">-#endif</span>
<a href="#l14.444"></a><span id="l14.444" class="difflineminus">-  CleanupMAPITempFiles();</span>
<a href="#l14.445"></a><span id="l14.445" class="difflineminus">-</span>
<a href="#l14.446"></a><span id="l14.446" class="difflineminus">-  //</span>
<a href="#l14.447"></a><span id="l14.447" class="difflineminus">-  // Needed variables...</span>
<a href="#l14.448"></a><span id="l14.448" class="difflineminus">-  //</span>
<a href="#l14.449"></a><span id="l14.449" class="difflineminus">-  BOOL          isTempSession = FALSE;</span>
<a href="#l14.450"></a><span id="l14.450" class="difflineminus">-  LONG          result = SUCCESS_SUCCESS;</span>
<a href="#l14.451"></a><span id="l14.451" class="difflineminus">-  HWND          hWndIPC;</span>
<a href="#l14.452"></a><span id="l14.452" class="difflineminus">-  MAPIIPCType   ipcInfo;</span>
<a href="#l14.453"></a><span id="l14.453" class="difflineminus">-</span>
<a href="#l14.454"></a><span id="l14.454" class="difflineminus">-	if (!lpMessage)</span>
<a href="#l14.455"></a><span id="l14.455" class="difflineminus">-	{</span>
<a href="#l14.456"></a><span id="l14.456" class="difflineminus">-		return(MAPI_E_FAILURE);</span>
<a href="#l14.457"></a><span id="l14.457" class="difflineminus">-	}</span>
<a href="#l14.458"></a><span id="l14.458" class="difflineminus">-</span>
<a href="#l14.459"></a><span id="l14.459" class="difflineminus">-  //</span>
<a href="#l14.460"></a><span id="l14.460" class="difflineminus">-  // Sanity Check the attachments if any here...</span>
<a href="#l14.461"></a><span id="l14.461" class="difflineminus">-  //</span>
<a href="#l14.462"></a><span id="l14.462" class="difflineminus">-  if (lpMessage-&gt;nFileCount &gt; 0)</span>
<a href="#l14.463"></a><span id="l14.463" class="difflineminus">-  {</span>
<a href="#l14.464"></a><span id="l14.464" class="difflineminus">-    DWORD rc = SanityCheckAttachmentFiles(lpMessage);  // return of zero is ok</span>
<a href="#l14.465"></a><span id="l14.465" class="difflineminus">-    if (rc == 1)</span>
<a href="#l14.466"></a><span id="l14.466" class="difflineminus">-    {</span>
<a href="#l14.467"></a><span id="l14.467" class="difflineminus">-      return(MAPI_E_ATTACHMENT_NOT_FOUND);</span>
<a href="#l14.468"></a><span id="l14.468" class="difflineminus">-    }</span>
<a href="#l14.469"></a><span id="l14.469" class="difflineminus">-    else if (rc == 2)</span>
<a href="#l14.470"></a><span id="l14.470" class="difflineminus">-    {</span>
<a href="#l14.471"></a><span id="l14.471" class="difflineminus">-      return(MAPI_E_ATTACHMENT_OPEN_FAILURE);</span>
<a href="#l14.472"></a><span id="l14.472" class="difflineminus">-    }</span>
<a href="#l14.473"></a><span id="l14.473" class="difflineminus">-  }</span>
<a href="#l14.474"></a><span id="l14.474" class="difflineminus">-</span>
<a href="#l14.475"></a><span id="l14.475" class="difflineminus">-  //</span>
<a href="#l14.476"></a><span id="l14.476" class="difflineminus">-  // If lhSession is ZERO, then we have to get a temporary session and</span>
<a href="#l14.477"></a><span id="l14.477" class="difflineminus">-  // go from there.</span>
<a href="#l14.478"></a><span id="l14.478" class="difflineminus">-  //</span>
<a href="#l14.479"></a><span id="l14.479" class="difflineminus">-  if (lhSession == 0)</span>
<a href="#l14.480"></a><span id="l14.480" class="difflineminus">-  {</span>
<a href="#l14.481"></a><span id="l14.481" class="difflineminus">-    LHANDLE    lhTempSession;</span>
<a href="#l14.482"></a><span id="l14.482" class="difflineminus">-    if (MAPILogon(0, NULL, NULL, 0, 0, &amp;lhTempSession) != SUCCESS_SUCCESS)</span>
<a href="#l14.483"></a><span id="l14.483" class="difflineminus">-    {</span>
<a href="#l14.484"></a><span id="l14.484" class="difflineminus">-      isTempSession = TRUE;</span>
<a href="#l14.485"></a><span id="l14.485" class="difflineminus">-      if (MAPILogon(0, &quot;dummy&quot;, &quot;dummy&quot;, 0, 0, &amp;lhTempSession) != SUCCESS_SUCCESS)</span>
<a href="#l14.486"></a><span id="l14.486" class="difflineminus">-      {</span>
<a href="#l14.487"></a><span id="l14.487" class="difflineminus">-        return(MAPI_E_LOGIN_FAILURE);</span>
<a href="#l14.488"></a><span id="l14.488" class="difflineminus">-      }</span>
<a href="#l14.489"></a><span id="l14.489" class="difflineminus">-    }</span>
<a href="#l14.490"></a><span id="l14.490" class="difflineminus">-</span>
<a href="#l14.491"></a><span id="l14.491" class="difflineminus">-    lhSession = lhTempSession;</span>
<a href="#l14.492"></a><span id="l14.492" class="difflineminus">-  }</span>
<a href="#l14.493"></a><span id="l14.493" class="difflineminus">-</span>
<a href="#l14.494"></a><span id="l14.494" class="difflineminus">-  //</span>
<a href="#l14.495"></a><span id="l14.495" class="difflineminus">-  // Now create the big chunk of memory that we will pass across which</span>
<a href="#l14.496"></a><span id="l14.496" class="difflineminus">-  // represents the message</span>
<a href="#l14.497"></a><span id="l14.497" class="difflineminus">-  //</span>
<a href="#l14.498"></a><span id="l14.498" class="difflineminus">-  DWORD               totalSize;</span>
<a href="#l14.499"></a><span id="l14.499" class="difflineminus">-  MAPISendMailType    *memToPass = NULL;</span>
<a href="#l14.500"></a><span id="l14.500" class="difflineminus">-</span>
<a href="#l14.501"></a><span id="l14.501" class="difflineminus">-  memToPass = (MAPISendMailType *) FlattenMAPIMessageStructure(lpMessage, &amp;totalSize);</span>
<a href="#l14.502"></a><span id="l14.502" class="difflineminus">-  if (!memToPass)</span>
<a href="#l14.503"></a><span id="l14.503" class="difflineminus">-  {</span>
<a href="#l14.504"></a><span id="l14.504" class="difflineminus">-      if (isTempSession)</span>
<a href="#l14.505"></a><span id="l14.505" class="difflineminus">-      {</span>
<a href="#l14.506"></a><span id="l14.506" class="difflineminus">-        MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.507"></a><span id="l14.507" class="difflineminus">-      }</span>
<a href="#l14.508"></a><span id="l14.508" class="difflineminus">-      </span>
<a href="#l14.509"></a><span id="l14.509" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.510"></a><span id="l14.510" class="difflineminus">-  }</span>
<a href="#l14.511"></a><span id="l14.511" class="difflineminus">-</span>
<a href="#l14.512"></a><span id="l14.512" class="difflineminus">-  memToPass-&gt;lhSession = lhSession;</span>
<a href="#l14.513"></a><span id="l14.513" class="difflineminus">-  memToPass-&gt;ulUIParam = UIParam;</span>
<a href="#l14.514"></a><span id="l14.514" class="difflineminus">-  memToPass-&gt;flFlags = flags;</span>
<a href="#l14.515"></a><span id="l14.515" class="difflineminus">-  memToPass-&gt;ipcWorked = 0;</span>
<a href="#l14.516"></a><span id="l14.516" class="difflineminus">-</span>
<a href="#l14.517"></a><span id="l14.517" class="difflineminus">-  //</span>
<a href="#l14.518"></a><span id="l14.518" class="difflineminus">-  // This call locates a Communicator Window, if one is not running,</span>
<a href="#l14.519"></a><span id="l14.519" class="difflineminus">-  // it will start up an instance of Communicator and grab that window.</span>
<a href="#l14.520"></a><span id="l14.520" class="difflineminus">-  //</span>
<a href="#l14.521"></a><span id="l14.521" class="difflineminus">-  hWndIPC = GetCommunicatorIPCWindow();</span>
<a href="#l14.522"></a><span id="l14.522" class="difflineminus">-  if (NULL == hWndIPC)</span>
<a href="#l14.523"></a><span id="l14.523" class="difflineminus">-  {</span>
<a href="#l14.524"></a><span id="l14.524" class="difflineminus">-    free(memToPass);</span>
<a href="#l14.525"></a><span id="l14.525" class="difflineminus">-    if (isTempSession)</span>
<a href="#l14.526"></a><span id="l14.526" class="difflineminus">-    {</span>
<a href="#l14.527"></a><span id="l14.527" class="difflineminus">-      MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.528"></a><span id="l14.528" class="difflineminus">-    }</span>
<a href="#l14.529"></a><span id="l14.529" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.530"></a><span id="l14.530" class="difflineminus">-  }</span>
<a href="#l14.531"></a><span id="l14.531" class="difflineminus">-</span>
<a href="#l14.532"></a><span id="l14.532" class="difflineminus">-  // </span>
<a href="#l14.533"></a><span id="l14.533" class="difflineminus">-  // Build the IPC structure of information that needs to be provided</span>
<a href="#l14.534"></a><span id="l14.534" class="difflineminus">-  // to get information into Communicator</span>
<a href="#l14.535"></a><span id="l14.535" class="difflineminus">-  //</span>
<a href="#l14.536"></a><span id="l14.536" class="difflineminus">-  BuildMemName((LPSTR)ipcInfo.smemName, UIParam);</span>
<a href="#l14.537"></a><span id="l14.537" class="difflineminus">-</span>
<a href="#l14.538"></a><span id="l14.538" class="difflineminus">-  //</span>
<a href="#l14.539"></a><span id="l14.539" class="difflineminus">-  // Build the shared memory segment of information to pass into </span>
<a href="#l14.540"></a><span id="l14.540" class="difflineminus">-  // Communicator for send message call.</span>
<a href="#l14.541"></a><span id="l14.541" class="difflineminus">-  //</span>
<a href="#l14.542"></a><span id="l14.542" class="difflineminus">-  CSharedMem      *sMem;</span>
<a href="#l14.543"></a><span id="l14.543" class="difflineminus">-  HANDLE          hSharedMemory;</span>
<a href="#l14.544"></a><span id="l14.544" class="difflineminus">-</span>
<a href="#l14.545"></a><span id="l14.545" class="difflineminus">-  //</span>
<a href="#l14.546"></a><span id="l14.546" class="difflineminus">-  // Create the shared memory...</span>
<a href="#l14.547"></a><span id="l14.547" class="difflineminus">-  //</span>
<a href="#l14.548"></a><span id="l14.548" class="difflineminus">-  sMem = NSCreateSharedMemory(totalSize, (LPSTR) ipcInfo.smemName, &amp;hSharedMemory);</span>
<a href="#l14.549"></a><span id="l14.549" class="difflineminus">-  if (!sMem)</span>
<a href="#l14.550"></a><span id="l14.550" class="difflineminus">-  {</span>
<a href="#l14.551"></a><span id="l14.551" class="difflineminus">-      free(memToPass);</span>
<a href="#l14.552"></a><span id="l14.552" class="difflineminus">-      if (isTempSession)</span>
<a href="#l14.553"></a><span id="l14.553" class="difflineminus">-      {</span>
<a href="#l14.554"></a><span id="l14.554" class="difflineminus">-        MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.555"></a><span id="l14.555" class="difflineminus">-      }</span>
<a href="#l14.556"></a><span id="l14.556" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.557"></a><span id="l14.557" class="difflineminus">-  }</span>
<a href="#l14.558"></a><span id="l14.558" class="difflineminus">-</span>
<a href="#l14.559"></a><span id="l14.559" class="difflineminus">-  //</span>
<a href="#l14.560"></a><span id="l14.560" class="difflineminus">-  // Now copy the information into the memory segment.</span>
<a href="#l14.561"></a><span id="l14.561" class="difflineminus">-  //</span>
<a href="#l14.562"></a><span id="l14.562" class="difflineminus">-  sMem-&gt;m_dwSize = totalSize;</span>
<a href="#l14.563"></a><span id="l14.563" class="difflineminus">-  memcpy(sMem-&gt;m_buf, memToPass, (size_t) totalSize);</span>
<a href="#l14.564"></a><span id="l14.564" class="difflineminus">-</span>
<a href="#l14.565"></a><span id="l14.565" class="difflineminus">-  //</span>
<a href="#l14.566"></a><span id="l14.566" class="difflineminus">-  // Now set the size of the shared memory segment for the </span>
<a href="#l14.567"></a><span id="l14.567" class="difflineminus">-  // WM_COPYDATA argument that will be sent across.</span>
<a href="#l14.568"></a><span id="l14.568" class="difflineminus">-  //</span>
<a href="#l14.569"></a><span id="l14.569" class="difflineminus">-  ipcInfo.smemSize = totalSize;</span>
<a href="#l14.570"></a><span id="l14.570" class="difflineminus">-</span>
<a href="#l14.571"></a><span id="l14.571" class="difflineminus">-  // For Win16, we actually pass in the pointer to the structure,</span>
<a href="#l14.572"></a><span id="l14.572" class="difflineminus">-  // so just assign the variable here.</span>
<a href="#l14.573"></a><span id="l14.573" class="difflineminus">-#ifdef WIN16</span>
<a href="#l14.574"></a><span id="l14.574" class="difflineminus">-  ipcInfo.lpsmem = sMem;</span>
<a href="#l14.575"></a><span id="l14.575" class="difflineminus">-#else</span>
<a href="#l14.576"></a><span id="l14.576" class="difflineminus">-  ipcInfo.lpsmem = NULL;</span>
<a href="#l14.577"></a><span id="l14.577" class="difflineminus">-#endif</span>
<a href="#l14.578"></a><span id="l14.578" class="difflineminus">-</span>
<a href="#l14.579"></a><span id="l14.579" class="difflineminus">-  //</span>
<a href="#l14.580"></a><span id="l14.580" class="difflineminus">-  // Ok, time to do the SendMessage() to Communicator...</span>
<a href="#l14.581"></a><span id="l14.581" class="difflineminus">-  //</span>
<a href="#l14.582"></a><span id="l14.582" class="difflineminus">-  result = SendMAPIRequest(hWndIPC, NSCP_MAPISendMail, &amp;ipcInfo);</span>
<a href="#l14.583"></a><span id="l14.583" class="difflineminus">-</span>
<a href="#l14.584"></a><span id="l14.584" class="difflineminus">-  // Check for IPC completion</span>
<a href="#l14.585"></a><span id="l14.585" class="difflineminus">-  MAPISendMailType *ptr = (MAPISendMailType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.586"></a><span id="l14.586" class="difflineminus">-  if (!ptr-&gt;ipcWorked)</span>
<a href="#l14.587"></a><span id="l14.587" class="difflineminus">-  {</span>
<a href="#l14.588"></a><span id="l14.588" class="difflineminus">-    result = MAPI_E_FAILURE;</span>
<a href="#l14.589"></a><span id="l14.589" class="difflineminus">-  }</span>
<a href="#l14.590"></a><span id="l14.590" class="difflineminus">-</span>
<a href="#l14.591"></a><span id="l14.591" class="difflineminus">-  //</span>
<a href="#l14.592"></a><span id="l14.592" class="difflineminus">-  // Now time to do some cleanup...</span>
<a href="#l14.593"></a><span id="l14.593" class="difflineminus">-  //</span>
<a href="#l14.594"></a><span id="l14.594" class="difflineminus">-  NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.595"></a><span id="l14.595" class="difflineminus">-  free(memToPass);</span>
<a href="#l14.596"></a><span id="l14.596" class="difflineminus">-</span>
<a href="#l14.597"></a><span id="l14.597" class="difflineminus">-	LogString(&quot;--MAPISendMail complete\r\n&quot;);</span>
<a href="#l14.598"></a><span id="l14.598" class="difflineminus">-</span>
<a href="#l14.599"></a><span id="l14.599" class="difflineminus">-  //</span>
<a href="#l14.600"></a><span id="l14.600" class="difflineminus">-  // If we created a temp session, then we need to trash it...</span>
<a href="#l14.601"></a><span id="l14.601" class="difflineminus">-  //</span>
<a href="#l14.602"></a><span id="l14.602" class="difflineminus">-  if (isTempSession)</span>
<a href="#l14.603"></a><span id="l14.603" class="difflineminus">-  {</span>
<a href="#l14.604"></a><span id="l14.604" class="difflineminus">-    MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.605"></a><span id="l14.605" class="difflineminus">-  }</span>
<a href="#l14.606"></a><span id="l14.606" class="difflineminus">-</span>
<a href="#l14.607"></a><span id="l14.607" class="difflineminus">-  return(result);</span>
<a href="#l14.608"></a><span id="l14.608" class="difflineminus">-}</span>
<a href="#l14.609"></a><span id="l14.609" class="difflineminus">-</span>
<a href="#l14.610"></a><span id="l14.610" class="difflineminus">-//</span>
<a href="#l14.611"></a><span id="l14.611" class="difflineminus">-// The MAPISendDocuments function sends a standard message with one or more attached </span>
<a href="#l14.612"></a><span id="l14.612" class="difflineminus">-// files and a cover note. The cover note is a dialog box that allows the user to </span>
<a href="#l14.613"></a><span id="l14.613" class="difflineminus">-// enter a list of recipients and an optional message. MAPISendDocuments differs </span>
<a href="#l14.614"></a><span id="l14.614" class="difflineminus">-// from the MAPISendMail function in that it allows less flexibility in message generation. </span>
<a href="#l14.615"></a><span id="l14.615" class="difflineminus">-//</span>
<a href="#l14.616"></a><span id="l14.616" class="difflineminus">-void</span>
<a href="#l14.617"></a><span id="l14.617" class="difflineminus">-CleanupStringArray(LPSTR *strArray, DWORD arraySize)</span>
<a href="#l14.618"></a><span id="l14.618" class="difflineminus">-{</span>
<a href="#l14.619"></a><span id="l14.619" class="difflineminus">-  DWORD   i;</span>
<a href="#l14.620"></a><span id="l14.620" class="difflineminus">-</span>
<a href="#l14.621"></a><span id="l14.621" class="difflineminus">-  if (strArray == NULL)</span>
<a href="#l14.622"></a><span id="l14.622" class="difflineminus">-    return;</span>
<a href="#l14.623"></a><span id="l14.623" class="difflineminus">-</span>
<a href="#l14.624"></a><span id="l14.624" class="difflineminus">-  for (i=0; i&lt;arraySize; i++)</span>
<a href="#l14.625"></a><span id="l14.625" class="difflineminus">-  {</span>
<a href="#l14.626"></a><span id="l14.626" class="difflineminus">-    if (strArray[i] != NULL)</span>
<a href="#l14.627"></a><span id="l14.627" class="difflineminus">-    {</span>
<a href="#l14.628"></a><span id="l14.628" class="difflineminus">-      free(strArray[i]);</span>
<a href="#l14.629"></a><span id="l14.629" class="difflineminus">-      strArray[i] = NULL;</span>
<a href="#l14.630"></a><span id="l14.630" class="difflineminus">-    }</span>
<a href="#l14.631"></a><span id="l14.631" class="difflineminus">-  }</span>
<a href="#l14.632"></a><span id="l14.632" class="difflineminus">-  </span>
<a href="#l14.633"></a><span id="l14.633" class="difflineminus">-  free(strArray);</span>
<a href="#l14.634"></a><span id="l14.634" class="difflineminus">-  strArray = NULL;</span>
<a href="#l14.635"></a><span id="l14.635" class="difflineminus">-}</span>
<a href="#l14.636"></a><span id="l14.636" class="difflineminus">-</span>
<a href="#l14.637"></a><span id="l14.637" class="difflineminus">-MAPI_IMPLEMENT(ULONG) MAPISendDocuments(</span>
<a href="#l14.638"></a><span id="l14.638" class="difflineminus">-    ULONG ulUIParam,</span>
<a href="#l14.639"></a><span id="l14.639" class="difflineminus">-    LPSTR lpszDelimChar,</span>
<a href="#l14.640"></a><span id="l14.640" class="difflineminus">-    LPSTR lpszFilePaths,</span>
<a href="#l14.641"></a><span id="l14.641" class="difflineminus">-    LPSTR lpszFileNames,</span>
<a href="#l14.642"></a><span id="l14.642" class="difflineminus">-    ULONG ulReserved)</span>
<a href="#l14.643"></a><span id="l14.643" class="difflineminus">-{</span>
<a href="#l14.644"></a><span id="l14.644" class="difflineminus">-  TRACE_FN(&quot;MAPISendDocuments&quot;);</span>
<a href="#l14.645"></a><span id="l14.645" class="difflineminus">-  TRACE(&quot;MAPI: MAPISendDocuments() FilePaths: %s\n&quot;, lpszFilePaths);</span>
<a href="#l14.646"></a><span id="l14.646" class="difflineminus">-  TRACE(&quot;MAPI: MAPISendDocuments() FileNames: %s\n&quot;, lpszFileNames);</span>
<a href="#l14.647"></a><span id="l14.647" class="difflineminus">-  TRACE(&quot;MAPI: MAPISendDocuments() Delim    : [%s]\n&quot;, lpszDelimChar);</span>
<a href="#l14.648"></a><span id="l14.648" class="difflineminus">-</span>
<a href="#l14.649"></a><span id="l14.649" class="difflineminus">-  CleanupMAPITempFiles();</span>
<a href="#l14.650"></a><span id="l14.650" class="difflineminus">-</span>
<a href="#l14.651"></a><span id="l14.651" class="difflineminus">-  //</span>
<a href="#l14.652"></a><span id="l14.652" class="difflineminus">-  // Needed variables...</span>
<a href="#l14.653"></a><span id="l14.653" class="difflineminus">-  //</span>
<a href="#l14.654"></a><span id="l14.654" class="difflineminus">-  LONG          result = SUCCESS_SUCCESS;</span>
<a href="#l14.655"></a><span id="l14.655" class="difflineminus">-  HWND          hWndIPC;</span>
<a href="#l14.656"></a><span id="l14.656" class="difflineminus">-</span>
<a href="#l14.657"></a><span id="l14.657" class="difflineminus">-	if (!lpszFilePaths) </span>
<a href="#l14.658"></a><span id="l14.658" class="difflineminus">-	{</span>
<a href="#l14.659"></a><span id="l14.659" class="difflineminus">-		return(MAPI_E_FAILURE);</span>
<a href="#l14.660"></a><span id="l14.660" class="difflineminus">-	}</span>
<a href="#l14.661"></a><span id="l14.661" class="difflineminus">-</span>
<a href="#l14.662"></a><span id="l14.662" class="difflineminus">-  //</span>
<a href="#l14.663"></a><span id="l14.663" class="difflineminus">-  // Sanity Check the attachments here...</span>
<a href="#l14.664"></a><span id="l14.664" class="difflineminus">-  //</span>
<a href="#l14.665"></a><span id="l14.665" class="difflineminus">-  DWORD aCount = GetFileCount(lpszFilePaths, lpszDelimChar);</span>
<a href="#l14.666"></a><span id="l14.666" class="difflineminus">-  DWORD reallyFound = 0;</span>
<a href="#l14.667"></a><span id="l14.667" class="difflineminus">-  DWORD i;</span>
<a href="#l14.668"></a><span id="l14.668" class="difflineminus">-  BYTE  szFileName[_MAX_PATH];</span>
<a href="#l14.669"></a><span id="l14.669" class="difflineminus">-  BYTE  szNewFileName[_MAX_PATH];</span>
<a href="#l14.670"></a><span id="l14.670" class="difflineminus">-  BYTE  szReadableName[_MAX_PATH];</span>
<a href="#l14.671"></a><span id="l14.671" class="difflineminus">-</span>
<a href="#l14.672"></a><span id="l14.672" class="difflineminus">-  LPSTR *strArray = (LPSTR *) malloc((size_t) (sizeof(LPSTR) * ((aCount * 2) + 1)));</span>
<a href="#l14.673"></a><span id="l14.673" class="difflineminus">-  if (!strArray)</span>
<a href="#l14.674"></a><span id="l14.674" class="difflineminus">-  {</span>
<a href="#l14.675"></a><span id="l14.675" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.676"></a><span id="l14.676" class="difflineminus">-  }</span>
<a href="#l14.677"></a><span id="l14.677" class="difflineminus">-</span>
<a href="#l14.678"></a><span id="l14.678" class="difflineminus">-  memset(strArray, 0, (size_t) (sizeof(LPSTR) * ((aCount * 2) + 1)));</span>
<a href="#l14.679"></a><span id="l14.679" class="difflineminus">-  for (i=0; i&lt;aCount; i++)</span>
<a href="#l14.680"></a><span id="l14.680" class="difflineminus">-  {</span>
<a href="#l14.681"></a><span id="l14.681" class="difflineminus">-    if (ExtractFile(lpszFilePaths, lpszDelimChar, i, (LPSTR)szFileName))  // true=found</span>
<a href="#l14.682"></a><span id="l14.682" class="difflineminus">-    {</span>
<a href="#l14.683"></a><span id="l14.683" class="difflineminus">-      if (ValidateFile((LPSTR)szFileName) != 0)</span>
<a href="#l14.684"></a><span id="l14.684" class="difflineminus">-      {</span>
<a href="#l14.685"></a><span id="l14.685" class="difflineminus">-        CleanupStringArray(strArray, reallyFound);</span>
<a href="#l14.686"></a><span id="l14.686" class="difflineminus">-        return(MAPI_E_ATTACHMENT_OPEN_FAILURE);</span>
<a href="#l14.687"></a><span id="l14.687" class="difflineminus">-      }</span>
<a href="#l14.688"></a><span id="l14.688" class="difflineminus">-</span>
<a href="#l14.689"></a><span id="l14.689" class="difflineminus">-      //</span>
<a href="#l14.690"></a><span id="l14.690" class="difflineminus">-      // Now get the matching name for this file!</span>
<a href="#l14.691"></a><span id="l14.691" class="difflineminus">-      //</span>
<a href="#l14.692"></a><span id="l14.692" class="difflineminus">-      if (!ExtractFile(lpszFileNames, lpszDelimChar, i, (LPSTR)szReadableName))  // true=found</span>
<a href="#l14.693"></a><span id="l14.693" class="difflineminus">-      {</span>
<a href="#l14.694"></a><span id="l14.694" class="difflineminus">-        lstrcpy((char *)szReadableName, (char *)szFileName);</span>
<a href="#l14.695"></a><span id="l14.695" class="difflineminus">-      }</span>
<a href="#l14.696"></a><span id="l14.696" class="difflineminus">-</span>
<a href="#l14.697"></a><span id="l14.697" class="difflineminus">-      if (GetTempMailNameWithExtension((char *)szNewFileName, (char *)szReadableName) == 0)</span>
<a href="#l14.698"></a><span id="l14.698" class="difflineminus">-      {</span>
<a href="#l14.699"></a><span id="l14.699" class="difflineminus">-        CleanupStringArray(strArray, reallyFound);</span>
<a href="#l14.700"></a><span id="l14.700" class="difflineminus">-        return(MAPI_E_ATTACHMENT_OPEN_FAILURE);</span>
<a href="#l14.701"></a><span id="l14.701" class="difflineminus">-      }</span>
<a href="#l14.702"></a><span id="l14.702" class="difflineminus">-</span>
<a href="#l14.703"></a><span id="l14.703" class="difflineminus">-      if (!XP_CopyFile((char *)szFileName, (char *)szNewFileName, TRUE))</span>
<a href="#l14.704"></a><span id="l14.704" class="difflineminus">-      {</span>
<a href="#l14.705"></a><span id="l14.705" class="difflineminus">-        CleanupStringArray(strArray, reallyFound);</span>
<a href="#l14.706"></a><span id="l14.706" class="difflineminus">-        return(MAPI_E_ATTACHMENT_WRITE_FAILURE);</span>
<a href="#l14.707"></a><span id="l14.707" class="difflineminus">-      }</span>
<a href="#l14.708"></a><span id="l14.708" class="difflineminus">-</span>
<a href="#l14.709"></a><span id="l14.709" class="difflineminus">-      AddTempFile((LPSTR) szNewFileName);</span>
<a href="#l14.710"></a><span id="l14.710" class="difflineminus">-</span>
<a href="#l14.711"></a><span id="l14.711" class="difflineminus">-      strArray[reallyFound++] = strdup((LPSTR)szNewFileName);</span>
<a href="#l14.712"></a><span id="l14.712" class="difflineminus">-      strArray[reallyFound++] = strdup((LPSTR)szReadableName);</span>
<a href="#l14.713"></a><span id="l14.713" class="difflineminus">-    }</span>
<a href="#l14.714"></a><span id="l14.714" class="difflineminus">-  }</span>
<a href="#l14.715"></a><span id="l14.715" class="difflineminus">-</span>
<a href="#l14.716"></a><span id="l14.716" class="difflineminus">-  // Set last entry to null...again</span>
<a href="#l14.717"></a><span id="l14.717" class="difflineminus">-  strArray[reallyFound] = NULL;</span>
<a href="#l14.718"></a><span id="l14.718" class="difflineminus">-</span>
<a href="#l14.719"></a><span id="l14.719" class="difflineminus">-  // Check that we created an even matching pair, otherwise bail!</span>
<a href="#l14.720"></a><span id="l14.720" class="difflineminus">-  if ((reallyFound % 2) != 0)</span>
<a href="#l14.721"></a><span id="l14.721" class="difflineminus">-  {</span>
<a href="#l14.722"></a><span id="l14.722" class="difflineminus">-    CleanupStringArray(strArray, reallyFound);</span>
<a href="#l14.723"></a><span id="l14.723" class="difflineminus">-    return(MAPI_E_ATTACHMENT_OPEN_FAILURE);</span>
<a href="#l14.724"></a><span id="l14.724" class="difflineminus">-  }</span>
<a href="#l14.725"></a><span id="l14.725" class="difflineminus">-</span>
<a href="#l14.726"></a><span id="l14.726" class="difflineminus">-  MAPISendDocumentsType   docType;</span>
<a href="#l14.727"></a><span id="l14.727" class="difflineminus">-  MAPISendDocumentsType   *memToPass = NULL;</span>
<a href="#l14.728"></a><span id="l14.728" class="difflineminus">-  NSstringSeq             strSeq;</span>
<a href="#l14.729"></a><span id="l14.729" class="difflineminus">-  DWORD                   memSize;</span>
<a href="#l14.730"></a><span id="l14.730" class="difflineminus">-  LONG                    strSize;</span>
<a href="#l14.731"></a><span id="l14.731" class="difflineminus">-  MAPIIPCType             ipcInfo;</span>
<a href="#l14.732"></a><span id="l14.732" class="difflineminus">-</span>
<a href="#l14.733"></a><span id="l14.733" class="difflineminus">-  // Start setting up the MAPISendDocumentsType structure to pass to communicator</span>
<a href="#l14.734"></a><span id="l14.734" class="difflineminus">-  docType.nFileCount   = reallyFound/2;</span>
<a href="#l14.735"></a><span id="l14.735" class="difflineminus">-  docType.ulUIParam    = ulUIParam;</span>
<a href="#l14.736"></a><span id="l14.736" class="difflineminus">-  docType.ipcWorked	   = 0;</span>
<a href="#l14.737"></a><span id="l14.737" class="difflineminus">-  strSeq               = NSStrSeqNew(strArray);</span>
<a href="#l14.738"></a><span id="l14.738" class="difflineminus">-  if (!strSeq)</span>
<a href="#l14.739"></a><span id="l14.739" class="difflineminus">-  {</span>
<a href="#l14.740"></a><span id="l14.740" class="difflineminus">-    CleanupStringArray(strArray, reallyFound);</span>
<a href="#l14.741"></a><span id="l14.741" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.742"></a><span id="l14.742" class="difflineminus">-  }</span>
<a href="#l14.743"></a><span id="l14.743" class="difflineminus">-</span>
<a href="#l14.744"></a><span id="l14.744" class="difflineminus">-  // Cleanup strArray... </span>
<a href="#l14.745"></a><span id="l14.745" class="difflineminus">-  CleanupStringArray(strArray, reallyFound);</span>
<a href="#l14.746"></a><span id="l14.746" class="difflineminus">-</span>
<a href="#l14.747"></a><span id="l14.747" class="difflineminus">-  strSize = NSStrSeqSize(strSeq);</span>
<a href="#l14.748"></a><span id="l14.748" class="difflineminus">-  memSize = sizeof(MAPISendDocumentsType) + strSize; </span>
<a href="#l14.749"></a><span id="l14.749" class="difflineminus">- </span>
<a href="#l14.750"></a><span id="l14.750" class="difflineminus">-  //</span>
<a href="#l14.751"></a><span id="l14.751" class="difflineminus">-  // Now create the big chunk of memory that we will pass across which</span>
<a href="#l14.752"></a><span id="l14.752" class="difflineminus">-  // represents attached files...</span>
<a href="#l14.753"></a><span id="l14.753" class="difflineminus">-  //</span>
<a href="#l14.754"></a><span id="l14.754" class="difflineminus">-  memToPass = (MAPISendDocumentsType *)malloc((size_t) memSize);</span>
<a href="#l14.755"></a><span id="l14.755" class="difflineminus">-  if (!memToPass)</span>
<a href="#l14.756"></a><span id="l14.756" class="difflineminus">-  {</span>
<a href="#l14.757"></a><span id="l14.757" class="difflineminus">-    NSStrSeqDelete(strSeq);</span>
<a href="#l14.758"></a><span id="l14.758" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.759"></a><span id="l14.759" class="difflineminus">-  }</span>
<a href="#l14.760"></a><span id="l14.760" class="difflineminus">-            </span>
<a href="#l14.761"></a><span id="l14.761" class="difflineminus">-  // Null out the new memory...</span>
<a href="#l14.762"></a><span id="l14.762" class="difflineminus">-  memset(memToPass, 0, (size_t) memSize);</span>
<a href="#l14.763"></a><span id="l14.763" class="difflineminus">-            </span>
<a href="#l14.764"></a><span id="l14.764" class="difflineminus">-  // Copy in the actual data to the real chunk of memory...</span>
<a href="#l14.765"></a><span id="l14.765" class="difflineminus">-  memcpy(memToPass, &amp;docType, sizeof(MAPISendDocumentsType));</span>
<a href="#l14.766"></a><span id="l14.766" class="difflineminus">-  memcpy(&amp;(memToPass-&gt;dataBuf[0]), strSeq, (size_t) strSize);</span>
<a href="#l14.767"></a><span id="l14.767" class="difflineminus">-</span>
<a href="#l14.768"></a><span id="l14.768" class="difflineminus">-  // Cleanup sequence...</span>
<a href="#l14.769"></a><span id="l14.769" class="difflineminus">-  NSStrSeqDelete(strSeq);</span>
<a href="#l14.770"></a><span id="l14.770" class="difflineminus">-</span>
<a href="#l14.771"></a><span id="l14.771" class="difflineminus">-  //</span>
<a href="#l14.772"></a><span id="l14.772" class="difflineminus">-  // This call locates a Communicator Window, if one is not running,</span>
<a href="#l14.773"></a><span id="l14.773" class="difflineminus">-  // it will start up an instance of Communicator and grab that window.</span>
<a href="#l14.774"></a><span id="l14.774" class="difflineminus">-  //</span>
<a href="#l14.775"></a><span id="l14.775" class="difflineminus">-  hWndIPC = GetCommunicatorIPCWindow();</span>
<a href="#l14.776"></a><span id="l14.776" class="difflineminus">-  if (NULL == hWndIPC)</span>
<a href="#l14.777"></a><span id="l14.777" class="difflineminus">-  {</span>
<a href="#l14.778"></a><span id="l14.778" class="difflineminus">-    free(memToPass);</span>
<a href="#l14.779"></a><span id="l14.779" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.780"></a><span id="l14.780" class="difflineminus">-  }</span>
<a href="#l14.781"></a><span id="l14.781" class="difflineminus">-</span>
<a href="#l14.782"></a><span id="l14.782" class="difflineminus">-  // </span>
<a href="#l14.783"></a><span id="l14.783" class="difflineminus">-  // Build the IPC structure of information that needs to be provided</span>
<a href="#l14.784"></a><span id="l14.784" class="difflineminus">-  // to get information into Communicator</span>
<a href="#l14.785"></a><span id="l14.785" class="difflineminus">-  //</span>
<a href="#l14.786"></a><span id="l14.786" class="difflineminus">-  BuildMemName((LPSTR)ipcInfo.smemName, ulUIParam);</span>
<a href="#l14.787"></a><span id="l14.787" class="difflineminus">-</span>
<a href="#l14.788"></a><span id="l14.788" class="difflineminus">-  //</span>
<a href="#l14.789"></a><span id="l14.789" class="difflineminus">-  // Build the shared memory segment of information to pass into </span>
<a href="#l14.790"></a><span id="l14.790" class="difflineminus">-  // Communicator for send message call.</span>
<a href="#l14.791"></a><span id="l14.791" class="difflineminus">-  //</span>
<a href="#l14.792"></a><span id="l14.792" class="difflineminus">-  CSharedMem      *sMem;</span>
<a href="#l14.793"></a><span id="l14.793" class="difflineminus">-  HANDLE          hSharedMemory;</span>
<a href="#l14.794"></a><span id="l14.794" class="difflineminus">-</span>
<a href="#l14.795"></a><span id="l14.795" class="difflineminus">-  //</span>
<a href="#l14.796"></a><span id="l14.796" class="difflineminus">-  // Create the shared memory...</span>
<a href="#l14.797"></a><span id="l14.797" class="difflineminus">-  //</span>
<a href="#l14.798"></a><span id="l14.798" class="difflineminus">-  sMem = NSCreateSharedMemory(memSize, (LPSTR) ipcInfo.smemName, &amp;hSharedMemory);</span>
<a href="#l14.799"></a><span id="l14.799" class="difflineminus">-  if (!sMem)</span>
<a href="#l14.800"></a><span id="l14.800" class="difflineminus">-  {</span>
<a href="#l14.801"></a><span id="l14.801" class="difflineminus">-      free(memToPass);</span>
<a href="#l14.802"></a><span id="l14.802" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.803"></a><span id="l14.803" class="difflineminus">-  }</span>
<a href="#l14.804"></a><span id="l14.804" class="difflineminus">-</span>
<a href="#l14.805"></a><span id="l14.805" class="difflineminus">-  //</span>
<a href="#l14.806"></a><span id="l14.806" class="difflineminus">-  // Now copy the information into the memory segment.</span>
<a href="#l14.807"></a><span id="l14.807" class="difflineminus">-  //</span>
<a href="#l14.808"></a><span id="l14.808" class="difflineminus">-  sMem-&gt;m_dwSize = memSize;</span>
<a href="#l14.809"></a><span id="l14.809" class="difflineminus">-  memcpy(sMem-&gt;m_buf, memToPass, (size_t) memSize);</span>
<a href="#l14.810"></a><span id="l14.810" class="difflineminus">-</span>
<a href="#l14.811"></a><span id="l14.811" class="difflineminus">-  //</span>
<a href="#l14.812"></a><span id="l14.812" class="difflineminus">-  // Now set the size of the shared memory segment for the </span>
<a href="#l14.813"></a><span id="l14.813" class="difflineminus">-  // WM_COPYDATA argument that will be sent across.</span>
<a href="#l14.814"></a><span id="l14.814" class="difflineminus">-  //</span>
<a href="#l14.815"></a><span id="l14.815" class="difflineminus">-  ipcInfo.smemSize = memSize;</span>
<a href="#l14.816"></a><span id="l14.816" class="difflineminus">-</span>
<a href="#l14.817"></a><span id="l14.817" class="difflineminus">-  // For Win16, we actually pass in the pointer to the structure,</span>
<a href="#l14.818"></a><span id="l14.818" class="difflineminus">-  // so just assign the variable here.</span>
<a href="#l14.819"></a><span id="l14.819" class="difflineminus">-#ifdef WIN16</span>
<a href="#l14.820"></a><span id="l14.820" class="difflineminus">-  ipcInfo.lpsmem = sMem;</span>
<a href="#l14.821"></a><span id="l14.821" class="difflineminus">-#else</span>
<a href="#l14.822"></a><span id="l14.822" class="difflineminus">-  ipcInfo.lpsmem = NULL;</span>
<a href="#l14.823"></a><span id="l14.823" class="difflineminus">-#endif</span>
<a href="#l14.824"></a><span id="l14.824" class="difflineminus">-</span>
<a href="#l14.825"></a><span id="l14.825" class="difflineminus">-  //</span>
<a href="#l14.826"></a><span id="l14.826" class="difflineminus">-  // Ok, time to do the SendMessage() to Communicator...</span>
<a href="#l14.827"></a><span id="l14.827" class="difflineminus">-  //</span>
<a href="#l14.828"></a><span id="l14.828" class="difflineminus">-  result = SendMAPIRequest(hWndIPC, NSCP_MAPISendDocuments, &amp;ipcInfo);</span>
<a href="#l14.829"></a><span id="l14.829" class="difflineminus">-</span>
<a href="#l14.830"></a><span id="l14.830" class="difflineminus">-  MAPISendDocumentsType *ptr = (MAPISendDocumentsType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.831"></a><span id="l14.831" class="difflineminus">-  if (!ptr-&gt;ipcWorked)</span>
<a href="#l14.832"></a><span id="l14.832" class="difflineminus">-  {</span>
<a href="#l14.833"></a><span id="l14.833" class="difflineminus">-    result = MAPI_E_FAILURE;</span>
<a href="#l14.834"></a><span id="l14.834" class="difflineminus">-  }</span>
<a href="#l14.835"></a><span id="l14.835" class="difflineminus">-</span>
<a href="#l14.836"></a><span id="l14.836" class="difflineminus">-  //</span>
<a href="#l14.837"></a><span id="l14.837" class="difflineminus">-  // Now time to do some cleanup...</span>
<a href="#l14.838"></a><span id="l14.838" class="difflineminus">-  //</span>
<a href="#l14.839"></a><span id="l14.839" class="difflineminus">-  NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.840"></a><span id="l14.840" class="difflineminus">-  free(memToPass);</span>
<a href="#l14.841"></a><span id="l14.841" class="difflineminus">-</span>
<a href="#l14.842"></a><span id="l14.842" class="difflineminus">-	LogString(&quot;--MAPISendDocuments() complete\r\n&quot;);</span>
<a href="#l14.843"></a><span id="l14.843" class="difflineminus">-  return(result);</span>
<a href="#l14.844"></a><span id="l14.844" class="difflineminus">-}</span>
<a href="#l14.845"></a><span id="l14.845" class="difflineminus">-</span>
<a href="#l14.846"></a><span id="l14.846" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.847"></a><span id="l14.847" class="difflineminus">-MAPIFindNext(</span>
<a href="#l14.848"></a><span id="l14.848" class="difflineminus">-    LHANDLE lhSession,</span>
<a href="#l14.849"></a><span id="l14.849" class="difflineminus">-    ULONG ulUIParam,</span>
<a href="#l14.850"></a><span id="l14.850" class="difflineminus">-    LPSTR lpszMessageType,</span>
<a href="#l14.851"></a><span id="l14.851" class="difflineminus">-    LPSTR lpszSeedMessageID,</span>
<a href="#l14.852"></a><span id="l14.852" class="difflineminus">-    FLAGS flFlags,</span>
<a href="#l14.853"></a><span id="l14.853" class="difflineminus">-    ULONG ulReserved,</span>
<a href="#l14.854"></a><span id="l14.854" class="difflineminus">-    LPSTR lpszMessageID)</span>
<a href="#l14.855"></a><span id="l14.855" class="difflineminus">-{</span>
<a href="#l14.856"></a><span id="l14.856" class="difflineminus">-LRESULT       result;</span>
<a href="#l14.857"></a><span id="l14.857" class="difflineminus">-HWND          hWndIPC;</span>
<a href="#l14.858"></a><span id="l14.858" class="difflineminus">-MAPIIPCType   ipcInfo;</span>
<a href="#l14.859"></a><span id="l14.859" class="difflineminus">-LPSTR         tempSeedString = &quot;&quot;;</span>
<a href="#l14.860"></a><span id="l14.860" class="difflineminus">-</span>
<a href="#l14.861"></a><span id="l14.861" class="difflineminus">-	TRACE_FN(&quot;MAPIFindNext&quot;);</span>
<a href="#l14.862"></a><span id="l14.862" class="difflineminus">-  if (lhSession == 0)</span>
<a href="#l14.863"></a><span id="l14.863" class="difflineminus">-  {</span>
<a href="#l14.864"></a><span id="l14.864" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l14.865"></a><span id="l14.865" class="difflineminus">-  }</span>
<a href="#l14.866"></a><span id="l14.866" class="difflineminus">-</span>
<a href="#l14.867"></a><span id="l14.867" class="difflineminus">-  if (lpszSeedMessageID)</span>
<a href="#l14.868"></a><span id="l14.868" class="difflineminus">-  {</span>
<a href="#l14.869"></a><span id="l14.869" class="difflineminus">-    if (strlen(lpszSeedMessageID) &gt; 511)</span>
<a href="#l14.870"></a><span id="l14.870" class="difflineminus">-    {</span>
<a href="#l14.871"></a><span id="l14.871" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.872"></a><span id="l14.872" class="difflineminus">-    }</span>
<a href="#l14.873"></a><span id="l14.873" class="difflineminus">-  }</span>
<a href="#l14.874"></a><span id="l14.874" class="difflineminus">-  else</span>
<a href="#l14.875"></a><span id="l14.875" class="difflineminus">-  {</span>
<a href="#l14.876"></a><span id="l14.876" class="difflineminus">-    lpszSeedMessageID = tempSeedString;</span>
<a href="#l14.877"></a><span id="l14.877" class="difflineminus">-  }</span>
<a href="#l14.878"></a><span id="l14.878" class="difflineminus">-</span>
<a href="#l14.879"></a><span id="l14.879" class="difflineminus">-	TRACE(&quot;MAPIFindNext lhSession Session ID = %lu\n&quot;, lhSession);</span>
<a href="#l14.880"></a><span id="l14.880" class="difflineminus">-</span>
<a href="#l14.881"></a><span id="l14.881" class="difflineminus">-  //</span>
<a href="#l14.882"></a><span id="l14.882" class="difflineminus">-  // This call locates a Communicator Window, if one is not running,</span>
<a href="#l14.883"></a><span id="l14.883" class="difflineminus">-  // it will start up an instance of Communicator and grab that window.</span>
<a href="#l14.884"></a><span id="l14.884" class="difflineminus">-  //</span>
<a href="#l14.885"></a><span id="l14.885" class="difflineminus">-  hWndIPC = GetCommunicatorIPCWindow();</span>
<a href="#l14.886"></a><span id="l14.886" class="difflineminus">-  if (NULL == hWndIPC)</span>
<a href="#l14.887"></a><span id="l14.887" class="difflineminus">-  {</span>
<a href="#l14.888"></a><span id="l14.888" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.889"></a><span id="l14.889" class="difflineminus">-  }</span>
<a href="#l14.890"></a><span id="l14.890" class="difflineminus">-</span>
<a href="#l14.891"></a><span id="l14.891" class="difflineminus">-  // </span>
<a href="#l14.892"></a><span id="l14.892" class="difflineminus">-  // Build the IPC structure of information that needs to be provided</span>
<a href="#l14.893"></a><span id="l14.893" class="difflineminus">-  // to get information into Communicator</span>
<a href="#l14.894"></a><span id="l14.894" class="difflineminus">-  //</span>
<a href="#l14.895"></a><span id="l14.895" class="difflineminus">-  BuildMemName((LPSTR)ipcInfo.smemName, ulUIParam);</span>
<a href="#l14.896"></a><span id="l14.896" class="difflineminus">-</span>
<a href="#l14.897"></a><span id="l14.897" class="difflineminus">-  //</span>
<a href="#l14.898"></a><span id="l14.898" class="difflineminus">-  // Build the shared memory segment of information to pass into </span>
<a href="#l14.899"></a><span id="l14.899" class="difflineminus">-  // Communicator for the login call.</span>
<a href="#l14.900"></a><span id="l14.900" class="difflineminus">-  //</span>
<a href="#l14.901"></a><span id="l14.901" class="difflineminus">-  CSharedMem        *sMem;</span>
<a href="#l14.902"></a><span id="l14.902" class="difflineminus">-  DWORD             memSize;</span>
<a href="#l14.903"></a><span id="l14.903" class="difflineminus">-  HANDLE            hSharedMemory;</span>
<a href="#l14.904"></a><span id="l14.904" class="difflineminus">-  MAPIFindNextType  findInfo;</span>
<a href="#l14.905"></a><span id="l14.905" class="difflineminus">-   </span>
<a href="#l14.906"></a><span id="l14.906" class="difflineminus">-  memSize = sizeof(MAPIFindNextType);</span>
<a href="#l14.907"></a><span id="l14.907" class="difflineminus">-</span>
<a href="#l14.908"></a><span id="l14.908" class="difflineminus">-  //</span>
<a href="#l14.909"></a><span id="l14.909" class="difflineminus">-  // Create the shared memory...</span>
<a href="#l14.910"></a><span id="l14.910" class="difflineminus">-  //</span>
<a href="#l14.911"></a><span id="l14.911" class="difflineminus">-  sMem = NSCreateSharedMemory(memSize, (LPSTR) ipcInfo.smemName, &amp;hSharedMemory);</span>
<a href="#l14.912"></a><span id="l14.912" class="difflineminus">-  if (!sMem)</span>
<a href="#l14.913"></a><span id="l14.913" class="difflineminus">-  {</span>
<a href="#l14.914"></a><span id="l14.914" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.915"></a><span id="l14.915" class="difflineminus">-  }</span>
<a href="#l14.916"></a><span id="l14.916" class="difflineminus">-</span>
<a href="#l14.917"></a><span id="l14.917" class="difflineminus">-  //</span>
<a href="#l14.918"></a><span id="l14.918" class="difflineminus">-  // Now populate a Logon structure with the passed in information</span>
<a href="#l14.919"></a><span id="l14.919" class="difflineminus">-  //</span>
<a href="#l14.920"></a><span id="l14.920" class="difflineminus">-  findInfo.lhSession  = lhSession;</span>
<a href="#l14.921"></a><span id="l14.921" class="difflineminus">-  findInfo.ulUIParam  = ulUIParam;</span>
<a href="#l14.922"></a><span id="l14.922" class="difflineminus">-  findInfo.flFlags    = flFlags;</span>
<a href="#l14.923"></a><span id="l14.923" class="difflineminus">-  findInfo.ipcWorked  = 0;</span>
<a href="#l14.924"></a><span id="l14.924" class="difflineminus">-</span>
<a href="#l14.925"></a><span id="l14.925" class="difflineminus">-  //</span>
<a href="#l14.926"></a><span id="l14.926" class="difflineminus">-  // Copy the seed value in the structure</span>
<a href="#l14.927"></a><span id="l14.927" class="difflineminus">-  //</span>
<a href="#l14.928"></a><span id="l14.928" class="difflineminus">-  strcpy((LPSTR) findInfo.lpszSeedMessageID, lpszSeedMessageID);</span>
<a href="#l14.929"></a><span id="l14.929" class="difflineminus">-</span>
<a href="#l14.930"></a><span id="l14.930" class="difflineminus">-  //</span>
<a href="#l14.931"></a><span id="l14.931" class="difflineminus">-  // Now copy the information into the memory segment.</span>
<a href="#l14.932"></a><span id="l14.932" class="difflineminus">-  //</span>
<a href="#l14.933"></a><span id="l14.933" class="difflineminus">-  sMem-&gt;m_dwSize = memSize;</span>
<a href="#l14.934"></a><span id="l14.934" class="difflineminus">-  memcpy(sMem-&gt;m_buf, &amp;(findInfo), sizeof(MAPIFindNextType));</span>
<a href="#l14.935"></a><span id="l14.935" class="difflineminus">-</span>
<a href="#l14.936"></a><span id="l14.936" class="difflineminus">-  //</span>
<a href="#l14.937"></a><span id="l14.937" class="difflineminus">-  // Now set the size of the shared memory segment for the </span>
<a href="#l14.938"></a><span id="l14.938" class="difflineminus">-  // WM_COPYDATA argument that will be sent across.</span>
<a href="#l14.939"></a><span id="l14.939" class="difflineminus">-  //</span>
<a href="#l14.940"></a><span id="l14.940" class="difflineminus">-  ipcInfo.smemSize = memSize;</span>
<a href="#l14.941"></a><span id="l14.941" class="difflineminus">-</span>
<a href="#l14.942"></a><span id="l14.942" class="difflineminus">-  // For Win16, we actually pass in the pointer to the structure,</span>
<a href="#l14.943"></a><span id="l14.943" class="difflineminus">-  // so just assign the variable here.</span>
<a href="#l14.944"></a><span id="l14.944" class="difflineminus">-#ifdef WIN16</span>
<a href="#l14.945"></a><span id="l14.945" class="difflineminus">-  ipcInfo.lpsmem = sMem;</span>
<a href="#l14.946"></a><span id="l14.946" class="difflineminus">-#else</span>
<a href="#l14.947"></a><span id="l14.947" class="difflineminus">-  ipcInfo.lpsmem = NULL;</span>
<a href="#l14.948"></a><span id="l14.948" class="difflineminus">-#endif</span>
<a href="#l14.949"></a><span id="l14.949" class="difflineminus">-</span>
<a href="#l14.950"></a><span id="l14.950" class="difflineminus">-  //</span>
<a href="#l14.951"></a><span id="l14.951" class="difflineminus">-  // Ok, time to do the SendMessage() to Communicator...</span>
<a href="#l14.952"></a><span id="l14.952" class="difflineminus">-  //</span>
<a href="#l14.953"></a><span id="l14.953" class="difflineminus">-  result = SendMAPIRequest(hWndIPC, NSCP_MAPIFindNext, &amp;ipcInfo);</span>
<a href="#l14.954"></a><span id="l14.954" class="difflineminus">-</span>
<a href="#l14.955"></a><span id="l14.955" class="difflineminus">-  // Check for IPC completion</span>
<a href="#l14.956"></a><span id="l14.956" class="difflineminus">-  MAPIFindNextType *findNextInfo = (MAPIFindNextType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.957"></a><span id="l14.957" class="difflineminus">-  if (!findNextInfo-&gt;ipcWorked)</span>
<a href="#l14.958"></a><span id="l14.958" class="difflineminus">-  {</span>
<a href="#l14.959"></a><span id="l14.959" class="difflineminus">-    result = MAPI_E_FAILURE;</span>
<a href="#l14.960"></a><span id="l14.960" class="difflineminus">-  }</span>
<a href="#l14.961"></a><span id="l14.961" class="difflineminus">-</span>
<a href="#l14.962"></a><span id="l14.962" class="difflineminus">-  //</span>
<a href="#l14.963"></a><span id="l14.963" class="difflineminus">-  // Now return the value to the caller...</span>
<a href="#l14.964"></a><span id="l14.964" class="difflineminus">-  //</span>
<a href="#l14.965"></a><span id="l14.965" class="difflineminus">-  if (result == SUCCESS_SUCCESS)</span>
<a href="#l14.966"></a><span id="l14.966" class="difflineminus">-  {</span>
<a href="#l14.967"></a><span id="l14.967" class="difflineminus">-    strcpy(lpszMessageID, (LPSTR) findNextInfo-&gt;lpszMessageID);</span>
<a href="#l14.968"></a><span id="l14.968" class="difflineminus">-  }</span>
<a href="#l14.969"></a><span id="l14.969" class="difflineminus">-</span>
<a href="#l14.970"></a><span id="l14.970" class="difflineminus">-  //</span>
<a href="#l14.971"></a><span id="l14.971" class="difflineminus">-  // Now do cleanup on the way out...</span>
<a href="#l14.972"></a><span id="l14.972" class="difflineminus">-  //</span>
<a href="#l14.973"></a><span id="l14.973" class="difflineminus">-  NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.974"></a><span id="l14.974" class="difflineminus">-	LogString(&quot;--MAPIFindNext complete\r\n&quot;);</span>
<a href="#l14.975"></a><span id="l14.975" class="difflineminus">-	return(result);</span>
<a href="#l14.976"></a><span id="l14.976" class="difflineminus">-}</span>
<a href="#l14.977"></a><span id="l14.977" class="difflineminus">-</span>
<a href="#l14.978"></a><span id="l14.978" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.979"></a><span id="l14.979" class="difflineminus">-MAPIReadMail(</span>
<a href="#l14.980"></a><span id="l14.980" class="difflineminus">-    LHANDLE lhSession,</span>
<a href="#l14.981"></a><span id="l14.981" class="difflineminus">-    ULONG ulUIParam,</span>
<a href="#l14.982"></a><span id="l14.982" class="difflineminus">-    LPSTR lpszMessageID,</span>
<a href="#l14.983"></a><span id="l14.983" class="difflineminus">-    FLAGS flFlags,</span>
<a href="#l14.984"></a><span id="l14.984" class="difflineminus">-    ULONG ulReserved,</span>
<a href="#l14.985"></a><span id="l14.985" class="difflineminus">-    lpMapiMessage FAR *lppMessage)</span>
<a href="#l14.986"></a><span id="l14.986" class="difflineminus">-{</span>
<a href="#l14.987"></a><span id="l14.987" class="difflineminus">-LRESULT       result;</span>
<a href="#l14.988"></a><span id="l14.988" class="difflineminus">-HWND          hWndIPC;</span>
<a href="#l14.989"></a><span id="l14.989" class="difflineminus">-MAPIIPCType   ipcInfo;</span>
<a href="#l14.990"></a><span id="l14.990" class="difflineminus">-</span>
<a href="#l14.991"></a><span id="l14.991" class="difflineminus">-	TRACE_FN(&quot;MAPIReadMail&quot;);</span>
<a href="#l14.992"></a><span id="l14.992" class="difflineminus">-  //</span>
<a href="#l14.993"></a><span id="l14.993" class="difflineminus">-  // This one has to have a valid session handle, or we bail!</span>
<a href="#l14.994"></a><span id="l14.994" class="difflineminus">-  // </span>
<a href="#l14.995"></a><span id="l14.995" class="difflineminus">-  if (lhSession == 0)</span>
<a href="#l14.996"></a><span id="l14.996" class="difflineminus">-  {</span>
<a href="#l14.997"></a><span id="l14.997" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l14.998"></a><span id="l14.998" class="difflineminus">-  }</span>
<a href="#l14.999"></a><span id="l14.999" class="difflineminus">-</span>
<a href="#l14.1000"></a><span id="l14.1000" class="difflineminus">-  if (strlen(lpszMessageID) &gt; 511)</span>
<a href="#l14.1001"></a><span id="l14.1001" class="difflineminus">-  {</span>
<a href="#l14.1002"></a><span id="l14.1002" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1003"></a><span id="l14.1003" class="difflineminus">-  }</span>
<a href="#l14.1004"></a><span id="l14.1004" class="difflineminus">-</span>
<a href="#l14.1005"></a><span id="l14.1005" class="difflineminus">-  //</span>
<a href="#l14.1006"></a><span id="l14.1006" class="difflineminus">-  // This call locates a Communicator Window, if one is not running,</span>
<a href="#l14.1007"></a><span id="l14.1007" class="difflineminus">-  // it will start up an instance of Communicator and grab that window.</span>
<a href="#l14.1008"></a><span id="l14.1008" class="difflineminus">-  //</span>
<a href="#l14.1009"></a><span id="l14.1009" class="difflineminus">-  hWndIPC = GetCommunicatorIPCWindow();</span>
<a href="#l14.1010"></a><span id="l14.1010" class="difflineminus">-  if (NULL == hWndIPC)</span>
<a href="#l14.1011"></a><span id="l14.1011" class="difflineminus">-  {</span>
<a href="#l14.1012"></a><span id="l14.1012" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.1013"></a><span id="l14.1013" class="difflineminus">-  }</span>
<a href="#l14.1014"></a><span id="l14.1014" class="difflineminus">-</span>
<a href="#l14.1015"></a><span id="l14.1015" class="difflineminus">-  // </span>
<a href="#l14.1016"></a><span id="l14.1016" class="difflineminus">-  // Build the IPC structure of information that needs to be provided</span>
<a href="#l14.1017"></a><span id="l14.1017" class="difflineminus">-  // to get information into Communicator</span>
<a href="#l14.1018"></a><span id="l14.1018" class="difflineminus">-  //</span>
<a href="#l14.1019"></a><span id="l14.1019" class="difflineminus">-  BuildMemName((LPSTR)ipcInfo.smemName, ulUIParam);</span>
<a href="#l14.1020"></a><span id="l14.1020" class="difflineminus">-</span>
<a href="#l14.1021"></a><span id="l14.1021" class="difflineminus">-  //</span>
<a href="#l14.1022"></a><span id="l14.1022" class="difflineminus">-  // Build the shared memory segment of information to pass into </span>
<a href="#l14.1023"></a><span id="l14.1023" class="difflineminus">-  // Communicator for the login call.</span>
<a href="#l14.1024"></a><span id="l14.1024" class="difflineminus">-  //</span>
<a href="#l14.1025"></a><span id="l14.1025" class="difflineminus">-  CSharedMem        *sMem;</span>
<a href="#l14.1026"></a><span id="l14.1026" class="difflineminus">-  DWORD             memSize;</span>
<a href="#l14.1027"></a><span id="l14.1027" class="difflineminus">-  HANDLE            hSharedMemory;</span>
<a href="#l14.1028"></a><span id="l14.1028" class="difflineminus">-  MAPIReadMailType  readMailInfo;</span>
<a href="#l14.1029"></a><span id="l14.1029" class="difflineminus">-   </span>
<a href="#l14.1030"></a><span id="l14.1030" class="difflineminus">-  memSize = sizeof(MAPIReadMailType);</span>
<a href="#l14.1031"></a><span id="l14.1031" class="difflineminus">-  memset(&amp;readMailInfo, 0, (size_t) memSize);</span>
<a href="#l14.1032"></a><span id="l14.1032" class="difflineminus">-</span>
<a href="#l14.1033"></a><span id="l14.1033" class="difflineminus">-  //</span>
<a href="#l14.1034"></a><span id="l14.1034" class="difflineminus">-  // Create the shared memory...</span>
<a href="#l14.1035"></a><span id="l14.1035" class="difflineminus">-  //</span>
<a href="#l14.1036"></a><span id="l14.1036" class="difflineminus">-  sMem = NSCreateSharedMemory(memSize, (LPSTR) ipcInfo.smemName, &amp;hSharedMemory);</span>
<a href="#l14.1037"></a><span id="l14.1037" class="difflineminus">-  if (!sMem)</span>
<a href="#l14.1038"></a><span id="l14.1038" class="difflineminus">-  {</span>
<a href="#l14.1039"></a><span id="l14.1039" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1040"></a><span id="l14.1040" class="difflineminus">-  }</span>
<a href="#l14.1041"></a><span id="l14.1041" class="difflineminus">-</span>
<a href="#l14.1042"></a><span id="l14.1042" class="difflineminus">-  //</span>
<a href="#l14.1043"></a><span id="l14.1043" class="difflineminus">-  // Now populate a Logon structure with the passed in information</span>
<a href="#l14.1044"></a><span id="l14.1044" class="difflineminus">-  //</span>
<a href="#l14.1045"></a><span id="l14.1045" class="difflineminus">-  readMailInfo.lhSession  = lhSession;</span>
<a href="#l14.1046"></a><span id="l14.1046" class="difflineminus">-  readMailInfo.ulUIParam  = ulUIParam;</span>
<a href="#l14.1047"></a><span id="l14.1047" class="difflineminus">-  readMailInfo.flFlags    = flFlags;</span>
<a href="#l14.1048"></a><span id="l14.1048" class="difflineminus">-  readMailInfo.ipcWorked  = 0;</span>
<a href="#l14.1049"></a><span id="l14.1049" class="difflineminus">-</span>
<a href="#l14.1050"></a><span id="l14.1050" class="difflineminus">-  //</span>
<a href="#l14.1051"></a><span id="l14.1051" class="difflineminus">-  // Copy the seed value in the structure</span>
<a href="#l14.1052"></a><span id="l14.1052" class="difflineminus">-  //</span>
<a href="#l14.1053"></a><span id="l14.1053" class="difflineminus">-  strcpy((LPSTR) readMailInfo.lpszMessageID, lpszMessageID);</span>
<a href="#l14.1054"></a><span id="l14.1054" class="difflineminus">-</span>
<a href="#l14.1055"></a><span id="l14.1055" class="difflineminus">-  //</span>
<a href="#l14.1056"></a><span id="l14.1056" class="difflineminus">-  // Now copy the information into the memory segment.</span>
<a href="#l14.1057"></a><span id="l14.1057" class="difflineminus">-  //</span>
<a href="#l14.1058"></a><span id="l14.1058" class="difflineminus">-  sMem-&gt;m_dwSize = memSize;</span>
<a href="#l14.1059"></a><span id="l14.1059" class="difflineminus">-  memcpy(sMem-&gt;m_buf, &amp;(readMailInfo), sizeof(MAPIReadMailType));</span>
<a href="#l14.1060"></a><span id="l14.1060" class="difflineminus">-</span>
<a href="#l14.1061"></a><span id="l14.1061" class="difflineminus">-  //</span>
<a href="#l14.1062"></a><span id="l14.1062" class="difflineminus">-  // Now set the size of the shared memory segment for the </span>
<a href="#l14.1063"></a><span id="l14.1063" class="difflineminus">-  // WM_COPYDATA argument that will be sent across.</span>
<a href="#l14.1064"></a><span id="l14.1064" class="difflineminus">-  //</span>
<a href="#l14.1065"></a><span id="l14.1065" class="difflineminus">-  ipcInfo.smemSize = memSize;</span>
<a href="#l14.1066"></a><span id="l14.1066" class="difflineminus">-</span>
<a href="#l14.1067"></a><span id="l14.1067" class="difflineminus">-  // For Win16, we actually pass in the pointer to the structure,</span>
<a href="#l14.1068"></a><span id="l14.1068" class="difflineminus">-  // so just assign the variable here.</span>
<a href="#l14.1069"></a><span id="l14.1069" class="difflineminus">-#ifdef WIN16</span>
<a href="#l14.1070"></a><span id="l14.1070" class="difflineminus">-  ipcInfo.lpsmem = sMem;</span>
<a href="#l14.1071"></a><span id="l14.1071" class="difflineminus">-#else</span>
<a href="#l14.1072"></a><span id="l14.1072" class="difflineminus">-  ipcInfo.lpsmem = NULL;</span>
<a href="#l14.1073"></a><span id="l14.1073" class="difflineminus">-#endif</span>
<a href="#l14.1074"></a><span id="l14.1074" class="difflineminus">-</span>
<a href="#l14.1075"></a><span id="l14.1075" class="difflineminus">-  //</span>
<a href="#l14.1076"></a><span id="l14.1076" class="difflineminus">-  // Ok, time to do the SendMessage() to Communicator...</span>
<a href="#l14.1077"></a><span id="l14.1077" class="difflineminus">-  //</span>
<a href="#l14.1078"></a><span id="l14.1078" class="difflineminus">-  result = SendMAPIRequest(hWndIPC, NSCP_MAPIReadMail, &amp;ipcInfo);</span>
<a href="#l14.1079"></a><span id="l14.1079" class="difflineminus">-</span>
<a href="#l14.1080"></a><span id="l14.1080" class="difflineminus">-  // Check the IPC status...</span>
<a href="#l14.1081"></a><span id="l14.1081" class="difflineminus">-  MAPIReadMailType *rMailPtr = (MAPIReadMailType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.1082"></a><span id="l14.1082" class="difflineminus">-</span>
<a href="#l14.1083"></a><span id="l14.1083" class="difflineminus">-  //</span>
<a href="#l14.1084"></a><span id="l14.1084" class="difflineminus">-  // Now return the value to the caller if we bombed...</span>
<a href="#l14.1085"></a><span id="l14.1085" class="difflineminus">-  //</span>
<a href="#l14.1086"></a><span id="l14.1086" class="difflineminus">-  if ((result != SUCCESS_SUCCESS) || (!(rMailPtr-&gt;ipcWorked)))</span>
<a href="#l14.1087"></a><span id="l14.1087" class="difflineminus">-  {</span>
<a href="#l14.1088"></a><span id="l14.1088" class="difflineminus">-    NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1089"></a><span id="l14.1089" class="difflineminus">-	  LogString(&quot;--MAPIReadMail failed\r\n&quot;);</span>
<a href="#l14.1090"></a><span id="l14.1090" class="difflineminus">-	  return(result);</span>
<a href="#l14.1091"></a><span id="l14.1091" class="difflineminus">-  }</span>
<a href="#l14.1092"></a><span id="l14.1092" class="difflineminus">-</span>
<a href="#l14.1093"></a><span id="l14.1093" class="difflineminus">-  // Now get a hold of the various values for the message we need to </span>
<a href="#l14.1094"></a><span id="l14.1094" class="difflineminus">-  // return in the lpMapiMessage structure</span>
<a href="#l14.1095"></a><span id="l14.1095" class="difflineminus">-</span>
<a href="#l14.1096"></a><span id="l14.1096" class="difflineminus">-  if (rMailPtr-&gt;MSG_nRecipCount == 0)</span>
<a href="#l14.1097"></a><span id="l14.1097" class="difflineminus">-  {</span>
<a href="#l14.1098"></a><span id="l14.1098" class="difflineminus">-    NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1099"></a><span id="l14.1099" class="difflineminus">-	  LogString(&quot;--MAPIReadMail failed - ZERO recipients\r\n&quot;);</span>
<a href="#l14.1100"></a><span id="l14.1100" class="difflineminus">-	  return(MAPI_E_FAILURE);</span>
<a href="#l14.1101"></a><span id="l14.1101" class="difflineminus">-  }</span>
<a href="#l14.1102"></a><span id="l14.1102" class="difflineminus">-</span>
<a href="#l14.1103"></a><span id="l14.1103" class="difflineminus">-  //</span>
<a href="#l14.1104"></a><span id="l14.1104" class="difflineminus">-  // Get the blob loaded into memory...</span>
<a href="#l14.1105"></a><span id="l14.1105" class="difflineminus">-  // </span>
<a href="#l14.1106"></a><span id="l14.1106" class="difflineminus">-  NSstringSeq blobSequence = (NSstringSeq) LoadBlobToMemory((LPSTR) rMailPtr-&gt;lpszBlob);</span>
<a href="#l14.1107"></a><span id="l14.1107" class="difflineminus">-</span>
<a href="#l14.1108"></a><span id="l14.1108" class="difflineminus">-  // Now check on the blob</span>
<a href="#l14.1109"></a><span id="l14.1109" class="difflineminus">-  if (!blobSequence)</span>
<a href="#l14.1110"></a><span id="l14.1110" class="difflineminus">-  {	  </span>
<a href="#l14.1111"></a><span id="l14.1111" class="difflineminus">-    // Cleanup the shared memory...</span>
<a href="#l14.1112"></a><span id="l14.1112" class="difflineminus">-    NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1113"></a><span id="l14.1113" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1114"></a><span id="l14.1114" class="difflineminus">-  }</span>
<a href="#l14.1115"></a><span id="l14.1115" class="difflineminus">-</span>
<a href="#l14.1116"></a><span id="l14.1116" class="difflineminus">-  lpMapiMessage  msgPtr = (MapiMessage *)malloc(sizeof(MapiMessage));</span>
<a href="#l14.1117"></a><span id="l14.1117" class="difflineminus">-  if (msgPtr == NULL)</span>
<a href="#l14.1118"></a><span id="l14.1118" class="difflineminus">-  {</span>
<a href="#l14.1119"></a><span id="l14.1119" class="difflineminus">-    // Cleanup the shared memory...</span>
<a href="#l14.1120"></a><span id="l14.1120" class="difflineminus">-    NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1121"></a><span id="l14.1121" class="difflineminus">-    NSStrSeqDelete(blobSequence);</span>
<a href="#l14.1122"></a><span id="l14.1122" class="difflineminus">-	  LogString(&quot;--MAPIReadMail failed\r\n&quot;);</span>
<a href="#l14.1123"></a><span id="l14.1123" class="difflineminus">-	  return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1124"></a><span id="l14.1124" class="difflineminus">-  }</span>
<a href="#l14.1125"></a><span id="l14.1125" class="difflineminus">-  </span>
<a href="#l14.1126"></a><span id="l14.1126" class="difflineminus">-  memset(msgPtr, 0, sizeof(MapiMessage)); </span>
<a href="#l14.1127"></a><span id="l14.1127" class="difflineminus">-</span>
<a href="#l14.1128"></a><span id="l14.1128" class="difflineminus">-  //</span>
<a href="#l14.1129"></a><span id="l14.1129" class="difflineminus">-  // At this point, we need to populate the structure of information</span>
<a href="#l14.1130"></a><span id="l14.1130" class="difflineminus">-  // we are passing back via the *lppMessage and then start parsing through the</span>
<a href="#l14.1131"></a><span id="l14.1131" class="difflineminus">-  // String sequence for each of needed fields. After populating the entire </span>
<a href="#l14.1132"></a><span id="l14.1132" class="difflineminus">-  // structure, return this pointer and our job on this side is done!</span>
<a href="#l14.1133"></a><span id="l14.1133" class="difflineminus">-  //</span>
<a href="#l14.1134"></a><span id="l14.1134" class="difflineminus">-  LPSTR   subject = NSStrSeqGet(blobSequence, 0);</span>
<a href="#l14.1135"></a><span id="l14.1135" class="difflineminus">-  LPSTR   noteText = NSStrSeqGet(blobSequence, 1);</span>
<a href="#l14.1136"></a><span id="l14.1136" class="difflineminus">-  LPSTR   dateReceived = NSStrSeqGet(blobSequence, 2);</span>
<a href="#l14.1137"></a><span id="l14.1137" class="difflineminus">-  LPSTR   threadID = NSStrSeqGet(blobSequence, 3);</span>
<a href="#l14.1138"></a><span id="l14.1138" class="difflineminus">-  LPSTR   origName = NSStrSeqGet(blobSequence, 4);</span>
<a href="#l14.1139"></a><span id="l14.1139" class="difflineminus">-  LPSTR   origAddress = NSStrSeqGet(blobSequence, 5);</span>
<a href="#l14.1140"></a><span id="l14.1140" class="difflineminus">-</span>
<a href="#l14.1141"></a><span id="l14.1141" class="difflineminus">-  UINT    i;</span>
<a href="#l14.1142"></a><span id="l14.1142" class="difflineminus">-  ULONG   stringCount = 6;      // This is to start with the rest of the string seq</span>
<a href="#l14.1143"></a><span id="l14.1143" class="difflineminus">-</span>
<a href="#l14.1144"></a><span id="l14.1144" class="difflineminus">-  // Set all of the general header information first!</span>
<a href="#l14.1145"></a><span id="l14.1145" class="difflineminus">-  msgPtr-&gt;lpszSubject = strdup(CheckNullString(subject));</span>
<a href="#l14.1146"></a><span id="l14.1146" class="difflineminus">-  msgPtr-&gt;lpszDateReceived = strdup(CheckNullString(dateReceived));</span>
<a href="#l14.1147"></a><span id="l14.1147" class="difflineminus">-  msgPtr-&gt;lpszConversationID = strdup(CheckNullString(threadID));</span>
<a href="#l14.1148"></a><span id="l14.1148" class="difflineminus">-  msgPtr-&gt;flFlags = rMailPtr-&gt;MSG_flFlags;</span>
<a href="#l14.1149"></a><span id="l14.1149" class="difflineminus">-  </span>
<a href="#l14.1150"></a><span id="l14.1150" class="difflineminus">-  // Setup the originator information!</span>
<a href="#l14.1151"></a><span id="l14.1151" class="difflineminus">-  msgPtr-&gt;lpOriginator = (lpMapiRecipDesc) malloc(sizeof(MapiRecipDesc));</span>
<a href="#l14.1152"></a><span id="l14.1152" class="difflineminus">-  if (!msgPtr-&gt;lpOriginator)</span>
<a href="#l14.1153"></a><span id="l14.1153" class="difflineminus">-  {</span>
<a href="#l14.1154"></a><span id="l14.1154" class="difflineminus">-    // Cleanup the shared memory...</span>
<a href="#l14.1155"></a><span id="l14.1155" class="difflineminus">-    NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1156"></a><span id="l14.1156" class="difflineminus">-</span>
<a href="#l14.1157"></a><span id="l14.1157" class="difflineminus">-    FreeMAPIMessage(msgPtr);</span>
<a href="#l14.1158"></a><span id="l14.1158" class="difflineminus">-    NSStrSeqDelete(blobSequence);</span>
<a href="#l14.1159"></a><span id="l14.1159" class="difflineminus">-	  LogString(&quot;--MAPIReadMail failed\r\n&quot;);</span>
<a href="#l14.1160"></a><span id="l14.1160" class="difflineminus">-	  return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1161"></a><span id="l14.1161" class="difflineminus">-  }</span>
<a href="#l14.1162"></a><span id="l14.1162" class="difflineminus">-</span>
<a href="#l14.1163"></a><span id="l14.1163" class="difflineminus">-  // memset the area just allocated to null</span>
<a href="#l14.1164"></a><span id="l14.1164" class="difflineminus">-  memset(msgPtr-&gt;lpOriginator, 0, sizeof(MapiRecipDesc));</span>
<a href="#l14.1165"></a><span id="l14.1165" class="difflineminus">-</span>
<a href="#l14.1166"></a><span id="l14.1166" class="difflineminus">-  msgPtr-&gt;lpOriginator-&gt;lpszName = strdup(CheckNullString(origName));</span>
<a href="#l14.1167"></a><span id="l14.1167" class="difflineminus">-  msgPtr-&gt;lpOriginator-&gt;lpszAddress = strdup(CheckNullString(origAddress));</span>
<a href="#l14.1168"></a><span id="l14.1168" class="difflineminus">-  msgPtr-&gt;lpOriginator-&gt;ulRecipClass = rMailPtr-&gt;MSG_ORIG_ulRecipClass;</span>
<a href="#l14.1169"></a><span id="l14.1169" class="difflineminus">-</span>
<a href="#l14.1170"></a><span id="l14.1170" class="difflineminus">-  // Now deal with the recipients of this message</span>
<a href="#l14.1171"></a><span id="l14.1171" class="difflineminus">-  msgPtr-&gt;lpRecips = (lpMapiRecipDesc) malloc((size_t) (sizeof(MapiRecipDesc) * </span>
<a href="#l14.1172"></a><span id="l14.1172" class="difflineminus">-                                                    rMailPtr-&gt;MSG_nRecipCount));</span>
<a href="#l14.1173"></a><span id="l14.1173" class="difflineminus">-  if (!msgPtr-&gt;lpRecips)</span>
<a href="#l14.1174"></a><span id="l14.1174" class="difflineminus">-  {</span>
<a href="#l14.1175"></a><span id="l14.1175" class="difflineminus">-    // Cleanup the shared memory...</span>
<a href="#l14.1176"></a><span id="l14.1176" class="difflineminus">-    NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1177"></a><span id="l14.1177" class="difflineminus">-</span>
<a href="#l14.1178"></a><span id="l14.1178" class="difflineminus">-    FreeMAPIMessage(msgPtr);</span>
<a href="#l14.1179"></a><span id="l14.1179" class="difflineminus">-    NSStrSeqDelete(blobSequence);</span>
<a href="#l14.1180"></a><span id="l14.1180" class="difflineminus">-	  LogString(&quot;--MAPIReadMail failed\r\n&quot;);</span>
<a href="#l14.1181"></a><span id="l14.1181" class="difflineminus">-	  return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1182"></a><span id="l14.1182" class="difflineminus">-  }</span>
<a href="#l14.1183"></a><span id="l14.1183" class="difflineminus">-</span>
<a href="#l14.1184"></a><span id="l14.1184" class="difflineminus">-  msgPtr-&gt;nRecipCount = rMailPtr-&gt;MSG_nRecipCount;</span>
<a href="#l14.1185"></a><span id="l14.1185" class="difflineminus">-  memset(msgPtr-&gt;lpRecips, 0, (size_t) (sizeof(MapiRecipDesc) * msgPtr-&gt;nRecipCount));</span>
<a href="#l14.1186"></a><span id="l14.1186" class="difflineminus">-</span>
<a href="#l14.1187"></a><span id="l14.1187" class="difflineminus">-  for (i=0; i&lt;msgPtr-&gt;nRecipCount; i++)</span>
<a href="#l14.1188"></a><span id="l14.1188" class="difflineminus">-  {</span>
<a href="#l14.1189"></a><span id="l14.1189" class="difflineminus">-  //      String x: LPSTR lpszName;             // Recipient N name                           </span>
<a href="#l14.1190"></a><span id="l14.1190" class="difflineminus">-  //      String x: LPSTR lpszAddress;          // Recipient N address (optional)             </span>
<a href="#l14.1191"></a><span id="l14.1191" class="difflineminus">-  //      String x: LPSTR lpszRecipClass        // recipient class - sprintf of ULONG</span>
<a href="#l14.1192"></a><span id="l14.1192" class="difflineminus">-</span>
<a href="#l14.1193"></a><span id="l14.1193" class="difflineminus">-    msgPtr-&gt;lpRecips[i].lpszName = </span>
<a href="#l14.1194"></a><span id="l14.1194" class="difflineminus">-        strdup( CheckNullString(NSStrSeqGet(blobSequence, stringCount++)) );</span>
<a href="#l14.1195"></a><span id="l14.1195" class="difflineminus">-</span>
<a href="#l14.1196"></a><span id="l14.1196" class="difflineminus">-    msgPtr-&gt;lpRecips[i].lpszAddress = </span>
<a href="#l14.1197"></a><span id="l14.1197" class="difflineminus">-        strdup( CheckNullString(NSStrSeqGet(blobSequence, stringCount++)) );</span>
<a href="#l14.1198"></a><span id="l14.1198" class="difflineminus">-      </span>
<a href="#l14.1199"></a><span id="l14.1199" class="difflineminus">-    msgPtr-&gt;lpRecips[i].ulRecipClass = </span>
<a href="#l14.1200"></a><span id="l14.1200" class="difflineminus">-        (ULONG) atoi( CheckNullString(NSStrSeqGet(blobSequence, stringCount++)) );</span>
<a href="#l14.1201"></a><span id="l14.1201" class="difflineminus">-  }</span>
<a href="#l14.1202"></a><span id="l14.1202" class="difflineminus">-</span>
<a href="#l14.1203"></a><span id="l14.1203" class="difflineminus">-  //</span>
<a href="#l14.1204"></a><span id="l14.1204" class="difflineminus">-  // MAPI_ENVELOPE_ONLY </span>
<a href="#l14.1205"></a><span id="l14.1205" class="difflineminus">-  // Indicates MAPIReadMail should read the message header only. File attachments are </span>
<a href="#l14.1206"></a><span id="l14.1206" class="difflineminus">-  // not copied to temporary files, and neither temporary file names nor message text </span>
<a href="#l14.1207"></a><span id="l14.1207" class="difflineminus">-  // is written. Setting this flag enhances performance. </span>
<a href="#l14.1208"></a><span id="l14.1208" class="difflineminus">-  //</span>
<a href="#l14.1209"></a><span id="l14.1209" class="difflineminus">-  // MAPI_SUPPRESS_ATTACH </span>
<a href="#l14.1210"></a><span id="l14.1210" class="difflineminus">-  // Indicates MAPIReadMail should not copy file attachments but should write message </span>
<a href="#l14.1211"></a><span id="l14.1211" class="difflineminus">-  // text into the MapiMessage structure. MAPIReadMail ignores this flag if the </span>
<a href="#l14.1212"></a><span id="l14.1212" class="difflineminus">-  // calling application has set the MAPI_ENVELOPE_ONLY flag. Setting the </span>
<a href="#l14.1213"></a><span id="l14.1213" class="difflineminus">-  // MAPI_SUPPRESS_ATTACH flag enhances performance. </span>
<a href="#l14.1214"></a><span id="l14.1214" class="difflineminus">-  //</span>
<a href="#l14.1215"></a><span id="l14.1215" class="difflineminus">-  if (flFlags &amp; MAPI_ENVELOPE_ONLY)</span>
<a href="#l14.1216"></a><span id="l14.1216" class="difflineminus">-  {</span>
<a href="#l14.1217"></a><span id="l14.1217" class="difflineminus">-    noteText = NULL;</span>
<a href="#l14.1218"></a><span id="l14.1218" class="difflineminus">-    rMailPtr-&gt;MSG_nFileCount = 0;</span>
<a href="#l14.1219"></a><span id="l14.1219" class="difflineminus">-  }</span>
<a href="#l14.1220"></a><span id="l14.1220" class="difflineminus">-  else if ( (flFlags &amp; MAPI_BODY_AS_FILE) &amp;&amp;</span>
<a href="#l14.1221"></a><span id="l14.1221" class="difflineminus">-            (flFlags &amp; MAPI_SUPPRESS_ATTACH))</span>
<a href="#l14.1222"></a><span id="l14.1222" class="difflineminus">-  {</span>
<a href="#l14.1223"></a><span id="l14.1223" class="difflineminus">-    rMailPtr-&gt;MSG_nFileCount = 1;</span>
<a href="#l14.1224"></a><span id="l14.1224" class="difflineminus">-  }</span>
<a href="#l14.1225"></a><span id="l14.1225" class="difflineminus">-  else if (flFlags &amp; MAPI_BODY_AS_FILE) </span>
<a href="#l14.1226"></a><span id="l14.1226" class="difflineminus">-  {</span>
<a href="#l14.1227"></a><span id="l14.1227" class="difflineminus">-    ++(rMailPtr-&gt;MSG_nFileCount);</span>
<a href="#l14.1228"></a><span id="l14.1228" class="difflineminus">-  }</span>
<a href="#l14.1229"></a><span id="l14.1229" class="difflineminus">-</span>
<a href="#l14.1230"></a><span id="l14.1230" class="difflineminus">-  // Now deal with the list of attachments! Since the nFileCount should be set</span>
<a href="#l14.1231"></a><span id="l14.1231" class="difflineminus">-  // correctly, this loop will automagically be correct</span>
<a href="#l14.1232"></a><span id="l14.1232" class="difflineminus">-  //</span>
<a href="#l14.1233"></a><span id="l14.1233" class="difflineminus">-  if (rMailPtr-&gt;MSG_nFileCount &gt; 0)</span>
<a href="#l14.1234"></a><span id="l14.1234" class="difflineminus">-  {</span>
<a href="#l14.1235"></a><span id="l14.1235" class="difflineminus">-    msgPtr-&gt;lpFiles = (lpMapiFileDesc) malloc((size_t)  (sizeof(MapiFileDesc) * </span>
<a href="#l14.1236"></a><span id="l14.1236" class="difflineminus">-                                                    rMailPtr-&gt;MSG_nFileCount) );</span>
<a href="#l14.1237"></a><span id="l14.1237" class="difflineminus">-    if (!msgPtr-&gt;lpFiles)</span>
<a href="#l14.1238"></a><span id="l14.1238" class="difflineminus">-    {</span>
<a href="#l14.1239"></a><span id="l14.1239" class="difflineminus">-      // Cleanup the shared memory...</span>
<a href="#l14.1240"></a><span id="l14.1240" class="difflineminus">-      NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1241"></a><span id="l14.1241" class="difflineminus">-</span>
<a href="#l14.1242"></a><span id="l14.1242" class="difflineminus">-      FreeMAPIMessage(msgPtr);</span>
<a href="#l14.1243"></a><span id="l14.1243" class="difflineminus">-      NSStrSeqDelete(blobSequence);</span>
<a href="#l14.1244"></a><span id="l14.1244" class="difflineminus">-      LogString(&quot;--MAPIReadMail failed\r\n&quot;);</span>
<a href="#l14.1245"></a><span id="l14.1245" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1246"></a><span id="l14.1246" class="difflineminus">-    }</span>
<a href="#l14.1247"></a><span id="l14.1247" class="difflineminus">-</span>
<a href="#l14.1248"></a><span id="l14.1248" class="difflineminus">-    memset(msgPtr-&gt;lpFiles, 0, (size_t) (sizeof(MapiFileDesc) * rMailPtr-&gt;MSG_nFileCount));</span>
<a href="#l14.1249"></a><span id="l14.1249" class="difflineminus">-  }</span>
<a href="#l14.1250"></a><span id="l14.1250" class="difflineminus">-</span>
<a href="#l14.1251"></a><span id="l14.1251" class="difflineminus">-  UCHAR   fNameBody[_MAX_PATH];</span>
<a href="#l14.1252"></a><span id="l14.1252" class="difflineminus">-</span>
<a href="#l14.1253"></a><span id="l14.1253" class="difflineminus">-  // Now do body and attachment stuff only if we haven't been told</span>
<a href="#l14.1254"></a><span id="l14.1254" class="difflineminus">-  // not to do it by the user.</span>
<a href="#l14.1255"></a><span id="l14.1255" class="difflineminus">-  if (!(flFlags &amp; MAPI_ENVELOPE_ONLY))</span>
<a href="#l14.1256"></a><span id="l14.1256" class="difflineminus">-  {</span>
<a href="#l14.1257"></a><span id="l14.1257" class="difflineminus">-    if (flFlags &amp; MAPI_BODY_AS_FILE)</span>
<a href="#l14.1258"></a><span id="l14.1258" class="difflineminus">-    {</span>
<a href="#l14.1259"></a><span id="l14.1259" class="difflineminus">-      LPSTR tempNoteText = CheckNullString(noteText);</span>
<a href="#l14.1260"></a><span id="l14.1260" class="difflineminus">-      </span>
<a href="#l14.1261"></a><span id="l14.1261" class="difflineminus">-      if (GetTempAttachmentName((LPSTR) fNameBody) != 0)</span>
<a href="#l14.1262"></a><span id="l14.1262" class="difflineminus">-      {</span>
<a href="#l14.1263"></a><span id="l14.1263" class="difflineminus">-        // Cleanup the shared memory...</span>
<a href="#l14.1264"></a><span id="l14.1264" class="difflineminus">-        NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1265"></a><span id="l14.1265" class="difflineminus">-        </span>
<a href="#l14.1266"></a><span id="l14.1266" class="difflineminus">-        FreeMAPIMessage(msgPtr);</span>
<a href="#l14.1267"></a><span id="l14.1267" class="difflineminus">-        NSStrSeqDelete(blobSequence);</span>
<a href="#l14.1268"></a><span id="l14.1268" class="difflineminus">-        LogString(&quot;--MAPIReadMail failed\r\n&quot;);</span>
<a href="#l14.1269"></a><span id="l14.1269" class="difflineminus">-        return(MAPI_E_ATTACHMENT_WRITE_FAILURE);</span>
<a href="#l14.1270"></a><span id="l14.1270" class="difflineminus">-      }</span>
<a href="#l14.1271"></a><span id="l14.1271" class="difflineminus">-      </span>
<a href="#l14.1272"></a><span id="l14.1272" class="difflineminus">-      if (WriteMemoryBufferToDisk((LPSTR) fNameBody, </span>
<a href="#l14.1273"></a><span id="l14.1273" class="difflineminus">-        (strlen(tempNoteText) + 1), tempNoteText) != 0)</span>
<a href="#l14.1274"></a><span id="l14.1274" class="difflineminus">-      {</span>
<a href="#l14.1275"></a><span id="l14.1275" class="difflineminus">-        // Cleanup the shared memory...</span>
<a href="#l14.1276"></a><span id="l14.1276" class="difflineminus">-        NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1277"></a><span id="l14.1277" class="difflineminus">-        </span>
<a href="#l14.1278"></a><span id="l14.1278" class="difflineminus">-        FreeMAPIMessage(msgPtr);</span>
<a href="#l14.1279"></a><span id="l14.1279" class="difflineminus">-        NSStrSeqDelete(blobSequence);</span>
<a href="#l14.1280"></a><span id="l14.1280" class="difflineminus">-        LogString(&quot;--MAPIReadMail failed\r\n&quot;);</span>
<a href="#l14.1281"></a><span id="l14.1281" class="difflineminus">-        return(MAPI_E_ATTACHMENT_WRITE_FAILURE);</span>
<a href="#l14.1282"></a><span id="l14.1282" class="difflineminus">-      }</span>
<a href="#l14.1283"></a><span id="l14.1283" class="difflineminus">-    }</span>
<a href="#l14.1284"></a><span id="l14.1284" class="difflineminus">-    else</span>
<a href="#l14.1285"></a><span id="l14.1285" class="difflineminus">-    {</span>
<a href="#l14.1286"></a><span id="l14.1286" class="difflineminus">-      msgPtr-&gt;lpszNoteText = strdup(noteText);</span>
<a href="#l14.1287"></a><span id="l14.1287" class="difflineminus">-    }</span>
<a href="#l14.1288"></a><span id="l14.1288" class="difflineminus">-    </span>
<a href="#l14.1289"></a><span id="l14.1289" class="difflineminus">-    msgPtr-&gt;nFileCount = rMailPtr-&gt;MSG_nFileCount;</span>
<a href="#l14.1290"></a><span id="l14.1290" class="difflineminus">-    for (i=0; i&lt;msgPtr-&gt;nFileCount; i++)</span>
<a href="#l14.1291"></a><span id="l14.1291" class="difflineminus">-    {</span>
<a href="#l14.1292"></a><span id="l14.1292" class="difflineminus">-      //</span>
<a href="#l14.1293"></a><span id="l14.1293" class="difflineminus">-      // MAPI_BODY_AS_FILE </span>
<a href="#l14.1294"></a><span id="l14.1294" class="difflineminus">-      // Indicates MAPIReadMail should write the message text to a temporary file </span>
<a href="#l14.1295"></a><span id="l14.1295" class="difflineminus">-      // and add it as the first attachment in the attachment list. </span>
<a href="#l14.1296"></a><span id="l14.1296" class="difflineminus">-      if ( (i == 0) &amp;&amp; (flFlags &amp; MAPI_BODY_AS_FILE))</span>
<a href="#l14.1297"></a><span id="l14.1297" class="difflineminus">-      {</span>
<a href="#l14.1298"></a><span id="l14.1298" class="difflineminus">-        msgPtr-&gt;lpFiles[i].lpszPathName = strdup((LPSTR)fNameBody);</span>
<a href="#l14.1299"></a><span id="l14.1299" class="difflineminus">-        msgPtr-&gt;lpFiles[i].lpszFileName = strdup((LPSTR)fNameBody);</span>
<a href="#l14.1300"></a><span id="l14.1300" class="difflineminus">-        continue;</span>
<a href="#l14.1301"></a><span id="l14.1301" class="difflineminus">-      }</span>
<a href="#l14.1302"></a><span id="l14.1302" class="difflineminus">-      </span>
<a href="#l14.1303"></a><span id="l14.1303" class="difflineminus">-      msgPtr-&gt;lpFiles[i].lpszPathName = </span>
<a href="#l14.1304"></a><span id="l14.1304" class="difflineminus">-        strdup( CheckNullString(NSStrSeqGet(blobSequence, stringCount++)) );</span>
<a href="#l14.1305"></a><span id="l14.1305" class="difflineminus">-      msgPtr-&gt;lpFiles[i].lpszFileName =</span>
<a href="#l14.1306"></a><span id="l14.1306" class="difflineminus">-        strdup( CheckNullString(NSStrSeqGet(blobSequence, stringCount++)) );</span>
<a href="#l14.1307"></a><span id="l14.1307" class="difflineminus">-    }</span>
<a href="#l14.1308"></a><span id="l14.1308" class="difflineminus">-  }</span>
<a href="#l14.1309"></a><span id="l14.1309" class="difflineminus">-</span>
<a href="#l14.1310"></a><span id="l14.1310" class="difflineminus">-  //</span>
<a href="#l14.1311"></a><span id="l14.1311" class="difflineminus">-  // RICHIE - For now, let's do a little cleanup on the message itself</span>
<a href="#l14.1312"></a><span id="l14.1312" class="difflineminus">-  // and strip the following inline tags:</span>
<a href="#l14.1313"></a><span id="l14.1313" class="difflineminus">-  //</span>
<a href="#l14.1314"></a><span id="l14.1314" class="difflineminus">-  // &amp;nbsp; &amp;lt; </span>
<a href="#l14.1315"></a><span id="l14.1315" class="difflineminus">-  //</span>
<a href="#l14.1316"></a><span id="l14.1316" class="difflineminus">-  msgPtr-&gt;lpszNoteText = StripHTML(msgPtr-&gt;lpszNoteText);</span>
<a href="#l14.1317"></a><span id="l14.1317" class="difflineminus">-</span>
<a href="#l14.1318"></a><span id="l14.1318" class="difflineminus">-  //</span>
<a href="#l14.1319"></a><span id="l14.1319" class="difflineminus">-  // Now that we are here, set the pointer array and move on with life...</span>
<a href="#l14.1320"></a><span id="l14.1320" class="difflineminus">-  //</span>
<a href="#l14.1321"></a><span id="l14.1321" class="difflineminus">-  *lppMessage = msgPtr;</span>
<a href="#l14.1322"></a><span id="l14.1322" class="difflineminus">-  SetPointerArray(msgPtr, MAPI_MESSAGE_TYPE);</span>
<a href="#l14.1323"></a><span id="l14.1323" class="difflineminus">-</span>
<a href="#l14.1324"></a><span id="l14.1324" class="difflineminus">-  // Cleanup the shared memory...</span>
<a href="#l14.1325"></a><span id="l14.1325" class="difflineminus">-  NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1326"></a><span id="l14.1326" class="difflineminus">-  if (blobSequence)</span>
<a href="#l14.1327"></a><span id="l14.1327" class="difflineminus">-    NSStrSeqDelete(blobSequence);</span>
<a href="#l14.1328"></a><span id="l14.1328" class="difflineminus">-</span>
<a href="#l14.1329"></a><span id="l14.1329" class="difflineminus">-  //</span>
<a href="#l14.1330"></a><span id="l14.1330" class="difflineminus">-  // Now, get out...</span>
<a href="#l14.1331"></a><span id="l14.1331" class="difflineminus">-  //</span>
<a href="#l14.1332"></a><span id="l14.1332" class="difflineminus">-	LogString(&quot;--MAPIReadMail complete\r\n&quot;);</span>
<a href="#l14.1333"></a><span id="l14.1333" class="difflineminus">-	return(result);</span>
<a href="#l14.1334"></a><span id="l14.1334" class="difflineminus">-}</span>
<a href="#l14.1335"></a><span id="l14.1335" class="difflineminus">-</span>
<a href="#l14.1336"></a><span id="l14.1336" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.1337"></a><span id="l14.1337" class="difflineminus">-MAPISaveMail(</span>
<a href="#l14.1338"></a><span id="l14.1338" class="difflineminus">-    LHANDLE lhSession,</span>
<a href="#l14.1339"></a><span id="l14.1339" class="difflineminus">-    ULONG ulUIParam,</span>
<a href="#l14.1340"></a><span id="l14.1340" class="difflineminus">-    lpMapiMessage lpMessage,</span>
<a href="#l14.1341"></a><span id="l14.1341" class="difflineminus">-    FLAGS flFlags,</span>
<a href="#l14.1342"></a><span id="l14.1342" class="difflineminus">-    ULONG ulReserved,</span>
<a href="#l14.1343"></a><span id="l14.1343" class="difflineminus">-    LPSTR lpszMessageID</span>
<a href="#l14.1344"></a><span id="l14.1344" class="difflineminus">-)</span>
<a href="#l14.1345"></a><span id="l14.1345" class="difflineminus">-{</span>
<a href="#l14.1346"></a><span id="l14.1346" class="difflineminus">-#ifdef _DEBUG</span>
<a href="#l14.1347"></a><span id="l14.1347" class="difflineminus">-	TRACE_FN(&quot;MapiSaveMail&quot;);</span>
<a href="#l14.1348"></a><span id="l14.1348" class="difflineminus">-	TRACE(&quot;  lhSession=%lu\n&quot;, lhSession);</span>
<a href="#l14.1349"></a><span id="l14.1349" class="difflineminus">-	if (lpMessage)</span>
<a href="#l14.1350"></a><span id="l14.1350" class="difflineminus">-	{</span>
<a href="#l14.1351"></a><span id="l14.1351" class="difflineminus">-		TRACE(&quot;  lpMessage-&gt;lpszSubject = '%s'\n  lpMessage-&gt;lpszNoteText='%s'\n&quot;, lpMessage-&gt;lpszSubject, lpMessage-&gt;lpszNoteText);</span>
<a href="#l14.1352"></a><span id="l14.1352" class="difflineminus">-		TRACE(&quot;  lpMessage-&gt;nRecipCount = %lu\n  lpMessage-&gt;nFileCount=%lu\n&quot;, lpMessage-&gt;nRecipCount, lpMessage-&gt;nFileCount);</span>
<a href="#l14.1353"></a><span id="l14.1353" class="difflineminus">-		lpMapiFileDesc pFiles = lpMessage-&gt;lpFiles;</span>
<a href="#l14.1354"></a><span id="l14.1354" class="difflineminus">-		for (ULONG i = 0; i &lt; lpMessage-&gt;nFileCount; i++)</span>
<a href="#l14.1355"></a><span id="l14.1355" class="difflineminus">-		{</span>
<a href="#l14.1356"></a><span id="l14.1356" class="difflineminus">-			TRACE(&quot;    lpszPathName='%s', lpszFileName='%s'\n&quot;, pFiles[i].lpszPathName, pFiles[i].lpszFileName);</span>
<a href="#l14.1357"></a><span id="l14.1357" class="difflineminus">-		}</span>
<a href="#l14.1358"></a><span id="l14.1358" class="difflineminus">-	}</span>
<a href="#l14.1359"></a><span id="l14.1359" class="difflineminus">-#endif</span>
<a href="#l14.1360"></a><span id="l14.1360" class="difflineminus">-</span>
<a href="#l14.1361"></a><span id="l14.1361" class="difflineminus">-  CleanupMAPITempFiles();</span>
<a href="#l14.1362"></a><span id="l14.1362" class="difflineminus">-</span>
<a href="#l14.1363"></a><span id="l14.1363" class="difflineminus">-  //</span>
<a href="#l14.1364"></a><span id="l14.1364" class="difflineminus">-  // Needed variables...</span>
<a href="#l14.1365"></a><span id="l14.1365" class="difflineminus">-  //</span>
<a href="#l14.1366"></a><span id="l14.1366" class="difflineminus">-  BOOL          isTempSession = FALSE;</span>
<a href="#l14.1367"></a><span id="l14.1367" class="difflineminus">-  LONG          result = SUCCESS_SUCCESS;</span>
<a href="#l14.1368"></a><span id="l14.1368" class="difflineminus">-  HWND          hWndIPC;</span>
<a href="#l14.1369"></a><span id="l14.1369" class="difflineminus">-  MAPIIPCType   ipcInfo;</span>
<a href="#l14.1370"></a><span id="l14.1370" class="difflineminus">-</span>
<a href="#l14.1371"></a><span id="l14.1371" class="difflineminus">-	if (!lpMessage)</span>
<a href="#l14.1372"></a><span id="l14.1372" class="difflineminus">-	{</span>
<a href="#l14.1373"></a><span id="l14.1373" class="difflineminus">-		return(MAPI_E_FAILURE);</span>
<a href="#l14.1374"></a><span id="l14.1374" class="difflineminus">-	}</span>
<a href="#l14.1375"></a><span id="l14.1375" class="difflineminus">-</span>
<a href="#l14.1376"></a><span id="l14.1376" class="difflineminus">-  //</span>
<a href="#l14.1377"></a><span id="l14.1377" class="difflineminus">-  // Sanity Check the attachments if any here...</span>
<a href="#l14.1378"></a><span id="l14.1378" class="difflineminus">-  //</span>
<a href="#l14.1379"></a><span id="l14.1379" class="difflineminus">-  if (lpMessage-&gt;nFileCount &gt; 0)</span>
<a href="#l14.1380"></a><span id="l14.1380" class="difflineminus">-  {</span>
<a href="#l14.1381"></a><span id="l14.1381" class="difflineminus">-    DWORD rc = SanityCheckAttachmentFiles(lpMessage);  // return of zero is ok</span>
<a href="#l14.1382"></a><span id="l14.1382" class="difflineminus">-    if (rc == 1)</span>
<a href="#l14.1383"></a><span id="l14.1383" class="difflineminus">-    {</span>
<a href="#l14.1384"></a><span id="l14.1384" class="difflineminus">-      return(MAPI_E_ATTACHMENT_NOT_FOUND);</span>
<a href="#l14.1385"></a><span id="l14.1385" class="difflineminus">-    }</span>
<a href="#l14.1386"></a><span id="l14.1386" class="difflineminus">-    else if (rc == 2)</span>
<a href="#l14.1387"></a><span id="l14.1387" class="difflineminus">-    {</span>
<a href="#l14.1388"></a><span id="l14.1388" class="difflineminus">-      return(MAPI_E_ATTACHMENT_OPEN_FAILURE);</span>
<a href="#l14.1389"></a><span id="l14.1389" class="difflineminus">-    }</span>
<a href="#l14.1390"></a><span id="l14.1390" class="difflineminus">-  }</span>
<a href="#l14.1391"></a><span id="l14.1391" class="difflineminus">-</span>
<a href="#l14.1392"></a><span id="l14.1392" class="difflineminus">-  //</span>
<a href="#l14.1393"></a><span id="l14.1393" class="difflineminus">-  // If lhSession is ZERO, then we have to get a temporary session and</span>
<a href="#l14.1394"></a><span id="l14.1394" class="difflineminus">-  // go from there.</span>
<a href="#l14.1395"></a><span id="l14.1395" class="difflineminus">-  //</span>
<a href="#l14.1396"></a><span id="l14.1396" class="difflineminus">-  if ( (lhSession == 0) || (flFlags &amp; MAPI_NEW_SESSION))</span>
<a href="#l14.1397"></a><span id="l14.1397" class="difflineminus">-  {</span>
<a href="#l14.1398"></a><span id="l14.1398" class="difflineminus">-    LHANDLE    lhTempSession;</span>
<a href="#l14.1399"></a><span id="l14.1399" class="difflineminus">-    if (MAPILogon(0, NULL, NULL, 0, 0, &amp;lhTempSession) != SUCCESS_SUCCESS)</span>
<a href="#l14.1400"></a><span id="l14.1400" class="difflineminus">-    {</span>
<a href="#l14.1401"></a><span id="l14.1401" class="difflineminus">-      isTempSession = TRUE;</span>
<a href="#l14.1402"></a><span id="l14.1402" class="difflineminus">-      if (MAPILogon(0, &quot;dummy&quot;, &quot;dummy&quot;, 0, 0, &amp;lhTempSession) != SUCCESS_SUCCESS)</span>
<a href="#l14.1403"></a><span id="l14.1403" class="difflineminus">-      {</span>
<a href="#l14.1404"></a><span id="l14.1404" class="difflineminus">-        return(MAPI_E_LOGIN_FAILURE);</span>
<a href="#l14.1405"></a><span id="l14.1405" class="difflineminus">-      }</span>
<a href="#l14.1406"></a><span id="l14.1406" class="difflineminus">-    }</span>
<a href="#l14.1407"></a><span id="l14.1407" class="difflineminus">-</span>
<a href="#l14.1408"></a><span id="l14.1408" class="difflineminus">-    lhSession = lhTempSession;</span>
<a href="#l14.1409"></a><span id="l14.1409" class="difflineminus">-  }</span>
<a href="#l14.1410"></a><span id="l14.1410" class="difflineminus">-</span>
<a href="#l14.1411"></a><span id="l14.1411" class="difflineminus">-  //</span>
<a href="#l14.1412"></a><span id="l14.1412" class="difflineminus">-  // Now create the big chunk of memory that we will pass across which</span>
<a href="#l14.1413"></a><span id="l14.1413" class="difflineminus">-  // represents the message</span>
<a href="#l14.1414"></a><span id="l14.1414" class="difflineminus">-  //</span>
<a href="#l14.1415"></a><span id="l14.1415" class="difflineminus">-  DWORD               totalSize;</span>
<a href="#l14.1416"></a><span id="l14.1416" class="difflineminus">-  MAPISendMailType    *memToPass = NULL;</span>
<a href="#l14.1417"></a><span id="l14.1417" class="difflineminus">-</span>
<a href="#l14.1418"></a><span id="l14.1418" class="difflineminus">-  memToPass = (MAPISendMailType *) FlattenMAPIMessageStructure(lpMessage, &amp;totalSize);</span>
<a href="#l14.1419"></a><span id="l14.1419" class="difflineminus">-  if (!memToPass)</span>
<a href="#l14.1420"></a><span id="l14.1420" class="difflineminus">-  {</span>
<a href="#l14.1421"></a><span id="l14.1421" class="difflineminus">-      if (isTempSession)</span>
<a href="#l14.1422"></a><span id="l14.1422" class="difflineminus">-      {</span>
<a href="#l14.1423"></a><span id="l14.1423" class="difflineminus">-        MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.1424"></a><span id="l14.1424" class="difflineminus">-      }</span>
<a href="#l14.1425"></a><span id="l14.1425" class="difflineminus">-      </span>
<a href="#l14.1426"></a><span id="l14.1426" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1427"></a><span id="l14.1427" class="difflineminus">-  }</span>
<a href="#l14.1428"></a><span id="l14.1428" class="difflineminus">-</span>
<a href="#l14.1429"></a><span id="l14.1429" class="difflineminus">-  memToPass-&gt;lhSession = lhSession;</span>
<a href="#l14.1430"></a><span id="l14.1430" class="difflineminus">-  memToPass-&gt;ulUIParam = ulUIParam;</span>
<a href="#l14.1431"></a><span id="l14.1431" class="difflineminus">-  memToPass-&gt;flFlags = flFlags;</span>
<a href="#l14.1432"></a><span id="l14.1432" class="difflineminus">-  memToPass-&gt;ipcWorked = 0;</span>
<a href="#l14.1433"></a><span id="l14.1433" class="difflineminus">-</span>
<a href="#l14.1434"></a><span id="l14.1434" class="difflineminus">-  //</span>
<a href="#l14.1435"></a><span id="l14.1435" class="difflineminus">-  // This call locates a Communicator Window, if one is not running,</span>
<a href="#l14.1436"></a><span id="l14.1436" class="difflineminus">-  // it will start up an instance of Communicator and grab that window.</span>
<a href="#l14.1437"></a><span id="l14.1437" class="difflineminus">-  //</span>
<a href="#l14.1438"></a><span id="l14.1438" class="difflineminus">-  hWndIPC = GetCommunicatorIPCWindow();</span>
<a href="#l14.1439"></a><span id="l14.1439" class="difflineminus">-  if (NULL == hWndIPC)</span>
<a href="#l14.1440"></a><span id="l14.1440" class="difflineminus">-  {</span>
<a href="#l14.1441"></a><span id="l14.1441" class="difflineminus">-    free(memToPass);</span>
<a href="#l14.1442"></a><span id="l14.1442" class="difflineminus">-    if (isTempSession)</span>
<a href="#l14.1443"></a><span id="l14.1443" class="difflineminus">-    {</span>
<a href="#l14.1444"></a><span id="l14.1444" class="difflineminus">-      MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.1445"></a><span id="l14.1445" class="difflineminus">-    }</span>
<a href="#l14.1446"></a><span id="l14.1446" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.1447"></a><span id="l14.1447" class="difflineminus">-  }</span>
<a href="#l14.1448"></a><span id="l14.1448" class="difflineminus">-</span>
<a href="#l14.1449"></a><span id="l14.1449" class="difflineminus">-  // </span>
<a href="#l14.1450"></a><span id="l14.1450" class="difflineminus">-  // Build the IPC structure of information that needs to be provided</span>
<a href="#l14.1451"></a><span id="l14.1451" class="difflineminus">-  // to get information into Communicator</span>
<a href="#l14.1452"></a><span id="l14.1452" class="difflineminus">-  //</span>
<a href="#l14.1453"></a><span id="l14.1453" class="difflineminus">-  BuildMemName((LPSTR)ipcInfo.smemName, ulUIParam);</span>
<a href="#l14.1454"></a><span id="l14.1454" class="difflineminus">-</span>
<a href="#l14.1455"></a><span id="l14.1455" class="difflineminus">-  //</span>
<a href="#l14.1456"></a><span id="l14.1456" class="difflineminus">-  // Build the shared memory segment of information to pass into </span>
<a href="#l14.1457"></a><span id="l14.1457" class="difflineminus">-  // Communicator for send message call.</span>
<a href="#l14.1458"></a><span id="l14.1458" class="difflineminus">-  //</span>
<a href="#l14.1459"></a><span id="l14.1459" class="difflineminus">-  CSharedMem      *sMem;</span>
<a href="#l14.1460"></a><span id="l14.1460" class="difflineminus">-  HANDLE          hSharedMemory;</span>
<a href="#l14.1461"></a><span id="l14.1461" class="difflineminus">-</span>
<a href="#l14.1462"></a><span id="l14.1462" class="difflineminus">-  //</span>
<a href="#l14.1463"></a><span id="l14.1463" class="difflineminus">-  // Create the shared memory...</span>
<a href="#l14.1464"></a><span id="l14.1464" class="difflineminus">-  //</span>
<a href="#l14.1465"></a><span id="l14.1465" class="difflineminus">-  sMem = NSCreateSharedMemory(totalSize, (LPSTR) ipcInfo.smemName, &amp;hSharedMemory);</span>
<a href="#l14.1466"></a><span id="l14.1466" class="difflineminus">-  if (!sMem)</span>
<a href="#l14.1467"></a><span id="l14.1467" class="difflineminus">-  {</span>
<a href="#l14.1468"></a><span id="l14.1468" class="difflineminus">-      free(memToPass);</span>
<a href="#l14.1469"></a><span id="l14.1469" class="difflineminus">-      if (isTempSession)</span>
<a href="#l14.1470"></a><span id="l14.1470" class="difflineminus">-      {</span>
<a href="#l14.1471"></a><span id="l14.1471" class="difflineminus">-        MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.1472"></a><span id="l14.1472" class="difflineminus">-      }</span>
<a href="#l14.1473"></a><span id="l14.1473" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1474"></a><span id="l14.1474" class="difflineminus">-  }</span>
<a href="#l14.1475"></a><span id="l14.1475" class="difflineminus">-</span>
<a href="#l14.1476"></a><span id="l14.1476" class="difflineminus">-  //</span>
<a href="#l14.1477"></a><span id="l14.1477" class="difflineminus">-  // Now copy the information into the memory segment.</span>
<a href="#l14.1478"></a><span id="l14.1478" class="difflineminus">-  //</span>
<a href="#l14.1479"></a><span id="l14.1479" class="difflineminus">-  sMem-&gt;m_dwSize = totalSize;</span>
<a href="#l14.1480"></a><span id="l14.1480" class="difflineminus">-  memcpy(sMem-&gt;m_buf, memToPass, (size_t) totalSize);</span>
<a href="#l14.1481"></a><span id="l14.1481" class="difflineminus">-</span>
<a href="#l14.1482"></a><span id="l14.1482" class="difflineminus">-  //</span>
<a href="#l14.1483"></a><span id="l14.1483" class="difflineminus">-  // Now set the size of the shared memory segment for the </span>
<a href="#l14.1484"></a><span id="l14.1484" class="difflineminus">-  // WM_COPYDATA argument that will be sent across.</span>
<a href="#l14.1485"></a><span id="l14.1485" class="difflineminus">-  //</span>
<a href="#l14.1486"></a><span id="l14.1486" class="difflineminus">-  ipcInfo.smemSize = totalSize;</span>
<a href="#l14.1487"></a><span id="l14.1487" class="difflineminus">-</span>
<a href="#l14.1488"></a><span id="l14.1488" class="difflineminus">-  // For Win16, we actually pass in the pointer to the structure,</span>
<a href="#l14.1489"></a><span id="l14.1489" class="difflineminus">-  // so just assign the variable here.</span>
<a href="#l14.1490"></a><span id="l14.1490" class="difflineminus">-#ifdef WIN16</span>
<a href="#l14.1491"></a><span id="l14.1491" class="difflineminus">-  ipcInfo.lpsmem = sMem;</span>
<a href="#l14.1492"></a><span id="l14.1492" class="difflineminus">-#else</span>
<a href="#l14.1493"></a><span id="l14.1493" class="difflineminus">-  ipcInfo.lpsmem = NULL;</span>
<a href="#l14.1494"></a><span id="l14.1494" class="difflineminus">-#endif</span>
<a href="#l14.1495"></a><span id="l14.1495" class="difflineminus">-</span>
<a href="#l14.1496"></a><span id="l14.1496" class="difflineminus">-  //</span>
<a href="#l14.1497"></a><span id="l14.1497" class="difflineminus">-  // Ok, time to do the SendMessage() to Communicator...</span>
<a href="#l14.1498"></a><span id="l14.1498" class="difflineminus">-  //</span>
<a href="#l14.1499"></a><span id="l14.1499" class="difflineminus">-  result = SendMAPIRequest(hWndIPC, NSCP_MAPISaveMail, &amp;ipcInfo);</span>
<a href="#l14.1500"></a><span id="l14.1500" class="difflineminus">-</span>
<a href="#l14.1501"></a><span id="l14.1501" class="difflineminus">-  // Check for IPC completion</span>
<a href="#l14.1502"></a><span id="l14.1502" class="difflineminus">-  MAPISendMailType *ptr = (MAPISendMailType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.1503"></a><span id="l14.1503" class="difflineminus">-  if (!ptr-&gt;ipcWorked)</span>
<a href="#l14.1504"></a><span id="l14.1504" class="difflineminus">-  {</span>
<a href="#l14.1505"></a><span id="l14.1505" class="difflineminus">-    result = MAPI_E_FAILURE;</span>
<a href="#l14.1506"></a><span id="l14.1506" class="difflineminus">-  }</span>
<a href="#l14.1507"></a><span id="l14.1507" class="difflineminus">-</span>
<a href="#l14.1508"></a><span id="l14.1508" class="difflineminus">-  //</span>
<a href="#l14.1509"></a><span id="l14.1509" class="difflineminus">-  // Now time to do some cleanup...</span>
<a href="#l14.1510"></a><span id="l14.1510" class="difflineminus">-  //</span>
<a href="#l14.1511"></a><span id="l14.1511" class="difflineminus">-  NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1512"></a><span id="l14.1512" class="difflineminus">-  free(memToPass);</span>
<a href="#l14.1513"></a><span id="l14.1513" class="difflineminus">-</span>
<a href="#l14.1514"></a><span id="l14.1514" class="difflineminus">-	LogString(&quot;--MAPISaveMail complete\r\n&quot;);</span>
<a href="#l14.1515"></a><span id="l14.1515" class="difflineminus">-</span>
<a href="#l14.1516"></a><span id="l14.1516" class="difflineminus">-  //</span>
<a href="#l14.1517"></a><span id="l14.1517" class="difflineminus">-  // If we created a temp session, then we need to trash it...</span>
<a href="#l14.1518"></a><span id="l14.1518" class="difflineminus">-  //</span>
<a href="#l14.1519"></a><span id="l14.1519" class="difflineminus">-  if (isTempSession)</span>
<a href="#l14.1520"></a><span id="l14.1520" class="difflineminus">-  {</span>
<a href="#l14.1521"></a><span id="l14.1521" class="difflineminus">-    MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.1522"></a><span id="l14.1522" class="difflineminus">-  }</span>
<a href="#l14.1523"></a><span id="l14.1523" class="difflineminus">-</span>
<a href="#l14.1524"></a><span id="l14.1524" class="difflineminus">-  return(result);</span>
<a href="#l14.1525"></a><span id="l14.1525" class="difflineminus">-}</span>
<a href="#l14.1526"></a><span id="l14.1526" class="difflineminus">-</span>
<a href="#l14.1527"></a><span id="l14.1527" class="difflineminus">-//</span>
<a href="#l14.1528"></a><span id="l14.1528" class="difflineminus">-// The MAPIDeleteMail function deletes a message. </span>
<a href="#l14.1529"></a><span id="l14.1529" class="difflineminus">-//</span>
<a href="#l14.1530"></a><span id="l14.1530" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.1531"></a><span id="l14.1531" class="difflineminus">-MAPIDeleteMail(</span>
<a href="#l14.1532"></a><span id="l14.1532" class="difflineminus">-    LHANDLE lhSession,</span>
<a href="#l14.1533"></a><span id="l14.1533" class="difflineminus">-    ULONG ulUIParam,</span>
<a href="#l14.1534"></a><span id="l14.1534" class="difflineminus">-    LPSTR lpszMessageID,</span>
<a href="#l14.1535"></a><span id="l14.1535" class="difflineminus">-    FLAGS flFlags,</span>
<a href="#l14.1536"></a><span id="l14.1536" class="difflineminus">-    ULONG ulReserved)</span>
<a href="#l14.1537"></a><span id="l14.1537" class="difflineminus">-{</span>
<a href="#l14.1538"></a><span id="l14.1538" class="difflineminus">-LRESULT       result;</span>
<a href="#l14.1539"></a><span id="l14.1539" class="difflineminus">-HWND          hWndIPC;</span>
<a href="#l14.1540"></a><span id="l14.1540" class="difflineminus">-MAPIIPCType   ipcInfo;</span>
<a href="#l14.1541"></a><span id="l14.1541" class="difflineminus">-</span>
<a href="#l14.1542"></a><span id="l14.1542" class="difflineminus">-	TRACE_FN(&quot;MAPIDeleteMail&quot;);</span>
<a href="#l14.1543"></a><span id="l14.1543" class="difflineminus">-  if (lhSession == 0)</span>
<a href="#l14.1544"></a><span id="l14.1544" class="difflineminus">-  {</span>
<a href="#l14.1545"></a><span id="l14.1545" class="difflineminus">-    return(MAPI_E_INVALID_SESSION);</span>
<a href="#l14.1546"></a><span id="l14.1546" class="difflineminus">-  }</span>
<a href="#l14.1547"></a><span id="l14.1547" class="difflineminus">-</span>
<a href="#l14.1548"></a><span id="l14.1548" class="difflineminus">-  // Make sure we have something valid on the message ID front!</span>
<a href="#l14.1549"></a><span id="l14.1549" class="difflineminus">-  if ((!lpszMessageID) || (!*lpszMessageID))</span>
<a href="#l14.1550"></a><span id="l14.1550" class="difflineminus">-  {</span>
<a href="#l14.1551"></a><span id="l14.1551" class="difflineminus">-    return(MAPI_E_INVALID_MESSAGE);</span>
<a href="#l14.1552"></a><span id="l14.1552" class="difflineminus">-  }</span>
<a href="#l14.1553"></a><span id="l14.1553" class="difflineminus">-</span>
<a href="#l14.1554"></a><span id="l14.1554" class="difflineminus">-  if (strlen(lpszMessageID) &gt; 511)</span>
<a href="#l14.1555"></a><span id="l14.1555" class="difflineminus">-  {</span>
<a href="#l14.1556"></a><span id="l14.1556" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1557"></a><span id="l14.1557" class="difflineminus">-  }</span>
<a href="#l14.1558"></a><span id="l14.1558" class="difflineminus">-</span>
<a href="#l14.1559"></a><span id="l14.1559" class="difflineminus">-	TRACE(&quot;MAPIDeleteMail lhSession Session ID = %lu\n&quot;, lhSession);</span>
<a href="#l14.1560"></a><span id="l14.1560" class="difflineminus">-</span>
<a href="#l14.1561"></a><span id="l14.1561" class="difflineminus">-  //</span>
<a href="#l14.1562"></a><span id="l14.1562" class="difflineminus">-  // This call locates a Communicator Window, if one is not running,</span>
<a href="#l14.1563"></a><span id="l14.1563" class="difflineminus">-  // it will start up an instance of Communicator and grab that window.</span>
<a href="#l14.1564"></a><span id="l14.1564" class="difflineminus">-  //</span>
<a href="#l14.1565"></a><span id="l14.1565" class="difflineminus">-  hWndIPC = GetCommunicatorIPCWindow();</span>
<a href="#l14.1566"></a><span id="l14.1566" class="difflineminus">-  if (NULL == hWndIPC)</span>
<a href="#l14.1567"></a><span id="l14.1567" class="difflineminus">-  {</span>
<a href="#l14.1568"></a><span id="l14.1568" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.1569"></a><span id="l14.1569" class="difflineminus">-  }</span>
<a href="#l14.1570"></a><span id="l14.1570" class="difflineminus">-</span>
<a href="#l14.1571"></a><span id="l14.1571" class="difflineminus">-  // </span>
<a href="#l14.1572"></a><span id="l14.1572" class="difflineminus">-  // Build the IPC structure of information that needs to be provided</span>
<a href="#l14.1573"></a><span id="l14.1573" class="difflineminus">-  // to get information into Communicator</span>
<a href="#l14.1574"></a><span id="l14.1574" class="difflineminus">-  //</span>
<a href="#l14.1575"></a><span id="l14.1575" class="difflineminus">-  BuildMemName((LPSTR)ipcInfo.smemName, ulUIParam);</span>
<a href="#l14.1576"></a><span id="l14.1576" class="difflineminus">-</span>
<a href="#l14.1577"></a><span id="l14.1577" class="difflineminus">-  //</span>
<a href="#l14.1578"></a><span id="l14.1578" class="difflineminus">-  // Build the shared memory segment of information to pass into </span>
<a href="#l14.1579"></a><span id="l14.1579" class="difflineminus">-  // Communicator for the login call.</span>
<a href="#l14.1580"></a><span id="l14.1580" class="difflineminus">-  //</span>
<a href="#l14.1581"></a><span id="l14.1581" class="difflineminus">-  CSharedMem          *sMem;</span>
<a href="#l14.1582"></a><span id="l14.1582" class="difflineminus">-  DWORD               memSize;</span>
<a href="#l14.1583"></a><span id="l14.1583" class="difflineminus">-  HANDLE              hSharedMemory;</span>
<a href="#l14.1584"></a><span id="l14.1584" class="difflineminus">-  MAPIDeleteMailType  delInfo;</span>
<a href="#l14.1585"></a><span id="l14.1585" class="difflineminus">-   </span>
<a href="#l14.1586"></a><span id="l14.1586" class="difflineminus">-  memSize = sizeof(MAPIDeleteMailType);</span>
<a href="#l14.1587"></a><span id="l14.1587" class="difflineminus">-  lstrcpy((LPSTR)delInfo.lpszMessageID, lpszMessageID);</span>
<a href="#l14.1588"></a><span id="l14.1588" class="difflineminus">-</span>
<a href="#l14.1589"></a><span id="l14.1589" class="difflineminus">-  //</span>
<a href="#l14.1590"></a><span id="l14.1590" class="difflineminus">-  // Create the shared memory...</span>
<a href="#l14.1591"></a><span id="l14.1591" class="difflineminus">-  //</span>
<a href="#l14.1592"></a><span id="l14.1592" class="difflineminus">-  sMem = NSCreateSharedMemory(memSize, (LPSTR) ipcInfo.smemName, &amp;hSharedMemory);</span>
<a href="#l14.1593"></a><span id="l14.1593" class="difflineminus">-  if (!sMem)</span>
<a href="#l14.1594"></a><span id="l14.1594" class="difflineminus">-  {</span>
<a href="#l14.1595"></a><span id="l14.1595" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1596"></a><span id="l14.1596" class="difflineminus">-  }</span>
<a href="#l14.1597"></a><span id="l14.1597" class="difflineminus">-</span>
<a href="#l14.1598"></a><span id="l14.1598" class="difflineminus">-  //</span>
<a href="#l14.1599"></a><span id="l14.1599" class="difflineminus">-  // Now populate a Logon structure with the passed in information</span>
<a href="#l14.1600"></a><span id="l14.1600" class="difflineminus">-  //</span>
<a href="#l14.1601"></a><span id="l14.1601" class="difflineminus">-  delInfo.lhSession   = lhSession;</span>
<a href="#l14.1602"></a><span id="l14.1602" class="difflineminus">-  delInfo.ulUIParam   = ulUIParam;</span>
<a href="#l14.1603"></a><span id="l14.1603" class="difflineminus">-  delInfo.ipcWorked   = 0;</span>
<a href="#l14.1604"></a><span id="l14.1604" class="difflineminus">-</span>
<a href="#l14.1605"></a><span id="l14.1605" class="difflineminus">-  //</span>
<a href="#l14.1606"></a><span id="l14.1606" class="difflineminus">-  // Now copy the information into the memory segment.</span>
<a href="#l14.1607"></a><span id="l14.1607" class="difflineminus">-  //</span>
<a href="#l14.1608"></a><span id="l14.1608" class="difflineminus">-  sMem-&gt;m_dwSize = memSize;</span>
<a href="#l14.1609"></a><span id="l14.1609" class="difflineminus">-  memcpy(sMem-&gt;m_buf, &amp;(delInfo), sizeof(MAPIDeleteMailType));</span>
<a href="#l14.1610"></a><span id="l14.1610" class="difflineminus">-</span>
<a href="#l14.1611"></a><span id="l14.1611" class="difflineminus">-  //</span>
<a href="#l14.1612"></a><span id="l14.1612" class="difflineminus">-  // Now set the size of the shared memory segment for the </span>
<a href="#l14.1613"></a><span id="l14.1613" class="difflineminus">-  // WM_COPYDATA argument that will be sent across.</span>
<a href="#l14.1614"></a><span id="l14.1614" class="difflineminus">-  //</span>
<a href="#l14.1615"></a><span id="l14.1615" class="difflineminus">-  ipcInfo.smemSize = memSize;</span>
<a href="#l14.1616"></a><span id="l14.1616" class="difflineminus">-</span>
<a href="#l14.1617"></a><span id="l14.1617" class="difflineminus">-  // For Win16, we actually pass in the pointer to the structure,</span>
<a href="#l14.1618"></a><span id="l14.1618" class="difflineminus">-  // so just assign the variable here.</span>
<a href="#l14.1619"></a><span id="l14.1619" class="difflineminus">-#ifdef WIN16</span>
<a href="#l14.1620"></a><span id="l14.1620" class="difflineminus">-  ipcInfo.lpsmem = sMem;</span>
<a href="#l14.1621"></a><span id="l14.1621" class="difflineminus">-#else</span>
<a href="#l14.1622"></a><span id="l14.1622" class="difflineminus">-  ipcInfo.lpsmem = NULL;</span>
<a href="#l14.1623"></a><span id="l14.1623" class="difflineminus">-#endif</span>
<a href="#l14.1624"></a><span id="l14.1624" class="difflineminus">-</span>
<a href="#l14.1625"></a><span id="l14.1625" class="difflineminus">-  //</span>
<a href="#l14.1626"></a><span id="l14.1626" class="difflineminus">-  // Ok, time to do the SendMessage() to Communicator...</span>
<a href="#l14.1627"></a><span id="l14.1627" class="difflineminus">-  //</span>
<a href="#l14.1628"></a><span id="l14.1628" class="difflineminus">-  result = SendMAPIRequest(hWndIPC, NSCP_MAPIDeleteMail, &amp;ipcInfo);</span>
<a href="#l14.1629"></a><span id="l14.1629" class="difflineminus">-</span>
<a href="#l14.1630"></a><span id="l14.1630" class="difflineminus">-  // Check for IPC completion</span>
<a href="#l14.1631"></a><span id="l14.1631" class="difflineminus">-  MAPIDeleteMailType *ptr = (MAPIDeleteMailType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.1632"></a><span id="l14.1632" class="difflineminus">-  if (!ptr-&gt;ipcWorked)</span>
<a href="#l14.1633"></a><span id="l14.1633" class="difflineminus">-  {</span>
<a href="#l14.1634"></a><span id="l14.1634" class="difflineminus">-    result = MAPI_E_FAILURE;</span>
<a href="#l14.1635"></a><span id="l14.1635" class="difflineminus">-  }</span>
<a href="#l14.1636"></a><span id="l14.1636" class="difflineminus">-</span>
<a href="#l14.1637"></a><span id="l14.1637" class="difflineminus">-  //</span>
<a href="#l14.1638"></a><span id="l14.1638" class="difflineminus">-  // Now do cleanup on the way out and return the value to the caller...</span>
<a href="#l14.1639"></a><span id="l14.1639" class="difflineminus">-  //</span>
<a href="#l14.1640"></a><span id="l14.1640" class="difflineminus">-  NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1641"></a><span id="l14.1641" class="difflineminus">-	LogString(&quot;--MAPIDeleteMail complete\r\n&quot;);</span>
<a href="#l14.1642"></a><span id="l14.1642" class="difflineminus">-	return(result);</span>
<a href="#l14.1643"></a><span id="l14.1643" class="difflineminus">-}</span>
<a href="#l14.1644"></a><span id="l14.1644" class="difflineminus">-</span>
<a href="#l14.1645"></a><span id="l14.1645" class="difflineminus">-// RICHIE - MAPI ADDRESS HERE</span>
<a href="#l14.1646"></a><span id="l14.1646" class="difflineminus">-</span>
<a href="#l14.1647"></a><span id="l14.1647" class="difflineminus">-//</span>
<a href="#l14.1648"></a><span id="l14.1648" class="difflineminus">-// The MAPIDetails function displays a dialog box containing the details </span>
<a href="#l14.1649"></a><span id="l14.1649" class="difflineminus">-// of a selected address list entry</span>
<a href="#l14.1650"></a><span id="l14.1650" class="difflineminus">-//</span>
<a href="#l14.1651"></a><span id="l14.1651" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.1652"></a><span id="l14.1652" class="difflineminus">-MAPIDetails(</span>
<a href="#l14.1653"></a><span id="l14.1653" class="difflineminus">-    LHANDLE lhSession,</span>
<a href="#l14.1654"></a><span id="l14.1654" class="difflineminus">-    ULONG ulUIParam,</span>
<a href="#l14.1655"></a><span id="l14.1655" class="difflineminus">-    lpMapiRecipDesc lpRecip,</span>
<a href="#l14.1656"></a><span id="l14.1656" class="difflineminus">-    FLAGS flFlags,</span>
<a href="#l14.1657"></a><span id="l14.1657" class="difflineminus">-    ULONG ulReserved)</span>
<a href="#l14.1658"></a><span id="l14.1658" class="difflineminus">-{</span>
<a href="#l14.1659"></a><span id="l14.1659" class="difflineminus">-	TRACE_FN(&quot;MAPIDetails&quot;);</span>
<a href="#l14.1660"></a><span id="l14.1660" class="difflineminus">-  //</span>
<a href="#l14.1661"></a><span id="l14.1661" class="difflineminus">-  // Needed variables...</span>
<a href="#l14.1662"></a><span id="l14.1662" class="difflineminus">-  //</span>
<a href="#l14.1663"></a><span id="l14.1663" class="difflineminus">-  BOOL          isTempSession = FALSE;</span>
<a href="#l14.1664"></a><span id="l14.1664" class="difflineminus">-  LONG          result = SUCCESS_SUCCESS;</span>
<a href="#l14.1665"></a><span id="l14.1665" class="difflineminus">-  HWND          hWndIPC;</span>
<a href="#l14.1666"></a><span id="l14.1666" class="difflineminus">-  MAPIIPCType   ipcInfo;</span>
<a href="#l14.1667"></a><span id="l14.1667" class="difflineminus">-</span>
<a href="#l14.1668"></a><span id="l14.1668" class="difflineminus">-  // Make sure we have something valid on the query name front!</span>
<a href="#l14.1669"></a><span id="l14.1669" class="difflineminus">-  if (!lpRecip) </span>
<a href="#l14.1670"></a><span id="l14.1670" class="difflineminus">-  {</span>
<a href="#l14.1671"></a><span id="l14.1671" class="difflineminus">-    return(MAPI_E_AMBIGUOUS_RECIPIENT);</span>
<a href="#l14.1672"></a><span id="l14.1672" class="difflineminus">-  }</span>
<a href="#l14.1673"></a><span id="l14.1673" class="difflineminus">-</span>
<a href="#l14.1674"></a><span id="l14.1674" class="difflineminus">-  if ((lpRecip-&gt;ulEIDSize == 0) || (lpRecip-&gt;ulEIDSize &gt; MAX_NAME_LEN))</span>
<a href="#l14.1675"></a><span id="l14.1675" class="difflineminus">-  {</span>
<a href="#l14.1676"></a><span id="l14.1676" class="difflineminus">-    return(MAPI_E_AMBIGUOUS_RECIPIENT);</span>
<a href="#l14.1677"></a><span id="l14.1677" class="difflineminus">-  }</span>
<a href="#l14.1678"></a><span id="l14.1678" class="difflineminus">-</span>
<a href="#l14.1679"></a><span id="l14.1679" class="difflineminus">-  //</span>
<a href="#l14.1680"></a><span id="l14.1680" class="difflineminus">-  // If lhSession is ZERO, then we have to get a temporary session and</span>
<a href="#l14.1681"></a><span id="l14.1681" class="difflineminus">-  // go from there.</span>
<a href="#l14.1682"></a><span id="l14.1682" class="difflineminus">-  //</span>
<a href="#l14.1683"></a><span id="l14.1683" class="difflineminus">-  if (lhSession == 0)</span>
<a href="#l14.1684"></a><span id="l14.1684" class="difflineminus">-  {</span>
<a href="#l14.1685"></a><span id="l14.1685" class="difflineminus">-    LHANDLE    lhTempSession;</span>
<a href="#l14.1686"></a><span id="l14.1686" class="difflineminus">-    if (MAPILogon(0, NULL, NULL, 0, 0, &amp;lhTempSession) != SUCCESS_SUCCESS)</span>
<a href="#l14.1687"></a><span id="l14.1687" class="difflineminus">-    {</span>
<a href="#l14.1688"></a><span id="l14.1688" class="difflineminus">-      isTempSession = TRUE;</span>
<a href="#l14.1689"></a><span id="l14.1689" class="difflineminus">-      if (MAPILogon(0, &quot;dummy&quot;, &quot;dummy&quot;, 0, 0, &amp;lhTempSession) != SUCCESS_SUCCESS)</span>
<a href="#l14.1690"></a><span id="l14.1690" class="difflineminus">-      {</span>
<a href="#l14.1691"></a><span id="l14.1691" class="difflineminus">-        return(MAPI_E_LOGIN_FAILURE);</span>
<a href="#l14.1692"></a><span id="l14.1692" class="difflineminus">-      }</span>
<a href="#l14.1693"></a><span id="l14.1693" class="difflineminus">-    }</span>
<a href="#l14.1694"></a><span id="l14.1694" class="difflineminus">-</span>
<a href="#l14.1695"></a><span id="l14.1695" class="difflineminus">-    lhSession = lhTempSession;</span>
<a href="#l14.1696"></a><span id="l14.1696" class="difflineminus">-  }</span>
<a href="#l14.1697"></a><span id="l14.1697" class="difflineminus">-</span>
<a href="#l14.1698"></a><span id="l14.1698" class="difflineminus">-  //</span>
<a href="#l14.1699"></a><span id="l14.1699" class="difflineminus">-  // Now create the big chunk of memory that we will pass across which</span>
<a href="#l14.1700"></a><span id="l14.1700" class="difflineminus">-  // represents the message</span>
<a href="#l14.1701"></a><span id="l14.1701" class="difflineminus">-  //</span>
<a href="#l14.1702"></a><span id="l14.1702" class="difflineminus">-  MAPIDetailsType        detailInfo;</span>
<a href="#l14.1703"></a><span id="l14.1703" class="difflineminus">-</span>
<a href="#l14.1704"></a><span id="l14.1704" class="difflineminus">-  memset(&amp;detailInfo, 0, sizeof(MAPIDetailsType));</span>
<a href="#l14.1705"></a><span id="l14.1705" class="difflineminus">-  detailInfo.lhSession = lhSession;</span>
<a href="#l14.1706"></a><span id="l14.1706" class="difflineminus">-  detailInfo.ulUIParam = ulUIParam;</span>
<a href="#l14.1707"></a><span id="l14.1707" class="difflineminus">-  detailInfo.flFlags   = flFlags;</span>
<a href="#l14.1708"></a><span id="l14.1708" class="difflineminus">-  detailInfo.ipcWorked = 0;</span>
<a href="#l14.1709"></a><span id="l14.1709" class="difflineminus">-  memcpy(detailInfo.lpszABookID, lpRecip-&gt;lpEntryID, (size_t) lpRecip-&gt;ulEIDSize);</span>
<a href="#l14.1710"></a><span id="l14.1710" class="difflineminus">-</span>
<a href="#l14.1711"></a><span id="l14.1711" class="difflineminus">-  //</span>
<a href="#l14.1712"></a><span id="l14.1712" class="difflineminus">-  // This call locates a Communicator Window, if one is not running,</span>
<a href="#l14.1713"></a><span id="l14.1713" class="difflineminus">-  // it will start up an instance of Communicator and grab that window.</span>
<a href="#l14.1714"></a><span id="l14.1714" class="difflineminus">-  //</span>
<a href="#l14.1715"></a><span id="l14.1715" class="difflineminus">-  hWndIPC = GetCommunicatorIPCWindow();</span>
<a href="#l14.1716"></a><span id="l14.1716" class="difflineminus">-  if (NULL == hWndIPC)</span>
<a href="#l14.1717"></a><span id="l14.1717" class="difflineminus">-  {</span>
<a href="#l14.1718"></a><span id="l14.1718" class="difflineminus">-    if (isTempSession)</span>
<a href="#l14.1719"></a><span id="l14.1719" class="difflineminus">-    {</span>
<a href="#l14.1720"></a><span id="l14.1720" class="difflineminus">-      MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.1721"></a><span id="l14.1721" class="difflineminus">-    }</span>
<a href="#l14.1722"></a><span id="l14.1722" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.1723"></a><span id="l14.1723" class="difflineminus">-  }</span>
<a href="#l14.1724"></a><span id="l14.1724" class="difflineminus">-</span>
<a href="#l14.1725"></a><span id="l14.1725" class="difflineminus">-  // </span>
<a href="#l14.1726"></a><span id="l14.1726" class="difflineminus">-  // Build the IPC structure of information that needs to be provided</span>
<a href="#l14.1727"></a><span id="l14.1727" class="difflineminus">-  // to get information into Communicator</span>
<a href="#l14.1728"></a><span id="l14.1728" class="difflineminus">-  //</span>
<a href="#l14.1729"></a><span id="l14.1729" class="difflineminus">-  BuildMemName((LPSTR)ipcInfo.smemName, ulUIParam);</span>
<a href="#l14.1730"></a><span id="l14.1730" class="difflineminus">-</span>
<a href="#l14.1731"></a><span id="l14.1731" class="difflineminus">-  //</span>
<a href="#l14.1732"></a><span id="l14.1732" class="difflineminus">-  // Build the shared memory segment of information to pass into </span>
<a href="#l14.1733"></a><span id="l14.1733" class="difflineminus">-  // Communicator for send message call.</span>
<a href="#l14.1734"></a><span id="l14.1734" class="difflineminus">-  //</span>
<a href="#l14.1735"></a><span id="l14.1735" class="difflineminus">-  CSharedMem      *sMem;</span>
<a href="#l14.1736"></a><span id="l14.1736" class="difflineminus">-  HANDLE          hSharedMemory;</span>
<a href="#l14.1737"></a><span id="l14.1737" class="difflineminus">-  </span>
<a href="#l14.1738"></a><span id="l14.1738" class="difflineminus">-  //</span>
<a href="#l14.1739"></a><span id="l14.1739" class="difflineminus">-  // Create the shared memory...</span>
<a href="#l14.1740"></a><span id="l14.1740" class="difflineminus">-  //</span>
<a href="#l14.1741"></a><span id="l14.1741" class="difflineminus">-  sMem = NSCreateSharedMemory(sizeof(MAPIDetailsType), (LPSTR) ipcInfo.smemName, &amp;hSharedMemory);</span>
<a href="#l14.1742"></a><span id="l14.1742" class="difflineminus">-  if (!sMem)</span>
<a href="#l14.1743"></a><span id="l14.1743" class="difflineminus">-  {</span>
<a href="#l14.1744"></a><span id="l14.1744" class="difflineminus">-      if (isTempSession)</span>
<a href="#l14.1745"></a><span id="l14.1745" class="difflineminus">-      {</span>
<a href="#l14.1746"></a><span id="l14.1746" class="difflineminus">-        MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.1747"></a><span id="l14.1747" class="difflineminus">-      }</span>
<a href="#l14.1748"></a><span id="l14.1748" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1749"></a><span id="l14.1749" class="difflineminus">-  }</span>
<a href="#l14.1750"></a><span id="l14.1750" class="difflineminus">-</span>
<a href="#l14.1751"></a><span id="l14.1751" class="difflineminus">-  //</span>
<a href="#l14.1752"></a><span id="l14.1752" class="difflineminus">-  // Now copy the information into the memory segment.</span>
<a href="#l14.1753"></a><span id="l14.1753" class="difflineminus">-  //</span>
<a href="#l14.1754"></a><span id="l14.1754" class="difflineminus">-  sMem-&gt;m_dwSize = sizeof(MAPIDetailsType);</span>
<a href="#l14.1755"></a><span id="l14.1755" class="difflineminus">-  memcpy(sMem-&gt;m_buf, &amp;detailInfo, sizeof(MAPIDetailsType));</span>
<a href="#l14.1756"></a><span id="l14.1756" class="difflineminus">-</span>
<a href="#l14.1757"></a><span id="l14.1757" class="difflineminus">-  //</span>
<a href="#l14.1758"></a><span id="l14.1758" class="difflineminus">-  // Now set the size of the shared memory segment for the </span>
<a href="#l14.1759"></a><span id="l14.1759" class="difflineminus">-  // WM_COPYDATA argument that will be sent across.</span>
<a href="#l14.1760"></a><span id="l14.1760" class="difflineminus">-  //</span>
<a href="#l14.1761"></a><span id="l14.1761" class="difflineminus">-  ipcInfo.smemSize = sizeof(MAPIDetailsType);</span>
<a href="#l14.1762"></a><span id="l14.1762" class="difflineminus">-</span>
<a href="#l14.1763"></a><span id="l14.1763" class="difflineminus">-  // For Win16, we actually pass in the pointer to the structure,</span>
<a href="#l14.1764"></a><span id="l14.1764" class="difflineminus">-  // so just assign the variable here.</span>
<a href="#l14.1765"></a><span id="l14.1765" class="difflineminus">-#ifdef WIN16</span>
<a href="#l14.1766"></a><span id="l14.1766" class="difflineminus">-  ipcInfo.lpsmem = sMem;</span>
<a href="#l14.1767"></a><span id="l14.1767" class="difflineminus">-#else</span>
<a href="#l14.1768"></a><span id="l14.1768" class="difflineminus">-  ipcInfo.lpsmem = NULL;</span>
<a href="#l14.1769"></a><span id="l14.1769" class="difflineminus">-#endif</span>
<a href="#l14.1770"></a><span id="l14.1770" class="difflineminus">-</span>
<a href="#l14.1771"></a><span id="l14.1771" class="difflineminus">-  //</span>
<a href="#l14.1772"></a><span id="l14.1772" class="difflineminus">-  // Ok, time to do the SendMessage() to Communicator...</span>
<a href="#l14.1773"></a><span id="l14.1773" class="difflineminus">-  //</span>
<a href="#l14.1774"></a><span id="l14.1774" class="difflineminus">-  result = SendMAPIRequest(hWndIPC, NSCP_MAPIDetails, &amp;ipcInfo);</span>
<a href="#l14.1775"></a><span id="l14.1775" class="difflineminus">-</span>
<a href="#l14.1776"></a><span id="l14.1776" class="difflineminus">-  // Check for IPC completion</span>
<a href="#l14.1777"></a><span id="l14.1777" class="difflineminus">-  MAPIDetailsType *ptr = (MAPIDetailsType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.1778"></a><span id="l14.1778" class="difflineminus">-  if (!ptr-&gt;ipcWorked)</span>
<a href="#l14.1779"></a><span id="l14.1779" class="difflineminus">-  {</span>
<a href="#l14.1780"></a><span id="l14.1780" class="difflineminus">-    result = MAPI_E_FAILURE;</span>
<a href="#l14.1781"></a><span id="l14.1781" class="difflineminus">-  }</span>
<a href="#l14.1782"></a><span id="l14.1782" class="difflineminus">-</span>
<a href="#l14.1783"></a><span id="l14.1783" class="difflineminus">-  //</span>
<a href="#l14.1784"></a><span id="l14.1784" class="difflineminus">-  // Now time to do some real cleanup...</span>
<a href="#l14.1785"></a><span id="l14.1785" class="difflineminus">-  //</span>
<a href="#l14.1786"></a><span id="l14.1786" class="difflineminus">-  NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1787"></a><span id="l14.1787" class="difflineminus">-</span>
<a href="#l14.1788"></a><span id="l14.1788" class="difflineminus">-  //</span>
<a href="#l14.1789"></a><span id="l14.1789" class="difflineminus">-  // If we created a temp session, then we need to trash it...</span>
<a href="#l14.1790"></a><span id="l14.1790" class="difflineminus">-  //</span>
<a href="#l14.1791"></a><span id="l14.1791" class="difflineminus">-  if (isTempSession)</span>
<a href="#l14.1792"></a><span id="l14.1792" class="difflineminus">-  {</span>
<a href="#l14.1793"></a><span id="l14.1793" class="difflineminus">-    MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.1794"></a><span id="l14.1794" class="difflineminus">-  }</span>
<a href="#l14.1795"></a><span id="l14.1795" class="difflineminus">-</span>
<a href="#l14.1796"></a><span id="l14.1796" class="difflineminus">-  LogString(&quot;--MAPIDetails complete\r\n&quot;);</span>
<a href="#l14.1797"></a><span id="l14.1797" class="difflineminus">-  return(result);</span>
<a href="#l14.1798"></a><span id="l14.1798" class="difflineminus">-}</span>
<a href="#l14.1799"></a><span id="l14.1799" class="difflineminus">-</span>
<a href="#l14.1800"></a><span id="l14.1800" class="difflineminus">-//</span>
<a href="#l14.1801"></a><span id="l14.1801" class="difflineminus">-// The MAPIResolveName function transforms a message recipient's name as entered by a </span>
<a href="#l14.1802"></a><span id="l14.1802" class="difflineminus">-// user to an unambiguous address list entry. </span>
<a href="#l14.1803"></a><span id="l14.1803" class="difflineminus">-//</span>
<a href="#l14.1804"></a><span id="l14.1804" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.1805"></a><span id="l14.1805" class="difflineminus">-MAPIResolveName(</span>
<a href="#l14.1806"></a><span id="l14.1806" class="difflineminus">-    LHANDLE lhSession,</span>
<a href="#l14.1807"></a><span id="l14.1807" class="difflineminus">-    ULONG ulUIParam,</span>
<a href="#l14.1808"></a><span id="l14.1808" class="difflineminus">-    LPSTR lpszName,</span>
<a href="#l14.1809"></a><span id="l14.1809" class="difflineminus">-    FLAGS flFlags,</span>
<a href="#l14.1810"></a><span id="l14.1810" class="difflineminus">-    ULONG ulReserved,</span>
<a href="#l14.1811"></a><span id="l14.1811" class="difflineminus">-    lpMapiRecipDesc FAR *lppRecip)</span>
<a href="#l14.1812"></a><span id="l14.1812" class="difflineminus">-{</span>
<a href="#l14.1813"></a><span id="l14.1813" class="difflineminus">-	TRACE_FN(&quot;MAPIResolveName&quot;);</span>
<a href="#l14.1814"></a><span id="l14.1814" class="difflineminus">-  //</span>
<a href="#l14.1815"></a><span id="l14.1815" class="difflineminus">-  // Needed variables...</span>
<a href="#l14.1816"></a><span id="l14.1816" class="difflineminus">-  //</span>
<a href="#l14.1817"></a><span id="l14.1817" class="difflineminus">-  BOOL          isTempSession = FALSE;</span>
<a href="#l14.1818"></a><span id="l14.1818" class="difflineminus">-  LONG          result = SUCCESS_SUCCESS;</span>
<a href="#l14.1819"></a><span id="l14.1819" class="difflineminus">-  HWND          hWndIPC;</span>
<a href="#l14.1820"></a><span id="l14.1820" class="difflineminus">-  MAPIIPCType   ipcInfo;</span>
<a href="#l14.1821"></a><span id="l14.1821" class="difflineminus">-</span>
<a href="#l14.1822"></a><span id="l14.1822" class="difflineminus">-  // Make sure we have something valid on the query name front!</span>
<a href="#l14.1823"></a><span id="l14.1823" class="difflineminus">-  if ((!lpszName) || (!*lpszName))</span>
<a href="#l14.1824"></a><span id="l14.1824" class="difflineminus">-  {</span>
<a href="#l14.1825"></a><span id="l14.1825" class="difflineminus">-    return(MAPI_E_UNKNOWN_RECIPIENT);</span>
<a href="#l14.1826"></a><span id="l14.1826" class="difflineminus">-  }</span>
<a href="#l14.1827"></a><span id="l14.1827" class="difflineminus">-</span>
<a href="#l14.1828"></a><span id="l14.1828" class="difflineminus">-  if (strlen(lpszName) &gt; 255)</span>
<a href="#l14.1829"></a><span id="l14.1829" class="difflineminus">-  {</span>
<a href="#l14.1830"></a><span id="l14.1830" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1831"></a><span id="l14.1831" class="difflineminus">-  }</span>
<a href="#l14.1832"></a><span id="l14.1832" class="difflineminus">-</span>
<a href="#l14.1833"></a><span id="l14.1833" class="difflineminus">-  //</span>
<a href="#l14.1834"></a><span id="l14.1834" class="difflineminus">-  // If lhSession is ZERO, then we have to get a temporary session and</span>
<a href="#l14.1835"></a><span id="l14.1835" class="difflineminus">-  // go from there.</span>
<a href="#l14.1836"></a><span id="l14.1836" class="difflineminus">-  //</span>
<a href="#l14.1837"></a><span id="l14.1837" class="difflineminus">-  if (lhSession == 0)</span>
<a href="#l14.1838"></a><span id="l14.1838" class="difflineminus">-  {</span>
<a href="#l14.1839"></a><span id="l14.1839" class="difflineminus">-    LHANDLE    lhTempSession;</span>
<a href="#l14.1840"></a><span id="l14.1840" class="difflineminus">-    if (MAPILogon(0, NULL, NULL, 0, 0, &amp;lhTempSession) != SUCCESS_SUCCESS)</span>
<a href="#l14.1841"></a><span id="l14.1841" class="difflineminus">-    {</span>
<a href="#l14.1842"></a><span id="l14.1842" class="difflineminus">-      isTempSession = TRUE;</span>
<a href="#l14.1843"></a><span id="l14.1843" class="difflineminus">-      if (MAPILogon(0, &quot;dummy&quot;, &quot;dummy&quot;, 0, 0, &amp;lhTempSession) != SUCCESS_SUCCESS)</span>
<a href="#l14.1844"></a><span id="l14.1844" class="difflineminus">-      {</span>
<a href="#l14.1845"></a><span id="l14.1845" class="difflineminus">-        return(MAPI_E_LOGIN_FAILURE);</span>
<a href="#l14.1846"></a><span id="l14.1846" class="difflineminus">-      }</span>
<a href="#l14.1847"></a><span id="l14.1847" class="difflineminus">-    }</span>
<a href="#l14.1848"></a><span id="l14.1848" class="difflineminus">-</span>
<a href="#l14.1849"></a><span id="l14.1849" class="difflineminus">-    lhSession = lhTempSession;</span>
<a href="#l14.1850"></a><span id="l14.1850" class="difflineminus">-  }</span>
<a href="#l14.1851"></a><span id="l14.1851" class="difflineminus">-</span>
<a href="#l14.1852"></a><span id="l14.1852" class="difflineminus">-  //</span>
<a href="#l14.1853"></a><span id="l14.1853" class="difflineminus">-  // Now create the big chunk of memory that we will pass across which</span>
<a href="#l14.1854"></a><span id="l14.1854" class="difflineminus">-  // represents the message</span>
<a href="#l14.1855"></a><span id="l14.1855" class="difflineminus">-  //</span>
<a href="#l14.1856"></a><span id="l14.1856" class="difflineminus">-  MAPIResolveNameType   nameInfo;</span>
<a href="#l14.1857"></a><span id="l14.1857" class="difflineminus">-</span>
<a href="#l14.1858"></a><span id="l14.1858" class="difflineminus">-  nameInfo.lhSession = lhSession;</span>
<a href="#l14.1859"></a><span id="l14.1859" class="difflineminus">-  nameInfo.ulUIParam = ulUIParam;</span>
<a href="#l14.1860"></a><span id="l14.1860" class="difflineminus">-  nameInfo.flFlags   = flFlags;</span>
<a href="#l14.1861"></a><span id="l14.1861" class="difflineminus">-  nameInfo.ipcWorked = 0;</span>
<a href="#l14.1862"></a><span id="l14.1862" class="difflineminus">-  lstrcpy((LPSTR) nameInfo.lpszName, lpszName);</span>
<a href="#l14.1863"></a><span id="l14.1863" class="difflineminus">-</span>
<a href="#l14.1864"></a><span id="l14.1864" class="difflineminus">-  //</span>
<a href="#l14.1865"></a><span id="l14.1865" class="difflineminus">-  // This call locates a Communicator Window, if one is not running,</span>
<a href="#l14.1866"></a><span id="l14.1866" class="difflineminus">-  // it will start up an instance of Communicator and grab that window.</span>
<a href="#l14.1867"></a><span id="l14.1867" class="difflineminus">-  //</span>
<a href="#l14.1868"></a><span id="l14.1868" class="difflineminus">-  hWndIPC = GetCommunicatorIPCWindow();</span>
<a href="#l14.1869"></a><span id="l14.1869" class="difflineminus">-  if (NULL == hWndIPC)</span>
<a href="#l14.1870"></a><span id="l14.1870" class="difflineminus">-  {</span>
<a href="#l14.1871"></a><span id="l14.1871" class="difflineminus">-    if (isTempSession)</span>
<a href="#l14.1872"></a><span id="l14.1872" class="difflineminus">-    {</span>
<a href="#l14.1873"></a><span id="l14.1873" class="difflineminus">-      MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.1874"></a><span id="l14.1874" class="difflineminus">-    }</span>
<a href="#l14.1875"></a><span id="l14.1875" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.1876"></a><span id="l14.1876" class="difflineminus">-  }</span>
<a href="#l14.1877"></a><span id="l14.1877" class="difflineminus">-</span>
<a href="#l14.1878"></a><span id="l14.1878" class="difflineminus">-  // </span>
<a href="#l14.1879"></a><span id="l14.1879" class="difflineminus">-  // Build the IPC structure of information that needs to be provided</span>
<a href="#l14.1880"></a><span id="l14.1880" class="difflineminus">-  // to get information into Communicator</span>
<a href="#l14.1881"></a><span id="l14.1881" class="difflineminus">-  //</span>
<a href="#l14.1882"></a><span id="l14.1882" class="difflineminus">-  BuildMemName((LPSTR)ipcInfo.smemName, ulUIParam);</span>
<a href="#l14.1883"></a><span id="l14.1883" class="difflineminus">-</span>
<a href="#l14.1884"></a><span id="l14.1884" class="difflineminus">-  //</span>
<a href="#l14.1885"></a><span id="l14.1885" class="difflineminus">-  // Build the shared memory segment of information to pass into </span>
<a href="#l14.1886"></a><span id="l14.1886" class="difflineminus">-  // Communicator for send message call.</span>
<a href="#l14.1887"></a><span id="l14.1887" class="difflineminus">-  //</span>
<a href="#l14.1888"></a><span id="l14.1888" class="difflineminus">-  CSharedMem      *sMem;</span>
<a href="#l14.1889"></a><span id="l14.1889" class="difflineminus">-  HANDLE          hSharedMemory;</span>
<a href="#l14.1890"></a><span id="l14.1890" class="difflineminus">-</span>
<a href="#l14.1891"></a><span id="l14.1891" class="difflineminus">-  //</span>
<a href="#l14.1892"></a><span id="l14.1892" class="difflineminus">-  // Create the shared memory...</span>
<a href="#l14.1893"></a><span id="l14.1893" class="difflineminus">-  //</span>
<a href="#l14.1894"></a><span id="l14.1894" class="difflineminus">-  sMem = NSCreateSharedMemory(sizeof(MAPIResolveNameType), (LPSTR) ipcInfo.smemName, &amp;hSharedMemory);</span>
<a href="#l14.1895"></a><span id="l14.1895" class="difflineminus">-  if (!sMem)</span>
<a href="#l14.1896"></a><span id="l14.1896" class="difflineminus">-  {</span>
<a href="#l14.1897"></a><span id="l14.1897" class="difflineminus">-      if (isTempSession)</span>
<a href="#l14.1898"></a><span id="l14.1898" class="difflineminus">-      {</span>
<a href="#l14.1899"></a><span id="l14.1899" class="difflineminus">-        MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.1900"></a><span id="l14.1900" class="difflineminus">-      }</span>
<a href="#l14.1901"></a><span id="l14.1901" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1902"></a><span id="l14.1902" class="difflineminus">-  }</span>
<a href="#l14.1903"></a><span id="l14.1903" class="difflineminus">-</span>
<a href="#l14.1904"></a><span id="l14.1904" class="difflineminus">-  //</span>
<a href="#l14.1905"></a><span id="l14.1905" class="difflineminus">-  // Now copy the information into the memory segment.</span>
<a href="#l14.1906"></a><span id="l14.1906" class="difflineminus">-  //</span>
<a href="#l14.1907"></a><span id="l14.1907" class="difflineminus">-  sMem-&gt;m_dwSize = sizeof(MAPIResolveNameType);</span>
<a href="#l14.1908"></a><span id="l14.1908" class="difflineminus">-  memcpy(sMem-&gt;m_buf, &amp;nameInfo, sizeof(MAPIResolveNameType));</span>
<a href="#l14.1909"></a><span id="l14.1909" class="difflineminus">-</span>
<a href="#l14.1910"></a><span id="l14.1910" class="difflineminus">-  //</span>
<a href="#l14.1911"></a><span id="l14.1911" class="difflineminus">-  // Now set the size of the shared memory segment for the </span>
<a href="#l14.1912"></a><span id="l14.1912" class="difflineminus">-  // WM_COPYDATA argument that will be sent across.</span>
<a href="#l14.1913"></a><span id="l14.1913" class="difflineminus">-  //</span>
<a href="#l14.1914"></a><span id="l14.1914" class="difflineminus">-  ipcInfo.smemSize = sizeof(MAPIResolveNameType);</span>
<a href="#l14.1915"></a><span id="l14.1915" class="difflineminus">-</span>
<a href="#l14.1916"></a><span id="l14.1916" class="difflineminus">-  // For Win16, we actually pass in the pointer to the structure,</span>
<a href="#l14.1917"></a><span id="l14.1917" class="difflineminus">-  // so just assign the variable here.</span>
<a href="#l14.1918"></a><span id="l14.1918" class="difflineminus">-#ifdef WIN16</span>
<a href="#l14.1919"></a><span id="l14.1919" class="difflineminus">-  ipcInfo.lpsmem = sMem;</span>
<a href="#l14.1920"></a><span id="l14.1920" class="difflineminus">-#else</span>
<a href="#l14.1921"></a><span id="l14.1921" class="difflineminus">-  ipcInfo.lpsmem = NULL;</span>
<a href="#l14.1922"></a><span id="l14.1922" class="difflineminus">-#endif</span>
<a href="#l14.1923"></a><span id="l14.1923" class="difflineminus">-</span>
<a href="#l14.1924"></a><span id="l14.1924" class="difflineminus">-  //</span>
<a href="#l14.1925"></a><span id="l14.1925" class="difflineminus">-  // Ok, time to do the SendMessage() to Communicator...</span>
<a href="#l14.1926"></a><span id="l14.1926" class="difflineminus">-  //</span>
<a href="#l14.1927"></a><span id="l14.1927" class="difflineminus">-  result = SendMAPIRequest(hWndIPC, NSCP_MAPIResolveName, &amp;ipcInfo);</span>
<a href="#l14.1928"></a><span id="l14.1928" class="difflineminus">-</span>
<a href="#l14.1929"></a><span id="l14.1929" class="difflineminus">-  // Check for IPC completion</span>
<a href="#l14.1930"></a><span id="l14.1930" class="difflineminus">-  MAPIResolveNameType *ptr = (MAPIResolveNameType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.1931"></a><span id="l14.1931" class="difflineminus">-  if (!ptr-&gt;ipcWorked)</span>
<a href="#l14.1932"></a><span id="l14.1932" class="difflineminus">-  {</span>
<a href="#l14.1933"></a><span id="l14.1933" class="difflineminus">-    result = MAPI_E_FAILURE;</span>
<a href="#l14.1934"></a><span id="l14.1934" class="difflineminus">-  }</span>
<a href="#l14.1935"></a><span id="l14.1935" class="difflineminus">-</span>
<a href="#l14.1936"></a><span id="l14.1936" class="difflineminus">-  //</span>
<a href="#l14.1937"></a><span id="l14.1937" class="difflineminus">-  // IF FOUND: create the new structure for the matched address info and set the</span>
<a href="#l14.1938"></a><span id="l14.1938" class="difflineminus">-  // memory tracking array correctly for cleanup later down the road.</span>
<a href="#l14.1939"></a><span id="l14.1939" class="difflineminus">-  // </span>
<a href="#l14.1940"></a><span id="l14.1940" class="difflineminus">-  if (result == SUCCESS_SUCCESS)</span>
<a href="#l14.1941"></a><span id="l14.1941" class="difflineminus">-  {</span>
<a href="#l14.1942"></a><span id="l14.1942" class="difflineminus">-    *lppRecip = (MapiRecipDesc FAR *)malloc(sizeof(MapiRecipDesc));</span>
<a href="#l14.1943"></a><span id="l14.1943" class="difflineminus">-    if (lppRecip == NULL)</span>
<a href="#l14.1944"></a><span id="l14.1944" class="difflineminus">-    {</span>
<a href="#l14.1945"></a><span id="l14.1945" class="difflineminus">-        if (isTempSession)</span>
<a href="#l14.1946"></a><span id="l14.1946" class="difflineminus">-        {</span>
<a href="#l14.1947"></a><span id="l14.1947" class="difflineminus">-          MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.1948"></a><span id="l14.1948" class="difflineminus">-        }</span>
<a href="#l14.1949"></a><span id="l14.1949" class="difflineminus">-</span>
<a href="#l14.1950"></a><span id="l14.1950" class="difflineminus">-        return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.1951"></a><span id="l14.1951" class="difflineminus">-    }</span>
<a href="#l14.1952"></a><span id="l14.1952" class="difflineminus">-</span>
<a href="#l14.1953"></a><span id="l14.1953" class="difflineminus">-    // Null out the new memory...</span>
<a href="#l14.1954"></a><span id="l14.1954" class="difflineminus">-    memset((*lppRecip), 0, sizeof(MapiRecipDesc));</span>
<a href="#l14.1955"></a><span id="l14.1955" class="difflineminus">-    MAPIResolveNameType *resultInfo = (MAPIResolveNameType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.1956"></a><span id="l14.1956" class="difflineminus">-</span>
<a href="#l14.1957"></a><span id="l14.1957" class="difflineminus">-    (*lppRecip)-&gt;ulRecipClass = 0;   // This field is meaningless in this call</span>
<a href="#l14.1958"></a><span id="l14.1958" class="difflineminus">-    (*lppRecip)-&gt;lpszName = strdup((LPSTR) resultInfo-&gt;lpszABookName);</span>
<a href="#l14.1959"></a><span id="l14.1959" class="difflineminus">-    (*lppRecip)-&gt;lpszAddress = strdup((LPSTR) resultInfo-&gt;lpszABookAddress);</span>
<a href="#l14.1960"></a><span id="l14.1960" class="difflineminus">-</span>
<a href="#l14.1961"></a><span id="l14.1961" class="difflineminus">-    // We will be using a string made up of the first and last name of the</span>
<a href="#l14.1962"></a><span id="l14.1962" class="difflineminus">-    // person as a unique ID for that individual. The string will be delimited</span>
<a href="#l14.1963"></a><span id="l14.1963" class="difflineminus">-    // like this:</span>
<a href="#l14.1964"></a><span id="l14.1964" class="difflineminus">-    //</span>
<a href="#l14.1965"></a><span id="l14.1965" class="difflineminus">-    //                &lt;first_name&gt;:=LAST=:&lt;last_name&gt;</span>
<a href="#l14.1966"></a><span id="l14.1966" class="difflineminus">-    //</span>
<a href="#l14.1967"></a><span id="l14.1967" class="difflineminus">-    (*lppRecip)-&gt;ulEIDSize = strlen((LPSTR) resultInfo-&gt;lpszABookID) + 1;</span>
<a href="#l14.1968"></a><span id="l14.1968" class="difflineminus">-    (*lppRecip)-&gt;lpEntryID = strdup((LPSTR) resultInfo-&gt;lpszABookID);</span>
<a href="#l14.1969"></a><span id="l14.1969" class="difflineminus">-</span>
<a href="#l14.1970"></a><span id="l14.1970" class="difflineminus">-    SetPointerArray(*lppRecip, MAPI_RECIPIENT_TYPE);</span>
<a href="#l14.1971"></a><span id="l14.1971" class="difflineminus">-  }  </span>
<a href="#l14.1972"></a><span id="l14.1972" class="difflineminus">-</span>
<a href="#l14.1973"></a><span id="l14.1973" class="difflineminus">-  //</span>
<a href="#l14.1974"></a><span id="l14.1974" class="difflineminus">-  // Now time to do some real cleanup...</span>
<a href="#l14.1975"></a><span id="l14.1975" class="difflineminus">-  //</span>
<a href="#l14.1976"></a><span id="l14.1976" class="difflineminus">-  NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.1977"></a><span id="l14.1977" class="difflineminus">-</span>
<a href="#l14.1978"></a><span id="l14.1978" class="difflineminus">-  //</span>
<a href="#l14.1979"></a><span id="l14.1979" class="difflineminus">-  // If we created a temp session, then we need to trash it...</span>
<a href="#l14.1980"></a><span id="l14.1980" class="difflineminus">-  //</span>
<a href="#l14.1981"></a><span id="l14.1981" class="difflineminus">-  if (isTempSession)</span>
<a href="#l14.1982"></a><span id="l14.1982" class="difflineminus">-  {</span>
<a href="#l14.1983"></a><span id="l14.1983" class="difflineminus">-    MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.1984"></a><span id="l14.1984" class="difflineminus">-  }</span>
<a href="#l14.1985"></a><span id="l14.1985" class="difflineminus">-</span>
<a href="#l14.1986"></a><span id="l14.1986" class="difflineminus">-  LogString(&quot;--MAPIResolveName complete\r\n&quot;);</span>
<a href="#l14.1987"></a><span id="l14.1987" class="difflineminus">-  return(result);</span>
<a href="#l14.1988"></a><span id="l14.1988" class="difflineminus">-}</span>
<a href="#l14.1989"></a><span id="l14.1989" class="difflineminus">-</span>
<a href="#l14.1990"></a><span id="l14.1990" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.1991"></a><span id="l14.1991" class="difflineminus">-MAPIAddress(</span>
<a href="#l14.1992"></a><span id="l14.1992" class="difflineminus">-    LHANDLE lhSession,</span>
<a href="#l14.1993"></a><span id="l14.1993" class="difflineminus">-    ULONG ulUIParam,</span>
<a href="#l14.1994"></a><span id="l14.1994" class="difflineminus">-    LPSTR lpszCaption,</span>
<a href="#l14.1995"></a><span id="l14.1995" class="difflineminus">-    ULONG nEditFields,</span>
<a href="#l14.1996"></a><span id="l14.1996" class="difflineminus">-    LPSTR lpszLabels,</span>
<a href="#l14.1997"></a><span id="l14.1997" class="difflineminus">-    ULONG nRecips,</span>
<a href="#l14.1998"></a><span id="l14.1998" class="difflineminus">-    lpMapiRecipDesc lpRecips,</span>
<a href="#l14.1999"></a><span id="l14.1999" class="difflineminus">-    FLAGS flFlags,</span>
<a href="#l14.2000"></a><span id="l14.2000" class="difflineminus">-    ULONG ulReserved,</span>
<a href="#l14.2001"></a><span id="l14.2001" class="difflineminus">-    LPULONG lpnNewRecips,</span>
<a href="#l14.2002"></a><span id="l14.2002" class="difflineminus">-    lpMapiRecipDesc FAR *lppNewRecips)</span>
<a href="#l14.2003"></a><span id="l14.2003" class="difflineminus">-{</span>
<a href="#l14.2004"></a><span id="l14.2004" class="difflineminus">-  TRACE_FN(&quot;MAPIAddress&quot;);</span>
<a href="#l14.2005"></a><span id="l14.2005" class="difflineminus">-  TRACE(&quot;MAPIAddress: lhSession=%lu\n&quot;, lhSession);</span>
<a href="#l14.2006"></a><span id="l14.2006" class="difflineminus">-  //</span>
<a href="#l14.2007"></a><span id="l14.2007" class="difflineminus">-  // Needed variables...</span>
<a href="#l14.2008"></a><span id="l14.2008" class="difflineminus">-  //</span>
<a href="#l14.2009"></a><span id="l14.2009" class="difflineminus">-  BOOL          isTempSession = FALSE;</span>
<a href="#l14.2010"></a><span id="l14.2010" class="difflineminus">-  LONG          result = SUCCESS_SUCCESS;</span>
<a href="#l14.2011"></a><span id="l14.2011" class="difflineminus">-  HWND          hWndIPC;</span>
<a href="#l14.2012"></a><span id="l14.2012" class="difflineminus">-  MAPIIPCType   ipcInfo;</span>
<a href="#l14.2013"></a><span id="l14.2013" class="difflineminus">-</span>
<a href="#l14.2014"></a><span id="l14.2014" class="difflineminus">-  *lppNewRecips = NULL;</span>
<a href="#l14.2015"></a><span id="l14.2015" class="difflineminus">-</span>
<a href="#l14.2016"></a><span id="l14.2016" class="difflineminus">-  //</span>
<a href="#l14.2017"></a><span id="l14.2017" class="difflineminus">-  // If lhSession is ZERO, then we have to get a temporary session and</span>
<a href="#l14.2018"></a><span id="l14.2018" class="difflineminus">-  // go from there.</span>
<a href="#l14.2019"></a><span id="l14.2019" class="difflineminus">-  //</span>
<a href="#l14.2020"></a><span id="l14.2020" class="difflineminus">-  if ( (lhSession == 0) || (flFlags &amp; MAPI_NEW_SESSION))</span>
<a href="#l14.2021"></a><span id="l14.2021" class="difflineminus">-  {</span>
<a href="#l14.2022"></a><span id="l14.2022" class="difflineminus">-    LHANDLE    lhTempSession;</span>
<a href="#l14.2023"></a><span id="l14.2023" class="difflineminus">-    if (MAPILogon(0, NULL, NULL, 0, 0, &amp;lhTempSession) != SUCCESS_SUCCESS)</span>
<a href="#l14.2024"></a><span id="l14.2024" class="difflineminus">-    {</span>
<a href="#l14.2025"></a><span id="l14.2025" class="difflineminus">-      isTempSession = TRUE;</span>
<a href="#l14.2026"></a><span id="l14.2026" class="difflineminus">-      if (MAPILogon(0, &quot;dummy&quot;, &quot;dummy&quot;, 0, 0, &amp;lhTempSession) != SUCCESS_SUCCESS)</span>
<a href="#l14.2027"></a><span id="l14.2027" class="difflineminus">-      {</span>
<a href="#l14.2028"></a><span id="l14.2028" class="difflineminus">-        return(MAPI_E_LOGIN_FAILURE);</span>
<a href="#l14.2029"></a><span id="l14.2029" class="difflineminus">-      }</span>
<a href="#l14.2030"></a><span id="l14.2030" class="difflineminus">-    }</span>
<a href="#l14.2031"></a><span id="l14.2031" class="difflineminus">-</span>
<a href="#l14.2032"></a><span id="l14.2032" class="difflineminus">-    lhSession = lhTempSession;</span>
<a href="#l14.2033"></a><span id="l14.2033" class="difflineminus">-  }</span>
<a href="#l14.2034"></a><span id="l14.2034" class="difflineminus">-</span>
<a href="#l14.2035"></a><span id="l14.2035" class="difflineminus">-  //</span>
<a href="#l14.2036"></a><span id="l14.2036" class="difflineminus">-  // This call locates a Communicator Window, if one is not running,</span>
<a href="#l14.2037"></a><span id="l14.2037" class="difflineminus">-  // it will start up an instance of Communicator and grab that window.</span>
<a href="#l14.2038"></a><span id="l14.2038" class="difflineminus">-  //</span>
<a href="#l14.2039"></a><span id="l14.2039" class="difflineminus">-  hWndIPC = GetCommunicatorIPCWindow();</span>
<a href="#l14.2040"></a><span id="l14.2040" class="difflineminus">-  if (NULL == hWndIPC)</span>
<a href="#l14.2041"></a><span id="l14.2041" class="difflineminus">-  {</span>
<a href="#l14.2042"></a><span id="l14.2042" class="difflineminus">-    return(MAPI_E_FAILURE);</span>
<a href="#l14.2043"></a><span id="l14.2043" class="difflineminus">-  }</span>
<a href="#l14.2044"></a><span id="l14.2044" class="difflineminus">-</span>
<a href="#l14.2045"></a><span id="l14.2045" class="difflineminus">-  // </span>
<a href="#l14.2046"></a><span id="l14.2046" class="difflineminus">-  // Build the IPC structure of information that needs to be provided</span>
<a href="#l14.2047"></a><span id="l14.2047" class="difflineminus">-  // to get information into Communicator</span>
<a href="#l14.2048"></a><span id="l14.2048" class="difflineminus">-  //</span>
<a href="#l14.2049"></a><span id="l14.2049" class="difflineminus">-  BuildMemName((LPSTR)ipcInfo.smemName, ulUIParam);</span>
<a href="#l14.2050"></a><span id="l14.2050" class="difflineminus">-</span>
<a href="#l14.2051"></a><span id="l14.2051" class="difflineminus">-  //</span>
<a href="#l14.2052"></a><span id="l14.2052" class="difflineminus">-  // Build the shared memory segment of information to pass into </span>
<a href="#l14.2053"></a><span id="l14.2053" class="difflineminus">-  // Communicator for the address call.</span>
<a href="#l14.2054"></a><span id="l14.2054" class="difflineminus">-  //</span>
<a href="#l14.2055"></a><span id="l14.2055" class="difflineminus">-  ULONG             i;</span>
<a href="#l14.2056"></a><span id="l14.2056" class="difflineminus">-  CSharedMem        *sMem;</span>
<a href="#l14.2057"></a><span id="l14.2057" class="difflineminus">-  DWORD             memSize;</span>
<a href="#l14.2058"></a><span id="l14.2058" class="difflineminus">-  HANDLE            hSharedMemory;</span>
<a href="#l14.2059"></a><span id="l14.2059" class="difflineminus">-  MAPIAddressType   addrInfo;</span>
<a href="#l14.2060"></a><span id="l14.2060" class="difflineminus">-  LONG              strSeqSize = 0;</span>
<a href="#l14.2061"></a><span id="l14.2061" class="difflineminus">-  NSstringSeq       strSeq = NULL;</span>
<a href="#l14.2062"></a><span id="l14.2062" class="difflineminus">-  DWORD             currentString = 0;</span>
<a href="#l14.2063"></a><span id="l14.2063" class="difflineminus">-   </span>
<a href="#l14.2064"></a><span id="l14.2064" class="difflineminus">-  //</span>
<a href="#l14.2065"></a><span id="l14.2065" class="difflineminus">-  // First populate a address structure with the passed in information</span>
<a href="#l14.2066"></a><span id="l14.2066" class="difflineminus">-  //</span>
<a href="#l14.2067"></a><span id="l14.2067" class="difflineminus">-  memset(&amp;addrInfo, 0, (size_t) sizeof(MAPIAddressType));</span>
<a href="#l14.2068"></a><span id="l14.2068" class="difflineminus">-</span>
<a href="#l14.2069"></a><span id="l14.2069" class="difflineminus">-  addrInfo.lhSession  = lhSession;</span>
<a href="#l14.2070"></a><span id="l14.2070" class="difflineminus">-  addrInfo.ulUIParam  = ulUIParam;</span>
<a href="#l14.2071"></a><span id="l14.2071" class="difflineminus">-  addrInfo.flFlags    = flFlags;</span>
<a href="#l14.2072"></a><span id="l14.2072" class="difflineminus">-  addrInfo.ipcWorked  = 0;</span>
<a href="#l14.2073"></a><span id="l14.2073" class="difflineminus">-  addrInfo.nNewRecips = 0;        // number of recips returned...</span>
<a href="#l14.2074"></a><span id="l14.2074" class="difflineminus">-  addrInfo.lpszBlob[0] = '\0';    // file name for blob of information </span>
<a href="#l14.2075"></a><span id="l14.2075" class="difflineminus">-</span>
<a href="#l14.2076"></a><span id="l14.2076" class="difflineminus">-  addrInfo.nRecips = nRecips;     // number of recips to start with...</span>
<a href="#l14.2077"></a><span id="l14.2077" class="difflineminus">-</span>
<a href="#l14.2078"></a><span id="l14.2078" class="difflineminus">-  //</span>
<a href="#l14.2079"></a><span id="l14.2079" class="difflineminus">-  // Copy the caption into the structure</span>
<a href="#l14.2080"></a><span id="l14.2080" class="difflineminus">-  //</span>
<a href="#l14.2081"></a><span id="l14.2081" class="difflineminus">-  if ((lpszCaption) &amp;&amp; (*lpszCaption))    // check for no null</span>
<a href="#l14.2082"></a><span id="l14.2082" class="difflineminus">-  {</span>
<a href="#l14.2083"></a><span id="l14.2083" class="difflineminus">-    strcpy((LPSTR) addrInfo.lpszCaption, lpszCaption);</span>
<a href="#l14.2084"></a><span id="l14.2084" class="difflineminus">-  }</span>
<a href="#l14.2085"></a><span id="l14.2085" class="difflineminus">-</span>
<a href="#l14.2086"></a><span id="l14.2086" class="difflineminus">-  // Now build the glob of memory of addresses to start with...</span>
<a href="#l14.2087"></a><span id="l14.2087" class="difflineminus">-  if (nRecips &gt; 0)</span>
<a href="#l14.2088"></a><span id="l14.2088" class="difflineminus">-  {</span>
<a href="#l14.2089"></a><span id="l14.2089" class="difflineminus">-    LPSTR *strArray = (LPSTR *) malloc((size_t) (sizeof(LPSTR) * ((nRecips * 3) + 1)));</span>
<a href="#l14.2090"></a><span id="l14.2090" class="difflineminus">-    if (!strArray)</span>
<a href="#l14.2091"></a><span id="l14.2091" class="difflineminus">-    {</span>
<a href="#l14.2092"></a><span id="l14.2092" class="difflineminus">-      if (isTempSession)</span>
<a href="#l14.2093"></a><span id="l14.2093" class="difflineminus">-      {</span>
<a href="#l14.2094"></a><span id="l14.2094" class="difflineminus">-        MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.2095"></a><span id="l14.2095" class="difflineminus">-      }</span>
<a href="#l14.2096"></a><span id="l14.2096" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.2097"></a><span id="l14.2097" class="difflineminus">-    }</span>
<a href="#l14.2098"></a><span id="l14.2098" class="difflineminus">-  </span>
<a href="#l14.2099"></a><span id="l14.2099" class="difflineminus">-    LPSTR toString  = &quot;1&quot;;</span>
<a href="#l14.2100"></a><span id="l14.2100" class="difflineminus">-    LPSTR ccString  = &quot;2&quot;;</span>
<a href="#l14.2101"></a><span id="l14.2101" class="difflineminus">-    LPSTR bccString = &quot;3&quot;;</span>
<a href="#l14.2102"></a><span id="l14.2102" class="difflineminus">-</span>
<a href="#l14.2103"></a><span id="l14.2103" class="difflineminus">-    for (i=0; i&lt;nRecips; i++)</span>
<a href="#l14.2104"></a><span id="l14.2104" class="difflineminus">-    {</span>
<a href="#l14.2105"></a><span id="l14.2105" class="difflineminus">-      // rhp - need message class</span>
<a href="#l14.2106"></a><span id="l14.2106" class="difflineminus">-      if (lpRecips[i].ulRecipClass == MAPI_BCC)</span>
<a href="#l14.2107"></a><span id="l14.2107" class="difflineminus">-        strArray[currentString++] = CheckNullString(bccString);</span>
<a href="#l14.2108"></a><span id="l14.2108" class="difflineminus">-      else if (lpRecips[i].ulRecipClass == MAPI_CC)</span>
<a href="#l14.2109"></a><span id="l14.2109" class="difflineminus">-        strArray[currentString++] = CheckNullString(ccString);</span>
<a href="#l14.2110"></a><span id="l14.2110" class="difflineminus">-      else</span>
<a href="#l14.2111"></a><span id="l14.2111" class="difflineminus">-        strArray[currentString++] = CheckNullString(toString);</span>
<a href="#l14.2112"></a><span id="l14.2112" class="difflineminus">-</span>
<a href="#l14.2113"></a><span id="l14.2113" class="difflineminus">-      strArray[currentString++] = CheckNullString(lpRecips[i].lpszName);</span>
<a href="#l14.2114"></a><span id="l14.2114" class="difflineminus">-      strArray[currentString++] = CheckNullString(lpRecips[i].lpszAddress);  </span>
<a href="#l14.2115"></a><span id="l14.2115" class="difflineminus">-    }</span>
<a href="#l14.2116"></a><span id="l14.2116" class="difflineminus">-</span>
<a href="#l14.2117"></a><span id="l14.2117" class="difflineminus">-    strArray[currentString] = NULL;</span>
<a href="#l14.2118"></a><span id="l14.2118" class="difflineminus">-</span>
<a href="#l14.2119"></a><span id="l14.2119" class="difflineminus">-    strSeq     = NSStrSeqNew(strArray);</span>
<a href="#l14.2120"></a><span id="l14.2120" class="difflineminus">-    free(strArray);</span>
<a href="#l14.2121"></a><span id="l14.2121" class="difflineminus">-    if (!strSeq)</span>
<a href="#l14.2122"></a><span id="l14.2122" class="difflineminus">-    {</span>
<a href="#l14.2123"></a><span id="l14.2123" class="difflineminus">-      if (isTempSession)</span>
<a href="#l14.2124"></a><span id="l14.2124" class="difflineminus">-      {</span>
<a href="#l14.2125"></a><span id="l14.2125" class="difflineminus">-        MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.2126"></a><span id="l14.2126" class="difflineminus">-      }</span>
<a href="#l14.2127"></a><span id="l14.2127" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.2128"></a><span id="l14.2128" class="difflineminus">-    }</span>
<a href="#l14.2129"></a><span id="l14.2129" class="difflineminus">-</span>
<a href="#l14.2130"></a><span id="l14.2130" class="difflineminus">-    strSeqSize = NSStrSeqSize(strSeq);</span>
<a href="#l14.2131"></a><span id="l14.2131" class="difflineminus">-  }</span>
<a href="#l14.2132"></a><span id="l14.2132" class="difflineminus">-  </span>
<a href="#l14.2133"></a><span id="l14.2133" class="difflineminus">-  memSize = sizeof(MAPIAddressType) + strSeqSize;</span>
<a href="#l14.2134"></a><span id="l14.2134" class="difflineminus">-</span>
<a href="#l14.2135"></a><span id="l14.2135" class="difflineminus">-  //</span>
<a href="#l14.2136"></a><span id="l14.2136" class="difflineminus">-  // Create the shared memory...</span>
<a href="#l14.2137"></a><span id="l14.2137" class="difflineminus">-  //</span>
<a href="#l14.2138"></a><span id="l14.2138" class="difflineminus">-  sMem = NSCreateSharedMemory(memSize, (LPSTR) ipcInfo.smemName, &amp;hSharedMemory);</span>
<a href="#l14.2139"></a><span id="l14.2139" class="difflineminus">-  if (!sMem)</span>
<a href="#l14.2140"></a><span id="l14.2140" class="difflineminus">-  {</span>
<a href="#l14.2141"></a><span id="l14.2141" class="difflineminus">-      if (isTempSession)</span>
<a href="#l14.2142"></a><span id="l14.2142" class="difflineminus">-      {</span>
<a href="#l14.2143"></a><span id="l14.2143" class="difflineminus">-        MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.2144"></a><span id="l14.2144" class="difflineminus">-      }</span>
<a href="#l14.2145"></a><span id="l14.2145" class="difflineminus">-      return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.2146"></a><span id="l14.2146" class="difflineminus">-  }</span>
<a href="#l14.2147"></a><span id="l14.2147" class="difflineminus">-</span>
<a href="#l14.2148"></a><span id="l14.2148" class="difflineminus">-  //</span>
<a href="#l14.2149"></a><span id="l14.2149" class="difflineminus">-  // Now copy the information into the memory segment.</span>
<a href="#l14.2150"></a><span id="l14.2150" class="difflineminus">-  //</span>
<a href="#l14.2151"></a><span id="l14.2151" class="difflineminus">-  sMem-&gt;m_dwSize = memSize;</span>
<a href="#l14.2152"></a><span id="l14.2152" class="difflineminus">-  memcpy(sMem-&gt;m_buf, &amp;(addrInfo), sizeof(MAPIAddressType));</span>
<a href="#l14.2153"></a><span id="l14.2153" class="difflineminus">-</span>
<a href="#l14.2154"></a><span id="l14.2154" class="difflineminus">-  // Now if we have recipients...copy in the sequence!</span>
<a href="#l14.2155"></a><span id="l14.2155" class="difflineminus">-  if (nRecips &gt; 0)  </span>
<a href="#l14.2156"></a><span id="l14.2156" class="difflineminus">-  {</span>
<a href="#l14.2157"></a><span id="l14.2157" class="difflineminus">-    MAPIAddressType *ptr = (MAPIAddressType *)&amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.2158"></a><span id="l14.2158" class="difflineminus">-</span>
<a href="#l14.2159"></a><span id="l14.2159" class="difflineminus">-    memcpy(ptr-&gt;dataBuf, strSeq, strSeqSize);</span>
<a href="#l14.2160"></a><span id="l14.2160" class="difflineminus">-    NSStrSeqDelete(strSeq);</span>
<a href="#l14.2161"></a><span id="l14.2161" class="difflineminus">-  }</span>
<a href="#l14.2162"></a><span id="l14.2162" class="difflineminus">-</span>
<a href="#l14.2163"></a><span id="l14.2163" class="difflineminus">-  //</span>
<a href="#l14.2164"></a><span id="l14.2164" class="difflineminus">-  // Now set the size of the shared memory segment for the </span>
<a href="#l14.2165"></a><span id="l14.2165" class="difflineminus">-  // WM_COPYDATA argument that will be sent across.</span>
<a href="#l14.2166"></a><span id="l14.2166" class="difflineminus">-  //</span>
<a href="#l14.2167"></a><span id="l14.2167" class="difflineminus">-  ipcInfo.smemSize = memSize;</span>
<a href="#l14.2168"></a><span id="l14.2168" class="difflineminus">-</span>
<a href="#l14.2169"></a><span id="l14.2169" class="difflineminus">-  // For Win16, we actually pass in the pointer to the structure,</span>
<a href="#l14.2170"></a><span id="l14.2170" class="difflineminus">-  // so just assign the variable here.</span>
<a href="#l14.2171"></a><span id="l14.2171" class="difflineminus">-#ifdef WIN16</span>
<a href="#l14.2172"></a><span id="l14.2172" class="difflineminus">-  ipcInfo.lpsmem = sMem;</span>
<a href="#l14.2173"></a><span id="l14.2173" class="difflineminus">-#else</span>
<a href="#l14.2174"></a><span id="l14.2174" class="difflineminus">-  ipcInfo.lpsmem = NULL;</span>
<a href="#l14.2175"></a><span id="l14.2175" class="difflineminus">-#endif</span>
<a href="#l14.2176"></a><span id="l14.2176" class="difflineminus">-</span>
<a href="#l14.2177"></a><span id="l14.2177" class="difflineminus">-  //</span>
<a href="#l14.2178"></a><span id="l14.2178" class="difflineminus">-  // Ok, time to do the SendMessage() to Communicator...</span>
<a href="#l14.2179"></a><span id="l14.2179" class="difflineminus">-  //</span>
<a href="#l14.2180"></a><span id="l14.2180" class="difflineminus">-  result = SendMAPIRequest(hWndIPC, NSCP_MAPIAddress, &amp;ipcInfo);</span>
<a href="#l14.2181"></a><span id="l14.2181" class="difflineminus">-</span>
<a href="#l14.2182"></a><span id="l14.2182" class="difflineminus">-  // Check the IPC status...</span>
<a href="#l14.2183"></a><span id="l14.2183" class="difflineminus">-  MAPIAddressType *addrPtr = (MAPIAddressType *) &amp;(sMem-&gt;m_buf[0]);</span>
<a href="#l14.2184"></a><span id="l14.2184" class="difflineminus">-</span>
<a href="#l14.2185"></a><span id="l14.2185" class="difflineminus">-  //</span>
<a href="#l14.2186"></a><span id="l14.2186" class="difflineminus">-  // Now return the value to the caller if we bombed...</span>
<a href="#l14.2187"></a><span id="l14.2187" class="difflineminus">-  //</span>
<a href="#l14.2188"></a><span id="l14.2188" class="difflineminus">-  if ((result != SUCCESS_SUCCESS) || (!(addrPtr-&gt;ipcWorked)))</span>
<a href="#l14.2189"></a><span id="l14.2189" class="difflineminus">-  {</span>
<a href="#l14.2190"></a><span id="l14.2190" class="difflineminus">-    NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.2191"></a><span id="l14.2191" class="difflineminus">-    if (isTempSession)</span>
<a href="#l14.2192"></a><span id="l14.2192" class="difflineminus">-    {</span>
<a href="#l14.2193"></a><span id="l14.2193" class="difflineminus">-      MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.2194"></a><span id="l14.2194" class="difflineminus">-    }</span>
<a href="#l14.2195"></a><span id="l14.2195" class="difflineminus">-	  LogString(&quot;--MAPIAddress failed\r\n&quot;);</span>
<a href="#l14.2196"></a><span id="l14.2196" class="difflineminus">-	  return(result);</span>
<a href="#l14.2197"></a><span id="l14.2197" class="difflineminus">-  }</span>
<a href="#l14.2198"></a><span id="l14.2198" class="difflineminus">-</span>
<a href="#l14.2199"></a><span id="l14.2199" class="difflineminus">-  // Now deal with the addresses selected and move on...</span>
<a href="#l14.2200"></a><span id="l14.2200" class="difflineminus">-  if (addrPtr-&gt;nNewRecips == 0)</span>
<a href="#l14.2201"></a><span id="l14.2201" class="difflineminus">-  {</span>
<a href="#l14.2202"></a><span id="l14.2202" class="difflineminus">-    NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.2203"></a><span id="l14.2203" class="difflineminus">-    if (isTempSession)</span>
<a href="#l14.2204"></a><span id="l14.2204" class="difflineminus">-    {</span>
<a href="#l14.2205"></a><span id="l14.2205" class="difflineminus">-      MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.2206"></a><span id="l14.2206" class="difflineminus">-    }</span>
<a href="#l14.2207"></a><span id="l14.2207" class="difflineminus">-</span>
<a href="#l14.2208"></a><span id="l14.2208" class="difflineminus">-	  LogString(&quot;--MAPIAddress - ZERO recipients\r\n&quot;);</span>
<a href="#l14.2209"></a><span id="l14.2209" class="difflineminus">-	  return(result);</span>
<a href="#l14.2210"></a><span id="l14.2210" class="difflineminus">-  }</span>
<a href="#l14.2211"></a><span id="l14.2211" class="difflineminus">-</span>
<a href="#l14.2212"></a><span id="l14.2212" class="difflineminus">-  //</span>
<a href="#l14.2213"></a><span id="l14.2213" class="difflineminus">-  // Get the blob loaded into memory...</span>
<a href="#l14.2214"></a><span id="l14.2214" class="difflineminus">-  // </span>
<a href="#l14.2215"></a><span id="l14.2215" class="difflineminus">-  NSstringSeq blobSequence = (NSstringSeq) LoadBlobToMemory((LPSTR) addrPtr-&gt;lpszBlob);</span>
<a href="#l14.2216"></a><span id="l14.2216" class="difflineminus">-</span>
<a href="#l14.2217"></a><span id="l14.2217" class="difflineminus">-  // Now check on the blob</span>
<a href="#l14.2218"></a><span id="l14.2218" class="difflineminus">-  if (!blobSequence)</span>
<a href="#l14.2219"></a><span id="l14.2219" class="difflineminus">-  {	  </span>
<a href="#l14.2220"></a><span id="l14.2220" class="difflineminus">-    // Cleanup the shared memory...</span>
<a href="#l14.2221"></a><span id="l14.2221" class="difflineminus">-    NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.2222"></a><span id="l14.2222" class="difflineminus">-</span>
<a href="#l14.2223"></a><span id="l14.2223" class="difflineminus">-    if (isTempSession)</span>
<a href="#l14.2224"></a><span id="l14.2224" class="difflineminus">-    {</span>
<a href="#l14.2225"></a><span id="l14.2225" class="difflineminus">-      MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.2226"></a><span id="l14.2226" class="difflineminus">-    }</span>
<a href="#l14.2227"></a><span id="l14.2227" class="difflineminus">-    return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.2228"></a><span id="l14.2228" class="difflineminus">-  }</span>
<a href="#l14.2229"></a><span id="l14.2229" class="difflineminus">-</span>
<a href="#l14.2230"></a><span id="l14.2230" class="difflineminus">-  ULONG           stringCount = 0; // This is to start with the rest of the string seq</span>
<a href="#l14.2231"></a><span id="l14.2231" class="difflineminus">-  lpMapiRecipDesc lpNewRecips;</span>
<a href="#l14.2232"></a><span id="l14.2232" class="difflineminus">-</span>
<a href="#l14.2233"></a><span id="l14.2233" class="difflineminus">-  // Now deal with the recipients of this message</span>
<a href="#l14.2234"></a><span id="l14.2234" class="difflineminus">-  lpNewRecips = (lpMapiRecipDesc) malloc((size_t) (sizeof(MapiRecipDesc) * </span>
<a href="#l14.2235"></a><span id="l14.2235" class="difflineminus">-                                                    addrPtr-&gt;nNewRecips));</span>
<a href="#l14.2236"></a><span id="l14.2236" class="difflineminus">-  if (!lpNewRecips)</span>
<a href="#l14.2237"></a><span id="l14.2237" class="difflineminus">-  {</span>
<a href="#l14.2238"></a><span id="l14.2238" class="difflineminus">-    // Cleanup the shared memory...</span>
<a href="#l14.2239"></a><span id="l14.2239" class="difflineminus">-    NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.2240"></a><span id="l14.2240" class="difflineminus">-</span>
<a href="#l14.2241"></a><span id="l14.2241" class="difflineminus">-    NSStrSeqDelete(blobSequence);</span>
<a href="#l14.2242"></a><span id="l14.2242" class="difflineminus">-	  LogString(&quot;--MAPIAddress failed\r\n&quot;);</span>
<a href="#l14.2243"></a><span id="l14.2243" class="difflineminus">-    if (isTempSession)</span>
<a href="#l14.2244"></a><span id="l14.2244" class="difflineminus">-    {</span>
<a href="#l14.2245"></a><span id="l14.2245" class="difflineminus">-      MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.2246"></a><span id="l14.2246" class="difflineminus">-    }</span>
<a href="#l14.2247"></a><span id="l14.2247" class="difflineminus">-	  return(MAPI_E_INSUFFICIENT_MEMORY);</span>
<a href="#l14.2248"></a><span id="l14.2248" class="difflineminus">-  }</span>
<a href="#l14.2249"></a><span id="l14.2249" class="difflineminus">-</span>
<a href="#l14.2250"></a><span id="l14.2250" class="difflineminus">-  memset(lpNewRecips, 0, (size_t) (sizeof(MapiRecipDesc) * addrPtr-&gt;nNewRecips));</span>
<a href="#l14.2251"></a><span id="l14.2251" class="difflineminus">-</span>
<a href="#l14.2252"></a><span id="l14.2252" class="difflineminus">-  for (i=0; i&lt;addrPtr-&gt;nNewRecips; i++)</span>
<a href="#l14.2253"></a><span id="l14.2253" class="difflineminus">-  {</span>
<a href="#l14.2254"></a><span id="l14.2254" class="difflineminus">-    // String x: LPSTR lpszName;             // Recipient N name                           </span>
<a href="#l14.2255"></a><span id="l14.2255" class="difflineminus">-    // String x: LPSTR lpszAddress;          // Recipient N address (optional)             </span>
<a href="#l14.2256"></a><span id="l14.2256" class="difflineminus">-    // String x: LPSTR lpszRecipClass        // recipient class - sprintf of ULONG</span>
<a href="#l14.2257"></a><span id="l14.2257" class="difflineminus">-    lpNewRecips[i].lpszName = </span>
<a href="#l14.2258"></a><span id="l14.2258" class="difflineminus">-        strdup( CheckNullString(NSStrSeqGet(blobSequence, stringCount++)) );</span>
<a href="#l14.2259"></a><span id="l14.2259" class="difflineminus">-</span>
<a href="#l14.2260"></a><span id="l14.2260" class="difflineminus">-    lpNewRecips[i].lpszAddress = </span>
<a href="#l14.2261"></a><span id="l14.2261" class="difflineminus">-        strdup( CheckNullString(NSStrSeqGet(blobSequence, stringCount++)) );</span>
<a href="#l14.2262"></a><span id="l14.2262" class="difflineminus">-      </span>
<a href="#l14.2263"></a><span id="l14.2263" class="difflineminus">-    lpNewRecips[i].ulRecipClass = </span>
<a href="#l14.2264"></a><span id="l14.2264" class="difflineminus">-        (ULONG) atoi( CheckNullString(NSStrSeqGet(blobSequence, stringCount++)) );</span>
<a href="#l14.2265"></a><span id="l14.2265" class="difflineminus">-  }</span>
<a href="#l14.2266"></a><span id="l14.2266" class="difflineminus">-</span>
<a href="#l14.2267"></a><span id="l14.2267" class="difflineminus">-  //</span>
<a href="#l14.2268"></a><span id="l14.2268" class="difflineminus">-  // Now that we are here, set the pointer array and move on with life...</span>
<a href="#l14.2269"></a><span id="l14.2269" class="difflineminus">-  //</span>
<a href="#l14.2270"></a><span id="l14.2270" class="difflineminus">-  *lppNewRecips = lpNewRecips;</span>
<a href="#l14.2271"></a><span id="l14.2271" class="difflineminus">-  *lpnNewRecips = addrPtr-&gt;nNewRecips;</span>
<a href="#l14.2272"></a><span id="l14.2272" class="difflineminus">-  SetPointerArray(lpNewRecips, MAPI_RECIPIENT_TYPE);</span>
<a href="#l14.2273"></a><span id="l14.2273" class="difflineminus">-  </span>
<a href="#l14.2274"></a><span id="l14.2274" class="difflineminus">-  // Cleanup the shared memory...</span>
<a href="#l14.2275"></a><span id="l14.2275" class="difflineminus">-  NSCloseSharedMemory(sMem, hSharedMemory);</span>
<a href="#l14.2276"></a><span id="l14.2276" class="difflineminus">-  if (blobSequence)</span>
<a href="#l14.2277"></a><span id="l14.2277" class="difflineminus">-    NSStrSeqDelete(blobSequence);</span>
<a href="#l14.2278"></a><span id="l14.2278" class="difflineminus">-</span>
<a href="#l14.2279"></a><span id="l14.2279" class="difflineminus">-  //</span>
<a href="#l14.2280"></a><span id="l14.2280" class="difflineminus">-  // If we created a temp session, then we need to trash it...</span>
<a href="#l14.2281"></a><span id="l14.2281" class="difflineminus">-  //</span>
<a href="#l14.2282"></a><span id="l14.2282" class="difflineminus">-  if (isTempSession)</span>
<a href="#l14.2283"></a><span id="l14.2283" class="difflineminus">-  {</span>
<a href="#l14.2284"></a><span id="l14.2284" class="difflineminus">-    MAPILogoff(lhSession, 0, 0, 0);</span>
<a href="#l14.2285"></a><span id="l14.2285" class="difflineminus">-  }</span>
<a href="#l14.2286"></a><span id="l14.2286" class="difflineminus">-</span>
<a href="#l14.2287"></a><span id="l14.2287" class="difflineminus">-  TRACE(&quot;MAPIAddress Complete&quot;);</span>
<a href="#l14.2288"></a><span id="l14.2288" class="difflineminus">-	return(result);</span>
<a href="#l14.2289"></a><span id="l14.2289" class="difflineminus">-}</span>
<a href="#l14.2290"></a><span id="l14.2290" class="difflineminus">-</span>
<a href="#l14.2291"></a><span id="l14.2291" class="difflineminus">-MAPI_IMPLEMENT(ULONG) </span>
<a href="#l14.2292"></a><span id="l14.2292" class="difflineminus">-MAPIGetNetscapeVersion(void)</span>
<a href="#l14.2293"></a><span id="l14.2293" class="difflineminus">-{</span>
<a href="#l14.2294"></a><span id="l14.2294" class="difflineminus">-  return(1);</span>
<a href="#l14.2295"></a><span id="l14.2295" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">deleted file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/mapi32.def</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ /dev/null</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -1,14 +0,0 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineminus">-EXPORTS</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineminus">-	MAPILogon</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineminus">-	MAPILogoff</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineminus">-	MAPISendMail</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineminus">-	MAPISendDocuments</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineminus">-	MAPIFreeBuffer</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineminus">-	MAPIFindNext</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-	MAPIReadMail</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-	MAPISaveMail</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-	MAPIDeleteMail</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-	MAPIAddress</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-	MAPIDetails</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-	MAPIResolveName</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-  MAPIGetNetscapeVersion</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">deleted file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/mapi32.rc</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ /dev/null</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -1,146 +0,0 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineminus">-// Insert copyright and license here 1997</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineminus">-//Microsoft Developer Studio generated resource script.</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineminus">-//</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineminus">-</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineminus">-#define APSTUDIO_READONLY_SYMBOLS</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-//</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-// Generated from the TEXTINCLUDE 2 resource.</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-//</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-#include &quot;afxres.h&quot;</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineminus">-#undef APSTUDIO_READONLY_SYMBOLS</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineminus">-</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">-// English (U.S.) resources</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">-</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">-#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_ENU)</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineminus">-#ifdef _WIN32</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-LANGUAGE LANG_ENGLISH, SUBLANG_ENGLISH_US</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-#pragma code_page(1252)</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-#endif //_WIN32</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">-</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-//</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-// Dialog</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">-//</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">-</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-ID_DIALOG_MAPI DIALOGEX 0, 0, 186, 111</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-STYLE DS_MODALFRAME | WS_POPUP | WS_CAPTION | WS_SYSMENU</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">-EXSTYLE WS_EX_TOOLWINDOW</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-CAPTION &quot;Netscape MAPI Support&quot;</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-FONT 8, &quot;MS Sans Serif&quot;</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineminus">-BEGIN</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineminus">-    DEFPUSHBUTTON   &quot;OK&quot;,IDOK,41,95,50,14</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineminus">-    PUSHBUTTON      &quot;Cancel&quot;,IDCANCEL,104,95,50,14</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-    GROUPBOX        &quot;Diagnostic Information&quot;,IDC_STATIC,2,2,182,91</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-    CTEXT           &quot;This window will contain MAPI relative\ninformation for Netscape Communicator&quot;,</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineminus">-                    IDC_STATIC,11,14,159,30</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineminus">-END</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineminus">-</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-//</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-// DESIGNINFO</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineminus">-//</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineminus">-#ifdef APSTUDIO_INVOKED</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineminus">-GUIDELINES DESIGNINFO DISCARDABLE </span>
<a href="#l16.55"></a><span id="l16.55" class="difflineminus">-BEGIN</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineminus">-    ID_DIALOG_MAPI, DIALOG</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineminus">-    BEGIN</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineminus">-        LEFTMARGIN, 2</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineminus">-        RIGHTMARGIN, 184</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineminus">-        TOPMARGIN, 2</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineminus">-        BOTTOMMARGIN, 109</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineminus">-    END</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineminus">-END</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineminus">-#endif    // APSTUDIO_INVOKED</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineminus">-</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineminus">-</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineminus">-#ifdef APSTUDIO_INVOKED</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineminus">-//</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineminus">-// TEXTINCLUDE</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineminus">-//</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineminus">-</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineminus">-1 TEXTINCLUDE DISCARDABLE </span>
<a href="#l16.74"></a><span id="l16.74" class="difflineminus">-BEGIN</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineminus">-    &quot;resource.h\0&quot;</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineminus">-END</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineminus">-</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineminus">-2 TEXTINCLUDE DISCARDABLE </span>
<a href="#l16.79"></a><span id="l16.79" class="difflineminus">-BEGIN</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineminus">-    &quot;#include &quot;&quot;afxres.h&quot;&quot;\r\n&quot;</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineminus">-    &quot;\0&quot;</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineminus">-END</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineminus">-</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineminus">-3 TEXTINCLUDE DISCARDABLE </span>
<a href="#l16.85"></a><span id="l16.85" class="difflineminus">-BEGIN</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineminus">-    &quot;\r\n&quot;</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineminus">-    &quot;\0&quot;</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineminus">-END</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineminus">-</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineminus">-#endif    // APSTUDIO_INVOKED</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineminus">-</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineminus">-</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineminus">-#ifndef _MAC</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineminus">-//</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineminus">-// Version</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineminus">-//</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineminus">-</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineminus">-VS_VERSION_INFO VERSIONINFO</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineminus">- FILEVERSION 5,0,0,1</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineminus">- PRODUCTVERSION 5,0,0,1</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineminus">- FILEFLAGSMASK 0x3fL</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineminus">-#ifdef _DEBUG</span>
<a href="#l16.104"></a><span id="l16.104" class="difflineminus">- FILEFLAGS 0x1L</span>
<a href="#l16.105"></a><span id="l16.105" class="difflineminus">-#else</span>
<a href="#l16.106"></a><span id="l16.106" class="difflineminus">- FILEFLAGS 0x0L</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineminus">-#endif</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineminus">- FILEOS 0x40004L</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineminus">- FILETYPE 0x2L</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineminus">- FILESUBTYPE 0x0L</span>
<a href="#l16.111"></a><span id="l16.111" class="difflineminus">-BEGIN</span>
<a href="#l16.112"></a><span id="l16.112" class="difflineminus">-    BLOCK &quot;StringFileInfo&quot;</span>
<a href="#l16.113"></a><span id="l16.113" class="difflineminus">-    BEGIN</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineminus">-        BLOCK &quot;040904b0&quot;</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineminus">-        BEGIN</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineminus">-            VALUE &quot;Comments&quot;, &quot;Simple MAPI DLL\0&quot;</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineminus">-            VALUE &quot;CompanyName&quot;, &quot;Netscape Communications Corporation\0&quot;</span>
<a href="#l16.118"></a><span id="l16.118" class="difflineminus">-            VALUE &quot;FileDescription&quot;, &quot;mapi32\0&quot;</span>
<a href="#l16.119"></a><span id="l16.119" class="difflineminus">-            VALUE &quot;FileVersion&quot;, &quot;5, 0, 0, 1\0&quot;</span>
<a href="#l16.120"></a><span id="l16.120" class="difflineminus">-            VALUE &quot;InternalName&quot;, &quot;mapi32\0&quot;</span>
<a href="#l16.121"></a><span id="l16.121" class="difflineminus">-            VALUE &quot;LegalCopyright&quot;, &quot;Copyright  1997\0&quot;</span>
<a href="#l16.122"></a><span id="l16.122" class="difflineminus">-            VALUE &quot;LegalTrademarks&quot;, &quot;Netscape and Netscape Navigator are registered trademarks of Netscape Communications Corporation.\0&quot;</span>
<a href="#l16.123"></a><span id="l16.123" class="difflineminus">-            VALUE &quot;OriginalFilename&quot;, &quot;mapi32.dll\0&quot;</span>
<a href="#l16.124"></a><span id="l16.124" class="difflineminus">-            VALUE &quot;ProductName&quot;, &quot;Netscape Communications Simple MAPI\0&quot;</span>
<a href="#l16.125"></a><span id="l16.125" class="difflineminus">-            VALUE &quot;ProductVersion&quot;, &quot;5, 0, 0, 1\0&quot;</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineminus">-        END</span>
<a href="#l16.127"></a><span id="l16.127" class="difflineminus">-    END</span>
<a href="#l16.128"></a><span id="l16.128" class="difflineminus">-    BLOCK &quot;VarFileInfo&quot;</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineminus">-    BEGIN</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineminus">-        VALUE &quot;Translation&quot;, 0x409, 1200</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineminus">-    END</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineminus">-END</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineminus">-</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineminus">-#endif    // !_MAC</span>
<a href="#l16.135"></a><span id="l16.135" class="difflineminus">-</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineminus">-#endif    // English (U.S.) resources</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineminus">-</span>
<a href="#l16.139"></a><span id="l16.139" class="difflineminus">-</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineminus">-</span>
<a href="#l16.141"></a><span id="l16.141" class="difflineminus">-#ifndef APSTUDIO_INVOKED</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineminus">-//</span>
<a href="#l16.144"></a><span id="l16.144" class="difflineminus">-// Generated from the TEXTINCLUDE 3 resource.</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineminus">-//</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineminus">-</span>
<a href="#l16.147"></a><span id="l16.147" class="difflineminus">-</span>
<a href="#l16.148"></a><span id="l16.148" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.149"></a><span id="l16.149" class="difflineminus">-#endif    // not APSTUDIO_INVOKED</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">deleted file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/mapiipc.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ /dev/null</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -1,249 +0,0 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineminus">- *</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">- *</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">- * License.</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">- *</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineminus">- *</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">- *</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineminus">- *</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">- *</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">-//</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-//  MAPI IPC Routines</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-//  November 1997</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineminus">-//</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineminus">-#include &lt;windowsx.h&gt;</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineminus">-#include &lt;nscpmapi.h&gt;   // Should live in Communicator</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineminus">-</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineminus">-#include &quot;mapiipc.h&quot;</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineminus">-#include &quot;mapismem.h&quot;</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineminus">-#include &quot;trace.h&quot;</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineminus">-</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-#ifndef WIN32</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-#endif </span>
<a href="#l17.58"></a><span id="l17.58" class="difflineminus">-</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineminus">-//</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineminus">-// Necessary variables...</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineminus">-//</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineminus">-static LONG       instanceCount = 0;</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineminus">-HWND				      hWndMAPI = NULL;</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-char				      szClassName[] = &quot;NetscapeMAPIClient&quot;;</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineminus">-char              szWindowName[] = &quot;NetscapeMAPI&quot;;</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineminus">-</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineminus">-//</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineminus">-// External declares...</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineminus">-//</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineminus">-extern HINSTANCE  hInstance;</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineminus">-</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineminus">-void </span>
<a href="#l17.73"></a><span id="l17.73" class="difflineminus">-ProcessCommand(HWND hWnd, int id, HWND hCtl, UINT codeNotify) </span>
<a href="#l17.74"></a><span id="l17.74" class="difflineminus">-{ </span>
<a href="#l17.75"></a><span id="l17.75" class="difflineminus">-	switch (id) </span>
<a href="#l17.76"></a><span id="l17.76" class="difflineminus">-	{</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineminus">-	case IDOK:   </span>
<a href="#l17.78"></a><span id="l17.78" class="difflineminus">-	case IDCANCEL:</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineminus">-		{</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineminus">-			ShowWindow(hWnd, SW_HIDE);</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineminus">-		}</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineminus">-		</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineminus">-	default:</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineminus">-		;</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineminus">-	}</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineminus">-}</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineminus">-</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineminus">-BOOL CALLBACK LOADDS </span>
<a href="#l17.89"></a><span id="l17.89" class="difflineminus">-MyDlgProc(HWND hWndMain, UINT wMsg, WPARAM wParam, LPARAM lParam) </span>
<a href="#l17.90"></a><span id="l17.90" class="difflineminus">-{</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineminus">-  switch (wMsg) </span>
<a href="#l17.92"></a><span id="l17.92" class="difflineminus">-  {</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineminus">-  case WM_INITDIALOG: </span>
<a href="#l17.94"></a><span id="l17.94" class="difflineminus">-    {</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineminus">-      hWndMAPI = hWndMain;</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineminus">-    }</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineminus">-    break;</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineminus">-    </span>
<a href="#l17.99"></a><span id="l17.99" class="difflineminus">-  case WM_CLOSE:</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineminus">-//    DestroyWindow(hWndMain);</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineminus">-    break;</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineminus">-    </span>
<a href="#l17.103"></a><span id="l17.103" class="difflineminus">-  case WM_DESTROY:</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-    hWndMain = NULL;</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineminus">-    break;</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineminus">-</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineminus">-  case WM_COMMAND:</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineminus">-	  HANDLE_WM_COMMAND(hWndMAPI, wParam, lParam, ProcessCommand);</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineminus">-    break;</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineminus">-</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineminus">-  default:</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineminus">-    return FALSE;</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineminus">-  }</span>
<a href="#l17.114"></a><span id="l17.114" class="difflineminus">-</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineminus">-  return TRUE;</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineminus">-}</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineminus">-</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineminus">-BOOL </span>
<a href="#l17.119"></a><span id="l17.119" class="difflineminus">-InitInstance(HINSTANCE hInstance)</span>
<a href="#l17.120"></a><span id="l17.120" class="difflineminus">-{</span>
<a href="#l17.121"></a><span id="l17.121" class="difflineminus">-  //</span>
<a href="#l17.122"></a><span id="l17.122" class="difflineminus">-  // Create a main window for this application instance.  </span>
<a href="#l17.123"></a><span id="l17.123" class="difflineminus">-  //</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineminus">-  /* RICHIE - TRY SOME CHANGES!!!</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineminus">-  hWndMAPI = CreateDialog((HINSTANCE) hInstance, </span>
<a href="#l17.126"></a><span id="l17.126" class="difflineminus">-        MAKEINTRESOURCE(ID_DIALOG_QAHOOK),</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineminus">-        (HWND) NULL, (DLGPROC) MyDlgProc);</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineminus">-   ******/</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineminus">-  hWndMAPI = CreateWindow(</span>
<a href="#l17.130"></a><span id="l17.130" class="difflineminus">-              szClassName,	// pointer to registered class name</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineminus">-              szWindowName,	// pointer to window name</span>
<a href="#l17.132"></a><span id="l17.132" class="difflineminus">-              WS_CHILD,	    // window style</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineminus">-              -10,          	// horizontal position of window</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineminus">-              -10,	          // vertical position of window</span>
<a href="#l17.135"></a><span id="l17.135" class="difflineminus">-              1,	          // window width</span>
<a href="#l17.136"></a><span id="l17.136" class="difflineminus">-              1,	          // window height</span>
<a href="#l17.137"></a><span id="l17.137" class="difflineminus">-              GetDesktopWindow(),	// handle to parent or owner window</span>
<a href="#l17.138"></a><span id="l17.138" class="difflineminus">-              NULL,	        // handle to menu or child-window identifier</span>
<a href="#l17.139"></a><span id="l17.139" class="difflineminus">-              hInstance,	  // handle to application instance</span>
<a href="#l17.140"></a><span id="l17.140" class="difflineminus">-              NULL          // pointer to window-creation data</span>
<a href="#l17.141"></a><span id="l17.141" class="difflineminus">-              );</span>
<a href="#l17.142"></a><span id="l17.142" class="difflineminus">-  if (!hWndMAPI)</span>
<a href="#l17.143"></a><span id="l17.143" class="difflineminus">-    return FALSE;</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineminus">-  else</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineminus">-    return TRUE;</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineminus">-}</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineminus">-</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineminus">-BOOL </span>
<a href="#l17.149"></a><span id="l17.149" class="difflineminus">-InitApp(void)</span>
<a href="#l17.150"></a><span id="l17.150" class="difflineminus">-{</span>
<a href="#l17.151"></a><span id="l17.151" class="difflineminus">-#ifdef WIN32</span>
<a href="#l17.152"></a><span id="l17.152" class="difflineminus">-  WNDCLASS wc;</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineminus">-  wc.style         = 0; </span>
<a href="#l17.154"></a><span id="l17.154" class="difflineminus">-  wc.lpfnWndProc   = DefDlgProc; </span>
<a href="#l17.155"></a><span id="l17.155" class="difflineminus">-  wc.cbClsExtra    = 0; </span>
<a href="#l17.156"></a><span id="l17.156" class="difflineminus">-  wc.cbWndExtra    = DLGWINDOWEXTRA; </span>
<a href="#l17.157"></a><span id="l17.157" class="difflineminus">-  wc.hInstance     = hInstance; </span>
<a href="#l17.158"></a><span id="l17.158" class="difflineminus">-  wc.hIcon         = LoadIcon(hInstance, MAKEINTRESOURCE(ID_ICON_APP)); </span>
<a href="#l17.159"></a><span id="l17.159" class="difflineminus">-  wc.hCursor       = LoadCursor(0, IDC_ARROW); </span>
<a href="#l17.160"></a><span id="l17.160" class="difflineminus">-  wc.hbrBackground = (HBRUSH)(COLOR_BTNFACE + 1);</span>
<a href="#l17.161"></a><span id="l17.161" class="difflineminus">-  wc.lpszMenuName  = NULL; </span>
<a href="#l17.162"></a><span id="l17.162" class="difflineminus">-  wc.lpszClassName = szClassName;</span>
<a href="#l17.163"></a><span id="l17.163" class="difflineminus">-  </span>
<a href="#l17.164"></a><span id="l17.164" class="difflineminus">-  if(!RegisterClass(&amp;wc))</span>
<a href="#l17.165"></a><span id="l17.165" class="difflineminus">-    return FALSE;</span>
<a href="#l17.166"></a><span id="l17.166" class="difflineminus">-#endif</span>
<a href="#l17.167"></a><span id="l17.167" class="difflineminus">-  </span>
<a href="#l17.168"></a><span id="l17.168" class="difflineminus">-  return TRUE;</span>
<a href="#l17.169"></a><span id="l17.169" class="difflineminus">-} // end InitApp</span>
<a href="#l17.170"></a><span id="l17.170" class="difflineminus">-</span>
<a href="#l17.171"></a><span id="l17.171" class="difflineminus">-BOOL</span>
<a href="#l17.172"></a><span id="l17.172" class="difflineminus">-InitDLL(void)</span>
<a href="#l17.173"></a><span id="l17.173" class="difflineminus">-{</span>
<a href="#l17.174"></a><span id="l17.174" class="difflineminus">-  if (hWndMAPI != NULL)</span>
<a href="#l17.175"></a><span id="l17.175" class="difflineminus">-    return TRUE;</span>
<a href="#l17.176"></a><span id="l17.176" class="difflineminus">-</span>
<a href="#l17.177"></a><span id="l17.177" class="difflineminus">-  if (!InitApp()) </span>
<a href="#l17.178"></a><span id="l17.178" class="difflineminus">-  { </span>
<a href="#l17.179"></a><span id="l17.179" class="difflineminus">-    return FALSE;</span>
<a href="#l17.180"></a><span id="l17.180" class="difflineminus">-  }</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineminus">-  </span>
<a href="#l17.182"></a><span id="l17.182" class="difflineminus">-  if (!InitInstance(hInstance)) </span>
<a href="#l17.183"></a><span id="l17.183" class="difflineminus">-  {    </span>
<a href="#l17.184"></a><span id="l17.184" class="difflineminus">-    return FALSE;</span>
<a href="#l17.185"></a><span id="l17.185" class="difflineminus">-  }</span>
<a href="#l17.186"></a><span id="l17.186" class="difflineminus">-  </span>
<a href="#l17.187"></a><span id="l17.187" class="difflineminus">-//  ShowWindow(hWndMAPI, SW_SHOW);    Just for jollies</span>
<a href="#l17.188"></a><span id="l17.188" class="difflineminus">-  return(TRUE);</span>
<a href="#l17.189"></a><span id="l17.189" class="difflineminus">-}</span>
<a href="#l17.190"></a><span id="l17.190" class="difflineminus">-</span>
<a href="#l17.191"></a><span id="l17.191" class="difflineminus">-//*************************************************************</span>
<a href="#l17.192"></a><span id="l17.192" class="difflineminus">-//* Calls exposed for rest of DLL...</span>
<a href="#l17.193"></a><span id="l17.193" class="difflineminus">-//*************************************************************</span>
<a href="#l17.194"></a><span id="l17.194" class="difflineminus">-//</span>
<a href="#l17.195"></a><span id="l17.195" class="difflineminus">-// Purpose: Open the API</span>
<a href="#l17.196"></a><span id="l17.196" class="difflineminus">-// Return: 1 on success</span>
<a href="#l17.197"></a><span id="l17.197" class="difflineminus">-//         0 on failure</span>
<a href="#l17.198"></a><span id="l17.198" class="difflineminus">-//</span>
<a href="#l17.199"></a><span id="l17.199" class="difflineminus">-DWORD nsMAPI_OpenAPI(void)</span>
<a href="#l17.200"></a><span id="l17.200" class="difflineminus">-{</span>
<a href="#l17.201"></a><span id="l17.201" class="difflineminus">-  if (instanceCount &gt; 0)</span>
<a href="#l17.202"></a><span id="l17.202" class="difflineminus">-  {</span>
<a href="#l17.203"></a><span id="l17.203" class="difflineminus">-    return(1);</span>
<a href="#l17.204"></a><span id="l17.204" class="difflineminus">-  }</span>
<a href="#l17.205"></a><span id="l17.205" class="difflineminus">-</span>
<a href="#l17.206"></a><span id="l17.206" class="difflineminus">-  ++instanceCount;</span>
<a href="#l17.207"></a><span id="l17.207" class="difflineminus">-  return(1);</span>
<a href="#l17.208"></a><span id="l17.208" class="difflineminus">-}</span>
<a href="#l17.209"></a><span id="l17.209" class="difflineminus">-</span>
<a href="#l17.210"></a><span id="l17.210" class="difflineminus">-//</span>
<a href="#l17.211"></a><span id="l17.211" class="difflineminus">-// Purpose: Close the API</span>
<a href="#l17.212"></a><span id="l17.212" class="difflineminus">-//</span>
<a href="#l17.213"></a><span id="l17.213" class="difflineminus">-void nsMAPI_CloseAPI(void)</span>
<a href="#l17.214"></a><span id="l17.214" class="difflineminus">-{</span>
<a href="#l17.215"></a><span id="l17.215" class="difflineminus">-  --instanceCount;</span>
<a href="#l17.216"></a><span id="l17.216" class="difflineminus">-  if (instanceCount &lt;= 0)</span>
<a href="#l17.217"></a><span id="l17.217" class="difflineminus">-  {</span>
<a href="#l17.218"></a><span id="l17.218" class="difflineminus">-    instanceCount = 0;</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineminus">-  }</span>
<a href="#l17.220"></a><span id="l17.220" class="difflineminus">-</span>
<a href="#l17.221"></a><span id="l17.221" class="difflineminus">-  return;</span>
<a href="#l17.222"></a><span id="l17.222" class="difflineminus">-}</span>
<a href="#l17.223"></a><span id="l17.223" class="difflineminus">-</span>
<a href="#l17.224"></a><span id="l17.224" class="difflineminus">-//</span>
<a href="#l17.225"></a><span id="l17.225" class="difflineminus">-// Send the actual request to Communicator</span>
<a href="#l17.226"></a><span id="l17.226" class="difflineminus">-//</span>
<a href="#l17.227"></a><span id="l17.227" class="difflineminus">-LRESULT</span>
<a href="#l17.228"></a><span id="l17.228" class="difflineminus">-SendMAPIRequest(HWND hWnd, </span>
<a href="#l17.229"></a><span id="l17.229" class="difflineminus">-                DWORD mapiRequestID, </span>
<a href="#l17.230"></a><span id="l17.230" class="difflineminus">-                MAPIIPCType *ipcInfo)</span>
<a href="#l17.231"></a><span id="l17.231" class="difflineminus">-{</span>
<a href="#l17.232"></a><span id="l17.232" class="difflineminus">-LRESULT         returnVal = 0;</span>
<a href="#l17.233"></a><span id="l17.233" class="difflineminus">-COPYDATASTRUCT  cds;</span>
<a href="#l17.234"></a><span id="l17.234" class="difflineminus">-</span>
<a href="#l17.235"></a><span id="l17.235" class="difflineminus">-  if (!InitDLL())</span>
<a href="#l17.236"></a><span id="l17.236" class="difflineminus">-  {</span>
<a href="#l17.237"></a><span id="l17.237" class="difflineminus">-    return 0;</span>
<a href="#l17.238"></a><span id="l17.238" class="difflineminus">-  }</span>
<a href="#l17.239"></a><span id="l17.239" class="difflineminus">-</span>
<a href="#l17.240"></a><span id="l17.240" class="difflineminus">-  cds.dwData = mapiRequestID;</span>
<a href="#l17.241"></a><span id="l17.241" class="difflineminus">-  cds.cbData = sizeof(MAPIIPCType);</span>
<a href="#l17.242"></a><span id="l17.242" class="difflineminus">-  cds.lpData = ipcInfo;</span>
<a href="#l17.243"></a><span id="l17.243" class="difflineminus">-</span>
<a href="#l17.244"></a><span id="l17.244" class="difflineminus">-  // Make the call into Communicator</span>
<a href="#l17.245"></a><span id="l17.245" class="difflineminus">-  returnVal = SendMessage(hWnd, WM_COPYDATA, (WPARAM) hWndMAPI, (LPARAM) &amp;cds);</span>
<a href="#l17.246"></a><span id="l17.246" class="difflineminus">-</span>
<a href="#l17.247"></a><span id="l17.247" class="difflineminus">-  // Now kill the window...</span>
<a href="#l17.248"></a><span id="l17.248" class="difflineminus">-  DestroyWindow(hWndMAPI);</span>
<a href="#l17.249"></a><span id="l17.249" class="difflineminus">-  hWndMAPI = NULL;</span>
<a href="#l17.250"></a><span id="l17.250" class="difflineminus">-  UnregisterClass(szClassName, hInstance);</span>
<a href="#l17.251"></a><span id="l17.251" class="difflineminus">-  </span>
<a href="#l17.252"></a><span id="l17.252" class="difflineminus">-  return returnVal;</span>
<a href="#l17.253"></a><span id="l17.253" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">deleted file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/mapiipc.h</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ /dev/null</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -1,63 +0,0 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineminus">- *</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">- *</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">- * License.</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">- *</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineminus">- *</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">- *</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineminus">- *</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">- *</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">-#ifndef __MAPIIPC_HPP__</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-#define __MAPIIPC_HPP__</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineminus">-</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineminus">-#include &quot;port.h&quot;</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineminus">-#include &lt;nscpmapi.h&gt;</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineminus">-</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineminus">-//********************************************************</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineminus">-// Open and close functions for API</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineminus">-//********************************************************</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-// Open the API</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineminus">-// Return: 1 on success, 0 on failure</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineminus">-//</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineminus">-DWORD nsMAPI_OpenAPI(void);</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineminus">-</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineminus">-//</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineminus">-// Purpose: Close the API</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineminus">-//</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineminus">-void  nsMAPI_CloseAPI(void);</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineminus">-</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineminus">-//</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineminus">-// Send the actual request to Communicator</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineminus">-//</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineminus">-LRESULT   SendMAPIRequest(HWND hWnd, </span>
<a href="#l18.64"></a><span id="l18.64" class="difflineminus">-                DWORD mapiRequestID, </span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-                MAPIIPCType *ipcInfo);</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineminus">-</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineminus">-#endif // __MAPIIPC_HPP__</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">deleted file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/mapimem.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ /dev/null</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -1,363 +0,0 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineminus">- *</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">- *</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">- * License.</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">- *</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">- *</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineminus">- *</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineminus">- *</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineminus">- *</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">-//</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-//  mem.cpp</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineminus">-//  November 1997</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineminus">-//  This implements various memory management functions for use with</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineminus">-//  MAPI features of Communicator</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineminus">-//</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineminus">-#include &lt;windows.h&gt;     </span>
<a href="#l19.49"></a><span id="l19.49" class="difflineminus">-#include &lt;memory.h&gt; </span>
<a href="#l19.50"></a><span id="l19.50" class="difflineminus">-#include &lt;malloc.h&gt;</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineminus">-#include &quot;mapimem.h&quot;</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineminus">-#include &lt;nscpmapi.h&gt;   // lives in communicator winfe</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineminus">-#include &quot;nsstrseq.h&quot;</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-#include &quot;trace.h&quot;</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineminus">-#include &quot;mapiutl.h&quot;</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineminus">-#include &quot;xpapi.h&quot;</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineminus">-</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineminus">-LPSTR</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineminus">-CheckNullString(LPSTR inStr)</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineminus">-{</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineminus">-  static UCHAR  str[1];</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineminus">-</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineminus">-  str[0] = '\0';</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineminus">-  if (inStr == NULL)</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineminus">-    return((LPSTR)str);</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineminus">-  else</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineminus">-    return(inStr);</span>
<a href="#l19.68"></a><span id="l19.68" class="difflineminus">-}</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineminus">-</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineminus">-void</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineminus">-FreeMAPIFile(lpMapiFileDesc pv)</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineminus">-{</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineminus">-  if (!pv)</span>
<a href="#l19.74"></a><span id="l19.74" class="difflineminus">-    return;</span>
<a href="#l19.75"></a><span id="l19.75" class="difflineminus">-</span>
<a href="#l19.76"></a><span id="l19.76" class="difflineminus">-  if (pv-&gt;lpszPathName != NULL)   </span>
<a href="#l19.77"></a><span id="l19.77" class="difflineminus">-    free(pv-&gt;lpszPathName);</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineminus">-</span>
<a href="#l19.79"></a><span id="l19.79" class="difflineminus">-  if (pv-&gt;lpszFileName != NULL)   </span>
<a href="#l19.80"></a><span id="l19.80" class="difflineminus">-    free(pv-&gt;lpszFileName);</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineminus">-}</span>
<a href="#l19.82"></a><span id="l19.82" class="difflineminus">-</span>
<a href="#l19.83"></a><span id="l19.83" class="difflineminus">-void</span>
<a href="#l19.84"></a><span id="l19.84" class="difflineminus">-FreeMAPIMessage(lpMapiMessage pv)</span>
<a href="#l19.85"></a><span id="l19.85" class="difflineminus">-{</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineminus">-  ULONG i;</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineminus">-</span>
<a href="#l19.88"></a><span id="l19.88" class="difflineminus">-  if (!pv)</span>
<a href="#l19.89"></a><span id="l19.89" class="difflineminus">-    return;</span>
<a href="#l19.90"></a><span id="l19.90" class="difflineminus">-</span>
<a href="#l19.91"></a><span id="l19.91" class="difflineminus">-  if (pv-&gt;lpszSubject != NULL)</span>
<a href="#l19.92"></a><span id="l19.92" class="difflineminus">-    free(pv-&gt;lpszSubject);</span>
<a href="#l19.93"></a><span id="l19.93" class="difflineminus">-</span>
<a href="#l19.94"></a><span id="l19.94" class="difflineminus">-  if (pv-&gt;lpszNoteText)</span>
<a href="#l19.95"></a><span id="l19.95" class="difflineminus">-      free(pv-&gt;lpszNoteText);</span>
<a href="#l19.96"></a><span id="l19.96" class="difflineminus">-  </span>
<a href="#l19.97"></a><span id="l19.97" class="difflineminus">-  if (pv-&gt;lpszMessageType)</span>
<a href="#l19.98"></a><span id="l19.98" class="difflineminus">-    free(pv-&gt;lpszMessageType);</span>
<a href="#l19.99"></a><span id="l19.99" class="difflineminus">-  </span>
<a href="#l19.100"></a><span id="l19.100" class="difflineminus">-  if (pv-&gt;lpszDateReceived)</span>
<a href="#l19.101"></a><span id="l19.101" class="difflineminus">-    free(pv-&gt;lpszDateReceived);</span>
<a href="#l19.102"></a><span id="l19.102" class="difflineminus">-  </span>
<a href="#l19.103"></a><span id="l19.103" class="difflineminus">-  if (pv-&gt;lpszConversationID)</span>
<a href="#l19.104"></a><span id="l19.104" class="difflineminus">-    free(pv-&gt;lpszConversationID);</span>
<a href="#l19.105"></a><span id="l19.105" class="difflineminus">-  </span>
<a href="#l19.106"></a><span id="l19.106" class="difflineminus">-  if (pv-&gt;lpOriginator)</span>
<a href="#l19.107"></a><span id="l19.107" class="difflineminus">-    FreeMAPIRecipient(pv-&gt;lpOriginator);</span>
<a href="#l19.108"></a><span id="l19.108" class="difflineminus">-  </span>
<a href="#l19.109"></a><span id="l19.109" class="difflineminus">-  for (i=0; i&lt;pv-&gt;nRecipCount; i++)</span>
<a href="#l19.110"></a><span id="l19.110" class="difflineminus">-  {</span>
<a href="#l19.111"></a><span id="l19.111" class="difflineminus">-    if (&amp;(pv-&gt;lpRecips[i]) != NULL)</span>
<a href="#l19.112"></a><span id="l19.112" class="difflineminus">-    {</span>
<a href="#l19.113"></a><span id="l19.113" class="difflineminus">-      FreeMAPIRecipient(&amp;(pv-&gt;lpRecips[i]));</span>
<a href="#l19.114"></a><span id="l19.114" class="difflineminus">-    }</span>
<a href="#l19.115"></a><span id="l19.115" class="difflineminus">-  }</span>
<a href="#l19.116"></a><span id="l19.116" class="difflineminus">-</span>
<a href="#l19.117"></a><span id="l19.117" class="difflineminus">-  if (pv-&gt;lpRecips != NULL)</span>
<a href="#l19.118"></a><span id="l19.118" class="difflineminus">-  {</span>
<a href="#l19.119"></a><span id="l19.119" class="difflineminus">-    free(pv-&gt;lpRecips);</span>
<a href="#l19.120"></a><span id="l19.120" class="difflineminus">-  }</span>
<a href="#l19.121"></a><span id="l19.121" class="difflineminus">-</span>
<a href="#l19.122"></a><span id="l19.122" class="difflineminus">-  for (i=0; i&lt;pv-&gt;nFileCount; i++)</span>
<a href="#l19.123"></a><span id="l19.123" class="difflineminus">-  {</span>
<a href="#l19.124"></a><span id="l19.124" class="difflineminus">-    if (&amp;(pv-&gt;lpFiles[i]) != NULL)</span>
<a href="#l19.125"></a><span id="l19.125" class="difflineminus">-    {</span>
<a href="#l19.126"></a><span id="l19.126" class="difflineminus">-      FreeMAPIFile(&amp;(pv-&gt;lpFiles[i]));</span>
<a href="#l19.127"></a><span id="l19.127" class="difflineminus">-    }</span>
<a href="#l19.128"></a><span id="l19.128" class="difflineminus">-  }</span>
<a href="#l19.129"></a><span id="l19.129" class="difflineminus">-</span>
<a href="#l19.130"></a><span id="l19.130" class="difflineminus">-  if (pv-&gt;lpFiles != NULL)</span>
<a href="#l19.131"></a><span id="l19.131" class="difflineminus">-  {</span>
<a href="#l19.132"></a><span id="l19.132" class="difflineminus">-    free(pv-&gt;lpFiles);</span>
<a href="#l19.133"></a><span id="l19.133" class="difflineminus">-  }</span>
<a href="#l19.134"></a><span id="l19.134" class="difflineminus">-  </span>
<a href="#l19.135"></a><span id="l19.135" class="difflineminus">-  free(pv);</span>
<a href="#l19.136"></a><span id="l19.136" class="difflineminus">-  pv = NULL;</span>
<a href="#l19.137"></a><span id="l19.137" class="difflineminus">-}</span>
<a href="#l19.138"></a><span id="l19.138" class="difflineminus">-</span>
<a href="#l19.139"></a><span id="l19.139" class="difflineminus">-void</span>
<a href="#l19.140"></a><span id="l19.140" class="difflineminus">-FreeMAPIRecipient(lpMapiRecipDesc pv)</span>
<a href="#l19.141"></a><span id="l19.141" class="difflineminus">-{</span>
<a href="#l19.142"></a><span id="l19.142" class="difflineminus">-  if (!pv)</span>
<a href="#l19.143"></a><span id="l19.143" class="difflineminus">-    return;</span>
<a href="#l19.144"></a><span id="l19.144" class="difflineminus">-</span>
<a href="#l19.145"></a><span id="l19.145" class="difflineminus">-  if (pv-&gt;lpszName != NULL)   </span>
<a href="#l19.146"></a><span id="l19.146" class="difflineminus">-    free(pv-&gt;lpszName);</span>
<a href="#l19.147"></a><span id="l19.147" class="difflineminus">-</span>
<a href="#l19.148"></a><span id="l19.148" class="difflineminus">-  if (pv-&gt;lpszAddress != NULL)</span>
<a href="#l19.149"></a><span id="l19.149" class="difflineminus">-    free(pv-&gt;lpszAddress);</span>
<a href="#l19.150"></a><span id="l19.150" class="difflineminus">-</span>
<a href="#l19.151"></a><span id="l19.151" class="difflineminus">-  if (pv-&gt;lpEntryID != NULL)</span>
<a href="#l19.152"></a><span id="l19.152" class="difflineminus">-    free(pv-&gt;lpEntryID);  </span>
<a href="#l19.153"></a><span id="l19.153" class="difflineminus">-}</span>
<a href="#l19.154"></a><span id="l19.154" class="difflineminus">-</span>
<a href="#l19.155"></a><span id="l19.155" class="difflineminus">-//</span>
<a href="#l19.156"></a><span id="l19.156" class="difflineminus">-// This routine will take an lpMapiMessage structure and &quot;flatten&quot; it into</span>
<a href="#l19.157"></a><span id="l19.157" class="difflineminus">-// one contiguous chunk of memory that can be easily passed around. After this</span>
<a href="#l19.158"></a><span id="l19.158" class="difflineminus">-// is done, &quot;extract&quot; routines will be written to get complicated string routines</span>
<a href="#l19.159"></a><span id="l19.159" class="difflineminus">-// out of the chunk of memory at the end.</span>
<a href="#l19.160"></a><span id="l19.160" class="difflineminus">-// </span>
<a href="#l19.161"></a><span id="l19.161" class="difflineminus">-LPVOID</span>
<a href="#l19.162"></a><span id="l19.162" class="difflineminus">-FlattenMAPIMessageStructure(lpMapiMessage msg, DWORD *totalSize)</span>
<a href="#l19.163"></a><span id="l19.163" class="difflineminus">-{</span>
<a href="#l19.164"></a><span id="l19.164" class="difflineminus">-  MAPISendMailType    *mailPtr;</span>
<a href="#l19.165"></a><span id="l19.165" class="difflineminus">-  LPSTR               *strArray;</span>
<a href="#l19.166"></a><span id="l19.166" class="difflineminus">-  DWORD               strCount = 0;</span>
<a href="#l19.167"></a><span id="l19.167" class="difflineminus">-  DWORD               currentString = 0;</span>
<a href="#l19.168"></a><span id="l19.168" class="difflineminus">-  DWORD               arrayBufSize = 0;</span>
<a href="#l19.169"></a><span id="l19.169" class="difflineminus">-  DWORD               i;</span>
<a href="#l19.170"></a><span id="l19.170" class="difflineminus">-</span>
<a href="#l19.171"></a><span id="l19.171" class="difflineminus">-  *totalSize = 0;</span>
<a href="#l19.172"></a><span id="l19.172" class="difflineminus">-  if (!msg)</span>
<a href="#l19.173"></a><span id="l19.173" class="difflineminus">-    return(NULL);</span>
<a href="#l19.174"></a><span id="l19.174" class="difflineminus">-</span>
<a href="#l19.175"></a><span id="l19.175" class="difflineminus">-  //</span>
<a href="#l19.176"></a><span id="l19.176" class="difflineminus">-  // Allocate the initial structure to hold all of the mail info.</span>
<a href="#l19.177"></a><span id="l19.177" class="difflineminus">-  //</span>
<a href="#l19.178"></a><span id="l19.178" class="difflineminus">-  *totalSize = sizeof(MAPISendMailType);</span>
<a href="#l19.179"></a><span id="l19.179" class="difflineminus">-  mailPtr = (MAPISendMailType *) malloc(sizeof(MAPISendMailType));</span>
<a href="#l19.180"></a><span id="l19.180" class="difflineminus">-  if (!mailPtr)</span>
<a href="#l19.181"></a><span id="l19.181" class="difflineminus">-    return(NULL);</span>
<a href="#l19.182"></a><span id="l19.182" class="difflineminus">-  memset(mailPtr, 0, sizeof(MAPISendMailType));</span>
<a href="#l19.183"></a><span id="l19.183" class="difflineminus">-</span>
<a href="#l19.184"></a><span id="l19.184" class="difflineminus">-  //</span>
<a href="#l19.185"></a><span id="l19.185" class="difflineminus">-  // First, assign all of the easy numeric values...</span>
<a href="#l19.186"></a><span id="l19.186" class="difflineminus">-  //</span>
<a href="#l19.187"></a><span id="l19.187" class="difflineminus">-  mailPtr-&gt;MSG_flFlags = msg-&gt;flFlags;          // unread,return receipt</span>
<a href="#l19.188"></a><span id="l19.188" class="difflineminus">-  mailPtr-&gt;MSG_nRecipCount = msg-&gt;nRecipCount;  // Number of recipients</span>
<a href="#l19.189"></a><span id="l19.189" class="difflineminus">-  mailPtr-&gt;MSG_nFileCount = msg-&gt;nFileCount;    // # of file attachments</span>
<a href="#l19.190"></a><span id="l19.190" class="difflineminus">-  if (msg-&gt;lpOriginator != NULL)</span>
<a href="#l19.191"></a><span id="l19.191" class="difflineminus">-  {</span>
<a href="#l19.192"></a><span id="l19.192" class="difflineminus">-    mailPtr-&gt;MSG_ORIG_ulRecipClass = msg-&gt;lpOriginator-&gt;ulRecipClass; //  Recipient class - MAPI_TO, MAPI_CC, MAPI_BCC, MAPI_ORIG</span>
<a href="#l19.193"></a><span id="l19.193" class="difflineminus">-  }</span>
<a href="#l19.194"></a><span id="l19.194" class="difflineminus">-</span>
<a href="#l19.195"></a><span id="l19.195" class="difflineminus">-  //</span>
<a href="#l19.196"></a><span id="l19.196" class="difflineminus">-  // Now, figure out how many string pointers we need...</span>
<a href="#l19.197"></a><span id="l19.197" class="difflineminus">-  //</span>
<a href="#l19.198"></a><span id="l19.198" class="difflineminus">-  strCount = 4;     // These are the 4 KNOWN strings up front for a message</span>
<a href="#l19.199"></a><span id="l19.199" class="difflineminus">-  strCount += 2;    // This is for the originator name and address</span>
<a href="#l19.200"></a><span id="l19.200" class="difflineminus">-</span>
<a href="#l19.201"></a><span id="l19.201" class="difflineminus">-  strCount += msg-&gt;nRecipCount * 3; // Name, address &amp; class (cc, bcc) for each recipient</span>
<a href="#l19.202"></a><span id="l19.202" class="difflineminus">-  strCount += msg-&gt;nFileCount  * 2; // filename and display name for each attachment</span>
<a href="#l19.203"></a><span id="l19.203" class="difflineminus">-</span>
<a href="#l19.204"></a><span id="l19.204" class="difflineminus">-  // </span>
<a href="#l19.205"></a><span id="l19.205" class="difflineminus">-  // Now allocate a new string sequence...add one entry for NULL at the end</span>
<a href="#l19.206"></a><span id="l19.206" class="difflineminus">-  //  </span>
<a href="#l19.207"></a><span id="l19.207" class="difflineminus">-  arrayBufSize = sizeof(LPSTR) * (strCount + 1);</span>
<a href="#l19.208"></a><span id="l19.208" class="difflineminus">-</span>
<a href="#l19.209"></a><span id="l19.209" class="difflineminus">-#ifdef WIN16    // Check for max mem allocation...</span>
<a href="#l19.210"></a><span id="l19.210" class="difflineminus">-  if ((sizeof(MAPISendMailType) + arrayBufSize) &gt; 64000)</span>
<a href="#l19.211"></a><span id="l19.211" class="difflineminus">-  {</span>
<a href="#l19.212"></a><span id="l19.212" class="difflineminus">-    free(mailPtr);</span>
<a href="#l19.213"></a><span id="l19.213" class="difflineminus">-    return NULL;</span>
<a href="#l19.214"></a><span id="l19.214" class="difflineminus">-  }</span>
<a href="#l19.215"></a><span id="l19.215" class="difflineminus">-#endif</span>
<a href="#l19.216"></a><span id="l19.216" class="difflineminus">-</span>
<a href="#l19.217"></a><span id="l19.217" class="difflineminus">-  //</span>
<a href="#l19.218"></a><span id="l19.218" class="difflineminus">-  // Allocate a buffer for the string pointers and if this fails, </span>
<a href="#l19.219"></a><span id="l19.219" class="difflineminus">-  // cleanup and return.</span>
<a href="#l19.220"></a><span id="l19.220" class="difflineminus">-  // </span>
<a href="#l19.221"></a><span id="l19.221" class="difflineminus">-  strArray = (LPSTR *)malloc( (size_t) arrayBufSize);</span>
<a href="#l19.222"></a><span id="l19.222" class="difflineminus">-  if (!strArray)</span>
<a href="#l19.223"></a><span id="l19.223" class="difflineminus">-  {</span>
<a href="#l19.224"></a><span id="l19.224" class="difflineminus">-    free(mailPtr);</span>
<a href="#l19.225"></a><span id="l19.225" class="difflineminus">-    return NULL;</span>
<a href="#l19.226"></a><span id="l19.226" class="difflineminus">-  }</span>
<a href="#l19.227"></a><span id="l19.227" class="difflineminus">-</span>
<a href="#l19.228"></a><span id="l19.228" class="difflineminus">-  memset(strArray, 0, (size_t) arrayBufSize);  // Set the array to NULL</span>
<a href="#l19.229"></a><span id="l19.229" class="difflineminus">-  strArray[currentString++] = CheckNullString(msg-&gt;lpszSubject);        // Message Subject</span>
<a href="#l19.230"></a><span id="l19.230" class="difflineminus">-  strArray[currentString++] = CheckNullString(msg-&gt;lpszNoteText);       // Message Text  </span>
<a href="#l19.231"></a><span id="l19.231" class="difflineminus">-  strArray[currentString++] = CheckNullString(msg-&gt;lpszDateReceived);   // in YYYY/MM/DD HH:MM format</span>
<a href="#l19.232"></a><span id="l19.232" class="difflineminus">-  strArray[currentString++] = CheckNullString(msg-&gt;lpszConversationID); // conversation thread ID</span>
<a href="#l19.233"></a><span id="l19.233" class="difflineminus">-</span>
<a href="#l19.234"></a><span id="l19.234" class="difflineminus">-  if (msg-&gt;lpOriginator)</span>
<a href="#l19.235"></a><span id="l19.235" class="difflineminus">-  {</span>
<a href="#l19.236"></a><span id="l19.236" class="difflineminus">-    strArray[currentString++] = CheckNullString(msg-&gt;lpOriginator[0].lpszName);</span>
<a href="#l19.237"></a><span id="l19.237" class="difflineminus">-    strArray[currentString++] = CheckNullString(msg-&gt;lpOriginator[0].lpszAddress);</span>
<a href="#l19.238"></a><span id="l19.238" class="difflineminus">-  }</span>
<a href="#l19.239"></a><span id="l19.239" class="difflineminus">-  else</span>
<a href="#l19.240"></a><span id="l19.240" class="difflineminus">-  {</span>
<a href="#l19.241"></a><span id="l19.241" class="difflineminus">-    strArray[currentString++] = CheckNullString(NULL);</span>
<a href="#l19.242"></a><span id="l19.242" class="difflineminus">-    strArray[currentString++] = CheckNullString(NULL);</span>
<a href="#l19.243"></a><span id="l19.243" class="difflineminus">-  }</span>
<a href="#l19.244"></a><span id="l19.244" class="difflineminus">-</span>
<a href="#l19.245"></a><span id="l19.245" class="difflineminus">-  //</span>
<a href="#l19.246"></a><span id="l19.246" class="difflineminus">-  // Assign pointers for the Name and address of each recipient</span>
<a href="#l19.247"></a><span id="l19.247" class="difflineminus">-  //</span>
<a href="#l19.248"></a><span id="l19.248" class="difflineminus">-  LPSTR toString  = &quot;1&quot;;</span>
<a href="#l19.249"></a><span id="l19.249" class="difflineminus">-  LPSTR ccString  = &quot;2&quot;;</span>
<a href="#l19.250"></a><span id="l19.250" class="difflineminus">-  LPSTR bccString = &quot;3&quot;;</span>
<a href="#l19.251"></a><span id="l19.251" class="difflineminus">-</span>
<a href="#l19.252"></a><span id="l19.252" class="difflineminus">-  for (i=0; i&lt;msg-&gt;nRecipCount; i++)</span>
<a href="#l19.253"></a><span id="l19.253" class="difflineminus">-  {</span>
<a href="#l19.254"></a><span id="l19.254" class="difflineminus">-    // rhp - need message class</span>
<a href="#l19.255"></a><span id="l19.255" class="difflineminus">-    if (msg-&gt;lpRecips[i].ulRecipClass == MAPI_BCC)</span>
<a href="#l19.256"></a><span id="l19.256" class="difflineminus">-      strArray[currentString++] = CheckNullString(bccString);</span>
<a href="#l19.257"></a><span id="l19.257" class="difflineminus">-    else if (msg-&gt;lpRecips[i].ulRecipClass == MAPI_CC)</span>
<a href="#l19.258"></a><span id="l19.258" class="difflineminus">-      strArray[currentString++] = CheckNullString(ccString);</span>
<a href="#l19.259"></a><span id="l19.259" class="difflineminus">-    else</span>
<a href="#l19.260"></a><span id="l19.260" class="difflineminus">-      strArray[currentString++] = CheckNullString(toString);</span>
<a href="#l19.261"></a><span id="l19.261" class="difflineminus">-</span>
<a href="#l19.262"></a><span id="l19.262" class="difflineminus">-    strArray[currentString++] = CheckNullString(msg-&gt;lpRecips[i].lpszName);</span>
<a href="#l19.263"></a><span id="l19.263" class="difflineminus">-    strArray[currentString++] = CheckNullString(msg-&gt;lpRecips[i].lpszAddress);  </span>
<a href="#l19.264"></a><span id="l19.264" class="difflineminus">-  }</span>
<a href="#l19.265"></a><span id="l19.265" class="difflineminus">-</span>
<a href="#l19.266"></a><span id="l19.266" class="difflineminus">-  BYTE    szNewFileName[_MAX_PATH];</span>
<a href="#l19.267"></a><span id="l19.267" class="difflineminus">-</span>
<a href="#l19.268"></a><span id="l19.268" class="difflineminus">-  for (i=0; i&lt;msg-&gt;nFileCount; i++)</span>
<a href="#l19.269"></a><span id="l19.269" class="difflineminus">-  {</span>
<a href="#l19.270"></a><span id="l19.270" class="difflineminus">-    char *namePtr;</span>
<a href="#l19.271"></a><span id="l19.271" class="difflineminus">-    // have to copy/create temp files here of office won't work...</span>
<a href="#l19.272"></a><span id="l19.272" class="difflineminus">-</span>
<a href="#l19.273"></a><span id="l19.273" class="difflineminus">-    if ( </span>
<a href="#l19.274"></a><span id="l19.274" class="difflineminus">-          (msg-&gt;lpFiles[i].lpszFileName != NULL) &amp;&amp;</span>
<a href="#l19.275"></a><span id="l19.275" class="difflineminus">-          (*msg-&gt;lpFiles[i].lpszFileName != '\0') </span>
<a href="#l19.276"></a><span id="l19.276" class="difflineminus">-       )</span>
<a href="#l19.277"></a><span id="l19.277" class="difflineminus">-    {</span>
<a href="#l19.278"></a><span id="l19.278" class="difflineminus">-      namePtr = (char *)msg-&gt;lpFiles[i].lpszFileName;</span>
<a href="#l19.279"></a><span id="l19.279" class="difflineminus">-    }</span>
<a href="#l19.280"></a><span id="l19.280" class="difflineminus">-    else</span>
<a href="#l19.281"></a><span id="l19.281" class="difflineminus">-    {</span>
<a href="#l19.282"></a><span id="l19.282" class="difflineminus">-      namePtr = (char *)msg-&gt;lpFiles[i].lpszPathName;</span>
<a href="#l19.283"></a><span id="l19.283" class="difflineminus">-    }</span>
<a href="#l19.284"></a><span id="l19.284" class="difflineminus">-</span>
<a href="#l19.285"></a><span id="l19.285" class="difflineminus">-    if (GetTempMailNameWithExtension((char *)szNewFileName, namePtr) == 0)</span>
<a href="#l19.286"></a><span id="l19.286" class="difflineminus">-    {</span>
<a href="#l19.287"></a><span id="l19.287" class="difflineminus">-      free(strArray);</span>
<a href="#l19.288"></a><span id="l19.288" class="difflineminus">-      free(mailPtr);</span>
<a href="#l19.289"></a><span id="l19.289" class="difflineminus">-      return NULL;</span>
<a href="#l19.290"></a><span id="l19.290" class="difflineminus">-    }</span>
<a href="#l19.291"></a><span id="l19.291" class="difflineminus">-    </span>
<a href="#l19.292"></a><span id="l19.292" class="difflineminus">-    if (!XP_CopyFile((char *)msg-&gt;lpFiles[i].lpszPathName, (char *)szNewFileName, TRUE))</span>
<a href="#l19.293"></a><span id="l19.293" class="difflineminus">-    {</span>
<a href="#l19.294"></a><span id="l19.294" class="difflineminus">-      free(strArray);</span>
<a href="#l19.295"></a><span id="l19.295" class="difflineminus">-      free(mailPtr);</span>
<a href="#l19.296"></a><span id="l19.296" class="difflineminus">-      return NULL;</span>
<a href="#l19.297"></a><span id="l19.297" class="difflineminus">-    }</span>
<a href="#l19.298"></a><span id="l19.298" class="difflineminus">-</span>
<a href="#l19.299"></a><span id="l19.299" class="difflineminus">-    strArray[currentString++] = CheckNullString((char *)szNewFileName);</span>
<a href="#l19.300"></a><span id="l19.300" class="difflineminus">-    strArray[currentString++] = CheckNullString(msg-&gt;lpFiles[i].lpszFileName);</span>
<a href="#l19.301"></a><span id="l19.301" class="difflineminus">-</span>
<a href="#l19.302"></a><span id="l19.302" class="difflineminus">-    AddTempFile((LPSTR) szNewFileName);</span>
<a href="#l19.303"></a><span id="l19.303" class="difflineminus">-//    strArray[currentString++] = CheckNullString(msg-&gt;lpFiles[i].lpszPathName);</span>
<a href="#l19.304"></a><span id="l19.304" class="difflineminus">-//    strArray[currentString++] = CheckNullString(msg-&gt;lpFiles[i].lpszFileName);</span>
<a href="#l19.305"></a><span id="l19.305" class="difflineminus">-  }</span>
<a href="#l19.306"></a><span id="l19.306" class="difflineminus">-</span>
<a href="#l19.307"></a><span id="l19.307" class="difflineminus">-  if (currentString != strCount)</span>
<a href="#l19.308"></a><span id="l19.308" class="difflineminus">-  {</span>
<a href="#l19.309"></a><span id="l19.309" class="difflineminus">-    TRACE(&quot;MAPI PROBLEM!!!!!! FlattenMAPIMessageStructure() currentString != strCount\n&quot;);</span>
<a href="#l19.310"></a><span id="l19.310" class="difflineminus">-  }</span>
<a href="#l19.311"></a><span id="l19.311" class="difflineminus">-</span>
<a href="#l19.312"></a><span id="l19.312" class="difflineminus">-  strArray[strCount] = NULL;    // terminate at the end</span>
<a href="#l19.313"></a><span id="l19.313" class="difflineminus">-  NSstringSeq strSeq = NSStrSeqNew(strArray);</span>
<a href="#l19.314"></a><span id="l19.314" class="difflineminus">-  if (!strSeq)</span>
<a href="#l19.315"></a><span id="l19.315" class="difflineminus">-  {</span>
<a href="#l19.316"></a><span id="l19.316" class="difflineminus">-    free(strArray);</span>
<a href="#l19.317"></a><span id="l19.317" class="difflineminus">-    free(mailPtr);</span>
<a href="#l19.318"></a><span id="l19.318" class="difflineminus">-    return NULL;</span>
<a href="#l19.319"></a><span id="l19.319" class="difflineminus">-  }</span>
<a href="#l19.320"></a><span id="l19.320" class="difflineminus">-  </span>
<a href="#l19.321"></a><span id="l19.321" class="difflineminus">-  //</span>
<a href="#l19.322"></a><span id="l19.322" class="difflineminus">-  // Now we need to copy the structure into a big, contiguous chunk of memory</span>
<a href="#l19.323"></a><span id="l19.323" class="difflineminus">-  //</span>
<a href="#l19.324"></a><span id="l19.324" class="difflineminus">-  LONG totalArraySize = NSStrSeqSize(strSeq);</span>
<a href="#l19.325"></a><span id="l19.325" class="difflineminus">-  LONG totalMemSize = sizeof(MAPISendMailType) + totalArraySize;</span>
<a href="#l19.326"></a><span id="l19.326" class="difflineminus">-</span>
<a href="#l19.327"></a><span id="l19.327" class="difflineminus">-#ifdef WIN16</span>
<a href="#l19.328"></a><span id="l19.328" class="difflineminus">-  if (totalMemSize &gt; 64000)</span>
<a href="#l19.329"></a><span id="l19.329" class="difflineminus">-  {</span>
<a href="#l19.330"></a><span id="l19.330" class="difflineminus">-    free(strArray);</span>
<a href="#l19.331"></a><span id="l19.331" class="difflineminus">-    NSStrSeqDelete(strSeq);</span>
<a href="#l19.332"></a><span id="l19.332" class="difflineminus">-    free(mailPtr);</span>
<a href="#l19.333"></a><span id="l19.333" class="difflineminus">-    return NULL;</span>
<a href="#l19.334"></a><span id="l19.334" class="difflineminus">-  }</span>
<a href="#l19.335"></a><span id="l19.335" class="difflineminus">-#endif</span>
<a href="#l19.336"></a><span id="l19.336" class="difflineminus">-</span>
<a href="#l19.337"></a><span id="l19.337" class="difflineminus">-  MAPISendMailType *newMailPtr = (MAPISendMailType *)malloc((size_t)totalMemSize);</span>
<a href="#l19.338"></a><span id="l19.338" class="difflineminus">-  if (!newMailPtr)</span>
<a href="#l19.339"></a><span id="l19.339" class="difflineminus">-  {</span>
<a href="#l19.340"></a><span id="l19.340" class="difflineminus">-    free(strArray);</span>
<a href="#l19.341"></a><span id="l19.341" class="difflineminus">-    NSStrSeqDelete(strSeq);</span>
<a href="#l19.342"></a><span id="l19.342" class="difflineminus">-    free(mailPtr);</span>
<a href="#l19.343"></a><span id="l19.343" class="difflineminus">-    return NULL;</span>
<a href="#l19.344"></a><span id="l19.344" class="difflineminus">-  }</span>
<a href="#l19.345"></a><span id="l19.345" class="difflineminus">-</span>
<a href="#l19.346"></a><span id="l19.346" class="difflineminus">-  memset(newMailPtr, 0, (size_t) totalMemSize);</span>
<a href="#l19.347"></a><span id="l19.347" class="difflineminus">-  //</span>
<a href="#l19.348"></a><span id="l19.348" class="difflineminus">-  // Finally do the copy...</span>
<a href="#l19.349"></a><span id="l19.349" class="difflineminus">-  //</span>
<a href="#l19.350"></a><span id="l19.350" class="difflineminus">-  memcpy(newMailPtr, mailPtr, sizeof(MAPISendMailType));</span>
<a href="#l19.351"></a><span id="l19.351" class="difflineminus">-  memcpy(newMailPtr-&gt;dataBuf, strSeq, (size_t) totalArraySize);</span>
<a href="#l19.352"></a><span id="l19.352" class="difflineminus">-  *totalSize = totalMemSize;</span>
<a href="#l19.353"></a><span id="l19.353" class="difflineminus">-</span>
<a href="#l19.354"></a><span id="l19.354" class="difflineminus">-  //</span>
<a href="#l19.355"></a><span id="l19.355" class="difflineminus">-  // Cleanup and scram...</span>
<a href="#l19.356"></a><span id="l19.356" class="difflineminus">-  //</span>
<a href="#l19.357"></a><span id="l19.357" class="difflineminus">-  if (strArray)</span>
<a href="#l19.358"></a><span id="l19.358" class="difflineminus">-    free(strArray);</span>
<a href="#l19.359"></a><span id="l19.359" class="difflineminus">-</span>
<a href="#l19.360"></a><span id="l19.360" class="difflineminus">-  if (strSeq)</span>
<a href="#l19.361"></a><span id="l19.361" class="difflineminus">-    NSStrSeqDelete(strSeq);</span>
<a href="#l19.362"></a><span id="l19.362" class="difflineminus">-</span>
<a href="#l19.363"></a><span id="l19.363" class="difflineminus">-  if (mailPtr)</span>
<a href="#l19.364"></a><span id="l19.364" class="difflineminus">-    free(mailPtr);</span>
<a href="#l19.365"></a><span id="l19.365" class="difflineminus">-</span>
<a href="#l19.366"></a><span id="l19.366" class="difflineminus">-  return(newMailPtr);</span>
<a href="#l19.367"></a><span id="l19.367" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">deleted file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/mapimem.h</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ /dev/null</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -1,76 +0,0 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineminus">- *</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l20.10"></a><span id="l20.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l20.11"></a><span id="l20.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">- *</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">- * License.</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">- *</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">- *</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineminus">- *</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineminus">- *</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">- *</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineminus">-#ifndef __MY_MEM_HPP__</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineminus">-#define __MY_MEM_HPP__</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineminus">-</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-#ifndef MAPI_OLE	// Because MSFT doesn't do this for us :-(</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineminus">-#include &lt;mapi.h&gt;                                                 </span>
<a href="#l20.46"></a><span id="l20.46" class="difflineminus">-#endif</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineminus">-</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineminus">-//</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineminus">-// Needed for turning NULL's into &quot;&quot;'s for string sequence routines...</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-//</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineminus">-LPSTR     CheckNullString(LPSTR inStr);</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineminus">-</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-//</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineminus">-// Memory allocation functions...</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineminus">-//</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineminus">-</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineminus">-//</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineminus">-// This will free an lpMapiMessage structure allocated by this DLL</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineminus">-//</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineminus">-void      FreeMAPIMessage(lpMapiMessage pv);</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineminus">-</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineminus">-//</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineminus">-// This will free an lpMapiRecipDesc structure allocated by this DLL</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineminus">-//</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineminus">-void      FreeMAPIRecipient(lpMapiRecipDesc pv);</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineminus">-</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineminus">-//</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineminus">-// Frees a mapi file object...</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineminus">-//</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineminus">-void      FreeMAPIFile(lpMapiFileDesc pv);</span>
<a href="#l20.71"></a><span id="l20.71" class="difflineminus">-</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineminus">-//</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineminus">-// This routine will take an lpMapiMessage structure and &quot;flatten&quot; it into</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineminus">-// one contiguous chunk of memory that can be easily passed around. </span>
<a href="#l20.75"></a><span id="l20.75" class="difflineminus">-// </span>
<a href="#l20.76"></a><span id="l20.76" class="difflineminus">-LPVOID    FlattenMAPIMessageStructure(lpMapiMessage msg, DWORD *totalSize);</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineminus">-</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineminus">-</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineminus">-</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineminus">-#endif  // __MY_MEM_HPP__</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">deleted file mode 100644</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/mapiutl.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineplus">+++ /dev/null</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineat">@@ -1,899 +0,0 @@</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineminus">- *</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">- *</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">- * License.</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineminus">- *</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineminus">- *</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineminus">- *</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineminus">- *</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineminus">- *</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineminus">-//</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineminus">-//  Various utils needed for the MAPI functions</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineminus">-//  November 1997</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineminus">-//</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineminus">-#include &lt;windows.h&gt; </span>
<a href="#l21.47"></a><span id="l21.47" class="difflineminus">-#include &lt;time.h&gt; </span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-#include &lt;sys/stat.h&gt;</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineminus">-#include &lt;io.h&gt;</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineminus">-#include &quot;xpapi.h&quot;</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineminus">-#include &quot;trace.h&quot;</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineminus">-#include &quot;mapiipc.h&quot;</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineminus">-#include &quot;mapiutl.h&quot;</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-//</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-// Global variables</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineminus">-//</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineminus">-BOOL	  gLoggingEnabled = FALSE;</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineminus">-</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-void</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineminus">-SetLoggingEnabled(BOOL val)</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineminus">-{</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineminus">-  gLoggingEnabled = val;</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineminus">-}</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineminus">-</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineminus">-// Log File</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineminus">-void </span>
<a href="#l21.68"></a><span id="l21.68" class="difflineminus">-LogString(LPCSTR pStr1)</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineminus">-{</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineminus">-  // Off of the declaration line...</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineminus">-  LPCSTR pStr2 = NULL;</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineminus">-  BOOL useStr1 = TRUE;</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineminus">-</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineminus">-	if (gLoggingEnabled)</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineminus">-	{</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineminus">-		char tempPath[_MAX_PATH] = &quot;&quot;;</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineminus">-    if (getenv(&quot;TEMP&quot;))</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineminus">-    {</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineminus">-      lstrcpy((LPSTR) tempPath, getenv(&quot;TEMP&quot;));  // environmental variable</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineminus">-    } </span>
<a href="#l21.81"></a><span id="l21.81" class="difflineminus">-</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineminus">-		int len = lstrlen(tempPath);</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineminus">-		if ((len &gt; 1) &amp;&amp; tempPath[len - 1] != '\\')</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineminus">-		{</span>
<a href="#l21.85"></a><span id="l21.85" class="difflineminus">-			lstrcat(tempPath, &quot;\\&quot;);</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineminus">-		}</span>
<a href="#l21.87"></a><span id="l21.87" class="difflineminus">-		lstrcat(tempPath, szMapiLog);</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineminus">-		HFILE hFile = _lopen(tempPath, OF_WRITE);</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineminus">-		if (hFile == HFILE_ERROR)</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineminus">-		{</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineminus">-			hFile = _lcreat(tempPath, 0);</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineminus">-		}</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineminus">-		if (hFile != HFILE_ERROR)</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineminus">-		{</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineminus">-			_llseek(hFile, 0, SEEK_END);		// seek to the end of the file</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineminus">-			LPCSTR pTemp = useStr1 ? pStr1 : pStr2;</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineminus">-			_lwrite(hFile, pTemp, lstrlen(pTemp));</span>
<a href="#l21.98"></a><span id="l21.98" class="difflineminus">-			_lclose(hFile);</span>
<a href="#l21.99"></a><span id="l21.99" class="difflineminus">-		}</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineminus">-	}</span>
<a href="#l21.101"></a><span id="l21.101" class="difflineminus">-}</span>
<a href="#l21.102"></a><span id="l21.102" class="difflineminus">-</span>
<a href="#l21.103"></a><span id="l21.103" class="difflineminus">-//</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineminus">-// Find Communicator and return an HWND, if not, start Communicator,</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineminus">-// then find an HWND</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineminus">-//</span>
<a href="#l21.107"></a><span id="l21.107" class="difflineminus">-HWND </span>
<a href="#l21.108"></a><span id="l21.108" class="difflineminus">-GetCommunicatorIPCWindow(void)</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineminus">-{</span>
<a href="#l21.110"></a><span id="l21.110" class="difflineminus">-  HWND  hWnd = NULL; </span>
<a href="#l21.111"></a><span id="l21.111" class="difflineminus">-  DWORD timeCount = 0;</span>
<a href="#l21.112"></a><span id="l21.112" class="difflineminus">-  BOOL  launchTry = FALSE;</span>
<a href="#l21.113"></a><span id="l21.113" class="difflineminus">-</span>
<a href="#l21.114"></a><span id="l21.114" class="difflineminus">-  //</span>
<a href="#l21.115"></a><span id="l21.115" class="difflineminus">-  // This will wait for 10 seconds before giving up and failing</span>
<a href="#l21.116"></a><span id="l21.116" class="difflineminus">-  //</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineminus">-  while ((hWnd == NULL) &amp;&amp; (timeCount &lt; 20))</span>
<a href="#l21.118"></a><span id="l21.118" class="difflineminus">-  {</span>
<a href="#l21.119"></a><span id="l21.119" class="difflineminus">-    if ((hWnd = FindWindow(&quot;AfxFrameOrView&quot;, NULL)) &amp;&amp; !FindWindow(&quot;aHiddenFrameClass&quot;, NULL))</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineminus">-      return(hWnd);</span>
<a href="#l21.121"></a><span id="l21.121" class="difflineminus">-    else if ((hWnd = FindWindow(&quot;aHiddenFrameClass&quot;, NULL)))</span>
<a href="#l21.122"></a><span id="l21.122" class="difflineminus">-      return(hWnd);</span>
<a href="#l21.123"></a><span id="l21.123" class="difflineminus">-</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineminus">-    if (!launchTry)</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineminus">-    {</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineminus">-    char    szPath[_MAX_PATH] = &quot;&quot;;</span>
<a href="#l21.127"></a><span id="l21.127" class="difflineminus">-		DWORD   nMAPIERROR; </span>
<a href="#l21.128"></a><span id="l21.128" class="difflineminus">-</span>
<a href="#l21.129"></a><span id="l21.129" class="difflineminus">-      if ((nMAPIERROR = XP_GetInstallLocation(szPath, _MAX_PATH)) != SUCCESS_SUCCESS)</span>
<a href="#l21.130"></a><span id="l21.130" class="difflineminus">-      {</span>
<a href="#l21.131"></a><span id="l21.131" class="difflineminus">-        return(NULL); </span>
<a href="#l21.132"></a><span id="l21.132" class="difflineminus">-      }</span>
<a href="#l21.133"></a><span id="l21.133" class="difflineminus">-		</span>
<a href="#l21.134"></a><span id="l21.134" class="difflineminus">-		  WORD nReturn = XP_CallProcess(szPath, &quot; -MAPICLIENT&quot;);</span>
<a href="#l21.135"></a><span id="l21.135" class="difflineminus">-      launchTry = TRUE;</span>
<a href="#l21.136"></a><span id="l21.136" class="difflineminus">-    }</span>
<a href="#l21.137"></a><span id="l21.137" class="difflineminus">-</span>
<a href="#l21.138"></a><span id="l21.138" class="difflineminus">-    //</span>
<a href="#l21.139"></a><span id="l21.139" class="difflineminus">-    // Pause for 1/2 a second and try to connect again...</span>
<a href="#l21.140"></a><span id="l21.140" class="difflineminus">-    //</span>
<a href="#l21.141"></a><span id="l21.141" class="difflineminus">-#ifdef WIN32</span>
<a href="#l21.142"></a><span id="l21.142" class="difflineminus">-    Sleep(500);</span>
<a href="#l21.143"></a><span id="l21.143" class="difflineminus">-#else </span>
<a href="#l21.144"></a><span id="l21.144" class="difflineminus">-    Yield();</span>
<a href="#l21.145"></a><span id="l21.145" class="difflineminus">-#endif        </span>
<a href="#l21.146"></a><span id="l21.146" class="difflineminus">-</span>
<a href="#l21.147"></a><span id="l21.147" class="difflineminus">-    timeCount++;</span>
<a href="#l21.148"></a><span id="l21.148" class="difflineminus">-  }</span>
<a href="#l21.149"></a><span id="l21.149" class="difflineminus">-</span>
<a href="#l21.150"></a><span id="l21.150" class="difflineminus">-	return(hWnd);</span>
<a href="#l21.151"></a><span id="l21.151" class="difflineminus">-}</span>
<a href="#l21.152"></a><span id="l21.152" class="difflineminus">-</span>
<a href="#l21.153"></a><span id="l21.153" class="difflineminus">-void</span>
<a href="#l21.154"></a><span id="l21.154" class="difflineminus">-BuildMemName(LPSTR name, ULONG winSeed)</span>
<a href="#l21.155"></a><span id="l21.155" class="difflineminus">-{</span>
<a href="#l21.156"></a><span id="l21.156" class="difflineminus">-  static DWORD    id = 0;</span>
<a href="#l21.157"></a><span id="l21.157" class="difflineminus">-</span>
<a href="#l21.158"></a><span id="l21.158" class="difflineminus">-  if (id == 0)</span>
<a href="#l21.159"></a><span id="l21.159" class="difflineminus">-  {</span>
<a href="#l21.160"></a><span id="l21.160" class="difflineminus">-    // Seed the random-number generator with current time so that</span>
<a href="#l21.161"></a><span id="l21.161" class="difflineminus">-    // the numbers will be different every time we run.</span>
<a href="#l21.162"></a><span id="l21.162" class="difflineminus">-    srand( (unsigned)time( NULL ) );</span>
<a href="#l21.163"></a><span id="l21.163" class="difflineminus">-    id = rand();</span>
<a href="#l21.164"></a><span id="l21.164" class="difflineminus">-  }</span>
<a href="#l21.165"></a><span id="l21.165" class="difflineminus">-</span>
<a href="#l21.166"></a><span id="l21.166" class="difflineminus">-  wsprintf(name, &quot;MAPI_IPC_SMEM-%d&quot;, (winSeed + id++));</span>
<a href="#l21.167"></a><span id="l21.167" class="difflineminus">-  TRACE(&quot;Shared Memory Name = [%s]\n&quot;, name);</span>
<a href="#l21.168"></a><span id="l21.168" class="difflineminus">-}</span>
<a href="#l21.169"></a><span id="l21.169" class="difflineminus">-</span>
<a href="#l21.170"></a><span id="l21.170" class="difflineminus">-DWORD </span>
<a href="#l21.171"></a><span id="l21.171" class="difflineminus">-ValidateFile(LPCSTR szFile) </span>
<a href="#l21.172"></a><span id="l21.172" class="difflineminus">-{</span>
<a href="#l21.173"></a><span id="l21.173" class="difflineminus">-  	struct _stat buf;</span>
<a href="#l21.174"></a><span id="l21.174" class="difflineminus">-    int result;</span>
<a href="#l21.175"></a><span id="l21.175" class="difflineminus">-</span>
<a href="#l21.176"></a><span id="l21.176" class="difflineminus">-    result = _stat( szFile, &amp;buf );</span>
<a href="#l21.177"></a><span id="l21.177" class="difflineminus">-    if (result != 0)</span>
<a href="#l21.178"></a><span id="l21.178" class="difflineminus">-      return(1);</span>
<a href="#l21.179"></a><span id="l21.179" class="difflineminus">-</span>
<a href="#l21.180"></a><span id="l21.180" class="difflineminus">-    if (!(buf.st_mode &amp; S_IREAD))</span>
<a href="#l21.181"></a><span id="l21.181" class="difflineminus">-      return(2);</span>
<a href="#l21.182"></a><span id="l21.182" class="difflineminus">-</span>
<a href="#l21.183"></a><span id="l21.183" class="difflineminus">-    return(0);</span>
<a href="#l21.184"></a><span id="l21.184" class="difflineminus">-}</span>
<a href="#l21.185"></a><span id="l21.185" class="difflineminus">-</span>
<a href="#l21.186"></a><span id="l21.186" class="difflineminus">-//</span>
<a href="#l21.187"></a><span id="l21.187" class="difflineminus">-// return of zero is ok </span>
<a href="#l21.188"></a><span id="l21.188" class="difflineminus">-// 1 = MAPI_E_ATTACHMENT_NOT_FOUND</span>
<a href="#l21.189"></a><span id="l21.189" class="difflineminus">-// 2 = MAPI_E_ATTACHMENT_OPEN_FAILURE</span>
<a href="#l21.190"></a><span id="l21.190" class="difflineminus">-//</span>
<a href="#l21.191"></a><span id="l21.191" class="difflineminus">-DWORD</span>
<a href="#l21.192"></a><span id="l21.192" class="difflineminus">-SanityCheckAttachmentFiles(lpMapiMessage lpMessage)</span>
<a href="#l21.193"></a><span id="l21.193" class="difflineminus">-{</span>
<a href="#l21.194"></a><span id="l21.194" class="difflineminus">-  ULONG i;</span>
<a href="#l21.195"></a><span id="l21.195" class="difflineminus">-  DWORD rc;</span>
<a href="#l21.196"></a><span id="l21.196" class="difflineminus">-</span>
<a href="#l21.197"></a><span id="l21.197" class="difflineminus">-  for (i=0; i&lt;lpMessage-&gt;nFileCount; i++)</span>
<a href="#l21.198"></a><span id="l21.198" class="difflineminus">-  {</span>
<a href="#l21.199"></a><span id="l21.199" class="difflineminus">-    if ((rc = ValidateFile(lpMessage-&gt;lpFiles[i].lpszPathName)) != 0)</span>
<a href="#l21.200"></a><span id="l21.200" class="difflineminus">-    {</span>
<a href="#l21.201"></a><span id="l21.201" class="difflineminus">-      return(rc);</span>
<a href="#l21.202"></a><span id="l21.202" class="difflineminus">-    }</span>
<a href="#l21.203"></a><span id="l21.203" class="difflineminus">-  }</span>
<a href="#l21.204"></a><span id="l21.204" class="difflineminus">-</span>
<a href="#l21.205"></a><span id="l21.205" class="difflineminus">-  return(0);</span>
<a href="#l21.206"></a><span id="l21.206" class="difflineminus">-}</span>
<a href="#l21.207"></a><span id="l21.207" class="difflineminus">-</span>
<a href="#l21.208"></a><span id="l21.208" class="difflineminus">-DWORD </span>
<a href="#l21.209"></a><span id="l21.209" class="difflineminus">-GetFileCount(LPSTR pFiles, LPSTR delimChar)</span>
<a href="#l21.210"></a><span id="l21.210" class="difflineminus">-{</span>
<a href="#l21.211"></a><span id="l21.211" class="difflineminus">-  DWORD   count = 1;</span>
<a href="#l21.212"></a><span id="l21.212" class="difflineminus">-	if ((!pFiles) || (!*pFiles))</span>
<a href="#l21.213"></a><span id="l21.213" class="difflineminus">-		return(0);</span>
<a href="#l21.214"></a><span id="l21.214" class="difflineminus">-</span>
<a href="#l21.215"></a><span id="l21.215" class="difflineminus">-  for (DWORD i=0; i&lt;strlen(pFiles); i++)</span>
<a href="#l21.216"></a><span id="l21.216" class="difflineminus">-  {</span>
<a href="#l21.217"></a><span id="l21.217" class="difflineminus">-    if (pFiles[i] == delimChar[0])</span>
<a href="#l21.218"></a><span id="l21.218" class="difflineminus">-    {</span>
<a href="#l21.219"></a><span id="l21.219" class="difflineminus">-      ++count;</span>
<a href="#l21.220"></a><span id="l21.220" class="difflineminus">-    }</span>
<a href="#l21.221"></a><span id="l21.221" class="difflineminus">-  }</span>
<a href="#l21.222"></a><span id="l21.222" class="difflineminus">-</span>
<a href="#l21.223"></a><span id="l21.223" class="difflineminus">-  return(count);</span>
<a href="#l21.224"></a><span id="l21.224" class="difflineminus">-}</span>
<a href="#l21.225"></a><span id="l21.225" class="difflineminus">-</span>
<a href="#l21.226"></a><span id="l21.226" class="difflineminus">-//</span>
<a href="#l21.227"></a><span id="l21.227" class="difflineminus">-// Extract a filename from a string</span>
<a href="#l21.228"></a><span id="l21.228" class="difflineminus">-// Return TRUE if file found, else FALSE</span>
<a href="#l21.229"></a><span id="l21.229" class="difflineminus">-//</span>
<a href="#l21.230"></a><span id="l21.230" class="difflineminus">-BOOL</span>
<a href="#l21.231"></a><span id="l21.231" class="difflineminus">-ExtractFile(LPSTR pFiles, LPSTR delimChar, DWORD fIndex, LPSTR fName)</span>
<a href="#l21.232"></a><span id="l21.232" class="difflineminus">-{</span>
<a href="#l21.233"></a><span id="l21.233" class="difflineminus">-  LPSTR   ptr = pFiles;</span>
<a href="#l21.234"></a><span id="l21.234" class="difflineminus">-  DWORD   loc;</span>
<a href="#l21.235"></a><span id="l21.235" class="difflineminus">-  DWORD   count = 0;</span>
<a href="#l21.236"></a><span id="l21.236" class="difflineminus">-</span>
<a href="#l21.237"></a><span id="l21.237" class="difflineminus">-	if ((!pFiles) || (!*pFiles))</span>
<a href="#l21.238"></a><span id="l21.238" class="difflineminus">-		return(0);</span>
<a href="#l21.239"></a><span id="l21.239" class="difflineminus">-</span>
<a href="#l21.240"></a><span id="l21.240" class="difflineminus">-  // Get to the fIndex'th entry</span>
<a href="#l21.241"></a><span id="l21.241" class="difflineminus">-  for (loc=0; loc&lt;strlen(pFiles); loc++)</span>
<a href="#l21.242"></a><span id="l21.242" class="difflineminus">-  {</span>
<a href="#l21.243"></a><span id="l21.243" class="difflineminus">-    if (count == fIndex)</span>
<a href="#l21.244"></a><span id="l21.244" class="difflineminus">-      break;</span>
<a href="#l21.245"></a><span id="l21.245" class="difflineminus">-    if (pFiles[loc] == delimChar[0])</span>
<a href="#l21.246"></a><span id="l21.246" class="difflineminus">-      count++;</span>
<a href="#l21.247"></a><span id="l21.247" class="difflineminus">-  }</span>
<a href="#l21.248"></a><span id="l21.248" class="difflineminus">-</span>
<a href="#l21.249"></a><span id="l21.249" class="difflineminus">-  if (loc &gt;= strlen(pFiles))    // Got to the end of string!</span>
<a href="#l21.250"></a><span id="l21.250" class="difflineminus">-    return(FALSE);</span>
<a href="#l21.251"></a><span id="l21.251" class="difflineminus">-</span>
<a href="#l21.252"></a><span id="l21.252" class="difflineminus">-  lstrcpy(fName, (LPSTR)pFiles + loc);</span>
<a href="#l21.253"></a><span id="l21.253" class="difflineminus">-  //</span>
<a href="#l21.254"></a><span id="l21.254" class="difflineminus">-  // Truncate at 2nd delimiter</span>
<a href="#l21.255"></a><span id="l21.255" class="difflineminus">-  //</span>
<a href="#l21.256"></a><span id="l21.256" class="difflineminus">-  for (DWORD i=0; i&lt;strlen(fName); i++)</span>
<a href="#l21.257"></a><span id="l21.257" class="difflineminus">-  {</span>
<a href="#l21.258"></a><span id="l21.258" class="difflineminus">-    if (fName[i] == delimChar[0])</span>
<a href="#l21.259"></a><span id="l21.259" class="difflineminus">-    {</span>
<a href="#l21.260"></a><span id="l21.260" class="difflineminus">-      fName[i] = '\0';</span>
<a href="#l21.261"></a><span id="l21.261" class="difflineminus">-      break;</span>
<a href="#l21.262"></a><span id="l21.262" class="difflineminus">-    }</span>
<a href="#l21.263"></a><span id="l21.263" class="difflineminus">-  }</span>
<a href="#l21.264"></a><span id="l21.264" class="difflineminus">-</span>
<a href="#l21.265"></a><span id="l21.265" class="difflineminus">-  return(TRUE);</span>
<a href="#l21.266"></a><span id="l21.266" class="difflineminus">-}</span>
<a href="#l21.267"></a><span id="l21.267" class="difflineminus">-</span>
<a href="#l21.268"></a><span id="l21.268" class="difflineminus">-ULONG</span>
<a href="#l21.269"></a><span id="l21.269" class="difflineminus">-GetFileSize(LPSTR fName)</span>
<a href="#l21.270"></a><span id="l21.270" class="difflineminus">-{</span>
<a href="#l21.271"></a><span id="l21.271" class="difflineminus">-  struct _stat buf;</span>
<a href="#l21.272"></a><span id="l21.272" class="difflineminus">-  int result;</span>
<a href="#l21.273"></a><span id="l21.273" class="difflineminus">-  </span>
<a href="#l21.274"></a><span id="l21.274" class="difflineminus">-  result = _stat( fName, &amp;buf );</span>
<a href="#l21.275"></a><span id="l21.275" class="difflineminus">-  if (result != 0)</span>
<a href="#l21.276"></a><span id="l21.276" class="difflineminus">-    return(0);</span>
<a href="#l21.277"></a><span id="l21.277" class="difflineminus">-  </span>
<a href="#l21.278"></a><span id="l21.278" class="difflineminus">-  return(buf.st_size);</span>
<a href="#l21.279"></a><span id="l21.279" class="difflineminus">-}</span>
<a href="#l21.280"></a><span id="l21.280" class="difflineminus">- </span>
<a href="#l21.281"></a><span id="l21.281" class="difflineminus">-LPVOID</span>
<a href="#l21.282"></a><span id="l21.282" class="difflineminus">-LoadBlobToMemory(LPSTR fName)</span>
<a href="#l21.283"></a><span id="l21.283" class="difflineminus">-{</span>
<a href="#l21.284"></a><span id="l21.284" class="difflineminus">-  UCHAR     *ptr = NULL;</span>
<a href="#l21.285"></a><span id="l21.285" class="difflineminus">-  ULONG     bufSize = GetFileSize(fName);</span>
<a href="#l21.286"></a><span id="l21.286" class="difflineminus">-</span>
<a href="#l21.287"></a><span id="l21.287" class="difflineminus">-  if (bufSize == 0)</span>
<a href="#l21.288"></a><span id="l21.288" class="difflineminus">-  {</span>
<a href="#l21.289"></a><span id="l21.289" class="difflineminus">-    _unlink(fName);</span>
<a href="#l21.290"></a><span id="l21.290" class="difflineminus">-    return(NULL);</span>
<a href="#l21.291"></a><span id="l21.291" class="difflineminus">-  }</span>
<a href="#l21.292"></a><span id="l21.292" class="difflineminus">-</span>
<a href="#l21.293"></a><span id="l21.293" class="difflineminus">-  ptr = (UCHAR *)malloc( (size_t) bufSize);</span>
<a href="#l21.294"></a><span id="l21.294" class="difflineminus">-  if (!ptr)</span>
<a href="#l21.295"></a><span id="l21.295" class="difflineminus">-  {</span>
<a href="#l21.296"></a><span id="l21.296" class="difflineminus">-    _unlink(fName);</span>
<a href="#l21.297"></a><span id="l21.297" class="difflineminus">-    return(NULL);</span>
<a href="#l21.298"></a><span id="l21.298" class="difflineminus">-  }</span>
<a href="#l21.299"></a><span id="l21.299" class="difflineminus">-</span>
<a href="#l21.300"></a><span id="l21.300" class="difflineminus">-  HFILE hFile = _lopen(fName, OF_READ);</span>
<a href="#l21.301"></a><span id="l21.301" class="difflineminus">-  if (hFile == HFILE_ERROR)</span>
<a href="#l21.302"></a><span id="l21.302" class="difflineminus">-  {</span>
<a href="#l21.303"></a><span id="l21.303" class="difflineminus">-    _unlink(fName);</span>
<a href="#l21.304"></a><span id="l21.304" class="difflineminus">-    free(ptr);</span>
<a href="#l21.305"></a><span id="l21.305" class="difflineminus">-    return(NULL);</span>
<a href="#l21.306"></a><span id="l21.306" class="difflineminus">-  }</span>
<a href="#l21.307"></a><span id="l21.307" class="difflineminus">-</span>
<a href="#l21.308"></a><span id="l21.308" class="difflineminus">-  UINT numRead = _lread(hFile, ptr, (size_t) bufSize);</span>
<a href="#l21.309"></a><span id="l21.309" class="difflineminus">-  _lclose(hFile);</span>
<a href="#l21.310"></a><span id="l21.310" class="difflineminus">-</span>
<a href="#l21.311"></a><span id="l21.311" class="difflineminus">-  if (numRead != bufSize)</span>
<a href="#l21.312"></a><span id="l21.312" class="difflineminus">-  {</span>
<a href="#l21.313"></a><span id="l21.313" class="difflineminus">-    _unlink(fName);</span>
<a href="#l21.314"></a><span id="l21.314" class="difflineminus">-    free(ptr);</span>
<a href="#l21.315"></a><span id="l21.315" class="difflineminus">-    return(NULL);</span>
<a href="#l21.316"></a><span id="l21.316" class="difflineminus">-  }</span>
<a href="#l21.317"></a><span id="l21.317" class="difflineminus">-</span>
<a href="#l21.318"></a><span id="l21.318" class="difflineminus">-  _unlink(fName);</span>
<a href="#l21.319"></a><span id="l21.319" class="difflineminus">-	return(ptr);	</span>
<a href="#l21.320"></a><span id="l21.320" class="difflineminus">-}</span>
<a href="#l21.321"></a><span id="l21.321" class="difflineminus">-</span>
<a href="#l21.322"></a><span id="l21.322" class="difflineminus">-LONG</span>
<a href="#l21.323"></a><span id="l21.323" class="difflineminus">-WriteMemoryBufferToDisk(LPSTR fName, LONG bufSize, LPSTR buf)</span>
<a href="#l21.324"></a><span id="l21.324" class="difflineminus">-{</span>
<a href="#l21.325"></a><span id="l21.325" class="difflineminus">-  if (!buf)</span>
<a href="#l21.326"></a><span id="l21.326" class="difflineminus">-  {</span>
<a href="#l21.327"></a><span id="l21.327" class="difflineminus">-    return(-1);</span>
<a href="#l21.328"></a><span id="l21.328" class="difflineminus">-  }</span>
<a href="#l21.329"></a><span id="l21.329" class="difflineminus">-</span>
<a href="#l21.330"></a><span id="l21.330" class="difflineminus">-  HFILE hFile = _lcreat(fName, 0);</span>
<a href="#l21.331"></a><span id="l21.331" class="difflineminus">-  if (hFile == HFILE_ERROR)</span>
<a href="#l21.332"></a><span id="l21.332" class="difflineminus">-  {</span>
<a href="#l21.333"></a><span id="l21.333" class="difflineminus">-    return(-1);</span>
<a href="#l21.334"></a><span id="l21.334" class="difflineminus">-  }</span>
<a href="#l21.335"></a><span id="l21.335" class="difflineminus">-</span>
<a href="#l21.336"></a><span id="l21.336" class="difflineminus">-  LONG writeCount = _lwrite(hFile, buf, (size_t) bufSize);</span>
<a href="#l21.337"></a><span id="l21.337" class="difflineminus">-  _lclose(hFile);</span>
<a href="#l21.338"></a><span id="l21.338" class="difflineminus">-</span>
<a href="#l21.339"></a><span id="l21.339" class="difflineminus">-  if (writeCount != bufSize)</span>
<a href="#l21.340"></a><span id="l21.340" class="difflineminus">-  {</span>
<a href="#l21.341"></a><span id="l21.341" class="difflineminus">-    _unlink(fName);</span>
<a href="#l21.342"></a><span id="l21.342" class="difflineminus">-    return(-1);</span>
<a href="#l21.343"></a><span id="l21.343" class="difflineminus">-  }</span>
<a href="#l21.344"></a><span id="l21.344" class="difflineminus">-</span>
<a href="#l21.345"></a><span id="l21.345" class="difflineminus">-  return(0);</span>
<a href="#l21.346"></a><span id="l21.346" class="difflineminus">-}</span>
<a href="#l21.347"></a><span id="l21.347" class="difflineminus">-</span>
<a href="#l21.348"></a><span id="l21.348" class="difflineminus">-LPSTR</span>
<a href="#l21.349"></a><span id="l21.349" class="difflineminus">-GetTheTempDirectoryOnTheSystem(void)</span>
<a href="#l21.350"></a><span id="l21.350" class="difflineminus">-{</span>
<a href="#l21.351"></a><span id="l21.351" class="difflineminus">- static UCHAR retPath[_MAX_PATH];</span>
<a href="#l21.352"></a><span id="l21.352" class="difflineminus">-  </span>
<a href="#l21.353"></a><span id="l21.353" class="difflineminus">-  if (getenv(&quot;TEMP&quot;))</span>
<a href="#l21.354"></a><span id="l21.354" class="difflineminus">-  {</span>
<a href="#l21.355"></a><span id="l21.355" class="difflineminus">-    lstrcpy((LPSTR) retPath, getenv(&quot;TEMP&quot;));  // environmental variable</span>
<a href="#l21.356"></a><span id="l21.356" class="difflineminus">-  } </span>
<a href="#l21.357"></a><span id="l21.357" class="difflineminus">-  else if (getenv(&quot;TMP&quot;))</span>
<a href="#l21.358"></a><span id="l21.358" class="difflineminus">-  {</span>
<a href="#l21.359"></a><span id="l21.359" class="difflineminus">-    lstrcpy((LPSTR) retPath, getenv(&quot;TMP&quot;));  // How about this environmental variable?</span>
<a href="#l21.360"></a><span id="l21.360" class="difflineminus">-  }</span>
<a href="#l21.361"></a><span id="l21.361" class="difflineminus">-  else</span>
<a href="#l21.362"></a><span id="l21.362" class="difflineminus">-  {</span>
<a href="#l21.363"></a><span id="l21.363" class="difflineminus">-    GetWindowsDirectory((LPSTR) retPath, sizeof(retPath));</span>
<a href="#l21.364"></a><span id="l21.364" class="difflineminus">-  }</span>
<a href="#l21.365"></a><span id="l21.365" class="difflineminus">-</span>
<a href="#l21.366"></a><span id="l21.366" class="difflineminus">-  return((LPSTR) &amp;(retPath[0]));</span>
<a href="#l21.367"></a><span id="l21.367" class="difflineminus">-}</span>
<a href="#l21.368"></a><span id="l21.368" class="difflineminus">-</span>
<a href="#l21.369"></a><span id="l21.369" class="difflineminus">-#ifdef WIN16</span>
<a href="#l21.370"></a><span id="l21.370" class="difflineminus">-int WINAPI EXPORT ISGetTempFileName(LPCSTR a_pDummyPath,  LPCSTR a_pPrefix, UINT a_uUnique, LPSTR a_pResultName)</span>
<a href="#l21.371"></a><span id="l21.371" class="difflineminus">-{</span>
<a href="#l21.372"></a><span id="l21.372" class="difflineminus">-#ifdef GetTempFileName	// we need the real thing comming up next...</span>
<a href="#l21.373"></a><span id="l21.373" class="difflineminus">-#undef GetTempFileName</span>
<a href="#l21.374"></a><span id="l21.374" class="difflineminus">-#endif</span>
<a href="#l21.375"></a><span id="l21.375" class="difflineminus">-	return GetTempFileName(0, a_pPrefix, a_uUnique, a_pResultName);</span>
<a href="#l21.376"></a><span id="l21.376" class="difflineminus">-}</span>
<a href="#l21.377"></a><span id="l21.377" class="difflineminus">-#endif</span>
<a href="#l21.378"></a><span id="l21.378" class="difflineminus">-</span>
<a href="#l21.379"></a><span id="l21.379" class="difflineminus">-LONG</span>
<a href="#l21.380"></a><span id="l21.380" class="difflineminus">-GetTempAttachmentName(LPSTR fName) </span>
<a href="#l21.381"></a><span id="l21.381" class="difflineminus">-{</span>
<a href="#l21.382"></a><span id="l21.382" class="difflineminus">-  UINT        res;</span>
<a href="#l21.383"></a><span id="l21.383" class="difflineminus">-  static UINT uUnique = 1;</span>
<a href="#l21.384"></a><span id="l21.384" class="difflineminus">-</span>
<a href="#l21.385"></a><span id="l21.385" class="difflineminus">-  if (!fName)</span>
<a href="#l21.386"></a><span id="l21.386" class="difflineminus">-    return(-1);</span>
<a href="#l21.387"></a><span id="l21.387" class="difflineminus">-</span>
<a href="#l21.388"></a><span id="l21.388" class="difflineminus">-  LPSTR szTempPath = GetTheTempDirectoryOnTheSystem();</span>
<a href="#l21.389"></a><span id="l21.389" class="difflineminus">-</span>
<a href="#l21.390"></a><span id="l21.390" class="difflineminus">-TRYAGAIN:</span>
<a href="#l21.391"></a><span id="l21.391" class="difflineminus">-#ifdef WIN32</span>
<a href="#l21.392"></a><span id="l21.392" class="difflineminus">-  res = GetTempFileName(szTempPath, &quot;MAPI&quot;, uUnique++, fName);</span>
<a href="#l21.393"></a><span id="l21.393" class="difflineminus">-#else</span>
<a href="#l21.394"></a><span id="l21.394" class="difflineminus">-  res = ISGetTempFileName(szTempPath, &quot;MAPI&quot;, uUnique++, fName);</span>
<a href="#l21.395"></a><span id="l21.395" class="difflineminus">-#endif</span>
<a href="#l21.396"></a><span id="l21.396" class="difflineminus">-</span>
<a href="#l21.397"></a><span id="l21.397" class="difflineminus">-  if (ValidateFile(fName) != 1) </span>
<a href="#l21.398"></a><span id="l21.398" class="difflineminus">-  {</span>
<a href="#l21.399"></a><span id="l21.399" class="difflineminus">-    if (uUnique &lt; 32000)</span>
<a href="#l21.400"></a><span id="l21.400" class="difflineminus">-    {</span>
<a href="#l21.401"></a><span id="l21.401" class="difflineminus">-      goto TRYAGAIN;</span>
<a href="#l21.402"></a><span id="l21.402" class="difflineminus">-    }</span>
<a href="#l21.403"></a><span id="l21.403" class="difflineminus">-    else</span>
<a href="#l21.404"></a><span id="l21.404" class="difflineminus">-    {</span>
<a href="#l21.405"></a><span id="l21.405" class="difflineminus">-      return(-1);</span>
<a href="#l21.406"></a><span id="l21.406" class="difflineminus">-    }</span>
<a href="#l21.407"></a><span id="l21.407" class="difflineminus">-  }</span>
<a href="#l21.408"></a><span id="l21.408" class="difflineminus">-</span>
<a href="#l21.409"></a><span id="l21.409" class="difflineminus">-  return 0;</span>
<a href="#l21.410"></a><span id="l21.410" class="difflineminus">-}</span>
<a href="#l21.411"></a><span id="l21.411" class="difflineminus">-</span>
<a href="#l21.412"></a><span id="l21.412" class="difflineminus">-// RICHIE - strip all of the HTML stuff out of the message...</span>
<a href="#l21.413"></a><span id="l21.413" class="difflineminus">-int</span>
<a href="#l21.414"></a><span id="l21.414" class="difflineminus">-CheckForInlineHTML(char *noteBody, DWORD len, DWORD *curPos, char *newBody, DWORD *realLen)</span>
<a href="#l21.415"></a><span id="l21.415" class="difflineminus">-{</span>
<a href="#l21.416"></a><span id="l21.416" class="difflineminus">-  LPSTR   tags[] = {&quot;&amp;nbsp;&quot;, &quot;&amp;lt;&quot;, &quot;&amp;amp;&quot;, NULL};</span>
<a href="#l21.417"></a><span id="l21.417" class="difflineminus">-  UCHAR   tagsSubst[] = {' ', '&lt;', '&amp;', NULL};</span>
<a href="#l21.418"></a><span id="l21.418" class="difflineminus">-  int     x = 0;</span>
<a href="#l21.419"></a><span id="l21.419" class="difflineminus">-</span>
<a href="#l21.420"></a><span id="l21.420" class="difflineminus">-  while (tags[x])</span>
<a href="#l21.421"></a><span id="l21.421" class="difflineminus">-  {</span>
<a href="#l21.422"></a><span id="l21.422" class="difflineminus">-    // should we check for first tag</span>
<a href="#l21.423"></a><span id="l21.423" class="difflineminus">-    if ( (*curPos+strlen(tags[x])) &lt; len)</span>
<a href="#l21.424"></a><span id="l21.424" class="difflineminus">-    {</span>
<a href="#l21.425"></a><span id="l21.425" class="difflineminus">-      if (strncmp(tags[x], noteBody, strlen(tags[x])) == 0)</span>
<a href="#l21.426"></a><span id="l21.426" class="difflineminus">-      {</span>
<a href="#l21.427"></a><span id="l21.427" class="difflineminus">-        *curPos += strlen(tags[x]) - 1;</span>
<a href="#l21.428"></a><span id="l21.428" class="difflineminus">-        newBody[*realLen] = tagsSubst[x];</span>
<a href="#l21.429"></a><span id="l21.429" class="difflineminus">-        *realLen += 1;</span>
<a href="#l21.430"></a><span id="l21.430" class="difflineminus">-        return(-1);</span>
<a href="#l21.431"></a><span id="l21.431" class="difflineminus">-      }</span>
<a href="#l21.432"></a><span id="l21.432" class="difflineminus">-    }</span>
<a href="#l21.433"></a><span id="l21.433" class="difflineminus">-</span>
<a href="#l21.434"></a><span id="l21.434" class="difflineminus">-    ++x;</span>
<a href="#l21.435"></a><span id="l21.435" class="difflineminus">-  }</span>
<a href="#l21.436"></a><span id="l21.436" class="difflineminus">-</span>
<a href="#l21.437"></a><span id="l21.437" class="difflineminus">-  return(0);</span>
<a href="#l21.438"></a><span id="l21.438" class="difflineminus">-}</span>
<a href="#l21.439"></a><span id="l21.439" class="difflineminus">-</span>
<a href="#l21.440"></a><span id="l21.440" class="difflineminus">-//</span>
<a href="#l21.441"></a><span id="l21.441" class="difflineminus">-// RICHIE - This is also temporary fix for now...</span>
<a href="#l21.442"></a><span id="l21.442" class="difflineminus">-//</span>
<a href="#l21.443"></a><span id="l21.443" class="difflineminus">-LPSTR</span>
<a href="#l21.444"></a><span id="l21.444" class="difflineminus">-StripSignedMessage(LPSTR noteText, DWORD totalCR) </span>
<a href="#l21.445"></a><span id="l21.445" class="difflineminus">-{</span>
<a href="#l21.446"></a><span id="l21.446" class="difflineminus">-char    *newBuf;</span>
<a href="#l21.447"></a><span id="l21.447" class="difflineminus">-LPSTR   startTag = &quot;&lt;HTML&gt;&quot;;</span>
<a href="#l21.448"></a><span id="l21.448" class="difflineminus">-LPSTR   endTag = &quot;/HTML&gt;&quot;;</span>
<a href="#l21.449"></a><span id="l21.449" class="difflineminus">-DWORD   i;</span>
<a href="#l21.450"></a><span id="l21.450" class="difflineminus">-DWORD   realLen = 0;</span>
<a href="#l21.451"></a><span id="l21.451" class="difflineminus">-DWORD   startPos = 0;</span>
<a href="#l21.452"></a><span id="l21.452" class="difflineminus">-DWORD   len = strlen(noteText);</span>
<a href="#l21.453"></a><span id="l21.453" class="difflineminus">-</span>
<a href="#l21.454"></a><span id="l21.454" class="difflineminus">-  // create a new buffer...</span>
<a href="#l21.455"></a><span id="l21.455" class="difflineminus">-  newBuf = (char *) malloc((size_t)(len + totalCR));</span>
<a href="#l21.456"></a><span id="l21.456" class="difflineminus">-  if (!newBuf)</span>
<a href="#l21.457"></a><span id="l21.457" class="difflineminus">-    return(noteText);</span>
<a href="#l21.458"></a><span id="l21.458" class="difflineminus">-</span>
<a href="#l21.459"></a><span id="l21.459" class="difflineminus">-  newBuf[0] = '\0';</span>
<a href="#l21.460"></a><span id="l21.460" class="difflineminus">-</span>
<a href="#l21.461"></a><span id="l21.461" class="difflineminus">-  // First, find the start of the HTML for the message...</span>
<a href="#l21.462"></a><span id="l21.462" class="difflineminus">-  for (i=0; i&lt;len; i++)</span>
<a href="#l21.463"></a><span id="l21.463" class="difflineminus">-  {</span>
<a href="#l21.464"></a><span id="l21.464" class="difflineminus">-    // should we check for first tag</span>
<a href="#l21.465"></a><span id="l21.465" class="difflineminus">-    if ( (i+strlen(startTag)) &lt; len)</span>
<a href="#l21.466"></a><span id="l21.466" class="difflineminus">-    {</span>
<a href="#l21.467"></a><span id="l21.467" class="difflineminus">-      if (strncmp(startTag, (noteText + i), strlen(startTag)) == 0)</span>
<a href="#l21.468"></a><span id="l21.468" class="difflineminus">-      {</span>
<a href="#l21.469"></a><span id="l21.469" class="difflineminus">-        startPos = i + strlen(startTag);</span>
<a href="#l21.470"></a><span id="l21.470" class="difflineminus">-        break;</span>
<a href="#l21.471"></a><span id="l21.471" class="difflineminus">-      }</span>
<a href="#l21.472"></a><span id="l21.472" class="difflineminus">-    }</span>
<a href="#l21.473"></a><span id="l21.473" class="difflineminus">-  }</span>
<a href="#l21.474"></a><span id="l21.474" class="difflineminus">-</span>
<a href="#l21.475"></a><span id="l21.475" class="difflineminus">-  // Didn't find any HTML start tag</span>
<a href="#l21.476"></a><span id="l21.476" class="difflineminus">-  if (i == len)</span>
<a href="#l21.477"></a><span id="l21.477" class="difflineminus">-    return(noteText);</span>
<a href="#l21.478"></a><span id="l21.478" class="difflineminus">-</span>
<a href="#l21.479"></a><span id="l21.479" class="difflineminus">-  BOOL    inHTML = FALSE;</span>
<a href="#l21.480"></a><span id="l21.480" class="difflineminus">-  BOOL    firstChar = FALSE;</span>
<a href="#l21.481"></a><span id="l21.481" class="difflineminus">-</span>
<a href="#l21.482"></a><span id="l21.482" class="difflineminus">-  for (i=startPos; i&lt;len; i++)</span>
<a href="#l21.483"></a><span id="l21.483" class="difflineminus">-  {</span>
<a href="#l21.484"></a><span id="l21.484" class="difflineminus">-    char  *ptr = (noteText + i);</span>
<a href="#l21.485"></a><span id="l21.485" class="difflineminus">-</span>
<a href="#l21.486"></a><span id="l21.486" class="difflineminus">-    if ( ((*ptr == 0x0D) || (*ptr == 0x20)) &amp;&amp; (!firstChar) )</span>
<a href="#l21.487"></a><span id="l21.487" class="difflineminus">-      continue;</span>
<a href="#l21.488"></a><span id="l21.488" class="difflineminus">-    else</span>
<a href="#l21.489"></a><span id="l21.489" class="difflineminus">-      firstChar = TRUE;</span>
<a href="#l21.490"></a><span id="l21.490" class="difflineminus">-</span>
<a href="#l21.491"></a><span id="l21.491" class="difflineminus">-    // First, check for the end /HTML&gt; tag</span>
<a href="#l21.492"></a><span id="l21.492" class="difflineminus">-    if ( (i+strlen(endTag)) &lt; len)</span>
<a href="#l21.493"></a><span id="l21.493" class="difflineminus">-    {</span>
<a href="#l21.494"></a><span id="l21.494" class="difflineminus">-      if (strncmp(endTag, ptr, strlen(endTag)) == 0)</span>
<a href="#l21.495"></a><span id="l21.495" class="difflineminus">-      {</span>
<a href="#l21.496"></a><span id="l21.496" class="difflineminus">-        break;</span>
<a href="#l21.497"></a><span id="l21.497" class="difflineminus">-      }</span>
<a href="#l21.498"></a><span id="l21.498" class="difflineminus">-    }</span>
<a href="#l21.499"></a><span id="l21.499" class="difflineminus">-</span>
<a href="#l21.500"></a><span id="l21.500" class="difflineminus">-    // If we are in HTML, check for a &quot;&gt;&quot;...</span>
<a href="#l21.501"></a><span id="l21.501" class="difflineminus">-    if (inHTML)</span>
<a href="#l21.502"></a><span id="l21.502" class="difflineminus">-    {</span>
<a href="#l21.503"></a><span id="l21.503" class="difflineminus">-      if (*ptr == '&gt;')</span>
<a href="#l21.504"></a><span id="l21.504" class="difflineminus">-      {</span>
<a href="#l21.505"></a><span id="l21.505" class="difflineminus">-        inHTML = FALSE;</span>
<a href="#l21.506"></a><span id="l21.506" class="difflineminus">-      }</span>
<a href="#l21.507"></a><span id="l21.507" class="difflineminus">-      continue;</span>
<a href="#l21.508"></a><span id="l21.508" class="difflineminus">-    }</span>
<a href="#l21.509"></a><span id="l21.509" class="difflineminus">-</span>
<a href="#l21.510"></a><span id="l21.510" class="difflineminus">-    // Check for NEW HTML...</span>
<a href="#l21.511"></a><span id="l21.511" class="difflineminus">-    if (*ptr == '&lt;')</span>
<a href="#l21.512"></a><span id="l21.512" class="difflineminus">-    {</span>
<a href="#l21.513"></a><span id="l21.513" class="difflineminus">-      inHTML = TRUE;</span>
<a href="#l21.514"></a><span id="l21.514" class="difflineminus">-      continue;</span>
<a href="#l21.515"></a><span id="l21.515" class="difflineminus">-    }</span>
<a href="#l21.516"></a><span id="l21.516" class="difflineminus">-</span>
<a href="#l21.517"></a><span id="l21.517" class="difflineminus">-    if (CheckForInlineHTML(ptr, len, &amp;i, newBuf, &amp;realLen))</span>
<a href="#l21.518"></a><span id="l21.518" class="difflineminus">-      continue;</span>
<a href="#l21.519"></a><span id="l21.519" class="difflineminus">-</span>
<a href="#l21.520"></a><span id="l21.520" class="difflineminus">-    newBuf[realLen++] = *ptr;</span>
<a href="#l21.521"></a><span id="l21.521" class="difflineminus">-    // Tack on a line feed if we hit a CR...</span>
<a href="#l21.522"></a><span id="l21.522" class="difflineminus">-    if ( *ptr == 0x0D )</span>
<a href="#l21.523"></a><span id="l21.523" class="difflineminus">-    {</span>
<a href="#l21.524"></a><span id="l21.524" class="difflineminus">-      newBuf[realLen++] = 0x0A;</span>
<a href="#l21.525"></a><span id="l21.525" class="difflineminus">-    }</span>
<a href="#l21.526"></a><span id="l21.526" class="difflineminus">-  }</span>
<a href="#l21.527"></a><span id="l21.527" class="difflineminus">-</span>
<a href="#l21.528"></a><span id="l21.528" class="difflineminus">-  // terminate the buffer - reallocate and move on...</span>
<a href="#l21.529"></a><span id="l21.529" class="difflineminus">-  newBuf[realLen++] = '\0';</span>
<a href="#l21.530"></a><span id="l21.530" class="difflineminus">-  newBuf = (LPSTR) realloc(newBuf, (size_t) realLen);</span>
<a href="#l21.531"></a><span id="l21.531" class="difflineminus">-</span>
<a href="#l21.532"></a><span id="l21.532" class="difflineminus">-  // check if the realloc worked and if so, free old memory and</span>
<a href="#l21.533"></a><span id="l21.533" class="difflineminus">-  // return...if not, just return the original buffer</span>
<a href="#l21.534"></a><span id="l21.534" class="difflineminus">-  if (!newBuf)</span>
<a href="#l21.535"></a><span id="l21.535" class="difflineminus">-  {</span>
<a href="#l21.536"></a><span id="l21.536" class="difflineminus">-    return(noteText);</span>
<a href="#l21.537"></a><span id="l21.537" class="difflineminus">-  }</span>
<a href="#l21.538"></a><span id="l21.538" class="difflineminus">-  else</span>
<a href="#l21.539"></a><span id="l21.539" class="difflineminus">-  {</span>
<a href="#l21.540"></a><span id="l21.540" class="difflineminus">-    free(noteText);</span>
<a href="#l21.541"></a><span id="l21.541" class="difflineminus">-    return(newBuf);</span>
<a href="#l21.542"></a><span id="l21.542" class="difflineminus">-  }</span>
<a href="#l21.543"></a><span id="l21.543" class="difflineminus">-}</span>
<a href="#l21.544"></a><span id="l21.544" class="difflineminus">-</span>
<a href="#l21.545"></a><span id="l21.545" class="difflineminus">-//</span>
<a href="#l21.546"></a><span id="l21.546" class="difflineminus">-// RICHIE - this is a temporary fix for now to get rid of</span>
<a href="#l21.547"></a><span id="l21.547" class="difflineminus">-// html stuff within the text of a message - if there was a</span>
<a href="#l21.548"></a><span id="l21.548" class="difflineminus">-// valid noteText buffer coming into this call, we need to </span>
<a href="#l21.549"></a><span id="l21.549" class="difflineminus">-// free it on the way out.</span>
<a href="#l21.550"></a><span id="l21.550" class="difflineminus">-//</span>
<a href="#l21.551"></a><span id="l21.551" class="difflineminus">-LPSTR</span>
<a href="#l21.552"></a><span id="l21.552" class="difflineminus">-StripHTML(LPSTR noteText)</span>
<a href="#l21.553"></a><span id="l21.553" class="difflineminus">-{</span>
<a href="#l21.554"></a><span id="l21.554" class="difflineminus">-  char    *newBuf;</span>
<a href="#l21.555"></a><span id="l21.555" class="difflineminus">-  LPSTR   signTag = &quot;This is a cryptographically signed message in MIME format.&quot;;</span>
<a href="#l21.556"></a><span id="l21.556" class="difflineminus">-  LPSTR   mimeTag = &quot;This is a multi-part message in MIME format.&quot;;</span>
<a href="#l21.557"></a><span id="l21.557" class="difflineminus">-</span>
<a href="#l21.558"></a><span id="l21.558" class="difflineminus">-  DWORD   i;</span>
<a href="#l21.559"></a><span id="l21.559" class="difflineminus">-  DWORD   realLen = 0;</span>
<a href="#l21.560"></a><span id="l21.560" class="difflineminus">-  DWORD   totalCR = 0;</span>
<a href="#l21.561"></a><span id="l21.561" class="difflineminus">-</span>
<a href="#l21.562"></a><span id="l21.562" class="difflineminus">-  // do sanity checking...</span>
<a href="#l21.563"></a><span id="l21.563" class="difflineminus">-  if ((!noteText) || (!(*noteText)))</span>
<a href="#l21.564"></a><span id="l21.564" class="difflineminus">-    return(noteText);</span>
<a href="#l21.565"></a><span id="l21.565" class="difflineminus">-</span>
<a href="#l21.566"></a><span id="l21.566" class="difflineminus">-  // more sanity checking...</span>
<a href="#l21.567"></a><span id="l21.567" class="difflineminus">-  DWORD len = strlen(noteText) + 1;</span>
<a href="#l21.568"></a><span id="l21.568" class="difflineminus">-  if (len &lt;= 0) </span>
<a href="#l21.569"></a><span id="l21.569" class="difflineminus">-    return(noteText);</span>
<a href="#l21.570"></a><span id="l21.570" class="difflineminus">-</span>
<a href="#l21.571"></a><span id="l21.571" class="difflineminus">-  // Get the number of CR's in this message and add room for</span>
<a href="#l21.572"></a><span id="l21.572" class="difflineminus">-  // the LF's</span>
<a href="#l21.573"></a><span id="l21.573" class="difflineminus">-  for (i=0; i&lt;len; i++)</span>
<a href="#l21.574"></a><span id="l21.574" class="difflineminus">-  {</span>
<a href="#l21.575"></a><span id="l21.575" class="difflineminus">-    if ( (*(noteText + i)) == 0x0D )</span>
<a href="#l21.576"></a><span id="l21.576" class="difflineminus">-      ++totalCR;</span>
<a href="#l21.577"></a><span id="l21.577" class="difflineminus">-  }</span>
<a href="#l21.578"></a><span id="l21.578" class="difflineminus">-</span>
<a href="#l21.579"></a><span id="l21.579" class="difflineminus">-  // This is a check for a signed message in the start of a message</span>
<a href="#l21.580"></a><span id="l21.580" class="difflineminus">-  // check for sign line...    </span>
<a href="#l21.581"></a><span id="l21.581" class="difflineminus">-  if ( strlen(signTag) &lt; len)</span>
<a href="#l21.582"></a><span id="l21.582" class="difflineminus">-  {</span>
<a href="#l21.583"></a><span id="l21.583" class="difflineminus">-    if ( </span>
<a href="#l21.584"></a><span id="l21.584" class="difflineminus">-        (strncmp(signTag, noteText, strlen(signTag)) == 0) ||</span>
<a href="#l21.585"></a><span id="l21.585" class="difflineminus">-        (strncmp(mimeTag, noteText, strlen(mimeTag)) == 0) </span>
<a href="#l21.586"></a><span id="l21.586" class="difflineminus">-       )</span>
<a href="#l21.587"></a><span id="l21.587" class="difflineminus">-    {</span>
<a href="#l21.588"></a><span id="l21.588" class="difflineminus">-      return( StripSignedMessage(noteText, totalCR) );</span>
<a href="#l21.589"></a><span id="l21.589" class="difflineminus">-    }</span>
<a href="#l21.590"></a><span id="l21.590" class="difflineminus">-  }</span>
<a href="#l21.591"></a><span id="l21.591" class="difflineminus">-</span>
<a href="#l21.592"></a><span id="l21.592" class="difflineminus">-  // create a new buffer...</span>
<a href="#l21.593"></a><span id="l21.593" class="difflineminus">-  newBuf = (char *) malloc((size_t)(len + totalCR));</span>
<a href="#l21.594"></a><span id="l21.594" class="difflineminus">-  if (!newBuf)</span>
<a href="#l21.595"></a><span id="l21.595" class="difflineminus">-    return(noteText);</span>
<a href="#l21.596"></a><span id="l21.596" class="difflineminus">-</span>
<a href="#l21.597"></a><span id="l21.597" class="difflineminus">-  newBuf[0] = '\0';</span>
<a href="#l21.598"></a><span id="l21.598" class="difflineminus">-</span>
<a href="#l21.599"></a><span id="l21.599" class="difflineminus">-  BOOL    firstChar = FALSE;</span>
<a href="#l21.600"></a><span id="l21.600" class="difflineminus">-</span>
<a href="#l21.601"></a><span id="l21.601" class="difflineminus">-  // Now do the translation for the body of the note...</span>
<a href="#l21.602"></a><span id="l21.602" class="difflineminus">-  for (i=0; i&lt;len; i++)</span>
<a href="#l21.603"></a><span id="l21.603" class="difflineminus">-  {</span>
<a href="#l21.604"></a><span id="l21.604" class="difflineminus">-    char  *ptr = (noteText + i);</span>
<a href="#l21.605"></a><span id="l21.605" class="difflineminus">-    </span>
<a href="#l21.606"></a><span id="l21.606" class="difflineminus">-    if ( ((*ptr == 0x0D) || (*ptr == 0x20)) &amp;&amp; (!firstChar) )</span>
<a href="#l21.607"></a><span id="l21.607" class="difflineminus">-      continue;</span>
<a href="#l21.608"></a><span id="l21.608" class="difflineminus">-    else</span>
<a href="#l21.609"></a><span id="l21.609" class="difflineminus">-      firstChar = TRUE;</span>
<a href="#l21.610"></a><span id="l21.610" class="difflineminus">-</span>
<a href="#l21.611"></a><span id="l21.611" class="difflineminus">-    if (CheckForInlineHTML(ptr, len, &amp;i, newBuf, &amp;realLen))</span>
<a href="#l21.612"></a><span id="l21.612" class="difflineminus">-      continue;</span>
<a href="#l21.613"></a><span id="l21.613" class="difflineminus">-</span>
<a href="#l21.614"></a><span id="l21.614" class="difflineminus">-    newBuf[realLen++] = *ptr;</span>
<a href="#l21.615"></a><span id="l21.615" class="difflineminus">-    if ( *ptr == 0x0D )</span>
<a href="#l21.616"></a><span id="l21.616" class="difflineminus">-    {</span>
<a href="#l21.617"></a><span id="l21.617" class="difflineminus">-      newBuf[realLen++] = 0x0A;</span>
<a href="#l21.618"></a><span id="l21.618" class="difflineminus">-    }</span>
<a href="#l21.619"></a><span id="l21.619" class="difflineminus">-  }</span>
<a href="#l21.620"></a><span id="l21.620" class="difflineminus">-</span>
<a href="#l21.621"></a><span id="l21.621" class="difflineminus">-  // terminate the buffer - reallocate and move on...</span>
<a href="#l21.622"></a><span id="l21.622" class="difflineminus">-  newBuf[realLen++] = '\0';</span>
<a href="#l21.623"></a><span id="l21.623" class="difflineminus">-  newBuf = (LPSTR) realloc(newBuf, (size_t) realLen);</span>
<a href="#l21.624"></a><span id="l21.624" class="difflineminus">-</span>
<a href="#l21.625"></a><span id="l21.625" class="difflineminus">-  // check if the realloc worked and if so, free old memory and</span>
<a href="#l21.626"></a><span id="l21.626" class="difflineminus">-  // return...if not, just return the original buffer</span>
<a href="#l21.627"></a><span id="l21.627" class="difflineminus">-  if (!newBuf)</span>
<a href="#l21.628"></a><span id="l21.628" class="difflineminus">-  {</span>
<a href="#l21.629"></a><span id="l21.629" class="difflineminus">-    return(noteText);</span>
<a href="#l21.630"></a><span id="l21.630" class="difflineminus">-  }</span>
<a href="#l21.631"></a><span id="l21.631" class="difflineminus">-  else</span>
<a href="#l21.632"></a><span id="l21.632" class="difflineminus">-  {</span>
<a href="#l21.633"></a><span id="l21.633" class="difflineminus">-    free(noteText);</span>
<a href="#l21.634"></a><span id="l21.634" class="difflineminus">-    return(newBuf);</span>
<a href="#l21.635"></a><span id="l21.635" class="difflineminus">-  }</span>
<a href="#l21.636"></a><span id="l21.636" class="difflineminus">-}</span>
<a href="#l21.637"></a><span id="l21.637" class="difflineminus">-</span>
<a href="#l21.638"></a><span id="l21.638" class="difflineminus">-#ifdef WIN16</span>
<a href="#l21.639"></a><span id="l21.639" class="difflineminus">-</span>
<a href="#l21.640"></a><span id="l21.640" class="difflineminus">-void</span>
<a href="#l21.641"></a><span id="l21.641" class="difflineminus">-GetWin16TempName(LPSTR realFileName, LPSTR tempPath, </span>
<a href="#l21.642"></a><span id="l21.642" class="difflineminus">-				 LPSTR szTempFileName, UINT uUnique)</span>
<a href="#l21.643"></a><span id="l21.643" class="difflineminus">-{</span>
<a href="#l21.644"></a><span id="l21.644" class="difflineminus">-  char	 *dotPtr = strrchr(realFileName, '.');</span>
<a href="#l21.645"></a><span id="l21.645" class="difflineminus">-  if (dotPtr != NULL)</span>
<a href="#l21.646"></a><span id="l21.646" class="difflineminus">-  {</span>
<a href="#l21.647"></a><span id="l21.647" class="difflineminus">-    *dotPtr = '\0';</span>
<a href="#l21.648"></a><span id="l21.648" class="difflineminus">-  }                </span>
<a href="#l21.649"></a><span id="l21.649" class="difflineminus">-  </span>
<a href="#l21.650"></a><span id="l21.650" class="difflineminus">-  int nameLen = lstrlen(realFileName); </span>
<a href="#l21.651"></a><span id="l21.651" class="difflineminus">-  if (dotPtr != NULL)</span>
<a href="#l21.652"></a><span id="l21.652" class="difflineminus">-  {</span>
<a href="#l21.653"></a><span id="l21.653" class="difflineminus">-    *dotPtr = '.';</span>
<a href="#l21.654"></a><span id="l21.654" class="difflineminus">-  }</span>
<a href="#l21.655"></a><span id="l21.655" class="difflineminus">-  </span>
<a href="#l21.656"></a><span id="l21.656" class="difflineminus">-  if (nameLen &lt;= 7)</span>
<a href="#l21.657"></a><span id="l21.657" class="difflineminus">-  {</span>
<a href="#l21.658"></a><span id="l21.658" class="difflineminus">- 	wsprintf(szTempFileName, &quot;%s\\%d%s&quot;, tempPath, uUnique, realFileName);</span>
<a href="#l21.659"></a><span id="l21.659" class="difflineminus">-  }</span>
<a href="#l21.660"></a><span id="l21.660" class="difflineminus">-  else</span>
<a href="#l21.661"></a><span id="l21.661" class="difflineminus">-  {</span>
<a href="#l21.662"></a><span id="l21.662" class="difflineminus">-  	wsprintf(szTempFileName, &quot;%s\\%d%s&quot;, tempPath, uUnique, (realFileName + 1));</span>
<a href="#l21.663"></a><span id="l21.663" class="difflineminus">-  }</span>
<a href="#l21.664"></a><span id="l21.664" class="difflineminus">-}</span>
<a href="#l21.665"></a><span id="l21.665" class="difflineminus">-</span>
<a href="#l21.666"></a><span id="l21.666" class="difflineminus">-#endif</span>
<a href="#l21.667"></a><span id="l21.667" class="difflineminus">-</span>
<a href="#l21.668"></a><span id="l21.668" class="difflineminus">-#define MAXTRY  9999  // How many times do we try..</span>
<a href="#l21.669"></a><span id="l21.669" class="difflineminus">-</span>
<a href="#l21.670"></a><span id="l21.670" class="difflineminus">-UINT</span>
<a href="#l21.671"></a><span id="l21.671" class="difflineminus">-GetTempMailNameWithExtension(LPSTR szTempFileName, </span>
<a href="#l21.672"></a><span id="l21.672" class="difflineminus">-                             LPSTR origName)</span>
<a href="#l21.673"></a><span id="l21.673" class="difflineminus">-{</span>
<a href="#l21.674"></a><span id="l21.674" class="difflineminus">-  UINT        res = 1;</span>
<a href="#l21.675"></a><span id="l21.675" class="difflineminus">-  UINT        uUnique = 0;</span>
<a href="#l21.676"></a><span id="l21.676" class="difflineminus">-  char        *szTempPath = GetTheTempDirectoryOnTheSystem();</span>
<a href="#l21.677"></a><span id="l21.677" class="difflineminus">-  char        *tmpPtr;</span>
<a href="#l21.678"></a><span id="l21.678" class="difflineminus">-  char        *realFileName = NULL;</span>
<a href="#l21.679"></a><span id="l21.679" class="difflineminus">-</span>
<a href="#l21.680"></a><span id="l21.680" class="difflineminus">-  if ( (origName != NULL) &amp;&amp; (*origName != '\0') )</span>
<a href="#l21.681"></a><span id="l21.681" class="difflineminus">-  {</span>
<a href="#l21.682"></a><span id="l21.682" class="difflineminus">-    tmpPtr = origName;</span>
<a href="#l21.683"></a><span id="l21.683" class="difflineminus">-  }</span>
<a href="#l21.684"></a><span id="l21.684" class="difflineminus">-  else</span>
<a href="#l21.685"></a><span id="l21.685" class="difflineminus">-  {</span>
<a href="#l21.686"></a><span id="l21.686" class="difflineminus">-    tmpPtr = szTempFileName;</span>
<a href="#l21.687"></a><span id="l21.687" class="difflineminus">-  }</span>
<a href="#l21.688"></a><span id="l21.688" class="difflineminus">-</span>
<a href="#l21.689"></a><span id="l21.689" class="difflineminus">-  realFileName = strrchr(tmpPtr, '\\');</span>
<a href="#l21.690"></a><span id="l21.690" class="difflineminus">-  if (!realFileName)</span>
<a href="#l21.691"></a><span id="l21.691" class="difflineminus">-    realFileName = tmpPtr;</span>
<a href="#l21.692"></a><span id="l21.692" class="difflineminus">-  else</span>
<a href="#l21.693"></a><span id="l21.693" class="difflineminus">-    realFileName++;</span>
<a href="#l21.694"></a><span id="l21.694" class="difflineminus">-</span>
<a href="#l21.695"></a><span id="l21.695" class="difflineminus">-TRYAGAIN:</span>
<a href="#l21.696"></a><span id="l21.696" class="difflineminus">-</span>
<a href="#l21.697"></a><span id="l21.697" class="difflineminus">-#ifdef WIN32</span>
<a href="#l21.698"></a><span id="l21.698" class="difflineminus">-  if (uUnique == 0)</span>
<a href="#l21.699"></a><span id="l21.699" class="difflineminus">-  {</span>
<a href="#l21.700"></a><span id="l21.700" class="difflineminus">-    wsprintf(szTempFileName, &quot;%s\\%s&quot;, szTempPath, realFileName);</span>
<a href="#l21.701"></a><span id="l21.701" class="difflineminus">-  }</span>
<a href="#l21.702"></a><span id="l21.702" class="difflineminus">-  else</span>
<a href="#l21.703"></a><span id="l21.703" class="difflineminus">-  {</span>
<a href="#l21.704"></a><span id="l21.704" class="difflineminus">-    wsprintf(szTempFileName, &quot;%s\\%d_%s&quot;, </span>
<a href="#l21.705"></a><span id="l21.705" class="difflineminus">-                szTempPath, uUnique, realFileName);</span>
<a href="#l21.706"></a><span id="l21.706" class="difflineminus">-  }</span>
<a href="#l21.707"></a><span id="l21.707" class="difflineminus">-#else // WIN16</span>
<a href="#l21.708"></a><span id="l21.708" class="difflineminus">-  if ( (uUnique == 0) &amp;&amp; (strlen(realFileName) &lt;= 12) )</span>
<a href="#l21.709"></a><span id="l21.709" class="difflineminus">-  {</span>
<a href="#l21.710"></a><span id="l21.710" class="difflineminus">-    wsprintf(szTempFileName, &quot;%s\\%s&quot;, szTempPath, realFileName);</span>
<a href="#l21.711"></a><span id="l21.711" class="difflineminus">-  }</span>
<a href="#l21.712"></a><span id="l21.712" class="difflineminus">-  else</span>
<a href="#l21.713"></a><span id="l21.713" class="difflineminus">-  {              </span>
<a href="#l21.714"></a><span id="l21.714" class="difflineminus">-    if (uUnique &lt; 10)</span>
<a href="#l21.715"></a><span id="l21.715" class="difflineminus">-    {</span>
<a href="#l21.716"></a><span id="l21.716" class="difflineminus">-      GetWin16TempName(realFileName, szTempPath, szTempFileName, uUnique);</span>
<a href="#l21.717"></a><span id="l21.717" class="difflineminus">-    }</span>
<a href="#l21.718"></a><span id="l21.718" class="difflineminus">-    else </span>
<a href="#l21.719"></a><span id="l21.719" class="difflineminus">-    { </span>
<a href="#l21.720"></a><span id="l21.720" class="difflineminus">-      res = ISGetTempFileName(szTempPath, &quot;ns&quot;, uUnique++, szTempFileName);    </span>
<a href="#l21.721"></a><span id="l21.721" class="difflineminus">-    }</span>
<a href="#l21.722"></a><span id="l21.722" class="difflineminus">-</span>
<a href="#l21.723"></a><span id="l21.723" class="difflineminus">-    // Now add the correct extension...</span>
<a href="#l21.724"></a><span id="l21.724" class="difflineminus">-    char *origExt = strrchr(realFileName, '.');</span>
<a href="#l21.725"></a><span id="l21.725" class="difflineminus">-    if (origExt != NULL)</span>
<a href="#l21.726"></a><span id="l21.726" class="difflineminus">-    {</span>
<a href="#l21.727"></a><span id="l21.727" class="difflineminus">-      char *tmpExt = strrchr(szTempFileName, '.');</span>
<a href="#l21.728"></a><span id="l21.728" class="difflineminus">-      if (tmpExt != NULL)</span>
<a href="#l21.729"></a><span id="l21.729" class="difflineminus">-      {</span>
<a href="#l21.730"></a><span id="l21.730" class="difflineminus">-        origExt++;</span>
<a href="#l21.731"></a><span id="l21.731" class="difflineminus">-        tmpExt++;</span>
<a href="#l21.732"></a><span id="l21.732" class="difflineminus">-</span>
<a href="#l21.733"></a><span id="l21.733" class="difflineminus">-        while ( ((tmpExt) &amp;&amp; (origExt)) &amp;&amp; (*origExt != '\0') )</span>
<a href="#l21.734"></a><span id="l21.734" class="difflineminus">-        {</span>
<a href="#l21.735"></a><span id="l21.735" class="difflineminus">-          *tmpExt = *origExt;</span>
<a href="#l21.736"></a><span id="l21.736" class="difflineminus">-          tmpExt++;</span>
<a href="#l21.737"></a><span id="l21.737" class="difflineminus">-          origExt++;</span>
<a href="#l21.738"></a><span id="l21.738" class="difflineminus">-        }</span>
<a href="#l21.739"></a><span id="l21.739" class="difflineminus">-</span>
<a href="#l21.740"></a><span id="l21.740" class="difflineminus">-        *tmpExt = '\0';</span>
<a href="#l21.741"></a><span id="l21.741" class="difflineminus">-      }</span>
<a href="#l21.742"></a><span id="l21.742" class="difflineminus">-    }</span>
<a href="#l21.743"></a><span id="l21.743" class="difflineminus">-  }</span>
<a href="#l21.744"></a><span id="l21.744" class="difflineminus">-#endif</span>
<a href="#l21.745"></a><span id="l21.745" class="difflineminus">-</span>
<a href="#l21.746"></a><span id="l21.746" class="difflineminus">-  if ( (ValidateFile(szTempFileName) != 1) &amp;&amp; (uUnique &lt; MAXTRY) )</span>
<a href="#l21.747"></a><span id="l21.747" class="difflineminus">-  {</span>
<a href="#l21.748"></a><span id="l21.748" class="difflineminus">-    uUnique++;</span>
<a href="#l21.749"></a><span id="l21.749" class="difflineminus">-    if (uUnique &gt;= MAXTRY)</span>
<a href="#l21.750"></a><span id="l21.750" class="difflineminus">-      return(1);</span>
<a href="#l21.751"></a><span id="l21.751" class="difflineminus">-    goto TRYAGAIN;</span>
<a href="#l21.752"></a><span id="l21.752" class="difflineminus">-  }</span>
<a href="#l21.753"></a><span id="l21.753" class="difflineminus">-</span>
<a href="#l21.754"></a><span id="l21.754" class="difflineminus">-  return res;</span>
<a href="#l21.755"></a><span id="l21.755" class="difflineminus">-}</span>
<a href="#l21.756"></a><span id="l21.756" class="difflineminus">-</span>
<a href="#l21.757"></a><span id="l21.757" class="difflineminus">-#define kMaxTempFiles   10</span>
<a href="#l21.758"></a><span id="l21.758" class="difflineminus">-#define kMaxListLength  (10 * _MAX_PATH)</span>
<a href="#l21.759"></a><span id="l21.759" class="difflineminus">-</span>
<a href="#l21.760"></a><span id="l21.760" class="difflineminus">-void GetTempFiles(LPSTR pBuf, int lenBuf)</span>
<a href="#l21.761"></a><span id="l21.761" class="difflineminus">-{</span>
<a href="#l21.762"></a><span id="l21.762" class="difflineminus">-  if (!GetConfigInfoStr(szMapiSection, szTempFiles, pBuf, lenBuf, HKEY_ROOT))</span>
<a href="#l21.763"></a><span id="l21.763" class="difflineminus">-  {</span>
<a href="#l21.764"></a><span id="l21.764" class="difflineminus">-    *pBuf = 0;</span>
<a href="#l21.765"></a><span id="l21.765" class="difflineminus">-  }</span>
<a href="#l21.766"></a><span id="l21.766" class="difflineminus">-}</span>
<a href="#l21.767"></a><span id="l21.767" class="difflineminus">-</span>
<a href="#l21.768"></a><span id="l21.768" class="difflineminus">-void WriteTempFiles(LPSTR pBuf)</span>
<a href="#l21.769"></a><span id="l21.769" class="difflineminus">-{</span>
<a href="#l21.770"></a><span id="l21.770" class="difflineminus">-  SetConfigInfoStr(szMapiSection, szTempFiles, pBuf, HKEY_ROOT);</span>
<a href="#l21.771"></a><span id="l21.771" class="difflineminus">-}</span>
<a href="#l21.772"></a><span id="l21.772" class="difflineminus">-</span>
<a href="#l21.773"></a><span id="l21.773" class="difflineminus">-void  AddTempFile(LPCSTR pFileName)</span>
<a href="#l21.774"></a><span id="l21.774" class="difflineminus">-{</span>
<a href="#l21.775"></a><span id="l21.775" class="difflineminus">-  if ( (!pFileName) || (pFileName[0] == '\0') )</span>
<a href="#l21.776"></a><span id="l21.776" class="difflineminus">-    return;</span>
<a href="#l21.777"></a><span id="l21.777" class="difflineminus">-</span>
<a href="#l21.778"></a><span id="l21.778" class="difflineminus">-  char *files = (char *)malloc(kMaxListLength);</span>
<a href="#l21.779"></a><span id="l21.779" class="difflineminus">-</span>
<a href="#l21.780"></a><span id="l21.780" class="difflineminus">-  if (!files)</span>
<a href="#l21.781"></a><span id="l21.781" class="difflineminus">-    return;</span>
<a href="#l21.782"></a><span id="l21.782" class="difflineminus">-</span>
<a href="#l21.783"></a><span id="l21.783" class="difflineminus">-  GetTempFiles(files, kMaxListLength);</span>
<a href="#l21.784"></a><span id="l21.784" class="difflineminus">-  if ((lstrlen(files) + lstrlen(pFileName) + 2) &gt;= kMaxListLength)</span>
<a href="#l21.785"></a><span id="l21.785" class="difflineminus">-  {</span>
<a href="#l21.786"></a><span id="l21.786" class="difflineminus">-    free(files);</span>
<a href="#l21.787"></a><span id="l21.787" class="difflineminus">-    return;</span>
<a href="#l21.788"></a><span id="l21.788" class="difflineminus">-  }</span>
<a href="#l21.789"></a><span id="l21.789" class="difflineminus">-</span>
<a href="#l21.790"></a><span id="l21.790" class="difflineminus">-  if (lstrlen(files) != 0)</span>
<a href="#l21.791"></a><span id="l21.791" class="difflineminus">-  {</span>
<a href="#l21.792"></a><span id="l21.792" class="difflineminus">-          lstrcat(files, &quot;;&quot;);</span>
<a href="#l21.793"></a><span id="l21.793" class="difflineminus">-  }</span>
<a href="#l21.794"></a><span id="l21.794" class="difflineminus">-</span>
<a href="#l21.795"></a><span id="l21.795" class="difflineminus">-  lstrcat(files, pFileName);</span>
<a href="#l21.796"></a><span id="l21.796" class="difflineminus">-  WriteTempFiles(files);</span>
<a href="#l21.797"></a><span id="l21.797" class="difflineminus">-  free(files);</span>
<a href="#l21.798"></a><span id="l21.798" class="difflineminus">-}</span>
<a href="#l21.799"></a><span id="l21.799" class="difflineminus">-</span>
<a href="#l21.800"></a><span id="l21.800" class="difflineminus">-void DeleteFirstTempFile(LPSTR pFiles)</span>
<a href="#l21.801"></a><span id="l21.801" class="difflineminus">-{</span>
<a href="#l21.802"></a><span id="l21.802" class="difflineminus">-  if (!*pFiles)</span>
<a href="#l21.803"></a><span id="l21.803" class="difflineminus">-    return;</span>
<a href="#l21.804"></a><span id="l21.804" class="difflineminus">-  LPSTR pTemp = strchr(pFiles, ';');</span>
<a href="#l21.805"></a><span id="l21.805" class="difflineminus">-  if (pTemp)</span>
<a href="#l21.806"></a><span id="l21.806" class="difflineminus">-  {</span>
<a href="#l21.807"></a><span id="l21.807" class="difflineminus">-    *pTemp = 0;</span>
<a href="#l21.808"></a><span id="l21.808" class="difflineminus">-  }</span>
<a href="#l21.809"></a><span id="l21.809" class="difflineminus">- </span>
<a href="#l21.810"></a><span id="l21.810" class="difflineminus">-//#ifndef _DEBUG  </span>
<a href="#l21.811"></a><span id="l21.811" class="difflineminus">-  _unlink(pFiles);</span>
<a href="#l21.812"></a><span id="l21.812" class="difflineminus">-//#endif</span>
<a href="#l21.813"></a><span id="l21.813" class="difflineminus">-</span>
<a href="#l21.814"></a><span id="l21.814" class="difflineminus">-  if (pTemp)</span>
<a href="#l21.815"></a><span id="l21.815" class="difflineminus">-  {</span>
<a href="#l21.816"></a><span id="l21.816" class="difflineminus">-    memmove(pFiles, pTemp + 1, lstrlen(pTemp + 1) + 1);</span>
<a href="#l21.817"></a><span id="l21.817" class="difflineminus">-  }</span>
<a href="#l21.818"></a><span id="l21.818" class="difflineminus">-  else</span>
<a href="#l21.819"></a><span id="l21.819" class="difflineminus">-  {</span>
<a href="#l21.820"></a><span id="l21.820" class="difflineminus">-    *pFiles = 0;</span>
<a href="#l21.821"></a><span id="l21.821" class="difflineminus">-  }</span>
<a href="#l21.822"></a><span id="l21.822" class="difflineminus">-}</span>
<a href="#l21.823"></a><span id="l21.823" class="difflineminus">-</span>
<a href="#l21.824"></a><span id="l21.824" class="difflineminus">-void </span>
<a href="#l21.825"></a><span id="l21.825" class="difflineminus">-RemoveAllTempFiles(void)</span>
<a href="#l21.826"></a><span id="l21.826" class="difflineminus">-{</span>
<a href="#l21.827"></a><span id="l21.827" class="difflineminus">-  char *files = (char *)malloc(kMaxListLength);</span>
<a href="#l21.828"></a><span id="l21.828" class="difflineminus">-</span>
<a href="#l21.829"></a><span id="l21.829" class="difflineminus">-  if (!files)</span>
<a href="#l21.830"></a><span id="l21.830" class="difflineminus">-    return;</span>
<a href="#l21.831"></a><span id="l21.831" class="difflineminus">-</span>
<a href="#l21.832"></a><span id="l21.832" class="difflineminus">-  GetTempFiles(files, kMaxListLength);</span>
<a href="#l21.833"></a><span id="l21.833" class="difflineminus">-</span>
<a href="#l21.834"></a><span id="l21.834" class="difflineminus">-  while (*files)</span>
<a href="#l21.835"></a><span id="l21.835" class="difflineminus">-  {</span>
<a href="#l21.836"></a><span id="l21.836" class="difflineminus">-    DeleteFirstTempFile(files);</span>
<a href="#l21.837"></a><span id="l21.837" class="difflineminus">-  }</span>
<a href="#l21.838"></a><span id="l21.838" class="difflineminus">-</span>
<a href="#l21.839"></a><span id="l21.839" class="difflineminus">-  WriteTempFiles(files);</span>
<a href="#l21.840"></a><span id="l21.840" class="difflineminus">-  free(files);</span>
<a href="#l21.841"></a><span id="l21.841" class="difflineminus">-}</span>
<a href="#l21.842"></a><span id="l21.842" class="difflineminus">-</span>
<a href="#l21.843"></a><span id="l21.843" class="difflineminus">-void CheckAgeTempFiles(void)</span>
<a href="#l21.844"></a><span id="l21.844" class="difflineminus">-{</span>
<a href="#l21.845"></a><span id="l21.845" class="difflineminus">-  char *files = (char *)malloc(kMaxListLength);</span>
<a href="#l21.846"></a><span id="l21.846" class="difflineminus">-</span>
<a href="#l21.847"></a><span id="l21.847" class="difflineminus">-  if (!files)</span>
<a href="#l21.848"></a><span id="l21.848" class="difflineminus">-    return;</span>
<a href="#l21.849"></a><span id="l21.849" class="difflineminus">-</span>
<a href="#l21.850"></a><span id="l21.850" class="difflineminus">-  GetTempFiles(files, kMaxListLength);</span>
<a href="#l21.851"></a><span id="l21.851" class="difflineminus">-  int i = 0;</span>
<a href="#l21.852"></a><span id="l21.852" class="difflineminus">-  LPSTR pTemp = files;</span>
<a href="#l21.853"></a><span id="l21.853" class="difflineminus">-  while (TRUE)</span>
<a href="#l21.854"></a><span id="l21.854" class="difflineminus">-  {</span>
<a href="#l21.855"></a><span id="l21.855" class="difflineminus">-    pTemp = strchr(pTemp, ';');</span>
<a href="#l21.856"></a><span id="l21.856" class="difflineminus">-    if (!pTemp)</span>
<a href="#l21.857"></a><span id="l21.857" class="difflineminus">-      break;</span>
<a href="#l21.858"></a><span id="l21.858" class="difflineminus">-    ++pTemp;</span>
<a href="#l21.859"></a><span id="l21.859" class="difflineminus">-    ++i;</span>
<a href="#l21.860"></a><span id="l21.860" class="difflineminus">-  }</span>
<a href="#l21.861"></a><span id="l21.861" class="difflineminus">-</span>
<a href="#l21.862"></a><span id="l21.862" class="difflineminus">-  if (i &gt;= 10)</span>
<a href="#l21.863"></a><span id="l21.863" class="difflineminus">-  {</span>
<a href="#l21.864"></a><span id="l21.864" class="difflineminus">-    DeleteFirstTempFile(files);</span>
<a href="#l21.865"></a><span id="l21.865" class="difflineminus">-    WriteTempFiles(files);</span>
<a href="#l21.866"></a><span id="l21.866" class="difflineminus">-  }</span>
<a href="#l21.867"></a><span id="l21.867" class="difflineminus">-</span>
<a href="#l21.868"></a><span id="l21.868" class="difflineminus">-  free(files);</span>
<a href="#l21.869"></a><span id="l21.869" class="difflineminus">-}</span>
<a href="#l21.870"></a><span id="l21.870" class="difflineminus">-</span>
<a href="#l21.871"></a><span id="l21.871" class="difflineminus">-void </span>
<a href="#l21.872"></a><span id="l21.872" class="difflineminus">-CleanupMAPITempFiles(void)</span>
<a href="#l21.873"></a><span id="l21.873" class="difflineminus">-{</span>
<a href="#l21.874"></a><span id="l21.874" class="difflineminus">-  if (Is_16_OR_32_BIT_CommunitorRunning() == 0)</span>
<a href="#l21.875"></a><span id="l21.875" class="difflineminus">-  {</span>
<a href="#l21.876"></a><span id="l21.876" class="difflineminus">-    RemoveAllTempFiles();           // if Communicator not running, clean up all the temp files</span>
<a href="#l21.877"></a><span id="l21.877" class="difflineminus">-  }</span>
<a href="#l21.878"></a><span id="l21.878" class="difflineminus">-  else</span>
<a href="#l21.879"></a><span id="l21.879" class="difflineminus">-  {</span>
<a href="#l21.880"></a><span id="l21.880" class="difflineminus">-    CheckAgeTempFiles();</span>
<a href="#l21.881"></a><span id="l21.881" class="difflineminus">-  }</span>
<a href="#l21.882"></a><span id="l21.882" class="difflineminus">-}</span>
<a href="#l21.883"></a><span id="l21.883" class="difflineminus">-</span>
<a href="#l21.884"></a><span id="l21.884" class="difflineminus">-void *</span>
<a href="#l21.885"></a><span id="l21.885" class="difflineminus">-CleanMalloc(size_t mallocSize)</span>
<a href="#l21.886"></a><span id="l21.886" class="difflineminus">-{</span>
<a href="#l21.887"></a><span id="l21.887" class="difflineminus">-  void *ptr = malloc(mallocSize);</span>
<a href="#l21.888"></a><span id="l21.888" class="difflineminus">-  if (!ptr)</span>
<a href="#l21.889"></a><span id="l21.889" class="difflineminus">-    return(NULL);</span>
<a href="#l21.890"></a><span id="l21.890" class="difflineminus">-</span>
<a href="#l21.891"></a><span id="l21.891" class="difflineminus">-  memset(ptr, 0, mallocSize);</span>
<a href="#l21.892"></a><span id="l21.892" class="difflineminus">-  return(ptr);</span>
<a href="#l21.893"></a><span id="l21.893" class="difflineminus">-}</span>
<a href="#l21.894"></a><span id="l21.894" class="difflineminus">-</span>
<a href="#l21.895"></a><span id="l21.895" class="difflineminus">-void</span>
<a href="#l21.896"></a><span id="l21.896" class="difflineminus">-SafeFree(void *ptr)</span>
<a href="#l21.897"></a><span id="l21.897" class="difflineminus">-{</span>
<a href="#l21.898"></a><span id="l21.898" class="difflineminus">-  if (!ptr)</span>
<a href="#l21.899"></a><span id="l21.899" class="difflineminus">-    return;</span>
<a href="#l21.900"></a><span id="l21.900" class="difflineminus">-</span>
<a href="#l21.901"></a><span id="l21.901" class="difflineminus">-  free(ptr);</span>
<a href="#l21.902"></a><span id="l21.902" class="difflineminus">-  ptr = NULL;</span>
<a href="#l21.903"></a><span id="l21.903" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">deleted file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/mapiutl.h</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ /dev/null</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -1,89 +0,0 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineminus">- *</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l22.10"></a><span id="l22.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">- *</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">- * License.</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">- *</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">- *</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineminus">- *</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineminus">- *</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineminus">- *</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineminus">-#ifndef __UTILS_</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineminus">-#define __UTILS_</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineminus">-extern &quot;C&quot;</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineminus">-{</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineminus">-#endif</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineminus">-</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineminus">-#ifndef MAPI_OLE	// Because MSFT doesn't do this for us :-(</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineminus">-#include &lt;mapi.h&gt;</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineminus">-#endif</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineminus">-</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineminus">-//</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineminus">-// Utility functions...</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineminus">-//</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineminus">-void    SetLoggingEnabled(BOOL val);    // Set a logging enabled flag</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineminus">-void    LogString(LPCSTR pStr1);        // Log a string to a file...</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineminus">-void    BuildMemName(LPSTR name, ULONG winSeed);  // Shared memory name</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineminus">-HWND    GetCommunicatorIPCWindow(void);    // Get the IPC window we will use...</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineminus">-DWORD   SanityCheckAttachmentFiles(lpMapiMessage lpMessage); // Check attachments</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineminus">-DWORD   ValidateFile(LPCSTR szFile);       // Is this a valid file - 0=Yes 1 = NOT_FOUND 2 = OPEN_FAILURE</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineminus">-</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineminus">-DWORD   GetFileCount(LPSTR pFiles, LPSTR delimChar); // Get File count from string of file1;file2, etc..</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineminus">-BOOL    ExtractFile(LPSTR pFiles, LPSTR delimChar, DWORD fIndex, LPSTR fName); // Extract a filename from a string</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineminus">-</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineminus">-LPVOID  LoadBlobToMemory(LPSTR fName);  // Load the blob into memory!</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineminus">-LONG    GetTempAttachmentName(LPSTR fName); // Get a temp file name and put it in fName</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineminus">-</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineminus">-UINT    GetTempMailNameWithExtension(LPSTR szTempFileName, LPSTR origName);</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineminus">-void    CleanupMAPITempFiles(void);</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineminus">-void  AddTempFile(LPCSTR pFileName);</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineminus">-</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineminus">-void    *CleanMalloc(size_t mallocSize);</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineminus">-void    SafeFree(void *ptr);</span>
<a href="#l22.74"></a><span id="l22.74" class="difflineminus">-</span>
<a href="#l22.75"></a><span id="l22.75" class="difflineminus">-//</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineminus">-// RICHIE - this is a temporary fix for now to get rid of</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineminus">-// html stuff within the text of a message - if there was a</span>
<a href="#l22.78"></a><span id="l22.78" class="difflineminus">-// valid noteText buffer coming into this call, we need to </span>
<a href="#l22.79"></a><span id="l22.79" class="difflineminus">-// free it on the way out.</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineminus">-//</span>
<a href="#l22.81"></a><span id="l22.81" class="difflineminus">-LPSTR   StripHTML(LPSTR noteText);</span>
<a href="#l22.82"></a><span id="l22.82" class="difflineminus">-</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineminus">-//</span>
<a href="#l22.84"></a><span id="l22.84" class="difflineminus">-// Write a buffer to disk</span>
<a href="#l22.85"></a><span id="l22.85" class="difflineminus">-// Return 0 on success -1 on failure</span>
<a href="#l22.86"></a><span id="l22.86" class="difflineminus">-//</span>
<a href="#l22.87"></a><span id="l22.87" class="difflineminus">-LONG    WriteMemoryBufferToDisk(LPSTR fName, LONG bufSize, LPSTR buf); </span>
<a href="#l22.88"></a><span id="l22.88" class="difflineminus">-</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l22.90"></a><span id="l22.90" class="difflineminus">-}</span>
<a href="#l22.91"></a><span id="l22.91" class="difflineminus">-#endif</span>
<a href="#l22.92"></a><span id="l22.92" class="difflineminus">-</span>
<a href="#l22.93"></a><span id="l22.93" class="difflineminus">-#endif // __UTILS_</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">deleted file mode 100644</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/port.h</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineplus">+++ /dev/null</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineat">@@ -1,303 +0,0 @@</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l23.6"></a><span id="l23.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l23.8"></a><span id="l23.8" class="difflineminus">- *</span>
<a href="#l23.9"></a><span id="l23.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l23.11"></a><span id="l23.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">- *</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineminus">- * License.</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineminus">- *</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineminus">- *</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineminus">- *</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineminus">- *</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineminus">- *</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineminus">-//</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineminus">-</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineminus">-#ifndef PORT_H</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineminus">-#define PORT_H</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineminus">-</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l23.47"></a><span id="l23.47" class="difflineminus">-extern &quot;C&quot; {</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineminus">-#endif</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineminus">-</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineminus">-/*****************************************************************\</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineminus">- *                                                               *</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineminus">- *  PORT.H                                                       *</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineminus">- *                                                               *</span>
<a href="#l23.54"></a><span id="l23.54" class="difflineminus">- *  Win16/Win32 portability stuff                                *</span>
<a href="#l23.55"></a><span id="l23.55" class="difflineminus">- *                                                               *</span>
<a href="#l23.56"></a><span id="l23.56" class="difflineminus">- *  A.Sokolsky                                                   *</span>
<a href="#l23.57"></a><span id="l23.57" class="difflineminus">- *      3.10.94 distilled into this header                       *</span>
<a href="#l23.58"></a><span id="l23.58" class="difflineminus">- *                                                               *</span>
<a href="#l23.59"></a><span id="l23.59" class="difflineminus">-\*****************************************************************/</span>
<a href="#l23.60"></a><span id="l23.60" class="difflineminus">-</span>
<a href="#l23.61"></a><span id="l23.61" class="difflineminus">-/*</span>
<a href="#l23.62"></a><span id="l23.62" class="difflineminus">- * calling conventions</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineminus">- */</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineminus">-#include &lt;assert.h&gt;</span>
<a href="#l23.65"></a><span id="l23.65" class="difflineminus">-                                                      </span>
<a href="#l23.66"></a><span id="l23.66" class="difflineminus">-                                                      </span>
<a href="#l23.67"></a><span id="l23.67" class="difflineminus">-#ifndef CDECL</span>
<a href="#l23.68"></a><span id="l23.68" class="difflineminus">-#define CDECL __cdecl</span>
<a href="#l23.69"></a><span id="l23.69" class="difflineminus">-#endif  // CDECL</span>
<a href="#l23.70"></a><span id="l23.70" class="difflineminus">-</span>
<a href="#l23.71"></a><span id="l23.71" class="difflineminus">-#ifndef PASCAL</span>
<a href="#l23.72"></a><span id="l23.72" class="difflineminus">-#define PASCAL __pascal</span>
<a href="#l23.73"></a><span id="l23.73" class="difflineminus">-#endif  // PASCAL</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineminus">-</span>
<a href="#l23.75"></a><span id="l23.75" class="difflineminus">-#ifdef FASTCALL</span>
<a href="#l23.76"></a><span id="l23.76" class="difflineminus">-#error FASTCALL defined</span>
<a href="#l23.77"></a><span id="l23.77" class="difflineminus">-#endif // FASTCALL</span>
<a href="#l23.78"></a><span id="l23.78" class="difflineminus">-</span>
<a href="#l23.79"></a><span id="l23.79" class="difflineminus">-</span>
<a href="#l23.80"></a><span id="l23.80" class="difflineminus">-#ifdef NDEBUG</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineminus">-#define FASTCALL __fastcall</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineminus">-#else</span>
<a href="#l23.83"></a><span id="l23.83" class="difflineminus">-#define FASTCALL PASCAL</span>
<a href="#l23.84"></a><span id="l23.84" class="difflineminus">-#endif // NDEBUG   </span>
<a href="#l23.85"></a><span id="l23.85" class="difflineminus">-</span>
<a href="#l23.86"></a><span id="l23.86" class="difflineminus">-</span>
<a href="#l23.87"></a><span id="l23.87" class="difflineminus">-</span>
<a href="#l23.88"></a><span id="l23.88" class="difflineminus">-#ifndef HWND2DWORD</span>
<a href="#l23.89"></a><span id="l23.89" class="difflineminus">-#  ifdef WIN32</span>
<a href="#l23.90"></a><span id="l23.90" class="difflineminus">-#    define HWND2DWORD(X_hWnd) ( (DWORD)(X_hWnd) )</span>
<a href="#l23.91"></a><span id="l23.91" class="difflineminus">-#  else // WIN16</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineminus">-#    define HWND2DWORD(X_hWnd) ( (DWORD)MAKELONG(((WORD)(X_hWnd)), 0) )</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineminus">-#  endif</span>
<a href="#l23.94"></a><span id="l23.94" class="difflineminus">-#endif // HWND2DWORD</span>
<a href="#l23.95"></a><span id="l23.95" class="difflineminus">-</span>
<a href="#l23.96"></a><span id="l23.96" class="difflineminus">-</span>
<a href="#l23.97"></a><span id="l23.97" class="difflineminus">-/*</span>
<a href="#l23.98"></a><span id="l23.98" class="difflineminus">- * WIN16 - WIN32 compatibility stuff</span>
<a href="#l23.99"></a><span id="l23.99" class="difflineminus">- */</span>
<a href="#l23.100"></a><span id="l23.100" class="difflineminus">-</span>
<a href="#l23.101"></a><span id="l23.101" class="difflineminus">-#ifdef WIN32</span>
<a href="#l23.102"></a><span id="l23.102" class="difflineminus">-</span>
<a href="#l23.103"></a><span id="l23.103" class="difflineminus">-# define DLLEXPORT    __declspec( dllexport )</span>
<a href="#l23.104"></a><span id="l23.104" class="difflineminus">-# define EXPORT</span>
<a href="#l23.105"></a><span id="l23.105" class="difflineminus">-# define LOADDS</span>
<a href="#l23.106"></a><span id="l23.106" class="difflineminus">-# define HUGE</span>
<a href="#l23.107"></a><span id="l23.107" class="difflineminus">-# ifndef FAR</span>
<a href="#l23.108"></a><span id="l23.108" class="difflineminus">-#  define FAR</span>
<a href="#l23.109"></a><span id="l23.109" class="difflineminus">-# endif // FAR</span>
<a href="#l23.110"></a><span id="l23.110" class="difflineminus">-# ifndef NEAR</span>
<a href="#l23.111"></a><span id="l23.111" class="difflineminus">-#  define NEAR</span>
<a href="#l23.112"></a><span id="l23.112" class="difflineminus">-# endif // NEAR </span>
<a href="#l23.113"></a><span id="l23.113" class="difflineminus">-# ifdef UNICODE</span>
<a href="#l23.114"></a><span id="l23.114" class="difflineminus">-#  define SIZEOF(x)   (sizeof(x)/sizeof(WCHAR))</span>
<a href="#l23.115"></a><span id="l23.115" class="difflineminus">-# else</span>
<a href="#l23.116"></a><span id="l23.116" class="difflineminus">-#  define SIZEOF(x)   sizeof(x)</span>
<a href="#l23.117"></a><span id="l23.117" class="difflineminus">-# endif</span>
<a href="#l23.118"></a><span id="l23.118" class="difflineminus">-</span>
<a href="#l23.119"></a><span id="l23.119" class="difflineminus">-#else  // !WIN32 == WIN16</span>
<a href="#l23.120"></a><span id="l23.120" class="difflineminus">-</span>
<a href="#l23.121"></a><span id="l23.121" class="difflineminus">-# define DLLEXPORT    </span>
<a href="#l23.122"></a><span id="l23.122" class="difflineminus">-# define EXPORT       __export</span>
<a href="#l23.123"></a><span id="l23.123" class="difflineminus">-# define LOADDS       __loadds</span>
<a href="#l23.124"></a><span id="l23.124" class="difflineminus">-# define HUGE         __huge</span>
<a href="#l23.125"></a><span id="l23.125" class="difflineminus">-# ifndef FAR</span>
<a href="#l23.126"></a><span id="l23.126" class="difflineminus">-#   define FAR        __far</span>
<a href="#l23.127"></a><span id="l23.127" class="difflineminus">-#   define NEAR       __near</span>
<a href="#l23.128"></a><span id="l23.128" class="difflineminus">-# endif  // FAR</span>
<a href="#l23.129"></a><span id="l23.129" class="difflineminus">-# define CONST const</span>
<a href="#l23.130"></a><span id="l23.130" class="difflineminus">-# define SIZEOF(x)    sizeof(x)</span>
<a href="#l23.131"></a><span id="l23.131" class="difflineminus">-# define CHAR char</span>
<a href="#l23.132"></a><span id="l23.132" class="difflineminus">-# define TCHAR char</span>
<a href="#l23.133"></a><span id="l23.133" class="difflineminus">-# define WCHAR char</span>
<a href="#l23.134"></a><span id="l23.134" class="difflineminus">-# ifndef LPTSTR</span>
<a href="#l23.135"></a><span id="l23.135" class="difflineminus">-#   define LPTSTR LPSTR</span>
<a href="#l23.136"></a><span id="l23.136" class="difflineminus">-# endif</span>
<a href="#l23.137"></a><span id="l23.137" class="difflineminus">-# ifndef LPCTSTR </span>
<a href="#l23.138"></a><span id="l23.138" class="difflineminus">-#   define LPCTSTR LPCSTR</span>
<a href="#l23.139"></a><span id="l23.139" class="difflineminus">-# endif</span>
<a href="#l23.140"></a><span id="l23.140" class="difflineminus">-# define UNREFERENCED_PARAMETER(x) x;</span>
<a href="#l23.141"></a><span id="l23.141" class="difflineminus">-# ifndef TEXT</span>
<a href="#l23.142"></a><span id="l23.142" class="difflineminus">-#   define TEXT(x) x</span>
<a href="#l23.143"></a><span id="l23.143" class="difflineminus">-# endif</span>
<a href="#l23.144"></a><span id="l23.144" class="difflineminus">-# define GetWindowTextW GetWindowText</span>
<a href="#l23.145"></a><span id="l23.145" class="difflineminus">-# define lstrcpyW lstrcpy   </span>
<a href="#l23.146"></a><span id="l23.146" class="difflineminus">-</span>
<a href="#l23.147"></a><span id="l23.147" class="difflineminus">-# define BN_DBLCLK BN_DOUBLECLICKED // ~~MRJ needed for custom control.</span>
<a href="#l23.148"></a><span id="l23.148" class="difflineminus">-// ~~MRJ begin Win95 backward compat section</span>
<a href="#l23.149"></a><span id="l23.149" class="difflineminus">-# define LPWSTR LPSTR</span>
<a href="#l23.150"></a><span id="l23.150" class="difflineminus">-# define LPCWSTR LPCSTR</span>
<a href="#l23.151"></a><span id="l23.151" class="difflineminus">-</span>
<a href="#l23.152"></a><span id="l23.152" class="difflineminus">-// button check state for WIN16</span>
<a href="#l23.153"></a><span id="l23.153" class="difflineminus">-#ifndef BST_UNCHECKED</span>
<a href="#l23.154"></a><span id="l23.154" class="difflineminus">-#define BST_UNCHECKED      0x0000</span>
<a href="#l23.155"></a><span id="l23.155" class="difflineminus">-#endif</span>
<a href="#l23.156"></a><span id="l23.156" class="difflineminus">-</span>
<a href="#l23.157"></a><span id="l23.157" class="difflineminus">-#ifndef BST_CHECKED</span>
<a href="#l23.158"></a><span id="l23.158" class="difflineminus">-#define BST_CHECKED        0x0001</span>
<a href="#l23.159"></a><span id="l23.159" class="difflineminus">-#endif</span>
<a href="#l23.160"></a><span id="l23.160" class="difflineminus">-</span>
<a href="#l23.161"></a><span id="l23.161" class="difflineminus">-</span>
<a href="#l23.162"></a><span id="l23.162" class="difflineminus">-#ifndef WIN95_COMPAT</span>
<a href="#l23.163"></a><span id="l23.163" class="difflineminus">-#  define WIN95_COMPAT</span>
<a href="#l23.164"></a><span id="l23.164" class="difflineminus">-#endif</span>
<a href="#l23.165"></a><span id="l23.165" class="difflineminus">-</span>
<a href="#l23.166"></a><span id="l23.166" class="difflineminus">-// ~~MRJ end Win95 compat section.</span>
<a href="#l23.167"></a><span id="l23.167" class="difflineminus">-</span>
<a href="#l23.168"></a><span id="l23.168" class="difflineminus">-// critical section API stubs</span>
<a href="#l23.169"></a><span id="l23.169" class="difflineminus">-typedef DWORD CRITICAL_SECTION;</span>
<a href="#l23.170"></a><span id="l23.170" class="difflineminus">-typedef CRITICAL_SECTION FAR * LPCRITICAL_SECTION; </span>
<a href="#l23.171"></a><span id="l23.171" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l23.172"></a><span id="l23.172" class="difflineminus">-inline void InitializeCriticalSection(LPCRITICAL_SECTION lpSection) {}</span>
<a href="#l23.173"></a><span id="l23.173" class="difflineminus">-inline void DeleteCriticalSection(LPCRITICAL_SECTION lpSection) {}</span>
<a href="#l23.174"></a><span id="l23.174" class="difflineminus">-inline void EnterCriticalSection(LPCRITICAL_SECTION lpSection) {}</span>
<a href="#l23.175"></a><span id="l23.175" class="difflineminus">-inline void LeaveCriticalSection(LPCRITICAL_SECTION lpSection) {} </span>
<a href="#l23.176"></a><span id="l23.176" class="difflineminus">-#endif // __cplusplus </span>
<a href="#l23.177"></a><span id="l23.177" class="difflineminus">-</span>
<a href="#l23.178"></a><span id="l23.178" class="difflineminus">-// Added for nssock16 ---Neeti</span>
<a href="#l23.179"></a><span id="l23.179" class="difflineminus">-#ifndef ZeroMemory</span>
<a href="#l23.180"></a><span id="l23.180" class="difflineminus">-#include &lt;memory.h&gt;</span>
<a href="#l23.181"></a><span id="l23.181" class="difflineminus">-#define ZeroMemory(PTR, SIZE) memset(PTR, 0, SIZE)</span>
<a href="#l23.182"></a><span id="l23.182" class="difflineminus">-#endif // ZeroMemory</span>
<a href="#l23.183"></a><span id="l23.183" class="difflineminus">-</span>
<a href="#l23.184"></a><span id="l23.184" class="difflineminus">-#endif // WIN16</span>
<a href="#l23.185"></a><span id="l23.185" class="difflineminus">-</span>
<a href="#l23.186"></a><span id="l23.186" class="difflineminus">-/*</span>
<a href="#l23.187"></a><span id="l23.187" class="difflineminus">- * unix - windows compatibility stuff</span>
<a href="#l23.188"></a><span id="l23.188" class="difflineminus">- */</span>
<a href="#l23.189"></a><span id="l23.189" class="difflineminus">-typedef DWORD u_int32;</span>
<a href="#l23.190"></a><span id="l23.190" class="difflineminus">-typedef WORD  u_int16;</span>
<a href="#l23.191"></a><span id="l23.191" class="difflineminus">-typedef BYTE  u_int8;</span>
<a href="#l23.192"></a><span id="l23.192" class="difflineminus">-#ifdef WIN32</span>
<a href="#l23.193"></a><span id="l23.193" class="difflineminus">-typedef short int Bool16;</span>
<a href="#l23.194"></a><span id="l23.194" class="difflineminus">-#else  // WIN16</span>
<a href="#l23.195"></a><span id="l23.195" class="difflineminus">-typedef BOOL  Bool16;</span>
<a href="#l23.196"></a><span id="l23.196" class="difflineminus">-#endif // WIN16</span>
<a href="#l23.197"></a><span id="l23.197" class="difflineminus">-</span>
<a href="#l23.198"></a><span id="l23.198" class="difflineminus">-/*</span>
<a href="#l23.199"></a><span id="l23.199" class="difflineminus">- * Cross Platform Compatibility</span>
<a href="#l23.200"></a><span id="l23.200" class="difflineminus">- */</span>
<a href="#l23.201"></a><span id="l23.201" class="difflineminus">-#ifndef UNALIGNED</span>
<a href="#l23.202"></a><span id="l23.202" class="difflineminus">-# ifdef _M_ALPHA</span>
<a href="#l23.203"></a><span id="l23.203" class="difflineminus">-#  define UNALIGNED __unaligned</span>
<a href="#l23.204"></a><span id="l23.204" class="difflineminus">-# else  // !_M_ALPHA</span>
<a href="#l23.205"></a><span id="l23.205" class="difflineminus">-#  define UNALIGNED</span>
<a href="#l23.206"></a><span id="l23.206" class="difflineminus">-# endif // !_M_ALPHA</span>
<a href="#l23.207"></a><span id="l23.207" class="difflineminus">-#endif  // UNALIGNED</span>
<a href="#l23.208"></a><span id="l23.208" class="difflineminus">-</span>
<a href="#l23.209"></a><span id="l23.209" class="difflineminus">-//</span>
<a href="#l23.210"></a><span id="l23.210" class="difflineminus">-// RICHIE - for the Alpha port</span>
<a href="#l23.211"></a><span id="l23.211" class="difflineminus">-//</span>
<a href="#l23.212"></a><span id="l23.212" class="difflineminus">-#ifdef _M_ALPHA</span>
<a href="#l23.213"></a><span id="l23.213" class="difflineminus">-# undef pascal</span>
<a href="#l23.214"></a><span id="l23.214" class="difflineminus">-# undef PASCAL</span>
<a href="#l23.215"></a><span id="l23.215" class="difflineminus">-# if (_MSC_VER &gt;= 800) || defined(_STDCALL_SUPPORTED)</span>
<a href="#l23.216"></a><span id="l23.216" class="difflineminus">-#  define pascal __stdcall</span>
<a href="#l23.217"></a><span id="l23.217" class="difflineminus">-#  define PASCAL __stdcall</span>
<a href="#l23.218"></a><span id="l23.218" class="difflineminus">-# else</span>
<a href="#l23.219"></a><span id="l23.219" class="difflineminus">-#  define PASCAL</span>
<a href="#l23.220"></a><span id="l23.220" class="difflineminus">-# endif</span>
<a href="#l23.221"></a><span id="l23.221" class="difflineminus">-#endif</span>
<a href="#l23.222"></a><span id="l23.222" class="difflineminus">-</span>
<a href="#l23.223"></a><span id="l23.223" class="difflineminus">-</span>
<a href="#l23.224"></a><span id="l23.224" class="difflineminus">-/*</span>
<a href="#l23.225"></a><span id="l23.225" class="difflineminus">- * Useful Types</span>
<a href="#l23.226"></a><span id="l23.226" class="difflineminus">- */</span>
<a href="#l23.227"></a><span id="l23.227" class="difflineminus">-typedef char HUGE *HPSTR;</span>
<a href="#l23.228"></a><span id="l23.228" class="difflineminus">-typedef const char HUGE *HPCSTR;</span>
<a href="#l23.229"></a><span id="l23.229" class="difflineminus">-typedef unsigned char HUGE *HPBYTE;</span>
<a href="#l23.230"></a><span id="l23.230" class="difflineminus">-typedef WORD HUGE *HPWORD;</span>
<a href="#l23.231"></a><span id="l23.231" class="difflineminus">-typedef UINT FAR *LPUINT;</span>
<a href="#l23.232"></a><span id="l23.232" class="difflineminus">-typedef BOOL (CALLBACK *USERABORTPROC)();</span>
<a href="#l23.233"></a><span id="l23.233" class="difflineminus">-typedef BOOL (CALLBACK *PROGRESSPROC)(UINT uPos, UINT uRange);</span>
<a href="#l23.234"></a><span id="l23.234" class="difflineminus">-typedef int INT;   // ~~MRJ a function needed this defined.</span>
<a href="#l23.235"></a><span id="l23.235" class="difflineminus">-typedef MINMAXINFO FAR *LPMINMAXINFO; // ~~MRJ </span>
<a href="#l23.236"></a><span id="l23.236" class="difflineminus">-</span>
<a href="#l23.237"></a><span id="l23.237" class="difflineminus">-//</span>
<a href="#l23.238"></a><span id="l23.238" class="difflineminus">-// stuff missing from windows.h</span>
<a href="#l23.239"></a><span id="l23.239" class="difflineminus">-//</span>
<a href="#l23.240"></a><span id="l23.240" class="difflineminus">-#ifndef MAKEWORD</span>
<a href="#l23.241"></a><span id="l23.241" class="difflineminus">-#define MAKEWORD(low, high)    ((WORD)(((BYTE)(low)) | (((WORD)((BYTE)(high))) &lt;&lt; 8)))</span>
<a href="#l23.242"></a><span id="l23.242" class="difflineminus">-#endif // MAKEWORD</span>
<a href="#l23.243"></a><span id="l23.243" class="difflineminus">-</span>
<a href="#l23.244"></a><span id="l23.244" class="difflineminus">-#ifdef WIN32</span>
<a href="#l23.245"></a><span id="l23.245" class="difflineminus">-# ifndef hmemcpy</span>
<a href="#l23.246"></a><span id="l23.246" class="difflineminus">-#  define hmemcpy memcpy</span>
<a href="#l23.247"></a><span id="l23.247" class="difflineminus">-# endif // !defined(hmemcpy)</span>
<a href="#l23.248"></a><span id="l23.248" class="difflineminus">-# define _fmemset memset</span>
<a href="#l23.249"></a><span id="l23.249" class="difflineminus">-</span>
<a href="#l23.250"></a><span id="l23.250" class="difflineminus">-# include &lt;malloc.h&gt;</span>
<a href="#l23.251"></a><span id="l23.251" class="difflineminus">-</span>
<a href="#l23.252"></a><span id="l23.252" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l23.253"></a><span id="l23.253" class="difflineminus">-</span>
<a href="#l23.254"></a><span id="l23.254" class="difflineminus">-inline BOOL IsGDIObject(HGDIOBJ hObj) { return (hObj != 0); }</span>
<a href="#l23.255"></a><span id="l23.255" class="difflineminus">-inline void *_halloc(long num, unsigned int size) { return malloc(num * size); }</span>
<a href="#l23.256"></a><span id="l23.256" class="difflineminus">-inline void _hfree( void *memblock ) { free(memblock); } </span>
<a href="#l23.257"></a><span id="l23.257" class="difflineminus">-/*</span>
<a href="#l23.258"></a><span id="l23.258" class="difflineminus">-inline BOOL IsInstance(HINSTANCE hInst) {</span>
<a href="#l23.259"></a><span id="l23.259" class="difflineminus">-# ifdef WIN32</span>
<a href="#l23.260"></a><span id="l23.260" class="difflineminus">-    return (hInst != 0);</span>
<a href="#l23.261"></a><span id="l23.261" class="difflineminus">-# else // WIN16</span>
<a href="#l23.262"></a><span id="l23.262" class="difflineminus">-    return (hInst &gt; HINSTANCE_ERROR);</span>
<a href="#l23.263"></a><span id="l23.263" class="difflineminus">-# endif  </span>
<a href="#l23.264"></a><span id="l23.264" class="difflineminus">-}  </span>
<a href="#l23.265"></a><span id="l23.265" class="difflineminus">-*/</span>
<a href="#l23.266"></a><span id="l23.266" class="difflineminus">-</span>
<a href="#l23.267"></a><span id="l23.267" class="difflineminus">-#endif // __cplusplus</span>
<a href="#l23.268"></a><span id="l23.268" class="difflineminus">-</span>
<a href="#l23.269"></a><span id="l23.269" class="difflineminus">-  WINUSERAPI HANDLE WINAPI LoadImageA(HINSTANCE, LPCSTR, UINT, int, int, UINT);</span>
<a href="#l23.270"></a><span id="l23.270" class="difflineminus">-</span>
<a href="#l23.271"></a><span id="l23.271" class="difflineminus">-#endif // WIN32</span>
<a href="#l23.272"></a><span id="l23.272" class="difflineminus">-</span>
<a href="#l23.273"></a><span id="l23.273" class="difflineminus">-#ifdef __cplusplus </span>
<a href="#l23.274"></a><span id="l23.274" class="difflineminus">-inline BOOL IsInstance(HINSTANCE hInst) {</span>
<a href="#l23.275"></a><span id="l23.275" class="difflineminus">-# ifdef WIN32</span>
<a href="#l23.276"></a><span id="l23.276" class="difflineminus">-    return (hInst != 0);</span>
<a href="#l23.277"></a><span id="l23.277" class="difflineminus">-# else // WIN16</span>
<a href="#l23.278"></a><span id="l23.278" class="difflineminus">-    return (hInst &gt; HINSTANCE_ERROR);</span>
<a href="#l23.279"></a><span id="l23.279" class="difflineminus">-# endif  </span>
<a href="#l23.280"></a><span id="l23.280" class="difflineminus">-} </span>
<a href="#l23.281"></a><span id="l23.281" class="difflineminus">-inline void SetWindowSmallIcon(HINSTANCE hInst, HWND hWnd, UINT uIconResourceId) {</span>
<a href="#l23.282"></a><span id="l23.282" class="difflineminus">-#ifdef WIN32</span>
<a href="#l23.283"></a><span id="l23.283" class="difflineminus">-# ifndef WM_SETICON</span>
<a href="#l23.284"></a><span id="l23.284" class="difflineminus">-#   define WM_SETICON 0x0080</span>
<a href="#l23.285"></a><span id="l23.285" class="difflineminus">-# endif  // WM_SETICON</span>
<a href="#l23.286"></a><span id="l23.286" class="difflineminus">-# ifndef IMAGE_ICON</span>
<a href="#l23.287"></a><span id="l23.287" class="difflineminus">-#   define IMAGE_ICON 1</span>
<a href="#l23.288"></a><span id="l23.288" class="difflineminus">-# endif</span>
<a href="#l23.289"></a><span id="l23.289" class="difflineminus">-  assert(IsWindow(hWnd));</span>
<a href="#l23.290"></a><span id="l23.290" class="difflineminus">-  HICON hIcon = (HICON)LoadImageA(hInst, MAKEINTRESOURCE(uIconResourceId), IMAGE_ICON,</span>
<a href="#l23.291"></a><span id="l23.291" class="difflineminus">-    16, 16, 0);</span>
<a href="#l23.292"></a><span id="l23.292" class="difflineminus">-  if(NULL != hIcon) {</span>
<a href="#l23.293"></a><span id="l23.293" class="difflineminus">-    SendMessage(hWnd, WM_SETICON, FALSE, (LPARAM)hIcon);</span>
<a href="#l23.294"></a><span id="l23.294" class="difflineminus">-  } else {</span>
<a href="#l23.295"></a><span id="l23.295" class="difflineminus">-    HICON hIcon = LoadIcon(hInst, MAKEINTRESOURCE(uIconResourceId));</span>
<a href="#l23.296"></a><span id="l23.296" class="difflineminus">-    assert(hIcon != 0);</span>
<a href="#l23.297"></a><span id="l23.297" class="difflineminus">-    SendMessage(hWnd, WM_SETICON, FALSE, (LPARAM)hIcon);</span>
<a href="#l23.298"></a><span id="l23.298" class="difflineminus">-  }</span>
<a href="#l23.299"></a><span id="l23.299" class="difflineminus">-#endif // WIN32</span>
<a href="#l23.300"></a><span id="l23.300" class="difflineminus">-}</span>
<a href="#l23.301"></a><span id="l23.301" class="difflineminus">-#endif // __cplusplus</span>
<a href="#l23.302"></a><span id="l23.302" class="difflineminus">-</span>
<a href="#l23.303"></a><span id="l23.303" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l23.304"></a><span id="l23.304" class="difflineminus">-}</span>
<a href="#l23.305"></a><span id="l23.305" class="difflineminus">-#endif /* __cplusplus */</span>
<a href="#l23.306"></a><span id="l23.306" class="difflineminus">-</span>
<a href="#l23.307"></a><span id="l23.307" class="difflineminus">-#endif /* PORT_H */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">deleted file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/resource.h</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ /dev/null</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -1,54 +0,0 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineminus">- *</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">- *</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">- * License.</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">- *</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineminus">- *</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineminus">- *</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">- *</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">- *</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">-//{{NO_DEPENDENCIES}}</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">-// Microsoft Developer Studio generated include file.</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-// Used by mapi32.rc</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineminus">-//</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineminus">-#define ID_DIALOG_QAHOOK                101</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineminus">-#define ID_DIALOG_MAPI                  101</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineminus">-#define ID_ICON_APP                     102</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineminus">-</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineminus">-// Next default values for new objects</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-// </span>
<a href="#l24.51"></a><span id="l24.51" class="difflineminus">-#ifdef APSTUDIO_INVOKED</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineminus">-#ifndef APSTUDIO_READONLY_SYMBOLS</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-#define _APS_NEXT_RESOURCE_VALUE        103</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineminus">-#define _APS_NEXT_COMMAND_VALUE         40001</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineminus">-#define _APS_NEXT_CONTROL_VALUE         1000</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineminus">-#define _APS_NEXT_SYMED_VALUE           101</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineminus">-#endif</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineminus">-#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1">deleted file mode 100644</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/smem.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineplus">+++ /dev/null</span>
<a href="#l25.4"></a><span id="l25.4" class="difflineat">@@ -1,172 +0,0 @@</span>
<a href="#l25.5"></a><span id="l25.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l25.6"></a><span id="l25.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l25.7"></a><span id="l25.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l25.8"></a><span id="l25.8" class="difflineminus">- *</span>
<a href="#l25.9"></a><span id="l25.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l25.10"></a><span id="l25.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l25.11"></a><span id="l25.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">- *</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineminus">- * License.</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineminus">- *</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineminus">- *</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineminus">- *</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineminus">- *</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineminus">- *</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineminus">-//</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineminus">-//  smem.cpp - This deals with all shared memory functions needed for </span>
<a href="#l25.43"></a><span id="l25.43" class="difflineminus">-//  the MAPI component of Communicator</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineminus">-//  November 1997</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineminus">-//</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineminus">-#include &lt;windowsx.h&gt;</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineminus">-</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineminus">-#include &quot;mapismem.h&quot;</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineminus">-</span>
<a href="#l25.52"></a><span id="l25.52" class="difflineminus">-#ifndef ZeroMemory</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineminus">-#include &lt;memory.h&gt;</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineminus">-#define ZeroMemory(PTR, SIZE) memset(PTR, 0, SIZE)</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineminus">-#endif // ZeroMemory</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineminus">-</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineminus">-// </span>
<a href="#l25.58"></a><span id="l25.58" class="difflineminus">-// *create new* shared memory chunk </span>
<a href="#l25.59"></a><span id="l25.59" class="difflineminus">-// once this is created, use the pointer</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineminus">-// to the segment to to store data </span>
<a href="#l25.61"></a><span id="l25.61" class="difflineminus">-// e.g.: </span>
<a href="#l25.62"></a><span id="l25.62" class="difflineminus">-//     lpString = &quot;string for communicator&quot;; </span>
<a href="#l25.63"></a><span id="l25.63" class="difflineminus">-//     lstrcpy((LPSTR)pData-&gt;m_buf[0], lpString); </span>
<a href="#l25.64"></a><span id="l25.64" class="difflineminus">-//  </span>
<a href="#l25.65"></a><span id="l25.65" class="difflineminus">-CSharedMem *</span>
<a href="#l25.66"></a><span id="l25.66" class="difflineminus">-NSCreateSharedMemory(DWORD memSize, LPCTSTR memName, HANDLE *hSharedMemory)</span>
<a href="#l25.67"></a><span id="l25.67" class="difflineminus">-{</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineminus">-#ifdef WIN32</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineminus">-</span>
<a href="#l25.70"></a><span id="l25.70" class="difflineminus">-  BOOL bExistedBefore;</span>
<a href="#l25.71"></a><span id="l25.71" class="difflineminus">-  CSharedMem *pData;</span>
<a href="#l25.72"></a><span id="l25.72" class="difflineminus">-</span>
<a href="#l25.73"></a><span id="l25.73" class="difflineminus">-  LPCTSTR szObjectName = memName; </span>
<a href="#l25.74"></a><span id="l25.74" class="difflineminus">-  DWORD dwSize = sizeof(CSharedMem) + memSize; </span>
<a href="#l25.75"></a><span id="l25.75" class="difflineminus">-  *hSharedMemory = CreateFileMapping( </span>
<a href="#l25.76"></a><span id="l25.76" class="difflineminus">-    (HANDLE)0xFFFFFFFF,0,PAGE_READWRITE,0,dwSize,szObjectName); </span>
<a href="#l25.77"></a><span id="l25.77" class="difflineminus">-  if(*hSharedMemory == 0) </span>
<a href="#l25.78"></a><span id="l25.78" class="difflineminus">-  { </span>
<a href="#l25.79"></a><span id="l25.79" class="difflineminus">-    return NULL; </span>
<a href="#l25.80"></a><span id="l25.80" class="difflineminus">-  } </span>
<a href="#l25.81"></a><span id="l25.81" class="difflineminus">-  bExistedBefore = (GetLastError() == ERROR_ALREADY_EXISTS); </span>
<a href="#l25.82"></a><span id="l25.82" class="difflineminus">-  if(bExistedBefore) </span>
<a href="#l25.83"></a><span id="l25.83" class="difflineminus">-  { </span>
<a href="#l25.84"></a><span id="l25.84" class="difflineminus">-  	return NULL;</span>
<a href="#l25.85"></a><span id="l25.85" class="difflineminus">-  } </span>
<a href="#l25.86"></a><span id="l25.86" class="difflineminus">-</span>
<a href="#l25.87"></a><span id="l25.87" class="difflineminus">-  pData = (CSharedMem *)MapViewOfFile( </span>
<a href="#l25.88"></a><span id="l25.88" class="difflineminus">-            *hSharedMemory, FILE_MAP_ALL_ACCESS, 0, 0, 0); </span>
<a href="#l25.89"></a><span id="l25.89" class="difflineminus">-  if(pData == NULL) </span>
<a href="#l25.90"></a><span id="l25.90" class="difflineminus">-  { </span>
<a href="#l25.91"></a><span id="l25.91" class="difflineminus">-    return NULL; </span>
<a href="#l25.92"></a><span id="l25.92" class="difflineminus">-  } </span>
<a href="#l25.93"></a><span id="l25.93" class="difflineminus">-</span>
<a href="#l25.94"></a><span id="l25.94" class="difflineminus">-  ZeroMemory(pData, dwSize); </span>
<a href="#l25.95"></a><span id="l25.95" class="difflineminus">-  pData-&gt;m_dwSize = memSize; </span>
<a href="#l25.96"></a><span id="l25.96" class="difflineminus">-</span>
<a href="#l25.97"></a><span id="l25.97" class="difflineminus">-  return pData;</span>
<a href="#l25.98"></a><span id="l25.98" class="difflineminus">-#else</span>
<a href="#l25.99"></a><span id="l25.99" class="difflineminus">-  CSharedMem 	*sMemChunk = NULL;</span>
<a href="#l25.100"></a><span id="l25.100" class="difflineminus">-  DWORD dwSize = memSize = (sizeof(CSharedMem) + memSize); </span>
<a href="#l25.101"></a><span id="l25.101" class="difflineminus">-</span>
<a href="#l25.102"></a><span id="l25.102" class="difflineminus">-  if (sMemChunk != NULL)</span>
<a href="#l25.103"></a><span id="l25.103" class="difflineminus">-	  return(sMemChunk);</span>
<a href="#l25.104"></a><span id="l25.104" class="difflineminus">-</span>
<a href="#l25.105"></a><span id="l25.105" class="difflineminus">-  sMemChunk = (CSharedMem *) GlobalAllocPtr(GMEM_MOVEABLE, dwSize);</span>
<a href="#l25.106"></a><span id="l25.106" class="difflineminus">-  ZeroMemory(sMemChunk, (size_t) dwSize);</span>
<a href="#l25.107"></a><span id="l25.107" class="difflineminus">-  sMemChunk-&gt;m_dwSize = dwSize;   // Missing in Communicator code!</span>
<a href="#l25.108"></a><span id="l25.108" class="difflineminus">-  return(sMemChunk);</span>
<a href="#l25.109"></a><span id="l25.109" class="difflineminus">-</span>
<a href="#l25.110"></a><span id="l25.110" class="difflineminus">-#endif // WIN32</span>
<a href="#l25.111"></a><span id="l25.111" class="difflineminus">-}</span>
<a href="#l25.112"></a><span id="l25.112" class="difflineminus">-</span>
<a href="#l25.113"></a><span id="l25.113" class="difflineminus">-// </span>
<a href="#l25.114"></a><span id="l25.114" class="difflineminus">-// *open existing* shared memory chunk </span>
<a href="#l25.115"></a><span id="l25.115" class="difflineminus">-// once you have the pointer to the new segment </span>
<a href="#l25.116"></a><span id="l25.116" class="difflineminus">-// use this pointer to access data, e.g.: </span>
<a href="#l25.117"></a><span id="l25.117" class="difflineminus">-// </span>
<a href="#l25.118"></a><span id="l25.118" class="difflineminus">-CSharedMem *</span>
<a href="#l25.119"></a><span id="l25.119" class="difflineminus">-NSOpenExistingSharedMemory(LPCTSTR memName, HANDLE *hSharedMemory)</span>
<a href="#l25.120"></a><span id="l25.120" class="difflineminus">-{</span>
<a href="#l25.121"></a><span id="l25.121" class="difflineminus">-#ifdef WIN32</span>
<a href="#l25.122"></a><span id="l25.122" class="difflineminus">-  CSharedMem *pData;</span>
<a href="#l25.123"></a><span id="l25.123" class="difflineminus">-  DWORD dwSize;</span>
<a href="#l25.124"></a><span id="l25.124" class="difflineminus">-</span>
<a href="#l25.125"></a><span id="l25.125" class="difflineminus">-  LPCTSTR szObjectName = memName; </span>
<a href="#l25.126"></a><span id="l25.126" class="difflineminus">-  *hSharedMemory = OpenFileMapping( </span>
<a href="#l25.127"></a><span id="l25.127" class="difflineminus">-    PAGE_READWRITE,FALSE,szObjectName); </span>
<a href="#l25.128"></a><span id="l25.128" class="difflineminus">-  if(*hSharedMemory == 0) </span>
<a href="#l25.129"></a><span id="l25.129" class="difflineminus">-  { </span>
<a href="#l25.130"></a><span id="l25.130" class="difflineminus">-    return NULL; </span>
<a href="#l25.131"></a><span id="l25.131" class="difflineminus">-  } </span>
<a href="#l25.132"></a><span id="l25.132" class="difflineminus">-</span>
<a href="#l25.133"></a><span id="l25.133" class="difflineminus">-  pData = (CSharedMem *)MapViewOfFile( </span>
<a href="#l25.134"></a><span id="l25.134" class="difflineminus">-              *hSharedMemory,FILE_MAP_ALL_ACCESS,0,0,0); </span>
<a href="#l25.135"></a><span id="l25.135" class="difflineminus">-  if(pData == NULL) </span>
<a href="#l25.136"></a><span id="l25.136" class="difflineminus">-  { </span>
<a href="#l25.137"></a><span id="l25.137" class="difflineminus">-    return NULL; </span>
<a href="#l25.138"></a><span id="l25.138" class="difflineminus">-  } </span>
<a href="#l25.139"></a><span id="l25.139" class="difflineminus">-  </span>
<a href="#l25.140"></a><span id="l25.140" class="difflineminus">-  dwSize = pData-&gt;m_dwSize; </span>
<a href="#l25.141"></a><span id="l25.141" class="difflineminus">-  return pData;</span>
<a href="#l25.142"></a><span id="l25.142" class="difflineminus">-#else</span>
<a href="#l25.143"></a><span id="l25.143" class="difflineminus">-</span>
<a href="#l25.144"></a><span id="l25.144" class="difflineminus">-  return(NULL);   // In Win16, this is really meaningless...</span>
<a href="#l25.145"></a><span id="l25.145" class="difflineminus">-</span>
<a href="#l25.146"></a><span id="l25.146" class="difflineminus">-#endif</span>
<a href="#l25.147"></a><span id="l25.147" class="difflineminus">-}  </span>
<a href="#l25.148"></a><span id="l25.148" class="difflineminus">-</span>
<a href="#l25.149"></a><span id="l25.149" class="difflineminus">-// </span>
<a href="#l25.150"></a><span id="l25.150" class="difflineminus">-// to close shared memory segment</span>
<a href="#l25.151"></a><span id="l25.151" class="difflineminus">-// </span>
<a href="#l25.152"></a><span id="l25.152" class="difflineminus">-void</span>
<a href="#l25.153"></a><span id="l25.153" class="difflineminus">-NSCloseSharedMemory(CSharedMem *pData, HANDLE hSharedMemory)</span>
<a href="#l25.154"></a><span id="l25.154" class="difflineminus">-{</span>
<a href="#l25.155"></a><span id="l25.155" class="difflineminus">-#ifdef WIN32</span>
<a href="#l25.156"></a><span id="l25.156" class="difflineminus">-  if(pData != 0) </span>
<a href="#l25.157"></a><span id="l25.157" class="difflineminus">-  { </span>
<a href="#l25.158"></a><span id="l25.158" class="difflineminus">-    UnmapViewOfFile(pData); </span>
<a href="#l25.159"></a><span id="l25.159" class="difflineminus">-    pData = 0; </span>
<a href="#l25.160"></a><span id="l25.160" class="difflineminus">-  } </span>
<a href="#l25.161"></a><span id="l25.161" class="difflineminus">-</span>
<a href="#l25.162"></a><span id="l25.162" class="difflineminus">-  if(hSharedMemory != 0) </span>
<a href="#l25.163"></a><span id="l25.163" class="difflineminus">-  { </span>
<a href="#l25.164"></a><span id="l25.164" class="difflineminus">-    CloseHandle(hSharedMemory); </span>
<a href="#l25.165"></a><span id="l25.165" class="difflineminus">-    hSharedMemory = 0; </span>
<a href="#l25.166"></a><span id="l25.166" class="difflineminus">-  } </span>
<a href="#l25.167"></a><span id="l25.167" class="difflineminus">-#else</span>
<a href="#l25.168"></a><span id="l25.168" class="difflineminus">-</span>
<a href="#l25.169"></a><span id="l25.169" class="difflineminus">-	if (pData != NULL)</span>
<a href="#l25.170"></a><span id="l25.170" class="difflineminus">-	{</span>
<a href="#l25.171"></a><span id="l25.171" class="difflineminus">-		GlobalFreePtr(pData);</span>
<a href="#l25.172"></a><span id="l25.172" class="difflineminus">-		pData = NULL;</span>
<a href="#l25.173"></a><span id="l25.173" class="difflineminus">-	}</span>
<a href="#l25.174"></a><span id="l25.174" class="difflineminus">-</span>
<a href="#l25.175"></a><span id="l25.175" class="difflineminus">-#endif // WIN32</span>
<a href="#l25.176"></a><span id="l25.176" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1">deleted file mode 100644</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/trace.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineplus">+++ /dev/null</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineat">@@ -1,68 +0,0 @@</span>
<a href="#l26.5"></a><span id="l26.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l26.6"></a><span id="l26.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l26.7"></a><span id="l26.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l26.8"></a><span id="l26.8" class="difflineminus">- *</span>
<a href="#l26.9"></a><span id="l26.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l26.10"></a><span id="l26.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">- *</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineminus">- * License.</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineminus">- *</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineminus">- *</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineminus">- *</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineminus">- *</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineminus">- *</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-#include &lt;stdio.h&gt;</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineminus">-#include &lt;stdarg.h&gt;</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineminus">-#include &lt;tchar.h&gt;</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineminus">-#include &quot;trace.h&quot;</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineminus">-</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineminus">-#ifdef _DEBUG </span>
<a href="#l26.48"></a><span id="l26.48" class="difflineminus">-</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineminus">-#ifndef WIN16</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineminus">-void CDECL AfxTrace(LPCTSTR lpszFormat, ...)</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineminus">-#else                                       </span>
<a href="#l26.52"></a><span id="l26.52" class="difflineminus">-void CDECL AfxTrace(LPCSTR lpszFormat, ...)</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineminus">-#endif</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineminus">-{</span>
<a href="#l26.55"></a><span id="l26.55" class="difflineminus">-  va_list args;</span>
<a href="#l26.56"></a><span id="l26.56" class="difflineminus">-	va_start(args, lpszFormat);</span>
<a href="#l26.57"></a><span id="l26.57" class="difflineminus">-</span>
<a href="#l26.58"></a><span id="l26.58" class="difflineminus">-	int nBuf;</span>
<a href="#l26.59"></a><span id="l26.59" class="difflineminus">-	TCHAR szBuffer[512];</span>
<a href="#l26.60"></a><span id="l26.60" class="difflineminus">-</span>
<a href="#l26.61"></a><span id="l26.61" class="difflineminus">-	nBuf = _vstprintf(szBuffer, lpszFormat, args);</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineminus">-	va_end(args);</span>
<a href="#l26.63"></a><span id="l26.63" class="difflineminus">-  OutputDebugString(szBuffer); </span>
<a href="#l26.64"></a><span id="l26.64" class="difflineminus">-  return;</span>
<a href="#l26.65"></a><span id="l26.65" class="difflineminus">-}</span>
<a href="#l26.66"></a><span id="l26.66" class="difflineminus">-</span>
<a href="#l26.67"></a><span id="l26.67" class="difflineminus">-BOOL AfxAssertFailedLine(LPCSTR lpszFileName, int nLine)</span>
<a href="#l26.68"></a><span id="l26.68" class="difflineminus">-{    </span>
<a href="#l26.69"></a><span id="l26.69" class="difflineminus">-	return TRUE;</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineminus">-}</span>
<a href="#l26.71"></a><span id="l26.71" class="difflineminus">-</span>
<a href="#l26.72"></a><span id="l26.72" class="difflineminus">-#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1">deleted file mode 100644</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/trace.h</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineplus">+++ /dev/null</span>
<a href="#l27.4"></a><span id="l27.4" class="difflineat">@@ -1,81 +0,0 @@</span>
<a href="#l27.5"></a><span id="l27.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l27.6"></a><span id="l27.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l27.7"></a><span id="l27.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l27.8"></a><span id="l27.8" class="difflineminus">- *</span>
<a href="#l27.9"></a><span id="l27.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l27.10"></a><span id="l27.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l27.11"></a><span id="l27.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">- *</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineminus">- * License.</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineminus">- *</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineminus">- *</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineminus">- *</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineminus">- *</span>
<a href="#l27.28"></a><span id="l27.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineminus">- *</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l27.42"></a><span id="l27.42" class="difflineminus">-</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineminus">-#ifdef _DEBUG</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineminus">-BOOL AfxAssertFailedLine(LPCSTR lpszFileName, int nLine);</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineminus">-</span>
<a href="#l27.46"></a><span id="l27.46" class="difflineminus">-#ifndef WIN16</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineminus">-void CDECL AfxTrace(LPCTSTR lpszFormat, ...);</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineminus">-#else</span>
<a href="#l27.49"></a><span id="l27.49" class="difflineminus">-void CDECL AfxTrace(LPCSTR lpszFormat, ...);</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineminus">-#endif</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineminus">-</span>
<a href="#l27.52"></a><span id="l27.52" class="difflineminus">-#define TRACE              ::AfxTrace</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineminus">-#define THIS_FILE          __FILE__</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineminus">-#define ASSERT(f) \</span>
<a href="#l27.55"></a><span id="l27.55" class="difflineminus">-	do \</span>
<a href="#l27.56"></a><span id="l27.56" class="difflineminus">-	{ \</span>
<a href="#l27.57"></a><span id="l27.57" class="difflineminus">-	if (!(f) &amp;&amp; AfxAssertFailedLine(THIS_FILE, __LINE__)) \</span>
<a href="#l27.58"></a><span id="l27.58" class="difflineminus">-		AfxDebugBreak(); \</span>
<a href="#l27.59"></a><span id="l27.59" class="difflineminus">-	} while (0) \</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineminus">-</span>
<a href="#l27.61"></a><span id="l27.61" class="difflineminus">-#define VERIFY(f)          ASSERT(f)</span>
<a href="#l27.62"></a><span id="l27.62" class="difflineminus">-#define TRACE_FN(name) LogFn __logFn(name)</span>
<a href="#l27.63"></a><span id="l27.63" class="difflineminus">-class LogFn</span>
<a href="#l27.64"></a><span id="l27.64" class="difflineminus">-{</span>
<a href="#l27.65"></a><span id="l27.65" class="difflineminus">-public:</span>
<a href="#l27.66"></a><span id="l27.66" class="difflineminus">-	LogFn(LPCSTR pFnName) {m_pFnName = pFnName; TRACE(&quot;--%s: In--\n&quot;, pFnName);}</span>
<a href="#l27.67"></a><span id="l27.67" class="difflineminus">-	~LogFn() {TRACE(&quot;--%s: Out--\n&quot;, m_pFnName);}</span>
<a href="#l27.68"></a><span id="l27.68" class="difflineminus">-private:</span>
<a href="#l27.69"></a><span id="l27.69" class="difflineminus">-	LPCSTR m_pFnName;</span>
<a href="#l27.70"></a><span id="l27.70" class="difflineminus">-};</span>
<a href="#l27.71"></a><span id="l27.71" class="difflineminus">-#else</span>
<a href="#l27.72"></a><span id="l27.72" class="difflineminus">-// NDEBUG</span>
<a href="#l27.73"></a><span id="l27.73" class="difflineminus">-#define ASSERT(f)          ((void)0)</span>
<a href="#l27.74"></a><span id="l27.74" class="difflineminus">-#define VERIFY(f)          ((void)(f))</span>
<a href="#l27.75"></a><span id="l27.75" class="difflineminus">-#define ASSERT_VALID(pOb)  ((void)0)</span>
<a href="#l27.76"></a><span id="l27.76" class="difflineminus">-#define DEBUG_ONLY(f)      ((void)0)   </span>
<a href="#l27.77"></a><span id="l27.77" class="difflineminus">-#ifdef WIN32</span>
<a href="#l27.78"></a><span id="l27.78" class="difflineminus">-inline void CDECL AfxTrace(LPCTSTR, ...) { }</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineminus">-#else</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineminus">-inline void CDECL AfxTrace(LPCSTR, ...) { }</span>
<a href="#l27.81"></a><span id="l27.81" class="difflineminus">-#endif</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineminus">-#define TRACE              1 ? (void)0 : ::AfxTrace</span>
<a href="#l27.83"></a><span id="l27.83" class="difflineminus">-#define TRACE_FN(name)</span>
<a href="#l27.84"></a><span id="l27.84" class="difflineminus">-#endif // _DEBUG</span>
<a href="#l27.85"></a><span id="l27.85" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1">deleted file mode 100644</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/xpapi.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineplus">+++ /dev/null</span>
<a href="#l28.4"></a><span id="l28.4" class="difflineat">@@ -1,347 +0,0 @@</span>
<a href="#l28.5"></a><span id="l28.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l28.6"></a><span id="l28.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l28.7"></a><span id="l28.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l28.8"></a><span id="l28.8" class="difflineminus">- *</span>
<a href="#l28.9"></a><span id="l28.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l28.10"></a><span id="l28.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l28.11"></a><span id="l28.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">- *</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">- * License.</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineminus">- *</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineminus">- *</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineminus">- *</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineminus">- *</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineminus">- *</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineminus">-//</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineminus">-//  XPAPI.CPP</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineminus">-//  API implementation file for mapi16.dll and mapi32.dll</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineminus">-//  November 1997</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineminus">-//</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineminus">-#include &lt;stdio.h&gt;</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineminus">-#include &lt;stdarg.h&gt;</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineminus">-#include &quot;xpapi.h&quot;</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineminus">-#include &quot;mapiutl.h&quot;</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineminus">-</span>
<a href="#l28.53"></a><span id="l28.53" class="difflineminus">-WORD LOAD_DS XP_CallProcess(LPCSTR pPath, LPCSTR pCmdLine)</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineminus">-{            </span>
<a href="#l28.55"></a><span id="l28.55" class="difflineminus">-	WORD wReturn = 0;</span>
<a href="#l28.56"></a><span id="l28.56" class="difflineminus">-#ifndef WIN16</span>
<a href="#l28.57"></a><span id="l28.57" class="difflineminus">-	STARTUPINFO startupInfo;</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">-	PROCESS_INFORMATION processInfo;</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineminus">-</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineminus">-	memset(&amp;startupInfo, 0, sizeof(startupInfo));</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineminus">-	startupInfo.cb = sizeof(startupInfo);</span>
<a href="#l28.62"></a><span id="l28.62" class="difflineminus">-	if (wReturn = CreateProcess(pPath, (LPTSTR)pCmdLine, NULL, NULL, FALSE, CREATE_DEFAULT_ERROR_MODE | CREATE_NEW_PROCESS_GROUP, NULL, NULL, &amp;startupInfo, &amp;processInfo))</span>
<a href="#l28.63"></a><span id="l28.63" class="difflineminus">-	{</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineminus">-		WaitForInputIdle(processInfo.hProcess, 120000);</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineminus">-	}</span>
<a href="#l28.66"></a><span id="l28.66" class="difflineminus">-#else       </span>
<a href="#l28.67"></a><span id="l28.67" class="difflineminus">-	// char szMsg[80];	</span>
<a href="#l28.68"></a><span id="l28.68" class="difflineminus">-	char szExecute[512];</span>
<a href="#l28.69"></a><span id="l28.69" class="difflineminus">-	lstrcpy(szExecute, pPath);</span>
<a href="#l28.70"></a><span id="l28.70" class="difflineminus">-	lstrcat(szExecute, &quot; &quot;);</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineminus">-	lstrcat(szExecute, pCmdLine);</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineminus">-	wReturn = WinExec(szExecute,SW_SHOW);</span>
<a href="#l28.73"></a><span id="l28.73" class="difflineminus">-	</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineminus">-	if (wReturn &lt; 32) </span>
<a href="#l28.75"></a><span id="l28.75" class="difflineminus">-	{</span>
<a href="#l28.76"></a><span id="l28.76" class="difflineminus">-	    wReturn = 0;</span>
<a href="#l28.77"></a><span id="l28.77" class="difflineminus">-	}</span>
<a href="#l28.78"></a><span id="l28.78" class="difflineminus">-#endif</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineminus">-	return wReturn;</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineminus">-}</span>
<a href="#l28.81"></a><span id="l28.81" class="difflineminus">-</span>
<a href="#l28.82"></a><span id="l28.82" class="difflineminus">-HKEY LOAD_DS RegOpenParent(LPCSTR pSection, HKEY hRootKey, REGSAM access)</span>
<a href="#l28.83"></a><span id="l28.83" class="difflineminus">-{</span>
<a href="#l28.84"></a><span id="l28.84" class="difflineminus">-	HKEY hKey;</span>
<a href="#l28.85"></a><span id="l28.85" class="difflineminus">-#ifndef WIN16</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineminus">-	if (RegOpenKeyEx(hRootKey, pSection, 0, access, &amp;hKey) != ERROR_SUCCESS)</span>
<a href="#l28.87"></a><span id="l28.87" class="difflineminus">-	{</span>
<a href="#l28.88"></a><span id="l28.88" class="difflineminus">-		return(NULL);</span>
<a href="#l28.89"></a><span id="l28.89" class="difflineminus">-	}        </span>
<a href="#l28.90"></a><span id="l28.90" class="difflineminus">-#else</span>
<a href="#l28.91"></a><span id="l28.91" class="difflineminus">-    if (RegOpenKey(hRootKey, pSection, &amp;hKey) != ERROR_SUCCESS)</span>
<a href="#l28.92"></a><span id="l28.92" class="difflineminus">-    {</span>
<a href="#l28.93"></a><span id="l28.93" class="difflineminus">-    	return(NULL);</span>
<a href="#l28.94"></a><span id="l28.94" class="difflineminus">-    }</span>
<a href="#l28.95"></a><span id="l28.95" class="difflineminus">-#endif</span>
<a href="#l28.96"></a><span id="l28.96" class="difflineminus">-	return(hKey);</span>
<a href="#l28.97"></a><span id="l28.97" class="difflineminus">-}</span>
<a href="#l28.98"></a><span id="l28.98" class="difflineminus">-</span>
<a href="#l28.99"></a><span id="l28.99" class="difflineminus">-HKEY LOAD_DS RegCreateParent(LPCSTR pSection, HKEY hMasterKey)</span>
<a href="#l28.100"></a><span id="l28.100" class="difflineminus">-{</span>
<a href="#l28.101"></a><span id="l28.101" class="difflineminus">-	HKEY hKey;</span>
<a href="#l28.102"></a><span id="l28.102" class="difflineminus">-	if (RegCreateKey(hMasterKey, pSection, &amp;hKey) != ERROR_SUCCESS)</span>
<a href="#l28.103"></a><span id="l28.103" class="difflineminus">-	{</span>
<a href="#l28.104"></a><span id="l28.104" class="difflineminus">-		return(NULL);</span>
<a href="#l28.105"></a><span id="l28.105" class="difflineminus">-	}        </span>
<a href="#l28.106"></a><span id="l28.106" class="difflineminus">-	return(hKey);</span>
<a href="#l28.107"></a><span id="l28.107" class="difflineminus">-}</span>
<a href="#l28.108"></a><span id="l28.108" class="difflineminus">-</span>
<a href="#l28.109"></a><span id="l28.109" class="difflineminus">-BOOL LOAD_DS GetConfigInfoStr(LPCSTR pSection, LPCSTR pKey, LPSTR pBuf, int lenBuf, HKEY hMasterKey)</span>
<a href="#l28.110"></a><span id="l28.110" class="difflineminus">-{</span>
<a href="#l28.111"></a><span id="l28.111" class="difflineminus">-	HKEY hKey;</span>
<a href="#l28.112"></a><span id="l28.112" class="difflineminus">-	hKey = RegOpenParent(pSection, hMasterKey, KEY_QUERY_VALUE);</span>
<a href="#l28.113"></a><span id="l28.113" class="difflineminus">-	if (!hKey)</span>
<a href="#l28.114"></a><span id="l28.114" class="difflineminus">-	{</span>
<a href="#l28.115"></a><span id="l28.115" class="difflineminus">-		return(FALSE);</span>
<a href="#l28.116"></a><span id="l28.116" class="difflineminus">-	}</span>
<a href="#l28.117"></a><span id="l28.117" class="difflineminus">-</span>
<a href="#l28.118"></a><span id="l28.118" class="difflineminus">-	DWORD len = (DWORD)lenBuf;</span>
<a href="#l28.119"></a><span id="l28.119" class="difflineminus">-#ifndef WIN16</span>
<a href="#l28.120"></a><span id="l28.120" class="difflineminus">-	BOOL retVal = (RegQueryValueEx(hKey, pKey, NULL, NULL, (LPBYTE)pBuf, &amp;len) == ERROR_SUCCESS);</span>
<a href="#l28.121"></a><span id="l28.121" class="difflineminus">-#else</span>
<a href="#l28.122"></a><span id="l28.122" class="difflineminus">-	BOOL retVal = (RegQueryValue(hKey, pKey, pBuf, (long far*)&amp;len) == ERROR_SUCCESS);</span>
<a href="#l28.123"></a><span id="l28.123" class="difflineminus">-#endif</span>
<a href="#l28.124"></a><span id="l28.124" class="difflineminus">-	RegCloseKey(hKey);</span>
<a href="#l28.125"></a><span id="l28.125" class="difflineminus">-	return(retVal);</span>
<a href="#l28.126"></a><span id="l28.126" class="difflineminus">-}</span>
<a href="#l28.127"></a><span id="l28.127" class="difflineminus">-</span>
<a href="#l28.128"></a><span id="l28.128" class="difflineminus">-BOOL LOAD_DS GetConfigInfoNum(LPCSTR pSection, LPCSTR pKey, DWORD* pVal, HKEY hMasterKey)</span>
<a href="#l28.129"></a><span id="l28.129" class="difflineminus">-{</span>
<a href="#l28.130"></a><span id="l28.130" class="difflineminus">-	HKEY hKey;</span>
<a href="#l28.131"></a><span id="l28.131" class="difflineminus">-	hKey = RegOpenParent(pSection, hMasterKey, KEY_QUERY_VALUE);</span>
<a href="#l28.132"></a><span id="l28.132" class="difflineminus">-	if (!hKey)</span>
<a href="#l28.133"></a><span id="l28.133" class="difflineminus">-	{</span>
<a href="#l28.134"></a><span id="l28.134" class="difflineminus">-		return(FALSE);</span>
<a href="#l28.135"></a><span id="l28.135" class="difflineminus">-	}</span>
<a href="#l28.136"></a><span id="l28.136" class="difflineminus">-</span>
<a href="#l28.137"></a><span id="l28.137" class="difflineminus">-	DWORD len = sizeof(DWORD);</span>
<a href="#l28.138"></a><span id="l28.138" class="difflineminus">-#ifndef WIN16</span>
<a href="#l28.139"></a><span id="l28.139" class="difflineminus">-	BOOL retVal = (RegQueryValueEx(hKey, pKey, NULL, NULL, (LPBYTE)pVal, &amp;len) == ERROR_SUCCESS);</span>
<a href="#l28.140"></a><span id="l28.140" class="difflineminus">-#else</span>
<a href="#l28.141"></a><span id="l28.141" class="difflineminus">-	BOOL retVal = (RegQueryValue(hKey, pKey, (char far*)pVal, (long far*)&amp;len) == ERROR_SUCCESS);</span>
<a href="#l28.142"></a><span id="l28.142" class="difflineminus">-#endif</span>
<a href="#l28.143"></a><span id="l28.143" class="difflineminus">-	RegCloseKey(hKey);</span>
<a href="#l28.144"></a><span id="l28.144" class="difflineminus">-	return(retVal);</span>
<a href="#l28.145"></a><span id="l28.145" class="difflineminus">-}</span>
<a href="#l28.146"></a><span id="l28.146" class="difflineminus">-</span>
<a href="#l28.147"></a><span id="l28.147" class="difflineminus">-BOOL LOAD_DS SetConfigInfoStr(LPCSTR pSection, LPCSTR pKey, LPSTR pStr, HKEY hMasterKey)</span>
<a href="#l28.148"></a><span id="l28.148" class="difflineminus">-{</span>
<a href="#l28.149"></a><span id="l28.149" class="difflineminus">-	HKEY hKey;</span>
<a href="#l28.150"></a><span id="l28.150" class="difflineminus">-	hKey = RegCreateParent(pSection, hMasterKey);</span>
<a href="#l28.151"></a><span id="l28.151" class="difflineminus">-	if (!hKey)</span>
<a href="#l28.152"></a><span id="l28.152" class="difflineminus">-	{</span>
<a href="#l28.153"></a><span id="l28.153" class="difflineminus">-		return(FALSE);</span>
<a href="#l28.154"></a><span id="l28.154" class="difflineminus">-	}</span>
<a href="#l28.155"></a><span id="l28.155" class="difflineminus">-#ifndef WIN16</span>
<a href="#l28.156"></a><span id="l28.156" class="difflineminus">-	BOOL retVal = (RegSetValueEx(hKey, pKey, 0, REG_SZ, (LPBYTE)pStr, lstrlen(pStr) + 1) == ERROR_SUCCESS);</span>
<a href="#l28.157"></a><span id="l28.157" class="difflineminus">-#else</span>
<a href="#l28.158"></a><span id="l28.158" class="difflineminus">-	BOOL retVal = (RegSetValue(hKey, pKey, REG_SZ, pStr, lstrlen(pStr) + 1) == ERROR_SUCCESS);</span>
<a href="#l28.159"></a><span id="l28.159" class="difflineminus">-#endif</span>
<a href="#l28.160"></a><span id="l28.160" class="difflineminus">-	RegCloseKey(hKey);</span>
<a href="#l28.161"></a><span id="l28.161" class="difflineminus">-	return(retVal);</span>
<a href="#l28.162"></a><span id="l28.162" class="difflineminus">-}</span>
<a href="#l28.163"></a><span id="l28.163" class="difflineminus">-</span>
<a href="#l28.164"></a><span id="l28.164" class="difflineminus">-</span>
<a href="#l28.165"></a><span id="l28.165" class="difflineminus">-BOOL LOAD_DS XP_GetInstallDirectory(LPCSTR pcurVersionSection, LPCSTR pInstallDirKey, LPSTR path, UINT nSize, HKEY hKey)</span>
<a href="#l28.166"></a><span id="l28.166" class="difflineminus">-{   </span>
<a href="#l28.167"></a><span id="l28.167" class="difflineminus">-#ifdef WIN32   </span>
<a href="#l28.168"></a><span id="l28.168" class="difflineminus">-	if (!GetConfigInfoStr(pcurVersionSection, pInstallDirKey, path, nSize, hKey))</span>
<a href="#l28.169"></a><span id="l28.169" class="difflineminus">-	{  </span>
<a href="#l28.170"></a><span id="l28.170" class="difflineminus">-		return FALSE;</span>
<a href="#l28.171"></a><span id="l28.171" class="difflineminus">-	}</span>
<a href="#l28.172"></a><span id="l28.172" class="difflineminus">-	else</span>
<a href="#l28.173"></a><span id="l28.173" class="difflineminus">-	{</span>
<a href="#l28.174"></a><span id="l28.174" class="difflineminus">-		return TRUE;</span>
<a href="#l28.175"></a><span id="l28.175" class="difflineminus">-	}       </span>
<a href="#l28.176"></a><span id="l28.176" class="difflineminus">-#else</span>
<a href="#l28.177"></a><span id="l28.177" class="difflineminus">-	if ( 0 &lt; GetPrivateProfileString(pcurVersionSection, pInstallDirKey,&quot;ERROR&quot;, path, nSize, szNetscapeINI))</span>
<a href="#l28.178"></a><span id="l28.178" class="difflineminus">-	{</span>
<a href="#l28.179"></a><span id="l28.179" class="difflineminus">-		return TRUE;</span>
<a href="#l28.180"></a><span id="l28.180" class="difflineminus">-	}</span>
<a href="#l28.181"></a><span id="l28.181" class="difflineminus">-	else</span>
<a href="#l28.182"></a><span id="l28.182" class="difflineminus">-	{</span>
<a href="#l28.183"></a><span id="l28.183" class="difflineminus">-		return FALSE;</span>
<a href="#l28.184"></a><span id="l28.184" class="difflineminus">-	}</span>
<a href="#l28.185"></a><span id="l28.185" class="difflineminus">-#endif</span>
<a href="#l28.186"></a><span id="l28.186" class="difflineminus">-}</span>
<a href="#l28.187"></a><span id="l28.187" class="difflineminus">-</span>
<a href="#l28.188"></a><span id="l28.188" class="difflineminus">-</span>
<a href="#l28.189"></a><span id="l28.189" class="difflineminus">-BOOL LOAD_DS XP_GetVersionInfoString(LPCSTR pNavigatorSection, LPCSTR pCurrentVersionKey, LPSTR pcurVersionStr, UINT nSize, HKEY hKey)</span>
<a href="#l28.190"></a><span id="l28.190" class="difflineminus">-{ </span>
<a href="#l28.191"></a><span id="l28.191" class="difflineminus">-#ifdef WIN32</span>
<a href="#l28.192"></a><span id="l28.192" class="difflineminus">-	if (!GetConfigInfoStr(pNavigatorSection, pCurrentVersionKey, pcurVersionStr, nSize, HKEY_LOCAL_MACHINE))</span>
<a href="#l28.193"></a><span id="l28.193" class="difflineminus">-	{</span>
<a href="#l28.194"></a><span id="l28.194" class="difflineminus">-		return FALSE;</span>
<a href="#l28.195"></a><span id="l28.195" class="difflineminus">-	}               </span>
<a href="#l28.196"></a><span id="l28.196" class="difflineminus">-	else</span>
<a href="#l28.197"></a><span id="l28.197" class="difflineminus">-	{</span>
<a href="#l28.198"></a><span id="l28.198" class="difflineminus">-		return TRUE;</span>
<a href="#l28.199"></a><span id="l28.199" class="difflineminus">-	}</span>
<a href="#l28.200"></a><span id="l28.200" class="difflineminus">-#else </span>
<a href="#l28.201"></a><span id="l28.201" class="difflineminus">-	if ( 0 &lt; GetPrivateProfileString(pNavigatorSection, pCurrentVersionKey,&quot;ERROR&quot;, pcurVersionStr, nSize, szNetscapeINI))</span>
<a href="#l28.202"></a><span id="l28.202" class="difflineminus">-	{</span>
<a href="#l28.203"></a><span id="l28.203" class="difflineminus">-		return TRUE;</span>
<a href="#l28.204"></a><span id="l28.204" class="difflineminus">-	}</span>
<a href="#l28.205"></a><span id="l28.205" class="difflineminus">-	else</span>
<a href="#l28.206"></a><span id="l28.206" class="difflineminus">-	{</span>
<a href="#l28.207"></a><span id="l28.207" class="difflineminus">-		return FALSE;</span>
<a href="#l28.208"></a><span id="l28.208" class="difflineminus">-	}</span>
<a href="#l28.209"></a><span id="l28.209" class="difflineminus">-#endif</span>
<a href="#l28.210"></a><span id="l28.210" class="difflineminus">-</span>
<a href="#l28.211"></a><span id="l28.211" class="difflineminus">-}   </span>
<a href="#l28.212"></a><span id="l28.212" class="difflineminus">-</span>
<a href="#l28.213"></a><span id="l28.213" class="difflineminus">-DWORD LOAD_DS XP_GetInstallLocation(LPSTR pPath, UINT nSize)</span>
<a href="#l28.214"></a><span id="l28.214" class="difflineminus">-{           </span>
<a href="#l28.215"></a><span id="l28.215" class="difflineminus">-char curVersionStr[256]; </span>
<a href="#l28.216"></a><span id="l28.216" class="difflineminus">-char curVersionSection[256];</span>
<a href="#l28.217"></a><span id="l28.217" class="difflineminus">-</span>
<a href="#l28.218"></a><span id="l28.218" class="difflineminus">-  if (!pPath) </span>
<a href="#l28.219"></a><span id="l28.219" class="difflineminus">-    return  MAPI_E_LOGON_FAILURE;</span>
<a href="#l28.220"></a><span id="l28.220" class="difflineminus">-  </span>
<a href="#l28.221"></a><span id="l28.221" class="difflineminus">-#ifdef WIN32</span>
<a href="#l28.222"></a><span id="l28.222" class="difflineminus">-  if (!XP_GetVersionInfoString(szNavigatorSection, szCurrentVersionKey, curVersionStr, </span>
<a href="#l28.223"></a><span id="l28.223" class="difflineminus">-    sizeof(curVersionStr), HKEY_LOCAL_MACHINE))</span>
<a href="#l28.224"></a><span id="l28.224" class="difflineminus">-  {</span>
<a href="#l28.225"></a><span id="l28.225" class="difflineminus">-    return (MAPI_E_LOGON_FAILURE);</span>
<a href="#l28.226"></a><span id="l28.226" class="difflineminus">-  }</span>
<a href="#l28.227"></a><span id="l28.227" class="difflineminus">-  </span>
<a href="#l28.228"></a><span id="l28.228" class="difflineminus">-  wsprintf(curVersionSection, szNavigatorCurVersionSection, curVersionStr);</span>
<a href="#l28.229"></a><span id="l28.229" class="difflineminus">-		</span>
<a href="#l28.230"></a><span id="l28.230" class="difflineminus">-  if (!XP_GetInstallDirectory(curVersionSection, szInstallDirKey, pPath, </span>
<a href="#l28.231"></a><span id="l28.231" class="difflineminus">-    nSize, HKEY_LOCAL_MACHINE))</span>
<a href="#l28.232"></a><span id="l28.232" class="difflineminus">-  {</span>
<a href="#l28.233"></a><span id="l28.233" class="difflineminus">-    return (MAPI_E_ACCESS_DENIED);</span>
<a href="#l28.234"></a><span id="l28.234" class="difflineminus">-    </span>
<a href="#l28.235"></a><span id="l28.235" class="difflineminus">-  }</span>
<a href="#l28.236"></a><span id="l28.236" class="difflineminus">-  </span>
<a href="#l28.237"></a><span id="l28.237" class="difflineminus">-  lstrcat(pPath, &quot;\\&quot;);</span>
<a href="#l28.238"></a><span id="l28.238" class="difflineminus">-  lstrcat(pPath, &quot;Program\\netscape.exe&quot;);</span>
<a href="#l28.239"></a><span id="l28.239" class="difflineminus">-  </span>
<a href="#l28.240"></a><span id="l28.240" class="difflineminus">-  return SUCCESS_SUCCESS;</span>
<a href="#l28.241"></a><span id="l28.241" class="difflineminus">-#else</span>
<a href="#l28.242"></a><span id="l28.242" class="difflineminus">-  if (32 == Is_16_OR_32_BIT_CommunitorRunning())</span>
<a href="#l28.243"></a><span id="l28.243" class="difflineminus">-  {   </span>
<a href="#l28.244"></a><span id="l28.244" class="difflineminus">-    if (!GetConfigInfoStr(&quot;snews\\shell\\open&quot;, &quot;command&quot;, curVersionStr, sizeof(curVersionStr), HKEY_CLASSES_ROOT))</span>
<a href="#l28.245"></a><span id="l28.245" class="difflineminus">-    {</span>
<a href="#l28.246"></a><span id="l28.246" class="difflineminus">-      return (MAPI_E_ACCESS_DENIED);</span>
<a href="#l28.247"></a><span id="l28.247" class="difflineminus">-    }</span>
<a href="#l28.248"></a><span id="l28.248" class="difflineminus">-    else</span>
<a href="#l28.249"></a><span id="l28.249" class="difflineminus">-    {	</span>
<a href="#l28.250"></a><span id="l28.250" class="difflineminus">-      char *pFind = strstr(curVersionStr,&quot;-h&quot;);</span>
<a href="#l28.251"></a><span id="l28.251" class="difflineminus">-      </span>
<a href="#l28.252"></a><span id="l28.252" class="difflineminus">-      if (pFind)</span>
<a href="#l28.253"></a><span id="l28.253" class="difflineminus">-      {</span>
<a href="#l28.254"></a><span id="l28.254" class="difflineminus">-        *pFind=0;</span>
<a href="#l28.255"></a><span id="l28.255" class="difflineminus">-        lstrcpy(pPath,curVersionStr);</span>
<a href="#l28.256"></a><span id="l28.256" class="difflineminus">-      }</span>
<a href="#l28.257"></a><span id="l28.257" class="difflineminus">-      else</span>
<a href="#l28.258"></a><span id="l28.258" class="difflineminus">-      {</span>
<a href="#l28.259"></a><span id="l28.259" class="difflineminus">-        return (MAPI_E_ACCESS_DENIED);</span>
<a href="#l28.260"></a><span id="l28.260" class="difflineminus">-      }</span>
<a href="#l28.261"></a><span id="l28.261" class="difflineminus">-    }</span>
<a href="#l28.262"></a><span id="l28.262" class="difflineminus">-    </span>
<a href="#l28.263"></a><span id="l28.263" class="difflineminus">-    return SUCCESS_SUCCESS;</span>
<a href="#l28.264"></a><span id="l28.264" class="difflineminus">-  }</span>
<a href="#l28.265"></a><span id="l28.265" class="difflineminus">-  else //setup up to start navstart since we are a sixteen bit DLL.</span>
<a href="#l28.266"></a><span id="l28.266" class="difflineminus">-  {</span>
<a href="#l28.267"></a><span id="l28.267" class="difflineminus">-    if (!XP_GetVersionInfoString(szNavigatorSection, szCurrentVersionKey, curVersionStr, sizeof(curVersionStr), HKEY_LOCAL_MACHINE))</span>
<a href="#l28.268"></a><span id="l28.268" class="difflineminus">-    {</span>
<a href="#l28.269"></a><span id="l28.269" class="difflineminus">-      return (MAPI_E_LOGON_FAILURE);</span>
<a href="#l28.270"></a><span id="l28.270" class="difflineminus">-    }</span>
<a href="#l28.271"></a><span id="l28.271" class="difflineminus">-    </span>
<a href="#l28.272"></a><span id="l28.272" class="difflineminus">-    wsprintf(curVersionSection, szNavigatorCurVersionSection, curVersionStr);</span>
<a href="#l28.273"></a><span id="l28.273" class="difflineminus">-    </span>
<a href="#l28.274"></a><span id="l28.274" class="difflineminus">-    if (!XP_GetInstallDirectory(curVersionSection, szInstallDirKey, pPath,nSize, HKEY_LOCAL_MACHINE))</span>
<a href="#l28.275"></a><span id="l28.275" class="difflineminus">-    {</span>
<a href="#l28.276"></a><span id="l28.276" class="difflineminus">-      return (MAPI_E_ACCESS_DENIED);		</span>
<a href="#l28.277"></a><span id="l28.277" class="difflineminus">-    }</span>
<a href="#l28.278"></a><span id="l28.278" class="difflineminus">-    </span>
<a href="#l28.279"></a><span id="l28.279" class="difflineminus">-    lstrcat(pPath, &quot;\\&quot;);</span>
<a href="#l28.280"></a><span id="l28.280" class="difflineminus">-    lstrcat(pPath, &quot;NAVSTART.EXE&quot;);</span>
<a href="#l28.281"></a><span id="l28.281" class="difflineminus">-    return SUCCESS_SUCCESS;	</span>
<a href="#l28.282"></a><span id="l28.282" class="difflineminus">-  }</span>
<a href="#l28.283"></a><span id="l28.283" class="difflineminus">-#endif</span>
<a href="#l28.284"></a><span id="l28.284" class="difflineminus">-}</span>
<a href="#l28.285"></a><span id="l28.285" class="difflineminus">-</span>
<a href="#l28.286"></a><span id="l28.286" class="difflineminus">-int LOAD_DS Is_16_OR_32_BIT_CommunitorRunning()</span>
<a href="#l28.287"></a><span id="l28.287" class="difflineminus">-{</span>
<a href="#l28.288"></a><span id="l28.288" class="difflineminus">-  if (FindWindow(&quot;AfxFrameOrView&quot;, NULL) &amp;&amp; !FindWindow(&quot;aHiddenFrameClass&quot;, NULL))</span>
<a href="#l28.289"></a><span id="l28.289" class="difflineminus">-		return(16);</span>
<a href="#l28.290"></a><span id="l28.290" class="difflineminus">-	else if (FindWindow(&quot;aHiddenFrameClass&quot;, NULL))</span>
<a href="#l28.291"></a><span id="l28.291" class="difflineminus">-		return(32);</span>
<a href="#l28.292"></a><span id="l28.292" class="difflineminus">-	else </span>
<a href="#l28.293"></a><span id="l28.293" class="difflineminus">-		return 0;</span>
<a href="#l28.294"></a><span id="l28.294" class="difflineminus">-}</span>
<a href="#l28.295"></a><span id="l28.295" class="difflineminus">-</span>
<a href="#l28.296"></a><span id="l28.296" class="difflineminus">-// size of buffer to use for copying files.</span>
<a href="#l28.297"></a><span id="l28.297" class="difflineminus">-#define COPYBUFSIZE 1024</span>
<a href="#l28.298"></a><span id="l28.298" class="difflineminus">-</span>
<a href="#l28.299"></a><span id="l28.299" class="difflineminus">-#ifdef WIN16</span>
<a href="#l28.300"></a><span id="l28.300" class="difflineminus">-     </span>
<a href="#l28.301"></a><span id="l28.301" class="difflineminus">-BOOL Win16CopyFile(LPCSTR a_Src, LPCSTR a_Dest, BOOL a_bOverwrite)</span>
<a href="#l28.302"></a><span id="l28.302" class="difflineminus">-{</span>
<a href="#l28.303"></a><span id="l28.303" class="difflineminus">-	OFSTRUCT ofSrc, ofDest;</span>
<a href="#l28.304"></a><span id="l28.304" class="difflineminus">-	HFILE hSrc, hDest;</span>
<a href="#l28.305"></a><span id="l28.305" class="difflineminus">-	BOOL bResult;</span>
<a href="#l28.306"></a><span id="l28.306" class="difflineminus">-	</span>
<a href="#l28.307"></a><span id="l28.307" class="difflineminus">-	ofDest.cBytes = ofSrc.cBytes = sizeof(OFSTRUCT);</span>
<a href="#l28.308"></a><span id="l28.308" class="difflineminus">-	hDest = OpenFile(a_Dest, &amp;ofDest, OF_EXIST);</span>
<a href="#l28.309"></a><span id="l28.309" class="difflineminus">-	if (hDest != HFILE_ERROR &amp;&amp; !a_bOverwrite)</span>
<a href="#l28.310"></a><span id="l28.310" class="difflineminus">-		bResult = FALSE;	// file exists but caller doesn't want file overwritten</span>
<a href="#l28.311"></a><span id="l28.311" class="difflineminus">-	else { // file either doesn't exist, or caller wants it overwritten.</span>
<a href="#l28.312"></a><span id="l28.312" class="difflineminus">-		hSrc = OpenFile(a_Src, &amp;ofSrc, OF_READ);</span>
<a href="#l28.313"></a><span id="l28.313" class="difflineminus">-		hDest = OpenFile(a_Dest, &amp;ofDest, OF_WRITE | OF_CREATE);</span>
<a href="#l28.314"></a><span id="l28.314" class="difflineminus">-		if (hSrc != HFILE_ERROR &amp;&amp; hDest != HFILE_ERROR) {</span>
<a href="#l28.315"></a><span id="l28.315" class="difflineminus">-			unsigned char buf[COPYBUFSIZE];</span>
<a href="#l28.316"></a><span id="l28.316" class="difflineminus">-			UINT bufsize =  COPYBUFSIZE;</span>
<a href="#l28.317"></a><span id="l28.317" class="difflineminus">-			UINT bytesread;</span>
<a href="#l28.318"></a><span id="l28.318" class="difflineminus">-			</span>
<a href="#l28.319"></a><span id="l28.319" class="difflineminus">-			bResult = TRUE;			</span>
<a href="#l28.320"></a><span id="l28.320" class="difflineminus">-			while (0 != (bytesread = _lread(hSrc, (LPVOID)buf, bufsize))) {</span>
<a href="#l28.321"></a><span id="l28.321" class="difflineminus">-				if ((bytesread == HFILE_ERROR) || 	// check for read error...</span>
<a href="#l28.322"></a><span id="l28.322" class="difflineminus">-											// and write error</span>
<a href="#l28.323"></a><span id="l28.323" class="difflineminus">-					(bytesread != _lwrite(hDest, (LPVOID)buf, bytesread))) {</span>
<a href="#l28.324"></a><span id="l28.324" class="difflineminus">-					bResult = FALSE; // could be out of diskspace</span>
<a href="#l28.325"></a><span id="l28.325" class="difflineminus">-					break;</span>
<a href="#l28.326"></a><span id="l28.326" class="difflineminus">-				}</span>
<a href="#l28.327"></a><span id="l28.327" class="difflineminus">-			}</span>
<a href="#l28.328"></a><span id="l28.328" class="difflineminus">-		}</span>
<a href="#l28.329"></a><span id="l28.329" class="difflineminus">-		else</span>
<a href="#l28.330"></a><span id="l28.330" class="difflineminus">-			bResult = FALSE;</span>
<a href="#l28.331"></a><span id="l28.331" class="difflineminus">-</span>
<a href="#l28.332"></a><span id="l28.332" class="difflineminus">-		if (hSrc != HFILE_ERROR)</span>
<a href="#l28.333"></a><span id="l28.333" class="difflineminus">-			_lclose(hSrc);</span>
<a href="#l28.334"></a><span id="l28.334" class="difflineminus">-		if (hDest != HFILE_ERROR)</span>
<a href="#l28.335"></a><span id="l28.335" class="difflineminus">-			_lclose(hDest);</span>
<a href="#l28.336"></a><span id="l28.336" class="difflineminus">-	}</span>
<a href="#l28.337"></a><span id="l28.337" class="difflineminus">-			</span>
<a href="#l28.338"></a><span id="l28.338" class="difflineminus">-	return bResult;</span>
<a href="#l28.339"></a><span id="l28.339" class="difflineminus">-}</span>
<a href="#l28.340"></a><span id="l28.340" class="difflineminus">-</span>
<a href="#l28.341"></a><span id="l28.341" class="difflineminus">-#endif  // WIN16</span>
<a href="#l28.342"></a><span id="l28.342" class="difflineminus">-</span>
<a href="#l28.343"></a><span id="l28.343" class="difflineminus">-BOOL LOAD_DS </span>
<a href="#l28.344"></a><span id="l28.344" class="difflineminus">-XP_CopyFile(LPCSTR lpExistingFile, LPCSTR lpNewFile, BOOL bFailifExist)</span>
<a href="#l28.345"></a><span id="l28.345" class="difflineminus">-{                                                  </span>
<a href="#l28.346"></a><span id="l28.346" class="difflineminus">-#ifdef WIN32</span>
<a href="#l28.347"></a><span id="l28.347" class="difflineminus">-  return	CopyFile(lpExistingFile, lpNewFile, bFailifExist);</span>
<a href="#l28.348"></a><span id="l28.348" class="difflineminus">-#else                                                             </span>
<a href="#l28.349"></a><span id="l28.349" class="difflineminus">-  return    Win16CopyFile(lpExistingFile, lpNewFile, TRUE);</span>
<a href="#l28.350"></a><span id="l28.350" class="difflineminus">-#endif</span>
<a href="#l28.351"></a><span id="l28.351" class="difflineminus">-}    </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1">deleted file mode 100644</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineminus">--- a/mailnews/mapi/old/mapi32/xpapi.h</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineplus">+++ /dev/null</span>
<a href="#l29.4"></a><span id="l29.4" class="difflineat">@@ -1,138 +0,0 @@</span>
<a href="#l29.5"></a><span id="l29.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l29.6"></a><span id="l29.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l29.7"></a><span id="l29.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l29.8"></a><span id="l29.8" class="difflineminus">- *</span>
<a href="#l29.9"></a><span id="l29.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l29.10"></a><span id="l29.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l29.11"></a><span id="l29.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">- *</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineminus">- * License.</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineminus">- *</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineminus">- *</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l29.23"></a><span id="l29.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineminus">- *</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineminus">- *</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l29.34"></a><span id="l29.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l29.35"></a><span id="l29.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l29.36"></a><span id="l29.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l29.37"></a><span id="l29.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineminus">- *</span>
<a href="#l29.40"></a><span id="l29.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineminus">-//</span>
<a href="#l29.42"></a><span id="l29.42" class="difflineminus">-//  Various routines for MAPI functions.</span>
<a href="#l29.43"></a><span id="l29.43" class="difflineminus">-//  Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l29.44"></a><span id="l29.44" class="difflineminus">-//  November 1997</span>
<a href="#l29.45"></a><span id="l29.45" class="difflineminus">-//</span>
<a href="#l29.46"></a><span id="l29.46" class="difflineminus">-#ifndef __XPAPI_H</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineminus">-#define __XPAPI_H</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineminus">-</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineminus">-#ifdef WIN16</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineminus">-</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineminus">-#include &lt;direct.h&gt;</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineminus">-#include &lt;shellapi.h&gt;</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineminus">-#include &lt;stdlib.h&gt;</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineminus">-#else</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineminus">-#include &lt;winreg.h&gt;</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineminus">-#endif </span>
<a href="#l29.58"></a><span id="l29.58" class="difflineminus">- </span>
<a href="#l29.59"></a><span id="l29.59" class="difflineminus">-#ifdef WIN16</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineminus">-extern &quot;C&quot; {</span>
<a href="#l29.61"></a><span id="l29.61" class="difflineminus">-#ifndef MAPI_OLE	// Because MSFT doesn't do this for us :-(</span>
<a href="#l29.62"></a><span id="l29.62" class="difflineminus">-#include &lt;mapi.h&gt;</span>
<a href="#l29.63"></a><span id="l29.63" class="difflineminus">-#endif </span>
<a href="#l29.64"></a><span id="l29.64" class="difflineminus">-}           </span>
<a href="#l29.65"></a><span id="l29.65" class="difflineminus">-#else</span>
<a href="#l29.66"></a><span id="l29.66" class="difflineminus">-//#include &lt;mapi.h&gt;</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineminus">-#endif</span>
<a href="#l29.68"></a><span id="l29.68" class="difflineminus">-</span>
<a href="#l29.69"></a><span id="l29.69" class="difflineminus">-</span>
<a href="#l29.70"></a><span id="l29.70" class="difflineminus">-#ifdef WIN32</span>
<a href="#l29.71"></a><span id="l29.71" class="difflineminus">-#define MAPI_IMPLEMENT(param) param PASCAL </span>
<a href="#l29.72"></a><span id="l29.72" class="difflineminus">-#define LOAD_DS</span>
<a href="#l29.73"></a><span id="l29.73" class="difflineminus">-#else        </span>
<a href="#l29.74"></a><span id="l29.74" class="difflineminus">-#define LOAD_DS 	__loadds</span>
<a href="#l29.75"></a><span id="l29.75" class="difflineminus">-#define MAPI_IMPLEMENT(param) extern &quot;C&quot; param FAR PASCAL</span>
<a href="#l29.76"></a><span id="l29.76" class="difflineminus">- </span>
<a href="#l29.77"></a><span id="l29.77" class="difflineminus">-#endif   </span>
<a href="#l29.78"></a><span id="l29.78" class="difflineminus">-</span>
<a href="#l29.79"></a><span id="l29.79" class="difflineminus">-#ifdef WIN16</span>
<a href="#l29.80"></a><span id="l29.80" class="difflineminus">-#define _MAX_PATH 				260  /* max. length of full pathname*/</span>
<a href="#l29.81"></a><span id="l29.81" class="difflineminus">-#define MAPI_E_LOGON_FAILURE  	3 </span>
<a href="#l29.82"></a><span id="l29.82" class="difflineminus">-#define MAPI_E_ACCESS_DENIED	6  </span>
<a href="#l29.83"></a><span id="l29.83" class="difflineminus">-#define INVALID_HANDLE_VALUE 	(HANDLE)-1  </span>
<a href="#l29.84"></a><span id="l29.84" class="difflineminus">-#define KEY_QUERY_VALUE 		0x0001  </span>
<a href="#l29.85"></a><span id="l29.85" class="difflineminus">-#define HKEY_LOCAL_MACHINE 		((HKEY)0x80000002)</span>
<a href="#l29.86"></a><span id="l29.86" class="difflineminus">-#define HKEY_ROOT				HKEY_CLASSES_ROOT</span>
<a href="#l29.87"></a><span id="l29.87" class="difflineminus">-#else </span>
<a href="#l29.88"></a><span id="l29.88" class="difflineminus">-#define HKEY_ROOT				((HKEY)0x80000002)</span>
<a href="#l29.89"></a><span id="l29.89" class="difflineminus">-#endif</span>
<a href="#l29.90"></a><span id="l29.90" class="difflineminus">-</span>
<a href="#l29.91"></a><span id="l29.91" class="difflineminus">-//</span>
<a href="#l29.92"></a><span id="l29.92" class="difflineminus">-// registry keys</span>
<a href="#l29.93"></a><span id="l29.93" class="difflineminus">-//</span>
<a href="#l29.94"></a><span id="l29.94" class="difflineminus">-#ifdef WIN32</span>
<a href="#l29.95"></a><span id="l29.95" class="difflineminus">-static char szNavigatorSection[] = &quot;Software\\Netscape\\Netscape Navigator&quot;;</span>
<a href="#l29.96"></a><span id="l29.96" class="difflineminus">-static char szNavigatorCurVersionSection[] = &quot;Software\\Netscape\\Netscape Navigator\\%s\\Main&quot;;</span>
<a href="#l29.97"></a><span id="l29.97" class="difflineminus">-static char szCurrentVersionKey[] = &quot;CurrentVersion&quot;;</span>
<a href="#l29.98"></a><span id="l29.98" class="difflineminus">-static char szInstallDirKey[] = &quot;Install Directory&quot;;</span>
<a href="#l29.99"></a><span id="l29.99" class="difflineminus">-static char szMapiSection[] = &quot;Software\\Netscape\\Netscape Navigator\\MAPI&quot;;</span>
<a href="#l29.100"></a><span id="l29.100" class="difflineminus">-static char szTempFiles[] = &quot;TempFiles&quot;;  </span>
<a href="#l29.101"></a><span id="l29.101" class="difflineminus">-static char szMapiLog[] = &quot;NSMAPI32.LOG&quot;;</span>
<a href="#l29.102"></a><span id="l29.102" class="difflineminus">-#else </span>
<a href="#l29.103"></a><span id="l29.103" class="difflineminus">-//32 bit key strings for trying to read the 32bit registry</span>
<a href="#l29.104"></a><span id="l29.104" class="difflineminus">-static char szNavigatorSection32[] = &quot;Software\\Netscape\\Netscape Navigator&quot;;</span>
<a href="#l29.105"></a><span id="l29.105" class="difflineminus">-static char szNavigatorCurVersionSection32[] = &quot;Software\\Netscape\\Netscape Navigator\\%s\\Main&quot;;</span>
<a href="#l29.106"></a><span id="l29.106" class="difflineminus">-static char szMapiSection32[] = &quot;Software\\Netscape\\Netscape Navigator\\MAPI&quot;;</span>
<a href="#l29.107"></a><span id="l29.107" class="difflineminus">-</span>
<a href="#l29.108"></a><span id="l29.108" class="difflineminus">-// ini section and key strings </span>
<a href="#l29.109"></a><span id="l29.109" class="difflineminus">-static char szNetscapeINI[] = &quot;nscp.ini&quot;;</span>
<a href="#l29.110"></a><span id="l29.110" class="difflineminus">-static char szNavigatorSection[] = &quot;Netscape Navigator&quot;;</span>
<a href="#l29.111"></a><span id="l29.111" class="difflineminus">-static char szNavigatorCurVersionSection[] = &quot;Netscape Navigator-%s&quot;;</span>
<a href="#l29.112"></a><span id="l29.112" class="difflineminus">-static char szCurrentVersionKey[] = &quot;CurrentVersion&quot;;</span>
<a href="#l29.113"></a><span id="l29.113" class="difflineminus">-static char szInstallDirKey[] = &quot;Install Directory&quot;;</span>
<a href="#l29.114"></a><span id="l29.114" class="difflineminus">-static char szMapiSection[] = &quot;MAPI&quot;;</span>
<a href="#l29.115"></a><span id="l29.115" class="difflineminus">-static char szTempFiles[] = &quot;TempFiles&quot;;</span>
<a href="#l29.116"></a><span id="l29.116" class="difflineminus">-static char szExeName[] = &quot;NAVSTART.EXE&quot;;</span>
<a href="#l29.117"></a><span id="l29.117" class="difflineminus">-static char szMapiLog[] = &quot;NSMAPI16.LOG&quot;;</span>
<a href="#l29.118"></a><span id="l29.118" class="difflineminus">-#endif                                   </span>
<a href="#l29.119"></a><span id="l29.119" class="difflineminus">-</span>
<a href="#l29.120"></a><span id="l29.120" class="difflineminus">-//Since REGSAM is just an ACCESS_MASK which is just a DWORD and it's not </span>
<a href="#l29.121"></a><span id="l29.121" class="difflineminus">-//declared in win16 we'll make one hear for the purpose of keeping parameters</span>
<a href="#l29.122"></a><span id="l29.122" class="difflineminus">-//the same even though the access rights don't get used for win16.</span>
<a href="#l29.123"></a><span id="l29.123" class="difflineminus">-</span>
<a href="#l29.124"></a><span id="l29.124" class="difflineminus">-typedef DWORD REGSAM;</span>
<a href="#l29.125"></a><span id="l29.125" class="difflineminus">-</span>
<a href="#l29.126"></a><span id="l29.126" class="difflineminus">-</span>
<a href="#l29.127"></a><span id="l29.127" class="difflineminus">-// XP declarations</span>
<a href="#l29.128"></a><span id="l29.128" class="difflineminus">-</span>
<a href="#l29.129"></a><span id="l29.129" class="difflineminus">-int 	LOAD_DS Is_16_OR_32_BIT_CommunitorRunning();</span>
<a href="#l29.130"></a><span id="l29.130" class="difflineminus">-WORD 	LOAD_DS XP_CallProcess(LPCSTR pPath, LPCSTR pCmdLine);</span>
<a href="#l29.131"></a><span id="l29.131" class="difflineminus">-HKEY LOAD_DS RegOpenParent(LPCSTR pSection, HKEY hRootKey, REGSAM access);</span>
<a href="#l29.132"></a><span id="l29.132" class="difflineminus">-HKEY LOAD_DS RegCreateParent(LPCSTR pSection, HKEY hMasterKey);</span>
<a href="#l29.133"></a><span id="l29.133" class="difflineminus">-BOOL LOAD_DS GetConfigInfoStr(LPCSTR pSection, LPCSTR pKey, LPSTR pBuf, int lenBuf, HKEY hMasterKey);</span>
<a href="#l29.134"></a><span id="l29.134" class="difflineminus">-BOOL LOAD_DS GetConfigInfoNum(LPCSTR pSection, LPCSTR pKey, DWORD* pVal, HKEY hMasterKey);</span>
<a href="#l29.135"></a><span id="l29.135" class="difflineminus">-BOOL LOAD_DS SetConfigInfoStr(LPCSTR pSection, LPCSTR pKey, LPSTR pStr, HKEY hMasterKey); </span>
<a href="#l29.136"></a><span id="l29.136" class="difflineminus">-</span>
<a href="#l29.137"></a><span id="l29.137" class="difflineminus">-BOOL  LOAD_DS XP_GetInstallDirectory(LPCSTR pcurVersionSection, LPCSTR pInstallDirKey, LPSTR path, UINT nSize, HKEY hKey); </span>
<a href="#l29.138"></a><span id="l29.138" class="difflineminus">-BOOL  LOAD_DS XP_GetVersionInfoString(LPCSTR pNavigatorSection, LPCSTR pCurrentVersionKey, LPSTR pcurVersionStr, UINT nSize, HKEY hKey);</span>
<a href="#l29.139"></a><span id="l29.139" class="difflineminus">-DWORD LOAD_DS XP_GetInstallLocation(LPSTR pPath, UINT nSize);</span>
<a href="#l29.140"></a><span id="l29.140" class="difflineminus">-BOOL LOAD_DS  XP_CopyFile(LPCSTR lpExistingFile, LPCSTR lpNewFile, BOOL bFailifExist);</span>
<a href="#l29.141"></a><span id="l29.141" class="difflineminus">-</span>
<a href="#l29.142"></a><span id="l29.142" class="difflineminus">-#endif    // __XPAPI_H</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1">deleted file mode 100644</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineminus">--- a/mailnews/mapi/old/public/makefile.win</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineplus">+++ /dev/null</span>
<a href="#l30.4"></a><span id="l30.4" class="difflineat">@@ -1,48 +0,0 @@</span>
<a href="#l30.5"></a><span id="l30.5" class="difflineminus">-#!nmake</span>
<a href="#l30.6"></a><span id="l30.6" class="difflineminus">-#</span>
<a href="#l30.7"></a><span id="l30.7" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l30.8"></a><span id="l30.8" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l30.9"></a><span id="l30.9" class="difflineminus">-#</span>
<a href="#l30.10"></a><span id="l30.10" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l30.11"></a><span id="l30.11" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineminus">-#</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineminus">-# License.</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineminus">-#</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineminus">-#</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineminus">-#</span>
<a href="#l30.27"></a><span id="l30.27" class="difflineminus">-# Contributor(s):</span>
<a href="#l30.28"></a><span id="l30.28" class="difflineminus">-#</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineminus">-#</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineminus">-</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineminus">-DEPTH=..\..\..</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineminus">-MODULE=mime</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineminus">-</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineminus">-EXPORTS =							\</span>
<a href="#l30.47"></a><span id="l30.47" class="difflineminus">-	nscpmapi.h		\</span>
<a href="#l30.48"></a><span id="l30.48" class="difflineminus">-    $(NULL)</span>
<a href="#l30.49"></a><span id="l30.49" class="difflineminus">-</span>
<a href="#l30.50"></a><span id="l30.50" class="difflineminus">-</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineminus">-include &lt;$(DEPTH)\config\rules.mak&gt;</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1">deleted file mode 100644</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineminus">--- a/mailnews/mapi/old/public/nscpmapi.h</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineplus">+++ /dev/null</span>
<a href="#l31.4"></a><span id="l31.4" class="difflineat">@@ -1,351 +0,0 @@</span>
<a href="#l31.5"></a><span id="l31.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l31.6"></a><span id="l31.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l31.7"></a><span id="l31.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l31.8"></a><span id="l31.8" class="difflineminus">- *</span>
<a href="#l31.9"></a><span id="l31.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l31.10"></a><span id="l31.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l31.11"></a><span id="l31.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">- *</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineminus">- * License.</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineminus">- *</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineminus">- *</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineminus">- *</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineminus">- *</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l31.29"></a><span id="l31.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l31.34"></a><span id="l31.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l31.35"></a><span id="l31.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l31.36"></a><span id="l31.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l31.37"></a><span id="l31.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l31.38"></a><span id="l31.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l31.39"></a><span id="l31.39" class="difflineminus">- *</span>
<a href="#l31.40"></a><span id="l31.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l31.41"></a><span id="l31.41" class="difflineminus">-//</span>
<a href="#l31.42"></a><span id="l31.42" class="difflineminus">-// This is a header file for the MAPI support within </span>
<a href="#l31.43"></a><span id="l31.43" class="difflineminus">-// Communicator. </span>
<a href="#l31.44"></a><span id="l31.44" class="difflineminus">-//</span>
<a href="#l31.45"></a><span id="l31.45" class="difflineminus">-// Written by: Rich Pizzarro (rhp@netscape.com)</span>
<a href="#l31.46"></a><span id="l31.46" class="difflineminus">-//</span>
<a href="#l31.47"></a><span id="l31.47" class="difflineminus">-#ifndef _NSCPMAPI</span>
<a href="#l31.48"></a><span id="l31.48" class="difflineminus">-#define _NSCPMAPI</span>
<a href="#l31.49"></a><span id="l31.49" class="difflineminus">-</span>
<a href="#l31.50"></a><span id="l31.50" class="difflineminus">-#ifndef MAPI_OLE	// Because MSFT doesn't do this for us :-(</span>
<a href="#l31.51"></a><span id="l31.51" class="difflineminus">-#include &lt;mapi.h&gt;     // for MAPI specific types...        </span>
<a href="#l31.52"></a><span id="l31.52" class="difflineminus">-#endif </span>
<a href="#l31.53"></a><span id="l31.53" class="difflineminus">-</span>
<a href="#l31.54"></a><span id="l31.54" class="difflineminus">-#ifdef WIN16</span>
<a href="#l31.55"></a><span id="l31.55" class="difflineminus">-typedef unsigned char	UCHAR;</span>
<a href="#l31.56"></a><span id="l31.56" class="difflineminus">-#endif </span>
<a href="#l31.57"></a><span id="l31.57" class="difflineminus">-</span>
<a href="#l31.58"></a><span id="l31.58" class="difflineminus">-</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineminus">-#define           MAX_NAME_LEN    256</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineminus">-#define           MAX_PW_LEN      256</span>
<a href="#l31.61"></a><span id="l31.61" class="difflineminus">-#define           MAX_MSGINFO_LEN 512</span>
<a href="#l31.62"></a><span id="l31.62" class="difflineminus">-#define           MAX_CON         4     // Maximum MAPI session supported</span>
<a href="#l31.63"></a><span id="l31.63" class="difflineminus">-#define           MAX_POINTERS    32</span>
<a href="#l31.64"></a><span id="l31.64" class="difflineminus">-</span>
<a href="#l31.65"></a><span id="l31.65" class="difflineminus">-//</span>
<a href="#l31.66"></a><span id="l31.66" class="difflineminus">-// The MAPI class that will act as the internal mechanism for </span>
<a href="#l31.67"></a><span id="l31.67" class="difflineminus">-// Communicator to control multiple MAPI sessions.</span>
<a href="#l31.68"></a><span id="l31.68" class="difflineminus">-//</span>
<a href="#l31.69"></a><span id="l31.69" class="difflineminus">-class CMAPIConnection </span>
<a href="#l31.70"></a><span id="l31.70" class="difflineminus">-{</span>
<a href="#l31.71"></a><span id="l31.71" class="difflineminus">-protected:</span>
<a href="#l31.72"></a><span id="l31.72" class="difflineminus">-  LONG        m_ID;</span>
<a href="#l31.73"></a><span id="l31.73" class="difflineminus">-  BOOL        m_defaultConnection;  </span>
<a href="#l31.74"></a><span id="l31.74" class="difflineminus">-  LONG        m_sessionCount;</span>
<a href="#l31.75"></a><span id="l31.75" class="difflineminus">-  LONG        m_messageIndex;</span>
<a href="#l31.76"></a><span id="l31.76" class="difflineminus">-  LPVOID      m_cookie;</span>
<a href="#l31.77"></a><span id="l31.77" class="difflineminus">-  UCHAR       m_messageFindInfo[MAX_MSGINFO_LEN];</span>
<a href="#l31.78"></a><span id="l31.78" class="difflineminus">-  UCHAR       m_profileName[MAX_NAME_LEN];</span>
<a href="#l31.79"></a><span id="l31.79" class="difflineminus">-  UCHAR       m_password[MAX_PW_LEN];</span>
<a href="#l31.80"></a><span id="l31.80" class="difflineminus">-</span>
<a href="#l31.81"></a><span id="l31.81" class="difflineminus">-  // Methods</span>
<a href="#l31.82"></a><span id="l31.82" class="difflineminus">-</span>
<a href="#l31.83"></a><span id="l31.83" class="difflineminus">-public:</span>
<a href="#l31.84"></a><span id="l31.84" class="difflineminus">-  CMAPIConnection  ( LONG, LPSTR, LPSTR );</span>
<a href="#l31.85"></a><span id="l31.85" class="difflineminus">-  ~CMAPIConnection ( );</span>
<a href="#l31.86"></a><span id="l31.86" class="difflineminus">-</span>
<a href="#l31.87"></a><span id="l31.87" class="difflineminus">-  // ID related methods</span>
<a href="#l31.88"></a><span id="l31.88" class="difflineminus">-  LONG   GetID( ) { return m_ID; } ;</span>
<a href="#l31.89"></a><span id="l31.89" class="difflineminus">-</span>
<a href="#l31.90"></a><span id="l31.90" class="difflineminus">-  // Dealing with the default session...</span>
<a href="#l31.91"></a><span id="l31.91" class="difflineminus">-  BOOL    IsDefault( ) { return m_defaultConnection; } ;</span>
<a href="#l31.92"></a><span id="l31.92" class="difflineminus">-  void    SetDefault( BOOL flag ) { m_defaultConnection = flag; } ;</span>
<a href="#l31.93"></a><span id="l31.93" class="difflineminus">-</span>
<a href="#l31.94"></a><span id="l31.94" class="difflineminus">-  // For handling multiple sessions on a profile name...</span>
<a href="#l31.95"></a><span id="l31.95" class="difflineminus">-  LONG    GetSessionCount( ) { return m_sessionCount; } ;</span>
<a href="#l31.96"></a><span id="l31.96" class="difflineminus">-  void    IncrementSessionCount() { ++m_sessionCount; } ;</span>
<a href="#l31.97"></a><span id="l31.97" class="difflineminus">-  void    DecrementSessionCount() { --m_sessionCount; } ;</span>
<a href="#l31.98"></a><span id="l31.98" class="difflineminus">-</span>
<a href="#l31.99"></a><span id="l31.99" class="difflineminus">-  // Information retrieval stuff...</span>
<a href="#l31.100"></a><span id="l31.100" class="difflineminus">-  LPSTR   GetProfileName( ) { return (LPSTR) m_profileName; };</span>
<a href="#l31.101"></a><span id="l31.101" class="difflineminus">-  LPSTR   GetPassword( ) { return (LPSTR) m_password; };</span>
<a href="#l31.102"></a><span id="l31.102" class="difflineminus">-</span>
<a href="#l31.103"></a><span id="l31.103" class="difflineminus">-  // Dealing with message information...</span>
<a href="#l31.104"></a><span id="l31.104" class="difflineminus">-  void    SetMessageIndex( LONG mIndex ) { m_messageIndex = mIndex; } ;</span>
<a href="#l31.105"></a><span id="l31.105" class="difflineminus">-  LONG    GetMessageIndex( ) { return m_messageIndex; };</span>
<a href="#l31.106"></a><span id="l31.106" class="difflineminus">-</span>
<a href="#l31.107"></a><span id="l31.107" class="difflineminus">-  void    SetMessageFindInfo( LPSTR info ) { lstrcpy((LPSTR)m_messageFindInfo, info); } ;</span>
<a href="#l31.108"></a><span id="l31.108" class="difflineminus">-  LPSTR   GetMessageFindInfo( ) { return (LPSTR) m_messageFindInfo; };</span>
<a href="#l31.109"></a><span id="l31.109" class="difflineminus">-</span>
<a href="#l31.110"></a><span id="l31.110" class="difflineminus">-  // For enumerating Messages...</span>
<a href="#l31.111"></a><span id="l31.111" class="difflineminus">-  void    SetMapiListContext( LPVOID cookie) { m_cookie = cookie; } ;</span>
<a href="#l31.112"></a><span id="l31.112" class="difflineminus">-  LPVOID  GetMapiListContext( ) { return m_cookie; };</span>
<a href="#l31.113"></a><span id="l31.113" class="difflineminus">-};</span>
<a href="#l31.114"></a><span id="l31.114" class="difflineminus">-</span>
<a href="#l31.115"></a><span id="l31.115" class="difflineminus">-//</span>
<a href="#l31.116"></a><span id="l31.116" class="difflineminus">-// Defines needed for requests being made with the WM_COPYDATA call...</span>
<a href="#l31.117"></a><span id="l31.117" class="difflineminus">-//</span>
<a href="#l31.118"></a><span id="l31.118" class="difflineminus">-typedef enum {</span>
<a href="#l31.119"></a><span id="l31.119" class="difflineminus">-    NSCP_MAPIStartRequestID = 0,</span>
<a href="#l31.120"></a><span id="l31.120" class="difflineminus">-    NSCP_MAPILogon,</span>
<a href="#l31.121"></a><span id="l31.121" class="difflineminus">-    NSCP_MAPILogoff,</span>
<a href="#l31.122"></a><span id="l31.122" class="difflineminus">-    NSCP_MAPIFree,</span>
<a href="#l31.123"></a><span id="l31.123" class="difflineminus">-    NSCP_MAPISendMail,</span>
<a href="#l31.124"></a><span id="l31.124" class="difflineminus">-    NSCP_MAPISendDocuments, </span>
<a href="#l31.125"></a><span id="l31.125" class="difflineminus">-    NSCP_MAPIFindNext,</span>
<a href="#l31.126"></a><span id="l31.126" class="difflineminus">-    NSCP_MAPIReadMail,</span>
<a href="#l31.127"></a><span id="l31.127" class="difflineminus">-    NSCP_MAPISaveMail,</span>
<a href="#l31.128"></a><span id="l31.128" class="difflineminus">-    NSCP_MAPIDeleteMail,</span>
<a href="#l31.129"></a><span id="l31.129" class="difflineminus">-    NSCP_MAPIAddress,</span>
<a href="#l31.130"></a><span id="l31.130" class="difflineminus">-    NSCP_MAPIDetails,</span>
<a href="#l31.131"></a><span id="l31.131" class="difflineminus">-    NSCP_MAPIResolveName,</span>
<a href="#l31.132"></a><span id="l31.132" class="difflineminus">-    NSCP_MAPIEndRequestID       // Note: this is a marker for MAPI IPC requests</span>
<a href="#l31.133"></a><span id="l31.133" class="difflineminus">-} NSCP_IPC_REQUEST;</span>
<a href="#l31.134"></a><span id="l31.134" class="difflineminus">-</span>
<a href="#l31.135"></a><span id="l31.135" class="difflineminus">-//</span>
<a href="#l31.136"></a><span id="l31.136" class="difflineminus">-// This is to keep track of the pointers allocated in the MAPI DLL</span>
<a href="#l31.137"></a><span id="l31.137" class="difflineminus">-// and deal with them correctly.</span>
<a href="#l31.138"></a><span id="l31.138" class="difflineminus">-//</span>
<a href="#l31.139"></a><span id="l31.139" class="difflineminus">-#define   MAPI_MESSAGE_TYPE     0</span>
<a href="#l31.140"></a><span id="l31.140" class="difflineminus">-#define   MAPI_RECIPIENT_TYPE   1</span>
<a href="#l31.141"></a><span id="l31.141" class="difflineminus">- </span>
<a href="#l31.142"></a><span id="l31.142" class="difflineminus">-typedef struct {</span>
<a href="#l31.143"></a><span id="l31.143" class="difflineminus">-  LPVOID    lpMem;</span>
<a href="#l31.144"></a><span id="l31.144" class="difflineminus">-  UCHAR     memType;</span>
<a href="#l31.145"></a><span id="l31.145" class="difflineminus">-} memTrackerType;</span>
<a href="#l31.146"></a><span id="l31.146" class="difflineminus">-</span>
<a href="#l31.147"></a><span id="l31.147" class="difflineminus">-//</span>
<a href="#l31.148"></a><span id="l31.148" class="difflineminus">-// This is the generic message that WM_COPYDATA will send to the</span>
<a href="#l31.149"></a><span id="l31.149" class="difflineminus">-// Communicator product to allow it to attach to shared memory.</span>
<a href="#l31.150"></a><span id="l31.150" class="difflineminus">-// NOTE: On Win16, this will simply reference a pointer.</span>
<a href="#l31.151"></a><span id="l31.151" class="difflineminus">-//</span>
<a href="#l31.152"></a><span id="l31.152" class="difflineminus">-typedef struct {</span>
<a href="#l31.153"></a><span id="l31.153" class="difflineminus">-  UCHAR   smemName[64]; // Name of shared memory</span>
<a href="#l31.154"></a><span id="l31.154" class="difflineminus">-  DWORD   smemSize;     // Size of shared memory</span>
<a href="#l31.155"></a><span id="l31.155" class="difflineminus">-  LPVOID  lpsmem;       // Will be really used in Win16 only</span>
<a href="#l31.156"></a><span id="l31.156" class="difflineminus">-} MAPIIPCType;</span>
<a href="#l31.157"></a><span id="l31.157" class="difflineminus">-</span>
<a href="#l31.158"></a><span id="l31.158" class="difflineminus">-//</span>
<a href="#l31.159"></a><span id="l31.159" class="difflineminus">-// These are message specific structures that will be used for </span>
<a href="#l31.160"></a><span id="l31.160" class="difflineminus">-// the various MAPI operations.</span>
<a href="#l31.161"></a><span id="l31.161" class="difflineminus">-//</span>
<a href="#l31.162"></a><span id="l31.162" class="difflineminus">-typedef struct {</span>
<a href="#l31.163"></a><span id="l31.163" class="difflineminus">-  ULONG     ulUIParam;</span>
<a href="#l31.164"></a><span id="l31.164" class="difflineminus">-  FLAGS     flFlags;</span>
<a href="#l31.165"></a><span id="l31.165" class="difflineminus">-  LHANDLE   lhSession;</span>
<a href="#l31.166"></a><span id="l31.166" class="difflineminus">-  DWORD     ipcWorked;      // Necessary for IPC check with Communicator</span>
<a href="#l31.167"></a><span id="l31.167" class="difflineminus">-// LPSTR     strSequence,  // LPSTR lpszProfileName, LPSTR lpszPassword</span>
<a href="#l31.168"></a><span id="l31.168" class="difflineminus">-// This is here to document the fact there will be a string sequence at </span>
<a href="#l31.169"></a><span id="l31.169" class="difflineminus">-// this location</span>
<a href="#l31.170"></a><span id="l31.170" class="difflineminus">-} MAPILogonType;</span>
<a href="#l31.171"></a><span id="l31.171" class="difflineminus">-</span>
<a href="#l31.172"></a><span id="l31.172" class="difflineminus">-typedef struct {</span>
<a href="#l31.173"></a><span id="l31.173" class="difflineminus">-  LHANDLE   lhSession;</span>
<a href="#l31.174"></a><span id="l31.174" class="difflineminus">-  ULONG     ulUIParam;</span>
<a href="#l31.175"></a><span id="l31.175" class="difflineminus">-  FLAGS     flFlags;</span>
<a href="#l31.176"></a><span id="l31.176" class="difflineminus">-  DWORD     ipcWorked;      // Necessary for IPC check with Communicator</span>
<a href="#l31.177"></a><span id="l31.177" class="difflineminus">-} MAPILogoffType;</span>
<a href="#l31.178"></a><span id="l31.178" class="difflineminus">-</span>
<a href="#l31.179"></a><span id="l31.179" class="difflineminus">-typedef struct {</span>
<a href="#l31.180"></a><span id="l31.180" class="difflineminus">-  LHANDLE   lhSession;</span>
<a href="#l31.181"></a><span id="l31.181" class="difflineminus">-  ULONG     ulUIParam;</span>
<a href="#l31.182"></a><span id="l31.182" class="difflineminus">-  FLAGS     flFlags;</span>
<a href="#l31.183"></a><span id="l31.183" class="difflineminus">-  DWORD     ipcWorked;      // Necessary for IPC check with Communicator</span>
<a href="#l31.184"></a><span id="l31.184" class="difflineminus">-  // The following is the &quot;FLAT&quot; representation of the (lpMapiMessage lpMessage) </span>
<a href="#l31.185"></a><span id="l31.185" class="difflineminus">-  // argument of this structure </span>
<a href="#l31.186"></a><span id="l31.186" class="difflineminus">-  FLAGS     MSG_flFlags;          // unread,return receipt                  </span>
<a href="#l31.187"></a><span id="l31.187" class="difflineminus">-  ULONG     MSG_nRecipCount;      // Number of recipients                   </span>
<a href="#l31.188"></a><span id="l31.188" class="difflineminus">-  ULONG     MSG_nFileCount;       // # of file attachments                  </span>
<a href="#l31.189"></a><span id="l31.189" class="difflineminus">-  ULONG     MSG_ORIG_ulRecipClass; //  Recipient class - MAPI_TO, MAPI_CC, MAPI_BCC, MAPI_ORIG</span>
<a href="#l31.190"></a><span id="l31.190" class="difflineminus">-  BYTE      dataBuf[1];           // For easy referencing</span>
<a href="#l31.191"></a><span id="l31.191" class="difflineminus">-  //</span>
<a href="#l31.192"></a><span id="l31.192" class="difflineminus">-  // This is where it gets CONFUSING...the following buffer of memory is a</span>
<a href="#l31.193"></a><span id="l31.193" class="difflineminus">-  // contiguous chunk of memory for various strings that are part of this</span>
<a href="#l31.194"></a><span id="l31.194" class="difflineminus">-  // multilevel structure. For any of the following structure, any numbers</span>
<a href="#l31.195"></a><span id="l31.195" class="difflineminus">-  // are represented by strings that will have to be converted back to numeric</span>
<a href="#l31.196"></a><span id="l31.196" class="difflineminus">-  // values with atoi() calls.</span>
<a href="#l31.197"></a><span id="l31.197" class="difflineminus">-</span>
<a href="#l31.198"></a><span id="l31.198" class="difflineminus">-  // String 0: LPSTR lpszSubject;            // Message Subject</span>
<a href="#l31.199"></a><span id="l31.199" class="difflineminus">-  // String 1: LPSTR lpszNoteText FILE NAME; // Message Text will be</span>
<a href="#l31.200"></a><span id="l31.200" class="difflineminus">-  //           stored into a temp file and this will be the pointer to that file.</span>
<a href="#l31.201"></a><span id="l31.201" class="difflineminus">-  // String 2: LPSTR lpszDateReceived;       // in YYYY/MM/DD HH:MM format</span>
<a href="#l31.202"></a><span id="l31.202" class="difflineminus">-  // String 3: LPSTR lpszConversationID;     // conversation thread ID</span>
<a href="#l31.203"></a><span id="l31.203" class="difflineminus">-  //</span>
<a href="#l31.204"></a><span id="l31.204" class="difflineminus">-  // The following are for the originator of the message. Only ONE of these.</span>
<a href="#l31.205"></a><span id="l31.205" class="difflineminus">-  //</span>
<a href="#l31.206"></a><span id="l31.206" class="difflineminus">-  // String 4: LPSTR lpszName;             // Originator name                           </span>
<a href="#l31.207"></a><span id="l31.207" class="difflineminus">-  // String 5: LPSTR lpszAddress;          // Originator address (optional)             </span>
<a href="#l31.208"></a><span id="l31.208" class="difflineminus">-  //</span>
<a href="#l31.209"></a><span id="l31.209" class="difflineminus">-  // The following strings are for the recipients for this message. There are</span>
<a href="#l31.210"></a><span id="l31.210" class="difflineminus">-  // MSG_nRecipCount of these in a row:</span>
<a href="#l31.211"></a><span id="l31.211" class="difflineminus">-  //</span>
<a href="#l31.212"></a><span id="l31.212" class="difflineminus">-  // for (i=0; i&lt;MSG_nRecipCount; i++)</span>
<a href="#l31.213"></a><span id="l31.213" class="difflineminus">-  //      String x: LPSTR lpszRecipClass (ULONG) // Recipient class - MAPI_TO, MAPI_CC, MAPI_BCC, MAPI_ORIG        </span>
<a href="#l31.214"></a><span id="l31.214" class="difflineminus">-  //      String x: LPSTR lpszName;     // Recipient N name                           </span>
<a href="#l31.215"></a><span id="l31.215" class="difflineminus">-  //      String x: LPSTR lpszAddress;  // Recipient N address (optional)             </span>
<a href="#l31.216"></a><span id="l31.216" class="difflineminus">-  //</span>
<a href="#l31.217"></a><span id="l31.217" class="difflineminus">-  // Now, finally, add the attachments for this beast. There are MSG_nFileCount</span>
<a href="#l31.218"></a><span id="l31.218" class="difflineminus">-  // attachments so it would look like the following:</span>
<a href="#l31.219"></a><span id="l31.219" class="difflineminus">-  //</span>
<a href="#l31.220"></a><span id="l31.220" class="difflineminus">-  // for (i=0; i&lt;MSG_nFileCount; i++)</span>
<a href="#l31.221"></a><span id="l31.221" class="difflineminus">-  //</span>
<a href="#l31.222"></a><span id="l31.222" class="difflineminus">-  //      String x: LPSTR lpszPathName // Fully qualified path of the attached file. </span>
<a href="#l31.223"></a><span id="l31.223" class="difflineminus">-  //                                   // This path should include the disk drive letter and directory name.</span>
<a href="#l31.224"></a><span id="l31.224" class="difflineminus">-  //      String x: LPSTR lpszFileName // The display name for the attached file</span>
<a href="#l31.225"></a><span id="l31.225" class="difflineminus">-  //</span>
<a href="#l31.226"></a><span id="l31.226" class="difflineminus">-} MAPISendMailType;</span>
<a href="#l31.227"></a><span id="l31.227" class="difflineminus">-</span>
<a href="#l31.228"></a><span id="l31.228" class="difflineminus">-typedef struct {</span>
<a href="#l31.229"></a><span id="l31.229" class="difflineminus">-    ULONG     ulUIParam;</span>
<a href="#l31.230"></a><span id="l31.230" class="difflineminus">-    ULONG     nFileCount;</span>
<a href="#l31.231"></a><span id="l31.231" class="difflineminus">-    DWORD     ipcWorked;      // Necessary for IPC check with Communicator</span>
<a href="#l31.232"></a><span id="l31.232" class="difflineminus">-    BYTE      dataBuf[1];     // For easy referencing</span>
<a href="#l31.233"></a><span id="l31.233" class="difflineminus">-    //</span>
<a href="#l31.234"></a><span id="l31.234" class="difflineminus">-    // The sequence of strings to follow are groups of PathName/FileName couples.</span>
<a href="#l31.235"></a><span id="l31.235" class="difflineminus">-    // The strings will be parsed in MAPI[32].DLL and then put into this format:</span>
<a href="#l31.236"></a><span id="l31.236" class="difflineminus">-    //</span>
<a href="#l31.237"></a><span id="l31.237" class="difflineminus">-    // for (i=0; i&lt;nFileCount; i++)</span>
<a href="#l31.238"></a><span id="l31.238" class="difflineminus">-    //</span>
<a href="#l31.239"></a><span id="l31.239" class="difflineminus">-    //      String x: LPSTR lpszPathName // Fully qualified path of the attached file. </span>
<a href="#l31.240"></a><span id="l31.240" class="difflineminus">-    //                                   // This path should include the disk drive letter and directory name.</span>
<a href="#l31.241"></a><span id="l31.241" class="difflineminus">-    //      String x: LPSTR lpszFileName // The display name for the attached file</span>
<a href="#l31.242"></a><span id="l31.242" class="difflineminus">-} MAPISendDocumentsType;</span>
<a href="#l31.243"></a><span id="l31.243" class="difflineminus">-</span>
<a href="#l31.244"></a><span id="l31.244" class="difflineminus">-typedef struct {</span>
<a href="#l31.245"></a><span id="l31.245" class="difflineminus">-  LHANDLE     lhSession;</span>
<a href="#l31.246"></a><span id="l31.246" class="difflineminus">-  ULONG       ulUIParam;</span>
<a href="#l31.247"></a><span id="l31.247" class="difflineminus">-  FLAGS       flFlags;</span>
<a href="#l31.248"></a><span id="l31.248" class="difflineminus">-  DWORD       ipcWorked;      // Necessary for IPC check with Communicator</span>
<a href="#l31.249"></a><span id="l31.249" class="difflineminus">-  UCHAR       lpszSeedMessageID[MAX_MSGINFO_LEN];</span>
<a href="#l31.250"></a><span id="l31.250" class="difflineminus">-  UCHAR       lpszMessageID[MAX_MSGINFO_LEN];</span>
<a href="#l31.251"></a><span id="l31.251" class="difflineminus">-} MAPIFindNextType;</span>
<a href="#l31.252"></a><span id="l31.252" class="difflineminus">-</span>
<a href="#l31.253"></a><span id="l31.253" class="difflineminus">-typedef struct {</span>
<a href="#l31.254"></a><span id="l31.254" class="difflineminus">-  LHANDLE     lhSession;</span>
<a href="#l31.255"></a><span id="l31.255" class="difflineminus">-  ULONG       ulUIParam;</span>
<a href="#l31.256"></a><span id="l31.256" class="difflineminus">-  DWORD       ipcWorked;      // Necessary for IPC check with Communicator</span>
<a href="#l31.257"></a><span id="l31.257" class="difflineminus">-  UCHAR       lpszMessageID[MAX_MSGINFO_LEN];</span>
<a href="#l31.258"></a><span id="l31.258" class="difflineminus">-} MAPIDeleteMailType;</span>
<a href="#l31.259"></a><span id="l31.259" class="difflineminus">-</span>
<a href="#l31.260"></a><span id="l31.260" class="difflineminus">-typedef struct {</span>
<a href="#l31.261"></a><span id="l31.261" class="difflineminus">-  LHANDLE     lhSession;</span>
<a href="#l31.262"></a><span id="l31.262" class="difflineminus">-  ULONG       ulUIParam;</span>
<a href="#l31.263"></a><span id="l31.263" class="difflineminus">-  FLAGS       flFlags;</span>
<a href="#l31.264"></a><span id="l31.264" class="difflineminus">-  DWORD       ipcWorked;      // Necessary for IPC check with Communicator</span>
<a href="#l31.265"></a><span id="l31.265" class="difflineminus">-  UCHAR       lpszName[MAX_NAME_LEN];</span>
<a href="#l31.266"></a><span id="l31.266" class="difflineminus">-  // These are returned by Communicator</span>
<a href="#l31.267"></a><span id="l31.267" class="difflineminus">-  UCHAR       lpszABookID[MAX_NAME_LEN];         </span>
<a href="#l31.268"></a><span id="l31.268" class="difflineminus">-  UCHAR       lpszABookName[MAX_NAME_LEN];            </span>
<a href="#l31.269"></a><span id="l31.269" class="difflineminus">-  UCHAR       lpszABookAddress[MAX_NAME_LEN];         </span>
<a href="#l31.270"></a><span id="l31.270" class="difflineminus">-} MAPIResolveNameType;</span>
<a href="#l31.271"></a><span id="l31.271" class="difflineminus">-</span>
<a href="#l31.272"></a><span id="l31.272" class="difflineminus">-typedef struct {</span>
<a href="#l31.273"></a><span id="l31.273" class="difflineminus">-  LHANDLE     lhSession;</span>
<a href="#l31.274"></a><span id="l31.274" class="difflineminus">-  ULONG       ulUIParam;</span>
<a href="#l31.275"></a><span id="l31.275" class="difflineminus">-  FLAGS       flFlags;</span>
<a href="#l31.276"></a><span id="l31.276" class="difflineminus">-  DWORD       ipcWorked;      // Necessary for IPC check with Communicator</span>
<a href="#l31.277"></a><span id="l31.277" class="difflineminus">-  UCHAR       lpszABookID[MAX_NAME_LEN];</span>
<a href="#l31.278"></a><span id="l31.278" class="difflineminus">-} MAPIDetailsType;</span>
<a href="#l31.279"></a><span id="l31.279" class="difflineminus">-</span>
<a href="#l31.280"></a><span id="l31.280" class="difflineminus">-typedef struct {</span>
<a href="#l31.281"></a><span id="l31.281" class="difflineminus">-  LHANDLE     lhSession;</span>
<a href="#l31.282"></a><span id="l31.282" class="difflineminus">-  ULONG       ulUIParam;</span>
<a href="#l31.283"></a><span id="l31.283" class="difflineminus">-  FLAGS       flFlags;</span>
<a href="#l31.284"></a><span id="l31.284" class="difflineminus">-  DWORD       ipcWorked;      // Necessary for IPC check with Communicator</span>
<a href="#l31.285"></a><span id="l31.285" class="difflineminus">-  UCHAR       lpszMessageID[MAX_MSGINFO_LEN];</span>
<a href="#l31.286"></a><span id="l31.286" class="difflineminus">-  //</span>
<a href="#l31.287"></a><span id="l31.287" class="difflineminus">-  // The following is the &quot;FLAT&quot; representation of the (lpMapiMessage lpMessage) </span>
<a href="#l31.288"></a><span id="l31.288" class="difflineminus">-  // argument of this structure </span>
<a href="#l31.289"></a><span id="l31.289" class="difflineminus">-  //</span>
<a href="#l31.290"></a><span id="l31.290" class="difflineminus">-  FLAGS     MSG_flFlags;          // unread, return or receipt                  </span>
<a href="#l31.291"></a><span id="l31.291" class="difflineminus">-  ULONG     MSG_nRecipCount;      // Number of recipients                   </span>
<a href="#l31.292"></a><span id="l31.292" class="difflineminus">-  ULONG     MSG_nFileCount;       // # of file attachments                  </span>
<a href="#l31.293"></a><span id="l31.293" class="difflineminus">-  ULONG     MSG_ORIG_ulRecipClass; //  Recipient class - MAPI_TO, MAPI_CC, MAPI_BCC, MAPI_ORIG</span>
<a href="#l31.294"></a><span id="l31.294" class="difflineminus">-  //</span>
<a href="#l31.295"></a><span id="l31.295" class="difflineminus">-  // Output parameter for blob of information that will live on disk. </span>
<a href="#l31.296"></a><span id="l31.296" class="difflineminus">-  //</span>
<a href="#l31.297"></a><span id="l31.297" class="difflineminus">-  UCHAR       lpszBlob[MAX_MSGINFO_LEN];    // file name on disk</span>
<a href="#l31.298"></a><span id="l31.298" class="difflineminus">-  //</span>
<a href="#l31.299"></a><span id="l31.299" class="difflineminus">-  // The format of this blob of information will be:</span>
<a href="#l31.300"></a><span id="l31.300" class="difflineminus">-  //</span>
<a href="#l31.301"></a><span id="l31.301" class="difflineminus">-  // String 0: LPSTR lpszSubject;            // Message Subject</span>
<a href="#l31.302"></a><span id="l31.302" class="difflineminus">-  // String 1: LPSTR lpszNoteText FILE NAME; // Message Text will be</span>
<a href="#l31.303"></a><span id="l31.303" class="difflineminus">-  //           stored into a temp file and this will be the pointer to that file.</span>
<a href="#l31.304"></a><span id="l31.304" class="difflineminus">-  // String 2: LPSTR lpszDateReceived;       // in YYYY/MM/DD HH:MM format</span>
<a href="#l31.305"></a><span id="l31.305" class="difflineminus">-  // String 3: LPSTR lpszConversationID;     // conversation thread ID</span>
<a href="#l31.306"></a><span id="l31.306" class="difflineminus">-  //</span>
<a href="#l31.307"></a><span id="l31.307" class="difflineminus">-  // The following are for the originator of the message. Only ONE of these.</span>
<a href="#l31.308"></a><span id="l31.308" class="difflineminus">-  //</span>
<a href="#l31.309"></a><span id="l31.309" class="difflineminus">-  // String 4: LPSTR lpszName;             // Originator name                           </span>
<a href="#l31.310"></a><span id="l31.310" class="difflineminus">-  // String 5: LPSTR lpszAddress;          // Originator address (optional)             </span>
<a href="#l31.311"></a><span id="l31.311" class="difflineminus">-  //</span>
<a href="#l31.312"></a><span id="l31.312" class="difflineminus">-  // The following strings are for the recipients for this message. There are</span>
<a href="#l31.313"></a><span id="l31.313" class="difflineminus">-  // MSG_nRecipCount of these in a row:</span>
<a href="#l31.314"></a><span id="l31.314" class="difflineminus">-  //</span>
<a href="#l31.315"></a><span id="l31.315" class="difflineminus">-  // for (i=0; i&lt;MSG_nRecipCount; i++)</span>
<a href="#l31.316"></a><span id="l31.316" class="difflineminus">-  //      String x: LPSTR lpszName;             // Recipient N name                           </span>
<a href="#l31.317"></a><span id="l31.317" class="difflineminus">-  //      String x: LPSTR lpszAddress;          // Recipient N address (optional)             </span>
<a href="#l31.318"></a><span id="l31.318" class="difflineminus">-  //      String x: LPSTR lpszRecipClass        // recipient class - sprintf of ULONG</span>
<a href="#l31.319"></a><span id="l31.319" class="difflineminus">-  //</span>
<a href="#l31.320"></a><span id="l31.320" class="difflineminus">-  // Now, finally, add the attachments for this beast. There are MSG_nFileCount</span>
<a href="#l31.321"></a><span id="l31.321" class="difflineminus">-  // attachments so it would look like the following:</span>
<a href="#l31.322"></a><span id="l31.322" class="difflineminus">-  //</span>
<a href="#l31.323"></a><span id="l31.323" class="difflineminus">-  // for (i=0; i&lt;MSG_nFileCount; i++)</span>
<a href="#l31.324"></a><span id="l31.324" class="difflineminus">-  //</span>
<a href="#l31.325"></a><span id="l31.325" class="difflineminus">-  //      String x: LPSTR lpszPathName // Fully qualified path of the attached file. </span>
<a href="#l31.326"></a><span id="l31.326" class="difflineminus">-  //                                   // This path should include the disk drive letter and directory name.</span>
<a href="#l31.327"></a><span id="l31.327" class="difflineminus">-  //      String x: LPSTR lpszFileName // The display name for the attached file</span>
<a href="#l31.328"></a><span id="l31.328" class="difflineminus">-  //</span>
<a href="#l31.329"></a><span id="l31.329" class="difflineminus">-} MAPIReadMailType;</span>
<a href="#l31.330"></a><span id="l31.330" class="difflineminus">-</span>
<a href="#l31.331"></a><span id="l31.331" class="difflineminus">-typedef struct {</span>
<a href="#l31.332"></a><span id="l31.332" class="difflineminus">-  LHANDLE   lhSession;</span>
<a href="#l31.333"></a><span id="l31.333" class="difflineminus">-  ULONG     ulUIParam;</span>
<a href="#l31.334"></a><span id="l31.334" class="difflineminus">-  FLAGS     flFlags;</span>
<a href="#l31.335"></a><span id="l31.335" class="difflineminus">-  UCHAR     lpszCaption[MAX_MSGINFO_LEN];</span>
<a href="#l31.336"></a><span id="l31.336" class="difflineminus">-  DWORD     ipcWorked;      // Necessary for IPC check with Communicator</span>
<a href="#l31.337"></a><span id="l31.337" class="difflineminus">-  // The following is the &quot;FLAT&quot; representation of the (lpMapiRecipDesc lpRecips) </span>
<a href="#l31.338"></a><span id="l31.338" class="difflineminus">-  // argument of this structure </span>
<a href="#l31.339"></a><span id="l31.339" class="difflineminus">-  ULONG     nRecips;              // number of recips to start with...</span>
<a href="#l31.340"></a><span id="l31.340" class="difflineminus">-  ULONG     nNewRecips;           // number of recips returned...</span>
<a href="#l31.341"></a><span id="l31.341" class="difflineminus">-  UCHAR     lpszBlob[MAX_MSGINFO_LEN];    // file name for blob of information </span>
<a href="#l31.342"></a><span id="l31.342" class="difflineminus">-                                          // that will live on disk. </span>
<a href="#l31.343"></a><span id="l31.343" class="difflineminus">-  BYTE      dataBuf[1];           // For easy referencing</span>
<a href="#l31.344"></a><span id="l31.344" class="difflineminus">-  //</span>
<a href="#l31.345"></a><span id="l31.345" class="difflineminus">-  // The following contiguous chunk of memory is the buffer that holds </span>
<a href="#l31.346"></a><span id="l31.346" class="difflineminus">-  // the recipients to load into the address picker...</span>
<a href="#l31.347"></a><span id="l31.347" class="difflineminus">-  //</span>
<a href="#l31.348"></a><span id="l31.348" class="difflineminus">-  // for (i=0; i&lt;MSG_nRecipCount; i++)</span>
<a href="#l31.349"></a><span id="l31.349" class="difflineminus">-  //      String x: LPSTR lpszRecipClass (ULONG) // Recipient class - MAPI_TO, MAPI_CC, MAPI_BCC, MAPI_ORIG        </span>
<a href="#l31.350"></a><span id="l31.350" class="difflineminus">-  //      String x: LPSTR lpszName;     // Recipient N name                           </span>
<a href="#l31.351"></a><span id="l31.351" class="difflineminus">-  //      String x: LPSTR lpszAddress;  // Recipient N address (optional)             </span>
<a href="#l31.352"></a><span id="l31.352" class="difflineminus">-  //</span>
<a href="#l31.353"></a><span id="l31.353" class="difflineminus">-} MAPIAddressType;</span>
<a href="#l31.354"></a><span id="l31.354" class="difflineminus">-</span>
<a href="#l31.355"></a><span id="l31.355" class="difflineminus">-#endif    // _NSCPMAPI</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1">deleted file mode 100644</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineminus">--- a/mailnews/mapi/old/tests/makefile.win</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineplus">+++ /dev/null</span>
<a href="#l32.4"></a><span id="l32.4" class="difflineat">@@ -1,44 +0,0 @@</span>
<a href="#l32.5"></a><span id="l32.5" class="difflineminus">-#!nmake</span>
<a href="#l32.6"></a><span id="l32.6" class="difflineminus">-#</span>
<a href="#l32.7"></a><span id="l32.7" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l32.8"></a><span id="l32.8" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l32.9"></a><span id="l32.9" class="difflineminus">-#</span>
<a href="#l32.10"></a><span id="l32.10" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l32.11"></a><span id="l32.11" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineminus">-#</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l32.17"></a><span id="l32.17" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l32.18"></a><span id="l32.18" class="difflineminus">-# License.</span>
<a href="#l32.19"></a><span id="l32.19" class="difflineminus">-#</span>
<a href="#l32.20"></a><span id="l32.20" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineminus">-#</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l32.23"></a><span id="l32.23" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l32.24"></a><span id="l32.24" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l32.25"></a><span id="l32.25" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l32.26"></a><span id="l32.26" class="difflineminus">-#</span>
<a href="#l32.27"></a><span id="l32.27" class="difflineminus">-# Contributor(s):</span>
<a href="#l32.28"></a><span id="l32.28" class="difflineminus">-#</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l32.35"></a><span id="l32.35" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineminus">-#</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineminus">-</span>
<a href="#l32.43"></a><span id="l32.43" class="difflineminus">-DEPTH=..\..\..</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineminus">-</span>
<a href="#l32.45"></a><span id="l32.45" class="difflineminus">-</span>
<a href="#l32.46"></a><span id="l32.46" class="difflineminus">-DIRS=mapitest</span>
<a href="#l32.47"></a><span id="l32.47" class="difflineminus">-</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineminus">-include &lt;$(DEPTH)\config\rules.mak&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1">deleted file mode 100644</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/main.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineplus">+++ /dev/null</span>
<a href="#l33.4"></a><span id="l33.4" class="difflineat">@@ -1,239 +0,0 @@</span>
<a href="#l33.5"></a><span id="l33.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l33.6"></a><span id="l33.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l33.7"></a><span id="l33.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l33.8"></a><span id="l33.8" class="difflineminus">- *</span>
<a href="#l33.9"></a><span id="l33.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l33.10"></a><span id="l33.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l33.11"></a><span id="l33.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineminus">- *</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineminus">- * License.</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineminus">- *</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l33.20"></a><span id="l33.20" class="difflineminus">- *</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l33.23"></a><span id="l33.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l33.24"></a><span id="l33.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l33.25"></a><span id="l33.25" class="difflineminus">- *</span>
<a href="#l33.26"></a><span id="l33.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l33.27"></a><span id="l33.27" class="difflineminus">- *</span>
<a href="#l33.28"></a><span id="l33.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l33.29"></a><span id="l33.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l33.30"></a><span id="l33.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l33.34"></a><span id="l33.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l33.35"></a><span id="l33.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l33.36"></a><span id="l33.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l33.37"></a><span id="l33.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l33.38"></a><span id="l33.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l33.39"></a><span id="l33.39" class="difflineminus">- *</span>
<a href="#l33.40"></a><span id="l33.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineminus">-//</span>
<a href="#l33.42"></a><span id="l33.42" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l33.43"></a><span id="l33.43" class="difflineminus">-#include &lt;windowsx.h&gt;</span>
<a href="#l33.44"></a><span id="l33.44" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l33.45"></a><span id="l33.45" class="difflineminus">-#include &lt;stdlib.h&gt;</span>
<a href="#l33.46"></a><span id="l33.46" class="difflineminus">-#ifndef MAPI_OLE	// Because MSFT doesn't do this for us :-(</span>
<a href="#l33.47"></a><span id="l33.47" class="difflineminus">-#include &lt;mapi.h&gt;</span>
<a href="#l33.48"></a><span id="l33.48" class="difflineminus">-#endif</span>
<a href="#l33.49"></a><span id="l33.49" class="difflineminus">-</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineminus">-#include &quot;port.h&quot;</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l33.52"></a><span id="l33.52" class="difflineminus">-</span>
<a href="#l33.53"></a><span id="l33.53" class="difflineminus">-#ifndef WM_PAINTICON</span>
<a href="#l33.54"></a><span id="l33.54" class="difflineminus">-#define WM_PAINTICON              0x26</span>
<a href="#l33.55"></a><span id="l33.55" class="difflineminus">-#endif // WM_PAINTICON</span>
<a href="#l33.56"></a><span id="l33.56" class="difflineminus">-</span>
<a href="#l33.57"></a><span id="l33.57" class="difflineminus">-/* </span>
<a href="#l33.58"></a><span id="l33.58" class="difflineminus">- * Forward Declarations...</span>
<a href="#l33.59"></a><span id="l33.59" class="difflineminus">- */</span>
<a href="#l33.60"></a><span id="l33.60" class="difflineminus">-BOOL      InitInstance(HINSTANCE hInstance, int nCmdShow);</span>
<a href="#l33.61"></a><span id="l33.61" class="difflineminus">-BOOL CALLBACK LOADDS MyDlgProc(HWND hWnd, UINT wMsg, WPARAM wParam, LPARAM lParam);</span>
<a href="#l33.62"></a><span id="l33.62" class="difflineminus">-extern void ProcessCommand(HWND hWnd, int id, HWND hCtl, UINT codeNotify);</span>
<a href="#l33.63"></a><span id="l33.63" class="difflineminus">-BOOL      OpenMAPI(void);</span>
<a href="#l33.64"></a><span id="l33.64" class="difflineminus">-void      CloseMAPI(void);</span>
<a href="#l33.65"></a><span id="l33.65" class="difflineminus">-</span>
<a href="#l33.66"></a><span id="l33.66" class="difflineminus">-/*  </span>
<a href="#l33.67"></a><span id="l33.67" class="difflineminus">- * Global variables</span>
<a href="#l33.68"></a><span id="l33.68" class="difflineminus">- */</span>
<a href="#l33.69"></a><span id="l33.69" class="difflineminus">-HINSTANCE   hInst;</span>
<a href="#l33.70"></a><span id="l33.70" class="difflineminus">-HWND      hWnd;    </span>
<a href="#l33.71"></a><span id="l33.71" class="difflineminus">-</span>
<a href="#l33.72"></a><span id="l33.72" class="difflineminus">-#ifdef WIN16</span>
<a href="#l33.73"></a><span id="l33.73" class="difflineminus">-HICON	hIconApp;</span>
<a href="#l33.74"></a><span id="l33.74" class="difflineminus">-#endif</span>
<a href="#l33.75"></a><span id="l33.75" class="difflineminus">-</span>
<a href="#l33.76"></a><span id="l33.76" class="difflineminus">-char NEAR szAppName[] = &quot;Netscape QA Helper&quot;;</span>
<a href="#l33.77"></a><span id="l33.77" class="difflineminus">-char NEAR szShortAppName[] = &quot;QAHelper&quot;;</span>
<a href="#l33.78"></a><span id="l33.78" class="difflineminus">-char szClassName[] = &quot;Netscape_QAHelper_Class_Name&quot;;</span>
<a href="#l33.79"></a><span id="l33.79" class="difflineminus">-</span>
<a href="#l33.80"></a><span id="l33.80" class="difflineminus">-void</span>
<a href="#l33.81"></a><span id="l33.81" class="difflineminus">-AppCleanup(void)</span>
<a href="#l33.82"></a><span id="l33.82" class="difflineminus">-{</span>
<a href="#l33.83"></a><span id="l33.83" class="difflineminus">-  extern void    DoMAPILogoff(HWND hWnd);</span>
<a href="#l33.84"></a><span id="l33.84" class="difflineminus">-  static BOOL isDone = FALSE;</span>
<a href="#l33.85"></a><span id="l33.85" class="difflineminus">-</span>
<a href="#l33.86"></a><span id="l33.86" class="difflineminus">-  if (isDone)</span>
<a href="#l33.87"></a><span id="l33.87" class="difflineminus">-    return;</span>
<a href="#l33.88"></a><span id="l33.88" class="difflineminus">-</span>
<a href="#l33.89"></a><span id="l33.89" class="difflineminus">-  extern LHANDLE    mapiSession;</span>
<a href="#l33.90"></a><span id="l33.90" class="difflineminus">-</span>
<a href="#l33.91"></a><span id="l33.91" class="difflineminus">-  if (mapiSession != 0)</span>
<a href="#l33.92"></a><span id="l33.92" class="difflineminus">-  {</span>
<a href="#l33.93"></a><span id="l33.93" class="difflineminus">-    DoMAPILogoff(hWnd);</span>
<a href="#l33.94"></a><span id="l33.94" class="difflineminus">-  }</span>
<a href="#l33.95"></a><span id="l33.95" class="difflineminus">-</span>
<a href="#l33.96"></a><span id="l33.96" class="difflineminus">-  CloseMAPI();</span>
<a href="#l33.97"></a><span id="l33.97" class="difflineminus">-  isDone = TRUE;</span>
<a href="#l33.98"></a><span id="l33.98" class="difflineminus">-}</span>
<a href="#l33.99"></a><span id="l33.99" class="difflineminus">-</span>
<a href="#l33.100"></a><span id="l33.100" class="difflineminus">-BOOL </span>
<a href="#l33.101"></a><span id="l33.101" class="difflineminus">-InitInstance(HINSTANCE hInstance, int nCmdShow)</span>
<a href="#l33.102"></a><span id="l33.102" class="difflineminus">-{</span>
<a href="#l33.103"></a><span id="l33.103" class="difflineminus">-  /* Create a main window for this application instance.  */</span>
<a href="#l33.104"></a><span id="l33.104" class="difflineminus">-  hWnd = CreateDialog((HINSTANCE) hInstance, </span>
<a href="#l33.105"></a><span id="l33.105" class="difflineminus">-            MAKEINTRESOURCE(ID_DIALOG),</span>
<a href="#l33.106"></a><span id="l33.106" class="difflineminus">-            (HWND) NULL, (DLGPROC) MyDlgProc);</span>
<a href="#l33.107"></a><span id="l33.107" class="difflineminus">-  </span>
<a href="#l33.108"></a><span id="l33.108" class="difflineminus">-  if (!hWnd)</span>
<a href="#l33.109"></a><span id="l33.109" class="difflineminus">-    return FALSE;</span>
<a href="#l33.110"></a><span id="l33.110" class="difflineminus">-  else</span>
<a href="#l33.111"></a><span id="l33.111" class="difflineminus">-    return TRUE;</span>
<a href="#l33.112"></a><span id="l33.112" class="difflineminus">-}</span>
<a href="#l33.113"></a><span id="l33.113" class="difflineminus">-</span>
<a href="#l33.114"></a><span id="l33.114" class="difflineminus">-BOOL InitApp(void)</span>
<a href="#l33.115"></a><span id="l33.115" class="difflineminus">-{</span>
<a href="#l33.116"></a><span id="l33.116" class="difflineminus">-#ifndef WIN16</span>
<a href="#l33.117"></a><span id="l33.117" class="difflineminus">-  WNDCLASS wc;</span>
<a href="#l33.118"></a><span id="l33.118" class="difflineminus">-  wc.style         = 0; </span>
<a href="#l33.119"></a><span id="l33.119" class="difflineminus">-  wc.lpfnWndProc   = DefDlgProc; </span>
<a href="#l33.120"></a><span id="l33.120" class="difflineminus">-  wc.cbClsExtra    = 0; </span>
<a href="#l33.121"></a><span id="l33.121" class="difflineminus">-  wc.cbWndExtra    = DLGWINDOWEXTRA; </span>
<a href="#l33.122"></a><span id="l33.122" class="difflineminus">-  wc.hInstance     = hInst; </span>
<a href="#l33.123"></a><span id="l33.123" class="difflineminus">-  wc.hIcon         = LoadIcon(hInst, MAKEINTRESOURCE(ID_ICON_APP)); </span>
<a href="#l33.124"></a><span id="l33.124" class="difflineminus">-  wc.hCursor       = LoadCursor(0, IDC_ARROW); </span>
<a href="#l33.125"></a><span id="l33.125" class="difflineminus">-  wc.hbrBackground = (HBRUSH)(COLOR_BTNFACE + 1);</span>
<a href="#l33.126"></a><span id="l33.126" class="difflineminus">-  wc.lpszMenuName  = NULL; </span>
<a href="#l33.127"></a><span id="l33.127" class="difflineminus">-  wc.lpszClassName = szClassName;</span>
<a href="#l33.128"></a><span id="l33.128" class="difflineminus">-  </span>
<a href="#l33.129"></a><span id="l33.129" class="difflineminus">-  if(!RegisterClass(&amp;wc))</span>
<a href="#l33.130"></a><span id="l33.130" class="difflineminus">-    return FALSE;</span>
<a href="#l33.131"></a><span id="l33.131" class="difflineminus">-</span>
<a href="#l33.132"></a><span id="l33.132" class="difflineminus">-#else                </span>
<a href="#l33.133"></a><span id="l33.133" class="difflineminus">-  hIconApp = LoadIcon(hInst, MAKEINTRESOURCE(ID_ICON_APP));</span>
<a href="#l33.134"></a><span id="l33.134" class="difflineminus">-#endif</span>
<a href="#l33.135"></a><span id="l33.135" class="difflineminus">-  </span>
<a href="#l33.136"></a><span id="l33.136" class="difflineminus">-  return TRUE;</span>
<a href="#l33.137"></a><span id="l33.137" class="difflineminus">-} // end InitApp</span>
<a href="#l33.138"></a><span id="l33.138" class="difflineminus">-</span>
<a href="#l33.139"></a><span id="l33.139" class="difflineminus">-// Win Main </span>
<a href="#l33.140"></a><span id="l33.140" class="difflineminus">-int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)</span>
<a href="#l33.141"></a><span id="l33.141" class="difflineminus">-{</span>
<a href="#l33.142"></a><span id="l33.142" class="difflineminus">-  MSG     msg;</span>
<a href="#l33.143"></a><span id="l33.143" class="difflineminus">-  </span>
<a href="#l33.144"></a><span id="l33.144" class="difflineminus">-  hInst = hInstance;</span>
<a href="#l33.145"></a><span id="l33.145" class="difflineminus">-  </span>
<a href="#l33.146"></a><span id="l33.146" class="difflineminus">-  if (!InitApp()) </span>
<a href="#l33.147"></a><span id="l33.147" class="difflineminus">-  { </span>
<a href="#l33.148"></a><span id="l33.148" class="difflineminus">-    return FALSE;</span>
<a href="#l33.149"></a><span id="l33.149" class="difflineminus">-  }</span>
<a href="#l33.150"></a><span id="l33.150" class="difflineminus">-  </span>
<a href="#l33.151"></a><span id="l33.151" class="difflineminus">-  if (!InitInstance(hInstance, nCmdShow)) </span>
<a href="#l33.152"></a><span id="l33.152" class="difflineminus">-  {    </span>
<a href="#l33.153"></a><span id="l33.153" class="difflineminus">-    return FALSE;</span>
<a href="#l33.154"></a><span id="l33.154" class="difflineminus">-  }</span>
<a href="#l33.155"></a><span id="l33.155" class="difflineminus">-</span>
<a href="#l33.156"></a><span id="l33.156" class="difflineminus">-  if (!OpenMAPI()) </span>
<a href="#l33.157"></a><span id="l33.157" class="difflineminus">-  {    </span>
<a href="#l33.158"></a><span id="l33.158" class="difflineminus">-    return FALSE;</span>
<a href="#l33.159"></a><span id="l33.159" class="difflineminus">-  }</span>
<a href="#l33.160"></a><span id="l33.160" class="difflineminus">-</span>
<a href="#l33.161"></a><span id="l33.161" class="difflineminus">-  ShowWindow(hWnd, SW_SHOW);</span>
<a href="#l33.162"></a><span id="l33.162" class="difflineminus">-  </span>
<a href="#l33.163"></a><span id="l33.163" class="difflineminus">-  // Start the application</span>
<a href="#l33.164"></a><span id="l33.164" class="difflineminus">-  while ((GetMessage(&amp;msg, (HWND) NULL, (UINT) NULL, (UINT) NULL)))</span>
<a href="#l33.165"></a><span id="l33.165" class="difflineminus">-  {</span>
<a href="#l33.166"></a><span id="l33.166" class="difflineminus">-    if(IsDialogMessage(hWnd, &amp;msg))</span>
<a href="#l33.167"></a><span id="l33.167" class="difflineminus">-      continue;</span>
<a href="#l33.168"></a><span id="l33.168" class="difflineminus">-    </span>
<a href="#l33.169"></a><span id="l33.169" class="difflineminus">-    TranslateMessage(&amp;msg);</span>
<a href="#l33.170"></a><span id="l33.170" class="difflineminus">-    DispatchMessage(&amp;msg);</span>
<a href="#l33.171"></a><span id="l33.171" class="difflineminus">-  }</span>
<a href="#l33.172"></a><span id="l33.172" class="difflineminus">-</span>
<a href="#l33.173"></a><span id="l33.173" class="difflineminus">-  return(msg.wParam);</span>
<a href="#l33.174"></a><span id="l33.174" class="difflineminus">-}</span>
<a href="#l33.175"></a><span id="l33.175" class="difflineminus">-</span>
<a href="#l33.176"></a><span id="l33.176" class="difflineminus">-BOOL CALLBACK LOADDS </span>
<a href="#l33.177"></a><span id="l33.177" class="difflineminus">-MyDlgProc(HWND hWndMain, UINT wMsg, WPARAM wParam, LPARAM lParam) </span>
<a href="#l33.178"></a><span id="l33.178" class="difflineminus">-{</span>
<a href="#l33.179"></a><span id="l33.179" class="difflineminus">-  switch (wMsg) </span>
<a href="#l33.180"></a><span id="l33.180" class="difflineminus">-  {</span>
<a href="#l33.181"></a><span id="l33.181" class="difflineminus">-  case WM_INITDIALOG: </span>
<a href="#l33.182"></a><span id="l33.182" class="difflineminus">-    {</span>
<a href="#l33.183"></a><span id="l33.183" class="difflineminus">-      hWnd = hWndMain;</span>
<a href="#l33.184"></a><span id="l33.184" class="difflineminus">-	    SetDlgItemText(hWnd, ID_EDIT_ROW, &quot;0&quot;);</span>
<a href="#l33.185"></a><span id="l33.185" class="difflineminus">-    }</span>
<a href="#l33.186"></a><span id="l33.186" class="difflineminus">-    break;</span>
<a href="#l33.187"></a><span id="l33.187" class="difflineminus">-    </span>
<a href="#l33.188"></a><span id="l33.188" class="difflineminus">-  case WM_CLOSE:</span>
<a href="#l33.189"></a><span id="l33.189" class="difflineminus">-    {</span>
<a href="#l33.190"></a><span id="l33.190" class="difflineminus">-      DestroyWindow(hWnd);</span>
<a href="#l33.191"></a><span id="l33.191" class="difflineminus">-      break;</span>
<a href="#l33.192"></a><span id="l33.192" class="difflineminus">-    }</span>
<a href="#l33.193"></a><span id="l33.193" class="difflineminus">-</span>
<a href="#l33.194"></a><span id="l33.194" class="difflineminus">-  case WM_DESTROY:</span>
<a href="#l33.195"></a><span id="l33.195" class="difflineminus">-    {</span>
<a href="#l33.196"></a><span id="l33.196" class="difflineminus">-      AppCleanup();</span>
<a href="#l33.197"></a><span id="l33.197" class="difflineminus">-</span>
<a href="#l33.198"></a><span id="l33.198" class="difflineminus">-#ifndef WIN16</span>
<a href="#l33.199"></a><span id="l33.199" class="difflineminus">-      UnregisterClass(szClassName, hInst);</span>
<a href="#l33.200"></a><span id="l33.200" class="difflineminus">-#else              </span>
<a href="#l33.201"></a><span id="l33.201" class="difflineminus">-      // Destroy the 16 bit windows icon</span>
<a href="#l33.202"></a><span id="l33.202" class="difflineminus">-      if(hIconApp != 0)</span>
<a href="#l33.203"></a><span id="l33.203" class="difflineminus">-        DestroyIcon(hIconApp);</span>
<a href="#l33.204"></a><span id="l33.204" class="difflineminus">-#endif</span>
<a href="#l33.205"></a><span id="l33.205" class="difflineminus">-      </span>
<a href="#l33.206"></a><span id="l33.206" class="difflineminus">-      PostQuitMessage(0);</span>
<a href="#l33.207"></a><span id="l33.207" class="difflineminus">-      break;</span>
<a href="#l33.208"></a><span id="l33.208" class="difflineminus">-    }</span>
<a href="#l33.209"></a><span id="l33.209" class="difflineminus">-  case WM_COMMAND:</span>
<a href="#l33.210"></a><span id="l33.210" class="difflineminus">-    HANDLE_WM_COMMAND(hWnd, wParam, lParam, ProcessCommand);</span>
<a href="#l33.211"></a><span id="l33.211" class="difflineminus">-    break;</span>
<a href="#l33.212"></a><span id="l33.212" class="difflineminus">-    </span>
<a href="#l33.213"></a><span id="l33.213" class="difflineminus">-  case WM_QUERYDRAGICON:     </span>
<a href="#l33.214"></a><span id="l33.214" class="difflineminus">-#ifdef WIN16</span>
<a href="#l33.215"></a><span id="l33.215" class="difflineminus">-    return (BOOL)hIconApp;</span>
<a href="#l33.216"></a><span id="l33.216" class="difflineminus">-#endif</span>
<a href="#l33.217"></a><span id="l33.217" class="difflineminus">-    </span>
<a href="#l33.218"></a><span id="l33.218" class="difflineminus">-  case WM_PAINTICON:</span>
<a href="#l33.219"></a><span id="l33.219" class="difflineminus">-#ifdef WIN16    </span>
<a href="#l33.220"></a><span id="l33.220" class="difflineminus">-    SetClassWord(hWnd, GCW_HICON, 0);</span>
<a href="#l33.221"></a><span id="l33.221" class="difflineminus">-    </span>
<a href="#l33.222"></a><span id="l33.222" class="difflineminus">-    // fall trough</span>
<a href="#l33.223"></a><span id="l33.223" class="difflineminus">-  case WM_PAINT: </span>
<a href="#l33.224"></a><span id="l33.224" class="difflineminus">-    {</span>
<a href="#l33.225"></a><span id="l33.225" class="difflineminus">-      if(!IsIconic(hWnd))</span>
<a href="#l33.226"></a><span id="l33.226" class="difflineminus">-        return FALSE;</span>
<a href="#l33.227"></a><span id="l33.227" class="difflineminus">-      PAINTSTRUCT ps;</span>
<a href="#l33.228"></a><span id="l33.228" class="difflineminus">-      HDC hDC = BeginPaint(hWnd, &amp;ps);</span>
<a href="#l33.229"></a><span id="l33.229" class="difflineminus">-      SetMapMode(hDC, MM_TEXT);</span>
<a href="#l33.230"></a><span id="l33.230" class="difflineminus">-      DrawIcon(hDC, 2, 2, hIconApp);</span>
<a href="#l33.231"></a><span id="l33.231" class="difflineminus">-      EndPaint(hWnd, &amp;ps);</span>
<a href="#l33.232"></a><span id="l33.232" class="difflineminus">-      break;</span>
<a href="#l33.233"></a><span id="l33.233" class="difflineminus">-    } </span>
<a href="#l33.234"></a><span id="l33.234" class="difflineminus">-#endif //WIN16</span>
<a href="#l33.235"></a><span id="l33.235" class="difflineminus">-    break;    // RICHIE - if this is not here NT 3.51 Pukes!!!!  </span>
<a href="#l33.236"></a><span id="l33.236" class="difflineminus">-</span>
<a href="#l33.237"></a><span id="l33.237" class="difflineminus">-  default:</span>
<a href="#l33.238"></a><span id="l33.238" class="difflineminus">-    return FALSE;</span>
<a href="#l33.239"></a><span id="l33.239" class="difflineminus">-  }</span>
<a href="#l33.240"></a><span id="l33.240" class="difflineminus">-  </span>
<a href="#l33.241"></a><span id="l33.241" class="difflineminus">-  //~~av  return (DefWindowProc(hWnd, wMsg, wParam, lParam));</span>
<a href="#l33.242"></a><span id="l33.242" class="difflineminus">-  return TRUE;</span>
<a href="#l33.243"></a><span id="l33.243" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1">deleted file mode 100644</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/makefile.win</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineplus">+++ /dev/null</span>
<a href="#l34.4"></a><span id="l34.4" class="difflineat">@@ -1,240 +0,0 @@</span>
<a href="#l34.5"></a><span id="l34.5" class="difflineminus">-# Microsoft Developer Studio Generated NMAKE File, Based on mapitest.dsp</span>
<a href="#l34.6"></a><span id="l34.6" class="difflineminus">-!IF &quot;$(CFG)&quot; == &quot;&quot;</span>
<a href="#l34.7"></a><span id="l34.7" class="difflineminus">-CFG=mapitest - Win32 Debug</span>
<a href="#l34.8"></a><span id="l34.8" class="difflineminus">-!MESSAGE No configuration specified. Defaulting to mapitest - Win32 Debug.</span>
<a href="#l34.9"></a><span id="l34.9" class="difflineminus">-!ENDIF </span>
<a href="#l34.10"></a><span id="l34.10" class="difflineminus">-</span>
<a href="#l34.11"></a><span id="l34.11" class="difflineminus">-!IF &quot;$(CFG)&quot; != &quot;mapitest - Win32 Release&quot; &amp;&amp; &quot;$(CFG)&quot; != &quot;mapitest - Win32 Debug&quot;</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-!MESSAGE Invalid configuration &quot;$(CFG)&quot; specified.</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-!MESSAGE You can specify a configuration when running NMAKE</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-!MESSAGE by defining the macro CFG on the command line. For example:</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineminus">-!MESSAGE </span>
<a href="#l34.16"></a><span id="l34.16" class="difflineminus">-!MESSAGE NMAKE /f &quot;mapitest.mak&quot; CFG=&quot;mapitest - Win32 Debug&quot;</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineminus">-!MESSAGE </span>
<a href="#l34.18"></a><span id="l34.18" class="difflineminus">-!MESSAGE Possible choices for configuration are:</span>
<a href="#l34.19"></a><span id="l34.19" class="difflineminus">-!MESSAGE </span>
<a href="#l34.20"></a><span id="l34.20" class="difflineminus">-!MESSAGE &quot;mapitest - Win32 Release&quot; (based on &quot;Win32 (x86) Application&quot;)</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineminus">-!MESSAGE &quot;mapitest - Win32 Debug&quot; (based on &quot;Win32 (x86) Application&quot;)</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineminus">-!MESSAGE </span>
<a href="#l34.23"></a><span id="l34.23" class="difflineminus">-!ERROR An invalid configuration is specified.</span>
<a href="#l34.24"></a><span id="l34.24" class="difflineminus">-!ENDIF </span>
<a href="#l34.25"></a><span id="l34.25" class="difflineminus">-</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineminus">-!IF &quot;$(OS)&quot; == &quot;Windows_NT&quot;</span>
<a href="#l34.27"></a><span id="l34.27" class="difflineminus">-NULL=</span>
<a href="#l34.28"></a><span id="l34.28" class="difflineminus">-!ELSE </span>
<a href="#l34.29"></a><span id="l34.29" class="difflineminus">-NULL=nul</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineminus">-!ENDIF </span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineminus">-!IF  &quot;$(CFG)&quot; == &quot;mapitest - Win32 Release&quot;</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineminus">-</span>
<a href="#l34.34"></a><span id="l34.34" class="difflineminus">-OUTDIR=.\Release</span>
<a href="#l34.35"></a><span id="l34.35" class="difflineminus">-INTDIR=.\Release</span>
<a href="#l34.36"></a><span id="l34.36" class="difflineminus">-# Begin Custom Macros</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineminus">-OutDir=.\Release</span>
<a href="#l34.38"></a><span id="l34.38" class="difflineminus">-# End Custom Macros</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineminus">-</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineminus">-ALL : &quot;$(OUTDIR)\mapitest.exe&quot;</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineminus">-</span>
<a href="#l34.42"></a><span id="l34.42" class="difflineminus">-export :</span>
<a href="#l34.43"></a><span id="l34.43" class="difflineminus">-libs :</span>
<a href="#l34.44"></a><span id="l34.44" class="difflineminus">-install : </span>
<a href="#l34.45"></a><span id="l34.45" class="difflineminus">-</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineminus">-clobber_all : clobber</span>
<a href="#l34.47"></a><span id="l34.47" class="difflineminus">-</span>
<a href="#l34.48"></a><span id="l34.48" class="difflineminus">-clobber:</span>
<a href="#l34.49"></a><span id="l34.49" class="difflineminus">-	-@erase &quot;$(INTDIR)\main.obj&quot;</span>
<a href="#l34.50"></a><span id="l34.50" class="difflineminus">-	-@erase &quot;$(INTDIR)\mapimail.obj&quot;</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineminus">-	-@erase &quot;$(INTDIR)\mapiproc.obj&quot;</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineminus">-	-@erase &quot;$(INTDIR)\mtest32.res&quot;</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineminus">-	-@erase &quot;$(INTDIR)\readmail.obj&quot;</span>
<a href="#l34.54"></a><span id="l34.54" class="difflineminus">-	-@erase &quot;$(INTDIR)\vc60.idb&quot;</span>
<a href="#l34.55"></a><span id="l34.55" class="difflineminus">-	-@erase &quot;$(OUTDIR)\mapitest.exe&quot;</span>
<a href="#l34.56"></a><span id="l34.56" class="difflineminus">-	-@erase &quot;$(OUTDIR)\mapitest.pch&quot;</span>
<a href="#l34.57"></a><span id="l34.57" class="difflineminus">-</span>
<a href="#l34.58"></a><span id="l34.58" class="difflineminus">-&quot;$(OUTDIR)&quot; :</span>
<a href="#l34.59"></a><span id="l34.59" class="difflineminus">-    if not exist &quot;$(OUTDIR)/$(NULL)&quot; mkdir &quot;$(OUTDIR)&quot;</span>
<a href="#l34.60"></a><span id="l34.60" class="difflineminus">-</span>
<a href="#l34.61"></a><span id="l34.61" class="difflineminus">-CPP=cl.exe</span>
<a href="#l34.62"></a><span id="l34.62" class="difflineminus">-CPP_PROJ=/nologo /ML /W3 /GX /O2 /D &quot;WIN32&quot; /D &quot;NDEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /Fp&quot;$(INTDIR)\mapitest.pch&quot; /YX /Fo&quot;$(INTDIR)\\&quot; /Fd&quot;$(INTDIR)\\&quot; /FD /c </span>
<a href="#l34.63"></a><span id="l34.63" class="difflineminus">-</span>
<a href="#l34.64"></a><span id="l34.64" class="difflineminus">-.c{$(INTDIR)}.obj::</span>
<a href="#l34.65"></a><span id="l34.65" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.66"></a><span id="l34.66" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.67"></a><span id="l34.67" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.68"></a><span id="l34.68" class="difflineminus">-</span>
<a href="#l34.69"></a><span id="l34.69" class="difflineminus">-.cpp{$(INTDIR)}.obj::</span>
<a href="#l34.70"></a><span id="l34.70" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.71"></a><span id="l34.71" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.72"></a><span id="l34.72" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.73"></a><span id="l34.73" class="difflineminus">-</span>
<a href="#l34.74"></a><span id="l34.74" class="difflineminus">-.cxx{$(INTDIR)}.obj::</span>
<a href="#l34.75"></a><span id="l34.75" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.76"></a><span id="l34.76" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.77"></a><span id="l34.77" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.78"></a><span id="l34.78" class="difflineminus">-</span>
<a href="#l34.79"></a><span id="l34.79" class="difflineminus">-.c{$(INTDIR)}.sbr::</span>
<a href="#l34.80"></a><span id="l34.80" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.81"></a><span id="l34.81" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.82"></a><span id="l34.82" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.83"></a><span id="l34.83" class="difflineminus">-</span>
<a href="#l34.84"></a><span id="l34.84" class="difflineminus">-.cpp{$(INTDIR)}.sbr::</span>
<a href="#l34.85"></a><span id="l34.85" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.86"></a><span id="l34.86" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.87"></a><span id="l34.87" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.88"></a><span id="l34.88" class="difflineminus">-</span>
<a href="#l34.89"></a><span id="l34.89" class="difflineminus">-.cxx{$(INTDIR)}.sbr::</span>
<a href="#l34.90"></a><span id="l34.90" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.91"></a><span id="l34.91" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.92"></a><span id="l34.92" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.93"></a><span id="l34.93" class="difflineminus">-</span>
<a href="#l34.94"></a><span id="l34.94" class="difflineminus">-MTL=midl.exe</span>
<a href="#l34.95"></a><span id="l34.95" class="difflineminus">-MTL_PROJ=/nologo /D &quot;NDEBUG&quot; /mktyplib203 /win32 </span>
<a href="#l34.96"></a><span id="l34.96" class="difflineminus">-RSC=rc.exe</span>
<a href="#l34.97"></a><span id="l34.97" class="difflineminus">-RSC_PROJ=/l 0x409 /fo&quot;$(INTDIR)\mtest32.res&quot; /d &quot;NDEBUG&quot; </span>
<a href="#l34.98"></a><span id="l34.98" class="difflineminus">-BSC32=bscmake.exe</span>
<a href="#l34.99"></a><span id="l34.99" class="difflineminus">-BSC32_FLAGS=/nologo /o&quot;$(OUTDIR)\mapitest.bsc&quot; </span>
<a href="#l34.100"></a><span id="l34.100" class="difflineminus">-BSC32_SBRS= \</span>
<a href="#l34.101"></a><span id="l34.101" class="difflineminus">-	</span>
<a href="#l34.102"></a><span id="l34.102" class="difflineminus">-LINK32=link.exe</span>
<a href="#l34.103"></a><span id="l34.103" class="difflineminus">-LINK32_FLAGS=kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /subsystem:windows /incremental:no /pdb:&quot;$(OUTDIR)\mapitest.pdb&quot; /machine:I386 /out:&quot;$(OUTDIR)\mapitest.exe&quot; </span>
<a href="#l34.104"></a><span id="l34.104" class="difflineminus">-LINK32_OBJS= \</span>
<a href="#l34.105"></a><span id="l34.105" class="difflineminus">-	&quot;$(INTDIR)\main.obj&quot; \</span>
<a href="#l34.106"></a><span id="l34.106" class="difflineminus">-	&quot;$(INTDIR)\mapimail.obj&quot; \</span>
<a href="#l34.107"></a><span id="l34.107" class="difflineminus">-	&quot;$(INTDIR)\mapiproc.obj&quot; \</span>
<a href="#l34.108"></a><span id="l34.108" class="difflineminus">-	&quot;$(INTDIR)\readmail.obj&quot; \</span>
<a href="#l34.109"></a><span id="l34.109" class="difflineminus">-	&quot;$(INTDIR)\mtest32.res&quot;</span>
<a href="#l34.110"></a><span id="l34.110" class="difflineminus">-</span>
<a href="#l34.111"></a><span id="l34.111" class="difflineminus">-&quot;$(OUTDIR)\mapitest.exe&quot; : &quot;$(OUTDIR)&quot; $(DEF_FILE) $(LINK32_OBJS)</span>
<a href="#l34.112"></a><span id="l34.112" class="difflineminus">-    $(LINK32) @&lt;&lt;</span>
<a href="#l34.113"></a><span id="l34.113" class="difflineminus">-  $(LINK32_FLAGS) $(LINK32_OBJS)</span>
<a href="#l34.114"></a><span id="l34.114" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.115"></a><span id="l34.115" class="difflineminus">-</span>
<a href="#l34.116"></a><span id="l34.116" class="difflineminus">-!ELSEIF  &quot;$(CFG)&quot; == &quot;mapitest - Win32 Debug&quot;</span>
<a href="#l34.117"></a><span id="l34.117" class="difflineminus">-</span>
<a href="#l34.118"></a><span id="l34.118" class="difflineminus">-OUTDIR=.\Debug</span>
<a href="#l34.119"></a><span id="l34.119" class="difflineminus">-INTDIR=.\Debug</span>
<a href="#l34.120"></a><span id="l34.120" class="difflineminus">-# Begin Custom Macros</span>
<a href="#l34.121"></a><span id="l34.121" class="difflineminus">-OutDir=.\Debug</span>
<a href="#l34.122"></a><span id="l34.122" class="difflineminus">-# End Custom Macros</span>
<a href="#l34.123"></a><span id="l34.123" class="difflineminus">-</span>
<a href="#l34.124"></a><span id="l34.124" class="difflineminus">-ALL : &quot;$(OUTDIR)\mapitest.exe&quot;</span>
<a href="#l34.125"></a><span id="l34.125" class="difflineminus">-</span>
<a href="#l34.126"></a><span id="l34.126" class="difflineminus">-export :</span>
<a href="#l34.127"></a><span id="l34.127" class="difflineminus">-libs :</span>
<a href="#l34.128"></a><span id="l34.128" class="difflineminus">-install : </span>
<a href="#l34.129"></a><span id="l34.129" class="difflineminus">-</span>
<a href="#l34.130"></a><span id="l34.130" class="difflineminus">-clobber_all : clobber</span>
<a href="#l34.131"></a><span id="l34.131" class="difflineminus">-</span>
<a href="#l34.132"></a><span id="l34.132" class="difflineminus">-clobber :</span>
<a href="#l34.133"></a><span id="l34.133" class="difflineminus">-	-@erase &quot;$(INTDIR)\main.obj&quot;</span>
<a href="#l34.134"></a><span id="l34.134" class="difflineminus">-	-@erase &quot;$(INTDIR)\mapimail.obj&quot;</span>
<a href="#l34.135"></a><span id="l34.135" class="difflineminus">-	-@erase &quot;$(INTDIR)\mapiproc.obj&quot;</span>
<a href="#l34.136"></a><span id="l34.136" class="difflineminus">-	-@erase &quot;$(INTDIR)\mtest32.res&quot;</span>
<a href="#l34.137"></a><span id="l34.137" class="difflineminus">-	-@erase &quot;$(INTDIR)\readmail.obj&quot;</span>
<a href="#l34.138"></a><span id="l34.138" class="difflineminus">-	-@erase &quot;$(INTDIR)\vc60.idb&quot;</span>
<a href="#l34.139"></a><span id="l34.139" class="difflineminus">-	-@erase &quot;$(INTDIR)\vc60.pdb&quot;</span>
<a href="#l34.140"></a><span id="l34.140" class="difflineminus">-	-@erase &quot;$(OUTDIR)\mapitest.exe&quot;</span>
<a href="#l34.141"></a><span id="l34.141" class="difflineminus">-	-@erase &quot;$(OUTDIR)\mapitest.ilk&quot;</span>
<a href="#l34.142"></a><span id="l34.142" class="difflineminus">-	-@erase &quot;$(OUTDIR)\mapitest.pdb&quot;</span>
<a href="#l34.143"></a><span id="l34.143" class="difflineminus">-	-@erase &quot;$(OUTDIR)\mapitest.pch&quot;</span>
<a href="#l34.144"></a><span id="l34.144" class="difflineminus">-</span>
<a href="#l34.145"></a><span id="l34.145" class="difflineminus">-&quot;$(OUTDIR)&quot; :</span>
<a href="#l34.146"></a><span id="l34.146" class="difflineminus">-    if not exist &quot;$(OUTDIR)/$(NULL)&quot; mkdir &quot;$(OUTDIR)&quot;</span>
<a href="#l34.147"></a><span id="l34.147" class="difflineminus">-</span>
<a href="#l34.148"></a><span id="l34.148" class="difflineminus">-CPP=cl.exe</span>
<a href="#l34.149"></a><span id="l34.149" class="difflineminus">-CPP_PROJ=/nologo /MLd /W3 /Gm /GX /ZI /Od /D &quot;WIN32&quot; /D &quot;_DEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /Fp&quot;$(INTDIR)\mapitest.pch&quot; /YX /Fo&quot;$(INTDIR)\\&quot; /Fd&quot;$(INTDIR)\\&quot; /FD /GZ /c </span>
<a href="#l34.150"></a><span id="l34.150" class="difflineminus">-</span>
<a href="#l34.151"></a><span id="l34.151" class="difflineminus">-.c{$(INTDIR)}.obj::</span>
<a href="#l34.152"></a><span id="l34.152" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.153"></a><span id="l34.153" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.154"></a><span id="l34.154" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.155"></a><span id="l34.155" class="difflineminus">-</span>
<a href="#l34.156"></a><span id="l34.156" class="difflineminus">-.cpp{$(INTDIR)}.obj::</span>
<a href="#l34.157"></a><span id="l34.157" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.158"></a><span id="l34.158" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.159"></a><span id="l34.159" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.160"></a><span id="l34.160" class="difflineminus">-</span>
<a href="#l34.161"></a><span id="l34.161" class="difflineminus">-.cxx{$(INTDIR)}.obj::</span>
<a href="#l34.162"></a><span id="l34.162" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.163"></a><span id="l34.163" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.164"></a><span id="l34.164" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.165"></a><span id="l34.165" class="difflineminus">-</span>
<a href="#l34.166"></a><span id="l34.166" class="difflineminus">-.c{$(INTDIR)}.sbr::</span>
<a href="#l34.167"></a><span id="l34.167" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.168"></a><span id="l34.168" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.169"></a><span id="l34.169" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.170"></a><span id="l34.170" class="difflineminus">-</span>
<a href="#l34.171"></a><span id="l34.171" class="difflineminus">-.cpp{$(INTDIR)}.sbr::</span>
<a href="#l34.172"></a><span id="l34.172" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.173"></a><span id="l34.173" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.174"></a><span id="l34.174" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.175"></a><span id="l34.175" class="difflineminus">-</span>
<a href="#l34.176"></a><span id="l34.176" class="difflineminus">-.cxx{$(INTDIR)}.sbr::</span>
<a href="#l34.177"></a><span id="l34.177" class="difflineminus">-   $(CPP) @&lt;&lt;</span>
<a href="#l34.178"></a><span id="l34.178" class="difflineminus">-   $(CPP_PROJ) $&lt; </span>
<a href="#l34.179"></a><span id="l34.179" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.180"></a><span id="l34.180" class="difflineminus">-</span>
<a href="#l34.181"></a><span id="l34.181" class="difflineminus">-MTL=midl.exe</span>
<a href="#l34.182"></a><span id="l34.182" class="difflineminus">-MTL_PROJ=/nologo /D &quot;_DEBUG&quot; /mktyplib203 /win32 </span>
<a href="#l34.183"></a><span id="l34.183" class="difflineminus">-RSC=rc.exe</span>
<a href="#l34.184"></a><span id="l34.184" class="difflineminus">-RSC_PROJ=/l 0x409 /fo&quot;$(INTDIR)\mtest32.res&quot; /d &quot;_DEBUG&quot; </span>
<a href="#l34.185"></a><span id="l34.185" class="difflineminus">-BSC32=bscmake.exe</span>
<a href="#l34.186"></a><span id="l34.186" class="difflineminus">-BSC32_FLAGS=/nologo /o&quot;$(OUTDIR)\mapitest.bsc&quot; </span>
<a href="#l34.187"></a><span id="l34.187" class="difflineminus">-BSC32_SBRS= \</span>
<a href="#l34.188"></a><span id="l34.188" class="difflineminus">-	</span>
<a href="#l34.189"></a><span id="l34.189" class="difflineminus">-LINK32=link.exe</span>
<a href="#l34.190"></a><span id="l34.190" class="difflineminus">-LINK32_FLAGS=kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /subsystem:windows /incremental:yes /pdb:&quot;$(OUTDIR)\mapitest.pdb&quot; /debug /machine:I386 /out:&quot;$(OUTDIR)\mapitest.exe&quot; /pdbtype:sept </span>
<a href="#l34.191"></a><span id="l34.191" class="difflineminus">-LINK32_OBJS= \</span>
<a href="#l34.192"></a><span id="l34.192" class="difflineminus">-	&quot;$(INTDIR)\main.obj&quot; \</span>
<a href="#l34.193"></a><span id="l34.193" class="difflineminus">-	&quot;$(INTDIR)\mapimail.obj&quot; \</span>
<a href="#l34.194"></a><span id="l34.194" class="difflineminus">-	&quot;$(INTDIR)\mapiproc.obj&quot; \</span>
<a href="#l34.195"></a><span id="l34.195" class="difflineminus">-	&quot;$(INTDIR)\readmail.obj&quot; \</span>
<a href="#l34.196"></a><span id="l34.196" class="difflineminus">-	&quot;$(INTDIR)\mtest32.res&quot;</span>
<a href="#l34.197"></a><span id="l34.197" class="difflineminus">-</span>
<a href="#l34.198"></a><span id="l34.198" class="difflineminus">-&quot;$(OUTDIR)\mapitest.exe&quot; : &quot;$(OUTDIR)&quot; $(DEF_FILE) $(LINK32_OBJS)</span>
<a href="#l34.199"></a><span id="l34.199" class="difflineminus">-    $(LINK32) @&lt;&lt;</span>
<a href="#l34.200"></a><span id="l34.200" class="difflineminus">-  $(LINK32_FLAGS) $(LINK32_OBJS)</span>
<a href="#l34.201"></a><span id="l34.201" class="difflineminus">-&lt;&lt;</span>
<a href="#l34.202"></a><span id="l34.202" class="difflineminus">-</span>
<a href="#l34.203"></a><span id="l34.203" class="difflineminus">-!ENDIF </span>
<a href="#l34.204"></a><span id="l34.204" class="difflineminus">-</span>
<a href="#l34.205"></a><span id="l34.205" class="difflineminus">-</span>
<a href="#l34.206"></a><span id="l34.206" class="difflineminus">-!IF &quot;$(NO_EXTERNAL_DEPS)&quot; != &quot;1&quot;</span>
<a href="#l34.207"></a><span id="l34.207" class="difflineminus">-!IF EXISTS(&quot;mapitest.dep&quot;)</span>
<a href="#l34.208"></a><span id="l34.208" class="difflineminus">-!INCLUDE &quot;mapitest.dep&quot;</span>
<a href="#l34.209"></a><span id="l34.209" class="difflineminus">-!ELSE </span>
<a href="#l34.210"></a><span id="l34.210" class="difflineminus">-!MESSAGE Warning: cannot find &quot;mapitest.dep&quot;</span>
<a href="#l34.211"></a><span id="l34.211" class="difflineminus">-!ENDIF </span>
<a href="#l34.212"></a><span id="l34.212" class="difflineminus">-!ENDIF </span>
<a href="#l34.213"></a><span id="l34.213" class="difflineminus">-</span>
<a href="#l34.214"></a><span id="l34.214" class="difflineminus">-</span>
<a href="#l34.215"></a><span id="l34.215" class="difflineminus">-!IF &quot;$(CFG)&quot; == &quot;mapitest - Win32 Release&quot; || &quot;$(CFG)&quot; == &quot;mapitest - Win32 Debug&quot;</span>
<a href="#l34.216"></a><span id="l34.216" class="difflineminus">-SOURCE=.\main.cpp</span>
<a href="#l34.217"></a><span id="l34.217" class="difflineminus">-</span>
<a href="#l34.218"></a><span id="l34.218" class="difflineminus">-&quot;$(INTDIR)\main.obj&quot; : $(SOURCE) &quot;$(INTDIR)&quot;</span>
<a href="#l34.219"></a><span id="l34.219" class="difflineminus">-</span>
<a href="#l34.220"></a><span id="l34.220" class="difflineminus">-</span>
<a href="#l34.221"></a><span id="l34.221" class="difflineminus">-SOURCE=.\mapimail.cpp</span>
<a href="#l34.222"></a><span id="l34.222" class="difflineminus">-</span>
<a href="#l34.223"></a><span id="l34.223" class="difflineminus">-&quot;$(INTDIR)\mapimail.obj&quot; : $(SOURCE) &quot;$(INTDIR)&quot;</span>
<a href="#l34.224"></a><span id="l34.224" class="difflineminus">-</span>
<a href="#l34.225"></a><span id="l34.225" class="difflineminus">-</span>
<a href="#l34.226"></a><span id="l34.226" class="difflineminus">-SOURCE=.\mapiproc.cpp</span>
<a href="#l34.227"></a><span id="l34.227" class="difflineminus">-</span>
<a href="#l34.228"></a><span id="l34.228" class="difflineminus">-&quot;$(INTDIR)\mapiproc.obj&quot; : $(SOURCE) &quot;$(INTDIR)&quot;</span>
<a href="#l34.229"></a><span id="l34.229" class="difflineminus">-</span>
<a href="#l34.230"></a><span id="l34.230" class="difflineminus">-</span>
<a href="#l34.231"></a><span id="l34.231" class="difflineminus">-SOURCE=.\mtest32.rc</span>
<a href="#l34.232"></a><span id="l34.232" class="difflineminus">-</span>
<a href="#l34.233"></a><span id="l34.233" class="difflineminus">-&quot;$(INTDIR)\mtest32.res&quot; : $(SOURCE) &quot;$(INTDIR)&quot;</span>
<a href="#l34.234"></a><span id="l34.234" class="difflineminus">-	$(RSC) $(RSC_PROJ) $(SOURCE)</span>
<a href="#l34.235"></a><span id="l34.235" class="difflineminus">-</span>
<a href="#l34.236"></a><span id="l34.236" class="difflineminus">-</span>
<a href="#l34.237"></a><span id="l34.237" class="difflineminus">-SOURCE=.\readmail.cpp</span>
<a href="#l34.238"></a><span id="l34.238" class="difflineminus">-</span>
<a href="#l34.239"></a><span id="l34.239" class="difflineminus">-&quot;$(INTDIR)\readmail.obj&quot; : $(SOURCE) &quot;$(INTDIR)&quot;</span>
<a href="#l34.240"></a><span id="l34.240" class="difflineminus">-</span>
<a href="#l34.241"></a><span id="l34.241" class="difflineminus">-</span>
<a href="#l34.242"></a><span id="l34.242" class="difflineminus">-</span>
<a href="#l34.243"></a><span id="l34.243" class="difflineminus">-!ENDIF </span>
<a href="#l34.244"></a><span id="l34.244" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1">deleted file mode 100644</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/mapimail.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineplus">+++ /dev/null</span>
<a href="#l35.4"></a><span id="l35.4" class="difflineat">@@ -1,772 +0,0 @@</span>
<a href="#l35.5"></a><span id="l35.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l35.6"></a><span id="l35.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l35.7"></a><span id="l35.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l35.8"></a><span id="l35.8" class="difflineminus">- *</span>
<a href="#l35.9"></a><span id="l35.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l35.10"></a><span id="l35.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l35.11"></a><span id="l35.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">- *</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineminus">- * License.</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineminus">- *</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineminus">- *</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineminus">- *</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineminus">- *</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l35.37"></a><span id="l35.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineminus">- *</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l35.41"></a><span id="l35.41" class="difflineminus">-//</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineminus">-#include &lt;windowsx.h&gt;   </span>
<a href="#l35.44"></a><span id="l35.44" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l35.45"></a><span id="l35.45" class="difflineminus">-#include &lt;mapi.h&gt;         </span>
<a href="#l35.46"></a><span id="l35.46" class="difflineminus">-#include &lt;stdlib.h&gt;</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineminus">-</span>
<a href="#l35.48"></a><span id="l35.48" class="difflineminus">-#include &quot;port.h&quot;</span>
<a href="#l35.49"></a><span id="l35.49" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineminus">-</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineminus">-//</span>
<a href="#l35.52"></a><span id="l35.52" class="difflineminus">-// Variables...</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineminus">-// </span>
<a href="#l35.54"></a><span id="l35.54" class="difflineminus">-extern HINSTANCE   m_hInstMapi;</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineminus">-extern LHANDLE     mapiSession;</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineminus">-</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineminus">-// </span>
<a href="#l35.58"></a><span id="l35.58" class="difflineminus">-// Forward declarations...</span>
<a href="#l35.59"></a><span id="l35.59" class="difflineminus">-//</span>
<a href="#l35.60"></a><span id="l35.60" class="difflineminus">-void          DoMAPIFreeBuffer(HWND hWnd, LPVOID buf, BOOL alert);</span>
<a href="#l35.61"></a><span id="l35.61" class="difflineminus">-extern void   ShowMessage(HWND hWnd, LPSTR msg);</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineminus">-void          DoMAPISendMail(HWND hWnd);</span>
<a href="#l35.63"></a><span id="l35.63" class="difflineminus">-void          DoMAPISendDocuments(HWND hWnd);</span>
<a href="#l35.64"></a><span id="l35.64" class="difflineminus">-void          DoMAPISaveMail(HWND hWnd);</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineminus">-void          DoMAPIAddress(HWND hWnd);</span>
<a href="#l35.66"></a><span id="l35.66" class="difflineminus">-extern void   SetFooter(LPSTR msg);</span>
<a href="#l35.67"></a><span id="l35.67" class="difflineminus">-extern LPSTR  GetMAPIError(LONG errorCode);</span>
<a href="#l35.68"></a><span id="l35.68" class="difflineminus">-</span>
<a href="#l35.69"></a><span id="l35.69" class="difflineminus">-void </span>
<a href="#l35.70"></a><span id="l35.70" class="difflineminus">-ProcessMailCommand(HWND hWnd, int id, HWND hCtl, UINT codeNotify) </span>
<a href="#l35.71"></a><span id="l35.71" class="difflineminus">-{ </span>
<a href="#l35.72"></a><span id="l35.72" class="difflineminus">-  switch (id) </span>
<a href="#l35.73"></a><span id="l35.73" class="difflineminus">-  {</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineminus">-  case IDCANCEL:</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineminus">-    EndDialog(hWnd, 0);</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineminus">-    break;</span>
<a href="#l35.77"></a><span id="l35.77" class="difflineminus">-</span>
<a href="#l35.78"></a><span id="l35.78" class="difflineminus">-  case ID_BUTTON_MAPISENDMAIL:</span>
<a href="#l35.79"></a><span id="l35.79" class="difflineminus">-    DoMAPISendMail(hWnd);</span>
<a href="#l35.80"></a><span id="l35.80" class="difflineminus">-    break;</span>
<a href="#l35.81"></a><span id="l35.81" class="difflineminus">-</span>
<a href="#l35.82"></a><span id="l35.82" class="difflineminus">-  case ID_BUTTON_MAPISENDDOCUMENTS:</span>
<a href="#l35.83"></a><span id="l35.83" class="difflineminus">-    DoMAPISendDocuments(hWnd);</span>
<a href="#l35.84"></a><span id="l35.84" class="difflineminus">-    break;</span>
<a href="#l35.85"></a><span id="l35.85" class="difflineminus">-</span>
<a href="#l35.86"></a><span id="l35.86" class="difflineminus">-  case ID_BUTTON_MAPISAVEMAIL:</span>
<a href="#l35.87"></a><span id="l35.87" class="difflineminus">-    DoMAPISaveMail(hWnd);</span>
<a href="#l35.88"></a><span id="l35.88" class="difflineminus">-    break;</span>
<a href="#l35.89"></a><span id="l35.89" class="difflineminus">-</span>
<a href="#l35.90"></a><span id="l35.90" class="difflineminus">-  case ID_BUTTON_MAPIADDRESS:</span>
<a href="#l35.91"></a><span id="l35.91" class="difflineminus">-    DoMAPIAddress(hWnd);</span>
<a href="#l35.92"></a><span id="l35.92" class="difflineminus">-    break;</span>
<a href="#l35.93"></a><span id="l35.93" class="difflineminus">-</span>
<a href="#l35.94"></a><span id="l35.94" class="difflineminus">-  default:</span>
<a href="#l35.95"></a><span id="l35.95" class="difflineminus">-    break;</span>
<a href="#l35.96"></a><span id="l35.96" class="difflineminus">-  }</span>
<a href="#l35.97"></a><span id="l35.97" class="difflineminus">-}</span>
<a href="#l35.98"></a><span id="l35.98" class="difflineminus">-</span>
<a href="#l35.99"></a><span id="l35.99" class="difflineminus">-BOOL CALLBACK LOADDS </span>
<a href="#l35.100"></a><span id="l35.100" class="difflineminus">-MailDlgProc(HWND hWndMain, UINT wMsg, WPARAM wParam, LPARAM lParam) </span>
<a href="#l35.101"></a><span id="l35.101" class="difflineminus">-{</span>
<a href="#l35.102"></a><span id="l35.102" class="difflineminus">-  switch (wMsg) </span>
<a href="#l35.103"></a><span id="l35.103" class="difflineminus">-  {</span>
<a href="#l35.104"></a><span id="l35.104" class="difflineminus">-  case WM_INITDIALOG: </span>
<a href="#l35.105"></a><span id="l35.105" class="difflineminus">-    break;</span>
<a href="#l35.106"></a><span id="l35.106" class="difflineminus">-</span>
<a href="#l35.107"></a><span id="l35.107" class="difflineminus">-  case WM_COMMAND:</span>
<a href="#l35.108"></a><span id="l35.108" class="difflineminus">-    HANDLE_WM_COMMAND(hWndMain, wParam, lParam, ProcessMailCommand);</span>
<a href="#l35.109"></a><span id="l35.109" class="difflineminus">-    break;</span>
<a href="#l35.110"></a><span id="l35.110" class="difflineminus">-</span>
<a href="#l35.111"></a><span id="l35.111" class="difflineminus">-  default:</span>
<a href="#l35.112"></a><span id="l35.112" class="difflineminus">-    return FALSE;</span>
<a href="#l35.113"></a><span id="l35.113" class="difflineminus">-  }</span>
<a href="#l35.114"></a><span id="l35.114" class="difflineminus">-  </span>
<a href="#l35.115"></a><span id="l35.115" class="difflineminus">-  return TRUE;</span>
<a href="#l35.116"></a><span id="l35.116" class="difflineminus">-}</span>
<a href="#l35.117"></a><span id="l35.117" class="difflineminus">-</span>
<a href="#l35.118"></a><span id="l35.118" class="difflineminus">-static LPSTR lpszDelimChar = &quot;;&quot;;</span>
<a href="#l35.119"></a><span id="l35.119" class="difflineminus">-</span>
<a href="#l35.120"></a><span id="l35.120" class="difflineminus">-void</span>
<a href="#l35.121"></a><span id="l35.121" class="difflineminus">-TackItOn(LPSTR fileBuf, LPSTR nameBuf, LPSTR addOn)</span>
<a href="#l35.122"></a><span id="l35.122" class="difflineminus">-{</span>
<a href="#l35.123"></a><span id="l35.123" class="difflineminus">-  if (addOn[0] != '\0')</span>
<a href="#l35.124"></a><span id="l35.124" class="difflineminus">-  {</span>
<a href="#l35.125"></a><span id="l35.125" class="difflineminus">-    lstrcat(fileBuf, addOn);</span>
<a href="#l35.126"></a><span id="l35.126" class="difflineminus">-    lstrcat(fileBuf, lpszDelimChar);</span>
<a href="#l35.127"></a><span id="l35.127" class="difflineminus">-</span>
<a href="#l35.128"></a><span id="l35.128" class="difflineminus">-    lstrcat(nameBuf, &quot;NAMEOF.FILE&quot;);</span>
<a href="#l35.129"></a><span id="l35.129" class="difflineminus">-    lstrcat(nameBuf, lpszDelimChar);</span>
<a href="#l35.130"></a><span id="l35.130" class="difflineminus">-  }</span>
<a href="#l35.131"></a><span id="l35.131" class="difflineminus">-}</span>
<a href="#l35.132"></a><span id="l35.132" class="difflineminus">-</span>
<a href="#l35.133"></a><span id="l35.133" class="difflineminus">-void</span>
<a href="#l35.134"></a><span id="l35.134" class="difflineminus">-DoMAPISendDocuments(HWND hWnd)</span>
<a href="#l35.135"></a><span id="l35.135" class="difflineminus">-{</span>
<a href="#l35.136"></a><span id="l35.136" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPISendDocuments) (ULONG ulUIParam, </span>
<a href="#l35.137"></a><span id="l35.137" class="difflineminus">-          LPTSTR lpszDelimChar, LPTSTR lpszFullPaths, </span>
<a href="#l35.138"></a><span id="l35.138" class="difflineminus">-          LPTSTR lpszFileNames, ULONG ulReserved);</span>
<a href="#l35.139"></a><span id="l35.139" class="difflineminus">-</span>
<a href="#l35.140"></a><span id="l35.140" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l35.141"></a><span id="l35.141" class="difflineminus">-  (FARPROC&amp;) lpfnMAPISendDocuments = GetProcAddress(m_hInstMapi, &quot;MAPISENDDOCUMENTS&quot;); </span>
<a href="#l35.142"></a><span id="l35.142" class="difflineminus">-#else</span>
<a href="#l35.143"></a><span id="l35.143" class="difflineminus">-  (FARPROC&amp;) lpfnMAPISendDocuments = GetProcAddress(m_hInstMapi, &quot;MAPISendDocuments&quot;); </span>
<a href="#l35.144"></a><span id="l35.144" class="difflineminus">-#endif</span>
<a href="#l35.145"></a><span id="l35.145" class="difflineminus">-  </span>
<a href="#l35.146"></a><span id="l35.146" class="difflineminus">-  if (!lpfnMAPISendDocuments)</span>
<a href="#l35.147"></a><span id="l35.147" class="difflineminus">-  {</span>
<a href="#l35.148"></a><span id="l35.148" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l35.149"></a><span id="l35.149" class="difflineminus">-    return;</span>
<a href="#l35.150"></a><span id="l35.150" class="difflineminus">-  }</span>
<a href="#l35.151"></a><span id="l35.151" class="difflineminus">-</span>
<a href="#l35.152"></a><span id="l35.152" class="difflineminus">-  char  msg[1024];</span>
<a href="#l35.153"></a><span id="l35.153" class="difflineminus">-  char  tempFileName[_MAX_PATH] = &quot;&quot;;</span>
<a href="#l35.154"></a><span id="l35.154" class="difflineminus">-  char  lpszFullPaths[(_MAX_PATH + 1) * 4] = &quot;&quot;;</span>
<a href="#l35.155"></a><span id="l35.155" class="difflineminus">-  char  lpszFileNames[(_MAX_PATH + 1) * 4] = &quot;&quot;;</span>
<a href="#l35.156"></a><span id="l35.156" class="difflineminus">-</span>
<a href="#l35.157"></a><span id="l35.157" class="difflineminus">-  // Now get the names of the files to attach...</span>
<a href="#l35.158"></a><span id="l35.158" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH1, tempFileName, sizeof(tempFileName));</span>
<a href="#l35.159"></a><span id="l35.159" class="difflineminus">-  TackItOn(lpszFullPaths, lpszFileNames, tempFileName); </span>
<a href="#l35.160"></a><span id="l35.160" class="difflineminus">-</span>
<a href="#l35.161"></a><span id="l35.161" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH2, tempFileName, sizeof(tempFileName));</span>
<a href="#l35.162"></a><span id="l35.162" class="difflineminus">-  TackItOn(lpszFullPaths, lpszFileNames, tempFileName); </span>
<a href="#l35.163"></a><span id="l35.163" class="difflineminus">-</span>
<a href="#l35.164"></a><span id="l35.164" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH3, tempFileName, sizeof(tempFileName));</span>
<a href="#l35.165"></a><span id="l35.165" class="difflineminus">-  TackItOn(lpszFullPaths, lpszFileNames, tempFileName); </span>
<a href="#l35.166"></a><span id="l35.166" class="difflineminus">-</span>
<a href="#l35.167"></a><span id="l35.167" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH4, tempFileName, sizeof(tempFileName));</span>
<a href="#l35.168"></a><span id="l35.168" class="difflineminus">-  TackItOn(lpszFullPaths, lpszFileNames, tempFileName); </span>
<a href="#l35.169"></a><span id="l35.169" class="difflineminus">-</span>
<a href="#l35.170"></a><span id="l35.170" class="difflineminus">-  LONG  rc = (*lpfnMAPISendDocuments)</span>
<a href="#l35.171"></a><span id="l35.171" class="difflineminus">-        ( (ULONG) hWnd,        </span>
<a href="#l35.172"></a><span id="l35.172" class="difflineminus">-          lpszDelimChar, </span>
<a href="#l35.173"></a><span id="l35.173" class="difflineminus">-          lpszFullPaths, </span>
<a href="#l35.174"></a><span id="l35.174" class="difflineminus">-          lpszFileNames, </span>
<a href="#l35.175"></a><span id="l35.175" class="difflineminus">-          0);</span>
<a href="#l35.176"></a><span id="l35.176" class="difflineminus">-</span>
<a href="#l35.177"></a><span id="l35.177" class="difflineminus">-  if (rc == SUCCESS_SUCCESS)</span>
<a href="#l35.178"></a><span id="l35.178" class="difflineminus">-  {</span>
<a href="#l35.179"></a><span id="l35.179" class="difflineminus">-    ShowMessage(hWnd, &quot;Success with MAPISendDocuments&quot;);</span>
<a href="#l35.180"></a><span id="l35.180" class="difflineminus">-    SetFooter(&quot;MAPISendDocuments success&quot;);</span>
<a href="#l35.181"></a><span id="l35.181" class="difflineminus">-  }</span>
<a href="#l35.182"></a><span id="l35.182" class="difflineminus">-  else</span>
<a href="#l35.183"></a><span id="l35.183" class="difflineminus">-  {</span>
<a href="#l35.184"></a><span id="l35.184" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %d from MAPISendDocuments\nError=[%s]&quot;, </span>
<a href="#l35.185"></a><span id="l35.185" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l35.186"></a><span id="l35.186" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l35.187"></a><span id="l35.187" class="difflineminus">-    SetFooter(&quot;MAPISendDocuments failed&quot;);</span>
<a href="#l35.188"></a><span id="l35.188" class="difflineminus">-  }</span>
<a href="#l35.189"></a><span id="l35.189" class="difflineminus">-}</span>
<a href="#l35.190"></a><span id="l35.190" class="difflineminus">-</span>
<a href="#l35.191"></a><span id="l35.191" class="difflineminus">-void</span>
<a href="#l35.192"></a><span id="l35.192" class="difflineminus">-FreeMAPIFile(lpMapiFileDesc pv)</span>
<a href="#l35.193"></a><span id="l35.193" class="difflineminus">-{</span>
<a href="#l35.194"></a><span id="l35.194" class="difflineminus">-  if (!pv)</span>
<a href="#l35.195"></a><span id="l35.195" class="difflineminus">-    return;</span>
<a href="#l35.196"></a><span id="l35.196" class="difflineminus">-</span>
<a href="#l35.197"></a><span id="l35.197" class="difflineminus">-  if (pv-&gt;lpszPathName != NULL)   </span>
<a href="#l35.198"></a><span id="l35.198" class="difflineminus">-    free(pv-&gt;lpszPathName);</span>
<a href="#l35.199"></a><span id="l35.199" class="difflineminus">-</span>
<a href="#l35.200"></a><span id="l35.200" class="difflineminus">-  if (pv-&gt;lpszFileName != NULL)   </span>
<a href="#l35.201"></a><span id="l35.201" class="difflineminus">-    free(pv-&gt;lpszFileName);</span>
<a href="#l35.202"></a><span id="l35.202" class="difflineminus">-}</span>
<a href="#l35.203"></a><span id="l35.203" class="difflineminus">-</span>
<a href="#l35.204"></a><span id="l35.204" class="difflineminus">-void</span>
<a href="#l35.205"></a><span id="l35.205" class="difflineminus">-FreeMAPIRecipient(lpMapiRecipDesc pv)</span>
<a href="#l35.206"></a><span id="l35.206" class="difflineminus">-{</span>
<a href="#l35.207"></a><span id="l35.207" class="difflineminus">-  if (!pv)</span>
<a href="#l35.208"></a><span id="l35.208" class="difflineminus">-    return;</span>
<a href="#l35.209"></a><span id="l35.209" class="difflineminus">-</span>
<a href="#l35.210"></a><span id="l35.210" class="difflineminus">-  if (pv-&gt;lpszName != NULL)   </span>
<a href="#l35.211"></a><span id="l35.211" class="difflineminus">-    free(pv-&gt;lpszName);</span>
<a href="#l35.212"></a><span id="l35.212" class="difflineminus">-</span>
<a href="#l35.213"></a><span id="l35.213" class="difflineminus">-  if (pv-&gt;lpszAddress != NULL)</span>
<a href="#l35.214"></a><span id="l35.214" class="difflineminus">-    free(pv-&gt;lpszAddress);</span>
<a href="#l35.215"></a><span id="l35.215" class="difflineminus">-</span>
<a href="#l35.216"></a><span id="l35.216" class="difflineminus">-  if (pv-&gt;lpEntryID != NULL)</span>
<a href="#l35.217"></a><span id="l35.217" class="difflineminus">-    free(pv-&gt;lpEntryID);  </span>
<a href="#l35.218"></a><span id="l35.218" class="difflineminus">-}</span>
<a href="#l35.219"></a><span id="l35.219" class="difflineminus">-</span>
<a href="#l35.220"></a><span id="l35.220" class="difflineminus">-void</span>
<a href="#l35.221"></a><span id="l35.221" class="difflineminus">-FreeMAPIMessage(lpMapiMessage pv)</span>
<a href="#l35.222"></a><span id="l35.222" class="difflineminus">-{</span>
<a href="#l35.223"></a><span id="l35.223" class="difflineminus">-  ULONG i;</span>
<a href="#l35.224"></a><span id="l35.224" class="difflineminus">-</span>
<a href="#l35.225"></a><span id="l35.225" class="difflineminus">-  if (!pv)</span>
<a href="#l35.226"></a><span id="l35.226" class="difflineminus">-    return;</span>
<a href="#l35.227"></a><span id="l35.227" class="difflineminus">-</span>
<a href="#l35.228"></a><span id="l35.228" class="difflineminus">-  if (pv-&gt;lpszSubject != NULL)</span>
<a href="#l35.229"></a><span id="l35.229" class="difflineminus">-    free(pv-&gt;lpszSubject);</span>
<a href="#l35.230"></a><span id="l35.230" class="difflineminus">-</span>
<a href="#l35.231"></a><span id="l35.231" class="difflineminus">-  if (pv-&gt;lpszNoteText)</span>
<a href="#l35.232"></a><span id="l35.232" class="difflineminus">-      free(pv-&gt;lpszNoteText);</span>
<a href="#l35.233"></a><span id="l35.233" class="difflineminus">-  </span>
<a href="#l35.234"></a><span id="l35.234" class="difflineminus">-  if (pv-&gt;lpszMessageType)</span>
<a href="#l35.235"></a><span id="l35.235" class="difflineminus">-    free(pv-&gt;lpszMessageType);</span>
<a href="#l35.236"></a><span id="l35.236" class="difflineminus">-  </span>
<a href="#l35.237"></a><span id="l35.237" class="difflineminus">-  if (pv-&gt;lpszDateReceived)</span>
<a href="#l35.238"></a><span id="l35.238" class="difflineminus">-    free(pv-&gt;lpszDateReceived);</span>
<a href="#l35.239"></a><span id="l35.239" class="difflineminus">-  </span>
<a href="#l35.240"></a><span id="l35.240" class="difflineminus">-  if (pv-&gt;lpszConversationID)</span>
<a href="#l35.241"></a><span id="l35.241" class="difflineminus">-    free(pv-&gt;lpszConversationID);</span>
<a href="#l35.242"></a><span id="l35.242" class="difflineminus">-  </span>
<a href="#l35.243"></a><span id="l35.243" class="difflineminus">-  if (pv-&gt;lpOriginator)</span>
<a href="#l35.244"></a><span id="l35.244" class="difflineminus">-    FreeMAPIRecipient(pv-&gt;lpOriginator);</span>
<a href="#l35.245"></a><span id="l35.245" class="difflineminus">-  </span>
<a href="#l35.246"></a><span id="l35.246" class="difflineminus">-  for (i=0; i&lt;pv-&gt;nRecipCount; i++)</span>
<a href="#l35.247"></a><span id="l35.247" class="difflineminus">-  {</span>
<a href="#l35.248"></a><span id="l35.248" class="difflineminus">-    if (&amp;(pv-&gt;lpRecips[i]) != NULL)</span>
<a href="#l35.249"></a><span id="l35.249" class="difflineminus">-    {</span>
<a href="#l35.250"></a><span id="l35.250" class="difflineminus">-      FreeMAPIRecipient(&amp;(pv-&gt;lpRecips[i]));</span>
<a href="#l35.251"></a><span id="l35.251" class="difflineminus">-    }</span>
<a href="#l35.252"></a><span id="l35.252" class="difflineminus">-  }</span>
<a href="#l35.253"></a><span id="l35.253" class="difflineminus">-</span>
<a href="#l35.254"></a><span id="l35.254" class="difflineminus">-  if (pv-&gt;lpRecips != NULL)</span>
<a href="#l35.255"></a><span id="l35.255" class="difflineminus">-  {</span>
<a href="#l35.256"></a><span id="l35.256" class="difflineminus">-    free(pv-&gt;lpRecips);</span>
<a href="#l35.257"></a><span id="l35.257" class="difflineminus">-  }</span>
<a href="#l35.258"></a><span id="l35.258" class="difflineminus">-</span>
<a href="#l35.259"></a><span id="l35.259" class="difflineminus">-  for (i=0; i&lt;pv-&gt;nFileCount; i++)</span>
<a href="#l35.260"></a><span id="l35.260" class="difflineminus">-  {</span>
<a href="#l35.261"></a><span id="l35.261" class="difflineminus">-    if (&amp;(pv-&gt;lpFiles[i]) != NULL)</span>
<a href="#l35.262"></a><span id="l35.262" class="difflineminus">-    {</span>
<a href="#l35.263"></a><span id="l35.263" class="difflineminus">-      FreeMAPIFile(&amp;(pv-&gt;lpFiles[i]));</span>
<a href="#l35.264"></a><span id="l35.264" class="difflineminus">-    }</span>
<a href="#l35.265"></a><span id="l35.265" class="difflineminus">-  }</span>
<a href="#l35.266"></a><span id="l35.266" class="difflineminus">-</span>
<a href="#l35.267"></a><span id="l35.267" class="difflineminus">-  if (pv-&gt;lpFiles != NULL)</span>
<a href="#l35.268"></a><span id="l35.268" class="difflineminus">-  {</span>
<a href="#l35.269"></a><span id="l35.269" class="difflineminus">-    free(pv-&gt;lpFiles);</span>
<a href="#l35.270"></a><span id="l35.270" class="difflineminus">-  }</span>
<a href="#l35.271"></a><span id="l35.271" class="difflineminus">-  </span>
<a href="#l35.272"></a><span id="l35.272" class="difflineminus">-  free(pv);</span>
<a href="#l35.273"></a><span id="l35.273" class="difflineminus">-  pv = NULL;</span>
<a href="#l35.274"></a><span id="l35.274" class="difflineminus">-}</span>
<a href="#l35.275"></a><span id="l35.275" class="difflineminus">-</span>
<a href="#l35.276"></a><span id="l35.276" class="difflineminus">-void</span>
<a href="#l35.277"></a><span id="l35.277" class="difflineminus">-DoMAPISendMail(HWND hWnd)</span>
<a href="#l35.278"></a><span id="l35.278" class="difflineminus">-{</span>
<a href="#l35.279"></a><span id="l35.279" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPISendMail) (LHANDLE lhSession, ULONG ulUIParam, </span>
<a href="#l35.280"></a><span id="l35.280" class="difflineminus">-                  lpMapiMessage lpMessage, FLAGS flFlags, ULONG ulReserved);</span>
<a href="#l35.281"></a><span id="l35.281" class="difflineminus">-</span>
<a href="#l35.282"></a><span id="l35.282" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l35.283"></a><span id="l35.283" class="difflineminus">-  (FARPROC&amp;) lpfnMAPISendMail = GetProcAddress(m_hInstMapi, &quot;MAPISENDMAIL&quot;); </span>
<a href="#l35.284"></a><span id="l35.284" class="difflineminus">-#else</span>
<a href="#l35.285"></a><span id="l35.285" class="difflineminus">-  (FARPROC&amp;) lpfnMAPISendMail = GetProcAddress(m_hInstMapi, &quot;MAPISendMail&quot;); </span>
<a href="#l35.286"></a><span id="l35.286" class="difflineminus">-#endif</span>
<a href="#l35.287"></a><span id="l35.287" class="difflineminus">-  </span>
<a href="#l35.288"></a><span id="l35.288" class="difflineminus">-  if (!lpfnMAPISendMail)</span>
<a href="#l35.289"></a><span id="l35.289" class="difflineminus">-  {</span>
<a href="#l35.290"></a><span id="l35.290" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l35.291"></a><span id="l35.291" class="difflineminus">-    return;</span>
<a href="#l35.292"></a><span id="l35.292" class="difflineminus">-  }          </span>
<a href="#l35.293"></a><span id="l35.293" class="difflineminus">-</span>
<a href="#l35.294"></a><span id="l35.294" class="difflineminus">-  FLAGS   flFlags = 0;</span>
<a href="#l35.295"></a><span id="l35.295" class="difflineminus">-  char    msg[512];</span>
<a href="#l35.296"></a><span id="l35.296" class="difflineminus">-  char    file1[_MAX_PATH] = &quot;&quot;;</span>
<a href="#l35.297"></a><span id="l35.297" class="difflineminus">-  char    file2[_MAX_PATH] = &quot;&quot;;</span>
<a href="#l35.298"></a><span id="l35.298" class="difflineminus">-  char    file3[_MAX_PATH] = &quot;&quot;;</span>
<a href="#l35.299"></a><span id="l35.299" class="difflineminus">-  char    file4[_MAX_PATH] = &quot;&quot;;</span>
<a href="#l35.300"></a><span id="l35.300" class="difflineminus">-  char    toAddr[128];</span>
<a href="#l35.301"></a><span id="l35.301" class="difflineminus">-  char    ccAddr[128];</span>
<a href="#l35.302"></a><span id="l35.302" class="difflineminus">-  char    bccAddr[128];</span>
<a href="#l35.303"></a><span id="l35.303" class="difflineminus">-  char    subject[128];</span>
<a href="#l35.304"></a><span id="l35.304" class="difflineminus">-  char    noteText[4096];</span>
<a href="#l35.305"></a><span id="l35.305" class="difflineminus">-  char    dateReceived[128] = &quot;N/A&quot;;</span>
<a href="#l35.306"></a><span id="l35.306" class="difflineminus">-  char    threadID[128] = &quot;N/A&quot;;</span>
<a href="#l35.307"></a><span id="l35.307" class="difflineminus">-  char    origName[128] = &quot;N/A&quot;;</span>
<a href="#l35.308"></a><span id="l35.308" class="difflineminus">-  char    origAddress[128] = &quot;N/A&quot;;</span>
<a href="#l35.309"></a><span id="l35.309" class="difflineminus">-</span>
<a href="#l35.310"></a><span id="l35.310" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_TOADDRESS, toAddr, sizeof(toAddr));</span>
<a href="#l35.311"></a><span id="l35.311" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_CCADDRESS, ccAddr, sizeof(ccAddr));</span>
<a href="#l35.312"></a><span id="l35.312" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_BCCADDRESS, bccAddr, sizeof(bccAddr));</span>
<a href="#l35.313"></a><span id="l35.313" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_SUBJECT, subject, sizeof(subject));</span>
<a href="#l35.314"></a><span id="l35.314" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_NOTETEXT, noteText, sizeof(noteText));</span>
<a href="#l35.315"></a><span id="l35.315" class="difflineminus">-</span>
<a href="#l35.316"></a><span id="l35.316" class="difflineminus">-  // Do the one flag we support for this call...</span>
<a href="#l35.317"></a><span id="l35.317" class="difflineminus">-  if (BST_CHECKED == Button_GetCheck(GetDlgItem(hWnd, ID_CHECK_SHOWDIALOG)))</span>
<a href="#l35.318"></a><span id="l35.318" class="difflineminus">-  {</span>
<a href="#l35.319"></a><span id="l35.319" class="difflineminus">-    flFlags |= MAPI_DIALOG;</span>
<a href="#l35.320"></a><span id="l35.320" class="difflineminus">-  }</span>
<a href="#l35.321"></a><span id="l35.321" class="difflineminus">-</span>
<a href="#l35.322"></a><span id="l35.322" class="difflineminus">-  // Build the message to send off...</span>
<a href="#l35.323"></a><span id="l35.323" class="difflineminus">-  lpMapiMessage  msgPtr = (MapiMessage *)malloc(sizeof(MapiMessage));</span>
<a href="#l35.324"></a><span id="l35.324" class="difflineminus">-  if (msgPtr == NULL)</span>
<a href="#l35.325"></a><span id="l35.325" class="difflineminus">-  {</span>
<a href="#l35.326"></a><span id="l35.326" class="difflineminus">-    return;</span>
<a href="#l35.327"></a><span id="l35.327" class="difflineminus">-  }</span>
<a href="#l35.328"></a><span id="l35.328" class="difflineminus">-  </span>
<a href="#l35.329"></a><span id="l35.329" class="difflineminus">-  memset(msgPtr, 0, sizeof(MapiMessage)); </span>
<a href="#l35.330"></a><span id="l35.330" class="difflineminus">-</span>
<a href="#l35.331"></a><span id="l35.331" class="difflineminus">-  //</span>
<a href="#l35.332"></a><span id="l35.332" class="difflineminus">-  // At this point, we need to populate the structure of information</span>
<a href="#l35.333"></a><span id="l35.333" class="difflineminus">-  // we are passing in via the *lppMessage</span>
<a href="#l35.334"></a><span id="l35.334" class="difflineminus">-  //</span>
<a href="#l35.335"></a><span id="l35.335" class="difflineminus">-</span>
<a href="#l35.336"></a><span id="l35.336" class="difflineminus">-  // Set all of the general information first!</span>
<a href="#l35.337"></a><span id="l35.337" class="difflineminus">-  msgPtr-&gt;lpszSubject = strdup(subject);</span>
<a href="#l35.338"></a><span id="l35.338" class="difflineminus">-  msgPtr-&gt;lpszNoteText = strdup(noteText);</span>
<a href="#l35.339"></a><span id="l35.339" class="difflineminus">-  msgPtr-&gt;lpszDateReceived = strdup(dateReceived);</span>
<a href="#l35.340"></a><span id="l35.340" class="difflineminus">-  msgPtr-&gt;lpszConversationID = strdup(threadID);</span>
<a href="#l35.341"></a><span id="l35.341" class="difflineminus">-  msgPtr-&gt;flFlags = flFlags;</span>
<a href="#l35.342"></a><span id="l35.342" class="difflineminus">-</span>
<a href="#l35.343"></a><span id="l35.343" class="difflineminus">-  // Now deal with the recipients of this message</span>
<a href="#l35.344"></a><span id="l35.344" class="difflineminus">-  DWORD       realRecips = 0;</span>
<a href="#l35.345"></a><span id="l35.345" class="difflineminus">-  if (toAddr[0] != '\0')    ++realRecips;</span>
<a href="#l35.346"></a><span id="l35.346" class="difflineminus">-  if (ccAddr[0] != '\0')    ++realRecips;</span>
<a href="#l35.347"></a><span id="l35.347" class="difflineminus">-  if (bccAddr[0] != '\0')   ++realRecips;</span>
<a href="#l35.348"></a><span id="l35.348" class="difflineminus">-</span>
<a href="#l35.349"></a><span id="l35.349" class="difflineminus">-  msgPtr-&gt;lpRecips = (lpMapiRecipDesc) malloc((size_t) (sizeof(MapiRecipDesc) * realRecips));</span>
<a href="#l35.350"></a><span id="l35.350" class="difflineminus">-  if (!msgPtr-&gt;lpRecips)</span>
<a href="#l35.351"></a><span id="l35.351" class="difflineminus">-  {</span>
<a href="#l35.352"></a><span id="l35.352" class="difflineminus">-    FreeMAPIMessage(msgPtr);</span>
<a href="#l35.353"></a><span id="l35.353" class="difflineminus">-    return;</span>
<a href="#l35.354"></a><span id="l35.354" class="difflineminus">-  }</span>
<a href="#l35.355"></a><span id="l35.355" class="difflineminus">-</span>
<a href="#l35.356"></a><span id="l35.356" class="difflineminus">-  msgPtr-&gt;nRecipCount = realRecips;</span>
<a href="#l35.357"></a><span id="l35.357" class="difflineminus">-  memset(msgPtr-&gt;lpRecips, 0, (size_t) (sizeof(MapiRecipDesc) * msgPtr-&gt;nRecipCount));</span>
<a href="#l35.358"></a><span id="l35.358" class="difflineminus">-</span>
<a href="#l35.359"></a><span id="l35.359" class="difflineminus">-  DWORD       rCount = 0;</span>
<a href="#l35.360"></a><span id="l35.360" class="difflineminus">-  if (toAddr[0] != '\0')</span>
<a href="#l35.361"></a><span id="l35.361" class="difflineminus">-  {</span>
<a href="#l35.362"></a><span id="l35.362" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszName = strdup(toAddr);</span>
<a href="#l35.363"></a><span id="l35.363" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszAddress = strdup(toAddr);</span>
<a href="#l35.364"></a><span id="l35.364" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].ulRecipClass = MAPI_TO;</span>
<a href="#l35.365"></a><span id="l35.365" class="difflineminus">-    rCount++;</span>
<a href="#l35.366"></a><span id="l35.366" class="difflineminus">-  }</span>
<a href="#l35.367"></a><span id="l35.367" class="difflineminus">-</span>
<a href="#l35.368"></a><span id="l35.368" class="difflineminus">-  if (ccAddr[0] != '\0')</span>
<a href="#l35.369"></a><span id="l35.369" class="difflineminus">-  {</span>
<a href="#l35.370"></a><span id="l35.370" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszName = strdup(ccAddr);</span>
<a href="#l35.371"></a><span id="l35.371" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszAddress = strdup(ccAddr);</span>
<a href="#l35.372"></a><span id="l35.372" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].ulRecipClass = MAPI_CC;    </span>
<a href="#l35.373"></a><span id="l35.373" class="difflineminus">-    rCount++;</span>
<a href="#l35.374"></a><span id="l35.374" class="difflineminus">-  }</span>
<a href="#l35.375"></a><span id="l35.375" class="difflineminus">-</span>
<a href="#l35.376"></a><span id="l35.376" class="difflineminus">-  if (bccAddr[0] != '\0')</span>
<a href="#l35.377"></a><span id="l35.377" class="difflineminus">-  {</span>
<a href="#l35.378"></a><span id="l35.378" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszName = strdup(bccAddr);</span>
<a href="#l35.379"></a><span id="l35.379" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszAddress = strdup(bccAddr);</span>
<a href="#l35.380"></a><span id="l35.380" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].ulRecipClass = MAPI_BCC;</span>
<a href="#l35.381"></a><span id="l35.381" class="difflineminus">-    rCount++;</span>
<a href="#l35.382"></a><span id="l35.382" class="difflineminus">-  }</span>
<a href="#l35.383"></a><span id="l35.383" class="difflineminus">-</span>
<a href="#l35.384"></a><span id="l35.384" class="difflineminus">-  // Now get the names of the files to attach...</span>
<a href="#l35.385"></a><span id="l35.385" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH1, file1, sizeof(file1));</span>
<a href="#l35.386"></a><span id="l35.386" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH2, file2, sizeof(file2));</span>
<a href="#l35.387"></a><span id="l35.387" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH3, file3, sizeof(file3));</span>
<a href="#l35.388"></a><span id="l35.388" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH4, file4, sizeof(file4));</span>
<a href="#l35.389"></a><span id="l35.389" class="difflineminus">-</span>
<a href="#l35.390"></a><span id="l35.390" class="difflineminus">-  DWORD       realFiles = 0;</span>
<a href="#l35.391"></a><span id="l35.391" class="difflineminus">-  if (file1[0] != '\0')    ++realFiles;</span>
<a href="#l35.392"></a><span id="l35.392" class="difflineminus">-  if (file2[0] != '\0')    ++realFiles;</span>
<a href="#l35.393"></a><span id="l35.393" class="difflineminus">-  if (file3[0] != '\0')    ++realFiles;</span>
<a href="#l35.394"></a><span id="l35.394" class="difflineminus">-  if (file4[0] != '\0')    ++realFiles;</span>
<a href="#l35.395"></a><span id="l35.395" class="difflineminus">-</span>
<a href="#l35.396"></a><span id="l35.396" class="difflineminus">-  // Now deal with the list of attachments! Since the nFileCount should be set</span>
<a href="#l35.397"></a><span id="l35.397" class="difflineminus">-  // correctly, this loop will automagically be correct</span>
<a href="#l35.398"></a><span id="l35.398" class="difflineminus">-  //</span>
<a href="#l35.399"></a><span id="l35.399" class="difflineminus">-  msgPtr-&gt;nFileCount = realFiles;</span>
<a href="#l35.400"></a><span id="l35.400" class="difflineminus">-  if (realFiles &gt; 0)</span>
<a href="#l35.401"></a><span id="l35.401" class="difflineminus">-  {</span>
<a href="#l35.402"></a><span id="l35.402" class="difflineminus">-    msgPtr-&gt;lpFiles = (lpMapiFileDesc) malloc((size_t) (sizeof(MapiFileDesc) * realFiles));</span>
<a href="#l35.403"></a><span id="l35.403" class="difflineminus">-    if (!msgPtr-&gt;lpFiles)</span>
<a href="#l35.404"></a><span id="l35.404" class="difflineminus">-    {</span>
<a href="#l35.405"></a><span id="l35.405" class="difflineminus">-      FreeMAPIMessage(msgPtr);</span>
<a href="#l35.406"></a><span id="l35.406" class="difflineminus">-      return;</span>
<a href="#l35.407"></a><span id="l35.407" class="difflineminus">-    }</span>
<a href="#l35.408"></a><span id="l35.408" class="difflineminus">-</span>
<a href="#l35.409"></a><span id="l35.409" class="difflineminus">-    memset(msgPtr-&gt;lpFiles, 0, (size_t) (sizeof(MapiFileDesc) * msgPtr-&gt;nFileCount));</span>
<a href="#l35.410"></a><span id="l35.410" class="difflineminus">-  }</span>
<a href="#l35.411"></a><span id="l35.411" class="difflineminus">-</span>
<a href="#l35.412"></a><span id="l35.412" class="difflineminus">-  rCount = 0;</span>
<a href="#l35.413"></a><span id="l35.413" class="difflineminus">-  if (file1[0] != '\0')</span>
<a href="#l35.414"></a><span id="l35.414" class="difflineminus">-  {</span>
<a href="#l35.415"></a><span id="l35.415" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszPathName = strdup((LPSTR)file1);</span>
<a href="#l35.416"></a><span id="l35.416" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszFileName = strdup((LPSTR)file1);</span>
<a href="#l35.417"></a><span id="l35.417" class="difflineminus">-    ++rCount;</span>
<a href="#l35.418"></a><span id="l35.418" class="difflineminus">-  }</span>
<a href="#l35.419"></a><span id="l35.419" class="difflineminus">-</span>
<a href="#l35.420"></a><span id="l35.420" class="difflineminus">-  if (file2[0] != '\0')</span>
<a href="#l35.421"></a><span id="l35.421" class="difflineminus">-  {</span>
<a href="#l35.422"></a><span id="l35.422" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszPathName = strdup((LPSTR)file2);</span>
<a href="#l35.423"></a><span id="l35.423" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszFileName = strdup((LPSTR)file2);</span>
<a href="#l35.424"></a><span id="l35.424" class="difflineminus">-    ++rCount;</span>
<a href="#l35.425"></a><span id="l35.425" class="difflineminus">-  }</span>
<a href="#l35.426"></a><span id="l35.426" class="difflineminus">-</span>
<a href="#l35.427"></a><span id="l35.427" class="difflineminus">-  if (file3[0] != '\0')</span>
<a href="#l35.428"></a><span id="l35.428" class="difflineminus">-  {</span>
<a href="#l35.429"></a><span id="l35.429" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszPathName = strdup((LPSTR)file3);</span>
<a href="#l35.430"></a><span id="l35.430" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszFileName = strdup((LPSTR)file3);</span>
<a href="#l35.431"></a><span id="l35.431" class="difflineminus">-    ++rCount;</span>
<a href="#l35.432"></a><span id="l35.432" class="difflineminus">-  }</span>
<a href="#l35.433"></a><span id="l35.433" class="difflineminus">-</span>
<a href="#l35.434"></a><span id="l35.434" class="difflineminus">-  if (file4[0] != '\0')</span>
<a href="#l35.435"></a><span id="l35.435" class="difflineminus">-  {</span>
<a href="#l35.436"></a><span id="l35.436" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszPathName = strdup((LPSTR)file4);</span>
<a href="#l35.437"></a><span id="l35.437" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszFileName = strdup((LPSTR)file4);</span>
<a href="#l35.438"></a><span id="l35.438" class="difflineminus">-    ++rCount;</span>
<a href="#l35.439"></a><span id="l35.439" class="difflineminus">-  }</span>
<a href="#l35.440"></a><span id="l35.440" class="difflineminus">-</span>
<a href="#l35.441"></a><span id="l35.441" class="difflineminus">-  // Finally, make the call...</span>
<a href="#l35.442"></a><span id="l35.442" class="difflineminus">-  LONG  rc = (*lpfnMAPISendMail)</span>
<a href="#l35.443"></a><span id="l35.443" class="difflineminus">-           (mapiSession, </span>
<a href="#l35.444"></a><span id="l35.444" class="difflineminus">-           (ULONG) hWnd, </span>
<a href="#l35.445"></a><span id="l35.445" class="difflineminus">-           msgPtr, </span>
<a href="#l35.446"></a><span id="l35.446" class="difflineminus">-           flFlags, </span>
<a href="#l35.447"></a><span id="l35.447" class="difflineminus">-           0);</span>
<a href="#l35.448"></a><span id="l35.448" class="difflineminus">-</span>
<a href="#l35.449"></a><span id="l35.449" class="difflineminus">-  if (rc == SUCCESS_SUCCESS)</span>
<a href="#l35.450"></a><span id="l35.450" class="difflineminus">-  {</span>
<a href="#l35.451"></a><span id="l35.451" class="difflineminus">-    ShowMessage(hWnd, &quot;Success with MAPISendMail&quot;);</span>
<a href="#l35.452"></a><span id="l35.452" class="difflineminus">-    SetFooter(&quot;MAPISendMail success&quot;);</span>
<a href="#l35.453"></a><span id="l35.453" class="difflineminus">-  }</span>
<a href="#l35.454"></a><span id="l35.454" class="difflineminus">-  else</span>
<a href="#l35.455"></a><span id="l35.455" class="difflineminus">-  {</span>
<a href="#l35.456"></a><span id="l35.456" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %d from MAPISendMail\nError=[%s]&quot;, </span>
<a href="#l35.457"></a><span id="l35.457" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l35.458"></a><span id="l35.458" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l35.459"></a><span id="l35.459" class="difflineminus">-    SetFooter(&quot;MAPISendMail failed&quot;);</span>
<a href="#l35.460"></a><span id="l35.460" class="difflineminus">-  }</span>
<a href="#l35.461"></a><span id="l35.461" class="difflineminus">-</span>
<a href="#l35.462"></a><span id="l35.462" class="difflineminus">-  // Now cleanup and move on...</span>
<a href="#l35.463"></a><span id="l35.463" class="difflineminus">-  FreeMAPIMessage(msgPtr);</span>
<a href="#l35.464"></a><span id="l35.464" class="difflineminus">-}</span>
<a href="#l35.465"></a><span id="l35.465" class="difflineminus">-</span>
<a href="#l35.466"></a><span id="l35.466" class="difflineminus">-void</span>
<a href="#l35.467"></a><span id="l35.467" class="difflineminus">-DoMAPISaveMail(HWND hWnd)</span>
<a href="#l35.468"></a><span id="l35.468" class="difflineminus">-{</span>
<a href="#l35.469"></a><span id="l35.469" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPISaveMail) (LHANDLE lhSession, ULONG ulUIParam, </span>
<a href="#l35.470"></a><span id="l35.470" class="difflineminus">-                  lpMapiMessage lpMessage, FLAGS flFlags, ULONG ulReserved,</span>
<a href="#l35.471"></a><span id="l35.471" class="difflineminus">-                  LPTSTR lpszMessageID);</span>
<a href="#l35.472"></a><span id="l35.472" class="difflineminus">-</span>
<a href="#l35.473"></a><span id="l35.473" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l35.474"></a><span id="l35.474" class="difflineminus">-  (FARPROC&amp;) lpfnMAPISaveMail = GetProcAddress(m_hInstMapi, &quot;MAPISAVEMAIL&quot;); </span>
<a href="#l35.475"></a><span id="l35.475" class="difflineminus">-#else</span>
<a href="#l35.476"></a><span id="l35.476" class="difflineminus">-  (FARPROC&amp;) lpfnMAPISaveMail = GetProcAddress(m_hInstMapi, &quot;MAPISaveMail&quot;); </span>
<a href="#l35.477"></a><span id="l35.477" class="difflineminus">-#endif</span>
<a href="#l35.478"></a><span id="l35.478" class="difflineminus">-  </span>
<a href="#l35.479"></a><span id="l35.479" class="difflineminus">-  if (!lpfnMAPISaveMail)</span>
<a href="#l35.480"></a><span id="l35.480" class="difflineminus">-  {</span>
<a href="#l35.481"></a><span id="l35.481" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l35.482"></a><span id="l35.482" class="difflineminus">-    return;</span>
<a href="#l35.483"></a><span id="l35.483" class="difflineminus">-  }          </span>
<a href="#l35.484"></a><span id="l35.484" class="difflineminus">-</span>
<a href="#l35.485"></a><span id="l35.485" class="difflineminus">-  FLAGS   flFlags = 0;</span>
<a href="#l35.486"></a><span id="l35.486" class="difflineminus">-  char    msg[512];</span>
<a href="#l35.487"></a><span id="l35.487" class="difflineminus">-  char    file1[_MAX_PATH] = &quot;&quot;;</span>
<a href="#l35.488"></a><span id="l35.488" class="difflineminus">-  char    file2[_MAX_PATH] = &quot;&quot;;</span>
<a href="#l35.489"></a><span id="l35.489" class="difflineminus">-  char    file3[_MAX_PATH] = &quot;&quot;;</span>
<a href="#l35.490"></a><span id="l35.490" class="difflineminus">-  char    file4[_MAX_PATH] = &quot;&quot;;</span>
<a href="#l35.491"></a><span id="l35.491" class="difflineminus">-  char    toAddr[128];</span>
<a href="#l35.492"></a><span id="l35.492" class="difflineminus">-  char    ccAddr[128];</span>
<a href="#l35.493"></a><span id="l35.493" class="difflineminus">-  char    bccAddr[128];</span>
<a href="#l35.494"></a><span id="l35.494" class="difflineminus">-  char    subject[128];</span>
<a href="#l35.495"></a><span id="l35.495" class="difflineminus">-  char    noteText[4096];</span>
<a href="#l35.496"></a><span id="l35.496" class="difflineminus">-  char    dateReceived[128] = &quot;N/A&quot;;</span>
<a href="#l35.497"></a><span id="l35.497" class="difflineminus">-  char    threadID[128] = &quot;N/A&quot;;</span>
<a href="#l35.498"></a><span id="l35.498" class="difflineminus">-  char    origName[128] = &quot;N/A&quot;;</span>
<a href="#l35.499"></a><span id="l35.499" class="difflineminus">-  char    origAddress[128] = &quot;N/A&quot;;</span>
<a href="#l35.500"></a><span id="l35.500" class="difflineminus">-</span>
<a href="#l35.501"></a><span id="l35.501" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_TOADDRESS, toAddr, sizeof(toAddr));</span>
<a href="#l35.502"></a><span id="l35.502" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_CCADDRESS, ccAddr, sizeof(ccAddr));</span>
<a href="#l35.503"></a><span id="l35.503" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_BCCADDRESS, bccAddr, sizeof(bccAddr));</span>
<a href="#l35.504"></a><span id="l35.504" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_SUBJECT, subject, sizeof(subject));</span>
<a href="#l35.505"></a><span id="l35.505" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_NOTETEXT, noteText, sizeof(noteText));</span>
<a href="#l35.506"></a><span id="l35.506" class="difflineminus">-</span>
<a href="#l35.507"></a><span id="l35.507" class="difflineminus">-  // Build the message to send off...</span>
<a href="#l35.508"></a><span id="l35.508" class="difflineminus">-  lpMapiMessage  msgPtr = (MapiMessage *)malloc(sizeof(MapiMessage));</span>
<a href="#l35.509"></a><span id="l35.509" class="difflineminus">-  if (msgPtr == NULL)</span>
<a href="#l35.510"></a><span id="l35.510" class="difflineminus">-  {</span>
<a href="#l35.511"></a><span id="l35.511" class="difflineminus">-    return;</span>
<a href="#l35.512"></a><span id="l35.512" class="difflineminus">-  }</span>
<a href="#l35.513"></a><span id="l35.513" class="difflineminus">-  </span>
<a href="#l35.514"></a><span id="l35.514" class="difflineminus">-  memset(msgPtr, 0, sizeof(MapiMessage)); </span>
<a href="#l35.515"></a><span id="l35.515" class="difflineminus">-</span>
<a href="#l35.516"></a><span id="l35.516" class="difflineminus">-  //</span>
<a href="#l35.517"></a><span id="l35.517" class="difflineminus">-  // At this point, we need to populate the structure of information</span>
<a href="#l35.518"></a><span id="l35.518" class="difflineminus">-  // we are passing in via the *lppMessage</span>
<a href="#l35.519"></a><span id="l35.519" class="difflineminus">-  //</span>
<a href="#l35.520"></a><span id="l35.520" class="difflineminus">-</span>
<a href="#l35.521"></a><span id="l35.521" class="difflineminus">-  // Set all of the general information first!</span>
<a href="#l35.522"></a><span id="l35.522" class="difflineminus">-  msgPtr-&gt;lpszSubject = strdup(subject);</span>
<a href="#l35.523"></a><span id="l35.523" class="difflineminus">-  msgPtr-&gt;lpszNoteText = strdup(noteText);</span>
<a href="#l35.524"></a><span id="l35.524" class="difflineminus">-  msgPtr-&gt;lpszDateReceived = strdup(dateReceived);</span>
<a href="#l35.525"></a><span id="l35.525" class="difflineminus">-  msgPtr-&gt;lpszConversationID = strdup(threadID);</span>
<a href="#l35.526"></a><span id="l35.526" class="difflineminus">-  msgPtr-&gt;flFlags = flFlags;</span>
<a href="#l35.527"></a><span id="l35.527" class="difflineminus">-</span>
<a href="#l35.528"></a><span id="l35.528" class="difflineminus">-  // Now deal with the recipients of this message</span>
<a href="#l35.529"></a><span id="l35.529" class="difflineminus">-  DWORD       realRecips = 0;</span>
<a href="#l35.530"></a><span id="l35.530" class="difflineminus">-  if (toAddr[0] != '\0')    ++realRecips;</span>
<a href="#l35.531"></a><span id="l35.531" class="difflineminus">-  if (ccAddr[0] != '\0')    ++realRecips;</span>
<a href="#l35.532"></a><span id="l35.532" class="difflineminus">-  if (bccAddr[0] != '\0')   ++realRecips;</span>
<a href="#l35.533"></a><span id="l35.533" class="difflineminus">-</span>
<a href="#l35.534"></a><span id="l35.534" class="difflineminus">-  msgPtr-&gt;lpRecips = (lpMapiRecipDesc) malloc((size_t) (sizeof(MapiRecipDesc) * realRecips));</span>
<a href="#l35.535"></a><span id="l35.535" class="difflineminus">-  if (!msgPtr-&gt;lpRecips)</span>
<a href="#l35.536"></a><span id="l35.536" class="difflineminus">-  {</span>
<a href="#l35.537"></a><span id="l35.537" class="difflineminus">-    FreeMAPIMessage(msgPtr);</span>
<a href="#l35.538"></a><span id="l35.538" class="difflineminus">-    return;</span>
<a href="#l35.539"></a><span id="l35.539" class="difflineminus">-  }</span>
<a href="#l35.540"></a><span id="l35.540" class="difflineminus">-</span>
<a href="#l35.541"></a><span id="l35.541" class="difflineminus">-  msgPtr-&gt;nRecipCount = realRecips;</span>
<a href="#l35.542"></a><span id="l35.542" class="difflineminus">-  memset(msgPtr-&gt;lpRecips, 0, (size_t) (sizeof(MapiRecipDesc) * msgPtr-&gt;nRecipCount));</span>
<a href="#l35.543"></a><span id="l35.543" class="difflineminus">-</span>
<a href="#l35.544"></a><span id="l35.544" class="difflineminus">-  DWORD       rCount = 0;</span>
<a href="#l35.545"></a><span id="l35.545" class="difflineminus">-  if (toAddr[0] != '\0')</span>
<a href="#l35.546"></a><span id="l35.546" class="difflineminus">-  {</span>
<a href="#l35.547"></a><span id="l35.547" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszName = strdup(toAddr);</span>
<a href="#l35.548"></a><span id="l35.548" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszAddress = strdup(toAddr);</span>
<a href="#l35.549"></a><span id="l35.549" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].ulRecipClass = MAPI_TO;</span>
<a href="#l35.550"></a><span id="l35.550" class="difflineminus">-    rCount++;</span>
<a href="#l35.551"></a><span id="l35.551" class="difflineminus">-  }</span>
<a href="#l35.552"></a><span id="l35.552" class="difflineminus">-</span>
<a href="#l35.553"></a><span id="l35.553" class="difflineminus">-  if (ccAddr[0] != '\0')</span>
<a href="#l35.554"></a><span id="l35.554" class="difflineminus">-  {</span>
<a href="#l35.555"></a><span id="l35.555" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszName = strdup(ccAddr);</span>
<a href="#l35.556"></a><span id="l35.556" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszAddress = strdup(ccAddr);</span>
<a href="#l35.557"></a><span id="l35.557" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].ulRecipClass = MAPI_CC;    </span>
<a href="#l35.558"></a><span id="l35.558" class="difflineminus">-    rCount++;</span>
<a href="#l35.559"></a><span id="l35.559" class="difflineminus">-  }</span>
<a href="#l35.560"></a><span id="l35.560" class="difflineminus">-</span>
<a href="#l35.561"></a><span id="l35.561" class="difflineminus">-  if (bccAddr[0] != '\0')</span>
<a href="#l35.562"></a><span id="l35.562" class="difflineminus">-  {</span>
<a href="#l35.563"></a><span id="l35.563" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszName = strdup(bccAddr);</span>
<a href="#l35.564"></a><span id="l35.564" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].lpszAddress = strdup(bccAddr);</span>
<a href="#l35.565"></a><span id="l35.565" class="difflineminus">-    msgPtr-&gt;lpRecips[rCount].ulRecipClass = MAPI_BCC;</span>
<a href="#l35.566"></a><span id="l35.566" class="difflineminus">-    rCount++;</span>
<a href="#l35.567"></a><span id="l35.567" class="difflineminus">-  }</span>
<a href="#l35.568"></a><span id="l35.568" class="difflineminus">-</span>
<a href="#l35.569"></a><span id="l35.569" class="difflineminus">-  // Now get the names of the files to attach...</span>
<a href="#l35.570"></a><span id="l35.570" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH1, file1, sizeof(file1));</span>
<a href="#l35.571"></a><span id="l35.571" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH2, file2, sizeof(file2));</span>
<a href="#l35.572"></a><span id="l35.572" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH3, file3, sizeof(file3));</span>
<a href="#l35.573"></a><span id="l35.573" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_ATTACH4, file4, sizeof(file4));</span>
<a href="#l35.574"></a><span id="l35.574" class="difflineminus">-</span>
<a href="#l35.575"></a><span id="l35.575" class="difflineminus">-  DWORD       realFiles = 0;</span>
<a href="#l35.576"></a><span id="l35.576" class="difflineminus">-  if (file1[0] != '\0')    ++realFiles;</span>
<a href="#l35.577"></a><span id="l35.577" class="difflineminus">-  if (file2[0] != '\0')    ++realFiles;</span>
<a href="#l35.578"></a><span id="l35.578" class="difflineminus">-  if (file3[0] != '\0')    ++realFiles;</span>
<a href="#l35.579"></a><span id="l35.579" class="difflineminus">-  if (file4[0] != '\0')    ++realFiles;</span>
<a href="#l35.580"></a><span id="l35.580" class="difflineminus">-</span>
<a href="#l35.581"></a><span id="l35.581" class="difflineminus">-  // Now deal with the list of attachments! Since the nFileCount should be set</span>
<a href="#l35.582"></a><span id="l35.582" class="difflineminus">-  // correctly, this loop will automagically be correct</span>
<a href="#l35.583"></a><span id="l35.583" class="difflineminus">-  //</span>
<a href="#l35.584"></a><span id="l35.584" class="difflineminus">-  msgPtr-&gt;nFileCount = realFiles;</span>
<a href="#l35.585"></a><span id="l35.585" class="difflineminus">-  if (realFiles &gt; 0)</span>
<a href="#l35.586"></a><span id="l35.586" class="difflineminus">-  {</span>
<a href="#l35.587"></a><span id="l35.587" class="difflineminus">-    msgPtr-&gt;lpFiles = (lpMapiFileDesc) malloc((size_t) (sizeof(MapiFileDesc) * realFiles));</span>
<a href="#l35.588"></a><span id="l35.588" class="difflineminus">-    if (!msgPtr-&gt;lpFiles)</span>
<a href="#l35.589"></a><span id="l35.589" class="difflineminus">-    {</span>
<a href="#l35.590"></a><span id="l35.590" class="difflineminus">-      FreeMAPIMessage(msgPtr);</span>
<a href="#l35.591"></a><span id="l35.591" class="difflineminus">-      return;</span>
<a href="#l35.592"></a><span id="l35.592" class="difflineminus">-    }</span>
<a href="#l35.593"></a><span id="l35.593" class="difflineminus">-</span>
<a href="#l35.594"></a><span id="l35.594" class="difflineminus">-    memset(msgPtr-&gt;lpFiles, 0, (size_t) (sizeof(MapiFileDesc) * msgPtr-&gt;nFileCount));</span>
<a href="#l35.595"></a><span id="l35.595" class="difflineminus">-  }</span>
<a href="#l35.596"></a><span id="l35.596" class="difflineminus">-</span>
<a href="#l35.597"></a><span id="l35.597" class="difflineminus">-  rCount = 0;</span>
<a href="#l35.598"></a><span id="l35.598" class="difflineminus">-  if (file1[0] != '\0')</span>
<a href="#l35.599"></a><span id="l35.599" class="difflineminus">-  {</span>
<a href="#l35.600"></a><span id="l35.600" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszPathName = strdup((LPSTR)file1);</span>
<a href="#l35.601"></a><span id="l35.601" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszFileName = strdup((LPSTR)file1);</span>
<a href="#l35.602"></a><span id="l35.602" class="difflineminus">-    ++rCount;</span>
<a href="#l35.603"></a><span id="l35.603" class="difflineminus">-  }</span>
<a href="#l35.604"></a><span id="l35.604" class="difflineminus">-</span>
<a href="#l35.605"></a><span id="l35.605" class="difflineminus">-  if (file2[0] != '\0')</span>
<a href="#l35.606"></a><span id="l35.606" class="difflineminus">-  {</span>
<a href="#l35.607"></a><span id="l35.607" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszPathName = strdup((LPSTR)file2);</span>
<a href="#l35.608"></a><span id="l35.608" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszFileName = strdup((LPSTR)file2);</span>
<a href="#l35.609"></a><span id="l35.609" class="difflineminus">-    ++rCount;</span>
<a href="#l35.610"></a><span id="l35.610" class="difflineminus">-  }</span>
<a href="#l35.611"></a><span id="l35.611" class="difflineminus">-</span>
<a href="#l35.612"></a><span id="l35.612" class="difflineminus">-  if (file3[0] != '\0')</span>
<a href="#l35.613"></a><span id="l35.613" class="difflineminus">-  {</span>
<a href="#l35.614"></a><span id="l35.614" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszPathName = strdup((LPSTR)file3);</span>
<a href="#l35.615"></a><span id="l35.615" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszFileName = strdup((LPSTR)file3);</span>
<a href="#l35.616"></a><span id="l35.616" class="difflineminus">-    ++rCount;</span>
<a href="#l35.617"></a><span id="l35.617" class="difflineminus">-  }</span>
<a href="#l35.618"></a><span id="l35.618" class="difflineminus">-</span>
<a href="#l35.619"></a><span id="l35.619" class="difflineminus">-  if (file4[0] != '\0')</span>
<a href="#l35.620"></a><span id="l35.620" class="difflineminus">-  {</span>
<a href="#l35.621"></a><span id="l35.621" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszPathName = strdup((LPSTR)file4);</span>
<a href="#l35.622"></a><span id="l35.622" class="difflineminus">-    msgPtr-&gt;lpFiles[rCount].lpszFileName = strdup((LPSTR)file4);</span>
<a href="#l35.623"></a><span id="l35.623" class="difflineminus">-    ++rCount;</span>
<a href="#l35.624"></a><span id="l35.624" class="difflineminus">-  }</span>
<a href="#l35.625"></a><span id="l35.625" class="difflineminus">-</span>
<a href="#l35.626"></a><span id="l35.626" class="difflineminus">-  // Finally, make the call...</span>
<a href="#l35.627"></a><span id="l35.627" class="difflineminus">-  LONG  rc = (*lpfnMAPISaveMail)</span>
<a href="#l35.628"></a><span id="l35.628" class="difflineminus">-           (mapiSession, </span>
<a href="#l35.629"></a><span id="l35.629" class="difflineminus">-           (ULONG) hWnd, </span>
<a href="#l35.630"></a><span id="l35.630" class="difflineminus">-           msgPtr, </span>
<a href="#l35.631"></a><span id="l35.631" class="difflineminus">-           flFlags, </span>
<a href="#l35.632"></a><span id="l35.632" class="difflineminus">-           0, NULL);</span>
<a href="#l35.633"></a><span id="l35.633" class="difflineminus">-</span>
<a href="#l35.634"></a><span id="l35.634" class="difflineminus">-  if (rc == SUCCESS_SUCCESS)</span>
<a href="#l35.635"></a><span id="l35.635" class="difflineminus">-  {</span>
<a href="#l35.636"></a><span id="l35.636" class="difflineminus">-    ShowMessage(hWnd, &quot;Success with MAPISaveMail&quot;);</span>
<a href="#l35.637"></a><span id="l35.637" class="difflineminus">-    SetFooter(&quot;MAPISaveMail success&quot;);</span>
<a href="#l35.638"></a><span id="l35.638" class="difflineminus">-  }</span>
<a href="#l35.639"></a><span id="l35.639" class="difflineminus">-  else</span>
<a href="#l35.640"></a><span id="l35.640" class="difflineminus">-  {</span>
<a href="#l35.641"></a><span id="l35.641" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %d from MAPISaveMail\nError=[%s]&quot;, </span>
<a href="#l35.642"></a><span id="l35.642" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l35.643"></a><span id="l35.643" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l35.644"></a><span id="l35.644" class="difflineminus">-    SetFooter(&quot;MAPISaveMail failed&quot;);</span>
<a href="#l35.645"></a><span id="l35.645" class="difflineminus">-  }</span>
<a href="#l35.646"></a><span id="l35.646" class="difflineminus">-</span>
<a href="#l35.647"></a><span id="l35.647" class="difflineminus">-  // Now cleanup and move on...</span>
<a href="#l35.648"></a><span id="l35.648" class="difflineminus">-  FreeMAPIMessage(msgPtr);</span>
<a href="#l35.649"></a><span id="l35.649" class="difflineminus">-}</span>
<a href="#l35.650"></a><span id="l35.650" class="difflineminus">-</span>
<a href="#l35.651"></a><span id="l35.651" class="difflineminus">-void          </span>
<a href="#l35.652"></a><span id="l35.652" class="difflineminus">-DoMAPIAddress(HWND hWnd)</span>
<a href="#l35.653"></a><span id="l35.653" class="difflineminus">-{</span>
<a href="#l35.654"></a><span id="l35.654" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPIAddress) </span>
<a href="#l35.655"></a><span id="l35.655" class="difflineminus">-                            (LHANDLE lhSession,</span>
<a href="#l35.656"></a><span id="l35.656" class="difflineminus">-                            ULONG ulUIParam,</span>
<a href="#l35.657"></a><span id="l35.657" class="difflineminus">-                            LPSTR lpszCaption,</span>
<a href="#l35.658"></a><span id="l35.658" class="difflineminus">-                            ULONG nEditFields,</span>
<a href="#l35.659"></a><span id="l35.659" class="difflineminus">-                            LPSTR lpszLabels,</span>
<a href="#l35.660"></a><span id="l35.660" class="difflineminus">-                            ULONG nRecips,</span>
<a href="#l35.661"></a><span id="l35.661" class="difflineminus">-                            lpMapiRecipDesc lpRecips,</span>
<a href="#l35.662"></a><span id="l35.662" class="difflineminus">-                            FLAGS flFlags,</span>
<a href="#l35.663"></a><span id="l35.663" class="difflineminus">-                            ULONG ulReserved,</span>
<a href="#l35.664"></a><span id="l35.664" class="difflineminus">-                            LPULONG lpnNewRecips,</span>
<a href="#l35.665"></a><span id="l35.665" class="difflineminus">-                            lpMapiRecipDesc FAR *lppNewRecips);</span>
<a href="#l35.666"></a><span id="l35.666" class="difflineminus">-</span>
<a href="#l35.667"></a><span id="l35.667" class="difflineminus">-</span>
<a href="#l35.668"></a><span id="l35.668" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l35.669"></a><span id="l35.669" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIAddress = GetProcAddress(m_hInstMapi, &quot;MAPIADDRESS&quot;); </span>
<a href="#l35.670"></a><span id="l35.670" class="difflineminus">-#else</span>
<a href="#l35.671"></a><span id="l35.671" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIAddress = GetProcAddress(m_hInstMapi, &quot;MAPIAddress&quot;); </span>
<a href="#l35.672"></a><span id="l35.672" class="difflineminus">-#endif</span>
<a href="#l35.673"></a><span id="l35.673" class="difflineminus">-  </span>
<a href="#l35.674"></a><span id="l35.674" class="difflineminus">-  if (!lpfnMAPIAddress)</span>
<a href="#l35.675"></a><span id="l35.675" class="difflineminus">-  {</span>
<a href="#l35.676"></a><span id="l35.676" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l35.677"></a><span id="l35.677" class="difflineminus">-    return;</span>
<a href="#l35.678"></a><span id="l35.678" class="difflineminus">-  }          </span>
<a href="#l35.679"></a><span id="l35.679" class="difflineminus">-</span>
<a href="#l35.680"></a><span id="l35.680" class="difflineminus">-  DWORD   i;</span>
<a href="#l35.681"></a><span id="l35.681" class="difflineminus">-  FLAGS   flFlags = 0;</span>
<a href="#l35.682"></a><span id="l35.682" class="difflineminus">-  DWORD   addrCount = 0;</span>
<a href="#l35.683"></a><span id="l35.683" class="difflineminus">-  char    msg[512];</span>
<a href="#l35.684"></a><span id="l35.684" class="difflineminus">-  char    toAddr[128];</span>
<a href="#l35.685"></a><span id="l35.685" class="difflineminus">-  char    ccAddr[128];</span>
<a href="#l35.686"></a><span id="l35.686" class="difflineminus">-  char    bccAddr[128];</span>
<a href="#l35.687"></a><span id="l35.687" class="difflineminus">-</span>
<a href="#l35.688"></a><span id="l35.688" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_TOADDRESS, toAddr, sizeof(toAddr));</span>
<a href="#l35.689"></a><span id="l35.689" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_CCADDRESS, ccAddr, sizeof(ccAddr));</span>
<a href="#l35.690"></a><span id="l35.690" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_BCCADDRESS, bccAddr, sizeof(bccAddr));</span>
<a href="#l35.691"></a><span id="l35.691" class="difflineminus">-</span>
<a href="#l35.692"></a><span id="l35.692" class="difflineminus">-  if (toAddr[0]) ++addrCount;</span>
<a href="#l35.693"></a><span id="l35.693" class="difflineminus">-  if (ccAddr[0]) ++addrCount;</span>
<a href="#l35.694"></a><span id="l35.694" class="difflineminus">-  if (bccAddr[0]) ++addrCount;</span>
<a href="#l35.695"></a><span id="l35.695" class="difflineminus">-</span>
<a href="#l35.696"></a><span id="l35.696" class="difflineminus">-  lpMapiRecipDesc lpRecips = (lpMapiRecipDesc) malloc((size_t) (sizeof(MapiRecipDesc) * addrCount));</span>
<a href="#l35.697"></a><span id="l35.697" class="difflineminus">-  if (!lpRecips)</span>
<a href="#l35.698"></a><span id="l35.698" class="difflineminus">-  {</span>
<a href="#l35.699"></a><span id="l35.699" class="difflineminus">-    return;</span>
<a href="#l35.700"></a><span id="l35.700" class="difflineminus">-  }</span>
<a href="#l35.701"></a><span id="l35.701" class="difflineminus">-</span>
<a href="#l35.702"></a><span id="l35.702" class="difflineminus">-  memset(lpRecips, 0, (size_t) (sizeof(MapiRecipDesc) * addrCount));</span>
<a href="#l35.703"></a><span id="l35.703" class="difflineminus">-</span>
<a href="#l35.704"></a><span id="l35.704" class="difflineminus">-  DWORD       rCount = 0;</span>
<a href="#l35.705"></a><span id="l35.705" class="difflineminus">-  if (toAddr[0] != '\0')</span>
<a href="#l35.706"></a><span id="l35.706" class="difflineminus">-  {</span>
<a href="#l35.707"></a><span id="l35.707" class="difflineminus">-    lpRecips[rCount].lpszName = strdup(&quot;To Address Name&quot;);</span>
<a href="#l35.708"></a><span id="l35.708" class="difflineminus">-    lpRecips[rCount].lpszAddress = strdup(toAddr);</span>
<a href="#l35.709"></a><span id="l35.709" class="difflineminus">-    lpRecips[rCount].ulRecipClass = MAPI_TO;</span>
<a href="#l35.710"></a><span id="l35.710" class="difflineminus">-    rCount++;</span>
<a href="#l35.711"></a><span id="l35.711" class="difflineminus">-  }</span>
<a href="#l35.712"></a><span id="l35.712" class="difflineminus">-</span>
<a href="#l35.713"></a><span id="l35.713" class="difflineminus">-  if (ccAddr[0] != '\0')</span>
<a href="#l35.714"></a><span id="l35.714" class="difflineminus">-  {</span>
<a href="#l35.715"></a><span id="l35.715" class="difflineminus">-    lpRecips[rCount].lpszName = strdup(&quot;CC Address Name&quot;);</span>
<a href="#l35.716"></a><span id="l35.716" class="difflineminus">-    lpRecips[rCount].lpszAddress = strdup(ccAddr);</span>
<a href="#l35.717"></a><span id="l35.717" class="difflineminus">-    lpRecips[rCount].ulRecipClass = MAPI_CC;    </span>
<a href="#l35.718"></a><span id="l35.718" class="difflineminus">-    rCount++;</span>
<a href="#l35.719"></a><span id="l35.719" class="difflineminus">-  }</span>
<a href="#l35.720"></a><span id="l35.720" class="difflineminus">-</span>
<a href="#l35.721"></a><span id="l35.721" class="difflineminus">-  if (bccAddr[0] != '\0')</span>
<a href="#l35.722"></a><span id="l35.722" class="difflineminus">-  {</span>
<a href="#l35.723"></a><span id="l35.723" class="difflineminus">-    lpRecips[rCount].lpszName = strdup(&quot;BCC Address Name&quot;);</span>
<a href="#l35.724"></a><span id="l35.724" class="difflineminus">-    lpRecips[rCount].lpszAddress = strdup(bccAddr);</span>
<a href="#l35.725"></a><span id="l35.725" class="difflineminus">-    lpRecips[rCount].ulRecipClass = MAPI_BCC;</span>
<a href="#l35.726"></a><span id="l35.726" class="difflineminus">-    rCount++;</span>
<a href="#l35.727"></a><span id="l35.727" class="difflineminus">-  }</span>
<a href="#l35.728"></a><span id="l35.728" class="difflineminus">-  </span>
<a href="#l35.729"></a><span id="l35.729" class="difflineminus">-  ULONG             newRecips;</span>
<a href="#l35.730"></a><span id="l35.730" class="difflineminus">-  lpMapiRecipDesc   lpNewRecips;</span>
<a href="#l35.731"></a><span id="l35.731" class="difflineminus">-</span>
<a href="#l35.732"></a><span id="l35.732" class="difflineminus">-  // Finally, make the call...</span>
<a href="#l35.733"></a><span id="l35.733" class="difflineminus">-  LONG  rc = (*lpfnMAPIAddress)</span>
<a href="#l35.734"></a><span id="l35.734" class="difflineminus">-                     (mapiSession,</span>
<a href="#l35.735"></a><span id="l35.735" class="difflineminus">-                      0,</span>
<a href="#l35.736"></a><span id="l35.736" class="difflineminus">-                      &quot;MAPI Test Address Picker&quot;,</span>
<a href="#l35.737"></a><span id="l35.737" class="difflineminus">-                      0,</span>
<a href="#l35.738"></a><span id="l35.738" class="difflineminus">-                      NULL,</span>
<a href="#l35.739"></a><span id="l35.739" class="difflineminus">-                      rCount,</span>
<a href="#l35.740"></a><span id="l35.740" class="difflineminus">-                      lpRecips,</span>
<a href="#l35.741"></a><span id="l35.741" class="difflineminus">-                      0,</span>
<a href="#l35.742"></a><span id="l35.742" class="difflineminus">-                      0,</span>
<a href="#l35.743"></a><span id="l35.743" class="difflineminus">-                      &amp;newRecips,</span>
<a href="#l35.744"></a><span id="l35.744" class="difflineminus">-                      &amp;lpNewRecips);</span>
<a href="#l35.745"></a><span id="l35.745" class="difflineminus">-  if (rc == SUCCESS_SUCCESS)</span>
<a href="#l35.746"></a><span id="l35.746" class="difflineminus">-  {</span>
<a href="#l35.747"></a><span id="l35.747" class="difflineminus">-    for (i=0; i&lt;newRecips; i++)</span>
<a href="#l35.748"></a><span id="l35.748" class="difflineminus">-    {</span>
<a href="#l35.749"></a><span id="l35.749" class="difflineminus">-      char  tMsg[512];</span>
<a href="#l35.750"></a><span id="l35.750" class="difflineminus">-</span>
<a href="#l35.751"></a><span id="l35.751" class="difflineminus">-      wsprintf(tMsg, &quot;User %d\nName=[%s]\nEmail=[%s]\nType=[%d]&quot;, </span>
<a href="#l35.752"></a><span id="l35.752" class="difflineminus">-            i, </span>
<a href="#l35.753"></a><span id="l35.753" class="difflineminus">-            lpNewRecips[i].lpszName, </span>
<a href="#l35.754"></a><span id="l35.754" class="difflineminus">-            lpNewRecips[i].lpszAddress, </span>
<a href="#l35.755"></a><span id="l35.755" class="difflineminus">-            lpNewRecips[i].ulRecipClass);</span>
<a href="#l35.756"></a><span id="l35.756" class="difflineminus">-      ShowMessage(hWnd, tMsg);</span>
<a href="#l35.757"></a><span id="l35.757" class="difflineminus">-    }</span>
<a href="#l35.758"></a><span id="l35.758" class="difflineminus">-</span>
<a href="#l35.759"></a><span id="l35.759" class="difflineminus">-    SetFooter(&quot;MAPIAddress success&quot;);</span>
<a href="#l35.760"></a><span id="l35.760" class="difflineminus">-</span>
<a href="#l35.761"></a><span id="l35.761" class="difflineminus">-    DoMAPIFreeBuffer(hWnd, lpNewRecips, TRUE);</span>
<a href="#l35.762"></a><span id="l35.762" class="difflineminus">-  }</span>
<a href="#l35.763"></a><span id="l35.763" class="difflineminus">-  else</span>
<a href="#l35.764"></a><span id="l35.764" class="difflineminus">-  {</span>
<a href="#l35.765"></a><span id="l35.765" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %d from MAPIAddress\nError=[%s]&quot;, </span>
<a href="#l35.766"></a><span id="l35.766" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l35.767"></a><span id="l35.767" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l35.768"></a><span id="l35.768" class="difflineminus">-    SetFooter(&quot;MAPIAddress failed&quot;);</span>
<a href="#l35.769"></a><span id="l35.769" class="difflineminus">-  }</span>
<a href="#l35.770"></a><span id="l35.770" class="difflineminus">-</span>
<a href="#l35.771"></a><span id="l35.771" class="difflineminus">-  // Now cleanup and move on...</span>
<a href="#l35.772"></a><span id="l35.772" class="difflineminus">-  for (i=0; i&lt;rCount; i++)</span>
<a href="#l35.773"></a><span id="l35.773" class="difflineminus">-  {</span>
<a href="#l35.774"></a><span id="l35.774" class="difflineminus">-    FreeMAPIRecipient(&amp;(lpRecips[i]));</span>
<a href="#l35.775"></a><span id="l35.775" class="difflineminus">-  }</span>
<a href="#l35.776"></a><span id="l35.776" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1">deleted file mode 100644</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/mapiproc.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineplus">+++ /dev/null</span>
<a href="#l36.4"></a><span id="l36.4" class="difflineat">@@ -1,832 +0,0 @@</span>
<a href="#l36.5"></a><span id="l36.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l36.6"></a><span id="l36.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l36.7"></a><span id="l36.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l36.8"></a><span id="l36.8" class="difflineminus">- *</span>
<a href="#l36.9"></a><span id="l36.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l36.10"></a><span id="l36.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l36.11"></a><span id="l36.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">- *</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineminus">- * License.</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineminus">- *</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l36.20"></a><span id="l36.20" class="difflineminus">- *</span>
<a href="#l36.21"></a><span id="l36.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l36.23"></a><span id="l36.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l36.24"></a><span id="l36.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l36.25"></a><span id="l36.25" class="difflineminus">- *</span>
<a href="#l36.26"></a><span id="l36.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineminus">- *</span>
<a href="#l36.28"></a><span id="l36.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l36.29"></a><span id="l36.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l36.30"></a><span id="l36.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l36.34"></a><span id="l36.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l36.35"></a><span id="l36.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l36.37"></a><span id="l36.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l36.38"></a><span id="l36.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l36.39"></a><span id="l36.39" class="difflineminus">- *</span>
<a href="#l36.40"></a><span id="l36.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l36.41"></a><span id="l36.41" class="difflineminus">-//</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l36.43"></a><span id="l36.43" class="difflineminus">-#include &lt;windowsx.h&gt;      </span>
<a href="#l36.44"></a><span id="l36.44" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineminus">-</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineminus">-#ifndef MAPI_OLE	// Because MSFT doesn't do this for us :-(</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineminus">-#include &lt;mapi.h&gt;</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineminus">-#endif</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineminus">-</span>
<a href="#l36.50"></a><span id="l36.50" class="difflineminus">-#include &quot;port.h&quot;</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l36.52"></a><span id="l36.52" class="difflineminus">-</span>
<a href="#l36.53"></a><span id="l36.53" class="difflineminus">-//</span>
<a href="#l36.54"></a><span id="l36.54" class="difflineminus">-// Variables...</span>
<a href="#l36.55"></a><span id="l36.55" class="difflineminus">-// </span>
<a href="#l36.56"></a><span id="l36.56" class="difflineminus">-extern HINSTANCE  hInst;</span>
<a href="#l36.57"></a><span id="l36.57" class="difflineminus">-HINSTANCE         m_hInstMapi;</span>
<a href="#l36.58"></a><span id="l36.58" class="difflineminus">-LHANDLE           mapiSession = 0;</span>
<a href="#l36.59"></a><span id="l36.59" class="difflineminus">-</span>
<a href="#l36.60"></a><span id="l36.60" class="difflineminus">-// </span>
<a href="#l36.61"></a><span id="l36.61" class="difflineminus">-// Forward declarations...</span>
<a href="#l36.62"></a><span id="l36.62" class="difflineminus">-//</span>
<a href="#l36.63"></a><span id="l36.63" class="difflineminus">-void    LoadNSCPVersionFunc(HWND hWnd);</span>
<a href="#l36.64"></a><span id="l36.64" class="difflineminus">-void    DoMAPILogon(HWND hWnd);</span>
<a href="#l36.65"></a><span id="l36.65" class="difflineminus">-void    DoMAPILogoff(HWND hWnd);</span>
<a href="#l36.66"></a><span id="l36.66" class="difflineminus">-void    DoMAPIFreeBuffer(HWND hWnd, LPVOID buf, BOOL alert);</span>
<a href="#l36.67"></a><span id="l36.67" class="difflineminus">-void    DoMAPISendMail(HWND hWnd);</span>
<a href="#l36.68"></a><span id="l36.68" class="difflineminus">-void    DoMAPISendDocuments(HWND hWnd);</span>
<a href="#l36.69"></a><span id="l36.69" class="difflineminus">-void    DoMAPIFindNext(HWND hWnd);</span>
<a href="#l36.70"></a><span id="l36.70" class="difflineminus">-void    DoMAPIReadMail(HWND hWnd);</span>
<a href="#l36.71"></a><span id="l36.71" class="difflineminus">-void    DoMAPIDeleteMail(HWND hWnd);</span>
<a href="#l36.72"></a><span id="l36.72" class="difflineminus">-void    DoMAPIDetails(HWND hWnd);</span>
<a href="#l36.73"></a><span id="l36.73" class="difflineminus">-void    DoMAPIResolveName(HWND hWnd);</span>
<a href="#l36.74"></a><span id="l36.74" class="difflineminus">-void    DoMAPIResolveNameFreeBuffer(HWND hWnd);</span>
<a href="#l36.75"></a><span id="l36.75" class="difflineminus">-void    SetFooter(LPSTR msg);</span>
<a href="#l36.76"></a><span id="l36.76" class="difflineminus">-void    DoMAPI_NSCP_Sync(HWND hWnd);</span>
<a href="#l36.77"></a><span id="l36.77" class="difflineminus">-LPSTR   GetMAPIError(LONG errorCode);</span>
<a href="#l36.78"></a><span id="l36.78" class="difflineminus">-extern void DisplayMAPIReadMail(HWND hWnd, lpMapiMessage msgPtr);</span>
<a href="#l36.79"></a><span id="l36.79" class="difflineminus">-lpMapiMessage   GetMessage(HWND hWnd, LPSTR id);</span>
<a href="#l36.80"></a><span id="l36.80" class="difflineminus">-</span>
<a href="#l36.81"></a><span id="l36.81" class="difflineminus">-void</span>
<a href="#l36.82"></a><span id="l36.82" class="difflineminus">-SetFooter(LPSTR msg)</span>
<a href="#l36.83"></a><span id="l36.83" class="difflineminus">-{</span>
<a href="#l36.84"></a><span id="l36.84" class="difflineminus">-  extern HWND   hWnd;</span>
<a href="#l36.85"></a><span id="l36.85" class="difflineminus">-</span>
<a href="#l36.86"></a><span id="l36.86" class="difflineminus">-  SetDlgItemText(hWnd, ID_STATIC_RESULT, msg);</span>
<a href="#l36.87"></a><span id="l36.87" class="difflineminus">-}</span>
<a href="#l36.88"></a><span id="l36.88" class="difflineminus">-</span>
<a href="#l36.89"></a><span id="l36.89" class="difflineminus">-char FAR *</span>
<a href="#l36.90"></a><span id="l36.90" class="difflineminus">-GetMAPIError(LONG errorCode)</span>
<a href="#l36.91"></a><span id="l36.91" class="difflineminus">-{</span>
<a href="#l36.92"></a><span id="l36.92" class="difflineminus">-  static char FAR msg[128];</span>
<a href="#l36.93"></a><span id="l36.93" class="difflineminus">-</span>
<a href="#l36.94"></a><span id="l36.94" class="difflineminus">-  switch (errorCode) {                            </span>
<a href="#l36.95"></a><span id="l36.95" class="difflineminus">-  case MAPI_E_FAILURE:</span>
<a href="#l36.96"></a><span id="l36.96" class="difflineminus">-    lstrcpy(msg, &quot;General MAPI Failure&quot;);</span>
<a href="#l36.97"></a><span id="l36.97" class="difflineminus">-    break;</span>
<a href="#l36.98"></a><span id="l36.98" class="difflineminus">-</span>
<a href="#l36.99"></a><span id="l36.99" class="difflineminus">-  case MAPI_E_INSUFFICIENT_MEMORY:</span>
<a href="#l36.100"></a><span id="l36.100" class="difflineminus">-    strcpy(msg, &quot;Insufficient Memory&quot;);</span>
<a href="#l36.101"></a><span id="l36.101" class="difflineminus">-    break;</span>
<a href="#l36.102"></a><span id="l36.102" class="difflineminus">-</span>
<a href="#l36.103"></a><span id="l36.103" class="difflineminus">-  case MAPI_E_LOGIN_FAILURE:</span>
<a href="#l36.104"></a><span id="l36.104" class="difflineminus">-    strcpy(msg, &quot;Login Failure&quot;);</span>
<a href="#l36.105"></a><span id="l36.105" class="difflineminus">-    break;</span>
<a href="#l36.106"></a><span id="l36.106" class="difflineminus">-</span>
<a href="#l36.107"></a><span id="l36.107" class="difflineminus">-  case MAPI_E_TOO_MANY_SESSIONS:</span>
<a href="#l36.108"></a><span id="l36.108" class="difflineminus">-    strcpy(msg, &quot;Too many MAPI sessions&quot;);</span>
<a href="#l36.109"></a><span id="l36.109" class="difflineminus">-    break;</span>
<a href="#l36.110"></a><span id="l36.110" class="difflineminus">-</span>
<a href="#l36.111"></a><span id="l36.111" class="difflineminus">-  case MAPI_E_INVALID_SESSION:</span>
<a href="#l36.112"></a><span id="l36.112" class="difflineminus">-    strcpy(msg, &quot;Invalid Session!&quot;);</span>
<a href="#l36.113"></a><span id="l36.113" class="difflineminus">-    break;</span>
<a href="#l36.114"></a><span id="l36.114" class="difflineminus">-</span>
<a href="#l36.115"></a><span id="l36.115" class="difflineminus">-  case MAPI_E_INVALID_MESSAGE:</span>
<a href="#l36.116"></a><span id="l36.116" class="difflineminus">-    strcpy(msg, &quot;Message identifier was bad!&quot;);</span>
<a href="#l36.117"></a><span id="l36.117" class="difflineminus">-    break;</span>
<a href="#l36.118"></a><span id="l36.118" class="difflineminus">-</span>
<a href="#l36.119"></a><span id="l36.119" class="difflineminus">-  case MAPI_E_NO_MESSAGES:</span>
<a href="#l36.120"></a><span id="l36.120" class="difflineminus">-    strcpy(msg, &quot;No messages were found!&quot;);</span>
<a href="#l36.121"></a><span id="l36.121" class="difflineminus">-    break;</span>
<a href="#l36.122"></a><span id="l36.122" class="difflineminus">-</span>
<a href="#l36.123"></a><span id="l36.123" class="difflineminus">-  case MAPI_E_ATTACHMENT_WRITE_FAILURE:</span>
<a href="#l36.124"></a><span id="l36.124" class="difflineminus">-    strcpy(msg, &quot;Attachment write failure!&quot;);</span>
<a href="#l36.125"></a><span id="l36.125" class="difflineminus">-    break;</span>
<a href="#l36.126"></a><span id="l36.126" class="difflineminus">-</span>
<a href="#l36.127"></a><span id="l36.127" class="difflineminus">-  case MAPI_E_DISK_FULL:</span>
<a href="#l36.128"></a><span id="l36.128" class="difflineminus">-    strcpy(msg, &quot;Attachment write failure! DISK FULL&quot;);</span>
<a href="#l36.129"></a><span id="l36.129" class="difflineminus">-    break;</span>
<a href="#l36.130"></a><span id="l36.130" class="difflineminus">-</span>
<a href="#l36.131"></a><span id="l36.131" class="difflineminus">-  case MAPI_E_AMBIGUOUS_RECIPIENT:</span>
<a href="#l36.132"></a><span id="l36.132" class="difflineminus">-    strcpy(msg, &quot;Recipient requested is not a unique address list entry.&quot;);</span>
<a href="#l36.133"></a><span id="l36.133" class="difflineminus">-    break;</span>
<a href="#l36.134"></a><span id="l36.134" class="difflineminus">-</span>
<a href="#l36.135"></a><span id="l36.135" class="difflineminus">-  case MAPI_E_UNKNOWN_RECIPIENT:</span>
<a href="#l36.136"></a><span id="l36.136" class="difflineminus">-    strcpy(msg, &quot;Recipient requested does not exist.&quot;);</span>
<a href="#l36.137"></a><span id="l36.137" class="difflineminus">-    break;</span>
<a href="#l36.138"></a><span id="l36.138" class="difflineminus">-</span>
<a href="#l36.139"></a><span id="l36.139" class="difflineminus">-  case MAPI_E_NOT_SUPPORTED:</span>
<a href="#l36.140"></a><span id="l36.140" class="difflineminus">-    strcpy(msg, &quot;Not supported by messaging system&quot;);</span>
<a href="#l36.141"></a><span id="l36.141" class="difflineminus">-    break;</span>
<a href="#l36.142"></a><span id="l36.142" class="difflineminus">-</span>
<a href="#l36.143"></a><span id="l36.143" class="difflineminus">-  case SUCCESS_SUCCESS:</span>
<a href="#l36.144"></a><span id="l36.144" class="difflineminus">-    strcpy(msg, &quot;Success on MAPI operation&quot;);</span>
<a href="#l36.145"></a><span id="l36.145" class="difflineminus">-    break;</span>
<a href="#l36.146"></a><span id="l36.146" class="difflineminus">-</span>
<a href="#l36.147"></a><span id="l36.147" class="difflineminus">-  case MAPI_E_INVALID_RECIPS:</span>
<a href="#l36.148"></a><span id="l36.148" class="difflineminus">-    strcpy(msg, &quot;Recipient specified in the lpRecip parameter was\nunknown. No dialog box was displayed.&quot;);</span>
<a href="#l36.149"></a><span id="l36.149" class="difflineminus">-    break;</span>
<a href="#l36.150"></a><span id="l36.150" class="difflineminus">-</span>
<a href="#l36.151"></a><span id="l36.151" class="difflineminus">-  case MAPI_E_ATTACHMENT_OPEN_FAILURE:</span>
<a href="#l36.152"></a><span id="l36.152" class="difflineminus">-    strcpy(msg, &quot;One or more files could not be located. No message was sent.&quot;);    </span>
<a href="#l36.153"></a><span id="l36.153" class="difflineminus">-    break;</span>
<a href="#l36.154"></a><span id="l36.154" class="difflineminus">-</span>
<a href="#l36.155"></a><span id="l36.155" class="difflineminus">-  case MAPI_E_ATTACHMENT_NOT_FOUND:</span>
<a href="#l36.156"></a><span id="l36.156" class="difflineminus">-    strcpy(msg, &quot;The specified attachment was not found. No message was sent.&quot;);</span>
<a href="#l36.157"></a><span id="l36.157" class="difflineminus">-    break;</span>
<a href="#l36.158"></a><span id="l36.158" class="difflineminus">-</span>
<a href="#l36.159"></a><span id="l36.159" class="difflineminus">-  case MAPI_E_BAD_RECIPTYPE:</span>
<a href="#l36.160"></a><span id="l36.160" class="difflineminus">-    strcpy(msg, &quot;The type of a recipient was not MAPI_TO, MAPI_CC, or MAPI_BCC. No message was sent.&quot;);</span>
<a href="#l36.161"></a><span id="l36.161" class="difflineminus">-    break;</span>
<a href="#l36.162"></a><span id="l36.162" class="difflineminus">-</span>
<a href="#l36.163"></a><span id="l36.163" class="difflineminus">-  default:</span>
<a href="#l36.164"></a><span id="l36.164" class="difflineminus">-    strcpy(msg, &quot;Unknown MAPI Return Code&quot;);</span>
<a href="#l36.165"></a><span id="l36.165" class="difflineminus">-    break;</span>
<a href="#l36.166"></a><span id="l36.166" class="difflineminus">-  }</span>
<a href="#l36.167"></a><span id="l36.167" class="difflineminus">-</span>
<a href="#l36.168"></a><span id="l36.168" class="difflineminus">-  return((LPSTR) &amp;(msg[0]));</span>
<a href="#l36.169"></a><span id="l36.169" class="difflineminus">-}</span>
<a href="#l36.170"></a><span id="l36.170" class="difflineminus">-</span>
<a href="#l36.171"></a><span id="l36.171" class="difflineminus">-void</span>
<a href="#l36.172"></a><span id="l36.172" class="difflineminus">-ShowMessage(HWND hWnd, LPSTR msg)</span>
<a href="#l36.173"></a><span id="l36.173" class="difflineminus">-{</span>
<a href="#l36.174"></a><span id="l36.174" class="difflineminus">-  MessageBox(hWnd, msg, &quot;Info Message&quot;, MB_ICONINFORMATION);</span>
<a href="#l36.175"></a><span id="l36.175" class="difflineminus">-}</span>
<a href="#l36.176"></a><span id="l36.176" class="difflineminus">-</span>
<a href="#l36.177"></a><span id="l36.177" class="difflineminus">-BOOL</span>
<a href="#l36.178"></a><span id="l36.178" class="difflineminus">-OpenMAPI(void)</span>
<a href="#l36.179"></a><span id="l36.179" class="difflineminus">-{</span>
<a href="#l36.180"></a><span id="l36.180" class="difflineminus">-#ifdef WIN16</span>
<a href="#l36.181"></a><span id="l36.181" class="difflineminus">-	m_hInstMapi = LoadLibrary(&quot;Y:\\ns\\cmd\\winfe\\mapi\\MAPI.DLL&quot;);	</span>
<a href="#l36.182"></a><span id="l36.182" class="difflineminus">-#else</span>
<a href="#l36.183"></a><span id="l36.183" class="difflineminus">-  m_hInstMapi = LoadLibrary(&quot;..\\..\\..\\..\\mapidll\\mozMAPI32.DLL&quot;);</span>
<a href="#l36.184"></a><span id="l36.184" class="difflineminus">-#endif</span>
<a href="#l36.185"></a><span id="l36.185" class="difflineminus">-</span>
<a href="#l36.186"></a><span id="l36.186" class="difflineminus">-  if (!m_hInstMapi)</span>
<a href="#l36.187"></a><span id="l36.187" class="difflineminus">-  {</span>
<a href="#l36.188"></a><span id="l36.188" class="difflineminus">-    ShowMessage(NULL, &quot;Error Loading the MAPI DLL...Probably not found!&quot;);</span>
<a href="#l36.189"></a><span id="l36.189" class="difflineminus">-    return(FALSE);</span>
<a href="#l36.190"></a><span id="l36.190" class="difflineminus">-  }</span>
<a href="#l36.191"></a><span id="l36.191" class="difflineminus">-</span>
<a href="#l36.192"></a><span id="l36.192" class="difflineminus">-  return(TRUE);</span>
<a href="#l36.193"></a><span id="l36.193" class="difflineminus">-}</span>
<a href="#l36.194"></a><span id="l36.194" class="difflineminus">-</span>
<a href="#l36.195"></a><span id="l36.195" class="difflineminus">-void</span>
<a href="#l36.196"></a><span id="l36.196" class="difflineminus">-CloseMAPI(void)</span>
<a href="#l36.197"></a><span id="l36.197" class="difflineminus">-{</span>
<a href="#l36.198"></a><span id="l36.198" class="difflineminus">-  if(m_hInstMapi)</span>
<a href="#l36.199"></a><span id="l36.199" class="difflineminus">-  {</span>
<a href="#l36.200"></a><span id="l36.200" class="difflineminus">-    FreeLibrary(m_hInstMapi);</span>
<a href="#l36.201"></a><span id="l36.201" class="difflineminus">-  }</span>
<a href="#l36.202"></a><span id="l36.202" class="difflineminus">-}</span>
<a href="#l36.203"></a><span id="l36.203" class="difflineminus">-</span>
<a href="#l36.204"></a><span id="l36.204" class="difflineminus">-void </span>
<a href="#l36.205"></a><span id="l36.205" class="difflineminus">-ProcessCommand(HWND hWnd, int id, HWND hCtl, UINT codeNotify) </span>
<a href="#l36.206"></a><span id="l36.206" class="difflineminus">-{ </span>
<a href="#l36.207"></a><span id="l36.207" class="difflineminus">-  switch (id) </span>
<a href="#l36.208"></a><span id="l36.208" class="difflineminus">-  {</span>
<a href="#l36.209"></a><span id="l36.209" class="difflineminus">-  case ID_BUTTON_SYNC:</span>
<a href="#l36.210"></a><span id="l36.210" class="difflineminus">-    DoMAPI_NSCP_Sync(hWnd);</span>
<a href="#l36.211"></a><span id="l36.211" class="difflineminus">-    break;</span>
<a href="#l36.212"></a><span id="l36.212" class="difflineminus">-</span>
<a href="#l36.213"></a><span id="l36.213" class="difflineminus">-  case ID_BUTTON_NSCPVERSION:</span>
<a href="#l36.214"></a><span id="l36.214" class="difflineminus">-    LoadNSCPVersionFunc(hWnd);</span>
<a href="#l36.215"></a><span id="l36.215" class="difflineminus">-    break;</span>
<a href="#l36.216"></a><span id="l36.216" class="difflineminus">-</span>
<a href="#l36.217"></a><span id="l36.217" class="difflineminus">-  case ID_BUTTON_LOGON:</span>
<a href="#l36.218"></a><span id="l36.218" class="difflineminus">-    DoMAPILogon(hWnd);</span>
<a href="#l36.219"></a><span id="l36.219" class="difflineminus">-    break;</span>
<a href="#l36.220"></a><span id="l36.220" class="difflineminus">-</span>
<a href="#l36.221"></a><span id="l36.221" class="difflineminus">-  case ID_BUTTON_LOGOFF:</span>
<a href="#l36.222"></a><span id="l36.222" class="difflineminus">-    DoMAPILogoff(hWnd);</span>
<a href="#l36.223"></a><span id="l36.223" class="difflineminus">-    break;</span>
<a href="#l36.224"></a><span id="l36.224" class="difflineminus">-</span>
<a href="#l36.225"></a><span id="l36.225" class="difflineminus">-  case ID_BUTTON_FINDNEXT:</span>
<a href="#l36.226"></a><span id="l36.226" class="difflineminus">-  case ID_MENU_MAPIFINDNEXT:</span>
<a href="#l36.227"></a><span id="l36.227" class="difflineminus">-    DoMAPIFindNext(hWnd);</span>
<a href="#l36.228"></a><span id="l36.228" class="difflineminus">-    break;</span>
<a href="#l36.229"></a><span id="l36.229" class="difflineminus">-</span>
<a href="#l36.230"></a><span id="l36.230" class="difflineminus">-  case ID_BUTTON_READMAIL:</span>
<a href="#l36.231"></a><span id="l36.231" class="difflineminus">-  case ID_MENU_MAPIREADMAIL:</span>
<a href="#l36.232"></a><span id="l36.232" class="difflineminus">-    DoMAPIReadMail(hWnd);</span>
<a href="#l36.233"></a><span id="l36.233" class="difflineminus">-    break;</span>
<a href="#l36.234"></a><span id="l36.234" class="difflineminus">-</span>
<a href="#l36.235"></a><span id="l36.235" class="difflineminus">-  case ID_BUTTON_MAIL:</span>
<a href="#l36.236"></a><span id="l36.236" class="difflineminus">-    {</span>
<a href="#l36.237"></a><span id="l36.237" class="difflineminus">-    extern CALLBACK LOADDS </span>
<a href="#l36.238"></a><span id="l36.238" class="difflineminus">-           MailDlgProc(HWND hWndMain, UINT wMsg, WPARAM wParam, LPARAM lParam);</span>
<a href="#l36.239"></a><span id="l36.239" class="difflineminus">-</span>
<a href="#l36.240"></a><span id="l36.240" class="difflineminus">-    DialogBox(hInst, MAKEINTRESOURCE(ID_DIALOG_MAIL), hWnd, </span>
<a href="#l36.241"></a><span id="l36.241" class="difflineminus">-      (DLGPROC)MailDlgProc);</span>
<a href="#l36.242"></a><span id="l36.242" class="difflineminus">-    }</span>
<a href="#l36.243"></a><span id="l36.243" class="difflineminus">-    break;</span>
<a href="#l36.244"></a><span id="l36.244" class="difflineminus">-</span>
<a href="#l36.245"></a><span id="l36.245" class="difflineminus">-  case ID_BUTTON_DELETEMAIL:</span>
<a href="#l36.246"></a><span id="l36.246" class="difflineminus">-  case ID_MENU_MAPIDELETEMAIL:</span>
<a href="#l36.247"></a><span id="l36.247" class="difflineminus">-    DoMAPIDeleteMail(hWnd);</span>
<a href="#l36.248"></a><span id="l36.248" class="difflineminus">-    break;</span>
<a href="#l36.249"></a><span id="l36.249" class="difflineminus">-</span>
<a href="#l36.250"></a><span id="l36.250" class="difflineminus">-  case ID_MENU_MYEXIT:</span>
<a href="#l36.251"></a><span id="l36.251" class="difflineminus">-	  DestroyWindow(hWnd);</span>
<a href="#l36.252"></a><span id="l36.252" class="difflineminus">-	  break;</span>
<a href="#l36.253"></a><span id="l36.253" class="difflineminus">-</span>
<a href="#l36.254"></a><span id="l36.254" class="difflineminus">-  case ID_BUTTON_CLEAR:</span>
<a href="#l36.255"></a><span id="l36.255" class="difflineminus">-  case ID_MENU_CLEARRESULTS:</span>
<a href="#l36.256"></a><span id="l36.256" class="difflineminus">-    ListBox_ResetContent(GetDlgItem(hWnd, ID_LIST_RESULT));      </span>
<a href="#l36.257"></a><span id="l36.257" class="difflineminus">-	  break;</span>
<a href="#l36.258"></a><span id="l36.258" class="difflineminus">-</span>
<a href="#l36.259"></a><span id="l36.259" class="difflineminus">-  case ID_BUTTON_FREEBUFFER:</span>
<a href="#l36.260"></a><span id="l36.260" class="difflineminus">-    DoMAPIResolveNameFreeBuffer(hWnd);</span>
<a href="#l36.261"></a><span id="l36.261" class="difflineminus">-    break;</span>
<a href="#l36.262"></a><span id="l36.262" class="difflineminus">-</span>
<a href="#l36.263"></a><span id="l36.263" class="difflineminus">-  case ID_BUTTON_RESOLVENAME:</span>
<a href="#l36.264"></a><span id="l36.264" class="difflineminus">-    DoMAPIResolveName(hWnd);</span>
<a href="#l36.265"></a><span id="l36.265" class="difflineminus">-    break;</span>
<a href="#l36.266"></a><span id="l36.266" class="difflineminus">-</span>
<a href="#l36.267"></a><span id="l36.267" class="difflineminus">-  case ID_BUTTON_DETAILS:</span>
<a href="#l36.268"></a><span id="l36.268" class="difflineminus">-    DoMAPIDetails(hWnd);</span>
<a href="#l36.269"></a><span id="l36.269" class="difflineminus">-    break;</span>
<a href="#l36.270"></a><span id="l36.270" class="difflineminus">-</span>
<a href="#l36.271"></a><span id="l36.271" class="difflineminus">-  case ID_MENU_MYABOUT:</span>
<a href="#l36.272"></a><span id="l36.272" class="difflineminus">-	  MessageBox(hWnd,	</span>
<a href="#l36.273"></a><span id="l36.273" class="difflineminus">-			  &quot;Netscape MAPI Test Harness\nWritten by: Rich Pizzarro (rhp@netscape.com)&quot;,	</span>
<a href="#l36.274"></a><span id="l36.274" class="difflineminus">-			  &quot;About&quot;,</span>
<a href="#l36.275"></a><span id="l36.275" class="difflineminus">-			  MB_ICONINFORMATION);</span>
<a href="#l36.276"></a><span id="l36.276" class="difflineminus">-	  break;</span>
<a href="#l36.277"></a><span id="l36.277" class="difflineminus">-  </span>
<a href="#l36.278"></a><span id="l36.278" class="difflineminus">-  default:</span>
<a href="#l36.279"></a><span id="l36.279" class="difflineminus">-    break;</span>
<a href="#l36.280"></a><span id="l36.280" class="difflineminus">-  }</span>
<a href="#l36.281"></a><span id="l36.281" class="difflineminus">-}</span>
<a href="#l36.282"></a><span id="l36.282" class="difflineminus">-</span>
<a href="#l36.283"></a><span id="l36.283" class="difflineminus">-void</span>
<a href="#l36.284"></a><span id="l36.284" class="difflineminus">-DoMAPILogon(HWND hWnd)</span>
<a href="#l36.285"></a><span id="l36.285" class="difflineminus">-{</span>
<a href="#l36.286"></a><span id="l36.286" class="difflineminus">-  char  msg[1024];</span>
<a href="#l36.287"></a><span id="l36.287" class="difflineminus">-  char  user[128] = &quot;&quot;;</span>
<a href="#l36.288"></a><span id="l36.288" class="difflineminus">-  char  pw[128] = &quot;&quot;;</span>
<a href="#l36.289"></a><span id="l36.289" class="difflineminus">-</span>
<a href="#l36.290"></a><span id="l36.290" class="difflineminus">-  // Get Address of MAPI function...</span>
<a href="#l36.291"></a><span id="l36.291" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPILogon)(ULONG, LPSTR, LPSTR, FLAGS, ULONG, LPLHANDLE);   </span>
<a href="#l36.292"></a><span id="l36.292" class="difflineminus">-  </span>
<a href="#l36.293"></a><span id="l36.293" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l36.294"></a><span id="l36.294" class="difflineminus">-  (FARPROC&amp;) lpfnMAPILogon = GetProcAddress(m_hInstMapi, &quot;MAPILOGON&quot;); </span>
<a href="#l36.295"></a><span id="l36.295" class="difflineminus">-#else</span>
<a href="#l36.296"></a><span id="l36.296" class="difflineminus">-  (FARPROC&amp;) lpfnMAPILogon = GetProcAddress(m_hInstMapi, &quot;MAPILogon&quot;); </span>
<a href="#l36.297"></a><span id="l36.297" class="difflineminus">-#endif</span>
<a href="#l36.298"></a><span id="l36.298" class="difflineminus">-  </span>
<a href="#l36.299"></a><span id="l36.299" class="difflineminus">-  if (!lpfnMAPILogon)</span>
<a href="#l36.300"></a><span id="l36.300" class="difflineminus">-  {</span>
<a href="#l36.301"></a><span id="l36.301" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l36.302"></a><span id="l36.302" class="difflineminus">-    return;</span>
<a href="#l36.303"></a><span id="l36.303" class="difflineminus">-  }</span>
<a href="#l36.304"></a><span id="l36.304" class="difflineminus">-</span>
<a href="#l36.305"></a><span id="l36.305" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_USERNAME, user, sizeof(user));</span>
<a href="#l36.306"></a><span id="l36.306" class="difflineminus">-  GetDlgItemText(hWnd, ID_EDIT_PW, pw, sizeof(pw));</span>
<a href="#l36.307"></a><span id="l36.307" class="difflineminus">-</span>
<a href="#l36.308"></a><span id="l36.308" class="difflineminus">-  LONG  rc = (*lpfnMAPILogon)((ULONG) hWnd, user, pw, </span>
<a href="#l36.309"></a><span id="l36.309" class="difflineminus">-                  MAPI_FORCE_DOWNLOAD | MAPI_NEW_SESSION, 0, &amp;mapiSession);</span>
<a href="#l36.310"></a><span id="l36.310" class="difflineminus">-  if (rc == SUCCESS_SUCCESS)</span>
<a href="#l36.311"></a><span id="l36.311" class="difflineminus">-  {</span>
<a href="#l36.312"></a><span id="l36.312" class="difflineminus">-    wsprintf(msg, &quot;Success with session = %d&quot;, mapiSession);</span>
<a href="#l36.313"></a><span id="l36.313" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.314"></a><span id="l36.314" class="difflineminus">-    SetFooter(&quot;Logon success&quot;);</span>
<a href="#l36.315"></a><span id="l36.315" class="difflineminus">-  }</span>
<a href="#l36.316"></a><span id="l36.316" class="difflineminus">-  else</span>
<a href="#l36.317"></a><span id="l36.317" class="difflineminus">-  {</span>
<a href="#l36.318"></a><span id="l36.318" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %d from Logon\nError=[%s]&quot;, </span>
<a href="#l36.319"></a><span id="l36.319" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l36.320"></a><span id="l36.320" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.321"></a><span id="l36.321" class="difflineminus">-    SetFooter(&quot;Logon failed&quot;);</span>
<a href="#l36.322"></a><span id="l36.322" class="difflineminus">-  }</span>
<a href="#l36.323"></a><span id="l36.323" class="difflineminus">-}</span>
<a href="#l36.324"></a><span id="l36.324" class="difflineminus">-</span>
<a href="#l36.325"></a><span id="l36.325" class="difflineminus">-void</span>
<a href="#l36.326"></a><span id="l36.326" class="difflineminus">-DoMAPILogoff(HWND hWnd)</span>
<a href="#l36.327"></a><span id="l36.327" class="difflineminus">-{</span>
<a href="#l36.328"></a><span id="l36.328" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPILogoff) ( LHANDLE lhSession, ULONG ulUIParam, </span>
<a href="#l36.329"></a><span id="l36.329" class="difflineminus">-                                FLAGS flFlags, ULONG ulReserved);</span>
<a href="#l36.330"></a><span id="l36.330" class="difflineminus">-</span>
<a href="#l36.331"></a><span id="l36.331" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l36.332"></a><span id="l36.332" class="difflineminus">-  (FARPROC&amp;) lpfnMAPILogoff = GetProcAddress(m_hInstMapi, &quot;MAPILOGOFF&quot;); </span>
<a href="#l36.333"></a><span id="l36.333" class="difflineminus">-#else</span>
<a href="#l36.334"></a><span id="l36.334" class="difflineminus">-  (FARPROC&amp;) lpfnMAPILogoff = GetProcAddress(m_hInstMapi, &quot;MAPILogoff&quot;); </span>
<a href="#l36.335"></a><span id="l36.335" class="difflineminus">-#endif</span>
<a href="#l36.336"></a><span id="l36.336" class="difflineminus">-  </span>
<a href="#l36.337"></a><span id="l36.337" class="difflineminus">-  if (!lpfnMAPILogoff)</span>
<a href="#l36.338"></a><span id="l36.338" class="difflineminus">-  {</span>
<a href="#l36.339"></a><span id="l36.339" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l36.340"></a><span id="l36.340" class="difflineminus">-    return;</span>
<a href="#l36.341"></a><span id="l36.341" class="difflineminus">-  }</span>
<a href="#l36.342"></a><span id="l36.342" class="difflineminus">-</span>
<a href="#l36.343"></a><span id="l36.343" class="difflineminus">-  char  msg[1024];</span>
<a href="#l36.344"></a><span id="l36.344" class="difflineminus">-  LONG  rc = (*lpfnMAPILogoff)(mapiSession, (ULONG) hWnd, 0, 0);</span>
<a href="#l36.345"></a><span id="l36.345" class="difflineminus">-  if (rc == SUCCESS_SUCCESS)</span>
<a href="#l36.346"></a><span id="l36.346" class="difflineminus">-  {</span>
<a href="#l36.347"></a><span id="l36.347" class="difflineminus">-    wsprintf(msg, &quot;Successful logoff&quot;);</span>
<a href="#l36.348"></a><span id="l36.348" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.349"></a><span id="l36.349" class="difflineminus">-    SetFooter(msg);</span>
<a href="#l36.350"></a><span id="l36.350" class="difflineminus">-  }</span>
<a href="#l36.351"></a><span id="l36.351" class="difflineminus">-  else</span>
<a href="#l36.352"></a><span id="l36.352" class="difflineminus">-  {</span>
<a href="#l36.353"></a><span id="l36.353" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %d from Logoff\nError=[%s]&quot;, </span>
<a href="#l36.354"></a><span id="l36.354" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l36.355"></a><span id="l36.355" class="difflineminus">-</span>
<a href="#l36.356"></a><span id="l36.356" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.357"></a><span id="l36.357" class="difflineminus">-    SetFooter(&quot;Logoff failed&quot;);</span>
<a href="#l36.358"></a><span id="l36.358" class="difflineminus">-  }</span>
<a href="#l36.359"></a><span id="l36.359" class="difflineminus">-</span>
<a href="#l36.360"></a><span id="l36.360" class="difflineminus">-  mapiSession = 0;</span>
<a href="#l36.361"></a><span id="l36.361" class="difflineminus">-}</span>
<a href="#l36.362"></a><span id="l36.362" class="difflineminus">-</span>
<a href="#l36.363"></a><span id="l36.363" class="difflineminus">-void</span>
<a href="#l36.364"></a><span id="l36.364" class="difflineminus">-DoMAPIFreeBuffer(HWND hWnd, LPVOID buf, BOOL alert)</span>
<a href="#l36.365"></a><span id="l36.365" class="difflineminus">-{</span>
<a href="#l36.366"></a><span id="l36.366" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPIFreeBuffer) (LPVOID lpBuffer);</span>
<a href="#l36.367"></a><span id="l36.367" class="difflineminus">-</span>
<a href="#l36.368"></a><span id="l36.368" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l36.369"></a><span id="l36.369" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIFreeBuffer = GetProcAddress(m_hInstMapi, &quot;MAPIFREEBUFFER&quot;); </span>
<a href="#l36.370"></a><span id="l36.370" class="difflineminus">-#else</span>
<a href="#l36.371"></a><span id="l36.371" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIFreeBuffer = GetProcAddress(m_hInstMapi, &quot;MAPIFreeBuffer&quot;); </span>
<a href="#l36.372"></a><span id="l36.372" class="difflineminus">-#endif</span>
<a href="#l36.373"></a><span id="l36.373" class="difflineminus">-  </span>
<a href="#l36.374"></a><span id="l36.374" class="difflineminus">-  if (!lpfnMAPIFreeBuffer)</span>
<a href="#l36.375"></a><span id="l36.375" class="difflineminus">-  {</span>
<a href="#l36.376"></a><span id="l36.376" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l36.377"></a><span id="l36.377" class="difflineminus">-    return;</span>
<a href="#l36.378"></a><span id="l36.378" class="difflineminus">-  }</span>
<a href="#l36.379"></a><span id="l36.379" class="difflineminus">-</span>
<a href="#l36.380"></a><span id="l36.380" class="difflineminus">-  char  msg[1024];</span>
<a href="#l36.381"></a><span id="l36.381" class="difflineminus">-  LONG  rc = (*lpfnMAPIFreeBuffer)(buf);</span>
<a href="#l36.382"></a><span id="l36.382" class="difflineminus">-#ifdef WIN32</span>
<a href="#l36.383"></a><span id="l36.383" class="difflineminus">-  if (rc == S_OK)</span>
<a href="#l36.384"></a><span id="l36.384" class="difflineminus">-#else</span>
<a href="#l36.385"></a><span id="l36.385" class="difflineminus">-  if (rc == SUCCESS_SUCCESS)</span>
<a href="#l36.386"></a><span id="l36.386" class="difflineminus">-#endif</span>
<a href="#l36.387"></a><span id="l36.387" class="difflineminus">-  {</span>
<a href="#l36.388"></a><span id="l36.388" class="difflineminus">-    wsprintf(msg, &quot;Successful Free Buffer Operation&quot;);</span>
<a href="#l36.389"></a><span id="l36.389" class="difflineminus">-    if (alert)</span>
<a href="#l36.390"></a><span id="l36.390" class="difflineminus">-      ShowMessage(hWnd, msg);</span>
<a href="#l36.391"></a><span id="l36.391" class="difflineminus">-  }</span>
<a href="#l36.392"></a><span id="l36.392" class="difflineminus">-  else</span>
<a href="#l36.393"></a><span id="l36.393" class="difflineminus">-  {</span>
<a href="#l36.394"></a><span id="l36.394" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %d from Logoff&quot;, rc);</span>
<a href="#l36.395"></a><span id="l36.395" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.396"></a><span id="l36.396" class="difflineminus">-  }</span>
<a href="#l36.397"></a><span id="l36.397" class="difflineminus">-}</span>
<a href="#l36.398"></a><span id="l36.398" class="difflineminus">-</span>
<a href="#l36.399"></a><span id="l36.399" class="difflineminus">-void</span>
<a href="#l36.400"></a><span id="l36.400" class="difflineminus">-DoMAPIFindNext(HWND hWnd)</span>
<a href="#l36.401"></a><span id="l36.401" class="difflineminus">-{</span>
<a href="#l36.402"></a><span id="l36.402" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPIFindNext) (LHANDLE lhSession, ULONG ulUIParam, </span>
<a href="#l36.403"></a><span id="l36.403" class="difflineminus">-           LPTSTR lpszMessageType, LPTSTR lpszSeedMessageID, FLAGS flFlags, </span>
<a href="#l36.404"></a><span id="l36.404" class="difflineminus">-           ULONG ulReserved, LPTSTR lpszMessageID);</span>
<a href="#l36.405"></a><span id="l36.405" class="difflineminus">-</span>
<a href="#l36.406"></a><span id="l36.406" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l36.407"></a><span id="l36.407" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIFindNext = GetProcAddress(m_hInstMapi, &quot;MAPIFINDNEXT&quot;); </span>
<a href="#l36.408"></a><span id="l36.408" class="difflineminus">-#else</span>
<a href="#l36.409"></a><span id="l36.409" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIFindNext = GetProcAddress(m_hInstMapi, &quot;MAPIFindNext&quot;); </span>
<a href="#l36.410"></a><span id="l36.410" class="difflineminus">-#endif</span>
<a href="#l36.411"></a><span id="l36.411" class="difflineminus">-</span>
<a href="#l36.412"></a><span id="l36.412" class="difflineminus">-  if (!lpfnMAPIFindNext)</span>
<a href="#l36.413"></a><span id="l36.413" class="difflineminus">-  {</span>
<a href="#l36.414"></a><span id="l36.414" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l36.415"></a><span id="l36.415" class="difflineminus">-    return;</span>
<a href="#l36.416"></a><span id="l36.416" class="difflineminus">-  }</span>
<a href="#l36.417"></a><span id="l36.417" class="difflineminus">-</span>
<a href="#l36.418"></a><span id="l36.418" class="difflineminus">-  // Clear the list before we start...</span>
<a href="#l36.419"></a><span id="l36.419" class="difflineminus">-  ListBox_ResetContent(GetDlgItem(hWnd, ID_LIST_RESULT));</span>
<a href="#l36.420"></a><span id="l36.420" class="difflineminus">-</span>
<a href="#l36.421"></a><span id="l36.421" class="difflineminus">-  char  msg[1024];</span>
<a href="#l36.422"></a><span id="l36.422" class="difflineminus">-  char  messageID[512];</span>
<a href="#l36.423"></a><span id="l36.423" class="difflineminus">-  LONG  rc;                                                               </span>
<a href="#l36.424"></a><span id="l36.424" class="difflineminus">-#ifdef WIN32</span>
<a href="#l36.425"></a><span id="l36.425" class="difflineminus">-  FLAGS	flags = MAPI_GUARANTEE_FIFO | MAPI_LONG_MSGID | MAPI_UNREAD_ONLY;</span>
<a href="#l36.426"></a><span id="l36.426" class="difflineminus">-#else                                                                     	</span>
<a href="#l36.427"></a><span id="l36.427" class="difflineminus">-  FLAGS	flags = MAPI_GUARANTEE_FIFO | MAPI_UNREAD_ONLY;</span>
<a href="#l36.428"></a><span id="l36.428" class="difflineminus">-#endif</span>
<a href="#l36.429"></a><span id="l36.429" class="difflineminus">-  </span>
<a href="#l36.430"></a><span id="l36.430" class="difflineminus">-  while ( (rc = (*lpfnMAPIFindNext) (mapiSession, </span>
<a href="#l36.431"></a><span id="l36.431" class="difflineminus">-           (ULONG) hWnd, </span>
<a href="#l36.432"></a><span id="l36.432" class="difflineminus">-           NULL, </span>
<a href="#l36.433"></a><span id="l36.433" class="difflineminus">-           NULL, </span>
<a href="#l36.434"></a><span id="l36.434" class="difflineminus">-		   flags,</span>
<a href="#l36.435"></a><span id="l36.435" class="difflineminus">-           0,</span>
<a href="#l36.436"></a><span id="l36.436" class="difflineminus">-           messageID)) == SUCCESS_SUCCESS)</span>
<a href="#l36.437"></a><span id="l36.437" class="difflineminus">-  {</span>
<a href="#l36.438"></a><span id="l36.438" class="difflineminus">-      // </span>
<a href="#l36.439"></a><span id="l36.439" class="difflineminus">-</span>
<a href="#l36.440"></a><span id="l36.440" class="difflineminus">-      lpMapiMessage mapiMsg = GetMessage(hWnd, messageID);</span>
<a href="#l36.441"></a><span id="l36.441" class="difflineminus">-      if (mapiMsg != NULL)</span>
<a href="#l36.442"></a><span id="l36.442" class="difflineminus">-      {</span>
<a href="#l36.443"></a><span id="l36.443" class="difflineminus">-        wsprintf(msg, &quot;%s: \&quot;%s\&quot; Sender: %s&quot;, </span>
<a href="#l36.444"></a><span id="l36.444" class="difflineminus">-                  messageID, </span>
<a href="#l36.445"></a><span id="l36.445" class="difflineminus">-                  mapiMsg-&gt;lpszSubject ? mapiMsg-&gt;lpszSubject : &quot;&quot;, </span>
<a href="#l36.446"></a><span id="l36.446" class="difflineminus">-                  mapiMsg-&gt;lpOriginator-&gt;lpszName);</span>
<a href="#l36.447"></a><span id="l36.447" class="difflineminus">-        DoMAPIFreeBuffer(hWnd, mapiMsg, FALSE);</span>
<a href="#l36.448"></a><span id="l36.448" class="difflineminus">-      }</span>
<a href="#l36.449"></a><span id="l36.449" class="difflineminus">-      else</span>
<a href="#l36.450"></a><span id="l36.450" class="difflineminus">-      {</span>
<a href="#l36.451"></a><span id="l36.451" class="difflineminus">-        lstrcpy(msg, messageID);</span>
<a href="#l36.452"></a><span id="l36.452" class="difflineminus">-      }</span>
<a href="#l36.453"></a><span id="l36.453" class="difflineminus">-</span>
<a href="#l36.454"></a><span id="l36.454" class="difflineminus">-      ListBox_InsertString(GetDlgItem(hWnd, ID_LIST_RESULT), 0, msg);</span>
<a href="#l36.455"></a><span id="l36.455" class="difflineminus">-  }</span>
<a href="#l36.456"></a><span id="l36.456" class="difflineminus">-</span>
<a href="#l36.457"></a><span id="l36.457" class="difflineminus">-  wsprintf(msg, &quot;Enumeration ended: Return code %d from MAPIFindNext\nCondition=[%s]&quot;, </span>
<a href="#l36.458"></a><span id="l36.458" class="difflineminus">-                    rc, GetMAPIError(rc));</span>
<a href="#l36.459"></a><span id="l36.459" class="difflineminus">-  ShowMessage(hWnd, msg);</span>
<a href="#l36.460"></a><span id="l36.460" class="difflineminus">-  SetFooter(&quot;Enumeration ended&quot;);</span>
<a href="#l36.461"></a><span id="l36.461" class="difflineminus">-}</span>
<a href="#l36.462"></a><span id="l36.462" class="difflineminus">-</span>
<a href="#l36.463"></a><span id="l36.463" class="difflineminus">-void</span>
<a href="#l36.464"></a><span id="l36.464" class="difflineminus">-DoMAPIReadMail(HWND hWnd)</span>
<a href="#l36.465"></a><span id="l36.465" class="difflineminus">-{</span>
<a href="#l36.466"></a><span id="l36.466" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPIReadMail) (LHANDLE lhSession, ULONG ulUIParam, </span>
<a href="#l36.467"></a><span id="l36.467" class="difflineminus">-           LPTSTR lpszMessageID, FLAGS flFlags, ULONG ulReserved, </span>
<a href="#l36.468"></a><span id="l36.468" class="difflineminus">-           lpMapiMessage FAR * lppMessage);</span>
<a href="#l36.469"></a><span id="l36.469" class="difflineminus">-</span>
<a href="#l36.470"></a><span id="l36.470" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l36.471"></a><span id="l36.471" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIReadMail = GetProcAddress(m_hInstMapi, &quot;MAPIREADMAIL&quot;); </span>
<a href="#l36.472"></a><span id="l36.472" class="difflineminus">-#else</span>
<a href="#l36.473"></a><span id="l36.473" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIReadMail = GetProcAddress(m_hInstMapi, &quot;MAPIReadMail&quot;); </span>
<a href="#l36.474"></a><span id="l36.474" class="difflineminus">-#endif</span>
<a href="#l36.475"></a><span id="l36.475" class="difflineminus">-  </span>
<a href="#l36.476"></a><span id="l36.476" class="difflineminus">-  if (!lpfnMAPIReadMail)</span>
<a href="#l36.477"></a><span id="l36.477" class="difflineminus">-  {</span>
<a href="#l36.478"></a><span id="l36.478" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l36.479"></a><span id="l36.479" class="difflineminus">-    return;</span>
<a href="#l36.480"></a><span id="l36.480" class="difflineminus">-  }</span>
<a href="#l36.481"></a><span id="l36.481" class="difflineminus">-</span>
<a href="#l36.482"></a><span id="l36.482" class="difflineminus">-  char            msg[1024];</span>
<a href="#l36.483"></a><span id="l36.483" class="difflineminus">-  char            lpszMessageID[512];</span>
<a href="#l36.484"></a><span id="l36.484" class="difflineminus">-  lpMapiMessage   lpMessage = NULL;</span>
<a href="#l36.485"></a><span id="l36.485" class="difflineminus">-  FLAGS           flFlags = 0;</span>
<a href="#l36.486"></a><span id="l36.486" class="difflineminus">-</span>
<a href="#l36.487"></a><span id="l36.487" class="difflineminus">-  DWORD selected = ListBox_GetCurSel(GetDlgItem(hWnd, ID_LIST_RESULT));</span>
<a href="#l36.488"></a><span id="l36.488" class="difflineminus">-  if (selected == LB_ERR)</span>
<a href="#l36.489"></a><span id="l36.489" class="difflineminus">-  {</span>
<a href="#l36.490"></a><span id="l36.490" class="difflineminus">-    ShowMessage(hWnd, &quot;You need to select a valid message. Make sure\nyou have done a MAPIFindNext and selected\none of the resulting messages.&quot;);</span>
<a href="#l36.491"></a><span id="l36.491" class="difflineminus">-    return;</span>
<a href="#l36.492"></a><span id="l36.492" class="difflineminus">-  }</span>
<a href="#l36.493"></a><span id="l36.493" class="difflineminus">-</span>
<a href="#l36.494"></a><span id="l36.494" class="difflineminus">-  ListBox_GetText(GetDlgItem(hWnd, ID_LIST_RESULT), selected, lpszMessageID);</span>
<a href="#l36.495"></a><span id="l36.495" class="difflineminus">-</span>
<a href="#l36.496"></a><span id="l36.496" class="difflineminus">-  // Do the various flags for this call...</span>
<a href="#l36.497"></a><span id="l36.497" class="difflineminus">-  if (BST_CHECKED == Button_GetCheck(GetDlgItem(hWnd, IDC_CHECK_BODYASFILE)))</span>
<a href="#l36.498"></a><span id="l36.498" class="difflineminus">-  {</span>
<a href="#l36.499"></a><span id="l36.499" class="difflineminus">-    flFlags |= MAPI_BODY_AS_FILE;</span>
<a href="#l36.500"></a><span id="l36.500" class="difflineminus">-  }</span>
<a href="#l36.501"></a><span id="l36.501" class="difflineminus">-</span>
<a href="#l36.502"></a><span id="l36.502" class="difflineminus">-  if (BST_CHECKED == Button_GetCheck(GetDlgItem(hWnd, IDC_CHECK_ENVELOPEONLY)))</span>
<a href="#l36.503"></a><span id="l36.503" class="difflineminus">-  {</span>
<a href="#l36.504"></a><span id="l36.504" class="difflineminus">-    flFlags |= MAPI_ENVELOPE_ONLY;</span>
<a href="#l36.505"></a><span id="l36.505" class="difflineminus">-  }</span>
<a href="#l36.506"></a><span id="l36.506" class="difflineminus">-</span>
<a href="#l36.507"></a><span id="l36.507" class="difflineminus">-  if (BST_CHECKED == Button_GetCheck(GetDlgItem(hWnd, IDC_CHECK_PEEK)))</span>
<a href="#l36.508"></a><span id="l36.508" class="difflineminus">-  {</span>
<a href="#l36.509"></a><span id="l36.509" class="difflineminus">-    flFlags |= MAPI_PEEK;</span>
<a href="#l36.510"></a><span id="l36.510" class="difflineminus">-  }</span>
<a href="#l36.511"></a><span id="l36.511" class="difflineminus">-  </span>
<a href="#l36.512"></a><span id="l36.512" class="difflineminus">-  if (BST_CHECKED == Button_GetCheck(GetDlgItem(hWnd, IDC_CHECK_SUPPRESSATTACH)))</span>
<a href="#l36.513"></a><span id="l36.513" class="difflineminus">-  {</span>
<a href="#l36.514"></a><span id="l36.514" class="difflineminus">-    flFlags |= MAPI_SUPPRESS_ATTACH;</span>
<a href="#l36.515"></a><span id="l36.515" class="difflineminus">-  }</span>
<a href="#l36.516"></a><span id="l36.516" class="difflineminus">-</span>
<a href="#l36.517"></a><span id="l36.517" class="difflineminus">-  char *ptr = strchr( (const char *) lpszMessageID, ':');</span>
<a href="#l36.518"></a><span id="l36.518" class="difflineminus">-  if (ptr) *ptr = '\0';</span>
<a href="#l36.519"></a><span id="l36.519" class="difflineminus">-</span>
<a href="#l36.520"></a><span id="l36.520" class="difflineminus">-  LONG  rc = (*lpfnMAPIReadMail)</span>
<a href="#l36.521"></a><span id="l36.521" class="difflineminus">-          (mapiSession, </span>
<a href="#l36.522"></a><span id="l36.522" class="difflineminus">-          (ULONG) hWnd, </span>
<a href="#l36.523"></a><span id="l36.523" class="difflineminus">-          lpszMessageID,</span>
<a href="#l36.524"></a><span id="l36.524" class="difflineminus">-          flFlags,</span>
<a href="#l36.525"></a><span id="l36.525" class="difflineminus">-          0, </span>
<a href="#l36.526"></a><span id="l36.526" class="difflineminus">-          &amp;lpMessage);</span>
<a href="#l36.527"></a><span id="l36.527" class="difflineminus">-</span>
<a href="#l36.528"></a><span id="l36.528" class="difflineminus">-  // Deal with error up front and return if need be...</span>
<a href="#l36.529"></a><span id="l36.529" class="difflineminus">-  if (rc != SUCCESS_SUCCESS)</span>
<a href="#l36.530"></a><span id="l36.530" class="difflineminus">-  {</span>
<a href="#l36.531"></a><span id="l36.531" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %x from MAPIReadMail\nError=[%s]&quot;, </span>
<a href="#l36.532"></a><span id="l36.532" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l36.533"></a><span id="l36.533" class="difflineminus">-</span>
<a href="#l36.534"></a><span id="l36.534" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.535"></a><span id="l36.535" class="difflineminus">-    SetFooter(&quot;ReadMail failed&quot;);</span>
<a href="#l36.536"></a><span id="l36.536" class="difflineminus">-    return;</span>
<a href="#l36.537"></a><span id="l36.537" class="difflineminus">-  }</span>
<a href="#l36.538"></a><span id="l36.538" class="difflineminus">-</span>
<a href="#l36.539"></a><span id="l36.539" class="difflineminus">-  // Now display the message and then return...</span>
<a href="#l36.540"></a><span id="l36.540" class="difflineminus">-  DisplayMAPIReadMail(hWnd, lpMessage);</span>
<a href="#l36.541"></a><span id="l36.541" class="difflineminus">-  DoMAPIFreeBuffer(hWnd, lpMessage, TRUE);</span>
<a href="#l36.542"></a><span id="l36.542" class="difflineminus">-}</span>
<a href="#l36.543"></a><span id="l36.543" class="difflineminus">-</span>
<a href="#l36.544"></a><span id="l36.544" class="difflineminus">-void</span>
<a href="#l36.545"></a><span id="l36.545" class="difflineminus">-DoMAPIDeleteMail(HWND hWnd)</span>
<a href="#l36.546"></a><span id="l36.546" class="difflineminus">-{</span>
<a href="#l36.547"></a><span id="l36.547" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPIDeleteMail) (LHANDLE lhSession, ULONG ulUIParam, </span>
<a href="#l36.548"></a><span id="l36.548" class="difflineminus">-            LPTSTR lpszMessageID, FLAGS flFlags, ULONG ulReserved);</span>
<a href="#l36.549"></a><span id="l36.549" class="difflineminus">-</span>
<a href="#l36.550"></a><span id="l36.550" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l36.551"></a><span id="l36.551" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIDeleteMail = GetProcAddress(m_hInstMapi, &quot;MAPIDELETEMAIL&quot;); </span>
<a href="#l36.552"></a><span id="l36.552" class="difflineminus">-#else</span>
<a href="#l36.553"></a><span id="l36.553" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIDeleteMail = GetProcAddress(m_hInstMapi, &quot;MAPIDeleteMail&quot;); </span>
<a href="#l36.554"></a><span id="l36.554" class="difflineminus">-#endif</span>
<a href="#l36.555"></a><span id="l36.555" class="difflineminus">-  </span>
<a href="#l36.556"></a><span id="l36.556" class="difflineminus">-  if (!lpfnMAPIDeleteMail)</span>
<a href="#l36.557"></a><span id="l36.557" class="difflineminus">-  {</span>
<a href="#l36.558"></a><span id="l36.558" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l36.559"></a><span id="l36.559" class="difflineminus">-    return;</span>
<a href="#l36.560"></a><span id="l36.560" class="difflineminus">-  }</span>
<a href="#l36.561"></a><span id="l36.561" class="difflineminus">- </span>
<a href="#l36.562"></a><span id="l36.562" class="difflineminus">-  char            msg[1024];</span>
<a href="#l36.563"></a><span id="l36.563" class="difflineminus">-  char            lpszMessageID[512];</span>
<a href="#l36.564"></a><span id="l36.564" class="difflineminus">-  lpMapiMessage   lpMessage = NULL;</span>
<a href="#l36.565"></a><span id="l36.565" class="difflineminus">-</span>
<a href="#l36.566"></a><span id="l36.566" class="difflineminus">-  DWORD selected = ListBox_GetCurSel(GetDlgItem(hWnd, ID_LIST_RESULT));</span>
<a href="#l36.567"></a><span id="l36.567" class="difflineminus">-  if (selected == LB_ERR)</span>
<a href="#l36.568"></a><span id="l36.568" class="difflineminus">-  {</span>
<a href="#l36.569"></a><span id="l36.569" class="difflineminus">-    ShowMessage(hWnd, &quot;You need to select a valid message. Make sure\nyou have done a MAPIFindNext and selected\none of the resulting messages.&quot;);</span>
<a href="#l36.570"></a><span id="l36.570" class="difflineminus">-    return;</span>
<a href="#l36.571"></a><span id="l36.571" class="difflineminus">-  }</span>
<a href="#l36.572"></a><span id="l36.572" class="difflineminus">-</span>
<a href="#l36.573"></a><span id="l36.573" class="difflineminus">-  ListBox_GetText(GetDlgItem(hWnd, ID_LIST_RESULT), selected, lpszMessageID);</span>
<a href="#l36.574"></a><span id="l36.574" class="difflineminus">-</span>
<a href="#l36.575"></a><span id="l36.575" class="difflineminus">-  char *ptr = strchr( (const char *) lpszMessageID, ':');</span>
<a href="#l36.576"></a><span id="l36.576" class="difflineminus">-  if (ptr) *ptr = '\0';</span>
<a href="#l36.577"></a><span id="l36.577" class="difflineminus">-</span>
<a href="#l36.578"></a><span id="l36.578" class="difflineminus">-  LONG  rc = (*lpfnMAPIDeleteMail)</span>
<a href="#l36.579"></a><span id="l36.579" class="difflineminus">-          (mapiSession, </span>
<a href="#l36.580"></a><span id="l36.580" class="difflineminus">-          (ULONG) hWnd,</span>
<a href="#l36.581"></a><span id="l36.581" class="difflineminus">-          lpszMessageID, </span>
<a href="#l36.582"></a><span id="l36.582" class="difflineminus">-          0,</span>
<a href="#l36.583"></a><span id="l36.583" class="difflineminus">-          0);</span>
<a href="#l36.584"></a><span id="l36.584" class="difflineminus">-  </span>
<a href="#l36.585"></a><span id="l36.585" class="difflineminus">-  // Deal with the return code...</span>
<a href="#l36.586"></a><span id="l36.586" class="difflineminus">-  if (rc == SUCCESS_SUCCESS)</span>
<a href="#l36.587"></a><span id="l36.587" class="difflineminus">-  {</span>
<a href="#l36.588"></a><span id="l36.588" class="difflineminus">-    wsprintf(msg, &quot;Successful deletion&quot;);</span>
<a href="#l36.589"></a><span id="l36.589" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.590"></a><span id="l36.590" class="difflineminus">-    SetFooter(msg);  </span>
<a href="#l36.591"></a><span id="l36.591" class="difflineminus">-</span>
<a href="#l36.592"></a><span id="l36.592" class="difflineminus">-    // If it worked, refresh the list...</span>
<a href="#l36.593"></a><span id="l36.593" class="difflineminus">-    ShowMessage(hWnd, &quot;The message list will now be refreshed\nsince one message was deleted.&quot;);</span>
<a href="#l36.594"></a><span id="l36.594" class="difflineminus">-    DoMAPIFindNext(hWnd);</span>
<a href="#l36.595"></a><span id="l36.595" class="difflineminus">-  }</span>
<a href="#l36.596"></a><span id="l36.596" class="difflineminus">-  else</span>
<a href="#l36.597"></a><span id="l36.597" class="difflineminus">-  {</span>
<a href="#l36.598"></a><span id="l36.598" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %d from MAPIDeleteMail\nError=[%s]&quot;, </span>
<a href="#l36.599"></a><span id="l36.599" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l36.600"></a><span id="l36.600" class="difflineminus">-</span>
<a href="#l36.601"></a><span id="l36.601" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.602"></a><span id="l36.602" class="difflineminus">-    SetFooter(&quot;Logoff failed&quot;);</span>
<a href="#l36.603"></a><span id="l36.603" class="difflineminus">-  }</span>
<a href="#l36.604"></a><span id="l36.604" class="difflineminus">-}</span>
<a href="#l36.605"></a><span id="l36.605" class="difflineminus">-</span>
<a href="#l36.606"></a><span id="l36.606" class="difflineminus">-// This is for the name lookup stuff...</span>
<a href="#l36.607"></a><span id="l36.607" class="difflineminus">-lpMapiRecipDesc       lpRecip = NULL;</span>
<a href="#l36.608"></a><span id="l36.608" class="difflineminus">-</span>
<a href="#l36.609"></a><span id="l36.609" class="difflineminus">-void</span>
<a href="#l36.610"></a><span id="l36.610" class="difflineminus">-DoMAPIResolveName(HWND hWnd)</span>
<a href="#l36.611"></a><span id="l36.611" class="difflineminus">-{</span>
<a href="#l36.612"></a><span id="l36.612" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPIResolveName) (LHANDLE lhSession, ULONG ulUIParam, </span>
<a href="#l36.613"></a><span id="l36.613" class="difflineminus">-            LPTSTR lpszName, FLAGS flFlags, ULONG ulReserved, </span>
<a href="#l36.614"></a><span id="l36.614" class="difflineminus">-            lpMapiRecipDesc FAR * lppRecip); </span>
<a href="#l36.615"></a><span id="l36.615" class="difflineminus">-</span>
<a href="#l36.616"></a><span id="l36.616" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l36.617"></a><span id="l36.617" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIResolveName = GetProcAddress(m_hInstMapi, &quot;MAPIRESOLVENAME&quot;); </span>
<a href="#l36.618"></a><span id="l36.618" class="difflineminus">-#else</span>
<a href="#l36.619"></a><span id="l36.619" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIResolveName = GetProcAddress(m_hInstMapi, &quot;MAPIResolveName&quot;); </span>
<a href="#l36.620"></a><span id="l36.620" class="difflineminus">-#endif</span>
<a href="#l36.621"></a><span id="l36.621" class="difflineminus">-  </span>
<a href="#l36.622"></a><span id="l36.622" class="difflineminus">-  if (!lpfnMAPIResolveName)</span>
<a href="#l36.623"></a><span id="l36.623" class="difflineminus">-  {</span>
<a href="#l36.624"></a><span id="l36.624" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l36.625"></a><span id="l36.625" class="difflineminus">-    return;</span>
<a href="#l36.626"></a><span id="l36.626" class="difflineminus">-  }</span>
<a href="#l36.627"></a><span id="l36.627" class="difflineminus">-</span>
<a href="#l36.628"></a><span id="l36.628" class="difflineminus">-  if (lpRecip != NULL)</span>
<a href="#l36.629"></a><span id="l36.629" class="difflineminus">-  {</span>
<a href="#l36.630"></a><span id="l36.630" class="difflineminus">-    ShowMessage(hWnd, &quot;We need to free memory from a previous call...&quot;);</span>
<a href="#l36.631"></a><span id="l36.631" class="difflineminus">-    DoMAPIFreeBuffer(hWnd, lpRecip, TRUE);</span>
<a href="#l36.632"></a><span id="l36.632" class="difflineminus">-    lpRecip = NULL;</span>
<a href="#l36.633"></a><span id="l36.633" class="difflineminus">-  }</span>
<a href="#l36.634"></a><span id="l36.634" class="difflineminus">-</span>
<a href="#l36.635"></a><span id="l36.635" class="difflineminus">-  char        userName[512];</span>
<a href="#l36.636"></a><span id="l36.636" class="difflineminus">-  char        msg[1024];</span>
<a href="#l36.637"></a><span id="l36.637" class="difflineminus">-  FLAGS       flFlags = 0;    // We support none...</span>
<a href="#l36.638"></a><span id="l36.638" class="difflineminus">-</span>
<a href="#l36.639"></a><span id="l36.639" class="difflineminus">-  GetDlgItemText(hWnd, IDC_EDIT_RESOLVENAME, userName, sizeof(userName));</span>
<a href="#l36.640"></a><span id="l36.640" class="difflineminus">-  LONG  rc = (*lpfnMAPIResolveName)</span>
<a href="#l36.641"></a><span id="l36.641" class="difflineminus">-                      (mapiSession, </span>
<a href="#l36.642"></a><span id="l36.642" class="difflineminus">-                       (ULONG) hWnd, </span>
<a href="#l36.643"></a><span id="l36.643" class="difflineminus">-                       userName,</span>
<a href="#l36.644"></a><span id="l36.644" class="difflineminus">-                       flFlags, </span>
<a href="#l36.645"></a><span id="l36.645" class="difflineminus">-                       0, </span>
<a href="#l36.646"></a><span id="l36.646" class="difflineminus">-                       &amp;lpRecip);</span>
<a href="#l36.647"></a><span id="l36.647" class="difflineminus">-</span>
<a href="#l36.648"></a><span id="l36.648" class="difflineminus">-  // Deal with error up front and return if need be...</span>
<a href="#l36.649"></a><span id="l36.649" class="difflineminus">-  if (rc != SUCCESS_SUCCESS)</span>
<a href="#l36.650"></a><span id="l36.650" class="difflineminus">-  {</span>
<a href="#l36.651"></a><span id="l36.651" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %d from DoMAPIResolveName\nError=[%s]&quot;, </span>
<a href="#l36.652"></a><span id="l36.652" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l36.653"></a><span id="l36.653" class="difflineminus">-</span>
<a href="#l36.654"></a><span id="l36.654" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.655"></a><span id="l36.655" class="difflineminus">-    SetFooter(&quot;DoMAPIResolveName failed&quot;);</span>
<a href="#l36.656"></a><span id="l36.656" class="difflineminus">-    return;</span>
<a href="#l36.657"></a><span id="l36.657" class="difflineminus">-  }</span>
<a href="#l36.658"></a><span id="l36.658" class="difflineminus">-</span>
<a href="#l36.659"></a><span id="l36.659" class="difflineminus">-  // If we get here, we should probably show the information that we</span>
<a href="#l36.660"></a><span id="l36.660" class="difflineminus">-  // got back</span>
<a href="#l36.661"></a><span id="l36.661" class="difflineminus">-  wsprintf(msg, &quot;Received information for %s\nName=[%s]\nAddress=[%s]\nID=[%s]&quot;,</span>
<a href="#l36.662"></a><span id="l36.662" class="difflineminus">-    userName, lpRecip-&gt;lpszName, lpRecip-&gt;lpszAddress, (LPSTR) lpRecip-&gt;lpEntryID);</span>
<a href="#l36.663"></a><span id="l36.663" class="difflineminus">-  ShowMessage(hWnd, msg);</span>
<a href="#l36.664"></a><span id="l36.664" class="difflineminus">-}</span>
<a href="#l36.665"></a><span id="l36.665" class="difflineminus">-</span>
<a href="#l36.666"></a><span id="l36.666" class="difflineminus">-void    </span>
<a href="#l36.667"></a><span id="l36.667" class="difflineminus">-DoMAPIResolveNameFreeBuffer(HWND hWnd)</span>
<a href="#l36.668"></a><span id="l36.668" class="difflineminus">-{</span>
<a href="#l36.669"></a><span id="l36.669" class="difflineminus">-  if (lpRecip == NULL)</span>
<a href="#l36.670"></a><span id="l36.670" class="difflineminus">-  {</span>
<a href="#l36.671"></a><span id="l36.671" class="difflineminus">-    ShowMessage(hWnd, &quot;There is no memory allocated from MAPIResolveName()\nto be freed. Request ignored.&quot;);</span>
<a href="#l36.672"></a><span id="l36.672" class="difflineminus">-  }</span>
<a href="#l36.673"></a><span id="l36.673" class="difflineminus">-  else</span>
<a href="#l36.674"></a><span id="l36.674" class="difflineminus">-  {</span>
<a href="#l36.675"></a><span id="l36.675" class="difflineminus">-    DoMAPIFreeBuffer(hWnd, lpRecip, TRUE);</span>
<a href="#l36.676"></a><span id="l36.676" class="difflineminus">-    lpRecip = NULL;</span>
<a href="#l36.677"></a><span id="l36.677" class="difflineminus">-  }</span>
<a href="#l36.678"></a><span id="l36.678" class="difflineminus">-}</span>
<a href="#l36.679"></a><span id="l36.679" class="difflineminus">-</span>
<a href="#l36.680"></a><span id="l36.680" class="difflineminus">-void</span>
<a href="#l36.681"></a><span id="l36.681" class="difflineminus">-DoMAPIDetails(HWND hWnd)</span>
<a href="#l36.682"></a><span id="l36.682" class="difflineminus">-{</span>
<a href="#l36.683"></a><span id="l36.683" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPIDetails) (LHANDLE lhSession, ULONG ulUIParam, </span>
<a href="#l36.684"></a><span id="l36.684" class="difflineminus">-            lpMapiRecipDesc lpRecip, FLAGS flFlags, ULONG ulReserved);</span>
<a href="#l36.685"></a><span id="l36.685" class="difflineminus">-</span>
<a href="#l36.686"></a><span id="l36.686" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l36.687"></a><span id="l36.687" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIDetails = GetProcAddress(m_hInstMapi, &quot;MAPIDetails&quot;); </span>
<a href="#l36.688"></a><span id="l36.688" class="difflineminus">-#else</span>
<a href="#l36.689"></a><span id="l36.689" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIDetails = GetProcAddress(m_hInstMapi, &quot;MAPIDetails&quot;); </span>
<a href="#l36.690"></a><span id="l36.690" class="difflineminus">-#endif</span>
<a href="#l36.691"></a><span id="l36.691" class="difflineminus">-  </span>
<a href="#l36.692"></a><span id="l36.692" class="difflineminus">-  if (!lpfnMAPIDetails)</span>
<a href="#l36.693"></a><span id="l36.693" class="difflineminus">-  {</span>
<a href="#l36.694"></a><span id="l36.694" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l36.695"></a><span id="l36.695" class="difflineminus">-    return;</span>
<a href="#l36.696"></a><span id="l36.696" class="difflineminus">-  }</span>
<a href="#l36.697"></a><span id="l36.697" class="difflineminus">-</span>
<a href="#l36.698"></a><span id="l36.698" class="difflineminus">-  char        msg[1024];</span>
<a href="#l36.699"></a><span id="l36.699" class="difflineminus">-  FLAGS       flFlags = 0;    // We really don't support these...</span>
<a href="#l36.700"></a><span id="l36.700" class="difflineminus">-</span>
<a href="#l36.701"></a><span id="l36.701" class="difflineminus">-  LONG  rc = (*lpfnMAPIDetails)</span>
<a href="#l36.702"></a><span id="l36.702" class="difflineminus">-              (mapiSession, </span>
<a href="#l36.703"></a><span id="l36.703" class="difflineminus">-              (ULONG) hWnd,</span>
<a href="#l36.704"></a><span id="l36.704" class="difflineminus">-               lpRecip,</span>
<a href="#l36.705"></a><span id="l36.705" class="difflineminus">-               flFlags,</span>
<a href="#l36.706"></a><span id="l36.706" class="difflineminus">-               0);</span>
<a href="#l36.707"></a><span id="l36.707" class="difflineminus">-</span>
<a href="#l36.708"></a><span id="l36.708" class="difflineminus">-  if (rc == SUCCESS_SUCCESS)</span>
<a href="#l36.709"></a><span id="l36.709" class="difflineminus">-  {</span>
<a href="#l36.710"></a><span id="l36.710" class="difflineminus">-</span>
<a href="#l36.711"></a><span id="l36.711" class="difflineminus">-    wsprintf(msg, &quot;MAPIDetails call succeeded&quot;);</span>
<a href="#l36.712"></a><span id="l36.712" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.713"></a><span id="l36.713" class="difflineminus">-    SetFooter(msg);</span>
<a href="#l36.714"></a><span id="l36.714" class="difflineminus">-  }</span>
<a href="#l36.715"></a><span id="l36.715" class="difflineminus">-  else</span>
<a href="#l36.716"></a><span id="l36.716" class="difflineminus">-  {</span>
<a href="#l36.717"></a><span id="l36.717" class="difflineminus">-</span>
<a href="#l36.718"></a><span id="l36.718" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %d from MAPIDetails\nError=[%s]&quot;, </span>
<a href="#l36.719"></a><span id="l36.719" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l36.720"></a><span id="l36.720" class="difflineminus">-</span>
<a href="#l36.721"></a><span id="l36.721" class="difflineminus">-    if (lpRecip == NULL)</span>
<a href="#l36.722"></a><span id="l36.722" class="difflineminus">-    {</span>
<a href="#l36.723"></a><span id="l36.723" class="difflineminus">-      lstrcat(msg, &quot;\nNOTE: There is no valid pointer from a MAPIResolveName()\ncall to show details about.&quot;);</span>
<a href="#l36.724"></a><span id="l36.724" class="difflineminus">-    }</span>
<a href="#l36.725"></a><span id="l36.725" class="difflineminus">-</span>
<a href="#l36.726"></a><span id="l36.726" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.727"></a><span id="l36.727" class="difflineminus">-    SetFooter(&quot;MAPIDetails failed&quot;);</span>
<a href="#l36.728"></a><span id="l36.728" class="difflineminus">-  }</span>
<a href="#l36.729"></a><span id="l36.729" class="difflineminus">-}</span>
<a href="#l36.730"></a><span id="l36.730" class="difflineminus">-</span>
<a href="#l36.731"></a><span id="l36.731" class="difflineminus">-lpMapiMessage </span>
<a href="#l36.732"></a><span id="l36.732" class="difflineminus">-GetMessage(HWND hWnd, LPSTR id)</span>
<a href="#l36.733"></a><span id="l36.733" class="difflineminus">-{</span>
<a href="#l36.734"></a><span id="l36.734" class="difflineminus">-  ULONG (FAR PASCAL *lpfnMAPIReadMail) (LHANDLE lhSession, ULONG ulUIParam, </span>
<a href="#l36.735"></a><span id="l36.735" class="difflineminus">-           LPTSTR lpszMessageID, FLAGS flFlags, ULONG ulReserved, </span>
<a href="#l36.736"></a><span id="l36.736" class="difflineminus">-           lpMapiMessage FAR * lppMessage);</span>
<a href="#l36.737"></a><span id="l36.737" class="difflineminus">-</span>
<a href="#l36.738"></a><span id="l36.738" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l36.739"></a><span id="l36.739" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIReadMail = GetProcAddress(m_hInstMapi, &quot;MAPIREADMAIL&quot;); </span>
<a href="#l36.740"></a><span id="l36.740" class="difflineminus">-#else</span>
<a href="#l36.741"></a><span id="l36.741" class="difflineminus">-  (FARPROC&amp;) lpfnMAPIReadMail = GetProcAddress(m_hInstMapi, &quot;MAPIReadMail&quot;); </span>
<a href="#l36.742"></a><span id="l36.742" class="difflineminus">-#endif</span>
<a href="#l36.743"></a><span id="l36.743" class="difflineminus">-  </span>
<a href="#l36.744"></a><span id="l36.744" class="difflineminus">-  if (!lpfnMAPIReadMail)</span>
<a href="#l36.745"></a><span id="l36.745" class="difflineminus">-  {</span>
<a href="#l36.746"></a><span id="l36.746" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l36.747"></a><span id="l36.747" class="difflineminus">-    return NULL;</span>
<a href="#l36.748"></a><span id="l36.748" class="difflineminus">-  }</span>
<a href="#l36.749"></a><span id="l36.749" class="difflineminus">-</span>
<a href="#l36.750"></a><span id="l36.750" class="difflineminus">-  char            msg[1024];</span>
<a href="#l36.751"></a><span id="l36.751" class="difflineminus">-  lpMapiMessage   lpMessage = NULL;</span>
<a href="#l36.752"></a><span id="l36.752" class="difflineminus">-  FLAGS           flFlags = 0;</span>
<a href="#l36.753"></a><span id="l36.753" class="difflineminus">-</span>
<a href="#l36.754"></a><span id="l36.754" class="difflineminus">-  flFlags |= MAPI_ENVELOPE_ONLY;</span>
<a href="#l36.755"></a><span id="l36.755" class="difflineminus">-  LONG  rc = (*lpfnMAPIReadMail)</span>
<a href="#l36.756"></a><span id="l36.756" class="difflineminus">-          (mapiSession, </span>
<a href="#l36.757"></a><span id="l36.757" class="difflineminus">-          (ULONG) hWnd, </span>
<a href="#l36.758"></a><span id="l36.758" class="difflineminus">-          id,</span>
<a href="#l36.759"></a><span id="l36.759" class="difflineminus">-          flFlags,</span>
<a href="#l36.760"></a><span id="l36.760" class="difflineminus">-          0, </span>
<a href="#l36.761"></a><span id="l36.761" class="difflineminus">-          &amp;lpMessage);</span>
<a href="#l36.762"></a><span id="l36.762" class="difflineminus">-</span>
<a href="#l36.763"></a><span id="l36.763" class="difflineminus">-  // Deal with error up front and return if need be...</span>
<a href="#l36.764"></a><span id="l36.764" class="difflineminus">-  if (rc != SUCCESS_SUCCESS)</span>
<a href="#l36.765"></a><span id="l36.765" class="difflineminus">-  {</span>
<a href="#l36.766"></a><span id="l36.766" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %x from MAPIReadMail\nError=[%s]&quot;, </span>
<a href="#l36.767"></a><span id="l36.767" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l36.768"></a><span id="l36.768" class="difflineminus">-</span>
<a href="#l36.769"></a><span id="l36.769" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.770"></a><span id="l36.770" class="difflineminus">-    SetFooter(&quot;ReadMail failed&quot;);</span>
<a href="#l36.771"></a><span id="l36.771" class="difflineminus">-    return NULL;</span>
<a href="#l36.772"></a><span id="l36.772" class="difflineminus">-  }</span>
<a href="#l36.773"></a><span id="l36.773" class="difflineminus">-</span>
<a href="#l36.774"></a><span id="l36.774" class="difflineminus">-  return(lpMessage);</span>
<a href="#l36.775"></a><span id="l36.775" class="difflineminus">-}</span>
<a href="#l36.776"></a><span id="l36.776" class="difflineminus">-</span>
<a href="#l36.777"></a><span id="l36.777" class="difflineminus">-void    </span>
<a href="#l36.778"></a><span id="l36.778" class="difflineminus">-LoadNSCPVersionFunc(HWND hWnd)</span>
<a href="#l36.779"></a><span id="l36.779" class="difflineminus">-{</span>
<a href="#l36.780"></a><span id="l36.780" class="difflineminus">-  ULONG (FAR PASCAL *lpfnLoadNSCPVersion) ( void );</span>
<a href="#l36.781"></a><span id="l36.781" class="difflineminus">-</span>
<a href="#l36.782"></a><span id="l36.782" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l36.783"></a><span id="l36.783" class="difflineminus">-  (FARPROC&amp;) lpfnLoadNSCPVersion = GetProcAddress(m_hInstMapi, &quot;MAPIGETNERSCAPEVERSION&quot;); </span>
<a href="#l36.784"></a><span id="l36.784" class="difflineminus">-#else</span>
<a href="#l36.785"></a><span id="l36.785" class="difflineminus">-  (FARPROC&amp;) lpfnLoadNSCPVersion = GetProcAddress(m_hInstMapi, &quot;MAPIGetNetscapeVersion&quot;); </span>
<a href="#l36.786"></a><span id="l36.786" class="difflineminus">-#endif</span>
<a href="#l36.787"></a><span id="l36.787" class="difflineminus">-  </span>
<a href="#l36.788"></a><span id="l36.788" class="difflineminus">-  if (!lpfnLoadNSCPVersion)</span>
<a href="#l36.789"></a><span id="l36.789" class="difflineminus">-  {</span>
<a href="#l36.790"></a><span id="l36.790" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPIGetNetscapeVersion() function.&quot;);</span>
<a href="#l36.791"></a><span id="l36.791" class="difflineminus">-  }</span>
<a href="#l36.792"></a><span id="l36.792" class="difflineminus">-  else</span>
<a href="#l36.793"></a><span id="l36.793" class="difflineminus">-  {</span>
<a href="#l36.794"></a><span id="l36.794" class="difflineminus">-    ShowMessage(hWnd, &quot;MAPIGetNetscapeVersion() function was FOUND!&quot;);</span>
<a href="#l36.795"></a><span id="l36.795" class="difflineminus">-  }</span>
<a href="#l36.796"></a><span id="l36.796" class="difflineminus">-  return;</span>
<a href="#l36.797"></a><span id="l36.797" class="difflineminus">-}</span>
<a href="#l36.798"></a><span id="l36.798" class="difflineminus">-</span>
<a href="#l36.799"></a><span id="l36.799" class="difflineminus">-void    </span>
<a href="#l36.800"></a><span id="l36.800" class="difflineminus">-DoMAPI_NSCP_Sync(HWND hWnd)</span>
<a href="#l36.801"></a><span id="l36.801" class="difflineminus">-{</span>
<a href="#l36.802"></a><span id="l36.802" class="difflineminus">-ULONG (FAR PASCAL *lpfnNSCPSync) ( LHANDLE lhSession,</span>
<a href="#l36.803"></a><span id="l36.803" class="difflineminus">-                                          ULONG ulReserved );</span>
<a href="#l36.804"></a><span id="l36.804" class="difflineminus">-#ifdef WIN16		</span>
<a href="#l36.805"></a><span id="l36.805" class="difflineminus">-  (FARPROC&amp;) lpfnNSCPSync = GetProcAddress(m_hInstMapi, &quot;MAPI_NSCP_SYNCHRONIZECLIENT&quot;); </span>
<a href="#l36.806"></a><span id="l36.806" class="difflineminus">-#else</span>
<a href="#l36.807"></a><span id="l36.807" class="difflineminus">-  (FARPROC&amp;) lpfnNSCPSync = GetProcAddress(m_hInstMapi, &quot;MAPI_NSCP_SynchronizeClient&quot;); </span>
<a href="#l36.808"></a><span id="l36.808" class="difflineminus">-#endif</span>
<a href="#l36.809"></a><span id="l36.809" class="difflineminus">-</span>
<a href="#l36.810"></a><span id="l36.810" class="difflineminus">-  if (!lpfnNSCPSync)</span>
<a href="#l36.811"></a><span id="l36.811" class="difflineminus">-  {</span>
<a href="#l36.812"></a><span id="l36.812" class="difflineminus">-    ShowMessage(hWnd, &quot;Unable to locate MAPI function.&quot;);</span>
<a href="#l36.813"></a><span id="l36.813" class="difflineminus">-    return;</span>
<a href="#l36.814"></a><span id="l36.814" class="difflineminus">-  }</span>
<a href="#l36.815"></a><span id="l36.815" class="difflineminus">-</span>
<a href="#l36.816"></a><span id="l36.816" class="difflineminus">-  LONG  rc = (*lpfnNSCPSync) (mapiSession, 0);</span>
<a href="#l36.817"></a><span id="l36.817" class="difflineminus">-</span>
<a href="#l36.818"></a><span id="l36.818" class="difflineminus">-  char    msg[256];</span>
<a href="#l36.819"></a><span id="l36.819" class="difflineminus">-</span>
<a href="#l36.820"></a><span id="l36.820" class="difflineminus">-  // Deal with error up front and return if need be...</span>
<a href="#l36.821"></a><span id="l36.821" class="difflineminus">-  if (rc != SUCCESS_SUCCESS)</span>
<a href="#l36.822"></a><span id="l36.822" class="difflineminus">-  {</span>
<a href="#l36.823"></a><span id="l36.823" class="difflineminus">-    wsprintf(msg, &quot;FAILURE: Return code %d from MAPI_NSCP_SynchronizeClient\nError=[%s]&quot;, </span>
<a href="#l36.824"></a><span id="l36.824" class="difflineminus">-                      rc, GetMAPIError(rc));</span>
<a href="#l36.825"></a><span id="l36.825" class="difflineminus">-</span>
<a href="#l36.826"></a><span id="l36.826" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.827"></a><span id="l36.827" class="difflineminus">-    SetFooter(&quot;MAPI_NSCP_SynchronizeClient failed&quot;);</span>
<a href="#l36.828"></a><span id="l36.828" class="difflineminus">-    return;</span>
<a href="#l36.829"></a><span id="l36.829" class="difflineminus">-  }</span>
<a href="#l36.830"></a><span id="l36.830" class="difflineminus">-  else</span>
<a href="#l36.831"></a><span id="l36.831" class="difflineminus">-  {</span>
<a href="#l36.832"></a><span id="l36.832" class="difflineminus">-    wsprintf(msg, &quot;Success for MAPI_NSCP_SynchronizeClient&quot;);    </span>
<a href="#l36.833"></a><span id="l36.833" class="difflineminus">-    ShowMessage(hWnd, msg);</span>
<a href="#l36.834"></a><span id="l36.834" class="difflineminus">-    SetFooter(&quot;MAPI_NSCP_SynchronizeClient success&quot;);</span>
<a href="#l36.835"></a><span id="l36.835" class="difflineminus">-  }</span>
<a href="#l36.836"></a><span id="l36.836" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1">deleted file mode 100644</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/mapitest.dep</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineplus">+++ /dev/null</span>
<a href="#l37.4"></a><span id="l37.4" class="difflineat">@@ -1,25 +0,0 @@</span>
<a href="#l37.5"></a><span id="l37.5" class="difflineminus">-# Microsoft Developer Studio Generated Dependency File, included by mapitest.mak</span>
<a href="#l37.6"></a><span id="l37.6" class="difflineminus">-</span>
<a href="#l37.7"></a><span id="l37.7" class="difflineminus">-.\main.cpp : \</span>
<a href="#l37.8"></a><span id="l37.8" class="difflineminus">-	&quot;.\port.h&quot;\</span>
<a href="#l37.9"></a><span id="l37.9" class="difflineminus">-	&quot;c:\program files\msdev\vc98\include\basetsd.h&quot;\</span>
<a href="#l37.10"></a><span id="l37.10" class="difflineminus">-	</span>
<a href="#l37.11"></a><span id="l37.11" class="difflineminus">-</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-.\mapimail.cpp : \</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-	&quot;.\port.h&quot;\</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">-	&quot;c:\program files\msdev\vc98\include\basetsd.h&quot;\</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineminus">-	</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineminus">-</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineminus">-.\mapiproc.cpp : \</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineminus">-	&quot;.\port.h&quot;\</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineminus">-	&quot;c:\program files\msdev\vc98\include\basetsd.h&quot;\</span>
<a href="#l37.20"></a><span id="l37.20" class="difflineminus">-	</span>
<a href="#l37.21"></a><span id="l37.21" class="difflineminus">-</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineminus">-.\mtest32.rc : \</span>
<a href="#l37.23"></a><span id="l37.23" class="difflineminus">-	&quot;.\nscicon.ico&quot;\</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineminus">-	</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineminus">-</span>
<a href="#l37.26"></a><span id="l37.26" class="difflineminus">-.\readmail.cpp : \</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineminus">-	&quot;.\port.h&quot;\</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineminus">-	&quot;c:\program files\msdev\vc98\include\basetsd.h&quot;\</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineminus">-	</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1">deleted file mode 100644</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/mapitest.dsp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineplus">+++ /dev/null</span>
<a href="#l38.4"></a><span id="l38.4" class="difflineat">@@ -1,121 +0,0 @@</span>
<a href="#l38.5"></a><span id="l38.5" class="difflineminus">-# Microsoft Developer Studio Project File - Name=&quot;mapitest&quot; - Package Owner=&lt;4&gt;</span>
<a href="#l38.6"></a><span id="l38.6" class="difflineminus">-# Microsoft Developer Studio Generated Build File, Format Version 6.00</span>
<a href="#l38.7"></a><span id="l38.7" class="difflineminus">-# ** DO NOT EDIT **</span>
<a href="#l38.8"></a><span id="l38.8" class="difflineminus">-</span>
<a href="#l38.9"></a><span id="l38.9" class="difflineminus">-# TARGTYPE &quot;Win32 (x86) Application&quot; 0x0101</span>
<a href="#l38.10"></a><span id="l38.10" class="difflineminus">-</span>
<a href="#l38.11"></a><span id="l38.11" class="difflineminus">-CFG=mapitest - Win32 Debug</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-!MESSAGE This is not a valid makefile. To build this project using NMAKE,</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineminus">-!MESSAGE use the Export Makefile command and run</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineminus">-!MESSAGE </span>
<a href="#l38.15"></a><span id="l38.15" class="difflineminus">-!MESSAGE NMAKE /f &quot;mapitest.mak&quot;.</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineminus">-!MESSAGE </span>
<a href="#l38.17"></a><span id="l38.17" class="difflineminus">-!MESSAGE You can specify a configuration when running NMAKE</span>
<a href="#l38.18"></a><span id="l38.18" class="difflineminus">-!MESSAGE by defining the macro CFG on the command line. For example:</span>
<a href="#l38.19"></a><span id="l38.19" class="difflineminus">-!MESSAGE </span>
<a href="#l38.20"></a><span id="l38.20" class="difflineminus">-!MESSAGE NMAKE /f &quot;mapitest.mak&quot; CFG=&quot;mapitest - Win32 Debug&quot;</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineminus">-!MESSAGE </span>
<a href="#l38.22"></a><span id="l38.22" class="difflineminus">-!MESSAGE Possible choices for configuration are:</span>
<a href="#l38.23"></a><span id="l38.23" class="difflineminus">-!MESSAGE </span>
<a href="#l38.24"></a><span id="l38.24" class="difflineminus">-!MESSAGE &quot;mapitest - Win32 Release&quot; (based on &quot;Win32 (x86) Application&quot;)</span>
<a href="#l38.25"></a><span id="l38.25" class="difflineminus">-!MESSAGE &quot;mapitest - Win32 Debug&quot; (based on &quot;Win32 (x86) Application&quot;)</span>
<a href="#l38.26"></a><span id="l38.26" class="difflineminus">-!MESSAGE </span>
<a href="#l38.27"></a><span id="l38.27" class="difflineminus">-</span>
<a href="#l38.28"></a><span id="l38.28" class="difflineminus">-# Begin Project</span>
<a href="#l38.29"></a><span id="l38.29" class="difflineminus">-# PROP AllowPerConfigDependencies 0</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineminus">-# PROP Scc_ProjName &quot;&quot;</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-# PROP Scc_LocalPath &quot;&quot;</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineminus">-CPP=cl.exe</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineminus">-MTL=midl.exe</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineminus">-RSC=rc.exe</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineminus">-</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineminus">-!IF  &quot;$(CFG)&quot; == &quot;mapitest - Win32 Release&quot;</span>
<a href="#l38.37"></a><span id="l38.37" class="difflineminus">-</span>
<a href="#l38.38"></a><span id="l38.38" class="difflineminus">-# PROP BASE Use_MFC 0</span>
<a href="#l38.39"></a><span id="l38.39" class="difflineminus">-# PROP BASE Use_Debug_Libraries 0</span>
<a href="#l38.40"></a><span id="l38.40" class="difflineminus">-# PROP BASE Output_Dir &quot;Release&quot;</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineminus">-# PROP BASE Intermediate_Dir &quot;Release&quot;</span>
<a href="#l38.42"></a><span id="l38.42" class="difflineminus">-# PROP BASE Target_Dir &quot;&quot;</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineminus">-# PROP Use_MFC 0</span>
<a href="#l38.44"></a><span id="l38.44" class="difflineminus">-# PROP Use_Debug_Libraries 0</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineminus">-# PROP Output_Dir &quot;Release&quot;</span>
<a href="#l38.46"></a><span id="l38.46" class="difflineminus">-# PROP Intermediate_Dir &quot;Release&quot;</span>
<a href="#l38.47"></a><span id="l38.47" class="difflineminus">-# PROP Target_Dir &quot;&quot;</span>
<a href="#l38.48"></a><span id="l38.48" class="difflineminus">-# ADD BASE CPP /nologo /W3 /GX /O2 /D &quot;WIN32&quot; /D &quot;NDEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /YX /FD /c</span>
<a href="#l38.49"></a><span id="l38.49" class="difflineminus">-# ADD CPP /nologo /W3 /GX /O2 /D &quot;WIN32&quot; /D &quot;NDEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /YX /FD /c</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-# ADD BASE MTL /nologo /D &quot;NDEBUG&quot; /mktyplib203 /win32</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineminus">-# ADD MTL /nologo /D &quot;NDEBUG&quot; /mktyplib203 /win32</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineminus">-# ADD BASE RSC /l 0x409 /d &quot;NDEBUG&quot;</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineminus">-# ADD RSC /l 0x409 /d &quot;NDEBUG&quot;</span>
<a href="#l38.54"></a><span id="l38.54" class="difflineminus">-BSC32=bscmake.exe</span>
<a href="#l38.55"></a><span id="l38.55" class="difflineminus">-# ADD BASE BSC32 /nologo</span>
<a href="#l38.56"></a><span id="l38.56" class="difflineminus">-# ADD BSC32 /nologo</span>
<a href="#l38.57"></a><span id="l38.57" class="difflineminus">-LINK32=link.exe</span>
<a href="#l38.58"></a><span id="l38.58" class="difflineminus">-# ADD BASE LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /subsystem:windows /machine:I386</span>
<a href="#l38.59"></a><span id="l38.59" class="difflineminus">-# ADD LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /subsystem:windows /machine:I386</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineminus">-</span>
<a href="#l38.61"></a><span id="l38.61" class="difflineminus">-!ELSEIF  &quot;$(CFG)&quot; == &quot;mapitest - Win32 Debug&quot;</span>
<a href="#l38.62"></a><span id="l38.62" class="difflineminus">-</span>
<a href="#l38.63"></a><span id="l38.63" class="difflineminus">-# PROP BASE Use_MFC 0</span>
<a href="#l38.64"></a><span id="l38.64" class="difflineminus">-# PROP BASE Use_Debug_Libraries 1</span>
<a href="#l38.65"></a><span id="l38.65" class="difflineminus">-# PROP BASE Output_Dir &quot;Debug&quot;</span>
<a href="#l38.66"></a><span id="l38.66" class="difflineminus">-# PROP BASE Intermediate_Dir &quot;Debug&quot;</span>
<a href="#l38.67"></a><span id="l38.67" class="difflineminus">-# PROP BASE Target_Dir &quot;&quot;</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineminus">-# PROP Use_MFC 0</span>
<a href="#l38.69"></a><span id="l38.69" class="difflineminus">-# PROP Use_Debug_Libraries 1</span>
<a href="#l38.70"></a><span id="l38.70" class="difflineminus">-# PROP Output_Dir &quot;Debug&quot;</span>
<a href="#l38.71"></a><span id="l38.71" class="difflineminus">-# PROP Intermediate_Dir &quot;Debug&quot;</span>
<a href="#l38.72"></a><span id="l38.72" class="difflineminus">-# PROP Target_Dir &quot;&quot;</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineminus">-# ADD BASE CPP /nologo /W3 /Gm /GX /ZI /Od /D &quot;WIN32&quot; /D &quot;_DEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /YX /FD /GZ /c</span>
<a href="#l38.74"></a><span id="l38.74" class="difflineminus">-# ADD CPP /nologo /W3 /Gm /GX /ZI /Od /D &quot;WIN32&quot; /D &quot;_DEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /YX /FD /GZ /c</span>
<a href="#l38.75"></a><span id="l38.75" class="difflineminus">-# ADD BASE MTL /nologo /D &quot;_DEBUG&quot; /mktyplib203 /win32</span>
<a href="#l38.76"></a><span id="l38.76" class="difflineminus">-# ADD MTL /nologo /D &quot;_DEBUG&quot; /mktyplib203 /win32</span>
<a href="#l38.77"></a><span id="l38.77" class="difflineminus">-# ADD BASE RSC /l 0x409 /d &quot;_DEBUG&quot;</span>
<a href="#l38.78"></a><span id="l38.78" class="difflineminus">-# ADD RSC /l 0x409 /d &quot;_DEBUG&quot;</span>
<a href="#l38.79"></a><span id="l38.79" class="difflineminus">-BSC32=bscmake.exe</span>
<a href="#l38.80"></a><span id="l38.80" class="difflineminus">-# ADD BASE BSC32 /nologo</span>
<a href="#l38.81"></a><span id="l38.81" class="difflineminus">-# ADD BSC32 /nologo</span>
<a href="#l38.82"></a><span id="l38.82" class="difflineminus">-LINK32=link.exe</span>
<a href="#l38.83"></a><span id="l38.83" class="difflineminus">-# ADD BASE LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /subsystem:windows /debug /machine:I386 /pdbtype:sept</span>
<a href="#l38.84"></a><span id="l38.84" class="difflineminus">-# ADD LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /subsystem:windows /debug /machine:I386 /pdbtype:sept</span>
<a href="#l38.85"></a><span id="l38.85" class="difflineminus">-</span>
<a href="#l38.86"></a><span id="l38.86" class="difflineminus">-!ENDIF </span>
<a href="#l38.87"></a><span id="l38.87" class="difflineminus">-</span>
<a href="#l38.88"></a><span id="l38.88" class="difflineminus">-# Begin Target</span>
<a href="#l38.89"></a><span id="l38.89" class="difflineminus">-</span>
<a href="#l38.90"></a><span id="l38.90" class="difflineminus">-# Name &quot;mapitest - Win32 Release&quot;</span>
<a href="#l38.91"></a><span id="l38.91" class="difflineminus">-# Name &quot;mapitest - Win32 Debug&quot;</span>
<a href="#l38.92"></a><span id="l38.92" class="difflineminus">-# Begin Group &quot;Source Files&quot;</span>
<a href="#l38.93"></a><span id="l38.93" class="difflineminus">-</span>
<a href="#l38.94"></a><span id="l38.94" class="difflineminus">-# PROP Default_Filter &quot;cpp;c;cxx;rc;def;r;odl;idl;hpj;bat&quot;</span>
<a href="#l38.95"></a><span id="l38.95" class="difflineminus">-# Begin Source File</span>
<a href="#l38.96"></a><span id="l38.96" class="difflineminus">-</span>
<a href="#l38.97"></a><span id="l38.97" class="difflineminus">-SOURCE=.\main.cpp</span>
<a href="#l38.98"></a><span id="l38.98" class="difflineminus">-# End Source File</span>
<a href="#l38.99"></a><span id="l38.99" class="difflineminus">-# Begin Source File</span>
<a href="#l38.100"></a><span id="l38.100" class="difflineminus">-</span>
<a href="#l38.101"></a><span id="l38.101" class="difflineminus">-SOURCE=.\mapimail.cpp</span>
<a href="#l38.102"></a><span id="l38.102" class="difflineminus">-# End Source File</span>
<a href="#l38.103"></a><span id="l38.103" class="difflineminus">-# Begin Source File</span>
<a href="#l38.104"></a><span id="l38.104" class="difflineminus">-</span>
<a href="#l38.105"></a><span id="l38.105" class="difflineminus">-SOURCE=.\mapiproc.cpp</span>
<a href="#l38.106"></a><span id="l38.106" class="difflineminus">-# End Source File</span>
<a href="#l38.107"></a><span id="l38.107" class="difflineminus">-# Begin Source File</span>
<a href="#l38.108"></a><span id="l38.108" class="difflineminus">-</span>
<a href="#l38.109"></a><span id="l38.109" class="difflineminus">-SOURCE=.\mtest32.rc</span>
<a href="#l38.110"></a><span id="l38.110" class="difflineminus">-# End Source File</span>
<a href="#l38.111"></a><span id="l38.111" class="difflineminus">-# Begin Source File</span>
<a href="#l38.112"></a><span id="l38.112" class="difflineminus">-</span>
<a href="#l38.113"></a><span id="l38.113" class="difflineminus">-SOURCE=.\readmail.cpp</span>
<a href="#l38.114"></a><span id="l38.114" class="difflineminus">-# End Source File</span>
<a href="#l38.115"></a><span id="l38.115" class="difflineminus">-# End Group</span>
<a href="#l38.116"></a><span id="l38.116" class="difflineminus">-# Begin Group &quot;Header Files&quot;</span>
<a href="#l38.117"></a><span id="l38.117" class="difflineminus">-</span>
<a href="#l38.118"></a><span id="l38.118" class="difflineminus">-# PROP Default_Filter &quot;h;hpp;hxx;hm;inl&quot;</span>
<a href="#l38.119"></a><span id="l38.119" class="difflineminus">-# End Group</span>
<a href="#l38.120"></a><span id="l38.120" class="difflineminus">-# Begin Group &quot;Resource Files&quot;</span>
<a href="#l38.121"></a><span id="l38.121" class="difflineminus">-</span>
<a href="#l38.122"></a><span id="l38.122" class="difflineminus">-# PROP Default_Filter &quot;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe&quot;</span>
<a href="#l38.123"></a><span id="l38.123" class="difflineminus">-# End Group</span>
<a href="#l38.124"></a><span id="l38.124" class="difflineminus">-# End Target</span>
<a href="#l38.125"></a><span id="l38.125" class="difflineminus">-# End Project</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1">deleted file mode 100644</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/mapitest.dsw</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineplus">+++ /dev/null</span>
<a href="#l39.4"></a><span id="l39.4" class="difflineat">@@ -1,29 +0,0 @@</span>
<a href="#l39.5"></a><span id="l39.5" class="difflineminus">-Microsoft Developer Studio Workspace File, Format Version 6.00</span>
<a href="#l39.6"></a><span id="l39.6" class="difflineminus">-# WARNING: DO NOT EDIT OR DELETE THIS WORKSPACE FILE!</span>
<a href="#l39.7"></a><span id="l39.7" class="difflineminus">-</span>
<a href="#l39.8"></a><span id="l39.8" class="difflineminus">-###############################################################################</span>
<a href="#l39.9"></a><span id="l39.9" class="difflineminus">-</span>
<a href="#l39.10"></a><span id="l39.10" class="difflineminus">-Project: &quot;mapitest&quot;=.\mapitest.dsp - Package Owner=&lt;4&gt;</span>
<a href="#l39.11"></a><span id="l39.11" class="difflineminus">-</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-Package=&lt;5&gt;</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineminus">-{{{</span>
<a href="#l39.14"></a><span id="l39.14" class="difflineminus">-}}}</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineminus">-</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineminus">-Package=&lt;4&gt;</span>
<a href="#l39.17"></a><span id="l39.17" class="difflineminus">-{{{</span>
<a href="#l39.18"></a><span id="l39.18" class="difflineminus">-}}}</span>
<a href="#l39.19"></a><span id="l39.19" class="difflineminus">-</span>
<a href="#l39.20"></a><span id="l39.20" class="difflineminus">-###############################################################################</span>
<a href="#l39.21"></a><span id="l39.21" class="difflineminus">-</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineminus">-Global:</span>
<a href="#l39.23"></a><span id="l39.23" class="difflineminus">-</span>
<a href="#l39.24"></a><span id="l39.24" class="difflineminus">-Package=&lt;5&gt;</span>
<a href="#l39.25"></a><span id="l39.25" class="difflineminus">-{{{</span>
<a href="#l39.26"></a><span id="l39.26" class="difflineminus">-}}}</span>
<a href="#l39.27"></a><span id="l39.27" class="difflineminus">-</span>
<a href="#l39.28"></a><span id="l39.28" class="difflineminus">-Package=&lt;3&gt;</span>
<a href="#l39.29"></a><span id="l39.29" class="difflineminus">-{{{</span>
<a href="#l39.30"></a><span id="l39.30" class="difflineminus">-}}}</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineminus">-###############################################################################</span>
<a href="#l39.33"></a><span id="l39.33" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1">deleted file mode 100644</span>
<a href="#l40.2"></a><span id="l40.2">index 9fbede73a9d8d21a44f0e61c6af1560f5686a5c5..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l40.3"></a><span id="l40.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1">deleted file mode 100644</span>
<a href="#l41.2"></a><span id="l41.2">index 0bb8136ea821499d71242de2aba948c9d8d5b6e4..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l41.3"></a><span id="l41.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1">deleted file mode 100644</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/mapitest.plg</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineplus">+++ /dev/null</span>
<a href="#l42.4"></a><span id="l42.4" class="difflineat">@@ -1,44 +0,0 @@</span>
<a href="#l42.5"></a><span id="l42.5" class="difflineminus">-&lt;html&gt;</span>
<a href="#l42.6"></a><span id="l42.6" class="difflineminus">-&lt;body&gt;</span>
<a href="#l42.7"></a><span id="l42.7" class="difflineminus">-&lt;pre&gt;</span>
<a href="#l42.8"></a><span id="l42.8" class="difflineminus">-&lt;h1&gt;Build Log&lt;/h1&gt;</span>
<a href="#l42.9"></a><span id="l42.9" class="difflineminus">-&lt;h3&gt;</span>
<a href="#l42.10"></a><span id="l42.10" class="difflineminus">---------------------Configuration: mapitest - Win32 Debug--------------------</span>
<a href="#l42.11"></a><span id="l42.11" class="difflineminus">-&lt;/h3&gt;</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-&lt;h3&gt;Command Lines&lt;/h3&gt;</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineminus">-Creating command line &quot;rc.exe /l 0x409 /fo&quot;Debug/mtest32.res&quot; /d &quot;_DEBUG&quot; &quot;Y:\mozilla\mailnews\mapi\tests\mapitest\mtest32.rc&quot;&quot; </span>
<a href="#l42.14"></a><span id="l42.14" class="difflineminus">-Creating temporary file &quot;C:\TEMP\RSP38A.tmp&quot; with contents</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineminus">-[</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineminus">-/nologo /MLd /W3 /Gm /GX /ZI /Od /D &quot;WIN32&quot; /D &quot;_DEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /Fp&quot;Debug/mapitest.pch&quot; /YX /Fo&quot;Debug/&quot; /Fd&quot;Debug/&quot; /FD /GZ /c </span>
<a href="#l42.17"></a><span id="l42.17" class="difflineminus">-&quot;Y:\mozilla\mailnews\mapi\tests\mapitest\readmail.cpp&quot;</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineminus">-&quot;Y:\mozilla\mailnews\mapi\tests\mapitest\mapimail.cpp&quot;</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineminus">-&quot;Y:\mozilla\mailnews\mapi\tests\mapitest\mapiproc.cpp&quot;</span>
<a href="#l42.20"></a><span id="l42.20" class="difflineminus">-&quot;Y:\mozilla\mailnews\mapi\tests\mapitest\main.cpp&quot;</span>
<a href="#l42.21"></a><span id="l42.21" class="difflineminus">-]</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineminus">-Creating command line &quot;cl.exe @C:\TEMP\RSP38A.tmp&quot; </span>
<a href="#l42.23"></a><span id="l42.23" class="difflineminus">-Creating temporary file &quot;C:\TEMP\RSP38B.tmp&quot; with contents</span>
<a href="#l42.24"></a><span id="l42.24" class="difflineminus">-[</span>
<a href="#l42.25"></a><span id="l42.25" class="difflineminus">-kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /subsystem:windows /incremental:yes /pdb:&quot;Debug/mapitest.pdb&quot; /debug /machine:I386 /out:&quot;Debug/mapitest.exe&quot; /pdbtype:sept </span>
<a href="#l42.26"></a><span id="l42.26" class="difflineminus">-.\Debug\readmail.obj</span>
<a href="#l42.27"></a><span id="l42.27" class="difflineminus">-.\Debug\mapimail.obj</span>
<a href="#l42.28"></a><span id="l42.28" class="difflineminus">-.\Debug\mapiproc.obj</span>
<a href="#l42.29"></a><span id="l42.29" class="difflineminus">-.\Debug\mtest32.res</span>
<a href="#l42.30"></a><span id="l42.30" class="difflineminus">-.\Debug\main.obj</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-]</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineminus">-Creating command line &quot;link.exe @C:\TEMP\RSP38B.tmp&quot;</span>
<a href="#l42.33"></a><span id="l42.33" class="difflineminus">-&lt;h3&gt;Output Window&lt;/h3&gt;</span>
<a href="#l42.34"></a><span id="l42.34" class="difflineminus">-Compiling resources...</span>
<a href="#l42.35"></a><span id="l42.35" class="difflineminus">-Compiling...</span>
<a href="#l42.36"></a><span id="l42.36" class="difflineminus">-readmail.cpp</span>
<a href="#l42.37"></a><span id="l42.37" class="difflineminus">-mapimail.cpp</span>
<a href="#l42.38"></a><span id="l42.38" class="difflineminus">-mapiproc.cpp</span>
<a href="#l42.39"></a><span id="l42.39" class="difflineminus">-main.cpp</span>
<a href="#l42.40"></a><span id="l42.40" class="difflineminus">-Linking...</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineminus">-</span>
<a href="#l42.42"></a><span id="l42.42" class="difflineminus">-</span>
<a href="#l42.43"></a><span id="l42.43" class="difflineminus">-</span>
<a href="#l42.44"></a><span id="l42.44" class="difflineminus">-&lt;h3&gt;Results&lt;/h3&gt;</span>
<a href="#l42.45"></a><span id="l42.45" class="difflineminus">-mapitest.exe - 0 error(s), 0 warning(s)</span>
<a href="#l42.46"></a><span id="l42.46" class="difflineminus">-&lt;/pre&gt;</span>
<a href="#l42.47"></a><span id="l42.47" class="difflineminus">-&lt;/body&gt;</span>
<a href="#l42.48"></a><span id="l42.48" class="difflineminus">-&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1">deleted file mode 100644</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/mtest32.rc</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineplus">+++ /dev/null</span>
<a href="#l43.4"></a><span id="l43.4" class="difflineat">@@ -1,245 +0,0 @@</span>
<a href="#l43.5"></a><span id="l43.5" class="difflineminus">-//Microsoft Developer Studio generated resource script.</span>
<a href="#l43.6"></a><span id="l43.6" class="difflineminus">-//</span>
<a href="#l43.7"></a><span id="l43.7" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l43.8"></a><span id="l43.8" class="difflineminus">-</span>
<a href="#l43.9"></a><span id="l43.9" class="difflineminus">-#define APSTUDIO_READONLY_SYMBOLS</span>
<a href="#l43.10"></a><span id="l43.10" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l43.11"></a><span id="l43.11" class="difflineminus">-//</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-// Generated from the TEXTINCLUDE 2 resource.</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineminus">-//</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineminus">-#include &quot;afxres.h&quot;</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineminus">-</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineminus">-#undef APSTUDIO_READONLY_SYMBOLS</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineminus">-</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l43.20"></a><span id="l43.20" class="difflineminus">-// English (U.S.) resources</span>
<a href="#l43.21"></a><span id="l43.21" class="difflineminus">-</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineminus">-#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_ENU)</span>
<a href="#l43.23"></a><span id="l43.23" class="difflineminus">-#ifdef _WIN32</span>
<a href="#l43.24"></a><span id="l43.24" class="difflineminus">-LANGUAGE LANG_ENGLISH, SUBLANG_ENGLISH_US</span>
<a href="#l43.25"></a><span id="l43.25" class="difflineminus">-#pragma code_page(1252)</span>
<a href="#l43.26"></a><span id="l43.26" class="difflineminus">-#endif //_WIN32</span>
<a href="#l43.27"></a><span id="l43.27" class="difflineminus">-</span>
<a href="#l43.28"></a><span id="l43.28" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l43.29"></a><span id="l43.29" class="difflineminus">-//</span>
<a href="#l43.30"></a><span id="l43.30" class="difflineminus">-// Dialog</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-//</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineminus">-</span>
<a href="#l43.33"></a><span id="l43.33" class="difflineminus">-ID_DIALOG DIALOG DISCARDABLE  0, 0, 344, 229</span>
<a href="#l43.34"></a><span id="l43.34" class="difflineminus">-STYLE DS_MODALFRAME | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU</span>
<a href="#l43.35"></a><span id="l43.35" class="difflineminus">-CAPTION &quot;Netscape MAPI Test Harness&quot;</span>
<a href="#l43.36"></a><span id="l43.36" class="difflineminus">-MENU ID_MENU</span>
<a href="#l43.37"></a><span id="l43.37" class="difflineminus">-FONT 8, &quot;MS Sans Serif&quot;</span>
<a href="#l43.38"></a><span id="l43.38" class="difflineminus">-BEGIN</span>
<a href="#l43.39"></a><span id="l43.39" class="difflineminus">-    GROUPBOX        &quot;Open/Close&quot;,IDC_STATIC,4,4,336,27</span>
<a href="#l43.40"></a><span id="l43.40" class="difflineminus">-    LTEXT           &quot;User:&quot;,IDC_STATIC,9,17,18,11</span>
<a href="#l43.41"></a><span id="l43.41" class="difflineminus">-    EDITTEXT        ID_EDIT_USERNAME,28,15,41,12,ES_AUTOHSCROLL</span>
<a href="#l43.42"></a><span id="l43.42" class="difflineminus">-    LTEXT           &quot;Password:&quot;,IDC_STATIC,74,17,38,11</span>
<a href="#l43.43"></a><span id="l43.43" class="difflineminus">-    EDITTEXT        ID_EDIT_PW,112,15,41,12,ES_PASSWORD | ES_AUTOHSCROLL</span>
<a href="#l43.44"></a><span id="l43.44" class="difflineminus">-    PUSHBUTTON      &quot;MAPILogon&quot;,ID_BUTTON_LOGON,157,13,46,14</span>
<a href="#l43.45"></a><span id="l43.45" class="difflineminus">-    PUSHBUTTON      &quot;MAPILogoff&quot;,ID_BUTTON_LOGOFF,209,13,46,14</span>
<a href="#l43.46"></a><span id="l43.46" class="difflineminus">-    GROUPBOX        &quot;Mail Operations&quot;,IDC_STATIC,4,36,336,142</span>
<a href="#l43.47"></a><span id="l43.47" class="difflineminus">-    PUSHBUTTON      &quot;MAPIFindNext&quot;,ID_BUTTON_FINDNEXT,17,50,57,14</span>
<a href="#l43.48"></a><span id="l43.48" class="difflineminus">-    PUSHBUTTON      &quot;MAPIDeleteMail&quot;,ID_BUTTON_DELETEMAIL,80,50,57,14</span>
<a href="#l43.49"></a><span id="l43.49" class="difflineminus">-    PUSHBUTTON      &quot;Clear Results&quot;,ID_BUTTON_CLEAR,143,50,57,14</span>
<a href="#l43.50"></a><span id="l43.50" class="difflineminus">-    PUSHBUTTON      &quot;Send Mail&quot;,ID_BUTTON_MAIL,206,50,57,14</span>
<a href="#l43.51"></a><span id="l43.51" class="difflineminus">-    LISTBOX         ID_LIST_RESULT,9,66,325,56,LBS_SORT | </span>
<a href="#l43.52"></a><span id="l43.52" class="difflineminus">-                    LBS_NOINTEGRALHEIGHT | WS_VSCROLL | WS_HSCROLL | </span>
<a href="#l43.53"></a><span id="l43.53" class="difflineminus">-                    WS_TABSTOP</span>
<a href="#l43.54"></a><span id="l43.54" class="difflineminus">-    GROUPBOX        &quot;User Information&quot;,IDC_STATIC,4,181,336,28</span>
<a href="#l43.55"></a><span id="l43.55" class="difflineminus">-    PUSHBUTTON      &quot;MAPIResolveName&quot;,ID_BUTTON_RESOLVENAME,9,192,68,14</span>
<a href="#l43.56"></a><span id="l43.56" class="difflineminus">-    EDITTEXT        IDC_EDIT_RESOLVENAME,82,192,130,14,ES_AUTOHSCROLL</span>
<a href="#l43.57"></a><span id="l43.57" class="difflineminus">-    PUSHBUTTON      &quot;MAPIDetails&quot;,ID_BUTTON_DETAILS,219,192,48,14</span>
<a href="#l43.58"></a><span id="l43.58" class="difflineminus">-    LTEXT           &quot;&quot;,ID_STATIC_RESULT,4,214,336,13,SS_SUNKEN</span>
<a href="#l43.59"></a><span id="l43.59" class="difflineminus">-    PUSHBUTTON      &quot;MAPIReadMail&quot;,ID_BUTTON_READMAIL,34,142,57,14</span>
<a href="#l43.60"></a><span id="l43.60" class="difflineminus">-    CONTROL         &quot;MAPI_BODY_AS_FILE - Body as attachment&quot;,</span>
<a href="#l43.61"></a><span id="l43.61" class="difflineminus">-                    IDC_CHECK_BODYASFILE,&quot;Button&quot;,BS_AUTOCHECKBOX | </span>
<a href="#l43.62"></a><span id="l43.62" class="difflineminus">-                    WS_TABSTOP,121,125,188,9</span>
<a href="#l43.63"></a><span id="l43.63" class="difflineminus">-    CONTROL         &quot;MAPI_ENVELOPE_ONLY - Header information only&quot;,</span>
<a href="#l43.64"></a><span id="l43.64" class="difflineminus">-                    IDC_CHECK_ENVELOPEONLY,&quot;Button&quot;,BS_AUTOCHECKBOX | </span>
<a href="#l43.65"></a><span id="l43.65" class="difflineminus">-                    WS_TABSTOP,121,138,188,9</span>
<a href="#l43.66"></a><span id="l43.66" class="difflineminus">-    CONTROL         &quot;MAPI_PEEK - Don't mark message as read&quot;,IDC_CHECK_PEEK,</span>
<a href="#l43.67"></a><span id="l43.67" class="difflineminus">-                    &quot;Button&quot;,BS_AUTOCHECKBOX | WS_TABSTOP,121,151,188,9</span>
<a href="#l43.68"></a><span id="l43.68" class="difflineminus">-    CONTROL         &quot;MAPI_SUPPRESS_ATTACH - Suppress attachments&quot;,</span>
<a href="#l43.69"></a><span id="l43.69" class="difflineminus">-                    IDC_CHECK_SUPPRESSATTACH,&quot;Button&quot;,BS_AUTOCHECKBOX | </span>
<a href="#l43.70"></a><span id="l43.70" class="difflineminus">-                    WS_TABSTOP,121,164,188,9</span>
<a href="#l43.71"></a><span id="l43.71" class="difflineminus">-    PUSHBUTTON      &quot;&lt;- MAPIFreeBuffer&quot;,ID_BUTTON_FREEBUFFER,272,192,63,14</span>
<a href="#l43.72"></a><span id="l43.72" class="difflineminus">-    PUSHBUTTON      &quot;MAPIGetNSCPVersion&quot;,ID_BUTTON_NSCPVERSION,261,13,76,14</span>
<a href="#l43.73"></a><span id="l43.73" class="difflineminus">-    PUSHBUTTON      &quot;Synchronize&quot;,ID_BUTTON_SYNC,269,50,57,14</span>
<a href="#l43.74"></a><span id="l43.74" class="difflineminus">-END</span>
<a href="#l43.75"></a><span id="l43.75" class="difflineminus">-</span>
<a href="#l43.76"></a><span id="l43.76" class="difflineminus">-ID_DIALOG_MAIL DIALOG DISCARDABLE  0, 0, 285, 246</span>
<a href="#l43.77"></a><span id="l43.77" class="difflineminus">-STYLE DS_MODALFRAME | WS_POPUP | WS_CAPTION | WS_SYSMENU</span>
<a href="#l43.78"></a><span id="l43.78" class="difflineminus">-CAPTION &quot;Composition&quot;</span>
<a href="#l43.79"></a><span id="l43.79" class="difflineminus">-FONT 8, &quot;MS Sans Serif&quot;</span>
<a href="#l43.80"></a><span id="l43.80" class="difflineminus">-BEGIN</span>
<a href="#l43.81"></a><span id="l43.81" class="difflineminus">-    GROUPBOX        &quot;Address Information&quot;,IDC_STATIC,4,4,275,55</span>
<a href="#l43.82"></a><span id="l43.82" class="difflineminus">-    LTEXT           &quot;To:&quot;,IDC_STATIC,21,19,12,8</span>
<a href="#l43.83"></a><span id="l43.83" class="difflineminus">-    EDITTEXT        ID_EDIT_TOADDRESS,36,16,239,13,ES_AUTOHSCROLL</span>
<a href="#l43.84"></a><span id="l43.84" class="difflineminus">-    EDITTEXT        ID_EDIT_CCADDRESS,36,30,239,13,ES_AUTOHSCROLL</span>
<a href="#l43.85"></a><span id="l43.85" class="difflineminus">-    EDITTEXT        ID_EDIT_BCCADDRESS,36,44,239,13,ES_AUTOHSCROLL</span>
<a href="#l43.86"></a><span id="l43.86" class="difflineminus">-    LTEXT           &quot;Subject:&quot;,IDC_STATIC,5,65,29,9</span>
<a href="#l43.87"></a><span id="l43.87" class="difflineminus">-    EDITTEXT        ID_EDIT_SUBJECT,36,63,239,13,ES_AUTOHSCROLL</span>
<a href="#l43.88"></a><span id="l43.88" class="difflineminus">-    EDITTEXT        ID_EDIT_NOTETEXT,4,78,271,72,ES_MULTILINE | </span>
<a href="#l43.89"></a><span id="l43.89" class="difflineminus">-                    ES_AUTOHSCROLL</span>
<a href="#l43.90"></a><span id="l43.90" class="difflineminus">-    GROUPBOX        &quot;Attachments&quot;,IDC_STATIC,4,153,275,39</span>
<a href="#l43.91"></a><span id="l43.91" class="difflineminus">-    EDITTEXT        ID_EDIT_ATTACH1,16,162,122,13,ES_AUTOHSCROLL</span>
<a href="#l43.92"></a><span id="l43.92" class="difflineminus">-    EDITTEXT        ID_EDIT_ATTACH2,16,176,122,13,ES_AUTOHSCROLL</span>
<a href="#l43.93"></a><span id="l43.93" class="difflineminus">-    EDITTEXT        ID_EDIT_ATTACH3,147,162,122,13,ES_AUTOHSCROLL</span>
<a href="#l43.94"></a><span id="l43.94" class="difflineminus">-    EDITTEXT        ID_EDIT_ATTACH4,147,175,122,13,ES_AUTOHSCROLL</span>
<a href="#l43.95"></a><span id="l43.95" class="difflineminus">-    PUSHBUTTON      &quot;MAPISendMail&quot;,ID_BUTTON_MAPISENDMAIL,70,204,58,14</span>
<a href="#l43.96"></a><span id="l43.96" class="difflineminus">-    PUSHBUTTON      &quot;Cancel&quot;,IDCANCEL,50,225,84,14</span>
<a href="#l43.97"></a><span id="l43.97" class="difflineminus">-    PUSHBUTTON      &quot;MAPISendDocuments&quot;,ID_BUTTON_MAPISENDDOCUMENTS,132,204,</span>
<a href="#l43.98"></a><span id="l43.98" class="difflineminus">-                    79,14</span>
<a href="#l43.99"></a><span id="l43.99" class="difflineminus">-    CONTROL         &quot;Show Dialog&quot;,ID_CHECK_SHOWDIALOG,&quot;Button&quot;,</span>
<a href="#l43.100"></a><span id="l43.100" class="difflineminus">-                    BS_AUTOCHECKBOX | WS_TABSTOP,8,207,55,9</span>
<a href="#l43.101"></a><span id="l43.101" class="difflineminus">-    LTEXT           &quot;cc:&quot;,IDC_STATIC,22,32,12,8</span>
<a href="#l43.102"></a><span id="l43.102" class="difflineminus">-    LTEXT           &quot;bcc:&quot;,IDC_STATIC,18,47,15,8</span>
<a href="#l43.103"></a><span id="l43.103" class="difflineminus">-    GROUPBOX        &quot;Send Operations&quot;,IDC_STATIC,4,196,275,26</span>
<a href="#l43.104"></a><span id="l43.104" class="difflineminus">-    PUSHBUTTON      &quot;MAPISaveMail&quot;,ID_BUTTON_MAPISAVEMAIL,215,204,57,14</span>
<a href="#l43.105"></a><span id="l43.105" class="difflineminus">-    PUSHBUTTON      &quot;MAPIAddress&quot;,ID_BUTTON_MAPIADDRESS,150,225,84,14</span>
<a href="#l43.106"></a><span id="l43.106" class="difflineminus">-END</span>
<a href="#l43.107"></a><span id="l43.107" class="difflineminus">-</span>
<a href="#l43.108"></a><span id="l43.108" class="difflineminus">-ID_DIALOG_READMAIL DIALOG DISCARDABLE  0, 0, 269, 266</span>
<a href="#l43.109"></a><span id="l43.109" class="difflineminus">-STYLE DS_MODALFRAME | WS_POPUP | WS_CAPTION | WS_SYSMENU</span>
<a href="#l43.110"></a><span id="l43.110" class="difflineminus">-CAPTION &quot;Mail Message&quot;</span>
<a href="#l43.111"></a><span id="l43.111" class="difflineminus">-FONT 8, &quot;MS Sans Serif&quot;</span>
<a href="#l43.112"></a><span id="l43.112" class="difflineminus">-BEGIN</span>
<a href="#l43.113"></a><span id="l43.113" class="difflineminus">-    LTEXT           &quot;Subject:&quot;,IDC_STATIC,5,71,27,9</span>
<a href="#l43.114"></a><span id="l43.114" class="difflineminus">-    EDITTEXT        IDC_EDIT_SUBJECT,36,69,229,12,ES_AUTOHSCROLL | </span>
<a href="#l43.115"></a><span id="l43.115" class="difflineminus">-                    ES_READONLY</span>
<a href="#l43.116"></a><span id="l43.116" class="difflineminus">-    LISTBOX         IDC_LIST_ATTACHMENTS,4,211,261,37,LBS_SORT | </span>
<a href="#l43.117"></a><span id="l43.117" class="difflineminus">-                    LBS_NOINTEGRALHEIGHT | WS_VSCROLL | WS_TABSTOP</span>
<a href="#l43.118"></a><span id="l43.118" class="difflineminus">-    EDITTEXT        IDC_EDIT_BODYTEXT,4,113,261,85,ES_MULTILINE | </span>
<a href="#l43.119"></a><span id="l43.119" class="difflineminus">-                    ES_AUTOVSCROLL | ES_AUTOHSCROLL | ES_READONLY | </span>
<a href="#l43.120"></a><span id="l43.120" class="difflineminus">-                    ES_WANTRETURN</span>
<a href="#l43.121"></a><span id="l43.121" class="difflineminus">-    LISTBOX         IDC_LIST_RECIPIENTS,4,29,261,36,LBS_SORT | </span>
<a href="#l43.122"></a><span id="l43.122" class="difflineminus">-                    LBS_NOINTEGRALHEIGHT | WS_VSCROLL | WS_TABSTOP</span>
<a href="#l43.123"></a><span id="l43.123" class="difflineminus">-    LTEXT           &quot;Recipients:&quot;,IDC_STATIC,4,19,43,9</span>
<a href="#l43.124"></a><span id="l43.124" class="difflineminus">-    LTEXT           &quot;Attachments:&quot;,IDC_STATIC,4,202,43,9</span>
<a href="#l43.125"></a><span id="l43.125" class="difflineminus">-    EDITTEXT        IDC_EDIT_DATETIME,36,83,229,12,ES_AUTOHSCROLL | </span>
<a href="#l43.126"></a><span id="l43.126" class="difflineminus">-                    ES_READONLY</span>
<a href="#l43.127"></a><span id="l43.127" class="difflineminus">-    LTEXT           &quot;Date:&quot;,IDC_STATIC,13,84,19,9</span>
<a href="#l43.128"></a><span id="l43.128" class="difflineminus">-    PUSHBUTTON      &quot;OK&quot;,ID_OK,114,249,42,13</span>
<a href="#l43.129"></a><span id="l43.129" class="difflineminus">-    EDITTEXT        IDC_EDIT_THREAD,36,97,229,12,ES_AUTOHSCROLL | </span>
<a href="#l43.130"></a><span id="l43.130" class="difflineminus">-                    ES_READONLY</span>
<a href="#l43.131"></a><span id="l43.131" class="difflineminus">-    LTEXT           &quot;Thread:&quot;,IDC_STATIC,6,99,25,9</span>
<a href="#l43.132"></a><span id="l43.132" class="difflineminus">-    LTEXT           &quot;From:&quot;,IDC_STATIC,4,6,19,9</span>
<a href="#l43.133"></a><span id="l43.133" class="difflineminus">-    EDITTEXT        IDC_EDIT_FROM,27,4,238,12,ES_AUTOHSCROLL | ES_READONLY</span>
<a href="#l43.134"></a><span id="l43.134" class="difflineminus">-END</span>
<a href="#l43.135"></a><span id="l43.135" class="difflineminus">-</span>
<a href="#l43.136"></a><span id="l43.136" class="difflineminus">-</span>
<a href="#l43.137"></a><span id="l43.137" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l43.138"></a><span id="l43.138" class="difflineminus">-//</span>
<a href="#l43.139"></a><span id="l43.139" class="difflineminus">-// DESIGNINFO</span>
<a href="#l43.140"></a><span id="l43.140" class="difflineminus">-//</span>
<a href="#l43.141"></a><span id="l43.141" class="difflineminus">-</span>
<a href="#l43.142"></a><span id="l43.142" class="difflineminus">-#ifdef APSTUDIO_INVOKED</span>
<a href="#l43.143"></a><span id="l43.143" class="difflineminus">-GUIDELINES DESIGNINFO DISCARDABLE </span>
<a href="#l43.144"></a><span id="l43.144" class="difflineminus">-BEGIN</span>
<a href="#l43.145"></a><span id="l43.145" class="difflineminus">-    ID_DIALOG, DIALOG</span>
<a href="#l43.146"></a><span id="l43.146" class="difflineminus">-    BEGIN</span>
<a href="#l43.147"></a><span id="l43.147" class="difflineminus">-        LEFTMARGIN, 4</span>
<a href="#l43.148"></a><span id="l43.148" class="difflineminus">-        RIGHTMARGIN, 340</span>
<a href="#l43.149"></a><span id="l43.149" class="difflineminus">-        VERTGUIDE, 9</span>
<a href="#l43.150"></a><span id="l43.150" class="difflineminus">-        VERTGUIDE, 309</span>
<a href="#l43.151"></a><span id="l43.151" class="difflineminus">-        TOPMARGIN, 4</span>
<a href="#l43.152"></a><span id="l43.152" class="difflineminus">-        BOTTOMMARGIN, 227</span>
<a href="#l43.153"></a><span id="l43.153" class="difflineminus">-        HORZGUIDE, 206</span>
<a href="#l43.154"></a><span id="l43.154" class="difflineminus">-    END</span>
<a href="#l43.155"></a><span id="l43.155" class="difflineminus">-</span>
<a href="#l43.156"></a><span id="l43.156" class="difflineminus">-    ID_DIALOG_MAIL, DIALOG</span>
<a href="#l43.157"></a><span id="l43.157" class="difflineminus">-    BEGIN</span>
<a href="#l43.158"></a><span id="l43.158" class="difflineminus">-        LEFTMARGIN, 4</span>
<a href="#l43.159"></a><span id="l43.159" class="difflineminus">-        RIGHTMARGIN, 281</span>
<a href="#l43.160"></a><span id="l43.160" class="difflineminus">-        TOPMARGIN, 4</span>
<a href="#l43.161"></a><span id="l43.161" class="difflineminus">-        BOTTOMMARGIN, 239</span>
<a href="#l43.162"></a><span id="l43.162" class="difflineminus">-    END</span>
<a href="#l43.163"></a><span id="l43.163" class="difflineminus">-</span>
<a href="#l43.164"></a><span id="l43.164" class="difflineminus">-    ID_DIALOG_READMAIL, DIALOG</span>
<a href="#l43.165"></a><span id="l43.165" class="difflineminus">-    BEGIN</span>
<a href="#l43.166"></a><span id="l43.166" class="difflineminus">-        LEFTMARGIN, 4</span>
<a href="#l43.167"></a><span id="l43.167" class="difflineminus">-        RIGHTMARGIN, 265</span>
<a href="#l43.168"></a><span id="l43.168" class="difflineminus">-        TOPMARGIN, 4</span>
<a href="#l43.169"></a><span id="l43.169" class="difflineminus">-        BOTTOMMARGIN, 262</span>
<a href="#l43.170"></a><span id="l43.170" class="difflineminus">-    END</span>
<a href="#l43.171"></a><span id="l43.171" class="difflineminus">-END</span>
<a href="#l43.172"></a><span id="l43.172" class="difflineminus">-#endif    // APSTUDIO_INVOKED</span>
<a href="#l43.173"></a><span id="l43.173" class="difflineminus">-</span>
<a href="#l43.174"></a><span id="l43.174" class="difflineminus">-</span>
<a href="#l43.175"></a><span id="l43.175" class="difflineminus">-#ifdef APSTUDIO_INVOKED</span>
<a href="#l43.176"></a><span id="l43.176" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l43.177"></a><span id="l43.177" class="difflineminus">-//</span>
<a href="#l43.178"></a><span id="l43.178" class="difflineminus">-// TEXTINCLUDE</span>
<a href="#l43.179"></a><span id="l43.179" class="difflineminus">-//</span>
<a href="#l43.180"></a><span id="l43.180" class="difflineminus">-</span>
<a href="#l43.181"></a><span id="l43.181" class="difflineminus">-1 TEXTINCLUDE DISCARDABLE </span>
<a href="#l43.182"></a><span id="l43.182" class="difflineminus">-BEGIN</span>
<a href="#l43.183"></a><span id="l43.183" class="difflineminus">-    &quot;resource.h\0&quot;</span>
<a href="#l43.184"></a><span id="l43.184" class="difflineminus">-END</span>
<a href="#l43.185"></a><span id="l43.185" class="difflineminus">-</span>
<a href="#l43.186"></a><span id="l43.186" class="difflineminus">-2 TEXTINCLUDE DISCARDABLE </span>
<a href="#l43.187"></a><span id="l43.187" class="difflineminus">-BEGIN</span>
<a href="#l43.188"></a><span id="l43.188" class="difflineminus">-    &quot;#include &quot;&quot;afxres.h&quot;&quot;\r\n&quot;</span>
<a href="#l43.189"></a><span id="l43.189" class="difflineminus">-    &quot;\0&quot;</span>
<a href="#l43.190"></a><span id="l43.190" class="difflineminus">-END</span>
<a href="#l43.191"></a><span id="l43.191" class="difflineminus">-</span>
<a href="#l43.192"></a><span id="l43.192" class="difflineminus">-3 TEXTINCLUDE DISCARDABLE </span>
<a href="#l43.193"></a><span id="l43.193" class="difflineminus">-BEGIN</span>
<a href="#l43.194"></a><span id="l43.194" class="difflineminus">-    &quot;\r\n&quot;</span>
<a href="#l43.195"></a><span id="l43.195" class="difflineminus">-    &quot;\0&quot;</span>
<a href="#l43.196"></a><span id="l43.196" class="difflineminus">-END</span>
<a href="#l43.197"></a><span id="l43.197" class="difflineminus">-</span>
<a href="#l43.198"></a><span id="l43.198" class="difflineminus">-#endif    // APSTUDIO_INVOKED</span>
<a href="#l43.199"></a><span id="l43.199" class="difflineminus">-</span>
<a href="#l43.200"></a><span id="l43.200" class="difflineminus">-</span>
<a href="#l43.201"></a><span id="l43.201" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l43.202"></a><span id="l43.202" class="difflineminus">-//</span>
<a href="#l43.203"></a><span id="l43.203" class="difflineminus">-// Icon</span>
<a href="#l43.204"></a><span id="l43.204" class="difflineminus">-//</span>
<a href="#l43.205"></a><span id="l43.205" class="difflineminus">-</span>
<a href="#l43.206"></a><span id="l43.206" class="difflineminus">-// Icon with lowest ID value placed first to ensure application icon</span>
<a href="#l43.207"></a><span id="l43.207" class="difflineminus">-// remains consistent on all systems.</span>
<a href="#l43.208"></a><span id="l43.208" class="difflineminus">-ID_ICON_APP             ICON    DISCARDABLE     &quot;nscicon.ico&quot;</span>
<a href="#l43.209"></a><span id="l43.209" class="difflineminus">-</span>
<a href="#l43.210"></a><span id="l43.210" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l43.211"></a><span id="l43.211" class="difflineminus">-//</span>
<a href="#l43.212"></a><span id="l43.212" class="difflineminus">-// Menu</span>
<a href="#l43.213"></a><span id="l43.213" class="difflineminus">-//</span>
<a href="#l43.214"></a><span id="l43.214" class="difflineminus">-</span>
<a href="#l43.215"></a><span id="l43.215" class="difflineminus">-ID_MENU MENU DISCARDABLE </span>
<a href="#l43.216"></a><span id="l43.216" class="difflineminus">-BEGIN</span>
<a href="#l43.217"></a><span id="l43.217" class="difflineminus">-    POPUP &quot;&amp;File&quot;</span>
<a href="#l43.218"></a><span id="l43.218" class="difflineminus">-    BEGIN</span>
<a href="#l43.219"></a><span id="l43.219" class="difflineminus">-        MENUITEM &quot;MAPI&amp;FindNext&quot;,               ID_MENU_MAPIFINDNEXT</span>
<a href="#l43.220"></a><span id="l43.220" class="difflineminus">-        MENUITEM &quot;MAPI&amp;ReadMail&quot;,               ID_MENU_MAPIREADMAIL</span>
<a href="#l43.221"></a><span id="l43.221" class="difflineminus">-        MENUITEM SEPARATOR</span>
<a href="#l43.222"></a><span id="l43.222" class="difflineminus">-        MENUITEM &quot;E&amp;xit&quot;,                       ID_MENU_MYEXIT</span>
<a href="#l43.223"></a><span id="l43.223" class="difflineminus">-    END</span>
<a href="#l43.224"></a><span id="l43.224" class="difflineminus">-    POPUP &quot;&amp;Edit&quot;</span>
<a href="#l43.225"></a><span id="l43.225" class="difflineminus">-    BEGIN</span>
<a href="#l43.226"></a><span id="l43.226" class="difflineminus">-        MENUITEM &quot;MAPI&amp;DeleteMail&quot;,             ID_MENU_MAPIDELETEMAIL</span>
<a href="#l43.227"></a><span id="l43.227" class="difflineminus">-        MENUITEM &quot;&amp;Clear Results&quot;,              ID_MENU_CLEARRESULTS</span>
<a href="#l43.228"></a><span id="l43.228" class="difflineminus">-    END</span>
<a href="#l43.229"></a><span id="l43.229" class="difflineminus">-    POPUP &quot;&amp;Help&quot;</span>
<a href="#l43.230"></a><span id="l43.230" class="difflineminus">-    BEGIN</span>
<a href="#l43.231"></a><span id="l43.231" class="difflineminus">-        MENUITEM &quot;&amp;About...&quot;,                   ID_MENU_MYABOUT</span>
<a href="#l43.232"></a><span id="l43.232" class="difflineminus">-    END</span>
<a href="#l43.233"></a><span id="l43.233" class="difflineminus">-END</span>
<a href="#l43.234"></a><span id="l43.234" class="difflineminus">-</span>
<a href="#l43.235"></a><span id="l43.235" class="difflineminus">-#endif    // English (U.S.) resources</span>
<a href="#l43.236"></a><span id="l43.236" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l43.237"></a><span id="l43.237" class="difflineminus">-</span>
<a href="#l43.238"></a><span id="l43.238" class="difflineminus">-</span>
<a href="#l43.239"></a><span id="l43.239" class="difflineminus">-</span>
<a href="#l43.240"></a><span id="l43.240" class="difflineminus">-#ifndef APSTUDIO_INVOKED</span>
<a href="#l43.241"></a><span id="l43.241" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l43.242"></a><span id="l43.242" class="difflineminus">-//</span>
<a href="#l43.243"></a><span id="l43.243" class="difflineminus">-// Generated from the TEXTINCLUDE 3 resource.</span>
<a href="#l43.244"></a><span id="l43.244" class="difflineminus">-//</span>
<a href="#l43.245"></a><span id="l43.245" class="difflineminus">-</span>
<a href="#l43.246"></a><span id="l43.246" class="difflineminus">-</span>
<a href="#l43.247"></a><span id="l43.247" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////</span>
<a href="#l43.248"></a><span id="l43.248" class="difflineminus">-#endif    // not APSTUDIO_INVOKED</span>
<a href="#l43.249"></a><span id="l43.249" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1">deleted file mode 100644</span>
<a href="#l44.2"></a><span id="l44.2">index cac16f623a5b750cc4c333d5a8921c7b587f00cb..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l44.3"></a><span id="l44.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1">deleted file mode 100644</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/port.h</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineplus">+++ /dev/null</span>
<a href="#l45.4"></a><span id="l45.4" class="difflineat">@@ -1,303 +0,0 @@</span>
<a href="#l45.5"></a><span id="l45.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l45.6"></a><span id="l45.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l45.7"></a><span id="l45.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l45.8"></a><span id="l45.8" class="difflineminus">- *</span>
<a href="#l45.9"></a><span id="l45.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l45.10"></a><span id="l45.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l45.11"></a><span id="l45.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineminus">- *</span>
<a href="#l45.14"></a><span id="l45.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l45.16"></a><span id="l45.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l45.17"></a><span id="l45.17" class="difflineminus">- * License.</span>
<a href="#l45.18"></a><span id="l45.18" class="difflineminus">- *</span>
<a href="#l45.19"></a><span id="l45.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l45.20"></a><span id="l45.20" class="difflineminus">- *</span>
<a href="#l45.21"></a><span id="l45.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l45.23"></a><span id="l45.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l45.24"></a><span id="l45.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l45.25"></a><span id="l45.25" class="difflineminus">- *</span>
<a href="#l45.26"></a><span id="l45.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l45.27"></a><span id="l45.27" class="difflineminus">- *</span>
<a href="#l45.28"></a><span id="l45.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l45.29"></a><span id="l45.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l45.30"></a><span id="l45.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l45.33"></a><span id="l45.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l45.34"></a><span id="l45.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l45.35"></a><span id="l45.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l45.36"></a><span id="l45.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l45.37"></a><span id="l45.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l45.38"></a><span id="l45.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l45.39"></a><span id="l45.39" class="difflineminus">- *</span>
<a href="#l45.40"></a><span id="l45.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l45.41"></a><span id="l45.41" class="difflineminus">-//</span>
<a href="#l45.42"></a><span id="l45.42" class="difflineminus">-</span>
<a href="#l45.43"></a><span id="l45.43" class="difflineminus">-#ifndef PORT_H</span>
<a href="#l45.44"></a><span id="l45.44" class="difflineminus">-#define PORT_H</span>
<a href="#l45.45"></a><span id="l45.45" class="difflineminus">-</span>
<a href="#l45.46"></a><span id="l45.46" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l45.47"></a><span id="l45.47" class="difflineminus">-extern &quot;C&quot; {</span>
<a href="#l45.48"></a><span id="l45.48" class="difflineminus">-#endif</span>
<a href="#l45.49"></a><span id="l45.49" class="difflineminus">-</span>
<a href="#l45.50"></a><span id="l45.50" class="difflineminus">-/*****************************************************************\</span>
<a href="#l45.51"></a><span id="l45.51" class="difflineminus">- *                                                               *</span>
<a href="#l45.52"></a><span id="l45.52" class="difflineminus">- *  PORT.H                                                       *</span>
<a href="#l45.53"></a><span id="l45.53" class="difflineminus">- *                                                               *</span>
<a href="#l45.54"></a><span id="l45.54" class="difflineminus">- *  Win16/Win32 portability stuff                                *</span>
<a href="#l45.55"></a><span id="l45.55" class="difflineminus">- *                                                               *</span>
<a href="#l45.56"></a><span id="l45.56" class="difflineminus">- *  A.Sokolsky                                                   *</span>
<a href="#l45.57"></a><span id="l45.57" class="difflineminus">- *      3.10.94 distilled into this header                       *</span>
<a href="#l45.58"></a><span id="l45.58" class="difflineminus">- *                                                               *</span>
<a href="#l45.59"></a><span id="l45.59" class="difflineminus">-\*****************************************************************/</span>
<a href="#l45.60"></a><span id="l45.60" class="difflineminus">-</span>
<a href="#l45.61"></a><span id="l45.61" class="difflineminus">-/*</span>
<a href="#l45.62"></a><span id="l45.62" class="difflineminus">- * calling conventions</span>
<a href="#l45.63"></a><span id="l45.63" class="difflineminus">- */</span>
<a href="#l45.64"></a><span id="l45.64" class="difflineminus">-#include &lt;assert.h&gt;</span>
<a href="#l45.65"></a><span id="l45.65" class="difflineminus">-                                                      </span>
<a href="#l45.66"></a><span id="l45.66" class="difflineminus">-                                                      </span>
<a href="#l45.67"></a><span id="l45.67" class="difflineminus">-#ifndef CDECL</span>
<a href="#l45.68"></a><span id="l45.68" class="difflineminus">-#define CDECL __cdecl</span>
<a href="#l45.69"></a><span id="l45.69" class="difflineminus">-#endif  // CDECL</span>
<a href="#l45.70"></a><span id="l45.70" class="difflineminus">-</span>
<a href="#l45.71"></a><span id="l45.71" class="difflineminus">-#ifndef PASCAL</span>
<a href="#l45.72"></a><span id="l45.72" class="difflineminus">-#define PASCAL __pascal</span>
<a href="#l45.73"></a><span id="l45.73" class="difflineminus">-#endif  // PASCAL</span>
<a href="#l45.74"></a><span id="l45.74" class="difflineminus">-</span>
<a href="#l45.75"></a><span id="l45.75" class="difflineminus">-#ifdef FASTCALL</span>
<a href="#l45.76"></a><span id="l45.76" class="difflineminus">-#error FASTCALL defined</span>
<a href="#l45.77"></a><span id="l45.77" class="difflineminus">-#endif // FASTCALL</span>
<a href="#l45.78"></a><span id="l45.78" class="difflineminus">-</span>
<a href="#l45.79"></a><span id="l45.79" class="difflineminus">-</span>
<a href="#l45.80"></a><span id="l45.80" class="difflineminus">-#ifdef NDEBUG</span>
<a href="#l45.81"></a><span id="l45.81" class="difflineminus">-#define FASTCALL __fastcall</span>
<a href="#l45.82"></a><span id="l45.82" class="difflineminus">-#else</span>
<a href="#l45.83"></a><span id="l45.83" class="difflineminus">-#define FASTCALL PASCAL</span>
<a href="#l45.84"></a><span id="l45.84" class="difflineminus">-#endif // NDEBUG   </span>
<a href="#l45.85"></a><span id="l45.85" class="difflineminus">-</span>
<a href="#l45.86"></a><span id="l45.86" class="difflineminus">-</span>
<a href="#l45.87"></a><span id="l45.87" class="difflineminus">-</span>
<a href="#l45.88"></a><span id="l45.88" class="difflineminus">-#ifndef HWND2DWORD</span>
<a href="#l45.89"></a><span id="l45.89" class="difflineminus">-#  ifdef WIN32</span>
<a href="#l45.90"></a><span id="l45.90" class="difflineminus">-#    define HWND2DWORD(X_hWnd) ( (DWORD)(X_hWnd) )</span>
<a href="#l45.91"></a><span id="l45.91" class="difflineminus">-#  else // WIN16</span>
<a href="#l45.92"></a><span id="l45.92" class="difflineminus">-#    define HWND2DWORD(X_hWnd) ( (DWORD)MAKELONG(((WORD)(X_hWnd)), 0) )</span>
<a href="#l45.93"></a><span id="l45.93" class="difflineminus">-#  endif</span>
<a href="#l45.94"></a><span id="l45.94" class="difflineminus">-#endif // HWND2DWORD</span>
<a href="#l45.95"></a><span id="l45.95" class="difflineminus">-</span>
<a href="#l45.96"></a><span id="l45.96" class="difflineminus">-</span>
<a href="#l45.97"></a><span id="l45.97" class="difflineminus">-/*</span>
<a href="#l45.98"></a><span id="l45.98" class="difflineminus">- * WIN16 - WIN32 compatibility stuff</span>
<a href="#l45.99"></a><span id="l45.99" class="difflineminus">- */</span>
<a href="#l45.100"></a><span id="l45.100" class="difflineminus">-</span>
<a href="#l45.101"></a><span id="l45.101" class="difflineminus">-#ifdef WIN32</span>
<a href="#l45.102"></a><span id="l45.102" class="difflineminus">-</span>
<a href="#l45.103"></a><span id="l45.103" class="difflineminus">-# define DLLEXPORT    __declspec( dllexport )</span>
<a href="#l45.104"></a><span id="l45.104" class="difflineminus">-# define EXPORT</span>
<a href="#l45.105"></a><span id="l45.105" class="difflineminus">-# define LOADDS</span>
<a href="#l45.106"></a><span id="l45.106" class="difflineminus">-# define HUGE</span>
<a href="#l45.107"></a><span id="l45.107" class="difflineminus">-# ifndef FAR</span>
<a href="#l45.108"></a><span id="l45.108" class="difflineminus">-#  define FAR</span>
<a href="#l45.109"></a><span id="l45.109" class="difflineminus">-# endif // FAR</span>
<a href="#l45.110"></a><span id="l45.110" class="difflineminus">-# ifndef NEAR</span>
<a href="#l45.111"></a><span id="l45.111" class="difflineminus">-#  define NEAR</span>
<a href="#l45.112"></a><span id="l45.112" class="difflineminus">-# endif // NEAR </span>
<a href="#l45.113"></a><span id="l45.113" class="difflineminus">-# ifdef UNICODE</span>
<a href="#l45.114"></a><span id="l45.114" class="difflineminus">-#  define SIZEOF(x)   (sizeof(x)/sizeof(WCHAR))</span>
<a href="#l45.115"></a><span id="l45.115" class="difflineminus">-# else</span>
<a href="#l45.116"></a><span id="l45.116" class="difflineminus">-#  define SIZEOF(x)   sizeof(x)</span>
<a href="#l45.117"></a><span id="l45.117" class="difflineminus">-# endif</span>
<a href="#l45.118"></a><span id="l45.118" class="difflineminus">-</span>
<a href="#l45.119"></a><span id="l45.119" class="difflineminus">-#else  // !WIN32 == WIN16</span>
<a href="#l45.120"></a><span id="l45.120" class="difflineminus">-</span>
<a href="#l45.121"></a><span id="l45.121" class="difflineminus">-# define DLLEXPORT    </span>
<a href="#l45.122"></a><span id="l45.122" class="difflineminus">-# define EXPORT       __export</span>
<a href="#l45.123"></a><span id="l45.123" class="difflineminus">-# define LOADDS       __loadds</span>
<a href="#l45.124"></a><span id="l45.124" class="difflineminus">-# define HUGE         __huge</span>
<a href="#l45.125"></a><span id="l45.125" class="difflineminus">-# ifndef FAR</span>
<a href="#l45.126"></a><span id="l45.126" class="difflineminus">-#   define FAR        __far</span>
<a href="#l45.127"></a><span id="l45.127" class="difflineminus">-#   define NEAR       __near</span>
<a href="#l45.128"></a><span id="l45.128" class="difflineminus">-# endif  // FAR</span>
<a href="#l45.129"></a><span id="l45.129" class="difflineminus">-# define CONST const</span>
<a href="#l45.130"></a><span id="l45.130" class="difflineminus">-# define SIZEOF(x)    sizeof(x)</span>
<a href="#l45.131"></a><span id="l45.131" class="difflineminus">-# define CHAR char</span>
<a href="#l45.132"></a><span id="l45.132" class="difflineminus">-# define TCHAR char</span>
<a href="#l45.133"></a><span id="l45.133" class="difflineminus">-# define WCHAR char</span>
<a href="#l45.134"></a><span id="l45.134" class="difflineminus">-# ifndef LPTSTR</span>
<a href="#l45.135"></a><span id="l45.135" class="difflineminus">-#   define LPTSTR LPSTR</span>
<a href="#l45.136"></a><span id="l45.136" class="difflineminus">-# endif</span>
<a href="#l45.137"></a><span id="l45.137" class="difflineminus">-# ifndef LPCTSTR </span>
<a href="#l45.138"></a><span id="l45.138" class="difflineminus">-#   define LPCTSTR LPCSTR</span>
<a href="#l45.139"></a><span id="l45.139" class="difflineminus">-# endif</span>
<a href="#l45.140"></a><span id="l45.140" class="difflineminus">-# define UNREFERENCED_PARAMETER(x) x;</span>
<a href="#l45.141"></a><span id="l45.141" class="difflineminus">-# ifndef TEXT</span>
<a href="#l45.142"></a><span id="l45.142" class="difflineminus">-#   define TEXT(x) x</span>
<a href="#l45.143"></a><span id="l45.143" class="difflineminus">-# endif</span>
<a href="#l45.144"></a><span id="l45.144" class="difflineminus">-# define GetWindowTextW GetWindowText</span>
<a href="#l45.145"></a><span id="l45.145" class="difflineminus">-# define lstrcpyW lstrcpy   </span>
<a href="#l45.146"></a><span id="l45.146" class="difflineminus">-</span>
<a href="#l45.147"></a><span id="l45.147" class="difflineminus">-# define BN_DBLCLK BN_DOUBLECLICKED // ~~MRJ needed for custom control.</span>
<a href="#l45.148"></a><span id="l45.148" class="difflineminus">-// ~~MRJ begin Win95 backward compat section</span>
<a href="#l45.149"></a><span id="l45.149" class="difflineminus">-# define LPWSTR LPSTR</span>
<a href="#l45.150"></a><span id="l45.150" class="difflineminus">-# define LPCWSTR LPCSTR</span>
<a href="#l45.151"></a><span id="l45.151" class="difflineminus">-</span>
<a href="#l45.152"></a><span id="l45.152" class="difflineminus">-// button check state for WIN16</span>
<a href="#l45.153"></a><span id="l45.153" class="difflineminus">-#ifndef BST_UNCHECKED</span>
<a href="#l45.154"></a><span id="l45.154" class="difflineminus">-#define BST_UNCHECKED      0x0000</span>
<a href="#l45.155"></a><span id="l45.155" class="difflineminus">-#endif</span>
<a href="#l45.156"></a><span id="l45.156" class="difflineminus">-</span>
<a href="#l45.157"></a><span id="l45.157" class="difflineminus">-#ifndef BST_CHECKED</span>
<a href="#l45.158"></a><span id="l45.158" class="difflineminus">-#define BST_CHECKED        0x0001</span>
<a href="#l45.159"></a><span id="l45.159" class="difflineminus">-#endif</span>
<a href="#l45.160"></a><span id="l45.160" class="difflineminus">-</span>
<a href="#l45.161"></a><span id="l45.161" class="difflineminus">-</span>
<a href="#l45.162"></a><span id="l45.162" class="difflineminus">-#ifndef WIN95_COMPAT</span>
<a href="#l45.163"></a><span id="l45.163" class="difflineminus">-#  define WIN95_COMPAT</span>
<a href="#l45.164"></a><span id="l45.164" class="difflineminus">-#endif</span>
<a href="#l45.165"></a><span id="l45.165" class="difflineminus">-</span>
<a href="#l45.166"></a><span id="l45.166" class="difflineminus">-// ~~MRJ end Win95 compat section.</span>
<a href="#l45.167"></a><span id="l45.167" class="difflineminus">-</span>
<a href="#l45.168"></a><span id="l45.168" class="difflineminus">-// critical section API stubs</span>
<a href="#l45.169"></a><span id="l45.169" class="difflineminus">-typedef DWORD CRITICAL_SECTION;</span>
<a href="#l45.170"></a><span id="l45.170" class="difflineminus">-typedef CRITICAL_SECTION FAR * LPCRITICAL_SECTION; </span>
<a href="#l45.171"></a><span id="l45.171" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l45.172"></a><span id="l45.172" class="difflineminus">-inline void InitializeCriticalSection(LPCRITICAL_SECTION lpSection) {}</span>
<a href="#l45.173"></a><span id="l45.173" class="difflineminus">-inline void DeleteCriticalSection(LPCRITICAL_SECTION lpSection) {}</span>
<a href="#l45.174"></a><span id="l45.174" class="difflineminus">-inline void EnterCriticalSection(LPCRITICAL_SECTION lpSection) {}</span>
<a href="#l45.175"></a><span id="l45.175" class="difflineminus">-inline void LeaveCriticalSection(LPCRITICAL_SECTION lpSection) {} </span>
<a href="#l45.176"></a><span id="l45.176" class="difflineminus">-#endif // __cplusplus </span>
<a href="#l45.177"></a><span id="l45.177" class="difflineminus">-</span>
<a href="#l45.178"></a><span id="l45.178" class="difflineminus">-// Added for nssock16 ---Neeti</span>
<a href="#l45.179"></a><span id="l45.179" class="difflineminus">-#ifndef ZeroMemory</span>
<a href="#l45.180"></a><span id="l45.180" class="difflineminus">-#include &lt;memory.h&gt;</span>
<a href="#l45.181"></a><span id="l45.181" class="difflineminus">-#define ZeroMemory(PTR, SIZE) memset(PTR, 0, SIZE)</span>
<a href="#l45.182"></a><span id="l45.182" class="difflineminus">-#endif // ZeroMemory</span>
<a href="#l45.183"></a><span id="l45.183" class="difflineminus">-</span>
<a href="#l45.184"></a><span id="l45.184" class="difflineminus">-#endif // WIN16</span>
<a href="#l45.185"></a><span id="l45.185" class="difflineminus">-</span>
<a href="#l45.186"></a><span id="l45.186" class="difflineminus">-/*</span>
<a href="#l45.187"></a><span id="l45.187" class="difflineminus">- * unix - windows compatibility stuff</span>
<a href="#l45.188"></a><span id="l45.188" class="difflineminus">- */</span>
<a href="#l45.189"></a><span id="l45.189" class="difflineminus">-typedef DWORD u_int32;</span>
<a href="#l45.190"></a><span id="l45.190" class="difflineminus">-typedef WORD  u_int16;</span>
<a href="#l45.191"></a><span id="l45.191" class="difflineminus">-typedef BYTE  u_int8;</span>
<a href="#l45.192"></a><span id="l45.192" class="difflineminus">-#ifdef WIN32</span>
<a href="#l45.193"></a><span id="l45.193" class="difflineminus">-typedef short int Bool16;</span>
<a href="#l45.194"></a><span id="l45.194" class="difflineminus">-#else  // WIN16</span>
<a href="#l45.195"></a><span id="l45.195" class="difflineminus">-typedef BOOL  Bool16;</span>
<a href="#l45.196"></a><span id="l45.196" class="difflineminus">-#endif // WIN16</span>
<a href="#l45.197"></a><span id="l45.197" class="difflineminus">-</span>
<a href="#l45.198"></a><span id="l45.198" class="difflineminus">-/*</span>
<a href="#l45.199"></a><span id="l45.199" class="difflineminus">- * Cross Platform Compatibility</span>
<a href="#l45.200"></a><span id="l45.200" class="difflineminus">- */</span>
<a href="#l45.201"></a><span id="l45.201" class="difflineminus">-#ifndef UNALIGNED</span>
<a href="#l45.202"></a><span id="l45.202" class="difflineminus">-# ifdef _M_ALPHA</span>
<a href="#l45.203"></a><span id="l45.203" class="difflineminus">-#  define UNALIGNED __unaligned</span>
<a href="#l45.204"></a><span id="l45.204" class="difflineminus">-# else  // !_M_ALPHA</span>
<a href="#l45.205"></a><span id="l45.205" class="difflineminus">-#  define UNALIGNED</span>
<a href="#l45.206"></a><span id="l45.206" class="difflineminus">-# endif // !_M_ALPHA</span>
<a href="#l45.207"></a><span id="l45.207" class="difflineminus">-#endif  // UNALIGNED</span>
<a href="#l45.208"></a><span id="l45.208" class="difflineminus">-</span>
<a href="#l45.209"></a><span id="l45.209" class="difflineminus">-//</span>
<a href="#l45.210"></a><span id="l45.210" class="difflineminus">-// RICHIE - for the Alpha port</span>
<a href="#l45.211"></a><span id="l45.211" class="difflineminus">-//</span>
<a href="#l45.212"></a><span id="l45.212" class="difflineminus">-#ifdef _M_ALPHA</span>
<a href="#l45.213"></a><span id="l45.213" class="difflineminus">-# undef pascal</span>
<a href="#l45.214"></a><span id="l45.214" class="difflineminus">-# undef PASCAL</span>
<a href="#l45.215"></a><span id="l45.215" class="difflineminus">-# if (_MSC_VER &gt;= 800) || defined(_STDCALL_SUPPORTED)</span>
<a href="#l45.216"></a><span id="l45.216" class="difflineminus">-#  define pascal __stdcall</span>
<a href="#l45.217"></a><span id="l45.217" class="difflineminus">-#  define PASCAL __stdcall</span>
<a href="#l45.218"></a><span id="l45.218" class="difflineminus">-# else</span>
<a href="#l45.219"></a><span id="l45.219" class="difflineminus">-#  define PASCAL</span>
<a href="#l45.220"></a><span id="l45.220" class="difflineminus">-# endif</span>
<a href="#l45.221"></a><span id="l45.221" class="difflineminus">-#endif</span>
<a href="#l45.222"></a><span id="l45.222" class="difflineminus">-</span>
<a href="#l45.223"></a><span id="l45.223" class="difflineminus">-</span>
<a href="#l45.224"></a><span id="l45.224" class="difflineminus">-/*</span>
<a href="#l45.225"></a><span id="l45.225" class="difflineminus">- * Useful Types</span>
<a href="#l45.226"></a><span id="l45.226" class="difflineminus">- */</span>
<a href="#l45.227"></a><span id="l45.227" class="difflineminus">-typedef char HUGE *HPSTR;</span>
<a href="#l45.228"></a><span id="l45.228" class="difflineminus">-typedef const char HUGE *HPCSTR;</span>
<a href="#l45.229"></a><span id="l45.229" class="difflineminus">-typedef unsigned char HUGE *HPBYTE;</span>
<a href="#l45.230"></a><span id="l45.230" class="difflineminus">-typedef WORD HUGE *HPWORD;</span>
<a href="#l45.231"></a><span id="l45.231" class="difflineminus">-typedef UINT FAR *LPUINT;</span>
<a href="#l45.232"></a><span id="l45.232" class="difflineminus">-typedef BOOL (CALLBACK *USERABORTPROC)();</span>
<a href="#l45.233"></a><span id="l45.233" class="difflineminus">-typedef BOOL (CALLBACK *PROGRESSPROC)(UINT uPos, UINT uRange);</span>
<a href="#l45.234"></a><span id="l45.234" class="difflineminus">-typedef int INT;   // ~~MRJ a function needed this defined.</span>
<a href="#l45.235"></a><span id="l45.235" class="difflineminus">-typedef MINMAXINFO FAR *LPMINMAXINFO; // ~~MRJ </span>
<a href="#l45.236"></a><span id="l45.236" class="difflineminus">-</span>
<a href="#l45.237"></a><span id="l45.237" class="difflineminus">-//</span>
<a href="#l45.238"></a><span id="l45.238" class="difflineminus">-// stuff missing from windows.h</span>
<a href="#l45.239"></a><span id="l45.239" class="difflineminus">-//</span>
<a href="#l45.240"></a><span id="l45.240" class="difflineminus">-#ifndef MAKEWORD</span>
<a href="#l45.241"></a><span id="l45.241" class="difflineminus">-#define MAKEWORD(low, high)    ((WORD)(((BYTE)(low)) | (((WORD)((BYTE)(high))) &lt;&lt; 8)))</span>
<a href="#l45.242"></a><span id="l45.242" class="difflineminus">-#endif // MAKEWORD</span>
<a href="#l45.243"></a><span id="l45.243" class="difflineminus">-</span>
<a href="#l45.244"></a><span id="l45.244" class="difflineminus">-#ifdef WIN32</span>
<a href="#l45.245"></a><span id="l45.245" class="difflineminus">-# ifndef hmemcpy</span>
<a href="#l45.246"></a><span id="l45.246" class="difflineminus">-#  define hmemcpy memcpy</span>
<a href="#l45.247"></a><span id="l45.247" class="difflineminus">-# endif // !defined(hmemcpy)</span>
<a href="#l45.248"></a><span id="l45.248" class="difflineminus">-# define _fmemset memset</span>
<a href="#l45.249"></a><span id="l45.249" class="difflineminus">-</span>
<a href="#l45.250"></a><span id="l45.250" class="difflineminus">-# include &lt;malloc.h&gt;</span>
<a href="#l45.251"></a><span id="l45.251" class="difflineminus">-</span>
<a href="#l45.252"></a><span id="l45.252" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l45.253"></a><span id="l45.253" class="difflineminus">-</span>
<a href="#l45.254"></a><span id="l45.254" class="difflineminus">-inline BOOL IsGDIObject(HGDIOBJ hObj) { return (hObj != 0); }</span>
<a href="#l45.255"></a><span id="l45.255" class="difflineminus">-inline void *_halloc(long num, unsigned int size) { return malloc(num * size); }</span>
<a href="#l45.256"></a><span id="l45.256" class="difflineminus">-inline void _hfree( void *memblock ) { free(memblock); } </span>
<a href="#l45.257"></a><span id="l45.257" class="difflineminus">-/*</span>
<a href="#l45.258"></a><span id="l45.258" class="difflineminus">-inline BOOL IsInstance(HINSTANCE hInst) {</span>
<a href="#l45.259"></a><span id="l45.259" class="difflineminus">-# ifdef WIN32</span>
<a href="#l45.260"></a><span id="l45.260" class="difflineminus">-    return (hInst != 0);</span>
<a href="#l45.261"></a><span id="l45.261" class="difflineminus">-# else // WIN16</span>
<a href="#l45.262"></a><span id="l45.262" class="difflineminus">-    return (hInst &gt; HINSTANCE_ERROR);</span>
<a href="#l45.263"></a><span id="l45.263" class="difflineminus">-# endif  </span>
<a href="#l45.264"></a><span id="l45.264" class="difflineminus">-}  </span>
<a href="#l45.265"></a><span id="l45.265" class="difflineminus">-*/</span>
<a href="#l45.266"></a><span id="l45.266" class="difflineminus">-</span>
<a href="#l45.267"></a><span id="l45.267" class="difflineminus">-#endif // __cplusplus</span>
<a href="#l45.268"></a><span id="l45.268" class="difflineminus">-</span>
<a href="#l45.269"></a><span id="l45.269" class="difflineminus">-  WINUSERAPI HANDLE WINAPI LoadImageA(HINSTANCE, LPCSTR, UINT, int, int, UINT);</span>
<a href="#l45.270"></a><span id="l45.270" class="difflineminus">-</span>
<a href="#l45.271"></a><span id="l45.271" class="difflineminus">-#endif // WIN32</span>
<a href="#l45.272"></a><span id="l45.272" class="difflineminus">-</span>
<a href="#l45.273"></a><span id="l45.273" class="difflineminus">-#ifdef __cplusplus </span>
<a href="#l45.274"></a><span id="l45.274" class="difflineminus">-inline BOOL IsInstance(HINSTANCE hInst) {</span>
<a href="#l45.275"></a><span id="l45.275" class="difflineminus">-# ifdef WIN32</span>
<a href="#l45.276"></a><span id="l45.276" class="difflineminus">-    return (hInst != 0);</span>
<a href="#l45.277"></a><span id="l45.277" class="difflineminus">-# else // WIN16</span>
<a href="#l45.278"></a><span id="l45.278" class="difflineminus">-    return (hInst &gt; HINSTANCE_ERROR);</span>
<a href="#l45.279"></a><span id="l45.279" class="difflineminus">-# endif  </span>
<a href="#l45.280"></a><span id="l45.280" class="difflineminus">-} </span>
<a href="#l45.281"></a><span id="l45.281" class="difflineminus">-inline void SetWindowSmallIcon(HINSTANCE hInst, HWND hWnd, UINT uIconResourceId) {</span>
<a href="#l45.282"></a><span id="l45.282" class="difflineminus">-#ifdef WIN32</span>
<a href="#l45.283"></a><span id="l45.283" class="difflineminus">-# ifndef WM_SETICON</span>
<a href="#l45.284"></a><span id="l45.284" class="difflineminus">-#   define WM_SETICON 0x0080</span>
<a href="#l45.285"></a><span id="l45.285" class="difflineminus">-# endif  // WM_SETICON</span>
<a href="#l45.286"></a><span id="l45.286" class="difflineminus">-# ifndef IMAGE_ICON</span>
<a href="#l45.287"></a><span id="l45.287" class="difflineminus">-#   define IMAGE_ICON 1</span>
<a href="#l45.288"></a><span id="l45.288" class="difflineminus">-# endif</span>
<a href="#l45.289"></a><span id="l45.289" class="difflineminus">-  assert(IsWindow(hWnd));</span>
<a href="#l45.290"></a><span id="l45.290" class="difflineminus">-  HICON hIcon = (HICON)LoadImageA(hInst, MAKEINTRESOURCE(uIconResourceId), IMAGE_ICON,</span>
<a href="#l45.291"></a><span id="l45.291" class="difflineminus">-    16, 16, 0);</span>
<a href="#l45.292"></a><span id="l45.292" class="difflineminus">-  if(NULL != hIcon) {</span>
<a href="#l45.293"></a><span id="l45.293" class="difflineminus">-    SendMessage(hWnd, WM_SETICON, FALSE, (LPARAM)hIcon);</span>
<a href="#l45.294"></a><span id="l45.294" class="difflineminus">-  } else {</span>
<a href="#l45.295"></a><span id="l45.295" class="difflineminus">-    HICON hIcon = LoadIcon(hInst, MAKEINTRESOURCE(uIconResourceId));</span>
<a href="#l45.296"></a><span id="l45.296" class="difflineminus">-    assert(hIcon != 0);</span>
<a href="#l45.297"></a><span id="l45.297" class="difflineminus">-    SendMessage(hWnd, WM_SETICON, FALSE, (LPARAM)hIcon);</span>
<a href="#l45.298"></a><span id="l45.298" class="difflineminus">-  }</span>
<a href="#l45.299"></a><span id="l45.299" class="difflineminus">-#endif // WIN32</span>
<a href="#l45.300"></a><span id="l45.300" class="difflineminus">-}</span>
<a href="#l45.301"></a><span id="l45.301" class="difflineminus">-#endif // __cplusplus</span>
<a href="#l45.302"></a><span id="l45.302" class="difflineminus">-</span>
<a href="#l45.303"></a><span id="l45.303" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l45.304"></a><span id="l45.304" class="difflineminus">-}</span>
<a href="#l45.305"></a><span id="l45.305" class="difflineminus">-#endif /* __cplusplus */</span>
<a href="#l45.306"></a><span id="l45.306" class="difflineminus">-</span>
<a href="#l45.307"></a><span id="l45.307" class="difflineminus">-#endif /* PORT_H */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1">deleted file mode 100644</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/readmail.cpp</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineplus">+++ /dev/null</span>
<a href="#l46.4"></a><span id="l46.4" class="difflineat">@@ -1,137 +0,0 @@</span>
<a href="#l46.5"></a><span id="l46.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l46.6"></a><span id="l46.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l46.7"></a><span id="l46.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l46.8"></a><span id="l46.8" class="difflineminus">- *</span>
<a href="#l46.9"></a><span id="l46.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l46.10"></a><span id="l46.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l46.11"></a><span id="l46.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineminus">- *</span>
<a href="#l46.14"></a><span id="l46.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l46.16"></a><span id="l46.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l46.17"></a><span id="l46.17" class="difflineminus">- * License.</span>
<a href="#l46.18"></a><span id="l46.18" class="difflineminus">- *</span>
<a href="#l46.19"></a><span id="l46.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l46.20"></a><span id="l46.20" class="difflineminus">- *</span>
<a href="#l46.21"></a><span id="l46.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l46.22"></a><span id="l46.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l46.23"></a><span id="l46.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l46.24"></a><span id="l46.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l46.25"></a><span id="l46.25" class="difflineminus">- *</span>
<a href="#l46.26"></a><span id="l46.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l46.27"></a><span id="l46.27" class="difflineminus">- *</span>
<a href="#l46.28"></a><span id="l46.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l46.29"></a><span id="l46.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l46.30"></a><span id="l46.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l46.34"></a><span id="l46.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l46.35"></a><span id="l46.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l46.36"></a><span id="l46.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l46.37"></a><span id="l46.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l46.38"></a><span id="l46.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l46.39"></a><span id="l46.39" class="difflineminus">- *</span>
<a href="#l46.40"></a><span id="l46.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l46.41"></a><span id="l46.41" class="difflineminus">-//</span>
<a href="#l46.42"></a><span id="l46.42" class="difflineminus">-#include &lt;windows.h&gt;</span>
<a href="#l46.43"></a><span id="l46.43" class="difflineminus">-#include &lt;windowsx.h&gt;</span>
<a href="#l46.44"></a><span id="l46.44" class="difflineminus">-</span>
<a href="#l46.45"></a><span id="l46.45" class="difflineminus">-#ifndef MAPI_OLE	// Because MSFT doesn't do this for us :-(</span>
<a href="#l46.46"></a><span id="l46.46" class="difflineminus">-#include &lt;mapi.h&gt;</span>
<a href="#l46.47"></a><span id="l46.47" class="difflineminus">-#endif</span>
<a href="#l46.48"></a><span id="l46.48" class="difflineminus">-</span>
<a href="#l46.49"></a><span id="l46.49" class="difflineminus">-#include &quot;port.h&quot;</span>
<a href="#l46.50"></a><span id="l46.50" class="difflineminus">-#include &quot;resource.h&quot;</span>
<a href="#l46.51"></a><span id="l46.51" class="difflineminus">-</span>
<a href="#l46.52"></a><span id="l46.52" class="difflineminus">-//</span>
<a href="#l46.53"></a><span id="l46.53" class="difflineminus">-// Variables...</span>
<a href="#l46.54"></a><span id="l46.54" class="difflineminus">-// </span>
<a href="#l46.55"></a><span id="l46.55" class="difflineminus">-extern HINSTANCE   hInst;</span>
<a href="#l46.56"></a><span id="l46.56" class="difflineminus">-extern HINSTANCE   m_hInstMapi;</span>
<a href="#l46.57"></a><span id="l46.57" class="difflineminus">-extern LHANDLE     mapiSession;</span>
<a href="#l46.58"></a><span id="l46.58" class="difflineminus">-</span>
<a href="#l46.59"></a><span id="l46.59" class="difflineminus">-// </span>
<a href="#l46.60"></a><span id="l46.60" class="difflineminus">-// Forward declarations...</span>
<a href="#l46.61"></a><span id="l46.61" class="difflineminus">-//</span>
<a href="#l46.62"></a><span id="l46.62" class="difflineminus">-extern void   ShowMessage(HWND hWnd, LPSTR msg);</span>
<a href="#l46.63"></a><span id="l46.63" class="difflineminus">-extern void   SetFooter(LPSTR msg);</span>
<a href="#l46.64"></a><span id="l46.64" class="difflineminus">-extern LPSTR  GetMAPIError(LONG errorCode);</span>
<a href="#l46.65"></a><span id="l46.65" class="difflineminus">-lpMapiMessage mailPtr = NULL;</span>
<a href="#l46.66"></a><span id="l46.66" class="difflineminus">-</span>
<a href="#l46.67"></a><span id="l46.67" class="difflineminus">-void </span>
<a href="#l46.68"></a><span id="l46.68" class="difflineminus">-ProcessReadMailCommand(HWND hWnd, int id, HWND hCtl, UINT codeNotify) </span>
<a href="#l46.69"></a><span id="l46.69" class="difflineminus">-{ </span>
<a href="#l46.70"></a><span id="l46.70" class="difflineminus">-  switch (id) </span>
<a href="#l46.71"></a><span id="l46.71" class="difflineminus">-  {</span>
<a href="#l46.72"></a><span id="l46.72" class="difflineminus">-  case ID_OK:</span>
<a href="#l46.73"></a><span id="l46.73" class="difflineminus">-  case IDCANCEL:</span>
<a href="#l46.74"></a><span id="l46.74" class="difflineminus">-    EndDialog(hWnd, 0);</span>
<a href="#l46.75"></a><span id="l46.75" class="difflineminus">-    break;</span>
<a href="#l46.76"></a><span id="l46.76" class="difflineminus">-</span>
<a href="#l46.77"></a><span id="l46.77" class="difflineminus">-  default:</span>
<a href="#l46.78"></a><span id="l46.78" class="difflineminus">-    break;</span>
<a href="#l46.79"></a><span id="l46.79" class="difflineminus">-  }</span>
<a href="#l46.80"></a><span id="l46.80" class="difflineminus">-}</span>
<a href="#l46.81"></a><span id="l46.81" class="difflineminus">-</span>
<a href="#l46.82"></a><span id="l46.82" class="difflineminus">-BOOL CALLBACK LOADDS </span>
<a href="#l46.83"></a><span id="l46.83" class="difflineminus">-ReadMailDlgProc(HWND hWndMail, UINT wMsg, WPARAM wParam, LPARAM lParam) </span>
<a href="#l46.84"></a><span id="l46.84" class="difflineminus">-{</span>
<a href="#l46.85"></a><span id="l46.85" class="difflineminus">-  switch (wMsg) </span>
<a href="#l46.86"></a><span id="l46.86" class="difflineminus">-  {</span>
<a href="#l46.87"></a><span id="l46.87" class="difflineminus">-  case WM_INITDIALOG: </span>
<a href="#l46.88"></a><span id="l46.88" class="difflineminus">-    {</span>
<a href="#l46.89"></a><span id="l46.89" class="difflineminus">-      DWORD i;</span>
<a href="#l46.90"></a><span id="l46.90" class="difflineminus">-      // Do everything we need to display the message pointed to by</span>
<a href="#l46.91"></a><span id="l46.91" class="difflineminus">-      // mailPtr</span>
<a href="#l46.92"></a><span id="l46.92" class="difflineminus">-      if (!mailPtr)</span>
<a href="#l46.93"></a><span id="l46.93" class="difflineminus">-        break;</span>
<a href="#l46.94"></a><span id="l46.94" class="difflineminus">-</span>
<a href="#l46.95"></a><span id="l46.95" class="difflineminus">-      // Start with the basics...</span>
<a href="#l46.96"></a><span id="l46.96" class="difflineminus">-      SetDlgItemText(hWndMail, IDC_EDIT_SUBJECT, mailPtr-&gt;lpszSubject);</span>
<a href="#l46.97"></a><span id="l46.97" class="difflineminus">-      SetDlgItemText(hWndMail, IDC_EDIT_DATETIME, mailPtr-&gt;lpszDateReceived);</span>
<a href="#l46.98"></a><span id="l46.98" class="difflineminus">-      SetDlgItemText(hWndMail, IDC_EDIT_THREAD, mailPtr-&gt;lpszConversationID);</span>
<a href="#l46.99"></a><span id="l46.99" class="difflineminus">-      SetDlgItemText(hWndMail, IDC_EDIT_BODYTEXT, mailPtr-&gt;lpszNoteText);</span>
<a href="#l46.100"></a><span id="l46.100" class="difflineminus">-</span>
<a href="#l46.101"></a><span id="l46.101" class="difflineminus">-      char    buf[1024];</span>
<a href="#l46.102"></a><span id="l46.102" class="difflineminus">-      wsprintf(buf, &quot;%s (%s)&quot;, mailPtr-&gt;lpOriginator-&gt;lpszName, </span>
<a href="#l46.103"></a><span id="l46.103" class="difflineminus">-                              mailPtr-&gt;lpOriginator-&gt;lpszAddress);</span>
<a href="#l46.104"></a><span id="l46.104" class="difflineminus">-      SetDlgItemText(hWndMail, IDC_EDIT_FROM, buf);</span>
<a href="#l46.105"></a><span id="l46.105" class="difflineminus">-</span>
<a href="#l46.106"></a><span id="l46.106" class="difflineminus">-      for (i=0; i&lt;mailPtr-&gt;nRecipCount; i++)</span>
<a href="#l46.107"></a><span id="l46.107" class="difflineminus">-      {</span>
<a href="#l46.108"></a><span id="l46.108" class="difflineminus">-          wsprintf(buf, &quot;%s (%s)&quot;, mailPtr-&gt;lpRecips[i].lpszName, </span>
<a href="#l46.109"></a><span id="l46.109" class="difflineminus">-                                   mailPtr-&gt;lpRecips[i].lpszAddress);</span>
<a href="#l46.110"></a><span id="l46.110" class="difflineminus">-          ListBox_InsertString(GetDlgItem(hWndMail, IDC_LIST_RECIPIENTS), </span>
<a href="#l46.111"></a><span id="l46.111" class="difflineminus">-                  ListBox_GetCount(GetDlgItem(hWndMail, IDC_LIST_RECIPIENTS)), </span>
<a href="#l46.112"></a><span id="l46.112" class="difflineminus">-                  buf);</span>
<a href="#l46.113"></a><span id="l46.113" class="difflineminus">-      }</span>
<a href="#l46.114"></a><span id="l46.114" class="difflineminus">-</span>
<a href="#l46.115"></a><span id="l46.115" class="difflineminus">-      for (i=0; i&lt;mailPtr-&gt;nFileCount; i++)</span>
<a href="#l46.116"></a><span id="l46.116" class="difflineminus">-      {</span>
<a href="#l46.117"></a><span id="l46.117" class="difflineminus">-          ListBox_InsertString(GetDlgItem(hWndMail, IDC_LIST_ATTACHMENTS), </span>
<a href="#l46.118"></a><span id="l46.118" class="difflineminus">-                ListBox_GetCount(GetDlgItem(hWndMail, IDC_LIST_ATTACHMENTS)), </span>
<a href="#l46.119"></a><span id="l46.119" class="difflineminus">-                mailPtr-&gt;lpFiles[i].lpszPathName);</span>
<a href="#l46.120"></a><span id="l46.120" class="difflineminus">-      }</span>
<a href="#l46.121"></a><span id="l46.121" class="difflineminus">-    }</span>
<a href="#l46.122"></a><span id="l46.122" class="difflineminus">-    break;</span>
<a href="#l46.123"></a><span id="l46.123" class="difflineminus">-</span>
<a href="#l46.124"></a><span id="l46.124" class="difflineminus">-  case WM_COMMAND:</span>
<a href="#l46.125"></a><span id="l46.125" class="difflineminus">-    HANDLE_WM_COMMAND(hWndMail, wParam, lParam, ProcessReadMailCommand);</span>
<a href="#l46.126"></a><span id="l46.126" class="difflineminus">-    break;</span>
<a href="#l46.127"></a><span id="l46.127" class="difflineminus">-</span>
<a href="#l46.128"></a><span id="l46.128" class="difflineminus">-  default:</span>
<a href="#l46.129"></a><span id="l46.129" class="difflineminus">-    return FALSE;</span>
<a href="#l46.130"></a><span id="l46.130" class="difflineminus">-  }</span>
<a href="#l46.131"></a><span id="l46.131" class="difflineminus">-  </span>
<a href="#l46.132"></a><span id="l46.132" class="difflineminus">-  return TRUE;</span>
<a href="#l46.133"></a><span id="l46.133" class="difflineminus">-}</span>
<a href="#l46.134"></a><span id="l46.134" class="difflineminus">-</span>
<a href="#l46.135"></a><span id="l46.135" class="difflineminus">-void</span>
<a href="#l46.136"></a><span id="l46.136" class="difflineminus">-DisplayMAPIReadMail(HWND hWnd, lpMapiMessage msgPtr)</span>
<a href="#l46.137"></a><span id="l46.137" class="difflineminus">-{</span>
<a href="#l46.138"></a><span id="l46.138" class="difflineminus">-  mailPtr = msgPtr;</span>
<a href="#l46.139"></a><span id="l46.139" class="difflineminus">-  DialogBox(hInst, MAKEINTRESOURCE(ID_DIALOG_READMAIL), hWnd, </span>
<a href="#l46.140"></a><span id="l46.140" class="difflineminus">-                (DLGPROC)ReadMailDlgProc);</span>
<a href="#l46.141"></a><span id="l46.141" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1">deleted file mode 100644</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineminus">--- a/mailnews/mapi/old/tests/mapitest/resource.h</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineplus">+++ /dev/null</span>
<a href="#l47.4"></a><span id="l47.4" class="difflineat">@@ -1,124 +0,0 @@</span>
<a href="#l47.5"></a><span id="l47.5" class="difflineminus">-//{{NO_DEPENDENCIES}}</span>
<a href="#l47.6"></a><span id="l47.6" class="difflineminus">-// Microsoft Developer Studio generated include file.</span>
<a href="#l47.7"></a><span id="l47.7" class="difflineminus">-// Used by mtest32.rc</span>
<a href="#l47.8"></a><span id="l47.8" class="difflineminus">-//</span>
<a href="#l47.9"></a><span id="l47.9" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l47.10"></a><span id="l47.10" class="difflineminus">- *</span>
<a href="#l47.11"></a><span id="l47.11" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineminus">- *</span>
<a href="#l47.14"></a><span id="l47.14" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l47.15"></a><span id="l47.15" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l47.16"></a><span id="l47.16" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l47.17"></a><span id="l47.17" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l47.18"></a><span id="l47.18" class="difflineminus">- *</span>
<a href="#l47.19"></a><span id="l47.19" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l47.20"></a><span id="l47.20" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l47.21"></a><span id="l47.21" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineminus">- * License.</span>
<a href="#l47.23"></a><span id="l47.23" class="difflineminus">- *</span>
<a href="#l47.24"></a><span id="l47.24" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l47.25"></a><span id="l47.25" class="difflineminus">- *</span>
<a href="#l47.26"></a><span id="l47.26" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l47.27"></a><span id="l47.27" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l47.28"></a><span id="l47.28" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l47.29"></a><span id="l47.29" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l47.30"></a><span id="l47.30" class="difflineminus">- *</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">- * Contributor(s):</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineminus">- *</span>
<a href="#l47.33"></a><span id="l47.33" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l47.34"></a><span id="l47.34" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l47.35"></a><span id="l47.35" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l47.36"></a><span id="l47.36" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l47.37"></a><span id="l47.37" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l47.38"></a><span id="l47.38" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l47.39"></a><span id="l47.39" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l47.40"></a><span id="l47.40" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l47.41"></a><span id="l47.41" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l47.42"></a><span id="l47.42" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l47.43"></a><span id="l47.43" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l47.44"></a><span id="l47.44" class="difflineminus">- *</span>
<a href="#l47.45"></a><span id="l47.45" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l47.46"></a><span id="l47.46" class="difflineminus">-#define ID_GUI_MESSAGE1                 1</span>
<a href="#l47.47"></a><span id="l47.47" class="difflineminus">-#define ID_BUTTON_MAPIADDRESS           3</span>
<a href="#l47.48"></a><span id="l47.48" class="difflineminus">-#define ID_DIALOG                       101</span>
<a href="#l47.49"></a><span id="l47.49" class="difflineminus">-#define ID_ICON_APP                     102</span>
<a href="#l47.50"></a><span id="l47.50" class="difflineminus">-#define ID_MENU                         104</span>
<a href="#l47.51"></a><span id="l47.51" class="difflineminus">-#define ID_DIALOG_MAIL                  105</span>
<a href="#l47.52"></a><span id="l47.52" class="difflineminus">-#define ID_DIALOG_READMAIL              106</span>
<a href="#l47.53"></a><span id="l47.53" class="difflineminus">-#define ID_SETFROMEDIT                  1000</span>
<a href="#l47.54"></a><span id="l47.54" class="difflineminus">-#define ID_SETTEXT                      1001</span>
<a href="#l47.55"></a><span id="l47.55" class="difflineminus">-#define ID_GETROWS                      1001</span>
<a href="#l47.56"></a><span id="l47.56" class="difflineminus">-#define ID_EDIT                         1002</span>
<a href="#l47.57"></a><span id="l47.57" class="difflineminus">-#define ID_EDIT_HWND                    1002</span>
<a href="#l47.58"></a><span id="l47.58" class="difflineminus">-#define ID_RESOURCETEXT                 1003</span>
<a href="#l47.59"></a><span id="l47.59" class="difflineminus">-#define ID_GETTEXT                      1003</span>
<a href="#l47.60"></a><span id="l47.60" class="difflineminus">-#define ID_STATIC_RESULT                1004</span>
<a href="#l47.61"></a><span id="l47.61" class="difflineminus">-#define ID_GETVISROWS                   1005</span>
<a href="#l47.62"></a><span id="l47.62" class="difflineminus">-#define ID_GETWINID                     1006</span>
<a href="#l47.63"></a><span id="l47.63" class="difflineminus">-#define ID_SETROWFOCUS                  1007</span>
<a href="#l47.64"></a><span id="l47.64" class="difflineminus">-#define ID_GETROWFOCUS                  1008</span>
<a href="#l47.65"></a><span id="l47.65" class="difflineminus">-#define ID_EDIT_ROW                     1009</span>
<a href="#l47.66"></a><span id="l47.66" class="difflineminus">-#define ID_LIST_RESULT                  1010</span>
<a href="#l47.67"></a><span id="l47.67" class="difflineminus">-#define ID_GETCOLCOUNT                  1011</span>
<a href="#l47.68"></a><span id="l47.68" class="difflineminus">-#define ID_BUTTON_LOGON                 1011</span>
<a href="#l47.69"></a><span id="l47.69" class="difflineminus">-#define ID_SETROWINVIEW                 1012</span>
<a href="#l47.70"></a><span id="l47.70" class="difflineminus">-#define ID_BUTTON_LOGOFF                1012</span>
<a href="#l47.71"></a><span id="l47.71" class="difflineminus">-#define ID_GETNUMCHILDREN               1013</span>
<a href="#l47.72"></a><span id="l47.72" class="difflineminus">-#define ID_EDIT_USERNAME                1013</span>
<a href="#l47.73"></a><span id="l47.73" class="difflineminus">-#define ID_CLEARRESULTS                 1014</span>
<a href="#l47.74"></a><span id="l47.74" class="difflineminus">-#define ID_EDIT_PW                      1014</span>
<a href="#l47.75"></a><span id="l47.75" class="difflineminus">-#define ID_BUTTON_FINDNEXT              1015</span>
<a href="#l47.76"></a><span id="l47.76" class="difflineminus">-#define ID_BUTTON_CLEAR                 1016</span>
<a href="#l47.77"></a><span id="l47.77" class="difflineminus">-#define ID_BUTTON_READMAIL              1017</span>
<a href="#l47.78"></a><span id="l47.78" class="difflineminus">-#define ID_BUTTON_DELETEMAIL            1018</span>
<a href="#l47.79"></a><span id="l47.79" class="difflineminus">-#define IDC_EDIT_RESOLVENAME            1019</span>
<a href="#l47.80"></a><span id="l47.80" class="difflineminus">-#define ID_BUTTON_MAPISENDMAIL          1020</span>
<a href="#l47.81"></a><span id="l47.81" class="difflineminus">-#define ID_BUTTON_NSCPVERSION           1020</span>
<a href="#l47.82"></a><span id="l47.82" class="difflineminus">-#define ID_BUTTON_RESOLVENAME           1021</span>
<a href="#l47.83"></a><span id="l47.83" class="difflineminus">-#define ID_BUTTON_MAPISENDDOCUMENTS     1021</span>
<a href="#l47.84"></a><span id="l47.84" class="difflineminus">-#define ID_EDIT_TOADDRESS               1022</span>
<a href="#l47.85"></a><span id="l47.85" class="difflineminus">-#define ID_EDIT_CCADDRESS               1023</span>
<a href="#l47.86"></a><span id="l47.86" class="difflineminus">-#define ID_BUTTON_DETAILS               1024</span>
<a href="#l47.87"></a><span id="l47.87" class="difflineminus">-#define ID_EDIT_BCCADDRESS              1024</span>
<a href="#l47.88"></a><span id="l47.88" class="difflineminus">-#define ID_EDIT_SUBJECT                 1025</span>
<a href="#l47.89"></a><span id="l47.89" class="difflineminus">-#define ID_BUTTON_MAIL                  1025</span>
<a href="#l47.90"></a><span id="l47.90" class="difflineminus">-#define ID_BUTTON_FREEBUFFER            1026</span>
<a href="#l47.91"></a><span id="l47.91" class="difflineminus">-#define ID_EDIT_NOTETEXT                1026</span>
<a href="#l47.92"></a><span id="l47.92" class="difflineminus">-#define ID_EDIT_ATTACH1                 1027</span>
<a href="#l47.93"></a><span id="l47.93" class="difflineminus">-#define ID_BUTTON_SYNC                  1027</span>
<a href="#l47.94"></a><span id="l47.94" class="difflineminus">-#define ID_EDIT_ATTACH2                 1028</span>
<a href="#l47.95"></a><span id="l47.95" class="difflineminus">-#define IDC_CHECK_BODYASFILE            1028</span>
<a href="#l47.96"></a><span id="l47.96" class="difflineminus">-#define ID_EDIT_ATTACH3                 1029</span>
<a href="#l47.97"></a><span id="l47.97" class="difflineminus">-#define IDC_CHECK_ENVELOPEONLY          1029</span>
<a href="#l47.98"></a><span id="l47.98" class="difflineminus">-#define IDC_LIST_ATTACHMENTS            1029</span>
<a href="#l47.99"></a><span id="l47.99" class="difflineminus">-#define ID_EDIT_ATTACH4                 1030</span>
<a href="#l47.100"></a><span id="l47.100" class="difflineminus">-#define IDC_CHECK_PEEK                  1030</span>
<a href="#l47.101"></a><span id="l47.101" class="difflineminus">-#define IDC_EDIT_BODYTEXT               1030</span>
<a href="#l47.102"></a><span id="l47.102" class="difflineminus">-#define IDC_CHECK_SUPPRESSATTACH        1031</span>
<a href="#l47.103"></a><span id="l47.103" class="difflineminus">-#define IDC_LIST_RECIPIENTS             1031</span>
<a href="#l47.104"></a><span id="l47.104" class="difflineminus">-#define ID_BUTTON_MAPISAVEMAIL          1031</span>
<a href="#l47.105"></a><span id="l47.105" class="difflineminus">-#define IDC_EDIT_SUBJECT                1032</span>
<a href="#l47.106"></a><span id="l47.106" class="difflineminus">-#define IDC_EDIT_DATETIME               1033</span>
<a href="#l47.107"></a><span id="l47.107" class="difflineminus">-#define ID_OK                           1034</span>
<a href="#l47.108"></a><span id="l47.108" class="difflineminus">-#define IDC_EDIT_THREAD                 1035</span>
<a href="#l47.109"></a><span id="l47.109" class="difflineminus">-#define ID_CHECK_SHOWDIALOG             1035</span>
<a href="#l47.110"></a><span id="l47.110" class="difflineminus">-#define IDC_EDIT_FROM                   1036</span>
<a href="#l47.111"></a><span id="l47.111" class="difflineminus">-#define ID_MENU_MYEXIT                  30001</span>
<a href="#l47.112"></a><span id="l47.112" class="difflineminus">-#define ID_MENU_CLEAR                   30002</span>
<a href="#l47.113"></a><span id="l47.113" class="difflineminus">-#define ID_MENU_MYABOUT                 30003</span>
<a href="#l47.114"></a><span id="l47.114" class="difflineminus">-#define ID_MENU_CLEARRESULTS            30004</span>
<a href="#l47.115"></a><span id="l47.115" class="difflineminus">-#define ID_MENU_MAPIDELETEMAIL          30005</span>
<a href="#l47.116"></a><span id="l47.116" class="difflineminus">-#define ID_MENU_MAPIFINDNEXT            30006</span>
<a href="#l47.117"></a><span id="l47.117" class="difflineminus">-#define ID_MENU_MAPIREADMAIL            30007</span>
<a href="#l47.118"></a><span id="l47.118" class="difflineminus">-</span>
<a href="#l47.119"></a><span id="l47.119" class="difflineminus">-// Next default values for new objects</span>
<a href="#l47.120"></a><span id="l47.120" class="difflineminus">-// </span>
<a href="#l47.121"></a><span id="l47.121" class="difflineminus">-#ifdef APSTUDIO_INVOKED</span>
<a href="#l47.122"></a><span id="l47.122" class="difflineminus">-#ifndef APSTUDIO_READONLY_SYMBOLS</span>
<a href="#l47.123"></a><span id="l47.123" class="difflineminus">-#define _APS_NEXT_RESOURCE_VALUE        107</span>
<a href="#l47.124"></a><span id="l47.124" class="difflineminus">-#define _APS_NEXT_COMMAND_VALUE         30008</span>
<a href="#l47.125"></a><span id="l47.125" class="difflineminus">-#define _APS_NEXT_CONTROL_VALUE         1036</span>
<a href="#l47.126"></a><span id="l47.126" class="difflineminus">-#define _APS_NEXT_SYMED_VALUE           101</span>
<a href="#l47.127"></a><span id="l47.127" class="difflineminus">-#endif</span>
<a href="#l47.128"></a><span id="l47.128" class="difflineminus">-#endif</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

