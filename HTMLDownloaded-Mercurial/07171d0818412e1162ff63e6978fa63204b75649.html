<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20751:07171d0818412e1162ff63e6978fa63204b75649</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 07171d0818412e1162ff63e6978fa63204b75649" />
<meta property="og:url" content="/comm-central/rev/07171d0818412e1162ff63e6978fa63204b75649" />
<meta property="og:description" content="Bug 857230 - Convert nsIMsgFilter::searchTerms from nsISupportsArray to nsIMutableArray. r=aceman,jorgk,mkmelin,Ratty a=Ratty" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 07171d0818412e1162ff63e6978fa63204b75649 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/07171d0818412e1162ff63e6978fa63204b75649">shortlog</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/07171d0818412e1162ff63e6978fa63204b75649">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649">files</a> |
changeset |
<a href="/comm-central/raw-rev/07171d0818412e1162ff63e6978fa63204b75649">raw</a>  | <a href="/comm-central/archive/07171d0818412e1162ff63e6978fa63204b75649.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=857230">Bug 857230</a> - Convert nsIMsgFilter::searchTerms from nsISupportsArray to nsIMutableArray. r=aceman,jorgk,mkmelin,Ratty a=Ratty
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#69;&#114;&#105;&#99;&#32;&#82;&#97;&#104;&#109;&#32;&#60;&#101;&#114;&#97;&#104;&#109;&#64;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 16 Nov 2016 12:43:32 -0800</td></tr>

<tr>
 <td>changeset 20751</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/07171d0818412e1162ff63e6978fa63204b75649">07171d0818412e1162ff63e6978fa63204b75649</a></td>
</tr>



<tr>
<td>parent 20750</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5aa6e96146e52ae578d36c5ac5afc246c5b77c5a">5aa6e96146e52ae578d36c5ac5afc246c5b77c5a</a>
</td>
</tr>

<tr>
<td>child 20752</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/aa2c8b078e9cadd736deac46a5a26376048992be">aa2c8b078e9cadd736deac46a5a26376048992be</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=07171d0818412e1162ff63e6978fa63204b75649">12564</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 23 Nov 2016 19:57:34 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@07171d081841 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=07171d0818412e1162ff63e6978fa63204b75649">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=07171d0818412e1162ff63e6978fa63204b75649&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=07171d0818412e1162ff63e6978fa63204b75649&newProject=comm-central&newRevision=07171d0818412e1162ff63e6978fa63204b75649&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=07171d0818412e1162ff63e6978fa63204b75649&newProject=comm-central&newRevision=07171d0818412e1162ff63e6978fa63204b75649&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=07171d0818412e1162ff63e6978fa63204b75649&newProject=comm-central&newRevision=07171d0818412e1162ff63e6978fa63204b75649&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a>, <a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a>, <a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a>, <a href="/comm-central/log?rev=reviewer%28Ratty%29&revcount=50">Ratty</a>, <a href="/comm-central/log?rev=reviewer%28Ratty%29&revcount=50">Ratty</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=857230">857230</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=857230">Bug 857230</a> - Convert nsIMsgFilter::searchTerms from nsISupportsArray to nsIMutableArray. r=aceman,jorgk,mkmelin,Ratty a=Ratty</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mail/base/content/ABSearchDialog.js">mail/base/content/ABSearchDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mail/base/content/ABSearchDialog.js">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mail/base/content/ABSearchDialog.js">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mail/base/content/ABSearchDialog.js">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mail/base/content/ABSearchDialog.js">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mail/base/content/ABSearchDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mail/base/modules/searchSpec.js">mail/base/modules/searchSpec.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mail/base/modules/searchSpec.js">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mail/base/modules/searchSpec.js">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mail/base/modules/searchSpec.js">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mail/base/modules/searchSpec.js">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mail/base/modules/searchSpec.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/FilterEditor.js">mailnews/base/search/content/FilterEditor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/FilterEditor.js">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/FilterEditor.js">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/FilterEditor.js">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/FilterEditor.js">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/FilterEditor.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/searchTermOverlay.js">mailnews/base/search/content/searchTermOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/searchTermOverlay.js">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/searchTermOverlay.js">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/searchTermOverlay.js">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/searchTermOverlay.js">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/content/searchTermOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgFilter.idl">mailnews/base/search/public/nsIMsgFilter.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgFilter.idl">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgFilter.idl">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgFilter.idl">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgFilter.idl">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgFilter.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchSession.idl">mailnews/base/search/public/nsIMsgSearchSession.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchSession.idl">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchSession.idl">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchSession.idl">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchSession.idl">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchSession.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchValidityTable.idl">mailnews/base/search/public/nsIMsgSearchValidityTable.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchValidityTable.idl">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchValidityTable.idl">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchValidityTable.idl">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchValidityTable.idl">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsIMsgSearchValidityTable.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchAdapter.h">mailnews/base/search/public/nsMsgSearchAdapter.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchAdapter.h">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchAdapter.h">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchAdapter.h">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchAdapter.h">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchAdapter.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchScopeTerm.h">mailnews/base/search/public/nsMsgSearchScopeTerm.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchScopeTerm.h">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchScopeTerm.h">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchScopeTerm.h">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchScopeTerm.h">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/public/nsMsgSearchScopeTerm.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.cpp">mailnews/base/search/src/nsMsgFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.h">mailnews/base/search/src/nsMsgFilter.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.h">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.h">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.h">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.h">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilter.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterList.cpp">mailnews/base/search/src/nsMsgFilterList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterList.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterList.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterList.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterList.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterService.cpp">mailnews/base/search/src/nsMsgFilterService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterService.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterService.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterService.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterService.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgFilterService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgImapSearch.cpp">mailnews/base/search/src/nsMsgImapSearch.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgImapSearch.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgImapSearch.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgImapSearch.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgImapSearch.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgImapSearch.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.cpp">mailnews/base/search/src/nsMsgLocalSearch.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.h">mailnews/base/search/src/nsMsgLocalSearch.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.h">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.h">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.h">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.h">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgLocalSearch.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchAdapter.cpp">mailnews/base/search/src/nsMsgSearchAdapter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchAdapter.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchAdapter.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchAdapter.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchAdapter.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchAdapter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchImap.h">mailnews/base/search/src/nsMsgSearchImap.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchImap.h">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchImap.h">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchImap.h">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchImap.h">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchImap.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.cpp">mailnews/base/search/src/nsMsgSearchNews.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.h">mailnews/base/search/src/nsMsgSearchNews.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.h">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.h">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.h">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.h">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchNews.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.cpp">mailnews/base/search/src/nsMsgSearchSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.h">mailnews/base/search/src/nsMsgSearchSession.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.h">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.h">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.h">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.h">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchSession.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/virtualFolderWrapper.js">mailnews/base/src/virtualFolderWrapper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/virtualFolderWrapper.js">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/virtualFolderWrapper.js">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/virtualFolderWrapper.js">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/virtualFolderWrapper.js">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/src/virtualFolderWrapper.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.h">mailnews/base/util/nsMsgUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.h">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.h">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.h">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.h">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/base/util/nsMsgUtils.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/public/nsIMsgMailView.idl">mailnews/extensions/mailviews/public/nsIMsgMailView.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/public/nsIMsgMailView.idl">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/public/nsIMsgMailView.idl">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/public/nsIMsgMailView.idl">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/public/nsIMsgMailView.idl">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/public/nsIMsgMailView.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.h">mailnews/extensions/mailviews/src/nsMsgMailViewList.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.h">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.h">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.h">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.h">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/extensions/mailviews/src/nsMsgMailViewList.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/commandglue.js">suite/mailnews/commandglue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/commandglue.js">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/commandglue.js">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/commandglue.js">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/commandglue.js">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/commandglue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/msgViewPickerOverlay.js">suite/mailnews/msgViewPickerOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/msgViewPickerOverlay.js">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/msgViewPickerOverlay.js">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/msgViewPickerOverlay.js">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/msgViewPickerOverlay.js">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/msgViewPickerOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/search/ABSearchDialog.js">suite/mailnews/search/ABSearchDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/search/ABSearchDialog.js">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/search/ABSearchDialog.js">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/search/ABSearchDialog.js">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/search/ABSearchDialog.js">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/search/ABSearchDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/searchBar.js">suite/mailnews/searchBar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/searchBar.js">file</a> |
<a href="/comm-central/annotate/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/searchBar.js">annotate</a> |
<a href="/comm-central/diff/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/searchBar.js">diff</a> |
<a href="/comm-central/comparison/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/searchBar.js">comparison</a> |
<a href="/comm-central/log/07171d0818412e1162ff63e6978fa63204b75649/suite/mailnews/searchBar.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/ABSearchDialog.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/ABSearchDialog.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.5"></a><span id="l1.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.6"></a><span id="l1.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> Components.utils.import(&quot;resource:///modules/ABQueryUtils.jsm&quot;);</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineplus">+Components.utils.import(&quot;resource:///modules/iteratorUtils.js&quot;);</span>
<a href="#l1.10"></a><span id="l1.10"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l1.11"></a><span id="l1.11"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l1.12"></a><span id="l1.12"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l1.13"></a><span id="l1.13"> </span>
<a href="#l1.14"></a><span id="l1.14"> var searchSessionContractID = &quot;@mozilla.org/messenger/searchSession;1&quot;;</span>
<a href="#l1.15"></a><span id="l1.15"> var gSearchSession;</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> var nsMsgSearchScope = Components.interfaces.nsMsgSearchScope;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineat">@@ -173,21 +174,17 @@ function onSearch()</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">     var currentAbURI = document.getElementById('abPopup').getAttribute('value');</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22">     gSearchSession.addDirectoryScopeTerm(GetScopeForDirectoryURI(currentAbURI));</span>
<a href="#l1.23"></a><span id="l1.23">     saveSearchTerms(gSearchSession.searchTerms, gSearchSession);</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">     var searchUri = currentAbURI + &quot;?(&quot;;</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-    var count = gSearchSession.searchTerms.Count();</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-    for (var i=0; i&lt;count; i++) {</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-      var searchTerm = gSearchSession.searchTerms.GetElementAt(i).QueryInterface(nsIMsgSearchTerm);</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+    for (let searchTerm of fixIterator(gSearchSession.searchTerms, nsIMsgSearchTerm)) {</span>
<a href="#l1.33"></a><span id="l1.33">       // get the &quot;and&quot; / &quot;or&quot; value from the first term</span>
<a href="#l1.34"></a><span id="l1.34">       if (i == 0) {</span>
<a href="#l1.35"></a><span id="l1.35">        if (searchTerm.booleanAnd)</span>
<a href="#l1.36"></a><span id="l1.36">          searchUri += &quot;and&quot;;</span>
<a href="#l1.37"></a><span id="l1.37">        else</span>
<a href="#l1.38"></a><span id="l1.38">          searchUri += &quot;or&quot;;</span>
<a href="#l1.39"></a><span id="l1.39">       }</span>
<a href="#l1.40"></a><span id="l1.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/modules/searchSpec.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/modules/searchSpec.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -356,17 +356,17 @@ SearchSpec.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">    *  userTerms.  The way this works is that each of the 'context' sets of</span>
<a href="#l2.5"></a><span id="l2.5">    *  terms gets wrapped into a group which is boolean anded together with</span>
<a href="#l2.6"></a><span id="l2.6">    *  everything else.</span>
<a href="#l2.7"></a><span id="l2.7">    */</span>
<a href="#l2.8"></a><span id="l2.8">   updateSession: function SearchSpec_applySearch() {</span>
<a href="#l2.9"></a><span id="l2.9">     let session = this.session;</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">     // clear out our current terms and scope</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    session.searchTerms.QueryInterface(Ci.nsISupportsArray).Clear();</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    session.searchTerms.clear();</span>
<a href="#l2.14"></a><span id="l2.14">     session.clearScopes();</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16">     // the scope logic needs to know if any terms look at the body attribute.</span>
<a href="#l2.17"></a><span id="l2.17">     let haveBodyTerm = false;</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">     // -- apply terms</span>
<a href="#l2.20"></a><span id="l2.20">     if (this._virtualFolderTerms) {</span>
<a href="#l2.21"></a><span id="l2.21">       for (let term in fixIterator(this._virtualFolderTerms,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/search/content/FilterEditor.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/search/content/FilterEditor.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -132,19 +132,19 @@ function filterEditorOnLoad()</span>
<a href="#l3.4"></a><span id="l3.4">         // copy the actions</span>
<a href="#l3.5"></a><span id="l3.5">         for (let i = 0; i &lt; copiedFilter.actionCount; i++)</span>
<a href="#l3.6"></a><span id="l3.6">         {</span>
<a href="#l3.7"></a><span id="l3.7">           let filterAction = copiedFilter.getActionAt(i);</span>
<a href="#l3.8"></a><span id="l3.8">           newFilter.appendAction(filterAction);</span>
<a href="#l3.9"></a><span id="l3.9">         }</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">         // copy the search terms</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-        for (let i = 0; i &lt; copiedFilter.searchTerms.Count(); i++)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+        for (let i = 0; i &lt; copiedFilter.searchTerms.length; i++)</span>
<a href="#l3.14"></a><span id="l3.14">         {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-          var searchTerm = copiedFilter.searchTerms.QueryElementAt(i,</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+          let searchTerm = copiedFilter.searchTerms.queryElementAt(i,</span>
<a href="#l3.17"></a><span id="l3.17">             Components.interfaces.nsIMsgSearchTerm);</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">           var newTerm = newFilter.createTerm();</span>
<a href="#l3.20"></a><span id="l3.20">           newTerm.attrib = searchTerm.attrib;</span>
<a href="#l3.21"></a><span id="l3.21">           newTerm.op = searchTerm.op;</span>
<a href="#l3.22"></a><span id="l3.22">           newTerm.booleanAnd = searchTerm.booleanAnd;</span>
<a href="#l3.23"></a><span id="l3.23">           newTerm.value = searchTerm.value;</span>
<a href="#l3.24"></a><span id="l3.24">           newFilter.appendTerm(newTerm);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/search/content/searchTermOverlay.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/search/content/searchTermOverlay.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -168,18 +168,18 @@ function initializeBooleanWidgets()</span>
<a href="#l4.4"></a><span id="l4.4">       : (booleanAnd ? &quot;and&quot; : &quot;or&quot;)</span>
<a href="#l4.5"></a><span id="l4.5">     var searchTerms = document.getElementById(&quot;searchTermList&quot;);</span>
<a href="#l4.6"></a><span id="l4.6">     if (searchTerms)</span>
<a href="#l4.7"></a><span id="l4.7">       updateSearchTermsListbox(matchAll);</span>
<a href="#l4.8"></a><span id="l4.8"> }</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10"> function initializeSearchRows(scope, searchTerms)</span>
<a href="#l4.11"></a><span id="l4.11"> {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    for (var i = 0; i &lt; searchTerms.Count(); i++) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-        var searchTerm = searchTerms.QueryElementAt(i, nsIMsgSearchTerm);</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+    for (let i = 0; i &lt; searchTerms.length; i++) {</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+        let searchTerm = searchTerms.queryElementAt(i, nsIMsgSearchTerm);</span>
<a href="#l4.16"></a><span id="l4.16">         createSearchRow(i, scope, searchTerm, false);</span>
<a href="#l4.17"></a><span id="l4.17">         gTotalSearchTerms++;</span>
<a href="#l4.18"></a><span id="l4.18">     }</span>
<a href="#l4.19"></a><span id="l4.19">     initializeBooleanWidgets();</span>
<a href="#l4.20"></a><span id="l4.20">     updateRemoveRowButton();</span>
<a href="#l4.21"></a><span id="l4.21"> }</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23"> /**</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineat">@@ -465,38 +465,38 @@ function removeSearchRow(index)</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26">     if (!listitem) {</span>
<a href="#l4.27"></a><span id="l4.27">         dump(&quot;Error: couldn't find parent listitem!\n&quot;);</span>
<a href="#l4.28"></a><span id="l4.28">         return;</span>
<a href="#l4.29"></a><span id="l4.29">     }</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31"> </span>
<a href="#l4.32"></a><span id="l4.32">     if (searchTermObj.searchTerm) {</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-        gSearchRemovedTerms[gSearchRemovedTerms.length] = searchTermObj.searchTerm;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+        gSearchRemovedTerms.push(searchTermObj.searchTerm);</span>
<a href="#l4.35"></a><span id="l4.35">     } else {</span>
<a href="#l4.36"></a><span id="l4.36">         //dump(&quot;That wasn't real. ignoring \n&quot;);</span>
<a href="#l4.37"></a><span id="l4.37">     }</span>
<a href="#l4.38"></a><span id="l4.38"> </span>
<a href="#l4.39"></a><span id="l4.39">     listitem.remove();</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-    </span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+</span>
<a href="#l4.42"></a><span id="l4.42">     // now remove the item from our list of terms</span>
<a href="#l4.43"></a><span id="l4.43">     gSearchTerms.splice(index, 1); </span>
<a href="#l4.44"></a><span id="l4.44"> }</span>
<a href="#l4.45"></a><span id="l4.45"> </span>
<a href="#l4.46"></a><span id="l4.46"> // save the search terms from the UI back to the actual search terms</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-// searchTerms: nsISupportsArray of terms</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+// searchTerms: nsIMutableArray of terms</span>
<a href="#l4.49"></a><span id="l4.49"> // termOwner:   object which can contain and create the terms</span>
<a href="#l4.50"></a><span id="l4.50"> //              (will be unnecessary if we just make terms creatable</span>
<a href="#l4.51"></a><span id="l4.51"> //               via XPCOM)</span>
<a href="#l4.52"></a><span id="l4.52"> function saveSearchTerms(searchTerms, termOwner)</span>
<a href="#l4.53"></a><span id="l4.53"> {</span>
<a href="#l4.54"></a><span id="l4.54">     var matchAll = gSearchBooleanRadiogroup.value == 'matchAll';</span>
<a href="#l4.55"></a><span id="l4.55">     var i;</span>
<a href="#l4.56"></a><span id="l4.56">     for (i = 0; i &lt; gSearchRemovedTerms.length; i++)</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-        searchTerms.RemoveElement(gSearchRemovedTerms[i]);</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+        searchTerms.removeElementAt(searchTerms.indexOf(0, gSearchRemovedTerms[i]));</span>
<a href="#l4.59"></a><span id="l4.59"> </span>
<a href="#l4.60"></a><span id="l4.60">     for (i = 0; i&lt;gSearchTerms.length; i++) {</span>
<a href="#l4.61"></a><span id="l4.61">         try {</span>
<a href="#l4.62"></a><span id="l4.62">             gSearchTerms[i].obj.matchAll = matchAll;</span>
<a href="#l4.63"></a><span id="l4.63">             var searchTerm = gSearchTerms[i].obj.searchTerm;</span>
<a href="#l4.64"></a><span id="l4.64">             if (searchTerm)</span>
<a href="#l4.65"></a><span id="l4.65">                 gSearchTerms[i].obj.save();</span>
<a href="#l4.66"></a><span id="l4.66">             else if (!gSearchTerms[i].initialized)</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineat">@@ -505,17 +505,17 @@ function saveSearchTerms(searchTerms, te</span>
<a href="#l4.68"></a><span id="l4.68">             else {</span>
<a href="#l4.69"></a><span id="l4.69">                 // need to create a new searchTerm, and somehow save it to that</span>
<a href="#l4.70"></a><span id="l4.70">                 searchTerm = termOwner.createTerm();</span>
<a href="#l4.71"></a><span id="l4.71">                 gSearchTerms[i].obj.saveTo(searchTerm);</span>
<a href="#l4.72"></a><span id="l4.72">                 // this might not be the right place for the term,</span>
<a href="#l4.73"></a><span id="l4.73">                 // but we need to make the array longer anyway</span>
<a href="#l4.74"></a><span id="l4.74">                 termOwner.appendTerm(searchTerm);</span>
<a href="#l4.75"></a><span id="l4.75">             }</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-            searchTerms.SetElementAt(i, searchTerm);</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+            searchTerms.replaceElementAt(searchTerm, i, /* weak */ false);</span>
<a href="#l4.78"></a><span id="l4.78">         } catch (ex) {</span>
<a href="#l4.79"></a><span id="l4.79">             dump(&quot;** Error saving element &quot; + i + &quot;: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l4.80"></a><span id="l4.80">         }</span>
<a href="#l4.81"></a><span id="l4.81">     }</span>
<a href="#l4.82"></a><span id="l4.82"> }</span>
<a href="#l4.83"></a><span id="l4.83"> </span>
<a href="#l4.84"></a><span id="l4.84"> function onReset(event)</span>
<a href="#l4.85"></a><span id="l4.85"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgFilter.idl</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgFilter.idl</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,28 +1,19 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* -*- Mode: IDL; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l5.5"></a><span id="l5.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.6"></a><span id="l5.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.7"></a><span id="l5.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l5.11"></a><span id="l5.11"> #include &quot;nsMsgFilterCore.idl&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-// classes.</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-%{C++</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-#endif</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-%}</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-interface nsISupportsArray;</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23"> interface nsIArray;</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+interface nsIMutableArray;</span>
<a href="#l5.25"></a><span id="l5.25"> interface nsIOutputStream;</span>
<a href="#l5.26"></a><span id="l5.26"> interface nsIMsgFilterCustomAction;</span>
<a href="#l5.27"></a><span id="l5.27"> interface nsIMsgFilterList;</span>
<a href="#l5.28"></a><span id="l5.28"> interface nsIMsgSearchScopeTerm;</span>
<a href="#l5.29"></a><span id="l5.29"> interface nsIMsgSearchValue;</span>
<a href="#l5.30"></a><span id="l5.30"> interface nsIMsgSearchTerm;</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32"> [scriptable, uuid(36d2748e-9246-44f3-bb74-46cbb0b8c23a)]</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineat">@@ -82,17 +73,17 @@ interface nsIMsgFilter : nsISupports {</span>
<a href="#l5.34"></a><span id="l5.34">                  out nsIMsgSearchValue value, // bad! using shared structure</span>
<a href="#l5.35"></a><span id="l5.35">                  out boolean BooleanAND,</span>
<a href="#l5.36"></a><span id="l5.36">                  out ACString arbitraryHeader);</span>
<a href="#l5.37"></a><span id="l5.37"> </span>
<a href="#l5.38"></a><span id="l5.38">     void appendTerm(in nsIMsgSearchTerm term);</span>
<a href="#l5.39"></a><span id="l5.39"> </span>
<a href="#l5.40"></a><span id="l5.40">     nsIMsgSearchTerm createTerm();</span>
<a href="#l5.41"></a><span id="l5.41"> </span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-    attribute nsISupportsArray searchTerms;</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+    attribute nsIMutableArray searchTerms;</span>
<a href="#l5.44"></a><span id="l5.44"> </span>
<a href="#l5.45"></a><span id="l5.45">     attribute nsIMsgSearchScopeTerm scope;</span>
<a href="#l5.46"></a><span id="l5.46"> </span>
<a href="#l5.47"></a><span id="l5.47">     // Marking noscript because &quot;headers&quot; is actually a null-separated</span>
<a href="#l5.48"></a><span id="l5.48">     // list of headers, which is not scriptable.</span>
<a href="#l5.49"></a><span id="l5.49">     [noscript] void MatchHdr(in nsIMsgDBHdr msgHdr, in nsIMsgFolder folder,</span>
<a href="#l5.50"></a><span id="l5.50">                   in nsIMsgDatabase db,</span>
<a href="#l5.51"></a><span id="l5.51">                   in string headers,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgSearchSession.idl</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgSearchSession.idl</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,31 +1,22 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l6.5"></a><span id="l6.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.6"></a><span id="l6.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.7"></a><span id="l6.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> #include &quot;nsIMsgSearchValue.idl&quot;</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+interface nsIMutableArray;</span>
<a href="#l6.13"></a><span id="l6.13"> interface nsIMsgSearchAdapter;</span>
<a href="#l6.14"></a><span id="l6.14"> interface nsIMsgSearchTerm;</span>
<a href="#l6.15"></a><span id="l6.15"> interface nsIMsgSearchNotify;</span>
<a href="#l6.16"></a><span id="l6.16"> interface nsIMsgHdr;</span>
<a href="#l6.17"></a><span id="l6.17"> interface nsIMsgDatabase;</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-// classes.</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-%{C++</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-#endif</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">-%}</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-interface nsISupportsArray;</span>
<a href="#l6.28"></a><span id="l6.28"> interface nsIMsgWindow;</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30"> //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l6.31"></a><span id="l6.31"> // The Msg Search Session is an interface designed to make constructing</span>
<a href="#l6.32"></a><span id="l6.32"> // searches easier. Clients typically build up search terms, and then run</span>
<a href="#l6.33"></a><span id="l6.33"> // the search</span>
<a href="#l6.34"></a><span id="l6.34"> //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l6.35"></a><span id="l6.35"> </span>
<a href="#l6.36"></a><span id="l6.36" class="difflineat">@@ -45,19 +36,19 @@ interface nsIMsgSearchSession :  nsISupp</span>
<a href="#l6.37"></a><span id="l6.37">  *                        otherwise ignored</span>
<a href="#l6.38"></a><span id="l6.38">  */</span>
<a href="#l6.39"></a><span id="l6.39">   void addSearchTerm(in nsMsgSearchAttribValue attrib,</span>
<a href="#l6.40"></a><span id="l6.40">                      in nsMsgSearchOpValue op,</span>
<a href="#l6.41"></a><span id="l6.41">                      in nsIMsgSearchValue value,</span>
<a href="#l6.42"></a><span id="l6.42">                      in boolean BooleanAND,</span>
<a href="#l6.43"></a><span id="l6.43">                      in string customString);</span>
<a href="#l6.44"></a><span id="l6.44"> </span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">-  readonly attribute nsISupportsArray searchTerms;</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+  attribute nsIMutableArray searchTerms;</span>
<a href="#l6.47"></a><span id="l6.47"> </span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-  nsIMsgSearchTerm createTerm ();</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+  nsIMsgSearchTerm createTerm();</span>
<a href="#l6.50"></a><span id="l6.50">   void appendTerm(in nsIMsgSearchTerm term);</span>
<a href="#l6.51"></a><span id="l6.51"> </span>
<a href="#l6.52"></a><span id="l6.52">   /**</span>
<a href="#l6.53"></a><span id="l6.53">    * @name Search notification flags</span>
<a href="#l6.54"></a><span id="l6.54">    * These flags determine which notifications will be sent.</span>
<a href="#l6.55"></a><span id="l6.55">    * @{</span>
<a href="#l6.56"></a><span id="l6.56">    */</span>
<a href="#l6.57"></a><span id="l6.57">   /// search started notification</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgSearchValidityTable.idl</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgSearchValidityTable.idl</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,25 +1,16 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* -*- Mode: IDL; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l7.5"></a><span id="l7.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.6"></a><span id="l7.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.7"></a><span id="l7.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l7.10"></a><span id="l7.10"> #include &quot;nsMsgSearchCore.idl&quot;</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-// classes.</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-%{C++</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-#endif</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-%}</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-interface nsISupportsArray;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+interface nsIArray;</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23"> [scriptable, uuid(b07f1cb6-fae9-4d92-9edb-03f9ad249c66)]</span>
<a href="#l7.24"></a><span id="l7.24"> interface nsIMsgSearchValidityTable : nsISupports {</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26">     void setAvailable(in nsMsgSearchAttribValue attrib,</span>
<a href="#l7.27"></a><span id="l7.27">                       in nsMsgSearchOpValue op, in boolean active);</span>
<a href="#l7.28"></a><span id="l7.28">     void setEnabled(in nsMsgSearchAttribValue attrib,</span>
<a href="#l7.29"></a><span id="l7.29">                     in nsMsgSearchOpValue op, in boolean enabled);</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineat">@@ -28,17 +19,17 @@ interface nsIMsgSearchValidityTable : ns</span>
<a href="#l7.31"></a><span id="l7.31"> </span>
<a href="#l7.32"></a><span id="l7.32">     boolean getAvailable(in nsMsgSearchAttribValue attrib,</span>
<a href="#l7.33"></a><span id="l7.33">                          in nsMsgSearchOpValue op);</span>
<a href="#l7.34"></a><span id="l7.34">     boolean getEnabled(in nsMsgSearchAttribValue attrib,</span>
<a href="#l7.35"></a><span id="l7.35">                        in nsMsgSearchOpValue op);</span>
<a href="#l7.36"></a><span id="l7.36">     boolean getValidButNotShown(in nsMsgSearchAttribValue attrib,</span>
<a href="#l7.37"></a><span id="l7.37">                                 in nsMsgSearchOpValue op);</span>
<a href="#l7.38"></a><span id="l7.38"> </span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">-    [noscript] void validateTerms(in nsISupportsArray terms);</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+    [noscript] void validateTerms(in nsIArray terms);</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42">     readonly attribute long numAvailAttribs;</span>
<a href="#l7.43"></a><span id="l7.43"> </span>
<a href="#l7.44"></a><span id="l7.44">     void getAvailableAttributes(out unsigned long length,</span>
<a href="#l7.45"></a><span id="l7.45">                                 [retval, array, size_is(length)]</span>
<a href="#l7.46"></a><span id="l7.46">                                 out nsMsgSearchAttribValue attrs);</span>
<a href="#l7.47"></a><span id="l7.47"> </span>
<a href="#l7.48"></a><span id="l7.48">     void getAvailableOperators(in nsMsgSearchAttribValue attrib,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgSearchAdapter.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgSearchAdapter.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -24,30 +24,30 @@ class nsIMsgSearchScopeTerm;</span>
<a href="#l8.4"></a><span id="l8.4"> //</span>
<a href="#l8.5"></a><span id="l8.5"> // There is a separate Adapter class for area (pop, imap, nntp, ldap) to contain</span>
<a href="#l8.6"></a><span id="l8.6"> // the special smarts for that protocol.</span>
<a href="#l8.7"></a><span id="l8.7"> //-----------------------------------------------------------------------------</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> class nsMsgSearchAdapter : public nsIMsgSearchAdapter</span>
<a href="#l8.10"></a><span id="l8.10"> {</span>
<a href="#l8.11"></a><span id="l8.11"> public:</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  nsMsgSearchAdapter (nsIMsgSearchScopeTerm*, nsISupportsArray *);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  nsMsgSearchAdapter (nsIMsgSearchScopeTerm*, nsIArray*);</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">   NS_DECL_ISUPPORTS</span>
<a href="#l8.16"></a><span id="l8.16">   NS_DECL_NSIMSGSEARCHADAPTER</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18">   nsIMsgSearchScopeTerm        *m_scope;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt;  m_searchTerms;       /* linked list of criteria terms */</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+  nsCOMPtr&lt;nsIArray&gt;  m_searchTerms;       /* linked list of criteria terms */</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22">   bool m_abortCalled;</span>
<a href="#l8.23"></a><span id="l8.23">   nsString  m_defaultCharset;</span>
<a href="#l8.24"></a><span id="l8.24">   bool m_forceAsciiSearch;</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26">   static nsresult EncodeImap (char **ppEncoding,</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-           nsISupportsArray *searchTerms,</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+           nsIArray *searchTerms,</span>
<a href="#l8.29"></a><span id="l8.29">            const char16_t *srcCharset,</span>
<a href="#l8.30"></a><span id="l8.30">            const char16_t *destCharset,</span>
<a href="#l8.31"></a><span id="l8.31">            bool reallyDredd = false);</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33">   static nsresult EncodeImapValue(char *encoding, const char *value, bool useQuotes, bool reallyDredd);</span>
<a href="#l8.34"></a><span id="l8.34"> </span>
<a href="#l8.35"></a><span id="l8.35">   static char *GetImapCharsetParam(const char16_t *destCharset);</span>
<a href="#l8.36"></a><span id="l8.36">   static char16_t *EscapeSearchUrl (const char16_t *nntpCommand);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgSearchScopeTerm.h</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgSearchScopeTerm.h</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -21,17 +21,17 @@ class nsMsgSearchScopeTerm : public nsIM</span>
<a href="#l9.4"></a><span id="l9.4"> public:</span>
<a href="#l9.5"></a><span id="l9.5">   nsMsgSearchScopeTerm (nsIMsgSearchSession *, nsMsgSearchScopeValue, nsIMsgFolder *);</span>
<a href="#l9.6"></a><span id="l9.6">   nsMsgSearchScopeTerm ();</span>
<a href="#l9.7"></a><span id="l9.7">   </span>
<a href="#l9.8"></a><span id="l9.8">   NS_DECL_ISUPPORTS</span>
<a href="#l9.9"></a><span id="l9.9">   NS_DECL_NSIMSGSEARCHSCOPETERM</span>
<a href="#l9.10"></a><span id="l9.10">     </span>
<a href="#l9.11"></a><span id="l9.11">   nsresult TimeSlice (bool *aDone);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  nsresult InitializeAdapter (nsISupportsArray *termList);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  nsresult InitializeAdapter (nsIArray *termList);</span>
<a href="#l9.14"></a><span id="l9.14">   </span>
<a href="#l9.15"></a><span id="l9.15">   char *GetStatusBarName ();</span>
<a href="#l9.16"></a><span id="l9.16">   </span>
<a href="#l9.17"></a><span id="l9.17">   nsMsgSearchScopeValue m_attribute;</span>
<a href="#l9.18"></a><span id="l9.18">   char *m_name;</span>
<a href="#l9.19"></a><span id="l9.19">   nsCOMPtr &lt;nsIMsgFolder&gt; m_folder;</span>
<a href="#l9.20"></a><span id="l9.20">   nsCOMPtr &lt;nsIMsgSearchAdapter&gt; m_adapter;</span>
<a href="#l9.21"></a><span id="l9.21">   nsCOMPtr &lt;nsIInputStream&gt; m_inputStream; // for message bodies</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,34 +1,35 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* -*- Mode: C++; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.5"></a><span id="l10.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.6"></a><span id="l10.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.7"></a><span id="l10.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> // this file implements the nsMsgFilter interface</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;msgCore.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+#include &quot;nsArray.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l10.15"></a><span id="l10.15"> #include &quot;nsMsgFilterList.h&quot;    // for kFileVersion</span>
<a href="#l10.16"></a><span id="l10.16"> #include &quot;nsMsgFilter.h&quot;</span>
<a href="#l10.17"></a><span id="l10.17"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l10.18"></a><span id="l10.18"> #include &quot;nsMsgLocalSearch.h&quot;</span>
<a href="#l10.19"></a><span id="l10.19"> #include &quot;nsMsgSearchTerm.h&quot;</span>
<a href="#l10.20"></a><span id="l10.20"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l10.21"></a><span id="l10.21"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l10.22"></a><span id="l10.22"> #include &quot;nsMsgSearchValue.h&quot;</span>
<a href="#l10.23"></a><span id="l10.23"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l10.25"></a><span id="l10.25"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l10.26"></a><span id="l10.26"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l10.27"></a><span id="l10.27"> #include &quot;nsDateTimeFormatCID.h&quot;</span>
<a href="#l10.28"></a><span id="l10.28"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l10.29"></a><span id="l10.29"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l10.30"></a><span id="l10.30"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l10.32"></a><span id="l10.32"> #include &quot;prmem.h&quot;</span>
<a href="#l10.33"></a><span id="l10.33"> #include &quot;mozilla/ArrayUtils.h&quot;</span>
<a href="#l10.34"></a><span id="l10.34"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l10.35"></a><span id="l10.35"> </span>
<a href="#l10.36"></a><span id="l10.36"> static const char *kImapPrefix = &quot;//imap:&quot;;</span>
<a href="#l10.37"></a><span id="l10.37"> static const char *kWhitespace = &quot;\b\t\r\n &quot;;</span>
<a href="#l10.38"></a><span id="l10.38"> </span>
<a href="#l10.39"></a><span id="l10.39"> nsMsgRuleAction::nsMsgRuleAction()</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineat">@@ -167,19 +168,18 @@ NS_IMETHODIMP nsMsgRuleAction::GetCustom</span>
<a href="#l10.41"></a><span id="l10.41"> }</span>
<a href="#l10.42"></a><span id="l10.42"> </span>
<a href="#l10.43"></a><span id="l10.43"> nsMsgFilter::nsMsgFilter():</span>
<a href="#l10.44"></a><span id="l10.44">     m_temporary(false),</span>
<a href="#l10.45"></a><span id="l10.45">     m_unparseable(false),</span>
<a href="#l10.46"></a><span id="l10.46">     m_filterList(nullptr),</span>
<a href="#l10.47"></a><span id="l10.47">     m_expressionTree(nullptr)</span>
<a href="#l10.48"></a><span id="l10.48"> {</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-  nsresult rv = NS_NewISupportsArray(getter_AddRefs(m_termList));</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-    NS_ASSERTION(false, &quot;Failed to allocate a nsISupportsArray for nsMsgFilter&quot;);</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+  m_termList = nsArray::Create();</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+  NS_ASSERTION(m_termList, &quot;Failed to allocate a nsIMutableArray for m_termList&quot;);</span>
<a href="#l10.54"></a><span id="l10.54"> </span>
<a href="#l10.55"></a><span id="l10.55">   m_type = nsMsgFilterType::InboxRule | nsMsgFilterType::Manual;</span>
<a href="#l10.56"></a><span id="l10.56"> }</span>
<a href="#l10.57"></a><span id="l10.57"> </span>
<a href="#l10.58"></a><span id="l10.58"> nsMsgFilter::~nsMsgFilter()</span>
<a href="#l10.59"></a><span id="l10.59"> {</span>
<a href="#l10.60"></a><span id="l10.60">   delete m_expressionTree;</span>
<a href="#l10.61"></a><span id="l10.61"> }</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineat">@@ -240,17 +240,17 @@ NS_IMETHODIMP nsMsgFilter::AddTerm(</span>
<a href="#l10.63"></a><span id="l10.63"> }</span>
<a href="#l10.64"></a><span id="l10.64"> </span>
<a href="#l10.65"></a><span id="l10.65"> NS_IMETHODIMP nsMsgFilter::AppendTerm(nsIMsgSearchTerm * aTerm)</span>
<a href="#l10.66"></a><span id="l10.66"> {</span>
<a href="#l10.67"></a><span id="l10.67">     NS_ENSURE_TRUE(aTerm, NS_ERROR_NULL_POINTER);</span>
<a href="#l10.68"></a><span id="l10.68">     // invalidate expression tree if we're changing the terms</span>
<a href="#l10.69"></a><span id="l10.69">     delete m_expressionTree;</span>
<a href="#l10.70"></a><span id="l10.70">     m_expressionTree = nullptr;</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineminus">-    return m_termList-&gt;AppendElement(static_cast&lt;nsISupports*&gt;(aTerm));</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+    return m_termList-&gt;AppendElement(aTerm, /* weak = */ false);</span>
<a href="#l10.73"></a><span id="l10.73"> }</span>
<a href="#l10.74"></a><span id="l10.74"> </span>
<a href="#l10.75"></a><span id="l10.75"> NS_IMETHODIMP</span>
<a href="#l10.76"></a><span id="l10.76"> nsMsgFilter::CreateTerm(nsIMsgSearchTerm **aResult)</span>
<a href="#l10.77"></a><span id="l10.77"> {</span>
<a href="#l10.78"></a><span id="l10.78">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l10.79"></a><span id="l10.79">     nsMsgSearchTerm *term = new nsMsgSearchTerm;</span>
<a href="#l10.80"></a><span id="l10.80">     NS_ENSURE_TRUE(term, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineat">@@ -437,27 +437,27 @@ NS_IMETHODIMP nsMsgFilter::GetTerm(int32</span>
<a href="#l10.82"></a><span id="l10.82">       term-&gt;GetBooleanAnd(booleanAnd);</span>
<a href="#l10.83"></a><span id="l10.83">     if (attrib &amp;&amp; *attrib &gt; nsMsgSearchAttrib::OtherHeader</span>
<a href="#l10.84"></a><span id="l10.84">         &amp;&amp; *attrib &lt; nsMsgSearchAttrib::kNumMsgSearchAttributes)</span>
<a href="#l10.85"></a><span id="l10.85">       term-&gt;GetArbitraryHeader(arbitraryHeader);</span>
<a href="#l10.86"></a><span id="l10.86">   }</span>
<a href="#l10.87"></a><span id="l10.87">   return NS_OK;</span>
<a href="#l10.88"></a><span id="l10.88"> }</span>
<a href="#l10.89"></a><span id="l10.89"> </span>
<a href="#l10.90"></a><span id="l10.90" class="difflineminus">-NS_IMETHODIMP nsMsgFilter::GetSearchTerms(nsISupportsArray **aResult)</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+NS_IMETHODIMP nsMsgFilter::GetSearchTerms(nsIMutableArray **aResult)</span>
<a href="#l10.92"></a><span id="l10.92"> {</span>
<a href="#l10.93"></a><span id="l10.93">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l10.94"></a><span id="l10.94">     // caller can change m_termList, which can invalidate m_expressionTree.</span>
<a href="#l10.95"></a><span id="l10.95">     delete m_expressionTree;</span>
<a href="#l10.96"></a><span id="l10.96">     m_expressionTree = nullptr;</span>
<a href="#l10.97"></a><span id="l10.97">     NS_IF_ADDREF(*aResult = m_termList);</span>
<a href="#l10.98"></a><span id="l10.98">     return NS_OK;</span>
<a href="#l10.99"></a><span id="l10.99"> }</span>
<a href="#l10.100"></a><span id="l10.100"> </span>
<a href="#l10.101"></a><span id="l10.101" class="difflineminus">-NS_IMETHODIMP nsMsgFilter::SetSearchTerms(nsISupportsArray *aSearchList)</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineplus">+NS_IMETHODIMP nsMsgFilter::SetSearchTerms(nsIMutableArray *aSearchList)</span>
<a href="#l10.103"></a><span id="l10.103"> {</span>
<a href="#l10.104"></a><span id="l10.104">     delete m_expressionTree;</span>
<a href="#l10.105"></a><span id="l10.105">     m_expressionTree = nullptr;</span>
<a href="#l10.106"></a><span id="l10.106">     m_termList = aSearchList;</span>
<a href="#l10.107"></a><span id="l10.107">     return NS_OK;</span>
<a href="#l10.108"></a><span id="l10.108"> }</span>
<a href="#l10.109"></a><span id="l10.109"> </span>
<a href="#l10.110"></a><span id="l10.110"> NS_IMETHODIMP nsMsgFilter::SetScope(nsIMsgSearchScopeTerm *aResult)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilter.h</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilter.h</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -6,16 +6,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> #ifndef _nsMsgFilter_H_</span>
<a href="#l11.5"></a><span id="l11.5"> #define _nsMsgFilter_H_</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7"> #include &quot;nscore.h&quot;</span>
<a href="#l11.8"></a><span id="l11.8"> #include &quot;nsISupports.h&quot;</span>
<a href="#l11.9"></a><span id="l11.9"> #include &quot;nsIMsgFilter.h&quot;</span>
<a href="#l11.10"></a><span id="l11.10"> #include &quot;nsIMsgSearchScopeTerm.h&quot;</span>
<a href="#l11.11"></a><span id="l11.11"> #include &quot;nsMsgSearchBoolExpression.h&quot;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l11.13"></a><span id="l11.13"> #include &quot;nsIDateTimeFormat.h&quot;</span>
<a href="#l11.14"></a><span id="l11.14"> #include &quot;nsIMsgFilterCustomAction.h&quot;</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16"> class nsMsgRuleAction : public nsIMsgRuleAction</span>
<a href="#l11.17"></a><span id="l11.17"> {</span>
<a href="#l11.18"></a><span id="l11.18"> public:</span>
<a href="#l11.19"></a><span id="l11.19">   NS_DECL_ISUPPORTS</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21" class="difflineat">@@ -87,17 +88,17 @@ protected:</span>
<a href="#l11.22"></a><span id="l11.22">   nsCString   m_scriptFileName;  // iff this filter is a script.</span>
<a href="#l11.23"></a><span id="l11.23">   nsCString   m_description;</span>
<a href="#l11.24"></a><span id="l11.24">   nsCString   m_unparsedBuffer;</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26">   bool m_enabled;</span>
<a href="#l11.27"></a><span id="l11.27">   bool m_temporary;</span>
<a href="#l11.28"></a><span id="l11.28">   bool m_unparseable;</span>
<a href="#l11.29"></a><span id="l11.29">   nsIMsgFilterList *m_filterList;  /* owning filter list */</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; m_termList;       /* linked list of criteria terms */</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; m_termList;       /* linked list of criteria terms */</span>
<a href="#l11.32"></a><span id="l11.32">   nsCOMPtr&lt;nsIMsgSearchScopeTerm&gt; m_scope;         /* default for mail rules is inbox, but news rules could</span>
<a href="#l11.33"></a><span id="l11.33">                                                   have a newsgroup - LDAP would be invalid */</span>
<a href="#l11.34"></a><span id="l11.34">   nsTArray&lt;nsCOMPtr&lt;nsIMsgRuleAction&gt; &gt; m_actionList;</span>
<a href="#l11.35"></a><span id="l11.35">   nsMsgSearchBoolExpression *m_expressionTree;</span>
<a href="#l11.36"></a><span id="l11.36">   nsCOMPtr&lt;nsIDateTimeFormat&gt; mDateFormatter;</span>
<a href="#l11.37"></a><span id="l11.37"> };</span>
<a href="#l11.38"></a><span id="l11.38"> </span>
<a href="#l11.39"></a><span id="l11.39"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1141,21 +1141,21 @@ nsresult nsMsgFilterList::ComputeArbitra</span>
<a href="#l12.4"></a><span id="l12.4">   nsCOMPtr&lt;nsIMsgFilter&gt; filter;</span>
<a href="#l12.5"></a><span id="l12.5">   nsMsgSearchAttribValue attrib;</span>
<a href="#l12.6"></a><span id="l12.6">   nsCString arbitraryHeader;</span>
<a href="#l12.7"></a><span id="l12.7">   for (uint32_t index = 0; index &lt; numFilters; index++)</span>
<a href="#l12.8"></a><span id="l12.8">   {</span>
<a href="#l12.9"></a><span id="l12.9">     rv = GetFilterAt(index, getter_AddRefs(filter));</span>
<a href="#l12.10"></a><span id="l12.10">     if (!(NS_SUCCEEDED(rv) &amp;&amp; filter)) continue;</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    nsCOMPtr &lt;nsISupportsArray&gt; searchTerms;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-    uint32_t numSearchTerms=0;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+    nsCOMPtr&lt;nsIMutableArray&gt; searchTerms;</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+    uint32_t numSearchTerms = 0;</span>
<a href="#l12.16"></a><span id="l12.16">     filter-&gt;GetSearchTerms(getter_AddRefs(searchTerms));</span>
<a href="#l12.17"></a><span id="l12.17">     if (searchTerms)</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-      searchTerms-&gt;Count(&amp;numSearchTerms);</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+      searchTerms-&gt;GetLength(&amp;numSearchTerms);</span>
<a href="#l12.20"></a><span id="l12.20">     for (uint32_t i = 0; i &lt; numSearchTerms; i++)</span>
<a href="#l12.21"></a><span id="l12.21">     {</span>
<a href="#l12.22"></a><span id="l12.22">       filter-&gt;GetTerm(i, &amp;attrib, nullptr, nullptr, nullptr, arbitraryHeader);</span>
<a href="#l12.23"></a><span id="l12.23">       if (!arbitraryHeader.IsEmpty())</span>
<a href="#l12.24"></a><span id="l12.24">       {</span>
<a href="#l12.25"></a><span id="l12.25">         if (m_arbitraryHeaders.IsEmpty())</span>
<a href="#l12.26"></a><span id="l12.26">           m_arbitraryHeaders.Assign(arbitraryHeader);</span>
<a href="#l12.27"></a><span id="l12.27">         else if (m_arbitraryHeaders.Find(arbitraryHeader, CaseInsensitiveCompare) == -1)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -378,28 +378,28 @@ nsresult nsMsgFilterAfterTheFact::RunNex</span>
<a href="#l13.4"></a><span id="l13.4">   {</span>
<a href="#l13.5"></a><span id="l13.5">     m_curFilter = nullptr;</span>
<a href="#l13.6"></a><span id="l13.6">     if (m_curFilterIndex &gt;= m_numFilters)</span>
<a href="#l13.7"></a><span id="l13.7">       break;</span>
<a href="#l13.8"></a><span id="l13.8">     BREAK_IF_FALSE(m_filters, &quot;Missing filters&quot;);</span>
<a href="#l13.9"></a><span id="l13.9">     rv = m_filters-&gt;GetFilterAt(m_curFilterIndex++, getter_AddRefs(m_curFilter));</span>
<a href="#l13.10"></a><span id="l13.10">     CONTINUE_IF_FAILURE(rv, &quot;Could not get filter at index&quot;);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    nsCOMPtr &lt;nsISupportsArray&gt; searchTerms;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    nsCOMPtr&lt;nsIMutableArray&gt; searchTerms;</span>
<a href="#l13.14"></a><span id="l13.14">     rv = m_curFilter-&gt;GetSearchTerms(getter_AddRefs(searchTerms));</span>
<a href="#l13.15"></a><span id="l13.15">     CONTINUE_IF_FAILURE(rv, &quot;Could not get searchTerms&quot;);</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17">     if (m_searchSession)</span>
<a href="#l13.18"></a><span id="l13.18">       m_searchSession-&gt;UnregisterListener(this);</span>
<a href="#l13.19"></a><span id="l13.19">     m_searchSession = do_CreateInstance(NS_MSGSEARCHSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l13.20"></a><span id="l13.20">     BREAK_IF_FAILURE(rv, &quot;Failed to get search session&quot;);</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22">     nsMsgSearchScopeValue searchScope = nsMsgSearchScope::offlineMail;</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-    uint32_t termCount;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-    searchTerms-&gt;Count(&amp;termCount);</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+    uint32_t termCount = 0;</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+    searchTerms-&gt;GetLength(&amp;termCount);</span>
<a href="#l13.27"></a><span id="l13.27">     for (uint32_t termIndex = 0; termIndex &lt; termCount; termIndex++)</span>
<a href="#l13.28"></a><span id="l13.28">     {</span>
<a href="#l13.29"></a><span id="l13.29">       nsCOMPtr &lt;nsIMsgSearchTerm&gt; term;</span>
<a href="#l13.30"></a><span id="l13.30">       nsresult rv = searchTerms-&gt;QueryElementAt(termIndex, NS_GET_IID(nsIMsgSearchTerm), getter_AddRefs(term));</span>
<a href="#l13.31"></a><span id="l13.31">       BREAK_IF_FAILURE(rv, &quot;Could not get search term&quot;);</span>
<a href="#l13.32"></a><span id="l13.32">       rv = m_searchSession-&gt;AppendTerm(term);</span>
<a href="#l13.33"></a><span id="l13.33">       BREAK_IF_FAILURE(rv, &quot;Could not append search term&quot;);</span>
<a href="#l13.34"></a><span id="l13.34">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgImapSearch.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgImapSearch.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -5,28 +5,21 @@</span>
<a href="#l14.4"></a><span id="l14.4"> #include &quot;msgCore.h&quot;</span>
<a href="#l14.5"></a><span id="l14.5"> #include &quot;nsMsgSearchAdapter.h&quot;</span>
<a href="#l14.6"></a><span id="l14.6"> #include &quot;nsMsgSearchScopeTerm.h&quot;</span>
<a href="#l14.7"></a><span id="l14.7"> #include &quot;nsMsgResultElement.h&quot;</span>
<a href="#l14.8"></a><span id="l14.8"> #include &quot;nsMsgSearchTerm.h&quot;</span>
<a href="#l14.9"></a><span id="l14.9"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l14.10"></a><span id="l14.10"> #include &quot;nsMsgSearchImap.h&quot;</span>
<a href="#l14.11"></a><span id="l14.11"> #include &quot;prmem.h&quot;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-// classes.</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-#endif</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l14.21"></a><span id="l14.21"> // Implementation of search for IMAP mail folders</span>
<a href="#l14.22"></a><span id="l14.22"> </span>
<a href="#l14.23"></a><span id="l14.23"> </span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-nsMsgSearchOnlineMail::nsMsgSearchOnlineMail (nsMsgSearchScopeTerm *scope, nsISupportsArray *termList) : nsMsgSearchAdapter (scope, termList)</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+nsMsgSearchOnlineMail::nsMsgSearchOnlineMail (nsMsgSearchScopeTerm *scope, nsIArray *termList) : nsMsgSearchAdapter (scope, termList)</span>
<a href="#l14.26"></a><span id="l14.26"> {</span>
<a href="#l14.27"></a><span id="l14.27"> }</span>
<a href="#l14.28"></a><span id="l14.28"> </span>
<a href="#l14.29"></a><span id="l14.29"> </span>
<a href="#l14.30"></a><span id="l14.30"> nsMsgSearchOnlineMail::~nsMsgSearchOnlineMail () </span>
<a href="#l14.31"></a><span id="l14.31"> {</span>
<a href="#l14.32"></a><span id="l14.32"> }</span>
<a href="#l14.33"></a><span id="l14.33"> </span>
<a href="#l14.34"></a><span id="l14.34" class="difflineat">@@ -78,29 +71,29 @@ nsresult nsMsgSearchOnlineMail::Search (</span>
<a href="#l14.35"></a><span id="l14.35">     // we should never end up here for a purely online</span>
<a href="#l14.36"></a><span id="l14.36">     // folder.  We might for an offline IMAP folder.</span>
<a href="#l14.37"></a><span id="l14.37">     nsresult err = NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l14.38"></a><span id="l14.38"> </span>
<a href="#l14.39"></a><span id="l14.39">     return err;</span>
<a href="#l14.40"></a><span id="l14.40"> }</span>
<a href="#l14.41"></a><span id="l14.41"> </span>
<a href="#l14.42"></a><span id="l14.42"> nsresult nsMsgSearchOnlineMail::Encode (nsCString&amp; pEncoding,</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-                                        nsISupportsArray *searchTerms,</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+                                        nsIArray *searchTerms,</span>
<a href="#l14.45"></a><span id="l14.45">                                         const char16_t *destCharset)</span>
<a href="#l14.46"></a><span id="l14.46"> {</span>
<a href="#l14.47"></a><span id="l14.47">   nsCString imapTerms;</span>
<a href="#l14.48"></a><span id="l14.48">   </span>
<a href="#l14.49"></a><span id="l14.49">   //check if searchTerms are ascii only</span>
<a href="#l14.50"></a><span id="l14.50">   bool asciiOnly = true;</span>
<a href="#l14.51"></a><span id="l14.51">   // ### what's this mean in the NWO?????</span>
<a href="#l14.52"></a><span id="l14.52">   </span>
<a href="#l14.53"></a><span id="l14.53">   if (true) // !(srcCharset &amp; CODESET_MASK == STATEFUL || srcCharset &amp; CODESET_MASK == WIDECHAR) )   //assume all single/multiple bytes charset has ascii as subset</span>
<a href="#l14.54"></a><span id="l14.54">   {</span>
<a href="#l14.55"></a><span id="l14.55">     uint32_t termCount;</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-    searchTerms-&gt;Count(&amp;termCount);</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+    searchTerms-&gt;GetLength(&amp;termCount);</span>
<a href="#l14.58"></a><span id="l14.58">     uint32_t i = 0;</span>
<a href="#l14.59"></a><span id="l14.59">     </span>
<a href="#l14.60"></a><span id="l14.60">     for (i = 0; i &lt; termCount &amp;&amp; asciiOnly; i++)</span>
<a href="#l14.61"></a><span id="l14.61">     {</span>
<a href="#l14.62"></a><span id="l14.62">       nsCOMPtr&lt;nsIMsgSearchTerm&gt; pTerm;</span>
<a href="#l14.63"></a><span id="l14.63">       searchTerms-&gt;QueryElementAt(i, NS_GET_IID(nsIMsgSearchTerm),</span>
<a href="#l14.64"></a><span id="l14.64">         (void **)getter_AddRefs(pTerm));</span>
<a href="#l14.65"></a><span id="l14.65">       </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -9,24 +9,17 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> #include &quot;nsMsgSearchCore.h&quot;</span>
<a href="#l15.6"></a><span id="l15.6"> #include &quot;nsMsgLocalSearch.h&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> #include &quot;nsIStreamListener.h&quot;</span>
<a href="#l15.8"></a><span id="l15.8"> #include &quot;nsMsgSearchBoolExpression.h&quot;</span>
<a href="#l15.9"></a><span id="l15.9"> #include &quot;nsMsgSearchTerm.h&quot;</span>
<a href="#l15.10"></a><span id="l15.10"> #include &quot;nsMsgResultElement.h&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-// classes.</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-#endif</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l15.21"></a><span id="l15.21"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l15.22"></a><span id="l15.22"> #include &quot;nsMsgSearchValue.h&quot;</span>
<a href="#l15.23"></a><span id="l15.23"> #include &quot;nsIMsgLocalMailFolder.h&quot;</span>
<a href="#l15.24"></a><span id="l15.24"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l15.25"></a><span id="l15.25"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l15.26"></a><span id="l15.26"> #include &quot;nsIMsgFilterPlugin.h&quot;</span>
<a href="#l15.27"></a><span id="l15.27"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l15.28"></a><span id="l15.28"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineat">@@ -232,17 +225,17 @@ void nsMsgSearchBoolExpression::Generate</span>
<a href="#l15.30"></a><span id="l15.30"> </span>
<a href="#l15.31"></a><span id="l15.31"> //-----------------------------------------------------------------------------</span>
<a href="#l15.32"></a><span id="l15.32"> //---------------- Adapter class for searching offline folders ----------------</span>
<a href="#l15.33"></a><span id="l15.33"> //-----------------------------------------------------------------------------</span>
<a href="#l15.34"></a><span id="l15.34"> </span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36"> NS_IMPL_ISUPPORTS_INHERITED(nsMsgSearchOfflineMail, nsMsgSearchAdapter, nsIUrlListener)</span>
<a href="#l15.37"></a><span id="l15.37"> </span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-nsMsgSearchOfflineMail::nsMsgSearchOfflineMail (nsIMsgSearchScopeTerm *scope, nsISupportsArray *termList) : nsMsgSearchAdapter (scope, termList)</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+nsMsgSearchOfflineMail::nsMsgSearchOfflineMail (nsIMsgSearchScopeTerm *scope, nsIArray *termList) : nsMsgSearchAdapter (scope, termList)</span>
<a href="#l15.40"></a><span id="l15.40"> {</span>
<a href="#l15.41"></a><span id="l15.41"> }</span>
<a href="#l15.42"></a><span id="l15.42"> </span>
<a href="#l15.43"></a><span id="l15.43"> nsMsgSearchOfflineMail::~nsMsgSearchOfflineMail ()</span>
<a href="#l15.44"></a><span id="l15.44"> {</span>
<a href="#l15.45"></a><span id="l15.45">   // Database should have been closed when the scope term finished.</span>
<a href="#l15.46"></a><span id="l15.46">   CleanUpScope();</span>
<a href="#l15.47"></a><span id="l15.47">   NS_ASSERTION(!m_db, &quot;db not closed&quot;);</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineat">@@ -305,43 +298,43 @@ nsresult nsMsgSearchOfflineMail::OpenSum</span>
<a href="#l15.49"></a><span id="l15.49">     }</span>
<a href="#l15.50"></a><span id="l15.50"> </span>
<a href="#l15.51"></a><span id="l15.51">     return err;</span>
<a href="#l15.52"></a><span id="l15.52"> }</span>
<a href="#l15.53"></a><span id="l15.53"> </span>
<a href="#l15.54"></a><span id="l15.54"> </span>
<a href="#l15.55"></a><span id="l15.55"> nsresult</span>
<a href="#l15.56"></a><span id="l15.56"> nsMsgSearchOfflineMail::MatchTermsForFilter(nsIMsgDBHdr *msgToMatch,</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-                                            nsISupportsArray *termList,</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+                                            nsIArray *termList,</span>
<a href="#l15.59"></a><span id="l15.59">                                             const char *defaultCharset,</span>
<a href="#l15.60"></a><span id="l15.60">                                             nsIMsgSearchScopeTerm * scope,</span>
<a href="#l15.61"></a><span id="l15.61">                                             nsIMsgDatabase * db,</span>
<a href="#l15.62"></a><span id="l15.62">                                             const char * headers,</span>
<a href="#l15.63"></a><span id="l15.63">                                             uint32_t headerSize,</span>
<a href="#l15.64"></a><span id="l15.64">                                             nsMsgSearchBoolExpression ** aExpressionTree,</span>
<a href="#l15.65"></a><span id="l15.65">                                             bool *pResult)</span>
<a href="#l15.66"></a><span id="l15.66"> {</span>
<a href="#l15.67"></a><span id="l15.67">     return MatchTerms(msgToMatch, termList, defaultCharset, scope, db, headers, headerSize, true, aExpressionTree, pResult);</span>
<a href="#l15.68"></a><span id="l15.68"> }</span>
<a href="#l15.69"></a><span id="l15.69"> </span>
<a href="#l15.70"></a><span id="l15.70"> // static method which matches a header against a list of search terms.</span>
<a href="#l15.71"></a><span id="l15.71"> nsresult</span>
<a href="#l15.72"></a><span id="l15.72"> nsMsgSearchOfflineMail::MatchTermsForSearch(nsIMsgDBHdr *msgToMatch,</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-                                            nsISupportsArray* termList,</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineplus">+                                            nsIArray* termList,</span>
<a href="#l15.75"></a><span id="l15.75">                                             const char *defaultCharset,</span>
<a href="#l15.76"></a><span id="l15.76">                                             nsIMsgSearchScopeTerm *scope,</span>
<a href="#l15.77"></a><span id="l15.77">                                             nsIMsgDatabase *db,</span>
<a href="#l15.78"></a><span id="l15.78">                                             nsMsgSearchBoolExpression ** aExpressionTree,</span>
<a href="#l15.79"></a><span id="l15.79">                                             bool *pResult)</span>
<a href="#l15.80"></a><span id="l15.80"> {</span>
<a href="#l15.81"></a><span id="l15.81"> </span>
<a href="#l15.82"></a><span id="l15.82">     return MatchTerms(msgToMatch, termList, defaultCharset, scope, db, nullptr, 0, false, aExpressionTree, pResult);</span>
<a href="#l15.83"></a><span id="l15.83"> }</span>
<a href="#l15.84"></a><span id="l15.84"> </span>
<a href="#l15.85"></a><span id="l15.85" class="difflineminus">-nsresult nsMsgSearchOfflineMail::ConstructExpressionTree(nsISupportsArray * termList,</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineplus">+nsresult nsMsgSearchOfflineMail::ConstructExpressionTree(nsIArray *termList,</span>
<a href="#l15.87"></a><span id="l15.87">                                             uint32_t termCount,</span>
<a href="#l15.88"></a><span id="l15.88">                                             uint32_t &amp;aStartPosInList,</span>
<a href="#l15.89"></a><span id="l15.89">                                             nsMsgSearchBoolExpression ** aExpressionTree)</span>
<a href="#l15.90"></a><span id="l15.90"> {</span>
<a href="#l15.91"></a><span id="l15.91">   nsMsgSearchBoolExpression * finalExpression = *aExpressionTree;</span>
<a href="#l15.92"></a><span id="l15.92"> </span>
<a href="#l15.93"></a><span id="l15.93">   if (!finalExpression)</span>
<a href="#l15.94"></a><span id="l15.94">     finalExpression = new nsMsgSearchBoolExpression();</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineat">@@ -659,34 +652,34 @@ nsresult nsMsgSearchOfflineMail::Process</span>
<a href="#l15.96"></a><span id="l15.96">           }</span>
<a href="#l15.97"></a><span id="l15.97">     }</span>
<a href="#l15.98"></a><span id="l15.98"> </span>
<a href="#l15.99"></a><span id="l15.99">     *pResult = result;</span>
<a href="#l15.100"></a><span id="l15.100">     return err;</span>
<a href="#l15.101"></a><span id="l15.101"> }</span>
<a href="#l15.102"></a><span id="l15.102"> </span>
<a href="#l15.103"></a><span id="l15.103"> nsresult nsMsgSearchOfflineMail::MatchTerms(nsIMsgDBHdr *msgToMatch,</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-                                            nsISupportsArray * termList,</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineplus">+                                            nsIArray *termList,</span>
<a href="#l15.106"></a><span id="l15.106">                                             const char *defaultCharset,</span>
<a href="#l15.107"></a><span id="l15.107">                                             nsIMsgSearchScopeTerm * scope,</span>
<a href="#l15.108"></a><span id="l15.108">                                             nsIMsgDatabase * db,</span>
<a href="#l15.109"></a><span id="l15.109">                                             const char * headers,</span>
<a href="#l15.110"></a><span id="l15.110">                                             uint32_t headerSize,</span>
<a href="#l15.111"></a><span id="l15.111">                                             bool Filtering,</span>
<a href="#l15.112"></a><span id="l15.112">                                             nsMsgSearchBoolExpression ** aExpressionTree,</span>
<a href="#l15.113"></a><span id="l15.113">                                             bool *pResult)</span>
<a href="#l15.114"></a><span id="l15.114"> {</span>
<a href="#l15.115"></a><span id="l15.115">   NS_ENSURE_ARG(aExpressionTree);</span>
<a href="#l15.116"></a><span id="l15.116">   nsresult err;</span>
<a href="#l15.117"></a><span id="l15.117"> </span>
<a href="#l15.118"></a><span id="l15.118">   if (!*aExpressionTree)</span>
<a href="#l15.119"></a><span id="l15.119">   {</span>
<a href="#l15.120"></a><span id="l15.120">     uint32_t initialPos = 0;</span>
<a href="#l15.121"></a><span id="l15.121">     uint32_t count;</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineminus">-    termList-&gt;Count(&amp;count);</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineplus">+    termList-&gt;GetLength(&amp;count);</span>
<a href="#l15.124"></a><span id="l15.124">     err = ConstructExpressionTree(termList, count, initialPos, aExpressionTree);</span>
<a href="#l15.125"></a><span id="l15.125">     if (NS_FAILED(err))</span>
<a href="#l15.126"></a><span id="l15.126">       return err;</span>
<a href="#l15.127"></a><span id="l15.127">   }</span>
<a href="#l15.128"></a><span id="l15.128"> </span>
<a href="#l15.129"></a><span id="l15.129">   // evaluate the expression tree and return the result</span>
<a href="#l15.130"></a><span id="l15.130">   *pResult = (*aExpressionTree)</span>
<a href="#l15.131"></a><span id="l15.131">     ?  (*aExpressionTree)-&gt;OfflineEvaluate(msgToMatch,</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineat">@@ -819,17 +812,17 @@ NS_IMETHODIMP nsMsgSearchOfflineMail::On</span>
<a href="#l15.133"></a><span id="l15.133">   if (m_scope)</span>
<a href="#l15.134"></a><span id="l15.134">     m_scope-&gt;GetSearchSession(getter_AddRefs(searchSession));</span>
<a href="#l15.135"></a><span id="l15.135">   if (searchSession)</span>
<a href="#l15.136"></a><span id="l15.136">     searchSession-&gt;ResumeSearch();</span>
<a href="#l15.137"></a><span id="l15.137"> </span>
<a href="#l15.138"></a><span id="l15.138">   return NS_OK;</span>
<a href="#l15.139"></a><span id="l15.139"> }</span>
<a href="#l15.140"></a><span id="l15.140"> </span>
<a href="#l15.141"></a><span id="l15.141" class="difflineminus">-nsMsgSearchOfflineNews::nsMsgSearchOfflineNews (nsIMsgSearchScopeTerm *scope, nsISupportsArray *termList) : nsMsgSearchOfflineMail (scope, termList)</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineplus">+nsMsgSearchOfflineNews::nsMsgSearchOfflineNews (nsIMsgSearchScopeTerm *scope, nsIArray *termList) : nsMsgSearchOfflineMail (scope, termList)</span>
<a href="#l15.143"></a><span id="l15.143"> {</span>
<a href="#l15.144"></a><span id="l15.144"> }</span>
<a href="#l15.145"></a><span id="l15.145"> </span>
<a href="#l15.146"></a><span id="l15.146"> </span>
<a href="#l15.147"></a><span id="l15.147"> nsMsgSearchOfflineNews::~nsMsgSearchOfflineNews ()</span>
<a href="#l15.148"></a><span id="l15.148"> {</span>
<a href="#l15.149"></a><span id="l15.149"> }</span>
<a href="#l15.150"></a><span id="l15.150"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgLocalSearch.h</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgLocalSearch.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -19,39 +19,39 @@</span>
<a href="#l16.4"></a><span id="l16.4"> class nsIMsgDBHdr;</span>
<a href="#l16.5"></a><span id="l16.5"> class nsIMsgSearchScopeTerm;</span>
<a href="#l16.6"></a><span id="l16.6"> class nsIMsgFolder;</span>
<a href="#l16.7"></a><span id="l16.7"> class nsMsgSearchBoolExpression;</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9"> class nsMsgSearchOfflineMail : public nsMsgSearchAdapter, public nsIUrlListener</span>
<a href="#l16.10"></a><span id="l16.10"> {</span>
<a href="#l16.11"></a><span id="l16.11"> public:</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  nsMsgSearchOfflineMail (nsIMsgSearchScopeTerm*, nsISupportsArray *);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  nsMsgSearchOfflineMail (nsIMsgSearchScopeTerm*, nsIArray *);</span>
<a href="#l16.14"></a><span id="l16.14"> </span>
<a href="#l16.15"></a><span id="l16.15">   NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17">   NS_DECL_NSIURLLISTENER</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">   NS_IMETHOD ValidateTerms () override;</span>
<a href="#l16.20"></a><span id="l16.20">   NS_IMETHOD Search (bool *aDone) override;</span>
<a href="#l16.21"></a><span id="l16.21">   NS_IMETHOD Abort () override;</span>
<a href="#l16.22"></a><span id="l16.22">   NS_IMETHOD AddResultElement (nsIMsgDBHdr *) override;</span>
<a href="#l16.23"></a><span id="l16.23"> </span>
<a href="#l16.24"></a><span id="l16.24">   static nsresult  MatchTermsForFilter(nsIMsgDBHdr * msgToMatch,</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-                                         nsISupportsArray *termList,</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+                                         nsIArray *termList,</span>
<a href="#l16.27"></a><span id="l16.27">                                          const char *defaultCharset,</span>
<a href="#l16.28"></a><span id="l16.28">                                          nsIMsgSearchScopeTerm *scope,</span>
<a href="#l16.29"></a><span id="l16.29">                                          nsIMsgDatabase * db,</span>
<a href="#l16.30"></a><span id="l16.30">                                          const char * headers,</span>
<a href="#l16.31"></a><span id="l16.31">                                          uint32_t headerSize,</span>
<a href="#l16.32"></a><span id="l16.32">                                          nsMsgSearchBoolExpression ** aExpressionTree,</span>
<a href="#l16.33"></a><span id="l16.33">                      bool *pResult);</span>
<a href="#l16.34"></a><span id="l16.34"> </span>
<a href="#l16.35"></a><span id="l16.35">   static nsresult MatchTermsForSearch(nsIMsgDBHdr * msgTomatch,</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">-                                      nsISupportsArray * termList,</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+                                      nsIArray *termList,</span>
<a href="#l16.38"></a><span id="l16.38">                                       const char *defaultCharset,</span>
<a href="#l16.39"></a><span id="l16.39">                                       nsIMsgSearchScopeTerm *scope,</span>
<a href="#l16.40"></a><span id="l16.40">                                       nsIMsgDatabase *db,</span>
<a href="#l16.41"></a><span id="l16.41">                                       nsMsgSearchBoolExpression ** aExpressionTree,</span>
<a href="#l16.42"></a><span id="l16.42">  bool *pResult);</span>
<a href="#l16.43"></a><span id="l16.43"> </span>
<a href="#l16.44"></a><span id="l16.44">   virtual nsresult OpenSummaryFile ();</span>
<a href="#l16.45"></a><span id="l16.45"> </span>
<a href="#l16.46"></a><span id="l16.46" class="difflineat">@@ -62,41 +62,41 @@ public:</span>
<a href="#l16.47"></a><span id="l16.47">                                nsIMsgDatabase * db,</span>
<a href="#l16.48"></a><span id="l16.48">                                const char * headers,</span>
<a href="#l16.49"></a><span id="l16.49">                                uint32_t headerSize,</span>
<a href="#l16.50"></a><span id="l16.50">                                bool Filtering,</span>
<a href="#l16.51"></a><span id="l16.51">                  bool *pResult);</span>
<a href="#l16.52"></a><span id="l16.52"> protected:</span>
<a href="#l16.53"></a><span id="l16.53">   virtual ~nsMsgSearchOfflineMail();</span>
<a href="#l16.54"></a><span id="l16.54">   static nsresult MatchTerms(nsIMsgDBHdr *msgToMatch,</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineminus">-                                nsISupportsArray *termList,</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineplus">+                                nsIArray *termList,</span>
<a href="#l16.57"></a><span id="l16.57">                                 const char *defaultCharset,</span>
<a href="#l16.58"></a><span id="l16.58">                                 nsIMsgSearchScopeTerm *scope,</span>
<a href="#l16.59"></a><span id="l16.59">                                 nsIMsgDatabase * db,</span>
<a href="#l16.60"></a><span id="l16.60">                                 const char * headers,</span>
<a href="#l16.61"></a><span id="l16.61">                                 uint32_t headerSize,</span>
<a href="#l16.62"></a><span id="l16.62">                                 bool ForFilters,</span>
<a href="#l16.63"></a><span id="l16.63">                                 nsMsgSearchBoolExpression ** aExpressionTree,</span>
<a href="#l16.64"></a><span id="l16.64">                 bool *pResult);</span>
<a href="#l16.65"></a><span id="l16.65"> </span>
<a href="#l16.66"></a><span id="l16.66" class="difflineminus">-    static nsresult ConstructExpressionTree(nsISupportsArray * termList,</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+    static nsresult ConstructExpressionTree(nsIArray *termList,</span>
<a href="#l16.68"></a><span id="l16.68">                                       uint32_t termCount,</span>
<a href="#l16.69"></a><span id="l16.69">                                       uint32_t &amp;aStartPosInList,</span>
<a href="#l16.70"></a><span id="l16.70">                                       nsMsgSearchBoolExpression ** aExpressionTree);</span>
<a href="#l16.71"></a><span id="l16.71"> </span>
<a href="#l16.72"></a><span id="l16.72">   nsCOMPtr &lt;nsIMsgDatabase&gt; m_db;</span>
<a href="#l16.73"></a><span id="l16.73">   nsCOMPtr&lt;nsISimpleEnumerator&gt; m_listContext;</span>
<a href="#l16.74"></a><span id="l16.74">   void CleanUpScope();</span>
<a href="#l16.75"></a><span id="l16.75"> };</span>
<a href="#l16.76"></a><span id="l16.76"> </span>
<a href="#l16.77"></a><span id="l16.77"> </span>
<a href="#l16.78"></a><span id="l16.78"> class nsMsgSearchOfflineNews : public nsMsgSearchOfflineMail</span>
<a href="#l16.79"></a><span id="l16.79"> {</span>
<a href="#l16.80"></a><span id="l16.80"> public:</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineminus">-  nsMsgSearchOfflineNews (nsIMsgSearchScopeTerm*, nsISupportsArray *);</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineplus">+  nsMsgSearchOfflineNews (nsIMsgSearchScopeTerm*, nsIArray*);</span>
<a href="#l16.83"></a><span id="l16.83">   virtual ~nsMsgSearchOfflineNews ();</span>
<a href="#l16.84"></a><span id="l16.84">   NS_IMETHOD ValidateTerms () override;</span>
<a href="#l16.85"></a><span id="l16.85"> </span>
<a href="#l16.86"></a><span id="l16.86">   virtual nsresult OpenSummaryFile () override;</span>
<a href="#l16.87"></a><span id="l16.87"> };</span>
<a href="#l16.88"></a><span id="l16.88"> </span>
<a href="#l16.89"></a><span id="l16.89"> </span>
<a href="#l16.90"></a><span id="l16.90"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -19,24 +19,17 @@</span>
<a href="#l17.4"></a><span id="l17.4"> #include &quot;prprf.h&quot;</span>
<a href="#l17.5"></a><span id="l17.5"> #include &quot;mozilla/UniquePtr.h&quot;</span>
<a href="#l17.6"></a><span id="l17.6"> #include &quot;prmem.h&quot;</span>
<a href="#l17.7"></a><span id="l17.7"> #include &quot;MailNewsTypes.h&quot;</span>
<a href="#l17.8"></a><span id="l17.8"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l17.9"></a><span id="l17.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l17.10"></a><span id="l17.10"> #include &quot;nsMemory.h&quot;</span>
<a href="#l17.11"></a><span id="l17.11"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-// classes.</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-#endif</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l17.21"></a><span id="l17.21"> #include &quot;nsAlgorithm.h&quot;</span>
<a href="#l17.22"></a><span id="l17.22"> #include &lt;algorithm&gt;</span>
<a href="#l17.23"></a><span id="l17.23"> #include &quot;mozilla/Attributes.h&quot;</span>
<a href="#l17.24"></a><span id="l17.24"> </span>
<a href="#l17.25"></a><span id="l17.25"> // This stuff lives in the base class because the IMAP search syntax</span>
<a href="#l17.26"></a><span id="l17.26"> // is used by the Dredd SEARCH command as well as IMAP itself</span>
<a href="#l17.27"></a><span id="l17.27"> </span>
<a href="#l17.28"></a><span id="l17.28"> // km - the NOT and HEADER strings are not encoded with a trailing</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineat">@@ -84,17 +77,17 @@ NS_IMETHODIMP nsMsgSearchAdapter::Modify</span>
<a href="#l17.30"></a><span id="l17.30"> </span>
<a href="#l17.31"></a><span id="l17.31"> NS_IMETHODIMP nsMsgSearchAdapter::OpenResultElement(nsMsgResultElement *)</span>
<a href="#l17.32"></a><span id="l17.32"> {</span>
<a href="#l17.33"></a><span id="l17.33">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l17.34"></a><span id="l17.34"> }</span>
<a href="#l17.35"></a><span id="l17.35"> </span>
<a href="#l17.36"></a><span id="l17.36"> NS_IMPL_ISUPPORTS(nsMsgSearchAdapter, nsIMsgSearchAdapter)</span>
<a href="#l17.37"></a><span id="l17.37"> </span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-nsMsgSearchAdapter::nsMsgSearchAdapter(nsIMsgSearchScopeTerm *scope, nsISupportsArray *searchTerms)</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+nsMsgSearchAdapter::nsMsgSearchAdapter(nsIMsgSearchScopeTerm *scope, nsIArray *searchTerms)</span>
<a href="#l17.40"></a><span id="l17.40">   : m_searchTerms(searchTerms)</span>
<a href="#l17.41"></a><span id="l17.41"> {</span>
<a href="#l17.42"></a><span id="l17.42">   m_scope = scope;</span>
<a href="#l17.43"></a><span id="l17.43"> }</span>
<a href="#l17.44"></a><span id="l17.44"> </span>
<a href="#l17.45"></a><span id="l17.45"> nsMsgSearchAdapter::~nsMsgSearchAdapter()</span>
<a href="#l17.46"></a><span id="l17.46"> {</span>
<a href="#l17.47"></a><span id="l17.47"> }</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineat">@@ -662,26 +655,26 @@ nsresult nsMsgSearchAdapter::EncodeImapV</span>
<a href="#l17.49"></a><span id="l17.49">   PL_strcat (encoding, value);</span>
<a href="#l17.50"></a><span id="l17.50">   if (useQuotes)</span>
<a href="#l17.51"></a><span id="l17.51">     PL_strcat(encoding, &quot;\&quot;&quot;);</span>
<a href="#l17.52"></a><span id="l17.52"> </span>
<a href="#l17.53"></a><span id="l17.53">   return NS_OK;</span>
<a href="#l17.54"></a><span id="l17.54"> }</span>
<a href="#l17.55"></a><span id="l17.55"> </span>
<a href="#l17.56"></a><span id="l17.56"> </span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-nsresult nsMsgSearchAdapter::EncodeImap (char **ppOutEncoding, nsISupportsArray *searchTerms, const char16_t *srcCharset, const char16_t *destCharset, bool reallyDredd)</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+nsresult nsMsgSearchAdapter::EncodeImap (char **ppOutEncoding, nsIArray *searchTerms, const char16_t *srcCharset, const char16_t *destCharset, bool reallyDredd)</span>
<a href="#l17.59"></a><span id="l17.59"> {</span>
<a href="#l17.60"></a><span id="l17.60">   // i've left the old code (before using CBoolExpression for debugging purposes to make sure that</span>
<a href="#l17.61"></a><span id="l17.61">   // the new code generates the same encoding string as the old code.....</span>
<a href="#l17.62"></a><span id="l17.62"> </span>
<a href="#l17.63"></a><span id="l17.63">   nsresult err = NS_OK;</span>
<a href="#l17.64"></a><span id="l17.64">   *ppOutEncoding = nullptr;</span>
<a href="#l17.65"></a><span id="l17.65"> </span>
<a href="#l17.66"></a><span id="l17.66">   uint32_t termCount;</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineminus">-  searchTerms-&gt;Count(&amp;termCount);</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+  searchTerms-&gt;GetLength(&amp;termCount);</span>
<a href="#l17.69"></a><span id="l17.69">   uint32_t i = 0;</span>
<a href="#l17.70"></a><span id="l17.70"> </span>
<a href="#l17.71"></a><span id="l17.71">   // create our expression</span>
<a href="#l17.72"></a><span id="l17.72">   nsMsgSearchBoolExpression * expression = new nsMsgSearchBoolExpression();</span>
<a href="#l17.73"></a><span id="l17.73">   if (!expression)</span>
<a href="#l17.74"></a><span id="l17.74">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l17.75"></a><span id="l17.75"> </span>
<a href="#l17.76"></a><span id="l17.76">   for (i = 0; i &lt; termCount &amp;&amp; NS_SUCCEEDED(err); i++)</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineat">@@ -818,24 +811,24 @@ nsMsgSearchValidityTable::GetNumAvailAtt</span>
<a href="#l17.78"></a><span id="l17.78">         break;</span>
<a href="#l17.79"></a><span id="l17.79">       }</span>
<a href="#l17.80"></a><span id="l17.80">         }</span>
<a href="#l17.81"></a><span id="l17.81">   *aResult = m_numAvailAttribs;</span>
<a href="#l17.82"></a><span id="l17.82">     return NS_OK;</span>
<a href="#l17.83"></a><span id="l17.83"> }</span>
<a href="#l17.84"></a><span id="l17.84"> </span>
<a href="#l17.85"></a><span id="l17.85"> nsresult</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineminus">-nsMsgSearchValidityTable::ValidateTerms (nsISupportsArray *searchTerms)</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+nsMsgSearchValidityTable::ValidateTerms (nsIArray *searchTerms)</span>
<a href="#l17.88"></a><span id="l17.88"> {</span>
<a href="#l17.89"></a><span id="l17.89">   nsresult err = NS_OK;</span>
<a href="#l17.90"></a><span id="l17.90">   uint32_t count;</span>
<a href="#l17.91"></a><span id="l17.91"> </span>
<a href="#l17.92"></a><span id="l17.92">   NS_ENSURE_ARG(searchTerms);</span>
<a href="#l17.93"></a><span id="l17.93"> </span>
<a href="#l17.94"></a><span id="l17.94" class="difflineminus">-  searchTerms-&gt;Count(&amp;count);</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineplus">+  searchTerms-&gt;GetLength(&amp;count);</span>
<a href="#l17.96"></a><span id="l17.96">   for (uint32_t i = 0; i &lt; count; i++)</span>
<a href="#l17.97"></a><span id="l17.97">   {</span>
<a href="#l17.98"></a><span id="l17.98">     nsCOMPtr&lt;nsIMsgSearchTerm&gt; pTerm;</span>
<a href="#l17.99"></a><span id="l17.99">     searchTerms-&gt;QueryElementAt(i, NS_GET_IID(nsIMsgSearchTerm),</span>
<a href="#l17.100"></a><span id="l17.100">                              (void **)getter_AddRefs(pTerm));</span>
<a href="#l17.101"></a><span id="l17.101"> </span>
<a href="#l17.102"></a><span id="l17.102">     nsIMsgSearchTerm *iTerm = pTerm;</span>
<a href="#l17.103"></a><span id="l17.103">     nsMsgSearchTerm *term = static_cast&lt;nsMsgSearchTerm *&gt;(iTerm);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchImap.h</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchImap.h</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -9,26 +9,26 @@</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5"> //-----------------------------------------------------------------------------</span>
<a href="#l18.6"></a><span id="l18.6"> //---------- Adapter class for searching online (IMAP) folders ----------------</span>
<a href="#l18.7"></a><span id="l18.7"> //-----------------------------------------------------------------------------</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9"> class nsMsgSearchOnlineMail : public nsMsgSearchAdapter</span>
<a href="#l18.10"></a><span id="l18.10"> {</span>
<a href="#l18.11"></a><span id="l18.11"> public:</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  nsMsgSearchOnlineMail (nsMsgSearchScopeTerm *scope, nsISupportsArray *termList);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  nsMsgSearchOnlineMail (nsMsgSearchScopeTerm *scope, nsIArray *termList);</span>
<a href="#l18.14"></a><span id="l18.14">   virtual ~nsMsgSearchOnlineMail ();</span>
<a href="#l18.15"></a><span id="l18.15"> </span>
<a href="#l18.16"></a><span id="l18.16">   NS_IMETHOD ValidateTerms () override;</span>
<a href="#l18.17"></a><span id="l18.17">   NS_IMETHOD Search (bool *aDone) override;</span>
<a href="#l18.18"></a><span id="l18.18">   NS_IMETHOD GetEncoding (char **result) override;</span>
<a href="#l18.19"></a><span id="l18.19">   NS_IMETHOD AddResultElement (nsIMsgDBHdr *) override;</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21">   static nsresult Encode (nsCString&amp; ppEncoding,</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineminus">-                            nsISupportsArray *searchTerms,</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+                            nsIArray *searchTerms,</span>
<a href="#l18.24"></a><span id="l18.24">                             const char16_t *destCharset);</span>
<a href="#l18.25"></a><span id="l18.25"> </span>
<a href="#l18.26"></a><span id="l18.26"> </span>
<a href="#l18.27"></a><span id="l18.27"> protected:</span>
<a href="#l18.28"></a><span id="l18.28">   nsCString m_encoding;</span>
<a href="#l18.29"></a><span id="l18.29"> };</span>
<a href="#l18.30"></a><span id="l18.30"> </span>
<a href="#l18.31"></a><span id="l18.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchNews.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchNews.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -10,24 +10,17 @@</span>
<a href="#l19.4"></a><span id="l19.4"> #include &quot;nsMsgSearchTerm.h&quot;</span>
<a href="#l19.5"></a><span id="l19.5"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l19.6"></a><span id="l19.6"> #include &quot;nsMsgSearchNews.h&quot;</span>
<a href="#l19.7"></a><span id="l19.7"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l19.8"></a><span id="l19.8"> #include &quot;prprf.h&quot;</span>
<a href="#l19.9"></a><span id="l19.9"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l19.10"></a><span id="l19.10"> #include &quot;nsMemory.h&quot;</span>
<a href="#l19.11"></a><span id="l19.11"> #include &lt;ctype.h&gt;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-// classes.</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">-#endif</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22"> // Implementation of search for IMAP mail folders</span>
<a href="#l19.23"></a><span id="l19.23"> </span>
<a href="#l19.24"></a><span id="l19.24"> </span>
<a href="#l19.25"></a><span id="l19.25"> // Implementation of search for newsgroups</span>
<a href="#l19.26"></a><span id="l19.26"> </span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28"> //-----------------------------------------------------------------------------</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineat">@@ -35,17 +28,17 @@</span>
<a href="#l19.30"></a><span id="l19.30"> //-----------------------------------------------------------------------------</span>
<a href="#l19.31"></a><span id="l19.31"> </span>
<a href="#l19.32"></a><span id="l19.32"> </span>
<a href="#l19.33"></a><span id="l19.33"> const char *nsMsgSearchNews::m_kNntpFrom = &quot;FROM &quot;;</span>
<a href="#l19.34"></a><span id="l19.34"> const char *nsMsgSearchNews::m_kNntpSubject = &quot;SUBJECT &quot;;</span>
<a href="#l19.35"></a><span id="l19.35"> const char *nsMsgSearchNews::m_kTermSeparator = &quot;/&quot;;</span>
<a href="#l19.36"></a><span id="l19.36"> </span>
<a href="#l19.37"></a><span id="l19.37"> </span>
<a href="#l19.38"></a><span id="l19.38" class="difflineminus">-nsMsgSearchNews::nsMsgSearchNews (nsMsgSearchScopeTerm *scope, nsISupportsArray *termList) : nsMsgSearchAdapter (scope, termList)</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+nsMsgSearchNews::nsMsgSearchNews (nsMsgSearchScopeTerm *scope, nsIArray *termList) : nsMsgSearchAdapter (scope, termList)</span>
<a href="#l19.40"></a><span id="l19.40"> {</span>
<a href="#l19.41"></a><span id="l19.41"> }</span>
<a href="#l19.42"></a><span id="l19.42"> </span>
<a href="#l19.43"></a><span id="l19.43"> </span>
<a href="#l19.44"></a><span id="l19.44"> nsMsgSearchNews::~nsMsgSearchNews ()</span>
<a href="#l19.45"></a><span id="l19.45"> {</span>
<a href="#l19.46"></a><span id="l19.46"> }</span>
<a href="#l19.47"></a><span id="l19.47"> </span>
<a href="#l19.48"></a><span id="l19.48" class="difflineat">@@ -218,17 +211,17 @@ nsresult nsMsgSearchNews::Encode (nsCStr</span>
<a href="#l19.49"></a><span id="l19.49">   NS_ASSERTION(outEncoding, &quot;no out encoding&quot;);</span>
<a href="#l19.50"></a><span id="l19.50">   if (!outEncoding)</span>
<a href="#l19.51"></a><span id="l19.51">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l19.52"></a><span id="l19.52"> </span>
<a href="#l19.53"></a><span id="l19.53">   nsresult err = NS_OK;</span>
<a href="#l19.54"></a><span id="l19.54"> </span>
<a href="#l19.55"></a><span id="l19.55">   uint32_t numTerms;</span>
<a href="#l19.56"></a><span id="l19.56"> </span>
<a href="#l19.57"></a><span id="l19.57" class="difflineminus">-  m_searchTerms-&gt;Count(&amp;numTerms);</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineplus">+  m_searchTerms-&gt;GetLength(&amp;numTerms);</span>
<a href="#l19.59"></a><span id="l19.59">   char **intermediateEncodings = new char * [numTerms];</span>
<a href="#l19.60"></a><span id="l19.60">   if (intermediateEncodings)</span>
<a href="#l19.61"></a><span id="l19.61">   {</span>
<a href="#l19.62"></a><span id="l19.62">     // Build an XPAT command for each term</span>
<a href="#l19.63"></a><span id="l19.63">     int encodingLength = 0;</span>
<a href="#l19.64"></a><span id="l19.64">     uint32_t i;</span>
<a href="#l19.65"></a><span id="l19.65">     for (i = 0; i &lt; numTerms; i++)</span>
<a href="#l19.66"></a><span id="l19.66">     {</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineat">@@ -247,17 +240,17 @@ nsresult nsMsgSearchNews::Encode (nsCStr</span>
<a href="#l19.68"></a><span id="l19.68">     }</span>
<a href="#l19.69"></a><span id="l19.69">     encodingLength += strlen(&quot;?search&quot;);</span>
<a href="#l19.70"></a><span id="l19.70">     // Combine all the term encodings into one big encoding</span>
<a href="#l19.71"></a><span id="l19.71">     char *encoding = new char [encodingLength + 1];</span>
<a href="#l19.72"></a><span id="l19.72">     if (encoding)</span>
<a href="#l19.73"></a><span id="l19.73">     {</span>
<a href="#l19.74"></a><span id="l19.74">       PL_strcpy (encoding, &quot;?search&quot;);</span>
<a href="#l19.75"></a><span id="l19.75"> </span>
<a href="#l19.76"></a><span id="l19.76" class="difflineminus">-      m_searchTerms-&gt;Count(&amp;numTerms);</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineplus">+      m_searchTerms-&gt;GetLength(&amp;numTerms);</span>
<a href="#l19.78"></a><span id="l19.78"> </span>
<a href="#l19.79"></a><span id="l19.79">       for (i = 0; i &lt; numTerms; i++)</span>
<a href="#l19.80"></a><span id="l19.80">       {</span>
<a href="#l19.81"></a><span id="l19.81">         if (intermediateEncodings[i])</span>
<a href="#l19.82"></a><span id="l19.82">         {</span>
<a href="#l19.83"></a><span id="l19.83">           PL_strcat (encoding, m_kTermSeparator);</span>
<a href="#l19.84"></a><span id="l19.84">           PL_strcat (encoding, intermediateEncodings[i]);</span>
<a href="#l19.85"></a><span id="l19.85">           delete [] intermediateEncodings[i];</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineat">@@ -330,17 +323,17 @@ void nsMsgSearchNews::CollateHits()</span>
<a href="#l19.87"></a><span id="l19.87">   uint32_t termCount = 1;</span>
<a href="#l19.88"></a><span id="l19.88">   if (!m_ORSearch)</span>
<a href="#l19.89"></a><span id="l19.89">   {</span>
<a href="#l19.90"></a><span id="l19.90">     // We have a traditional AND search which must be collated. In order to</span>
<a href="#l19.91"></a><span id="l19.91">     // get promoted into the hits list, a candidate article number must appear</span>
<a href="#l19.92"></a><span id="l19.92">     // in the results of each XPAT command. So if we fire 3 XPAT commands (one</span>
<a href="#l19.93"></a><span id="l19.93">     // per search term), the article number must appear 3 times. If it appears</span>
<a href="#l19.94"></a><span id="l19.94">     // fewer than 3 times, it matched some search terms, but not all.</span>
<a href="#l19.95"></a><span id="l19.95" class="difflineminus">-    m_searchTerms-&gt;Count(&amp;termCount);</span>
<a href="#l19.96"></a><span id="l19.96" class="difflineplus">+    m_searchTerms-&gt;GetLength(&amp;termCount);</span>
<a href="#l19.97"></a><span id="l19.97">   }</span>
<a href="#l19.98"></a><span id="l19.98">   uint32_t candidateCount = 0;</span>
<a href="#l19.99"></a><span id="l19.99">   uint32_t candidate = m_candidateHits[0];</span>
<a href="#l19.100"></a><span id="l19.100">   for (uint32_t index = 0; index &lt; size; ++index)   </span>
<a href="#l19.101"></a><span id="l19.101">   {</span>
<a href="#l19.102"></a><span id="l19.102">     uint32_t possibleCandidate = m_candidateHits[index];</span>
<a href="#l19.103"></a><span id="l19.103">     if (candidate == possibleCandidate)</span>
<a href="#l19.104"></a><span id="l19.104">     {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchNews.h</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchNews.h</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -10,17 +10,17 @@</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5"> //-----------------------------------------------------------------------------</span>
<a href="#l20.6"></a><span id="l20.6"> //---------- Adapter class for searching online (news) folders ----------------</span>
<a href="#l20.7"></a><span id="l20.7"> //-----------------------------------------------------------------------------</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9"> class nsMsgSearchNews : public nsMsgSearchAdapter</span>
<a href="#l20.10"></a><span id="l20.10"> {</span>
<a href="#l20.11"></a><span id="l20.11"> public:</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  nsMsgSearchNews (nsMsgSearchScopeTerm *scope, nsISupportsArray *termList);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  nsMsgSearchNews (nsMsgSearchScopeTerm *scope, nsIArray *termList);</span>
<a href="#l20.14"></a><span id="l20.14">   virtual ~nsMsgSearchNews ();</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16">   NS_IMETHOD ValidateTerms () override;</span>
<a href="#l20.17"></a><span id="l20.17">   NS_IMETHOD Search (bool *aDone) override;</span>
<a href="#l20.18"></a><span id="l20.18">   NS_IMETHOD GetEncoding (char **result) override;</span>
<a href="#l20.19"></a><span id="l20.19">   NS_IMETHOD AddHit(nsMsgKey key) override;</span>
<a href="#l20.20"></a><span id="l20.20">   NS_IMETHOD CurrentUrlDone(nsresult exitCode) override;</span>
<a href="#l20.21"></a><span id="l20.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l21.4"></a><span id="l21.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l21.5"></a><span id="l21.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.6"></a><span id="l21.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.7"></a><span id="l21.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9"> #include &quot;msgCore.h&quot;</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineplus">+#include &quot;nsArray.h&quot;</span>
<a href="#l21.11"></a><span id="l21.11"> #include &quot;nsMsgSearchCore.h&quot;</span>
<a href="#l21.12"></a><span id="l21.12"> #include &quot;nsMsgSearchAdapter.h&quot;</span>
<a href="#l21.13"></a><span id="l21.13"> #include &quot;nsMsgSearchBoolExpression.h&quot;</span>
<a href="#l21.14"></a><span id="l21.14"> #include &quot;nsMsgSearchSession.h&quot;</span>
<a href="#l21.15"></a><span id="l21.15"> #include &quot;nsMsgResultElement.h&quot;</span>
<a href="#l21.16"></a><span id="l21.16"> #include &quot;nsMsgSearchTerm.h&quot;</span>
<a href="#l21.17"></a><span id="l21.17"> #include &quot;nsMsgSearchScopeTerm.h&quot;</span>
<a href="#l21.18"></a><span id="l21.18"> #include &quot;nsIMsgMessageService.h&quot;</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineat">@@ -27,19 +28,18 @@ NS_IMPL_ISUPPORTS(nsMsgSearchSession, ns</span>
<a href="#l21.20"></a><span id="l21.20"> </span>
<a href="#l21.21"></a><span id="l21.21"> nsMsgSearchSession::nsMsgSearchSession()</span>
<a href="#l21.22"></a><span id="l21.22"> {</span>
<a href="#l21.23"></a><span id="l21.23">   m_sortAttribute = nsMsgSearchAttrib::Sender;</span>
<a href="#l21.24"></a><span id="l21.24">   m_idxRunningScope = 0;</span>
<a href="#l21.25"></a><span id="l21.25">   m_handlingError = false;</span>
<a href="#l21.26"></a><span id="l21.26">   m_expressionTree = nullptr;</span>
<a href="#l21.27"></a><span id="l21.27">   m_searchPaused = false;</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineminus">-  nsresult rv = NS_NewISupportsArray(getter_AddRefs(m_termList));</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-    NS_ASSERTION(false, &quot;Failed to allocate a nsISupportsArray for nsMsgFilter&quot;);</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+  m_termList = nsArray::Create();</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+  NS_ASSERTION(m_termList, &quot;Failed to allocate a nsIMutableArray for m_termList&quot;);</span>
<a href="#l21.33"></a><span id="l21.33"> }</span>
<a href="#l21.34"></a><span id="l21.34"> </span>
<a href="#l21.35"></a><span id="l21.35"> nsMsgSearchSession::~nsMsgSearchSession()</span>
<a href="#l21.36"></a><span id="l21.36"> {</span>
<a href="#l21.37"></a><span id="l21.37">   InterruptSearch();</span>
<a href="#l21.38"></a><span id="l21.38">   delete m_expressionTree;</span>
<a href="#l21.39"></a><span id="l21.39">   DestroyScopeList();</span>
<a href="#l21.40"></a><span id="l21.40">   DestroyTermList();</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineat">@@ -57,43 +57,50 @@ nsMsgSearchSession::AddSearchTerm(nsMsgS</span>
<a href="#l21.42"></a><span id="l21.42">   if (BooleanANDp)</span>
<a href="#l21.43"></a><span id="l21.43">     boolOp = (nsMsgSearchBooleanOperator)nsMsgSearchBooleanOp::BooleanAND;</span>
<a href="#l21.44"></a><span id="l21.44">   else</span>
<a href="#l21.45"></a><span id="l21.45">     boolOp = (nsMsgSearchBooleanOperator)nsMsgSearchBooleanOp::BooleanOR;</span>
<a href="#l21.46"></a><span id="l21.46">   nsMsgSearchTerm *pTerm = new nsMsgSearchTerm(attrib, op, value,</span>
<a href="#l21.47"></a><span id="l21.47">                                                boolOp, customString);</span>
<a href="#l21.48"></a><span id="l21.48">   NS_ENSURE_TRUE(pTerm, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l21.49"></a><span id="l21.49"> </span>
<a href="#l21.50"></a><span id="l21.50" class="difflineminus">-  m_termList-&gt;AppendElement(pTerm);</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+  m_termList-&gt;AppendElement(pTerm, /* weak = */ false);</span>
<a href="#l21.52"></a><span id="l21.52">   // force the expression tree to rebuild whenever we change the terms</span>
<a href="#l21.53"></a><span id="l21.53">   delete m_expressionTree;</span>
<a href="#l21.54"></a><span id="l21.54">   m_expressionTree = nullptr;</span>
<a href="#l21.55"></a><span id="l21.55">   return NS_OK;</span>
<a href="#l21.56"></a><span id="l21.56"> }</span>
<a href="#l21.57"></a><span id="l21.57"> </span>
<a href="#l21.58"></a><span id="l21.58"> NS_IMETHODIMP</span>
<a href="#l21.59"></a><span id="l21.59"> nsMsgSearchSession::AppendTerm(nsIMsgSearchTerm *aTerm)</span>
<a href="#l21.60"></a><span id="l21.60"> {</span>
<a href="#l21.61"></a><span id="l21.61">     NS_ENSURE_ARG_POINTER(aTerm);</span>
<a href="#l21.62"></a><span id="l21.62">     NS_ENSURE_TRUE(m_termList, NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l21.63"></a><span id="l21.63">     delete m_expressionTree;</span>
<a href="#l21.64"></a><span id="l21.64">     m_expressionTree = nullptr;</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineminus">-    return m_termList-&gt;AppendElement(aTerm);</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineplus">+    return m_termList-&gt;AppendElement(aTerm, /* weak = */ false);</span>
<a href="#l21.67"></a><span id="l21.67"> }</span>
<a href="#l21.68"></a><span id="l21.68"> </span>
<a href="#l21.69"></a><span id="l21.69"> NS_IMETHODIMP</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineminus">-nsMsgSearchSession::GetSearchTerms(nsISupportsArray **aResult)</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineplus">+nsMsgSearchSession::GetSearchTerms(nsIMutableArray **aResult)</span>
<a href="#l21.72"></a><span id="l21.72"> {</span>
<a href="#l21.73"></a><span id="l21.73">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l21.74"></a><span id="l21.74">     *aResult = m_termList;</span>
<a href="#l21.75"></a><span id="l21.75">     NS_ADDREF(*aResult);</span>
<a href="#l21.76"></a><span id="l21.76">     return NS_OK;</span>
<a href="#l21.77"></a><span id="l21.77"> }</span>
<a href="#l21.78"></a><span id="l21.78"> </span>
<a href="#l21.79"></a><span id="l21.79"> NS_IMETHODIMP</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineplus">+nsMsgSearchSession::SetSearchTerms(nsIMutableArray *aSearchTerms)</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineplus">+{</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineplus">+  m_termList = aSearchTerms;</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+  return NS_OK;</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineplus">+}</span>
<a href="#l21.85"></a><span id="l21.85" class="difflineplus">+</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l21.87"></a><span id="l21.87"> nsMsgSearchSession::CreateTerm(nsIMsgSearchTerm **aResult)</span>
<a href="#l21.88"></a><span id="l21.88"> {</span>
<a href="#l21.89"></a><span id="l21.89">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l21.90"></a><span id="l21.90">     nsMsgSearchTerm *term = new nsMsgSearchTerm;</span>
<a href="#l21.91"></a><span id="l21.91">     NS_ENSURE_TRUE(term, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l21.92"></a><span id="l21.92"> </span>
<a href="#l21.93"></a><span id="l21.93">     *aResult = static_cast&lt;nsIMsgSearchTerm*&gt;(term);</span>
<a href="#l21.94"></a><span id="l21.94">     NS_ADDREF(*aResult);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchSession.h</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchSession.h</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -7,24 +7,17 @@</span>
<a href="#l22.4"></a><span id="l22.4"> #define nsMsgSearchSession_h___</span>
<a href="#l22.5"></a><span id="l22.5"> </span>
<a href="#l22.6"></a><span id="l22.6"> #include &quot;nscore.h&quot;</span>
<a href="#l22.7"></a><span id="l22.7"> #include &quot;nsMsgSearchCore.h&quot;</span>
<a href="#l22.8"></a><span id="l22.8"> #include &quot;nsIMsgSearchSession.h&quot;</span>
<a href="#l22.9"></a><span id="l22.9"> #include &quot;nsIUrlListener.h&quot;</span>
<a href="#l22.10"></a><span id="l22.10"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l22.11"></a><span id="l22.11"> #include &quot;nsITimer.h&quot;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-// classes.</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-#endif</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l22.21"></a><span id="l22.21"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l22.22"></a><span id="l22.22"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l22.23"></a><span id="l22.23"> #include &quot;nsTObserverArray.h&quot;</span>
<a href="#l22.24"></a><span id="l22.24"> </span>
<a href="#l22.25"></a><span id="l22.25"> class nsMsgSearchAdapter;</span>
<a href="#l22.26"></a><span id="l22.26"> class nsMsgSearchBoolExpression;</span>
<a href="#l22.27"></a><span id="l22.27"> class nsMsgSearchScopeTerm;</span>
<a href="#l22.28"></a><span id="l22.28"> </span>
<a href="#l22.29"></a><span id="l22.29" class="difflineat">@@ -50,17 +43,17 @@ protected:</span>
<a href="#l22.30"></a><span id="l22.30">   nsresult DoNextSearch();</span>
<a href="#l22.31"></a><span id="l22.31">   nsresult SearchWOUrls ();</span>
<a href="#l22.32"></a><span id="l22.32">   nsresult GetNextUrl();</span>
<a href="#l22.33"></a><span id="l22.33">   nsresult NotifyListenersDone(nsresult status);</span>
<a href="#l22.34"></a><span id="l22.34">   void EnableFolderNotifications(bool aEnable);</span>
<a href="#l22.35"></a><span id="l22.35">   void ReleaseFolderDBRef();</span>
<a href="#l22.36"></a><span id="l22.36"> </span>
<a href="#l22.37"></a><span id="l22.37">   nsTArray&lt;RefPtr&lt;nsMsgSearchScopeTerm&gt;&gt; m_scopeList;</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineminus">-  nsCOMPtr &lt;nsISupportsArray&gt; m_termList;</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; m_termList;</span>
<a href="#l22.40"></a><span id="l22.40"> </span>
<a href="#l22.41"></a><span id="l22.41">   nsTArray&lt;nsCOMPtr&lt;nsIMsgSearchNotify&gt; &gt; m_listenerList;</span>
<a href="#l22.42"></a><span id="l22.42">   nsTArray&lt;int32_t&gt; m_listenerFlagList;</span>
<a href="#l22.43"></a><span id="l22.43">   /**</span>
<a href="#l22.44"></a><span id="l22.44">    * Iterator index for m_listenerList/m_listenerFlagList.  We used to use an</span>
<a href="#l22.45"></a><span id="l22.45">    * nsTObserverArray for m_listenerList but its auto-adjusting iterator was</span>
<a href="#l22.46"></a><span id="l22.46">    * not helping us keep our m_listenerFlagList iterator correct.</span>
<a href="#l22.47"></a><span id="l22.47">    *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -1901,17 +1901,17 @@ NS_IMETHODIMP nsMsgSearchScopeTerm::Clos</span>
<a href="#l23.4"></a><span id="l23.4">   return NS_OK;</span>
<a href="#l23.5"></a><span id="l23.5"> }</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7"> nsresult nsMsgSearchScopeTerm::TimeSlice (bool *aDone)</span>
<a href="#l23.8"></a><span id="l23.8"> {</span>
<a href="#l23.9"></a><span id="l23.9">   return m_adapter-&gt;Search(aDone);</span>
<a href="#l23.10"></a><span id="l23.10"> }</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-nsresult nsMsgSearchScopeTerm::InitializeAdapter (nsISupportsArray *termList)</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+nsresult nsMsgSearchScopeTerm::InitializeAdapter (nsIArray *termList)</span>
<a href="#l23.14"></a><span id="l23.14"> {</span>
<a href="#l23.15"></a><span id="l23.15">   if (m_adapter)</span>
<a href="#l23.16"></a><span id="l23.16">     return NS_OK;</span>
<a href="#l23.17"></a><span id="l23.17"> </span>
<a href="#l23.18"></a><span id="l23.18">   nsresult rv = NS_OK;</span>
<a href="#l23.19"></a><span id="l23.19"> </span>
<a href="#l23.20"></a><span id="l23.20">   switch (m_attribute)</span>
<a href="#l23.21"></a><span id="l23.21">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -4,24 +4,17 @@</span>
<a href="#l24.4"></a><span id="l24.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l24.5"></a><span id="l24.5"> </span>
<a href="#l24.6"></a><span id="l24.6"> /*</span>
<a href="#l24.7"></a><span id="l24.7">  * The account manager service - manages all accounts, servers, and identities</span>
<a href="#l24.8"></a><span id="l24.8">  */</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l24.11"></a><span id="l24.11"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-// classes.</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-#endif</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l24.21"></a><span id="l24.21"> #include &quot;nsIArray.h&quot;</span>
<a href="#l24.22"></a><span id="l24.22"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l24.23"></a><span id="l24.23"> #include &quot;nsMsgAccountManager.h&quot;</span>
<a href="#l24.24"></a><span id="l24.24"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l24.25"></a><span id="l24.25"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l24.26"></a><span id="l24.26"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l24.27"></a><span id="l24.27"> #include &quot;prmem.h&quot;</span>
<a href="#l24.28"></a><span id="l24.28"> #include &quot;prcmon.h&quot;</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineat">@@ -2554,31 +2547,31 @@ nsresult VirtualFolderChangeListener::In</span>
<a href="#l24.30"></a><span id="l24.30">     nsCOMPtr &lt;nsIMsgFilter&gt; tempFilter;</span>
<a href="#l24.31"></a><span id="l24.31">     filterList-&gt;CreateFilter(NS_LITERAL_STRING(&quot;temp&quot;), getter_AddRefs(tempFilter));</span>
<a href="#l24.32"></a><span id="l24.32">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.33"></a><span id="l24.33">     filterList-&gt;ParseCondition(tempFilter, searchTermString.get());</span>
<a href="#l24.34"></a><span id="l24.34">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.35"></a><span id="l24.35">     m_searchSession = do_CreateInstance(NS_MSGSEARCHSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l24.36"></a><span id="l24.36">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.37"></a><span id="l24.37"> </span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">-    nsCOMPtr&lt;nsISupportsArray&gt; searchTerms;</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineplus">+    nsCOMPtr&lt;nsIMutableArray&gt; searchTerms;</span>
<a href="#l24.40"></a><span id="l24.40">     rv = tempFilter-&gt;GetSearchTerms(getter_AddRefs(searchTerms));</span>
<a href="#l24.41"></a><span id="l24.41">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.42"></a><span id="l24.42"> </span>
<a href="#l24.43"></a><span id="l24.43">     // we add the search scope right before we match the header,</span>
<a href="#l24.44"></a><span id="l24.44">     // because we don't want the search scope caching the body input</span>
<a href="#l24.45"></a><span id="l24.45">     // stream, because that holds onto the mailbox file, breaking</span>
<a href="#l24.46"></a><span id="l24.46">     // compaction.</span>
<a href="#l24.47"></a><span id="l24.47"> </span>
<a href="#l24.48"></a><span id="l24.48">     // add each item in termsArray to the search session</span>
<a href="#l24.49"></a><span id="l24.49">     uint32_t numTerms;</span>
<a href="#l24.50"></a><span id="l24.50">     searchTerms-&gt;Count(&amp;numTerms);</span>
<a href="#l24.51"></a><span id="l24.51">     for (uint32_t i = 0; i &lt; numTerms; i++)</span>
<a href="#l24.52"></a><span id="l24.52">     {</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-      nsCOMPtr &lt;nsIMsgSearchTerm&gt; searchTerm (do_QueryElementAt(searchTerms, i));</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+      nsCOMPtr&lt;nsIMsgSearchTerm&gt; searchTerm(do_QueryElementAt(searchTerms, i));</span>
<a href="#l24.55"></a><span id="l24.55">       nsMsgSearchAttribValue attrib;</span>
<a href="#l24.56"></a><span id="l24.56">       searchTerm-&gt;GetAttrib(&amp;attrib);</span>
<a href="#l24.57"></a><span id="l24.57">       if (attrib == nsMsgSearchAttrib::MsgStatus)</span>
<a href="#l24.58"></a><span id="l24.58">         m_searchOnMsgStatus = true;</span>
<a href="#l24.59"></a><span id="l24.59">       m_searchSession-&gt;AppendTerm(searchTerm);</span>
<a href="#l24.60"></a><span id="l24.60">     }</span>
<a href="#l24.61"></a><span id="l24.61">   }</span>
<a href="#l24.62"></a><span id="l24.62">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -3588,17 +3588,17 @@ nsMsgDBView::PerformActionsOnJunkMsgs(bo</span>
<a href="#l25.4"></a><span id="l25.4">     else if (msgsAreJunk)</span>
<a href="#l25.5"></a><span id="l25.5">     {</span>
<a href="#l25.6"></a><span id="l25.6">       if (mDeleteModel == nsMsgImapDeleteModels::IMAPDelete)</span>
<a href="#l25.7"></a><span id="l25.7">       {</span>
<a href="#l25.8"></a><span id="l25.8">         // Unfortunately the DeleteMessages in this case is interpreted by IMAP as</span>
<a href="#l25.9"></a><span id="l25.9">         //  a delete toggle. So what we have to do is to assemble a new delete</span>
<a href="#l25.10"></a><span id="l25.10">         //  array, keeping only those that are not deleted.</span>
<a href="#l25.11"></a><span id="l25.11">         //</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-        nsCOMPtr&lt;nsIMutableArray&gt; hdrsToDelete = do_CreateInstance(&quot;@mozilla.org/array;1&quot;, &amp;rv);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+        nsCOMPtr&lt;nsIMutableArray&gt; hdrsToDelete = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l25.14"></a><span id="l25.14">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.15"></a><span id="l25.15">         uint32_t cnt;</span>
<a href="#l25.16"></a><span id="l25.16">         rv = mJunkHdrs-&gt;GetLength(&amp;cnt);</span>
<a href="#l25.17"></a><span id="l25.17">         for (uint32_t i = 0; i &lt; cnt; i++)</span>
<a href="#l25.18"></a><span id="l25.18">         {</span>
<a href="#l25.19"></a><span id="l25.19">           nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr = do_QueryElementAt(mJunkHdrs, i);</span>
<a href="#l25.20"></a><span id="l25.20">           if (msgHdr)</span>
<a href="#l25.21"></a><span id="l25.21">           {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -13,16 +13,17 @@</span>
<a href="#l26.4"></a><span id="l26.4"> #include &quot;nsIMsgCopyService.h&quot;</span>
<a href="#l26.5"></a><span id="l26.5"> #include &quot;nsICopyMsgStreamListener.h&quot;</span>
<a href="#l26.6"></a><span id="l26.6"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l26.7"></a><span id="l26.7"> #include &quot;nsITreeColumns.h&quot;</span>
<a href="#l26.8"></a><span id="l26.8"> #include &quot;nsIMsgSearchSession.h&quot;</span>
<a href="#l26.9"></a><span id="l26.9"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l26.10"></a><span id="l26.10"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l26.11"></a><span id="l26.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l26.13"></a><span id="l26.13"> </span>
<a href="#l26.14"></a><span id="l26.14"> nsMsgXFVirtualFolderDBView::nsMsgXFVirtualFolderDBView()</span>
<a href="#l26.15"></a><span id="l26.15"> {</span>
<a href="#l26.16"></a><span id="l26.16">   mSuppressMsgDisplay = false;</span>
<a href="#l26.17"></a><span id="l26.17">   m_doingSearch = false;</span>
<a href="#l26.18"></a><span id="l26.18">   m_doingQuickSearch = false;</span>
<a href="#l26.19"></a><span id="l26.19">   m_totalMessagesInView = 0;</span>
<a href="#l26.20"></a><span id="l26.20"> }</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineat">@@ -378,17 +379,17 @@ nsMsgXFVirtualFolderDBView::OnNewSearch(</span>
<a href="#l26.22"></a><span id="l26.22">   // Figure out how many search terms the virtual folder has.</span>
<a href="#l26.23"></a><span id="l26.23">   nsCOMPtr&lt;nsIMsgDatabase&gt; virtDatabase;</span>
<a href="#l26.24"></a><span id="l26.24">   nsCOMPtr&lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l26.25"></a><span id="l26.25">   nsresult rv = m_viewFolder-&gt;GetDBFolderInfoAndDB(getter_AddRefs(dbFolderInfo), getter_AddRefs(virtDatabase));</span>
<a href="#l26.26"></a><span id="l26.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.27"></a><span id="l26.27"> </span>
<a href="#l26.28"></a><span id="l26.28">   nsCString terms;</span>
<a href="#l26.29"></a><span id="l26.29">   dbFolderInfo-&gt;GetCharProperty(&quot;searchStr&quot;, terms);</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; searchTerms;</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; searchTerms;</span>
<a href="#l26.32"></a><span id="l26.32">   rv = searchSession-&gt;GetSearchTerms(getter_AddRefs(searchTerms));</span>
<a href="#l26.33"></a><span id="l26.33">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.34"></a><span id="l26.34">   nsCString curSearchAsString;</span>
<a href="#l26.35"></a><span id="l26.35"> </span>
<a href="#l26.36"></a><span id="l26.36">   rv = MsgTermListToString(searchTerms, curSearchAsString);</span>
<a href="#l26.37"></a><span id="l26.37">   // Trim off the initial AND/OR, which is irrelevant and inconsistent between</span>
<a href="#l26.38"></a><span id="l26.38">   // what searchSpec.js generates, and what's in virtualFolders.dat.</span>
<a href="#l26.39"></a><span id="l26.39">   curSearchAsString.Cut(0, StringBeginsWith(curSearchAsString, NS_LITERAL_CSTRING(&quot;AND&quot;)) ? 3 : 2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/base/src/virtualFolderWrapper.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/base/src/virtualFolderWrapper.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -24,19 +24,18 @@ var VirtualFolderHelper = {</span>
<a href="#l27.4"></a><span id="l27.4">    * If the call to addSubfolder fails (and therefore throws), we will NOT catch</span>
<a href="#l27.5"></a><span id="l27.5">    *  it.</span>
<a href="#l27.6"></a><span id="l27.6">    *</span>
<a href="#l27.7"></a><span id="l27.7">    * @param aFolderName The name of the new folder to create.</span>
<a href="#l27.8"></a><span id="l27.8">    * @param aParentFolder The folder in which to create the search folder.</span>
<a href="#l27.9"></a><span id="l27.9">    * @param aSearchFolders A list of nsIMsgFolders that you want to use as the</span>
<a href="#l27.10"></a><span id="l27.10">    *     sources for the virtual folder OR a string that is the already '|'</span>
<a href="#l27.11"></a><span id="l27.11">    *     delimited list of folder URIs to use.</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-   * @param aSearchTerms The search terms to use for the virtual folder.  This</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-   *     should be a JS list/nsIMutableArray/nsISupportsArray of</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">-   *     nsIMsgSearchTermbs.</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+   * @param aSearchTerms The search terms to use for the virtual folder. This</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineplus">+   *     should be a JS list/nsIMutableArray of nsIMsgSearchTerms.</span>
<a href="#l27.17"></a><span id="l27.17">    * @param aOnlineSearch Should the search attempt to use the server's search</span>
<a href="#l27.18"></a><span id="l27.18">    *     capabilities when possible and appropriate?</span>
<a href="#l27.19"></a><span id="l27.19">    *</span>
<a href="#l27.20"></a><span id="l27.20">    * @return The VirtualFolderWrapper wrapping the newly created folder.  You</span>
<a href="#l27.21"></a><span id="l27.21">    *     would probably only want this for its virtualFolder attribute which has</span>
<a href="#l27.22"></a><span id="l27.22">    *     the nsIMsgFolder we created.  Be careful about accessing any of the</span>
<a href="#l27.23"></a><span id="l27.23">    *     other attributes, as they will bring its message database back to life.</span>
<a href="#l27.24"></a><span id="l27.24">    */</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineat">@@ -128,18 +127,17 @@ VirtualFolderWrapper.prototype = {</span>
<a href="#l27.26"></a><span id="l27.26">                                .QueryInterface(Ci.nsIMsgFolder));</span>
<a href="#l27.27"></a><span id="l27.27">     }</span>
<a href="#l27.28"></a><span id="l27.28">     return folders;</span>
<a href="#l27.29"></a><span id="l27.29">   },</span>
<a href="#l27.30"></a><span id="l27.30">   /**</span>
<a href="#l27.31"></a><span id="l27.31">    * Set the search folders that back this virtual folder.</span>
<a href="#l27.32"></a><span id="l27.32">    *</span>
<a href="#l27.33"></a><span id="l27.33">    * @param aFolders Either a &quot;|&quot;-delimited string of folder URIs or a list of</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineminus">-   *     nsIMsgFolders that fixIterator can traverse (JS array/nsIMutableArray/</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineminus">-   *     nsISupportsArray).</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineplus">+   *     nsIMsgFolders that fixIterator can traverse (JS array/nsIMutableArray).</span>
<a href="#l27.37"></a><span id="l27.37">    */</span>
<a href="#l27.38"></a><span id="l27.38">   set searchFolders(aFolders) {</span>
<a href="#l27.39"></a><span id="l27.39">     if (typeof(aFolders) == &quot;string&quot;) {</span>
<a href="#l27.40"></a><span id="l27.40">       this.dbFolderInfo.setCharProperty(&quot;searchFolderUri&quot;, aFolders);</span>
<a href="#l27.41"></a><span id="l27.41">     }</span>
<a href="#l27.42"></a><span id="l27.42">     else {</span>
<a href="#l27.43"></a><span id="l27.43">       let uris = Array.from(fixIterator(aFolders, Ci.nsIMsgFolder))</span>
<a href="#l27.44"></a><span id="l27.44">                       .map(folder =&gt; folder.URI);</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineat">@@ -178,17 +176,17 @@ VirtualFolderWrapper.prototype = {</span>
<a href="#l27.46"></a><span id="l27.46"> </span>
<a href="#l27.47"></a><span id="l27.47">   /**</span>
<a href="#l27.48"></a><span id="l27.48">    * Set the search string for this virtual folder to the stringified version of</span>
<a href="#l27.49"></a><span id="l27.49">    *  the provided list of nsIMsgSearchTerm search terms.  If you already have</span>
<a href="#l27.50"></a><span id="l27.50">    *  a strinigified version of the search constraint, just set |searchString|</span>
<a href="#l27.51"></a><span id="l27.51">    *  directly.</span>
<a href="#l27.52"></a><span id="l27.52">    *</span>
<a href="#l27.53"></a><span id="l27.53">    * @param aTerms Some collection that fixIterator can traverse.  A JS list or</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineminus">-   *     XPCOM array (nsIMutableArray or nsISupportsArray) should work.</span>
<a href="#l27.55"></a><span id="l27.55" class="difflineplus">+   *     XPCOM array (nsIMutableArray) should work.</span>
<a href="#l27.56"></a><span id="l27.56">    */</span>
<a href="#l27.57"></a><span id="l27.57">   set searchTerms(aTerms) {</span>
<a href="#l27.58"></a><span id="l27.58">     let condition = &quot;&quot;;</span>
<a href="#l27.59"></a><span id="l27.59">     for (let term in fixIterator(aTerms, Ci.nsIMsgSearchTerm)) {</span>
<a href="#l27.60"></a><span id="l27.60">       if (condition.length)</span>
<a href="#l27.61"></a><span id="l27.61">         condition += &quot; &quot;;</span>
<a href="#l27.62"></a><span id="l27.62">       if (term.matchAll) {</span>
<a href="#l27.63"></a><span id="l27.63">         condition = &quot;ALL&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -19,16 +19,17 @@</span>
<a href="#l28.4"></a><span id="l28.4"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l28.5"></a><span id="l28.5"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l28.6"></a><span id="l28.6"> #include &quot;nsIMsgFolderCache.h&quot;</span>
<a href="#l28.7"></a><span id="l28.7"> #include &quot;nsIMsgPluggableStore.h&quot;</span>
<a href="#l28.8"></a><span id="l28.8"> #include &quot;nsIMsgFolderCacheElement.h&quot;</span>
<a href="#l28.9"></a><span id="l28.9"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l28.10"></a><span id="l28.10"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l28.11"></a><span id="l28.11"> #include &quot;nsIMsgProtocolInfo.h&quot;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l28.13"></a><span id="l28.13"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l28.14"></a><span id="l28.14"> #include &quot;nsIRelativeFilePref.h&quot;</span>
<a href="#l28.15"></a><span id="l28.15"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l28.16"></a><span id="l28.16"> #include &quot;nsIAuthPrompt.h&quot;</span>
<a href="#l28.17"></a><span id="l28.17"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l28.18"></a><span id="l28.18"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l28.19"></a><span id="l28.19"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l28.20"></a><span id="l28.20"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineat">@@ -1870,17 +1871,17 @@ nsMsgIncomingServer::ConfigureTemporaryS</span>
<a href="#l28.22"></a><span id="l28.22">      * We don't want this filter to activate on messages that have</span>
<a href="#l28.23"></a><span id="l28.23">      *  been marked by the user as not spam. This occurs when messages that</span>
<a href="#l28.24"></a><span id="l28.24">      *  were marked as good are moved back into the inbox. But to</span>
<a href="#l28.25"></a><span id="l28.25">      *  do this with a filter, we have to add a boolean term. That requires</span>
<a href="#l28.26"></a><span id="l28.26">      *  that we rewrite the existing filter search terms to group them.</span>
<a href="#l28.27"></a><span id="l28.27">      */</span>
<a href="#l28.28"></a><span id="l28.28"> </span>
<a href="#l28.29"></a><span id="l28.29">     // get the list of search terms from the filter</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineminus">-    nsCOMPtr&lt;nsISupportsArray&gt; searchTerms;</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineplus">+    nsCOMPtr&lt;nsIMutableArray&gt; searchTerms;</span>
<a href="#l28.32"></a><span id="l28.32">     rv = newFilter-&gt;GetSearchTerms(getter_AddRefs(searchTerms));</span>
<a href="#l28.33"></a><span id="l28.33">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.34"></a><span id="l28.34">     uint32_t count = 0;</span>
<a href="#l28.35"></a><span id="l28.35">     searchTerms-&gt;Count(&amp;count);</span>
<a href="#l28.36"></a><span id="l28.36">     if (count &gt; 1) // don't need to group a single term</span>
<a href="#l28.37"></a><span id="l28.37">     {</span>
<a href="#l28.38"></a><span id="l28.38">       // beginGrouping the first term, and endGrouping the last term</span>
<a href="#l28.39"></a><span id="l28.39">       nsCOMPtr&lt;nsIMsgSearchTerm&gt; firstTerm(do_QueryElementAt(searchTerms,</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineat">@@ -1906,17 +1907,17 @@ nsMsgIncomingServer::ConfigureTemporaryS</span>
<a href="#l28.41"></a><span id="l28.41"> </span>
<a href="#l28.42"></a><span id="l28.42">     nsCOMPtr&lt;nsIMsgSearchValue&gt; searchValue;</span>
<a href="#l28.43"></a><span id="l28.43">     searchTerm-&gt;GetValue(getter_AddRefs(searchValue));</span>
<a href="#l28.44"></a><span id="l28.44">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.45"></a><span id="l28.45">     searchValue-&gt;SetAttrib(nsMsgSearchAttrib::JunkScoreOrigin);</span>
<a href="#l28.46"></a><span id="l28.46">     searchValue-&gt;SetStr(NS_LITERAL_STRING(&quot;user&quot;));</span>
<a href="#l28.47"></a><span id="l28.47">     searchTerm-&gt;SetValue(searchValue);</span>
<a href="#l28.48"></a><span id="l28.48"> </span>
<a href="#l28.49"></a><span id="l28.49" class="difflineminus">-    searchTerms-&gt;InsertElementAt(searchTerm, count);</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineplus">+    searchTerms-&gt;InsertElementAt(searchTerm, count, /* weak = */ false);</span>
<a href="#l28.51"></a><span id="l28.51"> </span>
<a href="#l28.52"></a><span id="l28.52">     bool moveOnSpam, markAsReadOnSpam;</span>
<a href="#l28.53"></a><span id="l28.53">     spamSettings-&gt;GetMoveOnSpam(&amp;moveOnSpam);</span>
<a href="#l28.54"></a><span id="l28.54">     if (moveOnSpam)</span>
<a href="#l28.55"></a><span id="l28.55">     {</span>
<a href="#l28.56"></a><span id="l28.56">       nsCString spamFolderURI;</span>
<a href="#l28.57"></a><span id="l28.57">       rv = spamSettings-&gt;GetSpamFolderURI(getter_Copies(spamFolderURI));</span>
<a href="#l28.58"></a><span id="l28.58">       if (NS_SUCCEEDED(rv) &amp;&amp; (!spamFolderURI.IsEmpty()))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -53,24 +53,17 @@</span>
<a href="#l29.4"></a><span id="l29.4"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l29.5"></a><span id="l29.5"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l29.6"></a><span id="l29.6"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l29.7"></a><span id="l29.7"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l29.8"></a><span id="l29.8"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l29.9"></a><span id="l29.9"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l29.10"></a><span id="l29.10"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l29.11"></a><span id="l29.11"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-// classes.</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineminus">-#endif</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l29.21"></a><span id="l29.21"> #include &quot;nsIMsgSearchTerm.h&quot;</span>
<a href="#l29.22"></a><span id="l29.22"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l29.23"></a><span id="l29.23"> #include &quot;nsIAtomService.h&quot;</span>
<a href="#l29.24"></a><span id="l29.24"> #include &quot;nsIStreamListener.h&quot;</span>
<a href="#l29.25"></a><span id="l29.25"> #include &quot;nsReadLine.h&quot;</span>
<a href="#l29.26"></a><span id="l29.26"> #include &quot;nsICharsetDetectionObserver.h&quot;</span>
<a href="#l29.27"></a><span id="l29.27"> #include &quot;nsICharsetDetector.h&quot;</span>
<a href="#l29.28"></a><span id="l29.28"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineat">@@ -2232,20 +2225,20 @@ NS_MSG_BASE nsresult MsgPromptLoginFaile</span>
<a href="#l29.30"></a><span id="l29.30"> </span>
<a href="#l29.31"></a><span id="l29.31"> NS_MSG_BASE PRTime MsgConvertAgeInDaysToCutoffDate(int32_t ageInDays)</span>
<a href="#l29.32"></a><span id="l29.32"> {</span>
<a href="#l29.33"></a><span id="l29.33">   PRTime now = PR_Now();</span>
<a href="#l29.34"></a><span id="l29.34"> </span>
<a href="#l29.35"></a><span id="l29.35">   return now - PR_USEC_PER_DAY * ageInDays;</span>
<a href="#l29.36"></a><span id="l29.36"> }</span>
<a href="#l29.37"></a><span id="l29.37"> </span>
<a href="#l29.38"></a><span id="l29.38" class="difflineminus">-NS_MSG_BASE nsresult MsgTermListToString(nsISupportsArray *aTermList, nsCString &amp;aOutString)</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineplus">+NS_MSG_BASE nsresult MsgTermListToString(nsIArray *aTermList, nsCString &amp;aOutString)</span>
<a href="#l29.40"></a><span id="l29.40"> {</span>
<a href="#l29.41"></a><span id="l29.41">   uint32_t count;</span>
<a href="#l29.42"></a><span id="l29.42" class="difflineminus">-  aTermList-&gt;Count(&amp;count);</span>
<a href="#l29.43"></a><span id="l29.43" class="difflineplus">+  aTermList-&gt;GetLength(&amp;count);</span>
<a href="#l29.44"></a><span id="l29.44">   nsresult rv = NS_OK;</span>
<a href="#l29.45"></a><span id="l29.45"> </span>
<a href="#l29.46"></a><span id="l29.46">   for (uint32_t searchIndex = 0; searchIndex &lt; count;</span>
<a href="#l29.47"></a><span id="l29.47">        searchIndex++)</span>
<a href="#l29.48"></a><span id="l29.48">   {</span>
<a href="#l29.49"></a><span id="l29.49">     nsAutoCString stream;</span>
<a href="#l29.50"></a><span id="l29.50"> </span>
<a href="#l29.51"></a><span id="l29.51">     nsCOMPtr&lt;nsIMsgSearchTerm&gt; term;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -9,24 +9,17 @@</span>
<a href="#l30.4"></a><span id="l30.4"> #include &quot;nsIURL.h&quot;</span>
<a href="#l30.5"></a><span id="l30.5"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l30.6"></a><span id="l30.6"> #include &quot;msgCore.h&quot;</span>
<a href="#l30.7"></a><span id="l30.7"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l30.8"></a><span id="l30.8"> #include &quot;MailNewsTypes2.h&quot;</span>
<a href="#l30.9"></a><span id="l30.9"> #include &quot;nsTArray.h&quot;</span>
<a href="#l30.10"></a><span id="l30.10"> #include &quot;nsInterfaceRequestorAgg.h&quot;</span>
<a href="#l30.11"></a><span id="l30.11"> #include &quot;nsILoadGroup.h&quot;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-// classes.</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineminus">-#endif</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineplus">+#include &quot;nsIArray.h&quot;</span>
<a href="#l30.21"></a><span id="l30.21"> #include &quot;nsIAtom.h&quot;</span>
<a href="#l30.22"></a><span id="l30.22"> #include &quot;nsINetUtil.h&quot;</span>
<a href="#l30.23"></a><span id="l30.23"> #include &quot;nsIRequest.h&quot;</span>
<a href="#l30.24"></a><span id="l30.24"> #include &quot;nsILoadInfo.h&quot;</span>
<a href="#l30.25"></a><span id="l30.25"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l30.26"></a><span id="l30.26"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l30.27"></a><span id="l30.27"> #include &quot;nsIFile.h&quot;</span>
<a href="#l30.28"></a><span id="l30.28"> </span>
<a href="#l30.29"></a><span id="l30.29" class="difflineat">@@ -37,17 +30,16 @@ class nsIMsgFolder;</span>
<a href="#l30.30"></a><span id="l30.30"> class nsIMsgMessageService;</span>
<a href="#l30.31"></a><span id="l30.31"> class nsIUrlListener;</span>
<a href="#l30.32"></a><span id="l30.32"> class nsIOutputStream;</span>
<a href="#l30.33"></a><span id="l30.33"> class nsIInputStream;</span>
<a href="#l30.34"></a><span id="l30.34"> class nsIMsgDatabase;</span>
<a href="#l30.35"></a><span id="l30.35"> class nsIMutableArray;</span>
<a href="#l30.36"></a><span id="l30.36"> class nsIProxyInfo;</span>
<a href="#l30.37"></a><span id="l30.37"> class nsIMsgWindow;</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineminus">-class nsISupportsArray;</span>
<a href="#l30.39"></a><span id="l30.39"> class nsIStreamListener;</span>
<a href="#l30.40"></a><span id="l30.40"> </span>
<a href="#l30.41"></a><span id="l30.41"> #define FILE_IO_BUFFER_SIZE (16*1024)</span>
<a href="#l30.42"></a><span id="l30.42"> #define MSGS_URL    &quot;chrome://messenger/locale/messenger.properties&quot;</span>
<a href="#l30.43"></a><span id="l30.43"> </span>
<a href="#l30.44"></a><span id="l30.44"> //These are utility functions that can used throughout the mailnews code</span>
<a href="#l30.45"></a><span id="l30.45"> </span>
<a href="#l30.46"></a><span id="l30.46"> NS_MSG_BASE nsresult GetMessageServiceContractIDForURI(const char *uri, nsCString &amp;contractID);</span>
<a href="#l30.47"></a><span id="l30.47" class="difflineat">@@ -282,17 +274,17 @@ NS_MSG_BASE PRTime MsgConvertAgeInDaysTo</span>
<a href="#l30.48"></a><span id="l30.48"> </span>
<a href="#l30.49"></a><span id="l30.49"> /**</span>
<a href="#l30.50"></a><span id="l30.50">  * Converts the passed in term list to its string representation.</span>
<a href="#l30.51"></a><span id="l30.51">  *</span>
<a href="#l30.52"></a><span id="l30.52">  * @param      aTermList    Array of nsIMsgSearchTerms</span>
<a href="#l30.53"></a><span id="l30.53">  * @param[out] aOutString   result representation of search terms.</span>
<a href="#l30.54"></a><span id="l30.54">  *</span>
<a href="#l30.55"></a><span id="l30.55">  */</span>
<a href="#l30.56"></a><span id="l30.56" class="difflineminus">-NS_MSG_BASE nsresult MsgTermListToString(nsISupportsArray *aTermList, nsCString &amp;aOutString);</span>
<a href="#l30.57"></a><span id="l30.57" class="difflineplus">+NS_MSG_BASE nsresult MsgTermListToString(nsIArray *aTermList, nsCString &amp;aOutString);</span>
<a href="#l30.58"></a><span id="l30.58"> </span>
<a href="#l30.59"></a><span id="l30.59"> NS_MSG_BASE nsresult</span>
<a href="#l30.60"></a><span id="l30.60"> MsgStreamMsgHeaders(nsIInputStream *aInputStream, nsIStreamListener *aConsumer);</span>
<a href="#l30.61"></a><span id="l30.61"> </span>
<a href="#l30.62"></a><span id="l30.62"> /**</span>
<a href="#l30.63"></a><span id="l30.63">  * convert string to uint64_t</span>
<a href="#l30.64"></a><span id="l30.64">  *</span>
<a href="#l30.65"></a><span id="l30.65">  * @param str conveted string</span>
<a href="#l30.66"></a><span id="l30.66" class="difflineat">@@ -399,18 +391,17 @@ ConvertBufToPlainText(nsString &amp;aConBuf,</span>
<a href="#l30.67"></a><span id="l30.67"> #define CaseInsensitiveFindInReadable(what, str) \</span>
<a href="#l30.68"></a><span id="l30.68">         ((str).Find(what, CaseInsensitiveCompare) != kNotFound)</span>
<a href="#l30.69"></a><span id="l30.69"> #define LossyAppendUTF16toASCII(source, dest) \</span>
<a href="#l30.70"></a><span id="l30.70">         (dest).Append(NS_LossyConvertUTF16toASCII(source))</span>
<a href="#l30.71"></a><span id="l30.71"> #define Last() \</span>
<a href="#l30.72"></a><span id="l30.72">         EndReading()[-1]</span>
<a href="#l30.73"></a><span id="l30.73"> #define SetCharAt(ch, index) \</span>
<a href="#l30.74"></a><span id="l30.74">         Replace(index, 1, ch)</span>
<a href="#l30.75"></a><span id="l30.75" class="difflineminus">-#define NS_NewISupportsArray(result) \</span>
<a href="#l30.76"></a><span id="l30.76" class="difflineminus">-        CallCreateInstance(NS_SUPPORTSARRAY_CONTRACTID, static_cast&lt;nsISupportsArray**&gt;(result))</span>
<a href="#l30.77"></a><span id="l30.77" class="difflineplus">+</span>
<a href="#l30.78"></a><span id="l30.78"> /**</span>
<a href="#l30.79"></a><span id="l30.79">  * The internal and external methods expect the parameters in a different order.</span>
<a href="#l30.80"></a><span id="l30.80">  * The internal API also always expects a flag rather than a comparator.</span>
<a href="#l30.81"></a><span id="l30.81">  */</span>
<a href="#l30.82"></a><span id="l30.82"> inline int32_t MsgFind(nsAString &amp;str, const char *what, bool ignore_case, uint32_t offset)</span>
<a href="#l30.83"></a><span id="l30.83"> {</span>
<a href="#l30.84"></a><span id="l30.84">   return str.Find(what, offset, ignore_case);</span>
<a href="#l30.85"></a><span id="l30.85"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/extensions/mailviews/public/nsIMsgMailView.idl</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/extensions/mailviews/public/nsIMsgMailView.idl</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -1,35 +1,25 @@</span>
<a href="#l31.4"></a><span id="l31.4"> /* -*- Mode: IDL; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l31.5"></a><span id="l31.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l31.6"></a><span id="l31.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l31.7"></a><span id="l31.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l31.8"></a><span id="l31.8"> </span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l31.11"></a><span id="l31.11" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-// classes.</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-%{C++</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineminus">-#endif</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineminus">-%}</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineminus">-interface nsISupportsArray;</span>
<a href="#l31.21"></a><span id="l31.21"> </span>
<a href="#l31.22"></a><span id="l31.22" class="difflineplus">+interface nsIMutableArray;</span>
<a href="#l31.23"></a><span id="l31.23"> interface nsIMsgSearchTerm;</span>
<a href="#l31.24"></a><span id="l31.24"> </span>
<a href="#l31.25"></a><span id="l31.25"> [scriptable, uuid(28AC84DF-CBE5-430d-A5C0-4FA63B5424DF)]</span>
<a href="#l31.26"></a><span id="l31.26"> interface nsIMsgMailView : nsISupports {</span>
<a href="#l31.27"></a><span id="l31.27">     attribute wstring mailViewName;</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineminus">-	readonly attribute wstring prettyName; // localized pretty name</span>
<a href="#l31.29"></a><span id="l31.29" class="difflineplus">+    readonly attribute wstring prettyName; // localized pretty name</span>
<a href="#l31.30"></a><span id="l31.30"> </span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-    // the array of search terms </span>
<a href="#l31.32"></a><span id="l31.32" class="difflineminus">-    attribute nsISupportsArray searchTerms;</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineplus">+    // the array of search terms</span>
<a href="#l31.34"></a><span id="l31.34" class="difflineplus">+    attribute nsIMutableArray searchTerms;</span>
<a href="#l31.35"></a><span id="l31.35"> </span>
<a href="#l31.36"></a><span id="l31.36">     // these two helper methods are required to allow searchTermsOverlay.js to</span>
<a href="#l31.37"></a><span id="l31.37">     // manipulate a mail view without knowing it is dealing with a mail view. nsIMsgFilter</span>
<a href="#l31.38"></a><span id="l31.38">     // and nsIMsgSearchSession have the same two methods....we should probably make an interface around them.</span>
<a href="#l31.39"></a><span id="l31.39" class="difflineminus">-	void appendTerm(in nsIMsgSearchTerm term);</span>
<a href="#l31.40"></a><span id="l31.40" class="difflineminus">-	nsIMsgSearchTerm createTerm();</span>
<a href="#l31.41"></a><span id="l31.41" class="difflineminus">-</span>
<a href="#l31.42"></a><span id="l31.42" class="difflineplus">+    void appendTerm(in nsIMsgSearchTerm term);</span>
<a href="#l31.43"></a><span id="l31.43" class="difflineplus">+    nsIMsgSearchTerm createTerm();</span>
<a href="#l31.44"></a><span id="l31.44"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -1,43 +1,39 @@</span>
<a href="#l32.4"></a><span id="l32.4"> /* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l32.5"></a><span id="l32.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l32.6"></a><span id="l32.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l32.7"></a><span id="l32.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l32.8"></a><span id="l32.8"> </span>
<a href="#l32.9"></a><span id="l32.9"> #include &quot;nsMsgMailViewList.h&quot;</span>
<a href="#l32.10"></a><span id="l32.10" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l32.11"></a><span id="l32.11" class="difflineminus">-// classes.</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineminus">-#endif</span>
<a href="#l32.17"></a><span id="l32.17" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l32.18"></a><span id="l32.18" class="difflineplus">+#include &quot;nsArray.h&quot;</span>
<a href="#l32.19"></a><span id="l32.19" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l32.20"></a><span id="l32.20"> #include &quot;nsIFileChannel.h&quot;</span>
<a href="#l32.21"></a><span id="l32.21"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l32.22"></a><span id="l32.22"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l32.23"></a><span id="l32.23"> #include &quot;nsIMsgSearchTerm.h&quot;</span>
<a href="#l32.24"></a><span id="l32.24"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l32.25"></a><span id="l32.25"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l32.26"></a><span id="l32.26"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l32.27"></a><span id="l32.27"> #include &quot;nsIFile.h&quot;</span>
<a href="#l32.28"></a><span id="l32.28"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l32.29"></a><span id="l32.29"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l32.30"></a><span id="l32.30"> #include &quot;nsIMsgFilter.h&quot;</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineplus">+#include &quot;nsArrayUtils.h&quot;</span>
<a href="#l32.32"></a><span id="l32.32"> </span>
<a href="#l32.33"></a><span id="l32.33"> #define kDefaultViewPeopleIKnow &quot;People I Know&quot;</span>
<a href="#l32.34"></a><span id="l32.34"> #define kDefaultViewRecent &quot;Recent Mail&quot;</span>
<a href="#l32.35"></a><span id="l32.35"> #define kDefaultViewFiveDays &quot;Last 5 Days&quot;</span>
<a href="#l32.36"></a><span id="l32.36"> #define kDefaultViewNotJunk &quot;Not Junk&quot;</span>
<a href="#l32.37"></a><span id="l32.37"> #define kDefaultViewHasAttachments &quot;Has Attachments&quot;</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineminus">- </span>
<a href="#l32.39"></a><span id="l32.39" class="difflineplus">+</span>
<a href="#l32.40"></a><span id="l32.40"> nsMsgMailView::nsMsgMailView()</span>
<a href="#l32.41"></a><span id="l32.41"> {</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineminus">-    mViewSearchTerms = do_CreateInstance(NS_SUPPORTSARRAY_CONTRACTID);</span>
<a href="#l32.43"></a><span id="l32.43" class="difflineplus">+    mViewSearchTerms = nsArray::Create();</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineplus">+    NS_ASSERTION(mViewSearchTerms, &quot;Failed to allocate a nsIMutableArray for mViewSearchTerms&quot;);</span>
<a href="#l32.45"></a><span id="l32.45"> }</span>
<a href="#l32.46"></a><span id="l32.46"> </span>
<a href="#l32.47"></a><span id="l32.47"> NS_IMPL_ADDREF(nsMsgMailView)</span>
<a href="#l32.48"></a><span id="l32.48"> NS_IMPL_RELEASE(nsMsgMailView)</span>
<a href="#l32.49"></a><span id="l32.49"> NS_IMPL_QUERY_INTERFACE(nsMsgMailView, nsIMsgMailView)</span>
<a href="#l32.50"></a><span id="l32.50"> </span>
<a href="#l32.51"></a><span id="l32.51"> nsMsgMailView::~nsMsgMailView()</span>
<a href="#l32.52"></a><span id="l32.52"> {</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineat">@@ -88,34 +84,34 @@ NS_IMETHODIMP nsMsgMailView::GetPrettyNa</span>
<a href="#l32.54"></a><span id="l32.54">     else if (mName.EqualsLiteral(kDefaultViewHasAttachments))</span>
<a href="#l32.55"></a><span id="l32.55">         rv = mBundle-&gt;GetStringFromName(u&quot;mailViewHasAttachments&quot;, aMailViewName);</span>
<a href="#l32.56"></a><span id="l32.56">     else</span>
<a href="#l32.57"></a><span id="l32.57">         *aMailViewName = ToNewUnicode(mName);</span>
<a href="#l32.58"></a><span id="l32.58"> </span>
<a href="#l32.59"></a><span id="l32.59">     return rv;</span>
<a href="#l32.60"></a><span id="l32.60"> }</span>
<a href="#l32.61"></a><span id="l32.61"> </span>
<a href="#l32.62"></a><span id="l32.62" class="difflineminus">-NS_IMETHODIMP nsMsgMailView::GetSearchTerms(nsISupportsArray ** aSearchTerms)</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineplus">+NS_IMETHODIMP nsMsgMailView::GetSearchTerms(nsIMutableArray **aSearchTerms)</span>
<a href="#l32.64"></a><span id="l32.64"> {</span>
<a href="#l32.65"></a><span id="l32.65">     NS_ENSURE_ARG_POINTER(aSearchTerms);</span>
<a href="#l32.66"></a><span id="l32.66">     NS_IF_ADDREF(*aSearchTerms = mViewSearchTerms);</span>
<a href="#l32.67"></a><span id="l32.67">     return NS_OK;</span>
<a href="#l32.68"></a><span id="l32.68"> }</span>
<a href="#l32.69"></a><span id="l32.69"> </span>
<a href="#l32.70"></a><span id="l32.70" class="difflineminus">-NS_IMETHODIMP nsMsgMailView::SetSearchTerms(nsISupportsArray * aSearchTerms)</span>
<a href="#l32.71"></a><span id="l32.71" class="difflineplus">+NS_IMETHODIMP nsMsgMailView::SetSearchTerms(nsIMutableArray *aSearchTerms)</span>
<a href="#l32.72"></a><span id="l32.72"> {</span>
<a href="#l32.73"></a><span id="l32.73">     mViewSearchTerms = aSearchTerms;</span>
<a href="#l32.74"></a><span id="l32.74">     return NS_OK;</span>
<a href="#l32.75"></a><span id="l32.75"> }</span>
<a href="#l32.76"></a><span id="l32.76"> </span>
<a href="#l32.77"></a><span id="l32.77" class="difflineminus">-NS_IMETHODIMP nsMsgMailView::AppendTerm(nsIMsgSearchTerm * aTerm)</span>
<a href="#l32.78"></a><span id="l32.78" class="difflineplus">+NS_IMETHODIMP nsMsgMailView::AppendTerm(nsIMsgSearchTerm *aTerm)</span>
<a href="#l32.79"></a><span id="l32.79"> {</span>
<a href="#l32.80"></a><span id="l32.80">     NS_ENSURE_TRUE(aTerm, NS_ERROR_NULL_POINTER);</span>
<a href="#l32.81"></a><span id="l32.81" class="difflineminus">-    </span>
<a href="#l32.82"></a><span id="l32.82" class="difflineminus">-    return mViewSearchTerms-&gt;AppendElement(static_cast&lt;nsISupports*&gt;(aTerm));</span>
<a href="#l32.83"></a><span id="l32.83" class="difflineplus">+</span>
<a href="#l32.84"></a><span id="l32.84" class="difflineplus">+    return mViewSearchTerms-&gt;AppendElement(aTerm, /* weak */ false);</span>
<a href="#l32.85"></a><span id="l32.85"> }</span>
<a href="#l32.86"></a><span id="l32.86"> </span>
<a href="#l32.87"></a><span id="l32.87"> NS_IMETHODIMP nsMsgMailView::CreateTerm(nsIMsgSearchTerm **aResult)</span>
<a href="#l32.88"></a><span id="l32.88"> {</span>
<a href="#l32.89"></a><span id="l32.89">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l32.90"></a><span id="l32.90">     nsCOMPtr&lt;nsIMsgSearchTerm&gt; searchTerm = do_CreateInstance(&quot;@mozilla.org/messenger/searchTerm;1&quot;);</span>
<a href="#l32.91"></a><span id="l32.91">     NS_IF_ADDREF(*aResult = searchTerm);</span>
<a href="#l32.92"></a><span id="l32.92">     return NS_OK;</span>
<a href="#l32.93"></a><span id="l32.93" class="difflineat">@@ -217,17 +213,17 @@ nsresult nsMsgMailViewList::ConvertMailV</span>
<a href="#l32.94"></a><span id="l32.94">       GetMailViewAt(index, getter_AddRefs(mailView));</span>
<a href="#l32.95"></a><span id="l32.95">       if (!mailView)</span>
<a href="#l32.96"></a><span id="l32.96">           continue;</span>
<a href="#l32.97"></a><span id="l32.97">       mailView-&gt;GetMailViewName(getter_Copies(mailViewName));</span>
<a href="#l32.98"></a><span id="l32.98">       mFilterList-&gt;CreateFilter(mailViewName, getter_AddRefs(newMailFilter));</span>
<a href="#l32.99"></a><span id="l32.99">       if (!newMailFilter)</span>
<a href="#l32.100"></a><span id="l32.100">           continue;</span>
<a href="#l32.101"></a><span id="l32.101"> </span>
<a href="#l32.102"></a><span id="l32.102" class="difflineminus">-      nsCOMPtr&lt;nsISupportsArray&gt; searchTerms;</span>
<a href="#l32.103"></a><span id="l32.103" class="difflineplus">+      nsCOMPtr&lt;nsIMutableArray&gt; searchTerms;</span>
<a href="#l32.104"></a><span id="l32.104">       mailView-&gt;GetSearchTerms(getter_AddRefs(searchTerms));</span>
<a href="#l32.105"></a><span id="l32.105">       newMailFilter-&gt;SetSearchTerms(searchTerms);</span>
<a href="#l32.106"></a><span id="l32.106">       mFilterList-&gt;InsertFilterAt(index, newMailFilter);</span>
<a href="#l32.107"></a><span id="l32.107">   }</span>
<a href="#l32.108"></a><span id="l32.108"> </span>
<a href="#l32.109"></a><span id="l32.109">   return NS_OK;</span>
<a href="#l32.110"></a><span id="l32.110"> }</span>
<a href="#l32.111"></a><span id="l32.111"> </span>
<a href="#l32.112"></a><span id="l32.112" class="difflineat">@@ -293,17 +289,17 @@ nsresult nsMsgMailViewList::ConvertFilte</span>
<a href="#l32.113"></a><span id="l32.113">         nsCOMPtr&lt;nsIMsgMailView&gt; newMailView;</span>
<a href="#l32.114"></a><span id="l32.114">         rv = CreateMailView(getter_AddRefs(newMailView));</span>
<a href="#l32.115"></a><span id="l32.115">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l32.116"></a><span id="l32.116"> </span>
<a href="#l32.117"></a><span id="l32.117">         nsString filterName;</span>
<a href="#l32.118"></a><span id="l32.118">         msgFilter-&gt;GetFilterName(filterName);</span>
<a href="#l32.119"></a><span id="l32.119">         newMailView-&gt;SetMailViewName(filterName.get());</span>
<a href="#l32.120"></a><span id="l32.120"> </span>
<a href="#l32.121"></a><span id="l32.121" class="difflineminus">-        nsCOMPtr&lt;nsISupportsArray&gt; filterSearchTerms;</span>
<a href="#l32.122"></a><span id="l32.122" class="difflineplus">+        nsCOMPtr&lt;nsIMutableArray&gt; filterSearchTerms;</span>
<a href="#l32.123"></a><span id="l32.123">         rv = msgFilter-&gt;GetSearchTerms(getter_AddRefs(filterSearchTerms));</span>
<a href="#l32.124"></a><span id="l32.124">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l32.125"></a><span id="l32.125">         rv = newMailView-&gt;SetSearchTerms(filterSearchTerms);</span>
<a href="#l32.126"></a><span id="l32.126">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l32.127"></a><span id="l32.127"> </span>
<a href="#l32.128"></a><span id="l32.128">         // now append this new mail view to our global list view</span>
<a href="#l32.129"></a><span id="l32.129">         m_mailViews.AppendElement(newMailView);</span>
<a href="#l32.130"></a><span id="l32.130">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/extensions/mailviews/src/nsMsgMailViewList.h</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/extensions/mailviews/src/nsMsgMailViewList.h</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -6,24 +6,17 @@</span>
<a href="#l33.4"></a><span id="l33.4"> </span>
<a href="#l33.5"></a><span id="l33.5"> #ifndef _nsMsgMailViewList_H_</span>
<a href="#l33.6"></a><span id="l33.6"> #define _nsMsgMailViewList_H_</span>
<a href="#l33.7"></a><span id="l33.7"> </span>
<a href="#l33.8"></a><span id="l33.8"> #include &quot;nscore.h&quot;</span>
<a href="#l33.9"></a><span id="l33.9"> #include &quot;nsIMsgMailViewList.h&quot;</span>
<a href="#l33.10"></a><span id="l33.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l33.11"></a><span id="l33.11"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineminus">-// classes.</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineminus">-#endif</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l33.20"></a><span id="l33.20" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l33.21"></a><span id="l33.21"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l33.22"></a><span id="l33.22"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l33.23"></a><span id="l33.23"> #include &quot;nsIMsgFilterList.h&quot;</span>
<a href="#l33.24"></a><span id="l33.24"> </span>
<a href="#l33.25"></a><span id="l33.25"> // a mail View is just a name and an array of search terms</span>
<a href="#l33.26"></a><span id="l33.26"> class nsMsgMailView : public nsIMsgMailView</span>
<a href="#l33.27"></a><span id="l33.27"> {</span>
<a href="#l33.28"></a><span id="l33.28"> public:</span>
<a href="#l33.29"></a><span id="l33.29" class="difflineat">@@ -31,17 +24,17 @@ public:</span>
<a href="#l33.30"></a><span id="l33.30">   NS_DECL_NSIMSGMAILVIEW</span>
<a href="#l33.31"></a><span id="l33.31"> </span>
<a href="#l33.32"></a><span id="l33.32">   nsMsgMailView();</span>
<a href="#l33.33"></a><span id="l33.33"> </span>
<a href="#l33.34"></a><span id="l33.34"> protected:</span>
<a href="#l33.35"></a><span id="l33.35">   virtual ~nsMsgMailView();</span>
<a href="#l33.36"></a><span id="l33.36">   nsString mName;</span>
<a href="#l33.37"></a><span id="l33.37">   nsCOMPtr&lt;nsIStringBundle&gt; mBundle;</span>
<a href="#l33.38"></a><span id="l33.38" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; mViewSearchTerms;</span>
<a href="#l33.39"></a><span id="l33.39" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; mViewSearchTerms;</span>
<a href="#l33.40"></a><span id="l33.40"> };</span>
<a href="#l33.41"></a><span id="l33.41"> </span>
<a href="#l33.42"></a><span id="l33.42"> </span>
<a href="#l33.43"></a><span id="l33.43"> class nsMsgMailViewList : public nsIMsgMailViewList</span>
<a href="#l33.44"></a><span id="l33.44"> {</span>
<a href="#l33.45"></a><span id="l33.45"> public:</span>
<a href="#l33.46"></a><span id="l33.46">   NS_DECL_ISUPPORTS</span>
<a href="#l33.47"></a><span id="l33.47">   NS_DECL_NSIMSGMAILVIEWLIST</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -686,17 +686,17 @@ NS_IMETHODIMP nsImapMailFolder::UpdateFo</span>
<a href="#l34.4"></a><span id="l34.4">         nsMsgFilterTypeType filterType;</span>
<a href="#l34.5"></a><span id="l34.5">         filter-&gt;GetFilterType(&amp;filterType);</span>
<a href="#l34.6"></a><span id="l34.6">         if (!(filterType &amp; nsMsgFilterType::Incoming))</span>
<a href="#l34.7"></a><span id="l34.7">           continue;</span>
<a href="#l34.8"></a><span id="l34.8">         bool enabled = false;</span>
<a href="#l34.9"></a><span id="l34.9">         filter-&gt;GetEnabled(&amp;enabled);</span>
<a href="#l34.10"></a><span id="l34.10">         if (!enabled)</span>
<a href="#l34.11"></a><span id="l34.11">           continue;</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-        nsCOMPtr&lt;nsISupportsArray&gt; searchTerms;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+        nsCOMPtr&lt;nsIMutableArray&gt; searchTerms;</span>
<a href="#l34.14"></a><span id="l34.14">         uint32_t numSearchTerms = 0;</span>
<a href="#l34.15"></a><span id="l34.15">         filter-&gt;GetSearchTerms(getter_AddRefs(searchTerms));</span>
<a href="#l34.16"></a><span id="l34.16">         if (searchTerms)</span>
<a href="#l34.17"></a><span id="l34.17">           searchTerms-&gt;Count(&amp;numSearchTerms);</span>
<a href="#l34.18"></a><span id="l34.18">         for (uint32_t termIndex = 0;</span>
<a href="#l34.19"></a><span id="l34.19">              termIndex &lt; numSearchTerms &amp;&amp; !m_filterListRequiresBody;</span>
<a href="#l34.20"></a><span id="l34.20">              termIndex++)</span>
<a href="#l34.21"></a><span id="l34.21">         {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/suite/mailnews/commandglue.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/suite/mailnews/commandglue.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -875,17 +875,17 @@ function RemoveMailOfflineObserver()</span>
<a href="#l35.4"></a><span id="l35.4"> </span>
<a href="#l35.5"></a><span id="l35.5"> function getSearchTermString(searchTerms)</span>
<a href="#l35.6"></a><span id="l35.6"> {</span>
<a href="#l35.7"></a><span id="l35.7">   var searchIndex;</span>
<a href="#l35.8"></a><span id="l35.8">   var condition = &quot;&quot;;</span>
<a href="#l35.9"></a><span id="l35.9">   var count = searchTerms.Count();</span>
<a href="#l35.10"></a><span id="l35.10">   for (searchIndex = 0; searchIndex &lt; count; )</span>
<a href="#l35.11"></a><span id="l35.11">   {</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-    var term = searchTerms.QueryElementAt(searchIndex++, Components.interfaces.nsIMsgSearchTerm);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+    var term = searchTerms.queryElementAt(searchIndex++, Components.interfaces.nsIMsgSearchTerm);</span>
<a href="#l35.14"></a><span id="l35.14"> </span>
<a href="#l35.15"></a><span id="l35.15">     if (condition.length &gt; 1)</span>
<a href="#l35.16"></a><span id="l35.16">       condition += ' ';</span>
<a href="#l35.17"></a><span id="l35.17"> </span>
<a href="#l35.18"></a><span id="l35.18">     if (term.matchAll)</span>
<a href="#l35.19"></a><span id="l35.19">     {</span>
<a href="#l35.20"></a><span id="l35.20">         condition = &quot;ALL&quot;;</span>
<a href="#l35.21"></a><span id="l35.21">         break;</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -973,36 +973,43 @@ function setupXFVirtualFolderSearch(fold</span>
<a href="#l35.23"></a><span id="l35.23"> </span>
<a href="#l35.24"></a><span id="l35.24">   for (i in folderUrisToSearch)</span>
<a href="#l35.25"></a><span id="l35.25">     {</span>
<a href="#l35.26"></a><span id="l35.26">       let realFolder = GetMsgFolderFromUri(folderUrisToSearch[i]);</span>
<a href="#l35.27"></a><span id="l35.27">       if (!realFolder.isServer)</span>
<a href="#l35.28"></a><span id="l35.28">         gSearchSession.addScopeTerm(!searchOnline ? nsMsgSearchScope.offlineMail : GetScopeForFolder(realFolder), realFolder);</span>
<a href="#l35.29"></a><span id="l35.29">     }</span>
<a href="#l35.30"></a><span id="l35.30"> </span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-    var termsArray = searchTerms.QueryInterface(Components.interfaces.nsISupportsArray);</span>
<a href="#l35.32"></a><span id="l35.32">     const nsIMsgSearchTerm = Components.interfaces.nsIMsgSearchTerm;</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineminus">-    for (let term in fixIterator(termsArray, nsIMsgSearchTerm)) {</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineplus">+    for (let term of fixIterator(searchTerms, nsIMsgSearchTerm)) {</span>
<a href="#l35.35"></a><span id="l35.35">       gSearchSession.appendTerm(term);</span>
<a href="#l35.36"></a><span id="l35.36">     }</span>
<a href="#l35.37"></a><span id="l35.37"> }</span>
<a href="#l35.38"></a><span id="l35.38"> </span>
<a href="#l35.39"></a><span id="l35.39" class="difflineplus">+/**</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineplus">+ * Uses an array of search terms to produce a new list usable from quick search.</span>
<a href="#l35.41"></a><span id="l35.41" class="difflineplus">+ *</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineplus">+ * @param searchTermsArray  A nsIArray of terms to copy.</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineplus">+ *</span>
<a href="#l35.44"></a><span id="l35.44" class="difflineplus">+ * @return nsIMutableArray of search terms</span>
<a href="#l35.45"></a><span id="l35.45" class="difflineplus">+ */</span>
<a href="#l35.46"></a><span id="l35.46"> function CreateGroupedSearchTerms(searchTermsArray)</span>
<a href="#l35.47"></a><span id="l35.47"> {</span>
<a href="#l35.48"></a><span id="l35.48"> </span>
<a href="#l35.49"></a><span id="l35.49">   var searchSession = gSearchSession ||</span>
<a href="#l35.50"></a><span id="l35.50">     Components.classes[searchSessionContractID].createInstance(Components.interfaces.nsIMsgSearchSession);</span>
<a href="#l35.51"></a><span id="l35.51"> </span>
<a href="#l35.52"></a><span id="l35.52" class="difflineminus">-  // create a temporary isupports array to store our search terms</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineminus">-  // since we will be modifying the terms so they work with quick search</span>
<a href="#l35.54"></a><span id="l35.54" class="difflineminus">-  var searchTermsArrayForQS = Components.classes[&quot;@mozilla.org/supports-array;1&quot;].createInstance(Components.interfaces.nsISupportsArray);</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineplus">+  // Create a temporary nsIMutableArray to store our search terms</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineplus">+  // since we will be modifying the terms so they work with quick search.</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineplus">+  var searchTermsArrayForQS = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineplus">+                                        .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l35.59"></a><span id="l35.59"> </span>
<a href="#l35.60"></a><span id="l35.60" class="difflineminus">-  var numEntries = searchTermsArray.Count();</span>
<a href="#l35.61"></a><span id="l35.61" class="difflineminus">-  for (var i = 0; i &lt; numEntries; i++) {</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineminus">-    var searchTerm = searchTermsArray.GetElementAt(i).QueryInterface(Components.interfaces.nsIMsgSearchTerm);</span>
<a href="#l35.63"></a><span id="l35.63" class="difflineplus">+  var numEntries = searchTermsArray.length;</span>
<a href="#l35.64"></a><span id="l35.64" class="difflineplus">+  for (let i = 0; i &lt; numEntries; i++) {</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineplus">+    let searchTerm = searchTermsArray.queryElementAt(i, Components.interfaces.nsIMsgSearchTerm);</span>
<a href="#l35.66"></a><span id="l35.66"> </span>
<a href="#l35.67"></a><span id="l35.67">     // clone the term, since we might be modifying it</span>
<a href="#l35.68"></a><span id="l35.68">     var searchTermForQS = searchSession.createTerm();</span>
<a href="#l35.69"></a><span id="l35.69">     searchTermForQS.value = searchTerm.value;</span>
<a href="#l35.70"></a><span id="l35.70">     searchTermForQS.attrib = searchTerm.attrib;</span>
<a href="#l35.71"></a><span id="l35.71">     searchTermForQS.arbitraryHeader = searchTerm.arbitraryHeader</span>
<a href="#l35.72"></a><span id="l35.72">     searchTermForQS.hdrProperty = searchTerm.hdrProperty;</span>
<a href="#l35.73"></a><span id="l35.73">     searchTermForQS.customId = searchTerm.customId</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineat">@@ -1012,17 +1019,17 @@ function CreateGroupedSearchTerms(search</span>
<a href="#l35.75"></a><span id="l35.75">     if (i == 0)</span>
<a href="#l35.76"></a><span id="l35.76">       searchTermForQS.beginsGrouping = true;</span>
<a href="#l35.77"></a><span id="l35.77">     else if (i == numEntries - 1)</span>
<a href="#l35.78"></a><span id="l35.78">       searchTermForQS.endsGrouping = true;</span>
<a href="#l35.79"></a><span id="l35.79"> </span>
<a href="#l35.80"></a><span id="l35.80">     // turn the first term to true to work with quick search...</span>
<a href="#l35.81"></a><span id="l35.81">     searchTermForQS.booleanAnd = i ? searchTerm.booleanAnd : true;</span>
<a href="#l35.82"></a><span id="l35.82"> </span>
<a href="#l35.83"></a><span id="l35.83" class="difflineminus">-    searchTermsArrayForQS.AppendElement(searchTermForQS);</span>
<a href="#l35.84"></a><span id="l35.84" class="difflineplus">+    searchTermsArrayForQS.appendElement(searchTermForQS, /* weak = */ false);</span>
<a href="#l35.85"></a><span id="l35.85">   }</span>
<a href="#l35.86"></a><span id="l35.86">   return searchTermsArrayForQS;</span>
<a href="#l35.87"></a><span id="l35.87"> }</span>
<a href="#l35.88"></a><span id="l35.88"> </span>
<a href="#l35.89"></a><span id="l35.89"> function OnLeavingFolder(aFolder)</span>
<a href="#l35.90"></a><span id="l35.90"> {</span>
<a href="#l35.91"></a><span id="l35.91">   try</span>
<a href="#l35.92"></a><span id="l35.92">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/suite/mailnews/msgViewPickerOverlay.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/suite/mailnews/msgViewPickerOverlay.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -205,101 +205,97 @@ function LoadCustomMailView(index)</span>
<a href="#l36.4"></a><span id="l36.4"> }</span>
<a href="#l36.5"></a><span id="l36.5"> </span>
<a href="#l36.6"></a><span id="l36.6"> </span>
<a href="#l36.7"></a><span id="l36.7"> function ViewTagKeyword(keyword)</span>
<a href="#l36.8"></a><span id="l36.8"> {</span>
<a href="#l36.9"></a><span id="l36.9">   PrepareForViewChange();</span>
<a href="#l36.10"></a><span id="l36.10"> </span>
<a href="#l36.11"></a><span id="l36.11">   // create an i supports array to store our search terms</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  var searchTermsArray = Components.classes[&quot;@mozilla.org/supports-array;1&quot;]</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-                                   .createInstance(Components.interfaces.nsISupportsArray);</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineplus">+  var searchTermsArray = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+                                   .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l36.16"></a><span id="l36.16">   var term = gSearchSession.createTerm();</span>
<a href="#l36.17"></a><span id="l36.17">   var value = term.value;</span>
<a href="#l36.18"></a><span id="l36.18"> </span>
<a href="#l36.19"></a><span id="l36.19">   value.str = keyword;</span>
<a href="#l36.20"></a><span id="l36.20">   value.attrib = nsMsgSearchAttrib.Keywords;</span>
<a href="#l36.21"></a><span id="l36.21">   term.value = value;</span>
<a href="#l36.22"></a><span id="l36.22">   term.attrib = nsMsgSearchAttrib.Keywords;</span>
<a href="#l36.23"></a><span id="l36.23">   term.op = nsMsgSearchOp.Contains;</span>
<a href="#l36.24"></a><span id="l36.24">   term.booleanAnd = true;</span>
<a href="#l36.25"></a><span id="l36.25"> </span>
<a href="#l36.26"></a><span id="l36.26" class="difflineminus">-  searchTermsArray.AppendElement(term);</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineplus">+  searchTermsArray.appendElement(term, /* weak = */ false);</span>
<a href="#l36.28"></a><span id="l36.28">   AddVirtualFolderTerms(searchTermsArray);</span>
<a href="#l36.29"></a><span id="l36.29">   createSearchTermsWithList(searchTermsArray);</span>
<a href="#l36.30"></a><span id="l36.30">   gDefaultSearchViewTerms = searchTermsArray;</span>
<a href="#l36.31"></a><span id="l36.31"> }</span>
<a href="#l36.32"></a><span id="l36.32"> </span>
<a href="#l36.33"></a><span id="l36.33"> </span>
<a href="#l36.34"></a><span id="l36.34"> function ViewNewMail()</span>
<a href="#l36.35"></a><span id="l36.35"> {</span>
<a href="#l36.36"></a><span id="l36.36">   PrepareForViewChange();</span>
<a href="#l36.37"></a><span id="l36.37"> </span>
<a href="#l36.38"></a><span id="l36.38">   // create an i supports array to store our search terms</span>
<a href="#l36.39"></a><span id="l36.39" class="difflineminus">-  var searchTermsArray = Components.classes[&quot;@mozilla.org/supports-array;1&quot;]</span>
<a href="#l36.40"></a><span id="l36.40" class="difflineminus">-                                   .createInstance(Components.interfaces.nsISupportsArray);</span>
<a href="#l36.41"></a><span id="l36.41" class="difflineplus">+  var searchTermsArray = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineplus">+                                   .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l36.43"></a><span id="l36.43">   var term = gSearchSession.createTerm();</span>
<a href="#l36.44"></a><span id="l36.44">   var value = term.value;</span>
<a href="#l36.45"></a><span id="l36.45"> </span>
<a href="#l36.46"></a><span id="l36.46">   value.status = 1;</span>
<a href="#l36.47"></a><span id="l36.47">   value.attrib = nsMsgSearchAttrib.MsgStatus;</span>
<a href="#l36.48"></a><span id="l36.48">   term.value = value;</span>
<a href="#l36.49"></a><span id="l36.49">   term.attrib = nsMsgSearchAttrib.MsgStatus;</span>
<a href="#l36.50"></a><span id="l36.50">   term.op = nsMsgSearchOp.Isnt;</span>
<a href="#l36.51"></a><span id="l36.51">   term.booleanAnd = true;</span>
<a href="#l36.52"></a><span id="l36.52" class="difflineminus">-  searchTermsArray.AppendElement(term);</span>
<a href="#l36.53"></a><span id="l36.53" class="difflineplus">+  searchTermsArray.appendElement(term, /* weak = */ false);</span>
<a href="#l36.54"></a><span id="l36.54"> </span>
<a href="#l36.55"></a><span id="l36.55">   AddVirtualFolderTerms(searchTermsArray);</span>
<a href="#l36.56"></a><span id="l36.56"> </span>
<a href="#l36.57"></a><span id="l36.57">   createSearchTermsWithList(searchTermsArray);</span>
<a href="#l36.58"></a><span id="l36.58">   // not quite right - these want to be just the view terms...but it might not matter.</span>
<a href="#l36.59"></a><span id="l36.59">   gDefaultSearchViewTerms = searchTermsArray;</span>
<a href="#l36.60"></a><span id="l36.60"> }</span>
<a href="#l36.61"></a><span id="l36.61"> </span>
<a href="#l36.62"></a><span id="l36.62"> </span>
<a href="#l36.63"></a><span id="l36.63"> function ViewNotDeletedMail()</span>
<a href="#l36.64"></a><span id="l36.64"> {</span>
<a href="#l36.65"></a><span id="l36.65">   PrepareForViewChange();</span>
<a href="#l36.66"></a><span id="l36.66"> </span>
<a href="#l36.67"></a><span id="l36.67">   // create an i supports array to store our search terms</span>
<a href="#l36.68"></a><span id="l36.68" class="difflineminus">-  var searchTermsArray = Components.classes[&quot;@mozilla.org/supports-array;1&quot;]</span>
<a href="#l36.69"></a><span id="l36.69" class="difflineminus">-                                   .createInstance(Components.interfaces.nsISupportsArray);</span>
<a href="#l36.70"></a><span id="l36.70" class="difflineplus">+  var searchTermsArray = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l36.71"></a><span id="l36.71" class="difflineplus">+                                   .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l36.72"></a><span id="l36.72">   var term = gSearchSession.createTerm();</span>
<a href="#l36.73"></a><span id="l36.73">   var value = term.value;</span>
<a href="#l36.74"></a><span id="l36.74"> </span>
<a href="#l36.75"></a><span id="l36.75">   value.status = 0x00200000;</span>
<a href="#l36.76"></a><span id="l36.76">   value.attrib = nsMsgSearchAttrib.MsgStatus;</span>
<a href="#l36.77"></a><span id="l36.77">   term.value = value;</span>
<a href="#l36.78"></a><span id="l36.78">   term.attrib = nsMsgSearchAttrib.MsgStatus;</span>
<a href="#l36.79"></a><span id="l36.79">   term.op = nsMsgSearchOp.Isnt;</span>
<a href="#l36.80"></a><span id="l36.80">   term.booleanAnd = true;</span>
<a href="#l36.81"></a><span id="l36.81" class="difflineminus">-  searchTermsArray.AppendElement(term);</span>
<a href="#l36.82"></a><span id="l36.82" class="difflineplus">+  searchTermsArray.appendElement(term, /* weak = */ false);</span>
<a href="#l36.83"></a><span id="l36.83"> </span>
<a href="#l36.84"></a><span id="l36.84">   AddVirtualFolderTerms(searchTermsArray);</span>
<a href="#l36.85"></a><span id="l36.85"> </span>
<a href="#l36.86"></a><span id="l36.86">   createSearchTermsWithList(searchTermsArray);</span>
<a href="#l36.87"></a><span id="l36.87">   // not quite right - these want to be just the view terms...but it might not matter.</span>
<a href="#l36.88"></a><span id="l36.88">   gDefaultSearchViewTerms = searchTermsArray;</span>
<a href="#l36.89"></a><span id="l36.89"> }</span>
<a href="#l36.90"></a><span id="l36.90"> </span>
<a href="#l36.91"></a><span id="l36.91"> </span>
<a href="#l36.92"></a><span id="l36.92"> function AddVirtualFolderTerms(searchTermsArray)</span>
<a href="#l36.93"></a><span id="l36.93"> {</span>
<a href="#l36.94"></a><span id="l36.94">   // add in any virtual folder terms</span>
<a href="#l36.95"></a><span id="l36.95">   var virtualFolderSearchTerms = (gVirtualFolderTerms || gXFVirtualFolderTerms);</span>
<a href="#l36.96"></a><span id="l36.96">   if (virtualFolderSearchTerms)</span>
<a href="#l36.97"></a><span id="l36.97">   {</span>
<a href="#l36.98"></a><span id="l36.98" class="difflineminus">-    var isupports = null;</span>
<a href="#l36.99"></a><span id="l36.99" class="difflineminus">-    var searchTerm;</span>
<a href="#l36.100"></a><span id="l36.100" class="difflineminus">-    var termsArray = virtualFolderSearchTerms.QueryInterface(Components.interfaces.nsISupportsArray);</span>
<a href="#l36.101"></a><span id="l36.101" class="difflineminus">-    for (var i = 0; i &lt; termsArray.Count(); i++)</span>
<a href="#l36.102"></a><span id="l36.102" class="difflineplus">+    for (let i = 0; i &lt; termsArray.length; i++)</span>
<a href="#l36.103"></a><span id="l36.103">     {</span>
<a href="#l36.104"></a><span id="l36.104" class="difflineminus">-      isupports = termsArray.GetElementAt(i);</span>
<a href="#l36.105"></a><span id="l36.105" class="difflineminus">-      searchTerm = isupports.QueryInterface(Components.interfaces.nsIMsgSearchTerm);</span>
<a href="#l36.106"></a><span id="l36.106" class="difflineminus">-      searchTermsArray.AppendElement(searchTerm);</span>
<a href="#l36.107"></a><span id="l36.107" class="difflineplus">+      let searchTerm = virtualFolderSearchTerms.queryElementAt(i, Components.interfaces.nsIMsgSearchTerm);</span>
<a href="#l36.108"></a><span id="l36.108" class="difflineplus">+      searchTermsArray.appendElement(searchTerm, /* weak = */ false);</span>
<a href="#l36.109"></a><span id="l36.109">     }</span>
<a href="#l36.110"></a><span id="l36.110">   }</span>
<a href="#l36.111"></a><span id="l36.111"> }</span>
<a href="#l36.112"></a><span id="l36.112"> </span>
<a href="#l36.113"></a><span id="l36.113"> </span>
<a href="#l36.114"></a><span id="l36.114"> function PrepareForViewChange()</span>
<a href="#l36.115"></a><span id="l36.115"> {</span>
<a href="#l36.116"></a><span id="l36.116">   // this is a problem - it saves the current view in gPreQuickSearchView</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/suite/mailnews/search/ABSearchDialog.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/suite/mailnews/search/ABSearchDialog.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l37.4"></a><span id="l37.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l37.5"></a><span id="l37.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l37.6"></a><span id="l37.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l37.7"></a><span id="l37.7"> </span>
<a href="#l37.8"></a><span id="l37.8"> Components.utils.import(&quot;resource:///modules/ABQueryUtils.jsm&quot;);</span>
<a href="#l37.9"></a><span id="l37.9" class="difflineplus">+Components.utils.import(&quot;resource:///modules/iteratorUtils.js&quot;);</span>
<a href="#l37.10"></a><span id="l37.10"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l37.11"></a><span id="l37.11"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l37.12"></a><span id="l37.12"> </span>
<a href="#l37.13"></a><span id="l37.13"> var searchSessionContractID = &quot;@mozilla.org/messenger/searchSession;1&quot;;</span>
<a href="#l37.14"></a><span id="l37.14"> var gSearchSession;</span>
<a href="#l37.15"></a><span id="l37.15"> </span>
<a href="#l37.16"></a><span id="l37.16"> var nsMsgSearchScope = Components.interfaces.nsMsgSearchScope;</span>
<a href="#l37.17"></a><span id="l37.17"> var nsIMsgSearchTerm = Components.interfaces.nsIMsgSearchTerm;</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineat">@@ -160,21 +161,17 @@ function onSearch()</span>
<a href="#l37.19"></a><span id="l37.19"> </span>
<a href="#l37.20"></a><span id="l37.20">     var currentAbURI = document.getElementById('abPopup').getAttribute('value');</span>
<a href="#l37.21"></a><span id="l37.21"> </span>
<a href="#l37.22"></a><span id="l37.22">     gSearchSession.addDirectoryScopeTerm(GetScopeForDirectoryURI(currentAbURI));</span>
<a href="#l37.23"></a><span id="l37.23">     saveSearchTerms(gSearchSession.searchTerms, gSearchSession);</span>
<a href="#l37.24"></a><span id="l37.24"> </span>
<a href="#l37.25"></a><span id="l37.25">     var searchUri = currentAbURI + &quot;?(&quot;;</span>
<a href="#l37.26"></a><span id="l37.26"> </span>
<a href="#l37.27"></a><span id="l37.27" class="difflineminus">-    var count = gSearchSession.searchTerms.Count();</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineminus">-</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineminus">-    for (var i=0; i&lt;count; i++) {</span>
<a href="#l37.30"></a><span id="l37.30" class="difflineminus">-      var searchTerm = gSearchSession.searchTerms.GetElementAt(i).QueryInterface(nsIMsgSearchTerm);</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineminus">-</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineplus">+    for (let searchTerm of fixIterator(gSearchSession.searchTerms, nsIMsgSearchTerm)) {</span>
<a href="#l37.33"></a><span id="l37.33">       // get the &quot;and&quot; / &quot;or&quot; value from the first term</span>
<a href="#l37.34"></a><span id="l37.34">       if (i == 0) {</span>
<a href="#l37.35"></a><span id="l37.35">        if (searchTerm.booleanAnd)</span>
<a href="#l37.36"></a><span id="l37.36">          searchUri += &quot;and&quot;;</span>
<a href="#l37.37"></a><span id="l37.37">        else</span>
<a href="#l37.38"></a><span id="l37.38">          searchUri += &quot;or&quot;;</span>
<a href="#l37.39"></a><span id="l37.39">       }</span>
<a href="#l37.40"></a><span id="l37.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/suite/mailnews/searchBar.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/suite/mailnews/searchBar.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l38.4"></a><span id="l38.4"> /* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l38.5"></a><span id="l38.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l38.6"></a><span id="l38.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l38.7"></a><span id="l38.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l38.8"></a><span id="l38.8"> </span>
<a href="#l38.9"></a><span id="l38.9"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l38.10"></a><span id="l38.10" class="difflineplus">+Components.utils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12"> var gSearchSession = null;</span>
<a href="#l38.13"></a><span id="l38.13"> var gPreQuickSearchView = null;</span>
<a href="#l38.14"></a><span id="l38.14"> var gSearchTimer = null;</span>
<a href="#l38.15"></a><span id="l38.15"> var gViewSearchListener;</span>
<a href="#l38.16"></a><span id="l38.16"> var gSearchBundle;</span>
<a href="#l38.17"></a><span id="l38.17"> var gProgressMeter = null;</span>
<a href="#l38.18"></a><span id="l38.18"> var gSearchInProgress = false;</span>
<a href="#l38.19"></a><span id="l38.19" class="difflineat">@@ -167,17 +168,17 @@ function onEnterInSearchBar()</span>
<a href="#l38.20"></a><span id="l38.20">        statusFeedback.showStatusString(&quot;&quot;);</span>
<a href="#l38.21"></a><span id="l38.21">        disableQuickSearchClearButton();</span>
<a href="#l38.22"></a><span id="l38.22"> </span>
<a href="#l38.23"></a><span id="l38.23">        viewDebug (&quot;onEnterInSearchBar gDefaultSearchViewTerms = &quot; + gDefaultSearchViewTerms + &quot;gVirtualFolderTerms = &quot;</span>
<a href="#l38.24"></a><span id="l38.24">         + gVirtualFolderTerms + &quot;gXFVirtualFolderTerms = &quot; + gXFVirtualFolderTerms + &quot;\n&quot;);</span>
<a href="#l38.25"></a><span id="l38.25">        var addTerms = gDefaultSearchViewTerms || gVirtualFolderTerms || gXFVirtualFolderTerms;</span>
<a href="#l38.26"></a><span id="l38.26">        if (addTerms)</span>
<a href="#l38.27"></a><span id="l38.27">        {</span>
<a href="#l38.28"></a><span id="l38.28" class="difflineminus">-           viewDebug (&quot;addTerms = &quot; + addTerms + &quot; count = &quot; + addTerms.Count() + &quot;\n&quot;);</span>
<a href="#l38.29"></a><span id="l38.29" class="difflineplus">+           viewDebug (&quot;addTerms = &quot; + addTerms + &quot; count = &quot; + addTerms.length + &quot;\n&quot;);</span>
<a href="#l38.30"></a><span id="l38.30">            initializeSearchBar();</span>
<a href="#l38.31"></a><span id="l38.31">            onSearch(addTerms);</span>
<a href="#l38.32"></a><span id="l38.32">        }</span>
<a href="#l38.33"></a><span id="l38.33">        else</span>
<a href="#l38.34"></a><span id="l38.34">         restorePreSearchView();</span>
<a href="#l38.35"></a><span id="l38.35">      }</span>
<a href="#l38.36"></a><span id="l38.36">      else if (gPreQuickSearchView &amp;&amp; !gDefaultSearchViewTerms)// may be a quick search from a cross-folder virtual folder</span>
<a href="#l38.37"></a><span id="l38.37">       restorePreSearchView();</span>
<a href="#l38.38"></a><span id="l38.38" class="difflineat">@@ -286,20 +287,18 @@ function onSearch(aSearchTerms)</span>
<a href="#l38.39"></a><span id="l38.39"> }</span>
<a href="#l38.40"></a><span id="l38.40"> </span>
<a href="#l38.41"></a><span id="l38.41"> function createSearchTermsWithList(aTermsArray)</span>
<a href="#l38.42"></a><span id="l38.42"> {</span>
<a href="#l38.43"></a><span id="l38.43">   var nsMsgSearchScope = Components.interfaces.nsMsgSearchScope;</span>
<a href="#l38.44"></a><span id="l38.44">   var nsMsgSearchAttrib = Components.interfaces.nsMsgSearchAttrib;</span>
<a href="#l38.45"></a><span id="l38.45">   var nsMsgSearchOp = Components.interfaces.nsMsgSearchOp;</span>
<a href="#l38.46"></a><span id="l38.46"> </span>
<a href="#l38.47"></a><span id="l38.47" class="difflineplus">+  gSearchSession.clear();</span>
<a href="#l38.48"></a><span id="l38.48">   gSearchSession.clearScopes();</span>
<a href="#l38.49"></a><span id="l38.49" class="difflineminus">-  var searchTerms = gSearchSession.searchTerms;</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-  var searchTermsArray = searchTerms.QueryInterface(Components.interfaces.nsISupportsArray);</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineminus">-  searchTermsArray.Clear();</span>
<a href="#l38.52"></a><span id="l38.52"> </span>
<a href="#l38.53"></a><span id="l38.53">   var i;</span>
<a href="#l38.54"></a><span id="l38.54">   var selectedFolder = GetThreadPaneFolder();</span>
<a href="#l38.55"></a><span id="l38.55">   if (gXFVirtualFolderTerms)</span>
<a href="#l38.56"></a><span id="l38.56">   {</span>
<a href="#l38.57"></a><span id="l38.57">     var msgDatabase = selectedFolder.msgDatabase;</span>
<a href="#l38.58"></a><span id="l38.58">     if (msgDatabase)</span>
<a href="#l38.59"></a><span id="l38.59">     {</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineat">@@ -315,31 +314,32 @@ function createSearchTermsWithList(aTerm</span>
<a href="#l38.61"></a><span id="l38.61">       }</span>
<a href="#l38.62"></a><span id="l38.62">     }</span>
<a href="#l38.63"></a><span id="l38.63">   }</span>
<a href="#l38.64"></a><span id="l38.64">   else</span>
<a href="#l38.65"></a><span id="l38.65">   {</span>
<a href="#l38.66"></a><span id="l38.66">     viewDebug (&quot;in createSearchTermsWithList, adding scope term for selected folder\n&quot;);</span>
<a href="#l38.67"></a><span id="l38.67">     gSearchSession.addScopeTerm(nsMsgSearchScope.offlineMail, selectedFolder);</span>
<a href="#l38.68"></a><span id="l38.68">   }</span>
<a href="#l38.69"></a><span id="l38.69" class="difflineminus">-  // add each item in termsArray to the search session</span>
<a href="#l38.70"></a><span id="l38.70"> </span>
<a href="#l38.71"></a><span id="l38.71" class="difflineminus">-  var termsArray = aTermsArray.QueryInterface(Components.interfaces.nsISupportsArray);</span>
<a href="#l38.72"></a><span id="l38.72" class="difflineminus">-  for (i = 0; i &lt; termsArray.Count(); ++i)</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineminus">-    gSearchSession.appendTerm(termsArray.GetElementAt(i).QueryInterface(Components.interfaces.nsIMsgSearchTerm));</span>
<a href="#l38.74"></a><span id="l38.74" class="difflineplus">+  // Add each item in aTermsArray to the search session.</span>
<a href="#l38.75"></a><span id="l38.75" class="difflineplus">+  for (let term of fixIterator(aTermsArray, Components.interfaces.nsIMsgSearchTerm)) {</span>
<a href="#l38.76"></a><span id="l38.76" class="difflineplus">+    gSearchSession.appendTerm(term);</span>
<a href="#l38.77"></a><span id="l38.77" class="difflineplus">+  }</span>
<a href="#l38.78"></a><span id="l38.78"> }</span>
<a href="#l38.79"></a><span id="l38.79"> </span>
<a href="#l38.80"></a><span id="l38.80"> function createSearchTerms()</span>
<a href="#l38.81"></a><span id="l38.81"> {</span>
<a href="#l38.82"></a><span id="l38.82">   var nsMsgSearchScope = Components.interfaces.nsMsgSearchScope;</span>
<a href="#l38.83"></a><span id="l38.83">   var nsMsgSearchAttrib = Components.interfaces.nsMsgSearchAttrib;</span>
<a href="#l38.84"></a><span id="l38.84">   var nsMsgSearchOp = Components.interfaces.nsMsgSearchOp;</span>
<a href="#l38.85"></a><span id="l38.85"> </span>
<a href="#l38.86"></a><span id="l38.86" class="difflineminus">-  // create an nsISupportsArray to store our search terms</span>
<a href="#l38.87"></a><span id="l38.87" class="difflineminus">-  var searchTermsArray = Components.classes[&quot;@mozilla.org/supports-array;1&quot;].createInstance(Components.interfaces.nsISupportsArray);</span>
<a href="#l38.88"></a><span id="l38.88" class="difflineplus">+  // create an nsIMutableArray to store our search terms</span>
<a href="#l38.89"></a><span id="l38.89" class="difflineplus">+  var searchTermsArray = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l38.90"></a><span id="l38.90" class="difflineplus">+                                   .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l38.91"></a><span id="l38.91">   var selectedFolder = GetThreadPaneFolder();</span>
<a href="#l38.92"></a><span id="l38.92"> </span>
<a href="#l38.93"></a><span id="l38.93">   // implement | for QS</span>
<a href="#l38.94"></a><span id="l38.94">   // does this break if the user types &quot;foo|bar&quot; expecting to see subjects with that string?</span>
<a href="#l38.95"></a><span id="l38.95">   // I claim no, since &quot;foo|bar&quot; will be a hit for &quot;foo&quot; || &quot;bar&quot;</span>
<a href="#l38.96"></a><span id="l38.96">   // they just might get more false positives</span>
<a href="#l38.97"></a><span id="l38.97">   var termList = gSearchInput.value.split(&quot;|&quot;);</span>
<a href="#l38.98"></a><span id="l38.98">   for (var i = 0; i &lt; termList.length; i ++)</span>
<a href="#l38.99"></a><span id="l38.99" class="difflineat">@@ -351,44 +351,39 @@ function createSearchTerms()</span>
<a href="#l38.100"></a><span id="l38.100">     // create, fill, and append the subject term</span>
<a href="#l38.101"></a><span id="l38.101">     var term = gSearchSession.createTerm();</span>
<a href="#l38.102"></a><span id="l38.102">     var value = term.value;</span>
<a href="#l38.103"></a><span id="l38.103">     value.str = termList[i];</span>
<a href="#l38.104"></a><span id="l38.104">     term.value = value;</span>
<a href="#l38.105"></a><span id="l38.105">     term.attrib = nsMsgSearchAttrib.Subject;</span>
<a href="#l38.106"></a><span id="l38.106">     term.op = nsMsgSearchOp.Contains;</span>
<a href="#l38.107"></a><span id="l38.107">     term.booleanAnd = false;</span>
<a href="#l38.108"></a><span id="l38.108" class="difflineminus">-    searchTermsArray.AppendElement(term);</span>
<a href="#l38.109"></a><span id="l38.109" class="difflineplus">+    searchTermsArray.appendElement(term, /* weak = */ false);</span>
<a href="#l38.110"></a><span id="l38.110"> </span>
<a href="#l38.111"></a><span id="l38.111">     // create, fill, and append the AllAddresses term</span>
<a href="#l38.112"></a><span id="l38.112">     term = gSearchSession.createTerm();</span>
<a href="#l38.113"></a><span id="l38.113">     value = term.value;</span>
<a href="#l38.114"></a><span id="l38.114">     value.str = termList[i];</span>
<a href="#l38.115"></a><span id="l38.115">     term.value = value;</span>
<a href="#l38.116"></a><span id="l38.116">     term.attrib = nsMsgSearchAttrib.AllAddresses;</span>
<a href="#l38.117"></a><span id="l38.117">     term.op = nsMsgSearchOp.Contains;</span>
<a href="#l38.118"></a><span id="l38.118">     term.booleanAnd = false;</span>
<a href="#l38.119"></a><span id="l38.119" class="difflineminus">-    searchTermsArray.AppendElement(term);</span>
<a href="#l38.120"></a><span id="l38.120" class="difflineplus">+    searchTermsArray.appendElement(term, /* weak = */ false);</span>
<a href="#l38.121"></a><span id="l38.121">   }</span>
<a href="#l38.122"></a><span id="l38.122"> </span>
<a href="#l38.123"></a><span id="l38.123">   // now append the default view or virtual folder criteria to the quick search</span>
<a href="#l38.124"></a><span id="l38.124">   // so we don't lose any default view information</span>
<a href="#l38.125"></a><span id="l38.125">   viewDebug(&quot;gDefaultSearchViewTerms = &quot; + gDefaultSearchViewTerms + &quot;gVirtualFolderTerms = &quot; + gVirtualFolderTerms +</span>
<a href="#l38.126"></a><span id="l38.126">     &quot;gXFVirtualFolderTerms = &quot; + gXFVirtualFolderTerms + &quot;\n&quot;);</span>
<a href="#l38.127"></a><span id="l38.127">   var defaultSearchTerms = (gDefaultSearchViewTerms || gVirtualFolderTerms || gXFVirtualFolderTerms);</span>
<a href="#l38.128"></a><span id="l38.128">   if (defaultSearchTerms)</span>
<a href="#l38.129"></a><span id="l38.129">   {</span>
<a href="#l38.130"></a><span id="l38.130" class="difflineminus">-    var isupports = null;</span>
<a href="#l38.131"></a><span id="l38.131" class="difflineminus">-    var searchTerm;</span>
<a href="#l38.132"></a><span id="l38.132" class="difflineminus">-    var termsArray = defaultSearchTerms.QueryInterface(Components.interfaces.nsISupportsArray);</span>
<a href="#l38.133"></a><span id="l38.133" class="difflineminus">-    for (i = 0; i &lt; termsArray.Count(); i++)</span>
<a href="#l38.134"></a><span id="l38.134" class="difflineplus">+    for (let searchTerm of fixIterator(defaultSearchTerms, Components.interfaces.nsIMsgSearchTerm))</span>
<a href="#l38.135"></a><span id="l38.135">     {</span>
<a href="#l38.136"></a><span id="l38.136" class="difflineminus">-      isupports = termsArray.GetElementAt(i);</span>
<a href="#l38.137"></a><span id="l38.137" class="difflineminus">-      searchTerm = isupports.QueryInterface(Components.interfaces.nsIMsgSearchTerm);</span>
<a href="#l38.138"></a><span id="l38.138" class="difflineminus">-      searchTermsArray.AppendElement(searchTerm);</span>
<a href="#l38.139"></a><span id="l38.139" class="difflineplus">+      searchTermsArray.appendElement(searchTerm, /* weak = */ false);</span>
<a href="#l38.140"></a><span id="l38.140">     }</span>
<a href="#l38.141"></a><span id="l38.141">   }</span>
<a href="#l38.142"></a><span id="l38.142"> </span>
<a href="#l38.143"></a><span id="l38.143">   createSearchTermsWithList(searchTermsArray);</span>
<a href="#l38.144"></a><span id="l38.144"> </span>
<a href="#l38.145"></a><span id="l38.145">   // now that we've added the terms, clear out our input array</span>
<a href="#l38.146"></a><span id="l38.146">   searchTermsArray.Clear();</span>
<a href="#l38.147"></a><span id="l38.147"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

