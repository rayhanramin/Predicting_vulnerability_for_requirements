<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 8619:84e7dc2dda02359a3a112ca61d9cab73c7282868</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 84e7dc2dda02359a3a112ca61d9cab73c7282868" />
<meta property="og:url" content="/comm-central/rev/84e7dc2dda02359a3a112ca61d9cab73c7282868" />
<meta property="og:description" content="Bug 680695 - Implement / add context menu with actions for all attachments for right-click on [paperclip icon], &quot;X attachments&quot; or [size] labels of attachment bar; r=bwinton, ui-r=bwinton" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 84e7dc2dda02359a3a112ca61d9cab73c7282868 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/84e7dc2dda02359a3a112ca61d9cab73c7282868">shortlog</a> |
<a href="/comm-central/log/84e7dc2dda02359a3a112ca61d9cab73c7282868">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/84e7dc2dda02359a3a112ca61d9cab73c7282868">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/84e7dc2dda02359a3a112ca61d9cab73c7282868">files</a> |
changeset |
<a href="/comm-central/raw-rev/84e7dc2dda02359a3a112ca61d9cab73c7282868">raw</a>  | <a href="/comm-central/archive/84e7dc2dda02359a3a112ca61d9cab73c7282868.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=680695">Bug 680695</a> - Implement / add context menu with actions for all attachments for right-click on [paperclip icon], &quot;X attachments&quot; or [size] labels of attachment bar; r=bwinton, ui-r=bwinton
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#105;&#109;&#32;&#80;&#111;&#114;&#116;&#101;&#114;&#32;&#60;&#115;&#113;&#117;&#105;&#98;&#98;&#108;&#121;&#102;&#108;&#97;&#98;&#98;&#101;&#116;&#121;&#100;&#111;&#111;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 08 Oct 2011 15:36:45 -0500</td></tr>

<tr>
 <td>changeset 8619</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/84e7dc2dda02359a3a112ca61d9cab73c7282868">84e7dc2dda02359a3a112ca61d9cab73c7282868</a></td>
</tr>



<tr>
<td>parent 8618</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0e2c50947711e57ef336a1db333129fbe470c419">0e2c50947711e57ef336a1db333129fbe470c419</a>
</td>
</tr>

<tr>
<td>child 8620</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/adf6153b25db4598deb7c5f6767379dff75fe4d3">adf6153b25db4598deb7c5f6767379dff75fe4d3</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=84e7dc2dda02359a3a112ca61d9cab73c7282868">6628</a></td></tr>
<tr><td>push user</td><td>squibblyflabbetydoo@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Sat, 08 Oct 2011 20:37:19 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@adf6153b25db [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=adf6153b25db4598deb7c5f6767379dff75fe4d3">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=adf6153b25db4598deb7c5f6767379dff75fe4d3&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=adf6153b25db4598deb7c5f6767379dff75fe4d3&newProject=comm-central&newRevision=0e2c50947711e57ef336a1db333129fbe470c419&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=adf6153b25db4598deb7c5f6767379dff75fe4d3&newProject=comm-central&newRevision=0e2c50947711e57ef336a1db333129fbe470c419&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=adf6153b25db4598deb7c5f6767379dff75fe4d3&newProject=comm-central&newRevision=0e2c50947711e57ef336a1db333129fbe470c419&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bwinton%29&revcount=50">bwinton</a>, <a href="/comm-central/log?rev=reviewer%28bwinton%29&revcount=50">bwinton</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=680695">680695</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=680695">Bug 680695</a> - Implement / add context menu with actions for all attachments for right-click on [paperclip icon], &quot;X attachments&quot; or [size] labels of attachment bar; r=bwinton, ui-r=bwinton</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.js">mail/base/content/msgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.xul">mail/base/content/msgHdrViewOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.xul">file</a> |
<a href="/comm-central/annotate/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.xul">annotate</a> |
<a href="/comm-central/diff/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.xul">diff</a> |
<a href="/comm-central/comparison/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.xul">comparison</a> |
<a href="/comm-central/log/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/base/content/msgHdrViewOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/messenger.properties">mail/locales/en-US/chrome/messenger/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/messenger.properties">file</a> |
<a href="/comm-central/annotate/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/messenger.properties">annotate</a> |
<a href="/comm-central/diff/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/messenger.properties">diff</a> |
<a href="/comm-central/comparison/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/messenger.properties">comparison</a> |
<a href="/comm-central/log/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/messenger.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/msgHdrViewOverlay.dtd">mail/locales/en-US/chrome/messenger/msgHdrViewOverlay.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/msgHdrViewOverlay.dtd">file</a> |
<a href="/comm-central/annotate/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/msgHdrViewOverlay.dtd">annotate</a> |
<a href="/comm-central/diff/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/msgHdrViewOverlay.dtd">diff</a> |
<a href="/comm-central/comparison/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/msgHdrViewOverlay.dtd">comparison</a> |
<a href="/comm-central/log/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/locales/en-US/chrome/messenger/msgHdrViewOverlay.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/test/mozmill/attachment/test-attachment.js">mail/test/mozmill/attachment/test-attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/test/mozmill/attachment/test-attachment.js">file</a> |
<a href="/comm-central/annotate/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/test/mozmill/attachment/test-attachment.js">annotate</a> |
<a href="/comm-central/diff/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/test/mozmill/attachment/test-attachment.js">diff</a> |
<a href="/comm-central/comparison/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/test/mozmill/attachment/test-attachment.js">comparison</a> |
<a href="/comm-central/log/84e7dc2dda02359a3a112ca61d9cab73c7282868/mail/test/mozmill/attachment/test-attachment.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1780,29 +1780,33 @@ function ContentTypeIsSMIME(contentType)</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> /**</span>
<a href="#l1.6"></a><span id="l1.6">  * Set up the attachment item context menu, showing or hiding the appropriate</span>
<a href="#l1.7"></a><span id="l1.7">  * menu items.</span>
<a href="#l1.8"></a><span id="l1.8">  */</span>
<a href="#l1.9"></a><span id="l1.9"> function onShowAttachmentItemContextMenu()</span>
<a href="#l1.10"></a><span id="l1.10"> {</span>
<a href="#l1.11"></a><span id="l1.11">   let attachmentList = document.getElementById(&quot;attachmentList&quot;);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+  let attachmentInfo = document.getElementById(&quot;attachmentInfo&quot;);</span>
<a href="#l1.13"></a><span id="l1.13">   let attachmentName = document.getElementById(&quot;attachmentName&quot;);</span>
<a href="#l1.14"></a><span id="l1.14">   let contextMenu    = document.getElementById(&quot;attachmentItemContext&quot;);</span>
<a href="#l1.15"></a><span id="l1.15">   let openMenu       = document.getElementById(&quot;context-openAttachment&quot;);</span>
<a href="#l1.16"></a><span id="l1.16">   let saveMenu       = document.getElementById(&quot;context-saveAttachment&quot;);</span>
<a href="#l1.17"></a><span id="l1.17">   let detachMenu     = document.getElementById(&quot;context-detachAttachment&quot;);</span>
<a href="#l1.18"></a><span id="l1.18">   let deleteMenu     = document.getElementById(&quot;context-deleteAttachment&quot;);</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-  // If we opened the context menu from the attachmentName label, just grab</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-  // the first (and only) attachment as our &quot;selected&quot; attachments.</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+  // If we opened the context menu from the attachment info area (the paperclip,</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+  // &quot;1 attachment&quot; label, filename, or file size, just grab the first (and</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+  // only) attachment as our &quot;selected&quot; attachments.</span>
<a href="#l1.25"></a><span id="l1.25">   var selectedAttachments;</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-  if (contextMenu.triggerNode == attachmentName) {</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+  if (contextMenu.triggerNode == attachmentInfo ||</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+      contextMenu.triggerNode.parentNode == attachmentInfo) {</span>
<a href="#l1.29"></a><span id="l1.29">     selectedAttachments = [attachmentList.getItemAtIndex(0).attachment];</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-    attachmentName.setAttribute(&quot;selected&quot;, true);</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+    if (contextMenu.triggerNode == attachmentName)</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+      attachmentName.setAttribute(&quot;selected&quot;, true);</span>
<a href="#l1.33"></a><span id="l1.33">   }</span>
<a href="#l1.34"></a><span id="l1.34">   else</span>
<a href="#l1.35"></a><span id="l1.35">     selectedAttachments = [item.attachment for each([, item] in</span>
<a href="#l1.36"></a><span id="l1.36">                            Iterator(attachmentList.selectedItems))];</span>
<a href="#l1.37"></a><span id="l1.37">   contextMenu.attachments = selectedAttachments;</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">   var allSelectedDetached = selectedAttachments.every(function(attachment) {</span>
<a href="#l1.40"></a><span id="l1.40">     return attachment.isExternalAttachment;</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineat">@@ -2024,33 +2028,36 @@ function displayAttachmentsForExpandedVi</span>
<a href="#l1.42"></a><span id="l1.42">       else if (!attachment.isDeleted)</span>
<a href="#l1.43"></a><span id="l1.43">         unknownSize = true;</span>
<a href="#l1.44"></a><span id="l1.44">     }</span>
<a href="#l1.45"></a><span id="l1.45"> </span>
<a href="#l1.46"></a><span id="l1.46">     // Show the appropriate toolbar button and label based on the number of</span>
<a href="#l1.47"></a><span id="l1.47">     // attachments.</span>
<a href="#l1.48"></a><span id="l1.48">     updateSaveAllAttachmentsButton();</span>
<a href="#l1.49"></a><span id="l1.49"> </span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+    let attachmentInfo = document.getElementById(&quot;attachmentInfo&quot;);</span>
<a href="#l1.51"></a><span id="l1.51">     let attachmentCount = document.getElementById(&quot;attachmentCount&quot;);</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-    let attachmentName  = document.getElementById(&quot;attachmentName&quot;);</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-    let attachmentSize  = document.getElementById(&quot;attachmentSize&quot;);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+    let attachmentName = document.getElementById(&quot;attachmentName&quot;);</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+    let attachmentSize = document.getElementById(&quot;attachmentSize&quot;);</span>
<a href="#l1.56"></a><span id="l1.56"> </span>
<a href="#l1.57"></a><span id="l1.57">     if (numAttachments == 1) {</span>
<a href="#l1.58"></a><span id="l1.58">       let count = bundle.getString(&quot;attachmentCountSingle&quot;);</span>
<a href="#l1.59"></a><span id="l1.59">       let name = SanitizeAttachmentDisplayName(currentAttachments[0]);</span>
<a href="#l1.60"></a><span id="l1.60"> </span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+      attachmentInfo.setAttribute(&quot;contextmenu&quot;, &quot;attachmentItemContext&quot;);</span>
<a href="#l1.62"></a><span id="l1.62">       attachmentCount.setAttribute(&quot;value&quot;, count);</span>
<a href="#l1.63"></a><span id="l1.63">       attachmentName.hidden = false;</span>
<a href="#l1.64"></a><span id="l1.64">       attachmentName.setAttribute(&quot;value&quot;, name);</span>
<a href="#l1.65"></a><span id="l1.65">     }</span>
<a href="#l1.66"></a><span id="l1.66">     else {</span>
<a href="#l1.67"></a><span id="l1.67">       let words = bundle.getString(&quot;attachmentCount&quot;);</span>
<a href="#l1.68"></a><span id="l1.68">       let count = PluralForm.get(currentAttachments.length, words)</span>
<a href="#l1.69"></a><span id="l1.69">                             .replace(&quot;#1&quot;, currentAttachments.length);</span>
<a href="#l1.70"></a><span id="l1.70"> </span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+      attachmentInfo.setAttribute(&quot;contextmenu&quot;, &quot;attachmentListContext&quot;);</span>
<a href="#l1.72"></a><span id="l1.72">       attachmentCount.setAttribute(&quot;value&quot;, count);</span>
<a href="#l1.73"></a><span id="l1.73">       attachmentName.hidden = true;</span>
<a href="#l1.74"></a><span id="l1.74">     }</span>
<a href="#l1.75"></a><span id="l1.75"> </span>
<a href="#l1.76"></a><span id="l1.76">     let sizeStr = messenger.formatFileSize(totalSize);</span>
<a href="#l1.77"></a><span id="l1.77">     if (unknownSize) {</span>
<a href="#l1.78"></a><span id="l1.78">       if (totalSize == 0)</span>
<a href="#l1.79"></a><span id="l1.79">         sizeStr = bundle.getString(&quot;attachmentSizeUnknown&quot;);</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineat">@@ -2094,28 +2101,32 @@ function updateSaveAllAttachmentsButton(</span>
<a href="#l1.81"></a><span id="l1.81">  *                 otherwise. If |expanded| is not specified, toggle the state.</span>
<a href="#l1.82"></a><span id="l1.82">  * @param updateFocus (optional) True if the focus should be updated, focusing</span>
<a href="#l1.83"></a><span id="l1.83">  *                    on the attachmentList when expanding, or the messagepane</span>
<a href="#l1.84"></a><span id="l1.84">  *                    when collapsing (but only when the attachmentList was</span>
<a href="#l1.85"></a><span id="l1.85">  *                    originally focused).</span>
<a href="#l1.86"></a><span id="l1.86">  */</span>
<a href="#l1.87"></a><span id="l1.87"> function toggleAttachmentList(expanded, updateFocus)</span>
<a href="#l1.88"></a><span id="l1.88"> {</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineminus">-  var attachmentToggle    = document.getElementById(&quot;attachmentToggle&quot;);</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineminus">-  var attachmentView      = document.getElementById(&quot;attachmentView&quot;);</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineminus">-  var attachmentList      = document.getElementById(&quot;attachmentList&quot;);</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineminus">-  var attachmentSplitter  = document.getElementById(&quot;attachment-splitter&quot;);</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+  var attachmentView = document.getElementById(&quot;attachmentView&quot;);</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+  var attachmentBar = document.getElementById(&quot;attachmentBar&quot;);</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+  var attachmentToggle = document.getElementById(&quot;attachmentToggle&quot;);</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+  var attachmentList = document.getElementById(&quot;attachmentList&quot;);</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+  var attachmentSplitter = document.getElementById(&quot;attachment-splitter&quot;);</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+  var bundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l1.99"></a><span id="l1.99"> </span>
<a href="#l1.100"></a><span id="l1.100">   if (expanded === undefined)</span>
<a href="#l1.101"></a><span id="l1.101">     expanded = !attachmentToggle.checked;</span>
<a href="#l1.102"></a><span id="l1.102">   attachmentToggle.checked = expanded;</span>
<a href="#l1.103"></a><span id="l1.103"> </span>
<a href="#l1.104"></a><span id="l1.104">   if (expanded) {</span>
<a href="#l1.105"></a><span id="l1.105">     attachmentList.collapsed = false;</span>
<a href="#l1.106"></a><span id="l1.106">     attachmentSplitter.collapsed = false;</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+    attachmentBar.setAttribute(&quot;tooltiptext&quot;, bundle.getString(</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+      &quot;collapseAttachmentPaneTooltip&quot;));</span>
<a href="#l1.109"></a><span id="l1.109"> </span>
<a href="#l1.110"></a><span id="l1.110">     var attachmentHeight = attachmentView.boxObject.height -</span>
<a href="#l1.111"></a><span id="l1.111">       attachmentList.boxObject.height + attachmentList.preferredHeight;</span>
<a href="#l1.112"></a><span id="l1.112"> </span>
<a href="#l1.113"></a><span id="l1.113">     // If the attachments box takes up too much of the message pane, downsize:</span>
<a href="#l1.114"></a><span id="l1.114">     var maxAttachmentHeight = document.getElementById(&quot;messagepanebox&quot;)</span>
<a href="#l1.115"></a><span id="l1.115">                                       .boxObject.height / 4;</span>
<a href="#l1.116"></a><span id="l1.116"> </span>
<a href="#l1.117"></a><span id="l1.117" class="difflineat">@@ -2124,16 +2135,18 @@ function toggleAttachmentList(expanded, </span>
<a href="#l1.118"></a><span id="l1.118">     attachmentView.setAttribute(&quot;maxheight&quot;, attachmentHeight);</span>
<a href="#l1.119"></a><span id="l1.119"> </span>
<a href="#l1.120"></a><span id="l1.120">     if (updateFocus)</span>
<a href="#l1.121"></a><span id="l1.121">       attachmentList.focus();</span>
<a href="#l1.122"></a><span id="l1.122">   }</span>
<a href="#l1.123"></a><span id="l1.123">   else {</span>
<a href="#l1.124"></a><span id="l1.124">     attachmentList.collapsed = true;</span>
<a href="#l1.125"></a><span id="l1.125">     attachmentSplitter.collapsed = true;</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineplus">+    attachmentBar.setAttribute(&quot;tooltiptext&quot;, bundle.getString(</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineplus">+      &quot;expandAttachmentPaneTooltip&quot;));</span>
<a href="#l1.128"></a><span id="l1.128">     attachmentView.removeAttribute(&quot;height&quot;);</span>
<a href="#l1.129"></a><span id="l1.129">     attachmentView.removeAttribute(&quot;maxheight&quot;);</span>
<a href="#l1.130"></a><span id="l1.130"> </span>
<a href="#l1.131"></a><span id="l1.131">     if (updateFocus &amp;&amp; document.activeElement == attachmentList)</span>
<a href="#l1.132"></a><span id="l1.132">       SetFocusMessagePane();</span>
<a href="#l1.133"></a><span id="l1.133">   }</span>
<a href="#l1.134"></a><span id="l1.134"> }</span>
<a href="#l1.135"></a><span id="l1.135"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/msgHdrViewOverlay.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/msgHdrViewOverlay.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -506,27 +506,30 @@</span>
<a href="#l2.4"></a><span id="l2.4">           oncommand=&quot;MsgComposeDraftMessage()&quot;/&gt;</span>
<a href="#l2.5"></a><span id="l2.5"> &lt;/hbox&gt;</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> &lt;!-- the message pane consists of 4 'boxes'. Box #4 is the attachment box which</span>
<a href="#l2.8"></a><span id="l2.8">      can be toggled into a slim or an expanded view --&gt;</span>
<a href="#l2.9"></a><span id="l2.9"> &lt;vbox id=&quot;attachmentView&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l2.10"></a><span id="l2.10">   &lt;hbox align=&quot;center&quot; id=&quot;attachmentBar&quot;</span>
<a href="#l2.11"></a><span id="l2.11">         context=&quot;attachment-toolbar-context-menu&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        onclick=&quot;if (event.button == 0 &amp;amp;&amp;amp; event.originalTarget.id == 'attachmentBar') toggleAttachmentList(undefined, true);&quot;&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+        onclick=&quot;if (event.button == 0) toggleAttachmentList(undefined, true);&quot;&gt;</span>
<a href="#l2.14"></a><span id="l2.14">     &lt;button type=&quot;checkbox&quot; id=&quot;attachmentToggle&quot;</span>
<a href="#l2.15"></a><span id="l2.15">             onmousedown=&quot;event.preventDefault();&quot;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+            onclick=&quot;event.stopPropagation();&quot;</span>
<a href="#l2.17"></a><span id="l2.17">             oncommand=&quot;toggleAttachmentList(this.checked, true);&quot;/&gt;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-    &lt;image id=&quot;attachmentIcon&quot;/&gt;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-    &lt;label id=&quot;attachmentCount&quot;/&gt;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-    &lt;label id=&quot;attachmentName&quot; crop=&quot;center&quot; flex=&quot;1&quot;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-           context=&quot;attachmentItemContext&quot;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-           onclick=&quot;if (event.button == 0) { TryHandleAllAttachments('open'); RestoreFocusAfterHdrButton(); }&quot;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-           ondraggesture=&quot;nsDragAndDrop.startDrag(event,attachmentNameDNDObserver);&quot;/&gt;</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-    &lt;label id=&quot;attachmentSize&quot;/&gt;</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+    &lt;hbox align=&quot;center&quot; id=&quot;attachmentInfo&quot;&gt;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+      &lt;image id=&quot;attachmentIcon&quot;/&gt;</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+      &lt;label id=&quot;attachmentCount&quot;/&gt;</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+      &lt;label id=&quot;attachmentName&quot; crop=&quot;center&quot; flex=&quot;1&quot;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+             tooltiptext=&quot;&amp;openAttachment.tooltip;&quot;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+             onclick=&quot;if (event.button == 0) { TryHandleAllAttachments('open'); RestoreFocusAfterHdrButton(); event.stopPropagation(); }&quot;</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+             ondraggesture=&quot;nsDragAndDrop.startDrag(event,attachmentNameDNDObserver);&quot;/&gt;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+      &lt;label id=&quot;attachmentSize&quot;/&gt;</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l2.34"></a><span id="l2.34">     &lt;!-- Use a very large flex value here so that attachmentCount doesn't take</span>
<a href="#l2.35"></a><span id="l2.35">          up more space than necessary, but still crops itself if there's not</span>
<a href="#l2.36"></a><span id="l2.36">          enough space. --&gt;</span>
<a href="#l2.37"></a><span id="l2.37">     &lt;spacer flex=&quot;9999&quot;/&gt;</span>
<a href="#l2.38"></a><span id="l2.38"> </span>
<a href="#l2.39"></a><span id="l2.39">     &lt;toolbox id=&quot;attachment-view-toolbox&quot;</span>
<a href="#l2.40"></a><span id="l2.40">              class=&quot;inline-toolbox&quot;</span>
<a href="#l2.41"></a><span id="l2.41">              defaulticonsize=&quot;small&quot;</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineat">@@ -536,16 +539,17 @@</span>
<a href="#l2.43"></a><span id="l2.43">              inlinetoolbox=&quot;true&quot;&gt;</span>
<a href="#l2.44"></a><span id="l2.44">       &lt;toolbarpalette id=&quot;attachment-view-toolbar-palette&quot;&gt;</span>
<a href="#l2.45"></a><span id="l2.45">         &lt;toolbaritem id=&quot;attachmentSaveAll&quot;</span>
<a href="#l2.46"></a><span id="l2.46">                      title=&quot;&amp;saveAllAttachmentsButton1.label;&quot;&gt;</span>
<a href="#l2.47"></a><span id="l2.47">           &lt;toolbarbutton type=&quot;menu-button&quot; id=&quot;attachmentSaveAllSingle&quot;</span>
<a href="#l2.48"></a><span id="l2.48">                          class=&quot;toolbarbutton-1 msgHeaderView-button&quot;</span>
<a href="#l2.49"></a><span id="l2.49">                          label=&quot;&amp;saveAttachmentButton1.label;&quot;</span>
<a href="#l2.50"></a><span id="l2.50">                          tooltiptext=&quot;&amp;saveAttachmentButton1.tooltip;&quot;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+                         onclick=&quot;event.stopPropagation();&quot;</span>
<a href="#l2.52"></a><span id="l2.52">                          oncommand=&quot;TryHandleAllAttachments('saveAs'); RestoreFocusAfterHdrButton();&quot;</span>
<a href="#l2.53"></a><span id="l2.53">                          hidden=&quot;true&quot;&gt;</span>
<a href="#l2.54"></a><span id="l2.54">             &lt;menupopup id=&quot;attachmentSaveAllSingleMenu&quot;</span>
<a href="#l2.55"></a><span id="l2.55">                        onpopupshowing=&quot;onShowSaveAttachmentMenuSingle();&quot;&gt;</span>
<a href="#l2.56"></a><span id="l2.56">               &lt;menuitem id=&quot;button-openAttachment&quot;</span>
<a href="#l2.57"></a><span id="l2.57">                         oncommand=&quot;TryHandleAllAttachments('open'); event.stopPropagation(); RestoreFocusAfterHdrButton();&quot;</span>
<a href="#l2.58"></a><span id="l2.58">                         label=&quot;&amp;openAttachmentCmd.label;&quot;</span>
<a href="#l2.59"></a><span id="l2.59">                         accesskey=&quot;&amp;openAttachmentCmd.accesskey;&quot;/&gt;</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineat">@@ -563,16 +567,17 @@</span>
<a href="#l2.61"></a><span id="l2.61">                         label=&quot;&amp;deleteAttachmentCmd.label;&quot;</span>
<a href="#l2.62"></a><span id="l2.62">                         accesskey=&quot;&amp;deleteAttachmentCmd.accesskey;&quot;/&gt;</span>
<a href="#l2.63"></a><span id="l2.63">             &lt;/menupopup&gt;</span>
<a href="#l2.64"></a><span id="l2.64">           &lt;/toolbarbutton&gt;</span>
<a href="#l2.65"></a><span id="l2.65">           &lt;toolbarbutton type=&quot;menu-button&quot; id=&quot;attachmentSaveAllMultiple&quot;</span>
<a href="#l2.66"></a><span id="l2.66">                          class=&quot;toolbarbutton-1 msgHeaderView-button&quot;</span>
<a href="#l2.67"></a><span id="l2.67">                          label=&quot;&amp;saveAllAttachmentsButton1.label;&quot;</span>
<a href="#l2.68"></a><span id="l2.68">                          tooltiptext=&quot;&amp;saveAllAttachmentsButton1.tooltip;&quot;</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+                         onclick=&quot;event.stopPropagation();&quot;</span>
<a href="#l2.70"></a><span id="l2.70">                          oncommand=&quot;TryHandleAllAttachments('save'); RestoreFocusAfterHdrButton();&quot;&gt;</span>
<a href="#l2.71"></a><span id="l2.71">             &lt;menupopup id=&quot;attachmentSaveAllMultipleMenu&quot;</span>
<a href="#l2.72"></a><span id="l2.72">                        onpopupshowing=&quot;onShowSaveAttachmentMenuMultiple();&quot;&gt;</span>
<a href="#l2.73"></a><span id="l2.73">               &lt;menuitem id=&quot;button-openAllAttachments&quot;</span>
<a href="#l2.74"></a><span id="l2.74">                         oncommand=&quot;TryHandleAllAttachments('open'); event.stopPropagation(); RestoreFocusAfterHdrButton();&quot;</span>
<a href="#l2.75"></a><span id="l2.75">                         label=&quot;&amp;openAllAttachmentsCmd.label;&quot;</span>
<a href="#l2.76"></a><span id="l2.76">                         accesskey=&quot;&amp;openAllAttachmentsCmd.accesskey;&quot;/&gt;</span>
<a href="#l2.77"></a><span id="l2.77">               &lt;menuitem id=&quot;button-saveAllAttachments&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -561,16 +561,19 @@ headerreply-toFieldMe=Me</span>
<a href="#l3.4"></a><span id="l3.4"> # LOCALIZATION NOTE (headerccFieldMe): first person prepositional object</span>
<a href="#l3.5"></a><span id="l3.5"> # pronoun used in the &quot;cc&quot; header of the message header pane.</span>
<a href="#l3.6"></a><span id="l3.6"> headerccFieldMe=Me</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> # LOCALIZATION NOTE (headerbccFieldMe): first person prepositional object</span>
<a href="#l3.9"></a><span id="l3.9"> # pronoun used in the &quot;bcc&quot; header of the message header pane.</span>
<a href="#l3.10"></a><span id="l3.10"> headerbccFieldMe=Me</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+expandAttachmentPaneTooltip=Show the attachment pane</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+collapseAttachmentPaneTooltip=Hide the attachment pane</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+</span>
<a href="#l3.15"></a><span id="l3.15"> # Shown when content tabs are being loaded.</span>
<a href="#l3.16"></a><span id="l3.16"> loadingTab=Loading…</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18"> # LOCALIZATION NOTE (xpinstallPromptWarning):</span>
<a href="#l3.19"></a><span id="l3.19"> # %1$S is replaced by brandShortName, %2$S is replaced by the host name of the</span>
<a href="#l3.20"></a><span id="l3.20"> # site.</span>
<a href="#l3.21"></a><span id="l3.21"> xpinstallPromptWarning=%1$S prevented the site (%2$S) from asking you to install software on your computer.</span>
<a href="#l3.22"></a><span id="l3.22"> xpinstallPromptAllowButton=Allow</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/msgHdrViewOverlay.dtd</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/msgHdrViewOverlay.dtd</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -112,16 +112,18 @@</span>
<a href="#l4.4"></a><span id="l4.4"> &lt;!ENTITY openAllAttachmentsCmd.accesskey    &quot;O&quot;&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> &lt;!ENTITY saveAllAttachmentsCmd.label    &quot;Save All…&quot;&gt;</span>
<a href="#l4.6"></a><span id="l4.6"> &lt;!ENTITY saveAllAttachmentsCmd.accesskey    &quot;S&quot;&gt;</span>
<a href="#l4.7"></a><span id="l4.7"> &lt;!ENTITY detachAllAttachmentsCmd.label    &quot;Detach All…&quot;&gt;</span>
<a href="#l4.8"></a><span id="l4.8"> &lt;!ENTITY detachAllAttachmentsCmd.accesskey    &quot;D&quot;&gt;</span>
<a href="#l4.9"></a><span id="l4.9"> &lt;!ENTITY deleteAllAttachmentsCmd.label    &quot;Delete All…&quot;&gt;</span>
<a href="#l4.10"></a><span id="l4.10"> &lt;!ENTITY deleteAllAttachmentsCmd.accesskey    &quot;e&quot;&gt;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+&lt;!ENTITY openAttachment.tooltip &quot;Open the attached file&quot;&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+</span>
<a href="#l4.14"></a><span id="l4.14"> &lt;!-- Attachment toolbar items --&gt;</span>
<a href="#l4.15"></a><span id="l4.15"> &lt;!ENTITY saveAttachmentButton1.label       &quot;Save&quot;&gt;</span>
<a href="#l4.16"></a><span id="l4.16"> &lt;!ENTITY saveAttachmentButton1.tooltip     &quot;Save the attached file&quot;&gt;</span>
<a href="#l4.17"></a><span id="l4.17"> &lt;!ENTITY saveAllAttachmentsButton1.label   &quot;Save All&quot;&gt;</span>
<a href="#l4.18"></a><span id="l4.18"> &lt;!ENTITY saveAllAttachmentsButton1.tooltip &quot;Save all the attached files&quot;&gt;</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20"> &lt;!ENTITY copyLinkCmd.label        &quot;Copy Link Location&quot;&gt;</span>
<a href="#l4.21"></a><span id="l4.21"> &lt;!ENTITY copyLinkCmd.accesskey    &quot;C&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/test/mozmill/attachment/test-attachment.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/test/mozmill/attachment/test-attachment.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -184,59 +184,126 @@ function test_attachment_name_sanitizati</span>
<a href="#l5.4"></a><span id="l5.4"> }</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6"> function test_attachment_name_click() {</span>
<a href="#l5.7"></a><span id="l5.7">   be_in_folder(folder);</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">   select_click_row(1);</span>
<a href="#l5.10"></a><span id="l5.10">   assert_selected_and_displayed(1);</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  // Ensure the context menu appears when right-clicking the attachment name</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-  mc.rightClick(mc.eid(&quot;attachmentName&quot;));</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-  wait_for_popup_to_open(mc.e(&quot;attachmentItemContext&quot;));</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-  close_popup(mc, mc.eid(&quot;attachmentItemContext&quot;));</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+  let attachmentList = mc.e(&quot;attachmentList&quot;);</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+  assert_true(attachmentList.collapsed, &quot;Attachment list should start out &quot; +</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+              &quot;collapsed!&quot;);</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+  // Ensure the open dialog appears when clicking on the attachment name and</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+  // that the attachment list doesn't expand.</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+  plan_for_modal_dialog(&quot;unknownContentType&quot;, function() {});</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+  mc.click(mc.eid(&quot;attachmentName&quot;));</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+  wait_for_modal_dialog(&quot;unknownContentType&quot;);</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+  assert_true(attachmentList.collapsed, &quot;Attachment list should not expand &quot; +</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+              &quot;when clicking on attachmentName!&quot;);</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+}</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+/**</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+ * Test that right-clicking on a particular element opens the expected context</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+ * menu.</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+ *</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+ * @param elementId the id of the element to right click on</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+ * @param contextMenuId the id of the context menu that should appear</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+ */</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+function subtest_attachment_right_click(elementId, contextMenuId) {</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+  mc.rightClick(mc.eid(elementId));</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+  wait_for_popup_to_open(mc.e(contextMenuId));</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+  close_popup(mc, mc.eid(contextMenuId));</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+}</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+function test_attachment_right_click_single() {</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+  be_in_folder(folder);</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+  select_click_row(1);</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+  assert_selected_and_displayed(1);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentIcon&quot;, &quot;attachmentItemContext&quot;);</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentCount&quot;, &quot;attachmentItemContext&quot;);</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentName&quot;, &quot;attachmentItemContext&quot;);</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentSize&quot;, &quot;attachmentItemContext&quot;);</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentToggle&quot;,</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+                                 &quot;attachment-toolbar-context-menu&quot;);</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentSaveAllSingle&quot;,</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+                                 &quot;attachment-toolbar-context-menu&quot;);</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentBar&quot;,</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+                                 &quot;attachment-toolbar-context-menu&quot;);</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+}</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+function test_attachment_right_click_multiple() {</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+  be_in_folder(folder);</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+  select_click_row(3);</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+  assert_selected_and_displayed(3);</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentIcon&quot;, &quot;attachmentListContext&quot;);</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentCount&quot;, &quot;attachmentListContext&quot;);</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentSize&quot;, &quot;attachmentListContext&quot;);</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentToggle&quot;,</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+                                 &quot;attachment-toolbar-context-menu&quot;);</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentSaveAllMultiple&quot;,</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+                                 &quot;attachment-toolbar-context-menu&quot;);</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+  subtest_attachment_right_click(&quot;attachmentBar&quot;,</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+                                 &quot;attachment-toolbar-context-menu&quot;);</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+}</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+/**</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+ * Test that clicking on various elements in the attachment bar toggles the</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+ * attachment list.</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+ *</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+ * @param elementId the id of the element to click</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+ */</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+function subtest_attachment_list_toggle(elementId) {</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+  let attachmentList = mc.e(&quot;attachmentList&quot;);</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+  let element = mc.eid(elementId);</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+  mc.click(element);</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+  assert_true(!attachmentList.collapsed, &quot;Attachment list should be expanded &quot; +</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+              &quot;after clicking &quot;+elementId+&quot;!&quot;);</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+  assert_attachment_list_focused();</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+  mc.click(element);</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+  assert_true(attachmentList.collapsed, &quot;Attachment list should be collapsed &quot; +</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+              &quot;after clicking &quot;+elementId+&quot; again!&quot;);</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineplus">+  assert_message_pane_focused();</span>
<a href="#l5.99"></a><span id="l5.99"> }</span>
<a href="#l5.100"></a><span id="l5.100"> </span>
<a href="#l5.101"></a><span id="l5.101"> function test_attachment_list_expansion() {</span>
<a href="#l5.102"></a><span id="l5.102">   be_in_folder(folder);</span>
<a href="#l5.103"></a><span id="l5.103"> </span>
<a href="#l5.104"></a><span id="l5.104">   select_click_row(1);</span>
<a href="#l5.105"></a><span id="l5.105">   assert_selected_and_displayed(1);</span>
<a href="#l5.106"></a><span id="l5.106"> </span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-  let attachmentList = mc.e(&quot;attachmentList&quot;);</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineminus">-  let attachmentToggle = mc.eid(&quot;attachmentToggle&quot;);</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineminus">-  let attachmentBar = mc.eid(&quot;attachmentBar&quot;);</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineminus">-</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineminus">-  assert_true(attachmentList.collapsed, &quot;Attachment list should start out &quot; +</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineminus">-              &quot;collapsed!&quot;);</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineminus">-</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineminus">-  mc.click(attachmentToggle);</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineminus">-  assert_true(!attachmentList.collapsed, &quot;Attachment list should be expanded &quot; +</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineminus">-              &quot;after clicking twisty!&quot;);</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineminus">-  assert_attachment_list_focused();</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+  assert_true(mc.e(&quot;attachmentList&quot;).collapsed, &quot;Attachment list should &quot; +</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineplus">+              &quot;start out collapsed!&quot;);</span>
<a href="#l5.120"></a><span id="l5.120"> </span>
<a href="#l5.121"></a><span id="l5.121" class="difflineminus">-  mc.click(attachmentToggle);</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineminus">-  assert_true(attachmentList.collapsed, &quot;Attachment list should be collapsed &quot; +</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineminus">-              &quot;after clicking twisty again!&quot;);</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineminus">-  assert_message_pane_focused();</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineplus">+  subtest_attachment_list_toggle(&quot;attachmentToggle&quot;);</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineplus">+  subtest_attachment_list_toggle(&quot;attachmentIcon&quot;);</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineplus">+  subtest_attachment_list_toggle(&quot;attachmentCount&quot;);</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineplus">+  subtest_attachment_list_toggle(&quot;attachmentSize&quot;);</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineplus">+  subtest_attachment_list_toggle(&quot;attachmentBar&quot;);</span>
<a href="#l5.130"></a><span id="l5.130"> </span>
<a href="#l5.131"></a><span id="l5.131" class="difflineminus">-  mc.click(attachmentBar);</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineminus">-  assert_true(!attachmentList.collapsed, &quot;Attachment list should be expanded &quot; +</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-              &quot;after clicking bar!&quot;);</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-  assert_attachment_list_focused();</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineminus">-</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-  mc.click(attachmentBar);</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-  assert_true(attachmentList.collapsed, &quot;Attachment list should be collapsed &quot; +</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineminus">-              &quot;after clicking bar again!&quot;);</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-  assert_message_pane_focused();</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineplus">+  // Ensure that clicking the &quot;Save All&quot; button doesn't expand the attachment</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineplus">+  // list.</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineplus">+  mc.click(mc.aid(&quot;attachmentSaveAllSingle&quot;,</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+                  {class: &quot;toolbarbutton-menubutton-dropmarker&quot;}));</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+  assert_true(mc.e(&quot;attachmentList&quot;).collapsed, &quot;Attachment list should be &quot; +</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+              &quot;collapsed after clicking save button!&quot;);</span>
<a href="#l5.146"></a><span id="l5.146"> }</span>
<a href="#l5.147"></a><span id="l5.147"> </span>
<a href="#l5.148"></a><span id="l5.148"> function test_selected_attachments_are_cleared() {</span>
<a href="#l5.149"></a><span id="l5.149">   be_in_folder(folder);</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-</span>
<a href="#l5.151"></a><span id="l5.151">   // First, select the message with two attachments.</span>
<a href="#l5.152"></a><span id="l5.152">   select_click_row(3);</span>
<a href="#l5.153"></a><span id="l5.153"> </span>
<a href="#l5.154"></a><span id="l5.154">   // Expand the attachment list.</span>
<a href="#l5.155"></a><span id="l5.155">   mc.click(mc.eid(&quot;attachmentToggle&quot;));</span>
<a href="#l5.156"></a><span id="l5.156"> </span>
<a href="#l5.157"></a><span id="l5.157">   // Select both the attachments.</span>
<a href="#l5.158"></a><span id="l5.158">   let attachmentList = mc.e(&quot;attachmentList&quot;);</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineat">@@ -245,17 +312,18 @@ function test_selected_attachments_are_c</span>
<a href="#l5.160"></a><span id="l5.160"> </span>
<a href="#l5.161"></a><span id="l5.161">   // We can just click on the first element, but the second one needs a</span>
<a href="#l5.162"></a><span id="l5.162">   // ctrl-click (or cmd-click for those Mac-heads among us).</span>
<a href="#l5.163"></a><span id="l5.163">   mc.click(new elib.Elem(attachmentList.children[0]), 5, 5);</span>
<a href="#l5.164"></a><span id="l5.164">   EventUtils.synthesizeMouse(attachmentList.children[1], 5, 5,</span>
<a href="#l5.165"></a><span id="l5.165">                              {accelKey: true}, mc.window);</span>
<a href="#l5.166"></a><span id="l5.166"> </span>
<a href="#l5.167"></a><span id="l5.167">   assert_equals(attachmentList.selectedItems.length, 2,</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineminus">-                &quot;We had the wrong number of selected items after selecting some!&quot;);</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineplus">+                &quot;We had the wrong number of selected items after selecting &quot; +</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineplus">+                &quot;some!&quot;);</span>
<a href="#l5.171"></a><span id="l5.171"> </span>
<a href="#l5.172"></a><span id="l5.172">   // Switch to the message with one attachment, and make sure there are no</span>
<a href="#l5.173"></a><span id="l5.173">   // selected attachments.</span>
<a href="#l5.174"></a><span id="l5.174">   select_click_row(2);</span>
<a href="#l5.175"></a><span id="l5.175"> </span>
<a href="#l5.176"></a><span id="l5.176">   // Expand the attachment list again.</span>
<a href="#l5.177"></a><span id="l5.177">   mc.click(mc.eid(&quot;attachmentToggle&quot;));</span>
<a href="#l5.178"></a><span id="l5.178"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

