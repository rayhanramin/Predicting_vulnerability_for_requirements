<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 14498:1d8b6d7e62b702a29660a612750cd197f42128c6</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 1d8b6d7e62b702a29660a612750cd197f42128c6" />
<meta property="og:url" content="/comm-central/rev/1d8b6d7e62b702a29660a612750cd197f42128c6" />
<meta property="og:description" content="Support hiding some tags in the buddy list, and add an 'Other Contacts' special group for contacts which aren't in any visible group." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 1d8b6d7e62b702a29660a612750cd197f42128c6 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/1d8b6d7e62b702a29660a612750cd197f42128c6">shortlog</a> |
<a href="/comm-central/log/1d8b6d7e62b702a29660a612750cd197f42128c6">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/1d8b6d7e62b702a29660a612750cd197f42128c6">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/1d8b6d7e62b702a29660a612750cd197f42128c6">files</a> |
changeset |
<a href="/comm-central/raw-rev/1d8b6d7e62b702a29660a612750cd197f42128c6">raw</a>  | <a href="/comm-central/archive/1d8b6d7e62b702a29660a612750cd197f42128c6.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Support hiding some tags in the buddy list, and add an 'Other Contacts' special group for contacts which aren't in any visible group.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#108;&#111;&#114;&#105;&#97;&#110;&#32;&#81;&#117;&#232;&#122;&#101;&#32;&#60;&#102;&#108;&#111;&#114;&#105;&#97;&#110;&#64;&#105;&#110;&#115;&#116;&#97;&#110;&#116;&#98;&#105;&#114;&#100;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 02 Apr 2011 01:36:51 +0200</td></tr>

<tr>
 <td>changeset 14498</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/1d8b6d7e62b702a29660a612750cd197f42128c6">1d8b6d7e62b702a29660a612750cd197f42128c6</a></td>
</tr>



<tr>
<td>parent 14497</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5ff8ea28fe01f4e0bb9b7dc2c557e421f9257340">5ff8ea28fe01f4e0bb9b7dc2c557e421f9257340</a>
</td>
</tr>

<tr>
<td>child 14499</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6d9ea621e0349d57d8d3521f77fe0d1f689115e3">6d9ea621e0349d57d8d3521f77fe0d1f689115e3</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=1d8b6d7e62b702a29660a612750cd197f42128c6">9778</a></td></tr>
<tr><td>push user</td><td>florian@queze.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 12 Jan 2014 18:25:45 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f81a23bfefcd [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>






</table></div>

<div class="page_body description">Support hiding some tags in the buddy list, and add an 'Other Contacts' special group for contacts which aren't in any visible group.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/app/profile/all-instantbird.js">im/app/profile/all-instantbird.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d8b6d7e62b702a29660a612750cd197f42128c6/im/app/profile/all-instantbird.js">file</a> |
<a href="/comm-central/annotate/1d8b6d7e62b702a29660a612750cd197f42128c6/im/app/profile/all-instantbird.js">annotate</a> |
<a href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/app/profile/all-instantbird.js">diff</a> |
<a href="/comm-central/comparison/1d8b6d7e62b702a29660a612750cd197f42128c6/im/app/profile/all-instantbird.js">comparison</a> |
<a href="/comm-central/log/1d8b6d7e62b702a29660a612750cd197f42128c6/im/app/profile/all-instantbird.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.css">im/content/blist.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.css">file</a> |
<a href="/comm-central/annotate/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.css">annotate</a> |
<a href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.css">diff</a> |
<a href="/comm-central/comparison/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.css">comparison</a> |
<a href="/comm-central/log/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.js">im/content/blist.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.js">file</a> |
<a href="/comm-central/annotate/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.js">annotate</a> |
<a href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.js">diff</a> |
<a href="/comm-central/comparison/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.js">comparison</a> |
<a href="/comm-central/log/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.xul">im/content/blist.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.xul">file</a> |
<a href="/comm-central/annotate/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.xul">annotate</a> |
<a href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.xul">diff</a> |
<a href="/comm-central/comparison/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.xul">comparison</a> |
<a href="/comm-central/log/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/blist.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/group.xml">im/content/group.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/group.xml">file</a> |
<a href="/comm-central/annotate/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/group.xml">annotate</a> |
<a href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/group.xml">diff</a> |
<a href="/comm-central/comparison/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/group.xml">comparison</a> |
<a href="/comm-central/log/1d8b6d7e62b702a29660a612750cd197f42128c6/im/content/group.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.dtd">im/locales/en-US/chrome/instantbird/instantbird.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.dtd">file</a> |
<a href="/comm-central/annotate/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.dtd">annotate</a> |
<a href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.dtd">diff</a> |
<a href="/comm-central/comparison/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.dtd">comparison</a> |
<a href="/comm-central/log/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.properties">im/locales/en-US/chrome/instantbird/instantbird.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.properties">file</a> |
<a href="/comm-central/annotate/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.properties">annotate</a> |
<a href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.properties">diff</a> |
<a href="/comm-central/comparison/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.properties">comparison</a> |
<a href="/comm-central/log/1d8b6d7e62b702a29660a612750cd197f42128c6/im/locales/en-US/chrome/instantbird/instantbird.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/themes/blist.css">im/themes/blist.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d8b6d7e62b702a29660a612750cd197f42128c6/im/themes/blist.css">file</a> |
<a href="/comm-central/annotate/1d8b6d7e62b702a29660a612750cd197f42128c6/im/themes/blist.css">annotate</a> |
<a href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/im/themes/blist.css">diff</a> |
<a href="/comm-central/comparison/1d8b6d7e62b702a29660a612750cd197f42128c6/im/themes/blist.css">comparison</a> |
<a href="/comm-central/log/1d8b6d7e62b702a29660a612750cd197f42128c6/im/themes/blist.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/public/imIContactsService.idl">purple/purplexpcom/public/imIContactsService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/public/imIContactsService.idl">file</a> |
<a href="/comm-central/annotate/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/public/imIContactsService.idl">annotate</a> |
<a href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/public/imIContactsService.idl">diff</a> |
<a href="/comm-central/comparison/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/public/imIContactsService.idl">comparison</a> |
<a href="/comm-central/log/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/public/imIContactsService.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/src/imContacts.js">purple/purplexpcom/src/imContacts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/src/imContacts.js">file</a> |
<a href="/comm-central/annotate/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/src/imContacts.js">annotate</a> |
<a href="/comm-central/diff/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/src/imContacts.js">diff</a> |
<a href="/comm-central/comparison/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/src/imContacts.js">comparison</a> |
<a href="/comm-central/log/1d8b6d7e62b702a29660a612750cd197f42128c6/purple/purplexpcom/src/imContacts.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/im/app/profile/all-instantbird.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/im/app/profile/all-instantbird.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -36,16 +36,18 @@ pref(&quot;messenger.accounts&quot;, &quot;&quot;);</span>
<a href="#l1.4"></a><span id="l1.4"> pref(&quot;messenger.accounts.promptOnDelete&quot;, true);</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> // The intervals in seconds between automatic reconnection attempts</span>
<a href="#l1.7"></a><span id="l1.7"> // The last value will be reused forever.</span>
<a href="#l1.8"></a><span id="l1.8"> // A value of 0 means that there will be no more reconnection attempts.</span>
<a href="#l1.9"></a><span id="l1.9"> pref(&quot;messenger.accounts.reconnectTimer&quot;, &quot;1,5,30,60,90,300,600,1200,3600&quot;);</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> pref(&quot;messenger.buddies.showOffline&quot;, false);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+pref(&quot;messenger.buddies.hiddenTags&quot;, &quot;&quot;);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+pref(&quot;messenger.buddies.hideTagPrompt&quot;, true);</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15"> pref(&quot;messenger.conversations.openInTabs&quot;, true);</span>
<a href="#l1.16"></a><span id="l1.16"> pref(&quot;messenger.conversations.useSeparateWindowsForMUCs&quot;, false);</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> pref(&quot;messenger.conversations.selections.magicCopyEnabled&quot;, true);</span>
<a href="#l1.19"></a><span id="l1.19"> pref(&quot;messenger.conversations.selections.ellipsis&quot;, &quot;chrome://instantbird/locale/instantbird.properties&quot;);</span>
<a href="#l1.20"></a><span id="l1.20"> pref(&quot;messenger.conversations.selections.systemMessagesTemplate&quot;, &quot;chrome://instantbird/locale/instantbird.properties&quot;);</span>
<a href="#l1.21"></a><span id="l1.21"> pref(&quot;messenger.conversations.selections.contentMessagesTemplate&quot;, &quot;chrome://instantbird/locale/instantbird.properties&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/im/content/blist.css</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/im/content/blist.css</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -51,16 +51,17 @@ contact[aliasing] .contactDisplayName {</span>
<a href="#l2.4"></a><span id="l2.4"> }</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6"> buddy {</span>
<a href="#l2.7"></a><span id="l2.7">   -moz-binding: url(&quot;chrome://instantbird/content/buddy.xml#buddy&quot;);</span>
<a href="#l2.8"></a><span id="l2.8"> }</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> group {</span>
<a href="#l2.11"></a><span id="l2.11">   -moz-binding: url(&quot;chrome://instantbird/content/group.xml#group&quot;);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  -moz-box-align: center;</span>
<a href="#l2.13"></a><span id="l2.13"> }</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15"> /* The height is required for the animation to work. The skin can</span>
<a href="#l2.16"></a><span id="l2.16">  * specify an additionnal min-height value if there are things of</span>
<a href="#l2.17"></a><span id="l2.17">  * constant size (icons + padding) */</span>
<a href="#l2.18"></a><span id="l2.18"> contact,</span>
<a href="#l2.19"></a><span id="l2.19"> buddy,</span>
<a href="#l2.20"></a><span id="l2.20"> group {</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -120,22 +121,26 @@ tooltip[type=&quot;buddy&quot;] {</span>
<a href="#l2.22"></a><span id="l2.22">   cursor: text;</span>
<a href="#l2.23"></a><span id="l2.23"> }</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25"> #statusMessage[editing] {</span>
<a href="#l2.26"></a><span id="l2.26">   -moz-appearance: textfield;</span>
<a href="#l2.27"></a><span id="l2.27">   -moz-binding: url('chrome://global/content/bindings/textbox.xml#textbox');</span>
<a href="#l2.28"></a><span id="l2.28"> }</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+.hideGroupButton,</span>
<a href="#l2.31"></a><span id="l2.31"> .startChatBubble,</span>
<a href="#l2.32"></a><span id="l2.32"> .expander-up,</span>
<a href="#l2.33"></a><span id="l2.33"> .expander-down {</span>
<a href="#l2.34"></a><span id="l2.34">   cursor: pointer;</span>
<a href="#l2.35"></a><span id="l2.35"> }</span>
<a href="#l2.36"></a><span id="l2.36"> </span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-.startChatBubble {</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+.hideGroupButton,</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+.startChatBubble</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+{</span>
<a href="#l2.41"></a><span id="l2.41">   display: none;</span>
<a href="#l2.42"></a><span id="l2.42"> }</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+group:not([id=&quot;group-1&quot;]):hover .hideGroupButton,</span>
<a href="#l2.45"></a><span id="l2.45"> contact[cansend]:hover .startChatBubble,</span>
<a href="#l2.46"></a><span id="l2.46"> contact[cansend][selected] .startChatBubble {</span>
<a href="#l2.47"></a><span id="l2.47">   display: -moz-box;</span>
<a href="#l2.48"></a><span id="l2.48"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/im/content/blist.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/im/content/blist.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -36,16 +36,18 @@</span>
<a href="#l3.4"></a><span id="l3.4">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> Components.utils.import(&quot;resource:///modules/imStatusUtils.jsm&quot;);</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> const events = [&quot;contact-availability-changed&quot;,</span>
<a href="#l3.9"></a><span id="l3.9">                 &quot;contact-added&quot;,</span>
<a href="#l3.10"></a><span id="l3.10">                 &quot;contact-moved&quot;,</span>
<a href="#l3.11"></a><span id="l3.11">                 &quot;status-changed&quot;,</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+                &quot;tag-hidden&quot;,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+                &quot;tag-shown&quot;,</span>
<a href="#l3.14"></a><span id="l3.14">                 &quot;purple-quit&quot;];</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> const showOfflineBuddiesPref = &quot;messenger.buddies.showOffline&quot;;</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18"> var gBuddyListContextMenu = null;</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20"> function buddyListContextMenu(aXulMenu) {</span>
<a href="#l3.21"></a><span id="l3.21">   this.target  = document.popupNode;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -64,18 +66,32 @@ function buddyListContextMenu(aXulMenu) </span>
<a href="#l3.23"></a><span id="l3.23">     &quot;context-delete&quot;,</span>
<a href="#l3.24"></a><span id="l3.24">     &quot;context-moveto&quot;,</span>
<a href="#l3.25"></a><span id="l3.25">     &quot;context-moveto-popup&quot;,</span>
<a href="#l3.26"></a><span id="l3.26">     &quot;context-create-tag-separator&quot;,</span>
<a href="#l3.27"></a><span id="l3.27">     &quot;context-create-tag&quot;,</span>
<a href="#l3.28"></a><span id="l3.28">     &quot;context-show-offline-buddies-separator&quot;</span>
<a href="#l3.29"></a><span id="l3.29">   ].forEach(function (aId) {</span>
<a href="#l3.30"></a><span id="l3.30">     document.getElementById(aId).hidden = hide;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+  });</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+  [ &quot;context-hide-tag&quot;,</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+    &quot;context-visible-tags&quot;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+  ].forEach(function (aId) {</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+    document.getElementById(aId).hidden = !this.onGroup;</span>
<a href="#l3.37"></a><span id="l3.37">   }, this);</span>
<a href="#l3.38"></a><span id="l3.38"> </span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+  if (this.onGroup) {</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+    document.getElementById(&quot;context-hide-tag&quot;).disabled =</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+      this.target.tag.id == -1;</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+  }</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+  document.getElementById(&quot;context-show-offline-buddies-separator&quot;).hidden =</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+    hide &amp;&amp; !this.onGroup;</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+</span>
<a href="#l3.47"></a><span id="l3.47">   let detach = document.getElementById(&quot;context-detach&quot;);</span>
<a href="#l3.48"></a><span id="l3.48">   detach.hidden = !this.onBuddy;</span>
<a href="#l3.49"></a><span id="l3.49">   if (this.onBuddy)</span>
<a href="#l3.50"></a><span id="l3.50">     detach.disabled = this.target.buddy.contact.getBuddies().length == 1;</span>
<a href="#l3.51"></a><span id="l3.51"> </span>
<a href="#l3.52"></a><span id="l3.52">   document.getElementById(&quot;context-openconversation&quot;).disabled =</span>
<a href="#l3.53"></a><span id="l3.53">     !hide &amp;&amp; !this.target.canOpenConversation();</span>
<a href="#l3.54"></a><span id="l3.54"> }</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineat">@@ -187,16 +203,72 @@ buddyListContextMenu.prototype = {</span>
<a href="#l3.56"></a><span id="l3.56"> </span>
<a href="#l3.57"></a><span id="l3.57">     var logs = [];</span>
<a href="#l3.58"></a><span id="l3.58">     for (let log in getIter(enumerator))</span>
<a href="#l3.59"></a><span id="l3.59">       logs.push(log);</span>
<a href="#l3.60"></a><span id="l3.60">     window.openDialog(&quot;chrome://instantbird/content/viewlog.xul&quot;,</span>
<a href="#l3.61"></a><span id="l3.61">                       &quot;Logs&quot;, &quot;chrome,resizable&quot;, {logs: logs},</span>
<a href="#l3.62"></a><span id="l3.62">                       this.target.displayName);</span>
<a href="#l3.63"></a><span id="l3.63">   },</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+  hideTag: function blcm_hideTag() {</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+    if (!this.onGroup || this.target.tag.id == -1)</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+      return;</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+    this.target.hide();</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+  },</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+  visibleTagsPopupShowing: function blcm_visibleTagsPopupShowing() {</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+    if (!this.onGroup)</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+      return;</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+    let popup = document.getElementById(&quot;context-visible-tags-popup&quot;);</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+    let item;</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+    while ((item = popup.firstChild) &amp;&amp; item.localName != &quot;menuseparator&quot;)</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+      popup.removeChild(item);</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+    let sortFunction = function (a, b) {</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+      let [a, b] = [a.name.toLowerCase(), b.name.toLowerCase()];</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+      return a &lt; b ? 1 : a &gt; b ? -1 : 0;</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+    };</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+    Services.tags.getTags()</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+            .sort(sortFunction)</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+            .forEach(function (aTag) {</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+      item = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+      item.setAttribute(&quot;label&quot;, aTag.name);</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+      item.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineplus">+      let id = aTag.id;</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+      item.groupId = id;</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineplus">+      if (!Services.tags.isTagHidden(aTag))</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+        item.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+      popup.insertBefore(item, popup.firstChild);</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+    });</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+    let otherContactsTag = document.getElementById(&quot;group-1&quot;);</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+    [ &quot;context-other-contacts-tag-separator&quot;,</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+      &quot;context-other-contacts-tag&quot;</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+    ].forEach(function (aId) {</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+      document.getElementById(aId).hidden = !otherContactsTag;</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+    });</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+    if (otherContactsTag) {</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+      // This avoids having the localizable &quot;Other Contacts&quot; string in</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+      // both a .dtd and .properties file.</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+      document.getElementById(&quot;context-other-contacts-tag&quot;).label =</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+        otherContactsTag.displayName;</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+    }</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+  },</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+  visibleTags: function blcm_visibleTags(aEvent) {</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+    let id = aEvent.originalTarget.groupId;</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineplus">+    if (!id)</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+      return;</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineplus">+    let tags = Services.tags;</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineplus">+    let tag = tags.getTagById(id);</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineplus">+    if (tags.isTagHidden(tag))</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineplus">+      tags.showTag(tag);</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineplus">+    else</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+      tags.hideTag(tag);</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+  },</span>
<a href="#l3.120"></a><span id="l3.120">   toggleShowOfflineBuddies: function blcm_toggleShowOfflineBuddies() {</span>
<a href="#l3.121"></a><span id="l3.121">     let newValue =</span>
<a href="#l3.122"></a><span id="l3.122">       !!document.getElementById(&quot;context-show-offline-buddies&quot;)</span>
<a href="#l3.123"></a><span id="l3.123">                 .getAttribute(&quot;checked&quot;);</span>
<a href="#l3.124"></a><span id="l3.124">     Services.prefs.setBoolPref(showOfflineBuddiesPref, newValue);</span>
<a href="#l3.125"></a><span id="l3.125">   }</span>
<a href="#l3.126"></a><span id="l3.126"> };</span>
<a href="#l3.127"></a><span id="l3.127"> </span>
<a href="#l3.128"></a><span id="l3.128" class="difflineat">@@ -211,54 +283,56 @@ var buddyList = {</span>
<a href="#l3.129"></a><span id="l3.129">       let showOffline = Services.prefs.getBoolPref(showOfflineBuddiesPref);</span>
<a href="#l3.130"></a><span id="l3.130">       this._showOffline = showOffline;</span>
<a href="#l3.131"></a><span id="l3.131">       let item = document.getElementById(&quot;context-show-offline-buddies&quot;);</span>
<a href="#l3.132"></a><span id="l3.132">       if (showOffline)</span>
<a href="#l3.133"></a><span id="l3.133">         item.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l3.134"></a><span id="l3.134">       else</span>
<a href="#l3.135"></a><span id="l3.135">         item.removeAttribute(&quot;checked&quot;);</span>
<a href="#l3.136"></a><span id="l3.136"> </span>
<a href="#l3.137"></a><span id="l3.137" class="difflineminus">-      let blistBox = document.getElementById(&quot;buddylistbox&quot;);</span>
<a href="#l3.138"></a><span id="l3.138">       Services.tags.getTags().forEach(function (aTag) {</span>
<a href="#l3.139"></a><span id="l3.139">         let elt = document.getElementById(&quot;group&quot; + aTag.id);</span>
<a href="#l3.140"></a><span id="l3.140">         if (elt)</span>
<a href="#l3.141"></a><span id="l3.141">           elt.showOffline = showOffline;</span>
<a href="#l3.142"></a><span id="l3.142">         else if (showOffline) {</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineminus">-          elt = document.createElement(&quot;group&quot;);</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineminus">-          blistBox.appendChild(elt);</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineminus">-          elt._showOffline = true;</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineminus">-          if (!elt.build(aTag))</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-            blistBox.removeChild(elt);</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+          if (Services.tags.isTagHidden(aTag))</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+            this.showOtherContacts();</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+          else</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+            this.displayGroup(aTag);</span>
<a href="#l3.152"></a><span id="l3.152">         }</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineminus">-      });</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+      }, this);</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+      let elt = document.getElementById(&quot;group-1&quot;); // &quot;Other contacts&quot;&quot;</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineplus">+      if (elt)</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+        elt.showOffline = showOffline;</span>
<a href="#l3.158"></a><span id="l3.158">       return;</span>
<a href="#l3.159"></a><span id="l3.159">     }</span>
<a href="#l3.160"></a><span id="l3.160"> </span>
<a href="#l3.161"></a><span id="l3.161">     if (aTopic == &quot;status-changed&quot;) {</span>
<a href="#l3.162"></a><span id="l3.162">       this.displayCurrentStatus();</span>
<a href="#l3.163"></a><span id="l3.163">       return;</span>
<a href="#l3.164"></a><span id="l3.164">     }</span>
<a href="#l3.165"></a><span id="l3.165"> </span>
<a href="#l3.166"></a><span id="l3.166" class="difflineplus">+    if (aTopic == &quot;tag-hidden&quot;) {</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+      this.showOtherContacts();</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+      return;</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineplus">+    }</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineplus">+</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineplus">+    if (aTopic == &quot;tag-shown&quot;) {</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineplus">+      if (!document.getElementById(&quot;group&quot; + aSubject.id))</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineplus">+        this.displayGroup(aSubject);</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineplus">+      return;</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineplus">+    }</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineplus">+</span>
<a href="#l3.177"></a><span id="l3.177">     // aSubject is an imIContact</span>
<a href="#l3.178"></a><span id="l3.178">     if (aSubject.online || this._showOffline) {</span>
<a href="#l3.179"></a><span id="l3.179">       aSubject.getTags().forEach(function (aTag) {</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineminus">-        if (!document.getElementById(&quot;group&quot; + aTag.id)) {</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineminus">-          let groupElt = document.createElement(&quot;group&quot;);</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineminus">-          let blistBox = document.getElementById(&quot;buddylistbox&quot;);</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineminus">-          blistBox.appendChild(groupElt);</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineminus">-          if (this._showOffline)</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineminus">-            groupElt._showOffline = true;</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineminus">-          if (!groupElt.build(aTag)) {</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineminus">-            // Broken group or notification?</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineminus">-            // This should never happen as there will always be at least</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineminus">-            // one contact shown.</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineminus">-            // (We test the aSubject.online || this._showOffline to ensure it.)</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineminus">-            blistBox.removeChild(groupElt);</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineminus">-          }</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineminus">-        }</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineplus">+        if (Services.tags.isTagHidden(aTag))</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+          this.showOtherContacts();</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineplus">+        else if (!document.getElementById(&quot;group&quot; + aTag.id))</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineplus">+          this.displayGroup(aTag);</span>
<a href="#l3.198"></a><span id="l3.198">       }, this);</span>
<a href="#l3.199"></a><span id="l3.199">     }</span>
<a href="#l3.200"></a><span id="l3.200">   },</span>
<a href="#l3.201"></a><span id="l3.201"> </span>
<a href="#l3.202"></a><span id="l3.202">   displayStatusType: function bl_displayStatusType(aStatusType) {</span>
<a href="#l3.203"></a><span id="l3.203">     document.getElementById(&quot;statusMessage&quot;)</span>
<a href="#l3.204"></a><span id="l3.204">             .setAttribute(&quot;statusType&quot;, aStatusType);</span>
<a href="#l3.205"></a><span id="l3.205">     let statusString = Status.toLabel(aStatusType);</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineat">@@ -415,32 +489,45 @@ var buddyList = {</span>
<a href="#l3.207"></a><span id="l3.207"> </span>
<a href="#l3.208"></a><span id="l3.208">     let prefBranch = Services.prefs;</span>
<a href="#l3.209"></a><span id="l3.209">     buddyList._showOffline = prefBranch.getBoolPref(showOfflineBuddiesPref);</span>
<a href="#l3.210"></a><span id="l3.210">     if (buddyList._showOffline) {</span>
<a href="#l3.211"></a><span id="l3.211">       document.getElementById(&quot;context-show-offline-buddies&quot;)</span>
<a href="#l3.212"></a><span id="l3.212">               .setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l3.213"></a><span id="l3.213">     }</span>
<a href="#l3.214"></a><span id="l3.214"> </span>
<a href="#l3.215"></a><span id="l3.215" class="difflineminus">-    let blistBox = document.getElementById(&quot;buddylistbox&quot;);</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineplus">+    let showOtherContacts = false;</span>
<a href="#l3.217"></a><span id="l3.217">     Services.tags.getTags().forEach(function (aTag) {</span>
<a href="#l3.218"></a><span id="l3.218" class="difflineminus">-      let groupElt = document.createElement(&quot;group&quot;);</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineminus">-      blistBox.appendChild(groupElt);</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineminus">-      if (buddyList._showOffline)</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineminus">-        groupElt._showOffline = true;</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineminus">-      if (!groupElt.build(aTag))</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineminus">-        blistBox.removeChild(groupElt);</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineplus">+      if (Services.tags.isTagHidden(aTag))</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineplus">+        showOtherContacts = true;</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineplus">+      else</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineplus">+        buddyList.displayGroup(aTag);</span>
<a href="#l3.228"></a><span id="l3.228">     });</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineminus">-    blistBox.focus();</span>
<a href="#l3.230"></a><span id="l3.230" class="difflineplus">+    if (showOtherContacts)</span>
<a href="#l3.231"></a><span id="l3.231" class="difflineplus">+      buddyList.showOtherContacts();</span>
<a href="#l3.232"></a><span id="l3.232" class="difflineplus">+    document.getElementById(&quot;buddylistbox&quot;).focus();</span>
<a href="#l3.233"></a><span id="l3.233"> </span>
<a href="#l3.234"></a><span id="l3.234">     prefBranch.addObserver(showOfflineBuddiesPref, buddyList, false);</span>
<a href="#l3.235"></a><span id="l3.235">     addObservers(buddyList, events);</span>
<a href="#l3.236"></a><span id="l3.236"> </span>
<a href="#l3.237"></a><span id="l3.237">     this.addEventListener(&quot;unload&quot;, buddyList.unload, false);</span>
<a href="#l3.238"></a><span id="l3.238">   },</span>
<a href="#l3.239"></a><span id="l3.239" class="difflineplus">+  displayGroup: function(aTag) {</span>
<a href="#l3.240"></a><span id="l3.240" class="difflineplus">+    let blistBox = document.getElementById(&quot;buddylistbox&quot;);</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineplus">+    let groupElt = document.createElement(&quot;group&quot;);</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineplus">+    blistBox.insertBefore(groupElt, document.getElementById(&quot;group-1&quot;));</span>
<a href="#l3.243"></a><span id="l3.243" class="difflineplus">+    if (this._showOffline)</span>
<a href="#l3.244"></a><span id="l3.244" class="difflineplus">+      groupElt._showOffline = true;</span>
<a href="#l3.245"></a><span id="l3.245" class="difflineplus">+    if (!groupElt.build(aTag))</span>
<a href="#l3.246"></a><span id="l3.246" class="difflineplus">+      blistBox.removeChild(groupElt);</span>
<a href="#l3.247"></a><span id="l3.247" class="difflineplus">+  },</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineplus">+  showOtherContacts: function bl_showOtherContacts() {</span>
<a href="#l3.249"></a><span id="l3.249" class="difflineplus">+    if (!document.getElementById(&quot;group-1&quot;))</span>
<a href="#l3.250"></a><span id="l3.250" class="difflineplus">+      this.displayGroup(Services.tags.otherContactsTag);</span>
<a href="#l3.251"></a><span id="l3.251" class="difflineplus">+  },</span>
<a href="#l3.252"></a><span id="l3.252">   unload: function bl_unload() {</span>
<a href="#l3.253"></a><span id="l3.253">     removeObservers(buddyList, events);</span>
<a href="#l3.254"></a><span id="l3.254">     Services.prefs.removeObserver(showOfflineBuddiesPref, buddyList);</span>
<a href="#l3.255"></a><span id="l3.255">    },</span>
<a href="#l3.256"></a><span id="l3.256"> </span>
<a href="#l3.257"></a><span id="l3.257">   // Handle key pressing</span>
<a href="#l3.258"></a><span id="l3.258">   keyPress: function bl_keyPress(aEvent) {</span>
<a href="#l3.259"></a><span id="l3.259">     var item = document.getElementById(&quot;buddylistbox&quot;).selectedItem;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/im/content/blist.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/im/content/blist.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -112,16 +112,31 @@</span>
<a href="#l4.4"></a><span id="l4.4">                    onpopupshowing=&quot;gBuddyListContextMenu.moveToPopupShowing();&quot;&gt;</span>
<a href="#l4.5"></a><span id="l4.5">           &lt;menuseparator id=&quot;context-create-tag-separator&quot;/&gt;</span>
<a href="#l4.6"></a><span id="l4.6">           &lt;menuitem id=&quot;context-create-tag&quot;</span>
<a href="#l4.7"></a><span id="l4.7">                     label=&quot;&amp;moveNewTagCmd.label;&quot;</span>
<a href="#l4.8"></a><span id="l4.8">                     accesskey=&quot;&amp;moveNewTagCmd.accesskey;&quot;</span>
<a href="#l4.9"></a><span id="l4.9">                     oncommand=&quot;gBuddyListContextMenu.moveToNewTag();&quot;/&gt;</span>
<a href="#l4.10"></a><span id="l4.10">         &lt;/menupopup&gt;</span>
<a href="#l4.11"></a><span id="l4.11">       &lt;/menu&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+      &lt;menuitem id=&quot;context-hide-tag&quot;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                label=&quot;&amp;hideTagCmd.label;&quot;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+                accesskey=&quot;&amp;hideTagCmd.accesskey;&quot;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+                oncommand=&quot;gBuddyListContextMenu.hideTag();&quot;/&gt;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+      &lt;menu id=&quot;context-visible-tags&quot;</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+            label=&quot;&amp;visibleTagsCmd.label;&quot;</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+            accesskey=&quot;&amp;visibleTagsCmd.accesskey;&quot;&gt;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+        &lt;menupopup id=&quot;context-visible-tags-popup&quot;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+                   oncommand=&quot;gBuddyListContextMenu.visibleTags(event);&quot;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+                   onpopupshowing=&quot;gBuddyListContextMenu.visibleTagsPopupShowing();&quot;&gt;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+          &lt;menuseparator id=&quot;context-other-contacts-tag-separator&quot;/&gt;</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+          &lt;menuitem id=&quot;context-other-contacts-tag&quot;</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+                    checked=&quot;true&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+        &lt;/menupopup&gt;</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+      &lt;/menu&gt;</span>
<a href="#l4.27"></a><span id="l4.27">       &lt;menuseparator id=&quot;context-show-offline-buddies-separator&quot;/&gt;</span>
<a href="#l4.28"></a><span id="l4.28">       &lt;menuitem id=&quot;context-show-offline-buddies&quot;</span>
<a href="#l4.29"></a><span id="l4.29">                 label=&quot;&amp;showOfflineBuddiesCmd.label;&quot;</span>
<a href="#l4.30"></a><span id="l4.30">                 accesskey=&quot;&amp;showOfflineBuddiesCmd.accesskey;&quot;</span>
<a href="#l4.31"></a><span id="l4.31">                 type=&quot;checkbox&quot;</span>
<a href="#l4.32"></a><span id="l4.32">                 oncommand=&quot;gBuddyListContextMenu.toggleShowOfflineBuddies();&quot;/&gt;</span>
<a href="#l4.33"></a><span id="l4.33">     &lt;/menupopup&gt;</span>
<a href="#l4.34"></a><span id="l4.34">   &lt;/popupset&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/im/content/group.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/im/content/group.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -31,28 +31,32 @@</span>
<a href="#l5.4"></a><span id="l5.4">    - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.5"></a><span id="l5.5">    - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.6"></a><span id="l5.6">    - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.7"></a><span id="l5.7">    - the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.8"></a><span id="l5.8">    - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.9"></a><span id="l5.9">    -</span>
<a href="#l5.10"></a><span id="l5.10">    - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-&lt;!DOCTYPE bindings&gt;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+&lt;!DOCTYPE bindings [</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+  &lt;!ENTITY % instantbirdDTD SYSTEM &quot;chrome://instantbird/locale/instantbird.dtd&quot; &gt;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+  %instantbirdDTD;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+]&gt;</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19"> &lt;bindings id=&quot;groupBindings&quot;</span>
<a href="#l5.20"></a><span id="l5.20">           xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l5.21"></a><span id="l5.21">           xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l5.22"></a><span id="l5.22">           xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">   &lt;binding id=&quot;group&quot; extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistitem&quot;&gt;</span>
<a href="#l5.25"></a><span id="l5.25">     &lt;content persist=&quot;closed&quot;&gt;</span>
<a href="#l5.26"></a><span id="l5.26">       &lt;xul:image class=&quot;twisty&quot;/&gt;</span>
<a href="#l5.27"></a><span id="l5.27">       &lt;xul:label flex=&quot;1&quot; crop=&quot;end&quot; xbl:inherits=&quot;value=name&quot;/&gt;</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+      &lt;xul:button anonid=&quot;hideGroupButton&quot; class=&quot;hideGroupButton&quot;</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+                  tooltiptext=&quot;&amp;hideGroupTooltip;&quot;/&gt;</span>
<a href="#l5.30"></a><span id="l5.30">     &lt;/content&gt;</span>
<a href="#l5.31"></a><span id="l5.31">     &lt;implementation implements=&quot;nsIObserver&quot;&gt;</span>
<a href="#l5.32"></a><span id="l5.32"> </span>
<a href="#l5.33"></a><span id="l5.33">      &lt;destructor&gt;</span>
<a href="#l5.34"></a><span id="l5.34">       &lt;![CDATA[</span>
<a href="#l5.35"></a><span id="l5.35">         if (this.tag) {</span>
<a href="#l5.36"></a><span id="l5.36">           this.tag.removeObserver(this);</span>
<a href="#l5.37"></a><span id="l5.37">           delete this.tag;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineat">@@ -85,16 +89,25 @@</span>
<a href="#l5.39"></a><span id="l5.39">         var RDF = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;]</span>
<a href="#l5.40"></a><span id="l5.40">                             .getService(Components.interfaces.nsIRDFService);</span>
<a href="#l5.41"></a><span id="l5.41">         var elt = RDF.GetResource(document.location + &quot;#&quot; + this.id);</span>
<a href="#l5.42"></a><span id="l5.42">         if (source.HasAssertion(elt, RDF.GetResource(&quot;closed&quot;),</span>
<a href="#l5.43"></a><span id="l5.43">                                 RDF.GetLiteral(&quot;true&quot;), true))</span>
<a href="#l5.44"></a><span id="l5.44">           this.setAttribute(&quot;closed&quot;, &quot;true&quot;);</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46">         contacts.forEach(this.addContact, this);</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+        let name;</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+        if (this.tag.id != -1)</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+          name = this.tag.name;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+        else {</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+          name = Services.strings.createBundle(&quot;chrome://instantbird/locale/instantbird.properties&quot;)</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+                         .GetStringFromName(&quot;group.otherContacts.name&quot;);</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+        }</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+        this.displayName = name;</span>
<a href="#l5.56"></a><span id="l5.56">         this._updateGroupLabel();</span>
<a href="#l5.57"></a><span id="l5.57">         this.tag.addObserver(this);</span>
<a href="#l5.58"></a><span id="l5.58">         return true;</span>
<a href="#l5.59"></a><span id="l5.59">       ]]&gt;</span>
<a href="#l5.60"></a><span id="l5.60">       &lt;/body&gt;</span>
<a href="#l5.61"></a><span id="l5.61">      &lt;/method&gt;</span>
<a href="#l5.62"></a><span id="l5.62"> </span>
<a href="#l5.63"></a><span id="l5.63">      &lt;property name=&quot;showOffline&quot;&gt;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineat">@@ -145,16 +158,26 @@</span>
<a href="#l5.65"></a><span id="l5.65">            let oldId = parseInt(aData);</span>
<a href="#l5.66"></a><span id="l5.66">            if (this.contactsById.hasOwnProperty(oldId)) {</span>
<a href="#l5.67"></a><span id="l5.67">              let contact = this.contactsById[oldId];</span>
<a href="#l5.68"></a><span id="l5.68">              delete this.contactsById[oldId];</span>
<a href="#l5.69"></a><span id="l5.69">              this.contactsById[contact.contact.id] = contact;</span>
<a href="#l5.70"></a><span id="l5.70">            }</span>
<a href="#l5.71"></a><span id="l5.71">            return;</span>
<a href="#l5.72"></a><span id="l5.72">          }</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+         if (aTopic == &quot;tag-hidden&quot;) {</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+           this.setAttribute(&quot;collapsing&quot;, &quot;true&quot;);</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+           this.addEventListener(&quot;transitionend&quot;, this._transitionEnd, true);</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+           for each (let contact in this.contacts) {</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+             contact.state = &quot;collapsing&quot;;</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+             contact.finishRemoveNode();</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+           }</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+           return;</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+         }</span>
<a href="#l5.83"></a><span id="l5.83">        ]]&gt;</span>
<a href="#l5.84"></a><span id="l5.84">        &lt;/body&gt;</span>
<a href="#l5.85"></a><span id="l5.85">      &lt;/method&gt;</span>
<a href="#l5.86"></a><span id="l5.86"> </span>
<a href="#l5.87"></a><span id="l5.87">      &lt;method name=&quot;addContact&quot;&gt;</span>
<a href="#l5.88"></a><span id="l5.88">       &lt;parameter name=&quot;aContact&quot;/&gt;</span>
<a href="#l5.89"></a><span id="l5.89">       &lt;body&gt;</span>
<a href="#l5.90"></a><span id="l5.90">       &lt;![CDATA[</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineat">@@ -209,16 +232,48 @@</span>
<a href="#l5.92"></a><span id="l5.92">         if (!this.hasAttribute(&quot;collapsing&quot;))</span>
<a href="#l5.93"></a><span id="l5.93">           return;</span>
<a href="#l5.94"></a><span id="l5.94">         this.tag.removeObserver(this);</span>
<a href="#l5.95"></a><span id="l5.95">         this.parentNode.removeChild(this);</span>
<a href="#l5.96"></a><span id="l5.96">       ]]&gt;</span>
<a href="#l5.97"></a><span id="l5.97">       &lt;/body&gt;</span>
<a href="#l5.98"></a><span id="l5.98">      &lt;/method&gt;</span>
<a href="#l5.99"></a><span id="l5.99"> </span>
<a href="#l5.100"></a><span id="l5.100" class="difflineplus">+     &lt;method name=&quot;hide&quot;&gt;</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+      &lt;body&gt;</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineplus">+      &lt;![CDATA[</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineplus">+        const promptPrefName = &quot;messenger.buddies.hideTagPrompt&quot;;</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineplus">+        if (Services.prefs.getBoolPref(promptPrefName)) {</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineplus">+          let bundle =</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineplus">+            Services.strings.createBundle(&quot;chrome://instantbird/locale/instantbird.properties&quot;);</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+          let name = this.displayName;</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+          let promptTitle =</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineplus">+            bundle.formatStringFromName(&quot;group.hidePrompt.title&quot;, [name], 1);</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+          let promptMessage =</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+            bundle.formatStringFromName(&quot;group.hidePrompt.message&quot;, [name], 1);</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+          let hideButton = bundle.GetStringFromName(&quot;group.hidePrompt.button&quot;);</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+          let promptCheckbox =</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+            bundle.GetStringFromName(&quot;group.hidePrompt.checkbox&quot;);</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+          let prompts = Services.prompt;</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineplus">+          let checkbox = {};</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineplus">+          let flags = prompts.BUTTON_TITLE_IS_STRING * prompts.BUTTON_POS_0 +</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+                      prompts.BUTTON_TITLE_CANCEL * prompts.BUTTON_POS_1 +</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineplus">+                      prompts.BUTTON_POS_0_DEFAULT;</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineplus">+          if (prompts.confirmEx(window, promptTitle, promptMessage, flags,</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineplus">+                                hideButton, null, null, promptCheckbox, checkbox))</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineplus">+            return;</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineplus">+</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineplus">+          if (!checkbox.value)</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineplus">+            Services.prefs.setBoolPref(promptPrefName, false);</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineplus">+        }</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineplus">+        Services.tags.hideTag(this.tag);</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineplus">+      ]]&gt;</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineplus">+      &lt;/body&gt;</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineplus">+     &lt;/method&gt;</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineplus">+</span>
<a href="#l5.132"></a><span id="l5.132">      &lt;method name=&quot;_updateClosedState&quot;&gt;</span>
<a href="#l5.133"></a><span id="l5.133">       &lt;parameter name=&quot;aClosed&quot;/&gt;</span>
<a href="#l5.134"></a><span id="l5.134">       &lt;body&gt;</span>
<a href="#l5.135"></a><span id="l5.135">       &lt;![CDATA[</span>
<a href="#l5.136"></a><span id="l5.136">         for each (let contact in this.contacts)</span>
<a href="#l5.137"></a><span id="l5.137">           contact.collapsed = aClosed;</span>
<a href="#l5.138"></a><span id="l5.138">       ]]&gt;</span>
<a href="#l5.139"></a><span id="l5.139">       &lt;/body&gt;</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineat">@@ -236,20 +291,21 @@</span>
<a href="#l5.141"></a><span id="l5.141">           this._updateClosedState(true);</span>
<a href="#l5.142"></a><span id="l5.142">         }</span>
<a href="#l5.143"></a><span id="l5.143"> </span>
<a href="#l5.144"></a><span id="l5.144">         this._updateGroupLabel();</span>
<a href="#l5.145"></a><span id="l5.145">       ]]&gt;</span>
<a href="#l5.146"></a><span id="l5.146">       &lt;/body&gt;</span>
<a href="#l5.147"></a><span id="l5.147">      &lt;/method&gt;</span>
<a href="#l5.148"></a><span id="l5.148"> </span>
<a href="#l5.149"></a><span id="l5.149" class="difflineplus">+     &lt;field name=&quot;displayName&quot;&gt;&lt;/field&gt;</span>
<a href="#l5.150"></a><span id="l5.150">      &lt;method name=&quot;_updateGroupLabel&quot;&gt;</span>
<a href="#l5.151"></a><span id="l5.151">       &lt;body&gt;</span>
<a href="#l5.152"></a><span id="l5.152">       &lt;![CDATA[</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineminus">-        let name = this.tag.name;</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineplus">+        let name = this.displayName;</span>
<a href="#l5.155"></a><span id="l5.155">         if (this.hasAttribute(&quot;closed&quot;))</span>
<a href="#l5.156"></a><span id="l5.156">           name += &quot; (&quot; + this.contacts.length + &quot;)&quot;;</span>
<a href="#l5.157"></a><span id="l5.157"> </span>
<a href="#l5.158"></a><span id="l5.158">         this.setAttribute(&quot;name&quot;, name);</span>
<a href="#l5.159"></a><span id="l5.159">       ]]&gt;</span>
<a href="#l5.160"></a><span id="l5.160">       &lt;/body&gt;</span>
<a href="#l5.161"></a><span id="l5.161">      &lt;/method&gt;</span>
<a href="#l5.162"></a><span id="l5.162"> </span>
<a href="#l5.163"></a><span id="l5.163" class="difflineat">@@ -279,13 +335,16 @@</span>
<a href="#l5.164"></a><span id="l5.164">     &lt;/implementation&gt;</span>
<a href="#l5.165"></a><span id="l5.165">     &lt;handlers&gt;</span>
<a href="#l5.166"></a><span id="l5.166">      &lt;handler event=&quot;click&quot;&gt;</span>
<a href="#l5.167"></a><span id="l5.167">      &lt;![CDATA[</span>
<a href="#l5.168"></a><span id="l5.168">         // Check if there was 1 click on the image or 2 clicks on the label</span>
<a href="#l5.169"></a><span id="l5.169">         if ((event.detail == 1 &amp;&amp; event.originalTarget.localName == &quot;image&quot;) ||</span>
<a href="#l5.170"></a><span id="l5.170">             (event.detail == 2 &amp;&amp; event.originalTarget.localName == &quot;label&quot;))</span>
<a href="#l5.171"></a><span id="l5.171">           this.close();</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineplus">+</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineplus">+        if (event.originalTarget.localName == &quot;button&quot;)</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineplus">+          this.hide();</span>
<a href="#l5.175"></a><span id="l5.175">      ]]&gt;</span>
<a href="#l5.176"></a><span id="l5.176">      &lt;/handler&gt;</span>
<a href="#l5.177"></a><span id="l5.177">     &lt;/handlers&gt;</span>
<a href="#l5.178"></a><span id="l5.178">   &lt;/binding&gt;</span>
<a href="#l5.179"></a><span id="l5.179"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/im/locales/en-US/chrome/instantbird/instantbird.dtd</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/im/locales/en-US/chrome/instantbird/instantbird.dtd</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -85,22 +85,28 @@</span>
<a href="#l6.4"></a><span id="l6.4"> &lt;!ENTITY deleteCmd.label               &quot;Remove&quot;&gt;</span>
<a href="#l6.5"></a><span id="l6.5"> &lt;!ENTITY deleteCmd.accesskey           &quot;v&quot;&gt;</span>
<a href="#l6.6"></a><span id="l6.6"> &lt;!ENTITY moveCmd.label                 &quot;Move to&quot;&gt;</span>
<a href="#l6.7"></a><span id="l6.7"> &lt;!ENTITY moveCmd.accesskey             &quot;M&quot;&gt;</span>
<a href="#l6.8"></a><span id="l6.8"> &lt;!ENTITY moveNewTagCmd.label           &quot;New Group&quot;&gt;</span>
<a href="#l6.9"></a><span id="l6.9"> &lt;!ENTITY moveNewTagCmd.accesskey       &quot;N&quot;&gt;</span>
<a href="#l6.10"></a><span id="l6.10"> &lt;!ENTITY showLogsCmd.label             &quot;Show Logs&quot;&gt;</span>
<a href="#l6.11"></a><span id="l6.11"> &lt;!ENTITY showLogsCmd.accesskey         &quot;L&quot;&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+&lt;!ENTITY hideTagCmd.label              &quot;Hide Tag&quot;&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+&lt;!ENTITY hideTagCmd.accesskey          &quot;H&quot;&gt;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+&lt;!ENTITY visibleTagsCmd.label          &quot;Visible Tags&quot;&gt;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+&lt;!ENTITY visibleTagsCmd.accesskey      &quot;V&quot;&gt;</span>
<a href="#l6.16"></a><span id="l6.16"> &lt;!ENTITY showOfflineBuddiesCmd.label   &quot;Show offline buddies&quot;&gt;</span>
<a href="#l6.17"></a><span id="l6.17"> &lt;!ENTITY showOfflineBuddiesCmd.accesskey &quot;o&quot;&gt;</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19"> &lt;!ENTITY expandContactTooltip          &quot;Expand&quot;&gt;</span>
<a href="#l6.20"></a><span id="l6.20"> &lt;!ENTITY collapseContactTooltip        &quot;Collapse&quot;&gt;</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+&lt;!ENTITY hideGroupTooltip              &quot;Hide&quot;&gt;</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+</span>
<a href="#l6.24"></a><span id="l6.24"> &lt;!-- Copied from mozilla/browser/locales/en-US/chrome/browser/baseMenuOverlay.dtd --&gt;</span>
<a href="#l6.25"></a><span id="l6.25"> &lt;!--  Mac OS X Window Menu --&gt;</span>
<a href="#l6.26"></a><span id="l6.26"> &lt;!ENTITY windowMenu.label &quot;Window&quot;&gt;</span>
<a href="#l6.27"></a><span id="l6.27"> &lt;!ENTITY minimizeWindow.label &quot;Minimize&quot;&gt;</span>
<a href="#l6.28"></a><span id="l6.28"> &lt;!ENTITY minimizeWindow.key &quot;m&quot;&gt;</span>
<a href="#l6.29"></a><span id="l6.29"> &lt;!ENTITY bringAllToFront.label &quot;Bring All to Front&quot;&gt;</span>
<a href="#l6.30"></a><span id="l6.30"> &lt;!ENTITY zoomWindow.label &quot;Zoom&quot;&gt;</span>
<a href="#l6.31"></a><span id="l6.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/im/locales/en-US/chrome/instantbird/instantbird.properties</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/im/locales/en-US/chrome/instantbird/instantbird.properties</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -29,16 +29,34 @@ buddy.deletePrompt.title=Delete %S?</span>
<a href="#l7.4"></a><span id="l7.4"> # at this prompt.</span>
<a href="#l7.5"></a><span id="l7.5"> buddy.deletePrompt.message=%S will be permanently removed from your %S buddy list if you continue.</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> #LOCALIZATION NOTE</span>
<a href="#l7.8"></a><span id="l7.8"> # the &amp; symbol indicates the position of the character that should be</span>
<a href="#l7.9"></a><span id="l7.9"> # used as the accesskey for this button.</span>
<a href="#l7.10"></a><span id="l7.10"> buddy.deletePrompt.button=&amp;Delete</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+group.otherContacts.name=Other Contacts</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+#LOCALIZATION NOTE</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+# %S here will be replaced by the tag name</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+group.hidePrompt.title=Hide %S?</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+#LOCALIZATION NOTE %S here will be replaced by the tag name.</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+# The translation for 'Visible Tags' here should match the translation of</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+# visibleTagsCmd.label in instantbird.dtd</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+# The translation for 'Other Contacts' should match group.otherContacts.name</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+group.hidePrompt.message=The tag '%S' will no longer be visible. Use the 'Visible Tags' context menu item to show it again.\n\nContacts that have no visible tag will be displayed in the 'Other Contacts' special group at the bottom of the list.</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+#LOCALIZATION NOTE</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+# the &amp; symbol indicates the position of the character that should be</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+# used as the accesskey for this button.</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+group.hidePrompt.button=&amp;Hide</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+group.hidePrompt.checkbox=Show next time</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+</span>
<a href="#l7.30"></a><span id="l7.30"> availableStatusType=Available</span>
<a href="#l7.31"></a><span id="l7.31"> awayStatusType=Away</span>
<a href="#l7.32"></a><span id="l7.32"> unavailableStatusType=Unavailable</span>
<a href="#l7.33"></a><span id="l7.33"> offlineStatusType=Offline</span>
<a href="#l7.34"></a><span id="l7.34"> invisibleStatusType=Invisible</span>
<a href="#l7.35"></a><span id="l7.35"> idleStatusType=Idle</span>
<a href="#l7.36"></a><span id="l7.36"> mobileStatusType=Mobile</span>
<a href="#l7.37"></a><span id="l7.37"> #LOCALIZATION NOTE</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/im/themes/blist.css</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/im/themes/blist.css</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -94,27 +94,51 @@ buddy[droptarget] {</span>
<a href="#l8.4"></a><span id="l8.4">   overflow-x: hidden;</span>
<a href="#l8.5"></a><span id="l8.5"> }</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> /* Avoid a strange jumping bug when hovering and the startChatBubble appears */</span>
<a href="#l8.8"></a><span id="l8.8"> .contact-vbox {</span>
<a href="#l8.9"></a><span id="l8.9">   min-height: 40px;</span>
<a href="#l8.10"></a><span id="l8.10"> }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+.hideGroupButton,</span>
<a href="#l8.13"></a><span id="l8.13"> .startChatBubble,</span>
<a href="#l8.14"></a><span id="l8.14"> .expander-up,</span>
<a href="#l8.15"></a><span id="l8.15"> .expander-down {</span>
<a href="#l8.16"></a><span id="l8.16">   margin: 0 3px;</span>
<a href="#l8.17"></a><span id="l8.17">   padding: 0;</span>
<a href="#l8.18"></a><span id="l8.18">   border: none;</span>
<a href="#l8.19"></a><span id="l8.19">   background: transparent;</span>
<a href="#l8.20"></a><span id="l8.20">   -moz-binding: url('chrome://global/content/bindings/button.xml#button-image');</span>
<a href="#l8.21"></a><span id="l8.21">   -moz-appearance: none;</span>
<a href="#l8.22"></a><span id="l8.22"> }</span>
<a href="#l8.23"></a><span id="l8.23"> </span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+%ifdef XP_UNIX</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+%ifndef XP_MACOSX</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+%define UNIX_BUT_NOT_MAC</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+%endif</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+%endif</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+.hideGroupButton {</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+  -moz-margin-end: 0;</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+  -moz-stack-sizing: ignore;</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+%ifdef UNIX_BUT_NOT_MAC</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+  list-style-image: url(&quot;moz-icon://stock/gtk-close?size=menu&quot;);</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+%else</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/close.png&quot;);</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+  -moz-image-region: rect(0, 16px, 16px, 0);</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+}</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+.hideGroupButton:hover {</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+  -moz-image-region: rect(0, 32px, 16px, 16px);</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+}</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+.hideGroupButton:hover:active {</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+  -moz-image-region: rect(0, 48px, 16px, 32px);</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+%endif</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+}</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+</span>
<a href="#l8.47"></a><span id="l8.47"> .startChatBubble {</span>
<a href="#l8.48"></a><span id="l8.48">   list-style-image: url('chrome://instantbird/skin/prpl-generic/icon.png');</span>
<a href="#l8.49"></a><span id="l8.49"> }</span>
<a href="#l8.50"></a><span id="l8.50"> </span>
<a href="#l8.51"></a><span id="l8.51"> .expander-up {</span>
<a href="#l8.52"></a><span id="l8.52">   list-style-image: url(&quot;chrome://instantbird/skin/collapse.png&quot;);</span>
<a href="#l8.53"></a><span id="l8.53"> }</span>
<a href="#l8.54"></a><span id="l8.54"> </span>
<a href="#l8.55"></a><span id="l8.55" class="difflineat">@@ -130,17 +154,19 @@ buddy[droptarget] {</span>
<a href="#l8.56"></a><span id="l8.56"> .prplBuddyIcon {</span>
<a href="#l8.57"></a><span id="l8.57">   margin: 0 3px;</span>
<a href="#l8.58"></a><span id="l8.58">   width: 16px;</span>
<a href="#l8.59"></a><span id="l8.59">   max-width: 16px;</span>
<a href="#l8.60"></a><span id="l8.60">   height: 16px;</span>
<a href="#l8.61"></a><span id="l8.61">   max-height: 16px;</span>
<a href="#l8.62"></a><span id="l8.62"> }</span>
<a href="#l8.63"></a><span id="l8.63"> </span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-.protoIcon, .statusIcon, .startChatBubble, .expander-up, .expander-down {</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+.protoIcon, .statusIcon,</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+.hideGroupButton, .startChatBubble,</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+.expander-up, .expander-down {</span>
<a href="#l8.68"></a><span id="l8.68">   width: 16px;</span>
<a href="#l8.69"></a><span id="l8.69">   height: 16px;</span>
<a href="#l8.70"></a><span id="l8.70">   min-height: 16px;</span>
<a href="#l8.71"></a><span id="l8.71">   min-width: 16px;</span>
<a href="#l8.72"></a><span id="l8.72"> }</span>
<a href="#l8.73"></a><span id="l8.73"> </span>
<a href="#l8.74"></a><span id="l8.74"> group label {</span>
<a href="#l8.75"></a><span id="l8.75">   margin: 0 2px;</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineat">@@ -201,16 +227,17 @@ group .twisty {</span>
<a href="#l8.77"></a><span id="l8.77"> </span>
<a href="#l8.78"></a><span id="l8.78"> group[closed] .twisty {</span>
<a href="#l8.79"></a><span id="l8.79">   background: url(&quot;chrome://global/skin/tree/twisty-clsd.png&quot;) no-repeat center;</span>
<a href="#l8.80"></a><span id="l8.80"> }</span>
<a href="#l8.81"></a><span id="l8.81"> %else</span>
<a href="#l8.82"></a><span id="l8.82"> %ifdef XP_MACOSX</span>
<a href="#l8.83"></a><span id="l8.83"> group .twisty {</span>
<a href="#l8.84"></a><span id="l8.84">   width: 9px;</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+  height: 9px;</span>
<a href="#l8.86"></a><span id="l8.86">   -moz-margin-end: 3px;</span>
<a href="#l8.87"></a><span id="l8.87">   -moz-margin-start: 3px;</span>
<a href="#l8.88"></a><span id="l8.88">   background: url(&quot;chrome://global/skin/arrow/arrow-dn-sharp.gif&quot;) no-repeat center;</span>
<a href="#l8.89"></a><span id="l8.89"> }</span>
<a href="#l8.90"></a><span id="l8.90"> </span>
<a href="#l8.91"></a><span id="l8.91"> group[closed] .twisty {</span>
<a href="#l8.92"></a><span id="l8.92">   background: url(&quot;chrome://global/skin/arrow/arrow-rit-sharp.gif&quot;) no-repeat center;</span>
<a href="#l8.93"></a><span id="l8.93"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/purple/purplexpcom/public/imIContactsService.idl</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/purple/purplexpcom/public/imIContactsService.idl</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -72,16 +72,22 @@ interface imITagsService: nsISupports {</span>
<a href="#l9.4"></a><span id="l9.4">   // Get an existing tag by (numeric) id. Returns null if not found.</span>
<a href="#l9.5"></a><span id="l9.5">   imITag getTagById(in long aId);</span>
<a href="#l9.6"></a><span id="l9.6">   // Get an existing tag by name (will do an SQL query). Returns null</span>
<a href="#l9.7"></a><span id="l9.7">   // if not found.</span>
<a href="#l9.8"></a><span id="l9.8">   imITag getTagByName(in AUTF8String aName);</span>
<a href="#l9.9"></a><span id="l9.9">   // Get an array of all existing tags.</span>
<a href="#l9.10"></a><span id="l9.10">   void getTags([optional] out unsigned long tagCount,</span>
<a href="#l9.11"></a><span id="l9.11">                [retval, array, size_is(tagCount)] out imITag tags);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  boolean isTagHidden(in imITag aTag);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  void hideTag(in imITag aTag);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+  void showTag(in imITag aTag);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+  readonly attribute imITag otherContactsTag;</span>
<a href="#l9.18"></a><span id="l9.18"> };</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20"> [scriptable, uuid(c211e5e2-f0a4-4a86-9e4c-3f6b905628a5)]</span>
<a href="#l9.21"></a><span id="l9.21"> interface imITag: nsISupports {</span>
<a href="#l9.22"></a><span id="l9.22">   readonly attribute long id;</span>
<a href="#l9.23"></a><span id="l9.23">            attribute AUTF8String name;</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25">   // Get an array of all the contacts associated with this tag.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/purple/purplexpcom/src/imContacts.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/purple/purplexpcom/src/imContacts.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -86,16 +86,24 @@ TagsService.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">   },</span>
<a href="#l10.5"></a><span id="l10.5">   // Get an array of all existing tags.</span>
<a href="#l10.6"></a><span id="l10.6">   getTags: function(aTagCount) {</span>
<a href="#l10.7"></a><span id="l10.7">     if (aTagCount)</span>
<a href="#l10.8"></a><span id="l10.8">       aTagCount.value = Tags.length;</span>
<a href="#l10.9"></a><span id="l10.9">     return Tags;</span>
<a href="#l10.10"></a><span id="l10.10">   },</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+  isTagHidden: function(aTag) aTag.id in otherContactsTag._hiddenTags,</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  hideTag: function(aTag) { otherContactsTag.hideTag(aTag); },</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+  showTag: function(aTag) { otherContactsTag.showTag(aTag); },</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+  get otherContactsTag() {</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+    otherContactsTag._initContacts();</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+    return otherContactsTag;</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+  },</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+</span>
<a href="#l10.20"></a><span id="l10.20">   QueryInterface: XPCOMUtils.generateQI([Ci.imITagsService]),</span>
<a href="#l10.21"></a><span id="l10.21">   classDescription: &quot;Tags&quot;,</span>
<a href="#l10.22"></a><span id="l10.22">   classID: Components.ID(&quot;{1fa92237-4303-4384-b8ac-4e65b50810a5}&quot;),</span>
<a href="#l10.23"></a><span id="l10.23">   contractID: &quot;@instantbird.org/purple/tags-service;1&quot;</span>
<a href="#l10.24"></a><span id="l10.24"> };</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26"> // TODO move into the tagsService</span>
<a href="#l10.27"></a><span id="l10.27"> var Tags = [];</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineat">@@ -154,16 +162,144 @@ Tag.prototype = {</span>
<a href="#l10.29"></a><span id="l10.29">     return interfaces;</span>
<a href="#l10.30"></a><span id="l10.30">   },</span>
<a href="#l10.31"></a><span id="l10.31">   getHelperForLanguage: function(language) null,</span>
<a href="#l10.32"></a><span id="l10.32">   implementationLanguage: Ci.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l10.33"></a><span id="l10.33">   flags: 0,</span>
<a href="#l10.34"></a><span id="l10.34">   QueryInterface: XPCOMUtils.generateQI([Ci.imITag, Ci.nsIClassInfo])</span>
<a href="#l10.35"></a><span id="l10.35"> };</span>
<a href="#l10.36"></a><span id="l10.36"> </span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+var otherContactsTag = {</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+  hiddenTagsPref: &quot;messenger.buddies.hiddenTags&quot;,</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+  _hiddenTags: {},</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+  _contactsInitialized: false,</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+  _saveHiddenTagsPref: function() {</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+    Services.prefs.setCharPref(this.hiddenTagsPref,</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+                               [id for (id in this._hiddenTags)].join(&quot;,&quot;));</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+  },</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+  showTag: function(aTag) {</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+    aTag.removeObserver(this);</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+    let id = aTag.id;</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+    delete this._hiddenTags[id];</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+    for each (let contact in this._contacts)</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+      if (contact.getTags().some(function(t) t.id == id))</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+        this._removeContact(contact);</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+    aTag.notifyObservers(aTag, &quot;tag-shown&quot;, null);</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+    Services.obs.notifyObservers(aTag, &quot;tag-shown&quot;, null);</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+    this._saveHiddenTagsPref();</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+  },</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+  hideTag: function(aTag) {</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+    if (aTag.id &lt; 0 || aTag.id in otherContactsTag._hiddenTags)</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+      return;</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+    this._hiddenTags[aTag.id] = aTag;</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+    if (this._contactsInitialized)</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+      this._hideTag(aTag);</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+    aTag.notifyObservers(aTag, &quot;tag-hidden&quot;, null);</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+    Services.obs.notifyObservers(aTag, &quot;tag-hidden&quot;, null);</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+    this._saveHiddenTagsPref();</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+  },</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+  _hideTag: function(aTag) {</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+    for each (let contact in aTag.getContacts())</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+      if (!(contact.id in this._contacts) &amp;&amp;</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+          contact.getTags().every(function(t) t.id in this._hiddenTags, this))</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+        this._addContact(contact);</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+    aTag.addObserver(this);</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+  },</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+  observe: function(aSubject, aTopic, aData) {</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+    if (aTopic != &quot;contact-moved-in&quot; &amp;&amp; aTopic != &quot;contact-moved-out&quot;)</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+      return;</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+    try {</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+      aSubject.QueryInterface(Ci.imIContact);</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+    } catch (e) {</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+      // TODO Most likely, aSubject is a tag. If a tag was added to a</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+      // contact we currently track, we should check that the new tag</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+      // is hidden, and if it is not, remove the contact from the</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+      // 'other contacts' group.</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+    }</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+    if (aTopic == &quot;contact-moved-in&quot; &amp;&amp; !(aSubject.id in this._contacts) &amp;&amp;</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+        aSubject.getTags().every(function(t) t.id in this._hiddenTags, this))</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+      this._addContact(aSubject);</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+    else if (aTopic == &quot;contact-moved-out&quot; &amp;&amp; aSubject.id in this._contacts &amp;&amp;</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+             aSubject.getTags().some(function(t) !(t.id in this._hiddenTags)))</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+      this._removeContact(aSubject);</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+  },</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineplus">+  _initHiddenTags: function() {</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+    let pref = Services.prefs.getCharPref(this.hiddenTagsPref);</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+    if (!pref)</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+      return;</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineplus">+    for each (let tagId in pref.split(&quot;,&quot;))</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineplus">+      this._hiddenTags[tagId] = TagsById[tagId];</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineplus">+  },</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+  _initContacts: function() {</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineplus">+    if (this._contactsInitialized)</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+      return;</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+    this._observers = [];</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+    this._observer = {observe: this.notifyObservers.bind(this)};</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+    this._contacts = {};</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineplus">+    this._contactsInitialized = true;</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+    for each (let tag in this._hiddenTags)</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+      this._hideTag(tag);</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+  },</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineplus">+  // imITag implementation</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineplus">+  get id() -1,</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+  get name() &quot;__others__&quot;,</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineplus">+  set name(aNewName) { throw Cr.NS_ERROR_NOT_AVAILABLE; },</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineplus">+  getContacts: function(aContactCount) {</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+    let contacts = [contact for each (contact in this._contacts)];</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineplus">+    if (aContactCount)</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineplus">+      aContactCount.value = contacts.length;</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineplus">+    return contacts;</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineplus">+  },</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineplus">+  _addContact: function (aContact) {</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+    this._contacts[aContact.id] = aContact;</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineplus">+    this.notifyObservers(aContact, &quot;contact-moved-in&quot;);</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineplus">+    for each (let observer in ContactsById[aContact.id]._observers)</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineplus">+      observer.observe(this, &quot;contact-moved-in&quot;, null);</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineplus">+    aContact.addObserver(this._observer);</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineplus">+  },</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineplus">+  _removeContact: function (aContact) {</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineplus">+    delete this._contacts[aContact.id];</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineplus">+    aContact.removeObserver(this._observer);</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineplus">+    this.notifyObservers(aContact, &quot;contact-moved-out&quot;);</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineplus">+    for each (let observer in ContactsById[aContact.id]._observers)</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineplus">+      observer.observe(this, &quot;contact-moved-out&quot;, null);</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineplus">+  },</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineplus">+</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineplus">+  addObserver: function(aObserver) {</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineplus">+    if (this._observers.indexOf(aObserver) == -1)</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineplus">+      this._observers.push(aObserver);</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineplus">+  },</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineplus">+  removeObserver: function(aObserver) {</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineplus">+    this._observers = this._observers.filter(function(o) o !== aObserver);</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineplus">+  },</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineplus">+  notifyObservers: function(aSubject, aTopic, aData) {</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineplus">+    for each (let observer in this._observers)</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineplus">+      observer.observe(aSubject, aTopic, aData);</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineplus">+  },</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineplus">+</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineplus">+  getInterfaces: function(countRef) {</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineplus">+    var interfaces = [Ci.nsIClassInfo, Ci.nsISupports, Ci.nsIObserver, Ci.imITag];</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineplus">+    countRef.value = interfaces.length;</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineplus">+    return interfaces;</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineplus">+  },</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineplus">+  getHelperForLanguage: function(language) null,</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineplus">+  implementationLanguage: Ci.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineplus">+  flags: 0,</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Ci.imITag, Ci.nsIObserver, Ci.nsIClassInfo])</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineplus">+};</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineplus">+</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineplus">+</span>
<a href="#l10.165"></a><span id="l10.165"> var ContactsById = { };</span>
<a href="#l10.166"></a><span id="l10.166"> var LastDummyContactId = 0;</span>
<a href="#l10.167"></a><span id="l10.167"> function Contact(aId, aAlias) {</span>
<a href="#l10.168"></a><span id="l10.168">   // Assign a negative id to dummy contacts that have a single buddy</span>
<a href="#l10.169"></a><span id="l10.169">   this._id = aId || --LastDummyContactId;</span>
<a href="#l10.170"></a><span id="l10.170">   this._alias = aAlias;</span>
<a href="#l10.171"></a><span id="l10.171">   this._tags = [];</span>
<a href="#l10.172"></a><span id="l10.172">   this._buddies = [];</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineat">@@ -986,16 +1122,18 @@ ContactsService.prototype = {</span>
<a href="#l10.174"></a><span id="l10.174">           buddy._addAccount(ab, tag);</span>
<a href="#l10.175"></a><span id="l10.175">       } catch (e) {</span>
<a href="#l10.176"></a><span id="l10.176">         // FIXME ab shouldn't be NULL (once purpleAccount is finished)</span>
<a href="#l10.177"></a><span id="l10.177">         // It currently doesn't work write with unknown protocols.</span>
<a href="#l10.178"></a><span id="l10.178">         Components.utils.reportError(e);</span>
<a href="#l10.179"></a><span id="l10.179">         dump(e + &quot;\n&quot;);</span>
<a href="#l10.180"></a><span id="l10.180">       }</span>
<a href="#l10.181"></a><span id="l10.181">     }</span>
<a href="#l10.182"></a><span id="l10.182" class="difflineplus">+</span>
<a href="#l10.183"></a><span id="l10.183" class="difflineplus">+    otherContactsTag._initHiddenTags();</span>
<a href="#l10.184"></a><span id="l10.184">   },</span>
<a href="#l10.185"></a><span id="l10.185">   unInitContacts: function() {</span>
<a href="#l10.186"></a><span id="l10.186">     AccountsById = { };</span>
<a href="#l10.187"></a><span id="l10.187">     Tags = [];</span>
<a href="#l10.188"></a><span id="l10.188">     TagsById = { };</span>
<a href="#l10.189"></a><span id="l10.189">     // Avoid shutdown leaks caused by references to native components</span>
<a href="#l10.190"></a><span id="l10.190">     // implementing imIAccountBuddy.</span>
<a href="#l10.191"></a><span id="l10.191">     for each (let buddy in BuddiesById)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

