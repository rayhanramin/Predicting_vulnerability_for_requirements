<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 14109:8a8d970b6103f9bf4f6687b0388a046873a49173</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 8a8d970b6103f9bf4f6687b0388a046873a49173" />
<meta property="og:url" content="/comm-central/rev/8a8d970b6103f9bf4f6687b0388a046873a49173" />
<meta property="og:description" content="Add a (pref'ed off by default) popup notification for incoming messages when the conversation windows are inactive." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 8a8d970b6103f9bf4f6687b0388a046873a49173 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/8a8d970b6103f9bf4f6687b0388a046873a49173">shortlog</a> |
<a href="/comm-central/log/8a8d970b6103f9bf4f6687b0388a046873a49173">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/8a8d970b6103f9bf4f6687b0388a046873a49173">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/8a8d970b6103f9bf4f6687b0388a046873a49173">files</a> |
changeset |
<a href="/comm-central/raw-rev/8a8d970b6103f9bf4f6687b0388a046873a49173">raw</a>  | <a href="/comm-central/archive/8a8d970b6103f9bf4f6687b0388a046873a49173.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Add a (pref'ed off by default) popup notification for incoming messages when the conversation windows are inactive.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#108;&#111;&#114;&#105;&#97;&#110;&#32;&#81;&#117;&#232;&#122;&#101;&#32;&#60;&#102;&#108;&#111;&#114;&#105;&#97;&#110;&#64;&#105;&#110;&#115;&#116;&#97;&#110;&#116;&#98;&#105;&#114;&#100;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 24 Sep 2009 16:25:32 +0200</td></tr>

<tr>
 <td>changeset 14109</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/8a8d970b6103f9bf4f6687b0388a046873a49173">8a8d970b6103f9bf4f6687b0388a046873a49173</a></td>
</tr>



<tr>
<td>parent 14108</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8b6c8e0a7692567199fa95213897c3dd81d3fd70">8b6c8e0a7692567199fa95213897c3dd81d3fd70</a>
</td>
</tr>

<tr>
<td>child 14110</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/735d23e577e3fd5d93d4fba05e264d5b4252a091">735d23e577e3fd5d93d4fba05e264d5b4252a091</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=8a8d970b6103f9bf4f6687b0388a046873a49173">9778</a></td></tr>
<tr><td>push user</td><td>florian@queze.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 12 Jan 2014 18:25:45 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f81a23bfefcd [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>






</table></div>

<div class="page_body description">Add a (pref'ed off by default) popup notification for incoming messages when the conversation windows are inactive.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8a8d970b6103f9bf4f6687b0388a046873a49173/im/app/profile/all-instantbird.js">im/app/profile/all-instantbird.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a8d970b6103f9bf4f6687b0388a046873a49173/im/app/profile/all-instantbird.js">file</a> |
<a href="/comm-central/annotate/8a8d970b6103f9bf4f6687b0388a046873a49173/im/app/profile/all-instantbird.js">annotate</a> |
<a href="/comm-central/diff/8a8d970b6103f9bf4f6687b0388a046873a49173/im/app/profile/all-instantbird.js">diff</a> |
<a href="/comm-central/comparison/8a8d970b6103f9bf4f6687b0388a046873a49173/im/app/profile/all-instantbird.js">comparison</a> |
<a href="/comm-central/log/8a8d970b6103f9bf4f6687b0388a046873a49173/im/app/profile/all-instantbird.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8a8d970b6103f9bf4f6687b0388a046873a49173/im/content/instantbird/imWindows.jsm">im/content/instantbird/imWindows.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a8d970b6103f9bf4f6687b0388a046873a49173/im/content/instantbird/imWindows.jsm">file</a> |
<a href="/comm-central/annotate/8a8d970b6103f9bf4f6687b0388a046873a49173/im/content/instantbird/imWindows.jsm">annotate</a> |
<a href="/comm-central/diff/8a8d970b6103f9bf4f6687b0388a046873a49173/im/content/instantbird/imWindows.jsm">diff</a> |
<a href="/comm-central/comparison/8a8d970b6103f9bf4f6687b0388a046873a49173/im/content/instantbird/imWindows.jsm">comparison</a> |
<a href="/comm-central/log/8a8d970b6103f9bf4f6687b0388a046873a49173/im/content/instantbird/imWindows.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/jar.mn">im/themes/winstripe/instantbird/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/jar.mn">file</a> |
<a href="/comm-central/annotate/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/jar.mn">annotate</a> |
<a href="/comm-central/diff/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/jar.mn">diff</a> |
<a href="/comm-central/comparison/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/jar.mn">comparison</a> |
<a href="/comm-central/log/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/newMessage.png">im/themes/winstripe/instantbird/newMessage.png</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/newMessage.png">file</a> |
<a href="/comm-central/annotate/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/newMessage.png">annotate</a> |
<a href="/comm-central/diff/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/newMessage.png">diff</a> |
<a href="/comm-central/comparison/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/newMessage.png">comparison</a> |
<a href="/comm-central/log/8a8d970b6103f9bf4f6687b0388a046873a49173/im/themes/winstripe/instantbird/newMessage.png">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/im/app/profile/all-instantbird.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/im/app/profile/all-instantbird.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -36,16 +36,17 @@ pref(&quot;messenger.conversations.selections</span>
<a href="#l1.4"></a><span id="l1.4"> pref(&quot;messenger.conversations.selections.systemMessagesTemplate&quot;, &quot;chrome://instantbird/locale/instantbird.properties&quot;);</span>
<a href="#l1.5"></a><span id="l1.5"> pref(&quot;messenger.conversations.selections.contentMessagesTemplate&quot;, &quot;chrome://instantbird/locale/instantbird.properties&quot;);</span>
<a href="#l1.6"></a><span id="l1.6"> pref(&quot;messenger.conversations.selections.actionMessagesTemplate&quot;, &quot;chrome://instantbird/locale/instantbird.properties&quot;);</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> pref(&quot;messenger.conversations.textbox.autoResize&quot;, true);</span>
<a href="#l1.9"></a><span id="l1.9"> pref(&quot;messenger.conversations.textbox.defaultMaxLines&quot;, 5);</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> pref(&quot;messenger.options.getAttentionOnNewMessages&quot;, true);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+pref(&quot;messenger.options.notifyOfNewMessages&quot;, false);</span>
<a href="#l1.13"></a><span id="l1.13"> #ifdef XP_MACOSX</span>
<a href="#l1.14"></a><span id="l1.14"> pref(&quot;messenger.options.showUnreadCountInDock&quot;, true);</span>
<a href="#l1.15"></a><span id="l1.15"> #endif</span>
<a href="#l1.16"></a><span id="l1.16"> pref(&quot;messenger.options.playSounds&quot;, true);</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> // this preference changes how we filter incoming messages</span>
<a href="#l1.19"></a><span id="l1.19"> // 0 = no formattings</span>
<a href="#l1.20"></a><span id="l1.20"> // 1 = basic formattings (bold, italic, underlined)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/im/content/instantbird/imWindows.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/im/content/instantbird/imWindows.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -92,16 +92,17 @@ var Conversations = {</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">     this._unreadCount = 0;</span>
<a href="#l2.6"></a><span id="l2.6"> #ifdef XP_MACOSX</span>
<a href="#l2.7"></a><span id="l2.7">     this._hideUnreadCountDockBadge();</span>
<a href="#l2.8"></a><span id="l2.8"> #endif</span>
<a href="#l2.9"></a><span id="l2.9">   },</span>
<a href="#l2.10"></a><span id="l2.10">   _windows: [],</span>
<a href="#l2.11"></a><span id="l2.11">   _getAttentionPrefName: &quot;messenger.options.getAttentionOnNewMessages&quot;,</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  _notificationPrefName: &quot;messenger.options.notifyOfNewMessages&quot;,</span>
<a href="#l2.13"></a><span id="l2.13">   _textboxAutoResizePrefName: &quot;messenger.conversations.textbox.autoResize&quot;,</span>
<a href="#l2.14"></a><span id="l2.14">   get _prefBranch () {</span>
<a href="#l2.15"></a><span id="l2.15">     delete this._prefBranch;</span>
<a href="#l2.16"></a><span id="l2.16">     return this._prefBranch =</span>
<a href="#l2.17"></a><span id="l2.17">       Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l2.18"></a><span id="l2.18">                 .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l2.19"></a><span id="l2.19">   },</span>
<a href="#l2.20"></a><span id="l2.20">   textboxAutoResize: function() {</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -206,16 +207,76 @@ var Conversations = {</span>
<a href="#l2.22"></a><span id="l2.22">     let position = this._windows.indexOf(aWindow);</span>
<a href="#l2.23"></a><span id="l2.23">     if (position != -1) {</span>
<a href="#l2.24"></a><span id="l2.24">       this._windows.splice(position, 1);</span>
<a href="#l2.25"></a><span id="l2.25">       this._windows.unshift(aWindow);</span>
<a href="#l2.26"></a><span id="l2.26">     }</span>
<a href="#l2.27"></a><span id="l2.27">     this._clearUnreadCount();</span>
<a href="#l2.28"></a><span id="l2.28">   },</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+  get ellipsis () {</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+    let ellipsis = &quot;[\u2026]&quot;;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+    try {</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+      ellipsis =</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+        this._prefBranch.getComplexValue(&quot;intl.ellipsis&quot;,</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+                                         Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+    } catch (e) { }</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+    return ellipsis;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+  },</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+  _showMessageNotification: function (aMessage) {</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+    // Get the hidden window. We need it to create a DOM node.</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+    let win = Components.classes[&quot;@mozilla.org/appshell/appShellService;1&quot;]</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+                        .getService(Components.interfaces.nsIAppShellService)</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+                        .hiddenDOMWindow;</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+    // Put the message content into a div node.</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+    let xhtmlElement = win.document.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;div&quot;);</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+    xhtmlElement.innerHTML = aMessage.message;</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+    // Convert the div node content to plain text.</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+    let encoder =</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+      Components.classes[&quot;@mozilla.org/layout/documentEncoder;1?type=text/plain&quot;]</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+                .createInstance(Components.interfaces.nsIDocumentEncoder);</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+    encoder.init(win.document, &quot;text/plain&quot;, 0);</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+    encoder.setNode(xhtmlElement);</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+    let messageText = encoder.encodeToString().replace(/\s+/g, &quot; &quot;);</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+    // Crop the end of the text if needed.</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+    if (messageText.length &gt; 50)</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+      messageText = messageText.substr(0, 50) + this.ellipsis;</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+    // Use the buddy icon if available for the icon of the notification.</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+    let icon;</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+    let conv = aMessage.conversation;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+    if (conv instanceof Components.interfaces.purpleIConvIM) {</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+      let buddy = conv.buddy;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+      if (buddy)</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+        icon = buddy.buddyIconFilename;</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+    }</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+    if (!icon)</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+      icon = &quot;chrome://instantbird/skin/newMessage.png&quot;;</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+    // Prepare an observer to focus the conversation if the</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+    // notification is clicked.</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+    let observer = {</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+      observe: function(aSubject, aTopic, aData) {</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+        if (aTopic == &quot;alertclickcallback&quot;)</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+          Conversations.focusConversation(aMessage.conversation);</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+      }</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+    };</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+    // Finally show the notification!</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+    Components.classes[&quot;@mozilla.org/alerts-service;1&quot;]</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+              .getService(Components.interfaces.nsIAlertsService)</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+              .showAlertNotification(icon, aMessage.alias || aMessage.who,</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+                                     messageText, false, &quot;&quot;, observer);</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+  },</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+</span>
<a href="#l2.90"></a><span id="l2.90">   init: function() {</span>
<a href="#l2.91"></a><span id="l2.91">     let os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l2.92"></a><span id="l2.92">                        .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l2.93"></a><span id="l2.93">     [&quot;new-text&quot;,</span>
<a href="#l2.94"></a><span id="l2.94">      &quot;new-conversation&quot;,</span>
<a href="#l2.95"></a><span id="l2.95">      &quot;purple-quit&quot;,</span>
<a href="#l2.96"></a><span id="l2.96">      &quot;quit-application-requested&quot;].forEach(function (aTopic) {</span>
<a href="#l2.97"></a><span id="l2.97">       os.addObserver(Conversations, aTopic, false);</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineat">@@ -285,14 +346,17 @@ var Conversations = {</span>
<a href="#l2.99"></a><span id="l2.99">       let conv = this._purpleConv[aSubject.conversation.id];</span>
<a href="#l2.100"></a><span id="l2.100">       if (!conv.loaded)</span>
<a href="#l2.101"></a><span id="l2.101">         conv.addMsg(aSubject);</span>
<a href="#l2.102"></a><span id="l2.102">       if (aSubject.incoming &amp;&amp; !aSubject.system &amp;&amp;</span>
<a href="#l2.103"></a><span id="l2.103">           (!(aSubject.conversation instanceof Components.interfaces.purpleIConvChat) ||</span>
<a href="#l2.104"></a><span id="l2.104">            aSubject.containsNick)) {</span>
<a href="#l2.105"></a><span id="l2.105">         if (this._prefBranch.getBoolPref(this._getAttentionPrefName))</span>
<a href="#l2.106"></a><span id="l2.106">           conv.ownerDocument.defaultView.getAttention();</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-        if (!this._windows[0].document.hasFocus())</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+        if (!this._windows[0].document.hasFocus()) {</span>
<a href="#l2.109"></a><span id="l2.109">           this._incrementUnreadCount();</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineplus">+          if (this._prefBranch.getBoolPref(this._notificationPrefName))</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineplus">+            this._showMessageNotification(aSubject);</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineplus">+        }</span>
<a href="#l2.113"></a><span id="l2.113">       }</span>
<a href="#l2.114"></a><span id="l2.114">     }</span>
<a href="#l2.115"></a><span id="l2.115">   }</span>
<a href="#l2.116"></a><span id="l2.116"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/im/themes/winstripe/instantbird/jar.mn</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/im/themes/winstripe/instantbird/jar.mn</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -20,16 +20,17 @@ classic.jar:</span>
<a href="#l3.4"></a><span id="l3.4"> 	skin/classic/instantbird/operator.png</span>
<a href="#l3.5"></a><span id="l3.5"> 	skin/classic/instantbird/half-operator.png</span>
<a href="#l3.6"></a><span id="l3.6"> 	skin/classic/instantbird/voice.png</span>
<a href="#l3.7"></a><span id="l3.7"> *	skin/classic/instantbird/blist.css</span>
<a href="#l3.8"></a><span id="l3.8"> 	skin/classic/instantbird/conv.css</span>
<a href="#l3.9"></a><span id="l3.9"> *	skin/classic/instantbird/conversation.css</span>
<a href="#l3.10"></a><span id="l3.10"> *	skin/classic/instantbird/engineManager.css</span>
<a href="#l3.11"></a><span id="l3.11"> *	skin/classic/instantbird/instantbird.css</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+	skin/classic/instantbird/newMessage.png</span>
<a href="#l3.13"></a><span id="l3.13"> 	skin/classic/instantbird/prpl-generic/icon32.png	(prpl/prpl-generic-32.png)</span>
<a href="#l3.14"></a><span id="l3.14"> 	skin/classic/instantbird/prpl-generic/icon48.png	(prpl/prpl-generic-48.png)</span>
<a href="#l3.15"></a><span id="l3.15"> 	skin/classic/instantbird/prpl-generic/icon.png		(prpl/prpl-generic.png)</span>
<a href="#l3.16"></a><span id="l3.16"> 	skin/classic/instantbird/prpl-unknown/icon32.png	(prpl/prpl-unknown-32.png)</span>
<a href="#l3.17"></a><span id="l3.17"> 	skin/classic/instantbird/prpl-unknown/icon48.png	(prpl/prpl-unknown-48.png)</span>
<a href="#l3.18"></a><span id="l3.18"> 	skin/classic/instantbird/prpl-unknown/icon.png		(prpl/prpl-unknown.png)</span>
<a href="#l3.19"></a><span id="l3.19"> % skin prpl-aim classic/1.0 %skin/classic/prpl/aim/</span>
<a href="#l3.20"></a><span id="l3.20"> 	skin/classic/prpl/aim/icon32.png	(prpl/prpl-aim-32.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">new file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..f1ee363a9b152e9dd7814e3253db0acb573d7b0c</span>
<a href="#l4.3"></a><span id="l4.3">GIT binary patch
literal 1955
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/span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

