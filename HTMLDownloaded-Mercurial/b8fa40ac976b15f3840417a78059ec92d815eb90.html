<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 23731:b8fa40ac976b15f3840417a78059ec92d815eb90</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ b8fa40ac976b15f3840417a78059ec92d815eb90" />
<meta property="og:url" content="/comm-central/rev/b8fa40ac976b15f3840417a78059ec92d815eb90" />
<meta property="og:description" content="Bug 1440490 - Move l10n related functions into calL10NUtils.jsm - part 4 - Migrate getLtnString. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / b8fa40ac976b15f3840417a78059ec92d815eb90 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/b8fa40ac976b15f3840417a78059ec92d815eb90">shortlog</a> |
<a href="/comm-central/log/b8fa40ac976b15f3840417a78059ec92d815eb90">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/b8fa40ac976b15f3840417a78059ec92d815eb90">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/b8fa40ac976b15f3840417a78059ec92d815eb90">files</a> |
changeset |
<a href="/comm-central/raw-rev/b8fa40ac976b15f3840417a78059ec92d815eb90">raw</a>  | <a href="/comm-central/archive/b8fa40ac976b15f3840417a78059ec92d815eb90.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1440490">Bug 1440490</a> - Move l10n related functions into calL10NUtils.jsm - part 4 - Migrate getLtnString. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 22 Feb 2018 07:47:47 +0100</td></tr>

<tr>
 <td>changeset 23731</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/b8fa40ac976b15f3840417a78059ec92d815eb90">b8fa40ac976b15f3840417a78059ec92d815eb90</a></td>
</tr>



<tr>
<td>parent 23730</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2530e8642a6199bb05de5281d1df7f91936e8b37">2530e8642a6199bb05de5281d1df7f91936e8b37</a>
</td>
</tr>

<tr>
<td>child 23732</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/605e1e0382bd4e9b972616eb87d63af3a24c08ba">605e1e0382bd4e9b972616eb87d63af3a24c08ba</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=b8fa40ac976b15f3840417a78059ec92d815eb90">14318</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Sat, 14 Apr 2018 20:53:18 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@56a8323d4235 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=56a8323d4235bb4edbc60b455d3590100a4af34d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=56a8323d4235bb4edbc60b455d3590100a4af34d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=56a8323d4235bb4edbc60b455d3590100a4af34d&newProject=comm-central&newRevision=2a4475b8555b7ca273fa96b199621a4360d510f7&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=56a8323d4235bb4edbc60b455d3590100a4af34d&newProject=comm-central&newRevision=2a4475b8555b7ca273fa96b199621a4360d510f7&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=56a8323d4235bb4edbc60b455d3590100a4af34d&newProject=comm-central&newRevision=2a4475b8555b7ca273fa96b199621a4360d510f7&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1440490">1440490</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1440490">Bug 1440490</a> - Move l10n related functions into calL10NUtils.jsm - part 4 - Migrate getLtnString. r=MakeMyDay

MozReview-Commit-ID: DRN181PLsSh</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/itip/calItipEmailTransport.js">calendar/itip/calItipEmailTransport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/itip/calItipEmailTransport.js">file</a> |
<a href="/comm-central/annotate/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/itip/calItipEmailTransport.js">annotate</a> |
<a href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/itip/calItipEmailTransport.js">diff</a> |
<a href="/comm-central/comparison/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/itip/calItipEmailTransport.js">comparison</a> |
<a href="/comm-central/log/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/itip/calItipEmailTransport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/imip-bar.js">calendar/lightning/content/imip-bar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/imip-bar.js">file</a> |
<a href="/comm-central/annotate/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/imip-bar.js">annotate</a> |
<a href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/imip-bar.js">diff</a> |
<a href="/comm-central/comparison/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/imip-bar.js">comparison</a> |
<a href="/comm-central/log/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/imip-bar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/lightning-utils.js">calendar/lightning/content/lightning-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/lightning-utils.js">file</a> |
<a href="/comm-central/annotate/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/lightning-utils.js">annotate</a> |
<a href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/lightning-utils.js">diff</a> |
<a href="/comm-central/comparison/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/lightning-utils.js">comparison</a> |
<a href="/comm-central/log/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/lightning-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/messenger-overlay-sidebar.js">calendar/lightning/content/messenger-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/messenger-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/messenger-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/messenger-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/messenger-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/content/messenger-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/ltnInvitationUtils.jsm">calendar/lightning/modules/ltnInvitationUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/ltnInvitationUtils.jsm">file</a> |
<a href="/comm-central/annotate/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/ltnInvitationUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/ltnInvitationUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/ltnInvitationUtils.jsm">comparison</a> |
<a href="/comm-central/log/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/ltnInvitationUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/ltnUtils.jsm">calendar/lightning/modules/ltnUtils.jsm</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/ltnUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/ltnUtils.jsm">comparison</a> |
<a href="/comm-central/log/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/ltnUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/moz.build">calendar/lightning/modules/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/moz.build">file</a> |
<a href="/comm-central/annotate/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/moz.build">annotate</a> |
<a href="/comm-central/diff/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/moz.build">diff</a> |
<a href="/comm-central/comparison/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/moz.build">comparison</a> |
<a href="/comm-central/log/b8fa40ac976b15f3840417a78059ec92d815eb90/calendar/lightning/modules/moz.build">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -207,71 +207,51 @@ var calitip = {</span>
<a href="#l1.4"></a><span id="l1.4">      * Gets the suggested text to be shown when an imip item has been processed.</span>
<a href="#l1.5"></a><span id="l1.5">      * This text is ready localized and can be displayed to the user.</span>
<a href="#l1.6"></a><span id="l1.6">      *</span>
<a href="#l1.7"></a><span id="l1.7">      * @param {Number} aStatus         The status of the processing (i.e NS_OK, an error code)</span>
<a href="#l1.8"></a><span id="l1.8">      * @param {Number} aOperationType  An operation type from calIOperationListener</span>
<a href="#l1.9"></a><span id="l1.9">      * @return {String}                The suggested text.</span>
<a href="#l1.10"></a><span id="l1.10">      */</span>
<a href="#l1.11"></a><span id="l1.11">     getCompleteText: function(aStatus, aOperationType) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        /**</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-         * Gets the string from the lightning bundle</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-         * @param {String} strName      The string identifier name</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-         * @param {String} param        An array of parameters for the strgin</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-         * @return {String}             The translated string</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-         */</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-        function _gs(strName, param) {</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-            return cal.calGetString(&quot;lightning&quot;, strName, param, &quot;lightning&quot;);</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-        }</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-</span>
<a href="#l1.22"></a><span id="l1.22">         let text = &quot;&quot;;</span>
<a href="#l1.23"></a><span id="l1.23">         const cIOL = Components.interfaces.calIOperationListener;</span>
<a href="#l1.24"></a><span id="l1.24">         if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l1.25"></a><span id="l1.25">             switch (aOperationType) {</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-                case cIOL.ADD: text = _gs(&quot;imipAddedItemToCal2&quot;); break;</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-                case cIOL.MODIFY: text = _gs(&quot;imipUpdatedItem2&quot;); break;</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-                case cIOL.DELETE: text = _gs(&quot;imipCanceledItem2&quot;); break;</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+                case cIOL.ADD: text = cal.l10n.getLtnString(&quot;imipAddedItemToCal2&quot;); break;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+                case cIOL.MODIFY: text = cal.l10n.getLtnString(&quot;imipUpdatedItem2&quot;); break;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+                case cIOL.DELETE: text = cal.l10n.getLtnString(&quot;imipCanceledItem2&quot;); break;</span>
<a href="#l1.32"></a><span id="l1.32">             }</span>
<a href="#l1.33"></a><span id="l1.33">         } else {</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-            text = _gs(&quot;imipBarProcessingFailed&quot;, [aStatus.toString(16)]);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+            text = cal.l10n.getLtnString(&quot;imipBarProcessingFailed&quot;, [aStatus.toString(16)]);</span>
<a href="#l1.36"></a><span id="l1.36">         }</span>
<a href="#l1.37"></a><span id="l1.37">         return text;</span>
<a href="#l1.38"></a><span id="l1.38">     },</span>
<a href="#l1.39"></a><span id="l1.39"> </span>
<a href="#l1.40"></a><span id="l1.40">     /**</span>
<a href="#l1.41"></a><span id="l1.41">      * Scope: iTIP message receiver</span>
<a href="#l1.42"></a><span id="l1.42">      *</span>
<a href="#l1.43"></a><span id="l1.43">      * Gets a text describing the given itip method. The text is of the form</span>
<a href="#l1.44"></a><span id="l1.44">      * &quot;This Message contains a ... &quot;.</span>
<a href="#l1.45"></a><span id="l1.45">      *</span>
<a href="#l1.46"></a><span id="l1.46">      * @param {String} method      The method to describe.</span>
<a href="#l1.47"></a><span id="l1.47">      * @return {String}            The localized text about the method.</span>
<a href="#l1.48"></a><span id="l1.48">      */</span>
<a href="#l1.49"></a><span id="l1.49">     getMethodText: function(method) {</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-        /**</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-         * Gets the string from the lightning bundle</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-         * @param {String} strName      The string identifier name</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-         * @param {String} param        An array of parameters for the strgin</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-         * @return {String}             The translated string</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-         */</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-        function _gs(strName) {</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineminus">-            return cal.calGetString(&quot;lightning&quot;, strName, null, &quot;lightning&quot;);</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-        }</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-</span>
<a href="#l1.60"></a><span id="l1.60">         switch (method) {</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineminus">-            case &quot;REFRESH&quot;: return _gs(&quot;imipBarRefreshText&quot;);</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-            case &quot;REQUEST&quot;: return _gs(&quot;imipBarRequestText&quot;);</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-            case &quot;PUBLISH&quot;: return _gs(&quot;imipBarPublishText&quot;);</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-            case &quot;CANCEL&quot;: return _gs(&quot;imipBarCancelText&quot;);</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineminus">-            case &quot;REPLY&quot;: return _gs(&quot;imipBarReplyText&quot;);</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-            case &quot;COUNTER&quot;: return _gs(&quot;imipBarCounterText&quot;);</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-            case &quot;DECLINECOUNTER&quot;: return _gs(&quot;imipBarDeclineCounterText&quot;);</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+            case &quot;REFRESH&quot;: return cal.l10n.getLtnString(&quot;imipBarRefreshText&quot;);</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+            case &quot;REQUEST&quot;: return cal.l10n.getLtnString(&quot;imipBarRequestText&quot;);</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+            case &quot;PUBLISH&quot;: return cal.l10n.getLtnString(&quot;imipBarPublishText&quot;);</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+            case &quot;CANCEL&quot;: return cal.l10n.getLtnString(&quot;imipBarCancelText&quot;);</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+            case &quot;REPLY&quot;: return cal.l10n.getLtnString(&quot;imipBarReplyText&quot;);</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+            case &quot;COUNTER&quot;: return cal.l10n.getLtnString(&quot;imipBarCounterText&quot;);</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+            case &quot;DECLINECOUNTER&quot;: return cal.l10n.getLtnString(&quot;imipBarDeclineCounterText&quot;);</span>
<a href="#l1.75"></a><span id="l1.75">             default:</span>
<a href="#l1.76"></a><span id="l1.76">                 cal.ERROR(&quot;Unknown iTIP method: &quot; + method);</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-                return _gs(&quot;imipBarUnsupportedText&quot;);</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+                return cal.l10n.getLtnString(&quot;imipBarUnsupportedText&quot;);</span>
<a href="#l1.79"></a><span id="l1.79">         }</span>
<a href="#l1.80"></a><span id="l1.80">     },</span>
<a href="#l1.81"></a><span id="l1.81"> </span>
<a href="#l1.82"></a><span id="l1.82">     /**</span>
<a href="#l1.83"></a><span id="l1.83">      * Scope: iTIP message receiver</span>
<a href="#l1.84"></a><span id="l1.84">      *</span>
<a href="#l1.85"></a><span id="l1.85">      * Gets localized toolbar label about the message state and triggers buttons to show.</span>
<a href="#l1.86"></a><span id="l1.86">      * This returns a JS object with the following structure:</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineat">@@ -286,92 +266,83 @@ var calitip = {</span>
<a href="#l1.88"></a><span id="l1.88">      * @param {calIItipItem} itipItem       The itipItem to query.</span>
<a href="#l1.89"></a><span id="l1.89">      * @param {Number} rc                   The result of retrieving the item</span>
<a href="#l1.90"></a><span id="l1.90">      * @param {Function} actionFunc         The action function.</span>
<a href="#l1.91"></a><span id="l1.91">      * @param {calIItemBase[]} foundItems   An array of items found while searching for the item</span>
<a href="#l1.92"></a><span id="l1.92">      *                                        in subscribed calendars</span>
<a href="#l1.93"></a><span id="l1.93">      * @return {Object}                     Return information about the options</span>
<a href="#l1.94"></a><span id="l1.94">      */</span>
<a href="#l1.95"></a><span id="l1.95">     getOptionsText: function(itipItem, rc, actionFunc, foundItems) {</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineminus">-        /**</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineminus">-         * Gets the string from the lightning bundle</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineminus">-         * @param {String} strName      The string identifier name</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineminus">-         * @param {String} aParam       An array of parameters for the strgin</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineminus">-         * @return {String}             The translated string</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineminus">-         */</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineminus">-        function _gs(strName, aParam=null) {</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineminus">-            return cal.calGetString(&quot;lightning&quot;, strName, aParam, &quot;lightning&quot;);</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineminus">-        }</span>
<a href="#l1.105"></a><span id="l1.105">         let imipLabel = null;</span>
<a href="#l1.106"></a><span id="l1.106">         if (itipItem.receivedMethod) {</span>
<a href="#l1.107"></a><span id="l1.107">             imipLabel = calitip.getMethodText(itipItem.receivedMethod);</span>
<a href="#l1.108"></a><span id="l1.108">         }</span>
<a href="#l1.109"></a><span id="l1.109">         let data = { label: imipLabel, showItems: [], hideItems: [] };</span>
<a href="#l1.110"></a><span id="l1.110">         let separateButtons = Preferences.get(&quot;calendar.itip.separateInvitationButtons&quot;, false);</span>
<a href="#l1.111"></a><span id="l1.111"> </span>
<a href="#l1.112"></a><span id="l1.112">         let disallowedCounter = false;</span>
<a href="#l1.113"></a><span id="l1.113">         if (foundItems &amp;&amp; foundItems.length) {</span>
<a href="#l1.114"></a><span id="l1.114">             let disallow = foundItems[0].getProperty(&quot;X-MICROSOFT-DISALLOW-COUNTER&quot;);</span>
<a href="#l1.115"></a><span id="l1.115">             disallowedCounter = disallow &amp;&amp; disallow == &quot;TRUE&quot;;</span>
<a href="#l1.116"></a><span id="l1.116">         }</span>
<a href="#l1.117"></a><span id="l1.117">         if (rc == Components.interfaces.calIErrors.CAL_IS_READONLY) {</span>
<a href="#l1.118"></a><span id="l1.118">             // No writable calendars, tell the user about it</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineminus">-            data.label = _gs(&quot;imipBarNotWritable&quot;);</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+            data.label = cal.l10n.getLtnString(&quot;imipBarNotWritable&quot;);</span>
<a href="#l1.121"></a><span id="l1.121">         } else if (Components.isSuccessCode(rc) &amp;&amp; !actionFunc) {</span>
<a href="#l1.122"></a><span id="l1.122">             // This case, they clicked on an old message that has already been</span>
<a href="#l1.123"></a><span id="l1.123">             // added/updated, we want to tell them that.</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineminus">-            data.label = _gs(&quot;imipBarAlreadyProcessedText&quot;);</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineplus">+            data.label = cal.l10n.getLtnString(&quot;imipBarAlreadyProcessedText&quot;);</span>
<a href="#l1.126"></a><span id="l1.126">             if (foundItems &amp;&amp; foundItems.length) {</span>
<a href="#l1.127"></a><span id="l1.127">                 data.showItems.push(&quot;imipDetailsButton&quot;);</span>
<a href="#l1.128"></a><span id="l1.128">                 if (itipItem.receivedMethod == &quot;COUNTER&quot; &amp;&amp; itipItem.sender) {</span>
<a href="#l1.129"></a><span id="l1.129">                     if (disallowedCounter) {</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineminus">-                        data.label = _gs(&quot;imipBarDisallowedCounterText&quot;);</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineplus">+                        data.label = cal.l10n.getLtnString(&quot;imipBarDisallowedCounterText&quot;);</span>
<a href="#l1.132"></a><span id="l1.132">                     } else {</span>
<a href="#l1.133"></a><span id="l1.133">                         let comparison;</span>
<a href="#l1.134"></a><span id="l1.134">                         for (let item of itipItem.getItemList({})) {</span>
<a href="#l1.135"></a><span id="l1.135">                             let attendees = cal.itip.getAttendeesBySender(</span>
<a href="#l1.136"></a><span id="l1.136">                                     item.getAttendees({}),</span>
<a href="#l1.137"></a><span id="l1.137">                                     itipItem.sender</span>
<a href="#l1.138"></a><span id="l1.138">                             );</span>
<a href="#l1.139"></a><span id="l1.139">                             if (attendees.length == 1) {</span>
<a href="#l1.140"></a><span id="l1.140">                                 comparison = calitip.compareSequence(item, foundItems[0]);</span>
<a href="#l1.141"></a><span id="l1.141">                                 if (comparison == 1) {</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineminus">-                                    data.label = _gs(&quot;imipBarCounterErrorText&quot;);</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineplus">+                                    data.label = cal.l10n.getLtnString(&quot;imipBarCounterErrorText&quot;);</span>
<a href="#l1.144"></a><span id="l1.144">                                     break;</span>
<a href="#l1.145"></a><span id="l1.145">                                 } else if (comparison == -1) {</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineminus">-                                    data.label = _gs(&quot;imipBarCounterPreviousVersionText&quot;);</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineplus">+                                    data.label = cal.l10n.getLtnString(&quot;imipBarCounterPreviousVersionText&quot;);</span>
<a href="#l1.148"></a><span id="l1.148">                                 }</span>
<a href="#l1.149"></a><span id="l1.149">                             }</span>
<a href="#l1.150"></a><span id="l1.150">                         }</span>
<a href="#l1.151"></a><span id="l1.151">                     }</span>
<a href="#l1.152"></a><span id="l1.152">                 }</span>
<a href="#l1.153"></a><span id="l1.153">             } else if (itipItem.receivedMethod == &quot;REPLY&quot;) {</span>
<a href="#l1.154"></a><span id="l1.154">                 // The item has been previously removed from the available calendars or the calendar</span>
<a href="#l1.155"></a><span id="l1.155">                 // containing the item is not available</span>
<a href="#l1.156"></a><span id="l1.156">                 let delmgr = Components.classes[&quot;@mozilla.org/calendar/deleted-items-manager;1&quot;]</span>
<a href="#l1.157"></a><span id="l1.157">                                        .getService(Components.interfaces.calIDeletedItems);</span>
<a href="#l1.158"></a><span id="l1.158">                 let delTime = null;</span>
<a href="#l1.159"></a><span id="l1.159">                 let items = itipItem.getItemList({});</span>
<a href="#l1.160"></a><span id="l1.160">                 if (items &amp;&amp; items.length) {</span>
<a href="#l1.161"></a><span id="l1.161">                     delTime = delmgr.getDeletedDate(items[0].id);</span>
<a href="#l1.162"></a><span id="l1.162">                 }</span>
<a href="#l1.163"></a><span id="l1.163">                 if (delTime) {</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineminus">-                    data.label = _gs(&quot;imipBarReplyToRecentlyRemovedItem&quot;, [delTime.toString()]);</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineplus">+                    data.label = cal.l10n.getLtnString(&quot;imipBarReplyToRecentlyRemovedItem&quot;, [delTime.toString()]);</span>
<a href="#l1.166"></a><span id="l1.166">                 } else {</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineminus">-                    data.label = _gs(&quot;imipBarReplyToNotExistingItem&quot;);</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineplus">+                    data.label = cal.l10n.getLtnString(&quot;imipBarReplyToNotExistingItem&quot;);</span>
<a href="#l1.169"></a><span id="l1.169">                 }</span>
<a href="#l1.170"></a><span id="l1.170">             } else if (itipItem.receivedMethod == &quot;DECLINECOUNTER&quot;) {</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineminus">-                data.label = _gs(&quot;imipBarDeclineCounterText&quot;);</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineplus">+                data.label = cal.l10n.getLtnString(&quot;imipBarDeclineCounterText&quot;);</span>
<a href="#l1.173"></a><span id="l1.173">             }</span>
<a href="#l1.174"></a><span id="l1.174">         } else if (Components.isSuccessCode(rc)) {</span>
<a href="#l1.175"></a><span id="l1.175">             cal.LOG(&quot;iTIP options on: &quot; + actionFunc.method);</span>
<a href="#l1.176"></a><span id="l1.176">             switch (actionFunc.method) {</span>
<a href="#l1.177"></a><span id="l1.177">                 case &quot;PUBLISH:UPDATE&quot;:</span>
<a href="#l1.178"></a><span id="l1.178">                 case &quot;REQUEST:UPDATE-MINOR&quot;:</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineminus">-                    data.label = _gs(&quot;imipBarUpdateText&quot;);</span>
<a href="#l1.180"></a><span id="l1.180" class="difflineplus">+                    data.label = cal.l10n.getLtnString(&quot;imipBarUpdateText&quot;);</span>
<a href="#l1.181"></a><span id="l1.181">                     // falls through</span>
<a href="#l1.182"></a><span id="l1.182">                 case &quot;REPLY&quot;:</span>
<a href="#l1.183"></a><span id="l1.183">                     data.showItems.push(&quot;imipUpdateButton&quot;);</span>
<a href="#l1.184"></a><span id="l1.184">                     break;</span>
<a href="#l1.185"></a><span id="l1.185">                 case &quot;PUBLISH&quot;:</span>
<a href="#l1.186"></a><span id="l1.186">                     data.showItems.push(&quot;imipAddButton&quot;);</span>
<a href="#l1.187"></a><span id="l1.187">                     break;</span>
<a href="#l1.188"></a><span id="l1.188">                 case &quot;REQUEST:UPDATE&quot;:</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineat">@@ -381,29 +352,29 @@ var calitip = {</span>
<a href="#l1.190"></a><span id="l1.190">                     for (let item of itipItem.getItemList({})) {</span>
<a href="#l1.191"></a><span id="l1.191">                         if (item.recurrenceInfo) {</span>
<a href="#l1.192"></a><span id="l1.192">                             isRecurringMaster = true;</span>
<a href="#l1.193"></a><span id="l1.193">                         }</span>
<a href="#l1.194"></a><span id="l1.194">                     }</span>
<a href="#l1.195"></a><span id="l1.195"> </span>
<a href="#l1.196"></a><span id="l1.196">                     if (actionFunc.method == &quot;REQUEST:UPDATE&quot;) {</span>
<a href="#l1.197"></a><span id="l1.197">                         if (isRecurringMaster) {</span>
<a href="#l1.198"></a><span id="l1.198" class="difflineminus">-                            data.label = _gs(&quot;imipBarUpdateSeriesText&quot;);</span>
<a href="#l1.199"></a><span id="l1.199" class="difflineplus">+                            data.label = cal.l10n.getLtnString(&quot;imipBarUpdateSeriesText&quot;);</span>
<a href="#l1.200"></a><span id="l1.200">                         } else if (itipItem.getItemList({}).length &gt; 1) {</span>
<a href="#l1.201"></a><span id="l1.201" class="difflineminus">-                            data.label = _gs(&quot;imipBarUpdateMultipleText&quot;);</span>
<a href="#l1.202"></a><span id="l1.202" class="difflineplus">+                            data.label = cal.l10n.getLtnString(&quot;imipBarUpdateMultipleText&quot;);</span>
<a href="#l1.203"></a><span id="l1.203">                         } else {</span>
<a href="#l1.204"></a><span id="l1.204" class="difflineminus">-                            data.label = _gs(&quot;imipBarUpdateText&quot;);</span>
<a href="#l1.205"></a><span id="l1.205" class="difflineplus">+                            data.label = cal.l10n.getLtnString(&quot;imipBarUpdateText&quot;);</span>
<a href="#l1.206"></a><span id="l1.206">                         }</span>
<a href="#l1.207"></a><span id="l1.207">                     } else if (actionFunc.method == &quot;REQUEST:NEEDS-ACTION&quot;) {</span>
<a href="#l1.208"></a><span id="l1.208">                         if (isRecurringMaster) {</span>
<a href="#l1.209"></a><span id="l1.209" class="difflineminus">-                            data.label = _gs(&quot;imipBarProcessedSeriesNeedsAction&quot;);</span>
<a href="#l1.210"></a><span id="l1.210" class="difflineplus">+                            data.label = cal.l10n.getLtnString(&quot;imipBarProcessedSeriesNeedsAction&quot;);</span>
<a href="#l1.211"></a><span id="l1.211">                         } else if (itipItem.getItemList({}).length &gt; 1) {</span>
<a href="#l1.212"></a><span id="l1.212" class="difflineminus">-                            data.label = _gs(&quot;imipBarProcessedMultipleNeedsAction&quot;);</span>
<a href="#l1.213"></a><span id="l1.213" class="difflineplus">+                            data.label = cal.l10n.getLtnString(&quot;imipBarProcessedMultipleNeedsAction&quot;);</span>
<a href="#l1.214"></a><span id="l1.214">                         } else {</span>
<a href="#l1.215"></a><span id="l1.215" class="difflineminus">-                            data.label = _gs(&quot;imipBarProcessedNeedsAction&quot;);</span>
<a href="#l1.216"></a><span id="l1.216" class="difflineplus">+                            data.label = cal.l10n.getLtnString(&quot;imipBarProcessedNeedsAction&quot;);</span>
<a href="#l1.217"></a><span id="l1.217">                         }</span>
<a href="#l1.218"></a><span id="l1.218">                     }</span>
<a href="#l1.219"></a><span id="l1.219"> </span>
<a href="#l1.220"></a><span id="l1.220">                     if (itipItem.getItemList({}).length &gt; 1 || isRecurringMaster) {</span>
<a href="#l1.221"></a><span id="l1.221">                         data.showItems.push(&quot;imipAcceptRecurrencesButton&quot;);</span>
<a href="#l1.222"></a><span id="l1.222">                         if (separateButtons) {</span>
<a href="#l1.223"></a><span id="l1.223">                             data.showItems.push(&quot;imipTentativeRecurrencesButton&quot;);</span>
<a href="#l1.224"></a><span id="l1.224">                             data.hideItems.push(&quot;imipAcceptRecurrencesButton_AcceptLabel&quot;);</span>
<a href="#l1.225"></a><span id="l1.225" class="difflineat">@@ -448,28 +419,28 @@ var calitip = {</span>
<a href="#l1.226"></a><span id="l1.226">                     break;</span>
<a href="#l1.227"></a><span id="l1.227">                 }</span>
<a href="#l1.228"></a><span id="l1.228">                 case &quot;REFRESH&quot;: {</span>
<a href="#l1.229"></a><span id="l1.229">                     data.showItems.push(&quot;imipReconfirmButton&quot;);</span>
<a href="#l1.230"></a><span id="l1.230">                     break;</span>
<a href="#l1.231"></a><span id="l1.231">                 }</span>
<a href="#l1.232"></a><span id="l1.232">                 case &quot;COUNTER&quot;: {</span>
<a href="#l1.233"></a><span id="l1.233">                     if (disallowedCounter) {</span>
<a href="#l1.234"></a><span id="l1.234" class="difflineminus">-                        data.label = _gs(&quot;imipBarDisallowedCounterText&quot;);</span>
<a href="#l1.235"></a><span id="l1.235" class="difflineplus">+                        data.label = cal.l10n.getLtnString(&quot;imipBarDisallowedCounterText&quot;);</span>
<a href="#l1.236"></a><span id="l1.236">                     }</span>
<a href="#l1.237"></a><span id="l1.237">                     data.showItems.push(&quot;imipDeclineCounterButton&quot;);</span>
<a href="#l1.238"></a><span id="l1.238">                     data.showItems.push(&quot;imipRescheduleButton&quot;);</span>
<a href="#l1.239"></a><span id="l1.239">                     break;</span>
<a href="#l1.240"></a><span id="l1.240">                 }</span>
<a href="#l1.241"></a><span id="l1.241">                 default:</span>
<a href="#l1.242"></a><span id="l1.242" class="difflineminus">-                    data.label = _gs(&quot;imipBarUnsupportedText&quot;);</span>
<a href="#l1.243"></a><span id="l1.243" class="difflineplus">+                    data.label = cal.l10n.getLtnString(&quot;imipBarUnsupportedText&quot;);</span>
<a href="#l1.244"></a><span id="l1.244">                     break;</span>
<a href="#l1.245"></a><span id="l1.245">             }</span>
<a href="#l1.246"></a><span id="l1.246">         } else {</span>
<a href="#l1.247"></a><span id="l1.247" class="difflineminus">-            data.label = _gs(&quot;imipBarUnsupportedText&quot;);</span>
<a href="#l1.248"></a><span id="l1.248" class="difflineplus">+            data.label = cal.l10n.getLtnString(&quot;imipBarUnsupportedText&quot;);</span>
<a href="#l1.249"></a><span id="l1.249">         }</span>
<a href="#l1.250"></a><span id="l1.250"> </span>
<a href="#l1.251"></a><span id="l1.251">         return data;</span>
<a href="#l1.252"></a><span id="l1.252">     },</span>
<a href="#l1.253"></a><span id="l1.253"> </span>
<a href="#l1.254"></a><span id="l1.254">     /**</span>
<a href="#l1.255"></a><span id="l1.255">      * Scope: iTIP message receiver</span>
<a href="#l1.256"></a><span id="l1.256">      * Retrieves the message sender.</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineat">@@ -601,17 +572,17 @@ var calitip = {</span>
<a href="#l1.258"></a><span id="l1.258">                 let matchingCals = calendars.filter(calendar =&gt; calitip.getInvitedAttendee(item, calendar) != null);</span>
<a href="#l1.259"></a><span id="l1.259">                 // if there's none, we will show the whole list of calendars:</span>
<a href="#l1.260"></a><span id="l1.260">                 if (matchingCals.length &gt; 0) {</span>
<a href="#l1.261"></a><span id="l1.261">                     calendars = matchingCals;</span>
<a href="#l1.262"></a><span id="l1.262">                 }</span>
<a href="#l1.263"></a><span id="l1.263">             }</span>
<a href="#l1.264"></a><span id="l1.264"> </span>
<a href="#l1.265"></a><span id="l1.265">             if (calendars.length == 0) {</span>
<a href="#l1.266"></a><span id="l1.266" class="difflineminus">-                let msg = cal.calGetString(&quot;lightning&quot;, &quot;imipNoCalendarAvailable&quot;, null, &quot;lightning&quot;);</span>
<a href="#l1.267"></a><span id="l1.267" class="difflineplus">+                let msg = cal.l10n.getLtnString(&quot;imipNoCalendarAvailable&quot;);</span>
<a href="#l1.268"></a><span id="l1.268">                 aWindow.alert(msg);</span>
<a href="#l1.269"></a><span id="l1.269">             } else if (calendars.length == 1) {</span>
<a href="#l1.270"></a><span id="l1.270">                 // There's only one calendar, so it's silly to ask what calendar</span>
<a href="#l1.271"></a><span id="l1.271">                 // the user wants to import into.</span>
<a href="#l1.272"></a><span id="l1.272">                 targetCalendar = calendars[0];</span>
<a href="#l1.273"></a><span id="l1.273">             } else {</span>
<a href="#l1.274"></a><span id="l1.274">                 // Ask what calendar to import into</span>
<a href="#l1.275"></a><span id="l1.275">                 let args = {};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -398,17 +398,17 @@ calCalendarManager.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">     //</span>
<a href="#l2.5"></a><span id="l2.5">     // / DB migration code ends here</span>
<a href="#l2.6"></a><span id="l2.6">     //</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8">     alertAndQuit: function() {</span>
<a href="#l2.9"></a><span id="l2.9">         // We want to include the extension name in the error message rather</span>
<a href="#l2.10"></a><span id="l2.10">         // than blaming Thunderbird.</span>
<a href="#l2.11"></a><span id="l2.11">         let hostAppName = cal.calGetString(&quot;brand&quot;, &quot;brandShortName&quot;, null, &quot;branding&quot;);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        let calAppName = cal.calGetString(&quot;lightning&quot;, &quot;brandShortName&quot;, null, &quot;lightning&quot;);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+        let calAppName = cal.l10n.getLtnString(&quot;brandShortName&quot;);</span>
<a href="#l2.14"></a><span id="l2.14">         let errorBoxTitle = cal.l10n.getCalString(&quot;tooNewSchemaErrorBoxTitle&quot;, [calAppName]);</span>
<a href="#l2.15"></a><span id="l2.15">         let errorBoxText = cal.l10n.getCalString(&quot;tooNewSchemaErrorBoxTextLightning&quot;, [calAppName, hostAppName]);</span>
<a href="#l2.16"></a><span id="l2.16">         let errorBoxButtonLabel = cal.l10n.getCalString(&quot;tooNewSchemaButtonRestart&quot;, [hostAppName]);</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18">         let promptSvc = Services.prompt;</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20">         let errorBoxButtonFlags = promptSvc.BUTTON_POS_0 *</span>
<a href="#l2.21"></a><span id="l2.21">                                   promptSvc.BUTTON_TITLE_IS_STRING +</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/itip/calItipEmailTransport.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/itip/calItipEmailTransport.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -75,60 +75,39 @@ calItipEmailTransport.prototype = {</span>
<a href="#l3.4"></a><span id="l3.4">                     &quot;calendar.itip.useInvitationSubjectPrefixes&quot;,</span>
<a href="#l3.5"></a><span id="l3.5">                     true</span>
<a href="#l3.6"></a><span id="l3.6">                 );</span>
<a href="#l3.7"></a><span id="l3.7">                 if (usePrefixes) {</span>
<a href="#l3.8"></a><span id="l3.8">                     let seq = item.getProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l3.9"></a><span id="l3.9">                     let subjectKey = seq &amp;&amp; seq &gt; 0</span>
<a href="#l3.10"></a><span id="l3.10">                         ? &quot;itipRequestUpdatedSubject&quot;</span>
<a href="#l3.11"></a><span id="l3.11">                         : &quot;itipRequestSubject&quot;;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-                    subject = cal.calGetString(</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                        &quot;lightning&quot;,</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                        subjectKey,</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-                        [summary],</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-                        &quot;lightning&quot;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-                    );</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+                    subject = cal.l10n.getLtnString(subjectKey, [summary]);</span>
<a href="#l3.19"></a><span id="l3.19">                 } else {</span>
<a href="#l3.20"></a><span id="l3.20">                     subject = summary;</span>
<a href="#l3.21"></a><span id="l3.21">                 }</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-                body = cal.calGetString(</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-                    &quot;lightning&quot;,</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+                body = cal.l10n.getLtnString(</span>
<a href="#l3.25"></a><span id="l3.25">                     &quot;itipRequestBody&quot;,</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-                    [item.organizer ? item.organizer.toString() : &quot;&quot;, summary],</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">-                    &quot;lightning&quot;</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+                    [item.organizer ? item.organizer.toString() : &quot;&quot;, summary]</span>
<a href="#l3.29"></a><span id="l3.29">                 );</span>
<a href="#l3.30"></a><span id="l3.30">                 break;</span>
<a href="#l3.31"></a><span id="l3.31">             }</span>
<a href="#l3.32"></a><span id="l3.32">             case &quot;CANCEL&quot;: {</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-                subject = cal.calGetString(</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-                    &quot;lightning&quot;,</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-                    &quot;itipCancelSubject&quot;,</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-                    [summary],</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-                    &quot;lightning&quot;</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-                );</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-                body = cal.calGetString(</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-                    &quot;lightning&quot;,</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+                subject = cal.l10n.getLtnString(&quot;itipCancelSubject&quot;, [summary]);</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+                body = cal.l10n.getLtnString(</span>
<a href="#l3.43"></a><span id="l3.43">                     &quot;itipCancelBody&quot;,</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-                    [item.organizer ? item.organizer.toString() : &quot;&quot;, summary],</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-                    &quot;lightning&quot;</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+                    [item.organizer ? item.organizer.toString() : &quot;&quot;, summary]</span>
<a href="#l3.47"></a><span id="l3.47">                 );</span>
<a href="#l3.48"></a><span id="l3.48">                 break;</span>
<a href="#l3.49"></a><span id="l3.49">             }</span>
<a href="#l3.50"></a><span id="l3.50">             case &quot;DECLINECOUNTER&quot;: {</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-                subject = cal.calGetString(</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-                    &quot;lightning&quot;,</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-                    &quot;itipDeclineCounterSubject&quot;,</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-                    [summary],</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-                    &quot;lightning&quot;</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-                );</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-                body = cal.calGetString(</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-                    &quot;lightning&quot;,</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+                subject = cal.l10n.getLtnString(&quot;itipDeclineCounterSubject&quot;, [summary]);</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+                body = cal.l10n.getLtnString(</span>
<a href="#l3.61"></a><span id="l3.61">                     &quot;itipDeclineCounterBody&quot;,</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-                    [item.organizer ? item.organizer.toString() : &quot;&quot;, summary],</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-                    &quot;lightning&quot;</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+                    [item.organizer ? item.organizer.toString() : &quot;&quot;, summary]</span>
<a href="#l3.65"></a><span id="l3.65">                 );</span>
<a href="#l3.66"></a><span id="l3.66">                 break;</span>
<a href="#l3.67"></a><span id="l3.67">             }</span>
<a href="#l3.68"></a><span id="l3.68">             case &quot;REPLY&quot;: {</span>
<a href="#l3.69"></a><span id="l3.69">                 // Get my participation status</span>
<a href="#l3.70"></a><span id="l3.70">                 let att = cal.itip.getInvitedAttendee(item, aItipItem.targetCalendar);</span>
<a href="#l3.71"></a><span id="l3.71">                 if (!att &amp;&amp; aItipItem.identity) {</span>
<a href="#l3.72"></a><span id="l3.72">                     att = item.getAttendeeById(cal.email.prependMailTo(aItipItem.identity));</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineat">@@ -157,28 +136,18 @@ calItipEmailTransport.prototype = {</span>
<a href="#l3.74"></a><span id="l3.74">                         subjectKey = &quot;itipReplySubjectDecline&quot;;</span>
<a href="#l3.75"></a><span id="l3.75">                         bodyKey = &quot;itipReplyBodyDecline&quot;;</span>
<a href="#l3.76"></a><span id="l3.76">                         break;</span>
<a href="#l3.77"></a><span id="l3.77">                     default:</span>
<a href="#l3.78"></a><span id="l3.78">                         subjectKey = &quot;itipReplySubject&quot;;</span>
<a href="#l3.79"></a><span id="l3.79">                         bodyKey = &quot;itipReplyBodyAccept&quot;;</span>
<a href="#l3.80"></a><span id="l3.80">                         break;</span>
<a href="#l3.81"></a><span id="l3.81">                 }</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-                subject = cal.calGetString(</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-                    &quot;lightning&quot;,</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-                    subjectKey,</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-                    [summary],</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-                    &quot;lightning&quot;</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-                );</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-                body = cal.calGetString(</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineminus">-                    &quot;lightning&quot;,</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineminus">-                    bodyKey,</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineminus">-                    [name],</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineminus">-                    &quot;lightning&quot;</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-                );</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+                subject = cal.l10n.getLtnString(subjectKey, [summary]);</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+                body = cal.l10n.getLtnString(bodyKey, [name]);</span>
<a href="#l3.96"></a><span id="l3.96">                 break;</span>
<a href="#l3.97"></a><span id="l3.97">             }</span>
<a href="#l3.98"></a><span id="l3.98">         }</span>
<a href="#l3.99"></a><span id="l3.99"> </span>
<a href="#l3.100"></a><span id="l3.100">         return {</span>
<a href="#l3.101"></a><span id="l3.101">             subject: subject,</span>
<a href="#l3.102"></a><span id="l3.102">             body: body</span>
<a href="#l3.103"></a><span id="l3.103">         };</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineat">@@ -238,18 +207,18 @@ calItipEmailTransport.prototype = {</span>
<a href="#l3.105"></a><span id="l3.105">                 // We still need this as a last resort if a user just deletes or</span>
<a href="#l3.106"></a><span id="l3.106">                 //  drags an invitation related event</span>
<a href="#l3.107"></a><span id="l3.107">                 let parent = Services.wm.getMostRecentWindow(null);</span>
<a href="#l3.108"></a><span id="l3.108">                 if (parent.closed) {</span>
<a href="#l3.109"></a><span id="l3.109">                     parent = cal.window.getCalendarWindow();</span>
<a href="#l3.110"></a><span id="l3.110">                 }</span>
<a href="#l3.111"></a><span id="l3.111">                 let cancelled = Services.prompt.confirmEx(</span>
<a href="#l3.112"></a><span id="l3.112">                     parent,</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineminus">-                    cal.calGetString(&quot;lightning&quot;, &quot;imipSendMail.title&quot;, null, &quot;lightning&quot;),</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineminus">-                    cal.calGetString(&quot;lightning&quot;, &quot;imipSendMail.text&quot;, null, &quot;lightning&quot;),</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineplus">+                    cal.l10n.getLtnString(&quot;imipSendMail.title&quot;),</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineplus">+                    cal.l10n.getLtnString(&quot;imipSendMail.text&quot;),</span>
<a href="#l3.117"></a><span id="l3.117">                     Services.prompt.STD_YES_NO_BUTTONS,</span>
<a href="#l3.118"></a><span id="l3.118">                     null,</span>
<a href="#l3.119"></a><span id="l3.119">                     null,</span>
<a href="#l3.120"></a><span id="l3.120">                     null,</span>
<a href="#l3.121"></a><span id="l3.121">                     null,</span>
<a href="#l3.122"></a><span id="l3.122">                     {}</span>
<a href="#l3.123"></a><span id="l3.123">                 );</span>
<a href="#l3.124"></a><span id="l3.124">                 if (cancelled) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/lightning/content/imip-bar.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/lightning/content/imip-bar.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -217,20 +217,20 @@ var ltnImipBar = {</span>
<a href="#l4.4"></a><span id="l4.4">             }</span>
<a href="#l4.5"></a><span id="l4.5">             return false;</span>
<a href="#l4.6"></a><span id="l4.6">         };</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">         // We override the bar label for sent out invitations and in case the event does not exist</span>
<a href="#l4.9"></a><span id="l4.9">         // anymore, we also clear the buttons if any to avoid e.g. accept/decline buttons</span>
<a href="#l4.10"></a><span id="l4.10">         if (isOutgoing(gMessageDisplay.displayedMessage)) {</span>
<a href="#l4.11"></a><span id="l4.11">             if (ltnImipBar.foundItems &amp;&amp; ltnImipBar.foundItems[0]) {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                data.label = ltn.getString(&quot;lightning&quot;, &quot;imipBarSentText&quot;);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                data.label = cal.l10n.getLtnString(&quot;imipBarSentText&quot;);</span>
<a href="#l4.14"></a><span id="l4.14">             } else {</span>
<a href="#l4.15"></a><span id="l4.15">                 data = {</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-                    label: ltn.getString(&quot;lightning&quot;, &quot;imipBarSentButRemovedText&quot;),</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+                    label: cal.l10n.getLtnString(&quot;imipBarSentButRemovedText&quot;),</span>
<a href="#l4.18"></a><span id="l4.18">                     buttons: [],</span>
<a href="#l4.19"></a><span id="l4.19">                     hideMenuItems: []</span>
<a href="#l4.20"></a><span id="l4.20">                 };</span>
<a href="#l4.21"></a><span id="l4.21">             }</span>
<a href="#l4.22"></a><span id="l4.22">         }</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24">         imipBar.setAttribute(&quot;label&quot;, data.label);</span>
<a href="#l4.25"></a><span id="l4.25">         // let's reset all buttons first</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineat">@@ -413,25 +413,25 @@ var ltnImipBar = {</span>
<a href="#l4.27"></a><span id="l4.27">                         counterProposal = {</span>
<a href="#l4.28"></a><span id="l4.28">                             attendee: proposingAttendee,</span>
<a href="#l4.29"></a><span id="l4.29">                             proposal: parsedProposal.differences,</span>
<a href="#l4.30"></a><span id="l4.30">                             oldVersion: parsedProposal.result == &quot;OLDVERSION&quot; ||</span>
<a href="#l4.31"></a><span id="l4.31">                                         parsedProposal.result == &quot;NOTLATESTUPDATE&quot;,</span>
<a href="#l4.32"></a><span id="l4.32">                             onReschedule: () =&gt; {</span>
<a href="#l4.33"></a><span id="l4.33">                                 imipBar.setAttribute(</span>
<a href="#l4.34"></a><span id="l4.34">                                     &quot;label&quot;,</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-                                    ltn.getString(&quot;lightning&quot;, &quot;imipBarCounterPreviousVersionText&quot;)</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+                                    cal.l10n.getLtnString(&quot;imipBarCounterPreviousVersionText&quot;)</span>
<a href="#l4.37"></a><span id="l4.37">                                 );</span>
<a href="#l4.38"></a><span id="l4.38">                                 // TODO: should we hide the buttons in this case, too?</span>
<a href="#l4.39"></a><span id="l4.39">                             }</span>
<a href="#l4.40"></a><span id="l4.40">                         };</span>
<a href="#l4.41"></a><span id="l4.41">                     } else {</span>
<a href="#l4.42"></a><span id="l4.42">                         imipBar.setAttribute(</span>
<a href="#l4.43"></a><span id="l4.43">                             &quot;label&quot;,</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-                            ltn.getString(&quot;lightning&quot;, &quot;imipBarCounterErrorText&quot;)</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+                            cal.l10n.getLtnString(&quot;imipBarCounterErrorText&quot;)</span>
<a href="#l4.46"></a><span id="l4.46">                         );</span>
<a href="#l4.47"></a><span id="l4.47">                         ltnImipBar.resetButtons();</span>
<a href="#l4.48"></a><span id="l4.48">                         if (proposingAttendee) {</span>
<a href="#l4.49"></a><span id="l4.49">                             cal.LOG(parsedProposal.result.descr);</span>
<a href="#l4.50"></a><span id="l4.50">                         } else {</span>
<a href="#l4.51"></a><span id="l4.51">                             cal.LOG(&quot;Failed to identify the sending attendee of the counterproposal.&quot;);</span>
<a href="#l4.52"></a><span id="l4.52">                         }</span>
<a href="#l4.53"></a><span id="l4.53"> </span>
<a href="#l4.54"></a><span id="l4.54" class="difflineat">@@ -459,18 +459,18 @@ var ltnImipBar = {</span>
<a href="#l4.55"></a><span id="l4.55">                 // Instead of a dialog, this might be implemented as a separate container inside the</span>
<a href="#l4.56"></a><span id="l4.56">                 // imip-overlay as proposed in bug 458578</span>
<a href="#l4.57"></a><span id="l4.57">             }</span>
<a href="#l4.58"></a><span id="l4.58">             let delmgr = Components.classes[&quot;@mozilla.org/calendar/deleted-items-manager;1&quot;]</span>
<a href="#l4.59"></a><span id="l4.59">                                    .getService(Components.interfaces.calIDeletedItems);</span>
<a href="#l4.60"></a><span id="l4.60">             let items = ltnImipBar.itipItem.getItemList({});</span>
<a href="#l4.61"></a><span id="l4.61">             if (items &amp;&amp; items.length) {</span>
<a href="#l4.62"></a><span id="l4.62">                 let delTime = delmgr.getDeletedDate(items[0].id);</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-                let dialogText = ltnGetString(&quot;lightning&quot;, &quot;confirmProcessInvitation&quot;);</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-                let dialogTitle = ltnGetString(&quot;lightning&quot;, &quot;confirmProcessInvitationTitle&quot;);</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+                let dialogText = cal.l10n.getLtnString(&quot;confirmProcessInvitation&quot;);</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+                let dialogTitle = cal.l10n.getLtnString(&quot;confirmProcessInvitationTitle&quot;);</span>
<a href="#l4.67"></a><span id="l4.67">                 if (delTime &amp;&amp; !Services.prompt.confirm(window, dialogTitle, dialogText)) {</span>
<a href="#l4.68"></a><span id="l4.68">                     return false;</span>
<a href="#l4.69"></a><span id="l4.69">                 }</span>
<a href="#l4.70"></a><span id="l4.70">             }</span>
<a href="#l4.71"></a><span id="l4.71"> </span>
<a href="#l4.72"></a><span id="l4.72">             if (aParticipantStatus == &quot;X-SAVECOPY&quot;) {</span>
<a href="#l4.73"></a><span id="l4.73">                 // we create and adopt copies of the respective events</span>
<a href="#l4.74"></a><span id="l4.74">                 let saveitems = ltnImipBar.itipItem.getItemList({}).map(cal.itip.getPublishLikeItemCopy.bind(cal));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/lightning/content/lightning-utils.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-utils.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,34 +1,19 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.5"></a><span id="l5.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.6"></a><span id="l5.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">-/* exported ltnGetString, ltnInitMailIdentitiesRow,</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">- *          ltnGetMailIdentitySelection, ltnSaveMailIdentitySelection,</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">- *          ltnNotifyOnIdentitySelection</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+/* exported ltnInitMailIdentitiesRow, ltnGetMailIdentitySelection,</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+ *          ltnSaveMailIdentitySelection, ltnNotifyOnIdentitySelection</span>
<a href="#l5.13"></a><span id="l5.13">  */</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15"> ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l5.16"></a><span id="l5.16"> ChromeUtils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l5.17"></a><span id="l5.17"> ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-ChromeUtils.import(&quot;resource://calendar/modules/ltnUtils.jsm&quot;);</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-/**</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">- * Gets a localized string in a .properties file from the lightning bundle</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">- *</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">- * @param   {String}  aBundleName  the name of the properties file.  It is assumed</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">- *                                 that the file lives in chrome://lightning/locale/</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">- * @param   {String}  aStringName  the name of the string within the properties file</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">- * @param   {Array}   aParams      optional array of parameters to format the string</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">- * @returns {String}               the localized string</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">- */</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-function ltnGetString(aBundleName, aStringName, aParams) {</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-    return cal.calGetString(aBundleName, aStringName, aParams, &quot;lightning&quot;);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-}</span>
<a href="#l5.32"></a><span id="l5.32"> </span>
<a href="#l5.33"></a><span id="l5.33"> /**</span>
<a href="#l5.34"></a><span id="l5.34">  * Initializing the email identity row</span>
<a href="#l5.35"></a><span id="l5.35">  * (shared between calendar creation wizard and properties dialog)</span>
<a href="#l5.36"></a><span id="l5.36">  */</span>
<a href="#l5.37"></a><span id="l5.37"> function ltnInitMailIdentitiesRow() {</span>
<a href="#l5.38"></a><span id="l5.38">     if (!gCalendar) {</span>
<a href="#l5.39"></a><span id="l5.39">         collapseElement(&quot;calendar-email-identity-row&quot;);</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineat">@@ -52,17 +37,17 @@ function ltnInitMailIdentitiesRow() {</span>
<a href="#l5.41"></a><span id="l5.41"> </span>
<a href="#l5.42"></a><span id="l5.42">     // Remove all children from the email list to avoid duplicates if the list</span>
<a href="#l5.43"></a><span id="l5.43">     // has already been populated during a previous step in the calendar</span>
<a href="#l5.44"></a><span id="l5.44">     // creation wizard.</span>
<a href="#l5.45"></a><span id="l5.45">     while (menuPopup.hasChildNodes()) {</span>
<a href="#l5.46"></a><span id="l5.46">         menuPopup.lastChild.remove();</span>
<a href="#l5.47"></a><span id="l5.47">     }</span>
<a href="#l5.48"></a><span id="l5.48"> </span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-    addMenuItem(menuPopup, ltnGetString(&quot;lightning&quot;, &quot;imipNoIdentity&quot;), &quot;none&quot;);</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+    addMenuItem(menuPopup, cal.l10n.getLtnString(&quot;imipNoIdentity&quot;), &quot;none&quot;);</span>
<a href="#l5.51"></a><span id="l5.51">     let identities;</span>
<a href="#l5.52"></a><span id="l5.52">     if (gCalendar &amp;&amp; gCalendar.aclEntry &amp;&amp; gCalendar.aclEntry.hasAccessControl) {</span>
<a href="#l5.53"></a><span id="l5.53">         identities = gCalendar.aclEntry.getOwnerIdentities({});</span>
<a href="#l5.54"></a><span id="l5.54">     } else {</span>
<a href="#l5.55"></a><span id="l5.55">         identities = MailServices.accounts.allIdentities;</span>
<a href="#l5.56"></a><span id="l5.56">     }</span>
<a href="#l5.57"></a><span id="l5.57">     for (let identity of fixIterator(identities, Components.interfaces.nsIMsgIdentity)) {</span>
<a href="#l5.58"></a><span id="l5.58">         addMenuItem(menuPopup, identity.identityName, identity.key);</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineat">@@ -110,17 +95,17 @@ function ltnSaveMailIdentitySelection() </span>
<a href="#l5.60"></a><span id="l5.60"> }</span>
<a href="#l5.61"></a><span id="l5.61"> </span>
<a href="#l5.62"></a><span id="l5.62"> /**</span>
<a href="#l5.63"></a><span id="l5.63">  * Displays a warning if the user doesn't assign an email identity to a calendar</span>
<a href="#l5.64"></a><span id="l5.64">  * (shared between calendar creation wizard and properties dialog)</span>
<a href="#l5.65"></a><span id="l5.65">  */</span>
<a href="#l5.66"></a><span id="l5.66"> function ltnNotifyOnIdentitySelection() {</span>
<a href="#l5.67"></a><span id="l5.67">     let notificationBox = document.getElementById(&quot;no-identity-notification&quot;);</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-    let msg = ltn.getString(&quot;lightning&quot;, &quot;noIdentitySelectedNotification&quot;);</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+    let msg = cal.l10n.getLtnString(&quot;noIdentitySelectedNotification&quot;);</span>
<a href="#l5.70"></a><span id="l5.70">     let sel = ltnGetMailIdentitySelection();</span>
<a href="#l5.71"></a><span id="l5.71"> </span>
<a href="#l5.72"></a><span id="l5.72">     if (sel == &quot;none&quot;) {</span>
<a href="#l5.73"></a><span id="l5.73">         notificationBox.appendNotification(</span>
<a href="#l5.74"></a><span id="l5.74">             msg,</span>
<a href="#l5.75"></a><span id="l5.75">             &quot;noIdentitySelected&quot;,</span>
<a href="#l5.76"></a><span id="l5.76">             null,</span>
<a href="#l5.77"></a><span id="l5.77">             notificationBox.PRIORITY_WARNING_MEDIUM</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -85,22 +85,22 @@ var calendarTabType = {</span>
<a href="#l6.4"></a><span id="l6.4">                 return {</span>
<a href="#l6.5"></a><span id="l6.5">                     // Since we do strange tab switching logic in ltnSwitch2Calendar,</span>
<a href="#l6.6"></a><span id="l6.6">                     // we should store the current tab state ourselves.</span>
<a href="#l6.7"></a><span id="l6.7">                     background: (aTab != tabmail.currentTabInfo)</span>
<a href="#l6.8"></a><span id="l6.8">                 };</span>
<a href="#l6.9"></a><span id="l6.9">             },</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">             restoreTab: function(aTabmail, aState) {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                aState.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleCalendar&quot;);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+                aState.title = cal.l10n.getLtnString(&quot;tabTitleCalendar&quot;);</span>
<a href="#l6.14"></a><span id="l6.14">                 aTabmail.openTab(&quot;calendar&quot;, aState);</span>
<a href="#l6.15"></a><span id="l6.15">             },</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17">             onTitleChanged: function(aTab) {</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-                aTab.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleCalendar&quot;);</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+                aTab.title = cal.l10n.getLtnString(&quot;tabTitleCalendar&quot;);</span>
<a href="#l6.20"></a><span id="l6.20">             },</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22">             supportsCommand: (aCommand, aTab) =&gt; calendarController2.supportsCommand(aCommand),</span>
<a href="#l6.23"></a><span id="l6.23">             isCommandEnabled: (aCommand, aTab) =&gt; calendarController2.isCommandEnabled(aCommand),</span>
<a href="#l6.24"></a><span id="l6.24">             doCommand: (aCommand, aTab) =&gt; calendarController2.doCommand(aCommand),</span>
<a href="#l6.25"></a><span id="l6.25">             onEvent: (aEvent, aTab) =&gt; calendarController2.onEvent(aEvent)</span>
<a href="#l6.26"></a><span id="l6.26">         },</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28" class="difflineat">@@ -130,22 +130,22 @@ var calendarTabType = {</span>
<a href="#l6.29"></a><span id="l6.29">                 return {</span>
<a href="#l6.30"></a><span id="l6.30">                     // Since we do strange tab switching logic in ltnSwitch2Task,</span>
<a href="#l6.31"></a><span id="l6.31">                     // we should store the current tab state ourselves.</span>
<a href="#l6.32"></a><span id="l6.32">                     background: (aTab != tabmail.currentTabInfo)</span>
<a href="#l6.33"></a><span id="l6.33">                 };</span>
<a href="#l6.34"></a><span id="l6.34">             },</span>
<a href="#l6.35"></a><span id="l6.35"> </span>
<a href="#l6.36"></a><span id="l6.36">             restoreTab: function(aTabmail, aState) {</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-                aState.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleTasks&quot;);</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+                aState.title = cal.l10n.getLtnString(&quot;tabTitleTasks&quot;);</span>
<a href="#l6.39"></a><span id="l6.39">                 aTabmail.openTab(&quot;tasks&quot;, aState);</span>
<a href="#l6.40"></a><span id="l6.40">             },</span>
<a href="#l6.41"></a><span id="l6.41"> </span>
<a href="#l6.42"></a><span id="l6.42">             onTitleChanged: function(aTab) {</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-                aTab.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleTasks&quot;);</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+                aTab.title = cal.l10n.getLtnString(&quot;tabTitleTasks&quot;);</span>
<a href="#l6.45"></a><span id="l6.45">             },</span>
<a href="#l6.46"></a><span id="l6.46"> </span>
<a href="#l6.47"></a><span id="l6.47">             supportsCommand: (aCommand, aTab) =&gt; calendarController2.supportsCommand(aCommand),</span>
<a href="#l6.48"></a><span id="l6.48">             isCommandEnabled: (aCommand, aTab) =&gt; calendarController2.isCommandEnabled(aCommand),</span>
<a href="#l6.49"></a><span id="l6.49">             doCommand: (aCommand, aTab) =&gt; calendarController2.doCommand(aCommand),</span>
<a href="#l6.50"></a><span id="l6.50">             onEvent: (aEvent, aTab) =&gt; calendarController2.onEvent(aEvent)</span>
<a href="#l6.51"></a><span id="l6.51">         }</span>
<a href="#l6.52"></a><span id="l6.52">     },</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineat">@@ -423,18 +423,18 @@ function ltnIntegrationNotification() {</span>
<a href="#l6.54"></a><span id="l6.54">     const kSupportUri = &quot;https://support.mozilla.org/kb/thunderbird-calendar-integration&quot;;</span>
<a href="#l6.55"></a><span id="l6.55">     const kLightningGuuid = &quot;{e2fda1a4-762b-4020-b5ad-a41df1933103}&quot;;</span>
<a href="#l6.56"></a><span id="l6.56"> </span>
<a href="#l6.57"></a><span id="l6.57">     // we fall back to messagepanebox for Seamonkey</span>
<a href="#l6.58"></a><span id="l6.58">     let notifyBox = document.getElementById(&quot;mail-notification-box&quot;) ||</span>
<a href="#l6.59"></a><span id="l6.59">                     document.getElementById(&quot;messagepanebox&quot;);</span>
<a href="#l6.60"></a><span id="l6.60"> </span>
<a href="#l6.61"></a><span id="l6.61">     let appBrand = cal.calGetString(&quot;brand&quot;, &quot;brandShortName&quot;, null, &quot;branding&quot;);</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-    let ltnBrand = ltnGetString(&quot;lightning&quot;, &quot;brandShortName&quot;);</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-    let label = ltnGetString(&quot;lightning&quot;, &quot;integrationLabel&quot;, [appBrand, ltnBrand]);</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+    let ltnBrand = cal.l10n.getLtnString(&quot;brandShortName&quot;);</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+    let label = cal.l10n.getLtnString(&quot;integrationLabel&quot;, [appBrand, ltnBrand]);</span>
<a href="#l6.66"></a><span id="l6.66"> </span>
<a href="#l6.67"></a><span id="l6.67">     // call backs for doing/undoing Lightning removal</span>
<a href="#l6.68"></a><span id="l6.68">     let cbRemoveLightning = function(aAddon) {</span>
<a href="#l6.69"></a><span id="l6.69">         aAddon.userDisabled = true;</span>
<a href="#l6.70"></a><span id="l6.70">     };</span>
<a href="#l6.71"></a><span id="l6.71">     let cbUndoRemoveLightning = function(aAddon) {</span>
<a href="#l6.72"></a><span id="l6.72">         aAddon.userDisabled = false;</span>
<a href="#l6.73"></a><span id="l6.73">     };</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineat">@@ -465,48 +465,48 @@ function ltnIntegrationNotification() {</span>
<a href="#l6.75"></a><span id="l6.75">     let cbKeepIt = function(aNotificationBar, aButton) {</span>
<a href="#l6.76"></a><span id="l6.76">         Preferences.set(kNotify, false);</span>
<a href="#l6.77"></a><span id="l6.77">     };</span>
<a href="#l6.78"></a><span id="l6.78">     let cbOptOut = function(aNotificationBar, aButton) {</span>
<a href="#l6.79"></a><span id="l6.79">         Preferences.set(kNotify, false);</span>
<a href="#l6.80"></a><span id="l6.80">         Preferences.set(kOptOut, true);</span>
<a href="#l6.81"></a><span id="l6.81">         AddonManager.getAddonByID(kLightningGuuid, cbRemoveLightning);</span>
<a href="#l6.82"></a><span id="l6.82">         // let the user know that removal will be applied after restart</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-        let restartLabel = ltnGetString(&quot;lightning&quot;, &quot;integrationRestartLabel&quot;, [ltnBrand, appBrand]);</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+        let restartLabel = cal.l10n.getLtnString(&quot;integrationRestartLabel&quot;, [ltnBrand, appBrand]);</span>
<a href="#l6.85"></a><span id="l6.85">         let button = [{</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-            label:     ltnGetString(&quot;lightning&quot;, &quot;integrationUndoButton&quot;),</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineminus">-            accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationUndoAccessKey&quot;),</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+            label:     cal.l10n.getLtnString(&quot;integrationUndoButton&quot;),</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+            accessKey: cal.l10n.getLtnString(&quot;integrationUndoAccessKey&quot;),</span>
<a href="#l6.90"></a><span id="l6.90">             popup:     null,</span>
<a href="#l6.91"></a><span id="l6.91">             callback:  cbUndoOptOut</span>
<a href="#l6.92"></a><span id="l6.92">         }, {</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-            label:     ltnGetString(&quot;lightning&quot;, &quot;integrationRestartButton&quot;),</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-            accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationRestartAccessKey&quot;),</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineplus">+            label:     cal.l10n.getLtnString(&quot;integrationRestartButton&quot;),</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+            accessKey: cal.l10n.getLtnString(&quot;integrationRestartAccessKey&quot;),</span>
<a href="#l6.97"></a><span id="l6.97">             popup:     null,</span>
<a href="#l6.98"></a><span id="l6.98">             callback:  cbRestartNow</span>
<a href="#l6.99"></a><span id="l6.99">         }];</span>
<a href="#l6.100"></a><span id="l6.100">         notifyBox.appendNotification(restartLabel,</span>
<a href="#l6.101"></a><span id="l6.101">                                      &quot;restart-required&quot;,</span>
<a href="#l6.102"></a><span id="l6.102">                                      null,</span>
<a href="#l6.103"></a><span id="l6.103">                                      notifyBox.PRIORITY_INFO_MEDIUM,</span>
<a href="#l6.104"></a><span id="l6.104">                                      button);</span>
<a href="#l6.105"></a><span id="l6.105">     };</span>
<a href="#l6.106"></a><span id="l6.106"> </span>
<a href="#l6.107"></a><span id="l6.107">     let buttons = [{</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineminus">-        label:     ltnGetString(&quot;lightning&quot;, &quot;integrationLearnMoreButton&quot;),</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineminus">-        accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationLearnMoreAccessKey&quot;),</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineplus">+        label:     cal.l10n.getLtnString(&quot;integrationLearnMoreButton&quot;),</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineplus">+        accessKey: cal.l10n.getLtnString(&quot;integrationLearnMoreAccessKey&quot;),</span>
<a href="#l6.112"></a><span id="l6.112">         popup:     null,</span>
<a href="#l6.113"></a><span id="l6.113">         callback:  cbLearnMore</span>
<a href="#l6.114"></a><span id="l6.114">     }, {</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineminus">-        label:     ltnGetString(&quot;lightning&quot;, &quot;integrationOptOutButton&quot;),</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineminus">-        accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationOptOutAccessKey&quot;),</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineplus">+        label:     cal.l10n.getLtnString(&quot;integrationOptOutButton&quot;),</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineplus">+        accessKey: cal.l10n.getLtnString(&quot;integrationOptOutAccessKey&quot;),</span>
<a href="#l6.119"></a><span id="l6.119">         popup:     null,</span>
<a href="#l6.120"></a><span id="l6.120">         callback:  cbOptOut</span>
<a href="#l6.121"></a><span id="l6.121">     }, {</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineminus">-        label:     ltnGetString(&quot;lightning&quot;, &quot;integrationKeepItButton&quot;),</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineminus">-        accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationKeepItAccessKey&quot;),</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineplus">+        label:     cal.l10n.getLtnString(&quot;integrationKeepItButton&quot;),</span>
<a href="#l6.125"></a><span id="l6.125" class="difflineplus">+        accessKey: cal.l10n.getLtnString(&quot;integrationKeepItAccessKey&quot;),</span>
<a href="#l6.126"></a><span id="l6.126">         popup:     null,</span>
<a href="#l6.127"></a><span id="l6.127">         callback:  cbKeepIt</span>
<a href="#l6.128"></a><span id="l6.128">     }];</span>
<a href="#l6.129"></a><span id="l6.129"> </span>
<a href="#l6.130"></a><span id="l6.130">     // we use PRIORITY_INFO_MEDIUM to overrule notifications from specialTabs.js if any</span>
<a href="#l6.131"></a><span id="l6.131">     let notification = notifyBox.appendNotification(label,</span>
<a href="#l6.132"></a><span id="l6.132">                                                     &quot;calendar-integration&quot;,</span>
<a href="#l6.133"></a><span id="l6.133">                                                     null,</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineat">@@ -658,17 +658,17 @@ var FIRST_DELAY_UNREGISTER = 0;</span>
<a href="#l6.135"></a><span id="l6.135"> </span>
<a href="#l6.136"></a><span id="l6.136"> var gInvitationsOperationListener = {</span>
<a href="#l6.137"></a><span id="l6.137">     mCount: 0,</span>
<a href="#l6.138"></a><span id="l6.138"> </span>
<a href="#l6.139"></a><span id="l6.139">     QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l6.140"></a><span id="l6.140">     onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDetail) {</span>
<a href="#l6.141"></a><span id="l6.141">         let invitationsBox = document.getElementById(&quot;calendar-invitations-panel&quot;);</span>
<a href="#l6.142"></a><span id="l6.142">         if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineminus">-            let value = ltnGetString(&quot;lightning&quot;, &quot;invitationsLink.label&quot;, [this.mCount]);</span>
<a href="#l6.144"></a><span id="l6.144" class="difflineplus">+            let value = cal.l10n.getLtnString(&quot;invitationsLink.label&quot;, [this.mCount]);</span>
<a href="#l6.145"></a><span id="l6.145">             document.getElementById(&quot;calendar-invitations-label&quot;).value = value;</span>
<a href="#l6.146"></a><span id="l6.146">             setElementValue(invitationsBox, this.mCount &lt; 1 &amp;&amp; &quot;true&quot;, &quot;hidden&quot;);</span>
<a href="#l6.147"></a><span id="l6.147">         } else {</span>
<a href="#l6.148"></a><span id="l6.148">             invitationsBox.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l6.149"></a><span id="l6.149">         }</span>
<a href="#l6.150"></a><span id="l6.150">         this.mCount = 0;</span>
<a href="#l6.151"></a><span id="l6.151">     },</span>
<a href="#l6.152"></a><span id="l6.152"> </span>
<a href="#l6.153"></a><span id="l6.153" class="difflineat">@@ -921,34 +921,34 @@ function checkCalendarBinaryComponent() </span>
<a href="#l6.154"></a><span id="l6.154">     AddonManager.getAddonByID(LIGHTNING_GUID, (ext) =&gt; {</span>
<a href="#l6.155"></a><span id="l6.155">         if (!ext) {</span>
<a href="#l6.156"></a><span id="l6.156">             return;</span>
<a href="#l6.157"></a><span id="l6.157">         }</span>
<a href="#l6.158"></a><span id="l6.158"> </span>
<a href="#l6.159"></a><span id="l6.159">         let version;</span>
<a href="#l6.160"></a><span id="l6.160">         let appversion = Services.appinfo.version;</span>
<a href="#l6.161"></a><span id="l6.161">         let versionparts = appversion.split(&quot;.&quot;);</span>
<a href="#l6.162"></a><span id="l6.162" class="difflineminus">-        let extbrand = ltnGetString(&quot;lightning&quot;, &quot;brandShortName&quot;);</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineplus">+        let extbrand = cal.l10n.getLtnString(&quot;brandShortName&quot;);</span>
<a href="#l6.164"></a><span id="l6.164"> </span>
<a href="#l6.165"></a><span id="l6.165">         switch (Services.appinfo.ID) {</span>
<a href="#l6.166"></a><span id="l6.166">             case THUNDERBIRD_GUID: // e.g. 31.4.0 -&gt; 3.3</span>
<a href="#l6.167"></a><span id="l6.167">                 version = ((parseInt(versionparts[0], 10) + 2) / 10).toFixed(1);</span>
<a href="#l6.168"></a><span id="l6.168">                 break;</span>
<a href="#l6.169"></a><span id="l6.169">             case SEAMONKEY_GUID: // e.g. 2.28.4 -&gt; 3.3</span>
<a href="#l6.170"></a><span id="l6.170">                 version = ((parseInt(versionparts[1], 10) + 5) / 10).toFixed(1);</span>
<a href="#l6.171"></a><span id="l6.171">                 break;</span>
<a href="#l6.172"></a><span id="l6.172">         }</span>
<a href="#l6.173"></a><span id="l6.173"> </span>
<a href="#l6.174"></a><span id="l6.174">         let text;</span>
<a href="#l6.175"></a><span id="l6.175">         if (version &amp;&amp; version != ext.version) {</span>
<a href="#l6.176"></a><span id="l6.176">             let args = [extbrand, ext.version, version];</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineminus">-            text = ltnGetString(&quot;lightning&quot;, &quot;binaryComponentKnown&quot;, args);</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineplus">+            text = cal.l10n.getLtnString(&quot;binaryComponentKnown&quot;, args);</span>
<a href="#l6.179"></a><span id="l6.179">         } else {</span>
<a href="#l6.180"></a><span id="l6.180">             let brand = cal.calGetString(&quot;brand&quot;, &quot;brandShortName&quot;, null, &quot;branding&quot;);</span>
<a href="#l6.181"></a><span id="l6.181">             let args = [extbrand, brand, appversion, ext.version];</span>
<a href="#l6.182"></a><span id="l6.182" class="difflineminus">-            text = ltnGetString(&quot;lightning&quot;, &quot;binaryComponentUnknown&quot;, args);</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineplus">+            text = cal.l10n.getLtnString(&quot;binaryComponentUnknown&quot;, args);</span>
<a href="#l6.184"></a><span id="l6.184">         }</span>
<a href="#l6.185"></a><span id="l6.185"> </span>
<a href="#l6.186"></a><span id="l6.186" class="difflineminus">-        let title = ltnGetString(&quot;lightning&quot;, &quot;binaryComponentTitle&quot;, [extbrand]);</span>
<a href="#l6.187"></a><span id="l6.187" class="difflineplus">+        let title = cal.l10n.getLtnString(&quot;binaryComponentTitle&quot;, [extbrand]);</span>
<a href="#l6.188"></a><span id="l6.188">         openAddonsMgr(&quot;addons://detail/&quot; + encodeURIComponent(LIGHTNING_GUID));</span>
<a href="#l6.189"></a><span id="l6.189">         Services.prompt.alert(window, title, text);</span>
<a href="#l6.190"></a><span id="l6.190">     });</span>
<a href="#l6.191"></a><span id="l6.191"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,20 +1,21 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.5"></a><span id="l7.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.6"></a><span id="l7.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l7.9"></a><span id="l7.9"> ChromeUtils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l7.10"></a><span id="l7.10"> ChromeUtils.import(&quot;resource://calendar/modules/calRecurrenceUtils.jsm&quot;);</span>
<a href="#l7.11"></a><span id="l7.11"> ChromeUtils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-ChromeUtils.import(&quot;resource://calendar/modules/ltnUtils.jsm&quot;);</span>
<a href="#l7.13"></a><span id="l7.13"> ChromeUtils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-this.EXPORTED_SYMBOLS = [&quot;ltn&quot;]; // even though it's defined in ltnUtils.jsm, import needs this</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+this.EXPORTED_SYMBOLS = [&quot;ltn&quot;]; /* exported ltn */</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+var ltn = {};</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+</span>
<a href="#l7.19"></a><span id="l7.19"> ltn.invitation = {</span>
<a href="#l7.20"></a><span id="l7.20">     /**</span>
<a href="#l7.21"></a><span id="l7.21">      * Returns a header title for an ITIP item depending on the response method</span>
<a href="#l7.22"></a><span id="l7.22">      * @param  {calItipItem}     aItipItem  the itip item to check</span>
<a href="#l7.23"></a><span id="l7.23">      * @return {String}          the header title</span>
<a href="#l7.24"></a><span id="l7.24">      */</span>
<a href="#l7.25"></a><span id="l7.25">     getItipHeader: function(aItipItem) {</span>
<a href="#l7.26"></a><span id="l7.26">         let header;</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineat">@@ -23,59 +24,57 @@ ltn.invitation = {</span>
<a href="#l7.28"></a><span id="l7.28">             let item = aItipItem.getItemList({})[0];</span>
<a href="#l7.29"></a><span id="l7.29">             let summary = item.getProperty(&quot;SUMMARY&quot;) || &quot;&quot;;</span>
<a href="#l7.30"></a><span id="l7.30">             let organizer = item.organizer;</span>
<a href="#l7.31"></a><span id="l7.31">             let organizerString = (organizer) ?</span>
<a href="#l7.32"></a><span id="l7.32">               (organizer.commonName || organizer.toString()) : &quot;&quot;;</span>
<a href="#l7.33"></a><span id="l7.33"> </span>
<a href="#l7.34"></a><span id="l7.34">             switch (aItipItem.responseMethod) {</span>
<a href="#l7.35"></a><span id="l7.35">                 case &quot;REQUEST&quot;:</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-                    header = ltn.getString(&quot;lightning&quot;,</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-                                           &quot;itipRequestBody&quot;,</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-                                           [organizerString, summary]);</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+                    header = cal.l10n.getLtnString(</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+                        &quot;itipRequestBody&quot;,</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+                        [organizerString, summary]</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+                    );</span>
<a href="#l7.43"></a><span id="l7.43">                     break;</span>
<a href="#l7.44"></a><span id="l7.44">                 case &quot;CANCEL&quot;:</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-                    header = ltn.getString(&quot;lightning&quot;,</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-                                           &quot;itipCancelBody&quot;,</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineminus">-                                           [organizerString, summary]);</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+                    header = cal.l10n.getLtnString(</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+                        &quot;itipCancelBody&quot;,</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+                        [organizerString, summary]</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+                    );</span>
<a href="#l7.52"></a><span id="l7.52">                     break;</span>
<a href="#l7.53"></a><span id="l7.53">                 case &quot;COUNTER&quot;:</span>
<a href="#l7.54"></a><span id="l7.54">                     // falls through</span>
<a href="#l7.55"></a><span id="l7.55">                 case &quot;REPLY&quot;: {</span>
<a href="#l7.56"></a><span id="l7.56">                     let attendees = item.getAttendees({});</span>
<a href="#l7.57"></a><span id="l7.57">                     let sender = cal.itip.getAttendeesBySender(attendees, aItipItem.sender);</span>
<a href="#l7.58"></a><span id="l7.58">                     if (sender.length == 1) {</span>
<a href="#l7.59"></a><span id="l7.59">                         if (aItipItem.responseMethod == &quot;COUNTER&quot;) {</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-                            header = cal.calGetString(&quot;lightning&quot;,</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-                                                      &quot;itipCounterBody&quot;,</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-                                                      [sender[0].toString(), summary],</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-                                                      &quot;lightning&quot;);</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+                            header = cal.l10n.getLtnString(&quot;itipCounterBody&quot;,</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+                                                           [sender[0].toString(), summary]);</span>
<a href="#l7.66"></a><span id="l7.66">                         } else {</span>
<a href="#l7.67"></a><span id="l7.67">                             let statusString = (sender[0].participationStatus == &quot;DECLINED&quot; ?</span>
<a href="#l7.68"></a><span id="l7.68">                                                 &quot;itipReplyBodyDecline&quot; : &quot;itipReplyBodyAccept&quot;);</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-                            header = cal.calGetString(&quot;lightning&quot;,</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-                                                      statusString,</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-                                                      [sender[0].toString()],</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineminus">-                                                      &quot;lightning&quot;);</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+                            header = cal.l10n.getLtnString(statusString, [sender[0].toString()]);</span>
<a href="#l7.74"></a><span id="l7.74">                         }</span>
<a href="#l7.75"></a><span id="l7.75">                     } else {</span>
<a href="#l7.76"></a><span id="l7.76">                         header = &quot;&quot;;</span>
<a href="#l7.77"></a><span id="l7.77">                     }</span>
<a href="#l7.78"></a><span id="l7.78">                     break;</span>
<a href="#l7.79"></a><span id="l7.79">                 }</span>
<a href="#l7.80"></a><span id="l7.80">                 case &quot;DECLINECOUNTER&quot;:</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-                    header = ltn.getString(&quot;lightning&quot;,</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-                                           &quot;itipDeclineCounterBody&quot;,</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineminus">-                                           [organizerString, summary]);</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineplus">+                    header = cal.l10n.getLtnString(</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineplus">+                        &quot;itipDeclineCounterBody&quot;,</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+                        [organizerString, summary]</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+                    );</span>
<a href="#l7.88"></a><span id="l7.88">                     break;</span>
<a href="#l7.89"></a><span id="l7.89">             }</span>
<a href="#l7.90"></a><span id="l7.90">         }</span>
<a href="#l7.91"></a><span id="l7.91"> </span>
<a href="#l7.92"></a><span id="l7.92">         if (!header) {</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineminus">-            header = ltn.getString(&quot;lightning&quot;, &quot;imipHtml.header&quot;, null);</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineplus">+            header = cal.l10n.getLtnString(&quot;imipHtml.header&quot;);</span>
<a href="#l7.95"></a><span id="l7.95">         }</span>
<a href="#l7.96"></a><span id="l7.96"> </span>
<a href="#l7.97"></a><span id="l7.97">         return header;</span>
<a href="#l7.98"></a><span id="l7.98">     },</span>
<a href="#l7.99"></a><span id="l7.99"> </span>
<a href="#l7.100"></a><span id="l7.100">     /**</span>
<a href="#l7.101"></a><span id="l7.101">      * Returns the html representation of the event as a DOM document.</span>
<a href="#l7.102"></a><span id="l7.102">      *</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineat">@@ -89,17 +88,17 @@ ltn.invitation = {</span>
<a href="#l7.104"></a><span id="l7.104">         let formatter = cal.getDateFormatter();</span>
<a href="#l7.105"></a><span id="l7.105"> </span>
<a href="#l7.106"></a><span id="l7.106">         let linkConverter = Components.classes[&quot;@mozilla.org/txttohtmlconv;1&quot;]</span>
<a href="#l7.107"></a><span id="l7.107">                                       .getService(Components.interfaces.mozITXTToHTMLConv);</span>
<a href="#l7.108"></a><span id="l7.108"> </span>
<a href="#l7.109"></a><span id="l7.109">         let field = function(aField, aContentText, aConvert) {</span>
<a href="#l7.110"></a><span id="l7.110">             let descr = doc.getElementById(&quot;imipHtml-&quot; + aField + &quot;-descr&quot;);</span>
<a href="#l7.111"></a><span id="l7.111">             if (descr) {</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineminus">-                let labelText = ltn.getString(&quot;lightning&quot;, &quot;imipHtml.&quot; + aField, null);</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineplus">+                let labelText = cal.l10n.getLtnString(&quot;imipHtml.&quot; + aField);</span>
<a href="#l7.114"></a><span id="l7.114">                 descr.textContent = labelText;</span>
<a href="#l7.115"></a><span id="l7.115">             }</span>
<a href="#l7.116"></a><span id="l7.116"> </span>
<a href="#l7.117"></a><span id="l7.117">             if (aContentText) {</span>
<a href="#l7.118"></a><span id="l7.118">                 let content = doc.getElementById(&quot;imipHtml-&quot; + aField + &quot;-content&quot;);</span>
<a href="#l7.119"></a><span id="l7.119">                 doc.getElementById(&quot;imipHtml-&quot; + aField + &quot;-row&quot;).hidden = false;</span>
<a href="#l7.120"></a><span id="l7.120">                 if (aConvert) {</span>
<a href="#l7.121"></a><span id="l7.121">                     // we convert special characters first to not mix up html conversion</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineat">@@ -184,17 +183,17 @@ ltn.invitation = {</span>
<a href="#l7.123"></a><span id="l7.123">                     cal.data.binaryInsert(modifiedOccurrences, exc, dateComptor, true);</span>
<a href="#l7.124"></a><span id="l7.124">                 }</span>
<a href="#l7.125"></a><span id="l7.125">             }</span>
<a href="#l7.126"></a><span id="l7.126"> </span>
<a href="#l7.127"></a><span id="l7.127">             let stringifyOcc = function(occ) {</span>
<a href="#l7.128"></a><span id="l7.128">                 let formattedExc = formatter.formatItemInterval(occ);</span>
<a href="#l7.129"></a><span id="l7.129">                 let occLocation = occ.getProperty(&quot;LOCATION&quot;);</span>
<a href="#l7.130"></a><span id="l7.130">                 if (occLocation != aEvent.getProperty(&quot;LOCATION&quot;)) {</span>
<a href="#l7.131"></a><span id="l7.131" class="difflineminus">-                    let location = ltn.getString(&quot;lightning&quot;, &quot;imipHtml.newLocation&quot;, [occLocation]);</span>
<a href="#l7.132"></a><span id="l7.132" class="difflineplus">+                    let location = cal.l10n.getLtnString(&quot;imipHtml.newLocation&quot;, [occLocation]);</span>
<a href="#l7.133"></a><span id="l7.133">                     formattedExc += &quot; (&quot; + location + &quot;)&quot;;</span>
<a href="#l7.134"></a><span id="l7.134">                 }</span>
<a href="#l7.135"></a><span id="l7.135">                 return formattedExc;</span>
<a href="#l7.136"></a><span id="l7.136">             };</span>
<a href="#l7.137"></a><span id="l7.137"> </span>
<a href="#l7.138"></a><span id="l7.138">             if (modifiedOccurrences.length &gt; 0) {</span>
<a href="#l7.139"></a><span id="l7.139">                 field(&quot;modifiedOccurrences&quot;, modifiedOccurrences.map(stringifyOcc).join(&quot;\n&quot;));</span>
<a href="#l7.140"></a><span id="l7.140">             }</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineat">@@ -233,38 +232,38 @@ ltn.invitation = {</span>
<a href="#l7.142"></a><span id="l7.142">         let setupAttendee = function(aAttendee) {</span>
<a href="#l7.143"></a><span id="l7.143">             let row = attendeeTemplate.cloneNode(true);</span>
<a href="#l7.144"></a><span id="l7.144">             row.removeAttribute(&quot;id&quot;);</span>
<a href="#l7.145"></a><span id="l7.145">             row.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l7.146"></a><span id="l7.146"> </span>
<a href="#l7.147"></a><span id="l7.147">             // resolve delegatees/delegators to display also the CN</span>
<a href="#l7.148"></a><span id="l7.148">             let del = cal.itip.resolveDelegation(aAttendee, attendees);</span>
<a href="#l7.149"></a><span id="l7.149">             if (del.delegators != &quot;&quot;) {</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineminus">-                del.delegators = &quot; &quot; + ltn.getString(&quot;lightning&quot;, &quot;imipHtml.attendeeDelegatedFrom&quot;,</span>
<a href="#l7.151"></a><span id="l7.151" class="difflineplus">+                del.delegators = &quot; &quot; + cal.l10n.getLtnString(&quot;imipHtml.attendeeDelegatedFrom&quot;,</span>
<a href="#l7.152"></a><span id="l7.152">                                                      [del.delegators]);</span>
<a href="#l7.153"></a><span id="l7.153">             }</span>
<a href="#l7.154"></a><span id="l7.154"> </span>
<a href="#l7.155"></a><span id="l7.155">             // display itip icon</span>
<a href="#l7.156"></a><span id="l7.156">             let role = aAttendee.role || &quot;REQ-PARTICIPANT&quot;;</span>
<a href="#l7.157"></a><span id="l7.157">             let partstat = aAttendee.participationStatus || &quot;NEEDS-ACTION&quot;;</span>
<a href="#l7.158"></a><span id="l7.158">             let userType = aAttendee.userType || &quot;INDIVIDUAL&quot;;</span>
<a href="#l7.159"></a><span id="l7.159">             let itipIcon = row.getElementsByClassName(&quot;itip-icon&quot;)[0];</span>
<a href="#l7.160"></a><span id="l7.160">             itipIcon.setAttribute(&quot;role&quot;, role);</span>
<a href="#l7.161"></a><span id="l7.161">             itipIcon.setAttribute(&quot;usertype&quot;, userType);</span>
<a href="#l7.162"></a><span id="l7.162">             itipIcon.setAttribute(&quot;partstat&quot;, partstat);</span>
<a href="#l7.163"></a><span id="l7.163">             let attName = aAttendee.commonName &amp;&amp; aAttendee.commonName.length</span>
<a href="#l7.164"></a><span id="l7.164">                           ? aAttendee.commonName : aAttendee.toString();</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineminus">-            let userTypeString = ltn.getString(&quot;lightning&quot;, &quot;imipHtml.attendeeUserType2.&quot; + userType,</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineminus">-                                               [aAttendee.toString()]);</span>
<a href="#l7.167"></a><span id="l7.167" class="difflineminus">-            let roleString = ltn.getString(&quot;lightning&quot;, &quot;imipHtml.attendeeRole2.&quot; + role,</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineminus">-                                           [userTypeString]);</span>
<a href="#l7.169"></a><span id="l7.169" class="difflineminus">-            let partstatString = ltn.getString(&quot;lightning&quot;, &quot;imipHtml.attendeePartStat2.&quot; + partstat,</span>
<a href="#l7.170"></a><span id="l7.170" class="difflineminus">-                                               [attName, del.delegatees]);</span>
<a href="#l7.171"></a><span id="l7.171" class="difflineminus">-            let itipTooltip = ltn.getString(&quot;lightning&quot;, &quot;imipHtml.attendee.combined&quot;,</span>
<a href="#l7.172"></a><span id="l7.172" class="difflineminus">-                                            [roleString, partstatString]);</span>
<a href="#l7.173"></a><span id="l7.173" class="difflineplus">+            let userTypeString = cal.l10n.getLtnString(&quot;imipHtml.attendeeUserType2.&quot; + userType,</span>
<a href="#l7.174"></a><span id="l7.174" class="difflineplus">+                                                       [aAttendee.toString()]);</span>
<a href="#l7.175"></a><span id="l7.175" class="difflineplus">+            let roleString = cal.l10n.getLtnString(&quot;imipHtml.attendeeRole2.&quot; + role,</span>
<a href="#l7.176"></a><span id="l7.176" class="difflineplus">+                                                   [userTypeString]);</span>
<a href="#l7.177"></a><span id="l7.177" class="difflineplus">+            let partstatString = cal.l10n.getLtnString(&quot;imipHtml.attendeePartStat2.&quot; + partstat,</span>
<a href="#l7.178"></a><span id="l7.178" class="difflineplus">+                                                       [attName, del.delegatees]);</span>
<a href="#l7.179"></a><span id="l7.179" class="difflineplus">+            let itipTooltip = cal.l10n.getLtnString(&quot;imipHtml.attendee.combined&quot;,</span>
<a href="#l7.180"></a><span id="l7.180" class="difflineplus">+                                                    [roleString, partstatString]);</span>
<a href="#l7.181"></a><span id="l7.181">             row.setAttribute(&quot;title&quot;, itipTooltip);</span>
<a href="#l7.182"></a><span id="l7.182">             // display attendee</span>
<a href="#l7.183"></a><span id="l7.183">             row.getElementsByClassName(&quot;attendee-name&quot;)[0].textContent = aAttendee.toString() +</span>
<a href="#l7.184"></a><span id="l7.184">                                                                          del.delegators;</span>
<a href="#l7.185"></a><span id="l7.185">             return row;</span>
<a href="#l7.186"></a><span id="l7.186">         };</span>
<a href="#l7.187"></a><span id="l7.187"> </span>
<a href="#l7.188"></a><span id="l7.188">         // Fill rows for attendees and organizer</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">deleted file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- a/calendar/lightning/modules/ltnUtils.jsm</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ /dev/null</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -1,22 +0,0 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineminus">- * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineminus">-</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">-/* exported ltn */</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">-</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">-ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-this.EXPORTED_SYMBOLS = [&quot;ltn&quot;];</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-var ltn = {</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-    /**</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-     * Gets the value of a string in a .properties file from the lightning bundle</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-     *</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-     * @param {String} aBundleName  the name of the properties file. It is assumed that the</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-     *                              file lives in chrome://lightning/locale/</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-     * @param {String} aStringName  the name of the string within the properties file</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-     * @param {Array}  aParams      [optional] array of parameters to format the string</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-     */</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-    getString: function(aBundleName, aStringName, aParams) {</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-        return cal.calGetString(aBundleName, aStringName, aParams, &quot;lightning&quot;);</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-    }</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/lightning/modules/moz.build</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/lightning/modules/moz.build</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,9 +1,8 @@</span>
<a href="#l9.4"></a><span id="l9.4"> # vim: set filetype=python:</span>
<a href="#l9.5"></a><span id="l9.5"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.7"></a><span id="l9.7"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> EXTRA_JS_MODULES += [</span>
<a href="#l9.10"></a><span id="l9.10">     'ltnInvitationUtils.jsm',</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineminus">-    'ltnUtils.jsm',</span>
<a href="#l9.12"></a><span id="l9.12"> ]</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

