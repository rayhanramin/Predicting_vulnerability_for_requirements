<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 2517:3c908fd109226622140a2c22a30ac257b04e2323</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 3c908fd109226622140a2c22a30ac257b04e2323" />
<meta property="og:url" content="/comm-central/rev/3c908fd109226622140a2c22a30ac257b04e2323" />
<meta property="og:description" content="Bug 415372 - Implement Feed Preview. r+sr=Neil." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 3c908fd109226622140a2c22a30ac257b04e2323 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/3c908fd109226622140a2c22a30ac257b04e2323">shortlog</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/3c908fd109226622140a2c22a30ac257b04e2323">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323">files</a> |
changeset |
<a href="/comm-central/raw-rev/3c908fd109226622140a2c22a30ac257b04e2323">raw</a>  | <a href="/comm-central/archive/3c908fd109226622140a2c22a30ac257b04e2323.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=415372">Bug 415372</a> - Implement Feed Preview. r+sr=Neil.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#67;&#97;&#105;&#111;&#32;&#84;&#105;&#97;&#103;&#111;&#32;&#79;&#108;&#105;&#118;&#101;&#105;&#114;&#97;&#32;&#60;&#97;&#115;&#114;&#97;&#105;&#108;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 30 Apr 2009 12:47:26 +0200</td></tr>

<tr>
 <td>changeset 2517</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/3c908fd109226622140a2c22a30ac257b04e2323">3c908fd109226622140a2c22a30ac257b04e2323</a></td>
</tr>



<tr>
<td>parent 2516</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8e72da55519104f7c343448c2ee2daa6529f588d">8e72da55519104f7c343448c2ee2daa6529f588d</a>
</td>
</tr>

<tr>
<td>child 2518</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/82c4914ad8ea1e1206cc22094f187d316b0df8ce">82c4914ad8ea1e1206cc22094f187d316b0df8ce</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=3c908fd109226622140a2c22a30ac257b04e2323">2053</a></td></tr>
<tr><td>push user</td><td>stefanh@inbox.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 30 Apr 2009 10:47:36 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@3c908fd10922 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3c908fd109226622140a2c22a30ac257b04e2323">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3c908fd109226622140a2c22a30ac257b04e2323&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3c908fd109226622140a2c22a30ac257b04e2323&newProject=comm-central&newRevision=3c908fd109226622140a2c22a30ac257b04e2323&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3c908fd109226622140a2c22a30ac257b04e2323&newProject=comm-central&newRevision=3c908fd109226622140a2c22a30ac257b04e2323&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3c908fd109226622140a2c22a30ac257b04e2323&newProject=comm-central&newRevision=3c908fd109226622140a2c22a30ac257b04e2323&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=415372">415372</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=415372">Bug 415372</a> - Implement Feed Preview. r+sr=Neil.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/Makefile.in">suite/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/Makefile.in">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/Makefile.in">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/Makefile.in">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/Makefile.in">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/linkToolbarOverlay.xul">suite/browser/linkToolbarOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/linkToolbarOverlay.xul">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/linkToolbarOverlay.xul">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/linkToolbarOverlay.xul">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/linkToolbarOverlay.xul">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/linkToolbarOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigator.xul">suite/browser/navigator.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigator.xul">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigator.xul">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigator.xul">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigator.xul">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigator.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigatorOverlay.xul">suite/browser/navigatorOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigatorOverlay.xul">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigatorOverlay.xul">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigatorOverlay.xul">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigatorOverlay.xul">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/navigatorOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.js">suite/browser/pageinfo/feeds.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.js">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.js">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.js">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.js">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.xml">suite/browser/pageinfo/feeds.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.xml">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.xml">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.xml">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.xml">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/browser/pageinfo/feeds.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/Makefile.in">suite/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/nsSuiteModule.cpp">suite/build/nsSuiteModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/nsSuiteModule.cpp">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/nsSuiteModule.cpp">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/nsSuiteModule.cpp">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/nsSuiteModule.cpp">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/build/nsSuiteModule.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.js">suite/common/feeds/subscribe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.js">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.js">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.js">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.js">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.xhtml">suite/common/feeds/subscribe.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.xhtml">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.xhtml">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.xhtml">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.xhtml">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/feeds/subscribe.xhtml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/jar.mn">suite/common/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/jar.mn">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/jar.mn">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/jar.mn">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/jar.mn">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/pref/pref-applications.js">suite/common/pref/pref-applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/pref/pref-applications.js">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/pref/pref-applications.js">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/pref/pref-applications.js">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/pref/pref-applications.js">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/pref/pref-applications.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/utilityOverlay.js">suite/common/utilityOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/utilityOverlay.js">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/utilityOverlay.js">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/utilityOverlay.js">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/utilityOverlay.js">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/common/utilityOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/Makefile.in">suite/feeds/public/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/Makefile.in">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/Makefile.in">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/Makefile.in">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/Makefile.in">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedResultService.idl">suite/feeds/public/nsIFeedResultService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedResultService.idl">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedResultService.idl">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedResultService.idl">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedResultService.idl">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedResultService.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedWriter.idl">suite/feeds/public/nsIFeedWriter.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedWriter.idl">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedWriter.idl">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedWriter.idl">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedWriter.idl">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIFeedWriter.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIWebContentConverterRegistrar.idl">suite/feeds/public/nsIWebContentConverterRegistrar.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIWebContentConverterRegistrar.idl">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIWebContentConverterRegistrar.idl">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIWebContentConverterRegistrar.idl">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIWebContentConverterRegistrar.idl">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/public/nsIWebContentConverterRegistrar.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedConverter.js">suite/feeds/src/FeedConverter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedConverter.js">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedConverter.js">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedConverter.js">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedConverter.js">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedConverter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedWriter.js">suite/feeds/src/FeedWriter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedWriter.js">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedWriter.js">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedWriter.js">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedWriter.js">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/FeedWriter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/Makefile.in">suite/feeds/src/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/Makefile.in">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/Makefile.in">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/Makefile.in">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/Makefile.in">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/WebContentConverter.js">suite/feeds/src/WebContentConverter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/WebContentConverter.js">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/WebContentConverter.js">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/WebContentConverter.js">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/WebContentConverter.js">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/WebContentConverter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsAboutFeeds.js">suite/feeds/src/nsAboutFeeds.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsAboutFeeds.js">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsAboutFeeds.js">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsAboutFeeds.js">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsAboutFeeds.js">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsAboutFeeds.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.cpp">suite/feeds/src/nsFeedSniffer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.cpp">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.cpp">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.cpp">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.cpp">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.h">suite/feeds/src/nsFeedSniffer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.h">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.h">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.h">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.h">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/feeds/src/nsFeedSniffer.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/unix/packages">suite/installer/unix/packages</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/unix/packages">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/unix/packages">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/unix/packages">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/unix/packages">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/unix/packages">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/windows/packages">suite/installer/windows/packages</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/windows/packages">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/windows/packages">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/windows/packages">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/windows/packages">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/installer/windows/packages">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.dtd">suite/locales/en-US/chrome/common/feeds/subscribe.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.dtd">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.dtd">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.dtd">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.dtd">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.properties">suite/locales/en-US/chrome/common/feeds/subscribe.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.properties">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.properties">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.properties">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.properties">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/feeds/subscribe.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/pref/pref-applications.properties">suite/locales/en-US/chrome/common/pref/pref-applications.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/pref/pref-applications.properties">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/pref/pref-applications.properties">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/pref/pref-applications.properties">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/pref/pref-applications.properties">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/en-US/chrome/common/pref/pref-applications.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/jar.mn">suite/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/makefiles.sh">suite/makefiles.sh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/makefiles.sh">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/makefiles.sh">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/makefiles.sh">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/makefiles.sh">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/makefiles.sh">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/feed-subscribe.css">suite/themes/classic/communicator/feed-subscribe.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/feed-subscribe.css">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/feed-subscribe.css">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/feed-subscribe.css">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/feed-subscribe.css">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/feed-subscribe.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/icons/feedIcon.png">suite/themes/classic/communicator/icons/feedIcon.png</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/icons/feedIcon.png">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/icons/feedIcon.png">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/icons/feedIcon.png">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/icons/feedIcon.png">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/communicator/icons/feedIcon.png">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/jar.mn">suite/themes/classic/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/jar.mn">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/jar.mn">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/jar.mn">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/jar.mn">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/classic/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/feed-subscribe.css">suite/themes/modern/communicator/feed-subscribe.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/feed-subscribe.css">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/feed-subscribe.css">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/feed-subscribe.css">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/feed-subscribe.css">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/feed-subscribe.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/icons/feedIcon.png">suite/themes/modern/communicator/icons/feedIcon.png</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/icons/feedIcon.png">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/icons/feedIcon.png">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/icons/feedIcon.png">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/icons/feedIcon.png">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/communicator/icons/feedIcon.png">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/jar.mn">suite/themes/modern/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/jar.mn">file</a> |
<a href="/comm-central/annotate/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/jar.mn">annotate</a> |
<a href="/comm-central/diff/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/jar.mn">diff</a> |
<a href="/comm-central/comparison/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/jar.mn">comparison</a> |
<a href="/comm-central/log/3c908fd109226622140a2c22a30ac257b04e2323/suite/themes/modern/jar.mn">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/Makefile.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/Makefile.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -45,16 +45,18 @@ include $(DEPTH)/config/autoconf.mk</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> # XXX Disable for release builds</span>
<a href="#l1.6"></a><span id="l1.6"> PARALLEL_DIRS = debugQA</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> PARALLEL_DIRS	+= \</span>
<a href="#l1.9"></a><span id="l1.9"> 		branding \</span>
<a href="#l1.10"></a><span id="l1.10"> 		browser \</span>
<a href="#l1.11"></a><span id="l1.11"> 		common \</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+		feeds/public \</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+		feeds/src \</span>
<a href="#l1.14"></a><span id="l1.14"> 		locales \</span>
<a href="#l1.15"></a><span id="l1.15"> 		modules \</span>
<a href="#l1.16"></a><span id="l1.16"> 		themes/classic \</span>
<a href="#l1.17"></a><span id="l1.17"> 		themes/modern \</span>
<a href="#l1.18"></a><span id="l1.18"> 		profile \</span>
<a href="#l1.19"></a><span id="l1.19"> 		security \</span>
<a href="#l1.20"></a><span id="l1.20"> 		shell/public \</span>
<a href="#l1.21"></a><span id="l1.21"> 		$(NULL)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/browser/linkToolbarOverlay.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/browser/linkToolbarOverlay.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -194,14 +194,13 @@</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">         &lt;/menupopup&gt;</span>
<a href="#l2.6"></a><span id="l2.6">       &lt;/toolbarbutton&gt;</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8">       &lt;toolbarbutton id=&quot;link-feed&quot; class=&quot;bookmark-item&quot;</span>
<a href="#l2.9"></a><span id="l2.9">           type=&quot;menu&quot;</span>
<a href="#l2.10"></a><span id="l2.10">           container=&quot;true&quot;</span>
<a href="#l2.11"></a><span id="l2.11">           label=&quot;&amp;feedButton.label;&quot; disabled=&quot;true&quot;&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        &lt;!-- XXXCallek oncommand temporary until feed Preview works --&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-        &lt;menupopup id=&quot;link-feed-popup&quot; oncommand=&quot;event.stopPropagation(); return subscribeToFeed('feed:' + event.target.getAttribute('href');&quot;/&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+        &lt;menupopup id=&quot;link-feed-popup&quot;/&gt;</span>
<a href="#l2.15"></a><span id="l2.15">       &lt;/toolbarbutton&gt;</span>
<a href="#l2.16"></a><span id="l2.16">     &lt;/toolbar&gt;</span>
<a href="#l2.17"></a><span id="l2.17">   &lt;/toolbox&gt;</span>
<a href="#l2.18"></a><span id="l2.18"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/browser/navigator.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/browser/navigator.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -137,20 +137,20 @@</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">   &lt;popupset id=&quot;mainPopupSet&quot;/&gt; &lt;!-- Firefox extension compatibility --&gt;</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7">   &lt;popup id=&quot;toolbar-context-menu&quot;/&gt;</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">   &lt;!-- context menu --&gt;</span>
<a href="#l3.10"></a><span id="l3.10">   &lt;popupset id=&quot;contentAreaContextSet&quot;/&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  &lt;!-- XXXCallek this should be loadURI rather than subscribe* here --&gt;</span>
<a href="#l3.13"></a><span id="l3.13">   &lt;popup id=&quot;feedsPopup&quot; popupanchor=&quot;bottomright&quot; popupalign=&quot;topright&quot;</span>
<a href="#l3.14"></a><span id="l3.14">          onpopupshowing=&quot;window.XULBrowserWindow.populateFeeds(this);&quot;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-         oncommand=&quot;subscribeToFeed('feed:' + event.target.statusText /*, gBrowser.currentURI*/);&quot;/&gt;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+         oncommand=&quot;subscribeToFeed(event.target.statusText, event);&quot;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+         onclick=&quot;checkForMiddleClick(this, event);&quot;/&gt;</span>
<a href="#l3.18"></a><span id="l3.18">   &lt;panel type=&quot;autocomplete&quot; id=&quot;PopupAutoComplete&quot; level=&quot;top&quot;/&gt;</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">   &lt;toolbox id=&quot;navigator-toolbox&quot; class=&quot;toolbox-top&quot; deferattached=&quot;true&quot;</span>
<a href="#l3.21"></a><span id="l3.21">            mode=&quot;full&quot; defaultmode=&quot;full&quot;&gt;</span>
<a href="#l3.22"></a><span id="l3.22">     &lt;!-- Menu --&gt;</span>
<a href="#l3.23"></a><span id="l3.23">     &lt;toolbar type=&quot;menubar&quot; id=&quot;toolbar-menubar&quot; class=&quot;chromeclass-menubar&quot;</span>
<a href="#l3.24"></a><span id="l3.24">              persist=&quot;collapsed&quot; grippytooltiptext=&quot;&amp;menuBar.tooltip;&quot; customizable=&quot;true&quot;</span>
<a href="#l3.25"></a><span id="l3.25">              defaultset=&quot;menubar-items&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/browser/navigatorOverlay.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/browser/navigatorOverlay.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -482,17 +482,18 @@</span>
<a href="#l4.4"></a><span id="l4.4">         &lt;menuitem key=&quot;addBookmarkKb&quot;   command=&quot;Browser:AddBookmark&quot;/&gt;</span>
<a href="#l4.5"></a><span id="l4.5">         &lt;menuitem key=&quot;addBookmarkAsKb&quot; command=&quot;Browser:AddBookmarkAs&quot;/&gt;</span>
<a href="#l4.6"></a><span id="l4.6">         &lt;menuitem                       command=&quot;Browser:AddGroupmarkAs&quot;/&gt;</span>
<a href="#l4.7"></a><span id="l4.7">         &lt;menuitem key=&quot;manBookmarkKb&quot;   command=&quot;Browser:ManageBookmark&quot;/&gt;</span>
<a href="#l4.8"></a><span id="l4.8">         &lt;menuseparator/&gt;</span>
<a href="#l4.9"></a><span id="l4.9">         &lt;menu id=&quot;feedsMenu&quot; class=&quot;menu-iconic&quot; disabled=&quot;true&quot;</span>
<a href="#l4.10"></a><span id="l4.10">               label=&quot;&amp;feedsMenu.label;&quot; accesskey=&quot;&amp;feedsMenu.accesskey;&quot;&gt;</span>
<a href="#l4.11"></a><span id="l4.11">           &lt;menupopup onpopupshowing=&quot;window.XULBrowserWindow.populateFeeds(this);&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                     oncommand=&quot;subscribeToFeed('feed:' + event.target.statusText /*, gBrowser.currentURI*/);&quot;/&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                     oncommand=&quot;subscribeToFeed(event.target.statusText, event);&quot;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+                     onclick=&quot;checkForMiddleClick(this, event);&quot;/&gt;</span>
<a href="#l4.15"></a><span id="l4.15">         &lt;/menu&gt;</span>
<a href="#l4.16"></a><span id="l4.16">         &lt;menuseparator/&gt;</span>
<a href="#l4.17"></a><span id="l4.17">       &lt;/menupopup&gt;</span>
<a href="#l4.18"></a><span id="l4.18">     &lt;/menu&gt;</span>
<a href="#l4.19"></a><span id="l4.19">       </span>
<a href="#l4.20"></a><span id="l4.20">   &lt;menu id=&quot;tasksMenu&quot;&gt;</span>
<a href="#l4.21"></a><span id="l4.21">     &lt;menupopup id=&quot;taskPopup&quot;&gt;</span>
<a href="#l4.22"></a><span id="l4.22">       &lt;menuitem id=&quot;menu_searchWeb&quot; label=&quot;&amp;searchInternetCmd.label;&quot; key=&quot;searchInternetKb&quot; accesskey=&quot;&amp;searchInternetCmd.accesskey;&quot; command=&quot;Browser:SearchInternet&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/browser/pageinfo/feeds.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/browser/pageinfo/feeds.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -68,20 +68,20 @@ function initFeedTab()</span>
<a href="#l5.4"></a><span id="l5.4">         addRow(link.title, type, link.href);</span>
<a href="#l5.5"></a><span id="l5.5">       }</span>
<a href="#l5.6"></a><span id="l5.6">     }</span>
<a href="#l5.7"></a><span id="l5.7">   }</span>
<a href="#l5.8"></a><span id="l5.8">   var feedListbox = document.getElementById(&quot;feedListbox&quot;);</span>
<a href="#l5.9"></a><span id="l5.9">   document.getElementById(&quot;feedTab&quot;).hidden = feedListbox.getRowCount() == 0;</span>
<a href="#l5.10"></a><span id="l5.10"> }</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-function onSubscribeFeed()</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+function onSubscribeFeed(event)</span>
<a href="#l5.14"></a><span id="l5.14"> {</span>
<a href="#l5.15"></a><span id="l5.15">   var listbox = document.getElementById(&quot;feedListbox&quot;);</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-  subscribeToFeed('feed:' + listbox.selectedItem.getAttribute(&quot;feedURL&quot;));</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+  subscribeToFeed(listbox.selectedItem.getAttribute(&quot;feedURL&quot;), event);</span>
<a href="#l5.18"></a><span id="l5.18"> }</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> function addRow(name, type, url)</span>
<a href="#l5.21"></a><span id="l5.21"> {</span>
<a href="#l5.22"></a><span id="l5.22">   var item = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l5.23"></a><span id="l5.23">   item.setAttribute(&quot;feed&quot;, &quot;true&quot;);</span>
<a href="#l5.24"></a><span id="l5.24">   item.setAttribute(&quot;name&quot;, name);</span>
<a href="#l5.25"></a><span id="l5.25">   item.setAttribute(&quot;type&quot;, type);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/browser/pageinfo/feeds.xml</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/browser/pageinfo/feeds.xml</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -54,14 +54,14 @@</span>
<a href="#l6.4"></a><span id="l6.4">           &lt;xul:textbox flex=&quot;1&quot; readonly=&quot;true&quot; xbl:inherits=&quot;value=name&quot;</span>
<a href="#l6.5"></a><span id="l6.5">                        class=&quot;feedTitle&quot;/&gt;</span>
<a href="#l6.6"></a><span id="l6.6">           &lt;xul:label xbl:inherits=&quot;value=type&quot;/&gt;</span>
<a href="#l6.7"></a><span id="l6.7">         &lt;/xul:hbox&gt;</span>
<a href="#l6.8"></a><span id="l6.8">         &lt;xul:textbox xbl:inherits=&quot;value=feedURL&quot; readonly=&quot;true&quot;/&gt;</span>
<a href="#l6.9"></a><span id="l6.9">         &lt;xul:hbox flex=&quot;1&quot; class=&quot;feed-subscribe&quot;&gt;</span>
<a href="#l6.10"></a><span id="l6.10">           &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l6.11"></a><span id="l6.11">           &lt;xul:button label=&quot;&amp;feedSubscribe;&quot; accesskey=&quot;&amp;feedSubscribe.accesskey;&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                      oncommand=&quot;onSubscribeFeed()&quot;/&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+                      oncommand=&quot;onSubscribeFeed(event)&quot;/&gt;</span>
<a href="#l6.14"></a><span id="l6.14">         &lt;/xul:hbox&gt;</span>
<a href="#l6.15"></a><span id="l6.15">       &lt;/xul:vbox&gt;</span>
<a href="#l6.16"></a><span id="l6.16">     &lt;/content&gt;</span>
<a href="#l6.17"></a><span id="l6.17">   &lt;/binding&gt;</span>
<a href="#l6.18"></a><span id="l6.18"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/build/Makefile.in</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/build/Makefile.in</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -77,22 +77,24 @@ ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l7.4"></a><span id="l7.4"> OS_LIBS += $(call EXPAND_LIBNAME,ole32 shell32)</span>
<a href="#l7.5"></a><span id="l7.5"> endif</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> LOCAL_INCLUDES += \</span>
<a href="#l7.8"></a><span id="l7.8"> 		-I$(topsrcdir)/suite/profile \</span>
<a href="#l7.9"></a><span id="l7.9"> 		-I$(topsrcdir)/suite/profile/migration/src \</span>
<a href="#l7.10"></a><span id="l7.10"> 		-I$(topsrcdir)/suite/browser/src \</span>
<a href="#l7.11"></a><span id="l7.11"> 		-I$(topsrcdir)/suite/shell/src \</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+		-I$(topsrcdir)/suite/feeds/src \</span>
<a href="#l7.13"></a><span id="l7.13"> 		$(NULL)</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15"> SHARED_LIBRARY_LIBS = \</span>
<a href="#l7.16"></a><span id="l7.16"> 	../profile/$(LIB_PREFIX)suiteprofile_s.$(LIB_SUFFIX) \</span>
<a href="#l7.17"></a><span id="l7.17"> 	../profile/migration/src/$(LIB_PREFIX)suitemigration_s.$(LIB_SUFFIX) \</span>
<a href="#l7.18"></a><span id="l7.18"> 	../browser/src/$(LIB_PREFIX)suitebrowser_s.$(LIB_SUFFIX) \</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+	../feeds/src/$(LIB_PREFIX)suitefeeds_s.$(LIB_SUFFIX) \</span>
<a href="#l7.20"></a><span id="l7.20"> 	$(NULL)</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l7.23"></a><span id="l7.23"> SHARED_LIBRARY_LIBS += ../shell/src/$(LIB_PREFIX)shellservice_s.$(LIB_SUFFIX)</span>
<a href="#l7.24"></a><span id="l7.24"> endif</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26"> EXTRA_DSO_LDOPTS += \</span>
<a href="#l7.27"></a><span id="l7.27"> 	$(LIBS_DIR) \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/build/nsSuiteModule.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/build/nsSuiteModule.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -41,16 +41,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> #include &quot;nsProfileMigrator.h&quot;</span>
<a href="#l8.5"></a><span id="l8.5"> #include &quot;nsSeamonkeyProfileMigrator.h&quot;</span>
<a href="#l8.6"></a><span id="l8.6"> #include &quot;nsThunderbirdProfileMigrator.h&quot;</span>
<a href="#l8.7"></a><span id="l8.7"> #include &quot;nsInternetSearchService.h&quot;</span>
<a href="#l8.8"></a><span id="l8.8"> #include &quot;nsLocalSearchService.h&quot;</span>
<a href="#l8.9"></a><span id="l8.9"> #include &quot;nsIGenericFactory.h&quot;</span>
<a href="#l8.10"></a><span id="l8.10"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l8.11"></a><span id="l8.11"> #include &quot;nsBookmarksService.h&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+#include &quot;nsFeedSniffer.h&quot;</span>
<a href="#l8.13"></a><span id="l8.13"> </span>
<a href="#l8.14"></a><span id="l8.14"> #if defined(XP_WIN)</span>
<a href="#l8.15"></a><span id="l8.15"> #include &quot;nsUrlWidget.h&quot;</span>
<a href="#l8.16"></a><span id="l8.16"> #include &quot;nsWindowsShellService.h&quot;</span>
<a href="#l8.17"></a><span id="l8.17"> #endif</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19"> /////////////////////////////////////////////////////////////////////////////</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21" class="difflineat">@@ -60,16 +61,17 @@ NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsWi</span>
<a href="#l8.22"></a><span id="l8.22"> #endif // Windows</span>
<a href="#l8.23"></a><span id="l8.23"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsSuiteDirectoryProvider)</span>
<a href="#l8.24"></a><span id="l8.24"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsProfileMigrator)</span>
<a href="#l8.25"></a><span id="l8.25"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsSeamonkeyProfileMigrator)</span>
<a href="#l8.26"></a><span id="l8.26"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsThunderbirdProfileMigrator)</span>
<a href="#l8.27"></a><span id="l8.27"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(LocalSearchDataSource, Init)</span>
<a href="#l8.28"></a><span id="l8.28"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(InternetSearchDataSource, Init)</span>
<a href="#l8.29"></a><span id="l8.29"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsBookmarksService, Init)</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+NS_GENERIC_FACTORY_CONSTRUCTOR(nsFeedSniffer)</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32"> /////////////////////////////////////////////////////////////////////////////</span>
<a href="#l8.33"></a><span id="l8.33"> </span>
<a href="#l8.34"></a><span id="l8.34"> static const nsModuleComponentInfo components[] = {</span>
<a href="#l8.35"></a><span id="l8.35"> #ifdef XP_WIN</span>
<a href="#l8.36"></a><span id="l8.36">   { NS_IURLWIDGET_CLASSNAME, NS_IURLWIDGET_CID,</span>
<a href="#l8.37"></a><span id="l8.37">     NS_IURLWIDGET_CONTRACTID, nsUrlWidgetConstructor },</span>
<a href="#l8.38"></a><span id="l8.38">   { &quot;SeaMonkey Windows Integration&quot;,</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineat">@@ -128,12 +130,18 @@ static const nsModuleComponentInfo compo</span>
<a href="#l8.40"></a><span id="l8.40">   { &quot;Bookmarks&quot;,</span>
<a href="#l8.41"></a><span id="l8.41">     NS_BOOKMARKS_SERVICE_CID,</span>
<a href="#l8.42"></a><span id="l8.42">     &quot;@mozilla.org/embeddor.implemented/bookmark-charset-resolver;1&quot;,</span>
<a href="#l8.43"></a><span id="l8.43">     nsBookmarksServiceConstructor },</span>
<a href="#l8.44"></a><span id="l8.44"> </span>
<a href="#l8.45"></a><span id="l8.45">   { &quot;Bookmarks&quot;,</span>
<a href="#l8.46"></a><span id="l8.46">     NS_BOOKMARKS_SERVICE_CID,</span>
<a href="#l8.47"></a><span id="l8.47">     NS_BOOKMARKS_DATASOURCE_CONTRACTID,</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-    nsBookmarksServiceConstructor }</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+    nsBookmarksServiceConstructor },</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+  { &quot;Feed Sniffer&quot;,</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+    NS_FEEDSNIFFER_CID,</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+    NS_FEEDSNIFFER_CONTRACTID,</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+    nsFeedSnifferConstructor,</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+    nsFeedSniffer::Register }</span>
<a href="#l8.56"></a><span id="l8.56"> };</span>
<a href="#l8.57"></a><span id="l8.57"> </span>
<a href="#l8.58"></a><span id="l8.58"> NS_IMPL_NSGETMODULE(SuiteModule, components)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/suite/common/feeds/subscribe.js</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,61 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+/* -*- Mode: Javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+ *</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+ *</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+ * License.</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+ *</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+ * The Original Code is the Feed Subscribe Handler.</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+ *</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+ *</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+ *</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+ *</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+var SubscribeHandler = {</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+  /**</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+   * The nsIFeedWriter object that produces the UI</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+   */</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+  _feedWriter: null,</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+  init: function SH_init() {</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+    this._feedWriter = new BrowserFeedWriter();</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+    this._feedWriter.init(window);</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+  },</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+  writeContent: function SH_writeContent() {</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+    this._feedWriter.writeContent();</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+  },</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+  uninit: function SH_uninit() {</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+    this._feedWriter.close();</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+  },</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+  subscribe: function FH_subscribe() {</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+    this._feedWriter.subscribe();</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+  }</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/suite/common/feeds/subscribe.xhtml</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,80 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+&lt;!DOCTYPE html [</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+  &lt;!ENTITY % htmlDTD</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+    PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+    &quot;DTD/xhtml1-strict.dtd&quot;&gt;</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+  %htmlDTD;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+  &lt;!ENTITY % globalDTD</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    SYSTEM &quot;chrome://global/locale/global.dtd&quot;&gt;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+  %globalDTD;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+  &lt;!ENTITY % feedDTD</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+    SYSTEM &quot;chrome://communicator/locale/feeds/subscribe.dtd&quot;&gt;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+  %feedDTD;</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+]&gt;</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+&lt;html id=&quot;feedHandler&quot;</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+      xmlns=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+      xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+  &lt;head&gt;</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+    &lt;title&gt;&amp;feedPage.title;&lt;/title&gt;</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+    &lt;link rel=&quot;stylesheet&quot;</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+          href=&quot;chrome://communicator/skin/feed-subscribe.css&quot;</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+          type=&quot;text/css&quot;</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+          media=&quot;all&quot;/&gt;</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+    &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+            src=&quot;chrome://communicator/content/feeds/subscribe.js&quot;/&gt;</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+  &lt;/head&gt;</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+  &lt;body onload=&quot;SubscribeHandler.writeContent();&quot; onunload=&quot;SubscribeHandler.uninit();&quot;&gt;</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+    &lt;div id=&quot;feedHeaderContainer&quot;&gt;</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+      &lt;div id=&quot;feedHeader&quot; dir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+        &lt;div id=&quot;feedIntroText&quot;&gt;</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+          &lt;p id=&quot;feedSubscriptionInfo1&quot; /&gt;</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+          &lt;p id=&quot;feedSubscriptionInfo2&quot; /&gt;</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+        &lt;/div&gt;</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+&lt;!-- XXXmano this can't have any whitespace in it.  Otherwise you would see</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+     how much XUL-in-XHTML sucks, see bug 348830 --&gt;</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+        &lt;div id=&quot;feedSubscribeLine&quot;</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+          &gt;&lt;xul:vbox</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+            &gt;&lt;xul:hbox align=&quot;center&quot;</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+              &gt;&lt;xul:description id=&quot;subscribeUsingDescription&quot;</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+              /&gt;&lt;xul:menulist id=&quot;handlersMenuList&quot; aria-labelledby=&quot;subscribeUsingDescription&quot;</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+                &gt;&lt;xul:menupopup menugenerated=&quot;true&quot; id=&quot;handlersMenuPopup&quot;</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+                  &gt;&lt;xul:menuitem id=&quot;messengerFeedsMenuItem&quot; label=&quot;&amp;feedMessenger;&quot; class=&quot;menuitem-iconic&quot; image=&quot;chrome://communicator/skin/icons/feedIcon16.png&quot; selected=&quot;true&quot;</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+                  /&gt;&lt;xul:menuseparator</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+                /&gt;&lt;/xul:menupopup</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+              &gt;&lt;/xul:menulist</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+            &gt;&lt;/xul:hbox</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+            &gt;&lt;xul:hbox</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+              &gt;&lt;xul:checkbox id=&quot;alwaysUse&quot; checked=&quot;false&quot;</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+            /&gt;&lt;/xul:hbox</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+            &gt;&lt;xul:hbox align=&quot;center&quot;</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+              &gt;&lt;xul:spacer flex=&quot;1&quot;</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+              /&gt;&lt;xul:button label=&quot;&amp;feedSubscribeNow;&quot; id=&quot;subscribeButton&quot;</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+            /&gt;&lt;/xul:hbox</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+          &gt;&lt;/xul:vbox</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+        &gt;&lt;/div</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+      &gt;&lt;/div&gt;</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+    &lt;/div&gt;</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+    &lt;script type=&quot;application/x-javascript&quot;&gt;</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+      SubscribeHandler.init();</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+    &lt;/script&gt;</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+    &lt;div id=&quot;feedBody&quot;&gt;</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+      &lt;div id=&quot;feedTitle&quot;&gt;</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+        &lt;a id=&quot;feedTitleLink&quot;&gt;</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+          &lt;img id=&quot;feedTitleImage&quot;/&gt;</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+        &lt;/a&gt;</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+        &lt;div id=&quot;feedTitleContainer&quot;&gt;</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+          &lt;h1 id=&quot;feedTitleText&quot;/&gt;</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+          &lt;h2 id=&quot;feedSubtitleText&quot;/&gt;</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+        &lt;/div&gt;</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+      &lt;/div&gt;</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+      &lt;div id=&quot;feedContent&quot;/&gt;</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+    &lt;/div&gt;</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+  &lt;/body&gt;</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/common/jar.mn</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/common/jar.mn</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -122,16 +122,18 @@ comm.jar:</span>
<a href="#l11.4"></a><span id="l11.4">    content/communicator/bookmarks/bookmarksTree.xml                 (bookmarks/bookmarksTree.xml)</span>
<a href="#l11.5"></a><span id="l11.5">    content/communicator/bookmarks/findBookmark.js                   (bookmarks/findBookmark.js)</span>
<a href="#l11.6"></a><span id="l11.6">    content/communicator/bookmarks/findBookmark.xul                  (bookmarks/findBookmark.xul)</span>
<a href="#l11.7"></a><span id="l11.7">    content/communicator/bookmarks/sortFolder.js                     (bookmarks/sortFolder.js)</span>
<a href="#l11.8"></a><span id="l11.8">    content/communicator/bookmarks/sortFolder.xul                    (bookmarks/sortFolder.xul)</span>
<a href="#l11.9"></a><span id="l11.9">    content/communicator/directory/directory.html                    (directory/directory.html)</span>
<a href="#l11.10"></a><span id="l11.10">    content/communicator/directory/directory.js                      (directory/directory.js)</span>
<a href="#l11.11"></a><span id="l11.11">    content/communicator/directory/directory.xul                     (directory/directory.xul)</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+   content/communicator/feeds/subscribe.xhtml                       (feeds/subscribe.xhtml)</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+   content/communicator/feeds/subscribe.js                          (feeds/subscribe.js)</span>
<a href="#l11.14"></a><span id="l11.14">    content/communicator/history/controller.js                       (history/controller.js)</span>
<a href="#l11.15"></a><span id="l11.15">    content/communicator/history/history.js                          (history/history.js)</span>
<a href="#l11.16"></a><span id="l11.16">    content/communicator/history/history.xul                         (history/history.xul)</span>
<a href="#l11.17"></a><span id="l11.17">    content/communicator/history/history-panel.xul                   (history/history-panel.xul)</span>
<a href="#l11.18"></a><span id="l11.18">    content/communicator/history/places.css                          (history/places.css)</span>
<a href="#l11.19"></a><span id="l11.19">    content/communicator/history/placesOverlay.xul                   (history/placesOverlay.xul)</span>
<a href="#l11.20"></a><span id="l11.20">    content/communicator/history/sidebarUtils.js                     (history/sidebarUtils.js)</span>
<a href="#l11.21"></a><span id="l11.21">    content/communicator/history/tree.xml                            (history/tree.xml)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/common/pref/pref-applications.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/common/pref/pref-applications.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -51,37 +51,34 @@ function Startup()</span>
<a href="#l12.4"></a><span id="l12.4"> //****************************************************************************//</span>
<a href="#l12.5"></a><span id="l12.5"> // Constants &amp; Enumeration Values</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7"> // constants for interfaces we need multiple times</span>
<a href="#l12.8"></a><span id="l12.8"> const nsIHandlerApp = Components.interfaces.nsIHandlerApp;</span>
<a href="#l12.9"></a><span id="l12.9"> const nsIHandlerInfo = Components.interfaces.nsIHandlerInfo;</span>
<a href="#l12.10"></a><span id="l12.10"> const nsILocalHandlerApp = Components.interfaces.nsILocalHandlerApp;</span>
<a href="#l12.11"></a><span id="l12.11"> const nsIWebHandlerApp = Components.interfaces.nsIWebHandlerApp;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-// XXX-SeaMonkey: remove comment once we implement nsIWebContentHandlerInfo</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-//const nsIWebContentHandlerInfo = Components.interfaces.nsIWebContentHandlerInfo;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+const nsIWebContentHandlerInfo = Components.interfaces.nsIWebContentHandlerInfo;</span>
<a href="#l12.15"></a><span id="l12.15"> const nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l12.16"></a><span id="l12.16"> const nsIMIMEInfo = Components.interfaces.nsIMIMEInfo;</span>
<a href="#l12.17"></a><span id="l12.17"> const nsIPropertyBag = Components.interfaces.nsIPropertyBag;</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19"> // global services</span>
<a href="#l12.20"></a><span id="l12.20"> var handlerSvc = Components.classes[&quot;@mozilla.org/uriloader/handler-service;1&quot;]</span>
<a href="#l12.21"></a><span id="l12.21">                            .getService(Components.interfaces.nsIHandlerService);</span>
<a href="#l12.22"></a><span id="l12.22"> var prefSvc = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l12.23"></a><span id="l12.23">                         .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l12.24"></a><span id="l12.24"> var categoryMgr = Components.classes[&quot;@mozilla.org/categorymanager;1&quot;]</span>
<a href="#l12.25"></a><span id="l12.25">                             .getService(Components.interfaces.nsICategoryManager);</span>
<a href="#l12.26"></a><span id="l12.26"> var mimeSvc = Components.classes[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l12.27"></a><span id="l12.27">                         .getService(Components.interfaces.nsIMIMEService);</span>
<a href="#l12.28"></a><span id="l12.28"> var ioSvc = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l12.29"></a><span id="l12.29">                       .getService(Components.interfaces.nsIIOService);</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-// XXX-SeaMonkey: remove null and comment once we implement nsIWebContentConverterService</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-// var converterSvc = Components.classes[&quot;@mozilla.org/embeddor.implemented/web-content-handler-registrar;1&quot;]</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-//                              .getService(Components.interfaces.nsIWebContentConverterService);</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-var converterSvc = null;</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+var converterSvc = Components.classes[&quot;@mozilla.org/embeddor.implemented/web-content-handler-registrar;1&quot;]</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+                             .getService(Components.interfaces.nsIWebContentConverterService);</span>
<a href="#l12.36"></a><span id="l12.36"> #ifdef HAVE_SHELL_SERVICE</span>
<a href="#l12.37"></a><span id="l12.37"> var shellSvc = Components.classes[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l12.38"></a><span id="l12.38">                          .getService(Components.interfaces.nsIShellService);</span>
<a href="#l12.39"></a><span id="l12.39"> #else</span>
<a href="#l12.40"></a><span id="l12.40"> var shellSvc = null;</span>
<a href="#l12.41"></a><span id="l12.41"> #endif</span>
<a href="#l12.42"></a><span id="l12.42"> </span>
<a href="#l12.43"></a><span id="l12.43"> const TYPE_MAYBE_FEED = &quot;application/vnd.mozilla.maybe.feed&quot;;</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineat">@@ -94,23 +91,23 @@ const PREF_DISABLED_PLUGIN_TYPES = &quot;plug</span>
<a href="#l12.45"></a><span id="l12.45"> const PREF_SHOW_PLUGINS_IN_LIST = &quot;browser.download.show_plugins_in_list&quot;;</span>
<a href="#l12.46"></a><span id="l12.46"> const PREF_HIDE_PLUGINS_WITHOUT_EXTENSIONS =</span>
<a href="#l12.47"></a><span id="l12.47">   &quot;browser.download.hide_plugins_without_extensions&quot;;</span>
<a href="#l12.48"></a><span id="l12.48"> </span>
<a href="#l12.49"></a><span id="l12.49"> /*</span>
<a href="#l12.50"></a><span id="l12.50">  * Preferences where we store handling information about the feed type.</span>
<a href="#l12.51"></a><span id="l12.51">  *</span>
<a href="#l12.52"></a><span id="l12.52">  * browser.feeds.handler</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">- * - &quot;bookmarks&quot;, &quot;reader&quot; (clarified further using the .default preference),</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+ * - &quot;messenger&quot;, &quot;reader&quot; (clarified further using the .default preference),</span>
<a href="#l12.55"></a><span id="l12.55">  *   or &quot;ask&quot; -- indicates the default handler being used to process feeds;</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineminus">- *   &quot;bookmarks&quot; is obsolete; to specify that the handler is bookmarks,</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">- *   set browser.feeds.handler.default to &quot;bookmarks&quot;;</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+ *   &quot;messenger&quot; is obsolete, use &quot;reader&quot; instead; to specify that the</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+ *    handler is messenger, set browser.feeds.handler.default to &quot;messenger&quot;;</span>
<a href="#l12.60"></a><span id="l12.60">  *</span>
<a href="#l12.61"></a><span id="l12.61">  * browser.feeds.handler.default</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineminus">- * - &quot;bookmarks&quot;, &quot;client&quot; or &quot;web&quot; -- indicates the chosen feed reader used</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+ * - &quot;messenger&quot;, &quot;client&quot; or &quot;web&quot; -- indicates the chosen feed reader used</span>
<a href="#l12.64"></a><span id="l12.64">  *   to display feeds, either transiently (i.e., when the &quot;use as default&quot;</span>
<a href="#l12.65"></a><span id="l12.65">  *   checkbox is unchecked, corresponds to when browser.feeds.handler==&quot;ask&quot;)</span>
<a href="#l12.66"></a><span id="l12.66">  *   or more permanently (i.e., the item displayed in the dropdown in Feeds</span>
<a href="#l12.67"></a><span id="l12.67">  *   preferences)</span>
<a href="#l12.68"></a><span id="l12.68">  *</span>
<a href="#l12.69"></a><span id="l12.69">  * browser.feeds.handler.webservice</span>
<a href="#l12.70"></a><span id="l12.70">  * - the URL of the currently selected web service used to read feeds</span>
<a href="#l12.71"></a><span id="l12.71">  *</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineat">@@ -539,43 +536,41 @@ FeedHandlerInfo.prototype = {</span>
<a href="#l12.73"></a><span id="l12.73">         return null;</span>
<a href="#l12.74"></a><span id="l12.74"> </span>
<a href="#l12.75"></a><span id="l12.75">       case &quot;web&quot;:</span>
<a href="#l12.76"></a><span id="l12.76">         var uri = document.getElementById(this._prefSelectedWeb).value;</span>
<a href="#l12.77"></a><span id="l12.77">         if (!uri)</span>
<a href="#l12.78"></a><span id="l12.78">           return null;</span>
<a href="#l12.79"></a><span id="l12.79">         return converterSvc.getWebContentHandlerByURI(this.type, uri);</span>
<a href="#l12.80"></a><span id="l12.80"> </span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-      case &quot;bookmarks&quot;:</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineplus">+      case &quot;messenger&quot;:</span>
<a href="#l12.83"></a><span id="l12.83">       default:</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-        // When the pref is set to bookmarks, we handle feeds internally,</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineplus">+        // When the pref is set to messenger, we handle feeds internally,</span>
<a href="#l12.86"></a><span id="l12.86">         // we don't forward them to a local or web handler app, so there is</span>
<a href="#l12.87"></a><span id="l12.87">         // no preferred handler.</span>
<a href="#l12.88"></a><span id="l12.88">         return null;</span>
<a href="#l12.89"></a><span id="l12.89">     }</span>
<a href="#l12.90"></a><span id="l12.90">   },</span>
<a href="#l12.91"></a><span id="l12.91"> </span>
<a href="#l12.92"></a><span id="l12.92">   set preferredApplicationHandler(aNewValue) {</span>
<a href="#l12.93"></a><span id="l12.93">     if (aNewValue instanceof nsILocalHandlerApp) {</span>
<a href="#l12.94"></a><span id="l12.94">       document.getElementById(this._prefSelectedApp).value = aNewValue.executable;</span>
<a href="#l12.95"></a><span id="l12.95">       document.getElementById(this._prefSelectedReader).value = &quot;client&quot;;</span>
<a href="#l12.96"></a><span id="l12.96">     }</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineminus">-    /* XXX-SeaMonkey: remove comment once we implement nsIWebContentHandlerInfo</span>
<a href="#l12.98"></a><span id="l12.98">     else if (aNewValue instanceof nsIWebContentHandlerInfo) {</span>
<a href="#l12.99"></a><span id="l12.99">       document.getElementById(this._prefSelectedWeb).value = aNewValue.uri;</span>
<a href="#l12.100"></a><span id="l12.100">       document.getElementById(this._prefSelectedReader).value = &quot;web&quot;;</span>
<a href="#l12.101"></a><span id="l12.101">       // Make the web handler be the new &quot;auto handler&quot; for feeds.</span>
<a href="#l12.102"></a><span id="l12.102">       // Note: we don't have to unregister the auto handler when the user picks</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-      // a non-web handler (local app, Live Bookmarks, etc.) because the service</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineplus">+      // a non-web handler (local app, RSS News &amp; Blogs, etc.) because the service</span>
<a href="#l12.105"></a><span id="l12.105">       // only uses the &quot;auto handler&quot; when the selected reader is a web handler.</span>
<a href="#l12.106"></a><span id="l12.106">       // We also don't have to unregister it when the user turns on &quot;always ask&quot;</span>
<a href="#l12.107"></a><span id="l12.107">       // (i.e. preview in browser), since that also overrides the auto handler.</span>
<a href="#l12.108"></a><span id="l12.108">       converterSvc.setAutoHandler(this.type, aNewValue);</span>
<a href="#l12.109"></a><span id="l12.109">     }</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineminus">-    */</span>
<a href="#l12.111"></a><span id="l12.111">   },</span>
<a href="#l12.112"></a><span id="l12.112"> </span>
<a href="#l12.113"></a><span id="l12.113">   _possibleApplicationHandlers: null,</span>
<a href="#l12.114"></a><span id="l12.114"> </span>
<a href="#l12.115"></a><span id="l12.115">   get possibleApplicationHandlers() {</span>
<a href="#l12.116"></a><span id="l12.116">     if (this._possibleApplicationHandlers)</span>
<a href="#l12.117"></a><span id="l12.117">       return this._possibleApplicationHandlers;</span>
<a href="#l12.118"></a><span id="l12.118"> </span>
<a href="#l12.119"></a><span id="l12.119" class="difflineat">@@ -697,19 +692,16 @@ FeedHandlerInfo.prototype = {</span>
<a href="#l12.120"></a><span id="l12.120">     // Should we instead return null?</span>
<a href="#l12.121"></a><span id="l12.121">     return &quot;&quot;;</span>
<a href="#l12.122"></a><span id="l12.122">   },</span>
<a href="#l12.123"></a><span id="l12.123"> </span>
<a href="#l12.124"></a><span id="l12.124">   // What to do with content of this type.</span>
<a href="#l12.125"></a><span id="l12.125">   get preferredAction() {</span>
<a href="#l12.126"></a><span id="l12.126">     switch (document.getElementById(this._prefSelectedAction).value) {</span>
<a href="#l12.127"></a><span id="l12.127"> </span>
<a href="#l12.128"></a><span id="l12.128" class="difflineminus">-      case &quot;bookmarks&quot;:</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineminus">-        return nsIHandlerInfo.handleInternally;</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineminus">-</span>
<a href="#l12.131"></a><span id="l12.131">       case &quot;reader&quot;: {</span>
<a href="#l12.132"></a><span id="l12.132">         let preferredApp = this.preferredApplicationHandler;</span>
<a href="#l12.133"></a><span id="l12.133">         let defaultApp = this._defaultApplicationHandler;</span>
<a href="#l12.134"></a><span id="l12.134"> </span>
<a href="#l12.135"></a><span id="l12.135">         // If we have a valid preferred app, return useSystemDefault if it's</span>
<a href="#l12.136"></a><span id="l12.136">         // the default app; otherwise return useHelperApp.</span>
<a href="#l12.137"></a><span id="l12.137">         if (gApplicationsPane.isValidHandlerApp(preferredApp)) {</span>
<a href="#l12.138"></a><span id="l12.138">           if (defaultApp &amp;&amp; defaultApp.equals(preferredApp))</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineat">@@ -724,26 +716,27 @@ FeedHandlerInfo.prototype = {</span>
<a href="#l12.140"></a><span id="l12.140">         // direct the user to live bookmarks.</span>
<a href="#l12.141"></a><span id="l12.141">         return nsIHandlerInfo.handleInternally;</span>
<a href="#l12.142"></a><span id="l12.142">       }</span>
<a href="#l12.143"></a><span id="l12.143"> </span>
<a href="#l12.144"></a><span id="l12.144">       // If the action is &quot;ask&quot;, then alwaysAskBeforeHandling will override</span>
<a href="#l12.145"></a><span id="l12.145">       // the action, so it doesn't matter what we say it is, it just has to be</span>
<a href="#l12.146"></a><span id="l12.146">       // something that doesn't cause the controller to hide the type.</span>
<a href="#l12.147"></a><span id="l12.147">       case &quot;ask&quot;:</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineplus">+      case &quot;messenger&quot;:</span>
<a href="#l12.149"></a><span id="l12.149">       default:</span>
<a href="#l12.150"></a><span id="l12.150">         return nsIHandlerInfo.handleInternally;</span>
<a href="#l12.151"></a><span id="l12.151">     }</span>
<a href="#l12.152"></a><span id="l12.152">   },</span>
<a href="#l12.153"></a><span id="l12.153"> </span>
<a href="#l12.154"></a><span id="l12.154">   set preferredAction(aNewValue) {</span>
<a href="#l12.155"></a><span id="l12.155">     switch (aNewValue) {</span>
<a href="#l12.156"></a><span id="l12.156"> </span>
<a href="#l12.157"></a><span id="l12.157">       case nsIHandlerInfo.handleInternally:</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineminus">-        document.getElementById(this._prefSelectedReader).value = &quot;bookmarks&quot;;</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineplus">+        document.getElementById(this._prefSelectedReader).value = &quot;messenger&quot;;</span>
<a href="#l12.160"></a><span id="l12.160">         break;</span>
<a href="#l12.161"></a><span id="l12.161"> </span>
<a href="#l12.162"></a><span id="l12.162">       case nsIHandlerInfo.useHelperApp:</span>
<a href="#l12.163"></a><span id="l12.163">         document.getElementById(this._prefSelectedAction).value = &quot;reader&quot;;</span>
<a href="#l12.164"></a><span id="l12.164">         // The controller has already set preferredApplicationHandler</span>
<a href="#l12.165"></a><span id="l12.165">         // to the new helper app.</span>
<a href="#l12.166"></a><span id="l12.166">         break;</span>
<a href="#l12.167"></a><span id="l12.167"> </span>
<a href="#l12.168"></a><span id="l12.168" class="difflineat">@@ -794,22 +787,20 @@ FeedHandlerInfo.prototype = {</span>
<a href="#l12.169"></a><span id="l12.169">         let pref = document.getElementById(PREF_FEED_SELECTED_APP);</span>
<a href="#l12.170"></a><span id="l12.170">         var preferredAppFile = pref.value;</span>
<a href="#l12.171"></a><span id="l12.171">         if (preferredAppFile) {</span>
<a href="#l12.172"></a><span id="l12.172">           let preferredApp = getLocalHandlerApp(preferredAppFile);</span>
<a href="#l12.173"></a><span id="l12.173">           if (app.equals(preferredApp))</span>
<a href="#l12.174"></a><span id="l12.174">             pref.reset();</span>
<a href="#l12.175"></a><span id="l12.175">         }</span>
<a href="#l12.176"></a><span id="l12.176">       }</span>
<a href="#l12.177"></a><span id="l12.177" class="difflineminus">-      /* XXX-SeaMonkey: remove comment once we implement nsIWebContentHandlerInfo</span>
<a href="#l12.178"></a><span id="l12.178">       else {</span>
<a href="#l12.179"></a><span id="l12.179">         app.QueryInterface(nsIWebContentHandlerInfo);</span>
<a href="#l12.180"></a><span id="l12.180">         converterSvc.removeContentHandler(app.contentType, app.uri);</span>
<a href="#l12.181"></a><span id="l12.181">       }</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineminus">-      */</span>
<a href="#l12.183"></a><span id="l12.183">     }</span>
<a href="#l12.184"></a><span id="l12.184">     this._possibleApplicationHandlers._removed = [];</span>
<a href="#l12.185"></a><span id="l12.185">   },</span>
<a href="#l12.186"></a><span id="l12.186"> </span>
<a href="#l12.187"></a><span id="l12.187"> </span>
<a href="#l12.188"></a><span id="l12.188">   //**************************************************************************//</span>
<a href="#l12.189"></a><span id="l12.189">   // Icons</span>
<a href="#l12.190"></a><span id="l12.190"> </span>
<a href="#l12.191"></a><span id="l12.191" class="difflineat">@@ -1255,19 +1246,19 @@ var gApplicationsPane = {</span>
<a href="#l12.192"></a><span id="l12.192">       case nsIHandlerInfo.useHelperApp:</span>
<a href="#l12.193"></a><span id="l12.193">         var preferredApp = aHandlerInfo.preferredApplicationHandler;</span>
<a href="#l12.194"></a><span id="l12.194">         var name = (preferredApp instanceof nsILocalHandlerApp) ?</span>
<a href="#l12.195"></a><span id="l12.195">                    getDisplayNameForFile(preferredApp.executable) :</span>
<a href="#l12.196"></a><span id="l12.196">                    preferredApp.name;</span>
<a href="#l12.197"></a><span id="l12.197">         return this._prefsBundle.getFormattedString(&quot;useApp&quot;, [name]);</span>
<a href="#l12.198"></a><span id="l12.198"> </span>
<a href="#l12.199"></a><span id="l12.199">       case nsIHandlerInfo.handleInternally:</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineminus">-        // For the feed type, handleInternally means live bookmarks.</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineminus">-        if (isFeedType(aHandlerInfo.type)) </span>
<a href="#l12.202"></a><span id="l12.202" class="difflineminus">-          return this._prefsBundle.getFormattedString(&quot;addLiveBookmarksInApp&quot;,</span>
<a href="#l12.203"></a><span id="l12.203" class="difflineplus">+        // For the feed type, handleInternally means News &amp; Blogs.</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineplus">+        if (isFeedType(aHandlerInfo.type))</span>
<a href="#l12.205"></a><span id="l12.205" class="difflineplus">+          return this._prefsBundle.getFormattedString(&quot;addNewsBlogsInApp&quot;,</span>
<a href="#l12.206"></a><span id="l12.206">                                                       [this._brandShortName]);</span>
<a href="#l12.207"></a><span id="l12.207"> </span>
<a href="#l12.208"></a><span id="l12.208">         // For other types, handleInternally looks like either useHelperApp</span>
<a href="#l12.209"></a><span id="l12.209">         // or useSystemDefault depending on whether or not there's a preferred</span>
<a href="#l12.210"></a><span id="l12.210">         // handler app.</span>
<a href="#l12.211"></a><span id="l12.211">         return (this.isValidHandlerApp(aHandlerInfo.preferredApplicationHandler)) ?</span>
<a href="#l12.212"></a><span id="l12.212">                aHandlerInfo.preferredApplicationHandler.name :</span>
<a href="#l12.213"></a><span id="l12.213">                aHandlerInfo.defaultDescription;</span>
<a href="#l12.214"></a><span id="l12.214" class="difflineat">@@ -1302,20 +1293,18 @@ var gApplicationsPane = {</span>
<a href="#l12.215"></a><span id="l12.215">       return false;</span>
<a href="#l12.216"></a><span id="l12.216"> </span>
<a href="#l12.217"></a><span id="l12.217">     if (aHandlerApp instanceof nsILocalHandlerApp)</span>
<a href="#l12.218"></a><span id="l12.218">       return this._isValidHandlerExecutable(aHandlerApp.executable);</span>
<a href="#l12.219"></a><span id="l12.219"> </span>
<a href="#l12.220"></a><span id="l12.220">     if (aHandlerApp instanceof nsIWebHandlerApp)</span>
<a href="#l12.221"></a><span id="l12.221">       return aHandlerApp.uriTemplate;</span>
<a href="#l12.222"></a><span id="l12.222"> </span>
<a href="#l12.223"></a><span id="l12.223" class="difflineminus">-    /* XXX-SeaMonkey: remove comment once we implement nsIWebContentHandlerInfo</span>
<a href="#l12.224"></a><span id="l12.224">     if (aHandlerApp instanceof nsIWebContentHandlerInfo)</span>
<a href="#l12.225"></a><span id="l12.225">       return aHandlerApp.uri;</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineminus">-    */</span>
<a href="#l12.227"></a><span id="l12.227"> </span>
<a href="#l12.228"></a><span id="l12.228">     return false;</span>
<a href="#l12.229"></a><span id="l12.229">   },</span>
<a href="#l12.230"></a><span id="l12.230"> </span>
<a href="#l12.231"></a><span id="l12.231">   _isValidHandlerExecutable: function(aExecutable) {</span>
<a href="#l12.232"></a><span id="l12.232">     return aExecutable &amp;&amp;</span>
<a href="#l12.233"></a><span id="l12.233">            aExecutable.exists() &amp;&amp;</span>
<a href="#l12.234"></a><span id="l12.234">            aExecutable.isExecutable() &amp;&amp;</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineat">@@ -1379,23 +1368,22 @@ var gApplicationsPane = {</span>
<a href="#l12.236"></a><span id="l12.236">       saveMenuItem.setAttribute(&quot;value&quot;, nsIHandlerInfo.saveToDisk);</span>
<a href="#l12.237"></a><span id="l12.237">       let label = this._prefsBundle.getString(&quot;saveFile&quot;);</span>
<a href="#l12.238"></a><span id="l12.238">       saveMenuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l12.239"></a><span id="l12.239">       saveMenuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l12.240"></a><span id="l12.240">       saveMenuItem.setAttribute(&quot;appHandlerIcon&quot;, &quot;save&quot;);</span>
<a href="#l12.241"></a><span id="l12.241">       menuPopup.appendChild(saveMenuItem);</span>
<a href="#l12.242"></a><span id="l12.242">     }</span>
<a href="#l12.243"></a><span id="l12.243"> </span>
<a href="#l12.244"></a><span id="l12.244" class="difflineminus">-    // If this is the feed type, add a Live Bookmarks item.</span>
<a href="#l12.245"></a><span id="l12.245" class="difflineminus">-    // XXX-SeaMonkey: remove the | &amp;&amp; false| once we support live bookmarks!</span>
<a href="#l12.246"></a><span id="l12.246" class="difflineminus">-    if (isFeedType(handlerInfo.type) &amp;&amp; false) {</span>
<a href="#l12.247"></a><span id="l12.247" class="difflineplus">+    // If this is the feed type, add a News &amp; Blogs item.</span>
<a href="#l12.248"></a><span id="l12.248" class="difflineplus">+    if (isFeedType(handlerInfo.type)) {</span>
<a href="#l12.249"></a><span id="l12.249">       let internalMenuItem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l12.250"></a><span id="l12.250">       internalMenuItem.setAttribute(&quot;class&quot;, &quot;handler-action&quot;);</span>
<a href="#l12.251"></a><span id="l12.251">       internalMenuItem.setAttribute(&quot;value&quot;, nsIHandlerInfo.handleInternally);</span>
<a href="#l12.252"></a><span id="l12.252" class="difflineminus">-      let label = this._prefsBundle.getFormattedString(&quot;addLiveBookmarksInApp&quot;,</span>
<a href="#l12.253"></a><span id="l12.253" class="difflineplus">+      let label = this._prefsBundle.getFormattedString(&quot;addNewsBlogsInApp&quot;,</span>
<a href="#l12.254"></a><span id="l12.254">                                                        [this._brandShortName]);</span>
<a href="#l12.255"></a><span id="l12.255">       internalMenuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l12.256"></a><span id="l12.256">       internalMenuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l12.257"></a><span id="l12.257">       internalMenuItem.setAttribute(&quot;appHandlerIcon&quot;, &quot;feed&quot;);</span>
<a href="#l12.258"></a><span id="l12.258">       menuPopup.appendChild(internalMenuItem);</span>
<a href="#l12.259"></a><span id="l12.259">     }</span>
<a href="#l12.260"></a><span id="l12.260"> </span>
<a href="#l12.261"></a><span id="l12.261">     // Add a separator to distinguish these items from the helper app items</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineat">@@ -1780,20 +1768,18 @@ var gApplicationsPane = {</span>
<a href="#l12.263"></a><span id="l12.263"> </span>
<a href="#l12.264"></a><span id="l12.264">   _getIconURLForHandlerApp: function(aHandlerApp) {</span>
<a href="#l12.265"></a><span id="l12.265">     if (aHandlerApp instanceof nsILocalHandlerApp)</span>
<a href="#l12.266"></a><span id="l12.266">       return this._getIconURLForFile(aHandlerApp.executable);</span>
<a href="#l12.267"></a><span id="l12.267"> </span>
<a href="#l12.268"></a><span id="l12.268">     if (aHandlerApp instanceof nsIWebHandlerApp)</span>
<a href="#l12.269"></a><span id="l12.269">       return this._getIconURLForWebApp(aHandlerApp.uriTemplate);</span>
<a href="#l12.270"></a><span id="l12.270"> </span>
<a href="#l12.271"></a><span id="l12.271" class="difflineminus">-    /* XXX-SeaMonkey: remove comment once we implement nsIWebContentHandlerInfo</span>
<a href="#l12.272"></a><span id="l12.272">     if (aHandlerApp instanceof nsIWebContentHandlerInfo)</span>
<a href="#l12.273"></a><span id="l12.273">       return this._getIconURLForWebApp(aHandlerApp.uri)</span>
<a href="#l12.274"></a><span id="l12.274" class="difflineminus">-    */</span>
<a href="#l12.275"></a><span id="l12.275"> </span>
<a href="#l12.276"></a><span id="l12.276">     // We know nothing about other kinds of handler apps.</span>
<a href="#l12.277"></a><span id="l12.277">     return &quot;&quot;;</span>
<a href="#l12.278"></a><span id="l12.278">   },</span>
<a href="#l12.279"></a><span id="l12.279"> </span>
<a href="#l12.280"></a><span id="l12.280">   _getIconURLForFile: function(aFile) {</span>
<a href="#l12.281"></a><span id="l12.281">     var fph = ioSvc.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l12.282"></a><span id="l12.282">                    .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/suite/common/utilityOverlay.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/suite/common/utilityOverlay.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1240,16 +1240,36 @@ function openUILinkArrayIn(urlArray, whe</span>
<a href="#l13.4"></a><span id="l13.4">   }</span>
<a href="#l13.5"></a><span id="l13.5">   for (var i = 1; i &lt; urlArray.length; i++)</span>
<a href="#l13.6"></a><span id="l13.6">     browser.addTab(urlArray[i], null, null, false, flags);</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8">   w.content.focus();</span>
<a href="#l13.9"></a><span id="l13.9">   return w;</span>
<a href="#l13.10"></a><span id="l13.10"> }</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-//XXXCallek only used until we implement Feed Preview</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-// uri is a string!</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-function subscribeToFeed(uri)</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-{</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-  Components.classes[&quot;@mozilla.org/newsblog-feed-downloader;1&quot;]</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-            .getService(Components.interfaces.nsINewsBlogFeedDownloader)</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-            .subscribeToFeed(uri, null, null);</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+function subscribeToFeed(href, event) {</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+  // Just load the feed in the content area to either subscribe or show the</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+  // preview UI</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+  var w = getTopWin();</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+  var charset;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+  if (w) {</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+    var browser = w.getBrowser();</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+    charset = browser.characterSet;</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+  }</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+  else</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+    // When calling this function without any open navigator window</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+    charset = document.characterSet;</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+  var feedURI = makeURI(href, charset);</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+  // Use the feed scheme so X-Moz-Is-Feed will be set</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+  // The value doesn't matter</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+  if (/^https?/.test(feedURI.scheme))</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+    href = &quot;feed:&quot; + href;</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+  openUILink(href, event, false, true);</span>
<a href="#l13.38"></a><span id="l13.38"> }</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+function subscribeToFeedMiddleClick(href, event) {</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+  if (event.button == 1) {</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+    this.subscribeToFeed(href, event);</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+    // unlike for command events, we have to close the menus manually</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+    closeMenus(event.target);</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+  }</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">new file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- /dev/null</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ b/suite/feeds/public/Makefile.in</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -0,0 +1,54 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineplus">+#</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineplus">+#</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+#</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+# License.</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+#</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+# The Original Code is mozilla.org code.</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+#</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+# The Initial Developer of the Original Code is</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+# Netscape Communications Corporation.</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 2001</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+#</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+# Contributor(s):</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+#</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+#</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+DEPTH		= ../../..</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+topsrcdir	= @top_srcdir@</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+srcdir		= @srcdir@</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+VPATH		= @srcdir@</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+include $(DEPTH)/config/autoconf.mk</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+MODULE		= suitefeeds</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+XPIDL_MODULE	= suitefeeds</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+XPIDLSRCS = \</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+	nsIFeedResultService.idl \</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+	nsIFeedWriter.idl \</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+	nsIWebContentConverterRegistrar.idl \</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+	$(NULL)</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">new file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- /dev/null</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ b/suite/feeds/public/nsIFeedResultService.idl</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -0,0 +1,100 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineplus">+ *</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+ *</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+ * License.</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+ *</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+ * The Original Code is the Feed Result Service.</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+ *</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+ *</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+ *   Robert Sayre &lt;sayrer@gmail.com&gt;</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineplus">+ *   Will Guaraldi &lt;will.guaraldi@pculture.org&gt;</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+ *</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+ *</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+#include &quot;nsISupports.idl&quot;</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+interface nsIURI;</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+interface nsIRequest;</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineplus">+interface nsIFeedResult;</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineplus">+</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineplus">+/**</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineplus">+ * nsIFeedResultService provides a globally-accessible object for retrieving</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineplus">+ * the results of feed processing.</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineplus">+ */</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineplus">+[scriptable, uuid(950a829e-c20e-4dc3-b447-f8b753ae54da)]</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineplus">+interface nsIFeedResultService : nsISupports</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineplus">+{</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineplus">+  /**</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+   * When set to true, forces the preview page to be displayed, regardless</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+   * of the user's preferences.</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineplus">+   */</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineplus">+  attribute boolean forcePreviewPage;</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineplus">+</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineplus">+  /**</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineplus">+   * Adds a URI to the user's specified external feed handler, or live</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineplus">+   * bookmarks.</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineplus">+   * @param   uri</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineplus">+   *          The uri of the feed to add.</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineplus">+   * @param   title</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineplus">+   *          The title of the feed to add.</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineplus">+   * @param   subtitle</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineplus">+   *          The subtitle of the feed to add.</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineplus">+   * @param   feedType</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineplus">+   *          The nsIFeed type of the feed.  See nsIFeed.idl</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineplus">+   */</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineplus">+  void addToClientReader(in AUTF8String uri,</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineplus">+                         in AString title,</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineplus">+                         in AString subtitle,</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineplus">+                         in unsigned long feedType);</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+  /**</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineplus">+   * Registers a Feed Result object with a globally accessible service</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+   * so that it can be accessed by a singleton method outside the usual</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineplus">+   * flow of control in document loading.</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineplus">+   *</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineplus">+   * @param   feedResult</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineplus">+   *          An object implementing nsIFeedResult representing the feed.</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineplus">+   */</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineplus">+  void addFeedResult(in nsIFeedResult feedResult);</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineplus">+</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineplus">+  /**</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+   * Gets a Feed Handler object registered using addFeedResult.</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+   *</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineplus">+   * @param   uri</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineplus">+   *          The URI of the feed a handler is being requested for</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineplus">+   */</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineplus">+  nsIFeedResult getFeedResult(in nsIURI uri);</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineplus">+</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineplus">+  /**</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineplus">+   * Unregisters a Feed Handler object registered using addFeedResult.</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineplus">+   * @param   uri</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineplus">+   *          The feed URI the handler was registered under. This must be</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineplus">+   *          the same *instance* the feed was registered under.</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineplus">+   */</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineplus">+  void removeFeedResult(in nsIURI uri);</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">new file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- /dev/null</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ b/suite/feeds/public/nsIFeedWriter.idl</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -0,0 +1,68 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineplus">+ *</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+ *</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+ * License.</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+ *</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+ * The Original Code is the Feed Writer.</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+ *</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+ *</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineplus">+ *</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+ *</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineplus">+</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineplus">+#include &quot;nsISupports.idl&quot;</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineplus">+</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+interface nsIDOMWindow;</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineplus">+/**</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineplus">+ * Instances of this component write UI into the display page. This component</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineplus">+ * is trusted so can access preferences etc, but page content isn't and so</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineplus">+ * cannot.</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+ */</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+[scriptable, uuid(67003393-018c-4e96-af10-c6c51a049fad)]</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+interface nsIFeedWriter : nsISupports</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+{</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+  /**</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineplus">+   * Initializes the feed writer and loads the feed subscription UI.</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineplus">+   * @param  aWindow</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+   *         The DOMWindow of the preview page.</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+   *         window.location.href == the URI of the feed.</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineplus">+   */</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineplus">+  void init(in nsIDOMWindow aWindow);</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineplus">+</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineplus">+  /**</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineplus">+   * Writes the feed content, assumes that the feed writer is initialized.</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineplus">+   */</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineplus">+  void writeContent();</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineplus">+  /**</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+   * Uninitialize the feed writer.</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineplus">+   */</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineplus">+  void close();</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/suite/feeds/public/nsIWebContentConverterRegistrar.idl</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,147 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+ *</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+ *</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+ * License.</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+ *</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+ * The Original Code is the Web Content Converter Registrar.</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+ *</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+ *</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+ *</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+ *</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+#include &quot;nsIMIMEInfo.idl&quot;</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+#include &quot;nsIWebContentHandlerRegistrar.idl&quot;</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+interface nsIRequest;</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+[scriptable, uuid(eb361098-5158-4b21-8f98-50b445f1f0b2)]</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+interface nsIWebContentHandlerInfo : nsIHandlerApp</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+{</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineplus">+  /**</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+   * The content type handled by the handler</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+   */</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+  readonly attribute AString contentType;</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+  /**</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+   * The uri of the handler, with an embedded %s where the URI of the loaded</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+   * document will be encoded.</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+   */</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+  readonly attribute AString uri;</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+  /**</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+   * Gets the service URL Spec, with the loading document URI encoded in it.</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+   * @param   uri</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineplus">+   *          The URI of the document being loaded</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+   * @returns The URI of the service with the loading document URI encoded in</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+   *          it.</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineplus">+   */</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+  AString getHandlerURI(in AString uri);</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+};</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineplus">+[scriptable, uuid(de7cc06e-e778-45cb-b7db-7a114e1e75b1)]</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineplus">+interface nsIWebContentConverterService : nsIWebContentHandlerRegistrar</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineplus">+{</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineplus">+  /**</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineplus">+   * Specifies the handler to be used to automatically handle all links of a</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineplus">+   * certain content type from now on.</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineplus">+   * @param   contentType</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineplus">+   *          The content type to automatically load with the specified handler</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineplus">+   * @param   handler</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineplus">+   *          A web service handler. If this is null, no automatic action is</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineplus">+   *          performed and the user must choose.</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineplus">+   * @throws  NS_ERROR_NOT_AVAILABLE if the service refered to by |handler| is</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+   *          not already registered.</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+   */</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+  void setAutoHandler(in AString contentType, in nsIWebContentHandlerInfo handler);</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+  /**</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+   * Gets the auto handler specified for a particular content type</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineplus">+   * @param   contentType</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineplus">+   *          The content type to look up an auto handler for.</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineplus">+   * @returns The web service handler that will automatically handle all</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineplus">+   *          documents of the specified type. null if there is no automatic</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineplus">+   *          handler. (Handlers may be registered, just none of them specified</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineplus">+   *          as &quot;automatic&quot;).</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineplus">+   */</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineplus">+  nsIWebContentHandlerInfo getAutoHandler(in AString contentType);</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineplus">+</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineplus">+  /**</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineplus">+   * Gets a web handler for the specified service URI</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineplus">+   * @param   contentType</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineplus">+   *          The content type of the service being located</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineplus">+   * @param   uri</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineplus">+   *          The service URI of the handler to locate.</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineplus">+   * @returns A web service handler that uses the specified uri.</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineplus">+   */</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+  nsIWebContentHandlerInfo getWebContentHandlerByURI(in AString contentType,</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineplus">+                                                     in AString uri);</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineplus">+</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineplus">+  /**</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineplus">+   * Loads the preferred handler when content of a registered type is about</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineplus">+   * to be loaded.</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineplus">+   * @param   request</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineplus">+   *          The nsIRequest for the load of the content</span>
<a href="#l17.114"></a><span id="l17.114" class="difflineplus">+   */</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineplus">+  void loadPreferredHandler(in nsIRequest request);</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineplus">+</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineplus">+  /**</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineplus">+   * Removes a registered protocol handler</span>
<a href="#l17.119"></a><span id="l17.119" class="difflineplus">+   * @param   protocol</span>
<a href="#l17.120"></a><span id="l17.120" class="difflineplus">+   *          The protocol scheme to remove a service handler for</span>
<a href="#l17.121"></a><span id="l17.121" class="difflineplus">+   * @param   uri</span>
<a href="#l17.122"></a><span id="l17.122" class="difflineplus">+   *          The uri of the service handler to remove</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineplus">+   */</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineplus">+  void removeProtocolHandler(in AString protocol, in AString uri);</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineplus">+</span>
<a href="#l17.126"></a><span id="l17.126" class="difflineplus">+  /**</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineplus">+   * Removes a registered content handler</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineplus">+   * @param   contentType</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineplus">+   *          The content type to remove a service handler for</span>
<a href="#l17.130"></a><span id="l17.130" class="difflineplus">+   * @param   uri</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineplus">+   *          The uri of the service handler to remove</span>
<a href="#l17.132"></a><span id="l17.132" class="difflineplus">+   */</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineplus">+  void removeContentHandler(in AString contentType, in AString uri);</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineplus">+</span>
<a href="#l17.135"></a><span id="l17.135" class="difflineplus">+  /**</span>
<a href="#l17.136"></a><span id="l17.136" class="difflineplus">+   * Gets the list of content handlers for a particular type.</span>
<a href="#l17.137"></a><span id="l17.137" class="difflineplus">+   * @param   contentType</span>
<a href="#l17.138"></a><span id="l17.138" class="difflineplus">+   *          The content type to get handlers for</span>
<a href="#l17.139"></a><span id="l17.139" class="difflineplus">+   * @returns An array of nsIWebContentHandlerInfo objects</span>
<a href="#l17.140"></a><span id="l17.140" class="difflineplus">+   */</span>
<a href="#l17.141"></a><span id="l17.141" class="difflineplus">+  void getContentHandlers(in AString contentType, out unsigned long count,</span>
<a href="#l17.142"></a><span id="l17.142" class="difflineplus">+                          [retval,array,size_is(count)] out nsIWebContentHandlerInfo handlers);</span>
<a href="#l17.143"></a><span id="l17.143" class="difflineplus">+</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineplus">+  /**</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineplus">+   * Resets the list of available content handlers to the default set from</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineplus">+   * the distribution.</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineplus">+   * @param   contentType</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineplus">+   *          The content type to reset handlers for</span>
<a href="#l17.149"></a><span id="l17.149" class="difflineplus">+   */</span>
<a href="#l17.150"></a><span id="l17.150" class="difflineplus">+  void resetHandlersForType(in AString contentType);</span>
<a href="#l17.151"></a><span id="l17.151" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">new file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- /dev/null</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ b/suite/feeds/src/FeedConverter.js</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -0,0 +1,640 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineplus">+/* -*- Mode: Javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineplus">+ *</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+ *</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+ * License.</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+ *</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+ * The Original Code is the Feed Stream Converter.</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+ *</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineplus">+ *</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineplus">+ *   Jeff Walden &lt;jwalden+code@mit.edu&gt;</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+ *   Will Guaraldi &lt;will.guaraldi@pculture.org&gt;</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineplus">+ *   Caio Tiago Oliveira &lt;asrail@gmail.com&gt;</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+ *</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineplus">+ *</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineplus">+</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/debug.js&quot;);</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineplus">+</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineplus">+const TYPE_MAYBE_FEED = &quot;application/vnd.mozilla.maybe.feed&quot;;</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineplus">+const TYPE_MAYBE_VIDEO_FEED = &quot;application/vnd.mozilla.maybe.video.feed&quot;;</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineplus">+const TYPE_MAYBE_AUDIO_FEED = &quot;application/vnd.mozilla.maybe.audio.feed&quot;;</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+const TYPE_ANY = &quot;*/*&quot;;</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineplus">+</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineplus">+const FEEDHANDLER_URI = &quot;about:feeds&quot;;</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineplus">+</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineplus">+const PREF_SELECTED_APP = &quot;browser.feeds.handlers.application&quot;;</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineplus">+const PREF_SELECTED_WEB = &quot;browser.feeds.handlers.webservice&quot;;</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineplus">+const PREF_SELECTED_ACTION = &quot;browser.feeds.handler&quot;;</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineplus">+const PREF_SELECTED_READER = &quot;browser.feeds.handler.default&quot;;</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineplus">+</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineplus">+const PREF_VIDEO_SELECTED_APP = &quot;browser.videoFeeds.handlers.application&quot;;</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineplus">+const PREF_VIDEO_SELECTED_WEB = &quot;browser.videoFeeds.handlers.webservice&quot;;</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineplus">+const PREF_VIDEO_SELECTED_ACTION = &quot;browser.videoFeeds.handler&quot;;</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineplus">+const PREF_VIDEO_SELECTED_READER = &quot;browser.videoFeeds.handler.default&quot;;</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineplus">+</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineplus">+const PREF_AUDIO_SELECTED_APP = &quot;browser.audioFeeds.handlers.application&quot;;</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineplus">+const PREF_AUDIO_SELECTED_WEB = &quot;browser.audioFeeds.handlers.webservice&quot;;</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineplus">+const PREF_AUDIO_SELECTED_ACTION = &quot;browser.audioFeeds.handler&quot;;</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineplus">+const PREF_AUDIO_SELECTED_READER = &quot;browser.audioFeeds.handler.default&quot;;</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineplus">+</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineplus">+function getPrefAppForType(t) {</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineplus">+  switch (t) {</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineplus">+      return PREF_VIDEO_SELECTED_APP;</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineplus">+</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineplus">+      return PREF_AUDIO_SELECTED_APP;</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineplus">+</span>
<a href="#l18.78"></a><span id="l18.78" class="difflineplus">+    default:</span>
<a href="#l18.79"></a><span id="l18.79" class="difflineplus">+      return PREF_SELECTED_APP;</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineplus">+  }</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineplus">+}</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineplus">+</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineplus">+function getPrefWebForType(t) {</span>
<a href="#l18.84"></a><span id="l18.84" class="difflineplus">+  switch (t) {</span>
<a href="#l18.85"></a><span id="l18.85" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l18.86"></a><span id="l18.86" class="difflineplus">+      return PREF_VIDEO_SELECTED_WEB;</span>
<a href="#l18.87"></a><span id="l18.87" class="difflineplus">+</span>
<a href="#l18.88"></a><span id="l18.88" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l18.89"></a><span id="l18.89" class="difflineplus">+      return PREF_AUDIO_SELECTED_WEB;</span>
<a href="#l18.90"></a><span id="l18.90" class="difflineplus">+</span>
<a href="#l18.91"></a><span id="l18.91" class="difflineplus">+    default:</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineplus">+      return PREF_SELECTED_WEB;</span>
<a href="#l18.93"></a><span id="l18.93" class="difflineplus">+  }</span>
<a href="#l18.94"></a><span id="l18.94" class="difflineplus">+}</span>
<a href="#l18.95"></a><span id="l18.95" class="difflineplus">+</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineplus">+function getPrefActionForType(t) {</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineplus">+  switch (t) {</span>
<a href="#l18.98"></a><span id="l18.98" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineplus">+      return PREF_VIDEO_SELECTED_ACTION;</span>
<a href="#l18.100"></a><span id="l18.100" class="difflineplus">+</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineplus">+      return PREF_AUDIO_SELECTED_ACTION;</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineplus">+</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineplus">+    default:</span>
<a href="#l18.105"></a><span id="l18.105" class="difflineplus">+      return PREF_SELECTED_ACTION;</span>
<a href="#l18.106"></a><span id="l18.106" class="difflineplus">+  }</span>
<a href="#l18.107"></a><span id="l18.107" class="difflineplus">+}</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineplus">+</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineplus">+function getPrefReaderForType(t) {</span>
<a href="#l18.110"></a><span id="l18.110" class="difflineplus">+  switch (t) {</span>
<a href="#l18.111"></a><span id="l18.111" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l18.112"></a><span id="l18.112" class="difflineplus">+      return PREF_VIDEO_SELECTED_READER;</span>
<a href="#l18.113"></a><span id="l18.113" class="difflineplus">+</span>
<a href="#l18.114"></a><span id="l18.114" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l18.115"></a><span id="l18.115" class="difflineplus">+      return PREF_AUDIO_SELECTED_READER;</span>
<a href="#l18.116"></a><span id="l18.116" class="difflineplus">+</span>
<a href="#l18.117"></a><span id="l18.117" class="difflineplus">+    default:</span>
<a href="#l18.118"></a><span id="l18.118" class="difflineplus">+      return PREF_SELECTED_READER;</span>
<a href="#l18.119"></a><span id="l18.119" class="difflineplus">+  }</span>
<a href="#l18.120"></a><span id="l18.120" class="difflineplus">+}</span>
<a href="#l18.121"></a><span id="l18.121" class="difflineplus">+</span>
<a href="#l18.122"></a><span id="l18.122" class="difflineplus">+function LOG(str) {</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineplus">+  var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineplus">+                        .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineplus">+</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineplus">+  try {</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineplus">+    if (prefs.getBoolPref(&quot;feeds.log&quot;))</span>
<a href="#l18.128"></a><span id="l18.128" class="difflineplus">+      dump(&quot;*** Feeds: &quot; + str + &quot;\n&quot;);</span>
<a href="#l18.129"></a><span id="l18.129" class="difflineplus">+  }</span>
<a href="#l18.130"></a><span id="l18.130" class="difflineplus">+  catch (ex) {</span>
<a href="#l18.131"></a><span id="l18.131" class="difflineplus">+  }</span>
<a href="#l18.132"></a><span id="l18.132" class="difflineplus">+}</span>
<a href="#l18.133"></a><span id="l18.133" class="difflineplus">+</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineplus">+function safeGetCharPref(pref, defaultValue) {</span>
<a href="#l18.135"></a><span id="l18.135" class="difflineplus">+  var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l18.136"></a><span id="l18.136" class="difflineplus">+                        .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineplus">+  try {</span>
<a href="#l18.138"></a><span id="l18.138" class="difflineplus">+    return prefs.getCharPref(pref);</span>
<a href="#l18.139"></a><span id="l18.139" class="difflineplus">+  }</span>
<a href="#l18.140"></a><span id="l18.140" class="difflineplus">+  catch (e) {</span>
<a href="#l18.141"></a><span id="l18.141" class="difflineplus">+  }</span>
<a href="#l18.142"></a><span id="l18.142" class="difflineplus">+  return defaultValue;</span>
<a href="#l18.143"></a><span id="l18.143" class="difflineplus">+}</span>
<a href="#l18.144"></a><span id="l18.144" class="difflineplus">+</span>
<a href="#l18.145"></a><span id="l18.145" class="difflineplus">+function FeedConverter() {</span>
<a href="#l18.146"></a><span id="l18.146" class="difflineplus">+  this._ioSvc = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l18.147"></a><span id="l18.147" class="difflineplus">+                          .getService(Components.interfaces.nsIIOService);</span>
<a href="#l18.148"></a><span id="l18.148" class="difflineplus">+}</span>
<a href="#l18.149"></a><span id="l18.149" class="difflineplus">+</span>
<a href="#l18.150"></a><span id="l18.150" class="difflineplus">+FeedConverter.prototype = {</span>
<a href="#l18.151"></a><span id="l18.151" class="difflineplus">+  /**</span>
<a href="#l18.152"></a><span id="l18.152" class="difflineplus">+   * This is the downloaded text data for the feed.</span>
<a href="#l18.153"></a><span id="l18.153" class="difflineplus">+   */</span>
<a href="#l18.154"></a><span id="l18.154" class="difflineplus">+  _data: null,</span>
<a href="#l18.155"></a><span id="l18.155" class="difflineplus">+</span>
<a href="#l18.156"></a><span id="l18.156" class="difflineplus">+  /**</span>
<a href="#l18.157"></a><span id="l18.157" class="difflineplus">+   * This is the object listening to the conversion, which is ultimately the</span>
<a href="#l18.158"></a><span id="l18.158" class="difflineplus">+   * docshell for the load.</span>
<a href="#l18.159"></a><span id="l18.159" class="difflineplus">+   */</span>
<a href="#l18.160"></a><span id="l18.160" class="difflineplus">+  _listener: null,</span>
<a href="#l18.161"></a><span id="l18.161" class="difflineplus">+</span>
<a href="#l18.162"></a><span id="l18.162" class="difflineplus">+  /**</span>
<a href="#l18.163"></a><span id="l18.163" class="difflineplus">+   * Records if the feed was sniffed</span>
<a href="#l18.164"></a><span id="l18.164" class="difflineplus">+   */</span>
<a href="#l18.165"></a><span id="l18.165" class="difflineplus">+  _sniffed: false,</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineplus">+</span>
<a href="#l18.167"></a><span id="l18.167" class="difflineplus">+  /**</span>
<a href="#l18.168"></a><span id="l18.168" class="difflineplus">+   * See nsISupports.idl</span>
<a href="#l18.169"></a><span id="l18.169" class="difflineplus">+   */</span>
<a href="#l18.170"></a><span id="l18.170" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI(</span>
<a href="#l18.171"></a><span id="l18.171" class="difflineplus">+    [Components.interfaces.nsIFeedResultListener,</span>
<a href="#l18.172"></a><span id="l18.172" class="difflineplus">+     Components.interfaces.nsIStreamConverter,</span>
<a href="#l18.173"></a><span id="l18.173" class="difflineplus">+     Components.interfaces.nsIStreamListener,</span>
<a href="#l18.174"></a><span id="l18.174" class="difflineplus">+     Components.interfaces.nsIRequestObserver,</span>
<a href="#l18.175"></a><span id="l18.175" class="difflineplus">+     Components.interfaces.nsISupports]),</span>
<a href="#l18.176"></a><span id="l18.176" class="difflineplus">+  classDescription: &quot;Feed Stream Converter&quot;,</span>
<a href="#l18.177"></a><span id="l18.177" class="difflineplus">+  classID: Components.ID(&quot;{88592F45-3866-4c8e-9D8A-AB58B290FCF7}&quot;),</span>
<a href="#l18.178"></a><span id="l18.178" class="difflineplus">+  implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l18.179"></a><span id="l18.179" class="difflineplus">+</span>
<a href="#l18.180"></a><span id="l18.180" class="difflineplus">+  /**</span>
<a href="#l18.181"></a><span id="l18.181" class="difflineplus">+   * See nsIStreamConverter.idl</span>
<a href="#l18.182"></a><span id="l18.182" class="difflineplus">+   */</span>
<a href="#l18.183"></a><span id="l18.183" class="difflineplus">+  convert: function convert(sourceStream, sourceType, destinationType,</span>
<a href="#l18.184"></a><span id="l18.184" class="difflineplus">+                               context) {</span>
<a href="#l18.185"></a><span id="l18.185" class="difflineplus">+    throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l18.186"></a><span id="l18.186" class="difflineplus">+  },</span>
<a href="#l18.187"></a><span id="l18.187" class="difflineplus">+</span>
<a href="#l18.188"></a><span id="l18.188" class="difflineplus">+  /**</span>
<a href="#l18.189"></a><span id="l18.189" class="difflineplus">+   * See nsIStreamConverter.idl</span>
<a href="#l18.190"></a><span id="l18.190" class="difflineplus">+   */</span>
<a href="#l18.191"></a><span id="l18.191" class="difflineplus">+  asyncConvertData: function asyncConvertData(sourceType, destinationType,</span>
<a href="#l18.192"></a><span id="l18.192" class="difflineplus">+                                               listener, context) {</span>
<a href="#l18.193"></a><span id="l18.193" class="difflineplus">+    this._listener = listener;</span>
<a href="#l18.194"></a><span id="l18.194" class="difflineplus">+  },</span>
<a href="#l18.195"></a><span id="l18.195" class="difflineplus">+</span>
<a href="#l18.196"></a><span id="l18.196" class="difflineplus">+  /**</span>
<a href="#l18.197"></a><span id="l18.197" class="difflineplus">+   * Whether or not the preview page is being forced.</span>
<a href="#l18.198"></a><span id="l18.198" class="difflineplus">+   */</span>
<a href="#l18.199"></a><span id="l18.199" class="difflineplus">+  _forcePreviewPage: false,</span>
<a href="#l18.200"></a><span id="l18.200" class="difflineplus">+</span>
<a href="#l18.201"></a><span id="l18.201" class="difflineplus">+  /**</span>
<a href="#l18.202"></a><span id="l18.202" class="difflineplus">+   * Release our references to various things once we're done using them.</span>
<a href="#l18.203"></a><span id="l18.203" class="difflineplus">+   */</span>
<a href="#l18.204"></a><span id="l18.204" class="difflineplus">+  _releaseHandles: function _releaseHandles() {</span>
<a href="#l18.205"></a><span id="l18.205" class="difflineplus">+    this._listener = null;</span>
<a href="#l18.206"></a><span id="l18.206" class="difflineplus">+    this._request = null;</span>
<a href="#l18.207"></a><span id="l18.207" class="difflineplus">+    this._processor = null;</span>
<a href="#l18.208"></a><span id="l18.208" class="difflineplus">+  },</span>
<a href="#l18.209"></a><span id="l18.209" class="difflineplus">+</span>
<a href="#l18.210"></a><span id="l18.210" class="difflineplus">+  /**</span>
<a href="#l18.211"></a><span id="l18.211" class="difflineplus">+   * See nsIFeedResultListener.idl</span>
<a href="#l18.212"></a><span id="l18.212" class="difflineplus">+   */</span>
<a href="#l18.213"></a><span id="l18.213" class="difflineplus">+  handleResult: function handleResult(result) {</span>
<a href="#l18.214"></a><span id="l18.214" class="difflineplus">+    // Feeds come in various content types, which our feed sniffer coerces to</span>
<a href="#l18.215"></a><span id="l18.215" class="difflineplus">+    // the maybe.feed type. However, feeds are used as a transport for</span>
<a href="#l18.216"></a><span id="l18.216" class="difflineplus">+    // different data types, e.g. news/blogs (traditional feed), video/audio</span>
<a href="#l18.217"></a><span id="l18.217" class="difflineplus">+    // (podcasts) and photos (photocasts, photostreams). Each of these is</span>
<a href="#l18.218"></a><span id="l18.218" class="difflineplus">+    // different in that there's a different class of application suitable for</span>
<a href="#l18.219"></a><span id="l18.219" class="difflineplus">+    // handling feeds of that type, but without a content-type differentiation</span>
<a href="#l18.220"></a><span id="l18.220" class="difflineplus">+    // it is difficult for us to disambiguate.</span>
<a href="#l18.221"></a><span id="l18.221" class="difflineplus">+    //</span>
<a href="#l18.222"></a><span id="l18.222" class="difflineplus">+    // The other problem is that if the user specifies an auto-action handler</span>
<a href="#l18.223"></a><span id="l18.223" class="difflineplus">+    // for one feed application, the fact that the content type is shared means</span>
<a href="#l18.224"></a><span id="l18.224" class="difflineplus">+    // that all other applications will auto-load with that handler too,</span>
<a href="#l18.225"></a><span id="l18.225" class="difflineplus">+    // regardless of the content-type.</span>
<a href="#l18.226"></a><span id="l18.226" class="difflineplus">+    //</span>
<a href="#l18.227"></a><span id="l18.227" class="difflineplus">+    // This means that content-type alone is not enough to determine whether</span>
<a href="#l18.228"></a><span id="l18.228" class="difflineplus">+    // or not a feed should be auto-handled. Therefore for feeds we need</span>
<a href="#l18.229"></a><span id="l18.229" class="difflineplus">+    // to always use this stream converter, even when an auto-action is</span>
<a href="#l18.230"></a><span id="l18.230" class="difflineplus">+    // specified, not the basic one provided by WebContentConverter. This</span>
<a href="#l18.231"></a><span id="l18.231" class="difflineplus">+    // converter needs to consume all of the data and parse it, and based on</span>
<a href="#l18.232"></a><span id="l18.232" class="difflineplus">+    // that determination make a judgement about type.</span>
<a href="#l18.233"></a><span id="l18.233" class="difflineplus">+    //</span>
<a href="#l18.234"></a><span id="l18.234" class="difflineplus">+    // Since there are no content types for this content, and I'm not going to</span>
<a href="#l18.235"></a><span id="l18.235" class="difflineplus">+    // invent any, the upshot is that while a user can set an auto-handler for</span>
<a href="#l18.236"></a><span id="l18.236" class="difflineplus">+    // generic feed content, the system will prevent them from setting an auto-</span>
<a href="#l18.237"></a><span id="l18.237" class="difflineplus">+    // handler for other stream types. In those cases, the user will always see</span>
<a href="#l18.238"></a><span id="l18.238" class="difflineplus">+    // the preview page and have to select a handler. We can guess and show</span>
<a href="#l18.239"></a><span id="l18.239" class="difflineplus">+    // a client handler, but will not be able to show web handlers for those</span>
<a href="#l18.240"></a><span id="l18.240" class="difflineplus">+    // types.</span>
<a href="#l18.241"></a><span id="l18.241" class="difflineplus">+    //</span>
<a href="#l18.242"></a><span id="l18.242" class="difflineplus">+    // If this is just a feed, not some kind of specialized application, then</span>
<a href="#l18.243"></a><span id="l18.243" class="difflineplus">+    // auto-handlers can be set and we should obey them.</span>
<a href="#l18.244"></a><span id="l18.244" class="difflineplus">+    try {</span>
<a href="#l18.245"></a><span id="l18.245" class="difflineplus">+      var feedService = Components.classes[&quot;@mozilla.org/browser/feeds/result-service;1&quot;]</span>
<a href="#l18.246"></a><span id="l18.246" class="difflineplus">+                                  .getService(Components.interfaces.nsIFeedResultService);</span>
<a href="#l18.247"></a><span id="l18.247" class="difflineplus">+      if (!this._forcePreviewPage &amp;&amp; result.doc) {</span>
<a href="#l18.248"></a><span id="l18.248" class="difflineplus">+        var feed = result.doc.QueryInterface(Components.interfaces.nsIFeed);</span>
<a href="#l18.249"></a><span id="l18.249" class="difflineplus">+        var handler = safeGetCharPref(getPrefActionForType(feed.type), &quot;ask&quot;);</span>
<a href="#l18.250"></a><span id="l18.250" class="difflineplus">+</span>
<a href="#l18.251"></a><span id="l18.251" class="difflineplus">+        if (handler != &quot;ask&quot;) {</span>
<a href="#l18.252"></a><span id="l18.252" class="difflineplus">+          if (handler == &quot;reader&quot;)</span>
<a href="#l18.253"></a><span id="l18.253" class="difflineplus">+            handler = safeGetCharPref(getPrefReaderForType(feed.type), &quot;messenger&quot;);</span>
<a href="#l18.254"></a><span id="l18.254" class="difflineplus">+          switch (handler) {</span>
<a href="#l18.255"></a><span id="l18.255" class="difflineplus">+            case &quot;web&quot;:</span>
<a href="#l18.256"></a><span id="l18.256" class="difflineplus">+              var wccr = Components.classes[&quot;@mozilla.org/embeddor.implemented/web-content-handler-registrar;1&quot;]</span>
<a href="#l18.257"></a><span id="l18.257" class="difflineplus">+                                   .getService(Components.interfaces.nsIWebContentConverterService);</span>
<a href="#l18.258"></a><span id="l18.258" class="difflineplus">+              if ((feed.type == Components.interfaces.nsIFeed.TYPE_FEED &amp;&amp;</span>
<a href="#l18.259"></a><span id="l18.259" class="difflineplus">+                   wccr.getAutoHandler(TYPE_MAYBE_FEED)) ||</span>
<a href="#l18.260"></a><span id="l18.260" class="difflineplus">+                  (feed.type == Components.interfaces.nsIFeed.TYPE_VIDEO &amp;&amp;</span>
<a href="#l18.261"></a><span id="l18.261" class="difflineplus">+                   wccr.getAutoHandler(TYPE_MAYBE_VIDEO_FEED)) ||</span>
<a href="#l18.262"></a><span id="l18.262" class="difflineplus">+                  (feed.type == Components.interfaces.nsIFeed.TYPE_AUDIO &amp;&amp;</span>
<a href="#l18.263"></a><span id="l18.263" class="difflineplus">+                   wccr.getAutoHandler(TYPE_MAYBE_AUDIO_FEED))) {</span>
<a href="#l18.264"></a><span id="l18.264" class="difflineplus">+                wccr.loadPreferredHandler(this._request);</span>
<a href="#l18.265"></a><span id="l18.265" class="difflineplus">+                return;</span>
<a href="#l18.266"></a><span id="l18.266" class="difflineplus">+              }</span>
<a href="#l18.267"></a><span id="l18.267" class="difflineplus">+              break;</span>
<a href="#l18.268"></a><span id="l18.268" class="difflineplus">+</span>
<a href="#l18.269"></a><span id="l18.269" class="difflineplus">+            default:</span>
<a href="#l18.270"></a><span id="l18.270" class="difflineplus">+              LOG(&quot;unexpected handler: &quot; + handler);</span>
<a href="#l18.271"></a><span id="l18.271" class="difflineplus">+              // fall through -- let feed service handle error</span>
<a href="#l18.272"></a><span id="l18.272" class="difflineplus">+            case &quot;bookmarks&quot;:</span>
<a href="#l18.273"></a><span id="l18.273" class="difflineplus">+            case &quot;client&quot;:</span>
<a href="#l18.274"></a><span id="l18.274" class="difflineplus">+            case &quot;messenger&quot;:</span>
<a href="#l18.275"></a><span id="l18.275" class="difflineplus">+              try {</span>
<a href="#l18.276"></a><span id="l18.276" class="difflineplus">+                var title = feed.title ? feed.title.plainText() : &quot;&quot;;</span>
<a href="#l18.277"></a><span id="l18.277" class="difflineplus">+                var desc = feed.subtitle ? feed.subtitle.plainText() : &quot;&quot;;</span>
<a href="#l18.278"></a><span id="l18.278" class="difflineplus">+                feedService.addToClientReader(result.uri.spec, title, desc, feed.type);</span>
<a href="#l18.279"></a><span id="l18.279" class="difflineplus">+                return;</span>
<a href="#l18.280"></a><span id="l18.280" class="difflineplus">+              } catch(ex) {</span>
<a href="#l18.281"></a><span id="l18.281" class="difflineplus">+                /* fallback to preview mode */</span>
<a href="#l18.282"></a><span id="l18.282" class="difflineplus">+              }</span>
<a href="#l18.283"></a><span id="l18.283" class="difflineplus">+          }</span>
<a href="#l18.284"></a><span id="l18.284" class="difflineplus">+        }</span>
<a href="#l18.285"></a><span id="l18.285" class="difflineplus">+      }</span>
<a href="#l18.286"></a><span id="l18.286" class="difflineplus">+</span>
<a href="#l18.287"></a><span id="l18.287" class="difflineplus">+      var chromeChannel;</span>
<a href="#l18.288"></a><span id="l18.288" class="difflineplus">+</span>
<a href="#l18.289"></a><span id="l18.289" class="difflineplus">+      // show the feed page if it wasn't sniffed and we have a document,</span>
<a href="#l18.290"></a><span id="l18.290" class="difflineplus">+      // or we have a document, title, and link or id</span>
<a href="#l18.291"></a><span id="l18.291" class="difflineplus">+      if (result.doc &amp;&amp; (!this._sniffed ||</span>
<a href="#l18.292"></a><span id="l18.292" class="difflineplus">+          (result.doc.title &amp;&amp; (result.doc.link || result.doc.id)))) {</span>
<a href="#l18.293"></a><span id="l18.293" class="difflineplus">+</span>
<a href="#l18.294"></a><span id="l18.294" class="difflineplus">+        // If there was no automatic handler, or this was a podcast,</span>
<a href="#l18.295"></a><span id="l18.295" class="difflineplus">+        // photostream or some other kind of application, we must always</span>
<a href="#l18.296"></a><span id="l18.296" class="difflineplus">+        // show the preview page.</span>
<a href="#l18.297"></a><span id="l18.297" class="difflineplus">+</span>
<a href="#l18.298"></a><span id="l18.298" class="difflineplus">+        // Store the result in the result service so that the display</span>
<a href="#l18.299"></a><span id="l18.299" class="difflineplus">+        // page can access it.</span>
<a href="#l18.300"></a><span id="l18.300" class="difflineplus">+</span>
<a href="#l18.301"></a><span id="l18.301" class="difflineplus">+        feedService.addFeedResult(result);</span>
<a href="#l18.302"></a><span id="l18.302" class="difflineplus">+</span>
<a href="#l18.303"></a><span id="l18.303" class="difflineplus">+        // Now load the actual XUL document.</span>
<a href="#l18.304"></a><span id="l18.304" class="difflineplus">+        var chromeURI = this._ioSvc.newURI(FEEDHANDLER_URI, null, null);</span>
<a href="#l18.305"></a><span id="l18.305" class="difflineplus">+        chromeChannel = this._ioSvc.newChannelFromURI(chromeURI, null);</span>
<a href="#l18.306"></a><span id="l18.306" class="difflineplus">+        chromeChannel.originalURI = result.uri;</span>
<a href="#l18.307"></a><span id="l18.307" class="difflineplus">+      }</span>
<a href="#l18.308"></a><span id="l18.308" class="difflineplus">+      else</span>
<a href="#l18.309"></a><span id="l18.309" class="difflineplus">+        chromeChannel = this._ioSvc.newChannelFromURI(result.uri, null);</span>
<a href="#l18.310"></a><span id="l18.310" class="difflineplus">+</span>
<a href="#l18.311"></a><span id="l18.311" class="difflineplus">+      chromeChannel.loadGroup = this._request.loadGroup;</span>
<a href="#l18.312"></a><span id="l18.312" class="difflineplus">+      chromeChannel.asyncOpen(this._listener, null);</span>
<a href="#l18.313"></a><span id="l18.313" class="difflineplus">+    }</span>
<a href="#l18.314"></a><span id="l18.314" class="difflineplus">+    finally {</span>
<a href="#l18.315"></a><span id="l18.315" class="difflineplus">+      this._releaseHandles();</span>
<a href="#l18.316"></a><span id="l18.316" class="difflineplus">+    }</span>
<a href="#l18.317"></a><span id="l18.317" class="difflineplus">+  },</span>
<a href="#l18.318"></a><span id="l18.318" class="difflineplus">+</span>
<a href="#l18.319"></a><span id="l18.319" class="difflineplus">+  /**</span>
<a href="#l18.320"></a><span id="l18.320" class="difflineplus">+   * See nsIStreamListener.idl</span>
<a href="#l18.321"></a><span id="l18.321" class="difflineplus">+   */</span>
<a href="#l18.322"></a><span id="l18.322" class="difflineplus">+  onDataAvailable: function onDataAvailable(request, context, inputStream,</span>
<a href="#l18.323"></a><span id="l18.323" class="difflineplus">+                                             sourceOffset, count) {</span>
<a href="#l18.324"></a><span id="l18.324" class="difflineplus">+    if (this._processor)</span>
<a href="#l18.325"></a><span id="l18.325" class="difflineplus">+      this._processor.onDataAvailable(request, context, inputStream,</span>
<a href="#l18.326"></a><span id="l18.326" class="difflineplus">+                                      sourceOffset, count);</span>
<a href="#l18.327"></a><span id="l18.327" class="difflineplus">+  },</span>
<a href="#l18.328"></a><span id="l18.328" class="difflineplus">+</span>
<a href="#l18.329"></a><span id="l18.329" class="difflineplus">+  /**</span>
<a href="#l18.330"></a><span id="l18.330" class="difflineplus">+   * See nsIRequestObserver.idl</span>
<a href="#l18.331"></a><span id="l18.331" class="difflineplus">+   */</span>
<a href="#l18.332"></a><span id="l18.332" class="difflineplus">+  onStartRequest: function onStartRequest(request, context) {</span>
<a href="#l18.333"></a><span id="l18.333" class="difflineplus">+    var channel = request.QueryInterface(Components.interfaces.nsIChannel);</span>
<a href="#l18.334"></a><span id="l18.334" class="difflineplus">+</span>
<a href="#l18.335"></a><span id="l18.335" class="difflineplus">+    // Check for a header that tells us there was no sniffing</span>
<a href="#l18.336"></a><span id="l18.336" class="difflineplus">+    // The value doesn't matter.</span>
<a href="#l18.337"></a><span id="l18.337" class="difflineplus">+    try {</span>
<a href="#l18.338"></a><span id="l18.338" class="difflineplus">+      var httpChannel = channel.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l18.339"></a><span id="l18.339" class="difflineplus">+      var noSniff = httpChannel.getResponseHeader(&quot;X-Moz-Is-Feed&quot;);</span>
<a href="#l18.340"></a><span id="l18.340" class="difflineplus">+    }</span>
<a href="#l18.341"></a><span id="l18.341" class="difflineplus">+    catch (ex) {</span>
<a href="#l18.342"></a><span id="l18.342" class="difflineplus">+      this._sniffed = true;</span>
<a href="#l18.343"></a><span id="l18.343" class="difflineplus">+    }</span>
<a href="#l18.344"></a><span id="l18.344" class="difflineplus">+</span>
<a href="#l18.345"></a><span id="l18.345" class="difflineplus">+    this._request = request;</span>
<a href="#l18.346"></a><span id="l18.346" class="difflineplus">+</span>
<a href="#l18.347"></a><span id="l18.347" class="difflineplus">+    // Save and reset the forced state bit early, in case there's some kind of</span>
<a href="#l18.348"></a><span id="l18.348" class="difflineplus">+    // error.</span>
<a href="#l18.349"></a><span id="l18.349" class="difflineplus">+    var feedService = Components.classes[&quot;@mozilla.org/browser/feeds/result-service;1&quot;]</span>
<a href="#l18.350"></a><span id="l18.350" class="difflineplus">+                                .getService(Components.interfaces.nsIFeedResultService);</span>
<a href="#l18.351"></a><span id="l18.351" class="difflineplus">+    this._forcePreviewPage = feedService.forcePreviewPage;</span>
<a href="#l18.352"></a><span id="l18.352" class="difflineplus">+    feedService.forcePreviewPage = false;</span>
<a href="#l18.353"></a><span id="l18.353" class="difflineplus">+</span>
<a href="#l18.354"></a><span id="l18.354" class="difflineplus">+    // Parse feed data as it comes in</span>
<a href="#l18.355"></a><span id="l18.355" class="difflineplus">+    this._processor = Components.classes[&quot;@mozilla.org/feed-processor;1&quot;]</span>
<a href="#l18.356"></a><span id="l18.356" class="difflineplus">+                                .createInstance(Components.interfaces.nsIFeedProcessor);</span>
<a href="#l18.357"></a><span id="l18.357" class="difflineplus">+    this._processor.listener = this;</span>
<a href="#l18.358"></a><span id="l18.358" class="difflineplus">+    this._processor.parseAsync(null, channel.URI);</span>
<a href="#l18.359"></a><span id="l18.359" class="difflineplus">+</span>
<a href="#l18.360"></a><span id="l18.360" class="difflineplus">+    this._processor.onStartRequest(request, context);</span>
<a href="#l18.361"></a><span id="l18.361" class="difflineplus">+  },</span>
<a href="#l18.362"></a><span id="l18.362" class="difflineplus">+</span>
<a href="#l18.363"></a><span id="l18.363" class="difflineplus">+  /**</span>
<a href="#l18.364"></a><span id="l18.364" class="difflineplus">+   * See nsIRequestObserver.idl</span>
<a href="#l18.365"></a><span id="l18.365" class="difflineplus">+   */</span>
<a href="#l18.366"></a><span id="l18.366" class="difflineplus">+  onStopRequest: function onStopRequest(request, context, status) {</span>
<a href="#l18.367"></a><span id="l18.367" class="difflineplus">+    if (this._processor)</span>
<a href="#l18.368"></a><span id="l18.368" class="difflineplus">+      this._processor.onStopRequest(request, context, status);</span>
<a href="#l18.369"></a><span id="l18.369" class="difflineplus">+  }</span>
<a href="#l18.370"></a><span id="l18.370" class="difflineplus">+</span>
<a href="#l18.371"></a><span id="l18.371" class="difflineplus">+};</span>
<a href="#l18.372"></a><span id="l18.372" class="difflineplus">+</span>
<a href="#l18.373"></a><span id="l18.373" class="difflineplus">+/**</span>
<a href="#l18.374"></a><span id="l18.374" class="difflineplus">+ * Helper to register multiple components sharing the same prototype</span>
<a href="#l18.375"></a><span id="l18.375" class="difflineplus">+ * using XPCOMUtils.</span>
<a href="#l18.376"></a><span id="l18.376" class="difflineplus">+ */</span>
<a href="#l18.377"></a><span id="l18.377" class="difflineplus">+function build_component(component, ctor, properties) {</span>
<a href="#l18.378"></a><span id="l18.378" class="difflineplus">+  component.prototype = new ctor();</span>
<a href="#l18.379"></a><span id="l18.379" class="difflineplus">+  for (let name in properties) {</span>
<a href="#l18.380"></a><span id="l18.380" class="difflineplus">+    component.prototype[name] = properties[name];</span>
<a href="#l18.381"></a><span id="l18.381" class="difflineplus">+  }</span>
<a href="#l18.382"></a><span id="l18.382" class="difflineplus">+}</span>
<a href="#l18.383"></a><span id="l18.383" class="difflineplus">+</span>
<a href="#l18.384"></a><span id="l18.384" class="difflineplus">+function FeedConverter_feed() {</span>
<a href="#l18.385"></a><span id="l18.385" class="difflineplus">+}</span>
<a href="#l18.386"></a><span id="l18.386" class="difflineplus">+</span>
<a href="#l18.387"></a><span id="l18.387" class="difflineplus">+build_component(FeedConverter_feed, FeedConverter,</span>
<a href="#l18.388"></a><span id="l18.388" class="difflineplus">+                {contractID: &quot;@mozilla.org/streamconv;1?from=&quot;</span>
<a href="#l18.389"></a><span id="l18.389" class="difflineplus">+                             + TYPE_MAYBE_FEED + &quot;&amp;to=&quot;</span>
<a href="#l18.390"></a><span id="l18.390" class="difflineplus">+                             + TYPE_ANY});</span>
<a href="#l18.391"></a><span id="l18.391" class="difflineplus">+</span>
<a href="#l18.392"></a><span id="l18.392" class="difflineplus">+function FeedConverter_audio_feed() {</span>
<a href="#l18.393"></a><span id="l18.393" class="difflineplus">+}</span>
<a href="#l18.394"></a><span id="l18.394" class="difflineplus">+</span>
<a href="#l18.395"></a><span id="l18.395" class="difflineplus">+build_component(FeedConverter_audio_feed, FeedConverter,</span>
<a href="#l18.396"></a><span id="l18.396" class="difflineplus">+                {contractID: &quot;@mozilla.org/streamconv;1?from=&quot;</span>
<a href="#l18.397"></a><span id="l18.397" class="difflineplus">+                             + TYPE_MAYBE_AUDIO_FEED + &quot;&amp;to=&quot;</span>
<a href="#l18.398"></a><span id="l18.398" class="difflineplus">+                             + TYPE_ANY});</span>
<a href="#l18.399"></a><span id="l18.399" class="difflineplus">+</span>
<a href="#l18.400"></a><span id="l18.400" class="difflineplus">+function FeedConverter_video_feed() {</span>
<a href="#l18.401"></a><span id="l18.401" class="difflineplus">+}</span>
<a href="#l18.402"></a><span id="l18.402" class="difflineplus">+</span>
<a href="#l18.403"></a><span id="l18.403" class="difflineplus">+build_component(FeedConverter_video_feed, FeedConverter,</span>
<a href="#l18.404"></a><span id="l18.404" class="difflineplus">+                {contractID: &quot;@mozilla.org/streamconv;1?from=&quot;</span>
<a href="#l18.405"></a><span id="l18.405" class="difflineplus">+                             + TYPE_MAYBE_VIDEO_FEED + &quot;&amp;to=&quot;</span>
<a href="#l18.406"></a><span id="l18.406" class="difflineplus">+                             + TYPE_ANY});</span>
<a href="#l18.407"></a><span id="l18.407" class="difflineplus">+</span>
<a href="#l18.408"></a><span id="l18.408" class="difflineplus">+/**</span>
<a href="#l18.409"></a><span id="l18.409" class="difflineplus">+ * Keeps parsed FeedResults around for use elsewhere in the UI after the stream</span>
<a href="#l18.410"></a><span id="l18.410" class="difflineplus">+ * converter completes.</span>
<a href="#l18.411"></a><span id="l18.411" class="difflineplus">+ */</span>
<a href="#l18.412"></a><span id="l18.412" class="difflineplus">+function FeedResultService() {</span>
<a href="#l18.413"></a><span id="l18.413" class="difflineplus">+  this._ioSvc = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l18.414"></a><span id="l18.414" class="difflineplus">+                          .getService(Components.interfaces.nsIIOService);</span>
<a href="#l18.415"></a><span id="l18.415" class="difflineplus">+}</span>
<a href="#l18.416"></a><span id="l18.416" class="difflineplus">+</span>
<a href="#l18.417"></a><span id="l18.417" class="difflineplus">+FeedResultService.prototype = {</span>
<a href="#l18.418"></a><span id="l18.418" class="difflineplus">+  /**</span>
<a href="#l18.419"></a><span id="l18.419" class="difflineplus">+   * A URI spec -&gt; [nsIFeedResult] hash. We have to keep a list as the</span>
<a href="#l18.420"></a><span id="l18.420" class="difflineplus">+   * value in case the same URI is requested concurrently.</span>
<a href="#l18.421"></a><span id="l18.421" class="difflineplus">+   */</span>
<a href="#l18.422"></a><span id="l18.422" class="difflineplus">+  _results: { },</span>
<a href="#l18.423"></a><span id="l18.423" class="difflineplus">+</span>
<a href="#l18.424"></a><span id="l18.424" class="difflineplus">+  /**</span>
<a href="#l18.425"></a><span id="l18.425" class="difflineplus">+   * See nsIFeedResultService.idl</span>
<a href="#l18.426"></a><span id="l18.426" class="difflineplus">+   */</span>
<a href="#l18.427"></a><span id="l18.427" class="difflineplus">+  forcePreviewPage: false,</span>
<a href="#l18.428"></a><span id="l18.428" class="difflineplus">+</span>
<a href="#l18.429"></a><span id="l18.429" class="difflineplus">+  /**</span>
<a href="#l18.430"></a><span id="l18.430" class="difflineplus">+   * See nsIFeedResultService.idl</span>
<a href="#l18.431"></a><span id="l18.431" class="difflineplus">+   */</span>
<a href="#l18.432"></a><span id="l18.432" class="difflineplus">+  addToClientReader: function addToClientReader(spec, title, subtitle, feedType) {</span>
<a href="#l18.433"></a><span id="l18.433" class="difflineplus">+    var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l18.434"></a><span id="l18.434" class="difflineplus">+                          .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l18.435"></a><span id="l18.435" class="difflineplus">+</span>
<a href="#l18.436"></a><span id="l18.436" class="difflineplus">+    var handler = safeGetCharPref(getPrefActionForType(feedType), &quot;reader&quot;);</span>
<a href="#l18.437"></a><span id="l18.437" class="difflineplus">+    if (handler == &quot;ask&quot; || handler == &quot;reader&quot;)</span>
<a href="#l18.438"></a><span id="l18.438" class="difflineplus">+      handler = safeGetCharPref(getPrefReaderForType(feedType), &quot;messenger&quot;);</span>
<a href="#l18.439"></a><span id="l18.439" class="difflineplus">+</span>
<a href="#l18.440"></a><span id="l18.440" class="difflineplus">+    switch (handler) {</span>
<a href="#l18.441"></a><span id="l18.441" class="difflineplus">+    case &quot;client&quot;:</span>
<a href="#l18.442"></a><span id="l18.442" class="difflineplus">+      var clientApp = prefs.getComplexValue(getPrefAppForType(feedType),</span>
<a href="#l18.443"></a><span id="l18.443" class="difflineplus">+                                            Components.interfaces.nsILocalFile);</span>
<a href="#l18.444"></a><span id="l18.444" class="difflineplus">+</span>
<a href="#l18.445"></a><span id="l18.445" class="difflineplus">+      // For the benefit of applications that might know how to deal with more</span>
<a href="#l18.446"></a><span id="l18.446" class="difflineplus">+      // URLs than just feeds, send feed: URLs in the following format:</span>
<a href="#l18.447"></a><span id="l18.447" class="difflineplus">+      //</span>
<a href="#l18.448"></a><span id="l18.448" class="difflineplus">+      // http urls: replace scheme with feed, e.g.</span>
<a href="#l18.449"></a><span id="l18.449" class="difflineplus">+      // http://foo.com/index.rdf -&gt; feed://foo.com/index.rdf</span>
<a href="#l18.450"></a><span id="l18.450" class="difflineplus">+      // other urls: prepend feed: scheme, e.g.</span>
<a href="#l18.451"></a><span id="l18.451" class="difflineplus">+      // https://foo.com/index.rdf -&gt; feed:https://foo.com/index.rdf</span>
<a href="#l18.452"></a><span id="l18.452" class="difflineplus">+      var feedURI = this._ioSvc.newURI(spec, null, null);</span>
<a href="#l18.453"></a><span id="l18.453" class="difflineplus">+      if (feedURI.schemeIs(&quot;http&quot;)) {</span>
<a href="#l18.454"></a><span id="l18.454" class="difflineplus">+        feedURI.scheme = &quot;feed&quot;;</span>
<a href="#l18.455"></a><span id="l18.455" class="difflineplus">+        spec = feedURI.spec;</span>
<a href="#l18.456"></a><span id="l18.456" class="difflineplus">+      }</span>
<a href="#l18.457"></a><span id="l18.457" class="difflineplus">+      else</span>
<a href="#l18.458"></a><span id="l18.458" class="difflineplus">+        spec = &quot;feed:&quot; + spec;</span>
<a href="#l18.459"></a><span id="l18.459" class="difflineplus">+</span>
<a href="#l18.460"></a><span id="l18.460" class="difflineplus">+      // Retrieving the shell service might fail on some systems, most</span>
<a href="#l18.461"></a><span id="l18.461" class="difflineplus">+      // notably systems where GNOME is not installed.</span>
<a href="#l18.462"></a><span id="l18.462" class="difflineplus">+      try {</span>
<a href="#l18.463"></a><span id="l18.463" class="difflineplus">+        var ss = Components.classes[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l18.464"></a><span id="l18.464" class="difflineplus">+                           .getService(Components.interfaces.nsIShellService);</span>
<a href="#l18.465"></a><span id="l18.465" class="difflineplus">+        ss.openApplicationWithURI(clientApp, spec);</span>
<a href="#l18.466"></a><span id="l18.466" class="difflineplus">+      } catch(e) {</span>
<a href="#l18.467"></a><span id="l18.467" class="difflineplus">+        // If we couldn't use the shell service, fallback to using a</span>
<a href="#l18.468"></a><span id="l18.468" class="difflineplus">+        // nsIProcess instance</span>
<a href="#l18.469"></a><span id="l18.469" class="difflineplus">+        var p = Components.classes[&quot;@mozilla.org/process/util;1&quot;]</span>
<a href="#l18.470"></a><span id="l18.470" class="difflineplus">+                          .createInstance(Components.interfaces.nsIProcess);</span>
<a href="#l18.471"></a><span id="l18.471" class="difflineplus">+        p.init(clientApp);</span>
<a href="#l18.472"></a><span id="l18.472" class="difflineplus">+        p.run(false, [spec], 1);</span>
<a href="#l18.473"></a><span id="l18.473" class="difflineplus">+      }</span>
<a href="#l18.474"></a><span id="l18.474" class="difflineplus">+      break;</span>
<a href="#l18.475"></a><span id="l18.475" class="difflineplus">+</span>
<a href="#l18.476"></a><span id="l18.476" class="difflineplus">+    default:</span>
<a href="#l18.477"></a><span id="l18.477" class="difflineplus">+      // &quot;web&quot; should have been handled elsewhere</span>
<a href="#l18.478"></a><span id="l18.478" class="difflineplus">+      LOG(&quot;unexpected handler: &quot; + handler);</span>
<a href="#l18.479"></a><span id="l18.479" class="difflineplus">+      // fall through</span>
<a href="#l18.480"></a><span id="l18.480" class="difflineplus">+    case &quot;bookmarks&quot;:</span>
<a href="#l18.481"></a><span id="l18.481" class="difflineplus">+    case &quot;messenger&quot;:</span>
<a href="#l18.482"></a><span id="l18.482" class="difflineplus">+      Components.classes[&quot;@mozilla.org/newsblog-feed-downloader;1&quot;]</span>
<a href="#l18.483"></a><span id="l18.483" class="difflineplus">+                .getService(Components.interfaces.nsINewsBlogFeedDownloader)</span>
<a href="#l18.484"></a><span id="l18.484" class="difflineplus">+                .subscribeToFeed(spec, null, null);</span>
<a href="#l18.485"></a><span id="l18.485" class="difflineplus">+      break;</span>
<a href="#l18.486"></a><span id="l18.486" class="difflineplus">+</span>
<a href="#l18.487"></a><span id="l18.487" class="difflineplus">+    }</span>
<a href="#l18.488"></a><span id="l18.488" class="difflineplus">+  },</span>
<a href="#l18.489"></a><span id="l18.489" class="difflineplus">+</span>
<a href="#l18.490"></a><span id="l18.490" class="difflineplus">+  /**</span>
<a href="#l18.491"></a><span id="l18.491" class="difflineplus">+   * See nsIFeedResultService.idl</span>
<a href="#l18.492"></a><span id="l18.492" class="difflineplus">+   */</span>
<a href="#l18.493"></a><span id="l18.493" class="difflineplus">+  addFeedResult: function addFeedResult(feedResult) {</span>
<a href="#l18.494"></a><span id="l18.494" class="difflineplus">+    NS_ASSERT(feedResult != null, &quot;null feedResult!&quot;);</span>
<a href="#l18.495"></a><span id="l18.495" class="difflineplus">+    NS_ASSERT(feedResult.uri != null, &quot;null URI!&quot;);</span>
<a href="#l18.496"></a><span id="l18.496" class="difflineplus">+    var spec = feedResult.uri.spec;</span>
<a href="#l18.497"></a><span id="l18.497" class="difflineplus">+    if (!this._results[spec])</span>
<a href="#l18.498"></a><span id="l18.498" class="difflineplus">+      this._results[spec] = [];</span>
<a href="#l18.499"></a><span id="l18.499" class="difflineplus">+    this._results[spec].push(feedResult);</span>
<a href="#l18.500"></a><span id="l18.500" class="difflineplus">+  },</span>
<a href="#l18.501"></a><span id="l18.501" class="difflineplus">+</span>
<a href="#l18.502"></a><span id="l18.502" class="difflineplus">+  /**</span>
<a href="#l18.503"></a><span id="l18.503" class="difflineplus">+   * See nsIFeedResultService.idl</span>
<a href="#l18.504"></a><span id="l18.504" class="difflineplus">+   */</span>
<a href="#l18.505"></a><span id="l18.505" class="difflineplus">+  getFeedResult: function getFeedResult(uri) {</span>
<a href="#l18.506"></a><span id="l18.506" class="difflineplus">+    NS_ASSERT(uri != null, &quot;null URI!&quot;);</span>
<a href="#l18.507"></a><span id="l18.507" class="difflineplus">+    var resultList = this._results[uri.spec];</span>
<a href="#l18.508"></a><span id="l18.508" class="difflineplus">+    for (let i = 0; i &lt; resultList.length; ++i) {</span>
<a href="#l18.509"></a><span id="l18.509" class="difflineplus">+      if (resultList[i].uri == uri)</span>
<a href="#l18.510"></a><span id="l18.510" class="difflineplus">+        return resultList[i];</span>
<a href="#l18.511"></a><span id="l18.511" class="difflineplus">+    }</span>
<a href="#l18.512"></a><span id="l18.512" class="difflineplus">+    return null;</span>
<a href="#l18.513"></a><span id="l18.513" class="difflineplus">+  },</span>
<a href="#l18.514"></a><span id="l18.514" class="difflineplus">+</span>
<a href="#l18.515"></a><span id="l18.515" class="difflineplus">+  /**</span>
<a href="#l18.516"></a><span id="l18.516" class="difflineplus">+   * See nsIFeedResultService.idl</span>
<a href="#l18.517"></a><span id="l18.517" class="difflineplus">+   */</span>
<a href="#l18.518"></a><span id="l18.518" class="difflineplus">+  removeFeedResult: function removeFeedResult(uri) {</span>
<a href="#l18.519"></a><span id="l18.519" class="difflineplus">+    NS_ASSERT(uri != null, &quot;null URI!&quot;);</span>
<a href="#l18.520"></a><span id="l18.520" class="difflineplus">+    var resultList = this._results[uri.spec];</span>
<a href="#l18.521"></a><span id="l18.521" class="difflineplus">+    if (!resultList)</span>
<a href="#l18.522"></a><span id="l18.522" class="difflineplus">+      return;</span>
<a href="#l18.523"></a><span id="l18.523" class="difflineplus">+    var deletions = 0;</span>
<a href="#l18.524"></a><span id="l18.524" class="difflineplus">+    for (let i = 0; i &lt; resultList.length; ++i) {</span>
<a href="#l18.525"></a><span id="l18.525" class="difflineplus">+      if (resultList[i].uri == uri) {</span>
<a href="#l18.526"></a><span id="l18.526" class="difflineplus">+        delete resultList[i];</span>
<a href="#l18.527"></a><span id="l18.527" class="difflineplus">+        ++deletions;</span>
<a href="#l18.528"></a><span id="l18.528" class="difflineplus">+      }</span>
<a href="#l18.529"></a><span id="l18.529" class="difflineplus">+    }</span>
<a href="#l18.530"></a><span id="l18.530" class="difflineplus">+</span>
<a href="#l18.531"></a><span id="l18.531" class="difflineplus">+    // send the holes to the end</span>
<a href="#l18.532"></a><span id="l18.532" class="difflineplus">+    resultList.sort();</span>
<a href="#l18.533"></a><span id="l18.533" class="difflineplus">+    // and trim the list</span>
<a href="#l18.534"></a><span id="l18.534" class="difflineplus">+    resultList.splice(resultList.length - deletions, deletions);</span>
<a href="#l18.535"></a><span id="l18.535" class="difflineplus">+    if (resultList.length == 0)</span>
<a href="#l18.536"></a><span id="l18.536" class="difflineplus">+      delete this._results[uri.spec];</span>
<a href="#l18.537"></a><span id="l18.537" class="difflineplus">+  },</span>
<a href="#l18.538"></a><span id="l18.538" class="difflineplus">+</span>
<a href="#l18.539"></a><span id="l18.539" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIFeedResultService,</span>
<a href="#l18.540"></a><span id="l18.540" class="difflineplus">+                                         Components.interfaces.nsISupports]),</span>
<a href="#l18.541"></a><span id="l18.541" class="difflineplus">+  classID: Components.ID(&quot;{E5B05E9D-F037-48e4-B9A4-B99476582927}&quot;),</span>
<a href="#l18.542"></a><span id="l18.542" class="difflineplus">+  classDescription: &quot;Feed Result Service&quot;,</span>
<a href="#l18.543"></a><span id="l18.543" class="difflineplus">+  contractID: &quot;@mozilla.org/browser/feeds/result-service;1&quot;,</span>
<a href="#l18.544"></a><span id="l18.544" class="difflineplus">+  implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT</span>
<a href="#l18.545"></a><span id="l18.545" class="difflineplus">+};</span>
<a href="#l18.546"></a><span id="l18.546" class="difflineplus">+</span>
<a href="#l18.547"></a><span id="l18.547" class="difflineplus">+/**</span>
<a href="#l18.548"></a><span id="l18.548" class="difflineplus">+ * A protocol handler that attempts to deal with the variant forms of feed:</span>
<a href="#l18.549"></a><span id="l18.549" class="difflineplus">+ * URIs that are actually either http or https.</span>
<a href="#l18.550"></a><span id="l18.550" class="difflineplus">+ */</span>
<a href="#l18.551"></a><span id="l18.551" class="difflineplus">+function _FeedProtocolHandler() {</span>
<a href="#l18.552"></a><span id="l18.552" class="difflineplus">+  this._ioSvc = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l18.553"></a><span id="l18.553" class="difflineplus">+                          .getService(Components.interfaces.nsIIOService);</span>
<a href="#l18.554"></a><span id="l18.554" class="difflineplus">+  this._http = this._ioSvc.getProtocolHandler(&quot;http&quot;);</span>
<a href="#l18.555"></a><span id="l18.555" class="difflineplus">+}</span>
<a href="#l18.556"></a><span id="l18.556" class="difflineplus">+</span>
<a href="#l18.557"></a><span id="l18.557" class="difflineplus">+_FeedProtocolHandler.prototype = {</span>
<a href="#l18.558"></a><span id="l18.558" class="difflineplus">+  get protocolFlags() {</span>
<a href="#l18.559"></a><span id="l18.559" class="difflineplus">+    return this._http.protocolFlags;</span>
<a href="#l18.560"></a><span id="l18.560" class="difflineplus">+  },</span>
<a href="#l18.561"></a><span id="l18.561" class="difflineplus">+</span>
<a href="#l18.562"></a><span id="l18.562" class="difflineplus">+  get defaultPort() {</span>
<a href="#l18.563"></a><span id="l18.563" class="difflineplus">+    return this._http.defaultPort;</span>
<a href="#l18.564"></a><span id="l18.564" class="difflineplus">+  },</span>
<a href="#l18.565"></a><span id="l18.565" class="difflineplus">+</span>
<a href="#l18.566"></a><span id="l18.566" class="difflineplus">+  allowPort: function allowPort(port, scheme) {</span>
<a href="#l18.567"></a><span id="l18.567" class="difflineplus">+    return this._http.allowPort(port, scheme);</span>
<a href="#l18.568"></a><span id="l18.568" class="difflineplus">+  },</span>
<a href="#l18.569"></a><span id="l18.569" class="difflineplus">+</span>
<a href="#l18.570"></a><span id="l18.570" class="difflineplus">+  newURI: function newURI(spec, originalCharset, baseURI) {</span>
<a href="#l18.571"></a><span id="l18.571" class="difflineplus">+    // See bug 408599 - feed URIs can be either standard URLs of the form</span>
<a href="#l18.572"></a><span id="l18.572" class="difflineplus">+    // feed://example.com, in which case the real protocol is http, or nested</span>
<a href="#l18.573"></a><span id="l18.573" class="difflineplus">+    // URIs of the form feed:realscheme:. When realscheme is either http or</span>
<a href="#l18.574"></a><span id="l18.574" class="difflineplus">+    // https, we deal with the way that creates a standard URL with the</span>
<a href="#l18.575"></a><span id="l18.575" class="difflineplus">+    // realscheme as the host by unmangling in newChannel; for others, we fail</span>
<a href="#l18.576"></a><span id="l18.576" class="difflineplus">+    // rather than let it wind up loading something like www.realscheme.com//foo</span>
<a href="#l18.577"></a><span id="l18.577" class="difflineplus">+</span>
<a href="#l18.578"></a><span id="l18.578" class="difflineplus">+    const feedSlashes = &quot;feed://&quot;;</span>
<a href="#l18.579"></a><span id="l18.579" class="difflineplus">+    const feedHttpSlashes = &quot;feed:http://&quot;;</span>
<a href="#l18.580"></a><span id="l18.580" class="difflineplus">+    const feedHttpsSlashes = &quot;feed:https://&quot;;</span>
<a href="#l18.581"></a><span id="l18.581" class="difflineplus">+</span>
<a href="#l18.582"></a><span id="l18.582" class="difflineplus">+    if (spec.substr(0, feedSlashes.length) != feedSlashes &amp;&amp;</span>
<a href="#l18.583"></a><span id="l18.583" class="difflineplus">+        spec.substr(0, feedHttpSlashes.length) != feedHttpSlashes &amp;&amp;</span>
<a href="#l18.584"></a><span id="l18.584" class="difflineplus">+        spec.substr(0, feedHttpsSlashes.length) != feedHttpsSlashes)</span>
<a href="#l18.585"></a><span id="l18.585" class="difflineplus">+      throw Components.results.NS_ERROR_MALFORMED_URI;</span>
<a href="#l18.586"></a><span id="l18.586" class="difflineplus">+</span>
<a href="#l18.587"></a><span id="l18.587" class="difflineplus">+    var uri = Components.classes[&quot;@mozilla.org/network/standard-url;1&quot;]</span>
<a href="#l18.588"></a><span id="l18.588" class="difflineplus">+                        .createInstance(Components.interfaces.nsIStandardURL);</span>
<a href="#l18.589"></a><span id="l18.589" class="difflineplus">+    uri.init(Components.interfaces.nsIStandardURL.URLTYPE_STANDARD, 80, spec,</span>
<a href="#l18.590"></a><span id="l18.590" class="difflineplus">+             originalCharset, baseURI);</span>
<a href="#l18.591"></a><span id="l18.591" class="difflineplus">+    return uri;</span>
<a href="#l18.592"></a><span id="l18.592" class="difflineplus">+  },</span>
<a href="#l18.593"></a><span id="l18.593" class="difflineplus">+</span>
<a href="#l18.594"></a><span id="l18.594" class="difflineplus">+  newChannel: function newChannel(aUri) {</span>
<a href="#l18.595"></a><span id="l18.595" class="difflineplus">+    // feed: URIs either start feed://, in which case the real scheme is http:</span>
<a href="#l18.596"></a><span id="l18.596" class="difflineplus">+    // or feed:http(s)://, (which by now we've changed to feed://realscheme//)</span>
<a href="#l18.597"></a><span id="l18.597" class="difflineplus">+    var feedSpec = aUri.spec;</span>
<a href="#l18.598"></a><span id="l18.598" class="difflineplus">+    const httpChunk = /^feed:\/\/(https?)/;</span>
<a href="#l18.599"></a><span id="l18.599" class="difflineplus">+    if (httpChunk.test(feedSpec))</span>
<a href="#l18.600"></a><span id="l18.600" class="difflineplus">+      feedSpec = feedSpec.replace(httpChunk, &quot;$1:&quot;);</span>
<a href="#l18.601"></a><span id="l18.601" class="difflineplus">+    else</span>
<a href="#l18.602"></a><span id="l18.602" class="difflineplus">+      feedSpec = feedSpec.replace(/^feed/, &quot;http&quot;);</span>
<a href="#l18.603"></a><span id="l18.603" class="difflineplus">+</span>
<a href="#l18.604"></a><span id="l18.604" class="difflineplus">+    var uri = this._ioSvc.newURI(feedSpec, aUri.originCharset, null);</span>
<a href="#l18.605"></a><span id="l18.605" class="difflineplus">+    var channel = this._ioSvc.newChannelFromURI(uri, null)</span>
<a href="#l18.606"></a><span id="l18.606" class="difflineplus">+                       .QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l18.607"></a><span id="l18.607" class="difflineplus">+    // Set this so we know this is supposed to be a feed</span>
<a href="#l18.608"></a><span id="l18.608" class="difflineplus">+    channel.setRequestHeader(&quot;X-Moz-Is-Feed&quot;, &quot;1&quot;, false);</span>
<a href="#l18.609"></a><span id="l18.609" class="difflineplus">+    channel.originalURI = aUri;</span>
<a href="#l18.610"></a><span id="l18.610" class="difflineplus">+    return channel;</span>
<a href="#l18.611"></a><span id="l18.611" class="difflineplus">+  },</span>
<a href="#l18.612"></a><span id="l18.612" class="difflineplus">+</span>
<a href="#l18.613"></a><span id="l18.613" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIProtocolHandler,</span>
<a href="#l18.614"></a><span id="l18.614" class="difflineplus">+                                         Components.interfaces.nsISupports]),</span>
<a href="#l18.615"></a><span id="l18.615" class="difflineplus">+  implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT</span>
<a href="#l18.616"></a><span id="l18.616" class="difflineplus">+};</span>
<a href="#l18.617"></a><span id="l18.617" class="difflineplus">+</span>
<a href="#l18.618"></a><span id="l18.618" class="difflineplus">+function FeedProtocolHandler() {</span>
<a href="#l18.619"></a><span id="l18.619" class="difflineplus">+}</span>
<a href="#l18.620"></a><span id="l18.620" class="difflineplus">+</span>
<a href="#l18.621"></a><span id="l18.621" class="difflineplus">+build_component(FeedProtocolHandler, _FeedProtocolHandler,</span>
<a href="#l18.622"></a><span id="l18.622" class="difflineplus">+                {classID: Components.ID(&quot;{A95D7F48-11BE-4324-8872-D23BD79FE78B}&quot;),</span>
<a href="#l18.623"></a><span id="l18.623" class="difflineplus">+                 classDescription: &quot;Feed Protocol Handler&quot;,</span>
<a href="#l18.624"></a><span id="l18.624" class="difflineplus">+                 contractID: &quot;@mozilla.org/network/protocol;1?name=feed&quot;,</span>
<a href="#l18.625"></a><span id="l18.625" class="difflineplus">+                 scheme: &quot;feed&quot;</span>
<a href="#l18.626"></a><span id="l18.626" class="difflineplus">+                });</span>
<a href="#l18.627"></a><span id="l18.627" class="difflineplus">+</span>
<a href="#l18.628"></a><span id="l18.628" class="difflineplus">+function PodcastProtocolHandler() {</span>
<a href="#l18.629"></a><span id="l18.629" class="difflineplus">+}</span>
<a href="#l18.630"></a><span id="l18.630" class="difflineplus">+</span>
<a href="#l18.631"></a><span id="l18.631" class="difflineplus">+build_component(PodcastProtocolHandler, _FeedProtocolHandler,</span>
<a href="#l18.632"></a><span id="l18.632" class="difflineplus">+                {classID: Components.ID(&quot;{F0FF0FE4-1713-4d34-9323-3F5DEB6A6A60}&quot;),</span>
<a href="#l18.633"></a><span id="l18.633" class="difflineplus">+                 classDescription: &quot;Podcast Protocol Handler&quot;,</span>
<a href="#l18.634"></a><span id="l18.634" class="difflineplus">+                 contractID: &quot;@mozilla.org/network/protocol;1?name=pcast&quot;,</span>
<a href="#l18.635"></a><span id="l18.635" class="difflineplus">+                 scheme: &quot;pcast&quot;</span>
<a href="#l18.636"></a><span id="l18.636" class="difflineplus">+                });</span>
<a href="#l18.637"></a><span id="l18.637" class="difflineplus">+</span>
<a href="#l18.638"></a><span id="l18.638" class="difflineplus">+var components = [FeedProtocolHandler, PodcastProtocolHandler, FeedResultService,</span>
<a href="#l18.639"></a><span id="l18.639" class="difflineplus">+                  FeedConverter_feed, FeedConverter_audio_feed,</span>
<a href="#l18.640"></a><span id="l18.640" class="difflineplus">+                  FeedConverter_video_feed];</span>
<a href="#l18.641"></a><span id="l18.641" class="difflineplus">+</span>
<a href="#l18.642"></a><span id="l18.642" class="difflineplus">+function NSGetModule(cm, file) {</span>
<a href="#l18.643"></a><span id="l18.643" class="difflineplus">+  return XPCOMUtils.generateModule(components);</span>
<a href="#l18.644"></a><span id="l18.644" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">new file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- /dev/null</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ b/suite/feeds/src/FeedWriter.js</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -0,0 +1,1442 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineplus">+/* -*- Mode: Javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineplus">+ *</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+ *</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+ * License.</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+ *</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+ * The Original Code is the Feed Writer.</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+ *</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+ *</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineplus">+ *   Jeff Walden &lt;jwalden+code@mit.edu&gt;</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineplus">+ *   Robert Sayre &lt;sayrer@gmail.com&gt;</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineplus">+ *   Michael Ventnor &lt;m.ventnor@gmail.com&gt;</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineplus">+ *   Will Guaraldi &lt;will.guaraldi@pculture.org&gt;</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+ *   Caio Tiago Oliveira &lt;asrail@gmail.com&gt;</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+ *</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineplus">+ *</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineplus">+</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+const XML_NS = &quot;http://www.w3.org/XML/1998/namespace&quot;;</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+const HTML_NS = &quot;http://www.w3.org/1999/xhtml&quot;;</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineplus">+const XUL_NS = &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;;</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineplus">+const TYPE_MAYBE_FEED = &quot;application/vnd.mozilla.maybe.feed&quot;;</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineplus">+const TYPE_MAYBE_AUDIO_FEED = &quot;application/vnd.mozilla.maybe.audio.feed&quot;;</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineplus">+const TYPE_MAYBE_VIDEO_FEED = &quot;application/vnd.mozilla.maybe.video.feed&quot;;</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineplus">+const STRING_BUNDLE_URI = &quot;chrome://communicator/locale/feeds/subscribe.properties&quot;;</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineplus">+const SUBSCRIBE_PAGE_URI = &quot;chrome://communicator/content/feeds/subscribe.xhtml&quot;;</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineplus">+</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineplus">+const PREF_SELECTED_APP = &quot;browser.feeds.handlers.application&quot;;</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineplus">+const PREF_SELECTED_WEB = &quot;browser.feeds.handlers.webservice&quot;;</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineplus">+const PREF_SELECTED_ACTION = &quot;browser.feeds.handler&quot;;</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineplus">+const PREF_SELECTED_READER = &quot;browser.feeds.handler.default&quot;;</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineplus">+</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineplus">+const PREF_VIDEO_SELECTED_APP = &quot;browser.videoFeeds.handlers.application&quot;;</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineplus">+const PREF_VIDEO_SELECTED_WEB = &quot;browser.videoFeeds.handlers.webservice&quot;;</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineplus">+const PREF_VIDEO_SELECTED_ACTION = &quot;browser.videoFeeds.handler&quot;;</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineplus">+const PREF_VIDEO_SELECTED_READER = &quot;browser.videoFeeds.handler.default&quot;;</span>
<a href="#l19.68"></a><span id="l19.68" class="difflineplus">+</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineplus">+const PREF_AUDIO_SELECTED_APP = &quot;browser.audioFeeds.handlers.application&quot;;</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineplus">+const PREF_AUDIO_SELECTED_WEB = &quot;browser.audioFeeds.handlers.webservice&quot;;</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineplus">+const PREF_AUDIO_SELECTED_ACTION = &quot;browser.audioFeeds.handler&quot;;</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineplus">+const PREF_AUDIO_SELECTED_READER = &quot;browser.audioFeeds.handler.default&quot;;</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineplus">+</span>
<a href="#l19.74"></a><span id="l19.74" class="difflineplus">+const PREF_SHOW_FIRST_RUN_UI = &quot;browser.feeds.showFirstRunUI&quot;;</span>
<a href="#l19.75"></a><span id="l19.75" class="difflineplus">+</span>
<a href="#l19.76"></a><span id="l19.76" class="difflineplus">+const TITLE_ID = &quot;feedTitleText&quot;;</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineplus">+const SUBTITLE_ID = &quot;feedSubtitleText&quot;;</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineplus">+</span>
<a href="#l19.79"></a><span id="l19.79" class="difflineplus">+function getPrefAppForType(t) {</span>
<a href="#l19.80"></a><span id="l19.80" class="difflineplus">+  switch (t) {</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l19.82"></a><span id="l19.82" class="difflineplus">+      return PREF_VIDEO_SELECTED_APP;</span>
<a href="#l19.83"></a><span id="l19.83" class="difflineplus">+</span>
<a href="#l19.84"></a><span id="l19.84" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l19.85"></a><span id="l19.85" class="difflineplus">+      return PREF_AUDIO_SELECTED_APP;</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineplus">+</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineplus">+    default:</span>
<a href="#l19.88"></a><span id="l19.88" class="difflineplus">+      return PREF_SELECTED_APP;</span>
<a href="#l19.89"></a><span id="l19.89" class="difflineplus">+  }</span>
<a href="#l19.90"></a><span id="l19.90" class="difflineplus">+}</span>
<a href="#l19.91"></a><span id="l19.91" class="difflineplus">+</span>
<a href="#l19.92"></a><span id="l19.92" class="difflineplus">+function getPrefWebForType(t) {</span>
<a href="#l19.93"></a><span id="l19.93" class="difflineplus">+  switch (t) {</span>
<a href="#l19.94"></a><span id="l19.94" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l19.95"></a><span id="l19.95" class="difflineplus">+      return PREF_VIDEO_SELECTED_WEB;</span>
<a href="#l19.96"></a><span id="l19.96" class="difflineplus">+</span>
<a href="#l19.97"></a><span id="l19.97" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l19.98"></a><span id="l19.98" class="difflineplus">+      return PREF_AUDIO_SELECTED_WEB;</span>
<a href="#l19.99"></a><span id="l19.99" class="difflineplus">+</span>
<a href="#l19.100"></a><span id="l19.100" class="difflineplus">+    default:</span>
<a href="#l19.101"></a><span id="l19.101" class="difflineplus">+      return PREF_SELECTED_WEB;</span>
<a href="#l19.102"></a><span id="l19.102" class="difflineplus">+  }</span>
<a href="#l19.103"></a><span id="l19.103" class="difflineplus">+}</span>
<a href="#l19.104"></a><span id="l19.104" class="difflineplus">+</span>
<a href="#l19.105"></a><span id="l19.105" class="difflineplus">+function getPrefActionForType(t) {</span>
<a href="#l19.106"></a><span id="l19.106" class="difflineplus">+  switch (t) {</span>
<a href="#l19.107"></a><span id="l19.107" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l19.108"></a><span id="l19.108" class="difflineplus">+      return PREF_VIDEO_SELECTED_ACTION;</span>
<a href="#l19.109"></a><span id="l19.109" class="difflineplus">+</span>
<a href="#l19.110"></a><span id="l19.110" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l19.111"></a><span id="l19.111" class="difflineplus">+      return PREF_AUDIO_SELECTED_ACTION;</span>
<a href="#l19.112"></a><span id="l19.112" class="difflineplus">+</span>
<a href="#l19.113"></a><span id="l19.113" class="difflineplus">+    default:</span>
<a href="#l19.114"></a><span id="l19.114" class="difflineplus">+      return PREF_SELECTED_ACTION;</span>
<a href="#l19.115"></a><span id="l19.115" class="difflineplus">+  }</span>
<a href="#l19.116"></a><span id="l19.116" class="difflineplus">+}</span>
<a href="#l19.117"></a><span id="l19.117" class="difflineplus">+</span>
<a href="#l19.118"></a><span id="l19.118" class="difflineplus">+function getPrefReaderForType(t) {</span>
<a href="#l19.119"></a><span id="l19.119" class="difflineplus">+  switch (t) {</span>
<a href="#l19.120"></a><span id="l19.120" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l19.121"></a><span id="l19.121" class="difflineplus">+      return PREF_VIDEO_SELECTED_READER;</span>
<a href="#l19.122"></a><span id="l19.122" class="difflineplus">+</span>
<a href="#l19.123"></a><span id="l19.123" class="difflineplus">+    case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l19.124"></a><span id="l19.124" class="difflineplus">+      return PREF_AUDIO_SELECTED_READER;</span>
<a href="#l19.125"></a><span id="l19.125" class="difflineplus">+</span>
<a href="#l19.126"></a><span id="l19.126" class="difflineplus">+    default:</span>
<a href="#l19.127"></a><span id="l19.127" class="difflineplus">+      return PREF_SELECTED_READER;</span>
<a href="#l19.128"></a><span id="l19.128" class="difflineplus">+  }</span>
<a href="#l19.129"></a><span id="l19.129" class="difflineplus">+}</span>
<a href="#l19.130"></a><span id="l19.130" class="difflineplus">+</span>
<a href="#l19.131"></a><span id="l19.131" class="difflineplus">+function LOG(str) {</span>
<a href="#l19.132"></a><span id="l19.132" class="difflineplus">+  var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l19.133"></a><span id="l19.133" class="difflineplus">+                        .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l19.134"></a><span id="l19.134" class="difflineplus">+</span>
<a href="#l19.135"></a><span id="l19.135" class="difflineplus">+  try {</span>
<a href="#l19.136"></a><span id="l19.136" class="difflineplus">+    if (prefs.getBoolPref(&quot;feeds.log&quot;))</span>
<a href="#l19.137"></a><span id="l19.137" class="difflineplus">+      dump(&quot;*** Feeds: &quot; + str + &quot;\n&quot;);</span>
<a href="#l19.138"></a><span id="l19.138" class="difflineplus">+  }</span>
<a href="#l19.139"></a><span id="l19.139" class="difflineplus">+  catch (ex) {</span>
<a href="#l19.140"></a><span id="l19.140" class="difflineplus">+  }</span>
<a href="#l19.141"></a><span id="l19.141" class="difflineplus">+}</span>
<a href="#l19.142"></a><span id="l19.142" class="difflineplus">+</span>
<a href="#l19.143"></a><span id="l19.143" class="difflineplus">+function safeGetCharPref(pref, defaultValue) {</span>
<a href="#l19.144"></a><span id="l19.144" class="difflineplus">+  var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l19.145"></a><span id="l19.145" class="difflineplus">+                        .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l19.146"></a><span id="l19.146" class="difflineplus">+  try {</span>
<a href="#l19.147"></a><span id="l19.147" class="difflineplus">+    return prefs.getCharPref(pref);</span>
<a href="#l19.148"></a><span id="l19.148" class="difflineplus">+  }</span>
<a href="#l19.149"></a><span id="l19.149" class="difflineplus">+  catch (e) {</span>
<a href="#l19.150"></a><span id="l19.150" class="difflineplus">+  }</span>
<a href="#l19.151"></a><span id="l19.151" class="difflineplus">+  return defaultValue;</span>
<a href="#l19.152"></a><span id="l19.152" class="difflineplus">+}</span>
<a href="#l19.153"></a><span id="l19.153" class="difflineplus">+</span>
<a href="#l19.154"></a><span id="l19.154" class="difflineplus">+/**</span>
<a href="#l19.155"></a><span id="l19.155" class="difflineplus">+ * Wrapper function for nsIIOService::newURI.</span>
<a href="#l19.156"></a><span id="l19.156" class="difflineplus">+ * @param aURLSpec</span>
<a href="#l19.157"></a><span id="l19.157" class="difflineplus">+ *        The URL string from which to create an nsIURI.</span>
<a href="#l19.158"></a><span id="l19.158" class="difflineplus">+ * @returns an nsIURI object, or null if the creation of the URI failed.</span>
<a href="#l19.159"></a><span id="l19.159" class="difflineplus">+ */</span>
<a href="#l19.160"></a><span id="l19.160" class="difflineplus">+function makeURI(aURLSpec, aCharset) {</span>
<a href="#l19.161"></a><span id="l19.161" class="difflineplus">+  try {</span>
<a href="#l19.162"></a><span id="l19.162" class="difflineplus">+    var ioSvc = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l19.163"></a><span id="l19.163" class="difflineplus">+                          .getService(Components.interfaces.nsIIOService);</span>
<a href="#l19.164"></a><span id="l19.164" class="difflineplus">+    return ioSvc.newURI(aURLSpec, aCharset, null);</span>
<a href="#l19.165"></a><span id="l19.165" class="difflineplus">+  } catch (ex) {</span>
<a href="#l19.166"></a><span id="l19.166" class="difflineplus">+  }</span>
<a href="#l19.167"></a><span id="l19.167" class="difflineplus">+</span>
<a href="#l19.168"></a><span id="l19.168" class="difflineplus">+  return null;</span>
<a href="#l19.169"></a><span id="l19.169" class="difflineplus">+}</span>
<a href="#l19.170"></a><span id="l19.170" class="difflineplus">+</span>
<a href="#l19.171"></a><span id="l19.171" class="difflineplus">+/**</span>
<a href="#l19.172"></a><span id="l19.172" class="difflineplus">+ * Converts a number of bytes to the appropriate unit that results in a</span>
<a href="#l19.173"></a><span id="l19.173" class="difflineplus">+ * number that needs fewer than 4 digits</span>
<a href="#l19.174"></a><span id="l19.174" class="difflineplus">+ *</span>
<a href="#l19.175"></a><span id="l19.175" class="difflineplus">+ * @return a pair: [new value with 3 sig. figs., its unit]</span>
<a href="#l19.176"></a><span id="l19.176" class="difflineplus">+  */</span>
<a href="#l19.177"></a><span id="l19.177" class="difflineplus">+function convertByteUnits(aBytes) {</span>
<a href="#l19.178"></a><span id="l19.178" class="difflineplus">+  var units = [&quot;bytes&quot;, &quot;kilobytes&quot;, &quot;megabytes&quot;, &quot;gigabytes&quot;];</span>
<a href="#l19.179"></a><span id="l19.179" class="difflineplus">+  var unitIndex = 0;</span>
<a href="#l19.180"></a><span id="l19.180" class="difflineplus">+</span>
<a href="#l19.181"></a><span id="l19.181" class="difflineplus">+  // convert to next unit if it needs 4 digits (after rounding), but only if</span>
<a href="#l19.182"></a><span id="l19.182" class="difflineplus">+  // we know the name of the next unit</span>
<a href="#l19.183"></a><span id="l19.183" class="difflineplus">+  while ((aBytes &gt;= 999.5) &amp;&amp; (unitIndex &lt; units.length - 1)) {</span>
<a href="#l19.184"></a><span id="l19.184" class="difflineplus">+    aBytes /= 1024;</span>
<a href="#l19.185"></a><span id="l19.185" class="difflineplus">+    unitIndex++;</span>
<a href="#l19.186"></a><span id="l19.186" class="difflineplus">+  }</span>
<a href="#l19.187"></a><span id="l19.187" class="difflineplus">+</span>
<a href="#l19.188"></a><span id="l19.188" class="difflineplus">+  // Get rid of insignificant bits by truncating to 1 or 0 decimal points</span>
<a href="#l19.189"></a><span id="l19.189" class="difflineplus">+  // 0 -&gt; 0; 1.2 -&gt; 1.2; 12.3 -&gt; 12.3; 123.4 -&gt; 123; 234.5 -&gt; 235</span>
<a href="#l19.190"></a><span id="l19.190" class="difflineplus">+  aBytes = aBytes.toFixed((aBytes &gt; 0) &amp;&amp; (aBytes &lt; 100) ? 1 : 0);</span>
<a href="#l19.191"></a><span id="l19.191" class="difflineplus">+</span>
<a href="#l19.192"></a><span id="l19.192" class="difflineplus">+  return [aBytes, units[unitIndex]];</span>
<a href="#l19.193"></a><span id="l19.193" class="difflineplus">+}</span>
<a href="#l19.194"></a><span id="l19.194" class="difflineplus">+</span>
<a href="#l19.195"></a><span id="l19.195" class="difflineplus">+function FeedWriter() {</span>
<a href="#l19.196"></a><span id="l19.196" class="difflineplus">+  this._ioSvc = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l19.197"></a><span id="l19.197" class="difflineplus">+                          .getService(Components.interfaces.nsIIOService);</span>
<a href="#l19.198"></a><span id="l19.198" class="difflineplus">+  this._mimeSvc = Components.classes[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l19.199"></a><span id="l19.199" class="difflineplus">+                            .getService(Components.interfaces.nsIMIMEService);</span>
<a href="#l19.200"></a><span id="l19.200" class="difflineplus">+}</span>
<a href="#l19.201"></a><span id="l19.201" class="difflineplus">+</span>
<a href="#l19.202"></a><span id="l19.202" class="difflineplus">+FeedWriter.prototype = {</span>
<a href="#l19.203"></a><span id="l19.203" class="difflineplus">+  _getPropertyAsBag: function getPropertyAsBag(container, property) {</span>
<a href="#l19.204"></a><span id="l19.204" class="difflineplus">+    return container.fields.getProperty(property)</span>
<a href="#l19.205"></a><span id="l19.205" class="difflineplus">+                    .QueryInterface(Components.interfaces.nsIPropertyBag2);</span>
<a href="#l19.206"></a><span id="l19.206" class="difflineplus">+  },</span>
<a href="#l19.207"></a><span id="l19.207" class="difflineplus">+</span>
<a href="#l19.208"></a><span id="l19.208" class="difflineplus">+  _getPropertyAsString: function getPropertyAsString(container, property) {</span>
<a href="#l19.209"></a><span id="l19.209" class="difflineplus">+    try {</span>
<a href="#l19.210"></a><span id="l19.210" class="difflineplus">+      return container.fields.getPropertyAsAString(property);</span>
<a href="#l19.211"></a><span id="l19.211" class="difflineplus">+    }</span>
<a href="#l19.212"></a><span id="l19.212" class="difflineplus">+    catch (e) {</span>
<a href="#l19.213"></a><span id="l19.213" class="difflineplus">+    }</span>
<a href="#l19.214"></a><span id="l19.214" class="difflineplus">+    return &quot;&quot;;</span>
<a href="#l19.215"></a><span id="l19.215" class="difflineplus">+  },</span>
<a href="#l19.216"></a><span id="l19.216" class="difflineplus">+</span>
<a href="#l19.217"></a><span id="l19.217" class="difflineplus">+  _setContentText: function setContentText(id, text) {</span>
<a href="#l19.218"></a><span id="l19.218" class="difflineplus">+    this._contentSandbox.element = this._document.getElementById(id);</span>
<a href="#l19.219"></a><span id="l19.219" class="difflineplus">+    this._contentSandbox.textNode = this._document.createTextNode(text);</span>
<a href="#l19.220"></a><span id="l19.220" class="difflineplus">+    var codeStr = &quot;while (element.hasChildNodes()) &quot; +</span>
<a href="#l19.221"></a><span id="l19.221" class="difflineplus">+                  &quot;  element.removeChild(element.firstChild);&quot; +</span>
<a href="#l19.222"></a><span id="l19.222" class="difflineplus">+                  &quot;element.appendChild(textNode);&quot;;</span>
<a href="#l19.223"></a><span id="l19.223" class="difflineplus">+    Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.224"></a><span id="l19.224" class="difflineplus">+    this._contentSandbox.element = null;</span>
<a href="#l19.225"></a><span id="l19.225" class="difflineplus">+    this._contentSandbox.textNode = null;</span>
<a href="#l19.226"></a><span id="l19.226" class="difflineplus">+  },</span>
<a href="#l19.227"></a><span id="l19.227" class="difflineplus">+</span>
<a href="#l19.228"></a><span id="l19.228" class="difflineplus">+  /**</span>
<a href="#l19.229"></a><span id="l19.229" class="difflineplus">+   * Safely sets the href attribute on an anchor tag, providing the URI</span>
<a href="#l19.230"></a><span id="l19.230" class="difflineplus">+   * specified can be loaded according to rules.</span>
<a href="#l19.231"></a><span id="l19.231" class="difflineplus">+   * @param   element</span>
<a href="#l19.232"></a><span id="l19.232" class="difflineplus">+   *          The element to set a URI attribute on</span>
<a href="#l19.233"></a><span id="l19.233" class="difflineplus">+   * @param   attribute</span>
<a href="#l19.234"></a><span id="l19.234" class="difflineplus">+   *          The attribute of the element to set the URI to, e.g. href or src</span>
<a href="#l19.235"></a><span id="l19.235" class="difflineplus">+   * @param   uri</span>
<a href="#l19.236"></a><span id="l19.236" class="difflineplus">+   *          The URI spec to set as the href</span>
<a href="#l19.237"></a><span id="l19.237" class="difflineplus">+   */</span>
<a href="#l19.238"></a><span id="l19.238" class="difflineplus">+  _safeSetURIAttribute: function safeSetURIAttribute(element, attribute, uri) {</span>
<a href="#l19.239"></a><span id="l19.239" class="difflineplus">+    var secman = Components.classes[&quot;@mozilla.org/scriptsecuritymanager;1&quot;]</span>
<a href="#l19.240"></a><span id="l19.240" class="difflineplus">+                           .getService(Components.interfaces.nsIScriptSecurityManager);</span>
<a href="#l19.241"></a><span id="l19.241" class="difflineplus">+    const flags = Components.interfaces.nsIScriptSecurityManager.DISALLOW_INHERIT_PRINCIPAL;</span>
<a href="#l19.242"></a><span id="l19.242" class="difflineplus">+    try {</span>
<a href="#l19.243"></a><span id="l19.243" class="difflineplus">+      secman.checkLoadURIStrWithPrincipal(this._feedPrincipal, uri, flags);</span>
<a href="#l19.244"></a><span id="l19.244" class="difflineplus">+      // checkLoadURIStrWithPrincipal will throw if the link URI should not be</span>
<a href="#l19.245"></a><span id="l19.245" class="difflineplus">+      // loaded, either because our feedURI isn't allowed to load it or per</span>
<a href="#l19.246"></a><span id="l19.246" class="difflineplus">+      // the rules specified in |flags|, so we'll never &quot;linkify&quot; the link...</span>
<a href="#l19.247"></a><span id="l19.247" class="difflineplus">+      this._contentSandbox.element = element;</span>
<a href="#l19.248"></a><span id="l19.248" class="difflineplus">+      this._contentSandbox.uri = uri;</span>
<a href="#l19.249"></a><span id="l19.249" class="difflineplus">+      var codeStr = &quot;element.setAttribute('&quot; + attribute + &quot;', uri);&quot;;</span>
<a href="#l19.250"></a><span id="l19.250" class="difflineplus">+      Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.251"></a><span id="l19.251" class="difflineplus">+    }</span>
<a href="#l19.252"></a><span id="l19.252" class="difflineplus">+    catch (e) {</span>
<a href="#l19.253"></a><span id="l19.253" class="difflineplus">+      // Not allowed to load this link because secman.checkLoadURIStr threw</span>
<a href="#l19.254"></a><span id="l19.254" class="difflineplus">+    }</span>
<a href="#l19.255"></a><span id="l19.255" class="difflineplus">+  },</span>
<a href="#l19.256"></a><span id="l19.256" class="difflineplus">+</span>
<a href="#l19.257"></a><span id="l19.257" class="difflineplus">+  /**</span>
<a href="#l19.258"></a><span id="l19.258" class="difflineplus">+   * Use this sandbox to run any dom manipulation code on nodes which</span>
<a href="#l19.259"></a><span id="l19.259" class="difflineplus">+   * are already inserted into the content document.</span>
<a href="#l19.260"></a><span id="l19.260" class="difflineplus">+   */</span>
<a href="#l19.261"></a><span id="l19.261" class="difflineplus">+  __contentSandbox: null,</span>
<a href="#l19.262"></a><span id="l19.262" class="difflineplus">+  get _contentSandbox() {</span>
<a href="#l19.263"></a><span id="l19.263" class="difflineplus">+    if (!this.__contentSandbox)</span>
<a href="#l19.264"></a><span id="l19.264" class="difflineplus">+      this.__contentSandbox = new Components.utils.Sandbox(this._window);</span>
<a href="#l19.265"></a><span id="l19.265" class="difflineplus">+</span>
<a href="#l19.266"></a><span id="l19.266" class="difflineplus">+    return this.__contentSandbox;</span>
<a href="#l19.267"></a><span id="l19.267" class="difflineplus">+  },</span>
<a href="#l19.268"></a><span id="l19.268" class="difflineplus">+</span>
<a href="#l19.269"></a><span id="l19.269" class="difflineplus">+  /**</span>
<a href="#l19.270"></a><span id="l19.270" class="difflineplus">+   * Calls doCommand for a the given XUL element within the context of the</span>
<a href="#l19.271"></a><span id="l19.271" class="difflineplus">+   * content document.</span>
<a href="#l19.272"></a><span id="l19.272" class="difflineplus">+   *</span>
<a href="#l19.273"></a><span id="l19.273" class="difflineplus">+   * @param aElement</span>
<a href="#l19.274"></a><span id="l19.274" class="difflineplus">+   *        the XUL element to call doCommand() on.</span>
<a href="#l19.275"></a><span id="l19.275" class="difflineplus">+   */</span>
<a href="#l19.276"></a><span id="l19.276" class="difflineplus">+  _safeDoCommand: function safeDoCommand(aElement) {</span>
<a href="#l19.277"></a><span id="l19.277" class="difflineplus">+    this._contentSandbox.element = aElement;</span>
<a href="#l19.278"></a><span id="l19.278" class="difflineplus">+    Components.utils.evalInSandbox(&quot;element.doCommand();&quot;, this._contentSandbox);</span>
<a href="#l19.279"></a><span id="l19.279" class="difflineplus">+    this._contentSandbox.element = null;</span>
<a href="#l19.280"></a><span id="l19.280" class="difflineplus">+  },</span>
<a href="#l19.281"></a><span id="l19.281" class="difflineplus">+</span>
<a href="#l19.282"></a><span id="l19.282" class="difflineplus">+  __faviconService: null,</span>
<a href="#l19.283"></a><span id="l19.283" class="difflineplus">+  get _faviconService() {</span>
<a href="#l19.284"></a><span id="l19.284" class="difflineplus">+    if (!this.__faviconService)</span>
<a href="#l19.285"></a><span id="l19.285" class="difflineplus">+      this.__faviconService = Components.classes[&quot;@mozilla.org/browser/favicon-service;1&quot;]</span>
<a href="#l19.286"></a><span id="l19.286" class="difflineplus">+                                        .getService(Components.interfaces.nsIFaviconService);</span>
<a href="#l19.287"></a><span id="l19.287" class="difflineplus">+</span>
<a href="#l19.288"></a><span id="l19.288" class="difflineplus">+    return this.__faviconService;</span>
<a href="#l19.289"></a><span id="l19.289" class="difflineplus">+  },</span>
<a href="#l19.290"></a><span id="l19.290" class="difflineplus">+</span>
<a href="#l19.291"></a><span id="l19.291" class="difflineplus">+  __bundle: null,</span>
<a href="#l19.292"></a><span id="l19.292" class="difflineplus">+  get _bundle() {</span>
<a href="#l19.293"></a><span id="l19.293" class="difflineplus">+    if (!this.__bundle) {</span>
<a href="#l19.294"></a><span id="l19.294" class="difflineplus">+      this.__bundle = Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l19.295"></a><span id="l19.295" class="difflineplus">+                                .getService(Components.interfaces.nsIStringBundleService)</span>
<a href="#l19.296"></a><span id="l19.296" class="difflineplus">+                                .createBundle(STRING_BUNDLE_URI);</span>
<a href="#l19.297"></a><span id="l19.297" class="difflineplus">+    }</span>
<a href="#l19.298"></a><span id="l19.298" class="difflineplus">+</span>
<a href="#l19.299"></a><span id="l19.299" class="difflineplus">+    return this.__bundle;</span>
<a href="#l19.300"></a><span id="l19.300" class="difflineplus">+  },</span>
<a href="#l19.301"></a><span id="l19.301" class="difflineplus">+</span>
<a href="#l19.302"></a><span id="l19.302" class="difflineplus">+  _getFormattedString: function getFormattedString(key, params) {</span>
<a href="#l19.303"></a><span id="l19.303" class="difflineplus">+    return this._bundle.formatStringFromName(key, params, params.length);</span>
<a href="#l19.304"></a><span id="l19.304" class="difflineplus">+  },</span>
<a href="#l19.305"></a><span id="l19.305" class="difflineplus">+</span>
<a href="#l19.306"></a><span id="l19.306" class="difflineplus">+  _getString: function getString(key) {</span>
<a href="#l19.307"></a><span id="l19.307" class="difflineplus">+    try {</span>
<a href="#l19.308"></a><span id="l19.308" class="difflineplus">+      return this._bundle.GetStringFromName(key);</span>
<a href="#l19.309"></a><span id="l19.309" class="difflineplus">+    } catch(e) {</span>
<a href="#l19.310"></a><span id="l19.310" class="difflineplus">+      LOG(&quot;Couldn't retrieve key from bundle&quot;);</span>
<a href="#l19.311"></a><span id="l19.311" class="difflineplus">+    }</span>
<a href="#l19.312"></a><span id="l19.312" class="difflineplus">+</span>
<a href="#l19.313"></a><span id="l19.313" class="difflineplus">+    return null;</span>
<a href="#l19.314"></a><span id="l19.314" class="difflineplus">+  },</span>
<a href="#l19.315"></a><span id="l19.315" class="difflineplus">+</span>
<a href="#l19.316"></a><span id="l19.316" class="difflineplus">+  /* Magic helper methods to be used instead of xbl properties */</span>
<a href="#l19.317"></a><span id="l19.317" class="difflineplus">+  _getSelectedItemFromMenulist: function getSelectedItemFromList(aList) {</span>
<a href="#l19.318"></a><span id="l19.318" class="difflineplus">+    return aList.getElementsByAttribute(&quot;selected&quot;, &quot;true&quot;).item(0);</span>
<a href="#l19.319"></a><span id="l19.319" class="difflineplus">+  },</span>
<a href="#l19.320"></a><span id="l19.320" class="difflineplus">+</span>
<a href="#l19.321"></a><span id="l19.321" class="difflineplus">+  _setCheckboxCheckedState: function setCheckboxCheckedState(aCheckbox, aValue) {</span>
<a href="#l19.322"></a><span id="l19.322" class="difflineplus">+    // see checkbox.xml, xbl bindings are not applied within the sandbox!</span>
<a href="#l19.323"></a><span id="l19.323" class="difflineplus">+    this._contentSandbox.checkbox = aCheckbox;</span>
<a href="#l19.324"></a><span id="l19.324" class="difflineplus">+    var codeStr;</span>
<a href="#l19.325"></a><span id="l19.325" class="difflineplus">+    var change = (aValue != (aCheckbox.getAttribute('checked') == 'true'));</span>
<a href="#l19.326"></a><span id="l19.326" class="difflineplus">+    if (aValue)</span>
<a href="#l19.327"></a><span id="l19.327" class="difflineplus">+      codeStr = &quot;checkbox.setAttribute('checked', 'true'); &quot;;</span>
<a href="#l19.328"></a><span id="l19.328" class="difflineplus">+    else</span>
<a href="#l19.329"></a><span id="l19.329" class="difflineplus">+      codeStr = &quot;checkbox.removeAttribute('checked'); &quot;;</span>
<a href="#l19.330"></a><span id="l19.330" class="difflineplus">+</span>
<a href="#l19.331"></a><span id="l19.331" class="difflineplus">+    if (change) {</span>
<a href="#l19.332"></a><span id="l19.332" class="difflineplus">+      this._contentSandbox.document = this._document;</span>
<a href="#l19.333"></a><span id="l19.333" class="difflineplus">+      codeStr += &quot;var event = document.createEvent('Events'); &quot; +</span>
<a href="#l19.334"></a><span id="l19.334" class="difflineplus">+                 &quot;event.initEvent('CheckboxStateChange', true, true);&quot; +</span>
<a href="#l19.335"></a><span id="l19.335" class="difflineplus">+                 &quot;checkbox.dispatchEvent(event);&quot;;</span>
<a href="#l19.336"></a><span id="l19.336" class="difflineplus">+    }</span>
<a href="#l19.337"></a><span id="l19.337" class="difflineplus">+</span>
<a href="#l19.338"></a><span id="l19.338" class="difflineplus">+    Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.339"></a><span id="l19.339" class="difflineplus">+  },</span>
<a href="#l19.340"></a><span id="l19.340" class="difflineplus">+</span>
<a href="#l19.341"></a><span id="l19.341" class="difflineplus">+   /**</span>
<a href="#l19.342"></a><span id="l19.342" class="difflineplus">+   * Returns a date suitable for displaying in the feed preview.</span>
<a href="#l19.343"></a><span id="l19.343" class="difflineplus">+   * If the date cannot be parsed, the return value is &quot;null&quot;.</span>
<a href="#l19.344"></a><span id="l19.344" class="difflineplus">+   * @param   dateString</span>
<a href="#l19.345"></a><span id="l19.345" class="difflineplus">+   *          A date as extracted from a feed entry. (entry.updated)</span>
<a href="#l19.346"></a><span id="l19.346" class="difflineplus">+   */</span>
<a href="#l19.347"></a><span id="l19.347" class="difflineplus">+  _parseDate: function parseDate(dateString) {</span>
<a href="#l19.348"></a><span id="l19.348" class="difflineplus">+    // Convert the date into the user's local time zone</span>
<a href="#l19.349"></a><span id="l19.349" class="difflineplus">+    var dateObj = new Date(dateString);</span>
<a href="#l19.350"></a><span id="l19.350" class="difflineplus">+</span>
<a href="#l19.351"></a><span id="l19.351" class="difflineplus">+    // Make sure the date we're given is valid.</span>
<a href="#l19.352"></a><span id="l19.352" class="difflineplus">+    if (isNaN(dateObj.getTime()))</span>
<a href="#l19.353"></a><span id="l19.353" class="difflineplus">+      return null;</span>
<a href="#l19.354"></a><span id="l19.354" class="difflineplus">+</span>
<a href="#l19.355"></a><span id="l19.355" class="difflineplus">+    var dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l19.356"></a><span id="l19.356" class="difflineplus">+                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l19.357"></a><span id="l19.357" class="difflineplus">+    return dateService.FormatDateTime(&quot;&quot;, dateService.dateFormatLong, dateService.timeFormatNoSeconds,</span>
<a href="#l19.358"></a><span id="l19.358" class="difflineplus">+                                      dateObj.getFullYear(), dateObj.getMonth()+1, dateObj.getDate(),</span>
<a href="#l19.359"></a><span id="l19.359" class="difflineplus">+                                      dateObj.getHours(), dateObj.getMinutes(), dateObj.getSeconds());</span>
<a href="#l19.360"></a><span id="l19.360" class="difflineplus">+  },</span>
<a href="#l19.361"></a><span id="l19.361" class="difflineplus">+</span>
<a href="#l19.362"></a><span id="l19.362" class="difflineplus">+  /**</span>
<a href="#l19.363"></a><span id="l19.363" class="difflineplus">+   * Returns the feed type.</span>
<a href="#l19.364"></a><span id="l19.364" class="difflineplus">+   */</span>
<a href="#l19.365"></a><span id="l19.365" class="difflineplus">+  __feedType: null,</span>
<a href="#l19.366"></a><span id="l19.366" class="difflineplus">+  _getFeedType: function getFeedType() {</span>
<a href="#l19.367"></a><span id="l19.367" class="difflineplus">+    if (this.__feedType != null)</span>
<a href="#l19.368"></a><span id="l19.368" class="difflineplus">+      return this.__feedType;</span>
<a href="#l19.369"></a><span id="l19.369" class="difflineplus">+</span>
<a href="#l19.370"></a><span id="l19.370" class="difflineplus">+    try {</span>
<a href="#l19.371"></a><span id="l19.371" class="difflineplus">+      // grab the feed because it's got the feed.type in it.</span>
<a href="#l19.372"></a><span id="l19.372" class="difflineplus">+      var container = this._getContainer();</span>
<a href="#l19.373"></a><span id="l19.373" class="difflineplus">+      var feed = container.QueryInterface(Components.interfaces.nsIFeed);</span>
<a href="#l19.374"></a><span id="l19.374" class="difflineplus">+      this.__feedType = feed.type;</span>
<a href="#l19.375"></a><span id="l19.375" class="difflineplus">+      return feed.type;</span>
<a href="#l19.376"></a><span id="l19.376" class="difflineplus">+    } catch (ex) {</span>
<a href="#l19.377"></a><span id="l19.377" class="difflineplus">+    }</span>
<a href="#l19.378"></a><span id="l19.378" class="difflineplus">+</span>
<a href="#l19.379"></a><span id="l19.379" class="difflineplus">+    return Components.interfaces.nsIFeed.TYPE_FEED;</span>
<a href="#l19.380"></a><span id="l19.380" class="difflineplus">+  },</span>
<a href="#l19.381"></a><span id="l19.381" class="difflineplus">+</span>
<a href="#l19.382"></a><span id="l19.382" class="difflineplus">+  /**</span>
<a href="#l19.383"></a><span id="l19.383" class="difflineplus">+   * Maps a feed type to a maybe-feed mimetype.</span>
<a href="#l19.384"></a><span id="l19.384" class="difflineplus">+   */</span>
<a href="#l19.385"></a><span id="l19.385" class="difflineplus">+  _getMimeTypeForFeedType: function getMimeTypeForFeedType() {</span>
<a href="#l19.386"></a><span id="l19.386" class="difflineplus">+    switch (this._getFeedType()) {</span>
<a href="#l19.387"></a><span id="l19.387" class="difflineplus">+      case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l19.388"></a><span id="l19.388" class="difflineplus">+        return TYPE_MAYBE_VIDEO_FEED;</span>
<a href="#l19.389"></a><span id="l19.389" class="difflineplus">+</span>
<a href="#l19.390"></a><span id="l19.390" class="difflineplus">+      case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l19.391"></a><span id="l19.391" class="difflineplus">+        return TYPE_MAYBE_AUDIO_FEED;</span>
<a href="#l19.392"></a><span id="l19.392" class="difflineplus">+</span>
<a href="#l19.393"></a><span id="l19.393" class="difflineplus">+      default:</span>
<a href="#l19.394"></a><span id="l19.394" class="difflineplus">+        return TYPE_MAYBE_FEED;</span>
<a href="#l19.395"></a><span id="l19.395" class="difflineplus">+    }</span>
<a href="#l19.396"></a><span id="l19.396" class="difflineplus">+  },</span>
<a href="#l19.397"></a><span id="l19.397" class="difflineplus">+</span>
<a href="#l19.398"></a><span id="l19.398" class="difflineplus">+  /**</span>
<a href="#l19.399"></a><span id="l19.399" class="difflineplus">+   * Writes the feed title into the preview document.</span>
<a href="#l19.400"></a><span id="l19.400" class="difflineplus">+   * @param   container</span>
<a href="#l19.401"></a><span id="l19.401" class="difflineplus">+   *          The feed container</span>
<a href="#l19.402"></a><span id="l19.402" class="difflineplus">+   */</span>
<a href="#l19.403"></a><span id="l19.403" class="difflineplus">+  _setTitleText: function setTitleText(container) {</span>
<a href="#l19.404"></a><span id="l19.404" class="difflineplus">+    if (container.title) {</span>
<a href="#l19.405"></a><span id="l19.405" class="difflineplus">+      var title = container.title.plainText();</span>
<a href="#l19.406"></a><span id="l19.406" class="difflineplus">+      this._setContentText(TITLE_ID, title);</span>
<a href="#l19.407"></a><span id="l19.407" class="difflineplus">+      this._contentSandbox.document = this._document;</span>
<a href="#l19.408"></a><span id="l19.408" class="difflineplus">+      this._contentSandbox.title = title;</span>
<a href="#l19.409"></a><span id="l19.409" class="difflineplus">+      var codeStr = &quot;document.title = title;&quot;</span>
<a href="#l19.410"></a><span id="l19.410" class="difflineplus">+      Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.411"></a><span id="l19.411" class="difflineplus">+    }</span>
<a href="#l19.412"></a><span id="l19.412" class="difflineplus">+</span>
<a href="#l19.413"></a><span id="l19.413" class="difflineplus">+    var feed = container.QueryInterface(Components.interfaces.nsIFeed);</span>
<a href="#l19.414"></a><span id="l19.414" class="difflineplus">+    if (feed &amp;&amp; feed.subtitle)</span>
<a href="#l19.415"></a><span id="l19.415" class="difflineplus">+      this._setContentText(SUBTITLE_ID, container.subtitle.plainText());</span>
<a href="#l19.416"></a><span id="l19.416" class="difflineplus">+  },</span>
<a href="#l19.417"></a><span id="l19.417" class="difflineplus">+</span>
<a href="#l19.418"></a><span id="l19.418" class="difflineplus">+  /**</span>
<a href="#l19.419"></a><span id="l19.419" class="difflineplus">+   * Writes the title image into the preview document if one is present.</span>
<a href="#l19.420"></a><span id="l19.420" class="difflineplus">+   * @param   container</span>
<a href="#l19.421"></a><span id="l19.421" class="difflineplus">+   *          The feed container</span>
<a href="#l19.422"></a><span id="l19.422" class="difflineplus">+   */</span>
<a href="#l19.423"></a><span id="l19.423" class="difflineplus">+  _setTitleImage: function setTitleImage(container) {</span>
<a href="#l19.424"></a><span id="l19.424" class="difflineplus">+    try {</span>
<a href="#l19.425"></a><span id="l19.425" class="difflineplus">+      var parts = container.image;</span>
<a href="#l19.426"></a><span id="l19.426" class="difflineplus">+</span>
<a href="#l19.427"></a><span id="l19.427" class="difflineplus">+      // Set up the title image (supplied by the feed)</span>
<a href="#l19.428"></a><span id="l19.428" class="difflineplus">+      var feedTitleImage = this._document.getElementById(&quot;feedTitleImage&quot;);</span>
<a href="#l19.429"></a><span id="l19.429" class="difflineplus">+      this._safeSetURIAttribute(feedTitleImage, &quot;src&quot;,</span>
<a href="#l19.430"></a><span id="l19.430" class="difflineplus">+                                parts.getPropertyAsAString(&quot;url&quot;));</span>
<a href="#l19.431"></a><span id="l19.431" class="difflineplus">+</span>
<a href="#l19.432"></a><span id="l19.432" class="difflineplus">+      // Set up the title image link</span>
<a href="#l19.433"></a><span id="l19.433" class="difflineplus">+      var feedTitleLink = this._document.getElementById(&quot;feedTitleLink&quot;);</span>
<a href="#l19.434"></a><span id="l19.434" class="difflineplus">+</span>
<a href="#l19.435"></a><span id="l19.435" class="difflineplus">+      var titleText = this._getFormattedString(&quot;linkTitleTextFormat&quot;,</span>
<a href="#l19.436"></a><span id="l19.436" class="difflineplus">+                                               [parts.getPropertyAsAString(&quot;title&quot;)]);</span>
<a href="#l19.437"></a><span id="l19.437" class="difflineplus">+      this._contentSandbox.feedTitleLink = feedTitleLink;</span>
<a href="#l19.438"></a><span id="l19.438" class="difflineplus">+      this._contentSandbox.titleText = titleText;</span>
<a href="#l19.439"></a><span id="l19.439" class="difflineplus">+      this._contentSandbox.feedTitleText = this._document.getElementById(&quot;feedTitleText&quot;);</span>
<a href="#l19.440"></a><span id="l19.440" class="difflineplus">+      this._contentSandbox.titleImageWidth = parseInt(parts.getPropertyAsAString(&quot;width&quot;)) + 15;</span>
<a href="#l19.441"></a><span id="l19.441" class="difflineplus">+</span>
<a href="#l19.442"></a><span id="l19.442" class="difflineplus">+      // Fix the margin on the main title, so that the image doesn't run over</span>
<a href="#l19.443"></a><span id="l19.443" class="difflineplus">+      // the underline</span>
<a href="#l19.444"></a><span id="l19.444" class="difflineplus">+      var codeStr = &quot;feedTitleLink.setAttribute('title', titleText); &quot; +</span>
<a href="#l19.445"></a><span id="l19.445" class="difflineplus">+                    &quot;feedTitleText.style.MozMarginEnd = titleImageWidth + 'px';&quot;;</span>
<a href="#l19.446"></a><span id="l19.446" class="difflineplus">+      Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.447"></a><span id="l19.447" class="difflineplus">+      this._contentSandbox.feedTitleLink = null;</span>
<a href="#l19.448"></a><span id="l19.448" class="difflineplus">+      this._contentSandbox.titleText = null;</span>
<a href="#l19.449"></a><span id="l19.449" class="difflineplus">+      this._contentSandbox.feedTitleText = null;</span>
<a href="#l19.450"></a><span id="l19.450" class="difflineplus">+      this._contentSandbox.titleImageWidth = null;</span>
<a href="#l19.451"></a><span id="l19.451" class="difflineplus">+</span>
<a href="#l19.452"></a><span id="l19.452" class="difflineplus">+      this._safeSetURIAttribute(feedTitleLink, &quot;href&quot;,</span>
<a href="#l19.453"></a><span id="l19.453" class="difflineplus">+                                parts.getPropertyAsAString(&quot;link&quot;));</span>
<a href="#l19.454"></a><span id="l19.454" class="difflineplus">+    }</span>
<a href="#l19.455"></a><span id="l19.455" class="difflineplus">+    catch (e) {</span>
<a href="#l19.456"></a><span id="l19.456" class="difflineplus">+      LOG(&quot;Failed to set Title Image (this is benign): &quot; + e);</span>
<a href="#l19.457"></a><span id="l19.457" class="difflineplus">+    }</span>
<a href="#l19.458"></a><span id="l19.458" class="difflineplus">+  },</span>
<a href="#l19.459"></a><span id="l19.459" class="difflineplus">+</span>
<a href="#l19.460"></a><span id="l19.460" class="difflineplus">+  /**</span>
<a href="#l19.461"></a><span id="l19.461" class="difflineplus">+   * Writes all entries contained in the feed.</span>
<a href="#l19.462"></a><span id="l19.462" class="difflineplus">+   * @param   container</span>
<a href="#l19.463"></a><span id="l19.463" class="difflineplus">+   *          The container of entries in the feed</span>
<a href="#l19.464"></a><span id="l19.464" class="difflineplus">+   */</span>
<a href="#l19.465"></a><span id="l19.465" class="difflineplus">+  _writeFeedContent: function writeFeedContent(container) {</span>
<a href="#l19.466"></a><span id="l19.466" class="difflineplus">+    // Build the actual feed content</span>
<a href="#l19.467"></a><span id="l19.467" class="difflineplus">+    var feed = container.QueryInterface(Components.interfaces.nsIFeed);</span>
<a href="#l19.468"></a><span id="l19.468" class="difflineplus">+    if (feed.items.length == 0)</span>
<a href="#l19.469"></a><span id="l19.469" class="difflineplus">+      return;</span>
<a href="#l19.470"></a><span id="l19.470" class="difflineplus">+</span>
<a href="#l19.471"></a><span id="l19.471" class="difflineplus">+    this._contentSandbox.feedContent =</span>
<a href="#l19.472"></a><span id="l19.472" class="difflineplus">+      this._document.getElementById(&quot;feedContent&quot;);</span>
<a href="#l19.473"></a><span id="l19.473" class="difflineplus">+</span>
<a href="#l19.474"></a><span id="l19.474" class="difflineplus">+    for (let i = 0; i &lt; feed.items.length; ++i) {</span>
<a href="#l19.475"></a><span id="l19.475" class="difflineplus">+      let entry = feed.items.queryElementAt(i, Components.interfaces.nsIFeedEntry);</span>
<a href="#l19.476"></a><span id="l19.476" class="difflineplus">+      entry.QueryInterface(Components.interfaces.nsIFeedContainer);</span>
<a href="#l19.477"></a><span id="l19.477" class="difflineplus">+</span>
<a href="#l19.478"></a><span id="l19.478" class="difflineplus">+      let entryContainer = this._document.createElementNS(HTML_NS, &quot;div&quot;);</span>
<a href="#l19.479"></a><span id="l19.479" class="difflineplus">+      entryContainer.className = &quot;entry&quot;;</span>
<a href="#l19.480"></a><span id="l19.480" class="difflineplus">+</span>
<a href="#l19.481"></a><span id="l19.481" class="difflineplus">+      // If the entry has a title, make it a link</span>
<a href="#l19.482"></a><span id="l19.482" class="difflineplus">+      if (entry.title) {</span>
<a href="#l19.483"></a><span id="l19.483" class="difflineplus">+        let a = this._document.createElementNS(HTML_NS, &quot;a&quot;);</span>
<a href="#l19.484"></a><span id="l19.484" class="difflineplus">+        a.appendChild(this._document.createTextNode(entry.title.plainText()));</span>
<a href="#l19.485"></a><span id="l19.485" class="difflineplus">+</span>
<a href="#l19.486"></a><span id="l19.486" class="difflineplus">+        // Entries are not required to have links, so entry.link can be null.</span>
<a href="#l19.487"></a><span id="l19.487" class="difflineplus">+        if (entry.link)</span>
<a href="#l19.488"></a><span id="l19.488" class="difflineplus">+          this._safeSetURIAttribute(a, &quot;href&quot;, entry.link.spec);</span>
<a href="#l19.489"></a><span id="l19.489" class="difflineplus">+</span>
<a href="#l19.490"></a><span id="l19.490" class="difflineplus">+        let title = this._document.createElementNS(HTML_NS, &quot;h3&quot;);</span>
<a href="#l19.491"></a><span id="l19.491" class="difflineplus">+        title.appendChild(a);</span>
<a href="#l19.492"></a><span id="l19.492" class="difflineplus">+</span>
<a href="#l19.493"></a><span id="l19.493" class="difflineplus">+        let lastUpdated = this._parseDate(entry.updated);</span>
<a href="#l19.494"></a><span id="l19.494" class="difflineplus">+        if (lastUpdated) {</span>
<a href="#l19.495"></a><span id="l19.495" class="difflineplus">+          let dateDiv = this._document.createElementNS(HTML_NS, &quot;div&quot;);</span>
<a href="#l19.496"></a><span id="l19.496" class="difflineplus">+          dateDiv.className = &quot;lastUpdated&quot;;</span>
<a href="#l19.497"></a><span id="l19.497" class="difflineplus">+          dateDiv.textContent = lastUpdated;</span>
<a href="#l19.498"></a><span id="l19.498" class="difflineplus">+          title.appendChild(dateDiv);</span>
<a href="#l19.499"></a><span id="l19.499" class="difflineplus">+        }</span>
<a href="#l19.500"></a><span id="l19.500" class="difflineplus">+</span>
<a href="#l19.501"></a><span id="l19.501" class="difflineplus">+        entryContainer.appendChild(title);</span>
<a href="#l19.502"></a><span id="l19.502" class="difflineplus">+      }</span>
<a href="#l19.503"></a><span id="l19.503" class="difflineplus">+</span>
<a href="#l19.504"></a><span id="l19.504" class="difflineplus">+      var body = this._document.createElementNS(HTML_NS, &quot;div&quot;);</span>
<a href="#l19.505"></a><span id="l19.505" class="difflineplus">+      var summary = entry.summary || entry.content;</span>
<a href="#l19.506"></a><span id="l19.506" class="difflineplus">+      var docFragment = null;</span>
<a href="#l19.507"></a><span id="l19.507" class="difflineplus">+      if (summary) {</span>
<a href="#l19.508"></a><span id="l19.508" class="difflineplus">+        if (summary.base)</span>
<a href="#l19.509"></a><span id="l19.509" class="difflineplus">+          body.setAttributeNS(XML_NS, &quot;base&quot;, summary.base.spec);</span>
<a href="#l19.510"></a><span id="l19.510" class="difflineplus">+        else</span>
<a href="#l19.511"></a><span id="l19.511" class="difflineplus">+          LOG(&quot;no base?&quot;);</span>
<a href="#l19.512"></a><span id="l19.512" class="difflineplus">+        docFragment = summary.createDocumentFragment(body);</span>
<a href="#l19.513"></a><span id="l19.513" class="difflineplus">+        if (docFragment)</span>
<a href="#l19.514"></a><span id="l19.514" class="difflineplus">+          body.appendChild(docFragment);</span>
<a href="#l19.515"></a><span id="l19.515" class="difflineplus">+</span>
<a href="#l19.516"></a><span id="l19.516" class="difflineplus">+        // If the entry doesn't have a title, append a # permalink</span>
<a href="#l19.517"></a><span id="l19.517" class="difflineplus">+        // See http://scripting.com/rss.xml for an example</span>
<a href="#l19.518"></a><span id="l19.518" class="difflineplus">+        if (!entry.title &amp;&amp; entry.link) {</span>
<a href="#l19.519"></a><span id="l19.519" class="difflineplus">+          var a = this._document.createElementNS(HTML_NS, &quot;a&quot;);</span>
<a href="#l19.520"></a><span id="l19.520" class="difflineplus">+          a.appendChild(this._document.createTextNode(&quot;#&quot;));</span>
<a href="#l19.521"></a><span id="l19.521" class="difflineplus">+          this._safeSetURIAttribute(a, &quot;href&quot;, entry.link.spec);</span>
<a href="#l19.522"></a><span id="l19.522" class="difflineplus">+          body.appendChild(this._document.createTextNode(&quot; &quot;));</span>
<a href="#l19.523"></a><span id="l19.523" class="difflineplus">+          body.appendChild(a);</span>
<a href="#l19.524"></a><span id="l19.524" class="difflineplus">+        }</span>
<a href="#l19.525"></a><span id="l19.525" class="difflineplus">+</span>
<a href="#l19.526"></a><span id="l19.526" class="difflineplus">+      }</span>
<a href="#l19.527"></a><span id="l19.527" class="difflineplus">+      body.className = &quot;feedEntryContent&quot;;</span>
<a href="#l19.528"></a><span id="l19.528" class="difflineplus">+      entryContainer.appendChild(body);</span>
<a href="#l19.529"></a><span id="l19.529" class="difflineplus">+</span>
<a href="#l19.530"></a><span id="l19.530" class="difflineplus">+      if (entry.enclosures &amp;&amp; entry.enclosures.length &gt; 0) {</span>
<a href="#l19.531"></a><span id="l19.531" class="difflineplus">+        var enclosuresDiv = this._buildEnclosureDiv(entry);</span>
<a href="#l19.532"></a><span id="l19.532" class="difflineplus">+        entryContainer.appendChild(enclosuresDiv);</span>
<a href="#l19.533"></a><span id="l19.533" class="difflineplus">+      }</span>
<a href="#l19.534"></a><span id="l19.534" class="difflineplus">+</span>
<a href="#l19.535"></a><span id="l19.535" class="difflineplus">+      this._contentSandbox.entryContainer = entryContainer;</span>
<a href="#l19.536"></a><span id="l19.536" class="difflineplus">+      this._contentSandbox.clearDiv = this._document</span>
<a href="#l19.537"></a><span id="l19.537" class="difflineplus">+                                          .createElementNS(HTML_NS, &quot;div&quot;);</span>
<a href="#l19.538"></a><span id="l19.538" class="difflineplus">+      this._contentSandbox.clearDiv.style.clear = &quot;both&quot;;</span>
<a href="#l19.539"></a><span id="l19.539" class="difflineplus">+</span>
<a href="#l19.540"></a><span id="l19.540" class="difflineplus">+      var codeStr = &quot;feedContent.appendChild(entryContainer); &quot; +</span>
<a href="#l19.541"></a><span id="l19.541" class="difflineplus">+                    &quot;feedContent.appendChild(clearDiv);&quot;;</span>
<a href="#l19.542"></a><span id="l19.542" class="difflineplus">+      Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.543"></a><span id="l19.543" class="difflineplus">+    }</span>
<a href="#l19.544"></a><span id="l19.544" class="difflineplus">+</span>
<a href="#l19.545"></a><span id="l19.545" class="difflineplus">+    this._contentSandbox.feedContent = null;</span>
<a href="#l19.546"></a><span id="l19.546" class="difflineplus">+    this._contentSandbox.entryContainer = null;</span>
<a href="#l19.547"></a><span id="l19.547" class="difflineplus">+    this._contentSandbox.clearDiv = null;</span>
<a href="#l19.548"></a><span id="l19.548" class="difflineplus">+  },</span>
<a href="#l19.549"></a><span id="l19.549" class="difflineplus">+</span>
<a href="#l19.550"></a><span id="l19.550" class="difflineplus">+  /**</span>
<a href="#l19.551"></a><span id="l19.551" class="difflineplus">+   * Takes a url to a media item and returns the best name it can come up with.</span>
<a href="#l19.552"></a><span id="l19.552" class="difflineplus">+   * Frequently this is the filename portion (e.g. passing in</span>
<a href="#l19.553"></a><span id="l19.553" class="difflineplus">+   * http://example.com/foo.mpeg would return &quot;foo.mpeg&quot;), but in more complex</span>
<a href="#l19.554"></a><span id="l19.554" class="difflineplus">+   * cases, this will return the entire url (e.g. passing in</span>
<a href="#l19.555"></a><span id="l19.555" class="difflineplus">+   * http://example.com/somedirectory/ would return</span>
<a href="#l19.556"></a><span id="l19.556" class="difflineplus">+   * http://example.com/somedirectory/).</span>
<a href="#l19.557"></a><span id="l19.557" class="difflineplus">+   * @param aURL</span>
<a href="#l19.558"></a><span id="l19.558" class="difflineplus">+   *        The URL string from which to create a display name</span>
<a href="#l19.559"></a><span id="l19.559" class="difflineplus">+   * @returns a string</span>
<a href="#l19.560"></a><span id="l19.560" class="difflineplus">+   */</span>
<a href="#l19.561"></a><span id="l19.561" class="difflineplus">+  _getURLDisplayName: function getURLDisplayName(aURL) {</span>
<a href="#l19.562"></a><span id="l19.562" class="difflineplus">+    var url = makeURI(aURL);</span>
<a href="#l19.563"></a><span id="l19.563" class="difflineplus">+</span>
<a href="#l19.564"></a><span id="l19.564" class="difflineplus">+    if ((url instanceof Components.interfaces.nsIURL) &amp;&amp; url.fileName)</span>
<a href="#l19.565"></a><span id="l19.565" class="difflineplus">+      return decodeURI(url.fileName);</span>
<a href="#l19.566"></a><span id="l19.566" class="difflineplus">+    return aURL;</span>
<a href="#l19.567"></a><span id="l19.567" class="difflineplus">+  },</span>
<a href="#l19.568"></a><span id="l19.568" class="difflineplus">+</span>
<a href="#l19.569"></a><span id="l19.569" class="difflineplus">+  /**</span>
<a href="#l19.570"></a><span id="l19.570" class="difflineplus">+   * Takes a FeedEntry with enclosures, generates the HTML code to represent</span>
<a href="#l19.571"></a><span id="l19.571" class="difflineplus">+   * them, and returns that.</span>
<a href="#l19.572"></a><span id="l19.572" class="difflineplus">+   * @param   entry</span>
<a href="#l19.573"></a><span id="l19.573" class="difflineplus">+   *          FeedEntry with enclosures</span>
<a href="#l19.574"></a><span id="l19.574" class="difflineplus">+   * @returns element</span>
<a href="#l19.575"></a><span id="l19.575" class="difflineplus">+   */</span>
<a href="#l19.576"></a><span id="l19.576" class="difflineplus">+  _buildEnclosureDiv: function buildEnclosureDiv(entry) {</span>
<a href="#l19.577"></a><span id="l19.577" class="difflineplus">+    var enclosuresDiv = this._document.createElementNS(HTML_NS, &quot;div&quot;);</span>
<a href="#l19.578"></a><span id="l19.578" class="difflineplus">+    enclosuresDiv.className = &quot;enclosures&quot;;</span>
<a href="#l19.579"></a><span id="l19.579" class="difflineplus">+</span>
<a href="#l19.580"></a><span id="l19.580" class="difflineplus">+    enclosuresDiv.appendChild(this._document.createTextNode(this._getString(&quot;mediaLabel&quot;)));</span>
<a href="#l19.581"></a><span id="l19.581" class="difflineplus">+</span>
<a href="#l19.582"></a><span id="l19.582" class="difflineplus">+    for (let i_enc = 0; i_enc &lt; entry.enclosures.length; ++i_enc) {</span>
<a href="#l19.583"></a><span id="l19.583" class="difflineplus">+      let enc = entry.enclosures.queryElementAt(i_enc, Components.interfaces.nsIWritablePropertyBag2);</span>
<a href="#l19.584"></a><span id="l19.584" class="difflineplus">+</span>
<a href="#l19.585"></a><span id="l19.585" class="difflineplus">+      if (!(enc.hasKey(&quot;url&quot;)))</span>
<a href="#l19.586"></a><span id="l19.586" class="difflineplus">+        continue;</span>
<a href="#l19.587"></a><span id="l19.587" class="difflineplus">+</span>
<a href="#l19.588"></a><span id="l19.588" class="difflineplus">+      let enclosureDiv = this._document.createElementNS(HTML_NS, &quot;div&quot;);</span>
<a href="#l19.589"></a><span id="l19.589" class="difflineplus">+      enclosureDiv.setAttribute(&quot;class&quot;, &quot;enclosure&quot;);</span>
<a href="#l19.590"></a><span id="l19.590" class="difflineplus">+</span>
<a href="#l19.591"></a><span id="l19.591" class="difflineplus">+      let mozicon = &quot;moz-icon://.txt?size=16&quot;;</span>
<a href="#l19.592"></a><span id="l19.592" class="difflineplus">+      let type_text = null;</span>
<a href="#l19.593"></a><span id="l19.593" class="difflineplus">+      let size_text = null;</span>
<a href="#l19.594"></a><span id="l19.594" class="difflineplus">+</span>
<a href="#l19.595"></a><span id="l19.595" class="difflineplus">+      if (enc.hasKey(&quot;type&quot;)) {</span>
<a href="#l19.596"></a><span id="l19.596" class="difflineplus">+        type_text = enc.get(&quot;type&quot;);</span>
<a href="#l19.597"></a><span id="l19.597" class="difflineplus">+        try {</span>
<a href="#l19.598"></a><span id="l19.598" class="difflineplus">+          let handlerInfoWrapper = this._mimeSvc.getFromTypeAndExtension(enc.get(&quot;type&quot;), null);</span>
<a href="#l19.599"></a><span id="l19.599" class="difflineplus">+</span>
<a href="#l19.600"></a><span id="l19.600" class="difflineplus">+          if (handlerInfoWrapper)</span>
<a href="#l19.601"></a><span id="l19.601" class="difflineplus">+            type_text = handlerInfoWrapper.description;</span>
<a href="#l19.602"></a><span id="l19.602" class="difflineplus">+</span>
<a href="#l19.603"></a><span id="l19.603" class="difflineplus">+          if  (type_text &amp;&amp; type_text.length &gt; 0)</span>
<a href="#l19.604"></a><span id="l19.604" class="difflineplus">+            mozicon = &quot;moz-icon://goat?size=16&amp;contentType=&quot; + enc.get(&quot;type&quot;);</span>
<a href="#l19.605"></a><span id="l19.605" class="difflineplus">+</span>
<a href="#l19.606"></a><span id="l19.606" class="difflineplus">+        } catch (ex) {</span>
<a href="#l19.607"></a><span id="l19.607" class="difflineplus">+        }</span>
<a href="#l19.608"></a><span id="l19.608" class="difflineplus">+</span>
<a href="#l19.609"></a><span id="l19.609" class="difflineplus">+      }</span>
<a href="#l19.610"></a><span id="l19.610" class="difflineplus">+</span>
<a href="#l19.611"></a><span id="l19.611" class="difflineplus">+      if (enc.hasKey(&quot;length&quot;) &amp;&amp; /^[0-9]+$/.test(enc.get(&quot;length&quot;))) {</span>
<a href="#l19.612"></a><span id="l19.612" class="difflineplus">+        let enc_size = convertByteUnits(parseInt(enc.get(&quot;length&quot;)));</span>
<a href="#l19.613"></a><span id="l19.613" class="difflineplus">+</span>
<a href="#l19.614"></a><span id="l19.614" class="difflineplus">+        let size_text = this._getFormattedString(&quot;enclosureSizeText&quot;,</span>
<a href="#l19.615"></a><span id="l19.615" class="difflineplus">+                             [enc_size[0], this._getString(enc_size[1])]);</span>
<a href="#l19.616"></a><span id="l19.616" class="difflineplus">+      }</span>
<a href="#l19.617"></a><span id="l19.617" class="difflineplus">+</span>
<a href="#l19.618"></a><span id="l19.618" class="difflineplus">+      let iconimg = this._document.createElementNS(HTML_NS, &quot;img&quot;);</span>
<a href="#l19.619"></a><span id="l19.619" class="difflineplus">+      iconimg.setAttribute(&quot;src&quot;, mozicon);</span>
<a href="#l19.620"></a><span id="l19.620" class="difflineplus">+      iconimg.setAttribute(&quot;class&quot;, &quot;type-icon&quot;);</span>
<a href="#l19.621"></a><span id="l19.621" class="difflineplus">+      enclosureDiv.appendChild(iconimg);</span>
<a href="#l19.622"></a><span id="l19.622" class="difflineplus">+</span>
<a href="#l19.623"></a><span id="l19.623" class="difflineplus">+      enclosureDiv.appendChild(this._document.createTextNode( &quot; &quot; ));</span>
<a href="#l19.624"></a><span id="l19.624" class="difflineplus">+</span>
<a href="#l19.625"></a><span id="l19.625" class="difflineplus">+      let enc_href = this._document.createElementNS(HTML_NS, &quot;a&quot;);</span>
<a href="#l19.626"></a><span id="l19.626" class="difflineplus">+      enc_href.appendChild(this._document.createTextNode(this._getURLDisplayName(enc.get(&quot;url&quot;))));</span>
<a href="#l19.627"></a><span id="l19.627" class="difflineplus">+      this._safeSetURIAttribute(enc_href, &quot;href&quot;, enc.get(&quot;url&quot;));</span>
<a href="#l19.628"></a><span id="l19.628" class="difflineplus">+      enclosureDiv.appendChild(enc_href);</span>
<a href="#l19.629"></a><span id="l19.629" class="difflineplus">+</span>
<a href="#l19.630"></a><span id="l19.630" class="difflineplus">+      if (type_text &amp;&amp; size_text)</span>
<a href="#l19.631"></a><span id="l19.631" class="difflineplus">+        enclosureDiv.appendChild(this._document.createTextNode( &quot; (&quot; + type_text + &quot;, &quot; + size_text + &quot;)&quot;));</span>
<a href="#l19.632"></a><span id="l19.632" class="difflineplus">+</span>
<a href="#l19.633"></a><span id="l19.633" class="difflineplus">+      else if (type_text)</span>
<a href="#l19.634"></a><span id="l19.634" class="difflineplus">+        enclosureDiv.appendChild(this._document.createTextNode( &quot; (&quot; + type_text + &quot;)&quot;))</span>
<a href="#l19.635"></a><span id="l19.635" class="difflineplus">+</span>
<a href="#l19.636"></a><span id="l19.636" class="difflineplus">+      else if (size_text)</span>
<a href="#l19.637"></a><span id="l19.637" class="difflineplus">+        enclosureDiv.appendChild(this._document.createTextNode( &quot; (&quot; + size_text + &quot;)&quot;))</span>
<a href="#l19.638"></a><span id="l19.638" class="difflineplus">+</span>
<a href="#l19.639"></a><span id="l19.639" class="difflineplus">+      enclosuresDiv.appendChild(enclosureDiv);</span>
<a href="#l19.640"></a><span id="l19.640" class="difflineplus">+    }</span>
<a href="#l19.641"></a><span id="l19.641" class="difflineplus">+</span>
<a href="#l19.642"></a><span id="l19.642" class="difflineplus">+    return enclosuresDiv;</span>
<a href="#l19.643"></a><span id="l19.643" class="difflineplus">+  },</span>
<a href="#l19.644"></a><span id="l19.644" class="difflineplus">+</span>
<a href="#l19.645"></a><span id="l19.645" class="difflineplus">+  /**</span>
<a href="#l19.646"></a><span id="l19.646" class="difflineplus">+   * Gets a valid nsIFeedContainer object from the parsed nsIFeedResult.</span>
<a href="#l19.647"></a><span id="l19.647" class="difflineplus">+   * Displays error information if there was one.</span>
<a href="#l19.648"></a><span id="l19.648" class="difflineplus">+   * @param   result</span>
<a href="#l19.649"></a><span id="l19.649" class="difflineplus">+   *          The parsed feed result</span>
<a href="#l19.650"></a><span id="l19.650" class="difflineplus">+   * @returns A valid nsIFeedContainer object containing the contents of</span>
<a href="#l19.651"></a><span id="l19.651" class="difflineplus">+   *          the feed.</span>
<a href="#l19.652"></a><span id="l19.652" class="difflineplus">+   */</span>
<a href="#l19.653"></a><span id="l19.653" class="difflineplus">+  _getContainer: function getContainer(result) {</span>
<a href="#l19.654"></a><span id="l19.654" class="difflineplus">+    var feedService = Components.classes[&quot;@mozilla.org/browser/feeds/result-service;1&quot;]</span>
<a href="#l19.655"></a><span id="l19.655" class="difflineplus">+                                .getService(Components.interfaces.nsIFeedResultService);</span>
<a href="#l19.656"></a><span id="l19.656" class="difflineplus">+</span>
<a href="#l19.657"></a><span id="l19.657" class="difflineplus">+    try {</span>
<a href="#l19.658"></a><span id="l19.658" class="difflineplus">+      var result = feedService.getFeedResult(this._getOriginalURI(this._window));</span>
<a href="#l19.659"></a><span id="l19.659" class="difflineplus">+</span>
<a href="#l19.660"></a><span id="l19.660" class="difflineplus">+      if (result.bozo) {</span>
<a href="#l19.661"></a><span id="l19.661" class="difflineplus">+        LOG(&quot;Subscribe Preview: feed result is bozo?!&quot;);</span>
<a href="#l19.662"></a><span id="l19.662" class="difflineplus">+      }</span>
<a href="#l19.663"></a><span id="l19.663" class="difflineplus">+    }</span>
<a href="#l19.664"></a><span id="l19.664" class="difflineplus">+    catch (e) {</span>
<a href="#l19.665"></a><span id="l19.665" class="difflineplus">+      LOG(&quot;Subscribe Preview: feed not available?!&quot;);</span>
<a href="#l19.666"></a><span id="l19.666" class="difflineplus">+    }</span>
<a href="#l19.667"></a><span id="l19.667" class="difflineplus">+</span>
<a href="#l19.668"></a><span id="l19.668" class="difflineplus">+    try {</span>
<a href="#l19.669"></a><span id="l19.669" class="difflineplus">+      var container = result.doc;</span>
<a href="#l19.670"></a><span id="l19.670" class="difflineplus">+    }</span>
<a href="#l19.671"></a><span id="l19.671" class="difflineplus">+    catch (e) {</span>
<a href="#l19.672"></a><span id="l19.672" class="difflineplus">+      LOG(&quot;Subscribe Preview: no result.doc? Why didn't the original reload?&quot;);</span>
<a href="#l19.673"></a><span id="l19.673" class="difflineplus">+      return null;</span>
<a href="#l19.674"></a><span id="l19.674" class="difflineplus">+    }</span>
<a href="#l19.675"></a><span id="l19.675" class="difflineplus">+    return container;</span>
<a href="#l19.676"></a><span id="l19.676" class="difflineplus">+  },</span>
<a href="#l19.677"></a><span id="l19.677" class="difflineplus">+</span>
<a href="#l19.678"></a><span id="l19.678" class="difflineplus">+  /**</span>
<a href="#l19.679"></a><span id="l19.679" class="difflineplus">+   * Get the human-readable display name of a file. This could be the</span>
<a href="#l19.680"></a><span id="l19.680" class="difflineplus">+   * application name.</span>
<a href="#l19.681"></a><span id="l19.681" class="difflineplus">+   * @param   file</span>
<a href="#l19.682"></a><span id="l19.682" class="difflineplus">+   *          A nsIFile to look up the name of</span>
<a href="#l19.683"></a><span id="l19.683" class="difflineplus">+   * @returns The display name of the application represented by the file.</span>
<a href="#l19.684"></a><span id="l19.684" class="difflineplus">+   */</span>
<a href="#l19.685"></a><span id="l19.685" class="difflineplus">+  _getFileDisplayName: function getFileDisplayName(file) {</span>
<a href="#l19.686"></a><span id="l19.686" class="difflineplus">+#ifdef XP_WIN</span>
<a href="#l19.687"></a><span id="l19.687" class="difflineplus">+    if (file instanceof Components.interfaces.nsILocalFileWin) {</span>
<a href="#l19.688"></a><span id="l19.688" class="difflineplus">+      try {</span>
<a href="#l19.689"></a><span id="l19.689" class="difflineplus">+        return file.getVersionInfoField(&quot;FileDescription&quot;);</span>
<a href="#l19.690"></a><span id="l19.690" class="difflineplus">+      }</span>
<a href="#l19.691"></a><span id="l19.691" class="difflineplus">+      catch (e) {</span>
<a href="#l19.692"></a><span id="l19.692" class="difflineplus">+      }</span>
<a href="#l19.693"></a><span id="l19.693" class="difflineplus">+    }</span>
<a href="#l19.694"></a><span id="l19.694" class="difflineplus">+#endif</span>
<a href="#l19.695"></a><span id="l19.695" class="difflineplus">+#ifdef XP_MACOSX</span>
<a href="#l19.696"></a><span id="l19.696" class="difflineplus">+    var lfm = file.QueryInterface(Components.interfaces.nsILocalFileMac);</span>
<a href="#l19.697"></a><span id="l19.697" class="difflineplus">+    try {</span>
<a href="#l19.698"></a><span id="l19.698" class="difflineplus">+      return lfm.bundleDisplayName;</span>
<a href="#l19.699"></a><span id="l19.699" class="difflineplus">+    }</span>
<a href="#l19.700"></a><span id="l19.700" class="difflineplus">+    catch (e) {</span>
<a href="#l19.701"></a><span id="l19.701" class="difflineplus">+      // fall through to the file name</span>
<a href="#l19.702"></a><span id="l19.702" class="difflineplus">+    }</span>
<a href="#l19.703"></a><span id="l19.703" class="difflineplus">+#endif</span>
<a href="#l19.704"></a><span id="l19.704" class="difflineplus">+    var url = this._ioSvc.newFileURI(file).QueryInterface(Components.interfaces.nsIURL);</span>
<a href="#l19.705"></a><span id="l19.705" class="difflineplus">+    return url.fileName;</span>
<a href="#l19.706"></a><span id="l19.706" class="difflineplus">+  },</span>
<a href="#l19.707"></a><span id="l19.707" class="difflineplus">+</span>
<a href="#l19.708"></a><span id="l19.708" class="difflineplus">+  /**</span>
<a href="#l19.709"></a><span id="l19.709" class="difflineplus">+   * Get moz-icon url for a file</span>
<a href="#l19.710"></a><span id="l19.710" class="difflineplus">+   * @param   file</span>
<a href="#l19.711"></a><span id="l19.711" class="difflineplus">+   *          A nsIFile object for which the moz-icon:// is returned</span>
<a href="#l19.712"></a><span id="l19.712" class="difflineplus">+   * @returns moz-icon url of the given file as a string</span>
<a href="#l19.713"></a><span id="l19.713" class="difflineplus">+   */</span>
<a href="#l19.714"></a><span id="l19.714" class="difflineplus">+  _getFileIconURL: function getFileIconURL(file) {</span>
<a href="#l19.715"></a><span id="l19.715" class="difflineplus">+    var fph = this._ioSvc.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l19.716"></a><span id="l19.716" class="difflineplus">+                  .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l19.717"></a><span id="l19.717" class="difflineplus">+    var urlSpec = fph.getURLSpecFromFile(file);</span>
<a href="#l19.718"></a><span id="l19.718" class="difflineplus">+    return &quot;moz-icon://&quot; + urlSpec + &quot;?size=16&quot;;</span>
<a href="#l19.719"></a><span id="l19.719" class="difflineplus">+  },</span>
<a href="#l19.720"></a><span id="l19.720" class="difflineplus">+</span>
<a href="#l19.721"></a><span id="l19.721" class="difflineplus">+  /**</span>
<a href="#l19.722"></a><span id="l19.722" class="difflineplus">+   * Helper method to set the selected application and system default</span>
<a href="#l19.723"></a><span id="l19.723" class="difflineplus">+   * reader menuitems details from a file object</span>
<a href="#l19.724"></a><span id="l19.724" class="difflineplus">+   *   @param aMenuItem</span>
<a href="#l19.725"></a><span id="l19.725" class="difflineplus">+   *          The menuitem on which the attributes should be set</span>
<a href="#l19.726"></a><span id="l19.726" class="difflineplus">+   *   @param aFile</span>
<a href="#l19.727"></a><span id="l19.727" class="difflineplus">+   *          The menuitem's associated file</span>
<a href="#l19.728"></a><span id="l19.728" class="difflineplus">+   */</span>
<a href="#l19.729"></a><span id="l19.729" class="difflineplus">+  _initMenuItemWithFile: function(aMenuItem, aFile) {</span>
<a href="#l19.730"></a><span id="l19.730" class="difflineplus">+    this._contentSandbox.menuitem = aMenuItem;</span>
<a href="#l19.731"></a><span id="l19.731" class="difflineplus">+    this._contentSandbox.label = this._getFileDisplayName(aFile);</span>
<a href="#l19.732"></a><span id="l19.732" class="difflineplus">+    this._contentSandbox.image = this._getFileIconURL(aFile);</span>
<a href="#l19.733"></a><span id="l19.733" class="difflineplus">+    var codeStr = &quot;menuitem.setAttribute('label', label); &quot; +</span>
<a href="#l19.734"></a><span id="l19.734" class="difflineplus">+                  &quot;menuitem.setAttribute('image', image);&quot;;</span>
<a href="#l19.735"></a><span id="l19.735" class="difflineplus">+    Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.736"></a><span id="l19.736" class="difflineplus">+  },</span>
<a href="#l19.737"></a><span id="l19.737" class="difflineplus">+</span>
<a href="#l19.738"></a><span id="l19.738" class="difflineplus">+  /**</span>
<a href="#l19.739"></a><span id="l19.739" class="difflineplus">+   * Displays a prompt from which the user may choose a (client) feed reader.</span>
<a href="#l19.740"></a><span id="l19.740" class="difflineplus">+   * @return - true if a feed reader was selected, false otherwise.</span>
<a href="#l19.741"></a><span id="l19.741" class="difflineplus">+   */</span>
<a href="#l19.742"></a><span id="l19.742" class="difflineplus">+  _chooseClientApp: function chooseClientApp() {</span>
<a href="#l19.743"></a><span id="l19.743" class="difflineplus">+    try {</span>
<a href="#l19.744"></a><span id="l19.744" class="difflineplus">+      var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l19.745"></a><span id="l19.745" class="difflineplus">+                         .createInstance(Components.interfaces.nsIFilePicker);</span>
<a href="#l19.746"></a><span id="l19.746" class="difflineplus">+      fp.init(this._window,</span>
<a href="#l19.747"></a><span id="l19.747" class="difflineplus">+              this._getString(&quot;chooseApplicationDialogTitle&quot;),</span>
<a href="#l19.748"></a><span id="l19.748" class="difflineplus">+              Components.interfaces.nsIFilePicker.modeOpen);</span>
<a href="#l19.749"></a><span id="l19.749" class="difflineplus">+      fp.appendFilters(Components.interfaces.nsIFilePicker.filterApps);</span>
<a href="#l19.750"></a><span id="l19.750" class="difflineplus">+</span>
<a href="#l19.751"></a><span id="l19.751" class="difflineplus">+      if (fp.show() == Components.interfaces.nsIFilePicker.returnOK) {</span>
<a href="#l19.752"></a><span id="l19.752" class="difflineplus">+        this._selectedApp = fp.file;</span>
<a href="#l19.753"></a><span id="l19.753" class="difflineplus">+        if (this._selectedApp) {</span>
<a href="#l19.754"></a><span id="l19.754" class="difflineplus">+          // XXXben - we need to compare this with the running instance executable</span>
<a href="#l19.755"></a><span id="l19.755" class="difflineplus">+          //          just don't know how to do that via script...</span>
<a href="#l19.756"></a><span id="l19.756" class="difflineplus">+          // XXXmano TBD: can probably add this to nsIShellService</span>
<a href="#l19.757"></a><span id="l19.757" class="difflineplus">+#ifdef XP_WIN</span>
<a href="#l19.758"></a><span id="l19.758" class="difflineplus">+#expand           if (fp.file.leafName != &quot;__MOZ_APP_NAME__.exe&quot;) {</span>
<a href="#l19.759"></a><span id="l19.759" class="difflineplus">+#else</span>
<a href="#l19.760"></a><span id="l19.760" class="difflineplus">+#ifdef XP_MACOSX</span>
<a href="#l19.761"></a><span id="l19.761" class="difflineplus">+#expand           if (fp.file.leafName != &quot;__MOZ_APP_DISPLAYNAME__.app&quot;) {</span>
<a href="#l19.762"></a><span id="l19.762" class="difflineplus">+#else</span>
<a href="#l19.763"></a><span id="l19.763" class="difflineplus">+#expand           if (fp.file.leafName != &quot;__MOZ_APP_NAME__-bin&quot;) {</span>
<a href="#l19.764"></a><span id="l19.764" class="difflineplus">+#endif</span>
<a href="#l19.765"></a><span id="l19.765" class="difflineplus">+#endif</span>
<a href="#l19.766"></a><span id="l19.766" class="difflineplus">+            this._initMenuItemWithFile(this._contentSandbox.selectedAppMenuItem,</span>
<a href="#l19.767"></a><span id="l19.767" class="difflineplus">+                                       this._selectedApp);</span>
<a href="#l19.768"></a><span id="l19.768" class="difflineplus">+</span>
<a href="#l19.769"></a><span id="l19.769" class="difflineplus">+            // Show and select the selected application menuitem</span>
<a href="#l19.770"></a><span id="l19.770" class="difflineplus">+            var codeStr = &quot;selectedAppMenuItem.hidden = false;&quot; +</span>
<a href="#l19.771"></a><span id="l19.771" class="difflineplus">+                          &quot;selectedAppMenuItem.doCommand();&quot;;</span>
<a href="#l19.772"></a><span id="l19.772" class="difflineplus">+            Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.773"></a><span id="l19.773" class="difflineplus">+            return true;</span>
<a href="#l19.774"></a><span id="l19.774" class="difflineplus">+          }</span>
<a href="#l19.775"></a><span id="l19.775" class="difflineplus">+        }</span>
<a href="#l19.776"></a><span id="l19.776" class="difflineplus">+      }</span>
<a href="#l19.777"></a><span id="l19.777" class="difflineplus">+    }</span>
<a href="#l19.778"></a><span id="l19.778" class="difflineplus">+    catch(ex) {</span>
<a href="#l19.779"></a><span id="l19.779" class="difflineplus">+    }</span>
<a href="#l19.780"></a><span id="l19.780" class="difflineplus">+</span>
<a href="#l19.781"></a><span id="l19.781" class="difflineplus">+    return false;</span>
<a href="#l19.782"></a><span id="l19.782" class="difflineplus">+  },</span>
<a href="#l19.783"></a><span id="l19.783" class="difflineplus">+</span>
<a href="#l19.784"></a><span id="l19.784" class="difflineplus">+  _setAlwaysUseCheckedState: function setAlwaysUseCheckedState(feedType) {</span>
<a href="#l19.785"></a><span id="l19.785" class="difflineplus">+    var checkbox = this._document.getElementById(&quot;alwaysUse&quot;);</span>
<a href="#l19.786"></a><span id="l19.786" class="difflineplus">+    if (checkbox) {</span>
<a href="#l19.787"></a><span id="l19.787" class="difflineplus">+      var alwaysUse = (safeGetCharPref(getPrefActionForType(feedType), &quot;ask&quot;) != &quot;ask&quot;);</span>
<a href="#l19.788"></a><span id="l19.788" class="difflineplus">+      this._setCheckboxCheckedState(checkbox, alwaysUse);</span>
<a href="#l19.789"></a><span id="l19.789" class="difflineplus">+    }</span>
<a href="#l19.790"></a><span id="l19.790" class="difflineplus">+  },</span>
<a href="#l19.791"></a><span id="l19.791" class="difflineplus">+</span>
<a href="#l19.792"></a><span id="l19.792" class="difflineplus">+  _setSubscribeUsingLabel: function setSubscribeUsingLabel() {</span>
<a href="#l19.793"></a><span id="l19.793" class="difflineplus">+    var stringLabel = &quot;subscribeFeedUsing&quot;;</span>
<a href="#l19.794"></a><span id="l19.794" class="difflineplus">+    switch (this._getFeedType()) {</span>
<a href="#l19.795"></a><span id="l19.795" class="difflineplus">+      case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l19.796"></a><span id="l19.796" class="difflineplus">+        stringLabel = &quot;subscribeVideoPodcastUsing&quot;;</span>
<a href="#l19.797"></a><span id="l19.797" class="difflineplus">+        break;</span>
<a href="#l19.798"></a><span id="l19.798" class="difflineplus">+</span>
<a href="#l19.799"></a><span id="l19.799" class="difflineplus">+      case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l19.800"></a><span id="l19.800" class="difflineplus">+        stringLabel = &quot;subscribeAudioPodcastUsing&quot;;</span>
<a href="#l19.801"></a><span id="l19.801" class="difflineplus">+        break;</span>
<a href="#l19.802"></a><span id="l19.802" class="difflineplus">+    }</span>
<a href="#l19.803"></a><span id="l19.803" class="difflineplus">+</span>
<a href="#l19.804"></a><span id="l19.804" class="difflineplus">+    this._contentSandbox.subscribeUsing =</span>
<a href="#l19.805"></a><span id="l19.805" class="difflineplus">+      this._document.getElementById(&quot;subscribeUsingDescription&quot;);</span>
<a href="#l19.806"></a><span id="l19.806" class="difflineplus">+    this._contentSandbox.label = this._getString(stringLabel);</span>
<a href="#l19.807"></a><span id="l19.807" class="difflineplus">+    var codeStr = &quot;subscribeUsing.setAttribute('value', label);&quot;</span>
<a href="#l19.808"></a><span id="l19.808" class="difflineplus">+    Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.809"></a><span id="l19.809" class="difflineplus">+  },</span>
<a href="#l19.810"></a><span id="l19.810" class="difflineplus">+</span>
<a href="#l19.811"></a><span id="l19.811" class="difflineplus">+  _setAlwaysUseLabel: function setAlwaysUseLabel() {</span>
<a href="#l19.812"></a><span id="l19.812" class="difflineplus">+    var checkbox = this._document.getElementById(&quot;alwaysUse&quot;);</span>
<a href="#l19.813"></a><span id="l19.813" class="difflineplus">+    if (checkbox) {</span>
<a href="#l19.814"></a><span id="l19.814" class="difflineplus">+      var handlersMenuList = this._document.getElementById(&quot;handlersMenuList&quot;);</span>
<a href="#l19.815"></a><span id="l19.815" class="difflineplus">+      if (handlersMenuList) {</span>
<a href="#l19.816"></a><span id="l19.816" class="difflineplus">+        var handlerName = this._getSelectedItemFromMenulist(handlersMenuList)</span>
<a href="#l19.817"></a><span id="l19.817" class="difflineplus">+                              .getAttribute(&quot;label&quot;);</span>
<a href="#l19.818"></a><span id="l19.818" class="difflineplus">+        var stringLabel = &quot;alwaysUseForFeeds&quot;;</span>
<a href="#l19.819"></a><span id="l19.819" class="difflineplus">+        switch (this._getFeedType()) {</span>
<a href="#l19.820"></a><span id="l19.820" class="difflineplus">+          case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l19.821"></a><span id="l19.821" class="difflineplus">+            stringLabel = &quot;alwaysUseForVideoPodcasts&quot;;</span>
<a href="#l19.822"></a><span id="l19.822" class="difflineplus">+            break;</span>
<a href="#l19.823"></a><span id="l19.823" class="difflineplus">+</span>
<a href="#l19.824"></a><span id="l19.824" class="difflineplus">+          case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l19.825"></a><span id="l19.825" class="difflineplus">+            stringLabel = &quot;alwaysUseForAudioPodcasts&quot;;</span>
<a href="#l19.826"></a><span id="l19.826" class="difflineplus">+            break;</span>
<a href="#l19.827"></a><span id="l19.827" class="difflineplus">+        }</span>
<a href="#l19.828"></a><span id="l19.828" class="difflineplus">+</span>
<a href="#l19.829"></a><span id="l19.829" class="difflineplus">+        this._contentSandbox.checkbox = checkbox;</span>
<a href="#l19.830"></a><span id="l19.830" class="difflineplus">+        this._contentSandbox.label = this._getFormattedString(stringLabel, [handlerName]);</span>
<a href="#l19.831"></a><span id="l19.831" class="difflineplus">+</span>
<a href="#l19.832"></a><span id="l19.832" class="difflineplus">+        var codeStr = &quot;checkbox.setAttribute('label', label);&quot;;</span>
<a href="#l19.833"></a><span id="l19.833" class="difflineplus">+        Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.834"></a><span id="l19.834" class="difflineplus">+      }</span>
<a href="#l19.835"></a><span id="l19.835" class="difflineplus">+    }</span>
<a href="#l19.836"></a><span id="l19.836" class="difflineplus">+  },</span>
<a href="#l19.837"></a><span id="l19.837" class="difflineplus">+</span>
<a href="#l19.838"></a><span id="l19.838" class="difflineplus">+  // nsIDomEventListener</span>
<a href="#l19.839"></a><span id="l19.839" class="difflineplus">+  handleEvent: function(event) {</span>
<a href="#l19.840"></a><span id="l19.840" class="difflineplus">+    // see comments in init()</span>
<a href="#l19.841"></a><span id="l19.841" class="difflineplus">+    event = new XPCNativeWrapper(event);</span>
<a href="#l19.842"></a><span id="l19.842" class="difflineplus">+    if (event.target.ownerDocument != this._document) {</span>
<a href="#l19.843"></a><span id="l19.843" class="difflineplus">+      LOG(&quot;FeedWriter.handleEvent: Someone passed the feed writer as a listener to the events of another document!&quot;);</span>
<a href="#l19.844"></a><span id="l19.844" class="difflineplus">+      return;</span>
<a href="#l19.845"></a><span id="l19.845" class="difflineplus">+    }</span>
<a href="#l19.846"></a><span id="l19.846" class="difflineplus">+</span>
<a href="#l19.847"></a><span id="l19.847" class="difflineplus">+    if (event.type == &quot;command&quot;) {</span>
<a href="#l19.848"></a><span id="l19.848" class="difflineplus">+      switch (event.target.id) {</span>
<a href="#l19.849"></a><span id="l19.849" class="difflineplus">+        case &quot;subscribeButton&quot;:</span>
<a href="#l19.850"></a><span id="l19.850" class="difflineplus">+          this.subscribe();</span>
<a href="#l19.851"></a><span id="l19.851" class="difflineplus">+          break;</span>
<a href="#l19.852"></a><span id="l19.852" class="difflineplus">+        case &quot;chooseApplicationMenuItem&quot;:</span>
<a href="#l19.853"></a><span id="l19.853" class="difflineplus">+          /* Bug 351263: Make sure to not steal focus if the &quot;Choose</span>
<a href="#l19.854"></a><span id="l19.854" class="difflineplus">+           * Application&quot; item is being selected with the keyboard. We do this</span>
<a href="#l19.855"></a><span id="l19.855" class="difflineplus">+           * by ignoring command events while the dropdown is closed (user</span>
<a href="#l19.856"></a><span id="l19.856" class="difflineplus">+           * arrowing through the combobox), but handling them while the</span>
<a href="#l19.857"></a><span id="l19.857" class="difflineplus">+           * combobox dropdown is open (user pressed enter when an item was</span>
<a href="#l19.858"></a><span id="l19.858" class="difflineplus">+           * selected). If we don't show the filepicker here, it will be shown</span>
<a href="#l19.859"></a><span id="l19.859" class="difflineplus">+           * when clicking &quot;Subscribe Now&quot;.</span>
<a href="#l19.860"></a><span id="l19.860" class="difflineplus">+           */</span>
<a href="#l19.861"></a><span id="l19.861" class="difflineplus">+          var popupbox = this._document.getElementById(&quot;handlersMenuList&quot;)</span>
<a href="#l19.862"></a><span id="l19.862" class="difflineplus">+                             .firstChild.boxObject;</span>
<a href="#l19.863"></a><span id="l19.863" class="difflineplus">+          popupbox.QueryInterface(Components.interfaces.nsIPopupBoxObject);</span>
<a href="#l19.864"></a><span id="l19.864" class="difflineplus">+          if (popupbox.popupState == &quot;hiding&quot; &amp;&amp; !this._chooseClientApp()) {</span>
<a href="#l19.865"></a><span id="l19.865" class="difflineplus">+            // Select the (per-prefs) selected handler if no application was</span>
<a href="#l19.866"></a><span id="l19.866" class="difflineplus">+            // selected</span>
<a href="#l19.867"></a><span id="l19.867" class="difflineplus">+            this._setSelectedHandler(this._getFeedType());</span>
<a href="#l19.868"></a><span id="l19.868" class="difflineplus">+          }</span>
<a href="#l19.869"></a><span id="l19.869" class="difflineplus">+          break;</span>
<a href="#l19.870"></a><span id="l19.870" class="difflineplus">+        default:</span>
<a href="#l19.871"></a><span id="l19.871" class="difflineplus">+          this._setAlwaysUseLabel();</span>
<a href="#l19.872"></a><span id="l19.872" class="difflineplus">+      }</span>
<a href="#l19.873"></a><span id="l19.873" class="difflineplus">+    }</span>
<a href="#l19.874"></a><span id="l19.874" class="difflineplus">+  },</span>
<a href="#l19.875"></a><span id="l19.875" class="difflineplus">+</span>
<a href="#l19.876"></a><span id="l19.876" class="difflineplus">+  _setSelectedHandler: function setSelectedHandler(feedType) {</span>
<a href="#l19.877"></a><span id="l19.877" class="difflineplus">+    var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l19.878"></a><span id="l19.878" class="difflineplus">+                          .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l19.879"></a><span id="l19.879" class="difflineplus">+    var handler = safeGetCharPref(getPrefReaderForType(feedType), &quot;messenger&quot;);</span>
<a href="#l19.880"></a><span id="l19.880" class="difflineplus">+</span>
<a href="#l19.881"></a><span id="l19.881" class="difflineplus">+    switch (handler) {</span>
<a href="#l19.882"></a><span id="l19.882" class="difflineplus">+      case &quot;web&quot;:</span>
<a href="#l19.883"></a><span id="l19.883" class="difflineplus">+        var handlersMenuList = this._document.getElementById(&quot;handlersMenuList&quot;);</span>
<a href="#l19.884"></a><span id="l19.884" class="difflineplus">+        if (handlersMenuList) {</span>
<a href="#l19.885"></a><span id="l19.885" class="difflineplus">+          var url = prefs.getComplexValue(getPrefWebForType(feedType),</span>
<a href="#l19.886"></a><span id="l19.886" class="difflineplus">+                                          Components.interfaces.nsISupportsString).data;</span>
<a href="#l19.887"></a><span id="l19.887" class="difflineplus">+          var handlers = handlersMenuList.getElementsByAttribute(&quot;webhandlerurl&quot;, url);</span>
<a href="#l19.888"></a><span id="l19.888" class="difflineplus">+          if (handlers.length == 0) {</span>
<a href="#l19.889"></a><span id="l19.889" class="difflineplus">+            LOG(&quot;FeedWriter._setSelectedHandler: selected web handler isn't in the menulist&quot;);</span>
<a href="#l19.890"></a><span id="l19.890" class="difflineplus">+            return;</span>
<a href="#l19.891"></a><span id="l19.891" class="difflineplus">+          }</span>
<a href="#l19.892"></a><span id="l19.892" class="difflineplus">+</span>
<a href="#l19.893"></a><span id="l19.893" class="difflineplus">+          this._safeDoCommand(handlers[0]);</span>
<a href="#l19.894"></a><span id="l19.894" class="difflineplus">+        }</span>
<a href="#l19.895"></a><span id="l19.895" class="difflineplus">+        break;</span>
<a href="#l19.896"></a><span id="l19.896" class="difflineplus">+      case &quot;client&quot;:</span>
<a href="#l19.897"></a><span id="l19.897" class="difflineplus">+        try {</span>
<a href="#l19.898"></a><span id="l19.898" class="difflineplus">+          this._selectedApp =</span>
<a href="#l19.899"></a><span id="l19.899" class="difflineplus">+            prefs.getComplexValue(getPrefAppForType(feedType),</span>
<a href="#l19.900"></a><span id="l19.900" class="difflineplus">+                                  Components.interfaces.nsILocalFile);</span>
<a href="#l19.901"></a><span id="l19.901" class="difflineplus">+        }</span>
<a href="#l19.902"></a><span id="l19.902" class="difflineplus">+        catch(ex) {</span>
<a href="#l19.903"></a><span id="l19.903" class="difflineplus">+          this._selectedApp = null;</span>
<a href="#l19.904"></a><span id="l19.904" class="difflineplus">+        }</span>
<a href="#l19.905"></a><span id="l19.905" class="difflineplus">+</span>
<a href="#l19.906"></a><span id="l19.906" class="difflineplus">+        if (this._selectedApp) {</span>
<a href="#l19.907"></a><span id="l19.907" class="difflineplus">+          this._initMenuItemWithFile(this._contentSandbox.selectedAppMenuItem,</span>
<a href="#l19.908"></a><span id="l19.908" class="difflineplus">+                                     this._selectedApp);</span>
<a href="#l19.909"></a><span id="l19.909" class="difflineplus">+          var codeStr = &quot;selectedAppMenuItem.hidden = false; &quot; +</span>
<a href="#l19.910"></a><span id="l19.910" class="difflineplus">+                        &quot;selectedAppMenuItem.doCommand(); &quot;;</span>
<a href="#l19.911"></a><span id="l19.911" class="difflineplus">+</span>
<a href="#l19.912"></a><span id="l19.912" class="difflineplus">+          // Only show the default reader menuitem if the default reader</span>
<a href="#l19.913"></a><span id="l19.913" class="difflineplus">+          // isn't the selected application</span>
<a href="#l19.914"></a><span id="l19.914" class="difflineplus">+          if (this._defaultSystemReader) {</span>
<a href="#l19.915"></a><span id="l19.915" class="difflineplus">+            var shouldHide = this._defaultSystemReader.path == this._selectedApp.path;</span>
<a href="#l19.916"></a><span id="l19.916" class="difflineplus">+            codeStr += &quot;defaultHandlerMenuItem.hidden = &quot; + shouldHide + &quot;;&quot;;</span>
<a href="#l19.917"></a><span id="l19.917" class="difflineplus">+          }</span>
<a href="#l19.918"></a><span id="l19.918" class="difflineplus">+          Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.919"></a><span id="l19.919" class="difflineplus">+          break;</span>
<a href="#l19.920"></a><span id="l19.920" class="difflineplus">+        }</span>
<a href="#l19.921"></a><span id="l19.921" class="difflineplus">+      // fall through if this._selectedApp is null</span>
<a href="#l19.922"></a><span id="l19.922" class="difflineplus">+      default:</span>
<a href="#l19.923"></a><span id="l19.923" class="difflineplus">+        var messengerFeedsMenuItem = this._document.getElementById(&quot;messengerFeedsMenuItem&quot;);</span>
<a href="#l19.924"></a><span id="l19.924" class="difflineplus">+        if (messengerFeedsMenuItem)</span>
<a href="#l19.925"></a><span id="l19.925" class="difflineplus">+          this._safeDoCommand(messengerFeedsMenuItem);</span>
<a href="#l19.926"></a><span id="l19.926" class="difflineplus">+        break;</span>
<a href="#l19.927"></a><span id="l19.927" class="difflineplus">+    }</span>
<a href="#l19.928"></a><span id="l19.928" class="difflineplus">+  },</span>
<a href="#l19.929"></a><span id="l19.929" class="difflineplus">+</span>
<a href="#l19.930"></a><span id="l19.930" class="difflineplus">+  _initSubscriptionUI: function initSubscriptionUI() {</span>
<a href="#l19.931"></a><span id="l19.931" class="difflineplus">+    var handlersMenuPopup = this._document.getElementById(&quot;handlersMenuPopup&quot;);</span>
<a href="#l19.932"></a><span id="l19.932" class="difflineplus">+    if (!handlersMenuPopup)</span>
<a href="#l19.933"></a><span id="l19.933" class="difflineplus">+      return;</span>
<a href="#l19.934"></a><span id="l19.934" class="difflineplus">+</span>
<a href="#l19.935"></a><span id="l19.935" class="difflineplus">+    var feedType = this._getFeedType();</span>
<a href="#l19.936"></a><span id="l19.936" class="difflineplus">+    var codeStr;</span>
<a href="#l19.937"></a><span id="l19.937" class="difflineplus">+</span>
<a href="#l19.938"></a><span id="l19.938" class="difflineplus">+    // change the background</span>
<a href="#l19.939"></a><span id="l19.939" class="difflineplus">+    var header = this._document.getElementById(&quot;feedHeader&quot;);</span>
<a href="#l19.940"></a><span id="l19.940" class="difflineplus">+    this._contentSandbox.header = header;</span>
<a href="#l19.941"></a><span id="l19.941" class="difflineplus">+    switch (feedType) {</span>
<a href="#l19.942"></a><span id="l19.942" class="difflineplus">+      case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l19.943"></a><span id="l19.943" class="difflineplus">+        codeStr = &quot;header.className = 'videoPodcastBackground'; &quot;;</span>
<a href="#l19.944"></a><span id="l19.944" class="difflineplus">+        break;</span>
<a href="#l19.945"></a><span id="l19.945" class="difflineplus">+</span>
<a href="#l19.946"></a><span id="l19.946" class="difflineplus">+      case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l19.947"></a><span id="l19.947" class="difflineplus">+        codeStr = &quot;header.className = 'audioPodcastBackground'; &quot;;</span>
<a href="#l19.948"></a><span id="l19.948" class="difflineplus">+        break;</span>
<a href="#l19.949"></a><span id="l19.949" class="difflineplus">+</span>
<a href="#l19.950"></a><span id="l19.950" class="difflineplus">+      default:</span>
<a href="#l19.951"></a><span id="l19.951" class="difflineplus">+        codeStr = &quot;header.className = 'feedBackground'; &quot;;</span>
<a href="#l19.952"></a><span id="l19.952" class="difflineplus">+    }</span>
<a href="#l19.953"></a><span id="l19.953" class="difflineplus">+</span>
<a href="#l19.954"></a><span id="l19.954" class="difflineplus">+</span>
<a href="#l19.955"></a><span id="l19.955" class="difflineplus">+    // Last-selected application</span>
<a href="#l19.956"></a><span id="l19.956" class="difflineplus">+    var menuItem = this._document.createElementNS(XUL_NS, &quot;menuitem&quot;);</span>
<a href="#l19.957"></a><span id="l19.957" class="difflineplus">+    menuItem.id = &quot;selectedAppMenuItem&quot;;</span>
<a href="#l19.958"></a><span id="l19.958" class="difflineplus">+    menuItem.className = &quot;menuitem-iconic&quot;;</span>
<a href="#l19.959"></a><span id="l19.959" class="difflineplus">+    menuItem.setAttribute(&quot;handlerType&quot;, &quot;client&quot;);</span>
<a href="#l19.960"></a><span id="l19.960" class="difflineplus">+    try {</span>
<a href="#l19.961"></a><span id="l19.961" class="difflineplus">+      var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l19.962"></a><span id="l19.962" class="difflineplus">+                            .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l19.963"></a><span id="l19.963" class="difflineplus">+      this._selectedApp = prefs.getComplexValue(getPrefAppForType(feedType),</span>
<a href="#l19.964"></a><span id="l19.964" class="difflineplus">+                                                Components.interfaces.nsILocalFile);</span>
<a href="#l19.965"></a><span id="l19.965" class="difflineplus">+</span>
<a href="#l19.966"></a><span id="l19.966" class="difflineplus">+      if (this._selectedApp.exists())</span>
<a href="#l19.967"></a><span id="l19.967" class="difflineplus">+        this._initMenuItemWithFile(menuItem, this._selectedApp);</span>
<a href="#l19.968"></a><span id="l19.968" class="difflineplus">+      else {</span>
<a href="#l19.969"></a><span id="l19.969" class="difflineplus">+        // Hide the menuitem if the last selected application doesn't exist</span>
<a href="#l19.970"></a><span id="l19.970" class="difflineplus">+        menuItem.hidden = true;</span>
<a href="#l19.971"></a><span id="l19.971" class="difflineplus">+      }</span>
<a href="#l19.972"></a><span id="l19.972" class="difflineplus">+    }</span>
<a href="#l19.973"></a><span id="l19.973" class="difflineplus">+    catch(ex) {</span>
<a href="#l19.974"></a><span id="l19.974" class="difflineplus">+      // Hide the menuitem until an application is selected</span>
<a href="#l19.975"></a><span id="l19.975" class="difflineplus">+      menuItem.hidden = true;</span>
<a href="#l19.976"></a><span id="l19.976" class="difflineplus">+    }</span>
<a href="#l19.977"></a><span id="l19.977" class="difflineplus">+    this._contentSandbox.handlersMenuPopup = handlersMenuPopup;</span>
<a href="#l19.978"></a><span id="l19.978" class="difflineplus">+    this._contentSandbox.selectedAppMenuItem = menuItem;</span>
<a href="#l19.979"></a><span id="l19.979" class="difflineplus">+</span>
<a href="#l19.980"></a><span id="l19.980" class="difflineplus">+    codeStr += &quot;handlersMenuPopup.appendChild(selectedAppMenuItem); &quot;;</span>
<a href="#l19.981"></a><span id="l19.981" class="difflineplus">+</span>
<a href="#l19.982"></a><span id="l19.982" class="difflineplus">+    menuItem = null;</span>
<a href="#l19.983"></a><span id="l19.983" class="difflineplus">+</span>
<a href="#l19.984"></a><span id="l19.984" class="difflineplus">+#ifdef HAVE_SHELL_SERVICE</span>
<a href="#l19.985"></a><span id="l19.985" class="difflineplus">+    // List the default feed reader</span>
<a href="#l19.986"></a><span id="l19.986" class="difflineplus">+    try {</span>
<a href="#l19.987"></a><span id="l19.987" class="difflineplus">+      this._defaultSystemReader = Components.classes[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l19.988"></a><span id="l19.988" class="difflineplus">+                                            .getService(Components.interfaces.nsIShellService)</span>
<a href="#l19.989"></a><span id="l19.989" class="difflineplus">+                                            .defaultFeedReader;</span>
<a href="#l19.990"></a><span id="l19.990" class="difflineplus">+      menuItem = this._document.createElementNS(XUL_NS, &quot;menuitem&quot;);</span>
<a href="#l19.991"></a><span id="l19.991" class="difflineplus">+      menuItem.id = &quot;defaultHandlerMenuItem&quot;;</span>
<a href="#l19.992"></a><span id="l19.992" class="difflineplus">+      menuItem.className = &quot;menuitem-iconic&quot;;</span>
<a href="#l19.993"></a><span id="l19.993" class="difflineplus">+      menuItem.setAttribute(&quot;handlerType&quot;, &quot;client&quot;);</span>
<a href="#l19.994"></a><span id="l19.994" class="difflineplus">+</span>
<a href="#l19.995"></a><span id="l19.995" class="difflineplus">+      this._initMenuItemWithFile(menuItem, this._defaultSystemReader);</span>
<a href="#l19.996"></a><span id="l19.996" class="difflineplus">+</span>
<a href="#l19.997"></a><span id="l19.997" class="difflineplus">+      // Hide the default reader item if it points to the same application</span>
<a href="#l19.998"></a><span id="l19.998" class="difflineplus">+      // as the last-selected application</span>
<a href="#l19.999"></a><span id="l19.999" class="difflineplus">+      if (this._selectedApp &amp;&amp;</span>
<a href="#l19.1000"></a><span id="l19.1000" class="difflineplus">+          this._selectedApp.path == this._defaultSystemReader.path)</span>
<a href="#l19.1001"></a><span id="l19.1001" class="difflineplus">+        menuItem.hidden = true;</span>
<a href="#l19.1002"></a><span id="l19.1002" class="difflineplus">+    }</span>
<a href="#l19.1003"></a><span id="l19.1003" class="difflineplus">+    catch(ex) {</span>
<a href="#l19.1004"></a><span id="l19.1004" class="difflineplus">+    }</span>
<a href="#l19.1005"></a><span id="l19.1005" class="difflineplus">+#endif</span>
<a href="#l19.1006"></a><span id="l19.1006" class="difflineplus">+</span>
<a href="#l19.1007"></a><span id="l19.1007" class="difflineplus">+    if (menuItem) {</span>
<a href="#l19.1008"></a><span id="l19.1008" class="difflineplus">+      this._contentSandbox.defaultHandlerMenuItem = menuItem;</span>
<a href="#l19.1009"></a><span id="l19.1009" class="difflineplus">+      codeStr += &quot;handlersMenuPopup.appendChild(defaultHandlerMenuItem); &quot;;</span>
<a href="#l19.1010"></a><span id="l19.1010" class="difflineplus">+    }</span>
<a href="#l19.1011"></a><span id="l19.1011" class="difflineplus">+</span>
<a href="#l19.1012"></a><span id="l19.1012" class="difflineplus">+    // &quot;Choose Application...&quot; menuitem</span>
<a href="#l19.1013"></a><span id="l19.1013" class="difflineplus">+    menuItem = this._document.createElementNS(XUL_NS, &quot;menuitem&quot;);</span>
<a href="#l19.1014"></a><span id="l19.1014" class="difflineplus">+    menuItem.id = &quot;chooseApplicationMenuItem&quot;;</span>
<a href="#l19.1015"></a><span id="l19.1015" class="difflineplus">+    menuItem.setAttribute(&quot;label&quot;, this._getString(&quot;chooseApplicationMenuItem&quot;));</span>
<a href="#l19.1016"></a><span id="l19.1016" class="difflineplus">+</span>
<a href="#l19.1017"></a><span id="l19.1017" class="difflineplus">+    this._contentSandbox.chooseAppMenuItem = menuItem;</span>
<a href="#l19.1018"></a><span id="l19.1018" class="difflineplus">+    codeStr += &quot;handlersMenuPopup.appendChild(chooseAppMenuItem); &quot;;</span>
<a href="#l19.1019"></a><span id="l19.1019" class="difflineplus">+</span>
<a href="#l19.1020"></a><span id="l19.1020" class="difflineplus">+    // separator</span>
<a href="#l19.1021"></a><span id="l19.1021" class="difflineplus">+    this._contentSandbox.chooseAppSep = this._document</span>
<a href="#l19.1022"></a><span id="l19.1022" class="difflineplus">+                                            .createElementNS(XUL_NS, &quot;menuseparator&quot;);</span>
<a href="#l19.1023"></a><span id="l19.1023" class="difflineplus">+    codeStr += &quot;handlersMenuPopup.appendChild(chooseAppSep); &quot;;</span>
<a href="#l19.1024"></a><span id="l19.1024" class="difflineplus">+</span>
<a href="#l19.1025"></a><span id="l19.1025" class="difflineplus">+    Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.1026"></a><span id="l19.1026" class="difflineplus">+</span>
<a href="#l19.1027"></a><span id="l19.1027" class="difflineplus">+    var historySvc = Components.classes[&quot;@mozilla.org/browser/nav-history-service;1&quot;]</span>
<a href="#l19.1028"></a><span id="l19.1028" class="difflineplus">+                               .getService(Components.interfaces.nsINavHistoryService);</span>
<a href="#l19.1029"></a><span id="l19.1029" class="difflineplus">+    historySvc.addObserver(this, false);</span>
<a href="#l19.1030"></a><span id="l19.1030" class="difflineplus">+</span>
<a href="#l19.1031"></a><span id="l19.1031" class="difflineplus">+    // List of web handlers</span>
<a href="#l19.1032"></a><span id="l19.1032" class="difflineplus">+    var wccr = Components.classes[&quot;@mozilla.org/embeddor.implemented/web-content-handler-registrar;1&quot;]</span>
<a href="#l19.1033"></a><span id="l19.1033" class="difflineplus">+                         .getService(Components.interfaces.nsIWebContentConverterService);</span>
<a href="#l19.1034"></a><span id="l19.1034" class="difflineplus">+    var handlers = wccr.getContentHandlers(this._getMimeTypeForFeedType(feedType), {});</span>
<a href="#l19.1035"></a><span id="l19.1035" class="difflineplus">+    if (handlers.length != 0) {</span>
<a href="#l19.1036"></a><span id="l19.1036" class="difflineplus">+      for (let i = 0; i &lt; handlers.length; ++i) {</span>
<a href="#l19.1037"></a><span id="l19.1037" class="difflineplus">+        menuItem = this._document.createElementNS(XUL_NS, &quot;menuitem&quot;);</span>
<a href="#l19.1038"></a><span id="l19.1038" class="difflineplus">+        menuItem.className = &quot;menuitem-iconic&quot;;</span>
<a href="#l19.1039"></a><span id="l19.1039" class="difflineplus">+        menuItem.setAttribute(&quot;label&quot;, handlers[i].name);</span>
<a href="#l19.1040"></a><span id="l19.1040" class="difflineplus">+        menuItem.setAttribute(&quot;handlerType&quot;, &quot;web&quot;);</span>
<a href="#l19.1041"></a><span id="l19.1041" class="difflineplus">+        menuItem.setAttribute(&quot;webhandlerurl&quot;, handlers[i].uri);</span>
<a href="#l19.1042"></a><span id="l19.1042" class="difflineplus">+        this._contentSandbox.menuItem = menuItem;</span>
<a href="#l19.1043"></a><span id="l19.1043" class="difflineplus">+        codeStr = &quot;handlersMenuPopup.appendChild(menuItem);&quot;;</span>
<a href="#l19.1044"></a><span id="l19.1044" class="difflineplus">+        Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.1045"></a><span id="l19.1045" class="difflineplus">+</span>
<a href="#l19.1046"></a><span id="l19.1046" class="difflineplus">+        let uri = makeURI(handlers[i].uri);</span>
<a href="#l19.1047"></a><span id="l19.1047" class="difflineplus">+        if (!this._setFaviconForWebReader(uri, menuItem)) {</span>
<a href="#l19.1048"></a><span id="l19.1048" class="difflineplus">+          if (uri &amp;&amp; /^https?/.test(uri.scheme)) {</span>
<a href="#l19.1049"></a><span id="l19.1049" class="difflineplus">+            let iconURL = makeURI(uri.resolve(&quot;/favicon.ico&quot;));</span>
<a href="#l19.1050"></a><span id="l19.1050" class="difflineplus">+            this._faviconService.setAndLoadFaviconForPage(uri, iconURL, true);</span>
<a href="#l19.1051"></a><span id="l19.1051" class="difflineplus">+          }</span>
<a href="#l19.1052"></a><span id="l19.1052" class="difflineplus">+        }</span>
<a href="#l19.1053"></a><span id="l19.1053" class="difflineplus">+      }</span>
<a href="#l19.1054"></a><span id="l19.1054" class="difflineplus">+      this._contentSandbox.menuItem = null;</span>
<a href="#l19.1055"></a><span id="l19.1055" class="difflineplus">+    }</span>
<a href="#l19.1056"></a><span id="l19.1056" class="difflineplus">+</span>
<a href="#l19.1057"></a><span id="l19.1057" class="difflineplus">+    this._setSelectedHandler(feedType);</span>
<a href="#l19.1058"></a><span id="l19.1058" class="difflineplus">+</span>
<a href="#l19.1059"></a><span id="l19.1059" class="difflineplus">+    // &quot;Subscribe using...&quot;</span>
<a href="#l19.1060"></a><span id="l19.1060" class="difflineplus">+    this._setSubscribeUsingLabel();</span>
<a href="#l19.1061"></a><span id="l19.1061" class="difflineplus">+</span>
<a href="#l19.1062"></a><span id="l19.1062" class="difflineplus">+    // &quot;Always use...&quot; checkbox initial state</span>
<a href="#l19.1063"></a><span id="l19.1063" class="difflineplus">+    this._setAlwaysUseCheckedState(feedType);</span>
<a href="#l19.1064"></a><span id="l19.1064" class="difflineplus">+    this._setAlwaysUseLabel();</span>
<a href="#l19.1065"></a><span id="l19.1065" class="difflineplus">+</span>
<a href="#l19.1066"></a><span id="l19.1066" class="difflineplus">+    // We update the &quot;Always use..&quot; checkbox label whenever the selected item</span>
<a href="#l19.1067"></a><span id="l19.1067" class="difflineplus">+    // in the list is changed</span>
<a href="#l19.1068"></a><span id="l19.1068" class="difflineplus">+    handlersMenuPopup.addEventListener(&quot;command&quot;, this, false);</span>
<a href="#l19.1069"></a><span id="l19.1069" class="difflineplus">+</span>
<a href="#l19.1070"></a><span id="l19.1070" class="difflineplus">+    // Set up the &quot;Subscribe Now&quot; button</span>
<a href="#l19.1071"></a><span id="l19.1071" class="difflineplus">+    this._document</span>
<a href="#l19.1072"></a><span id="l19.1072" class="difflineplus">+        .getElementById(&quot;subscribeButton&quot;)</span>
<a href="#l19.1073"></a><span id="l19.1073" class="difflineplus">+        .addEventListener(&quot;command&quot;, this, false);</span>
<a href="#l19.1074"></a><span id="l19.1074" class="difflineplus">+</span>
<a href="#l19.1075"></a><span id="l19.1075" class="difflineplus">+    // first-run ui</span>
<a href="#l19.1076"></a><span id="l19.1076" class="difflineplus">+    var showFirstRunUI = true;</span>
<a href="#l19.1077"></a><span id="l19.1077" class="difflineplus">+    try {</span>
<a href="#l19.1078"></a><span id="l19.1078" class="difflineplus">+      showFirstRunUI = prefs.getBoolPref(PREF_SHOW_FIRST_RUN_UI);</span>
<a href="#l19.1079"></a><span id="l19.1079" class="difflineplus">+    }</span>
<a href="#l19.1080"></a><span id="l19.1080" class="difflineplus">+    catch (ex) {</span>
<a href="#l19.1081"></a><span id="l19.1081" class="difflineplus">+    }</span>
<a href="#l19.1082"></a><span id="l19.1082" class="difflineplus">+    if (showFirstRunUI) {</span>
<a href="#l19.1083"></a><span id="l19.1083" class="difflineplus">+      var textfeedinfo1, textfeedinfo2;</span>
<a href="#l19.1084"></a><span id="l19.1084" class="difflineplus">+      switch (feedType) {</span>
<a href="#l19.1085"></a><span id="l19.1085" class="difflineplus">+        case Components.interfaces.nsIFeed.TYPE_VIDEO:</span>
<a href="#l19.1086"></a><span id="l19.1086" class="difflineplus">+          textfeedinfo1 = &quot;feedSubscriptionVideoPodcast1&quot;;</span>
<a href="#l19.1087"></a><span id="l19.1087" class="difflineplus">+          textfeedinfo2 = &quot;feedSubscriptionVideoPodcast2&quot;;</span>
<a href="#l19.1088"></a><span id="l19.1088" class="difflineplus">+          break;</span>
<a href="#l19.1089"></a><span id="l19.1089" class="difflineplus">+        case Components.interfaces.nsIFeed.TYPE_AUDIO:</span>
<a href="#l19.1090"></a><span id="l19.1090" class="difflineplus">+          textfeedinfo1 = &quot;feedSubscriptionAudioPodcast1&quot;;</span>
<a href="#l19.1091"></a><span id="l19.1091" class="difflineplus">+          textfeedinfo2 = &quot;feedSubscriptionAudioPodcast2&quot;;</span>
<a href="#l19.1092"></a><span id="l19.1092" class="difflineplus">+          break;</span>
<a href="#l19.1093"></a><span id="l19.1093" class="difflineplus">+        default:</span>
<a href="#l19.1094"></a><span id="l19.1094" class="difflineplus">+          textfeedinfo1 = &quot;feedSubscriptionFeed1&quot;;</span>
<a href="#l19.1095"></a><span id="l19.1095" class="difflineplus">+          textfeedinfo2 = &quot;feedSubscriptionFeed2&quot;;</span>
<a href="#l19.1096"></a><span id="l19.1096" class="difflineplus">+      }</span>
<a href="#l19.1097"></a><span id="l19.1097" class="difflineplus">+</span>
<a href="#l19.1098"></a><span id="l19.1098" class="difflineplus">+      this._contentSandbox.feedinfo1 =</span>
<a href="#l19.1099"></a><span id="l19.1099" class="difflineplus">+        this._document.getElementById(&quot;feedSubscriptionInfo1&quot;);</span>
<a href="#l19.1100"></a><span id="l19.1100" class="difflineplus">+      this._contentSandbox.feedinfo1Str = this._getString(textfeedinfo1);</span>
<a href="#l19.1101"></a><span id="l19.1101" class="difflineplus">+      this._contentSandbox.feedinfo2 =</span>
<a href="#l19.1102"></a><span id="l19.1102" class="difflineplus">+        this._document.getElementById(&quot;feedSubscriptionInfo2&quot;);</span>
<a href="#l19.1103"></a><span id="l19.1103" class="difflineplus">+      this._contentSandbox.feedinfo2Str = this._getString(textfeedinfo2);</span>
<a href="#l19.1104"></a><span id="l19.1104" class="difflineplus">+      this._contentSandbox.header = header;</span>
<a href="#l19.1105"></a><span id="l19.1105" class="difflineplus">+      codeStr = &quot;feedinfo1.textContent = feedinfo1Str; &quot; +</span>
<a href="#l19.1106"></a><span id="l19.1106" class="difflineplus">+                &quot;feedinfo2.textContent = feedinfo2Str; &quot; +</span>
<a href="#l19.1107"></a><span id="l19.1107" class="difflineplus">+                &quot;header.setAttribute('firstrun', 'true');&quot;;</span>
<a href="#l19.1108"></a><span id="l19.1108" class="difflineplus">+      Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.1109"></a><span id="l19.1109" class="difflineplus">+      prefs.setBoolPref(PREF_SHOW_FIRST_RUN_UI, false);</span>
<a href="#l19.1110"></a><span id="l19.1110" class="difflineplus">+    }</span>
<a href="#l19.1111"></a><span id="l19.1111" class="difflineplus">+  },</span>
<a href="#l19.1112"></a><span id="l19.1112" class="difflineplus">+</span>
<a href="#l19.1113"></a><span id="l19.1113" class="difflineplus">+  /**</span>
<a href="#l19.1114"></a><span id="l19.1114" class="difflineplus">+   * Returns the original URI object of the feed and ensures that this</span>
<a href="#l19.1115"></a><span id="l19.1115" class="difflineplus">+   * component is only ever invoked from the preview document.</span>
<a href="#l19.1116"></a><span id="l19.1116" class="difflineplus">+   * @param aWindow</span>
<a href="#l19.1117"></a><span id="l19.1117" class="difflineplus">+   *        The window of the document invoking the BrowserFeedWriter</span>
<a href="#l19.1118"></a><span id="l19.1118" class="difflineplus">+   */</span>
<a href="#l19.1119"></a><span id="l19.1119" class="difflineplus">+  _getOriginalURI: function getOriginalURI(aWindow) {</span>
<a href="#l19.1120"></a><span id="l19.1120" class="difflineplus">+    var chan = aWindow.QueryInterface(Components.interfaces.nsIInterfaceRequestor)</span>
<a href="#l19.1121"></a><span id="l19.1121" class="difflineplus">+                      .getInterface(Components.interfaces.nsIWebNavigation)</span>
<a href="#l19.1122"></a><span id="l19.1122" class="difflineplus">+                      .QueryInterface(Components.interfaces.nsIDocShell)</span>
<a href="#l19.1123"></a><span id="l19.1123" class="difflineplus">+                      .currentDocumentChannel;</span>
<a href="#l19.1124"></a><span id="l19.1124" class="difflineplus">+</span>
<a href="#l19.1125"></a><span id="l19.1125" class="difflineplus">+    var uri = makeURI(SUBSCRIBE_PAGE_URI);</span>
<a href="#l19.1126"></a><span id="l19.1126" class="difflineplus">+    var resolvedURI = Components.classes[&quot;@mozilla.org/chrome/chrome-registry;1&quot;]</span>
<a href="#l19.1127"></a><span id="l19.1127" class="difflineplus">+                                .getService(Components.interfaces.nsIChromeRegistry)</span>
<a href="#l19.1128"></a><span id="l19.1128" class="difflineplus">+                                .convertChromeURL(uri);</span>
<a href="#l19.1129"></a><span id="l19.1129" class="difflineplus">+</span>
<a href="#l19.1130"></a><span id="l19.1130" class="difflineplus">+    if (resolvedURI.equals(chan.URI))</span>
<a href="#l19.1131"></a><span id="l19.1131" class="difflineplus">+      return chan.originalURI;</span>
<a href="#l19.1132"></a><span id="l19.1132" class="difflineplus">+</span>
<a href="#l19.1133"></a><span id="l19.1133" class="difflineplus">+    return null;</span>
<a href="#l19.1134"></a><span id="l19.1134" class="difflineplus">+  },</span>
<a href="#l19.1135"></a><span id="l19.1135" class="difflineplus">+</span>
<a href="#l19.1136"></a><span id="l19.1136" class="difflineplus">+  _window: null,</span>
<a href="#l19.1137"></a><span id="l19.1137" class="difflineplus">+  _document: null,</span>
<a href="#l19.1138"></a><span id="l19.1138" class="difflineplus">+  _feedURI: null,</span>
<a href="#l19.1139"></a><span id="l19.1139" class="difflineplus">+  _feedPrincipal: null,</span>
<a href="#l19.1140"></a><span id="l19.1140" class="difflineplus">+</span>
<a href="#l19.1141"></a><span id="l19.1141" class="difflineplus">+  // nsIFeedWriter</span>
<a href="#l19.1142"></a><span id="l19.1142" class="difflineplus">+  init: function init(aWindow) {</span>
<a href="#l19.1143"></a><span id="l19.1143" class="difflineplus">+    // Explicitly wrap |window| in an XPCNativeWrapper to make sure</span>
<a href="#l19.1144"></a><span id="l19.1144" class="difflineplus">+    // it's a real native object! This will throw an exception if we</span>
<a href="#l19.1145"></a><span id="l19.1145" class="difflineplus">+    // get a non-native object.</span>
<a href="#l19.1146"></a><span id="l19.1146" class="difflineplus">+    var window = new XPCNativeWrapper(aWindow);</span>
<a href="#l19.1147"></a><span id="l19.1147" class="difflineplus">+    this._feedURI = this._getOriginalURI(window);</span>
<a href="#l19.1148"></a><span id="l19.1148" class="difflineplus">+    if (!this._feedURI)</span>
<a href="#l19.1149"></a><span id="l19.1149" class="difflineplus">+      return;</span>
<a href="#l19.1150"></a><span id="l19.1150" class="difflineplus">+</span>
<a href="#l19.1151"></a><span id="l19.1151" class="difflineplus">+    this._window = window;</span>
<a href="#l19.1152"></a><span id="l19.1152" class="difflineplus">+    this._document = window.document;</span>
<a href="#l19.1153"></a><span id="l19.1153" class="difflineplus">+</span>
<a href="#l19.1154"></a><span id="l19.1154" class="difflineplus">+    var secman = Components.classes[&quot;@mozilla.org/scriptsecuritymanager;1&quot;]</span>
<a href="#l19.1155"></a><span id="l19.1155" class="difflineplus">+                           .getService(Components.interfaces.nsIScriptSecurityManager);</span>
<a href="#l19.1156"></a><span id="l19.1156" class="difflineplus">+    this._feedPrincipal = secman.getCodebasePrincipal(this._feedURI);</span>
<a href="#l19.1157"></a><span id="l19.1157" class="difflineplus">+</span>
<a href="#l19.1158"></a><span id="l19.1158" class="difflineplus">+    LOG(&quot;Subscribe Preview: feed uri = &quot; + this._window.location.href);</span>
<a href="#l19.1159"></a><span id="l19.1159" class="difflineplus">+</span>
<a href="#l19.1160"></a><span id="l19.1160" class="difflineplus">+    // Set up the subscription UI</span>
<a href="#l19.1161"></a><span id="l19.1161" class="difflineplus">+    this._initSubscriptionUI();</span>
<a href="#l19.1162"></a><span id="l19.1162" class="difflineplus">+    var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l19.1163"></a><span id="l19.1163" class="difflineplus">+                          .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l19.1164"></a><span id="l19.1164" class="difflineplus">+    prefs.addObserver(PREF_SELECTED_ACTION, this, false);</span>
<a href="#l19.1165"></a><span id="l19.1165" class="difflineplus">+    prefs.addObserver(PREF_SELECTED_READER, this, false);</span>
<a href="#l19.1166"></a><span id="l19.1166" class="difflineplus">+    prefs.addObserver(PREF_SELECTED_WEB, this, false);</span>
<a href="#l19.1167"></a><span id="l19.1167" class="difflineplus">+    prefs.addObserver(PREF_SELECTED_APP, this, false);</span>
<a href="#l19.1168"></a><span id="l19.1168" class="difflineplus">+    prefs.addObserver(PREF_VIDEO_SELECTED_ACTION, this, false);</span>
<a href="#l19.1169"></a><span id="l19.1169" class="difflineplus">+    prefs.addObserver(PREF_VIDEO_SELECTED_READER, this, false);</span>
<a href="#l19.1170"></a><span id="l19.1170" class="difflineplus">+    prefs.addObserver(PREF_VIDEO_SELECTED_WEB, this, false);</span>
<a href="#l19.1171"></a><span id="l19.1171" class="difflineplus">+    prefs.addObserver(PREF_VIDEO_SELECTED_APP, this, false);</span>
<a href="#l19.1172"></a><span id="l19.1172" class="difflineplus">+</span>
<a href="#l19.1173"></a><span id="l19.1173" class="difflineplus">+    prefs.addObserver(PREF_AUDIO_SELECTED_ACTION, this, false);</span>
<a href="#l19.1174"></a><span id="l19.1174" class="difflineplus">+    prefs.addObserver(PREF_AUDIO_SELECTED_READER, this, false);</span>
<a href="#l19.1175"></a><span id="l19.1175" class="difflineplus">+    prefs.addObserver(PREF_AUDIO_SELECTED_WEB, this, false);</span>
<a href="#l19.1176"></a><span id="l19.1176" class="difflineplus">+    prefs.addObserver(PREF_AUDIO_SELECTED_APP, this, false);</span>
<a href="#l19.1177"></a><span id="l19.1177" class="difflineplus">+  },</span>
<a href="#l19.1178"></a><span id="l19.1178" class="difflineplus">+</span>
<a href="#l19.1179"></a><span id="l19.1179" class="difflineplus">+  writeContent: function writeContent() {</span>
<a href="#l19.1180"></a><span id="l19.1180" class="difflineplus">+    if (!this._window)</span>
<a href="#l19.1181"></a><span id="l19.1181" class="difflineplus">+      return;</span>
<a href="#l19.1182"></a><span id="l19.1182" class="difflineplus">+</span>
<a href="#l19.1183"></a><span id="l19.1183" class="difflineplus">+    try {</span>
<a href="#l19.1184"></a><span id="l19.1184" class="difflineplus">+      // Set up the feed content</span>
<a href="#l19.1185"></a><span id="l19.1185" class="difflineplus">+      var container = this._getContainer();</span>
<a href="#l19.1186"></a><span id="l19.1186" class="difflineplus">+      if (!container)</span>
<a href="#l19.1187"></a><span id="l19.1187" class="difflineplus">+        return;</span>
<a href="#l19.1188"></a><span id="l19.1188" class="difflineplus">+</span>
<a href="#l19.1189"></a><span id="l19.1189" class="difflineplus">+      this._setTitleText(container);</span>
<a href="#l19.1190"></a><span id="l19.1190" class="difflineplus">+      this._setTitleImage(container);</span>
<a href="#l19.1191"></a><span id="l19.1191" class="difflineplus">+      this._writeFeedContent(container);</span>
<a href="#l19.1192"></a><span id="l19.1192" class="difflineplus">+    }</span>
<a href="#l19.1193"></a><span id="l19.1193" class="difflineplus">+    finally {</span>
<a href="#l19.1194"></a><span id="l19.1194" class="difflineplus">+      this._removeFeedFromCache();</span>
<a href="#l19.1195"></a><span id="l19.1195" class="difflineplus">+    }</span>
<a href="#l19.1196"></a><span id="l19.1196" class="difflineplus">+  },</span>
<a href="#l19.1197"></a><span id="l19.1197" class="difflineplus">+</span>
<a href="#l19.1198"></a><span id="l19.1198" class="difflineplus">+  close: function close() {</span>
<a href="#l19.1199"></a><span id="l19.1199" class="difflineplus">+    this._document</span>
<a href="#l19.1200"></a><span id="l19.1200" class="difflineplus">+        .getElementById(&quot;handlersMenuPopup&quot;)</span>
<a href="#l19.1201"></a><span id="l19.1201" class="difflineplus">+        .removeEventListener(&quot;command&quot;, this, false);</span>
<a href="#l19.1202"></a><span id="l19.1202" class="difflineplus">+    this._document</span>
<a href="#l19.1203"></a><span id="l19.1203" class="difflineplus">+        .getElementById(&quot;subscribeButton&quot;)</span>
<a href="#l19.1204"></a><span id="l19.1204" class="difflineplus">+        .removeEventListener(&quot;command&quot;, this, false);</span>
<a href="#l19.1205"></a><span id="l19.1205" class="difflineplus">+    this._document = null;</span>
<a href="#l19.1206"></a><span id="l19.1206" class="difflineplus">+    this._window = null;</span>
<a href="#l19.1207"></a><span id="l19.1207" class="difflineplus">+    var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l19.1208"></a><span id="l19.1208" class="difflineplus">+                          .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l19.1209"></a><span id="l19.1209" class="difflineplus">+    prefs.removeObserver(PREF_SELECTED_ACTION, this);</span>
<a href="#l19.1210"></a><span id="l19.1210" class="difflineplus">+    prefs.removeObserver(PREF_SELECTED_READER, this);</span>
<a href="#l19.1211"></a><span id="l19.1211" class="difflineplus">+    prefs.removeObserver(PREF_SELECTED_WEB, this);</span>
<a href="#l19.1212"></a><span id="l19.1212" class="difflineplus">+    prefs.removeObserver(PREF_SELECTED_APP, this);</span>
<a href="#l19.1213"></a><span id="l19.1213" class="difflineplus">+    prefs.removeObserver(PREF_VIDEO_SELECTED_ACTION, this);</span>
<a href="#l19.1214"></a><span id="l19.1214" class="difflineplus">+    prefs.removeObserver(PREF_VIDEO_SELECTED_READER, this);</span>
<a href="#l19.1215"></a><span id="l19.1215" class="difflineplus">+    prefs.removeObserver(PREF_VIDEO_SELECTED_WEB, this);</span>
<a href="#l19.1216"></a><span id="l19.1216" class="difflineplus">+    prefs.removeObserver(PREF_VIDEO_SELECTED_APP, this);</span>
<a href="#l19.1217"></a><span id="l19.1217" class="difflineplus">+</span>
<a href="#l19.1218"></a><span id="l19.1218" class="difflineplus">+    prefs.removeObserver(PREF_AUDIO_SELECTED_ACTION, this);</span>
<a href="#l19.1219"></a><span id="l19.1219" class="difflineplus">+    prefs.removeObserver(PREF_AUDIO_SELECTED_READER, this);</span>
<a href="#l19.1220"></a><span id="l19.1220" class="difflineplus">+    prefs.removeObserver(PREF_AUDIO_SELECTED_WEB, this);</span>
<a href="#l19.1221"></a><span id="l19.1221" class="difflineplus">+    prefs.removeObserver(PREF_AUDIO_SELECTED_APP, this);</span>
<a href="#l19.1222"></a><span id="l19.1222" class="difflineplus">+</span>
<a href="#l19.1223"></a><span id="l19.1223" class="difflineplus">+    this._removeFeedFromCache();</span>
<a href="#l19.1224"></a><span id="l19.1224" class="difflineplus">+    this.__faviconService = null;</span>
<a href="#l19.1225"></a><span id="l19.1225" class="difflineplus">+    this.__bundle = null;</span>
<a href="#l19.1226"></a><span id="l19.1226" class="difflineplus">+    this._feedURI = null;</span>
<a href="#l19.1227"></a><span id="l19.1227" class="difflineplus">+    this.__contentSandbox = null;</span>
<a href="#l19.1228"></a><span id="l19.1228" class="difflineplus">+</span>
<a href="#l19.1229"></a><span id="l19.1229" class="difflineplus">+    var historySvc = Components.classes[&quot;@mozilla.org/browser/nav-history-service;1&quot;]</span>
<a href="#l19.1230"></a><span id="l19.1230" class="difflineplus">+                               .getService(Components.interfaces.nsINavHistoryService);</span>
<a href="#l19.1231"></a><span id="l19.1231" class="difflineplus">+    historySvc.removeObserver(this);</span>
<a href="#l19.1232"></a><span id="l19.1232" class="difflineplus">+  },</span>
<a href="#l19.1233"></a><span id="l19.1233" class="difflineplus">+</span>
<a href="#l19.1234"></a><span id="l19.1234" class="difflineplus">+  _removeFeedFromCache: function removeFeedFromCache() {</span>
<a href="#l19.1235"></a><span id="l19.1235" class="difflineplus">+    if (this._feedURI) {</span>
<a href="#l19.1236"></a><span id="l19.1236" class="difflineplus">+      var feedService = Components.classes[&quot;@mozilla.org/browser/feeds/result-service;1&quot;]</span>
<a href="#l19.1237"></a><span id="l19.1237" class="difflineplus">+                                  .getService(Components.interfaces.nsIFeedResultService);</span>
<a href="#l19.1238"></a><span id="l19.1238" class="difflineplus">+      feedService.removeFeedResult(this._feedURI);</span>
<a href="#l19.1239"></a><span id="l19.1239" class="difflineplus">+      this._feedURI = null;</span>
<a href="#l19.1240"></a><span id="l19.1240" class="difflineplus">+    }</span>
<a href="#l19.1241"></a><span id="l19.1241" class="difflineplus">+  },</span>
<a href="#l19.1242"></a><span id="l19.1242" class="difflineplus">+</span>
<a href="#l19.1243"></a><span id="l19.1243" class="difflineplus">+  subscribe: function subscribe() {</span>
<a href="#l19.1244"></a><span id="l19.1244" class="difflineplus">+    var feedType = this._getFeedType();</span>
<a href="#l19.1245"></a><span id="l19.1245" class="difflineplus">+</span>
<a href="#l19.1246"></a><span id="l19.1246" class="difflineplus">+    // Subscribe to the feed using the selected handler and save prefs</span>
<a href="#l19.1247"></a><span id="l19.1247" class="difflineplus">+    var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l19.1248"></a><span id="l19.1248" class="difflineplus">+                          .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l19.1249"></a><span id="l19.1249" class="difflineplus">+    var defaultHandler = &quot;reader&quot;;</span>
<a href="#l19.1250"></a><span id="l19.1250" class="difflineplus">+    var useAsDefault = this._document.getElementById(&quot;alwaysUse&quot;)</span>
<a href="#l19.1251"></a><span id="l19.1251" class="difflineplus">+                                     .getAttribute(&quot;checked&quot;);</span>
<a href="#l19.1252"></a><span id="l19.1252" class="difflineplus">+</span>
<a href="#l19.1253"></a><span id="l19.1253" class="difflineplus">+    var handlersMenuList = this._document.getElementById(&quot;handlersMenuList&quot;);</span>
<a href="#l19.1254"></a><span id="l19.1254" class="difflineplus">+    var selectedItem = this._getSelectedItemFromMenulist(handlersMenuList);</span>
<a href="#l19.1255"></a><span id="l19.1255" class="difflineplus">+</span>
<a href="#l19.1256"></a><span id="l19.1256" class="difflineplus">+    // Show the file picker before subscribing if the</span>
<a href="#l19.1257"></a><span id="l19.1257" class="difflineplus">+    // choose application menuitem was chosen using the keyboard</span>
<a href="#l19.1258"></a><span id="l19.1258" class="difflineplus">+    if (selectedItem.id == &quot;chooseApplicationMenuItem&quot;) {</span>
<a href="#l19.1259"></a><span id="l19.1259" class="difflineplus">+      if (!this._chooseClientApp())</span>
<a href="#l19.1260"></a><span id="l19.1260" class="difflineplus">+        return;</span>
<a href="#l19.1261"></a><span id="l19.1261" class="difflineplus">+</span>
<a href="#l19.1262"></a><span id="l19.1262" class="difflineplus">+      selectedItem = this._getSelectedItemFromMenulist(handlersMenuList);</span>
<a href="#l19.1263"></a><span id="l19.1263" class="difflineplus">+    }</span>
<a href="#l19.1264"></a><span id="l19.1264" class="difflineplus">+</span>
<a href="#l19.1265"></a><span id="l19.1265" class="difflineplus">+    if (selectedItem.hasAttribute(&quot;webhandlerurl&quot;)) {</span>
<a href="#l19.1266"></a><span id="l19.1266" class="difflineplus">+      var webURI = selectedItem.getAttribute(&quot;webhandlerurl&quot;);</span>
<a href="#l19.1267"></a><span id="l19.1267" class="difflineplus">+      prefs.setCharPref(getPrefReaderForType(feedType), &quot;web&quot;);</span>
<a href="#l19.1268"></a><span id="l19.1268" class="difflineplus">+</span>
<a href="#l19.1269"></a><span id="l19.1269" class="difflineplus">+      var supportsString = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l19.1270"></a><span id="l19.1270" class="difflineplus">+                                     .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l19.1271"></a><span id="l19.1271" class="difflineplus">+      supportsString.data = webURI;</span>
<a href="#l19.1272"></a><span id="l19.1272" class="difflineplus">+      prefs.setComplexValue(getPrefWebForType(feedType), Components.interfaces.nsISupportsString,</span>
<a href="#l19.1273"></a><span id="l19.1273" class="difflineplus">+                            supportsString);</span>
<a href="#l19.1274"></a><span id="l19.1274" class="difflineplus">+</span>
<a href="#l19.1275"></a><span id="l19.1275" class="difflineplus">+      var wccr = Components.classes[&quot;@mozilla.org/embeddor.implemented/web-content-handler-registrar;1&quot;]</span>
<a href="#l19.1276"></a><span id="l19.1276" class="difflineplus">+                           .getService(Components.interfaces.nsIWebContentConverterService);</span>
<a href="#l19.1277"></a><span id="l19.1277" class="difflineplus">+      var handler = wccr.getWebContentHandlerByURI(this._getMimeTypeForFeedType(feedType), webURI);</span>
<a href="#l19.1278"></a><span id="l19.1278" class="difflineplus">+      if (handler) {</span>
<a href="#l19.1279"></a><span id="l19.1279" class="difflineplus">+        if (useAsDefault)</span>
<a href="#l19.1280"></a><span id="l19.1280" class="difflineplus">+          wccr.setAutoHandler(this._getMimeTypeForFeedType(feedType), handler);</span>
<a href="#l19.1281"></a><span id="l19.1281" class="difflineplus">+</span>
<a href="#l19.1282"></a><span id="l19.1282" class="difflineplus">+        this._window.location.href = handler.getHandlerURI(this._window.location.href);</span>
<a href="#l19.1283"></a><span id="l19.1283" class="difflineplus">+        return;</span>
<a href="#l19.1284"></a><span id="l19.1284" class="difflineplus">+      }</span>
<a href="#l19.1285"></a><span id="l19.1285" class="difflineplus">+    }</span>
<a href="#l19.1286"></a><span id="l19.1286" class="difflineplus">+    else {</span>
<a href="#l19.1287"></a><span id="l19.1287" class="difflineplus">+      switch (selectedItem.id) {</span>
<a href="#l19.1288"></a><span id="l19.1288" class="difflineplus">+        case &quot;selectedAppMenuItem&quot;:</span>
<a href="#l19.1289"></a><span id="l19.1289" class="difflineplus">+          prefs.setComplexValue(getPrefAppForType(feedType), Components.interfaces.nsILocalFile,</span>
<a href="#l19.1290"></a><span id="l19.1290" class="difflineplus">+                                this._selectedApp);</span>
<a href="#l19.1291"></a><span id="l19.1291" class="difflineplus">+          prefs.setCharPref(getPrefReaderForType(feedType), &quot;client&quot;);</span>
<a href="#l19.1292"></a><span id="l19.1292" class="difflineplus">+          break;</span>
<a href="#l19.1293"></a><span id="l19.1293" class="difflineplus">+        case &quot;defaultHandlerMenuItem&quot;:</span>
<a href="#l19.1294"></a><span id="l19.1294" class="difflineplus">+          prefs.setComplexValue(getPrefAppForType(feedType), Components.interfaces.nsILocalFile,</span>
<a href="#l19.1295"></a><span id="l19.1295" class="difflineplus">+                                this._defaultSystemReader);</span>
<a href="#l19.1296"></a><span id="l19.1296" class="difflineplus">+          prefs.setCharPref(getPrefReaderForType(feedType), &quot;client&quot;);</span>
<a href="#l19.1297"></a><span id="l19.1297" class="difflineplus">+          break;</span>
<a href="#l19.1298"></a><span id="l19.1298" class="difflineplus">+        case &quot;messengerFeedsMenuItem&quot;:</span>
<a href="#l19.1299"></a><span id="l19.1299" class="difflineplus">+          defaultHandler = &quot;messenger&quot;;</span>
<a href="#l19.1300"></a><span id="l19.1300" class="difflineplus">+          prefs.setCharPref(getPrefReaderForType(feedType), &quot;messenger&quot;);</span>
<a href="#l19.1301"></a><span id="l19.1301" class="difflineplus">+          break;</span>
<a href="#l19.1302"></a><span id="l19.1302" class="difflineplus">+      }</span>
<a href="#l19.1303"></a><span id="l19.1303" class="difflineplus">+      var feedService = Components.classes[&quot;@mozilla.org/browser/feeds/result-service;1&quot;]</span>
<a href="#l19.1304"></a><span id="l19.1304" class="difflineplus">+                                  .getService(Components.interfaces.nsIFeedResultService);</span>
<a href="#l19.1305"></a><span id="l19.1305" class="difflineplus">+</span>
<a href="#l19.1306"></a><span id="l19.1306" class="difflineplus">+      // Pull the title and subtitle out of the document</span>
<a href="#l19.1307"></a><span id="l19.1307" class="difflineplus">+      var feedTitle = this._document.getElementById(TITLE_ID).textContent;</span>
<a href="#l19.1308"></a><span id="l19.1308" class="difflineplus">+      var feedSubtitle = this._document.getElementById(SUBTITLE_ID).textContent;</span>
<a href="#l19.1309"></a><span id="l19.1309" class="difflineplus">+      feedService.addToClientReader(this._window.location.href, feedTitle, feedSubtitle, feedType);</span>
<a href="#l19.1310"></a><span id="l19.1310" class="difflineplus">+    }</span>
<a href="#l19.1311"></a><span id="l19.1311" class="difflineplus">+</span>
<a href="#l19.1312"></a><span id="l19.1312" class="difflineplus">+    // If &quot;Always use...&quot; is checked, we should set PREF_*SELECTED_ACTION</span>
<a href="#l19.1313"></a><span id="l19.1313" class="difflineplus">+    // to either &quot;reader&quot; (If a web reader or if an application is selected),</span>
<a href="#l19.1314"></a><span id="l19.1314" class="difflineplus">+    // or to &quot;messenger&quot; (if the messenger feeds option is selected).</span>
<a href="#l19.1315"></a><span id="l19.1315" class="difflineplus">+    // Otherwise, we should set it to &quot;ask&quot;</span>
<a href="#l19.1316"></a><span id="l19.1316" class="difflineplus">+    if (useAsDefault)</span>
<a href="#l19.1317"></a><span id="l19.1317" class="difflineplus">+      prefs.setCharPref(getPrefActionForType(feedType), defaultHandler);</span>
<a href="#l19.1318"></a><span id="l19.1318" class="difflineplus">+    else</span>
<a href="#l19.1319"></a><span id="l19.1319" class="difflineplus">+      prefs.setCharPref(getPrefActionForType(feedType), &quot;ask&quot;);</span>
<a href="#l19.1320"></a><span id="l19.1320" class="difflineplus">+  },</span>
<a href="#l19.1321"></a><span id="l19.1321" class="difflineplus">+</span>
<a href="#l19.1322"></a><span id="l19.1322" class="difflineplus">+  // nsIObserver</span>
<a href="#l19.1323"></a><span id="l19.1323" class="difflineplus">+  observe: function observe(subject, topic, data) {</span>
<a href="#l19.1324"></a><span id="l19.1324" class="difflineplus">+    // see init()</span>
<a href="#l19.1325"></a><span id="l19.1325" class="difflineplus">+    subject = new XPCNativeWrapper(subject);</span>
<a href="#l19.1326"></a><span id="l19.1326" class="difflineplus">+</span>
<a href="#l19.1327"></a><span id="l19.1327" class="difflineplus">+    if (!this._window) {</span>
<a href="#l19.1328"></a><span id="l19.1328" class="difflineplus">+      // this._window is null unless this.init was called with a trusted</span>
<a href="#l19.1329"></a><span id="l19.1329" class="difflineplus">+      // window object.</span>
<a href="#l19.1330"></a><span id="l19.1330" class="difflineplus">+      return;</span>
<a href="#l19.1331"></a><span id="l19.1331" class="difflineplus">+    }</span>
<a href="#l19.1332"></a><span id="l19.1332" class="difflineplus">+</span>
<a href="#l19.1333"></a><span id="l19.1333" class="difflineplus">+    var feedType = this._getFeedType();</span>
<a href="#l19.1334"></a><span id="l19.1334" class="difflineplus">+</span>
<a href="#l19.1335"></a><span id="l19.1335" class="difflineplus">+    if (topic == &quot;nsPref:changed&quot;) {</span>
<a href="#l19.1336"></a><span id="l19.1336" class="difflineplus">+      switch (data) {</span>
<a href="#l19.1337"></a><span id="l19.1337" class="difflineplus">+        case PREF_SELECTED_READER:</span>
<a href="#l19.1338"></a><span id="l19.1338" class="difflineplus">+        case PREF_SELECTED_WEB:</span>
<a href="#l19.1339"></a><span id="l19.1339" class="difflineplus">+        case PREF_SELECTED_APP:</span>
<a href="#l19.1340"></a><span id="l19.1340" class="difflineplus">+        case PREF_VIDEO_SELECTED_READER:</span>
<a href="#l19.1341"></a><span id="l19.1341" class="difflineplus">+        case PREF_VIDEO_SELECTED_WEB:</span>
<a href="#l19.1342"></a><span id="l19.1342" class="difflineplus">+        case PREF_VIDEO_SELECTED_APP:</span>
<a href="#l19.1343"></a><span id="l19.1343" class="difflineplus">+        case PREF_AUDIO_SELECTED_READER:</span>
<a href="#l19.1344"></a><span id="l19.1344" class="difflineplus">+        case PREF_AUDIO_SELECTED_WEB:</span>
<a href="#l19.1345"></a><span id="l19.1345" class="difflineplus">+        case PREF_AUDIO_SELECTED_APP:</span>
<a href="#l19.1346"></a><span id="l19.1346" class="difflineplus">+          this._setSelectedHandler(feedType);</span>
<a href="#l19.1347"></a><span id="l19.1347" class="difflineplus">+          break;</span>
<a href="#l19.1348"></a><span id="l19.1348" class="difflineplus">+        case PREF_SELECTED_ACTION:</span>
<a href="#l19.1349"></a><span id="l19.1349" class="difflineplus">+        case PREF_VIDEO_SELECTED_ACTION:</span>
<a href="#l19.1350"></a><span id="l19.1350" class="difflineplus">+        case PREF_AUDIO_SELECTED_ACTION:</span>
<a href="#l19.1351"></a><span id="l19.1351" class="difflineplus">+          this._setAlwaysUseCheckedState(feedType);</span>
<a href="#l19.1352"></a><span id="l19.1352" class="difflineplus">+      }</span>
<a href="#l19.1353"></a><span id="l19.1353" class="difflineplus">+    }</span>
<a href="#l19.1354"></a><span id="l19.1354" class="difflineplus">+  },</span>
<a href="#l19.1355"></a><span id="l19.1355" class="difflineplus">+</span>
<a href="#l19.1356"></a><span id="l19.1356" class="difflineplus">+  /**</span>
<a href="#l19.1357"></a><span id="l19.1357" class="difflineplus">+   * Sets the icon for the given web-reader item in the readers menu</span>
<a href="#l19.1358"></a><span id="l19.1358" class="difflineplus">+   * if the favicon-service has the necessary icon stored.</span>
<a href="#l19.1359"></a><span id="l19.1359" class="difflineplus">+   * @param aURI</span>
<a href="#l19.1360"></a><span id="l19.1360" class="difflineplus">+   *        the reader URI.</span>
<a href="#l19.1361"></a><span id="l19.1361" class="difflineplus">+   * @param aMenuItem</span>
<a href="#l19.1362"></a><span id="l19.1362" class="difflineplus">+   *        the reader item in the readers menulist.</span>
<a href="#l19.1363"></a><span id="l19.1363" class="difflineplus">+   * @return true if the icon was set, false otherwise.</span>
<a href="#l19.1364"></a><span id="l19.1364" class="difflineplus">+   */</span>
<a href="#l19.1365"></a><span id="l19.1365" class="difflineplus">+  _setFaviconForWebReader: function setFaviconForWebReader(aURI, aMenuItem) {</span>
<a href="#l19.1366"></a><span id="l19.1366" class="difflineplus">+    var faviconsSvc = this._faviconService;</span>
<a href="#l19.1367"></a><span id="l19.1367" class="difflineplus">+    var faviconURI = null;</span>
<a href="#l19.1368"></a><span id="l19.1368" class="difflineplus">+    try {</span>
<a href="#l19.1369"></a><span id="l19.1369" class="difflineplus">+      faviconURI = faviconsSvc.getFaviconForPage(aURI);</span>
<a href="#l19.1370"></a><span id="l19.1370" class="difflineplus">+    }</span>
<a href="#l19.1371"></a><span id="l19.1371" class="difflineplus">+    catch(ex) {</span>
<a href="#l19.1372"></a><span id="l19.1372" class="difflineplus">+    }</span>
<a href="#l19.1373"></a><span id="l19.1373" class="difflineplus">+</span>
<a href="#l19.1374"></a><span id="l19.1374" class="difflineplus">+    if (faviconURI) {</span>
<a href="#l19.1375"></a><span id="l19.1375" class="difflineplus">+      var dataURL = faviconsSvc.getFaviconDataAsDataURL(faviconURI);</span>
<a href="#l19.1376"></a><span id="l19.1376" class="difflineplus">+      if (dataURL) {</span>
<a href="#l19.1377"></a><span id="l19.1377" class="difflineplus">+        this._contentSandbox.menuItem = aMenuItem;</span>
<a href="#l19.1378"></a><span id="l19.1378" class="difflineplus">+        this._contentSandbox.dataURL = dataURL;</span>
<a href="#l19.1379"></a><span id="l19.1379" class="difflineplus">+        var codeStr = &quot;menuItem.setAttribute('image', dataURL);&quot;;</span>
<a href="#l19.1380"></a><span id="l19.1380" class="difflineplus">+        Components.utils.evalInSandbox(codeStr, this._contentSandbox);</span>
<a href="#l19.1381"></a><span id="l19.1381" class="difflineplus">+        this._contentSandbox.menuItem = null;</span>
<a href="#l19.1382"></a><span id="l19.1382" class="difflineplus">+        this._contentSandbox.dataURL = null;</span>
<a href="#l19.1383"></a><span id="l19.1383" class="difflineplus">+</span>
<a href="#l19.1384"></a><span id="l19.1384" class="difflineplus">+        return true;</span>
<a href="#l19.1385"></a><span id="l19.1385" class="difflineplus">+      }</span>
<a href="#l19.1386"></a><span id="l19.1386" class="difflineplus">+    }</span>
<a href="#l19.1387"></a><span id="l19.1387" class="difflineplus">+</span>
<a href="#l19.1388"></a><span id="l19.1388" class="difflineplus">+    return false;</span>
<a href="#l19.1389"></a><span id="l19.1389" class="difflineplus">+  },</span>
<a href="#l19.1390"></a><span id="l19.1390" class="difflineplus">+</span>
<a href="#l19.1391"></a><span id="l19.1391" class="difflineplus">+   // nsINavHistoryService</span>
<a href="#l19.1392"></a><span id="l19.1392" class="difflineplus">+   onPageChanged: function onPageChanged(aURI, aWhat, aValue) {</span>
<a href="#l19.1393"></a><span id="l19.1393" class="difflineplus">+     // see init()</span>
<a href="#l19.1394"></a><span id="l19.1394" class="difflineplus">+     aURI = new XPCNativeWrapper(aURI);</span>
<a href="#l19.1395"></a><span id="l19.1395" class="difflineplus">+</span>
<a href="#l19.1396"></a><span id="l19.1396" class="difflineplus">+     if (aWhat == Components.interfaces.nsINavHistoryObserver.ATTRIBUTE_FAVICON) {</span>
<a href="#l19.1397"></a><span id="l19.1397" class="difflineplus">+       // Go through the readers menu and look for the corresponding</span>
<a href="#l19.1398"></a><span id="l19.1398" class="difflineplus">+       // reader menu-item for the page if any.</span>
<a href="#l19.1399"></a><span id="l19.1399" class="difflineplus">+       var spec = aURI.spec;</span>
<a href="#l19.1400"></a><span id="l19.1400" class="difflineplus">+       var handlersMenulist = this._document.getElementById(&quot;handlersMenuList&quot;);</span>
<a href="#l19.1401"></a><span id="l19.1401" class="difflineplus">+       var possibleHandlers = handlersMenulist.firstChild.childNodes;</span>
<a href="#l19.1402"></a><span id="l19.1402" class="difflineplus">+       for (let i=0; i &lt; possibleHandlers.length ; i++) {</span>
<a href="#l19.1403"></a><span id="l19.1403" class="difflineplus">+         if (possibleHandlers[i].getAttribute(&quot;webhandlerurl&quot;) == spec) {</span>
<a href="#l19.1404"></a><span id="l19.1404" class="difflineplus">+           this._setFaviconForWebReader(aURI, possibleHandlers[i]);</span>
<a href="#l19.1405"></a><span id="l19.1405" class="difflineplus">+           return;</span>
<a href="#l19.1406"></a><span id="l19.1406" class="difflineplus">+         }</span>
<a href="#l19.1407"></a><span id="l19.1407" class="difflineplus">+       }</span>
<a href="#l19.1408"></a><span id="l19.1408" class="difflineplus">+     }</span>
<a href="#l19.1409"></a><span id="l19.1409" class="difflineplus">+   },</span>
<a href="#l19.1410"></a><span id="l19.1410" class="difflineplus">+</span>
<a href="#l19.1411"></a><span id="l19.1411" class="difflineplus">+   onBeginUpdateBatch: function() { },</span>
<a href="#l19.1412"></a><span id="l19.1412" class="difflineplus">+   onEndUpdateBatch: function() { },</span>
<a href="#l19.1413"></a><span id="l19.1413" class="difflineplus">+   onVisit: function() { },</span>
<a href="#l19.1414"></a><span id="l19.1414" class="difflineplus">+   onTitleChanged: function() { },</span>
<a href="#l19.1415"></a><span id="l19.1415" class="difflineplus">+   onDeleteURI: function() { },</span>
<a href="#l19.1416"></a><span id="l19.1416" class="difflineplus">+   onClearHistory: function() { },</span>
<a href="#l19.1417"></a><span id="l19.1417" class="difflineplus">+   onPageExpired: function() { },</span>
<a href="#l19.1418"></a><span id="l19.1418" class="difflineplus">+</span>
<a href="#l19.1419"></a><span id="l19.1419" class="difflineplus">+  // nsIClassInfo</span>
<a href="#l19.1420"></a><span id="l19.1420" class="difflineplus">+  getInterfaces: function getInterfaces(countRef) {</span>
<a href="#l19.1421"></a><span id="l19.1421" class="difflineplus">+    var interfaces = [Components.interfaces.nsIFeedWriter,</span>
<a href="#l19.1422"></a><span id="l19.1422" class="difflineplus">+                       Components.interfaces.nsIClassInfo,</span>
<a href="#l19.1423"></a><span id="l19.1423" class="difflineplus">+                       Components.interfaces.nsISupports];</span>
<a href="#l19.1424"></a><span id="l19.1424" class="difflineplus">+    countRef.value = interfaces.length;</span>
<a href="#l19.1425"></a><span id="l19.1425" class="difflineplus">+    return interfaces;</span>
<a href="#l19.1426"></a><span id="l19.1426" class="difflineplus">+  },</span>
<a href="#l19.1427"></a><span id="l19.1427" class="difflineplus">+</span>
<a href="#l19.1428"></a><span id="l19.1428" class="difflineplus">+  getHelperForLanguage: function getHelperForLanguage(language) null,</span>
<a href="#l19.1429"></a><span id="l19.1429" class="difflineplus">+  contractID: &quot;@mozilla.org/browser/feeds/result-writer;1&quot;,</span>
<a href="#l19.1430"></a><span id="l19.1430" class="difflineplus">+  classDescription: &quot;Feed Writer&quot;,</span>
<a href="#l19.1431"></a><span id="l19.1431" class="difflineplus">+  classID: Components.ID(&quot;{49bb6593-3aff-4eb3-a068-2712c28bd58e}&quot;),</span>
<a href="#l19.1432"></a><span id="l19.1432" class="difflineplus">+  implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l19.1433"></a><span id="l19.1433" class="difflineplus">+  flags: Components.interfaces.nsIClassInfo.DOM_OBJECT,</span>
<a href="#l19.1434"></a><span id="l19.1434" class="difflineplus">+  _xpcom_categories: [{ category: &quot;JavaScript global constructor&quot;,</span>
<a href="#l19.1435"></a><span id="l19.1435" class="difflineplus">+                        entry: &quot;BrowserFeedWriter&quot;}],</span>
<a href="#l19.1436"></a><span id="l19.1436" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIFeedWriter,</span>
<a href="#l19.1437"></a><span id="l19.1437" class="difflineplus">+                                          Components.interfaces.nsIClassInfo,</span>
<a href="#l19.1438"></a><span id="l19.1438" class="difflineplus">+                                          Components.interfaces.nsIDOMEventListener,</span>
<a href="#l19.1439"></a><span id="l19.1439" class="difflineplus">+                                          Components.interfaces.nsINavHistoryObserver,</span>
<a href="#l19.1440"></a><span id="l19.1440" class="difflineplus">+                                          Components.interfaces.nsIObserver])</span>
<a href="#l19.1441"></a><span id="l19.1441" class="difflineplus">+</span>
<a href="#l19.1442"></a><span id="l19.1442" class="difflineplus">+};</span>
<a href="#l19.1443"></a><span id="l19.1443" class="difflineplus">+</span>
<a href="#l19.1444"></a><span id="l19.1444" class="difflineplus">+function NSGetModule(cm, file) {</span>
<a href="#l19.1445"></a><span id="l19.1445" class="difflineplus">+  return XPCOMUtils.generateModule([FeedWriter]);</span>
<a href="#l19.1446"></a><span id="l19.1446" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">new file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- /dev/null</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ b/suite/feeds/src/Makefile.in</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -0,0 +1,68 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineplus">+#</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l20.10"></a><span id="l20.10" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l20.11"></a><span id="l20.11" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+#</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+# License.</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+#</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+# The Original Code is the Feed Handling System</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+#</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+# The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineplus">+#</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineplus">+# Contributor(s):</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineplus">+#  Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineplus">+#</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineplus">+# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineplus">+# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+#</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineplus">+DEPTH		= ../../..</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineplus">+topsrcdir	= @top_srcdir@</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineplus">+srcdir		= @srcdir@</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineplus">+VPATH		= @srcdir@</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineplus">+include $(DEPTH)/config/autoconf.mk</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineplus">+</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+MODULE = suitefeeds</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+LIBRARY_NAME = suitefeeds_s</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineplus">+META_COMPONENT  = suite</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+FORCE_STATIC_LIB = 1</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineplus">+FORCE_USE_PIC = 1</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineplus">+</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineplus">+DEFINES += \</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineplus">+	-DMOZ_APP_NAME=$(MOZ_APP_NAME) \</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineplus">+	-DMOZ_APP_DISPLAYNAME=$(MOZ_APP_DISPLAYNAME) \</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineplus">+	$(NULL)</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineplus">+</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineplus">+EXTRA_PP_COMPONENTS = \</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineplus">+	FeedConverter.js \</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+	FeedWriter.js \</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineplus">+	WebContentConverter.js \</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineplus">+	nsAboutFeeds.js \</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineplus">+	$(NULL)</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineplus">+</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineplus">+REQUIRES = xpcom string necko caps js xpconnect mimetype</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineplus">+</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineplus">+CPPSRCS = \</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineplus">+	nsFeedSniffer.cpp \</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineplus">+	$(NULL)</span>
<a href="#l20.71"></a><span id="l20.71" class="difflineplus">+</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineplus">+include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">new file mode 100644</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineminus">--- /dev/null</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineplus">+++ b/suite/feeds/src/WebContentConverter.js</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineat">@@ -0,0 +1,893 @@</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineplus">+/* -*- Mode: Javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineplus">+ *</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+ *</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+ * License.</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+ *</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+ * The Original Code is the Web Content Converter System.</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+ *</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+ *</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+ *   Dan Mosedale &lt;dmose@mozilla.org&gt;</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+ *   Caio Tiago Oliveira &lt;asrail@gmail.com&gt;</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+ *</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineplus">+ *</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineplus">+</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/debug.js&quot;);</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineplus">+</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineplus">+const WCCR_CONTRACTID = &quot;@mozilla.org/embeddor.implemented/web-content-handler-registrar;1&quot;;</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+const WCCR_CLASSID = Components.ID(&quot;{792a7e82-06a0-437c-af63-b2d12e808acc}&quot;);</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+const WCCR_CLASSNAME = &quot;Web Content Handler Registrar&quot;;</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineplus">+const WCC_CLASSID = Components.ID(&quot;{db7ebf28-cc40-415f-8a51-1b111851df1e}&quot;);</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+const WCC_CLASSNAME = &quot;Web Service Handler&quot;;</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineplus">+</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+const TYPE_MAYBE_FEED = &quot;application/vnd.mozilla.maybe.feed&quot;;</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+const TYPE_ANY = &quot;*/*&quot;;</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineplus">+const PREF_CONTENTHANDLERS_AUTO = &quot;browser.contentHandlers.auto.&quot;;</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineplus">+const PREF_CONTENTHANDLERS_BRANCH = &quot;browser.contentHandlers.types.&quot;;</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineplus">+const PREF_SELECTED_WEB = &quot;browser.feeds.handlers.webservice&quot;;</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+const PREF_SELECTED_ACTION = &quot;browser.feeds.handler&quot;;</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineplus">+const PREF_SELECTED_READER = &quot;browser.feeds.handler.default&quot;;</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineplus">+const PREF_HANDLER_EXTERNAL_PREFIX = &quot;network.protocol-handler.external&quot;;</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineplus">+const PREF_ALLOW_DIFFERENT_HOST = &quot;gecko.handlerService.allowRegisterFromDifferentHost&quot;;</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineplus">+</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineplus">+const STRING_BUNDLE_URI = &quot;chrome://communicator/locale/feeds/subscribe.properties&quot;;</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineplus">+</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineplus">+const NS_ERROR_MODULE_DOM = 0x80530000;</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineplus">+const NS_ERROR_DOM_SYNTAX_ERR = NS_ERROR_MODULE_DOM + 12;</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineplus">+</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineplus">+function LOG(str) {</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+  var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineplus">+                        .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineplus">+</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineplus">+  try {</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineplus">+    if (prefs.getBoolPref(&quot;feeds.log&quot;))</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineplus">+      dump(&quot;*** Feeds: &quot; + str + &quot;\n&quot;);</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineplus">+  }</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineplus">+  catch (ex) {</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineplus">+  }</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineplus">+}</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineplus">+</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+function getNotificationBox(aWindow)</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineplus">+{</span>
<a href="#l21.85"></a><span id="l21.85" class="difflineplus">+  return aWindow.QueryInterface(Components.interfaces.nsIInterfaceRequestor)</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineplus">+                .getInterface(Components.interfaces.nsIWebNavigation)</span>
<a href="#l21.87"></a><span id="l21.87" class="difflineplus">+                .QueryInterface(Components.interfaces.nsIDocShell)</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineplus">+                .chromeEventHandler.parentNode.wrappedJSObject;</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineplus">+}</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineplus">+</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineplus">+function WebContentConverter() {</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineplus">+}</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineplus">+</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineplus">+WebContentConverter.prototype = {</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineplus">+  convert: function convert() { },</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineplus">+  asyncConvertData: function asyncConvertData() { },</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineplus">+  onDataAvailable: function onDataAvailable() { },</span>
<a href="#l21.98"></a><span id="l21.98" class="difflineplus">+  onStopRequest: function onStopRequest() { },</span>
<a href="#l21.99"></a><span id="l21.99" class="difflineplus">+</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineplus">+  onStartRequest: function onStartRequest(request, context) {</span>
<a href="#l21.101"></a><span id="l21.101" class="difflineplus">+    var wccr = Components.classes[WCCR_CONTRACTID]</span>
<a href="#l21.102"></a><span id="l21.102" class="difflineplus">+                         .getService(Components.interfaces.nsIWebContentConverterService);</span>
<a href="#l21.103"></a><span id="l21.103" class="difflineplus">+    wccr.loadPreferredHandler(request);</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineplus">+  },</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineplus">+</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI(</span>
<a href="#l21.107"></a><span id="l21.107" class="difflineplus">+    [Components.interfaces.nsIStreamConverter,</span>
<a href="#l21.108"></a><span id="l21.108" class="difflineplus">+     Components.interfaces.nsIStreamListener,</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineplus">+     Components.interfaces.nsISupports])</span>
<a href="#l21.110"></a><span id="l21.110" class="difflineplus">+};</span>
<a href="#l21.111"></a><span id="l21.111" class="difflineplus">+</span>
<a href="#l21.112"></a><span id="l21.112" class="difflineplus">+var WebContentConverterFactory = {</span>
<a href="#l21.113"></a><span id="l21.113" class="difflineplus">+  createInstance: function createInstance(outer, iid) {</span>
<a href="#l21.114"></a><span id="l21.114" class="difflineplus">+    if (outer != null)</span>
<a href="#l21.115"></a><span id="l21.115" class="difflineplus">+      throw Components.results.NS_ERROR_NO_AGGREGATION;</span>
<a href="#l21.116"></a><span id="l21.116" class="difflineplus">+    return new WebContentConverter().QueryInterface(iid);</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineplus">+  },</span>
<a href="#l21.118"></a><span id="l21.118" class="difflineplus">+</span>
<a href="#l21.119"></a><span id="l21.119" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI(</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineplus">+    [Components.interfaces.nsIFactory,</span>
<a href="#l21.121"></a><span id="l21.121" class="difflineplus">+     Components.interfaces.nsISupports])</span>
<a href="#l21.122"></a><span id="l21.122" class="difflineplus">+};</span>
<a href="#l21.123"></a><span id="l21.123" class="difflineplus">+</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineplus">+function ServiceInfo(contentType, uri, name) {</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineplus">+  this._contentType = contentType;</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineplus">+  this._uri = uri;</span>
<a href="#l21.127"></a><span id="l21.127" class="difflineplus">+  this._name = name;</span>
<a href="#l21.128"></a><span id="l21.128" class="difflineplus">+}</span>
<a href="#l21.129"></a><span id="l21.129" class="difflineplus">+</span>
<a href="#l21.130"></a><span id="l21.130" class="difflineplus">+ServiceInfo.prototype = {</span>
<a href="#l21.131"></a><span id="l21.131" class="difflineplus">+  /**</span>
<a href="#l21.132"></a><span id="l21.132" class="difflineplus">+   * See nsIHandlerApp</span>
<a href="#l21.133"></a><span id="l21.133" class="difflineplus">+   */</span>
<a href="#l21.134"></a><span id="l21.134" class="difflineplus">+  get name() {</span>
<a href="#l21.135"></a><span id="l21.135" class="difflineplus">+    return this._name;</span>
<a href="#l21.136"></a><span id="l21.136" class="difflineplus">+  },</span>
<a href="#l21.137"></a><span id="l21.137" class="difflineplus">+</span>
<a href="#l21.138"></a><span id="l21.138" class="difflineplus">+  /**</span>
<a href="#l21.139"></a><span id="l21.139" class="difflineplus">+   * See nsIHandlerApp</span>
<a href="#l21.140"></a><span id="l21.140" class="difflineplus">+   */</span>
<a href="#l21.141"></a><span id="l21.141" class="difflineplus">+  equals: function equals(aHandlerApp) {</span>
<a href="#l21.142"></a><span id="l21.142" class="difflineplus">+    if (!aHandlerApp)</span>
<a href="#l21.143"></a><span id="l21.143" class="difflineplus">+      throw Components.results.NS_ERROR_NULL_POINTER;</span>
<a href="#l21.144"></a><span id="l21.144" class="difflineplus">+</span>
<a href="#l21.145"></a><span id="l21.145" class="difflineplus">+    if (aHandlerApp instanceof Components.interfaces.nsIWebContentHandlerInfo &amp;&amp;</span>
<a href="#l21.146"></a><span id="l21.146" class="difflineplus">+        aHandlerApp.contentType == this.contentType &amp;&amp;</span>
<a href="#l21.147"></a><span id="l21.147" class="difflineplus">+        aHandlerApp.uri == this.uri)</span>
<a href="#l21.148"></a><span id="l21.148" class="difflineplus">+      return true;</span>
<a href="#l21.149"></a><span id="l21.149" class="difflineplus">+</span>
<a href="#l21.150"></a><span id="l21.150" class="difflineplus">+    return false;</span>
<a href="#l21.151"></a><span id="l21.151" class="difflineplus">+  },</span>
<a href="#l21.152"></a><span id="l21.152" class="difflineplus">+</span>
<a href="#l21.153"></a><span id="l21.153" class="difflineplus">+  /**</span>
<a href="#l21.154"></a><span id="l21.154" class="difflineplus">+   * See nsIWebContentHandlerInfo</span>
<a href="#l21.155"></a><span id="l21.155" class="difflineplus">+   */</span>
<a href="#l21.156"></a><span id="l21.156" class="difflineplus">+  get contentType() {</span>
<a href="#l21.157"></a><span id="l21.157" class="difflineplus">+    return this._contentType;</span>
<a href="#l21.158"></a><span id="l21.158" class="difflineplus">+  },</span>
<a href="#l21.159"></a><span id="l21.159" class="difflineplus">+</span>
<a href="#l21.160"></a><span id="l21.160" class="difflineplus">+  /**</span>
<a href="#l21.161"></a><span id="l21.161" class="difflineplus">+   * See nsIWebContentHandlerInfo</span>
<a href="#l21.162"></a><span id="l21.162" class="difflineplus">+   */</span>
<a href="#l21.163"></a><span id="l21.163" class="difflineplus">+  get uri() {</span>
<a href="#l21.164"></a><span id="l21.164" class="difflineplus">+    return this._uri;</span>
<a href="#l21.165"></a><span id="l21.165" class="difflineplus">+  },</span>
<a href="#l21.166"></a><span id="l21.166" class="difflineplus">+</span>
<a href="#l21.167"></a><span id="l21.167" class="difflineplus">+  /**</span>
<a href="#l21.168"></a><span id="l21.168" class="difflineplus">+   * See nsIWebContentHandlerInfo</span>
<a href="#l21.169"></a><span id="l21.169" class="difflineplus">+   */</span>
<a href="#l21.170"></a><span id="l21.170" class="difflineplus">+  getHandlerURI: function getHandlerURI(uri) {</span>
<a href="#l21.171"></a><span id="l21.171" class="difflineplus">+    return this._uri.replace(/%s/gi, encodeURIComponent(uri));</span>
<a href="#l21.172"></a><span id="l21.172" class="difflineplus">+  },</span>
<a href="#l21.173"></a><span id="l21.173" class="difflineplus">+</span>
<a href="#l21.174"></a><span id="l21.174" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI(</span>
<a href="#l21.175"></a><span id="l21.175" class="difflineplus">+    [Components.interfaces.nsIWebContentHandlerInfo,</span>
<a href="#l21.176"></a><span id="l21.176" class="difflineplus">+     Components.interfaces.nsISupports])</span>
<a href="#l21.177"></a><span id="l21.177" class="difflineplus">+};</span>
<a href="#l21.178"></a><span id="l21.178" class="difflineplus">+</span>
<a href="#l21.179"></a><span id="l21.179" class="difflineplus">+function WebContentConverterRegistrar() {</span>
<a href="#l21.180"></a><span id="l21.180" class="difflineplus">+  this._contentTypes = { };</span>
<a href="#l21.181"></a><span id="l21.181" class="difflineplus">+  this._autoHandleContentTypes = { };</span>
<a href="#l21.182"></a><span id="l21.182" class="difflineplus">+}</span>
<a href="#l21.183"></a><span id="l21.183" class="difflineplus">+</span>
<a href="#l21.184"></a><span id="l21.184" class="difflineplus">+WebContentConverterRegistrar.prototype = {</span>
<a href="#l21.185"></a><span id="l21.185" class="difflineplus">+  __bundle: null,</span>
<a href="#l21.186"></a><span id="l21.186" class="difflineplus">+  get _bundle() {</span>
<a href="#l21.187"></a><span id="l21.187" class="difflineplus">+    if (!this.__bundle) {</span>
<a href="#l21.188"></a><span id="l21.188" class="difflineplus">+      this.__bundle = Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l21.189"></a><span id="l21.189" class="difflineplus">+                        .getService(Components.interfaces.nsIStringBundleService)</span>
<a href="#l21.190"></a><span id="l21.190" class="difflineplus">+                        .createBundle(STRING_BUNDLE_URI);</span>
<a href="#l21.191"></a><span id="l21.191" class="difflineplus">+    }</span>
<a href="#l21.192"></a><span id="l21.192" class="difflineplus">+    return this.__bundle;</span>
<a href="#l21.193"></a><span id="l21.193" class="difflineplus">+  },</span>
<a href="#l21.194"></a><span id="l21.194" class="difflineplus">+</span>
<a href="#l21.195"></a><span id="l21.195" class="difflineplus">+  _getFormattedString: function getFormattedString(key, params) {</span>
<a href="#l21.196"></a><span id="l21.196" class="difflineplus">+    return this._bundle.formatStringFromName(key, params, params.length);</span>
<a href="#l21.197"></a><span id="l21.197" class="difflineplus">+  },</span>
<a href="#l21.198"></a><span id="l21.198" class="difflineplus">+</span>
<a href="#l21.199"></a><span id="l21.199" class="difflineplus">+  _getString: function getString(key) {</span>
<a href="#l21.200"></a><span id="l21.200" class="difflineplus">+    try {</span>
<a href="#l21.201"></a><span id="l21.201" class="difflineplus">+      return this._bundle.GetStringFromName(key);</span>
<a href="#l21.202"></a><span id="l21.202" class="difflineplus">+    } catch(e) {</span>
<a href="#l21.203"></a><span id="l21.203" class="difflineplus">+      LOG(&quot;Couldn't retrieve key from bundle&quot;);</span>
<a href="#l21.204"></a><span id="l21.204" class="difflineplus">+    }</span>
<a href="#l21.205"></a><span id="l21.205" class="difflineplus">+</span>
<a href="#l21.206"></a><span id="l21.206" class="difflineplus">+    return null;</span>
<a href="#l21.207"></a><span id="l21.207" class="difflineplus">+  },</span>
<a href="#l21.208"></a><span id="l21.208" class="difflineplus">+</span>
<a href="#l21.209"></a><span id="l21.209" class="difflineplus">+  /**</span>
<a href="#l21.210"></a><span id="l21.210" class="difflineplus">+   * See nsIWebContentConverterService</span>
<a href="#l21.211"></a><span id="l21.211" class="difflineplus">+   */</span>
<a href="#l21.212"></a><span id="l21.212" class="difflineplus">+  getAutoHandler: function getAutoHandler(contentType) {</span>
<a href="#l21.213"></a><span id="l21.213" class="difflineplus">+    contentType = this._resolveContentType(contentType);</span>
<a href="#l21.214"></a><span id="l21.214" class="difflineplus">+    if (contentType in this._autoHandleContentTypes)</span>
<a href="#l21.215"></a><span id="l21.215" class="difflineplus">+      return this._autoHandleContentTypes[contentType];</span>
<a href="#l21.216"></a><span id="l21.216" class="difflineplus">+    return null;</span>
<a href="#l21.217"></a><span id="l21.217" class="difflineplus">+  },</span>
<a href="#l21.218"></a><span id="l21.218" class="difflineplus">+</span>
<a href="#l21.219"></a><span id="l21.219" class="difflineplus">+  /**</span>
<a href="#l21.220"></a><span id="l21.220" class="difflineplus">+   * See nsIWebContentConverterService</span>
<a href="#l21.221"></a><span id="l21.221" class="difflineplus">+   */</span>
<a href="#l21.222"></a><span id="l21.222" class="difflineplus">+  setAutoHandler: function setAutoHandler(contentType, handler) {</span>
<a href="#l21.223"></a><span id="l21.223" class="difflineplus">+    if (handler &amp;&amp; !this._typeIsRegistered(contentType, handler.uri))</span>
<a href="#l21.224"></a><span id="l21.224" class="difflineplus">+      throw Components.results.NS_ERROR_NOT_AVAILABLE;</span>
<a href="#l21.225"></a><span id="l21.225" class="difflineplus">+</span>
<a href="#l21.226"></a><span id="l21.226" class="difflineplus">+    contentType = this._resolveContentType(contentType);</span>
<a href="#l21.227"></a><span id="l21.227" class="difflineplus">+    this._setAutoHandler(contentType, handler);</span>
<a href="#l21.228"></a><span id="l21.228" class="difflineplus">+</span>
<a href="#l21.229"></a><span id="l21.229" class="difflineplus">+    var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l21.230"></a><span id="l21.230" class="difflineplus">+                          .getService(Components.interfaces.nsIPrefService);</span>
<a href="#l21.231"></a><span id="l21.231" class="difflineplus">+    var autoBranch = prefs.getBranch(PREF_CONTENTHANDLERS_AUTO);</span>
<a href="#l21.232"></a><span id="l21.232" class="difflineplus">+    if (handler)</span>
<a href="#l21.233"></a><span id="l21.233" class="difflineplus">+      autoBranch.setCharPref(contentType, handler.uri);</span>
<a href="#l21.234"></a><span id="l21.234" class="difflineplus">+    else if (autoBranch.prefHasUserValue(contentType))</span>
<a href="#l21.235"></a><span id="l21.235" class="difflineplus">+      autoBranch.clearUserPref(contentType);</span>
<a href="#l21.236"></a><span id="l21.236" class="difflineplus">+</span>
<a href="#l21.237"></a><span id="l21.237" class="difflineplus">+    prefs.savePrefFile(null);</span>
<a href="#l21.238"></a><span id="l21.238" class="difflineplus">+  },</span>
<a href="#l21.239"></a><span id="l21.239" class="difflineplus">+</span>
<a href="#l21.240"></a><span id="l21.240" class="difflineplus">+  /**</span>
<a href="#l21.241"></a><span id="l21.241" class="difflineplus">+   * Update the internal data structure (not persistent)</span>
<a href="#l21.242"></a><span id="l21.242" class="difflineplus">+   */</span>
<a href="#l21.243"></a><span id="l21.243" class="difflineplus">+  _setAutoHandler: function setAutoHandler(contentType, handler) {</span>
<a href="#l21.244"></a><span id="l21.244" class="difflineplus">+    if (handler)</span>
<a href="#l21.245"></a><span id="l21.245" class="difflineplus">+      this._autoHandleContentTypes[contentType] = handler;</span>
<a href="#l21.246"></a><span id="l21.246" class="difflineplus">+    else if (contentType in this._autoHandleContentTypes)</span>
<a href="#l21.247"></a><span id="l21.247" class="difflineplus">+      delete this._autoHandleContentTypes[contentType];</span>
<a href="#l21.248"></a><span id="l21.248" class="difflineplus">+  },</span>
<a href="#l21.249"></a><span id="l21.249" class="difflineplus">+</span>
<a href="#l21.250"></a><span id="l21.250" class="difflineplus">+  /**</span>
<a href="#l21.251"></a><span id="l21.251" class="difflineplus">+   * See nsIWebContentConverterService</span>
<a href="#l21.252"></a><span id="l21.252" class="difflineplus">+   */</span>
<a href="#l21.253"></a><span id="l21.253" class="difflineplus">+  getWebContentHandlerByURI: function getWebContentHandlerByURI(contentType, uri) {</span>
<a href="#l21.254"></a><span id="l21.254" class="difflineplus">+    var handlers = this.getContentHandlers(contentType, { });</span>
<a href="#l21.255"></a><span id="l21.255" class="difflineplus">+    for (let i = 0; i &lt; handlers.length; ++i) {</span>
<a href="#l21.256"></a><span id="l21.256" class="difflineplus">+      if (handlers[i].uri == uri)</span>
<a href="#l21.257"></a><span id="l21.257" class="difflineplus">+        return handlers[i];</span>
<a href="#l21.258"></a><span id="l21.258" class="difflineplus">+    }</span>
<a href="#l21.259"></a><span id="l21.259" class="difflineplus">+    return null;</span>
<a href="#l21.260"></a><span id="l21.260" class="difflineplus">+  },</span>
<a href="#l21.261"></a><span id="l21.261" class="difflineplus">+</span>
<a href="#l21.262"></a><span id="l21.262" class="difflineplus">+  /**</span>
<a href="#l21.263"></a><span id="l21.263" class="difflineplus">+   * See nsIWebContentConverterService</span>
<a href="#l21.264"></a><span id="l21.264" class="difflineplus">+   */</span>
<a href="#l21.265"></a><span id="l21.265" class="difflineplus">+  loadPreferredHandler: function loadPreferredHandler(request) {</span>
<a href="#l21.266"></a><span id="l21.266" class="difflineplus">+    var channel = request.QueryInterface(Components.interfaces.nsIChannel);</span>
<a href="#l21.267"></a><span id="l21.267" class="difflineplus">+    var contentType = this._resolveContentType(channel.contentType);</span>
<a href="#l21.268"></a><span id="l21.268" class="difflineplus">+    var handler = this.getAutoHandler(contentType);</span>
<a href="#l21.269"></a><span id="l21.269" class="difflineplus">+    if (handler) {</span>
<a href="#l21.270"></a><span id="l21.270" class="difflineplus">+      request.cancel(Components.results.NS_ERROR_FAILURE);</span>
<a href="#l21.271"></a><span id="l21.271" class="difflineplus">+</span>
<a href="#l21.272"></a><span id="l21.272" class="difflineplus">+      var webNavigation = channel.notificationCallbacks</span>
<a href="#l21.273"></a><span id="l21.273" class="difflineplus">+                                 .getInterface(Components.interfaces.nsIWebNavigation);</span>
<a href="#l21.274"></a><span id="l21.274" class="difflineplus">+      webNavigation.loadURI(handler.getHandlerURI(channel.URI.spec),</span>
<a href="#l21.275"></a><span id="l21.275" class="difflineplus">+                            Components.interfaces.nsIWebNavigation.LOAD_FLAGS_NONE,</span>
<a href="#l21.276"></a><span id="l21.276" class="difflineplus">+                            null, null, null);</span>
<a href="#l21.277"></a><span id="l21.277" class="difflineplus">+    }</span>
<a href="#l21.278"></a><span id="l21.278" class="difflineplus">+  },</span>
<a href="#l21.279"></a><span id="l21.279" class="difflineplus">+</span>
<a href="#l21.280"></a><span id="l21.280" class="difflineplus">+  /**</span>
<a href="#l21.281"></a><span id="l21.281" class="difflineplus">+   * See nsIWebContentConverterService</span>
<a href="#l21.282"></a><span id="l21.282" class="difflineplus">+   */</span>
<a href="#l21.283"></a><span id="l21.283" class="difflineplus">+  removeProtocolHandler: function removeProtocolHandler(aProtocol, aURITemplate) {</span>
<a href="#l21.284"></a><span id="l21.284" class="difflineplus">+    var eps = Components.classes[&quot;@mozilla.org/uriloader/external-protocol-service;1&quot;]</span>
<a href="#l21.285"></a><span id="l21.285" class="difflineplus">+                        .getService(Components.interfaces.nsIExternalProtocolService);</span>
<a href="#l21.286"></a><span id="l21.286" class="difflineplus">+    var handlerInfo = eps.getProtocolHandlerInfo(aProtocol);</span>
<a href="#l21.287"></a><span id="l21.287" class="difflineplus">+    var handlers =  handlerInfo.possibleApplicationHandlers;</span>
<a href="#l21.288"></a><span id="l21.288" class="difflineplus">+    for (let i = 0; i &lt; handlers.length; i++) {</span>
<a href="#l21.289"></a><span id="l21.289" class="difflineplus">+      try { // We only want to test web handlers</span>
<a href="#l21.290"></a><span id="l21.290" class="difflineplus">+        let handler = handlers.queryElementAt(i, Components.interfaces.nsIWebHandlerApp);</span>
<a href="#l21.291"></a><span id="l21.291" class="difflineplus">+        if (handler.uriTemplate == aURITemplate) {</span>
<a href="#l21.292"></a><span id="l21.292" class="difflineplus">+          handlers.removeElementAt(i);</span>
<a href="#l21.293"></a><span id="l21.293" class="difflineplus">+          let hs = Components.classes[&quot;@mozilla.org/uriloader/handler-service;1&quot;]</span>
<a href="#l21.294"></a><span id="l21.294" class="difflineplus">+                             .getService(Components.interfaces.nsIHandlerService);</span>
<a href="#l21.295"></a><span id="l21.295" class="difflineplus">+          hs.store(handlerInfo);</span>
<a href="#l21.296"></a><span id="l21.296" class="difflineplus">+          return;</span>
<a href="#l21.297"></a><span id="l21.297" class="difflineplus">+        }</span>
<a href="#l21.298"></a><span id="l21.298" class="difflineplus">+      } catch (e) {</span>
<a href="#l21.299"></a><span id="l21.299" class="difflineplus">+        /* it wasn't a web handler */</span>
<a href="#l21.300"></a><span id="l21.300" class="difflineplus">+      }</span>
<a href="#l21.301"></a><span id="l21.301" class="difflineplus">+    }</span>
<a href="#l21.302"></a><span id="l21.302" class="difflineplus">+  },</span>
<a href="#l21.303"></a><span id="l21.303" class="difflineplus">+</span>
<a href="#l21.304"></a><span id="l21.304" class="difflineplus">+  /**</span>
<a href="#l21.305"></a><span id="l21.305" class="difflineplus">+   * See nsIWebContentConverterService</span>
<a href="#l21.306"></a><span id="l21.306" class="difflineplus">+   */</span>
<a href="#l21.307"></a><span id="l21.307" class="difflineplus">+  removeContentHandler: function removeContentHandler(contentType, uri) {</span>
<a href="#l21.308"></a><span id="l21.308" class="difflineplus">+    function notURI(serviceInfo) {</span>
<a href="#l21.309"></a><span id="l21.309" class="difflineplus">+      return serviceInfo.uri != uri;</span>
<a href="#l21.310"></a><span id="l21.310" class="difflineplus">+    }</span>
<a href="#l21.311"></a><span id="l21.311" class="difflineplus">+</span>
<a href="#l21.312"></a><span id="l21.312" class="difflineplus">+    if (contentType in this._contentTypes) {</span>
<a href="#l21.313"></a><span id="l21.313" class="difflineplus">+      this._contentTypes[contentType] = this._contentTypes[contentType]</span>
<a href="#l21.314"></a><span id="l21.314" class="difflineplus">+                                            .filter(notURI);</span>
<a href="#l21.315"></a><span id="l21.315" class="difflineplus">+    }</span>
<a href="#l21.316"></a><span id="l21.316" class="difflineplus">+  },</span>
<a href="#l21.317"></a><span id="l21.317" class="difflineplus">+</span>
<a href="#l21.318"></a><span id="l21.318" class="difflineplus">+  /**</span>
<a href="#l21.319"></a><span id="l21.319" class="difflineplus">+   *</span>
<a href="#l21.320"></a><span id="l21.320" class="difflineplus">+   */</span>
<a href="#l21.321"></a><span id="l21.321" class="difflineplus">+  _mappings: {</span>
<a href="#l21.322"></a><span id="l21.322" class="difflineplus">+    &quot;application/rss+xml&quot;: TYPE_MAYBE_FEED,</span>
<a href="#l21.323"></a><span id="l21.323" class="difflineplus">+    &quot;application/atom+xml&quot;: TYPE_MAYBE_FEED,</span>
<a href="#l21.324"></a><span id="l21.324" class="difflineplus">+  },</span>
<a href="#l21.325"></a><span id="l21.325" class="difflineplus">+</span>
<a href="#l21.326"></a><span id="l21.326" class="difflineplus">+  /**</span>
<a href="#l21.327"></a><span id="l21.327" class="difflineplus">+   * These are types for which there is a separate content converter aside</span>
<a href="#l21.328"></a><span id="l21.328" class="difflineplus">+   * from our built in generic one. We should not automatically register</span>
<a href="#l21.329"></a><span id="l21.329" class="difflineplus">+   * a factory for creating a converter for these types.</span>
<a href="#l21.330"></a><span id="l21.330" class="difflineplus">+   */</span>
<a href="#l21.331"></a><span id="l21.331" class="difflineplus">+  _blockedTypes: {</span>
<a href="#l21.332"></a><span id="l21.332" class="difflineplus">+    &quot;application/vnd.mozilla.maybe.feed&quot;: true,</span>
<a href="#l21.333"></a><span id="l21.333" class="difflineplus">+  },</span>
<a href="#l21.334"></a><span id="l21.334" class="difflineplus">+</span>
<a href="#l21.335"></a><span id="l21.335" class="difflineplus">+  /**</span>
<a href="#l21.336"></a><span id="l21.336" class="difflineplus">+   * Determines the &quot;internal&quot; content type based on the _mappings.</span>
<a href="#l21.337"></a><span id="l21.337" class="difflineplus">+   * @param   contentType</span>
<a href="#l21.338"></a><span id="l21.338" class="difflineplus">+   * @returns The resolved contentType value.</span>
<a href="#l21.339"></a><span id="l21.339" class="difflineplus">+   */</span>
<a href="#l21.340"></a><span id="l21.340" class="difflineplus">+  _resolveContentType: function resolveContentType(contentType) {</span>
<a href="#l21.341"></a><span id="l21.341" class="difflineplus">+    if (contentType in this._mappings)</span>
<a href="#l21.342"></a><span id="l21.342" class="difflineplus">+      return this._mappings[contentType];</span>
<a href="#l21.343"></a><span id="l21.343" class="difflineplus">+    return contentType;</span>
<a href="#l21.344"></a><span id="l21.344" class="difflineplus">+  },</span>
<a href="#l21.345"></a><span id="l21.345" class="difflineplus">+</span>
<a href="#l21.346"></a><span id="l21.346" class="difflineplus">+  _makeURI: function(aURL, aOriginCharset, aBaseURI) {</span>
<a href="#l21.347"></a><span id="l21.347" class="difflineplus">+    var ioService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l21.348"></a><span id="l21.348" class="difflineplus">+                              .getService(Components.interfaces.nsIIOService);</span>
<a href="#l21.349"></a><span id="l21.349" class="difflineplus">+    return ioService.newURI(aURL, aOriginCharset, aBaseURI);</span>
<a href="#l21.350"></a><span id="l21.350" class="difflineplus">+  },</span>
<a href="#l21.351"></a><span id="l21.351" class="difflineplus">+</span>
<a href="#l21.352"></a><span id="l21.352" class="difflineplus">+  _checkAndGetURI: function checkAndGetURI(aURIString, aContentWindow) {</span>
<a href="#l21.353"></a><span id="l21.353" class="difflineplus">+    try {</span>
<a href="#l21.354"></a><span id="l21.354" class="difflineplus">+      var uri = this._makeURI(aURIString);</span>
<a href="#l21.355"></a><span id="l21.355" class="difflineplus">+    } catch (ex) {</span>
<a href="#l21.356"></a><span id="l21.356" class="difflineplus">+      // not supposed to throw according to spec</span>
<a href="#l21.357"></a><span id="l21.357" class="difflineplus">+      return;</span>
<a href="#l21.358"></a><span id="l21.358" class="difflineplus">+    }</span>
<a href="#l21.359"></a><span id="l21.359" class="difflineplus">+</span>
<a href="#l21.360"></a><span id="l21.360" class="difflineplus">+    // For security reasons we reject non-http(s) urls (see bug 354316),</span>
<a href="#l21.361"></a><span id="l21.361" class="difflineplus">+    // we may need to revise this once we support more content types</span>
<a href="#l21.362"></a><span id="l21.362" class="difflineplus">+    // XXX this should be a &quot;security exception&quot; according to spec, but that</span>
<a href="#l21.363"></a><span id="l21.363" class="difflineplus">+    // isn't defined yet.</span>
<a href="#l21.364"></a><span id="l21.364" class="difflineplus">+    if (uri.scheme != &quot;http&quot; &amp;&amp; uri.scheme != &quot;https&quot;)</span>
<a href="#l21.365"></a><span id="l21.365" class="difflineplus">+      throw(&quot;Permission denied to add &quot; + uri.spec + &quot; as a content or protocol handler&quot;);</span>
<a href="#l21.366"></a><span id="l21.366" class="difflineplus">+</span>
<a href="#l21.367"></a><span id="l21.367" class="difflineplus">+    // We also reject handlers registered from a different host (see bug 402287)</span>
<a href="#l21.368"></a><span id="l21.368" class="difflineplus">+    // The pref allows us to test the feature</span>
<a href="#l21.369"></a><span id="l21.369" class="difflineplus">+    var pb = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l21.370"></a><span id="l21.370" class="difflineplus">+                       .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l21.371"></a><span id="l21.371" class="difflineplus">+    if ((!pb.prefHasUserValue(PREF_ALLOW_DIFFERENT_HOST) ||</span>
<a href="#l21.372"></a><span id="l21.372" class="difflineplus">+         !pb.getBoolPref(PREF_ALLOW_DIFFERENT_HOST)) &amp;&amp;</span>
<a href="#l21.373"></a><span id="l21.373" class="difflineplus">+        aContentWindow.location.hostname != uri.host)</span>
<a href="#l21.374"></a><span id="l21.374" class="difflineplus">+      throw(&quot;Permission denied to add &quot; + uri.spec + &quot; as a content or protocol handler&quot;);</span>
<a href="#l21.375"></a><span id="l21.375" class="difflineplus">+</span>
<a href="#l21.376"></a><span id="l21.376" class="difflineplus">+    // If the uri doesn't contain '%s', it won't be a good handler</span>
<a href="#l21.377"></a><span id="l21.377" class="difflineplus">+    if (uri.spec.indexOf(&quot;%s&quot;) &lt; 0)</span>
<a href="#l21.378"></a><span id="l21.378" class="difflineplus">+      throw NS_ERROR_DOM_SYNTAX_ERR;</span>
<a href="#l21.379"></a><span id="l21.379" class="difflineplus">+</span>
<a href="#l21.380"></a><span id="l21.380" class="difflineplus">+    return uri;</span>
<a href="#l21.381"></a><span id="l21.381" class="difflineplus">+  },</span>
<a href="#l21.382"></a><span id="l21.382" class="difflineplus">+</span>
<a href="#l21.383"></a><span id="l21.383" class="difflineplus">+  /**</span>
<a href="#l21.384"></a><span id="l21.384" class="difflineplus">+   * Determines if a web handler is already registered.</span>
<a href="#l21.385"></a><span id="l21.385" class="difflineplus">+   *</span>
<a href="#l21.386"></a><span id="l21.386" class="difflineplus">+   * @param aProtocol</span>
<a href="#l21.387"></a><span id="l21.387" class="difflineplus">+   *        The scheme of the web handler we are checking for.</span>
<a href="#l21.388"></a><span id="l21.388" class="difflineplus">+   * @param aURITemplate</span>
<a href="#l21.389"></a><span id="l21.389" class="difflineplus">+   *        The URI template that the handler uses to handle the protocol.</span>
<a href="#l21.390"></a><span id="l21.390" class="difflineplus">+   * @return true if it is already registered, false otherwise.</span>
<a href="#l21.391"></a><span id="l21.391" class="difflineplus">+   */</span>
<a href="#l21.392"></a><span id="l21.392" class="difflineplus">+  _protocolHandlerRegistered: function protocolHandlerRegistered(aProtocol, aURITemplate) {</span>
<a href="#l21.393"></a><span id="l21.393" class="difflineplus">+    var eps = Components.classes[&quot;@mozilla.org/uriloader/external-protocol-service;1&quot;]</span>
<a href="#l21.394"></a><span id="l21.394" class="difflineplus">+                        .getService(Components.interfaces.nsIExternalProtocolService);</span>
<a href="#l21.395"></a><span id="l21.395" class="difflineplus">+    var handlerInfo = eps.getProtocolHandlerInfo(aProtocol);</span>
<a href="#l21.396"></a><span id="l21.396" class="difflineplus">+    var handlers =  handlerInfo.possibleApplicationHandlers;</span>
<a href="#l21.397"></a><span id="l21.397" class="difflineplus">+    for (let i = 0; i &lt; handlers.length; i++) {</span>
<a href="#l21.398"></a><span id="l21.398" class="difflineplus">+      try { // We only want to test web handlers</span>
<a href="#l21.399"></a><span id="l21.399" class="difflineplus">+        let handler = handlers.queryElementAt(i, Components.interfaces.nsIWebHandlerApp);</span>
<a href="#l21.400"></a><span id="l21.400" class="difflineplus">+        if (handler.uriTemplate == aURITemplate)</span>
<a href="#l21.401"></a><span id="l21.401" class="difflineplus">+          return true;</span>
<a href="#l21.402"></a><span id="l21.402" class="difflineplus">+      } catch (e) { /* it wasn't a web handler */ }</span>
<a href="#l21.403"></a><span id="l21.403" class="difflineplus">+    }</span>
<a href="#l21.404"></a><span id="l21.404" class="difflineplus">+    return false;</span>
<a href="#l21.405"></a><span id="l21.405" class="difflineplus">+  },</span>
<a href="#l21.406"></a><span id="l21.406" class="difflineplus">+</span>
<a href="#l21.407"></a><span id="l21.407" class="difflineplus">+  /**</span>
<a href="#l21.408"></a><span id="l21.408" class="difflineplus">+   * See nsIWebContentHandlerRegistrar</span>
<a href="#l21.409"></a><span id="l21.409" class="difflineplus">+   */</span>
<a href="#l21.410"></a><span id="l21.410" class="difflineplus">+  registerProtocolHandler: function registerProtocolHandler(aProtocol, aURIString,</span>
<a href="#l21.411"></a><span id="l21.411" class="difflineplus">+                                                             aTitle, aContentWindow) {</span>
<a href="#l21.412"></a><span id="l21.412" class="difflineplus">+    LOG(&quot;registerProtocolHandler(&quot; + aProtocol + &quot;,&quot; + aURIString + &quot;,&quot; + aTitle + &quot;)&quot;);</span>
<a href="#l21.413"></a><span id="l21.413" class="difflineplus">+</span>
<a href="#l21.414"></a><span id="l21.414" class="difflineplus">+    // First, check to make sure this isn't already handled internally (we don't</span>
<a href="#l21.415"></a><span id="l21.415" class="difflineplus">+    // want to let them take over, say &quot;chrome&quot;).</span>
<a href="#l21.416"></a><span id="l21.416" class="difflineplus">+    var ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l21.417"></a><span id="l21.417" class="difflineplus">+                        .getService(Components.interfaces.nsIIOService);</span>
<a href="#l21.418"></a><span id="l21.418" class="difflineplus">+    var handler = ios.getProtocolHandler(aProtocol);</span>
<a href="#l21.419"></a><span id="l21.419" class="difflineplus">+    if (!(handler instanceof Components.interfaces.nsIExternalProtocolHandler)) {</span>
<a href="#l21.420"></a><span id="l21.420" class="difflineplus">+      // This is handled internally, so we don't want them to register</span>
<a href="#l21.421"></a><span id="l21.421" class="difflineplus">+      // XXX this should be a &quot;security exception&quot; according to spec, but that</span>
<a href="#l21.422"></a><span id="l21.422" class="difflineplus">+      // isn't defined yet.</span>
<a href="#l21.423"></a><span id="l21.423" class="difflineplus">+      throw(&quot;Permission denied to add &quot; + aURIString + &quot; as a protocol handler&quot;);</span>
<a href="#l21.424"></a><span id="l21.424" class="difflineplus">+    }</span>
<a href="#l21.425"></a><span id="l21.425" class="difflineplus">+</span>
<a href="#l21.426"></a><span id="l21.426" class="difflineplus">+    // check if it is in the black list</span>
<a href="#l21.427"></a><span id="l21.427" class="difflineplus">+    var pb = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l21.428"></a><span id="l21.428" class="difflineplus">+                       .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l21.429"></a><span id="l21.429" class="difflineplus">+    var allowed;</span>
<a href="#l21.430"></a><span id="l21.430" class="difflineplus">+    try {</span>
<a href="#l21.431"></a><span id="l21.431" class="difflineplus">+      allowed = pb.getBoolPref(PREF_HANDLER_EXTERNAL_PREFIX + &quot;.&quot; + aProtocol);</span>
<a href="#l21.432"></a><span id="l21.432" class="difflineplus">+    }</span>
<a href="#l21.433"></a><span id="l21.433" class="difflineplus">+    catch (e) {</span>
<a href="#l21.434"></a><span id="l21.434" class="difflineplus">+      allowed = pb.getBoolPref(PREF_HANDLER_EXTERNAL_PREFIX + &quot;-default&quot;);</span>
<a href="#l21.435"></a><span id="l21.435" class="difflineplus">+    }</span>
<a href="#l21.436"></a><span id="l21.436" class="difflineplus">+    if (!allowed) {</span>
<a href="#l21.437"></a><span id="l21.437" class="difflineplus">+      // XXX this should be a &quot;security exception&quot; according to spec</span>
<a href="#l21.438"></a><span id="l21.438" class="difflineplus">+      throw(&quot;Not allowed to register a protocol handler for &quot; + aProtocol);</span>
<a href="#l21.439"></a><span id="l21.439" class="difflineplus">+    }</span>
<a href="#l21.440"></a><span id="l21.440" class="difflineplus">+</span>
<a href="#l21.441"></a><span id="l21.441" class="difflineplus">+    var uri = this._checkAndGetURI(aURIString, aContentWindow);</span>
<a href="#l21.442"></a><span id="l21.442" class="difflineplus">+</span>
<a href="#l21.443"></a><span id="l21.443" class="difflineplus">+    var buttons, message;</span>
<a href="#l21.444"></a><span id="l21.444" class="difflineplus">+    if (this._protocolHandlerRegistered(aProtocol, uri.spec))</span>
<a href="#l21.445"></a><span id="l21.445" class="difflineplus">+      message = this._getFormattedString(&quot;protocolHandlerRegistered&quot;,</span>
<a href="#l21.446"></a><span id="l21.446" class="difflineplus">+                                         [aTitle, aProtocol]);</span>
<a href="#l21.447"></a><span id="l21.447" class="difflineplus">+    else {</span>
<a href="#l21.448"></a><span id="l21.448" class="difflineplus">+      // Now Ask the user and provide the proper callback</span>
<a href="#l21.449"></a><span id="l21.449" class="difflineplus">+      message = this._getFormattedString(&quot;addProtocolHandler&quot;,</span>
<a href="#l21.450"></a><span id="l21.450" class="difflineplus">+                                         [aTitle, uri.host, aProtocol]);</span>
<a href="#l21.451"></a><span id="l21.451" class="difflineplus">+      var fis = Components.classes[&quot;@mozilla.org/browser/favicon-service;1&quot;]</span>
<a href="#l21.452"></a><span id="l21.452" class="difflineplus">+                          .getService(Components.interfaces.nsIFaviconService);</span>
<a href="#l21.453"></a><span id="l21.453" class="difflineplus">+      var notificationIcon = fis.getFaviconLinkForIcon(uri);</span>
<a href="#l21.454"></a><span id="l21.454" class="difflineplus">+      var notificationValue = &quot;Protocol Registration: &quot; + aProtocol;</span>
<a href="#l21.455"></a><span id="l21.455" class="difflineplus">+      var addButton = {</span>
<a href="#l21.456"></a><span id="l21.456" class="difflineplus">+        label: this._getString(&quot;addProtocolHandlerAddButton&quot;),</span>
<a href="#l21.457"></a><span id="l21.457" class="difflineplus">+        accessKey: this._getString(&quot;addHandlerAddButtonAccesskey&quot;),</span>
<a href="#l21.458"></a><span id="l21.458" class="difflineplus">+        protocolInfo: { protocol: aProtocol, uri: uri.spec, name: aTitle },</span>
<a href="#l21.459"></a><span id="l21.459" class="difflineplus">+</span>
<a href="#l21.460"></a><span id="l21.460" class="difflineplus">+        callback: function addProtocolHandlerButtonCallback(aNotification, aButtonInfo) {</span>
<a href="#l21.461"></a><span id="l21.461" class="difflineplus">+          var protocol = aButtonInfo.protocolInfo.protocol;</span>
<a href="#l21.462"></a><span id="l21.462" class="difflineplus">+          var uri      = aButtonInfo.protocolInfo.uri;</span>
<a href="#l21.463"></a><span id="l21.463" class="difflineplus">+          var name     = aButtonInfo.protocolInfo.name;</span>
<a href="#l21.464"></a><span id="l21.464" class="difflineplus">+</span>
<a href="#l21.465"></a><span id="l21.465" class="difflineplus">+          var handler = Components.classes[&quot;@mozilla.org/uriloader/web-handler-app;1&quot;]</span>
<a href="#l21.466"></a><span id="l21.466" class="difflineplus">+                                  .createInstance(Components.interfaces.nsIWebHandlerApp);</span>
<a href="#l21.467"></a><span id="l21.467" class="difflineplus">+          handler.name = name;</span>
<a href="#l21.468"></a><span id="l21.468" class="difflineplus">+          handler.uriTemplate = uri;</span>
<a href="#l21.469"></a><span id="l21.469" class="difflineplus">+</span>
<a href="#l21.470"></a><span id="l21.470" class="difflineplus">+          var eps = Components.classes[&quot;@mozilla.org/uriloader/external-protocol-service;1&quot;]</span>
<a href="#l21.471"></a><span id="l21.471" class="difflineplus">+                              .getService(Components.interfaces.nsIExternalProtocolService);</span>
<a href="#l21.472"></a><span id="l21.472" class="difflineplus">+          var handlerInfo = eps.getProtocolHandlerInfo(protocol);</span>
<a href="#l21.473"></a><span id="l21.473" class="difflineplus">+          handlerInfo.possibleApplicationHandlers.appendElement(handler, false);</span>
<a href="#l21.474"></a><span id="l21.474" class="difflineplus">+</span>
<a href="#l21.475"></a><span id="l21.475" class="difflineplus">+          // Since the user has agreed to add a new handler, chances are good</span>
<a href="#l21.476"></a><span id="l21.476" class="difflineplus">+          // that the next time they see a handler of this type, they're going</span>
<a href="#l21.477"></a><span id="l21.477" class="difflineplus">+          // to want to use it.  Reset the handlerInfo to ask before the next</span>
<a href="#l21.478"></a><span id="l21.478" class="difflineplus">+          // use.</span>
<a href="#l21.479"></a><span id="l21.479" class="difflineplus">+          handlerInfo.alwaysAskBeforeHandling = true;</span>
<a href="#l21.480"></a><span id="l21.480" class="difflineplus">+</span>
<a href="#l21.481"></a><span id="l21.481" class="difflineplus">+          var hs = Components.classes[&quot;@mozilla.org/uriloader/handler-service;1&quot;]</span>
<a href="#l21.482"></a><span id="l21.482" class="difflineplus">+                             .getService(Components.interfaces.nsIHandlerService);</span>
<a href="#l21.483"></a><span id="l21.483" class="difflineplus">+          hs.store(handlerInfo);</span>
<a href="#l21.484"></a><span id="l21.484" class="difflineplus">+        }</span>
<a href="#l21.485"></a><span id="l21.485" class="difflineplus">+      };</span>
<a href="#l21.486"></a><span id="l21.486" class="difflineplus">+      buttons = [addButton];</span>
<a href="#l21.487"></a><span id="l21.487" class="difflineplus">+    }</span>
<a href="#l21.488"></a><span id="l21.488" class="difflineplus">+</span>
<a href="#l21.489"></a><span id="l21.489" class="difflineplus">+    var notificationBox = getNotificationBox(browserElement);</span>
<a href="#l21.490"></a><span id="l21.490" class="difflineplus">+    notificationBox.appendNotification(message,</span>
<a href="#l21.491"></a><span id="l21.491" class="difflineplus">+                                       notificationValue,</span>
<a href="#l21.492"></a><span id="l21.492" class="difflineplus">+                                       notificationIcon,</span>
<a href="#l21.493"></a><span id="l21.493" class="difflineplus">+                                       notificationBox.PRIORITY_INFO_LOW,</span>
<a href="#l21.494"></a><span id="l21.494" class="difflineplus">+                                       buttons);</span>
<a href="#l21.495"></a><span id="l21.495" class="difflineplus">+  },</span>
<a href="#l21.496"></a><span id="l21.496" class="difflineplus">+</span>
<a href="#l21.497"></a><span id="l21.497" class="difflineplus">+  /**</span>
<a href="#l21.498"></a><span id="l21.498" class="difflineplus">+   * See nsIWebContentHandlerRegistrar</span>
<a href="#l21.499"></a><span id="l21.499" class="difflineplus">+   * If a DOM window is provided, then the request came from content, so we</span>
<a href="#l21.500"></a><span id="l21.500" class="difflineplus">+   * prompt the user to confirm the registration.</span>
<a href="#l21.501"></a><span id="l21.501" class="difflineplus">+   */</span>
<a href="#l21.502"></a><span id="l21.502" class="difflineplus">+  registerContentHandler: function registerContentHandler(aContentType, aURIString,</span>
<a href="#l21.503"></a><span id="l21.503" class="difflineplus">+                                                           aTitle, aContentWindow) {</span>
<a href="#l21.504"></a><span id="l21.504" class="difflineplus">+    LOG(&quot;registerContentHandler(&quot; + aContentType + &quot;,&quot; + aURIString + &quot;,&quot; + aTitle + &quot;)&quot;);</span>
<a href="#l21.505"></a><span id="l21.505" class="difflineplus">+</span>
<a href="#l21.506"></a><span id="l21.506" class="difflineplus">+    // We only support feed types at present.</span>
<a href="#l21.507"></a><span id="l21.507" class="difflineplus">+    // XXX this should be a &quot;security exception&quot; according to spec, but that</span>
<a href="#l21.508"></a><span id="l21.508" class="difflineplus">+    // isn't defined yet.</span>
<a href="#l21.509"></a><span id="l21.509" class="difflineplus">+    var contentType = this._resolveContentType(aContentType);</span>
<a href="#l21.510"></a><span id="l21.510" class="difflineplus">+    if (contentType != TYPE_MAYBE_FEED)</span>
<a href="#l21.511"></a><span id="l21.511" class="difflineplus">+      return;</span>
<a href="#l21.512"></a><span id="l21.512" class="difflineplus">+</span>
<a href="#l21.513"></a><span id="l21.513" class="difflineplus">+    if (aContentWindow) {</span>
<a href="#l21.514"></a><span id="l21.514" class="difflineplus">+      var uri = this._checkAndGetURI(aURIString, aContentWindow);</span>
<a href="#l21.515"></a><span id="l21.515" class="difflineplus">+</span>
<a href="#l21.516"></a><span id="l21.516" class="difflineplus">+      this._appendFeedReaderNotification(uri, aTitle, getNotificationBox(browserElement));</span>
<a href="#l21.517"></a><span id="l21.517" class="difflineplus">+    }</span>
<a href="#l21.518"></a><span id="l21.518" class="difflineplus">+    else</span>
<a href="#l21.519"></a><span id="l21.519" class="difflineplus">+      this._registerContentHandler(contentType, aURIString, aTitle);</span>
<a href="#l21.520"></a><span id="l21.520" class="difflineplus">+  },</span>
<a href="#l21.521"></a><span id="l21.521" class="difflineplus">+</span>
<a href="#l21.522"></a><span id="l21.522" class="difflineplus">+  /**</span>
<a href="#l21.523"></a><span id="l21.523" class="difflineplus">+   * Appends a notifcation for the given feed reader details.</span>
<a href="#l21.524"></a><span id="l21.524" class="difflineplus">+   *</span>
<a href="#l21.525"></a><span id="l21.525" class="difflineplus">+   * The notification could be either a pseudo-dialog which lets</span>
<a href="#l21.526"></a><span id="l21.526" class="difflineplus">+   * the user to add the feed reader:</span>
<a href="#l21.527"></a><span id="l21.527" class="difflineplus">+   * [ [icon] Add %feed-reader-name% (%feed-reader-host%) as a Feed Reader?  (Add) [x] ]</span>
<a href="#l21.528"></a><span id="l21.528" class="difflineplus">+   *</span>
<a href="#l21.529"></a><span id="l21.529" class="difflineplus">+   * or a simple message for the case where the feed reader is already registered:</span>
<a href="#l21.530"></a><span id="l21.530" class="difflineplus">+   * [ [icon] %feed-reader-name% is already registered as a Feed Reader             [x] ]</span>
<a href="#l21.531"></a><span id="l21.531" class="difflineplus">+   *</span>
<a href="#l21.532"></a><span id="l21.532" class="difflineplus">+   * A new notification isn't appended if the given notificationbox has a</span>
<a href="#l21.533"></a><span id="l21.533" class="difflineplus">+   * notification for the same feed reader.</span>
<a href="#l21.534"></a><span id="l21.534" class="difflineplus">+   *</span>
<a href="#l21.535"></a><span id="l21.535" class="difflineplus">+   * @param aURI</span>
<a href="#l21.536"></a><span id="l21.536" class="difflineplus">+   *        The url of the feed reader as a nsIURI object</span>
<a href="#l21.537"></a><span id="l21.537" class="difflineplus">+   * @param aName</span>
<a href="#l21.538"></a><span id="l21.538" class="difflineplus">+   *        The feed reader name as it was passed to registerContentHandler</span>
<a href="#l21.539"></a><span id="l21.539" class="difflineplus">+   * @param aNotificationBox</span>
<a href="#l21.540"></a><span id="l21.540" class="difflineplus">+   *        The notification box to which a notification might be appended</span>
<a href="#l21.541"></a><span id="l21.541" class="difflineplus">+   * @return true if a notification has been appended, false otherwise.</span>
<a href="#l21.542"></a><span id="l21.542" class="difflineplus">+   */</span>
<a href="#l21.543"></a><span id="l21.543" class="difflineplus">+  _appendFeedReaderNotification: function appendFeedReaderNotification(aURI, aName, aNotificationBox) {</span>
<a href="#l21.544"></a><span id="l21.544" class="difflineplus">+    var uriSpec = aURI.spec;</span>
<a href="#l21.545"></a><span id="l21.545" class="difflineplus">+    var notificationValue = &quot;feed reader notification: &quot; + uriSpec;</span>
<a href="#l21.546"></a><span id="l21.546" class="difflineplus">+    var notificationIcon = aURI.prePath + &quot;/favicon.ico&quot;;</span>
<a href="#l21.547"></a><span id="l21.547" class="difflineplus">+</span>
<a href="#l21.548"></a><span id="l21.548" class="difflineplus">+    // Don't append a new notification if the notificationbox</span>
<a href="#l21.549"></a><span id="l21.549" class="difflineplus">+    // has a notification for the given feed reader already</span>
<a href="#l21.550"></a><span id="l21.550" class="difflineplus">+    if (aNotificationBox.getNotificationWithValue(notificationValue))</span>
<a href="#l21.551"></a><span id="l21.551" class="difflineplus">+      return false;</span>
<a href="#l21.552"></a><span id="l21.552" class="difflineplus">+</span>
<a href="#l21.553"></a><span id="l21.553" class="difflineplus">+    var buttons, message;</span>
<a href="#l21.554"></a><span id="l21.554" class="difflineplus">+    if (this.getWebContentHandlerByURI(TYPE_MAYBE_FEED, uriSpec))</span>
<a href="#l21.555"></a><span id="l21.555" class="difflineplus">+      message = this._getFormattedString(&quot;handlerRegistered&quot;, [aName]);</span>
<a href="#l21.556"></a><span id="l21.556" class="difflineplus">+    else {</span>
<a href="#l21.557"></a><span id="l21.557" class="difflineplus">+      message = this._getFormattedString(&quot;addHandler&quot;, [aName, aURI.host]);</span>
<a href="#l21.558"></a><span id="l21.558" class="difflineplus">+      var self = this;</span>
<a href="#l21.559"></a><span id="l21.559" class="difflineplus">+      var addButton = {</span>
<a href="#l21.560"></a><span id="l21.560" class="difflineplus">+        _outer: self,</span>
<a href="#l21.561"></a><span id="l21.561" class="difflineplus">+        label: self._getString(&quot;addHandlerAddButton&quot;),</span>
<a href="#l21.562"></a><span id="l21.562" class="difflineplus">+        accessKey: self._getString(&quot;addHandlerAddButtonAccesskey&quot;),</span>
<a href="#l21.563"></a><span id="l21.563" class="difflineplus">+        feedReaderInfo: { uri: uriSpec, name: aName },</span>
<a href="#l21.564"></a><span id="l21.564" class="difflineplus">+</span>
<a href="#l21.565"></a><span id="l21.565" class="difflineplus">+        /* static */</span>
<a href="#l21.566"></a><span id="l21.566" class="difflineplus">+        callback: function addFeedReaderButtonCallback(aNotification, aButtonInfo) {</span>
<a href="#l21.567"></a><span id="l21.567" class="difflineplus">+          var uri = aButtonInfo.feedReaderInfo.uri;</span>
<a href="#l21.568"></a><span id="l21.568" class="difflineplus">+          var name = aButtonInfo.feedReaderInfo.name;</span>
<a href="#l21.569"></a><span id="l21.569" class="difflineplus">+          var outer = aButtonInfo._outer;</span>
<a href="#l21.570"></a><span id="l21.570" class="difflineplus">+</span>
<a href="#l21.571"></a><span id="l21.571" class="difflineplus">+          // The reader could have been added from another window mean while</span>
<a href="#l21.572"></a><span id="l21.572" class="difflineplus">+          if (!outer.getWebContentHandlerByURI(TYPE_MAYBE_FEED, uri))</span>
<a href="#l21.573"></a><span id="l21.573" class="difflineplus">+            outer._registerContentHandler(TYPE_MAYBE_FEED, uri, name);</span>
<a href="#l21.574"></a><span id="l21.574" class="difflineplus">+</span>
<a href="#l21.575"></a><span id="l21.575" class="difflineplus">+          // avoid reference cycles</span>
<a href="#l21.576"></a><span id="l21.576" class="difflineplus">+          aButtonInfo._outer = null;</span>
<a href="#l21.577"></a><span id="l21.577" class="difflineplus">+</span>
<a href="#l21.578"></a><span id="l21.578" class="difflineplus">+          return false;</span>
<a href="#l21.579"></a><span id="l21.579" class="difflineplus">+        }</span>
<a href="#l21.580"></a><span id="l21.580" class="difflineplus">+      };</span>
<a href="#l21.581"></a><span id="l21.581" class="difflineplus">+      buttons = [addButton];</span>
<a href="#l21.582"></a><span id="l21.582" class="difflineplus">+    }</span>
<a href="#l21.583"></a><span id="l21.583" class="difflineplus">+</span>
<a href="#l21.584"></a><span id="l21.584" class="difflineplus">+    aNotificationBox.appendNotification(message,</span>
<a href="#l21.585"></a><span id="l21.585" class="difflineplus">+                                        notificationValue,</span>
<a href="#l21.586"></a><span id="l21.586" class="difflineplus">+                                        notificationIcon,</span>
<a href="#l21.587"></a><span id="l21.587" class="difflineplus">+                                        aNotificationBox.PRIORITY_INFO_LOW,</span>
<a href="#l21.588"></a><span id="l21.588" class="difflineplus">+                                        buttons);</span>
<a href="#l21.589"></a><span id="l21.589" class="difflineplus">+    return true;</span>
<a href="#l21.590"></a><span id="l21.590" class="difflineplus">+  },</span>
<a href="#l21.591"></a><span id="l21.591" class="difflineplus">+</span>
<a href="#l21.592"></a><span id="l21.592" class="difflineplus">+  /**</span>
<a href="#l21.593"></a><span id="l21.593" class="difflineplus">+   * Save Web Content Handler metadata to persistent preferences.</span>
<a href="#l21.594"></a><span id="l21.594" class="difflineplus">+   * @param   contentType</span>
<a href="#l21.595"></a><span id="l21.595" class="difflineplus">+   *          The content Type being handled</span>
<a href="#l21.596"></a><span id="l21.596" class="difflineplus">+   * @param   uri</span>
<a href="#l21.597"></a><span id="l21.597" class="difflineplus">+   *          The uri of the web service</span>
<a href="#l21.598"></a><span id="l21.598" class="difflineplus">+   * @param   title</span>
<a href="#l21.599"></a><span id="l21.599" class="difflineplus">+   *          The human readable name of the web service</span>
<a href="#l21.600"></a><span id="l21.600" class="difflineplus">+   *</span>
<a href="#l21.601"></a><span id="l21.601" class="difflineplus">+   * This data is stored under:</span>
<a href="#l21.602"></a><span id="l21.602" class="difflineplus">+   *</span>
<a href="#l21.603"></a><span id="l21.603" class="difflineplus">+   *    browser.contentHandlers.type0 = content/type</span>
<a href="#l21.604"></a><span id="l21.604" class="difflineplus">+   *    browser.contentHandlers.uri0 = http://www.foo.com/q=%s</span>
<a href="#l21.605"></a><span id="l21.605" class="difflineplus">+   *    browser.contentHandlers.title0 = Foo 2.0alphr</span>
<a href="#l21.606"></a><span id="l21.606" class="difflineplus">+   */</span>
<a href="#l21.607"></a><span id="l21.607" class="difflineplus">+  _saveContentHandlerToPrefs: function saveContentHandlerToPrefs(contentType, uri, title) {</span>
<a href="#l21.608"></a><span id="l21.608" class="difflineplus">+    var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l21.609"></a><span id="l21.609" class="difflineplus">+                          .getService(Components.interfaces.nsIPrefService);</span>
<a href="#l21.610"></a><span id="l21.610" class="difflineplus">+    var i = 0;</span>
<a href="#l21.611"></a><span id="l21.611" class="difflineplus">+    var typeBranch = null;</span>
<a href="#l21.612"></a><span id="l21.612" class="difflineplus">+    while (true) {</span>
<a href="#l21.613"></a><span id="l21.613" class="difflineplus">+      typeBranch = prefs.getBranch(PREF_CONTENTHANDLERS_BRANCH + i + &quot;.&quot;);</span>
<a href="#l21.614"></a><span id="l21.614" class="difflineplus">+      try {</span>
<a href="#l21.615"></a><span id="l21.615" class="difflineplus">+        typeBranch.getCharPref(&quot;type&quot;);</span>
<a href="#l21.616"></a><span id="l21.616" class="difflineplus">+        ++i;</span>
<a href="#l21.617"></a><span id="l21.617" class="difflineplus">+      }</span>
<a href="#l21.618"></a><span id="l21.618" class="difflineplus">+      catch (e) {</span>
<a href="#l21.619"></a><span id="l21.619" class="difflineplus">+        // No more handlers</span>
<a href="#l21.620"></a><span id="l21.620" class="difflineplus">+        break;</span>
<a href="#l21.621"></a><span id="l21.621" class="difflineplus">+      }</span>
<a href="#l21.622"></a><span id="l21.622" class="difflineplus">+    }</span>
<a href="#l21.623"></a><span id="l21.623" class="difflineplus">+    if (typeBranch) {</span>
<a href="#l21.624"></a><span id="l21.624" class="difflineplus">+      typeBranch.setCharPref(&quot;type&quot;, contentType);</span>
<a href="#l21.625"></a><span id="l21.625" class="difflineplus">+      var pls = Components.classes[&quot;@mozilla.org/pref-localizedstring;1&quot;]</span>
<a href="#l21.626"></a><span id="l21.626" class="difflineplus">+                          .createInstance(Components.interfaces.nsIPrefLocalizedString);</span>
<a href="#l21.627"></a><span id="l21.627" class="difflineplus">+      pls.data = uri;</span>
<a href="#l21.628"></a><span id="l21.628" class="difflineplus">+      typeBranch.setComplexValue(&quot;uri&quot;,</span>
<a href="#l21.629"></a><span id="l21.629" class="difflineplus">+                                 Components.interfaces.nsIPrefLocalizedString, pls);</span>
<a href="#l21.630"></a><span id="l21.630" class="difflineplus">+      pls.data = title;</span>
<a href="#l21.631"></a><span id="l21.631" class="difflineplus">+      typeBranch.setComplexValue(&quot;title&quot;,</span>
<a href="#l21.632"></a><span id="l21.632" class="difflineplus">+                                 Components.interfaces.nsIPrefLocalizedString, pls);</span>
<a href="#l21.633"></a><span id="l21.633" class="difflineplus">+</span>
<a href="#l21.634"></a><span id="l21.634" class="difflineplus">+      prefs.savePrefFile(null);</span>
<a href="#l21.635"></a><span id="l21.635" class="difflineplus">+    }</span>
<a href="#l21.636"></a><span id="l21.636" class="difflineplus">+  },</span>
<a href="#l21.637"></a><span id="l21.637" class="difflineplus">+</span>
<a href="#l21.638"></a><span id="l21.638" class="difflineplus">+  /**</span>
<a href="#l21.639"></a><span id="l21.639" class="difflineplus">+   * Determines if there is a type with a particular uri registered for the</span>
<a href="#l21.640"></a><span id="l21.640" class="difflineplus">+   * specified content type already.</span>
<a href="#l21.641"></a><span id="l21.641" class="difflineplus">+   * @param   contentType</span>
<a href="#l21.642"></a><span id="l21.642" class="difflineplus">+   *          The content type that the uri handles</span>
<a href="#l21.643"></a><span id="l21.643" class="difflineplus">+   * @param   uri</span>
<a href="#l21.644"></a><span id="l21.644" class="difflineplus">+   *          The uri of the</span>
<a href="#l21.645"></a><span id="l21.645" class="difflineplus">+   */</span>
<a href="#l21.646"></a><span id="l21.646" class="difflineplus">+  _typeIsRegistered: function typeIsRegistered(contentType, uri) {</span>
<a href="#l21.647"></a><span id="l21.647" class="difflineplus">+    if (!(contentType in this._contentTypes))</span>
<a href="#l21.648"></a><span id="l21.648" class="difflineplus">+      return false;</span>
<a href="#l21.649"></a><span id="l21.649" class="difflineplus">+</span>
<a href="#l21.650"></a><span id="l21.650" class="difflineplus">+    var services = this._contentTypes[contentType];</span>
<a href="#l21.651"></a><span id="l21.651" class="difflineplus">+    for (let i = 0; i &lt; services.length; ++i) {</span>
<a href="#l21.652"></a><span id="l21.652" class="difflineplus">+      // This uri has already been registered</span>
<a href="#l21.653"></a><span id="l21.653" class="difflineplus">+      if (services[i].uri == uri)</span>
<a href="#l21.654"></a><span id="l21.654" class="difflineplus">+        return true;</span>
<a href="#l21.655"></a><span id="l21.655" class="difflineplus">+    }</span>
<a href="#l21.656"></a><span id="l21.656" class="difflineplus">+    return false;</span>
<a href="#l21.657"></a><span id="l21.657" class="difflineplus">+  },</span>
<a href="#l21.658"></a><span id="l21.658" class="difflineplus">+</span>
<a href="#l21.659"></a><span id="l21.659" class="difflineplus">+  /**</span>
<a href="#l21.660"></a><span id="l21.660" class="difflineplus">+   * Gets a stream converter contract id for the specified content type.</span>
<a href="#l21.661"></a><span id="l21.661" class="difflineplus">+   * @param   contentType</span>
<a href="#l21.662"></a><span id="l21.662" class="difflineplus">+   *          The source content type for the conversion.</span>
<a href="#l21.663"></a><span id="l21.663" class="difflineplus">+   * @returns A contract id to construct a converter to convert between the</span>
<a href="#l21.664"></a><span id="l21.664" class="difflineplus">+   *          contentType and *\/*.</span>
<a href="#l21.665"></a><span id="l21.665" class="difflineplus">+   */</span>
<a href="#l21.666"></a><span id="l21.666" class="difflineplus">+  _getConverterContractID: function getConverterContractID(contentType) {</span>
<a href="#l21.667"></a><span id="l21.667" class="difflineplus">+    const template = &quot;@mozilla.org/streamconv;1?from=%s&amp;to=*/*&quot;;</span>
<a href="#l21.668"></a><span id="l21.668" class="difflineplus">+    return template.replace(/%s/, contentType);</span>
<a href="#l21.669"></a><span id="l21.669" class="difflineplus">+  },</span>
<a href="#l21.670"></a><span id="l21.670" class="difflineplus">+</span>
<a href="#l21.671"></a><span id="l21.671" class="difflineplus">+  /**</span>
<a href="#l21.672"></a><span id="l21.672" class="difflineplus">+   * Register a web service handler for a content type.</span>
<a href="#l21.673"></a><span id="l21.673" class="difflineplus">+   *</span>
<a href="#l21.674"></a><span id="l21.674" class="difflineplus">+   * @param   contentType</span>
<a href="#l21.675"></a><span id="l21.675" class="difflineplus">+   *          the content type being handled</span>
<a href="#l21.676"></a><span id="l21.676" class="difflineplus">+   * @param   uri</span>
<a href="#l21.677"></a><span id="l21.677" class="difflineplus">+   *          the URI of the web service</span>
<a href="#l21.678"></a><span id="l21.678" class="difflineplus">+   * @param   title</span>
<a href="#l21.679"></a><span id="l21.679" class="difflineplus">+   *          the human readable name of the web service</span>
<a href="#l21.680"></a><span id="l21.680" class="difflineplus">+   */</span>
<a href="#l21.681"></a><span id="l21.681" class="difflineplus">+  _registerContentHandler: function registerContentHandler(contentType, uri, title) {</span>
<a href="#l21.682"></a><span id="l21.682" class="difflineplus">+    this._updateContentTypeHandlerMap(contentType, uri, title);</span>
<a href="#l21.683"></a><span id="l21.683" class="difflineplus">+    this._saveContentHandlerToPrefs(contentType, uri, title);</span>
<a href="#l21.684"></a><span id="l21.684" class="difflineplus">+</span>
<a href="#l21.685"></a><span id="l21.685" class="difflineplus">+    if (contentType == TYPE_MAYBE_FEED) {</span>
<a href="#l21.686"></a><span id="l21.686" class="difflineplus">+      // Make the new handler the last-selected reader in the preview page</span>
<a href="#l21.687"></a><span id="l21.687" class="difflineplus">+      // and make sure the preview page is shown the next time a feed is visited</span>
<a href="#l21.688"></a><span id="l21.688" class="difflineplus">+      var pb = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l21.689"></a><span id="l21.689" class="difflineplus">+                         .getService(Components.interfaces.nsIPrefService).getBranch(null);</span>
<a href="#l21.690"></a><span id="l21.690" class="difflineplus">+      pb.setCharPref(PREF_SELECTED_READER, &quot;web&quot;);</span>
<a href="#l21.691"></a><span id="l21.691" class="difflineplus">+</span>
<a href="#l21.692"></a><span id="l21.692" class="difflineplus">+      var supportsString = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l21.693"></a><span id="l21.693" class="difflineplus">+                                     .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l21.694"></a><span id="l21.694" class="difflineplus">+      supportsString.data = uri;</span>
<a href="#l21.695"></a><span id="l21.695" class="difflineplus">+      pb.setComplexValue(PREF_SELECTED_WEB, Components.interfaces.nsISupportsString,</span>
<a href="#l21.696"></a><span id="l21.696" class="difflineplus">+                         supportsString);</span>
<a href="#l21.697"></a><span id="l21.697" class="difflineplus">+      pb.setCharPref(PREF_SELECTED_ACTION, &quot;ask&quot;);</span>
<a href="#l21.698"></a><span id="l21.698" class="difflineplus">+      this._setAutoHandler(TYPE_MAYBE_FEED, null);</span>
<a href="#l21.699"></a><span id="l21.699" class="difflineplus">+    }</span>
<a href="#l21.700"></a><span id="l21.700" class="difflineplus">+  },</span>
<a href="#l21.701"></a><span id="l21.701" class="difflineplus">+</span>
<a href="#l21.702"></a><span id="l21.702" class="difflineplus">+  /**</span>
<a href="#l21.703"></a><span id="l21.703" class="difflineplus">+   * Update the content type -&gt; handler map. This mapping is not persisted, use</span>
<a href="#l21.704"></a><span id="l21.704" class="difflineplus">+   * registerContentHandler or _saveContentHandlerToPrefs for that purpose.</span>
<a href="#l21.705"></a><span id="l21.705" class="difflineplus">+   * @param   contentType</span>
<a href="#l21.706"></a><span id="l21.706" class="difflineplus">+   *          The content Type being handled</span>
<a href="#l21.707"></a><span id="l21.707" class="difflineplus">+   * @param   uri</span>
<a href="#l21.708"></a><span id="l21.708" class="difflineplus">+   *          The uri of the web service</span>
<a href="#l21.709"></a><span id="l21.709" class="difflineplus">+   * @param   title</span>
<a href="#l21.710"></a><span id="l21.710" class="difflineplus">+   *          The human readable name of the web service</span>
<a href="#l21.711"></a><span id="l21.711" class="difflineplus">+   */</span>
<a href="#l21.712"></a><span id="l21.712" class="difflineplus">+  _updateContentTypeHandlerMap: function updateContentTypeHandlerMap(contentType, uri, title) {</span>
<a href="#l21.713"></a><span id="l21.713" class="difflineplus">+    if (!(contentType in this._contentTypes))</span>
<a href="#l21.714"></a><span id="l21.714" class="difflineplus">+      this._contentTypes[contentType] = [];</span>
<a href="#l21.715"></a><span id="l21.715" class="difflineplus">+</span>
<a href="#l21.716"></a><span id="l21.716" class="difflineplus">+    // Avoid adding duplicates</span>
<a href="#l21.717"></a><span id="l21.717" class="difflineplus">+    if (this._typeIsRegistered(contentType, uri))</span>
<a href="#l21.718"></a><span id="l21.718" class="difflineplus">+      return;</span>
<a href="#l21.719"></a><span id="l21.719" class="difflineplus">+</span>
<a href="#l21.720"></a><span id="l21.720" class="difflineplus">+    this._contentTypes[contentType].push(new ServiceInfo(contentType, uri, title));</span>
<a href="#l21.721"></a><span id="l21.721" class="difflineplus">+</span>
<a href="#l21.722"></a><span id="l21.722" class="difflineplus">+    if (!(contentType in this._blockedTypes)) {</span>
<a href="#l21.723"></a><span id="l21.723" class="difflineplus">+      var converterContractID = this._getConverterContractID(contentType);</span>
<a href="#l21.724"></a><span id="l21.724" class="difflineplus">+      var cr = Components.manager.QueryInterface(Components.interfaces.nsIComponentRegistrar);</span>
<a href="#l21.725"></a><span id="l21.725" class="difflineplus">+      cr.registerFactory(WCC_CLASSID, WCC_CLASSNAME, converterContractID,</span>
<a href="#l21.726"></a><span id="l21.726" class="difflineplus">+                         WebContentConverterFactory);</span>
<a href="#l21.727"></a><span id="l21.727" class="difflineplus">+    }</span>
<a href="#l21.728"></a><span id="l21.728" class="difflineplus">+  },</span>
<a href="#l21.729"></a><span id="l21.729" class="difflineplus">+</span>
<a href="#l21.730"></a><span id="l21.730" class="difflineplus">+  /**</span>
<a href="#l21.731"></a><span id="l21.731" class="difflineplus">+   * See nsIWebContentConverterService</span>
<a href="#l21.732"></a><span id="l21.732" class="difflineplus">+   */</span>
<a href="#l21.733"></a><span id="l21.733" class="difflineplus">+  getContentHandlers: function getContentHandlers(contentType, countRef) {</span>
<a href="#l21.734"></a><span id="l21.734" class="difflineplus">+    countRef.value = 0;</span>
<a href="#l21.735"></a><span id="l21.735" class="difflineplus">+    if (!(contentType in this._contentTypes))</span>
<a href="#l21.736"></a><span id="l21.736" class="difflineplus">+      return [];</span>
<a href="#l21.737"></a><span id="l21.737" class="difflineplus">+</span>
<a href="#l21.738"></a><span id="l21.738" class="difflineplus">+    var handlers = this._contentTypes[contentType];</span>
<a href="#l21.739"></a><span id="l21.739" class="difflineplus">+    countRef.value = handlers.length;</span>
<a href="#l21.740"></a><span id="l21.740" class="difflineplus">+    return handlers;</span>
<a href="#l21.741"></a><span id="l21.741" class="difflineplus">+  },</span>
<a href="#l21.742"></a><span id="l21.742" class="difflineplus">+</span>
<a href="#l21.743"></a><span id="l21.743" class="difflineplus">+  /**</span>
<a href="#l21.744"></a><span id="l21.744" class="difflineplus">+   * See nsIWebContentConverterService</span>
<a href="#l21.745"></a><span id="l21.745" class="difflineplus">+   */</span>
<a href="#l21.746"></a><span id="l21.746" class="difflineplus">+  resetHandlersForType: function resetHandlersForType(contentType) {</span>
<a href="#l21.747"></a><span id="l21.747" class="difflineplus">+    // currently unused within the tree, so only useful for extensions; previous</span>
<a href="#l21.748"></a><span id="l21.748" class="difflineplus">+    // impl. was buggy (and even infinite-looped!), so I argue that this is a</span>
<a href="#l21.749"></a><span id="l21.749" class="difflineplus">+    // definite improvement</span>
<a href="#l21.750"></a><span id="l21.750" class="difflineplus">+    throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l21.751"></a><span id="l21.751" class="difflineplus">+  },</span>
<a href="#l21.752"></a><span id="l21.752" class="difflineplus">+</span>
<a href="#l21.753"></a><span id="l21.753" class="difflineplus">+  /**</span>
<a href="#l21.754"></a><span id="l21.754" class="difflineplus">+   * Registers a handler from the settings on a preferences branch.</span>
<a href="#l21.755"></a><span id="l21.755" class="difflineplus">+   *</span>
<a href="#l21.756"></a><span id="l21.756" class="difflineplus">+   * @param branch</span>
<a href="#l21.757"></a><span id="l21.757" class="difflineplus">+   *        an nsIPrefBranch containing &quot;type&quot;, &quot;uri&quot;, and &quot;title&quot; preferences</span>
<a href="#l21.758"></a><span id="l21.758" class="difflineplus">+   *        corresponding to the content handler to be registered</span>
<a href="#l21.759"></a><span id="l21.759" class="difflineplus">+   */</span>
<a href="#l21.760"></a><span id="l21.760" class="difflineplus">+  _registerContentHandlerWithBranch: function(branch) {</span>
<a href="#l21.761"></a><span id="l21.761" class="difflineplus">+    /**</span>
<a href="#l21.762"></a><span id="l21.762" class="difflineplus">+     * Since we support up to six predefined readers, we need to handle gaps</span>
<a href="#l21.763"></a><span id="l21.763" class="difflineplus">+     * better, since the first branch with user-added values will be .6</span>
<a href="#l21.764"></a><span id="l21.764" class="difflineplus">+     *</span>
<a href="#l21.765"></a><span id="l21.765" class="difflineplus">+     * How we deal with that is to check to see if there's no prefs in the</span>
<a href="#l21.766"></a><span id="l21.766" class="difflineplus">+     * branch and stop cycling once that's true.  This doesn't fix the case</span>
<a href="#l21.767"></a><span id="l21.767" class="difflineplus">+     * where a user manually removes a reader, but that's not supported yet!</span>
<a href="#l21.768"></a><span id="l21.768" class="difflineplus">+     */</span>
<a href="#l21.769"></a><span id="l21.769" class="difflineplus">+    var vals = branch.getChildList(&quot;&quot;, {});</span>
<a href="#l21.770"></a><span id="l21.770" class="difflineplus">+    if (vals.length == 0)</span>
<a href="#l21.771"></a><span id="l21.771" class="difflineplus">+      return;</span>
<a href="#l21.772"></a><span id="l21.772" class="difflineplus">+</span>
<a href="#l21.773"></a><span id="l21.773" class="difflineplus">+    try {</span>
<a href="#l21.774"></a><span id="l21.774" class="difflineplus">+      var type = branch.getCharPref(&quot;type&quot;);</span>
<a href="#l21.775"></a><span id="l21.775" class="difflineplus">+      var uri = branch.getComplexValue(&quot;uri&quot;, Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l21.776"></a><span id="l21.776" class="difflineplus">+      var title = branch.getComplexValue(&quot;title&quot;,</span>
<a href="#l21.777"></a><span id="l21.777" class="difflineplus">+                                         Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l21.778"></a><span id="l21.778" class="difflineplus">+      this._updateContentTypeHandlerMap(type, uri, title);</span>
<a href="#l21.779"></a><span id="l21.779" class="difflineplus">+    }</span>
<a href="#l21.780"></a><span id="l21.780" class="difflineplus">+    catch(ex) {</span>
<a href="#l21.781"></a><span id="l21.781" class="difflineplus">+      // do nothing, the next branch might have values</span>
<a href="#l21.782"></a><span id="l21.782" class="difflineplus">+    }</span>
<a href="#l21.783"></a><span id="l21.783" class="difflineplus">+  },</span>
<a href="#l21.784"></a><span id="l21.784" class="difflineplus">+</span>
<a href="#l21.785"></a><span id="l21.785" class="difflineplus">+  /**</span>
<a href="#l21.786"></a><span id="l21.786" class="difflineplus">+   * Load the auto handler, content handler and protocol tables from</span>
<a href="#l21.787"></a><span id="l21.787" class="difflineplus">+   * preferences.</span>
<a href="#l21.788"></a><span id="l21.788" class="difflineplus">+   */</span>
<a href="#l21.789"></a><span id="l21.789" class="difflineplus">+  _init: function init() {</span>
<a href="#l21.790"></a><span id="l21.790" class="difflineplus">+    var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l21.791"></a><span id="l21.791" class="difflineplus">+                          .getService(Components.interfaces.nsIPrefService);</span>
<a href="#l21.792"></a><span id="l21.792" class="difflineplus">+</span>
<a href="#l21.793"></a><span id="l21.793" class="difflineplus">+    var kids = prefs.getBranch(PREF_CONTENTHANDLERS_BRANCH)</span>
<a href="#l21.794"></a><span id="l21.794" class="difflineplus">+                    .getChildList(&quot;&quot;, {});</span>
<a href="#l21.795"></a><span id="l21.795" class="difflineplus">+    // first get the numbers of the providers by getting all ###.uri prefs</span>
<a href="#l21.796"></a><span id="l21.796" class="difflineplus">+    var nums = [];</span>
<a href="#l21.797"></a><span id="l21.797" class="difflineplus">+    for (let i = 0; i &lt; kids.length; i++) {</span>
<a href="#l21.798"></a><span id="l21.798" class="difflineplus">+      let match = /^(\d+)\.uri$/.exec(kids[i]);</span>
<a href="#l21.799"></a><span id="l21.799" class="difflineplus">+      if (match)</span>
<a href="#l21.800"></a><span id="l21.800" class="difflineplus">+        nums.push(match[1]);</span>
<a href="#l21.801"></a><span id="l21.801" class="difflineplus">+    }</span>
<a href="#l21.802"></a><span id="l21.802" class="difflineplus">+    // sort them, to get them back in order</span>
<a href="#l21.803"></a><span id="l21.803" class="difflineplus">+    nums.sort(function(a, b) {return a - b;});</span>
<a href="#l21.804"></a><span id="l21.804" class="difflineplus">+    // now register them</span>
<a href="#l21.805"></a><span id="l21.805" class="difflineplus">+    for (let i = 0; i &lt; nums.length; i++) {</span>
<a href="#l21.806"></a><span id="l21.806" class="difflineplus">+      let branch = prefs.getBranch(PREF_CONTENTHANDLERS_BRANCH + nums[i] + &quot;.&quot;);</span>
<a href="#l21.807"></a><span id="l21.807" class="difflineplus">+      this._registerContentHandlerWithBranch(branch);</span>
<a href="#l21.808"></a><span id="l21.808" class="difflineplus">+    }</span>
<a href="#l21.809"></a><span id="l21.809" class="difflineplus">+</span>
<a href="#l21.810"></a><span id="l21.810" class="difflineplus">+    // We need to do this _after_ registering all of the available handlers,</span>
<a href="#l21.811"></a><span id="l21.811" class="difflineplus">+    // so that getWebContentHandlerByURI can return successfully.</span>
<a href="#l21.812"></a><span id="l21.812" class="difflineplus">+    try {</span>
<a href="#l21.813"></a><span id="l21.813" class="difflineplus">+      var autoBranch = prefs.getBranch(PREF_CONTENTHANDLERS_AUTO);</span>
<a href="#l21.814"></a><span id="l21.814" class="difflineplus">+      var childPrefs = autoBranch.getChildList(&quot;&quot;, { });</span>
<a href="#l21.815"></a><span id="l21.815" class="difflineplus">+      for (let i = 0; i &lt; childPrefs.length; ++i) {</span>
<a href="#l21.816"></a><span id="l21.816" class="difflineplus">+        let type = childPrefs[i];</span>
<a href="#l21.817"></a><span id="l21.817" class="difflineplus">+        let uri = autoBranch.getCharPref(type);</span>
<a href="#l21.818"></a><span id="l21.818" class="difflineplus">+        if (uri) {</span>
<a href="#l21.819"></a><span id="l21.819" class="difflineplus">+          let handler = this.getWebContentHandlerByURI(type, uri);</span>
<a href="#l21.820"></a><span id="l21.820" class="difflineplus">+          this._setAutoHandler(type, handler);</span>
<a href="#l21.821"></a><span id="l21.821" class="difflineplus">+        }</span>
<a href="#l21.822"></a><span id="l21.822" class="difflineplus">+      }</span>
<a href="#l21.823"></a><span id="l21.823" class="difflineplus">+    }</span>
<a href="#l21.824"></a><span id="l21.824" class="difflineplus">+    catch (e) {</span>
<a href="#l21.825"></a><span id="l21.825" class="difflineplus">+    }</span>
<a href="#l21.826"></a><span id="l21.826" class="difflineplus">+  },</span>
<a href="#l21.827"></a><span id="l21.827" class="difflineplus">+</span>
<a href="#l21.828"></a><span id="l21.828" class="difflineplus">+  /**</span>
<a href="#l21.829"></a><span id="l21.829" class="difflineplus">+   * See nsIObserver</span>
<a href="#l21.830"></a><span id="l21.830" class="difflineplus">+   */</span>
<a href="#l21.831"></a><span id="l21.831" class="difflineplus">+  observe: function observe(subject, topic, data) {</span>
<a href="#l21.832"></a><span id="l21.832" class="difflineplus">+    var os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l21.833"></a><span id="l21.833" class="difflineplus">+                       .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l21.834"></a><span id="l21.834" class="difflineplus">+    switch (topic) {</span>
<a href="#l21.835"></a><span id="l21.835" class="difflineplus">+    case &quot;app-startup&quot;:</span>
<a href="#l21.836"></a><span id="l21.836" class="difflineplus">+      os.addObserver(this, &quot;final-ui-startup&quot;, false);</span>
<a href="#l21.837"></a><span id="l21.837" class="difflineplus">+      break;</span>
<a href="#l21.838"></a><span id="l21.838" class="difflineplus">+    case &quot;final-ui-startup&quot;:</span>
<a href="#l21.839"></a><span id="l21.839" class="difflineplus">+      os.removeObserver(this, &quot;final-ui-startup&quot;);</span>
<a href="#l21.840"></a><span id="l21.840" class="difflineplus">+      this._init();</span>
<a href="#l21.841"></a><span id="l21.841" class="difflineplus">+      break;</span>
<a href="#l21.842"></a><span id="l21.842" class="difflineplus">+    }</span>
<a href="#l21.843"></a><span id="l21.843" class="difflineplus">+  },</span>
<a href="#l21.844"></a><span id="l21.844" class="difflineplus">+</span>
<a href="#l21.845"></a><span id="l21.845" class="difflineplus">+  /**</span>
<a href="#l21.846"></a><span id="l21.846" class="difflineplus">+   * See nsIFactory</span>
<a href="#l21.847"></a><span id="l21.847" class="difflineplus">+   */</span>
<a href="#l21.848"></a><span id="l21.848" class="difflineplus">+  createInstance: function createInstance(outer, iid) {</span>
<a href="#l21.849"></a><span id="l21.849" class="difflineplus">+    if (outer != null)</span>
<a href="#l21.850"></a><span id="l21.850" class="difflineplus">+      throw Components.results.NS_ERROR_NO_AGGREGATION;</span>
<a href="#l21.851"></a><span id="l21.851" class="difflineplus">+    return this.QueryInterface(iid);</span>
<a href="#l21.852"></a><span id="l21.852" class="difflineplus">+  },</span>
<a href="#l21.853"></a><span id="l21.853" class="difflineplus">+</span>
<a href="#l21.854"></a><span id="l21.854" class="difflineplus">+  /**</span>
<a href="#l21.855"></a><span id="l21.855" class="difflineplus">+   * See nsIClassInfo</span>
<a href="#l21.856"></a><span id="l21.856" class="difflineplus">+   */</span>
<a href="#l21.857"></a><span id="l21.857" class="difflineplus">+  getInterfaces: function getInterfaces(countRef) {</span>
<a href="#l21.858"></a><span id="l21.858" class="difflineplus">+    var interfaces = [Components.interfaces.nsIWebContentConverterService,</span>
<a href="#l21.859"></a><span id="l21.859" class="difflineplus">+                      Components.interfaces.nsIWebContentHandlerRegistrar,</span>
<a href="#l21.860"></a><span id="l21.860" class="difflineplus">+                      Components.interfaces.nsIObserver,</span>
<a href="#l21.861"></a><span id="l21.861" class="difflineplus">+                      Components.interfaces.nsIClassInfo,</span>
<a href="#l21.862"></a><span id="l21.862" class="difflineplus">+                      Components.interfaces.nsIFactory,</span>
<a href="#l21.863"></a><span id="l21.863" class="difflineplus">+                      Components.interfaces.nsISupports];</span>
<a href="#l21.864"></a><span id="l21.864" class="difflineplus">+    countRef.value = interfaces.length;</span>
<a href="#l21.865"></a><span id="l21.865" class="difflineplus">+    return interfaces;</span>
<a href="#l21.866"></a><span id="l21.866" class="difflineplus">+  },</span>
<a href="#l21.867"></a><span id="l21.867" class="difflineplus">+</span>
<a href="#l21.868"></a><span id="l21.868" class="difflineplus">+ getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l21.869"></a><span id="l21.869" class="difflineplus">+    return null;</span>
<a href="#l21.870"></a><span id="l21.870" class="difflineplus">+  },</span>
<a href="#l21.871"></a><span id="l21.871" class="difflineplus">+</span>
<a href="#l21.872"></a><span id="l21.872" class="difflineplus">+  contractID: WCCR_CONTRACTID,</span>
<a href="#l21.873"></a><span id="l21.873" class="difflineplus">+  classDescription: WCCR_CLASSNAME,</span>
<a href="#l21.874"></a><span id="l21.874" class="difflineplus">+  classID: WCCR_CLASSID,</span>
<a href="#l21.875"></a><span id="l21.875" class="difflineplus">+  implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l21.876"></a><span id="l21.876" class="difflineplus">+  flags: Components.interfaces.nsIClassInfo.DOM_OBJECT,</span>
<a href="#l21.877"></a><span id="l21.877" class="difflineplus">+</span>
<a href="#l21.878"></a><span id="l21.878" class="difflineplus">+  /**</span>
<a href="#l21.879"></a><span id="l21.879" class="difflineplus">+   * See nsISupports</span>
<a href="#l21.880"></a><span id="l21.880" class="difflineplus">+   */</span>
<a href="#l21.881"></a><span id="l21.881" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI(</span>
<a href="#l21.882"></a><span id="l21.882" class="difflineplus">+    [Components.interfaces.nsIWebContentConverterService,</span>
<a href="#l21.883"></a><span id="l21.883" class="difflineplus">+     Components.interfaces.nsIWebContentHandlerRegistrar,</span>
<a href="#l21.884"></a><span id="l21.884" class="difflineplus">+     Components.interfaces.nsIObserver,</span>
<a href="#l21.885"></a><span id="l21.885" class="difflineplus">+     Components.interfaces.nsIClassInfo,</span>
<a href="#l21.886"></a><span id="l21.886" class="difflineplus">+     Components.interfaces.nsIFactory,</span>
<a href="#l21.887"></a><span id="l21.887" class="difflineplus">+     Components.interfaces.nsISupports]),</span>
<a href="#l21.888"></a><span id="l21.888" class="difflineplus">+</span>
<a href="#l21.889"></a><span id="l21.889" class="difflineplus">+  _xpcom_categories: [{</span>
<a href="#l21.890"></a><span id="l21.890" class="difflineplus">+    category: &quot;app-startup&quot;,</span>
<a href="#l21.891"></a><span id="l21.891" class="difflineplus">+    service: true</span>
<a href="#l21.892"></a><span id="l21.892" class="difflineplus">+  }]</span>
<a href="#l21.893"></a><span id="l21.893" class="difflineplus">+};</span>
<a href="#l21.894"></a><span id="l21.894" class="difflineplus">+</span>
<a href="#l21.895"></a><span id="l21.895" class="difflineplus">+function NSGetModule(cm, file) {</span>
<a href="#l21.896"></a><span id="l21.896" class="difflineplus">+  return XPCOMUtils.generateModule([WebContentConverterRegistrar]);</span>
<a href="#l21.897"></a><span id="l21.897" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">new file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- /dev/null</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ b/suite/feeds/src/nsAboutFeeds.js</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -0,0 +1,80 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineplus">+ *</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l22.10"></a><span id="l22.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+ *</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+ * License.</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+ *</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+ * The Original Code is the SeaMonkey internet suite code.</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+ *</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+ * Caio Tiago Oliveira &lt;asrail@gmail.com&gt;</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineplus">+ *</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+ *</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+ * Contributor(s):</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineplus">+ *</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+ *</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineplus">+const ABOUTFEEDS_URI = &quot;chrome://communicator/content/feeds/subscribe.xhtml&quot;;</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineplus">+const ABOUTFEEDS_CONTRACTID = &quot;@mozilla.org/network/protocol/about;1?what=feeds&quot;;</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineplus">+const ABOUTFEEDS_CLASSNAME = &quot;About Feeds Page&quot;;</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineplus">+const ABOUTFEEDS_CLASSID = Components.ID(&quot;{f3487aac-65a0-4101-88a4-f7450c231351}&quot;);</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineplus">+</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineplus">+</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineplus">+function AboutFeeds() {</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineplus">+}</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineplus">+</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineplus">+AboutFeeds.prototype = {</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineplus">+  classDescription: ABOUTFEEDS_CLASSNAME,</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineplus">+  contractID: ABOUTFEEDS_CONTRACTID,</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineplus">+  classID: ABOUTFEEDS_CLASSID,</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineplus">+  implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI(</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineplus">+    [Components.interfaces.nsIAboutModule,</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineplus">+    Components.interfaces.nsISupports]),</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineplus">+</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineplus">+  newChannel: function(aURI) {</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineplus">+    var ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineplus">+                        .getService(Components.interfaces.nsIIOService);</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineplus">+    var secMan = Components.classes[&quot;@mozilla.org/scriptsecuritymanager;1&quot;]</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineplus">+                           .getService(Components.interfaces.nsIScriptSecurityManager);</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineplus">+    var channel = ios.newChannel(ABOUTFEEDS_URI, null, null);</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineplus">+    var principal = secMan.getCodebasePrincipal(aURI);</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineplus">+</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineplus">+    channel.originalURI = aURI;</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineplus">+    channel.owner = principal;</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineplus">+</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineplus">+    return channel;</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineplus">+  },</span>
<a href="#l22.74"></a><span id="l22.74" class="difflineplus">+</span>
<a href="#l22.75"></a><span id="l22.75" class="difflineplus">+  getURIFlags: function() {</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineplus">+    return Components.interfaces.nsIAboutModule.ALLOW_SCRIPT |</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineplus">+           Components.interfaces.nsIAboutModule.URI_SAFE_FOR_UNTRUSTED_CONTENT;</span>
<a href="#l22.78"></a><span id="l22.78" class="difflineplus">+  },</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineplus">+</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineplus">+};</span>
<a href="#l22.81"></a><span id="l22.81" class="difflineplus">+</span>
<a href="#l22.82"></a><span id="l22.82" class="difflineplus">+function NSGetModule(cm, file) {</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineplus">+  return XPCOMUtils.generateModule([AboutFeeds]);</span>
<a href="#l22.84"></a><span id="l22.84" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">new file mode 100644</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineminus">--- /dev/null</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineplus">+++ b/suite/feeds/src/nsFeedSniffer.cpp</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineat">@@ -0,0 +1,435 @@</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l23.6"></a><span id="l23.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l23.8"></a><span id="l23.8" class="difflineplus">+ *</span>
<a href="#l23.9"></a><span id="l23.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l23.11"></a><span id="l23.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+ *</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineplus">+ * License.</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineplus">+ *</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineplus">+ * The Original Code is the Feed Content Sniffer.</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineplus">+ *</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineplus">+ *</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineplus">+ *   Robert Sayre &lt;sayrer@gmail.com&gt;</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineplus">+ *</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineplus">+ *</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineplus">+</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineplus">+#include &quot;nsFeedSniffer.h&quot;</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineplus">+</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineplus">+#include &quot;prmem.h&quot;</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineplus">+</span>
<a href="#l23.47"></a><span id="l23.47" class="difflineplus">+#include &quot;nsNetCID.h&quot;</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineplus">+#include &quot;nsXPCOM.h&quot;</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineplus">+#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineplus">+#include &quot;nsStringStream.h&quot;</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineplus">+</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineplus">+#include &quot;nsICategoryManager.h&quot;</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineplus">+#include &quot;nsIServiceManager.h&quot;</span>
<a href="#l23.54"></a><span id="l23.54" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l23.55"></a><span id="l23.55" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l23.56"></a><span id="l23.56" class="difflineplus">+</span>
<a href="#l23.57"></a><span id="l23.57" class="difflineplus">+#include &quot;nsIStreamConverterService.h&quot;</span>
<a href="#l23.58"></a><span id="l23.58" class="difflineplus">+#include &quot;nsIStreamConverter.h&quot;</span>
<a href="#l23.59"></a><span id="l23.59" class="difflineplus">+</span>
<a href="#l23.60"></a><span id="l23.60" class="difflineplus">+#include &quot;nsIStreamListener.h&quot;</span>
<a href="#l23.61"></a><span id="l23.61" class="difflineplus">+</span>
<a href="#l23.62"></a><span id="l23.62" class="difflineplus">+#include &quot;nsIHttpChannel.h&quot;</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineplus">+#include &quot;nsIMIMEHeaderParam.h&quot;</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineplus">+</span>
<a href="#l23.65"></a><span id="l23.65" class="difflineplus">+#include &quot;nsMimeTypes.h&quot;</span>
<a href="#l23.66"></a><span id="l23.66" class="difflineplus">+</span>
<a href="#l23.67"></a><span id="l23.67" class="difflineplus">+#define TYPE_ATOM &quot;application/atom+xml&quot;</span>
<a href="#l23.68"></a><span id="l23.68" class="difflineplus">+#define TYPE_RSS &quot;application/rss+xml&quot;</span>
<a href="#l23.69"></a><span id="l23.69" class="difflineplus">+#define TYPE_MAYBE_FEED &quot;application/vnd.mozilla.maybe.feed&quot;</span>
<a href="#l23.70"></a><span id="l23.70" class="difflineplus">+</span>
<a href="#l23.71"></a><span id="l23.71" class="difflineplus">+#define NS_RDF &quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l23.72"></a><span id="l23.72" class="difflineplus">+#define NS_RSS &quot;http://purl.org/rss/1.0/&quot;</span>
<a href="#l23.73"></a><span id="l23.73" class="difflineplus">+</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineplus">+#define MAX_BYTES 512</span>
<a href="#l23.75"></a><span id="l23.75" class="difflineplus">+</span>
<a href="#l23.76"></a><span id="l23.76" class="difflineplus">+NS_IMPL_ISUPPORTS3(nsFeedSniffer,</span>
<a href="#l23.77"></a><span id="l23.77" class="difflineplus">+                   nsIContentSniffer,</span>
<a href="#l23.78"></a><span id="l23.78" class="difflineplus">+                   nsIStreamListener,</span>
<a href="#l23.79"></a><span id="l23.79" class="difflineplus">+                   nsIRequestObserver)</span>
<a href="#l23.80"></a><span id="l23.80" class="difflineplus">+</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineplus">+nsresult</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineplus">+nsFeedSniffer::ConvertEncodedData(nsIRequest* request,</span>
<a href="#l23.83"></a><span id="l23.83" class="difflineplus">+                                  const PRUint8* data,</span>
<a href="#l23.84"></a><span id="l23.84" class="difflineplus">+                                  PRUint32 length)</span>
<a href="#l23.85"></a><span id="l23.85" class="difflineplus">+{</span>
<a href="#l23.86"></a><span id="l23.86" class="difflineplus">+  nsresult rv = NS_OK;</span>
<a href="#l23.87"></a><span id="l23.87" class="difflineplus">+</span>
<a href="#l23.88"></a><span id="l23.88" class="difflineplus">+ mDecodedData = &quot;&quot;;</span>
<a href="#l23.89"></a><span id="l23.89" class="difflineplus">+ nsCOMPtr&lt;nsIHttpChannel&gt; httpChannel(do_QueryInterface(request));</span>
<a href="#l23.90"></a><span id="l23.90" class="difflineplus">+  if (!httpChannel)</span>
<a href="#l23.91"></a><span id="l23.91" class="difflineplus">+    return NS_ERROR_NO_INTERFACE;</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineplus">+</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineplus">+  nsCAutoString contentEncoding;</span>
<a href="#l23.94"></a><span id="l23.94" class="difflineplus">+  httpChannel-&gt;GetResponseHeader(NS_LITERAL_CSTRING(&quot;Content-Encoding&quot;),</span>
<a href="#l23.95"></a><span id="l23.95" class="difflineplus">+                                 contentEncoding);</span>
<a href="#l23.96"></a><span id="l23.96" class="difflineplus">+  if (!contentEncoding.IsEmpty()) {</span>
<a href="#l23.97"></a><span id="l23.97" class="difflineplus">+    nsCOMPtr&lt;nsIStreamConverterService&gt; converterService(do_GetService(NS_STREAMCONVERTERSERVICE_CONTRACTID));</span>
<a href="#l23.98"></a><span id="l23.98" class="difflineplus">+    if (converterService) {</span>
<a href="#l23.99"></a><span id="l23.99" class="difflineplus">+      ToLowerCase(contentEncoding);</span>
<a href="#l23.100"></a><span id="l23.100" class="difflineplus">+</span>
<a href="#l23.101"></a><span id="l23.101" class="difflineplus">+      nsCOMPtr&lt;nsIStreamListener&gt; converter;</span>
<a href="#l23.102"></a><span id="l23.102" class="difflineplus">+      rv = converterService-&gt;AsyncConvertData(contentEncoding.get(),</span>
<a href="#l23.103"></a><span id="l23.103" class="difflineplus">+                                              &quot;uncompressed&quot;, this, nsnull,</span>
<a href="#l23.104"></a><span id="l23.104" class="difflineplus">+                                              getter_AddRefs(converter));</span>
<a href="#l23.105"></a><span id="l23.105" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.106"></a><span id="l23.106" class="difflineplus">+</span>
<a href="#l23.107"></a><span id="l23.107" class="difflineplus">+      converter-&gt;OnStartRequest(request, nsnull);</span>
<a href="#l23.108"></a><span id="l23.108" class="difflineplus">+</span>
<a href="#l23.109"></a><span id="l23.109" class="difflineplus">+      nsCOMPtr&lt;nsIStringInputStream&gt; rawStream =</span>
<a href="#l23.110"></a><span id="l23.110" class="difflineplus">+        do_CreateInstance(NS_STRINGINPUTSTREAM_CONTRACTID);</span>
<a href="#l23.111"></a><span id="l23.111" class="difflineplus">+      if (!rawStream)</span>
<a href="#l23.112"></a><span id="l23.112" class="difflineplus">+        return NS_ERROR_FAILURE;</span>
<a href="#l23.113"></a><span id="l23.113" class="difflineplus">+</span>
<a href="#l23.114"></a><span id="l23.114" class="difflineplus">+      rv = rawStream-&gt;SetData((const char*)data, length);</span>
<a href="#l23.115"></a><span id="l23.115" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.116"></a><span id="l23.116" class="difflineplus">+</span>
<a href="#l23.117"></a><span id="l23.117" class="difflineplus">+      rv = converter-&gt;OnDataAvailable(request, nsnull, rawStream, 0, length);</span>
<a href="#l23.118"></a><span id="l23.118" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.119"></a><span id="l23.119" class="difflineplus">+</span>
<a href="#l23.120"></a><span id="l23.120" class="difflineplus">+      converter-&gt;OnStopRequest(request, nsnull, NS_OK);</span>
<a href="#l23.121"></a><span id="l23.121" class="difflineplus">+    }</span>
<a href="#l23.122"></a><span id="l23.122" class="difflineplus">+  }</span>
<a href="#l23.123"></a><span id="l23.123" class="difflineplus">+  return rv;</span>
<a href="#l23.124"></a><span id="l23.124" class="difflineplus">+}</span>
<a href="#l23.125"></a><span id="l23.125" class="difflineplus">+</span>
<a href="#l23.126"></a><span id="l23.126" class="difflineplus">+template&lt;int N&gt;</span>
<a href="#l23.127"></a><span id="l23.127" class="difflineplus">+static PRBool</span>
<a href="#l23.128"></a><span id="l23.128" class="difflineplus">+StringBeginsWithLowercaseLiteral(nsAString&amp; aString,</span>
<a href="#l23.129"></a><span id="l23.129" class="difflineplus">+                                 const char (&amp;aSubstring)[N])</span>
<a href="#l23.130"></a><span id="l23.130" class="difflineplus">+{</span>
<a href="#l23.131"></a><span id="l23.131" class="difflineplus">+  return StringHead(aString, N).LowerCaseEqualsLiteral(aSubstring);</span>
<a href="#l23.132"></a><span id="l23.132" class="difflineplus">+}</span>
<a href="#l23.133"></a><span id="l23.133" class="difflineplus">+</span>
<a href="#l23.134"></a><span id="l23.134" class="difflineplus">+// XXXsayrer put this in here to get on the branch with minimal delay.</span>
<a href="#l23.135"></a><span id="l23.135" class="difflineplus">+// Trunk really needs to factor this out. This is the third usage.</span>
<a href="#l23.136"></a><span id="l23.136" class="difflineplus">+PRBool</span>
<a href="#l23.137"></a><span id="l23.137" class="difflineplus">+HasAttachmentDisposition(nsIHttpChannel* httpChannel)</span>
<a href="#l23.138"></a><span id="l23.138" class="difflineplus">+{</span>
<a href="#l23.139"></a><span id="l23.139" class="difflineplus">+  if (!httpChannel)</span>
<a href="#l23.140"></a><span id="l23.140" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l23.141"></a><span id="l23.141" class="difflineplus">+</span>
<a href="#l23.142"></a><span id="l23.142" class="difflineplus">+  nsCAutoString contentDisposition;</span>
<a href="#l23.143"></a><span id="l23.143" class="difflineplus">+  nsresult rv =</span>
<a href="#l23.144"></a><span id="l23.144" class="difflineplus">+    httpChannel-&gt;GetResponseHeader(NS_LITERAL_CSTRING(&quot;content-disposition&quot;),</span>
<a href="#l23.145"></a><span id="l23.145" class="difflineplus">+                                   contentDisposition);</span>
<a href="#l23.146"></a><span id="l23.146" class="difflineplus">+</span>
<a href="#l23.147"></a><span id="l23.147" class="difflineplus">+  if (NS_SUCCEEDED(rv) &amp;&amp; !contentDisposition.IsEmpty()) {</span>
<a href="#l23.148"></a><span id="l23.148" class="difflineplus">+    nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l23.149"></a><span id="l23.149" class="difflineplus">+    httpChannel-&gt;GetURI(getter_AddRefs(uri));</span>
<a href="#l23.150"></a><span id="l23.150" class="difflineplus">+    nsCOMPtr&lt;nsIMIMEHeaderParam&gt; mimehdrpar =</span>
<a href="#l23.151"></a><span id="l23.151" class="difflineplus">+      do_GetService(NS_MIMEHEADERPARAM_CONTRACTID, &amp;rv);</span>
<a href="#l23.152"></a><span id="l23.152" class="difflineplus">+    if (NS_SUCCEEDED(rv))</span>
<a href="#l23.153"></a><span id="l23.153" class="difflineplus">+    {</span>
<a href="#l23.154"></a><span id="l23.154" class="difflineplus">+      nsCAutoString fallbackCharset;</span>
<a href="#l23.155"></a><span id="l23.155" class="difflineplus">+      if (uri)</span>
<a href="#l23.156"></a><span id="l23.156" class="difflineplus">+        uri-&gt;GetOriginCharset(fallbackCharset);</span>
<a href="#l23.157"></a><span id="l23.157" class="difflineplus">+      nsAutoString dispToken;</span>
<a href="#l23.158"></a><span id="l23.158" class="difflineplus">+      // Get the disposition type</span>
<a href="#l23.159"></a><span id="l23.159" class="difflineplus">+      rv = mimehdrpar-&gt;GetParameter(contentDisposition, &quot;&quot;, fallbackCharset,</span>
<a href="#l23.160"></a><span id="l23.160" class="difflineplus">+                                    PR_TRUE, nsnull, dispToken);</span>
<a href="#l23.161"></a><span id="l23.161" class="difflineplus">+      // RFC 2183, section 2.8 says that an unknown disposition</span>
<a href="#l23.162"></a><span id="l23.162" class="difflineplus">+      // value should be treated as &quot;attachment&quot;</span>
<a href="#l23.163"></a><span id="l23.163" class="difflineplus">+      // XXXbz this code is duplicated in GetFilenameAndExtensionFromChannel in</span>
<a href="#l23.164"></a><span id="l23.164" class="difflineplus">+      // nsExternalHelperAppService.  Factor it out!</span>
<a href="#l23.165"></a><span id="l23.165" class="difflineplus">+      if (NS_FAILED(rv) ||</span>
<a href="#l23.166"></a><span id="l23.166" class="difflineplus">+          (!dispToken.IsEmpty() &amp;&amp;</span>
<a href="#l23.167"></a><span id="l23.167" class="difflineplus">+           !StringBeginsWithLowercaseLiteral(dispToken, &quot;inline&quot;) &amp;&amp;</span>
<a href="#l23.168"></a><span id="l23.168" class="difflineplus">+           // Broken sites just send</span>
<a href="#l23.169"></a><span id="l23.169" class="difflineplus">+           // Content-Disposition: filename=&quot;file&quot;</span>
<a href="#l23.170"></a><span id="l23.170" class="difflineplus">+           // without a disposition token... screen those out.</span>
<a href="#l23.171"></a><span id="l23.171" class="difflineplus">+           !StringBeginsWithLowercaseLiteral(dispToken, &quot;filename&quot;) &amp;&amp;</span>
<a href="#l23.172"></a><span id="l23.172" class="difflineplus">+           // Also in use is Content-Disposition: name=&quot;file&quot;</span>
<a href="#l23.173"></a><span id="l23.173" class="difflineplus">+           !StringBeginsWithLowercaseLiteral(dispToken, &quot;name&quot;)))</span>
<a href="#l23.174"></a><span id="l23.174" class="difflineplus">+        // We have a content-disposition of &quot;attachment&quot; or unknown</span>
<a href="#l23.175"></a><span id="l23.175" class="difflineplus">+        return PR_TRUE;</span>
<a href="#l23.176"></a><span id="l23.176" class="difflineplus">+    }</span>
<a href="#l23.177"></a><span id="l23.177" class="difflineplus">+  }</span>
<a href="#l23.178"></a><span id="l23.178" class="difflineplus">+</span>
<a href="#l23.179"></a><span id="l23.179" class="difflineplus">+  return PR_FALSE;</span>
<a href="#l23.180"></a><span id="l23.180" class="difflineplus">+}</span>
<a href="#l23.181"></a><span id="l23.181" class="difflineplus">+</span>
<a href="#l23.182"></a><span id="l23.182" class="difflineplus">+/**</span>
<a href="#l23.183"></a><span id="l23.183" class="difflineplus">+ * @return the first occurrence of a character within a string buffer,</span>
<a href="#l23.184"></a><span id="l23.184" class="difflineplus">+ *         or nsnull if not found</span>
<a href="#l23.185"></a><span id="l23.185" class="difflineplus">+ */</span>
<a href="#l23.186"></a><span id="l23.186" class="difflineplus">+inline const char*</span>
<a href="#l23.187"></a><span id="l23.187" class="difflineplus">+FindChar(char c, const char *begin, const char *end)</span>
<a href="#l23.188"></a><span id="l23.188" class="difflineplus">+{</span>
<a href="#l23.189"></a><span id="l23.189" class="difflineplus">+  return static_cast&lt;const char *&gt;(memchr(begin, c, end - begin));</span>
<a href="#l23.190"></a><span id="l23.190" class="difflineplus">+}</span>
<a href="#l23.191"></a><span id="l23.191" class="difflineplus">+</span>
<a href="#l23.192"></a><span id="l23.192" class="difflineplus">+/**</span>
<a href="#l23.193"></a><span id="l23.193" class="difflineplus">+ *</span>
<a href="#l23.194"></a><span id="l23.194" class="difflineplus">+ * Determine if a substring is the &quot;documentElement&quot; in the document.</span>
<a href="#l23.195"></a><span id="l23.195" class="difflineplus">+ *</span>
<a href="#l23.196"></a><span id="l23.196" class="difflineplus">+ * All of our sniffed substrings: &lt;rss, &lt;feed, &lt;rdf:RDF must be the &quot;document&quot;</span>
<a href="#l23.197"></a><span id="l23.197" class="difflineplus">+ * element within the XML DOM, i.e. the root container element. Otherwise,</span>
<a href="#l23.198"></a><span id="l23.198" class="difflineplus">+ * it's possible that someone embedded one of these tags inside a document of</span>
<a href="#l23.199"></a><span id="l23.199" class="difflineplus">+ * another type, e.g. a HTML document, and we don't want to show the preview</span>
<a href="#l23.200"></a><span id="l23.200" class="difflineplus">+ * page if the document isn't actually a feed.</span>
<a href="#l23.201"></a><span id="l23.201" class="difflineplus">+ *</span>
<a href="#l23.202"></a><span id="l23.202" class="difflineplus">+ * @param   start</span>
<a href="#l23.203"></a><span id="l23.203" class="difflineplus">+ *          The beginning of the data being sniffed</span>
<a href="#l23.204"></a><span id="l23.204" class="difflineplus">+ * @param   end</span>
<a href="#l23.205"></a><span id="l23.205" class="difflineplus">+ *          The end of the data being sniffed, right before the substring that</span>
<a href="#l23.206"></a><span id="l23.206" class="difflineplus">+ *          was found.</span>
<a href="#l23.207"></a><span id="l23.207" class="difflineplus">+ * @returns PR_TRUE if the found substring is the documentElement, PR_FALSE</span>
<a href="#l23.208"></a><span id="l23.208" class="difflineplus">+ *          otherwise.</span>
<a href="#l23.209"></a><span id="l23.209" class="difflineplus">+ */</span>
<a href="#l23.210"></a><span id="l23.210" class="difflineplus">+static PRBool</span>
<a href="#l23.211"></a><span id="l23.211" class="difflineplus">+IsDocumentElement(const char *start, const char* end)</span>
<a href="#l23.212"></a><span id="l23.212" class="difflineplus">+{</span>
<a href="#l23.213"></a><span id="l23.213" class="difflineplus">+  // For every tag in the buffer, check to see if it's a PI, Doctype or</span>
<a href="#l23.214"></a><span id="l23.214" class="difflineplus">+  // comment, our desired substring or something invalid.</span>
<a href="#l23.215"></a><span id="l23.215" class="difflineplus">+  while ( (start = FindChar('&lt;', start, end)) ) {</span>
<a href="#l23.216"></a><span id="l23.216" class="difflineplus">+    ++start;</span>
<a href="#l23.217"></a><span id="l23.217" class="difflineplus">+    if (start &gt;= end)</span>
<a href="#l23.218"></a><span id="l23.218" class="difflineplus">+      return PR_FALSE;</span>
<a href="#l23.219"></a><span id="l23.219" class="difflineplus">+</span>
<a href="#l23.220"></a><span id="l23.220" class="difflineplus">+    // Check to see if the character following the '&lt;' is either '?' or '!'</span>
<a href="#l23.221"></a><span id="l23.221" class="difflineplus">+    // (processing instruction or doctype or comment)... these are valid nodes</span>
<a href="#l23.222"></a><span id="l23.222" class="difflineplus">+    // to have in the prologue.</span>
<a href="#l23.223"></a><span id="l23.223" class="difflineplus">+    if (*start != '?' &amp;&amp; *start != '!')</span>
<a href="#l23.224"></a><span id="l23.224" class="difflineplus">+      return PR_FALSE;</span>
<a href="#l23.225"></a><span id="l23.225" class="difflineplus">+</span>
<a href="#l23.226"></a><span id="l23.226" class="difflineplus">+    // Now advance the iterator until the '&gt;' (We do this because we don't want</span>
<a href="#l23.227"></a><span id="l23.227" class="difflineplus">+    // to sniff indicator substrings that are embedded within other nodes, e.g.</span>
<a href="#l23.228"></a><span id="l23.228" class="difflineplus">+    // comments: &lt;!-- &lt;rdf:RDF .. &gt; --&gt;</span>
<a href="#l23.229"></a><span id="l23.229" class="difflineplus">+    start = FindChar('&gt;', start, end);</span>
<a href="#l23.230"></a><span id="l23.230" class="difflineplus">+    if (!start)</span>
<a href="#l23.231"></a><span id="l23.231" class="difflineplus">+      return PR_FALSE;</span>
<a href="#l23.232"></a><span id="l23.232" class="difflineplus">+</span>
<a href="#l23.233"></a><span id="l23.233" class="difflineplus">+    ++start;</span>
<a href="#l23.234"></a><span id="l23.234" class="difflineplus">+  }</span>
<a href="#l23.235"></a><span id="l23.235" class="difflineplus">+  return PR_TRUE;</span>
<a href="#l23.236"></a><span id="l23.236" class="difflineplus">+}</span>
<a href="#l23.237"></a><span id="l23.237" class="difflineplus">+</span>
<a href="#l23.238"></a><span id="l23.238" class="difflineplus">+/**</span>
<a href="#l23.239"></a><span id="l23.239" class="difflineplus">+ * Determines whether or not a string exists as the root element in an XML data</span>
<a href="#l23.240"></a><span id="l23.240" class="difflineplus">+ * string buffer.</span>
<a href="#l23.241"></a><span id="l23.241" class="difflineplus">+ * @param   dataString</span>
<a href="#l23.242"></a><span id="l23.242" class="difflineplus">+ *          The data being sniffed</span>
<a href="#l23.243"></a><span id="l23.243" class="difflineplus">+ * @param   substring</span>
<a href="#l23.244"></a><span id="l23.244" class="difflineplus">+ *          The substring being tested for existence and root-ness.</span>
<a href="#l23.245"></a><span id="l23.245" class="difflineplus">+ * @returns PR_TRUE if the substring exists and is the documentElement, PR_FALSE</span>
<a href="#l23.246"></a><span id="l23.246" class="difflineplus">+ *          otherwise.</span>
<a href="#l23.247"></a><span id="l23.247" class="difflineplus">+ */</span>
<a href="#l23.248"></a><span id="l23.248" class="difflineplus">+static PRBool</span>
<a href="#l23.249"></a><span id="l23.249" class="difflineplus">+ContainsTopLevelSubstring(nsACString&amp; dataString, const char *substring)</span>
<a href="#l23.250"></a><span id="l23.250" class="difflineplus">+{</span>
<a href="#l23.251"></a><span id="l23.251" class="difflineplus">+  PRInt32 offset = dataString.Find(substring);</span>
<a href="#l23.252"></a><span id="l23.252" class="difflineplus">+  if (offset == -1)</span>
<a href="#l23.253"></a><span id="l23.253" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l23.254"></a><span id="l23.254" class="difflineplus">+</span>
<a href="#l23.255"></a><span id="l23.255" class="difflineplus">+  const char *begin = dataString.BeginReading();</span>
<a href="#l23.256"></a><span id="l23.256" class="difflineplus">+</span>
<a href="#l23.257"></a><span id="l23.257" class="difflineplus">+  // Only do the validation when we find the substring.</span>
<a href="#l23.258"></a><span id="l23.258" class="difflineplus">+  return IsDocumentElement(begin, begin + offset);</span>
<a href="#l23.259"></a><span id="l23.259" class="difflineplus">+}</span>
<a href="#l23.260"></a><span id="l23.260" class="difflineplus">+</span>
<a href="#l23.261"></a><span id="l23.261" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l23.262"></a><span id="l23.262" class="difflineplus">+nsFeedSniffer::GetMIMETypeFromContent(nsIRequest* request,</span>
<a href="#l23.263"></a><span id="l23.263" class="difflineplus">+                                      const PRUint8* data,</span>
<a href="#l23.264"></a><span id="l23.264" class="difflineplus">+                                      PRUint32 length,</span>
<a href="#l23.265"></a><span id="l23.265" class="difflineplus">+                                      nsACString&amp; sniffedType)</span>
<a href="#l23.266"></a><span id="l23.266" class="difflineplus">+{</span>
<a href="#l23.267"></a><span id="l23.267" class="difflineplus">+  nsCOMPtr&lt;nsIHttpChannel&gt; channel(do_QueryInterface(request));</span>
<a href="#l23.268"></a><span id="l23.268" class="difflineplus">+  if (!channel)</span>
<a href="#l23.269"></a><span id="l23.269" class="difflineplus">+    return NS_ERROR_NO_INTERFACE;</span>
<a href="#l23.270"></a><span id="l23.270" class="difflineplus">+</span>
<a href="#l23.271"></a><span id="l23.271" class="difflineplus">+  // Check that this is a GET request, since you can't subscribe to a POST...</span>
<a href="#l23.272"></a><span id="l23.272" class="difflineplus">+  nsCAutoString method;</span>
<a href="#l23.273"></a><span id="l23.273" class="difflineplus">+  channel-&gt;GetRequestMethod(method);</span>
<a href="#l23.274"></a><span id="l23.274" class="difflineplus">+  if (!method.Equals(&quot;GET&quot;)) {</span>
<a href="#l23.275"></a><span id="l23.275" class="difflineplus">+    sniffedType.Truncate();</span>
<a href="#l23.276"></a><span id="l23.276" class="difflineplus">+    return NS_OK;</span>
<a href="#l23.277"></a><span id="l23.277" class="difflineplus">+  }</span>
<a href="#l23.278"></a><span id="l23.278" class="difflineplus">+</span>
<a href="#l23.279"></a><span id="l23.279" class="difflineplus">+  // We need to find out if this is a load of a view-source document. In this</span>
<a href="#l23.280"></a><span id="l23.280" class="difflineplus">+  // case we do not want to override the content type, since the source display</span>
<a href="#l23.281"></a><span id="l23.281" class="difflineplus">+  // does not need to be converted from feed format to XUL. More importantly,</span>
<a href="#l23.282"></a><span id="l23.282" class="difflineplus">+  // we don't want to change the content type from something</span>
<a href="#l23.283"></a><span id="l23.283" class="difflineplus">+  // nsContentDLF::CreateInstance knows about (e.g. application/xml, text/html</span>
<a href="#l23.284"></a><span id="l23.284" class="difflineplus">+  // etc) to something that only the application fe knows about (maybe.feed)</span>
<a href="#l23.285"></a><span id="l23.285" class="difflineplus">+  // thus deactivating syntax highlighting.</span>
<a href="#l23.286"></a><span id="l23.286" class="difflineplus">+  nsCOMPtr&lt;nsIURI&gt; originalURI;</span>
<a href="#l23.287"></a><span id="l23.287" class="difflineplus">+  channel-&gt;GetOriginalURI(getter_AddRefs(originalURI));</span>
<a href="#l23.288"></a><span id="l23.288" class="difflineplus">+</span>
<a href="#l23.289"></a><span id="l23.289" class="difflineplus">+  nsCAutoString scheme;</span>
<a href="#l23.290"></a><span id="l23.290" class="difflineplus">+  originalURI-&gt;GetScheme(scheme);</span>
<a href="#l23.291"></a><span id="l23.291" class="difflineplus">+  if (scheme.EqualsLiteral(&quot;view-source&quot;)) {</span>
<a href="#l23.292"></a><span id="l23.292" class="difflineplus">+    sniffedType.Truncate();</span>
<a href="#l23.293"></a><span id="l23.293" class="difflineplus">+    return NS_OK;</span>
<a href="#l23.294"></a><span id="l23.294" class="difflineplus">+  }</span>
<a href="#l23.295"></a><span id="l23.295" class="difflineplus">+</span>
<a href="#l23.296"></a><span id="l23.296" class="difflineplus">+  // Check the Content-Type to see if it is set correctly. If it is set to</span>
<a href="#l23.297"></a><span id="l23.297" class="difflineplus">+  // something specific that we think is a reliable indication of a feed, don't</span>
<a href="#l23.298"></a><span id="l23.298" class="difflineplus">+  // bother sniffing since we assume the site maintainer knows what they're</span>
<a href="#l23.299"></a><span id="l23.299" class="difflineplus">+  // doing.</span>
<a href="#l23.300"></a><span id="l23.300" class="difflineplus">+  nsCAutoString contentType;</span>
<a href="#l23.301"></a><span id="l23.301" class="difflineplus">+  channel-&gt;GetContentType(contentType);</span>
<a href="#l23.302"></a><span id="l23.302" class="difflineplus">+  PRBool noSniff = contentType.EqualsLiteral(TYPE_RSS) ||</span>
<a href="#l23.303"></a><span id="l23.303" class="difflineplus">+                   contentType.EqualsLiteral(TYPE_ATOM);</span>
<a href="#l23.304"></a><span id="l23.304" class="difflineplus">+</span>
<a href="#l23.305"></a><span id="l23.305" class="difflineplus">+  // Check to see if this was a feed request from the location bar or from</span>
<a href="#l23.306"></a><span id="l23.306" class="difflineplus">+  // the feed: protocol. This is also a reliable indication.</span>
<a href="#l23.307"></a><span id="l23.307" class="difflineplus">+  // The value of the header doesn't matter.</span>
<a href="#l23.308"></a><span id="l23.308" class="difflineplus">+  if (!noSniff) {</span>
<a href="#l23.309"></a><span id="l23.309" class="difflineplus">+    nsCAutoString sniffHeader;</span>
<a href="#l23.310"></a><span id="l23.310" class="difflineplus">+    nsresult foundHeader =</span>
<a href="#l23.311"></a><span id="l23.311" class="difflineplus">+      channel-&gt;GetRequestHeader(NS_LITERAL_CSTRING(&quot;X-Moz-Is-Feed&quot;),</span>
<a href="#l23.312"></a><span id="l23.312" class="difflineplus">+                                sniffHeader);</span>
<a href="#l23.313"></a><span id="l23.313" class="difflineplus">+    noSniff = NS_SUCCEEDED(foundHeader);</span>
<a href="#l23.314"></a><span id="l23.314" class="difflineplus">+  }</span>
<a href="#l23.315"></a><span id="l23.315" class="difflineplus">+</span>
<a href="#l23.316"></a><span id="l23.316" class="difflineplus">+  if (noSniff) {</span>
<a href="#l23.317"></a><span id="l23.317" class="difflineplus">+    // check for an attachment after we have a likely feed.</span>
<a href="#l23.318"></a><span id="l23.318" class="difflineplus">+    if(HasAttachmentDisposition(channel)) {</span>
<a href="#l23.319"></a><span id="l23.319" class="difflineplus">+      sniffedType.Truncate();</span>
<a href="#l23.320"></a><span id="l23.320" class="difflineplus">+      return NS_OK;</span>
<a href="#l23.321"></a><span id="l23.321" class="difflineplus">+    }</span>
<a href="#l23.322"></a><span id="l23.322" class="difflineplus">+</span>
<a href="#l23.323"></a><span id="l23.323" class="difflineplus">+    // set the feed header as a response header, since we have good metadata</span>
<a href="#l23.324"></a><span id="l23.324" class="difflineplus">+    // telling us that the feed is supposed to be RSS or Atom</span>
<a href="#l23.325"></a><span id="l23.325" class="difflineplus">+    channel-&gt;SetResponseHeader(NS_LITERAL_CSTRING(&quot;X-Moz-Is-Feed&quot;),</span>
<a href="#l23.326"></a><span id="l23.326" class="difflineplus">+                               NS_LITERAL_CSTRING(&quot;1&quot;), PR_FALSE);</span>
<a href="#l23.327"></a><span id="l23.327" class="difflineplus">+    sniffedType.AssignLiteral(TYPE_MAYBE_FEED);</span>
<a href="#l23.328"></a><span id="l23.328" class="difflineplus">+    return NS_OK;</span>
<a href="#l23.329"></a><span id="l23.329" class="difflineplus">+  }</span>
<a href="#l23.330"></a><span id="l23.330" class="difflineplus">+</span>
<a href="#l23.331"></a><span id="l23.331" class="difflineplus">+  // Don't sniff arbitrary types.  Limit sniffing to situations that</span>
<a href="#l23.332"></a><span id="l23.332" class="difflineplus">+  // we think can reasonably arise.</span>
<a href="#l23.333"></a><span id="l23.333" class="difflineplus">+  if (!contentType.EqualsLiteral(TEXT_HTML) &amp;&amp;</span>
<a href="#l23.334"></a><span id="l23.334" class="difflineplus">+      !contentType.EqualsLiteral(APPLICATION_OCTET_STREAM) &amp;&amp;</span>
<a href="#l23.335"></a><span id="l23.335" class="difflineplus">+      // Same criterion as XMLHttpRequest.  Should we be checking for &quot;+xml&quot;</span>
<a href="#l23.336"></a><span id="l23.336" class="difflineplus">+      // and check for text/xml and application/xml by hand instead?</span>
<a href="#l23.337"></a><span id="l23.337" class="difflineplus">+      contentType.Find(&quot;xml&quot;) == -1) {</span>
<a href="#l23.338"></a><span id="l23.338" class="difflineplus">+    sniffedType.Truncate();</span>
<a href="#l23.339"></a><span id="l23.339" class="difflineplus">+    return NS_OK;</span>
<a href="#l23.340"></a><span id="l23.340" class="difflineplus">+  }</span>
<a href="#l23.341"></a><span id="l23.341" class="difflineplus">+</span>
<a href="#l23.342"></a><span id="l23.342" class="difflineplus">+  // Now we need to potentially decompress data served with</span>
<a href="#l23.343"></a><span id="l23.343" class="difflineplus">+  // Content-Encoding: gzip</span>
<a href="#l23.344"></a><span id="l23.344" class="difflineplus">+  nsresult rv = ConvertEncodedData(request, data, length);</span>
<a href="#l23.345"></a><span id="l23.345" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l23.346"></a><span id="l23.346" class="difflineplus">+    return rv;</span>
<a href="#l23.347"></a><span id="l23.347" class="difflineplus">+</span>
<a href="#l23.348"></a><span id="l23.348" class="difflineplus">+  const char* testData =</span>
<a href="#l23.349"></a><span id="l23.349" class="difflineplus">+    mDecodedData.IsEmpty() ? (const char*)data : mDecodedData.get();</span>
<a href="#l23.350"></a><span id="l23.350" class="difflineplus">+</span>
<a href="#l23.351"></a><span id="l23.351" class="difflineplus">+  // The strategy here is based on that described in:</span>
<a href="#l23.352"></a><span id="l23.352" class="difflineplus">+  // http://blogs.msdn.com/rssteam/articles/PublishersGuide.aspx</span>
<a href="#l23.353"></a><span id="l23.353" class="difflineplus">+  // for interoperarbility purposes.</span>
<a href="#l23.354"></a><span id="l23.354" class="difflineplus">+</span>
<a href="#l23.355"></a><span id="l23.355" class="difflineplus">+  // We cap the number of bytes to scan at MAX_BYTES to prevent picking up</span>
<a href="#l23.356"></a><span id="l23.356" class="difflineplus">+  // false positives by accidentally reading document content, e.g. a &quot;how to</span>
<a href="#l23.357"></a><span id="l23.357" class="difflineplus">+  // make a feed&quot; page.</span>
<a href="#l23.358"></a><span id="l23.358" class="difflineplus">+  if (length &gt; MAX_BYTES)</span>
<a href="#l23.359"></a><span id="l23.359" class="difflineplus">+    length = MAX_BYTES;</span>
<a href="#l23.360"></a><span id="l23.360" class="difflineplus">+</span>
<a href="#l23.361"></a><span id="l23.361" class="difflineplus">+  // Thus begins the actual sniffing.</span>
<a href="#l23.362"></a><span id="l23.362" class="difflineplus">+  nsDependentCSubstring dataString((const char*)testData, length);</span>
<a href="#l23.363"></a><span id="l23.363" class="difflineplus">+</span>
<a href="#l23.364"></a><span id="l23.364" class="difflineplus">+  PRBool isFeed = PR_FALSE;</span>
<a href="#l23.365"></a><span id="l23.365" class="difflineplus">+</span>
<a href="#l23.366"></a><span id="l23.366" class="difflineplus">+  // RSS 0.91/0.92/2.0</span>
<a href="#l23.367"></a><span id="l23.367" class="difflineplus">+  isFeed = ContainsTopLevelSubstring(dataString, &quot;&lt;rss&quot;);</span>
<a href="#l23.368"></a><span id="l23.368" class="difflineplus">+</span>
<a href="#l23.369"></a><span id="l23.369" class="difflineplus">+  // Atom 1.0</span>
<a href="#l23.370"></a><span id="l23.370" class="difflineplus">+  if (!isFeed)</span>
<a href="#l23.371"></a><span id="l23.371" class="difflineplus">+    isFeed = ContainsTopLevelSubstring(dataString, &quot;&lt;feed&quot;);</span>
<a href="#l23.372"></a><span id="l23.372" class="difflineplus">+</span>
<a href="#l23.373"></a><span id="l23.373" class="difflineplus">+  // RSS 1.0</span>
<a href="#l23.374"></a><span id="l23.374" class="difflineplus">+  if (!isFeed) {</span>
<a href="#l23.375"></a><span id="l23.375" class="difflineplus">+    isFeed = ContainsTopLevelSubstring(dataString, &quot;&lt;rdf:RDF&quot;) &amp;&amp;</span>
<a href="#l23.376"></a><span id="l23.376" class="difflineplus">+      dataString.Find(NS_RDF) != -1 &amp;&amp;</span>
<a href="#l23.377"></a><span id="l23.377" class="difflineplus">+      dataString.Find(NS_RSS) != -1;</span>
<a href="#l23.378"></a><span id="l23.378" class="difflineplus">+  }</span>
<a href="#l23.379"></a><span id="l23.379" class="difflineplus">+</span>
<a href="#l23.380"></a><span id="l23.380" class="difflineplus">+  // If we sniffed a feed, coerce our internal type</span>
<a href="#l23.381"></a><span id="l23.381" class="difflineplus">+  if (isFeed &amp;&amp; !HasAttachmentDisposition(channel))</span>
<a href="#l23.382"></a><span id="l23.382" class="difflineplus">+    sniffedType.AssignLiteral(TYPE_MAYBE_FEED);</span>
<a href="#l23.383"></a><span id="l23.383" class="difflineplus">+  else</span>
<a href="#l23.384"></a><span id="l23.384" class="difflineplus">+    sniffedType.Truncate();</span>
<a href="#l23.385"></a><span id="l23.385" class="difflineplus">+  return NS_OK;</span>
<a href="#l23.386"></a><span id="l23.386" class="difflineplus">+}</span>
<a href="#l23.387"></a><span id="l23.387" class="difflineplus">+</span>
<a href="#l23.388"></a><span id="l23.388" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l23.389"></a><span id="l23.389" class="difflineplus">+nsFeedSniffer::OnStartRequest(nsIRequest* request, nsISupports* context)</span>
<a href="#l23.390"></a><span id="l23.390" class="difflineplus">+{</span>
<a href="#l23.391"></a><span id="l23.391" class="difflineplus">+  return NS_OK;</span>
<a href="#l23.392"></a><span id="l23.392" class="difflineplus">+}</span>
<a href="#l23.393"></a><span id="l23.393" class="difflineplus">+</span>
<a href="#l23.394"></a><span id="l23.394" class="difflineplus">+NS_METHOD</span>
<a href="#l23.395"></a><span id="l23.395" class="difflineplus">+nsFeedSniffer::AppendSegmentToString(nsIInputStream* inputStream,</span>
<a href="#l23.396"></a><span id="l23.396" class="difflineplus">+                                     void* closure,</span>
<a href="#l23.397"></a><span id="l23.397" class="difflineplus">+                                     const char* rawSegment,</span>
<a href="#l23.398"></a><span id="l23.398" class="difflineplus">+                                     PRUint32 toOffset,</span>
<a href="#l23.399"></a><span id="l23.399" class="difflineplus">+                                     PRUint32 count,</span>
<a href="#l23.400"></a><span id="l23.400" class="difflineplus">+                                     PRUint32* writeCount)</span>
<a href="#l23.401"></a><span id="l23.401" class="difflineplus">+{</span>
<a href="#l23.402"></a><span id="l23.402" class="difflineplus">+  nsCString* decodedData = static_cast&lt;nsCString*&gt;(closure);</span>
<a href="#l23.403"></a><span id="l23.403" class="difflineplus">+  decodedData-&gt;Append(rawSegment, count);</span>
<a href="#l23.404"></a><span id="l23.404" class="difflineplus">+  *writeCount = count;</span>
<a href="#l23.405"></a><span id="l23.405" class="difflineplus">+  return NS_OK;</span>
<a href="#l23.406"></a><span id="l23.406" class="difflineplus">+}</span>
<a href="#l23.407"></a><span id="l23.407" class="difflineplus">+</span>
<a href="#l23.408"></a><span id="l23.408" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l23.409"></a><span id="l23.409" class="difflineplus">+nsFeedSniffer::OnDataAvailable(nsIRequest* request, nsISupports* context,</span>
<a href="#l23.410"></a><span id="l23.410" class="difflineplus">+                               nsIInputStream* stream, PRUint32 offset,</span>
<a href="#l23.411"></a><span id="l23.411" class="difflineplus">+                               PRUint32 count)</span>
<a href="#l23.412"></a><span id="l23.412" class="difflineplus">+{</span>
<a href="#l23.413"></a><span id="l23.413" class="difflineplus">+  PRUint32 read;</span>
<a href="#l23.414"></a><span id="l23.414" class="difflineplus">+  return stream-&gt;ReadSegments(AppendSegmentToString, &amp;mDecodedData, count,</span>
<a href="#l23.415"></a><span id="l23.415" class="difflineplus">+                              &amp;read);</span>
<a href="#l23.416"></a><span id="l23.416" class="difflineplus">+}</span>
<a href="#l23.417"></a><span id="l23.417" class="difflineplus">+</span>
<a href="#l23.418"></a><span id="l23.418" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l23.419"></a><span id="l23.419" class="difflineplus">+nsFeedSniffer::OnStopRequest(nsIRequest* request, nsISupports* context,</span>
<a href="#l23.420"></a><span id="l23.420" class="difflineplus">+                             nsresult status)</span>
<a href="#l23.421"></a><span id="l23.421" class="difflineplus">+{</span>
<a href="#l23.422"></a><span id="l23.422" class="difflineplus">+  return NS_OK;</span>
<a href="#l23.423"></a><span id="l23.423" class="difflineplus">+}</span>
<a href="#l23.424"></a><span id="l23.424" class="difflineplus">+</span>
<a href="#l23.425"></a><span id="l23.425" class="difflineplus">+NS_METHOD</span>
<a href="#l23.426"></a><span id="l23.426" class="difflineplus">+nsFeedSniffer::Register(nsIComponentManager *compMgr, nsIFile *path,</span>
<a href="#l23.427"></a><span id="l23.427" class="difflineplus">+                        const char *registryLocation,</span>
<a href="#l23.428"></a><span id="l23.428" class="difflineplus">+                        const char *componentType,</span>
<a href="#l23.429"></a><span id="l23.429" class="difflineplus">+                        const nsModuleComponentInfo *info)</span>
<a href="#l23.430"></a><span id="l23.430" class="difflineplus">+{</span>
<a href="#l23.431"></a><span id="l23.431" class="difflineplus">+  nsresult rv;</span>
<a href="#l23.432"></a><span id="l23.432" class="difflineplus">+  nsCOMPtr&lt;nsICategoryManager&gt; catman = do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l23.433"></a><span id="l23.433" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l23.434"></a><span id="l23.434" class="difflineplus">+    return rv;</span>
<a href="#l23.435"></a><span id="l23.435" class="difflineplus">+</span>
<a href="#l23.436"></a><span id="l23.436" class="difflineplus">+  return catman-&gt;AddCategoryEntry(NS_CONTENT_SNIFFER_CATEGORY, &quot;Feed Sniffer&quot;,</span>
<a href="#l23.437"></a><span id="l23.437" class="difflineplus">+                                  NS_FEEDSNIFFER_CONTRACTID, PR_TRUE, PR_TRUE,</span>
<a href="#l23.438"></a><span id="l23.438" class="difflineplus">+                                  nsnull);</span>
<a href="#l23.439"></a><span id="l23.439" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">new file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- /dev/null</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ b/suite/feeds/src/nsFeedSniffer.h</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -0,0 +1,77 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineplus">+ *</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+ *</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+ * License.</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+ *</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+ * The Original Code is the Feed Content Sniffer.</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+ *</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineplus">+ *</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineplus">+ *</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineplus">+ *</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineplus">+</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+#include &quot;nsIGenericFactory.h&quot;</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+#include &quot;nsIContentSniffer.h&quot;</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+#include &quot;nsIStreamListener.h&quot;</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineplus">+#include &quot;nsStringAPI.h&quot;</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineplus">+</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineplus">+#define NS_FEEDSNIFFER_CONTRACTID \</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineplus">+  &quot;@mozilla.org/browser/feeds/sniffer;1&quot;</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineplus">+</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineplus">+// {E5EEEF51-05CE-4885-9434-7287616D9547}</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+#define NS_FEEDSNIFFER_CID \</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineplus">+  { 0xe5eeef51, 0x5ce, 0x4885, { 0x94, 0x34, 0x72, 0x87, 0x61, 0x6d, 0x95, 0x47 } }</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineplus">+class nsFeedSniffer : public nsIContentSniffer, nsIStreamListener</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineplus">+{</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+public:</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+  NS_DECL_ISUPPORTS</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineplus">+  NS_DECL_NSICONTENTSNIFFER</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineplus">+  NS_DECL_NSIREQUESTOBSERVER</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineplus">+  NS_DECL_NSISTREAMLISTENER</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineplus">+</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineplus">+  static NS_METHOD AppendSegmentToString(nsIInputStream* inputStream,</span>
<a href="#l24.64"></a><span id="l24.64" class="difflineplus">+                                         void* closure,</span>
<a href="#l24.65"></a><span id="l24.65" class="difflineplus">+                                         const char* rawSegment,</span>
<a href="#l24.66"></a><span id="l24.66" class="difflineplus">+                                         PRUint32 toOffset,</span>
<a href="#l24.67"></a><span id="l24.67" class="difflineplus">+                                         PRUint32 count,</span>
<a href="#l24.68"></a><span id="l24.68" class="difflineplus">+                                         PRUint32* writeCount);</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineplus">+</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineplus">+  static NS_METHOD Register(nsIComponentManager* compMgr, nsIFile* path,</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineplus">+                            const char* registryLocation,</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineplus">+                            const char* componentType,</span>
<a href="#l24.73"></a><span id="l24.73" class="difflineplus">+                            const nsModuleComponentInfo *info);</span>
<a href="#l24.74"></a><span id="l24.74" class="difflineplus">+</span>
<a href="#l24.75"></a><span id="l24.75" class="difflineplus">+protected:</span>
<a href="#l24.76"></a><span id="l24.76" class="difflineplus">+  nsresult ConvertEncodedData(nsIRequest* request, const PRUint8* data,</span>
<a href="#l24.77"></a><span id="l24.77" class="difflineplus">+                              PRUint32 length);</span>
<a href="#l24.78"></a><span id="l24.78" class="difflineplus">+</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineplus">+private:</span>
<a href="#l24.80"></a><span id="l24.80" class="difflineplus">+  nsCString mDecodedData;</span>
<a href="#l24.81"></a><span id="l24.81" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/suite/installer/unix/packages</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/suite/installer/unix/packages</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -195,16 +195,17 @@ bin/components/sessionstore.xpt</span>
<a href="#l25.4"></a><span id="l25.4"> bin/components/shistory.xpt</span>
<a href="#l25.5"></a><span id="l25.5"> bin/components/shellservice.xpt</span>
<a href="#l25.6"></a><span id="l25.6"> bin/components/spellchecker.xpt</span>
<a href="#l25.7"></a><span id="l25.7"> bin/components/storage.xpt</span>
<a href="#l25.8"></a><span id="l25.8"> bin/components/libstoragecomps.so</span>
<a href="#l25.9"></a><span id="l25.9"> bin/components/libsuite.so</span>
<a href="#l25.10"></a><span id="l25.10"> bin/components/suitebrowser.xpt</span>
<a href="#l25.11"></a><span id="l25.11"> bin/components/suitecommon.xpt</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+bin/components/suitefeeds.xpt</span>
<a href="#l25.13"></a><span id="l25.13"> bin/components/suitemigration.xpt</span>
<a href="#l25.14"></a><span id="l25.14"> bin/components/libsystem-pref.so</span>
<a href="#l25.15"></a><span id="l25.15"> bin/components/libtkautocomplete.so</span>
<a href="#l25.16"></a><span id="l25.16"> bin/components/libtoolkitcomps.so</span>
<a href="#l25.17"></a><span id="l25.17"> bin/components/toolkitprofile.xpt</span>
<a href="#l25.18"></a><span id="l25.18"> bin/components/toolkitremote.xpt</span>
<a href="#l25.19"></a><span id="l25.19"> bin/components/libtxmgr.so</span>
<a href="#l25.20"></a><span id="l25.20"> bin/components/txmgr.xpt</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineat">@@ -240,20 +241,24 @@ bin/components/libxpconnect.so</span>
<a href="#l25.22"></a><span id="l25.22"> bin/components/xpinstall.xpt</span>
<a href="#l25.23"></a><span id="l25.23"> bin/components/xulapp.xpt</span>
<a href="#l25.24"></a><span id="l25.24"> bin/components/xuldoc.xpt</span>
<a href="#l25.25"></a><span id="l25.25"> bin/components/xultmpl.xpt</span>
<a href="#l25.26"></a><span id="l25.26"> bin/components/zipwriter.xpt</span>
<a href="#l25.27"></a><span id="l25.27"> bin/components/libzipwriter.so</span>
<a href="#l25.28"></a><span id="l25.28"> </span>
<a href="#l25.29"></a><span id="l25.29"> ; JavaScript components</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineplus">+bin/components/FeedConverter.js</span>
<a href="#l25.31"></a><span id="l25.31"> bin/components/FeedProcessor.js</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+bin/components/FeedWriter.js</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+bin/components/WebContentConverter.js</span>
<a href="#l25.34"></a><span id="l25.34"> bin/components/jsconsole-clhandler.js</span>
<a href="#l25.35"></a><span id="l25.35"> bin/components/nsAboutAbout.js</span>
<a href="#l25.36"></a><span id="l25.36"> bin/components/nsAboutCertError.js</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineplus">+bin/components/nsAboutFeeds.js</span>
<a href="#l25.38"></a><span id="l25.38"> bin/components/nsAboutSessionRestore.js</span>
<a href="#l25.39"></a><span id="l25.39"> bin/components/nsAddonRepository.js</span>
<a href="#l25.40"></a><span id="l25.40"> bin/components/nsBadCertHandler.js</span>
<a href="#l25.41"></a><span id="l25.41"> bin/components/nsBlocklistService.js</span>
<a href="#l25.42"></a><span id="l25.42"> bin/components/nsBrowserContentHandler.js</span>
<a href="#l25.43"></a><span id="l25.43"> bin/components/nsComposerCmdLineHandler.js</span>
<a href="#l25.44"></a><span id="l25.44"> bin/components/nsContentDispatchChooser.js</span>
<a href="#l25.45"></a><span id="l25.45"> bin/components/nsContentPrefService.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/suite/installer/windows/packages</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/suite/installer/windows/packages</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -193,16 +193,17 @@ bin\components\saxparser.xpt</span>
<a href="#l26.4"></a><span id="l26.4"> bin\components\sessionstore.xpt</span>
<a href="#l26.5"></a><span id="l26.5"> bin\components\shellservice.xpt</span>
<a href="#l26.6"></a><span id="l26.6"> bin\components\shistory.xpt</span>
<a href="#l26.7"></a><span id="l26.7"> bin\components\storage.xpt</span>
<a href="#l26.8"></a><span id="l26.8"> bin\components\strgcmps.dll</span>
<a href="#l26.9"></a><span id="l26.9"> bin\components\suite.dll</span>
<a href="#l26.10"></a><span id="l26.10"> bin\components\suitebrowser.xpt</span>
<a href="#l26.11"></a><span id="l26.11"> bin\components\suitecommon.xpt</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+bin\components\suitefeeds.xpt</span>
<a href="#l26.13"></a><span id="l26.13"> bin\components\suitemigration.xpt</span>
<a href="#l26.14"></a><span id="l26.14"> bin\components\tkautoc.dll</span>
<a href="#l26.15"></a><span id="l26.15"> bin\components\tkitcmps.dll</span>
<a href="#l26.16"></a><span id="l26.16"> bin\components\toolkitprofile.xpt</span>
<a href="#l26.17"></a><span id="l26.17"> bin\components\txmgr.dll</span>
<a href="#l26.18"></a><span id="l26.18"> bin\components\txmgr.xpt</span>
<a href="#l26.19"></a><span id="l26.19"> bin\components\txtsvc.xpt</span>
<a href="#l26.20"></a><span id="l26.20"> bin\components\uconv.dll</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineat">@@ -241,20 +242,24 @@ bin\components\xultmpl.xpt</span>
<a href="#l26.22"></a><span id="l26.22"> bin\components\zipwriter.xpt</span>
<a href="#l26.23"></a><span id="l26.23"> bin\components\zipwriter.dll</span>
<a href="#l26.24"></a><span id="l26.24"> bin\plugins\npnul32.dll</span>
<a href="#l26.25"></a><span id="l26.25"> bin\components\helperAppDlg.xpt</span>
<a href="#l26.26"></a><span id="l26.26"> bin\AccessibleMarshal.dll</span>
<a href="#l26.27"></a><span id="l26.27"> bin\sqlite3.dll</span>
<a href="#l26.28"></a><span id="l26.28"> </span>
<a href="#l26.29"></a><span id="l26.29"> ; JavaScript components</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineplus">+bin\components\FeedConverter.js</span>
<a href="#l26.31"></a><span id="l26.31"> bin\components\FeedProcessor.js</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+bin\components\FeedWriter.js</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+bin\components\WebContentConverter.js</span>
<a href="#l26.34"></a><span id="l26.34"> bin\components\jsconsole-clhandler.js</span>
<a href="#l26.35"></a><span id="l26.35"> bin\components\nsAboutAbout.js</span>
<a href="#l26.36"></a><span id="l26.36"> bin\components\nsAboutCertError.js</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineplus">+bin\components\nsAboutFeeds.js</span>
<a href="#l26.38"></a><span id="l26.38"> bin\components\nsAboutSessionRestore.js</span>
<a href="#l26.39"></a><span id="l26.39"> bin\components\nsAddonRepository.js</span>
<a href="#l26.40"></a><span id="l26.40"> bin\components\nsAxSecurityPolicy.js</span>
<a href="#l26.41"></a><span id="l26.41"> bin\components\nsBadCertHandler.js</span>
<a href="#l26.42"></a><span id="l26.42"> bin\components\nsBlocklistService.js</span>
<a href="#l26.43"></a><span id="l26.43"> bin\components\nsBrowserContentHandler.js</span>
<a href="#l26.44"></a><span id="l26.44"> bin\components\nsComposerCmdLineHandler.js</span>
<a href="#l26.45"></a><span id="l26.45"> bin\components\nsContentDispatchChooser.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1">new file mode 100644</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineminus">--- /dev/null</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/feeds/subscribe.dtd</span>
<a href="#l27.4"></a><span id="l27.4" class="difflineat">@@ -0,0 +1,3 @@</span>
<a href="#l27.5"></a><span id="l27.5" class="difflineplus">+&lt;!ENTITY feedPage.title &quot;Viewing Feed&quot;&gt;</span>
<a href="#l27.6"></a><span id="l27.6" class="difflineplus">+&lt;!ENTITY feedSubscribeNow &quot;Subscribe Now&quot;&gt;</span>
<a href="#l27.7"></a><span id="l27.7" class="difflineplus">+&lt;!ENTITY feedMessenger &quot;News &amp;amp; Blogs&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1">new file mode 100644</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineminus">--- /dev/null</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/feeds/subscribe.properties</span>
<a href="#l28.4"></a><span id="l28.4" class="difflineat">@@ -0,0 +1,48 @@</span>
<a href="#l28.5"></a><span id="l28.5" class="difflineplus">+linkTitleTextFormat=Go to %S</span>
<a href="#l28.6"></a><span id="l28.6" class="difflineplus">+addHandler=Add &quot;%S&quot; (%S) as a Feed Reader?</span>
<a href="#l28.7"></a><span id="l28.7" class="difflineplus">+addHandlerAddButton=Add Feed Reader</span>
<a href="#l28.8"></a><span id="l28.8" class="difflineplus">+addHandlerAddButtonAccesskey=A</span>
<a href="#l28.9"></a><span id="l28.9" class="difflineplus">+handlerRegistered=&quot;%S&quot; is already registered as a Feed Reader</span>
<a href="#l28.10"></a><span id="l28.10" class="difflineplus">+subscribeNow=Subscribe Now</span>
<a href="#l28.11"></a><span id="l28.11" class="difflineplus">+chooseApplicationMenuItem=Choose Application</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineplus">+chooseApplicationDialogTitle=Choose Application</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+alwaysUse=Always use %S to subscribe to feeds</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+mediaLabel=Media files</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineplus">+# LOCALIZATION NOTE: The next string is for the size of the enclosed media.</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineplus">+#   e.g. enclosureSizeText : &quot;50.23 MB&quot;</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineplus">+#   %1$S = size (in bytes or megabytes, ...)</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineplus">+#   %2$S = unit of measure (bytes, KB, MB, ...)</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineplus">+enclosureSizeText=%1$S %2$S</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineplus">+</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineplus">+bytes=bytes</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineplus">+kilobytes=KB</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineplus">+megabytes=MB</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineplus">+gigabytes=GB</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineplus">+</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineplus">+# LOCALIZATION NOTE: The next three strings explains to the user what they're</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineplus">+# doing.</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineplus">+#   e.g. alwaysUseForVideoPodcasts : &quot;Always use Miro to subscribe to video podcasts.&quot;</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineplus">+#   %S = application to use (Miro, iTunes, ...)</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineplus">+alwaysUseForFeeds=Always use %S to subscribe to feeds.</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+alwaysUseForAudioPodcasts=Always use %S to subscribe to podcasts.</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineplus">+alwaysUseForVideoPodcasts=Always use %S to subscribe to video podcasts.</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineplus">+</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineplus">+subscribeFeedUsing=Subscribe to this feed using</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineplus">+subscribeAudioPodcastUsing=Subscribe to this podcast using</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineplus">+subscribeVideoPodcastUsing=Subscribe to this video podcast using</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineplus">+</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineplus">+feedSubscriptionFeed1=This is a &quot;feed&quot; of frequently changing content on this site.</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineplus">+feedSubscriptionAudioPodcast1=This is a &quot;podcast&quot; of frequently changing content on this site.</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineplus">+feedSubscriptionVideoPodcast1=This is a &quot;video podcast&quot; of frequently changing content on this site.</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineplus">+</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineplus">+feedSubscriptionFeed2=You can subscribe to this feed to receive updates when this content changes.</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineplus">+feedSubscriptionAudioPodcast2=You can subscribe to this podcast to receive updates when this content changes.</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineplus">+feedSubscriptionVideoPodcast2=You can subscribe to this video podcast to receive updates when this content changes.</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineplus">+</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineplus">+# Protocol Handling</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineplus">+# &quot;Add %appName (%appDomain) as an application for %protocolType links?&quot;</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineplus">+addProtocolHandler=Add %S (%S) as an application for %S links?</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineplus">+addProtocolHandlerAddButton=Add Application</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineplus">+# &quot;%appName has already been added as an application for %protocolType links.&quot;</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineplus">+protocolHandlerRegistered=%S has already been added as an application for %S links.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/suite/locales/en-US/chrome/common/pref/pref-applications.properties</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/pref/pref-applications.properties</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -15,16 +15,16 @@ videoPodcastFeed=Video Podcast</span>
<a href="#l29.4"></a><span id="l29.4"> audioPodcastFeed=Podcast</span>
<a href="#l29.5"></a><span id="l29.5"> alwaysAsk=Always ask</span>
<a href="#l29.6"></a><span id="l29.6"> </span>
<a href="#l29.7"></a><span id="l29.7"> # LOCALIZATION NOTE (usePluginIn):</span>
<a href="#l29.8"></a><span id="l29.8"> # %1$S = plugin name (for example &quot;QuickTime Plugin-in 7.2&quot;)</span>
<a href="#l29.9"></a><span id="l29.9"> # %2$S = brandShortName from brand.properties (for example &quot;Minefield&quot;)</span>
<a href="#l29.10"></a><span id="l29.10"> usePluginIn=Use %S (in %S)</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-# LOCALIZATION NOTE (previewInApp, addLiveBookmarksInApp): %S = brandShortName</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+# LOCALIZATION NOTE (previewInApp, addNewsBlogsInApp): %S = brandShortName</span>
<a href="#l29.14"></a><span id="l29.14"> previewInApp=Preview in %S</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-addLiveBookmarksInApp=Add Live Bookmarks in %S</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+addNewsBlogsInApp=Subscribe in %S</span>
<a href="#l29.17"></a><span id="l29.17"> </span>
<a href="#l29.18"></a><span id="l29.18"> # LOCALIZATION NOTE (typeDescriptionWithType):</span>
<a href="#l29.19"></a><span id="l29.19"> # %1$S = type description (for example &quot;Portable Document Format&quot;)</span>
<a href="#l29.20"></a><span id="l29.20"> # %2$S = type (for example &quot;application/pdf&quot;)</span>
<a href="#l29.21"></a><span id="l29.21"> typeDescriptionWithType=%S (%S)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/suite/locales/jar.mn</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/suite/locales/jar.mn</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -19,16 +19,18 @@</span>
<a href="#l30.4"></a><span id="l30.4">   locale/@AB_CD@/branding/brand.dtd                                         (%chrome/branding/brand.dtd)</span>
<a href="#l30.5"></a><span id="l30.5">   locale/@AB_CD@/branding/brand.properties                                  (%chrome/branding/brand.properties)</span>
<a href="#l30.6"></a><span id="l30.6">   locale/@AB_CD@/communicator/askViewZoom.dtd                               (%chrome/common/askViewZoom.dtd)</span>
<a href="#l30.7"></a><span id="l30.7">   locale/@AB_CD@/communicator/certError.dtd                                 (%chrome/common/certError.dtd)</span>
<a href="#l30.8"></a><span id="l30.8">   locale/@AB_CD@/communicator/consoleOverlay.dtd                            (%chrome/common/consoleOverlay.dtd)</span>
<a href="#l30.9"></a><span id="l30.9">   locale/@AB_CD@/communicator/contentAreaCommands.dtd                       (%chrome/common/contentAreaCommands.dtd)</span>
<a href="#l30.10"></a><span id="l30.10">   locale/@AB_CD@/communicator/contentAreaCommands.properties                (%chrome/common/contentAreaCommands.properties)</span>
<a href="#l30.11"></a><span id="l30.11">   locale/@AB_CD@/communicator/defaultClientDialog.dtd                       (%chrome/common/defaultClientDialog.dtd)</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+  locale/@AB_CD@/communicator/feeds/subscribe.dtd                           (%chrome/common/feeds/subscribe.dtd)</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+  locale/@AB_CD@/communicator/feeds/subscribe.properties                    (%chrome/common/feeds/subscribe.properties)</span>
<a href="#l30.14"></a><span id="l30.14">   locale/@AB_CD@/communicator/notification.properties                       (%chrome/common/notification.properties)</span>
<a href="#l30.15"></a><span id="l30.15">   locale/@AB_CD@/communicator/openLocation.dtd                              (%chrome/common/openLocation.dtd)</span>
<a href="#l30.16"></a><span id="l30.16">   locale/@AB_CD@/communicator/openLocation.properties                       (%chrome/common/openLocation.properties)</span>
<a href="#l30.17"></a><span id="l30.17">   locale/@AB_CD@/communicator/passwordManager.dtd                           (%chrome/common/passwordManager.dtd)</span>
<a href="#l30.18"></a><span id="l30.18">   locale/@AB_CD@/communicator/printPreview.dtd                              (%chrome/common/printPreview.dtd)</span>
<a href="#l30.19"></a><span id="l30.19">   locale/@AB_CD@/communicator/shellservice.properties                       (%chrome/common/shellservice.properties)</span>
<a href="#l30.20"></a><span id="l30.20">   locale/@AB_CD@/communicator/sanitize.dtd                                  (%chrome/common/sanitize.dtd)</span>
<a href="#l30.21"></a><span id="l30.21">   locale/@AB_CD@/communicator/tasksOverlay.dtd                              (%chrome/common/tasksOverlay.dtd)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/suite/makefiles.sh</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/suite/makefiles.sh</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -45,16 +45,18 @@ add_makefiles &quot;</span>
<a href="#l31.4"></a><span id="l31.4">   suite/browser/src/Makefile</span>
<a href="#l31.5"></a><span id="l31.5">   suite/build/Makefile</span>
<a href="#l31.6"></a><span id="l31.6">   suite/debugQA/Makefile</span>
<a href="#l31.7"></a><span id="l31.7">   suite/debugQA/locales/Makefile</span>
<a href="#l31.8"></a><span id="l31.8">   suite/common/Makefile</span>
<a href="#l31.9"></a><span id="l31.9">   suite/common/public/Makefile</span>
<a href="#l31.10"></a><span id="l31.10">   suite/common/src/Makefile</span>
<a href="#l31.11"></a><span id="l31.11">   suite/common/tests/Makefile</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+  suite/feeds/public/Makefile</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+  suite/feeds/src/Makefile</span>
<a href="#l31.14"></a><span id="l31.14">   suite/installer/Makefile</span>
<a href="#l31.15"></a><span id="l31.15">   suite/installer/windows/Makefile</span>
<a href="#l31.16"></a><span id="l31.16">   suite/locales/Makefile</span>
<a href="#l31.17"></a><span id="l31.17">   suite/mailnews/Makefile</span>
<a href="#l31.18"></a><span id="l31.18">   suite/modules/Makefile</span>
<a href="#l31.19"></a><span id="l31.19">   suite/modules/test/Makefile</span>
<a href="#l31.20"></a><span id="l31.20">   suite/profile/Makefile</span>
<a href="#l31.21"></a><span id="l31.21">   suite/profile/migration/public/Makefile</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1">new file mode 100644</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineminus">--- /dev/null</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineplus">+++ b/suite/themes/classic/communicator/feed-subscribe.css</span>
<a href="#l32.4"></a><span id="l32.4" class="difflineat">@@ -0,0 +1,154 @@</span>
<a href="#l32.5"></a><span id="l32.5" class="difflineplus">+html {</span>
<a href="#l32.6"></a><span id="l32.6" class="difflineplus">+  background: -moz-Dialog;</span>
<a href="#l32.7"></a><span id="l32.7" class="difflineplus">+  font: message-box;</span>
<a href="#l32.8"></a><span id="l32.8" class="difflineplus">+}</span>
<a href="#l32.9"></a><span id="l32.9" class="difflineplus">+</span>
<a href="#l32.10"></a><span id="l32.10" class="difflineplus">+#feedBody {</span>
<a href="#l32.11"></a><span id="l32.11" class="difflineplus">+  border: 1px solid ThreeDShadow;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+  padding: 3em;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+  -moz-padding-start: 30px;</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+  margin: 2em auto;</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+  background: -moz-Field;</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineplus">+}</span>
<a href="#l32.17"></a><span id="l32.17" class="difflineplus">+</span>
<a href="#l32.18"></a><span id="l32.18" class="difflineplus">+#feedHeaderContainer {</span>
<a href="#l32.19"></a><span id="l32.19" class="difflineplus">+  border: 1px solid ThreeDShadow;</span>
<a href="#l32.20"></a><span id="l32.20" class="difflineplus">+  -moz-border-radius: 10px;</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineplus">+  margin: -4em auto 0 auto;</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineplus">+  background-color: InfoBackground;</span>
<a href="#l32.23"></a><span id="l32.23" class="difflineplus">+}</span>
<a href="#l32.24"></a><span id="l32.24" class="difflineplus">+</span>
<a href="#l32.25"></a><span id="l32.25" class="difflineplus">+#feedHeader {</span>
<a href="#l32.26"></a><span id="l32.26" class="difflineplus">+  margin-top: 4.9em;</span>
<a href="#l32.27"></a><span id="l32.27" class="difflineplus">+  margin-bottom: 1em;</span>
<a href="#l32.28"></a><span id="l32.28" class="difflineplus">+  -moz-margin-start: 1.4em;</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineplus">+  -moz-margin-end: 1em;</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineplus">+  -moz-padding-start: 2.9em;</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineplus">+  font-size: 110%;</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+  color: InfoText;</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineplus">+}</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineplus">+</span>
<a href="#l32.35"></a><span id="l32.35" class="difflineplus">+.feedBackground {</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineplus">+  background: url(&quot;chrome://communicator/skin/icons/feedIcon.png&quot;) 0% 10% no-repeat InfoBackground;</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineplus">+}</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineplus">+</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineplus">+.videoPodcastBackground {</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineplus">+  background: url(&quot;chrome://communicator/skin/icons/videoFeedIcon.png&quot;) 0% 10% no-repeat InfoBackground;</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineplus">+}</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineplus">+</span>
<a href="#l32.43"></a><span id="l32.43" class="difflineplus">+.audioPodcastBackground {</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineplus">+  background: url(&quot;chrome://communicator/skin/icons/audioFeedIcon.png&quot;) 0% 10% no-repeat InfoBackground;</span>
<a href="#l32.45"></a><span id="l32.45" class="difflineplus">+}</span>
<a href="#l32.46"></a><span id="l32.46" class="difflineplus">+</span>
<a href="#l32.47"></a><span id="l32.47" class="difflineplus">+#feedHeader[dir=&quot;rtl&quot;] {</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineplus">+  background-position: 100% 10%;</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineplus">+}</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineplus">+</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineplus">+#feedIntroText {</span>
<a href="#l32.52"></a><span id="l32.52" class="difflineplus">+  display: none;</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineplus">+}</span>
<a href="#l32.54"></a><span id="l32.54" class="difflineplus">+</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineplus">+</span>
<a href="#l32.56"></a><span id="l32.56" class="difflineplus">+</span>
<a href="#l32.57"></a><span id="l32.57" class="difflineplus">+#feedHeader[firstrun=&quot;true&quot;] #feedIntroText {</span>
<a href="#l32.58"></a><span id="l32.58" class="difflineplus">+  padding-top: 0.1em;</span>
<a href="#l32.59"></a><span id="l32.59" class="difflineplus">+  -moz-padding-start: 0.6em;</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineplus">+  display: block;</span>
<a href="#l32.61"></a><span id="l32.61" class="difflineplus">+}</span>
<a href="#l32.62"></a><span id="l32.62" class="difflineplus">+</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineplus">+#feedHeader[firstrun=&quot;true&quot;] &gt; #feedSubscribeLine {</span>
<a href="#l32.64"></a><span id="l32.64" class="difflineplus">+  -moz-padding-start: 1.8em;</span>
<a href="#l32.65"></a><span id="l32.65" class="difflineplus">+}</span>
<a href="#l32.66"></a><span id="l32.66" class="difflineplus">+</span>
<a href="#l32.67"></a><span id="l32.67" class="difflineplus">+#feedSubscribeLine {</span>
<a href="#l32.68"></a><span id="l32.68" class="difflineplus">+  padding-top: 0.2em;</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineplus">+}</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineplus">+</span>
<a href="#l32.71"></a><span id="l32.71" class="difflineplus">+#messengerFeedsMenuItem {</span>
<a href="#l32.72"></a><span id="l32.72" class="difflineplus">+  list-style-image: url(&quot;chrome://communicator/skin/icons/feedIcon16.png&quot;);</span>
<a href="#l32.73"></a><span id="l32.73" class="difflineplus">+}</span>
<a href="#l32.74"></a><span id="l32.74" class="difflineplus">+</span>
<a href="#l32.75"></a><span id="l32.75" class="difflineplus">+#feedHeader[dir=&quot;rtl&quot;] #handlersMenuList &gt; menupopup {</span>
<a href="#l32.76"></a><span id="l32.76" class="difflineplus">+  direction: rtl;</span>
<a href="#l32.77"></a><span id="l32.77" class="difflineplus">+}</span>
<a href="#l32.78"></a><span id="l32.78" class="difflineplus">+</span>
<a href="#l32.79"></a><span id="l32.79" class="difflineplus">+/* Don't print subscription UI */</span>
<a href="#l32.80"></a><span id="l32.80" class="difflineplus">+@media print {</span>
<a href="#l32.81"></a><span id="l32.81" class="difflineplus">+  #feedHeaderContainer {</span>
<a href="#l32.82"></a><span id="l32.82" class="difflineplus">+    display: none;</span>
<a href="#l32.83"></a><span id="l32.83" class="difflineplus">+  }</span>
<a href="#l32.84"></a><span id="l32.84" class="difflineplus">+}</span>
<a href="#l32.85"></a><span id="l32.85" class="difflineplus">+</span>
<a href="#l32.86"></a><span id="l32.86" class="difflineplus">+body {</span>
<a href="#l32.87"></a><span id="l32.87" class="difflineplus">+  margin: 0;</span>
<a href="#l32.88"></a><span id="l32.88" class="difflineplus">+  padding: 0 3em;</span>
<a href="#l32.89"></a><span id="l32.89" class="difflineplus">+  color: -moz-fieldText;</span>
<a href="#l32.90"></a><span id="l32.90" class="difflineplus">+  font: message-box;</span>
<a href="#l32.91"></a><span id="l32.91" class="difflineplus">+}</span>
<a href="#l32.92"></a><span id="l32.92" class="difflineplus">+</span>
<a href="#l32.93"></a><span id="l32.93" class="difflineplus">+h1 {</span>
<a href="#l32.94"></a><span id="l32.94" class="difflineplus">+  font-size: 160%;</span>
<a href="#l32.95"></a><span id="l32.95" class="difflineplus">+  border-bottom: 2px solid ThreeDLightShadow;</span>
<a href="#l32.96"></a><span id="l32.96" class="difflineplus">+  margin: 0 0 .2em 0;</span>
<a href="#l32.97"></a><span id="l32.97" class="difflineplus">+}</span>
<a href="#l32.98"></a><span id="l32.98" class="difflineplus">+</span>
<a href="#l32.99"></a><span id="l32.99" class="difflineplus">+h2 {</span>
<a href="#l32.100"></a><span id="l32.100" class="difflineplus">+  font-size: 110%;</span>
<a href="#l32.101"></a><span id="l32.101" class="difflineplus">+  font-weight: normal;</span>
<a href="#l32.102"></a><span id="l32.102" class="difflineplus">+  margin: 0 0 .6em 0;</span>
<a href="#l32.103"></a><span id="l32.103" class="difflineplus">+}</span>
<a href="#l32.104"></a><span id="l32.104" class="difflineplus">+</span>
<a href="#l32.105"></a><span id="l32.105" class="difflineplus">+#feedTitleLink {</span>
<a href="#l32.106"></a><span id="l32.106" class="difflineplus">+  float: right;</span>
<a href="#l32.107"></a><span id="l32.107" class="difflineplus">+  -moz-margin-start: .6em;</span>
<a href="#l32.108"></a><span id="l32.108" class="difflineplus">+  -moz-margin-end: 0;</span>
<a href="#l32.109"></a><span id="l32.109" class="difflineplus">+  margin-top: 0;</span>
<a href="#l32.110"></a><span id="l32.110" class="difflineplus">+  margin-bottom: 0;</span>
<a href="#l32.111"></a><span id="l32.111" class="difflineplus">+}</span>
<a href="#l32.112"></a><span id="l32.112" class="difflineplus">+</span>
<a href="#l32.113"></a><span id="l32.113" class="difflineplus">+a[href] img {</span>
<a href="#l32.114"></a><span id="l32.114" class="difflineplus">+  border: none;</span>
<a href="#l32.115"></a><span id="l32.115" class="difflineplus">+}</span>
<a href="#l32.116"></a><span id="l32.116" class="difflineplus">+</span>
<a href="#l32.117"></a><span id="l32.117" class="difflineplus">+#feedTitleContainer {</span>
<a href="#l32.118"></a><span id="l32.118" class="difflineplus">+  -moz-margin-start: 0;</span>
<a href="#l32.119"></a><span id="l32.119" class="difflineplus">+  -moz-margin-end: .6em;</span>
<a href="#l32.120"></a><span id="l32.120" class="difflineplus">+  margin-top: 0;</span>
<a href="#l32.121"></a><span id="l32.121" class="difflineplus">+  margin-bottom: 0;</span>
<a href="#l32.122"></a><span id="l32.122" class="difflineplus">+}</span>
<a href="#l32.123"></a><span id="l32.123" class="difflineplus">+</span>
<a href="#l32.124"></a><span id="l32.124" class="difflineplus">+#feedTitleImage {</span>
<a href="#l32.125"></a><span id="l32.125" class="difflineplus">+  -moz-margin-start: .6em;</span>
<a href="#l32.126"></a><span id="l32.126" class="difflineplus">+  -moz-margin-end: 0;</span>
<a href="#l32.127"></a><span id="l32.127" class="difflineplus">+  margin-top: 0;</span>
<a href="#l32.128"></a><span id="l32.128" class="difflineplus">+  margin-bottom: 0;</span>
<a href="#l32.129"></a><span id="l32.129" class="difflineplus">+  max-width: 300px;</span>
<a href="#l32.130"></a><span id="l32.130" class="difflineplus">+  max-height: 150px;</span>
<a href="#l32.131"></a><span id="l32.131" class="difflineplus">+}</span>
<a href="#l32.132"></a><span id="l32.132" class="difflineplus">+</span>
<a href="#l32.133"></a><span id="l32.133" class="difflineplus">+.feedEntryContent {</span>
<a href="#l32.134"></a><span id="l32.134" class="difflineplus">+  font-size: 110%;</span>
<a href="#l32.135"></a><span id="l32.135" class="difflineplus">+}</span>
<a href="#l32.136"></a><span id="l32.136" class="difflineplus">+</span>
<a href="#l32.137"></a><span id="l32.137" class="difflineplus">+.lastUpdated {</span>
<a href="#l32.138"></a><span id="l32.138" class="difflineplus">+  font-size: 85%;</span>
<a href="#l32.139"></a><span id="l32.139" class="difflineplus">+  font-weight: normal;</span>
<a href="#l32.140"></a><span id="l32.140" class="difflineplus">+}</span>
<a href="#l32.141"></a><span id="l32.141" class="difflineplus">+</span>
<a href="#l32.142"></a><span id="l32.142" class="difflineplus">+.type-icon {</span>
<a href="#l32.143"></a><span id="l32.143" class="difflineplus">+  vertical-align: bottom;</span>
<a href="#l32.144"></a><span id="l32.144" class="difflineplus">+  height: 16px;</span>
<a href="#l32.145"></a><span id="l32.145" class="difflineplus">+  width: 16px;</span>
<a href="#l32.146"></a><span id="l32.146" class="difflineplus">+}</span>
<a href="#l32.147"></a><span id="l32.147" class="difflineplus">+</span>
<a href="#l32.148"></a><span id="l32.148" class="difflineplus">+.enclosures {</span>
<a href="#l32.149"></a><span id="l32.149" class="difflineplus">+  border: 1px solid ThreeDShadow;</span>
<a href="#l32.150"></a><span id="l32.150" class="difflineplus">+  padding: 1em;</span>
<a href="#l32.151"></a><span id="l32.151" class="difflineplus">+  margin: 1em auto;</span>
<a href="#l32.152"></a><span id="l32.152" class="difflineplus">+  background: -moz-Dialog;</span>
<a href="#l32.153"></a><span id="l32.153" class="difflineplus">+}</span>
<a href="#l32.154"></a><span id="l32.154" class="difflineplus">+</span>
<a href="#l32.155"></a><span id="l32.155" class="difflineplus">+.enclosure {</span>
<a href="#l32.156"></a><span id="l32.156" class="difflineplus">+  vertical-align: middle;</span>
<a href="#l32.157"></a><span id="l32.157" class="difflineplus">+  margin-left: 2px;</span>
<a href="#l32.158"></a><span id="l32.158" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1">new file mode 100644</span>
<a href="#l33.2"></a><span id="l33.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..a788fffb00e59e3fff6931ad34cbc12a59f34254</span>
<a href="#l33.3"></a><span id="l33.3">GIT binary patch
literal 1794
zc$@(O2mSboP)&lt;h;3K|Lk000e1NJLTq001BW001Be1^@s6b9#F800004b3#c}2nYxW
zd&lt;bNS00009a7bBm000fw000fw0YWI7cmMzZ8FWQhbW?9;ba!ELWdL_~cP?peYja~^
zaAhuUa%Y?FJQ@H127gIJK~z|U#g}c2R!0@be&gt;3-GpMCb(7YfV5E-YIjPz2Yui=`k&lt;
zL}LQfA~vbo7Hn)%n&gt;0-@0sY*dA52=m_|ih8Q7N`kC2E7n2Scjssx7Qbs1~Vo!~62m
z1-dTFv(KHG&lt;A=F&gt;@AI%rOiYNAoZOi+_nz~g|2b!7t`ZUcpDmo|3~W+sgD}`?jr|m$
zZ&lt;9X&gt;0{ynN?ge1)J+Fv_sq-~)^Yp##tJc;xb}mHe@K)b@k*cwPh)ai(ic9Alxb!K4
zIHRtg8(cng_z%0vA6{($eyT)-qhAgCI@fJn+1L^zSKk9?K&amp;jm4ghvqssd7~1Fzt&amp;t
zaIRMGoYyOby5la&amp;&lt;$#k1e{;P1C-yE4V2xeT*tHlL83e5$j3JD?L{ZIH1rriN5JC|6
zrw%{|C&gt;?m6)?TMHXpPd^lXB%a^|QMWk*&lt;MFs&amp;#^ErGg02pi~4XQ26Hr&lt;rAyRR;Ex+
zKvZoAT&gt;6#9GockYojOUGK=}a@&lt;iS?TqfZf|6sl`Idcl{x?eZ|(7&gt;1FPxbuC;2S-6H
zpin4eB4kQ=ouoQZpwdMs{5Ve{s&lt;JJOCq8EO!fB#a&gt;mY9ScH?Gfnh$NCAXxASj9&lt;f@
z&gt;qU&lt;3Mn=x&amp;3{)rSloc+3%SL&amp;*IYF#NtU+voJwHg&amp;`#jiWDl1Uef}Z~n!P?#EdpASW
zRFjmFRYEROow$=2a5i=3;~&amp;hNgZaz%F&gt;k$uDz%|XvrsK_2^Op&amp;_~-^yX=b{F2)*cw
z=sVY8`&lt;}y{Iyku!CaPe&lt;xtoFkaTYNNVk$_Ipr*AFEm=;qpqpUEG;}b64E2%hdzKsD
zX=i-rr?G=?=8VK8g4NHXKlUV8&gt;lc)YxD=4H`EzmzESMyhBmrXpg^FTSv5}y4F5&amp;#8
z1nu*Y3x^orxtj4;K93BaNR23ho@WUk*ap_7A*}}E^8O?Sj6sr0&amp;O(hOx!xL7T!)_3
zMbOrXJ#m2Y50_!zJCGY)^ab=iPlGj{jr1wjAkL=MBRA)O@hgXH7YvqeM0Y&lt;4$tZI9
z@5tqU;4U3SE*?d25Esxh=OV*HjPLp!@%k4D@B5lJy!`9P&lt;zv_r2Woao#CcGYlF&lt;59
zW{h0_kZ8#!RB4vSH0&gt;j&gt;a03D0hWatT--=v2g+frxt+;;=Q+eYVR7)qp!Zm;*`s{ac
zr~8nx;o1suCM(fA2TTH{lI4IKxr+Jo_dGK&lt;H9fnB_|g67rH}j2*#uSJgbG6{KmT%`
z6LpQA32SNuo7&gt;EDz?z!)t3r{a_XWnbwNT!%ipsvtm?J;S0fqHMtG`9`;C7#^wgQC`
zQW&gt;SPe@o^dxcdoIsUuJBTLVatB*_v^MKQYR4s;wM7mr{M@1XMfM#?YUkGu44?qK1A
z1b08-!&lt;QzgJ@!UkqCrf!Vsp-bNm)o^kcYq;AA-b-2V)Q?{%i&lt;iRH29r4N(3;4`yIj
z_Gz^GIaE_8n8fdPT4N4w%Rw%B$S0mj{AM&gt;517smcrYOZ!=NuA7U=u38dOBw!DiW{X
zj@TrtBzy9Y$mk^iR6{Fz&amp;hmUOkg3jsED7^OL?G;boWfIoqVQBNVfSO{IU-=nRDSW5
zEGKm5O7!e|{p!*U$G-dPoQ1{fv;LF-B-^R--74&amp;Ul=$JD=#CzA$1&gt;uFUnczcW0?VW
zt{-!BPi}0^eN;F5ud2&lt;dZAle?{4lDzd`&gt;&lt;)!~384uR3@3?c7*LPtBZMJCpTQV|(??
z6afCm&gt;$yAEUj&lt;-UEr8JrIe?}r0M!gA&lt;@a43$LL~1CTNZM&gt;x+{d+P}S=zgH;WhK^)+
z20d+FK388vMlV8g!vm-*Wpk&gt;o4uEls3V{fKD28GwN2~+Pk=;N}yBYW~?)`oFdm?b&lt;
z5|#a1h(5U)Gw`FTIiP%r%J05G^uU(dxw--foEjkvfhMnv35pH*QtOMjx&gt;4*quVUYM
z72Vi`E|v%iF%aiKoy8p5j{NgAbYoME4JFethj$&gt;y_tea(x)=e~f04!zm=2(V5Ggj+
zp4IgY=;&gt;{f!cg6Gp@?psee1ayvuc$}LlonL@YofaHBh{KgTeCU)2QY&lt;{ayZcHKkFd
z4w5TFTu-&gt;NZ;)~bjQw_y*E{-px6WI!DlD|GM4|m35HR^y?B*+P?Ip8zUaEB7;`j&amp;W
zIdiDrym^Mbz?cGN0CT&gt;%j18Ze$0M!vEGGRexgG85IPdqK&lt;(J=ni#^71M&amp;UE62$X;V
k5Zp!p0$897i~?i-0r;%NI&gt;fK;H~;_u07*qoM6N&lt;$g0$pZj{pDw</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/suite/themes/classic/jar.mn</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/suite/themes/classic/jar.mn</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -39,16 +39,17 @@ classic.jar:</span>
<a href="#l34.4"></a><span id="l34.4">   skin/classic/communicator/bookmarks/location-hov.gif                  (communicator/bookmarks/location-hov.gif)</span>
<a href="#l34.5"></a><span id="l34.5">   skin/classic/communicator/bookmarks/location.gif                      (communicator/bookmarks/location.gif)</span>
<a href="#l34.6"></a><span id="l34.6">   skin/classic/communicator/bookmarks/bookmarksToolbar.css              (communicator/bookmarks/bookmarksToolbar.css)</span>
<a href="#l34.7"></a><span id="l34.7">   skin/classic/communicator/brand/throbber-anim.png                     (communicator/brand/throbber-anim.png)</span>
<a href="#l34.8"></a><span id="l34.8">   skin/classic/communicator/brand/throbber-single.png                   (communicator/brand/throbber-single.png)</span>
<a href="#l34.9"></a><span id="l34.9">   skin/classic/communicator/brand/throbber16-anim.png                   (communicator/brand/throbber16-anim.png)</span>
<a href="#l34.10"></a><span id="l34.10">   skin/classic/communicator/brand/throbber16-single.png                 (communicator/brand/throbber16-single.png)</span>
<a href="#l34.11"></a><span id="l34.11">   skin/classic/communicator/directory/directory.css                     (communicator/directory/directory.css)</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+  skin/classic/communicator/feed-subscribe.css                          (communicator/feed-subscribe.css)</span>
<a href="#l34.13"></a><span id="l34.13">   skin/classic/communicator/directory/folder-clsd.gif                   (communicator/directory/folder-clsd.gif)</span>
<a href="#l34.14"></a><span id="l34.14">   skin/classic/communicator/directory/folder-open.gif                   (communicator/directory/folder-open.gif)</span>
<a href="#l34.15"></a><span id="l34.15">   skin/classic/communicator/directory/file.gif                          (communicator/directory/file.gif)</span>
<a href="#l34.16"></a><span id="l34.16">   skin/classic/communicator/history/calendar.png                        (communicator/history/calendar.png)</span>
<a href="#l34.17"></a><span id="l34.17">   skin/classic/communicator/profile/migrate.gif                         (communicator/profile/migrate.gif)</span>
<a href="#l34.18"></a><span id="l34.18">   skin/classic/communicator/profile/profile.css                         (communicator/profile/profile.css)</span>
<a href="#l34.19"></a><span id="l34.19">   skin/classic/communicator/profile/profileManager.css                  (communicator/profile/profileManager.css)</span>
<a href="#l34.20"></a><span id="l34.20">   skin/classic/communicator/profile/profileicon-large.gif               (communicator/profile/profileicon-large.gif)</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineat">@@ -60,28 +61,30 @@ classic.jar:</span>
<a href="#l34.22"></a><span id="l34.22">   skin/classic/communicator/sidebar/sbtab-twisty.gif                    (communicator/sidebar/sbtab-twisty.gif)</span>
<a href="#l34.23"></a><span id="l34.23">   skin/classic/communicator/sidebar/sbtab-twisty-open.gif               (communicator/sidebar/sbtab-twisty-open.gif)</span>
<a href="#l34.24"></a><span id="l34.24">   skin/classic/communicator/sidebar/customize.css                       (communicator/sidebar/customize.css)</span>
<a href="#l34.25"></a><span id="l34.25">   skin/classic/communicator/sidebar/preview.css                         (communicator/sidebar/preview.css)</span>
<a href="#l34.26"></a><span id="l34.26">   skin/classic/communicator/sidebar/sidebarBindings.xml                 (communicator/sidebar/sidebarBindings.xml)</span>
<a href="#l34.27"></a><span id="l34.27">   skin/classic/communicator/sidebar/sidebar.css                         (communicator/sidebar/sidebar.css)</span>
<a href="#l34.28"></a><span id="l34.28">   skin/classic/communicator/sidebar/sidebarListView.css                 (communicator/sidebar/sidebarListView.css)</span>
<a href="#l34.29"></a><span id="l34.29">   skin/classic/communicator/xpinstall/xpinstall.css                     (communicator/xpinstall/xpinstall.css)</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineplus">+  skin/classic/communicator/icons/audioFeedIcon.png                     (communicator/icons/feedIcon.png)</span>
<a href="#l34.31"></a><span id="l34.31">   skin/classic/communicator/icons/close-button.gif                      (communicator/icons/close-button.gif)</span>
<a href="#l34.32"></a><span id="l34.32">   skin/classic/communicator/icons/offline.png                           (communicator/icons/offline.png)</span>
<a href="#l34.33"></a><span id="l34.33">   skin/classic/communicator/icons/online.png                            (communicator/icons/online.png)</span>
<a href="#l34.34"></a><span id="l34.34">   skin/classic/communicator/icons/search.png                            (communicator/icons/search.png)</span>
<a href="#l34.35"></a><span id="l34.35">   skin/classic/communicator/icons/lock-secure.png                       (communicator/icons/lock-secure.png)</span>
<a href="#l34.36"></a><span id="l34.36">   skin/classic/communicator/icons/lock-broken.png                       (communicator/icons/lock-broken.png)</span>
<a href="#l34.37"></a><span id="l34.37">   skin/classic/communicator/icons/lock-insecure.png                     (communicator/icons/lock-insecure.png)</span>
<a href="#l34.38"></a><span id="l34.38">   skin/classic/communicator/icons/loading.gif                           (communicator/icons/loading.gif)</span>
<a href="#l34.39"></a><span id="l34.39">   skin/classic/communicator/icons/communicatoricons.png                 (communicator/icons/communicatoricons.png)</span>
<a href="#l34.40"></a><span id="l34.40">   skin/classic/communicator/icons/communicatoricons-small.png           (communicator/icons/communicatoricons-small.png)</span>
<a href="#l34.41"></a><span id="l34.41">   skin/classic/communicator/icons/alwaysAsk.png                         (communicator/icons/alwaysAsk.png)</span>
<a href="#l34.42"></a><span id="l34.42">   skin/classic/communicator/icons/application.png                       (communicator/icons/application.png)</span>
<a href="#l34.43"></a><span id="l34.43" class="difflineplus">+  skin/classic/communicator/icons/feedIcon.png                          (communicator/icons/feedIcon.png)</span>
<a href="#l34.44"></a><span id="l34.44">   skin/classic/communicator/icons/feedIcon16.png                        (communicator/icons/feedIcon16.png)</span>
<a href="#l34.45"></a><span id="l34.45">   skin/classic/communicator/icons/plugin.png                            (communicator/icons/plugin.png)</span>
<a href="#l34.46"></a><span id="l34.46">   skin/classic/communicator/icons/save.png                              (communicator/icons/save.png)</span>
<a href="#l34.47"></a><span id="l34.47">   skin/classic/communicator/icons/smileys/smiley-smile.png              (communicator/icons/smileys/smiley-smile.png)</span>
<a href="#l34.48"></a><span id="l34.48">   skin/classic/communicator/icons/smileys/smiley-frown.png              (communicator/icons/smileys/smiley-frown.png)</span>
<a href="#l34.49"></a><span id="l34.49">   skin/classic/communicator/icons/smileys/smiley-wink.png               (communicator/icons/smileys/smiley-wink.png)</span>
<a href="#l34.50"></a><span id="l34.50">   skin/classic/communicator/icons/smileys/smiley-tongue.png             (communicator/icons/smileys/smiley-tongue.png)</span>
<a href="#l34.51"></a><span id="l34.51">   skin/classic/communicator/icons/smileys/smiley-laughing.png           (communicator/icons/smileys/smiley-laughing.png)</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineat">@@ -91,16 +94,17 @@ classic.jar:</span>
<a href="#l34.53"></a><span id="l34.53">   skin/classic/communicator/icons/smileys/smiley-kiss.png               (communicator/icons/smileys/smiley-kiss.png)</span>
<a href="#l34.54"></a><span id="l34.54">   skin/classic/communicator/icons/smileys/smiley-yell.png               (communicator/icons/smileys/smiley-yell.png)</span>
<a href="#l34.55"></a><span id="l34.55">   skin/classic/communicator/icons/smileys/smiley-cool.png               (communicator/icons/smileys/smiley-cool.png)</span>
<a href="#l34.56"></a><span id="l34.56">   skin/classic/communicator/icons/smileys/smiley-money.png              (communicator/icons/smileys/smiley-money.png)</span>
<a href="#l34.57"></a><span id="l34.57">   skin/classic/communicator/icons/smileys/smiley-foot.png               (communicator/icons/smileys/smiley-foot.png)</span>
<a href="#l34.58"></a><span id="l34.58">   skin/classic/communicator/icons/smileys/smiley-innocent.png           (communicator/icons/smileys/smiley-innocent.png)</span>
<a href="#l34.59"></a><span id="l34.59">   skin/classic/communicator/icons/smileys/smiley-cry.png                (communicator/icons/smileys/smiley-cry.png)</span>
<a href="#l34.60"></a><span id="l34.60">   skin/classic/communicator/icons/smileys/smiley-sealed.png             (communicator/icons/smileys/smiley-sealed.png)</span>
<a href="#l34.61"></a><span id="l34.61" class="difflineplus">+  skin/classic/communicator/icons/videoFeedIcon.png                     (communicator/icons/feedIcon.png)</span>
<a href="#l34.62"></a><span id="l34.62">   skin/classic/communicator/taskbar/composer-hov.gif                    (communicator/taskbar/composer-hov.gif)</span>
<a href="#l34.63"></a><span id="l34.63">   skin/classic/communicator/taskbar/addressbook.gif                     (communicator/taskbar/addressbook.gif)</span>
<a href="#l34.64"></a><span id="l34.64">   skin/classic/communicator/taskbar/addressbook-16.gif                  (communicator/taskbar/addressbook-16.gif)</span>
<a href="#l34.65"></a><span id="l34.65">   skin/classic/communicator/taskbar/mailnew-hov.gif                     (communicator/taskbar/mailnew-hov.gif)</span>
<a href="#l34.66"></a><span id="l34.66">   skin/classic/communicator/taskbar/navigator.gif                       (communicator/taskbar/navigator.gif)</span>
<a href="#l34.67"></a><span id="l34.67">   skin/classic/communicator/taskbar/navigator-hov.gif                   (communicator/taskbar/navigator-hov.gif)</span>
<a href="#l34.68"></a><span id="l34.68">   skin/classic/communicator/taskbar/navigator-16.gif                    (communicator/taskbar/navigator-16.gif)</span>
<a href="#l34.69"></a><span id="l34.69">   skin/classic/communicator/taskbar/mail.gif                            (communicator/taskbar/mail.gif)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1">new file mode 100644</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineminus">--- /dev/null</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineplus">+++ b/suite/themes/modern/communicator/feed-subscribe.css</span>
<a href="#l35.4"></a><span id="l35.4" class="difflineat">@@ -0,0 +1,191 @@</span>
<a href="#l35.5"></a><span id="l35.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l35.6"></a><span id="l35.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l35.7"></a><span id="l35.7" class="difflineplus">+ *</span>
<a href="#l35.8"></a><span id="l35.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l35.9"></a><span id="l35.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l35.10"></a><span id="l35.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l35.11"></a><span id="l35.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineplus">+ *</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineplus">+ * License.</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineplus">+ *</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineplus">+ * The Original Code is mozilla.org code.</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+ *</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineplus">+ * the Mozilla Organization.</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 1998-2002</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineplus">+ *</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineplus">+ *   Caio Tiago Oliveira &lt;asrail@gmail.com&gt;</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineplus">+ *</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l35.37"></a><span id="l35.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineplus">+ *</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l35.41"></a><span id="l35.41" class="difflineplus">+</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineplus">+html {</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineplus">+  background-color: #FFFFFF;</span>
<a href="#l35.44"></a><span id="l35.44" class="difflineplus">+  font: message-box;</span>
<a href="#l35.45"></a><span id="l35.45" class="difflineplus">+}</span>
<a href="#l35.46"></a><span id="l35.46" class="difflineplus">+</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineplus">+#feedBody {</span>
<a href="#l35.48"></a><span id="l35.48" class="difflineplus">+  border: 1px solid #2D3B49;</span>
<a href="#l35.49"></a><span id="l35.49" class="difflineplus">+  padding: 3em;</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineplus">+  -moz-padding-start: 30px;</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineplus">+  margin: 2em auto;</span>
<a href="#l35.52"></a><span id="l35.52" class="difflineplus">+  background-color: #C7D0D9;</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineplus">+  color: #22262F;</span>
<a href="#l35.54"></a><span id="l35.54" class="difflineplus">+}</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineplus">+</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineplus">+#feedHeaderContainer {</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineplus">+  border: 1px solid #2D3B49;</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineplus">+  -moz-border-radius: 10px;</span>
<a href="#l35.59"></a><span id="l35.59" class="difflineplus">+  margin: -4em auto 0 auto;</span>
<a href="#l35.60"></a><span id="l35.60" class="difflineplus">+  background-color: #C7D0D9;</span>
<a href="#l35.61"></a><span id="l35.61" class="difflineplus">+}</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineplus">+</span>
<a href="#l35.63"></a><span id="l35.63" class="difflineplus">+#feedHeader {</span>
<a href="#l35.64"></a><span id="l35.64" class="difflineplus">+  margin-top: 4.9em;</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineplus">+  margin-bottom: 1em;</span>
<a href="#l35.66"></a><span id="l35.66" class="difflineplus">+  -moz-margin-start: 1.4em;</span>
<a href="#l35.67"></a><span id="l35.67" class="difflineplus">+  -moz-margin-end: 1em;</span>
<a href="#l35.68"></a><span id="l35.68" class="difflineplus">+  -moz-padding-start: 2.9em;</span>
<a href="#l35.69"></a><span id="l35.69" class="difflineplus">+  font-size: 110%;</span>
<a href="#l35.70"></a><span id="l35.70" class="difflineplus">+  color: #000000;</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineplus">+}</span>
<a href="#l35.72"></a><span id="l35.72" class="difflineplus">+</span>
<a href="#l35.73"></a><span id="l35.73" class="difflineplus">+.feedBackground {</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineplus">+  background: url(&quot;chrome://communicator/skin/icons/feedIcon.png&quot;) 0% 10% no-repeat transparent;</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineplus">+}</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineplus">+</span>
<a href="#l35.77"></a><span id="l35.77" class="difflineplus">+.videoPodcastBackground {</span>
<a href="#l35.78"></a><span id="l35.78" class="difflineplus">+  background: url(&quot;chrome://communicator/skin/icons/videoFeedIcon.png&quot;) 0% 10% no-repeat transparent;</span>
<a href="#l35.79"></a><span id="l35.79" class="difflineplus">+}</span>
<a href="#l35.80"></a><span id="l35.80" class="difflineplus">+</span>
<a href="#l35.81"></a><span id="l35.81" class="difflineplus">+.audioPodcastBackground {</span>
<a href="#l35.82"></a><span id="l35.82" class="difflineplus">+  background: url(&quot;chrome://communicator/skin/icons/audioFeedIcon.png&quot;) 0% 10% no-repeat transparent;</span>
<a href="#l35.83"></a><span id="l35.83" class="difflineplus">+}</span>
<a href="#l35.84"></a><span id="l35.84" class="difflineplus">+</span>
<a href="#l35.85"></a><span id="l35.85" class="difflineplus">+#feedHeader[dir=&quot;rtl&quot;] {</span>
<a href="#l35.86"></a><span id="l35.86" class="difflineplus">+  background-position: 100% 10%;</span>
<a href="#l35.87"></a><span id="l35.87" class="difflineplus">+}</span>
<a href="#l35.88"></a><span id="l35.88" class="difflineplus">+</span>
<a href="#l35.89"></a><span id="l35.89" class="difflineplus">+#feedIntroText {</span>
<a href="#l35.90"></a><span id="l35.90" class="difflineplus">+  display: none;</span>
<a href="#l35.91"></a><span id="l35.91" class="difflineplus">+}</span>
<a href="#l35.92"></a><span id="l35.92" class="difflineplus">+</span>
<a href="#l35.93"></a><span id="l35.93" class="difflineplus">+#feedHeader[firstrun=&quot;true&quot;] #feedIntroText {</span>
<a href="#l35.94"></a><span id="l35.94" class="difflineplus">+  padding-top: 0.1em;</span>
<a href="#l35.95"></a><span id="l35.95" class="difflineplus">+  -moz-padding-start: 0.6em;</span>
<a href="#l35.96"></a><span id="l35.96" class="difflineplus">+  display: block;</span>
<a href="#l35.97"></a><span id="l35.97" class="difflineplus">+}</span>
<a href="#l35.98"></a><span id="l35.98" class="difflineplus">+</span>
<a href="#l35.99"></a><span id="l35.99" class="difflineplus">+#feedHeader[firstrun=&quot;true&quot;] &gt; #feedSubscribeLine {</span>
<a href="#l35.100"></a><span id="l35.100" class="difflineplus">+  -moz-padding-start: 1.8em;</span>
<a href="#l35.101"></a><span id="l35.101" class="difflineplus">+}</span>
<a href="#l35.102"></a><span id="l35.102" class="difflineplus">+</span>
<a href="#l35.103"></a><span id="l35.103" class="difflineplus">+#feedSubscribeLine {</span>
<a href="#l35.104"></a><span id="l35.104" class="difflineplus">+  padding-top: 0.2em;</span>
<a href="#l35.105"></a><span id="l35.105" class="difflineplus">+}</span>
<a href="#l35.106"></a><span id="l35.106" class="difflineplus">+</span>
<a href="#l35.107"></a><span id="l35.107" class="difflineplus">+#messengerFeedsMenuItem {</span>
<a href="#l35.108"></a><span id="l35.108" class="difflineplus">+  list-style-image: url(&quot;chrome://communicator/skin/icons/feedIcon16.png&quot;);</span>
<a href="#l35.109"></a><span id="l35.109" class="difflineplus">+}</span>
<a href="#l35.110"></a><span id="l35.110" class="difflineplus">+</span>
<a href="#l35.111"></a><span id="l35.111" class="difflineplus">+#feedHeader[dir=&quot;rtl&quot;] #handlersMenuList &gt; menupopup {</span>
<a href="#l35.112"></a><span id="l35.112" class="difflineplus">+  direction: rtl;</span>
<a href="#l35.113"></a><span id="l35.113" class="difflineplus">+}</span>
<a href="#l35.114"></a><span id="l35.114" class="difflineplus">+</span>
<a href="#l35.115"></a><span id="l35.115" class="difflineplus">+/* Don't print subscription UI */</span>
<a href="#l35.116"></a><span id="l35.116" class="difflineplus">+@media print {</span>
<a href="#l35.117"></a><span id="l35.117" class="difflineplus">+  #feedHeaderContainer {</span>
<a href="#l35.118"></a><span id="l35.118" class="difflineplus">+    display: none;</span>
<a href="#l35.119"></a><span id="l35.119" class="difflineplus">+  }</span>
<a href="#l35.120"></a><span id="l35.120" class="difflineplus">+}</span>
<a href="#l35.121"></a><span id="l35.121" class="difflineplus">+</span>
<a href="#l35.122"></a><span id="l35.122" class="difflineplus">+body {</span>
<a href="#l35.123"></a><span id="l35.123" class="difflineplus">+  margin: 0;</span>
<a href="#l35.124"></a><span id="l35.124" class="difflineplus">+  padding: 0 3em;</span>
<a href="#l35.125"></a><span id="l35.125" class="difflineplus">+  color: -moz-fieldText;</span>
<a href="#l35.126"></a><span id="l35.126" class="difflineplus">+  font: message-box;</span>
<a href="#l35.127"></a><span id="l35.127" class="difflineplus">+}</span>
<a href="#l35.128"></a><span id="l35.128" class="difflineplus">+</span>
<a href="#l35.129"></a><span id="l35.129" class="difflineplus">+h1 {</span>
<a href="#l35.130"></a><span id="l35.130" class="difflineplus">+  font-size: 160%;</span>
<a href="#l35.131"></a><span id="l35.131" class="difflineplus">+  border-bottom: 2px solid #7A8490;</span>
<a href="#l35.132"></a><span id="l35.132" class="difflineplus">+  margin: 0 0 .2em 0;</span>
<a href="#l35.133"></a><span id="l35.133" class="difflineplus">+}</span>
<a href="#l35.134"></a><span id="l35.134" class="difflineplus">+</span>
<a href="#l35.135"></a><span id="l35.135" class="difflineplus">+h2 {</span>
<a href="#l35.136"></a><span id="l35.136" class="difflineplus">+  font-size: 110%;</span>
<a href="#l35.137"></a><span id="l35.137" class="difflineplus">+  font-weight: normal;</span>
<a href="#l35.138"></a><span id="l35.138" class="difflineplus">+  margin: 0 0 .6em 0;</span>
<a href="#l35.139"></a><span id="l35.139" class="difflineplus">+}</span>
<a href="#l35.140"></a><span id="l35.140" class="difflineplus">+</span>
<a href="#l35.141"></a><span id="l35.141" class="difflineplus">+#feedTitleLink {</span>
<a href="#l35.142"></a><span id="l35.142" class="difflineplus">+  float: right;</span>
<a href="#l35.143"></a><span id="l35.143" class="difflineplus">+  -moz-margin-start: .6em;</span>
<a href="#l35.144"></a><span id="l35.144" class="difflineplus">+  -moz-margin-end: 0;</span>
<a href="#l35.145"></a><span id="l35.145" class="difflineplus">+  margin-top: 0;</span>
<a href="#l35.146"></a><span id="l35.146" class="difflineplus">+  margin-bottom: 0;</span>
<a href="#l35.147"></a><span id="l35.147" class="difflineplus">+}</span>
<a href="#l35.148"></a><span id="l35.148" class="difflineplus">+</span>
<a href="#l35.149"></a><span id="l35.149" class="difflineplus">+a[href] img {</span>
<a href="#l35.150"></a><span id="l35.150" class="difflineplus">+  border: none;</span>
<a href="#l35.151"></a><span id="l35.151" class="difflineplus">+}</span>
<a href="#l35.152"></a><span id="l35.152" class="difflineplus">+</span>
<a href="#l35.153"></a><span id="l35.153" class="difflineplus">+#feedTitleContainer {</span>
<a href="#l35.154"></a><span id="l35.154" class="difflineplus">+  -moz-margin-start: 0;</span>
<a href="#l35.155"></a><span id="l35.155" class="difflineplus">+  -moz-margin-end: .6em;</span>
<a href="#l35.156"></a><span id="l35.156" class="difflineplus">+  margin-top: 0;</span>
<a href="#l35.157"></a><span id="l35.157" class="difflineplus">+  margin-bottom: 0;</span>
<a href="#l35.158"></a><span id="l35.158" class="difflineplus">+}</span>
<a href="#l35.159"></a><span id="l35.159" class="difflineplus">+</span>
<a href="#l35.160"></a><span id="l35.160" class="difflineplus">+#feedTitleImage {</span>
<a href="#l35.161"></a><span id="l35.161" class="difflineplus">+  -moz-margin-start: .6em;</span>
<a href="#l35.162"></a><span id="l35.162" class="difflineplus">+  -moz-margin-end: 0;</span>
<a href="#l35.163"></a><span id="l35.163" class="difflineplus">+  margin-top: 0;</span>
<a href="#l35.164"></a><span id="l35.164" class="difflineplus">+  margin-bottom: 0;</span>
<a href="#l35.165"></a><span id="l35.165" class="difflineplus">+  max-width: 300px;</span>
<a href="#l35.166"></a><span id="l35.166" class="difflineplus">+  max-height: 150px;</span>
<a href="#l35.167"></a><span id="l35.167" class="difflineplus">+}</span>
<a href="#l35.168"></a><span id="l35.168" class="difflineplus">+</span>
<a href="#l35.169"></a><span id="l35.169" class="difflineplus">+.feedEntryContent {</span>
<a href="#l35.170"></a><span id="l35.170" class="difflineplus">+  font-size: 110%;</span>
<a href="#l35.171"></a><span id="l35.171" class="difflineplus">+}</span>
<a href="#l35.172"></a><span id="l35.172" class="difflineplus">+</span>
<a href="#l35.173"></a><span id="l35.173" class="difflineplus">+.lastUpdated {</span>
<a href="#l35.174"></a><span id="l35.174" class="difflineplus">+  font-size: 85%;</span>
<a href="#l35.175"></a><span id="l35.175" class="difflineplus">+  font-weight: normal;</span>
<a href="#l35.176"></a><span id="l35.176" class="difflineplus">+}</span>
<a href="#l35.177"></a><span id="l35.177" class="difflineplus">+</span>
<a href="#l35.178"></a><span id="l35.178" class="difflineplus">+.type-icon {</span>
<a href="#l35.179"></a><span id="l35.179" class="difflineplus">+  vertical-align: bottom;</span>
<a href="#l35.180"></a><span id="l35.180" class="difflineplus">+  height: 16px;</span>
<a href="#l35.181"></a><span id="l35.181" class="difflineplus">+  width: 16px;</span>
<a href="#l35.182"></a><span id="l35.182" class="difflineplus">+}</span>
<a href="#l35.183"></a><span id="l35.183" class="difflineplus">+</span>
<a href="#l35.184"></a><span id="l35.184" class="difflineplus">+.enclosures {</span>
<a href="#l35.185"></a><span id="l35.185" class="difflineplus">+  border: 1px solid #2D3B49;</span>
<a href="#l35.186"></a><span id="l35.186" class="difflineplus">+  padding: 1em;</span>
<a href="#l35.187"></a><span id="l35.187" class="difflineplus">+  margin: 1em auto;</span>
<a href="#l35.188"></a><span id="l35.188" class="difflineplus">+  background-color: #90A1B3;</span>
<a href="#l35.189"></a><span id="l35.189" class="difflineplus">+  color: #000000;</span>
<a href="#l35.190"></a><span id="l35.190" class="difflineplus">+}</span>
<a href="#l35.191"></a><span id="l35.191" class="difflineplus">+</span>
<a href="#l35.192"></a><span id="l35.192" class="difflineplus">+.enclosure {</span>
<a href="#l35.193"></a><span id="l35.193" class="difflineplus">+  vertical-align: middle;</span>
<a href="#l35.194"></a><span id="l35.194" class="difflineplus">+  margin-left: 2px;</span>
<a href="#l35.195"></a><span id="l35.195" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1">new file mode 100644</span>
<a href="#l36.2"></a><span id="l36.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..a788fffb00e59e3fff6931ad34cbc12a59f34254</span>
<a href="#l36.3"></a><span id="l36.3">GIT binary patch
literal 1794
zc$@(O2mSboP)&lt;h;3K|Lk000e1NJLTq001BW001Be1^@s6b9#F800004b3#c}2nYxW
zd&lt;bNS00009a7bBm000fw000fw0YWI7cmMzZ8FWQhbW?9;ba!ELWdL_~cP?peYja~^
zaAhuUa%Y?FJQ@H127gIJK~z|U#g}c2R!0@be&gt;3-GpMCb(7YfV5E-YIjPz2Yui=`k&lt;
zL}LQfA~vbo7Hn)%n&gt;0-@0sY*dA52=m_|ih8Q7N`kC2E7n2Scjssx7Qbs1~Vo!~62m
z1-dTFv(KHG&lt;A=F&gt;@AI%rOiYNAoZOi+_nz~g|2b!7t`ZUcpDmo|3~W+sgD}`?jr|m$
zZ&lt;9X&gt;0{ynN?ge1)J+Fv_sq-~)^Yp##tJc;xb}mHe@K)b@k*cwPh)ai(ic9Alxb!K4
zIHRtg8(cng_z%0vA6{($eyT)-qhAgCI@fJn+1L^zSKk9?K&amp;jm4ghvqssd7~1Fzt&amp;t
zaIRMGoYyOby5la&amp;&lt;$#k1e{;P1C-yE4V2xeT*tHlL83e5$j3JD?L{ZIH1rriN5JC|6
zrw%{|C&gt;?m6)?TMHXpPd^lXB%a^|QMWk*&lt;MFs&amp;#^ErGg02pi~4XQ26Hr&lt;rAyRR;Ex+
zKvZoAT&gt;6#9GockYojOUGK=}a@&lt;iS?TqfZf|6sl`Idcl{x?eZ|(7&gt;1FPxbuC;2S-6H
zpin4eB4kQ=ouoQZpwdMs{5Ve{s&lt;JJOCq8EO!fB#a&gt;mY9ScH?Gfnh$NCAXxASj9&lt;f@
z&gt;qU&lt;3Mn=x&amp;3{)rSloc+3%SL&amp;*IYF#NtU+voJwHg&amp;`#jiWDl1Uef}Z~n!P?#EdpASW
zRFjmFRYEROow$=2a5i=3;~&amp;hNgZaz%F&gt;k$uDz%|XvrsK_2^Op&amp;_~-^yX=b{F2)*cw
z=sVY8`&lt;}y{Iyku!CaPe&lt;xtoFkaTYNNVk$_Ipr*AFEm=;qpqpUEG;}b64E2%hdzKsD
zX=i-rr?G=?=8VK8g4NHXKlUV8&gt;lc)YxD=4H`EzmzESMyhBmrXpg^FTSv5}y4F5&amp;#8
z1nu*Y3x^orxtj4;K93BaNR23ho@WUk*ap_7A*}}E^8O?Sj6sr0&amp;O(hOx!xL7T!)_3
zMbOrXJ#m2Y50_!zJCGY)^ab=iPlGj{jr1wjAkL=MBRA)O@hgXH7YvqeM0Y&lt;4$tZI9
z@5tqU;4U3SE*?d25Esxh=OV*HjPLp!@%k4D@B5lJy!`9P&lt;zv_r2Woao#CcGYlF&lt;59
zW{h0_kZ8#!RB4vSH0&gt;j&gt;a03D0hWatT--=v2g+frxt+;;=Q+eYVR7)qp!Zm;*`s{ac
zr~8nx;o1suCM(fA2TTH{lI4IKxr+Jo_dGK&lt;H9fnB_|g67rH}j2*#uSJgbG6{KmT%`
z6LpQA32SNuo7&gt;EDz?z!)t3r{a_XWnbwNT!%ipsvtm?J;S0fqHMtG`9`;C7#^wgQC`
zQW&gt;SPe@o^dxcdoIsUuJBTLVatB*_v^MKQYR4s;wM7mr{M@1XMfM#?YUkGu44?qK1A
z1b08-!&lt;QzgJ@!UkqCrf!Vsp-bNm)o^kcYq;AA-b-2V)Q?{%i&lt;iRH29r4N(3;4`yIj
z_Gz^GIaE_8n8fdPT4N4w%Rw%B$S0mj{AM&gt;517smcrYOZ!=NuA7U=u38dOBw!DiW{X
zj@TrtBzy9Y$mk^iR6{Fz&amp;hmUOkg3jsED7^OL?G;boWfIoqVQBNVfSO{IU-=nRDSW5
zEGKm5O7!e|{p!*U$G-dPoQ1{fv;LF-B-^R--74&amp;Ul=$JD=#CzA$1&gt;uFUnczcW0?VW
zt{-!BPi}0^eN;F5ud2&lt;dZAle?{4lDzd`&gt;&lt;)!~384uR3@3?c7*LPtBZMJCpTQV|(??
z6afCm&gt;$yAEUj&lt;-UEr8JrIe?}r0M!gA&lt;@a43$LL~1CTNZM&gt;x+{d+P}S=zgH;WhK^)+
z20d+FK388vMlV8g!vm-*Wpk&gt;o4uEls3V{fKD28GwN2~+Pk=;N}yBYW~?)`oFdm?b&lt;
z5|#a1h(5U)Gw`FTIiP%r%J05G^uU(dxw--foEjkvfhMnv35pH*QtOMjx&gt;4*quVUYM
z72Vi`E|v%iF%aiKoy8p5j{NgAbYoME4JFethj$&gt;y_tea(x)=e~f04!zm=2(V5Ggj+
zp4IgY=;&gt;{f!cg6Gp@?psee1ayvuc$}LlonL@YofaHBh{KgTeCU)2QY&lt;{ayZcHKkFd
z4w5TFTu-&gt;NZ;)~bjQw_y*E{-px6WI!DlD|GM4|m35HR^y?B*+P?Ip8zUaEB7;`j&amp;W
zIdiDrym^Mbz?cGN0CT&gt;%j18Ze$0M!vEGGRexgG85IPdqK&lt;(J=ni#^71M&amp;UE62$X;V
k5Zp!p0$897i~?i-0r;%NI&gt;fK;H~;_u07*qoM6N&lt;$g0$pZj{pDw</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/suite/themes/modern/jar.mn</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/suite/themes/modern/jar.mn</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -33,22 +33,25 @@ modern.jar:</span>
<a href="#l37.4"></a><span id="l37.4">   skin/modern/communicator/brand/throbber-anim.png                 (communicator/brand/throbber-anim.png)</span>
<a href="#l37.5"></a><span id="l37.5">   skin/modern/communicator/brand/throbber-single.png               (communicator/brand/throbber-single.png)</span>
<a href="#l37.6"></a><span id="l37.6">   skin/modern/communicator/brand/throbber16-anim.png               (communicator/brand/throbber16-anim.png)</span>
<a href="#l37.7"></a><span id="l37.7">   skin/modern/communicator/brand/throbber16-single.png             (communicator/brand/throbber16-single.png)</span>
<a href="#l37.8"></a><span id="l37.8">   skin/modern/communicator/directory/file-folder-closed.gif        (communicator/directory/file-folder-closed.gif)</span>
<a href="#l37.9"></a><span id="l37.9">   skin/modern/communicator/directory/file-folder-open.gif          (communicator/directory/file-folder-open.gif)</span>
<a href="#l37.10"></a><span id="l37.10">   skin/modern/communicator/directory/file-icon.gif                 (communicator/directory/file-icon.gif)</span>
<a href="#l37.11"></a><span id="l37.11">   skin/modern/communicator/directory/directory.css                 (communicator/directory/directory.css)</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineplus">+  skin/modern/communicator/feed-subscribe.css                      (communicator/feed-subscribe.css)</span>
<a href="#l37.13"></a><span id="l37.13">   skin/modern/communicator/history/calendar.png                    (communicator/history/calendar.png)</span>
<a href="#l37.14"></a><span id="l37.14">   skin/modern/communicator/icons/alwaysAsk.png                     (communicator/icons/alwaysAsk.png)</span>
<a href="#l37.15"></a><span id="l37.15">   skin/modern/communicator/icons/application.png                   (communicator/icons/application.png)</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineplus">+  skin/modern/communicator/icons/audioFeedIcon.png                 (communicator/icons/feedIcon.png)</span>
<a href="#l37.17"></a><span id="l37.17">   skin/modern/communicator/icons/btn1.gif                          (communicator/icons/btn1.gif)</span>
<a href="#l37.18"></a><span id="l37.18">   skin/modern/communicator/icons/common.png                        (communicator/icons/common.png)</span>
<a href="#l37.19"></a><span id="l37.19">   skin/modern/communicator/icons/common-small.png                  (communicator/icons/common-small.png)</span>
<a href="#l37.20"></a><span id="l37.20" class="difflineplus">+  skin/modern/communicator/icons/feedIcon.png                      (communicator/icons/feedIcon.png)</span>
<a href="#l37.21"></a><span id="l37.21">   skin/modern/communicator/icons/feedIcon16.png                    (communicator/icons/feedIcon16.png)</span>
<a href="#l37.22"></a><span id="l37.22">   skin/modern/communicator/icons/loading.gif                       (communicator/icons/loading.gif)</span>
<a href="#l37.23"></a><span id="l37.23">   skin/modern/communicator/icons/lock-broken.png                   (communicator/icons/lock-broken.png)</span>
<a href="#l37.24"></a><span id="l37.24">   skin/modern/communicator/icons/lock-insecure.png                 (communicator/icons/lock-insecure.png)</span>
<a href="#l37.25"></a><span id="l37.25">   skin/modern/communicator/icons/lock-secure.png                   (communicator/icons/lock-secure.png)</span>
<a href="#l37.26"></a><span id="l37.26">   skin/modern/communicator/icons/offline.gif                       (communicator/icons/offline.gif)</span>
<a href="#l37.27"></a><span id="l37.27">   skin/modern/communicator/icons/online.gif                        (communicator/icons/online.gif)</span>
<a href="#l37.28"></a><span id="l37.28">   skin/modern/communicator/icons/plugin.png                        (communicator/icons/plugin.png)</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineat">@@ -64,16 +67,17 @@ modern.jar:</span>
<a href="#l37.30"></a><span id="l37.30">   skin/modern/communicator/icons/smileys/smiley-kiss.png           (communicator/icons/smileys/smiley-kiss.png)</span>
<a href="#l37.31"></a><span id="l37.31">   skin/modern/communicator/icons/smileys/smiley-yell.png           (communicator/icons/smileys/smiley-yell.png)</span>
<a href="#l37.32"></a><span id="l37.32">   skin/modern/communicator/icons/smileys/smiley-cool.png           (communicator/icons/smileys/smiley-cool.png)</span>
<a href="#l37.33"></a><span id="l37.33">   skin/modern/communicator/icons/smileys/smiley-money.png          (communicator/icons/smileys/smiley-money.png)</span>
<a href="#l37.34"></a><span id="l37.34">   skin/modern/communicator/icons/smileys/smiley-foot.png           (communicator/icons/smileys/smiley-foot.png)</span>
<a href="#l37.35"></a><span id="l37.35">   skin/modern/communicator/icons/smileys/smiley-innocent.png       (communicator/icons/smileys/smiley-innocent.png)</span>
<a href="#l37.36"></a><span id="l37.36">   skin/modern/communicator/icons/smileys/smiley-cry.png            (communicator/icons/smileys/smiley-cry.png)</span>
<a href="#l37.37"></a><span id="l37.37">   skin/modern/communicator/icons/smileys/smiley-sealed.png         (communicator/icons/smileys/smiley-sealed.png)</span>
<a href="#l37.38"></a><span id="l37.38" class="difflineplus">+  skin/modern/communicator/icons/videoFeedIcon.png                 (communicator/icons/feedIcon.png)</span>
<a href="#l37.39"></a><span id="l37.39">   skin/modern/communicator/profile/migrate.gif                     (communicator/profile/migrate.gif)</span>
<a href="#l37.40"></a><span id="l37.40">   skin/modern/communicator/profile/profile.gif                     (communicator/profile/profile.gif)</span>
<a href="#l37.41"></a><span id="l37.41">   skin/modern/communicator/profile/profile.css                     (communicator/profile/profile.css)</span>
<a href="#l37.42"></a><span id="l37.42">   skin/modern/communicator/search/category.gif                     (communicator/search/category.gif)</span>
<a href="#l37.43"></a><span id="l37.43">   skin/modern/communicator/search/result.gif                       (communicator/search/result.gif)</span>
<a href="#l37.44"></a><span id="l37.44">   skin/modern/communicator/search/internetresults.css              (communicator/search/internetresults.css)</span>
<a href="#l37.45"></a><span id="l37.45">   skin/modern/communicator/search/search-editor.css                (communicator/search/search-editor.css)</span>
<a href="#l37.46"></a><span id="l37.46">   skin/modern/communicator/search/search.css                       (communicator/search/search.css)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

