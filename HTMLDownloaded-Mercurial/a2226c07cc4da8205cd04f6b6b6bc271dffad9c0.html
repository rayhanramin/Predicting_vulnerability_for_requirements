<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 585:a2226c07cc4da8205cd04f6b6b6bc271dffad9c0</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a2226c07cc4da8205cd04f6b6b6bc271dffad9c0" />
<meta property="og:url" content="/comm-central/rev/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0" />
<meta property="og:description" content="Bug 308552 Growl Integration for Mail Alerts on Mac OS X. Patch by David Humphrey, bitrot updates by Standard8. r=Mnyromyr,sr=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a2226c07cc4da8205cd04f6b6b6bc271dffad9c0 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0">shortlog</a> |
<a href="/comm-central/log/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0">files</a> |
changeset |
<a href="/comm-central/raw-rev/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0">raw</a>  | <a href="/comm-central/archive/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=308552">Bug 308552</a> Growl Integration for Mail Alerts on Mac OS X. Patch by David Humphrey, bitrot updates by Standard8. r=Mnyromyr,sr=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#97;&#118;&#105;&#100;&#32;&#72;&#117;&#109;&#112;&#104;&#114;&#101;&#121;&#32;&#60;&#100;&#97;&#118;&#105;&#100;&#46;&#104;&#117;&#109;&#112;&#104;&#114;&#101;&#121;&#64;&#115;&#101;&#110;&#101;&#99;&#97;&#99;&#46;&#111;&#110;&#46;&#99;&#97;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 11 Oct 2008 09:01:09 +0100</td></tr>

<tr>
 <td>changeset 585</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0">a2226c07cc4da8205cd04f6b6b6bc271dffad9c0</a></td>
</tr>



<tr>
<td>parent 584</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/773da60a611342b6fa44dfe6812b2a3b3bb31cb6">773da60a611342b6fa44dfe6812b2a3b3bb31cb6</a>
</td>
</tr>

<tr>
<td>child 586</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1f39876064102605080798473fc6b238681ab755">1f39876064102605080798473fc6b238681ab755</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a2226c07cc4da8205cd04f6b6b6bc271dffad9c0">519</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Sat, 11 Oct 2008 08:24:20 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@1f3987606410 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1f39876064102605080798473fc6b238681ab755">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1f39876064102605080798473fc6b238681ab755&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1f39876064102605080798473fc6b238681ab755&newProject=comm-central&newRevision=773da60a611342b6fa44dfe6812b2a3b3bb31cb6&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1f39876064102605080798473fc6b238681ab755&newProject=comm-central&newRevision=773da60a611342b6fa44dfe6812b2a3b3bb31cb6&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1f39876064102605080798473fc6b238681ab755&newProject=comm-central&newRevision=773da60a611342b6fa44dfe6812b2a3b3bb31cb6&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Mnyromyr%29&revcount=50">Mnyromyr</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=308552">308552</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=308552">Bug 308552</a> Growl Integration for Mail Alerts on Mac OS X. Patch by David Humphrey, bitrot updates by Standard8. r=Mnyromyr,sr=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mail/locales/en-US/chrome/messenger/messenger.properties">mail/locales/en-US/chrome/messenger/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mail/locales/en-US/chrome/messenger/messenger.properties">file</a> |
<a href="/comm-central/annotate/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mail/locales/en-US/chrome/messenger/messenger.properties">annotate</a> |
<a href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mail/locales/en-US/chrome/messenger/messenger.properties">diff</a> |
<a href="/comm-central/comparison/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mail/locales/en-US/chrome/messenger/messenger.properties">comparison</a> |
<a href="/comm-central/log/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mail/locales/en-US/chrome/messenger/messenger.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/build/Makefile.in">mailnews/base/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.cpp">mailnews/base/src/nsMessengerOSXIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.cpp">file</a> |
<a href="/comm-central/annotate/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.cpp">comparison</a> |
<a href="/comm-central/log/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.h">mailnews/base/src/nsMessengerOSXIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.h">file</a> |
<a href="/comm-central/annotate/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.h">annotate</a> |
<a href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.h">diff</a> |
<a href="/comm-central/comparison/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.h">comparison</a> |
<a href="/comm-central/log/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/base/src/nsMessengerOSXIntegration.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/build/Makefile.in">mailnews/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/mailnews/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/suite/locales/en-US/chrome/mailnews/messenger.properties">suite/locales/en-US/chrome/mailnews/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/suite/locales/en-US/chrome/mailnews/messenger.properties">file</a> |
<a href="/comm-central/annotate/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/suite/locales/en-US/chrome/mailnews/messenger.properties">annotate</a> |
<a href="/comm-central/diff/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/suite/locales/en-US/chrome/mailnews/messenger.properties">diff</a> |
<a href="/comm-central/comparison/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/suite/locales/en-US/chrome/mailnews/messenger.properties">comparison</a> |
<a href="/comm-central/log/a2226c07cc4da8205cd04f6b6b6bc271dffad9c0/suite/locales/en-US/chrome/mailnews/messenger.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -447,16 +447,17 @@ copyToFolderAgain=Copy to &quot;%1$S&quot; Again</span>
<a href="#l1.4"></a><span id="l1.4"> copyToFolderAgainAccessKey=t</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> #LOCALIZATION NOTE %1$S is the e-mail address of the person we will allow remote images for</span>
<a href="#l1.7"></a><span id="l1.7"> alwaysLoadRemoteContentForSender1= Always load remote images from %1$S </span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> # Strings for growl notifications on Mac OS X</span>
<a href="#l1.10"></a><span id="l1.10"> subjectNotificationTitle=Subject: &quot;%1$S&quot;</span>
<a href="#l1.11"></a><span id="l1.11"> senderNotificationText=Sender: &quot;%1$S&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+growlNotification=New Mail</span>
<a href="#l1.13"></a><span id="l1.13"> </span>
<a href="#l1.14"></a><span id="l1.14"> # mailCommands.js</span>
<a href="#l1.15"></a><span id="l1.15"> emptyJunkTitle=Confirm</span>
<a href="#l1.16"></a><span id="l1.16"> emptyJunkMessage=Are you sure you want to permanently delete all messages and subfolders in the Junk folder?</span>
<a href="#l1.17"></a><span id="l1.17"> emptyJunkDontAsk=Don't ask me again.</span>
<a href="#l1.18"></a><span id="l1.18"> emptyTrashTitle=Confirm</span>
<a href="#l1.19"></a><span id="l1.19"> emptyTrashMessage=Are you sure you want to permanently delete all messages and subfolders in the Trash folder?</span>
<a href="#l1.20"></a><span id="l1.20"> emptyTrashDontAsk=Don't ask me again.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/build/Makefile.in</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/build/Makefile.in</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -79,16 +79,20 @@ REQUIRES	= xpcom \</span>
<a href="#l2.4"></a><span id="l2.4"> 		  appcomps \</span>
<a href="#l2.5"></a><span id="l2.5"> 		  toolkitcomps \</span>
<a href="#l2.6"></a><span id="l2.6"> 		  msgnews \</span>
<a href="#l2.7"></a><span id="l2.7"> 		  msgimap \</span>
<a href="#l2.8"></a><span id="l2.8"> 		  gfx \</span>
<a href="#l2.9"></a><span id="l2.9"> 		  webbrwsr \</span>
<a href="#l2.10"></a><span id="l2.10"> 		  $(NULL)</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+ifeq ($(OS_TARGET),Darwin)</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+REQUIRES += alerts</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+endif</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+</span>
<a href="#l2.16"></a><span id="l2.16"> CPPSRCS		= nsMsgFactory.cpp</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> SHARED_LIBRARY_LIBS = \</span>
<a href="#l2.19"></a><span id="l2.19"> 		../src/$(LIB_PREFIX)msgbase_s.$(LIB_SUFFIX) \</span>
<a href="#l2.20"></a><span id="l2.20"> 		../search/src/$(LIB_PREFIX)msgsearch_s.$(LIB_SUFFIX) \</span>
<a href="#l2.21"></a><span id="l2.21"> 		$(NULL)</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23"> ifeq ($(USE_SHORT_LIBNAME),1)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -59,19 +59,63 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &quot;nsIBaseWindow.h&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;nsIWidget.h&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> #include &quot;nsIPrefBranch.h&quot; </span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;nsIMessengerWindowService.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;prprf.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsIWeakReference.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+#include &quot;nsIAlertsService.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+#include &quot;nsIStringBundle.h&quot;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+#include &quot;nsToolkitCompsCID.h&quot;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+#include &quot;nsINotificationsList.h&quot;</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> #include &lt;Carbon/Carbon.h&gt;</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+#define kNewMailAlertIcon &quot;chrome://messenger/skin/icons/new-mail-alert.png&quot;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+#define kBiffShowAlertPref &quot;mail.biff.show_alert&quot;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+static void openMailWindow(const nsACString&amp; aFolderUri)</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+{</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+  nsresult rv;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+  nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession ( do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv));</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+    return;</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+  nsCOMPtr&lt;nsIMsgWindow&gt; topMostMsgWindow;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+  rv = mailSession-&gt;GetTopmostMsgWindow(getter_AddRefs(topMostMsgWindow));</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+  if (topMostMsgWindow)</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+  {</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+    if (!aFolderUri.IsEmpty())</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+    {</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+      nsCOMPtr&lt;nsIMsgWindowCommands&gt; windowCommands;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+      topMostMsgWindow-&gt;GetWindowCommands(getter_AddRefs(windowCommands));</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+      if (windowCommands)</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+        windowCommands-&gt;SelectFolder(aFolderUri);</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+    }</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+    </span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+    nsCOMPtr&lt;nsIDOMWindowInternal&gt; domWindow;</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+    topMostMsgWindow-&gt;GetDomWindow(getter_AddRefs(domWindow));</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+    domWindow-&gt;Focus();</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+  }</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+  else</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+  {</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+    // the user doesn't have a mail window open already so open one for them...</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+    nsCOMPtr&lt;nsIMessengerWindowService&gt; messengerWindowService =</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+      do_GetService(NS_MESSENGERWINDOWSERVICE_CONTRACTID);</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+    // if we want to preselect the first account with new mail,</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+    // here is where we would try to generate a uri to pass in</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+    // (and add code to the messenger window service to make that work)</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+    if (messengerWindowService)</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+      messengerWindowService-&gt;OpenMessengerWindowWithUri(</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+                                &quot;mail:3pane&quot;, nsCString(aFolderUri).get(), nsMsgKey_None);</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+  }</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+}</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+</span>
<a href="#l3.59"></a><span id="l3.59"> nsMessengerOSXIntegration::nsMessengerOSXIntegration()</span>
<a href="#l3.60"></a><span id="l3.60"> {</span>
<a href="#l3.61"></a><span id="l3.61">   mBiffStateAtom = do_GetAtom(&quot;BiffState&quot;);</span>
<a href="#l3.62"></a><span id="l3.62"> </span>
<a href="#l3.63"></a><span id="l3.63">   mBiffIconVisible = PR_FALSE;</span>
<a href="#l3.64"></a><span id="l3.64">   mSuppressBiffIcon = PR_FALSE;</span>
<a href="#l3.65"></a><span id="l3.65">   mAlertInProgress = PR_FALSE;</span>
<a href="#l3.66"></a><span id="l3.66">   NS_NewISupportsArray(getter_AddRefs(mFoldersWithNewMail));</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineat">@@ -88,40 +132,42 @@ nsMessengerOSXIntegration::~nsMessengerO</span>
<a href="#l3.68"></a><span id="l3.68"> </span>
<a href="#l3.69"></a><span id="l3.69"> NS_IMPL_ADDREF(nsMessengerOSXIntegration)</span>
<a href="#l3.70"></a><span id="l3.70"> NS_IMPL_RELEASE(nsMessengerOSXIntegration)</span>
<a href="#l3.71"></a><span id="l3.71"> </span>
<a href="#l3.72"></a><span id="l3.72"> NS_INTERFACE_MAP_BEGIN(nsMessengerOSXIntegration)</span>
<a href="#l3.73"></a><span id="l3.73">    NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIMessengerOSIntegration)</span>
<a href="#l3.74"></a><span id="l3.74">    NS_INTERFACE_MAP_ENTRY(nsIMessengerOSIntegration)</span>
<a href="#l3.75"></a><span id="l3.75">    NS_INTERFACE_MAP_ENTRY(nsIFolderListener)</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+   NS_INTERFACE_MAP_ENTRY(nsIObserver)</span>
<a href="#l3.77"></a><span id="l3.77"> NS_INTERFACE_MAP_END</span>
<a href="#l3.78"></a><span id="l3.78"> </span>
<a href="#l3.79"></a><span id="l3.79"> </span>
<a href="#l3.80"></a><span id="l3.80"> nsresult</span>
<a href="#l3.81"></a><span id="l3.81"> nsMessengerOSXIntegration::Init()</span>
<a href="#l3.82"></a><span id="l3.82"> {</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+  // need to register a named Growl notification</span>
<a href="#l3.84"></a><span id="l3.84">   nsresult rv;</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+  nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+  if (NS_SUCCEEDED(rv))</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+    observerService-&gt;AddObserver(this, &quot;before-growl-registration&quot;, PR_FALSE);</span>
<a href="#l3.88"></a><span id="l3.88">     </span>
<a href="#l3.89"></a><span id="l3.89">   nsCOMPtr &lt;nsIMsgAccountManager&gt; accountManager = </span>
<a href="#l3.90"></a><span id="l3.90">     do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l3.91"></a><span id="l3.91">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.92"></a><span id="l3.92"> </span>
<a href="#l3.93"></a><span id="l3.93">   // because we care if the default server changes</span>
<a href="#l3.94"></a><span id="l3.94">   rv = accountManager-&gt;AddRootFolderListener(this);</span>
<a href="#l3.95"></a><span id="l3.95">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.96"></a><span id="l3.96"> </span>
<a href="#l3.97"></a><span id="l3.97">   nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l3.98"></a><span id="l3.98">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.99"></a><span id="l3.99"> </span>
<a href="#l3.100"></a><span id="l3.100">   // because we care if the unread total count changes</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineminus">-  rv = mailSession-&gt;AddFolderListener(this, nsIFolderListener::boolPropertyChanged | nsIFolderListener::intPropertyChanged);</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineminus">-</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+  return mailSession-&gt;AddFolderListener(this, nsIFolderListener::boolPropertyChanged | nsIFolderListener::intPropertyChanged);</span>
<a href="#l3.106"></a><span id="l3.106"> }</span>
<a href="#l3.107"></a><span id="l3.107"> </span>
<a href="#l3.108"></a><span id="l3.108"> NS_IMETHODIMP</span>
<a href="#l3.109"></a><span id="l3.109"> nsMessengerOSXIntegration::OnItemPropertyChanged(nsIMsgFolder *, nsIAtom *, char const *, char const *)</span>
<a href="#l3.110"></a><span id="l3.110"> {</span>
<a href="#l3.111"></a><span id="l3.111">   return NS_OK;</span>
<a href="#l3.112"></a><span id="l3.112"> }</span>
<a href="#l3.113"></a><span id="l3.113"> </span>
<a href="#l3.114"></a><span id="l3.114" class="difflineat">@@ -132,47 +178,246 @@ nsMessengerOSXIntegration::OnItemUnichar</span>
<a href="#l3.115"></a><span id="l3.115"> }</span>
<a href="#l3.116"></a><span id="l3.116"> </span>
<a href="#l3.117"></a><span id="l3.117"> NS_IMETHODIMP</span>
<a href="#l3.118"></a><span id="l3.118"> nsMessengerOSXIntegration::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l3.119"></a><span id="l3.119"> {</span>
<a href="#l3.120"></a><span id="l3.120">   return NS_OK;</span>
<a href="#l3.121"></a><span id="l3.121"> }</span>
<a href="#l3.122"></a><span id="l3.122"> </span>
<a href="#l3.123"></a><span id="l3.123" class="difflineminus">-PRInt32 nsMessengerOSXIntegration::CountNewMessages()</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+nsMessengerOSXIntegration::Observe(nsISupports* aSubject, const char* aTopic, const PRUnichar* aData)</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+{</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+  if (!strcmp(aTopic, &quot;alertfinished&quot;))</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+    return OnAlertFinished(nsnull);</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+  if (!strcmp(aTopic, &quot;alertclickcallback&quot;))</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+    return OnAlertClicked();</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineplus">+  // register named Growl notification for new mail alerts.</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineplus">+  if (!strcmp(aTopic, &quot;before-growl-registration&quot;))</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+  {</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+      printf(&quot;\n\n\nbefore-growl-registration\n\n\n&quot;);</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+    nsresult rv;</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+    nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+    if (NS_SUCCEEDED(rv))</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+      observerService-&gt;RemoveObserver(this, &quot;before-growl-registration&quot;);</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineplus">+</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineplus">+    nsCOMPtr&lt;nsINotificationsList&gt; notifications = do_QueryInterface(aSubject, &amp;rv);</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineplus">+    if (NS_SUCCEEDED(rv))</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineplus">+    {</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+      printf(&quot;...trying to get string bundle...\n&quot;);</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+      nsCOMPtr&lt;nsIStringBundle&gt; bundle; </span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+      GetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+      if (bundle)</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+      { </span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+        nsString growlNotification;</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+        bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;growlNotification&quot;).get(), getter_Copies(growlNotification));</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+        notifications-&gt;AddNotification(growlNotification, PR_TRUE);</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+      }</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+    }</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+  }</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineplus">+  return NS_OK;</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+}</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineplus">+</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineplus">+PRInt32</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineplus">+nsMessengerOSXIntegration::CountNewMessages()</span>
<a href="#l3.161"></a><span id="l3.161"> {</span>
<a href="#l3.162"></a><span id="l3.162">   // iterate over all the folders in mFoldersWithNewMail</span>
<a href="#l3.163"></a><span id="l3.163">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l3.164"></a><span id="l3.164">   nsCOMPtr&lt;nsIWeakReference&gt; weakReference;</span>
<a href="#l3.165"></a><span id="l3.165">   PRInt32 numNewMessages = 0;</span>
<a href="#l3.166"></a><span id="l3.166">   PRInt32 totalNewMessages = 0;</span>
<a href="#l3.167"></a><span id="l3.167">   </span>
<a href="#l3.168"></a><span id="l3.168">   PRUint32 count = 0;</span>
<a href="#l3.169"></a><span id="l3.169">   mFoldersWithNewMail-&gt;Count(&amp;count);</span>
<a href="#l3.170"></a><span id="l3.170"> </span>
<a href="#l3.171"></a><span id="l3.171">   for (PRUint32 index = 0; index &lt; count; index++)</span>
<a href="#l3.172"></a><span id="l3.172">   {</span>
<a href="#l3.173"></a><span id="l3.173">     weakReference = do_QueryElementAt(mFoldersWithNewMail, index);</span>
<a href="#l3.174"></a><span id="l3.174">     folder = do_QueryReferent(weakReference);</span>
<a href="#l3.175"></a><span id="l3.175">     if (folder)</span>
<a href="#l3.176"></a><span id="l3.176">     {</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineminus">-</span>
<a href="#l3.178"></a><span id="l3.178">       numNewMessages = 0;   </span>
<a href="#l3.179"></a><span id="l3.179">       folder-&gt;GetNumNewMessages(PR_TRUE, &amp;numNewMessages);</span>
<a href="#l3.180"></a><span id="l3.180">       totalNewMessages += numNewMessages;</span>
<a href="#l3.181"></a><span id="l3.181">     } // if we got a folder</span>
<a href="#l3.182"></a><span id="l3.182">   } // for each folder</span>
<a href="#l3.183"></a><span id="l3.183"> </span>
<a href="#l3.184"></a><span id="l3.184">   return totalNewMessages;</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineminus">-  </span>
<a href="#l3.186"></a><span id="l3.186" class="difflineplus">+}</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineplus">+</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineplus">+nsresult</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineplus">+nsMessengerOSXIntegration::GetStringBundle(nsIStringBundle **aBundle)</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineplus">+{</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aBundle);</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineplus">+  nsresult rv;</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+  if (bundleService &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineplus">+    bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineplus">+  bundle.swap(*aBundle);</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineplus">+  return rv;</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineplus">+}</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineplus">+</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineplus">+void</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineplus">+nsMessengerOSXIntegration::FillToolTipInfo()</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineplus">+{</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineplus">+  nsCOMPtr&lt;nsIWeakReference&gt; weakReference = do_QueryElementAt(mFoldersWithNewMail, 0);</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineplus">+  nsCOMPtr&lt;nsIMsgFolder&gt; folder = do_QueryReferent(weakReference);</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineplus">+  if (folder)</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineplus">+  {</span>
<a href="#l3.208"></a><span id="l3.208" class="difflineplus">+    nsString accountName;</span>
<a href="#l3.209"></a><span id="l3.209" class="difflineplus">+    folder-&gt;GetPrettiestName(accountName);</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineplus">+</span>
<a href="#l3.211"></a><span id="l3.211" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundle&gt; bundle; </span>
<a href="#l3.212"></a><span id="l3.212" class="difflineplus">+    GetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineplus">+    if (bundle)</span>
<a href="#l3.214"></a><span id="l3.214" class="difflineplus">+    { </span>
<a href="#l3.215"></a><span id="l3.215" class="difflineplus">+      PRInt32 numNewMessages = 0;   </span>
<a href="#l3.216"></a><span id="l3.216" class="difflineplus">+      folder-&gt;GetNumNewMessages(PR_TRUE, &amp;numNewMessages);</span>
<a href="#l3.217"></a><span id="l3.217" class="difflineplus">+      nsAutoString numNewMsgsText;     </span>
<a href="#l3.218"></a><span id="l3.218" class="difflineplus">+      numNewMsgsText.AppendInt(numNewMessages);</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineplus">+</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineplus">+      const PRUnichar *formatStrings[] =</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineplus">+      {</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineplus">+        numNewMsgsText.get(),       </span>
<a href="#l3.223"></a><span id="l3.223" class="difflineplus">+      };</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineplus">+     </span>
<a href="#l3.225"></a><span id="l3.225" class="difflineplus">+      nsString finalText; </span>
<a href="#l3.226"></a><span id="l3.226" class="difflineplus">+      if (numNewMessages == 1)</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineplus">+        bundle-&gt;FormatStringFromName(NS_LITERAL_STRING(&quot;biffNotification_message&quot;).get(), formatStrings, 1, getter_Copies(finalText));</span>
<a href="#l3.228"></a><span id="l3.228" class="difflineplus">+      else</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineplus">+        bundle-&gt;FormatStringFromName(NS_LITERAL_STRING(&quot;biffNotification_messages&quot;).get(), formatStrings, 1, getter_Copies(finalText));</span>
<a href="#l3.230"></a><span id="l3.230" class="difflineplus">+</span>
<a href="#l3.231"></a><span id="l3.231" class="difflineplus">+      ShowAlertMessage(accountName, finalText, EmptyCString());</span>
<a href="#l3.232"></a><span id="l3.232" class="difflineplus">+    } // if we got a bundle</span>
<a href="#l3.233"></a><span id="l3.233" class="difflineplus">+  } // if we got a folder</span>
<a href="#l3.234"></a><span id="l3.234"> }</span>
<a href="#l3.235"></a><span id="l3.235"> </span>
<a href="#l3.236"></a><span id="l3.236" class="difflineminus">-nsresult nsMessengerOSXIntegration::OnAlertFinished(const PRUnichar * aAlertCookie)</span>
<a href="#l3.237"></a><span id="l3.237" class="difflineplus">+nsresult</span>
<a href="#l3.238"></a><span id="l3.238" class="difflineplus">+nsMessengerOSXIntegration::ShowAlertMessage(const nsAString&amp; aAlertTitle,</span>
<a href="#l3.239"></a><span id="l3.239" class="difflineplus">+                                            const nsAString&amp; aAlertText,</span>
<a href="#l3.240"></a><span id="l3.240" class="difflineplus">+                                            const nsACString&amp; aFolderURI)</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineplus">+{</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineplus">+  // if we are alredy in the process of showing an alert, don't try to show another one</span>
<a href="#l3.243"></a><span id="l3.243" class="difflineplus">+  if (mAlertInProgress)</span>
<a href="#l3.244"></a><span id="l3.244" class="difflineplus">+    return NS_OK;</span>
<a href="#l3.245"></a><span id="l3.245" class="difflineplus">+</span>
<a href="#l3.246"></a><span id="l3.246" class="difflineplus">+  nsresult rv;</span>
<a href="#l3.247"></a><span id="l3.247" class="difflineplus">+  nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.249"></a><span id="l3.249" class="difflineplus">+</span>
<a href="#l3.250"></a><span id="l3.250" class="difflineplus">+  PRBool showAlert = PR_TRUE;</span>
<a href="#l3.251"></a><span id="l3.251" class="difflineplus">+  prefBranch-&gt;GetBoolPref(kBiffShowAlertPref, &amp;showAlert);</span>
<a href="#l3.252"></a><span id="l3.252" class="difflineplus">+</span>
<a href="#l3.253"></a><span id="l3.253" class="difflineplus">+  if (showAlert)</span>
<a href="#l3.254"></a><span id="l3.254" class="difflineplus">+  {</span>
<a href="#l3.255"></a><span id="l3.255" class="difflineplus">+    nsCOMPtr&lt;nsIAlertsService&gt; alertsService (do_GetService(NS_ALERTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l3.256"></a><span id="l3.256" class="difflineplus">+    if (NS_SUCCEEDED(rv))</span>
<a href="#l3.257"></a><span id="l3.257" class="difflineplus">+    {</span>
<a href="#l3.258"></a><span id="l3.258" class="difflineplus">+      nsCOMPtr&lt;nsIStringBundle&gt; bundle; </span>
<a href="#l3.259"></a><span id="l3.259" class="difflineplus">+      GetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l3.260"></a><span id="l3.260" class="difflineplus">+      if (bundle)</span>
<a href="#l3.261"></a><span id="l3.261" class="difflineplus">+      { </span>
<a href="#l3.262"></a><span id="l3.262" class="difflineplus">+        nsString growlNotification;</span>
<a href="#l3.263"></a><span id="l3.263" class="difflineplus">+        bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;growlNotification&quot;).get(), getter_Copies(growlNotification));</span>
<a href="#l3.264"></a><span id="l3.264" class="difflineplus">+        rv = alertsService-&gt;ShowAlertNotification(NS_LITERAL_STRING(kNewMailAlertIcon), aAlertTitle,</span>
<a href="#l3.265"></a><span id="l3.265" class="difflineplus">+                                                  aAlertText, PR_TRUE, NS_ConvertASCIItoUTF16(aFolderURI),</span>
<a href="#l3.266"></a><span id="l3.266" class="difflineplus">+                                                  this, growlNotification);</span>
<a href="#l3.267"></a><span id="l3.267" class="difflineplus">+        mAlertInProgress = PR_TRUE;</span>
<a href="#l3.268"></a><span id="l3.268" class="difflineplus">+      }</span>
<a href="#l3.269"></a><span id="l3.269" class="difflineplus">+    }</span>
<a href="#l3.270"></a><span id="l3.270" class="difflineplus">+  }</span>
<a href="#l3.271"></a><span id="l3.271" class="difflineplus">+   </span>
<a href="#l3.272"></a><span id="l3.272" class="difflineplus">+  if (!showAlert || NS_FAILED(rv))</span>
<a href="#l3.273"></a><span id="l3.273" class="difflineplus">+    OnAlertFinished(nsnull);</span>
<a href="#l3.274"></a><span id="l3.274" class="difflineplus">+</span>
<a href="#l3.275"></a><span id="l3.275" class="difflineplus">+  return rv;</span>
<a href="#l3.276"></a><span id="l3.276" class="difflineplus">+}</span>
<a href="#l3.277"></a><span id="l3.277" class="difflineplus">+</span>
<a href="#l3.278"></a><span id="l3.278" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l3.279"></a><span id="l3.279" class="difflineplus">+nsMessengerOSXIntegration::OnItemIntPropertyChanged(nsIMsgFolder *aFolder,</span>
<a href="#l3.280"></a><span id="l3.280" class="difflineplus">+                                                    nsIAtom *aProperty,</span>
<a href="#l3.281"></a><span id="l3.281" class="difflineplus">+                                                    PRInt32 aOldValue,</span>
<a href="#l3.282"></a><span id="l3.282" class="difflineplus">+                                                    PRInt32 aNewValue)</span>
<a href="#l3.283"></a><span id="l3.283"> {</span>
<a href="#l3.284"></a><span id="l3.284" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l3.285"></a><span id="l3.285" class="difflineplus">+   // if we got new mail show an alert</span>
<a href="#l3.286"></a><span id="l3.286" class="difflineplus">+  if (mBiffStateAtom == aProperty &amp;&amp; mFoldersWithNewMail)</span>
<a href="#l3.287"></a><span id="l3.287" class="difflineplus">+  {</span>
<a href="#l3.288"></a><span id="l3.288" class="difflineplus">+    NS_ENSURE_TRUE(aFolder, NS_OK);</span>
<a href="#l3.289"></a><span id="l3.289" class="difflineplus">+</span>
<a href="#l3.290"></a><span id="l3.290" class="difflineplus">+    if (aNewValue == nsIMsgFolder::nsMsgBiffState_NewMail)</span>
<a href="#l3.291"></a><span id="l3.291" class="difflineplus">+    {</span>
<a href="#l3.292"></a><span id="l3.292" class="difflineplus">+      // if the icon is not already visible, only show a system tray icon if</span>
<a href="#l3.293"></a><span id="l3.293" class="difflineplus">+      // we are performing biff (as opposed to the user getting new mail)</span>
<a href="#l3.294"></a><span id="l3.294" class="difflineplus">+      if (!mBiffIconVisible)</span>
<a href="#l3.295"></a><span id="l3.295" class="difflineplus">+      {</span>
<a href="#l3.296"></a><span id="l3.296" class="difflineplus">+        PRBool performingBiff = PR_FALSE;</span>
<a href="#l3.297"></a><span id="l3.297" class="difflineplus">+        nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l3.298"></a><span id="l3.298" class="difflineplus">+        aFolder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l3.299"></a><span id="l3.299" class="difflineplus">+        if (server)</span>
<a href="#l3.300"></a><span id="l3.300" class="difflineplus">+          server-&gt;GetPerformingBiff(&amp;performingBiff);</span>
<a href="#l3.301"></a><span id="l3.301" class="difflineplus">+        if (!performingBiff)</span>
<a href="#l3.302"></a><span id="l3.302" class="difflineplus">+          return NS_OK; // kick out right now...</span>
<a href="#l3.303"></a><span id="l3.303" class="difflineplus">+      }</span>
<a href="#l3.304"></a><span id="l3.304" class="difflineplus">+</span>
<a href="#l3.305"></a><span id="l3.305" class="difflineplus">+      nsCOMPtr&lt;nsIWeakReference&gt; weakFolder = do_GetWeakReference(aFolder);</span>
<a href="#l3.306"></a><span id="l3.306" class="difflineplus">+</span>
<a href="#l3.307"></a><span id="l3.307" class="difflineplus">+      if (mFoldersWithNewMail-&gt;IndexOf(weakFolder) == kNotFound)</span>
<a href="#l3.308"></a><span id="l3.308" class="difflineplus">+          mFoldersWithNewMail-&gt;AppendElement(weakFolder);</span>
<a href="#l3.309"></a><span id="l3.309" class="difflineplus">+</span>
<a href="#l3.310"></a><span id="l3.310" class="difflineplus">+      FillToolTipInfo();</span>
<a href="#l3.311"></a><span id="l3.311" class="difflineplus">+    }</span>
<a href="#l3.312"></a><span id="l3.312" class="difflineplus">+    else if (aNewValue == nsIMsgFolder::nsMsgBiffState_NoMail)</span>
<a href="#l3.313"></a><span id="l3.313" class="difflineplus">+    {</span>
<a href="#l3.314"></a><span id="l3.314" class="difflineplus">+      // we are always going to remove the icon whenever we get our first no</span>
<a href="#l3.315"></a><span id="l3.315" class="difflineplus">+      // mail notification.</span>
<a href="#l3.316"></a><span id="l3.316" class="difflineplus">+      mFoldersWithNewMail-&gt;Clear();</span>
<a href="#l3.317"></a><span id="l3.317" class="difflineplus">+      if (mBiffIconVisible)</span>
<a href="#l3.318"></a><span id="l3.318" class="difflineplus">+      {</span>
<a href="#l3.319"></a><span id="l3.319" class="difflineplus">+        RestoreApplicationDockTileImage();</span>
<a href="#l3.320"></a><span id="l3.320" class="difflineplus">+        mBiffIconVisible = PR_FALSE;</span>
<a href="#l3.321"></a><span id="l3.321" class="difflineplus">+      }</span>
<a href="#l3.322"></a><span id="l3.322" class="difflineplus">+    }</span>
<a href="#l3.323"></a><span id="l3.323" class="difflineplus">+  } // if the biff property changed</span>
<a href="#l3.324"></a><span id="l3.324" class="difflineplus">+</span>
<a href="#l3.325"></a><span id="l3.325" class="difflineplus">+  return NS_OK;</span>
<a href="#l3.326"></a><span id="l3.326" class="difflineplus">+}</span>
<a href="#l3.327"></a><span id="l3.327" class="difflineplus">+</span>
<a href="#l3.328"></a><span id="l3.328" class="difflineplus">+nsresult</span>
<a href="#l3.329"></a><span id="l3.329" class="difflineplus">+nsMessengerOSXIntegration::OnAlertClicked()</span>
<a href="#l3.330"></a><span id="l3.330" class="difflineplus">+{</span>
<a href="#l3.331"></a><span id="l3.331" class="difflineplus">+#ifdef MOZ_THUNDERBIRD</span>
<a href="#l3.332"></a><span id="l3.332" class="difflineplus">+  nsresult rv;</span>
<a href="#l3.333"></a><span id="l3.333" class="difflineplus">+  nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l3.334"></a><span id="l3.334" class="difflineplus">+  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.335"></a><span id="l3.335" class="difflineplus">+  </span>
<a href="#l3.336"></a><span id="l3.336" class="difflineplus">+  nsCOMPtr&lt;nsIMsgWindow&gt; topMostMsgWindow;</span>
<a href="#l3.337"></a><span id="l3.337" class="difflineplus">+  rv = mailSession-&gt;GetTopmostMsgWindow(getter_AddRefs(topMostMsgWindow));</span>
<a href="#l3.338"></a><span id="l3.338" class="difflineplus">+  if (topMostMsgWindow)</span>
<a href="#l3.339"></a><span id="l3.339" class="difflineplus">+  {</span>
<a href="#l3.340"></a><span id="l3.340" class="difflineplus">+    nsCOMPtr&lt;nsIDOMWindowInternal&gt; domWindow;</span>
<a href="#l3.341"></a><span id="l3.341" class="difflineplus">+    rv = topMostMsgWindow-&gt;GetDomWindow(getter_AddRefs(domWindow));</span>
<a href="#l3.342"></a><span id="l3.342" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.343"></a><span id="l3.343" class="difflineplus">+</span>
<a href="#l3.344"></a><span id="l3.344" class="difflineplus">+    domWindow-&gt;Focus();</span>
<a href="#l3.345"></a><span id="l3.345" class="difflineplus">+  }</span>
<a href="#l3.346"></a><span id="l3.346" class="difflineplus">+#else</span>
<a href="#l3.347"></a><span id="l3.347" class="difflineplus">+  nsCString folderURI;</span>
<a href="#l3.348"></a><span id="l3.348" class="difflineplus">+  GetFirstFolderWithNewMail(folderURI);</span>
<a href="#l3.349"></a><span id="l3.349" class="difflineplus">+  openMailWindow(folderURI);</span>
<a href="#l3.350"></a><span id="l3.350" class="difflineplus">+#endif</span>
<a href="#l3.351"></a><span id="l3.351" class="difflineplus">+  return NS_OK;</span>
<a href="#l3.352"></a><span id="l3.352" class="difflineplus">+}</span>
<a href="#l3.353"></a><span id="l3.353" class="difflineplus">+</span>
<a href="#l3.354"></a><span id="l3.354" class="difflineplus">+nsresult</span>
<a href="#l3.355"></a><span id="l3.355" class="difflineplus">+nsMessengerOSXIntegration::OnAlertFinished(const PRUnichar * aAlertCookie)</span>
<a href="#l3.356"></a><span id="l3.356" class="difflineplus">+{</span>
<a href="#l3.357"></a><span id="l3.357" class="difflineplus">+  nsresult rv;</span>
<a href="#l3.358"></a><span id="l3.358">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch (do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l3.359"></a><span id="l3.359">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.360"></a><span id="l3.360">   </span>
<a href="#l3.361"></a><span id="l3.361">   PRBool bounceDockIcon = PR_FALSE; </span>
<a href="#l3.362"></a><span id="l3.362">   prefBranch-&gt;GetBoolPref(&quot;mail.biff.animate_dock_icon&quot;, &amp;bounceDockIcon);</span>
<a href="#l3.363"></a><span id="l3.363"> </span>
<a href="#l3.364"></a><span id="l3.364">   // This will call GetAttention(), which will bounce the dock icon.</span>
<a href="#l3.365"></a><span id="l3.365">   if (!mSuppressBiffIcon)</span>
<a href="#l3.366"></a><span id="l3.366" class="difflineat">@@ -195,17 +440,16 @@ nsresult nsMessengerOSXIntegration::OnAl</span>
<a href="#l3.367"></a><span id="l3.367">     </span>
<a href="#l3.368"></a><span id="l3.368">     // use OverlayApplicationDockTileImage</span>
<a href="#l3.369"></a><span id="l3.369">     // -- you'll have to pass it a CGImage, and somehow we have to</span>
<a href="#l3.370"></a><span id="l3.370">     // create the CGImage with the numbers. tricky    </span>
<a href="#l3.371"></a><span id="l3.371">     PRInt32 totalNewMessages = CountNewMessages();</span>
<a href="#l3.372"></a><span id="l3.372">     CGContextRef context = ::BeginCGContextForApplicationDockTile();</span>
<a href="#l3.373"></a><span id="l3.373">     </span>
<a href="#l3.374"></a><span id="l3.374">     // Draw a circle.</span>
<a href="#l3.375"></a><span id="l3.375" class="difflineminus">-</span>
<a href="#l3.376"></a><span id="l3.376">     ::CGContextBeginPath(context);</span>
<a href="#l3.377"></a><span id="l3.377">     ::CGContextAddArc(context, 95.0, 95.0, 25.0, 0.0, 2 * M_PI, true);</span>
<a href="#l3.378"></a><span id="l3.378">     ::CGContextClosePath(context);</span>
<a href="#l3.379"></a><span id="l3.379"> </span>
<a href="#l3.380"></a><span id="l3.380">     // use #2fc600 for the color.</span>
<a href="#l3.381"></a><span id="l3.381">     ::CGContextSetRGBFillColor(context, 0.184, 0.776, 0.0, 1);</span>
<a href="#l3.382"></a><span id="l3.382"> </span>
<a href="#l3.383"></a><span id="l3.383">     //::CGContextSetRGBFillColor(context, 1.0, 1.0, 1.0, 0.7);</span>
<a href="#l3.384"></a><span id="l3.384" class="difflineat">@@ -249,62 +493,60 @@ nsresult nsMessengerOSXIntegration::OnAl</span>
<a href="#l3.385"></a><span id="l3.385">     </span>
<a href="#l3.386"></a><span id="l3.386">     ATSUAttributeTag tags[3] = { kATSUFontTag, kATSUSizeTag, kATSUColorTag };</span>
<a href="#l3.387"></a><span id="l3.387">     ByteCount valueSizes[3] = { sizeof(ATSUFontID), sizeof(Fixed),</span>
<a href="#l3.388"></a><span id="l3.388">                                 sizeof(RGBColor) };</span>
<a href="#l3.389"></a><span id="l3.389">     ATSUAttributeValuePtr values[3] = { &amp;fmFont, &amp;size, &amp;white };</span>
<a href="#l3.390"></a><span id="l3.390"> </span>
<a href="#l3.391"></a><span id="l3.391">     err = ::ATSUSetAttributes(style, 3, tags, valueSizes, values);</span>
<a href="#l3.392"></a><span id="l3.392">     if (err != noErr) {</span>
<a href="#l3.393"></a><span id="l3.393" class="difflineminus">-        NS_WARNING(&quot;ATSUSetAttributes failed&quot;);</span>
<a href="#l3.394"></a><span id="l3.394" class="difflineminus">-        ::ATSUDisposeStyle(style);</span>
<a href="#l3.395"></a><span id="l3.395" class="difflineminus">-        ::EndCGContextForApplicationDockTile(context);</span>
<a href="#l3.396"></a><span id="l3.396" class="difflineminus">-</span>
<a href="#l3.397"></a><span id="l3.397" class="difflineminus">-        return NS_ERROR_FAILURE;</span>
<a href="#l3.398"></a><span id="l3.398" class="difflineminus">-      }</span>
<a href="#l3.399"></a><span id="l3.399" class="difflineplus">+      NS_WARNING(&quot;ATSUSetAttributes failed&quot;);</span>
<a href="#l3.400"></a><span id="l3.400" class="difflineplus">+      ::ATSUDisposeStyle(style);</span>
<a href="#l3.401"></a><span id="l3.401" class="difflineplus">+      ::EndCGContextForApplicationDockTile(context);</span>
<a href="#l3.402"></a><span id="l3.402" class="difflineplus">+      return NS_ERROR_FAILURE;</span>
<a href="#l3.403"></a><span id="l3.403" class="difflineplus">+    }</span>
<a href="#l3.404"></a><span id="l3.404"> </span>
<a href="#l3.405"></a><span id="l3.405">     UniCharCount runLengths = kATSUToTextEnd;</span>
<a href="#l3.406"></a><span id="l3.406">     ATSUTextLayout textLayout;</span>
<a href="#l3.407"></a><span id="l3.407">     err = ::ATSUCreateTextLayoutWithTextPtr(total.get(),</span>
<a href="#l3.408"></a><span id="l3.408">                                             kATSUFromTextBeginning,</span>
<a href="#l3.409"></a><span id="l3.409">                                             kATSUToTextEnd, total.Length(), 1,</span>
<a href="#l3.410"></a><span id="l3.410">                                             &amp;runLengths, &amp;style, &amp;textLayout);</span>
<a href="#l3.411"></a><span id="l3.411">     if (err != noErr) </span>
<a href="#l3.412"></a><span id="l3.412"> 	{</span>
<a href="#l3.413"></a><span id="l3.413" class="difflineminus">-        NS_WARNING(&quot;ATSUCreateTextLayoutWithTextPtr failed&quot;);</span>
<a href="#l3.414"></a><span id="l3.414" class="difflineminus">-        ::ATSUDisposeStyle(style);</span>
<a href="#l3.415"></a><span id="l3.415" class="difflineminus">-        ::EndCGContextForApplicationDockTile(context);</span>
<a href="#l3.416"></a><span id="l3.416" class="difflineminus">-</span>
<a href="#l3.417"></a><span id="l3.417" class="difflineminus">-        return NS_ERROR_FAILURE;</span>
<a href="#l3.418"></a><span id="l3.418" class="difflineplus">+      NS_WARNING(&quot;ATSUCreateTextLayoutWithTextPtr failed&quot;);</span>
<a href="#l3.419"></a><span id="l3.419" class="difflineplus">+      ::ATSUDisposeStyle(style);</span>
<a href="#l3.420"></a><span id="l3.420" class="difflineplus">+      ::EndCGContextForApplicationDockTile(context);</span>
<a href="#l3.421"></a><span id="l3.421" class="difflineplus">+      return NS_ERROR_FAILURE;</span>
<a href="#l3.422"></a><span id="l3.422">     }</span>
<a href="#l3.423"></a><span id="l3.423"> </span>
<a href="#l3.424"></a><span id="l3.424">     ATSUAttributeTag layoutTags[1] = { kATSUCGContextTag };</span>
<a href="#l3.425"></a><span id="l3.425">     ByteCount layoutValueSizes[1] = { sizeof(CGContextRef) };</span>
<a href="#l3.426"></a><span id="l3.426">     ATSUAttributeValuePtr layoutValues[1] = { &amp;context };</span>
<a href="#l3.427"></a><span id="l3.427"> </span>
<a href="#l3.428"></a><span id="l3.428">     err = ::ATSUSetLayoutControls(textLayout, 1, layoutTags, layoutValueSizes,</span>
<a href="#l3.429"></a><span id="l3.429">                                   layoutValues);</span>
<a href="#l3.430"></a><span id="l3.430">     if (err != noErr) </span>
<a href="#l3.431"></a><span id="l3.431"> 	{</span>
<a href="#l3.432"></a><span id="l3.432" class="difflineminus">-        NS_WARNING(&quot;ATSUSetLayoutControls failed&quot;);</span>
<a href="#l3.433"></a><span id="l3.433" class="difflineminus">-        ::ATSUDisposeStyle(style);</span>
<a href="#l3.434"></a><span id="l3.434" class="difflineminus">-        ::EndCGContextForApplicationDockTile(context);</span>
<a href="#l3.435"></a><span id="l3.435" class="difflineminus">-        return NS_ERROR_FAILURE;</span>
<a href="#l3.436"></a><span id="l3.436" class="difflineplus">+      NS_WARNING(&quot;ATSUSetLayoutControls failed&quot;);</span>
<a href="#l3.437"></a><span id="l3.437" class="difflineplus">+      ::ATSUDisposeStyle(style);</span>
<a href="#l3.438"></a><span id="l3.438" class="difflineplus">+      ::EndCGContextForApplicationDockTile(context);</span>
<a href="#l3.439"></a><span id="l3.439" class="difflineplus">+      return NS_ERROR_FAILURE;</span>
<a href="#l3.440"></a><span id="l3.440">     }</span>
<a href="#l3.441"></a><span id="l3.441"> </span>
<a href="#l3.442"></a><span id="l3.442">     Rect boundingBox;</span>
<a href="#l3.443"></a><span id="l3.443">     err = ::ATSUMeasureTextImage(textLayout, kATSUFromTextBeginning,</span>
<a href="#l3.444"></a><span id="l3.444">                                  kATSUToTextEnd, Long2Fix(0), Long2Fix(0),</span>
<a href="#l3.445"></a><span id="l3.445">                                  &amp;boundingBox);</span>
<a href="#l3.446"></a><span id="l3.446">     if (err != noErr) </span>
<a href="#l3.447"></a><span id="l3.447"> 	{</span>
<a href="#l3.448"></a><span id="l3.448" class="difflineminus">-        NS_WARNING(&quot;ATSUMeasureTextImage failed&quot;);</span>
<a href="#l3.449"></a><span id="l3.449" class="difflineminus">-        ::ATSUDisposeStyle(style);</span>
<a href="#l3.450"></a><span id="l3.450" class="difflineminus">-        ::EndCGContextForApplicationDockTile(context);</span>
<a href="#l3.451"></a><span id="l3.451" class="difflineminus">-        return NS_ERROR_FAILURE;</span>
<a href="#l3.452"></a><span id="l3.452" class="difflineplus">+      NS_WARNING(&quot;ATSUMeasureTextImage failed&quot;);</span>
<a href="#l3.453"></a><span id="l3.453" class="difflineplus">+      ::ATSUDisposeStyle(style);</span>
<a href="#l3.454"></a><span id="l3.454" class="difflineplus">+      ::EndCGContextForApplicationDockTile(context);</span>
<a href="#l3.455"></a><span id="l3.455" class="difflineplus">+      return NS_ERROR_FAILURE;</span>
<a href="#l3.456"></a><span id="l3.456">     }</span>
<a href="#l3.457"></a><span id="l3.457"> </span>
<a href="#l3.458"></a><span id="l3.458">     // Center text inside circle</span>
<a href="#l3.459"></a><span id="l3.459">     err = ::ATSUDrawText(textLayout, kATSUFromTextBeginning, kATSUToTextEnd,</span>
<a href="#l3.460"></a><span id="l3.460">                          Long2Fix(90 - (boundingBox.right - boundingBox.left) / 2),</span>
<a href="#l3.461"></a><span id="l3.461">                          Long2Fix(95 - (boundingBox.bottom - boundingBox.top) / 2));</span>
<a href="#l3.462"></a><span id="l3.462"> </span>
<a href="#l3.463"></a><span id="l3.463">     ::ATSUDisposeStyle(style);</span>
<a href="#l3.464"></a><span id="l3.464" class="difflineat">@@ -313,17 +555,17 @@ nsresult nsMessengerOSXIntegration::OnAl</span>
<a href="#l3.465"></a><span id="l3.465">     ::CGContextFlush(context);</span>
<a href="#l3.466"></a><span id="l3.466"> </span>
<a href="#l3.467"></a><span id="l3.467">     ::EndCGContextForApplicationDockTile(context);</span>
<a href="#l3.468"></a><span id="l3.468">     mBiffIconVisible = PR_TRUE;</span>
<a href="#l3.469"></a><span id="l3.469">   }</span>
<a href="#l3.470"></a><span id="l3.470"> </span>
<a href="#l3.471"></a><span id="l3.471">   mSuppressBiffIcon = PR_FALSE;</span>
<a href="#l3.472"></a><span id="l3.472">   mAlertInProgress = PR_FALSE;</span>
<a href="#l3.473"></a><span id="l3.473" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.474"></a><span id="l3.474" class="difflineplus">+  return rv; // was NS_OK;</span>
<a href="#l3.475"></a><span id="l3.475"> }</span>
<a href="#l3.476"></a><span id="l3.476"> </span>
<a href="#l3.477"></a><span id="l3.477"> NS_IMETHODIMP</span>
<a href="#l3.478"></a><span id="l3.478"> nsMessengerOSXIntegration::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, PRUint32 oldFlag, PRUint32 newFlag)</span>
<a href="#l3.479"></a><span id="l3.479"> {</span>
<a href="#l3.480"></a><span id="l3.480">   return NS_OK;</span>
<a href="#l3.481"></a><span id="l3.481"> }</span>
<a href="#l3.482"></a><span id="l3.482"> </span>
<a href="#l3.483"></a><span id="l3.483" class="difflineat">@@ -343,67 +585,68 @@ nsMessengerOSXIntegration::OnItemBoolPro</span>
<a href="#l3.484"></a><span id="l3.484"> }</span>
<a href="#l3.485"></a><span id="l3.485"> </span>
<a href="#l3.486"></a><span id="l3.486"> NS_IMETHODIMP</span>
<a href="#l3.487"></a><span id="l3.487"> nsMessengerOSXIntegration::OnItemEvent(nsIMsgFolder *, nsIAtom *)</span>
<a href="#l3.488"></a><span id="l3.488"> {</span>
<a href="#l3.489"></a><span id="l3.489">   return NS_OK;</span>
<a href="#l3.490"></a><span id="l3.490"> }</span>
<a href="#l3.491"></a><span id="l3.491"> </span>
<a href="#l3.492"></a><span id="l3.492" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l3.493"></a><span id="l3.493" class="difflineminus">-nsMessengerOSXIntegration::OnItemIntPropertyChanged(nsIMsgFolder *aItem, nsIAtom *aProperty, PRInt32 aOldValue, PRInt32 aNewValue)</span>
<a href="#l3.494"></a><span id="l3.494" class="difflineplus">+// get the first top level folder which we know has new mail, then enumerate over all the subfolders</span>
<a href="#l3.495"></a><span id="l3.495" class="difflineplus">+// looking for the first real folder with new mail. Return the folderURI for that folder.</span>
<a href="#l3.496"></a><span id="l3.496" class="difflineplus">+nsresult</span>
<a href="#l3.497"></a><span id="l3.497" class="difflineplus">+nsMessengerOSXIntegration::GetFirstFolderWithNewMail(nsACString&amp; aFolderURI)</span>
<a href="#l3.498"></a><span id="l3.498"> {</span>
<a href="#l3.499"></a><span id="l3.499" class="difflineminus">-  // if we got new mail bounce the Dock icon and/or apply badge to Dock icon</span>
<a href="#l3.500"></a><span id="l3.500" class="difflineminus">-  if (mBiffStateAtom == aProperty &amp;&amp; mFoldersWithNewMail)</span>
<a href="#l3.501"></a><span id="l3.501" class="difflineminus">-  {</span>
<a href="#l3.502"></a><span id="l3.502" class="difflineminus">-    if (aNewValue == nsIMsgFolder::nsMsgBiffState_NewMail) </span>
<a href="#l3.503"></a><span id="l3.503" class="difflineminus">-    {</span>
<a href="#l3.504"></a><span id="l3.504" class="difflineminus">-      // if the icon is not already visible, only show a system tray icon iff </span>
<a href="#l3.505"></a><span id="l3.505" class="difflineminus">-      // we are performing biff (as opposed to the user getting new mail)</span>
<a href="#l3.506"></a><span id="l3.506" class="difflineminus">-      if (!mBiffIconVisible)</span>
<a href="#l3.507"></a><span id="l3.507" class="difflineminus">-      {</span>
<a href="#l3.508"></a><span id="l3.508" class="difflineminus">-        PRBool performingBiff = PR_FALSE;</span>
<a href="#l3.509"></a><span id="l3.509" class="difflineminus">-        nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l3.510"></a><span id="l3.510" class="difflineminus">-        aItem-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l3.511"></a><span id="l3.511" class="difflineminus">-        if (server)</span>
<a href="#l3.512"></a><span id="l3.512" class="difflineminus">-          server-&gt;GetPerformingBiff(&amp;performingBiff);</span>
<a href="#l3.513"></a><span id="l3.513" class="difflineminus">-        if (!performingBiff) </span>
<a href="#l3.514"></a><span id="l3.514" class="difflineminus">-          return NS_OK; // kick out right now...</span>
<a href="#l3.515"></a><span id="l3.515" class="difflineminus">-      }</span>
<a href="#l3.516"></a><span id="l3.516" class="difflineplus">+  nsresult rv;</span>
<a href="#l3.517"></a><span id="l3.517" class="difflineplus">+  NS_ENSURE_TRUE(mFoldersWithNewMail, NS_ERROR_FAILURE);</span>
<a href="#l3.518"></a><span id="l3.518" class="difflineplus">+</span>
<a href="#l3.519"></a><span id="l3.519" class="difflineplus">+  nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l3.520"></a><span id="l3.520" class="difflineplus">+  nsCOMPtr&lt;nsIWeakReference&gt; weakReference;</span>
<a href="#l3.521"></a><span id="l3.521" class="difflineplus">+  PRInt32 numNewMessages = 0;</span>
<a href="#l3.522"></a><span id="l3.522" class="difflineplus">+</span>
<a href="#l3.523"></a><span id="l3.523" class="difflineplus">+  PRUint32 count = 0;</span>
<a href="#l3.524"></a><span id="l3.524" class="difflineplus">+  mFoldersWithNewMail-&gt;Count(&amp;count);</span>
<a href="#l3.525"></a><span id="l3.525" class="difflineplus">+</span>
<a href="#l3.526"></a><span id="l3.526" class="difflineplus">+  if (!count)  // kick out if we don't have any folders with new mail</span>
<a href="#l3.527"></a><span id="l3.527" class="difflineplus">+    return NS_OK;</span>
<a href="#l3.528"></a><span id="l3.528" class="difflineplus">+</span>
<a href="#l3.529"></a><span id="l3.529" class="difflineplus">+  weakReference = do_QueryElementAt(mFoldersWithNewMail, 0);</span>
<a href="#l3.530"></a><span id="l3.530" class="difflineplus">+  folder = do_QueryReferent(weakReference);</span>
<a href="#l3.531"></a><span id="l3.531"> </span>
<a href="#l3.532"></a><span id="l3.532" class="difflineminus">-      nsCOMPtr&lt;nsIWeakReference&gt; weakFolder = do_GetWeakReference(aItem); </span>
<a href="#l3.533"></a><span id="l3.533" class="difflineminus">-      // remove the element if it is already in the array....</span>
<a href="#l3.534"></a><span id="l3.534" class="difflineminus">-      PRUint32 count = 0;</span>
<a href="#l3.535"></a><span id="l3.535" class="difflineminus">-      PRUint32 index = 0; </span>
<a href="#l3.536"></a><span id="l3.536" class="difflineminus">-      mFoldersWithNewMail-&gt;Count(&amp;count);</span>
<a href="#l3.537"></a><span id="l3.537" class="difflineminus">-      nsCOMPtr&lt;nsIMsgFolder&gt; oldFolder;</span>
<a href="#l3.538"></a><span id="l3.538" class="difflineminus">-      nsCOMPtr&lt;nsIWeakReference&gt; weakReference;</span>
<a href="#l3.539"></a><span id="l3.539" class="difflineminus">-      for (index = 0; index &lt; count; index++)</span>
<a href="#l3.540"></a><span id="l3.540" class="difflineminus">-      {</span>
<a href="#l3.541"></a><span id="l3.541" class="difflineminus">-        weakReference = do_QueryElementAt(mFoldersWithNewMail, index);</span>
<a href="#l3.542"></a><span id="l3.542" class="difflineminus">-        oldFolder = do_QueryReferent(weakReference);</span>
<a href="#l3.543"></a><span id="l3.543" class="difflineminus">-        if (oldFolder == aItem) // if they point to the same folder</span>
<a href="#l3.544"></a><span id="l3.544" class="difflineminus">-          break;</span>
<a href="#l3.545"></a><span id="l3.545" class="difflineminus">-        oldFolder = nsnull;</span>
<a href="#l3.546"></a><span id="l3.546" class="difflineminus">-      }</span>
<a href="#l3.547"></a><span id="l3.547" class="difflineplus">+  if (folder)</span>
<a href="#l3.548"></a><span id="l3.548" class="difflineplus">+  {</span>
<a href="#l3.549"></a><span id="l3.549" class="difflineplus">+    nsCOMPtr&lt;nsIMsgFolder&gt; msgFolder;</span>
<a href="#l3.550"></a><span id="l3.550" class="difflineplus">+    // enumerate over the folders under this root folder till we find one with new mail....</span>
<a href="#l3.551"></a><span id="l3.551" class="difflineplus">+    nsCOMPtr&lt;nsISupportsArray&gt; allFolders;</span>
<a href="#l3.552"></a><span id="l3.552" class="difflineplus">+    NS_NewISupportsArray(getter_AddRefs(allFolders));</span>
<a href="#l3.553"></a><span id="l3.553" class="difflineplus">+    rv = folder-&gt;ListDescendents(allFolders);</span>
<a href="#l3.554"></a><span id="l3.554" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.555"></a><span id="l3.555"> </span>
<a href="#l3.556"></a><span id="l3.556" class="difflineminus">-	 if (oldFolder)</span>
<a href="#l3.557"></a><span id="l3.557" class="difflineminus">-       mFoldersWithNewMail-&gt;ReplaceElementAt(weakFolder, index);</span>
<a href="#l3.558"></a><span id="l3.558" class="difflineminus">-	 else</span>
<a href="#l3.559"></a><span id="l3.559" class="difflineminus">-       mFoldersWithNewMail-&gt;AppendElement(weakFolder);</span>
<a href="#l3.560"></a><span id="l3.560" class="difflineminus">-      // now regenerate the tooltip</span>
<a href="#l3.561"></a><span id="l3.561" class="difflineminus">-      OnAlertFinished(nsnull);  </span>
<a href="#l3.562"></a><span id="l3.562" class="difflineminus">-    }</span>
<a href="#l3.563"></a><span id="l3.563" class="difflineminus">-    else if (aNewValue == nsIMsgFolder::nsMsgBiffState_NoMail)</span>
<a href="#l3.564"></a><span id="l3.564" class="difflineminus">-	{</span>
<a href="#l3.565"></a><span id="l3.565" class="difflineminus">-      // we are always going to remove the icon whenever we get our first no mail</span>
<a href="#l3.566"></a><span id="l3.566" class="difflineminus">-      // notification. </span>
<a href="#l3.567"></a><span id="l3.567" class="difflineminus">-      mFoldersWithNewMail-&gt;Clear(); </span>
<a href="#l3.568"></a><span id="l3.568" class="difflineminus">-      if (mBiffIconVisible) </span>
<a href="#l3.569"></a><span id="l3.569" class="difflineplus">+    nsCOMPtr&lt;nsIEnumerator&gt; enumerator;</span>
<a href="#l3.570"></a><span id="l3.570" class="difflineplus">+    allFolders-&gt;Enumerate(getter_AddRefs(enumerator));</span>
<a href="#l3.571"></a><span id="l3.571" class="difflineplus">+    if (enumerator)</span>
<a href="#l3.572"></a><span id="l3.572" class="difflineplus">+    {</span>
<a href="#l3.573"></a><span id="l3.573" class="difflineplus">+      nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l3.574"></a><span id="l3.574" class="difflineplus">+      nsresult more = enumerator-&gt;First();</span>
<a href="#l3.575"></a><span id="l3.575" class="difflineplus">+      while (NS_SUCCEEDED(more))</span>
<a href="#l3.576"></a><span id="l3.576">       {</span>
<a href="#l3.577"></a><span id="l3.577" class="difflineminus">-        RestoreApplicationDockTileImage();</span>
<a href="#l3.578"></a><span id="l3.578" class="difflineminus">-        mBiffIconVisible = PR_FALSE;</span>
<a href="#l3.579"></a><span id="l3.579" class="difflineminus">-      }</span>
<a href="#l3.580"></a><span id="l3.580" class="difflineminus">-    }</span>
<a href="#l3.581"></a><span id="l3.581" class="difflineminus">-  } // if the biff property changed</span>
<a href="#l3.582"></a><span id="l3.582" class="difflineminus">-  </span>
<a href="#l3.583"></a><span id="l3.583" class="difflineplus">+        rv = enumerator-&gt;CurrentItem(getter_AddRefs(supports));</span>
<a href="#l3.584"></a><span id="l3.584" class="difflineplus">+        if (supports)</span>
<a href="#l3.585"></a><span id="l3.585" class="difflineplus">+        {</span>
<a href="#l3.586"></a><span id="l3.586" class="difflineplus">+          msgFolder = do_QueryInterface(supports, &amp;rv);</span>
<a href="#l3.587"></a><span id="l3.587" class="difflineplus">+          if (msgFolder)</span>
<a href="#l3.588"></a><span id="l3.588" class="difflineplus">+          {</span>
<a href="#l3.589"></a><span id="l3.589" class="difflineplus">+            numNewMessages = 0;</span>
<a href="#l3.590"></a><span id="l3.590" class="difflineplus">+            msgFolder-&gt;GetNumNewMessages(PR_FALSE, &amp;numNewMessages);</span>
<a href="#l3.591"></a><span id="l3.591" class="difflineplus">+            if (numNewMessages)</span>
<a href="#l3.592"></a><span id="l3.592" class="difflineplus">+              break; // kick out of the while loop</span>
<a href="#l3.593"></a><span id="l3.593" class="difflineplus">+            more = enumerator-&gt;Next();</span>
<a href="#l3.594"></a><span id="l3.594" class="difflineplus">+          }</span>
<a href="#l3.595"></a><span id="l3.595" class="difflineplus">+        } // if we have a folder</span>
<a href="#l3.596"></a><span id="l3.596" class="difflineplus">+      }  // if we have more potential folders to enumerate</span>
<a href="#l3.597"></a><span id="l3.597" class="difflineplus">+    }  // if enumerator</span>
<a href="#l3.598"></a><span id="l3.598" class="difflineplus">+</span>
<a href="#l3.599"></a><span id="l3.599" class="difflineplus">+    if (msgFolder)</span>
<a href="#l3.600"></a><span id="l3.600" class="difflineplus">+      msgFolder-&gt;GetURI(aFolderURI);</span>
<a href="#l3.601"></a><span id="l3.601" class="difflineplus">+  }</span>
<a href="#l3.602"></a><span id="l3.602" class="difflineplus">+</span>
<a href="#l3.603"></a><span id="l3.603">   return NS_OK;</span>
<a href="#l3.604"></a><span id="l3.604"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -43,37 +43,48 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #include &quot;nsIMessengerOSIntegration.h&quot;</span>
<a href="#l4.5"></a><span id="l4.5"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l4.6"></a><span id="l4.6"> #include &quot;nsIAtom.h&quot;</span>
<a href="#l4.7"></a><span id="l4.7"> #include &quot;nsITimer.h&quot;</span>
<a href="#l4.8"></a><span id="l4.8"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l4.9"></a><span id="l4.9"> #include &quot;nsString.h&quot;</span>
<a href="#l4.10"></a><span id="l4.10"> #include &quot;nsInt64.h&quot;</span>
<a href="#l4.11"></a><span id="l4.11"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+#include &quot;nsIObserver.h&quot;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+#include &quot;nsIAlertsService.h&quot;</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15"> #define NS_MESSENGEROSXINTEGRATION_CID \</span>
<a href="#l4.16"></a><span id="l4.16">   {0xaa83266, 0x4225, 0x4c4b, \</span>
<a href="#l4.17"></a><span id="l4.17">   {0x93, 0xf8, 0x94, 0xb1, 0x82, 0x58, 0x6f, 0x93}}</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+class nsIStringBundle;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+</span>
<a href="#l4.21"></a><span id="l4.21"> class nsMessengerOSXIntegration : public nsIMessengerOSIntegration,</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-                                  public nsIFolderListener</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+                                  public nsIFolderListener,</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+                                  public nsIObserver</span>
<a href="#l4.25"></a><span id="l4.25"> {</span>
<a href="#l4.26"></a><span id="l4.26"> public:</span>
<a href="#l4.27"></a><span id="l4.27">   nsMessengerOSXIntegration();</span>
<a href="#l4.28"></a><span id="l4.28">   virtual ~nsMessengerOSXIntegration();</span>
<a href="#l4.29"></a><span id="l4.29">   virtual nsresult Init();</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31">   NS_DECL_ISUPPORTS</span>
<a href="#l4.32"></a><span id="l4.32">   NS_DECL_NSIMESSENGEROSINTEGRATION</span>
<a href="#l4.33"></a><span id="l4.33">   NS_DECL_NSIFOLDERLISTENER</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+  NS_DECL_NSIOBSERVER</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36"> private:</span>
<a href="#l4.37"></a><span id="l4.37">   nsCOMPtr&lt;nsISupportsArray&gt; mFoldersWithNewMail;  // keep track of all the root folders with pending new mail</span>
<a href="#l4.38"></a><span id="l4.38">   nsCOMPtr&lt;nsIAtom&gt; mBiffStateAtom;</span>
<a href="#l4.39"></a><span id="l4.39">   PRInt32 CountNewMessages();</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+  nsresult ShowAlertMessage(const nsAString&amp; aAlertTitle, const nsAString&amp; aAlertText, const nsACString&amp; aFolderURI);</span>
<a href="#l4.41"></a><span id="l4.41">   nsresult OnAlertFinished(const PRUnichar * aAlertCookie);</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+  nsresult OnAlertClicked();</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+  nsresult GetStringBundle(nsIStringBundle **aBundle);</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+  void FillToolTipInfo();</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+  nsresult GetFirstFolderWithNewMail(nsACString&amp; aFolderURI);</span>
<a href="#l4.46"></a><span id="l4.46"> </span>
<a href="#l4.47"></a><span id="l4.47">   PRPackedBool mBiffIconVisible;</span>
<a href="#l4.48"></a><span id="l4.48">   PRPackedBool mSuppressBiffIcon;</span>
<a href="#l4.49"></a><span id="l4.49">   PRPackedBool mAlertInProgress;</span>
<a href="#l4.50"></a><span id="l4.50"> };</span>
<a href="#l4.51"></a><span id="l4.51"> </span>
<a href="#l4.52"></a><span id="l4.52"> #endif // __nsMessengerOSXIntegration_h</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/build/Makefile.in</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/build/Makefile.in</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -91,16 +91,20 @@ REQUIRES	= xpcom \</span>
<a href="#l5.4"></a><span id="l5.4"> 		  string \</span>
<a href="#l5.5"></a><span id="l5.5"> 		  txmgr \</span>
<a href="#l5.6"></a><span id="l5.6"> 		  widget \</span>
<a href="#l5.7"></a><span id="l5.7"> 		  webbrwsr \</span>
<a href="#l5.8"></a><span id="l5.8"> 		  uconv \</span>
<a href="#l5.9"></a><span id="l5.9"> 		  uriloader \</span>
<a href="#l5.10"></a><span id="l5.10"> 		  $(NULL)</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+ifeq ($(OS_TARGET),Darwin)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+REQUIRES += alerts</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+endif</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+</span>
<a href="#l5.16"></a><span id="l5.16"> ifdef MOZ_LDAP_XPCOM</span>
<a href="#l5.17"></a><span id="l5.17"> REQUIRES	+= mozldap \</span>
<a href="#l5.18"></a><span id="l5.18">                $(NULL)</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> DEFINES		+= -DMOZ_LDAP_XPCOM</span>
<a href="#l5.21"></a><span id="l5.21"> endif</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23"> CPPSRCS		= nsMailModule.cpp</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -399,16 +399,19 @@ errorOpenMessageForMessageIdMessage=Mess</span>
<a href="#l6.4"></a><span id="l6.4"> confirmPhishingTitle=Email Scam Alert</span>
<a href="#l6.5"></a><span id="l6.5"> #LOCALIZATION NOTE %1$S is the brand name, %2$S is the host name of the url being visited</span>
<a href="#l6.6"></a><span id="l6.6"> confirmPhishingUrl1=%1$S thinks this site is suspicious! It may be trying to impersonate the web page you want to visit. Most legitimate sites use names instead of numbers. Are you sure you want to visit %2$S?</span>
<a href="#l6.7"></a><span id="l6.7"> confirmPhishingUrl2=%1$S thinks this site is suspicious! It may be trying to impersonate the web page you want to visit. Are you sure you want to visit %2$S?</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> #LOCALIZATION NOTE %1$S is the e-mail address of the person we will allow remote content for</span>
<a href="#l6.10"></a><span id="l6.10"> alwaysLoadRemoteContentForSender=Click here to always load remote content from %1$S.</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+# Strings for growl notifications on Mac OS X</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+growlNotification=New Mail</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+</span>
<a href="#l6.15"></a><span id="l6.15"> # mailCommands.js</span>
<a href="#l6.16"></a><span id="l6.16"> emptyJunkTitle=Confirm</span>
<a href="#l6.17"></a><span id="l6.17"> emptyJunkMessage=Are you sure you want to permanently delete all messages and subfolders in the Junk folder?</span>
<a href="#l6.18"></a><span id="l6.18"> emptyJunkDontAsk=Don't ask me again.</span>
<a href="#l6.19"></a><span id="l6.19"> emptyTrashTitle=Confirm</span>
<a href="#l6.20"></a><span id="l6.20"> emptyTrashMessage=Are you sure you want to permanently delete all messages and subfolders in the Trash folder?</span>
<a href="#l6.21"></a><span id="l6.21"> emptyTrashDontAsk=Don't ask me again.</span>
<a href="#l6.22"></a><span id="l6.22"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

