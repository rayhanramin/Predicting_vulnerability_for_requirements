<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26548:71907b0d0630d017619ad5b4809546798686a9c0</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 71907b0d0630d017619ad5b4809546798686a9c0" />
<meta property="og:url" content="/comm-central/rev/71907b0d0630d017619ad5b4809546798686a9c0" />
<meta property="og:description" content="Bug 1515877 - Turn on ESLint in mailnews/jsaccount. r=aceman" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 71907b0d0630d017619ad5b4809546798686a9c0 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/71907b0d0630d017619ad5b4809546798686a9c0">shortlog</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/71907b0d0630d017619ad5b4809546798686a9c0">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0">files</a> |
changeset |
<a href="/comm-central/raw-rev/71907b0d0630d017619ad5b4809546798686a9c0">raw</a>  | <a href="/comm-central/archive/71907b0d0630d017619ad5b4809546798686a9c0.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1515877">Bug 1515877</a> - Turn on ESLint in mailnews/jsaccount. r=aceman
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 08 May 2019 14:43:53 +1200</td></tr>

<tr>
 <td>changeset 26548</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/71907b0d0630d017619ad5b4809546798686a9c0">71907b0d0630d017619ad5b4809546798686a9c0</a></td>
</tr>



<tr>
<td>parent 26547</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/46772686920b9a697f8fb0bfdc399c9015f1d177">46772686920b9a697f8fb0bfdc399c9015f1d177</a>
</td>
</tr>

<tr>
<td>child 26549</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7363a3e2cfb924e01f64b536a1d808c745d2d4d0">7363a3e2cfb924e01f64b536a1d808c745d2d4d0</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=71907b0d0630d017619ad5b4809546798686a9c0">15889</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 08 May 2019 22:55:04 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@8d4257424669 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8d425742466967aa0e90945d2f9d386dabb53fcc">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8d425742466967aa0e90945d2f9d386dabb53fcc&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8d425742466967aa0e90945d2f9d386dabb53fcc&newProject=comm-central&newRevision=83bbcac4d9a6d8b877cc97821c1f3410badf6417&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8d425742466967aa0e90945d2f9d386dabb53fcc&newProject=comm-central&newRevision=83bbcac4d9a6d8b877cc97821c1f3410badf6417&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8d425742466967aa0e90945d2f9d386dabb53fcc&newProject=comm-central&newRevision=83bbcac4d9a6d8b877cc97821c1f3410badf6417&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1515877">1515877</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1515877">Bug 1515877</a> - Turn on ESLint in mailnews/jsaccount. r=aceman</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/.eslintignore">.eslintignore</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/.eslintignore">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/.eslintignore">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/.eslintignore">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/.eslintignore">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/.eslintignore">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JSAccountUtils.jsm">mailnews/jsaccount/modules/JSAccountUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JSAccountUtils.jsm">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JSAccountUtils.jsm">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JSAccountUtils.jsm">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JSAccountUtils.jsm">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JSAccountUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JaBaseUrl.jsm">mailnews/jsaccount/modules/JaBaseUrl.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JaBaseUrl.jsm">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JaBaseUrl.jsm">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JaBaseUrl.jsm">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JaBaseUrl.jsm">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/modules/JaBaseUrl.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/.eslintrc.js">mailnews/jsaccount/test/unit/.eslintrc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/.eslintrc.js">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/.eslintrc.js">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/.eslintrc.js">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/.eslintrc.js">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/.eslintrc.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/head_jsaccount.js">mailnews/jsaccount/test/unit/head_jsaccount.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/head_jsaccount.js">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/head_jsaccount.js">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/head_jsaccount.js">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/head_jsaccount.js">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/head_jsaccount.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServer.jsm">mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServer.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServer.jsm">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServer.jsm">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServer.jsm">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServer.jsm">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServer.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServerComponent.js">mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServerComponent.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServerComponent.js">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServerComponent.js">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServerComponent.js">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServerComponent.js">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServerComponent.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolder.jsm">mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolder.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolder.jsm">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolder.jsm">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolder.jsm">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolder.jsm">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolder.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolderComponent.js">mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolderComponent.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolderComponent.js">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolderComponent.js">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolderComponent.js">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolderComponent.js">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolderComponent.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaMsgProtocolInfoComponent.js">mailnews/jsaccount/test/unit/resources/testJaMsgProtocolInfoComponent.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaMsgProtocolInfoComponent.js">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaMsgProtocolInfoComponent.js">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaMsgProtocolInfoComponent.js">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaMsgProtocolInfoComponent.js">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/resources/testJaMsgProtocolInfoComponent.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_componentsExist.js">mailnews/jsaccount/test/unit/test_componentsExist.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_componentsExist.js">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_componentsExist.js">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_componentsExist.js">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_componentsExist.js">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_componentsExist.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_fooUrl.js">mailnews/jsaccount/test/unit/test_fooUrl.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_fooUrl.js">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_fooUrl.js">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_fooUrl.js">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_fooUrl.js">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_fooUrl.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_jaMsgFolder.js">mailnews/jsaccount/test/unit/test_jaMsgFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_jaMsgFolder.js">file</a> |
<a href="/comm-central/annotate/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_jaMsgFolder.js">annotate</a> |
<a href="/comm-central/diff/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_jaMsgFolder.js">diff</a> |
<a href="/comm-central/comparison/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_jaMsgFolder.js">comparison</a> |
<a href="/comm-central/log/71907b0d0630d017619ad5b4809546798686a9c0/mailnews/jsaccount/test/unit/test_jaMsgFolder.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.eslintignore</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.eslintignore</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -59,17 +59,16 @@ editor/ui/dialogs/content/EdSnapToGrid.j</span>
<a href="#l1.4"></a><span id="l1.4"> editor/ui/dialogs/content/EdSnapToGrid.xul</span>
<a href="#l1.5"></a><span id="l1.5"> editor/ui/texzilla/**</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> # mailnews exclusions</span>
<a href="#l1.8"></a><span id="l1.8"> mailnews/mailnews.js</span>
<a href="#l1.9"></a><span id="l1.9"> mailnews/extensions/dsn/content/dsn.js</span>
<a href="#l1.10"></a><span id="l1.10"> mailnews/extensions/mdn/content/mdn.js</span>
<a href="#l1.11"></a><span id="l1.11"> mailnews/extensions/smime/content/smime.js</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-mailnews/jsaccount/*</span>
<a href="#l1.13"></a><span id="l1.13"> mailnews/mime/*</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15"> # mail exclusions</span>
<a href="#l1.16"></a><span id="l1.16"> mail/app/profile/all-thunderbird.js</span>
<a href="#l1.17"></a><span id="l1.17"> mail/app/profile/channel-prefs.js</span>
<a href="#l1.18"></a><span id="l1.18"> mail/app/profile/prefs.js</span>
<a href="#l1.19"></a><span id="l1.19"> mail/base/content/protovis-r2.6-modded.js</span>
<a href="#l1.20"></a><span id="l1.20"> mail/branding/nightly/thunderbird-branding.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/jsaccount/modules/JSAccountUtils.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/jsaccount/modules/JSAccountUtils.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -30,26 +30,25 @@</span>
<a href="#l2.4"></a><span id="l2.4">  * Examples of use can be found in the test files for jsaccount stuff.</span>
<a href="#l2.5"></a><span id="l2.5">  */</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> const EXPORTED_SYMBOLS = [&quot;JSAccountUtils&quot;];</span>
<a href="#l2.8"></a><span id="l2.8"> var JSAccountUtils = {};</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> const {Log} = ChromeUtils.import(&quot;resource://gre/modules/Log.jsm&quot;);</span>
<a href="#l2.11"></a><span id="l2.11"> const {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l2.13"></a><span id="l2.13"> </span>
<a href="#l2.14"></a><span id="l2.14"> // Logger definitions.</span>
<a href="#l2.15"></a><span id="l2.15"> const LOGGER_NAME = &quot;JsAccount&quot;;</span>
<a href="#l2.16"></a><span id="l2.16"> const PREF_BRANCH_LOG = &quot;mailnews.jsaccount.log.&quot;;</span>
<a href="#l2.17"></a><span id="l2.17"> const PREF_LOG_LEVEL = PREF_BRANCH_LOG + &quot;level&quot;;</span>
<a href="#l2.18"></a><span id="l2.18"> const PREF_LOG_DUMP = PREF_BRANCH_LOG + &quot;dump&quot;;</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> // Set default logging levels.</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-const LOG_LEVEL_DEFAULT = &quot;Info&quot;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+const LOG_LEVEL_DEFAULT = &quot;Info&quot;;</span>
<a href="#l2.23"></a><span id="l2.23"> const LOG_DUMP_DEFAULT = true;</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25"> // Logging usage: set mailnews.jsaccount.log.level to the word &quot;Debug&quot; to</span>
<a href="#l2.26"></a><span id="l2.26"> // increase logging level.</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28"> var log = configureLogging();</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30"> /**</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineat">@@ -76,24 +75,22 @@ var log = configureLogging();</span>
<a href="#l2.32"></a><span id="l2.32">  *                       created by the factory, where CID is a string uuid.</span>
<a href="#l2.33"></a><span id="l2.33">  *      }</span>
<a href="#l2.34"></a><span id="l2.34">  *</span>
<a href="#l2.35"></a><span id="l2.35">  *   @param aJsDelegateConstructor: a JS constructor class, called using new,</span>
<a href="#l2.36"></a><span id="l2.36">  *                                  that will create the JS object to which</span>
<a href="#l2.37"></a><span id="l2.37">  *                                  XPCOM methods calls will be delegated.</span>
<a href="#l2.38"></a><span id="l2.38">  */</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-JSAccountUtils.jaFactory = function (aProperties, aJsDelegateConstructor)</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-{</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+JSAccountUtils.jaFactory = function(aProperties, aJsDelegateConstructor) {</span>
<a href="#l2.43"></a><span id="l2.43">   let factory = {};</span>
<a href="#l2.44"></a><span id="l2.44">   factory.QueryInterface = ChromeUtils.generateQI([Ci.nsIFactory]);</span>
<a href="#l2.45"></a><span id="l2.45">   factory.lockFactory = function() {};</span>
<a href="#l2.46"></a><span id="l2.46"> </span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-  factory.createInstance = function(outer, iid)</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-  {</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+  factory.createInstance = function(outer, iid) {</span>
<a href="#l2.50"></a><span id="l2.50">     if (outer != null)</span>
<a href="#l2.51"></a><span id="l2.51">       throw Cr.NS_ERROR_NO_AGGREGATION;</span>
<a href="#l2.52"></a><span id="l2.52"> </span>
<a href="#l2.53"></a><span id="l2.53">     // C++ delegator class.</span>
<a href="#l2.54"></a><span id="l2.54">     let delegator = Cc[aProperties.baseContractID]</span>
<a href="#l2.55"></a><span id="l2.55">                       .createInstance(Ci.msgIOverride);</span>
<a href="#l2.56"></a><span id="l2.56"> </span>
<a href="#l2.57"></a><span id="l2.57">     // Make sure the delegator JS wrapper knows its interfaces.</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineat">@@ -111,24 +108,23 @@ JSAccountUtils.jaFactory = function (aPr</span>
<a href="#l2.59"></a><span id="l2.59">       delegateList = Object.getPrototypeOf(jsDelegate).delegateList;</span>
<a href="#l2.60"></a><span id="l2.60">     }</span>
<a href="#l2.61"></a><span id="l2.61">     if (delegateList instanceof Ci.msgIDelegateList) {</span>
<a href="#l2.62"></a><span id="l2.62">       delegator.methodsToDelegate = delegateList;</span>
<a href="#l2.63"></a><span id="l2.63">     } else {</span>
<a href="#l2.64"></a><span id="l2.64">       // Lazily create and populate the list of methods to delegate.</span>
<a href="#l2.65"></a><span id="l2.65">       log.info(&quot;creating delegate list for contractID &quot; + aProperties.contractID);</span>
<a href="#l2.66"></a><span id="l2.66">       let delegateList = delegator.methodsToDelegate;</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-      Object.keys(delegator).forEach(name =&gt; {log.debug(&quot;delegator has key &quot; + name);});</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+      Object.keys(delegator).forEach(name =&gt; { log.debug(&quot;delegator has key &quot; + name); });</span>
<a href="#l2.69"></a><span id="l2.69"> </span>
<a href="#l2.70"></a><span id="l2.70">       // jsMethods contains the methods that may be targets of the C++ delegation to JS.</span>
<a href="#l2.71"></a><span id="l2.71">       let jsMethods = Object.getPrototypeOf(jsDelegate);</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-      for (let name in jsMethods)</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-      {</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+      for (let name in jsMethods) {</span>
<a href="#l2.75"></a><span id="l2.75">         log.debug(&quot;processing jsDelegate method: &quot; + name);</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-        if (name[0] == '_') { // don't bother with methods explicitly marked as internal.</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+        if (name[0] == &quot;_&quot;) { // don't bother with methods explicitly marked as internal.</span>
<a href="#l2.78"></a><span id="l2.78">           log.debug(&quot;skipping &quot; + name);</span>
<a href="#l2.79"></a><span id="l2.79">           continue;</span>
<a href="#l2.80"></a><span id="l2.80">         }</span>
<a href="#l2.81"></a><span id="l2.81">         // Other methods to skip.</span>
<a href="#l2.82"></a><span id="l2.82">         if ([&quot;QueryInterface&quot;,  // nsISupports</span>
<a href="#l2.83"></a><span id="l2.83">              &quot;methodsToDelegate&quot;, &quot;jsDelegate&quot;, &quot;cppBase&quot;, // msgIOverride</span>
<a href="#l2.84"></a><span id="l2.84">              &quot;delegateList&quot;, &quot;wrappedJSObject&quot;, // non-XPCOM methods to skip</span>
<a href="#l2.85"></a><span id="l2.85">             ].includes(name)) {</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineat">@@ -144,21 +140,20 @@ JSAccountUtils.jaFactory = function (aPr</span>
<a href="#l2.87"></a><span id="l2.87">         let cppDescriptor = Object.getOwnPropertyDescriptor(delegator, name);</span>
<a href="#l2.88"></a><span id="l2.88">         if (!cppDescriptor) {</span>
<a href="#l2.89"></a><span id="l2.89">           log.debug(&quot;no cppDescriptor found for &quot; + name);</span>
<a href="#l2.90"></a><span id="l2.90">           // It is OK for jsMethods to have methods that are not used in override of C++.</span>
<a href="#l2.91"></a><span id="l2.91">           continue;</span>
<a href="#l2.92"></a><span id="l2.92">         }</span>
<a href="#l2.93"></a><span id="l2.93"> </span>
<a href="#l2.94"></a><span id="l2.94">         let upperCaseName = name[0].toUpperCase() + name.substr(1);</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineminus">-        if ('value' in jsDescriptor) {</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+        if (&quot;value&quot; in jsDescriptor) {</span>
<a href="#l2.97"></a><span id="l2.97">           log.info(&quot;delegating &quot; + upperCaseName);</span>
<a href="#l2.98"></a><span id="l2.98">           delegateList.add(upperCaseName);</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineminus">-        }</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineminus">-        else {</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+        } else {</span>
<a href="#l2.102"></a><span id="l2.102">           if (jsDescriptor.set) {</span>
<a href="#l2.103"></a><span id="l2.103">             log.info(&quot;delegating Set&quot; + upperCaseName);</span>
<a href="#l2.104"></a><span id="l2.104">             delegateList.add(&quot;Set&quot; + upperCaseName);</span>
<a href="#l2.105"></a><span id="l2.105">           }</span>
<a href="#l2.106"></a><span id="l2.106">           if (jsDescriptor.get) {</span>
<a href="#l2.107"></a><span id="l2.107">             log.info(&quot;delegating Get&quot; + upperCaseName);</span>
<a href="#l2.108"></a><span id="l2.108">             delegateList.add(&quot;Get&quot; + upperCaseName);</span>
<a href="#l2.109"></a><span id="l2.109">           }</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineat">@@ -173,30 +168,29 @@ JSAccountUtils.jaFactory = function (aPr</span>
<a href="#l2.111"></a><span id="l2.111">       if (iid.equals(iface)) {</span>
<a href="#l2.112"></a><span id="l2.112">         log.debug(&quot;Successfully returning delegator &quot; + delegator);</span>
<a href="#l2.113"></a><span id="l2.113">         return delegator;</span>
<a href="#l2.114"></a><span id="l2.114">       }</span>
<a href="#l2.115"></a><span id="l2.115">     throw Cr.NS_ERROR_NO_INTERFACE;</span>
<a href="#l2.116"></a><span id="l2.116">   };</span>
<a href="#l2.117"></a><span id="l2.117"> </span>
<a href="#l2.118"></a><span id="l2.118">   return factory;</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineminus">-}</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineplus">+};</span>
<a href="#l2.121"></a><span id="l2.121"> </span>
<a href="#l2.122"></a><span id="l2.122"> /**</span>
<a href="#l2.123"></a><span id="l2.123">  * Create a JS object that contains calls to each of the methods in a CPP</span>
<a href="#l2.124"></a><span id="l2.124">  * base class, that will reference the cpp object defined on a particular</span>
<a href="#l2.125"></a><span id="l2.125">  * instance of the object. This is intended to be the last item in the</span>
<a href="#l2.126"></a><span id="l2.126">  * prototype chain for a JsAccount implementation.</span>
<a href="#l2.127"></a><span id="l2.127">  *</span>
<a href="#l2.128"></a><span id="l2.128">  * @param aProperties see definition in jsFactory above</span>
<a href="#l2.129"></a><span id="l2.129">  *</span>
<a href="#l2.130"></a><span id="l2.130">  * @returns a JS object suitable as the prototype of a JsAccount implementation.</span>
<a href="#l2.131"></a><span id="l2.131">  */</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineminus">-JSAccountUtils.makeCppDelegator = function(aProperties)</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineminus">-{</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+JSAccountUtils.makeCppDelegator = function(aProperties) {</span>
<a href="#l2.135"></a><span id="l2.135">   log.info(&quot;Making cppDelegator for contractID &quot; + aProperties.contractID);</span>
<a href="#l2.136"></a><span id="l2.136">   let cppDelegator = {};</span>
<a href="#l2.137"></a><span id="l2.137">   let cppDummy = Cc[aProperties.baseContractID].createInstance(Ci.nsISupports);</span>
<a href="#l2.138"></a><span id="l2.138">   // Add methods from all interfaces.</span>
<a href="#l2.139"></a><span id="l2.139">   for (let iface of aProperties.baseInterfaces)</span>
<a href="#l2.140"></a><span id="l2.140">     cppDummy instanceof Ci[iface];</span>
<a href="#l2.141"></a><span id="l2.141"> </span>
<a href="#l2.142"></a><span id="l2.142">   for (let method in cppDummy) {</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineat">@@ -205,17 +199,17 @@ JSAccountUtils.makeCppDelegator = functi</span>
<a href="#l2.144"></a><span id="l2.144">       log.config(&quot;Skipping &quot; + method + &quot;\n&quot;);</span>
<a href="#l2.145"></a><span id="l2.145">       continue;</span>
<a href="#l2.146"></a><span id="l2.146">     }</span>
<a href="#l2.147"></a><span id="l2.147">     log.config(&quot;processing &quot; + method + &quot;\n&quot;);</span>
<a href="#l2.148"></a><span id="l2.148">     let descriptor = Object.getOwnPropertyDescriptor(cppDummy, method);</span>
<a href="#l2.149"></a><span id="l2.149">     let property = { enumerable: true };</span>
<a href="#l2.150"></a><span id="l2.150">     // We must use Immediately Invoked Function Expressions to pass method, otherwise it is</span>
<a href="#l2.151"></a><span id="l2.151">     // a closure containing just the last value it was set to.</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineminus">-    if ('value' in descriptor) {</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineplus">+    if (&quot;value&quot; in descriptor) {</span>
<a href="#l2.154"></a><span id="l2.154">       log.debug(&quot;Adding value for &quot; + method);</span>
<a href="#l2.155"></a><span id="l2.155">       property.value = function(aMethod) {</span>
<a href="#l2.156"></a><span id="l2.156">         return function(...args) {</span>
<a href="#l2.157"></a><span id="l2.157">           return Reflect.apply(this.cppBase[aMethod], undefined, args);</span>
<a href="#l2.158"></a><span id="l2.158">         };</span>
<a href="#l2.159"></a><span id="l2.159">       }(method);</span>
<a href="#l2.160"></a><span id="l2.160">     }</span>
<a href="#l2.161"></a><span id="l2.161">     if (descriptor.set) {</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineat">@@ -232,40 +226,38 @@ JSAccountUtils.makeCppDelegator = functi</span>
<a href="#l2.163"></a><span id="l2.163">         return function() {</span>
<a href="#l2.164"></a><span id="l2.164">           return this.cppBase[aMethod];</span>
<a href="#l2.165"></a><span id="l2.165">         };</span>
<a href="#l2.166"></a><span id="l2.166">       }(method);</span>
<a href="#l2.167"></a><span id="l2.167">     }</span>
<a href="#l2.168"></a><span id="l2.168">     Object.defineProperty(cppDelegator, method, property);</span>
<a href="#l2.169"></a><span id="l2.169">   }</span>
<a href="#l2.170"></a><span id="l2.170">   return cppDelegator;</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineminus">-}</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineplus">+};</span>
<a href="#l2.173"></a><span id="l2.173"> </span>
<a href="#l2.174"></a><span id="l2.174"> // Utility functions.</span>
<a href="#l2.175"></a><span id="l2.175"> </span>
<a href="#l2.176"></a><span id="l2.176"> // Iterate over an object and its prototypes to get a property descriptor.</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineminus">-function getPropertyDescriptor(obj, name)</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineminus">-{</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineplus">+function getPropertyDescriptor(obj, name) {</span>
<a href="#l2.180"></a><span id="l2.180">   let descriptor = null;</span>
<a href="#l2.181"></a><span id="l2.181"> </span>
<a href="#l2.182"></a><span id="l2.182">   // Eventually we will hit an object that will delegate JS calls to a CPP</span>
<a href="#l2.183"></a><span id="l2.183">   // object, which are not JS overrides of CPP methods. Locate this item, and</span>
<a href="#l2.184"></a><span id="l2.184">   // skip, because it will not have _JsPrototypeToDelegate defined.</span>
<a href="#l2.185"></a><span id="l2.185">   while (obj &amp;&amp; (&quot;_JsPrototypeToDelegate&quot; in obj)) {</span>
<a href="#l2.186"></a><span id="l2.186">     descriptor = Object.getOwnPropertyDescriptor(obj, name);</span>
<a href="#l2.187"></a><span id="l2.187">     if (descriptor)</span>
<a href="#l2.188"></a><span id="l2.188">       break;</span>
<a href="#l2.189"></a><span id="l2.189">     obj = Object.getPrototypeOf(obj);</span>
<a href="#l2.190"></a><span id="l2.190">   }</span>
<a href="#l2.191"></a><span id="l2.191">   return descriptor;</span>
<a href="#l2.192"></a><span id="l2.192"> }</span>
<a href="#l2.193"></a><span id="l2.193"> </span>
<a href="#l2.194"></a><span id="l2.194"> // Configure the logger based on the preferences.</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineminus">-function configureLogging()</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineminus">-{</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineplus">+function configureLogging() {</span>
<a href="#l2.198"></a><span id="l2.198">   let log = Log.repository.getLogger(LOGGER_NAME);</span>
<a href="#l2.199"></a><span id="l2.199"> </span>
<a href="#l2.200"></a><span id="l2.200">   // Log messages need to go to the browser console.</span>
<a href="#l2.201"></a><span id="l2.201">   let consoleAppender = new Log.ConsoleAppender(new Log.BasicFormatter());</span>
<a href="#l2.202"></a><span id="l2.202">   log.addAppender(consoleAppender);</span>
<a href="#l2.203"></a><span id="l2.203"> </span>
<a href="#l2.204"></a><span id="l2.204">   // Make sure the logger keeps up with the logging level preference.</span>
<a href="#l2.205"></a><span id="l2.205">   log.level = Log.Level[Services.prefs.getStringPref(PREF_LOG_LEVEL, LOG_LEVEL_DEFAULT)];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/jsaccount/modules/JaBaseUrl.jsm</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/jsaccount/modules/JaBaseUrl.jsm</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,17 +1,16 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* -*- indent-tabs-mode: nil; js-indent-level: 2 -*- */</span>
<a href="#l3.5"></a><span id="l3.5"> /* vim: set ts=2 et sw=2 tw=80 filetype=javascript: */</span>
<a href="#l3.6"></a><span id="l3.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.7"></a><span id="l3.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.8"></a><span id="l3.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10"> const EXPORTED_SYMBOLS = [&quot;JaBaseUrlProperties&quot;, &quot;JaBaseUrl&quot;];</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l3.13"></a><span id="l3.13"> const {JSAccountUtils} = ChromeUtils.import(&quot;resource:///modules/jsaccount/JSAccountUtils.jsm&quot;);</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> // A partial JavaScript implementation of the base server methods.</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> const JaBaseUrlProperties = {</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">   // The CPP object that delgates to CPP or JS.</span>
<a href="#l3.20"></a><span id="l3.20">   baseContractID:     &quot;@mozilla.org/jacppurldelegator;1&quot;,</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -36,33 +35,31 @@ const JaBaseUrlProperties = {</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23">   // We don't typically define this as a creatable component, but if we do use</span>
<a href="#l3.24"></a><span id="l3.24">   // these. Subclasses for particular account types require these defined for</span>
<a href="#l3.25"></a><span id="l3.25">   // that type.</span>
<a href="#l3.26"></a><span id="l3.26">   contractID:         &quot;@mozilla.org/jsaccount/jaurl;1&quot;,</span>
<a href="#l3.27"></a><span id="l3.27">   classID:            Components.ID(&quot;{1E7B42CA-E6D9-408F-A4E4-8D2F82AECBBD}&quot;),</span>
<a href="#l3.28"></a><span id="l3.28"> };</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+// Typical boilerplate to include in all implementations.</span>
<a href="#l3.31"></a><span id="l3.31"> function JaBaseUrl(aDelegator, aBaseInterfaces) {</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-// Typical boilerplate to include in all implementations.</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-</span>
<a href="#l3.35"></a><span id="l3.35">   // Object delegating method calls to the appropriate XPCOM object.</span>
<a href="#l3.36"></a><span id="l3.36">   // Weak because it owns us.</span>
<a href="#l3.37"></a><span id="l3.37">   this._delegatorWeak = Cu.getWeakReference(aDelegator);</span>
<a href="#l3.38"></a><span id="l3.38"> </span>
<a href="#l3.39"></a><span id="l3.39">   // Base implementation of methods with no overrides.</span>
<a href="#l3.40"></a><span id="l3.40">   this.cppBase = aDelegator.cppBase;</span>
<a href="#l3.41"></a><span id="l3.41"> </span>
<a href="#l3.42"></a><span id="l3.42">   // cppBase class sees all interfaces</span>
<a href="#l3.43"></a><span id="l3.43">   aBaseInterfaces.forEach(iface =&gt; this.cppBase instanceof iface);</span>
<a href="#l3.44"></a><span id="l3.44"> }</span>
<a href="#l3.45"></a><span id="l3.45"> </span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+// Typical boilerplate to include in all implementations.</span>
<a href="#l3.47"></a><span id="l3.47"> JaBaseUrl.prototype = {</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-// Typical boilerplate to include in all implementations.</span>
<a href="#l3.49"></a><span id="l3.49">   __proto__: JSAccountUtils.makeCppDelegator(JaBaseUrlProperties),</span>
<a href="#l3.50"></a><span id="l3.50"> </span>
<a href="#l3.51"></a><span id="l3.51">   // Flag this item as CPP needs to delegate to JS.</span>
<a href="#l3.52"></a><span id="l3.52">   _JsPrototypeToDelegate: true,</span>
<a href="#l3.53"></a><span id="l3.53"> </span>
<a href="#l3.54"></a><span id="l3.54">   // QI to the interfaces.</span>
<a href="#l3.55"></a><span id="l3.55">   QueryInterface: ChromeUtils.generateQI(JaBaseUrlProperties.baseInterfacesQI),</span>
<a href="#l3.56"></a><span id="l3.56"> </span>
<a href="#l3.57"></a><span id="l3.57" class="difflineat">@@ -75,10 +72,9 @@ JaBaseUrl.prototype = {</span>
<a href="#l3.58"></a><span id="l3.58">   get delegator() {</span>
<a href="#l3.59"></a><span id="l3.59">     return this._delegatorWeak.get();</span>
<a href="#l3.60"></a><span id="l3.60">   },</span>
<a href="#l3.61"></a><span id="l3.61"> </span>
<a href="#l3.62"></a><span id="l3.62">   // Dynamically-generated list of delegate methods.</span>
<a href="#l3.63"></a><span id="l3.63">   delegateList: null,</span>
<a href="#l3.64"></a><span id="l3.64"> </span>
<a href="#l3.65"></a><span id="l3.65">   // Implementation in JS  (if any) of methods in XPCOM interfaces.</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-</span>
<a href="#l3.67"></a><span id="l3.67"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">new file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- /dev/null</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/.eslintrc.js</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -0,0 +1,14 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineplus">+</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineplus">+module.exports = {</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineplus">+  &quot;extends&quot;: &quot;plugin:mozilla/xpcshell-test&quot;,</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+  &quot;rules&quot;: {</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+    &quot;func-names&quot;: &quot;off&quot;,</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+    &quot;mozilla/import-headjs-globals&quot;: &quot;error&quot;,</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    &quot;no-unused-vars&quot;: [&quot;error&quot;, {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+      &quot;args&quot;: &quot;none&quot;,</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+      &quot;vars&quot;: &quot;all&quot;,</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+    }],</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+  },</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/jsaccount/test/unit/head_jsaccount.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/head_jsaccount.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -7,15 +7,15 @@ var CC = Components.Constructor;</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l5.6"></a><span id="l5.6"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l5.7"></a><span id="l5.7"> var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l5.8"></a><span id="l5.8"> var {mailTestUtils} = ChromeUtils.import(&quot;resource://testing-common/mailnews/mailTestUtils.js&quot;);</span>
<a href="#l5.9"></a><span id="l5.9"> var {localAccountUtils} = ChromeUtils.import(&quot;resource://testing-common/mailnews/localAccountUtils.js&quot;);</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> // Load the test components.</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-do_load_manifest(&quot;resources/testComponents.manifest&quot;)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+do_load_manifest(&quot;resources/testComponents.manifest&quot;);</span>
<a href="#l5.14"></a><span id="l5.14"> // Ensure the profile directory is set up.</span>
<a href="#l5.15"></a><span id="l5.15"> do_get_profile();</span>
<a href="#l5.16"></a><span id="l5.16"> </span>
<a href="#l5.17"></a><span id="l5.17"> registerCleanupFunction(function() {</span>
<a href="#l5.18"></a><span id="l5.18">   load(&quot;../../../../mailnews/resources/mailShutdown.js&quot;);</span>
<a href="#l5.19"></a><span id="l5.19"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServer.jsm</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServer.jsm</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -6,19 +6,16 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /**</span>
<a href="#l6.5"></a><span id="l6.5">   This file creates a JS-based override of the JaIncomingServer implementation. It</span>
<a href="#l6.6"></a><span id="l6.6">   demos a minimal JS class, and is also used in testing the additional methods</span>
<a href="#l6.7"></a><span id="l6.7">   added to JaIncomingServer.cpp that are not in nsMsgDBFolder.cpp</span>
<a href="#l6.8"></a><span id="l6.8">  */</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10"> const EXPORTED_SYMBOLS = [&quot;JaBaseIncomingServerProperties&quot;, &quot;JaBaseIncomingServer&quot;];</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-var {JSAccountUtils} = ChromeUtils.import(&quot;resource:///modules/jsaccount/JSAccountUtils.jsm&quot;);</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-</span>
<a href="#l6.15"></a><span id="l6.15"> // A partial JavaScript implementation of the base server methods.</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17"> const JaBaseIncomingServerProperties = {</span>
<a href="#l6.18"></a><span id="l6.18">   baseContractID:     &quot;@mozilla.org/jacppincomingserverdelegator;1&quot;,</span>
<a href="#l6.19"></a><span id="l6.19">   baseInterfaces:     [ Ci.nsISupports,</span>
<a href="#l6.20"></a><span id="l6.20">                         Ci.nsIMsgIncomingServer,</span>
<a href="#l6.21"></a><span id="l6.21">                         Ci.nsIInterfaceRequestor,</span>
<a href="#l6.22"></a><span id="l6.22">                         Ci.msgIOverride,</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineat">@@ -57,12 +54,11 @@ JaBaseIncomingServer.prototype = {</span>
<a href="#l6.24"></a><span id="l6.24">   get wrappedJSObject() {</span>
<a href="#l6.25"></a><span id="l6.25">     return this;</span>
<a href="#l6.26"></a><span id="l6.26">   },</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28">   // Dynamically-generated list of delegate methods.</span>
<a href="#l6.29"></a><span id="l6.29">   delegateList: null,</span>
<a href="#l6.30"></a><span id="l6.30"> </span>
<a href="#l6.31"></a><span id="l6.31">   // nsIMsgIncomingServer overrides.</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-  get localStoreType() { return &quot;testja&quot;},</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-  get localDatabaseType() { return &quot;mailbox&quot;},</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+  get localStoreType() { return &quot;testja&quot;; },</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+  get localDatabaseType() { return &quot;mailbox&quot;; },</span>
<a href="#l6.37"></a><span id="l6.37"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServerComponent.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/resources/testJaBaseIncomingServerComponent.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -18,11 +18,11 @@ dump(&quot;\n\ntestJaBaseIncomingServerCompon</span>
<a href="#l7.4"></a><span id="l7.4"> function JaBaseIncomingServerConstructor() {</span>
<a href="#l7.5"></a><span id="l7.5">   dump(&quot;JaBaseIncomingServerConstructor\n&quot;);</span>
<a href="#l7.6"></a><span id="l7.6"> }</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> // Constructor prototype (not instance prototype).</span>
<a href="#l7.9"></a><span id="l7.9"> JaBaseIncomingServerConstructor.prototype = {</span>
<a href="#l7.10"></a><span id="l7.10">   classID: JaBaseIncomingServerProperties.classID,</span>
<a href="#l7.11"></a><span id="l7.11">   _xpcom_factory: JSAccountUtils.jaFactory(JaBaseIncomingServerProperties, JaBaseIncomingServer),</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-}</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+};</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-var NSGetFactory = XPCOMUtils.generateNSGetFactory([JaBaseIncomingServerConstructor]);</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+this.NSGetFactory = XPCOMUtils.generateNSGetFactory([JaBaseIncomingServerConstructor]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolder.jsm</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolder.jsm</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -6,19 +6,16 @@</span>
<a href="#l8.4"></a><span id="l8.4"> /**</span>
<a href="#l8.5"></a><span id="l8.5">   This file creates a JS-based override of the JaMsgFolder implementation. It</span>
<a href="#l8.6"></a><span id="l8.6">   demos a minimal JS class, and is also used in testing the additional methods</span>
<a href="#l8.7"></a><span id="l8.7">   added to JaMsgFolder.cpp that are not in nsMsgDBFolder.cpp</span>
<a href="#l8.8"></a><span id="l8.8">  */</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10"> const EXPORTED_SYMBOLS = [&quot;JaBaseMsgFolderProperties&quot;, &quot;JaBaseMsgFolder&quot;];</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-var {JSAccountUtils} = ChromeUtils.import(&quot;resource:///modules/jsaccount/JSAccountUtils.jsm&quot;);</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-</span>
<a href="#l8.15"></a><span id="l8.15"> // A partial JavaScript implementation of the base server methods.</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17"> const JaBaseMsgFolderProperties = {</span>
<a href="#l8.18"></a><span id="l8.18">   baseContractID:     &quot;@mozilla.org/jacppmsgfolderdelegator;1&quot;,</span>
<a href="#l8.19"></a><span id="l8.19">   baseInterfaces:     [ Ci.nsISupports,</span>
<a href="#l8.20"></a><span id="l8.20">                         Ci.nsIMsgFolder,</span>
<a href="#l8.21"></a><span id="l8.21">                         Ci.nsIDBChangeListener,</span>
<a href="#l8.22"></a><span id="l8.22">                         Ci.nsIUrlListener,</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineat">@@ -60,11 +57,10 @@ JaBaseMsgFolder.prototype = {</span>
<a href="#l8.24"></a><span id="l8.24">   get wrappedJSObject() {</span>
<a href="#l8.25"></a><span id="l8.25">     return this;</span>
<a href="#l8.26"></a><span id="l8.26">   },</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28">   // Dynamically-generated list of delegate methods.</span>
<a href="#l8.29"></a><span id="l8.29">   delegateList: null,</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31">   // nsIMsgFolder overrides.</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-  get incomingServerType() { return &quot;testja&quot;;},</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+  get incomingServerType() { return &quot;testja&quot;; },</span>
<a href="#l8.35"></a><span id="l8.35"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolderComponent.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/resources/testJaBaseMsgFolderComponent.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -4,27 +4,23 @@</span>
<a href="#l9.4"></a><span id="l9.4">    http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6"> // This file is the component definition for a demo base implementation of a</span>
<a href="#l9.7"></a><span id="l9.7"> // javascript msgFolder.</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l9.10"></a><span id="l9.10"> const {JSAccountUtils} = ChromeUtils.import(&quot;resource:///modules/jsaccount/JSAccountUtils.jsm&quot;);</span>
<a href="#l9.11"></a><span id="l9.11"> var {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  JaBaseIncomingServerProperties,</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-  JaBaseIncomingServer,</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-} = ChromeUtils.import(&quot;resource://testing-common/mailnews/testJaBaseIncomingServer.jsm&quot;);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-var {</span>
<a href="#l9.16"></a><span id="l9.16">   JaBaseMsgFolderProperties,</span>
<a href="#l9.17"></a><span id="l9.17">   JaBaseMsgFolder,</span>
<a href="#l9.18"></a><span id="l9.18"> } = ChromeUtils.import(&quot;resource://testing-common/mailnews/testJaBaseMsgFolder.jsm&quot;);</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20"> // Constructor</span>
<a href="#l9.21"></a><span id="l9.21"> function JaBaseMsgFolderConstructor() {</span>
<a href="#l9.22"></a><span id="l9.22"> }</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24"> // Constructor prototype (not instance prototype).</span>
<a href="#l9.25"></a><span id="l9.25"> JaBaseMsgFolderConstructor.prototype = {</span>
<a href="#l9.26"></a><span id="l9.26">   classID: JaBaseMsgFolderProperties.classID,</span>
<a href="#l9.27"></a><span id="l9.27">   _xpcom_factory: JSAccountUtils.jaFactory(JaBaseMsgFolderProperties, JaBaseMsgFolder),</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-}</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+};</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-var NSGetFactory = XPCOMUtils.generateNSGetFactory([JaBaseMsgFolderConstructor]);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+this.NSGetFactory = XPCOMUtils.generateNSGetFactory([JaBaseMsgFolderConstructor]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -2,51 +2,48 @@</span>
<a href="#l10.4"></a><span id="l10.4">    http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6"> /**</span>
<a href="#l10.7"></a><span id="l10.7">   One of the goals of JsAccount is to be able to incrementally extend a base</span>
<a href="#l10.8"></a><span id="l10.8">   implementation, possibly adding a new interface. This code demonstrates</span>
<a href="#l10.9"></a><span id="l10.9">   a mailnews URL extended for a hypthetical account type &quot;foo&quot;.</span>
<a href="#l10.10"></a><span id="l10.10"> **/</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-var CE = Components.Exception;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-</span>
<a href="#l10.14"></a><span id="l10.14"> var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l10.15"></a><span id="l10.15"> const {JSAccountUtils} = ChromeUtils.import(&quot;resource:///modules/jsaccount/JSAccountUtils.jsm&quot;);</span>
<a href="#l10.16"></a><span id="l10.16"> const {</span>
<a href="#l10.17"></a><span id="l10.17">   JaBaseUrl,</span>
<a href="#l10.18"></a><span id="l10.18">   JaBaseUrlProperties,</span>
<a href="#l10.19"></a><span id="l10.19"> } = ChromeUtils.import(&quot;resource:///modules/jsaccount/JaBaseUrl.jsm&quot;);</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21"> const ATTACHMENT_QUERY = &quot;part=1.&quot;;</span>
<a href="#l10.22"></a><span id="l10.22"> </span>
<a href="#l10.23"></a><span id="l10.23"> var FooUrlProperties = {</span>
<a href="#l10.24"></a><span id="l10.24">   // Extend the base properties.</span>
<a href="#l10.25"></a><span id="l10.25">   __proto__: JaBaseUrlProperties,</span>
<a href="#l10.26"></a><span id="l10.26"> </span>
<a href="#l10.27"></a><span id="l10.27">   contractID: &quot;@mozilla.org/jsaccount/testjafoourl;1&quot;,</span>
<a href="#l10.28"></a><span id="l10.28">   classID: Components.ID(&quot;{73F98539-A59F-4F6F-9A72-D83A08646C23}&quot;),</span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-// Add an additional interface only needed by this custom class.</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+  // Add an additional interface only needed by this custom class.</span>
<a href="#l10.32"></a><span id="l10.32">   extraInterfaces: [ Ci.msgIFooUrl ],</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-}</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+};</span>
<a href="#l10.35"></a><span id="l10.35"> </span>
<a href="#l10.36"></a><span id="l10.36"> // Constructor</span>
<a href="#l10.37"></a><span id="l10.37"> function FooUrlConstructor() {</span>
<a href="#l10.38"></a><span id="l10.38"> }</span>
<a href="#l10.39"></a><span id="l10.39"> </span>
<a href="#l10.40"></a><span id="l10.40"> // Constructor prototype (not instance prototype).</span>
<a href="#l10.41"></a><span id="l10.41"> FooUrlConstructor.prototype = {</span>
<a href="#l10.42"></a><span id="l10.42">   classID: FooUrlProperties.classID,</span>
<a href="#l10.43"></a><span id="l10.43">   _xpcom_factory: JSAccountUtils.jaFactory(FooUrlProperties, FooUrl),</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-}</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+};</span>
<a href="#l10.46"></a><span id="l10.46"> </span>
<a href="#l10.47"></a><span id="l10.47"> // Main class.</span>
<a href="#l10.48"></a><span id="l10.48"> function FooUrl(aDelegator, aBaseInterfaces) {</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-</span>
<a href="#l10.50"></a><span id="l10.50">   // Superclass constructor</span>
<a href="#l10.51"></a><span id="l10.51">   JaBaseUrl.call(this, aDelegator, aBaseInterfaces);</span>
<a href="#l10.52"></a><span id="l10.52"> </span>
<a href="#l10.53"></a><span id="l10.53">   // I'm not sure why I have to call this again, as it is called in the</span>
<a href="#l10.54"></a><span id="l10.54">   // base constructor, but without it this method will not find the</span>
<a href="#l10.55"></a><span id="l10.55">   // interfaces beyond nsISupports.</span>
<a href="#l10.56"></a><span id="l10.56">   aBaseInterfaces.forEach(iface =&gt; this.cppBase instanceof iface);</span>
<a href="#l10.57"></a><span id="l10.57"> </span>
<a href="#l10.58"></a><span id="l10.58" class="difflineat">@@ -54,43 +51,43 @@ function FooUrl(aDelegator, aBaseInterfa</span>
<a href="#l10.59"></a><span id="l10.59">   this._urlType = -1; // unknown;</span>
<a href="#l10.60"></a><span id="l10.60">   this._itemId = null;</span>
<a href="#l10.61"></a><span id="l10.61">   this._hidden = &quot;IAmHidden&quot;;</span>
<a href="#l10.62"></a><span id="l10.62"> }</span>
<a href="#l10.63"></a><span id="l10.63"> </span>
<a href="#l10.64"></a><span id="l10.64"> // Extend the base class methods.</span>
<a href="#l10.65"></a><span id="l10.65"> FooUrl.prototype = {</span>
<a href="#l10.66"></a><span id="l10.66"> </span>
<a href="#l10.67"></a><span id="l10.67" class="difflineminus">-    // Typical boilerplate to include in all implementations.</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+  // Typical boilerplate to include in all implementations.</span>
<a href="#l10.69"></a><span id="l10.69"> </span>
<a href="#l10.70"></a><span id="l10.70">   // Extended the JS URL object.</span>
<a href="#l10.71"></a><span id="l10.71">   __proto__: JaBaseUrl.prototype,</span>
<a href="#l10.72"></a><span id="l10.72"> </span>
<a href="#l10.73"></a><span id="l10.73">   // Delegate these methods to CPP.</span>
<a href="#l10.74"></a><span id="l10.74">   _JsPrototypeToDelegate: true,</span>
<a href="#l10.75"></a><span id="l10.75"> </span>
<a href="#l10.76"></a><span id="l10.76" class="difflineminus">-    // InterfaceRequestor override, needed if extraInterfaces.</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+  // InterfaceRequestor override, needed if extraInterfaces.</span>
<a href="#l10.78"></a><span id="l10.78"> </span>
<a href="#l10.79"></a><span id="l10.79" class="difflineminus">-  getInterface: function(iid) {</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+  getInterface(iid) {</span>
<a href="#l10.81"></a><span id="l10.81">     for (let iface of FooUrlProperties.extraInterfaces) {</span>
<a href="#l10.82"></a><span id="l10.82">       if (iid.equals(iface))</span>
<a href="#l10.83"></a><span id="l10.83">         return this;</span>
<a href="#l10.84"></a><span id="l10.84">     }</span>
<a href="#l10.85"></a><span id="l10.85">     return this.delegator.QueryInterface(iid);</span>
<a href="#l10.86"></a><span id="l10.86">   },</span>
<a href="#l10.87"></a><span id="l10.87"> </span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-    // msgIFooUrl implementation</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+  // msgIFooUrl implementation</span>
<a href="#l10.90"></a><span id="l10.90"> </span>
<a href="#l10.91"></a><span id="l10.91">   // Foo id for item.</span>
<a href="#l10.92"></a><span id="l10.92">   // attribute AString itemId;</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineminus">-  get itemId() { return this._itemId;},</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineminus">-  set itemId(aVal) {this._itemId = aVal;},</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+  get itemId() { return this._itemId; },</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+  set itemId(aVal) { this._itemId = aVal; },</span>
<a href="#l10.97"></a><span id="l10.97"> </span>
<a href="#l10.98"></a><span id="l10.98">   // Does this url refer to an attachment?</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineminus">-  //readonly attribute boolean isAttachment;</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+  // readonly attribute boolean isAttachment;</span>
<a href="#l10.101"></a><span id="l10.101">   get isAttachment() {</span>
<a href="#l10.102"></a><span id="l10.102">     // We look to see if the URL has an attachment query</span>
<a href="#l10.103"></a><span id="l10.103">     let query = this.QueryInterface(Ci.nsIURL).query;</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-    return (query &amp;&amp; query.indexOf(ATTACHMENT_QUERY) != -1);</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+    return (query &amp;&amp; query.includes(ATTACHMENT_QUERY));</span>
<a href="#l10.106"></a><span id="l10.106">   },</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-}</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+};</span>
<a href="#l10.109"></a><span id="l10.109"> </span>
<a href="#l10.110"></a><span id="l10.110" class="difflineminus">-var NSGetFactory = XPCOMUtils.generateNSGetFactory([FooUrlConstructor]);</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineplus">+this.NSGetFactory = XPCOMUtils.generateNSGetFactory([FooUrlConstructor]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/jsaccount/test/unit/resources/testJaMsgProtocolInfoComponent.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/resources/testJaMsgProtocolInfoComponent.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -36,22 +36,22 @@ testJaMsgProtocolInfo.prototype = {</span>
<a href="#l11.4"></a><span id="l11.4">   },</span>
<a href="#l11.5"></a><span id="l11.5">   // serverIID is used in AccountWizard.js, if missing will just report an error.</span>
<a href="#l11.6"></a><span id="l11.6">   get serverIID() { return null; },</span>
<a href="#l11.7"></a><span id="l11.7">   get requiresUsername() { return false; },</span>
<a href="#l11.8"></a><span id="l11.8">   get preflightPrettyNameWithEmailAddress() { return false; },</span>
<a href="#l11.9"></a><span id="l11.9">   get canDelete() { return true; },</span>
<a href="#l11.10"></a><span id="l11.10">   get canLoginAtStartUp() { return false; },</span>
<a href="#l11.11"></a><span id="l11.11">   get canDuplicate() { return false; },</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  getDefaultServerPort: (isSecure) =&gt;  0,</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  getDefaultServerPort: (isSecure) =&gt; 0,</span>
<a href="#l11.14"></a><span id="l11.14">   get canGetMessages() { return false; },</span>
<a href="#l11.15"></a><span id="l11.15">   get canGetIncomingMessages() { return false; },</span>
<a href="#l11.16"></a><span id="l11.16">   get defaultDoBiff() { return false; },</span>
<a href="#l11.17"></a><span id="l11.17">   get showComposeMsgLink() { return false; },</span>
<a href="#l11.18"></a><span id="l11.18">   get foldersCreatedAsync() { return false; },</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20">   classDescription: &quot;testja Msg Protocol Info implementation&quot;,</span>
<a href="#l11.21"></a><span id="l11.21">   classID: Components.ID(&quot;{74b9b9c3-9594-41c4-b9f0-326e5daac2e0}&quot;),</span>
<a href="#l11.22"></a><span id="l11.22">   contractID: &quot;@mozilla.org/messenger/protocol/info;1?type=testja&quot;,</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">-  QueryInterface: ChromeUtils.generateQI([Ci.nsIMsgProtocolInfo])</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+  QueryInterface: ChromeUtils.generateQI([Ci.nsIMsgProtocolInfo]),</span>
<a href="#l11.25"></a><span id="l11.25"> };</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-var NSGetFactory = XPCOMUtils.generateNSGetFactory([testJaMsgProtocolInfo]);</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+this.NSGetFactory = XPCOMUtils.generateNSGetFactory([testJaMsgProtocolInfo]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/jsaccount/test/unit/test_componentsExist.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/test_componentsExist.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -68,23 +68,21 @@ let tests = [</span>
<a href="#l12.4"></a><span id="l12.4">   // JaSend</span>
<a href="#l12.5"></a><span id="l12.5">               [&quot;@mozilla.org/jacppsenddelegator;1&quot;, &quot;nsISupports&quot;],</span>
<a href="#l12.6"></a><span id="l12.6">               [&quot;@mozilla.org/jacppsenddelegator;1&quot;, &quot;nsIMsgSend&quot;],</span>
<a href="#l12.7"></a><span id="l12.7">               [&quot;@mozilla.org/jacppsenddelegator;1&quot;, &quot;nsIMsgOperationListener&quot;],</span>
<a href="#l12.8"></a><span id="l12.8">               [&quot;@mozilla.org/jacppsenddelegator;1&quot;, &quot;msgIOverride&quot;],</span>
<a href="#l12.9"></a><span id="l12.9">               [&quot;@mozilla.org/jacppsenddelegator;1&quot;, &quot;nsISupportsWeakReference&quot;],</span>
<a href="#l12.10"></a><span id="l12.10">             ];</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-function run_test()</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-{</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+function run_test() {</span>
<a href="#l12.15"></a><span id="l12.15">   for (let [contractID, iface] of tests) {</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-    dump('trying to create component ' + contractID +</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-         ' with interface ' + iface + '\n');</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+    dump(&quot;trying to create component &quot; + contractID + &quot; with interface &quot; + iface + &quot;\n&quot;);</span>
<a href="#l12.19"></a><span id="l12.19">     try {</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-      dump(Cc[contractID] + &quot; &quot; + Ci[iface] + '\n');</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+      dump(Cc[contractID] + &quot; &quot; + Ci[iface] + &quot;\n&quot;);</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+    } catch (e) {</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+      dump(e + &quot;\n&quot;);</span>
<a href="#l12.24"></a><span id="l12.24">     }</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-    catch (e) {dump(e + '\n');}</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27">     let comp = Cc[contractID].createInstance(Ci[iface]);</span>
<a href="#l12.28"></a><span id="l12.28">     Assert.ok(comp instanceof Ci[iface]);</span>
<a href="#l12.29"></a><span id="l12.29">   }</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-</span>
<a href="#l12.31"></a><span id="l12.31"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/jsaccount/test/unit/test_fooUrl.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/test_fooUrl.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -2,22 +2,19 @@</span>
<a href="#l13.4"></a><span id="l13.4"> /* vim: set ts=2 et sw=2 tw=80 filetype=javascript: */</span>
<a href="#l13.5"></a><span id="l13.5"> /* Any copyright is dedicated to the Public Domain.</span>
<a href="#l13.6"></a><span id="l13.6">  * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> // Tests of override functionality using a demo &quot;foo&quot; type url.</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10"> var {</span>
<a href="#l13.11"></a><span id="l13.11">   JaBaseUrlProperties,</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  JaBaseUrl,</span>
<a href="#l13.13"></a><span id="l13.13"> } = ChromeUtils.import(&quot;resource:///modules/jsaccount/JaBaseUrl.jsm&quot;);</span>
<a href="#l13.14"></a><span id="l13.14"> </span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-var extraInterfaces = [</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-                       Ci.msgIFooUrl,</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-                      ];</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+var extraInterfaces = [Ci.msgIFooUrl];</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20"> function newURL() {</span>
<a href="#l13.21"></a><span id="l13.21">   return Cc[&quot;@mozilla.org/jsaccount/testjafoourl;1&quot;]</span>
<a href="#l13.22"></a><span id="l13.22">            .createInstance(Ci.nsISupports);</span>
<a href="#l13.23"></a><span id="l13.23"> }</span>
<a href="#l13.24"></a><span id="l13.24"> </span>
<a href="#l13.25"></a><span id="l13.25"> var tests = [</span>
<a href="#l13.26"></a><span id="l13.26">   function testExists() {</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineat">@@ -73,13 +70,12 @@ var tests = [</span>
<a href="#l13.28"></a><span id="l13.28"> </span>
<a href="#l13.29"></a><span id="l13.29">     url.QueryInterface(Ci.msgIJaUrl).setSpec(&quot;https://foo.invalid/bar/&quot;);</span>
<a href="#l13.30"></a><span id="l13.30">     Assert.ok(!fooUrl.isAttachment);</span>
<a href="#l13.31"></a><span id="l13.31">     url.QueryInterface(Ci.msgIJaUrl).setSpec(&quot;https://foo.invalid/bar?part=1.4&amp;dummy=stuff&quot;);</span>
<a href="#l13.32"></a><span id="l13.32">     Assert.ok(fooUrl.isAttachment);</span>
<a href="#l13.33"></a><span id="l13.33">   },</span>
<a href="#l13.34"></a><span id="l13.34"> ];</span>
<a href="#l13.35"></a><span id="l13.35"> </span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-function run_test()</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-{</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+function run_test() {</span>
<a href="#l13.39"></a><span id="l13.39">   for (var test of tests)</span>
<a href="#l13.40"></a><span id="l13.40">     test();</span>
<a href="#l13.41"></a><span id="l13.41"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/jsaccount/test/unit/test_jaMsgFolder.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/test_jaMsgFolder.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -5,37 +5,33 @@</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5"> // This tests the additional methods added to JaMsgFolder.cpp that are not</span>
<a href="#l14.6"></a><span id="l14.6"> // in nsMsgDBFolder.cpp  Although this code have been done creating the</span>
<a href="#l14.7"></a><span id="l14.7"> // delegator class directly, instead we use a JS component as a demo of</span>
<a href="#l14.8"></a><span id="l14.8"> // JS override classes.</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10"> var {</span>
<a href="#l14.11"></a><span id="l14.11">   JaBaseMsgFolderProperties,</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  JaBaseMsgFolder,</span>
<a href="#l14.13"></a><span id="l14.13"> } = ChromeUtils.import(&quot;resource://testing-common/mailnews/testJaBaseMsgFolder.jsm&quot;);</span>
<a href="#l14.14"></a><span id="l14.14"> var {MailUtils} = ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l14.15"></a><span id="l14.15"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-var interfaces = JaBaseMsgFolderProperties.baseInterfaces;</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-function run_test()</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-{</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+function run_test() {</span>
<a href="#l14.22"></a><span id="l14.22">   let server = MailServices.accounts.createIncomingServer(&quot;foouser&quot;, &quot;foohost&quot;, &quot;testja&quot;);</span>
<a href="#l14.23"></a><span id="l14.23">   Assert.ok(server instanceof Ci.msgIOverride);</span>
<a href="#l14.24"></a><span id="l14.24"> </span>
<a href="#l14.25"></a><span id="l14.25">   // If you create a folder object directly, it will complain about not being registered.</span>
<a href="#l14.26"></a><span id="l14.26">   // Use folder-lookup-service instead.</span>
<a href="#l14.27"></a><span id="l14.27">   let testJaMsgFolder = MailUtils.getOrCreateFolder(&quot;testja://foouser@foohost/somefolder&quot;);</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-  //let testJaMsgFolder = Cc[JaBaseMsgFolderProperties.contractID]</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+  // let testJaMsgFolder = Cc[JaBaseMsgFolderProperties.contractID]</span>
<a href="#l14.30"></a><span id="l14.30">   //                        .createInstance(Ci.msgIOverride);</span>
<a href="#l14.31"></a><span id="l14.31">   Assert.ok(testJaMsgFolder instanceof Ci.nsIMsgFolder);</span>
<a href="#l14.32"></a><span id="l14.32"> </span>
<a href="#l14.33"></a><span id="l14.33">   JaBaseMsgFolderProperties.baseInterfaces.forEach(iface =&gt; {</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-    dump('testing interface ' + iface + '(' + Ci[iface] + ')\n');</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+    dump(&quot;testing interface &quot; + iface + &quot;(&quot; + Ci[iface] + &quot;)\n&quot;);</span>
<a href="#l14.36"></a><span id="l14.36">     testJaMsgFolder.QueryInterface(Ci[iface]);</span>
<a href="#l14.37"></a><span id="l14.37">   });</span>
<a href="#l14.38"></a><span id="l14.38"> </span>
<a href="#l14.39"></a><span id="l14.39">   let db = testJaMsgFolder.msgDatabase;</span>
<a href="#l14.40"></a><span id="l14.40">   Assert.ok(db instanceof Ci.nsIMsgDatabase);</span>
<a href="#l14.41"></a><span id="l14.41"> </span>
<a href="#l14.42"></a><span id="l14.42">   // Make sure the DB actually works.</span>
<a href="#l14.43"></a><span id="l14.43">   let dbFolder = db.folder;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

