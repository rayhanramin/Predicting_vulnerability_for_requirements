<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 3109:b88721cbde504546867cf277c7f58ead7b90cdf0</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ b88721cbde504546867cf277c7f58ead7b90cdf0" />
<meta property="og:url" content="/comm-central/rev/b88721cbde504546867cf277c7f58ead7b90cdf0" />
<meta property="og:description" content="Bug 498222 - Bug in gloda noun_mimetype.js (TypeError: aMimeType is undefined). v1 don't be fooled by tableName, use fromJSON. also some cleanup. r+sr=bienvenu." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / b88721cbde504546867cf277c7f58ead7b90cdf0 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/b88721cbde504546867cf277c7f58ead7b90cdf0">shortlog</a> |
<a href="/comm-central/log/b88721cbde504546867cf277c7f58ead7b90cdf0">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/b88721cbde504546867cf277c7f58ead7b90cdf0">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/b88721cbde504546867cf277c7f58ead7b90cdf0">files</a> |
changeset |
<a href="/comm-central/raw-rev/b88721cbde504546867cf277c7f58ead7b90cdf0">raw</a>  | <a href="/comm-central/archive/b88721cbde504546867cf277c7f58ead7b90cdf0.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=498222">Bug 498222</a> - Bug in gloda noun_mimetype.js (TypeError: aMimeType is undefined). v1 don't be fooled by tableName, use fromJSON. also some cleanup. r+sr=bienvenu.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#65;&#110;&#100;&#114;&#101;&#119;&#32;&#83;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#32;&#60;&#97;&#115;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#64;&#97;&#115;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 20 Jul 2009 23:58:27 -0700</td></tr>

<tr>
 <td>changeset 3109</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/b88721cbde504546867cf277c7f58ead7b90cdf0">b88721cbde504546867cf277c7f58ead7b90cdf0</a></td>
</tr>



<tr>
<td>parent 3108</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/561f6f3354fb2f7224eebff23a5c27e4761e9b93">561f6f3354fb2f7224eebff23a5c27e4761e9b93</a>
</td>
</tr>

<tr>
<td>child 3110</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2d89b007d6117585edfac576e42256a844ac286d">2d89b007d6117585edfac576e42256a844ac286d</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=b88721cbde504546867cf277c7f58ead7b90cdf0">2532</a></td></tr>
<tr><td>push user</td><td>bugmail@asutherland.org</td></tr>
<tr><td>push date</td><td class="date age">Tue, 21 Jul 2009 07:00:52 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@2d89b007d611 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2d89b007d6117585edfac576e42256a844ac286d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2d89b007d6117585edfac576e42256a844ac286d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2d89b007d6117585edfac576e42256a844ac286d&newProject=comm-central&newRevision=b88721cbde504546867cf277c7f58ead7b90cdf0&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2d89b007d6117585edfac576e42256a844ac286d&newProject=comm-central&newRevision=b88721cbde504546867cf277c7f58ead7b90cdf0&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2d89b007d6117585edfac576e42256a844ac286d&newProject=comm-central&newRevision=b88721cbde504546867cf277c7f58ead7b90cdf0&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=498222">498222</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=498222">Bug 498222</a> - Bug in gloda noun_mimetype.js (TypeError: aMimeType is undefined). v1 don't be fooled by tableName, use fromJSON. also some cleanup. r+sr=bienvenu.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datamodel.js">mailnews/db/gloda/modules/datamodel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datamodel.js">file</a> |
<a href="/comm-central/annotate/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datamodel.js">annotate</a> |
<a href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datamodel.js">diff</a> |
<a href="/comm-central/comparison/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datamodel.js">comparison</a> |
<a href="/comm-central/log/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datamodel.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datastore.js">mailnews/db/gloda/modules/datastore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datastore.js">file</a> |
<a href="/comm-central/annotate/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datastore.js">annotate</a> |
<a href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datastore.js">diff</a> |
<a href="/comm-central/comparison/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datastore.js">comparison</a> |
<a href="/comm-central/log/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/datastore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/fundattr.js">mailnews/db/gloda/modules/fundattr.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/fundattr.js">file</a> |
<a href="/comm-central/annotate/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/fundattr.js">annotate</a> |
<a href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/fundattr.js">diff</a> |
<a href="/comm-central/comparison/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/fundattr.js">comparison</a> |
<a href="/comm-central/log/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/fundattr.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/gloda.js">mailnews/db/gloda/modules/gloda.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/gloda.js">file</a> |
<a href="/comm-central/annotate/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/gloda.js">annotate</a> |
<a href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/gloda.js">diff</a> |
<a href="/comm-central/comparison/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/gloda.js">comparison</a> |
<a href="/comm-central/log/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/gloda.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/indexer.js">mailnews/db/gloda/modules/indexer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/indexer.js">file</a> |
<a href="/comm-central/annotate/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/indexer.js">annotate</a> |
<a href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/indexer.js">diff</a> |
<a href="/comm-central/comparison/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/indexer.js">comparison</a> |
<a href="/comm-central/log/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/indexer.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/noun_mimetype.js">mailnews/db/gloda/modules/noun_mimetype.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/noun_mimetype.js">file</a> |
<a href="/comm-central/annotate/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/noun_mimetype.js">annotate</a> |
<a href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/noun_mimetype.js">diff</a> |
<a href="/comm-central/comparison/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/noun_mimetype.js">comparison</a> |
<a href="/comm-central/log/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/modules/noun_mimetype.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/test/unit/test_noun_mimetype.js">mailnews/db/gloda/test/unit/test_noun_mimetype.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/test/unit/test_noun_mimetype.js">file</a> |
<a href="/comm-central/annotate/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/test/unit/test_noun_mimetype.js">annotate</a> |
<a href="/comm-central/diff/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/test/unit/test_noun_mimetype.js">diff</a> |
<a href="/comm-central/comparison/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/test/unit/test_noun_mimetype.js">comparison</a> |
<a href="/comm-central/log/b88721cbde504546867cf277c7f58ead7b90cdf0/mailnews/db/gloda/test/unit/test_noun_mimetype.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/db/gloda/modules/datamodel.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/datamodel.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -96,49 +96,41 @@ GlodaAttributeDBDef.prototype = {</span>
<a href="#l1.4"></a><span id="l1.4">     let id = this._datastore._createAttributeDef(this._attrType,</span>
<a href="#l1.5"></a><span id="l1.5">                  this._pluginName, this._attrName, aValue);</span>
<a href="#l1.6"></a><span id="l1.6">     this._parameterBindings[aValue] = id;</span>
<a href="#l1.7"></a><span id="l1.7">     this._datastore.reportBinding(id, this, aValue);</span>
<a href="#l1.8"></a><span id="l1.8">     return id;</span>
<a href="#l1.9"></a><span id="l1.9">   },</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11">   /**</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-   * Given a list of values (if non-singular) or a single value (if singular),</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-   *  return a list (regardless of plurality) of database-ready [attribute id,</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-   *  value] tuples.  This is intended to be used to directly convert the value</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-   *  of a property on an object that corresponds to a bound attribute.</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+   * Given a list of values, return a list (regardless of plurality) of</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+   *  database-ready [attribute id,  value] tuples.  This is intended to be used</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+   *  to directly convert the value of a property on an object that corresponds</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+   *  to a bound attribute.</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+   *</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+   * @param {Array} aInstanceValues An array of instance values regardless of</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+   *     whether or not the attribute is singular.</span>
<a href="#l1.23"></a><span id="l1.23">    */</span>
<a href="#l1.24"></a><span id="l1.24">   convertValuesToDBAttributes:</span>
<a href="#l1.25"></a><span id="l1.25">       function gloda_attr_convertValuesToDBAttributes(aInstanceValues) {</span>
<a href="#l1.26"></a><span id="l1.26">     let nounDef = this.attrDef.objectNounDef;</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-    if (this._singular) {</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-      if (nounDef.usesParameter) {</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-        let [param, dbValue] = nounDef.toParamAndValue(aInstanceValues);</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-        return [[this.bindParameter(param), dbValue]];</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-      }</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-      else {</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-        return [[this._id, nounDef.toParamAndValue(aInstanceValues)[1]]];</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+    let dbAttributes = [];</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+    if (nounDef.usesParameter) {</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+      for each (let [, instanceValue] in Iterator(aInstanceValues)) {</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+        let [param, dbValue] = nounDef.toParamAndValue(instanceValue);</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+        dbAttributes.push([this.bindParameter(param), dbValue]);</span>
<a href="#l1.39"></a><span id="l1.39">       }</span>
<a href="#l1.40"></a><span id="l1.40">     }</span>
<a href="#l1.41"></a><span id="l1.41">     else {</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-      let dbAttributes = [];</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-      if (nounDef.usesParameter) {</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-        for each (let [, instanceValue] in Iterator(aInstanceValues)) {</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-          let [param, dbValue] = nounDef.toParamAndValue(instanceValue);</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-          dbAttributes.push([this.bindParameter(param), dbValue]);</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-        }</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+      for each (let [, instanceValue] in Iterator(aInstanceValues)) {</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+        dbAttributes.push([this._id,</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+                           nounDef.toParamAndValue(instanceValue)[1]]);</span>
<a href="#l1.51"></a><span id="l1.51">       }</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-      else {</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-        for each (let [, instanceValue] in Iterator(aInstanceValues)) {</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-          dbAttributes.push([this._id,</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-                             nounDef.toParamAndValue(instanceValue)[1]]);</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-        }</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineminus">-      }</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-      return dbAttributes;</span>
<a href="#l1.59"></a><span id="l1.59">     }</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+    return dbAttributes;</span>
<a href="#l1.61"></a><span id="l1.61">   },</span>
<a href="#l1.62"></a><span id="l1.62"> </span>
<a href="#l1.63"></a><span id="l1.63">   toString: function() {</span>
<a href="#l1.64"></a><span id="l1.64">     return this._compoundName;</span>
<a href="#l1.65"></a><span id="l1.65">   }</span>
<a href="#l1.66"></a><span id="l1.66"> };</span>
<a href="#l1.67"></a><span id="l1.67"> </span>
<a href="#l1.68"></a><span id="l1.68"> let GlodaHasAttributesMixIn = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/db/gloda/modules/datastore.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/datastore.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -3049,20 +3049,24 @@ var GlodaDatastore = {</span>
<a href="#l2.4"></a><span id="l2.4">       let dbAttrib = attribIDToDBDefAndParam[attribId][0];</span>
<a href="#l2.5"></a><span id="l2.5">       // the attribute should only fail to exist if an extension was removed</span>
<a href="#l2.6"></a><span id="l2.6">       if (dbAttrib === undefined)</span>
<a href="#l2.7"></a><span id="l2.7">         continue;</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">       let attrib = dbAttrib.attrDef;</span>
<a href="#l2.10"></a><span id="l2.10">       let objectNounDef = attrib.objectNounDef;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-      // if it has a tableName member, then it's a persistent object that needs</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-      //  to be loaded, which also means we need to hold it in a collection</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-      //  owned by our collection.</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-      if (objectNounDef.tableName) {</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+      // If it has a tableName member but no fromJSON, then it's a persistent</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+      //  object that needs to be loaded, which also means we need to hold it in</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+      //  a collection owned by our collection.</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+      // (If it has a fromJSON method, then it's a special case like</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+      //  MimeTypeNoun where it is authoritatively backed by a table but caches</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+      //  everything into memory.  There is no case where fromJSON would be</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+      //  implemented but we should still be doing database lookups.)</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+      if (objectNounDef.tableName &amp;&amp; !objectNounDef.fromJSON) {</span>
<a href="#l2.24"></a><span id="l2.24">         let references = aReferencesByNounID[objectNounDef.id];</span>
<a href="#l2.25"></a><span id="l2.25">         if (references === undefined)</span>
<a href="#l2.26"></a><span id="l2.26">           references = aReferencesByNounID[objectNounDef.id] = {};</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">         if (attrib.singular) {</span>
<a href="#l2.29"></a><span id="l2.29">           if (!(jsonValue in references))</span>
<a href="#l2.30"></a><span id="l2.30">             references[jsonValue] = null;</span>
<a href="#l2.31"></a><span id="l2.31">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/db/gloda/modules/fundattr.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/fundattr.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -428,18 +428,23 @@ var GlodaFundAttr = {</span>
<a href="#l3.4"></a><span id="l3.4">     aGlodaMessage.from = authorIdentity;</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">     // -- To, Cc</span>
<a href="#l3.7"></a><span id="l3.7">     aGlodaMessage.to = toIdentities;</span>
<a href="#l3.8"></a><span id="l3.8">     aGlodaMessage.cc = ccIdentities;</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">     // -- Attachments</span>
<a href="#l3.11"></a><span id="l3.11">     let attachmentTypes = [];</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    for each (let attachment in aMimeMsg.allAttachments) {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-      if (attachment.isRealAttachment) {</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+    for each (let [, attachment] in Iterator(aMimeMsg.allAttachments)) {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+      // We don't care about would-be attachments that are not user-intended</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+      //  attachments but rather artifacts of the message content.</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+      // We also want to avoid dealing with obviously bogus mime types.</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+      //  (If you don't have a &quot;/&quot;, you are probably bogus.)</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+      if (attachment.isRealAttachment &amp;&amp;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+          (attachment.contentType.indexOf(&quot;/&quot;) != -1)) {</span>
<a href="#l3.21"></a><span id="l3.21">         attachmentTypes.push(MimeTypeNoun.getMimeType(attachment.contentType));</span>
<a href="#l3.22"></a><span id="l3.22">       }</span>
<a href="#l3.23"></a><span id="l3.23">     }</span>
<a href="#l3.24"></a><span id="l3.24">     if (attachmentTypes.length) {</span>
<a href="#l3.25"></a><span id="l3.25">       aGlodaMessage.attachmentTypes = attachmentTypes;</span>
<a href="#l3.26"></a><span id="l3.26">     }</span>
<a href="#l3.27"></a><span id="l3.27"> </span>
<a href="#l3.28"></a><span id="l3.28">     // TODO: deal with mailing lists, including implicit-to.  this will require</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/db/gloda/modules/gloda.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/gloda.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1597,24 +1597,26 @@ var Gloda = {</span>
<a href="#l4.4"></a><span id="l4.4">       if (attrib.singular) {</span>
<a href="#l4.5"></a><span id="l4.5">         if (objectNounDef.toJSON)</span>
<a href="#l4.6"></a><span id="l4.6">           jsonDict[attrib.id] = objectNounDef.toJSON(value);</span>
<a href="#l4.7"></a><span id="l4.7">         else</span>
<a href="#l4.8"></a><span id="l4.8">           jsonDict[attrib.id] = value;</span>
<a href="#l4.9"></a><span id="l4.9">       }</span>
<a href="#l4.10"></a><span id="l4.10">       else {</span>
<a href="#l4.11"></a><span id="l4.11">         if (objectNounDef.toJSON) {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-          toJSON = objectNounDef.toJSON;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+          let toJSON = objectNounDef.toJSON;</span>
<a href="#l4.14"></a><span id="l4.14">           jsonDict[attrib.id] = [toJSON(subValue) for each</span>
<a href="#l4.15"></a><span id="l4.15">                            ([, subValue] in Iterator(value))] ;</span>
<a href="#l4.16"></a><span id="l4.16">         }</span>
<a href="#l4.17"></a><span id="l4.17">         else</span>
<a href="#l4.18"></a><span id="l4.18">           jsonDict[attrib.id] = value;</span>
<a href="#l4.19"></a><span id="l4.19">       }</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+      // - database index attributes</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+</span>
<a href="#l4.23"></a><span id="l4.23">       // perform a delta analysis against the old value, if we have one</span>
<a href="#l4.24"></a><span id="l4.24">       let oldValue = aOldItem[key];</span>
<a href="#l4.25"></a><span id="l4.25">       if (oldValue !== undefined) {</span>
<a href="#l4.26"></a><span id="l4.26">         // in the singular case if they don't match, it's one add and one remove</span>
<a href="#l4.27"></a><span id="l4.27">         if (attrib.singular) {</span>
<a href="#l4.28"></a><span id="l4.28">           // test for identicality, failing that, see if they have explicit</span>
<a href="#l4.29"></a><span id="l4.29">           //  equals support.</span>
<a href="#l4.30"></a><span id="l4.30">           if ((value !== oldValue) &amp;&amp;</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineat">@@ -1694,16 +1696,18 @@ var Gloda = {</span>
<a href="#l4.32"></a><span id="l4.32">         continue;</span>
<a href="#l4.33"></a><span id="l4.33"> </span>
<a href="#l4.34"></a><span id="l4.34">       // find the attribute definition that corresponds to this key</span>
<a href="#l4.35"></a><span id="l4.35">       let attrib = attribsByBoundName[key];</span>
<a href="#l4.36"></a><span id="l4.36">       // if there's no attribute, that's not good, but not horrible.</span>
<a href="#l4.37"></a><span id="l4.37">       if (attrib === undefined) {</span>
<a href="#l4.38"></a><span id="l4.38">         continue;</span>
<a href="#l4.39"></a><span id="l4.39">       }</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+      if (attrib.singular)</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+        value = [value];</span>
<a href="#l4.42"></a><span id="l4.42">       let attribDB = attrib.dbDef;</span>
<a href="#l4.43"></a><span id="l4.43">       removeDBAttribs.push.apply(removeDBAttribs,</span>
<a href="#l4.44"></a><span id="l4.44">                                  attribDB.convertValuesToDBAttributes(value));</span>
<a href="#l4.45"></a><span id="l4.45">       // delete these from the old item, as the old item is canonical, and</span>
<a href="#l4.46"></a><span id="l4.46">       //  should no longer have these values</span>
<a href="#l4.47"></a><span id="l4.47">       delete aOldItem[key];</span>
<a href="#l4.48"></a><span id="l4.48">     }</span>
<a href="#l4.49"></a><span id="l4.49"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/db/gloda/modules/indexer.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/indexer.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1366,17 +1366,18 @@ var GlodaIndexer = {</span>
<a href="#l5.4"></a><span id="l5.4">         catch (ex) {</span>
<a href="#l5.5"></a><span id="l5.5">           // Try and recover if the job is recoverable and the iterator that</span>
<a href="#l5.6"></a><span id="l5.6">           //  experienced the problem wasn't the job worker.  (If it was the</span>
<a href="#l5.7"></a><span id="l5.7">           //  job worker, we can't rely on its state to be intact.)</span>
<a href="#l5.8"></a><span id="l5.8">           if (this._curIndexingJob.recoverable &gt; 0 &amp;&amp;</span>
<a href="#l5.9"></a><span id="l5.9">               this._callbackHandle.activeStack.length &gt; 1) {</span>
<a href="#l5.10"></a><span id="l5.10">             this._curIndexingJob.recoverable--;</span>
<a href="#l5.11"></a><span id="l5.11">             this._log.warn(&quot;Problem during job, trying to recover.  Problem &quot; +</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-              &quot;was at &quot; + ex.fileName + &quot;:&quot; + ex.lineNumber + &quot;: &quot; + ex);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+              &quot;was at &quot; + ex.fileName + &quot;:&quot; + ex.lineNumber + &quot;: &quot; + ex +</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+              (ex.stack ? (&quot;\nStack: &quot; + ex.stack) : &quot;&quot;));</span>
<a href="#l5.15"></a><span id="l5.15">             // cleanup but leave the job's iterator intact.</span>
<a href="#l5.16"></a><span id="l5.16">             this._callbackHandle.cleanup(1);</span>
<a href="#l5.17"></a><span id="l5.17">             // the data must now be invalid</span>
<a href="#l5.18"></a><span id="l5.18">             this._workBatchData = undefined;</span>
<a href="#l5.19"></a><span id="l5.19">           }</span>
<a href="#l5.20"></a><span id="l5.20">           else {</span>
<a href="#l5.21"></a><span id="l5.21">             this._log.warn(&quot;Bailing on job (at &quot; + ex.fileName + &quot;:&quot; +</span>
<a href="#l5.22"></a><span id="l5.22">                 ex.lineNumber + &quot;) because: &quot; + ex);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/db/gloda/modules/noun_mimetype.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/noun_mimetype.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l6.5"></a><span id="l6.5">  *   Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l6.6"></a><span id="l6.6">  *</span>
<a href="#l6.7"></a><span id="l6.7">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l6.8"></a><span id="l6.8">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l6.9"></a><span id="l6.9">  * the License. You may obtain a copy of the License at</span>
<a href="#l6.10"></a><span id="l6.10">  * http://www.mozilla.org/MPL/</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">- * </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+ *</span>
<a href="#l6.13"></a><span id="l6.13">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l6.14"></a><span id="l6.14">  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l6.15"></a><span id="l6.15">  * for the specific language governing rights and limitations under the</span>
<a href="#l6.16"></a><span id="l6.16">  * License.</span>
<a href="#l6.17"></a><span id="l6.17">  *</span>
<a href="#l6.18"></a><span id="l6.18">  * The Original Code is Thunderbird Global Database.</span>
<a href="#l6.19"></a><span id="l6.19">  *</span>
<a href="#l6.20"></a><span id="l6.20">  * The Initial Developer of the Original Code is</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -27,165 +27,195 @@</span>
<a href="#l6.22"></a><span id="l6.22">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l6.23"></a><span id="l6.23">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l6.24"></a><span id="l6.24">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l6.25"></a><span id="l6.25">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l6.26"></a><span id="l6.26">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l6.27"></a><span id="l6.27">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l6.28"></a><span id="l6.28">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l6.29"></a><span id="l6.29">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">- * </span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+ *</span>
<a href="#l6.32"></a><span id="l6.32">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l6.33"></a><span id="l6.33"> </span>
<a href="#l6.34"></a><span id="l6.34"> EXPORTED_SYMBOLS = ['MimeType', 'MimeTypeNoun'];</span>
<a href="#l6.35"></a><span id="l6.35"> </span>
<a href="#l6.36"></a><span id="l6.36"> const Cc = Components.classes;</span>
<a href="#l6.37"></a><span id="l6.37"> const Ci = Components.interfaces;</span>
<a href="#l6.38"></a><span id="l6.38"> const Cr = Components.results;</span>
<a href="#l6.39"></a><span id="l6.39"> const Cu = Components.utils;</span>
<a href="#l6.40"></a><span id="l6.40"> </span>
<a href="#l6.41"></a><span id="l6.41"> Cu.import(&quot;resource://app/modules/gloda/log4moz.js&quot;);</span>
<a href="#l6.42"></a><span id="l6.42"> </span>
<a href="#l6.43"></a><span id="l6.43"> const LOG = Log4Moz.repository.getLogger(&quot;gloda.noun.mimetype&quot;);</span>
<a href="#l6.44"></a><span id="l6.44"> </span>
<a href="#l6.45"></a><span id="l6.45"> Cu.import(&quot;resource://app/modules/gloda/gloda.js&quot;);</span>
<a href="#l6.46"></a><span id="l6.46"> </span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+/**</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+ * Mime type abstraction that exists primarily so we can map mime types to</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+ *  integer id's.</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+ *</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+ * Instances of this class should only be retrieved via |MimeTypeNoun|; no one</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+ *  should ever create an instance directly.</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+ */</span>
<a href="#l6.54"></a><span id="l6.54"> function MimeType(aID, aType, aSubType, aFullType) {</span>
<a href="#l6.55"></a><span id="l6.55">   this._id = aID;</span>
<a href="#l6.56"></a><span id="l6.56">   this._type = aType;</span>
<a href="#l6.57"></a><span id="l6.57">   this._subType = aSubType;</span>
<a href="#l6.58"></a><span id="l6.58">   this._fullType = aFullType;</span>
<a href="#l6.59"></a><span id="l6.59"> }</span>
<a href="#l6.60"></a><span id="l6.60"> </span>
<a href="#l6.61"></a><span id="l6.61"> MimeType.prototype = {</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+  /**</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+   * The integer id we have associated with the mime type.  This is stable for</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+   *  the lifetime of the database, which means that anything in the Gloda</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+   *  database can use this without fear.  Things not persisted in the database</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+   *  should use the actual string mime type, retrieval via |fullType|.</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+   */</span>
<a href="#l6.68"></a><span id="l6.68">   get id() { return this._id; },</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+  /**</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+   * The first part of the MIME type; &quot;text/plain&quot; gets you &quot;text&quot;.</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+   */</span>
<a href="#l6.72"></a><span id="l6.72">   get type() { return this._type; },</span>
<a href="#l6.73"></a><span id="l6.73">   set fullType(aFullType) {</span>
<a href="#l6.74"></a><span id="l6.74">     if (!this._fullType) {</span>
<a href="#l6.75"></a><span id="l6.75">       this._fullType = aFullType;</span>
<a href="#l6.76"></a><span id="l6.76">       [this._type, this._subType] = this._fullType.split(&quot;/&quot;);</span>
<a href="#l6.77"></a><span id="l6.77">     }</span>
<a href="#l6.78"></a><span id="l6.78">   },</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+  /**</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+   * If the |fullType| is &quot;text/plain&quot;, subType is &quot;plain&quot;.</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+   */</span>
<a href="#l6.82"></a><span id="l6.82">   get subType() { return this._subType; },</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineplus">+  /**</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+   * The full MIME type; &quot;text/plain&quot; returns &quot;text/plain&quot;.</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+   */</span>
<a href="#l6.86"></a><span id="l6.86">   get fullType() { return this._fullType; },</span>
<a href="#l6.87"></a><span id="l6.87">   toString: function () {</span>
<a href="#l6.88"></a><span id="l6.88">     return this.fullType;</span>
<a href="#l6.89"></a><span id="l6.89">   }</span>
<a href="#l6.90"></a><span id="l6.90"> };</span>
<a href="#l6.91"></a><span id="l6.91"> </span>
<a href="#l6.92"></a><span id="l6.92"> /**</span>
<a href="#l6.93"></a><span id="l6.93">  * @namespace Mime type noun provider.</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">- * </span>
<a href="#l6.95"></a><span id="l6.95" class="difflineplus">+ *</span>
<a href="#l6.96"></a><span id="l6.96">  * The set of MIME Types is sufficiently limited that we can keep them all in</span>
<a href="#l6.97"></a><span id="l6.97">  *  memory.  In theory it is also sufficiently limited that we could use the</span>
<a href="#l6.98"></a><span id="l6.98">  *  parameter mechanism in the database.  However, it is more efficient, for</span>
<a href="#l6.99"></a><span id="l6.99">  *  both space and performance reasons, to store the specific mime type as a</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineminus">- *  value.  For future-proofing reasons, we opt use a database table to</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineplus">+ *  value.  For future-proofing reasons, we opt to use a database table to</span>
<a href="#l6.102"></a><span id="l6.102">  *  persist the mapping rather than a hard-coded list.  A preferences file or</span>
<a href="#l6.103"></a><span id="l6.103">  *  other text file would arguably suffice, but for consistency reasons, the</span>
<a href="#l6.104"></a><span id="l6.104">  *  database is not a bad thing.</span>
<a href="#l6.105"></a><span id="l6.105">  */</span>
<a href="#l6.106"></a><span id="l6.106"> var MimeTypeNoun = {</span>
<a href="#l6.107"></a><span id="l6.107">   name: &quot;mime-type&quot;,</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineminus">-  class: MimeType,</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineplus">+  clazz: MimeType, // gloda supports clazz as well as class</span>
<a href="#l6.110"></a><span id="l6.110">   allowsArbitraryAttrs: false,</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineminus">-  </span>
<a href="#l6.112"></a><span id="l6.112" class="difflineplus">+</span>
<a href="#l6.113"></a><span id="l6.113">   // note! update test_noun_mimetype if you change our internals!</span>
<a href="#l6.114"></a><span id="l6.114">   _mimeTypes: {},</span>
<a href="#l6.115"></a><span id="l6.115">   _mimeTypesByID: {},</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineminus">-  TYPE_BLOCK_SIZE: 8096,</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineplus">+  TYPE_BLOCK_SIZE: 8096, // bet you were expecting a power of 2!</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineplus">+    // (we can fix this next time we bump the database schema version and have</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineplus">+    //  to resort to blowing the database away.)</span>
<a href="#l6.120"></a><span id="l6.120">   _mimeTypeHighID: {},</span>
<a href="#l6.121"></a><span id="l6.121">   _highID: 0,</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineminus">-  </span>
<a href="#l6.123"></a><span id="l6.123" class="difflineplus">+</span>
<a href="#l6.124"></a><span id="l6.124">   // we now use the exciting 'schema' mechanism of defineNoun to get our table</span>
<a href="#l6.125"></a><span id="l6.125">   //  created for us, plus some helper methods that we simply don't use.</span>
<a href="#l6.126"></a><span id="l6.126">   schema: {</span>
<a href="#l6.127"></a><span id="l6.127">     name: 'mimeTypes',</span>
<a href="#l6.128"></a><span id="l6.128">     columns: [['id', 'INTEGER PRIMARY KEY', '_id'],</span>
<a href="#l6.129"></a><span id="l6.129">               ['mimeType', 'TEXT', 'fullType']],</span>
<a href="#l6.130"></a><span id="l6.130">   },</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineminus">-  </span>
<a href="#l6.132"></a><span id="l6.132" class="difflineplus">+</span>
<a href="#l6.133"></a><span id="l6.133">   _init: function() {</span>
<a href="#l6.134"></a><span id="l6.134">     LOG.debug(&quot;loading MIME types&quot;);</span>
<a href="#l6.135"></a><span id="l6.135">     this._loadMimeTypes();</span>
<a href="#l6.136"></a><span id="l6.136">   },</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineminus">-  </span>
<a href="#l6.138"></a><span id="l6.138" class="difflineplus">+</span>
<a href="#l6.139"></a><span id="l6.139">   _loadMimeTypes: function() {</span>
<a href="#l6.140"></a><span id="l6.140">     // get all the existing mime types!</span>
<a href="#l6.141"></a><span id="l6.141">     let query = Gloda.newQuery(this.id);</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineminus">-    nullFunc = function() {};</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineplus">+    let nullFunc = function() {};</span>
<a href="#l6.144"></a><span id="l6.144">     query.getCollection({</span>
<a href="#l6.145"></a><span id="l6.145">       onItemsAdded: nullFunc, onItemsModified: nullFunc, onItemsRemoved: null,</span>
<a href="#l6.146"></a><span id="l6.146">       onQueryCompleted: function (aCollection) {</span>
<a href="#l6.147"></a><span id="l6.147">         MimeTypeNoun._processMimeTypes(aCollection.items);</span>
<a href="#l6.148"></a><span id="l6.148">       }</span>
<a href="#l6.149"></a><span id="l6.149">     }, null).becomeExplicit();</span>
<a href="#l6.150"></a><span id="l6.150">   },</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineminus">-  </span>
<a href="#l6.152"></a><span id="l6.152" class="difflineplus">+</span>
<a href="#l6.153"></a><span id="l6.153">   _processMimeTypes: function(aMimeTypes) {</span>
<a href="#l6.154"></a><span id="l6.154">     for each (let [, mimeType] in Iterator(aMimeTypes)) {</span>
<a href="#l6.155"></a><span id="l6.155">       if (mimeType.id &gt; this._highID)</span>
<a href="#l6.156"></a><span id="l6.156">         this._highID = mimeType.id;</span>
<a href="#l6.157"></a><span id="l6.157">       this._mimeTypes[mimeType] = mimeType;</span>
<a href="#l6.158"></a><span id="l6.158">       this._mimeTypesByID[mimeType.id] = mimeType;</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineminus">-      </span>
<a href="#l6.160"></a><span id="l6.160" class="difflineplus">+</span>
<a href="#l6.161"></a><span id="l6.161">       let typeBlock = mimeType.id - (mimeType.id % this.TYPE_BLOCK_SIZE);</span>
<a href="#l6.162"></a><span id="l6.162">       let blockHighID = this._mimeTypeHighID[mimeType.type];</span>
<a href="#l6.163"></a><span id="l6.163">       if ((blockHighID === undefined) || mimeType.id &gt; blockHighID)</span>
<a href="#l6.164"></a><span id="l6.164">         this._mimeTypeHighID[mimeType.type] = mimeType.id;</span>
<a href="#l6.165"></a><span id="l6.165">     }</span>
<a href="#l6.166"></a><span id="l6.166">   },</span>
<a href="#l6.167"></a><span id="l6.167" class="difflineminus">-  </span>
<a href="#l6.168"></a><span id="l6.168" class="difflineplus">+</span>
<a href="#l6.169"></a><span id="l6.169">   _addNewMimeType: function(aMimeTypeName) {</span>
<a href="#l6.170"></a><span id="l6.170">     let [typeName, subTypeName] = aMimeTypeName.split(&quot;/&quot;);</span>
<a href="#l6.171"></a><span id="l6.171" class="difflineminus">-    </span>
<a href="#l6.172"></a><span id="l6.172" class="difflineplus">+</span>
<a href="#l6.173"></a><span id="l6.173">     if (!(typeName in this._mimeTypeHighID)) {</span>
<a href="#l6.174"></a><span id="l6.174">       let nextID = this._highID - (this._highID % this.TYPE_BLOCK_SIZE) +</span>
<a href="#l6.175"></a><span id="l6.175">         this.TYPE_BLOCK_SIZE;</span>
<a href="#l6.176"></a><span id="l6.176">       this._mimeTypeHighID[typeName] = nextID;</span>
<a href="#l6.177"></a><span id="l6.177">     }</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineminus">-    </span>
<a href="#l6.179"></a><span id="l6.179" class="difflineplus">+</span>
<a href="#l6.180"></a><span id="l6.180">     let nextID = ++this._mimeTypeHighID[typeName];</span>
<a href="#l6.181"></a><span id="l6.181" class="difflineminus">-    </span>
<a href="#l6.182"></a><span id="l6.182" class="difflineplus">+</span>
<a href="#l6.183"></a><span id="l6.183">     let mimeType = new MimeType(nextID, typeName, subTypeName, aMimeTypeName);</span>
<a href="#l6.184"></a><span id="l6.184">     if (mimeType.id &gt; this._highID)</span>
<a href="#l6.185"></a><span id="l6.185">       this._highID = mimeType.id;</span>
<a href="#l6.186"></a><span id="l6.186" class="difflineminus">-    </span>
<a href="#l6.187"></a><span id="l6.187" class="difflineplus">+</span>
<a href="#l6.188"></a><span id="l6.188">     this._mimeTypes[aMimeTypeName] = mimeType;</span>
<a href="#l6.189"></a><span id="l6.189">     this._mimeTypesByID[nextID] = mimeType;</span>
<a href="#l6.190"></a><span id="l6.190" class="difflineminus">-    </span>
<a href="#l6.191"></a><span id="l6.191" class="difflineplus">+</span>
<a href="#l6.192"></a><span id="l6.192">     // as great as the gloda extension mechanisms are, we don't think it makes</span>
<a href="#l6.193"></a><span id="l6.193">     //  a lot of sense to use them in this case.  So we directly trigger object</span>
<a href="#l6.194"></a><span id="l6.194">     //  insertion without any of the grokNounItem stuff.</span>
<a href="#l6.195"></a><span id="l6.195">     this.objInsert.call(this.datastore, mimeType);</span>
<a href="#l6.196"></a><span id="l6.196" class="difflineminus">-    </span>
<a href="#l6.197"></a><span id="l6.197" class="difflineplus">+</span>
<a href="#l6.198"></a><span id="l6.198">     return mimeType;</span>
<a href="#l6.199"></a><span id="l6.199">   },</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineminus">-  </span>
<a href="#l6.201"></a><span id="l6.201" class="difflineplus">+</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineplus">+  /**</span>
<a href="#l6.203"></a><span id="l6.203" class="difflineplus">+   * Map a mime type to a |MimeType| instance, creating it if necessary.</span>
<a href="#l6.204"></a><span id="l6.204" class="difflineplus">+   *</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineplus">+   * @param aMimeTypeName The mime type.  It may optionally include parameters</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineplus">+   *     (which will be ignored).  A mime type is of the form &quot;type/subtype&quot;.</span>
<a href="#l6.207"></a><span id="l6.207" class="difflineplus">+   *     A type with parameters would look like 'type/subtype; param=&quot;value&quot;'.</span>
<a href="#l6.208"></a><span id="l6.208" class="difflineplus">+   */</span>
<a href="#l6.209"></a><span id="l6.209">   getMimeType: function(aMimeTypeName) {</span>
<a href="#l6.210"></a><span id="l6.210">     // first, lose any parameters</span>
<a href="#l6.211"></a><span id="l6.211">     let semiIndex = aMimeTypeName.indexOf(&quot;;&quot;);</span>
<a href="#l6.212"></a><span id="l6.212">     if (semiIndex &gt;= 0)</span>
<a href="#l6.213"></a><span id="l6.213" class="difflineminus">-      aMimeTypeName = aMimeTypeName.substring(semiIndex);</span>
<a href="#l6.214"></a><span id="l6.214" class="difflineplus">+      aMimeTypeName = aMimeTypeName.substring(0, semiIndex);</span>
<a href="#l6.215"></a><span id="l6.215">     aMimeTypeName = aMimeTypeName.trim().toLowerCase();</span>
<a href="#l6.216"></a><span id="l6.216" class="difflineminus">-    </span>
<a href="#l6.217"></a><span id="l6.217" class="difflineminus">-    let mimeType = this._mimeTypes[aMimeTypeName];</span>
<a href="#l6.218"></a><span id="l6.218" class="difflineminus">-    if (mimeType)</span>
<a href="#l6.219"></a><span id="l6.219" class="difflineminus">-      return mimeType;</span>
<a href="#l6.220"></a><span id="l6.220" class="difflineplus">+</span>
<a href="#l6.221"></a><span id="l6.221" class="difflineplus">+    if (aMimeTypeName in this._mimeTypes)</span>
<a href="#l6.222"></a><span id="l6.222" class="difflineplus">+      return this._mimeTypes[aMimeTypeName];</span>
<a href="#l6.223"></a><span id="l6.223">     else</span>
<a href="#l6.224"></a><span id="l6.224">       return this._addNewMimeType(aMimeTypeName);</span>
<a href="#l6.225"></a><span id="l6.225">   },</span>
<a href="#l6.226"></a><span id="l6.226"> </span>
<a href="#l6.227"></a><span id="l6.227" class="difflineminus">-  toParamAndValue: function gloda_noun_freetag_toParamAndValue(aMimeType) {</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineplus">+  toParamAndValue: function gloda_noun_mimeType_toParamAndValue(aMimeType) {</span>
<a href="#l6.229"></a><span id="l6.229">     return [null, aMimeType.id];</span>
<a href="#l6.230"></a><span id="l6.230">   },</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineminus">-  toJSON: function gloda_noun_freetag_toJSON(aMimeType) {</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineplus">+  toJSON: function gloda_noun_mimeType_toJSON(aMimeType) {</span>
<a href="#l6.233"></a><span id="l6.233">     return aMimeType.id;</span>
<a href="#l6.234"></a><span id="l6.234">   },</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineminus">-  fromJSON: function gloda_noun_freetag_fromJSON(aMimeTypeID) {</span>
<a href="#l6.236"></a><span id="l6.236" class="difflineplus">+  fromJSON: function gloda_noun_mimeType_fromJSON(aMimeTypeID) {</span>
<a href="#l6.237"></a><span id="l6.237">     return this._mimeTypesByID[aMimeTypeID];</span>
<a href="#l6.238"></a><span id="l6.238">   },</span>
<a href="#l6.239"></a><span id="l6.239"> };</span>
<a href="#l6.240"></a><span id="l6.240"> Gloda.defineNoun(MimeTypeNoun, Gloda.NOUN_MIME_TYPE);</span>
<a href="#l6.241"></a><span id="l6.241"> try {</span>
<a href="#l6.242"></a><span id="l6.242"> MimeTypeNoun._init();</span>
<a href="#l6.243"></a><span id="l6.243"> } catch (ex) {</span>
<a href="#l6.244"></a><span id="l6.244">   LOG.error(&quot;problem init-ing: &quot; + ex.fileName + &quot;:&quot; + ex.lineNumber + &quot;: &quot; + ex);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_noun_mimetype.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_noun_mimetype.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -25,54 +25,73 @@ function new_pass() {</span>
<a href="#l7.4"></a><span id="l7.4">     MimeTypeNoun._mimeTypes = {};</span>
<a href="#l7.5"></a><span id="l7.5">     MimeTypeNoun._mimeTypesByID = {};</span>
<a href="#l7.6"></a><span id="l7.6">     MimeTypeNoun._mimeTypeHighID = {};</span>
<a href="#l7.7"></a><span id="l7.7">     MimeTypeNoun._highID = 0;</span>
<a href="#l7.8"></a><span id="l7.8">     MimeTypeNoun._init();</span>
<a href="#l7.9"></a><span id="l7.9">   }</span>
<a href="#l7.10"></a><span id="l7.10">   curPassResults = [];</span>
<a href="#l7.11"></a><span id="l7.11">   passResults.push(curPassResults);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  </span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+</span>
<a href="#l7.14"></a><span id="l7.14">   // the mime type does some async stuff... make sure we don't advance until</span>
<a href="#l7.15"></a><span id="l7.15">   //  it is done with said stuff.</span>
<a href="#l7.16"></a><span id="l7.16">   notifyWhenDatastoreDone(next_test);</span>
<a href="#l7.17"></a><span id="l7.17"> }</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19"> function test_basics() {</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+  let python;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+  // if this is not the first pass, check for python before other things to</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+  //  make sure we're not just relying on consistent logic rather than actual</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+  //  persistence</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+  if (passResults.length)</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+    python = MimeTypeNoun.getMimeType(&quot;text/x-python&quot;);</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+</span>
<a href="#l7.27"></a><span id="l7.27">   let jpeg = MimeTypeNoun.getMimeType(&quot;image/jpeg&quot;);</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-  LOG.debug(&quot;jpeg mime type: &quot; + jpeg);</span>
<a href="#l7.29"></a><span id="l7.29">   curPassResults.push(jpeg);</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-  </span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+</span>
<a href="#l7.32"></a><span id="l7.32">   let png = MimeTypeNoun.getMimeType(&quot;image/png&quot;);</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-  LOG.debug(&quot;jpeg mime type: &quot; + png);</span>
<a href="#l7.34"></a><span id="l7.34">   curPassResults.push(png);</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-  </span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+</span>
<a href="#l7.37"></a><span id="l7.37">   let html = MimeTypeNoun.getMimeType(&quot;text/html&quot;);</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-  LOG.debug(&quot;jpeg mime type: &quot; + html);</span>
<a href="#l7.39"></a><span id="l7.39">   curPassResults.push(html);</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-  </span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+</span>
<a href="#l7.42"></a><span id="l7.42">   let plain = MimeTypeNoun.getMimeType(&quot;text/plain&quot;);</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineminus">-  LOG.debug(&quot;jpeg mime type: &quot; + plain);</span>
<a href="#l7.44"></a><span id="l7.44">   curPassResults.push(plain);</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-  </span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+  // if this is for the first time, check for python now (see above)</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+  if (!passResults.length)</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+    python = MimeTypeNoun.getMimeType(&quot;text/x-python&quot;);</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+  // but always add it to the results now, as we need consistent ordering</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+  //  since we use a list.</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+  curPassResults.push(python);</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+</span>
<a href="#l7.55"></a><span id="l7.55">   // sanity-checking the parsing</span>
<a href="#l7.56"></a><span id="l7.56">   do_check_eq(jpeg.type, &quot;image&quot;);</span>
<a href="#l7.57"></a><span id="l7.57">   do_check_eq(jpeg.subType, &quot;jpeg&quot;);</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+</span>
<a href="#l7.59"></a><span id="l7.59">   // - make sure the numeric trickiness for the block stuff is actually doing</span>
<a href="#l7.60"></a><span id="l7.60">   //  the right thing!</span>
<a href="#l7.61"></a><span id="l7.61">   BLOCK_SIZE = MimeTypeNoun.TYPE_BLOCK_SIZE;</span>
<a href="#l7.62"></a><span id="l7.62">   // same blocks</span>
<a href="#l7.63"></a><span id="l7.63">   do_check_eq(Math.floor(jpeg.id / BLOCK_SIZE),</span>
<a href="#l7.64"></a><span id="l7.64">               Math.floor(png.id / BLOCK_SIZE));</span>
<a href="#l7.65"></a><span id="l7.65">   do_check_eq(Math.floor(html.id / BLOCK_SIZE),</span>
<a href="#l7.66"></a><span id="l7.66">               Math.floor(plain.id / BLOCK_SIZE));</span>
<a href="#l7.67"></a><span id="l7.67">   // different blocks</span>
<a href="#l7.68"></a><span id="l7.68">   do_check_neq(Math.floor(jpeg.id / BLOCK_SIZE),</span>
<a href="#l7.69"></a><span id="l7.69">                Math.floor(html.id / BLOCK_SIZE));</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-  </span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+  next_test();</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+}</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineplus">+</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineplus">+function test_parameters() {</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+  let plain = MimeTypeNoun.getMimeType(&quot;text/plain&quot;);</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+  do_check_eq(plain, MimeTypeNoun.getMimeType('text/plain; charset=&quot;UTF-8&quot;'));</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+</span>
<a href="#l7.79"></a><span id="l7.79">   next_test();</span>
<a href="#l7.80"></a><span id="l7.80"> }</span>
<a href="#l7.81"></a><span id="l7.81"> </span>
<a href="#l7.82"></a><span id="l7.82"> function verify_passes_are_the_same() {</span>
<a href="#l7.83"></a><span id="l7.83">   var firstPassResults = passResults[0];</span>
<a href="#l7.84"></a><span id="l7.84">   for (let iType = 0; iType &lt; curPassResults.length; iType++) {</span>
<a href="#l7.85"></a><span id="l7.85">     for (let iPass = 1; iPass &lt; passResults.length; iPass++) {</span>
<a href="#l7.86"></a><span id="l7.86">       do_check_eq(firstPassResults[iType].id,</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineat">@@ -80,20 +99,25 @@ function verify_passes_are_the_same() {</span>
<a href="#l7.88"></a><span id="l7.88">     }</span>
<a href="#l7.89"></a><span id="l7.89">   }</span>
<a href="#l7.90"></a><span id="l7.90">   next_test();</span>
<a href="#l7.91"></a><span id="l7.91"> }</span>
<a href="#l7.92"></a><span id="l7.92"> </span>
<a href="#l7.93"></a><span id="l7.93"> /* ===== Driver ===== */</span>
<a href="#l7.94"></a><span id="l7.94"> </span>
<a href="#l7.95"></a><span id="l7.95"> var tests = [</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineplus">+  // do two passes of test_basics making sure that persisted values really</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineplus">+  //  persist...</span>
<a href="#l7.98"></a><span id="l7.98">   new_pass,</span>
<a href="#l7.99"></a><span id="l7.99">   test_basics,</span>
<a href="#l7.100"></a><span id="l7.100">   new_pass,</span>
<a href="#l7.101"></a><span id="l7.101">   test_basics,</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineminus">-  verify_passes_are_the_same</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineplus">+  verify_passes_are_the_same,</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineplus">+</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+  test_parameters,</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+</span>
<a href="#l7.107"></a><span id="l7.107"> ];</span>
<a href="#l7.108"></a><span id="l7.108"> </span>
<a href="#l7.109"></a><span id="l7.109"> function run_test() {</span>
<a href="#l7.110"></a><span id="l7.110">   // use mbox injection so we get multiple folders...</span>
<a href="#l7.111"></a><span id="l7.111">   injectMessagesUsing(INJECT_MBOX);</span>
<a href="#l7.112"></a><span id="l7.112">   glodaHelperRunTests(tests);</span>
<a href="#l7.113"></a><span id="l7.113"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

