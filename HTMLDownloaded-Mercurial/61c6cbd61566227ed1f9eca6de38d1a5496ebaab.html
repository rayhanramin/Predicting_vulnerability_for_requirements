<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 9431:61c6cbd61566227ed1f9eca6de38d1a5496ebaab</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 61c6cbd61566227ed1f9eca6de38d1a5496ebaab" />
<meta property="og:url" content="/comm-central/rev/61c6cbd61566227ed1f9eca6de38d1a5496ebaab" />
<meta property="og:description" content="Bug 218439 - Account manager should disallow setting local directory of multiple accounts to the same physical directory (two accounts with same local directory causes mozilla to crash when checking IMAP mail or regenerate msf files). r=Standard8,r=IanN" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 61c6cbd61566227ed1f9eca6de38d1a5496ebaab 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/61c6cbd61566227ed1f9eca6de38d1a5496ebaab">shortlog</a> |
<a href="/comm-central/log/61c6cbd61566227ed1f9eca6de38d1a5496ebaab">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/61c6cbd61566227ed1f9eca6de38d1a5496ebaab">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/61c6cbd61566227ed1f9eca6de38d1a5496ebaab">files</a> |
changeset |
<a href="/comm-central/raw-rev/61c6cbd61566227ed1f9eca6de38d1a5496ebaab">raw</a>  | <a href="/comm-central/archive/61c6cbd61566227ed1f9eca6de38d1a5496ebaab.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=218439">Bug 218439</a> - Account manager should disallow setting local directory of multiple accounts to the same physical directory (two accounts with same local directory causes mozilla to crash when checking IMAP mail or regenerate msf files). r=Standard8,r=IanN
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 21 Feb 2012 12:28:33 +0000</td></tr>

<tr>
 <td>changeset 9431</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/61c6cbd61566227ed1f9eca6de38d1a5496ebaab">61c6cbd61566227ed1f9eca6de38d1a5496ebaab</a></td>
</tr>



<tr>
<td>parent 9430</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4fd77b4c57ca0e4f88433c74af2fa1feef76fbd5">4fd77b4c57ca0e4f88433c74af2fa1feef76fbd5</a>
</td>
</tr>

<tr>
<td>child 9432</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1b2d1c269c890ee7cb11d3865502c6757ebe29b6">1b2d1c269c890ee7cb11d3865502c6757ebe29b6</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=61c6cbd61566227ed1f9eca6de38d1a5496ebaab">7220</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 21 Feb 2012 12:32:30 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@4487f9fbfe2d [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4487f9fbfe2dacd8cd222b2160b6f59861890a5e">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4487f9fbfe2dacd8cd222b2160b6f59861890a5e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4487f9fbfe2dacd8cd222b2160b6f59861890a5e&newProject=comm-central&newRevision=c3184f1b35342dbd35a6757f2513f8e403897c96&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4487f9fbfe2dacd8cd222b2160b6f59861890a5e&newProject=comm-central&newRevision=c3184f1b35342dbd35a6757f2513f8e403897c96&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4487f9fbfe2dacd8cd222b2160b6f59861890a5e&newProject=comm-central&newRevision=c3184f1b35342dbd35a6757f2513f8e403897c96&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a>, <a href="/comm-central/log?rev=reviewer%28IanN%29&revcount=50">IanN</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=218439">218439</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=218439">Bug 218439</a> - Account manager should disallow setting local directory of multiple accounts to the same physical directory (two accounts with same local directory causes mozilla to crash when checking IMAP mail or regenerate msf files). r=Standard8,r=IanN</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61c6cbd61566227ed1f9eca6de38d1a5496ebaab/mailnews/base/prefs/content/amUtils.js">mailnews/base/prefs/content/amUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61c6cbd61566227ed1f9eca6de38d1a5496ebaab/mailnews/base/prefs/content/amUtils.js">file</a> |
<a href="/comm-central/annotate/61c6cbd61566227ed1f9eca6de38d1a5496ebaab/mailnews/base/prefs/content/amUtils.js">annotate</a> |
<a href="/comm-central/diff/61c6cbd61566227ed1f9eca6de38d1a5496ebaab/mailnews/base/prefs/content/amUtils.js">diff</a> |
<a href="/comm-central/comparison/61c6cbd61566227ed1f9eca6de38d1a5496ebaab/mailnews/base/prefs/content/amUtils.js">comparison</a> |
<a href="/comm-central/log/61c6cbd61566227ed1f9eca6de38d1a5496ebaab/mailnews/base/prefs/content/amUtils.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/prefs/content/amUtils.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/prefs/content/amUtils.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -31,16 +31,19 @@</span>
<a href="#l1.4"></a><span id="l1.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l1.5"></a><span id="l1.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l1.6"></a><span id="l1.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l1.7"></a><span id="l1.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l1.8"></a><span id="l1.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l1.9"></a><span id="l1.9">  *</span>
<a href="#l1.10"></a><span id="l1.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15"> const nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l1.16"></a><span id="l1.16"> const nsILocalFile = Components.interfaces.nsILocalFile;</span>
<a href="#l1.17"></a><span id="l1.17"> const LOCALFILE_CTRID = &quot;@mozilla.org/file/local;1&quot;;</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> function BrowseForLocalFolders()</span>
<a href="#l1.20"></a><span id="l1.20"> {</span>
<a href="#l1.21"></a><span id="l1.21">   var currentFolderTextBox = document.getElementById(&quot;server.localPath&quot;);</span>
<a href="#l1.22"></a><span id="l1.22">   var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineat">@@ -57,31 +60,27 @@ function BrowseForLocalFolders()</span>
<a href="#l1.24"></a><span id="l1.24">   fp.displayDirectory = currentFolder;</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">   if (fp.show() == nsIFilePicker.returnOK)</span>
<a href="#l1.27"></a><span id="l1.27">   {</span>
<a href="#l1.28"></a><span id="l1.28">     // Retrieve the selected folder.</span>
<a href="#l1.29"></a><span id="l1.29">     var selectedFolder = fp.file;</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31">     // check that no other account/server has this same local directory</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-    var allServers = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-                               .getService(Components.interfaces.nsIMsgAccountManager)</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-                               .allServers;</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+    var allServers = MailServices.accounts.allServers;</span>
<a href="#l1.36"></a><span id="l1.36">     for (var i = allServers.Count(); --i &gt;= 0;)</span>
<a href="#l1.37"></a><span id="l1.37">     {</span>
<a href="#l1.38"></a><span id="l1.38">       var currentServer = allServers.QueryElementAt(i, Components.interfaces.nsIMsgIncomingServer);</span>
<a href="#l1.39"></a><span id="l1.39">       if (currentServer.key != gServer.key &amp;&amp;</span>
<a href="#l1.40"></a><span id="l1.40">           currentServer.localPath.equals(selectedFolder))</span>
<a href="#l1.41"></a><span id="l1.41">       {</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-        var directoryAlreadyUsed =</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-          top.gPrefsBundle.getFormattedString(</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-            &quot;directoryUsedByOtherAccount&quot;, [ currentServer.prettyName ]);</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-        Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-                  .getService(Components.interfaces.nsIPromptService)</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-                  .alert(window, null, directoryAlreadyUsed);</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+        var dirAlreadyUsed = top.document.getElementById(&quot;bundle_prefs&quot;)</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+                                .getFormattedString(&quot;directoryUsedByOtherAccount&quot;,</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+                                                    [currentServer.prettyName]);</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+        Services.prompt.alert(window, null, dirAlreadyUsed);</span>
<a href="#l1.52"></a><span id="l1.52">         return;</span>
<a href="#l1.53"></a><span id="l1.53">       }</span>
<a href="#l1.54"></a><span id="l1.54">     }</span>
<a href="#l1.55"></a><span id="l1.55"> </span>
<a href="#l1.56"></a><span id="l1.56">     currentFolderTextBox.value = selectedFolder.path;</span>
<a href="#l1.57"></a><span id="l1.57">   }</span>
<a href="#l1.58"></a><span id="l1.58"> }</span>
<a href="#l1.59"></a><span id="l1.59"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

