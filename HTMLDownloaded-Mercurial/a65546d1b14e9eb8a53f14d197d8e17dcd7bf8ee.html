<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 17532:a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee" />
<meta property="og:url" content="/comm-central/rev/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee" />
<meta property="og:description" content="Bug 170270 - Enable search in multiple/all address books. r=mkmelin, ui-r=Paenglab." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee">shortlog</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee">files</a> |
changeset |
<a href="/comm-central/raw-rev/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee">raw</a>  | <a href="/comm-central/archive/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=170270">Bug 170270</a> - Enable search in multiple/all address books. r=mkmelin, ui-r=Paenglab.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#117;&#121;&#97;&#115;&#104;&#32;&#65;&#103;&#97;&#114;&#119;&#97;&#108;&#32;&#60;&#115;&#121;&#115;&#104;&#97;&#103;&#97;&#114;&#119;&#97;&#108;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 21 Feb 2015 16:43:53 +0100</td></tr>

<tr>
 <td>changeset 17532</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee">a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee</a></td>
</tr>



<tr>
<td>parent 17531</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d8219513e01f208ae62e1ce87aa4aca7c10aef61">d8219513e01f208ae62e1ce87aa4aca7c10aef61</a>
</td>
</tr>

<tr>
<td>child 17533</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b003a9bbb687a47ae30cbf99e97a4fb3596802b1">b003a9bbb687a47ae30cbf99e97a4fb3596802b1</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee">10795</a></td></tr>
<tr><td>push user</td><td>archaeopteryx@coole-files.de</td></tr>
<tr><td>push date</td><td class="date age">Sat, 21 Feb 2015 15:44:55 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@a65546d1b14e [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee&newProject=comm-central&newRevision=a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee&newProject=comm-central&newRevision=a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee&newProject=comm-central&newRevision=a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a>, <a href="/comm-central/log?rev=reviewer%28Paenglab%29&revcount=50">Paenglab</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=170270">170270</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=170270">Bug 170270</a> - Enable search in multiple/all address books. r=mkmelin, ui-r=Paenglab.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/base/modules/mailMigrator.js">mail/base/modules/mailMigrator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/base/modules/mailMigrator.js">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/base/modules/mailMigrator.js">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/base/modules/mailMigrator.js">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/base/modules/mailMigrator.js">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/base/modules/mailMigrator.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCardOverlay.js">mail/components/addrbook/content/abCardOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCardOverlay.js">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCardOverlay.js">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCardOverlay.js">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCardOverlay.js">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCardOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCommon.js">mail/components/addrbook/content/abCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCommon.js">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCommon.js">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCommon.js">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCommon.js">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abCommon.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.js">mail/components/addrbook/content/abContactsPanel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.js">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.js">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.js">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.js">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.xul">mail/components/addrbook/content/abContactsPanel.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.xul">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.xul">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.xul">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.xul">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abContactsPanel.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abTrees.js">mail/components/addrbook/content/abTrees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abTrees.js">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abTrees.js">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abTrees.js">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abTrees.js">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/abTrees.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.js">mail/components/addrbook/content/addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.js">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.js">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.js">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.js">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.xul">mail/components/addrbook/content/addressbook.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.xul">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.xul">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.xul">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.xul">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/components/addrbook/content/addressbook.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abResultsPaneOverlay.dtd">mail/locales/en-US/chrome/messenger/addressbook/abResultsPaneOverlay.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abResultsPaneOverlay.dtd">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abResultsPaneOverlay.dtd">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abResultsPaneOverlay.dtd">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abResultsPaneOverlay.dtd">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/abResultsPaneOverlay.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/test/mozmill/addrbook/test-address-book.js">mail/test/mozmill/addrbook/test-address-book.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/test/mozmill/addrbook/test-address-book.js">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/test/mozmill/addrbook/test-address-book.js">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/test/mozmill/addrbook/test-address-book.js">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/test/mozmill/addrbook/test-address-book.js">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/test/mozmill/addrbook/test-address-book.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/jar.mn">mail/themes/linux/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/jar.mn">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/jar.mn">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/jar.mn">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/jar.mn">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/mail/addrbook/addressbook.css">mail/themes/linux/mail/addrbook/addressbook.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/mail/addrbook/addressbook.css">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/mail/addrbook/addressbook.css">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/mail/addrbook/addressbook.css">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/mail/addrbook/addressbook.css">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/linux/mail/addrbook/addressbook.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/jar.mn">mail/themes/osx/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/jar.mn">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/jar.mn">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/jar.mn">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/jar.mn">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/mail/addrbook/addressbook.css">mail/themes/osx/mail/addrbook/addressbook.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/mail/addrbook/addressbook.css">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/mail/addrbook/addressbook.css">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/mail/addrbook/addressbook.css">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/mail/addrbook/addressbook.css">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/osx/mail/addrbook/addressbook.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/shared/mail/addressbook.css">mail/themes/shared/mail/addressbook.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/shared/mail/addressbook.css">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/shared/mail/addressbook.css">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/shared/mail/addressbook.css">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/shared/mail/addressbook.css">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/shared/mail/addressbook.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/jar.mn">mail/themes/windows/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/jar.mn">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/jar.mn">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/jar.mn">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/jar.mn">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook-aero.css">mail/themes/windows/mail/addrbook/addressbook-aero.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook-aero.css">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook-aero.css">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook-aero.css">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook-aero.css">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook-aero.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook.css">mail/themes/windows/mail/addrbook/addressbook.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook.css">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook.css">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook.css">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook.css">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mail/themes/windows/mail/addrbook/addressbook.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abAddressBookNameDialog.js">mailnews/addrbook/content/abAddressBookNameDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abAddressBookNameDialog.js">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abAddressBookNameDialog.js">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abAddressBookNameDialog.js">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abAddressBookNameDialog.js">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abAddressBookNameDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abDragDrop.js">mailnews/addrbook/content/abDragDrop.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abDragDrop.js">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abDragDrop.js">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abDragDrop.js">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abDragDrop.js">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abDragDrop.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abResultsPane.js">mailnews/addrbook/content/abResultsPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abResultsPane.js">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abResultsPane.js">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abResultsPane.js">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abResultsPane.js">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/content/abResultsPane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/public/nsIAbManager.idl">mailnews/addrbook/public/nsIAbManager.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/public/nsIAbManager.idl">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/public/nsIAbManager.idl">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/public/nsIAbManager.idl">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/public/nsIAbManager.idl">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/public/nsIAbManager.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbManager.cpp">mailnews/addrbook/src/nsAbManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbManager.cpp">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbManager.cpp">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbManager.cpp">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbManager.cpp">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.cpp">mailnews/addrbook/src/nsAbView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.cpp">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.cpp">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.cpp">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.cpp">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.h">mailnews/addrbook/src/nsAbView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.h">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.h">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.h">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.h">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/addrbook/src/nsAbView.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/mailnews.js">mailnews/mailnews.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/mailnews.js">file</a> |
<a href="/comm-central/annotate/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/mailnews.js">annotate</a> |
<a href="/comm-central/diff/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/mailnews.js">diff</a> |
<a href="/comm-central/comparison/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/mailnews.js">comparison</a> |
<a href="/comm-central/log/a65546d1b14e9eb8a53f14d197d8e17dcd7bf8ee/mailnews/mailnews.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/modules/mailMigrator.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/modules/mailMigrator.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -93,17 +93,17 @@ var MailMigrator = {</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">   /**</span>
<a href="#l1.6"></a><span id="l1.6">    * Determine if the UI has been upgraded in a way that requires us to reset</span>
<a href="#l1.7"></a><span id="l1.7">    * some user configuration.  If so, performs the resets.</span>
<a href="#l1.8"></a><span id="l1.8">    */</span>
<a href="#l1.9"></a><span id="l1.9">   _migrateUI: function() {</span>
<a href="#l1.10"></a><span id="l1.10">     // The code for this was ported from</span>
<a href="#l1.11"></a><span id="l1.11">     // mozilla/browser/components/nsBrowserGlue.js</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    const UI_VERSION = 9;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    const UI_VERSION = 10;</span>
<a href="#l1.14"></a><span id="l1.14">     const MESSENGER_DOCURL = &quot;chrome://messenger/content/messenger.xul&quot;;</span>
<a href="#l1.15"></a><span id="l1.15">     const UI_VERSION_PREF = &quot;mail.ui-rdf.version&quot;;</span>
<a href="#l1.16"></a><span id="l1.16">     let currentUIVersion = 0;</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18">     try {</span>
<a href="#l1.19"></a><span id="l1.19">       currentUIVersion = Services.prefs.getIntPref(UI_VERSION_PREF);</span>
<a href="#l1.20"></a><span id="l1.20">     } catch(ex) {}</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -264,16 +264,58 @@ var MailMigrator = {</span>
<a href="#l1.23"></a><span id="l1.23">               detector == &quot;ruprob&quot; ||</span>
<a href="#l1.24"></a><span id="l1.24">               detector == &quot;ukprob&quot;)) {</span>
<a href="#l1.25"></a><span id="l1.25">           // If the encoding detector pref value is not reachable from the UI,</span>
<a href="#l1.26"></a><span id="l1.26">           // reset to default (varies by localization).</span>
<a href="#l1.27"></a><span id="l1.27">           Services.prefs.clearUserPref(&quot;intl.charset.detector&quot;);</span>
<a href="#l1.28"></a><span id="l1.28">         }</span>
<a href="#l1.29"></a><span id="l1.29">       }</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+      // Add an expanded entry for All Address Books.</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+      if (currentUIVersion &lt; 10) {</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+        let PERMS_FILE = parseInt(&quot;0644&quot;, 8);</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+        let file = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+        file.append(&quot;directoryTree.json&quot;);</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+        let data = &quot;&quot;;</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+        // If the file exists, read its contents, prepend the &quot;All ABs&quot; URI</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+        // and save it, else, just write the &quot;All ABs&quot; URI to the file.</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+        if (file.exists()) {</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+          let fstream = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+                        .createInstance(Ci.nsIFileInputStream);</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+          let sstream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+                        .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+          fstream.init(file, -1, 0, 0);</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+          sstream.init(fstream);</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+          while (sstream.available()) {</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+            data += sstream.read(4096);</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+          }</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+          sstream.close();</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+          fstream.close();</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+        }</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+        if (data == &quot;[]&quot;) {</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+          data = &quot;&quot;;</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+        } else if (data.length &gt; 0) {</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+          data = data.substring(1, data.length - 1);</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+        }</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+        data = &quot;[&quot; + &quot;\&quot;moz-abdirectory://?\&quot;&quot; +</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+               ((data.length &gt; 0) ? (&quot;,&quot; + data) : &quot;&quot;) + &quot;]&quot;;</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+        let foStream = Cc[&quot;@mozilla.org/network/safe-file-output-stream;1&quot;]</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+                       .createInstance(Ci.nsIFileOutputStream);</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+        foStream.init(file, 0x02 | 0x08 | 0x20, PERMS_FILE, 0);</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+        foStream.write(data, data.length);</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+        foStream.QueryInterface(Ci.nsISafeOutputStream).finish();</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+        foStream.close();</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+      }</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+</span>
<a href="#l1.73"></a><span id="l1.73">       // Update the migration version.</span>
<a href="#l1.74"></a><span id="l1.74">       Services.prefs.setIntPref(UI_VERSION_PREF, UI_VERSION);</span>
<a href="#l1.75"></a><span id="l1.75"> </span>
<a href="#l1.76"></a><span id="l1.76">     } catch(e) {</span>
<a href="#l1.77"></a><span id="l1.77">       Cu.reportError(&quot;Migrating from UI version &quot; + currentUIVersion + &quot; to &quot; +</span>
<a href="#l1.78"></a><span id="l1.78">                      UI_VERSION + &quot; failed. Error message was: &quot; + e + &quot; -- &quot; +</span>
<a href="#l1.79"></a><span id="l1.79">                      &quot;Will reattempt on next start.&quot;);</span>
<a href="#l1.80"></a><span id="l1.80">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/addrbook/content/abCardOverlay.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCardOverlay.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -199,16 +199,25 @@ function EditCardOKButton()</span>
<a href="#l2.4"></a><span id="l2.4">         if (card.equals(gEditCard.card))</span>
<a href="#l2.5"></a><span id="l2.5">           foundDirectories.push({directory:subdir, cardIndex:index});</span>
<a href="#l2.6"></a><span id="l2.6">       }</span>
<a href="#l2.7"></a><span id="l2.7">     }</span>
<a href="#l2.8"></a><span id="l2.8">   }</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10">   CheckAndSetCardValues(gEditCard.card, document, false);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  // If the source directory is &quot;All Address Books&quot;, find the parent</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  // address book of the card being edited and reflect the changes in it.</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  if (directory.URI == kAllDirectoryRoot + &quot;?&quot;) {</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+    let dirId =</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+      gEditCard.card.directoryId</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+                    .substring(0, gEditCard.card.directoryId.indexOf(&quot;&amp;&quot;));</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+    directory = MailServices.ab.getDirectoryFromId(dirId);</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+  }</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+</span>
<a href="#l2.21"></a><span id="l2.21">   directory.modifyCard(gEditCard.card);</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23">   while (foundDirectories.length) {</span>
<a href="#l2.24"></a><span id="l2.24">     // Update the addressLists item for this card</span>
<a href="#l2.25"></a><span id="l2.25">     let foundItem = foundDirectories.pop();</span>
<a href="#l2.26"></a><span id="l2.26">     foundItem.directory</span>
<a href="#l2.27"></a><span id="l2.27">              .addressLists</span>
<a href="#l2.28"></a><span id="l2.28">              .replaceElementAt(gEditCard.card, foundItem.cardIndex, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/addrbook/content/abCommon.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCommon.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -7,20 +7,24 @@</span>
<a href="#l3.4"></a><span id="l3.4"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.5"></a><span id="l3.5"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> var gDirTree;</span>
<a href="#l3.8"></a><span id="l3.8"> var abList = 0;</span>
<a href="#l3.9"></a><span id="l3.9"> var gAbResultsTree = null;</span>
<a href="#l3.10"></a><span id="l3.10"> var gAbView = null;</span>
<a href="#l3.11"></a><span id="l3.11"> var gAddressBookBundle;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+// A boolean variable determining whether AB column should be shown in AB</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+// sidebar in compose window.</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+var gAbColumnInComposeSidebar = false;</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> const kDefaultSortColumn = &quot;GeneratedName&quot;;</span>
<a href="#l3.17"></a><span id="l3.17"> const kDefaultAscending = &quot;ascending&quot;;</span>
<a href="#l3.18"></a><span id="l3.18"> const kDefaultDescending = &quot;descending&quot;;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+const kAllDirectoryRoot = &quot;moz-abdirectory://&quot;;</span>
<a href="#l3.20"></a><span id="l3.20"> const kLdapUrlPrefix = &quot;moz-abldapdirectory://&quot;;</span>
<a href="#l3.21"></a><span id="l3.21"> const kPersonalAddressbookURI = &quot;moz-abmdbdirectory://abook.mab&quot;;</span>
<a href="#l3.22"></a><span id="l3.22"> const kCollectedAddressbookURI = &quot;moz-abmdbdirectory://history.mab&quot;;</span>
<a href="#l3.23"></a><span id="l3.23"> // The default, generic contact image is displayed via CSS when the photoURI is</span>
<a href="#l3.24"></a><span id="l3.24"> // blank.</span>
<a href="#l3.25"></a><span id="l3.25"> let defaultPhotoURI = &quot;&quot;;</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27"> const PERMS_FILE = parseInt(&quot;0644&quot;, 8);</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineat">@@ -34,16 +38,17 @@ var DirPaneController =</span>
<a href="#l3.29"></a><span id="l3.29">     switch (command) {</span>
<a href="#l3.30"></a><span id="l3.30">       case &quot;cmd_selectAll&quot;:</span>
<a href="#l3.31"></a><span id="l3.31">       case &quot;cmd_delete&quot;:</span>
<a href="#l3.32"></a><span id="l3.32">       case &quot;button_delete&quot;:</span>
<a href="#l3.33"></a><span id="l3.33">       case &quot;cmd_properties&quot;:</span>
<a href="#l3.34"></a><span id="l3.34">       case &quot;cmd_printcard&quot;:</span>
<a href="#l3.35"></a><span id="l3.35">       case &quot;cmd_printcardpreview&quot;:</span>
<a href="#l3.36"></a><span id="l3.36">       case &quot;cmd_newlist&quot;:</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+      case &quot;cmd_newCard&quot;:</span>
<a href="#l3.38"></a><span id="l3.38">         return true;</span>
<a href="#l3.39"></a><span id="l3.39">       default:</span>
<a href="#l3.40"></a><span id="l3.40">         return false;</span>
<a href="#l3.41"></a><span id="l3.41">     }</span>
<a href="#l3.42"></a><span id="l3.42">   },</span>
<a href="#l3.43"></a><span id="l3.43"> </span>
<a href="#l3.44"></a><span id="l3.44">   isCommandEnabled: function(command)</span>
<a href="#l3.45"></a><span id="l3.45">   {</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineat">@@ -60,18 +65,19 @@ var DirPaneController =</span>
<a href="#l3.47"></a><span id="l3.47">       case &quot;cmd_delete&quot;:</span>
<a href="#l3.48"></a><span id="l3.48">       case &quot;button_delete&quot;:</span>
<a href="#l3.49"></a><span id="l3.49">         var selectedDir = GetSelectedDirectory();</span>
<a href="#l3.50"></a><span id="l3.50">         if (command == &quot;cmd_delete&quot; &amp;&amp; selectedDir)</span>
<a href="#l3.51"></a><span id="l3.51">           goSetMenuValue(command, GetDirectoryFromURI(selectedDir).isMailList ?</span>
<a href="#l3.52"></a><span id="l3.52">                                   &quot;valueList&quot; : &quot;valueAddressBook&quot;);</span>
<a href="#l3.53"></a><span id="l3.53"> </span>
<a href="#l3.54"></a><span id="l3.54">         if (selectedDir &amp;&amp;</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-	    (selectedDir != kPersonalAddressbookURI) &amp;&amp;</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-	    (selectedDir != kCollectedAddressbookURI)) {</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+            (selectedDir != kPersonalAddressbookURI) &amp;&amp;</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+            (selectedDir != kCollectedAddressbookURI) &amp;&amp;</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+            (selectedDir != (kAllDirectoryRoot + &quot;?&quot;))) {</span>
<a href="#l3.60"></a><span id="l3.60">           // If the directory is a mailing list, and it is read-only, return</span>
<a href="#l3.61"></a><span id="l3.61">           // false.</span>
<a href="#l3.62"></a><span id="l3.62">           var abDir = GetDirectoryFromURI(selectedDir);</span>
<a href="#l3.63"></a><span id="l3.63">           if (abDir.isMailList &amp;&amp; abDir.readOnly)</span>
<a href="#l3.64"></a><span id="l3.64">             return false;</span>
<a href="#l3.65"></a><span id="l3.65"> </span>
<a href="#l3.66"></a><span id="l3.66">           // If the selected directory is an ldap directory</span>
<a href="#l3.67"></a><span id="l3.67">           // and if the prefs for this directory are locked</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineat">@@ -95,23 +101,26 @@ var DirPaneController =</span>
<a href="#l3.69"></a><span id="l3.69">           return false;</span>
<a href="#l3.70"></a><span id="l3.70">       case &quot;cmd_printcard&quot;:</span>
<a href="#l3.71"></a><span id="l3.71">       case &quot;cmd_printcardpreview&quot;:</span>
<a href="#l3.72"></a><span id="l3.72">         return (GetSelectedCardIndex() != -1);</span>
<a href="#l3.73"></a><span id="l3.73">       case &quot;cmd_properties&quot;:</span>
<a href="#l3.74"></a><span id="l3.74">         return (GetSelectedDirectory() != null);</span>
<a href="#l3.75"></a><span id="l3.75">       case &quot;cmd_newlist&quot;:</span>
<a href="#l3.76"></a><span id="l3.76">         selectedDir = GetSelectedDirectory();</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-        if (selectedDir) {</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+        if (selectedDir &amp;&amp; selectedDir != (kAllDirectoryRoot + &quot;?&quot;)) {</span>
<a href="#l3.79"></a><span id="l3.79">           var abDir = GetDirectoryFromURI(selectedDir);</span>
<a href="#l3.80"></a><span id="l3.80">           if (abDir) {</span>
<a href="#l3.81"></a><span id="l3.81">             return abDir.supportsMailingLists;</span>
<a href="#l3.82"></a><span id="l3.82">           }</span>
<a href="#l3.83"></a><span id="l3.83">         }</span>
<a href="#l3.84"></a><span id="l3.84">         return false;</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+      case &quot;cmd_newCard&quot;:</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+        selectedDir = GetSelectedDirectory();</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+        return (selectedDir &amp;&amp; selectedDir != (kAllDirectoryRoot + &quot;?&quot;));</span>
<a href="#l3.88"></a><span id="l3.88">       default:</span>
<a href="#l3.89"></a><span id="l3.89">         return false;</span>
<a href="#l3.90"></a><span id="l3.90">     }</span>
<a href="#l3.91"></a><span id="l3.91">   },</span>
<a href="#l3.92"></a><span id="l3.92"> </span>
<a href="#l3.93"></a><span id="l3.93">   doCommand: function(command)</span>
<a href="#l3.94"></a><span id="l3.94">   {</span>
<a href="#l3.95"></a><span id="l3.95">     switch (command) {</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineat">@@ -126,16 +135,19 @@ var DirPaneController =</span>
<a href="#l3.97"></a><span id="l3.97">           AbDeleteSelectedDirectory();</span>
<a href="#l3.98"></a><span id="l3.98">         break;</span>
<a href="#l3.99"></a><span id="l3.99">       case &quot;cmd_properties&quot;:</span>
<a href="#l3.100"></a><span id="l3.100">         AbEditSelectedDirectory();</span>
<a href="#l3.101"></a><span id="l3.101">         break;</span>
<a href="#l3.102"></a><span id="l3.102">       case &quot;cmd_newlist&quot;:</span>
<a href="#l3.103"></a><span id="l3.103">         AbNewList();</span>
<a href="#l3.104"></a><span id="l3.104">         break;</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+      case &quot;cmd_newCard&quot;:</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+        AbNewCard();</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+        break;</span>
<a href="#l3.108"></a><span id="l3.108">     }</span>
<a href="#l3.109"></a><span id="l3.109">   },</span>
<a href="#l3.110"></a><span id="l3.110"> </span>
<a href="#l3.111"></a><span id="l3.111">   onEvent: function(event)</span>
<a href="#l3.112"></a><span id="l3.112">   {</span>
<a href="#l3.113"></a><span id="l3.113">     // on blur events set the menu item texts back to the normal values</span>
<a href="#l3.114"></a><span id="l3.114">     if (event == &quot;blur&quot;)</span>
<a href="#l3.115"></a><span id="l3.115">       goSetMenuValue(&quot;cmd_delete&quot;, &quot;valueDefault&quot;);</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineat">@@ -250,16 +262,24 @@ function GetParentRow(aTree, aRow)</span>
<a href="#l3.117"></a><span id="l3.117">   return row;</span>
<a href="#l3.118"></a><span id="l3.118"> }</span>
<a href="#l3.119"></a><span id="l3.119"> </span>
<a href="#l3.120"></a><span id="l3.120"> function InitCommonJS()</span>
<a href="#l3.121"></a><span id="l3.121"> {</span>
<a href="#l3.122"></a><span id="l3.122">   gDirTree = document.getElementById(&quot;dirTree&quot;);</span>
<a href="#l3.123"></a><span id="l3.123">   abList = document.getElementById(&quot;addressbookList&quot;);</span>
<a href="#l3.124"></a><span id="l3.124">   gAddressBookBundle = document.getElementById(&quot;bundle_addressBook&quot;);</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+  // Make an entry for &quot;All Address Books&quot;.</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+  if (abList) {</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+    abList.insertItemAt(0, gAddressBookBundle.getString(&quot;allAddressBooks&quot;),</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+                        kAllDirectoryRoot + &quot;?&quot;);</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+    // Select the newly added entry.</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+    abList.selectedIndex = 0;</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+  }</span>
<a href="#l3.133"></a><span id="l3.133"> }</span>
<a href="#l3.134"></a><span id="l3.134"> </span>
<a href="#l3.135"></a><span id="l3.135"> function AbDelete()</span>
<a href="#l3.136"></a><span id="l3.136"> {</span>
<a href="#l3.137"></a><span id="l3.137">   var types = GetSelectedCardTypes();</span>
<a href="#l3.138"></a><span id="l3.138">   if (types == kNothingSelected)</span>
<a href="#l3.139"></a><span id="l3.139">     return;</span>
<a href="#l3.140"></a><span id="l3.140"> </span>
<a href="#l3.141"></a><span id="l3.141" class="difflineat">@@ -274,18 +294,38 @@ function AbDelete()</span>
<a href="#l3.142"></a><span id="l3.142">     confirmDeleteMessage = gAddressBookBundle.getString(&quot;confirmDeleteMailingList&quot;);</span>
<a href="#l3.143"></a><span id="l3.143">   else if (types == kCardsOnly &amp;&amp; gAbView &amp;&amp; gAbView.selection) {</span>
<a href="#l3.144"></a><span id="l3.144">     if (gAbView.selection.count &lt; 2)</span>
<a href="#l3.145"></a><span id="l3.145">       confirmDeleteMessage = gAddressBookBundle.getString(&quot;confirmDeleteContact&quot;);</span>
<a href="#l3.146"></a><span id="l3.146">     else</span>
<a href="#l3.147"></a><span id="l3.147">       confirmDeleteMessage = gAddressBookBundle.getString(&quot;confirmDeleteContacts&quot;);</span>
<a href="#l3.148"></a><span id="l3.148">   }</span>
<a href="#l3.149"></a><span id="l3.149"> </span>
<a href="#l3.150"></a><span id="l3.150" class="difflineminus">-  if (confirmDeleteMessage &amp;&amp; Services.prompt.confirm(window, null, confirmDeleteMessage))</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineminus">-    gAbView.deleteSelectedCards();</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+  if (confirmDeleteMessage &amp;&amp;</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+      Services.prompt.confirm(window, null, confirmDeleteMessage)) {</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+    if (GetSelectedDirectory() != (kAllDirectoryRoot + &quot;?&quot;)) {</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+      gAbView.deleteSelectedCards();</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineplus">+    } else {</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+      let cards = GetSelectedAbCards();</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineplus">+      for (let i = 0; i &lt; cards.length; i++) {</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineplus">+        let dirId = cards[i].directoryId</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineplus">+                            .substring(0, cards[i].directoryId.indexOf(&quot;&amp;&quot;));</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineplus">+        let directory = MailServices.ab.getDirectoryFromId(dirId);</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineplus">+</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineplus">+        let cardArray =</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineplus">+          Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineplus">+                    .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineplus">+        cardArray.appendElement(cards[i], false);</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+        if (directory)</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+          directory.deleteCards(cardArray);</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineplus">+      }</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineplus">+</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineplus">+      SetAbView(kAllDirectoryRoot + &quot;?&quot;);</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineplus">+    }</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineplus">+  }</span>
<a href="#l3.174"></a><span id="l3.174"> }</span>
<a href="#l3.175"></a><span id="l3.175"> </span>
<a href="#l3.176"></a><span id="l3.176"> function AbNewCard()</span>
<a href="#l3.177"></a><span id="l3.177"> {</span>
<a href="#l3.178"></a><span id="l3.178">   goNewCardDialog(GetSelectedDirectory());</span>
<a href="#l3.179"></a><span id="l3.179"> }</span>
<a href="#l3.180"></a><span id="l3.180"> </span>
<a href="#l3.181"></a><span id="l3.181"> function AbEditCard(card)</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineat">@@ -444,23 +484,30 @@ function DirPaneDoubleClick(event)</span>
<a href="#l3.183"></a><span id="l3.183">   }</span>
<a href="#l3.184"></a><span id="l3.184"> </span>
<a href="#l3.185"></a><span id="l3.185">   if (gDirTree &amp;&amp; gDirTree.view.selection &amp;&amp; gDirTree.view.selection.count == 1)</span>
<a href="#l3.186"></a><span id="l3.186">     AbEditSelectedDirectory();</span>
<a href="#l3.187"></a><span id="l3.187"> }</span>
<a href="#l3.188"></a><span id="l3.188"> </span>
<a href="#l3.189"></a><span id="l3.189"> function DirPaneSelectionChange()</span>
<a href="#l3.190"></a><span id="l3.190"> {</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineplus">+  let uri = GetSelectedDirectory();</span>
<a href="#l3.192"></a><span id="l3.192">   // clear out the search box when changing folders...</span>
<a href="#l3.193"></a><span id="l3.193">   onAbClearSearch();</span>
<a href="#l3.194"></a><span id="l3.194">   if (gDirTree &amp;&amp; gDirTree.view.selection &amp;&amp; gDirTree.view.selection.count == 1) {</span>
<a href="#l3.195"></a><span id="l3.195">     gPreviousDirTreeIndex = gDirTree.currentIndex;</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineminus">-    ChangeDirectoryByURI(GetSelectedDirectory());</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineplus">+    ChangeDirectoryByURI(uri);</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineplus">+    document.getElementById(&quot;localResultsOnlyMessage&quot;)</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineplus">+            .setAttribute(&quot;hidden&quot;,</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineplus">+                          !gDirectoryTreeView.hasRemoteAB ||</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineplus">+                          uri != kAllDirectoryRoot + &quot;?&quot;);</span>
<a href="#l3.202"></a><span id="l3.202">   }</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineplus">+</span>
<a href="#l3.204"></a><span id="l3.204">   goUpdateCommand('cmd_newlist');</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineplus">+  goUpdateCommand('cmd_newCard');</span>
<a href="#l3.206"></a><span id="l3.206"> }</span>
<a href="#l3.207"></a><span id="l3.207"> </span>
<a href="#l3.208"></a><span id="l3.208"> function ChangeDirectoryByURI(uri = kPersonalAddressbookURI)</span>
<a href="#l3.209"></a><span id="l3.209"> {</span>
<a href="#l3.210"></a><span id="l3.210">   SetAbView(uri);</span>
<a href="#l3.211"></a><span id="l3.211"> </span>
<a href="#l3.212"></a><span id="l3.212">   // Actively de-selecting if there are any pre-existing selections.</span>
<a href="#l3.213"></a><span id="l3.213">   if (gAbView &amp;&amp; gAbView.getCardFromRow(0))</span>
<a href="#l3.214"></a><span id="l3.214" class="difflineat">@@ -675,16 +722,17 @@ function generateQueryURI(aModelQuery, a</span>
<a href="#l3.215"></a><span id="l3.215">   return queryURI;</span>
<a href="#l3.216"></a><span id="l3.216"> }</span>
<a href="#l3.217"></a><span id="l3.217"> </span>
<a href="#l3.218"></a><span id="l3.218"> function onAbClearSearch()</span>
<a href="#l3.219"></a><span id="l3.219"> {</span>
<a href="#l3.220"></a><span id="l3.220">   var searchInput = document.getElementById(&quot;peopleSearchInput&quot;);</span>
<a href="#l3.221"></a><span id="l3.221">   if (searchInput)</span>
<a href="#l3.222"></a><span id="l3.222">     searchInput.value = &quot;&quot;;</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineplus">+</span>
<a href="#l3.224"></a><span id="l3.224">   onEnterInSearchBar();</span>
<a href="#l3.225"></a><span id="l3.225"> }</span>
<a href="#l3.226"></a><span id="l3.226"> </span>
<a href="#l3.227"></a><span id="l3.227"> // sets focus into the quick search box</span>
<a href="#l3.228"></a><span id="l3.228"> function QuickSearchFocus()</span>
<a href="#l3.229"></a><span id="l3.229"> {</span>
<a href="#l3.230"></a><span id="l3.230">   var searchInput = document.getElementById(&quot;peopleSearchInput&quot;);</span>
<a href="#l3.231"></a><span id="l3.231">   if (searchInput) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/addrbook/content/abContactsPanel.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/addrbook/content/abContactsPanel.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -55,30 +55,44 @@ function addSelectedAddresses(recipientT</span>
<a href="#l4.4"></a><span id="l4.4"> function AddressBookMenuListChange()</span>
<a href="#l4.5"></a><span id="l4.5"> {</span>
<a href="#l4.6"></a><span id="l4.6">   var searchInput = document.getElementById(&quot;peopleSearchInput&quot;);</span>
<a href="#l4.7"></a><span id="l4.7">   if (searchInput.value &amp;&amp; !searchInput.showingSearchCriteria)</span>
<a href="#l4.8"></a><span id="l4.8">     onEnterInSearchBar();</span>
<a href="#l4.9"></a><span id="l4.9">   else</span>
<a href="#l4.10"></a><span id="l4.10">     ChangeDirectoryByURI(document.getElementById('addressbookList').value);</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+  // Hide the addressbook column if the selected addressbook isn't</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  // all address books. Since, the value of the column is redundant in all</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+  // other cases.</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+  let addrbookColumn = document.getElementById(&quot;addrbook&quot;);</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+  if (abList.selectedIndex == 0) {</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+    addrbookColumn.setAttribute(&quot;hidden&quot;, gShowAbColumnInComposeSidebar);</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+    addrbookColumn.removeAttribute(&quot;ignoreincolumnpicker&quot;);</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+  } else {</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+    addrbookColumn.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+    addrbookColumn.setAttribute(&quot;ignoreincolumnpicker&quot;, &quot;true&quot;);</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+  }</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+</span>
<a href="#l4.24"></a><span id="l4.24">   CommandUpdate_AddressBook();</span>
<a href="#l4.25"></a><span id="l4.25"> }</span>
<a href="#l4.26"></a><span id="l4.26"> </span>
<a href="#l4.27"></a><span id="l4.27"> function AbPanelOnComposerClose()</span>
<a href="#l4.28"></a><span id="l4.28"> {</span>
<a href="#l4.29"></a><span id="l4.29">   CloseAbView();</span>
<a href="#l4.30"></a><span id="l4.30">   onAbClearSearch();</span>
<a href="#l4.31"></a><span id="l4.31"> }</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33"> function AbPanelOnComposerReOpen()</span>
<a href="#l4.34"></a><span id="l4.34"> {</span>
<a href="#l4.35"></a><span id="l4.35">   SetAbView(GetSelectedDirectory());</span>
<a href="#l4.36"></a><span id="l4.36"> }</span>
<a href="#l4.37"></a><span id="l4.37"> </span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+let mutationObs = null;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+</span>
<a href="#l4.40"></a><span id="l4.40"> function AbPanelLoad()</span>
<a href="#l4.41"></a><span id="l4.41"> {</span>
<a href="#l4.42"></a><span id="l4.42">   InitCommonJS();</span>
<a href="#l4.43"></a><span id="l4.43"> </span>
<a href="#l4.44"></a><span id="l4.44">   document.title = parent.document.getElementById(&quot;sidebar-title&quot;).value;</span>
<a href="#l4.45"></a><span id="l4.45"> </span>
<a href="#l4.46"></a><span id="l4.46">   var abPopup = document.getElementById('addressbookList');</span>
<a href="#l4.47"></a><span id="l4.47"> </span>
<a href="#l4.48"></a><span id="l4.48" class="difflineat">@@ -89,22 +103,42 @@ function AbPanelLoad()</span>
<a href="#l4.49"></a><span id="l4.49">   abPopup.value = temp;</span>
<a href="#l4.50"></a><span id="l4.50">   if (!abPopup.selectedItem)</span>
<a href="#l4.51"></a><span id="l4.51">     abPopup.selectedIndex = 0;</span>
<a href="#l4.52"></a><span id="l4.52"> </span>
<a href="#l4.53"></a><span id="l4.53">   ChangeDirectoryByURI(abPopup.value);</span>
<a href="#l4.54"></a><span id="l4.54"> </span>
<a href="#l4.55"></a><span id="l4.55">   parent.addEventListener(&quot;compose-window-close&quot;, AbPanelOnComposerClose, true);</span>
<a href="#l4.56"></a><span id="l4.56">   parent.addEventListener(&quot;compose-window-reopen&quot;, AbPanelOnComposerReOpen, true);</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+  mutationObs = new MutationObserver(function(aMutations) {</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+    aMutations.forEach(function(mutation) {</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+      if (GetSelectedDirectory() == (kAllDirectoryRoot + &quot;?&quot;) &amp;&amp;</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineplus">+          mutation.type == &quot;attributes&quot; &amp;&amp;</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineplus">+          mutation.attributeName == &quot;hidden&quot;) {</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+        let curState = document.getElementById(&quot;addrbook&quot;).getAttribute(&quot;hidden&quot;);</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+        if (curState == &quot;false&quot;)</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+          gShowAbColumnInComposeSidebar = true;</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+        else if (curState == &quot;true&quot;)</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+          gShowAbColumnInComposeSidebar = false;</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineplus">+      }</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+    });</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+  });</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+  document.getElementById(&quot;addrbook&quot;).setAttribute(&quot;hidden&quot;, gShowAbColumnInComposeSidbar);</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineplus">+  mutationObs.observe(document.getElementById(&quot;addrbook&quot;),</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineplus">+                      { attributes: true, childList: true });</span>
<a href="#l4.76"></a><span id="l4.76"> }</span>
<a href="#l4.77"></a><span id="l4.77"> </span>
<a href="#l4.78"></a><span id="l4.78"> function AbPanelUnload()</span>
<a href="#l4.79"></a><span id="l4.79"> {</span>
<a href="#l4.80"></a><span id="l4.80">   parent.removeEventListener(&quot;compose-window-close&quot;, AbPanelOnComposerClose, true);</span>
<a href="#l4.81"></a><span id="l4.81">   parent.removeEventListener(&quot;compose-window-reopen&quot;, AbPanelOnComposerReOpen, true);</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+  mutationObs.disconnect();</span>
<a href="#l4.83"></a><span id="l4.83"> </span>
<a href="#l4.84"></a><span id="l4.84">   CloseAbView();</span>
<a href="#l4.85"></a><span id="l4.85"> }</span>
<a href="#l4.86"></a><span id="l4.86"> </span>
<a href="#l4.87"></a><span id="l4.87"> function AbPanelNewCard()</span>
<a href="#l4.88"></a><span id="l4.88"> {</span>
<a href="#l4.89"></a><span id="l4.89">   goNewCardDialog(abList.value);</span>
<a href="#l4.90"></a><span id="l4.90"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/addrbook/content/abContactsPanel.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/addrbook/content/abContactsPanel.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -90,16 +90,20 @@</span>
<a href="#l5.4"></a><span id="l5.4">     &lt;tree id=&quot;abResultsTree&quot; flex=&quot;1&quot; context=&quot;cardProperties&quot; class=&quot;plain&quot; sortCol=&quot;GeneratedName&quot; persist=&quot;sortCol&quot;</span>
<a href="#l5.5"></a><span id="l5.5">           onclick=&quot;contactsListOnClick(event);&quot;</span>
<a href="#l5.6"></a><span id="l5.6">           onselect=&quot;this.view.selectionChanged(); document.commandDispatcher.updateCommands('addrbook-select');&quot;&gt;</span>
<a href="#l5.7"></a><span id="l5.7">       &lt;treecols&gt;</span>
<a href="#l5.8"></a><span id="l5.8">         &lt;!-- these column ids must match up to the mork column names, see nsIAddrDatabase.idl --&gt;</span>
<a href="#l5.9"></a><span id="l5.9">         &lt;treecol id=&quot;GeneratedName&quot;</span>
<a href="#l5.10"></a><span id="l5.10">                  persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot; label=&quot;&amp;GeneratedName.label;&quot; primary=&quot;true&quot;/&gt;</span>
<a href="#l5.11"></a><span id="l5.11">         &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+        &lt;treecol id=&quot;addrbook&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+                 persist=&quot;hidden ordinal width sortDirection&quot; hidden=&quot;true&quot;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+                 flex=&quot;1&quot; label=&quot;&amp;Addrbook.label;&quot;/&gt;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+        &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l5.16"></a><span id="l5.16">         &lt;treecol id=&quot;PrimaryEmail&quot;</span>
<a href="#l5.17"></a><span id="l5.17">                  persist=&quot;hidden ordinal width sortDirection&quot; hidden=&quot;true&quot;</span>
<a href="#l5.18"></a><span id="l5.18">                  flex=&quot;1&quot; label=&quot;&amp;PrimaryEmail.label;&quot;/&gt;</span>
<a href="#l5.19"></a><span id="l5.19">       &lt;/treecols&gt;</span>
<a href="#l5.20"></a><span id="l5.20">       &lt;treechildren ondraggesture=&quot;nsDragAndDrop.startDrag(event, abResultsPaneObserver);&quot;/&gt;</span>
<a href="#l5.21"></a><span id="l5.21">     &lt;/tree&gt;</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23">     &lt;separator class=&quot;thin&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/addrbook/content/abTrees.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/addrbook/content/abTrees.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -5,16 +5,77 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /**</span>
<a href="#l6.5"></a><span id="l6.5">  * This file contains our implementation for various addressbook trees.  It</span>
<a href="#l6.6"></a><span id="l6.6">  * depends on jsTreeView.js being loaded before this script is loaded.</span>
<a href="#l6.7"></a><span id="l6.7">  */</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l6.10"></a><span id="l6.10"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+// Tree Sort helper methods.</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+const AB_ORDER = [&quot;aab&quot;, &quot;pab&quot;, &quot;mork&quot;, &quot;ldap&quot;, &quot;mapi+other&quot;, &quot;anyab&quot;, &quot;cab&quot;];</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+function getDirectoryValue(aDir, aKey) {</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+  const Ci = Components.interfaces;</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+  if (aKey == &quot;ab_type&quot;) {</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+    if (aDir._directory.URI == kAllDirectoryRoot + &quot;?&quot;)</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+      return &quot;aab&quot;;</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+    if (aDir._directory.URI == kPersonalAddressbookURI)</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+      return &quot;pab&quot;;</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+    if (aDir._directory.URI == kCollectedAddressbookURI)</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+      return &quot;cab&quot;;</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+    if (aDir._directory instanceof Ci.nsIAbMDBDirectory)</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+      return &quot;mork&quot;;</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+    if (aDir._directory instanceof Ci.nsIAbLDAPDirectory)</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+      return &quot;ldap&quot;;</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+    // If there is any other AB type.</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+    return &quot;mapi+other&quot;;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+  } else if (aKey == &quot;ab_name&quot;) {</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+    return aDir._directory.dirName;</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+  }</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+  // This should never happen.</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+  return null;</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+}</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+function abNameCompare(a, b) {</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+  return a.localeCompare(b);</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+}</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+function abTypeCompare(a, b) {</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+  return (AB_ORDER.indexOf(a) - AB_ORDER.indexOf(b));</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+}</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+const SORT_PRIORITY = [&quot;ab_type&quot;, &quot;ab_name&quot;];</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+const SORT_FUNCS = [abTypeCompare, abNameCompare];</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+function abSort(a, b) {</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+  for (let i = 0; i &lt; SORT_FUNCS.length; i++) {</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+    let sortBy = SORT_PRIORITY[i];</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+    let aValue = getDirectoryValue(a, sortBy);</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+    let bValue = getDirectoryValue(b, sortBy);</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+    if (!aValue &amp;&amp; !bValue)</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+      return 0;</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+    if (!aValue)</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+      return -1;</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+    if (!bValue)</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+      return 1;</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+    if (aValue != bValue) {</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+      let result = SORT_FUNCS[i](aValue, bValue);</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+      if (result != 0)</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+        return result;</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+    }</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+  }</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+  return 0;</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+}</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+</span>
<a href="#l6.73"></a><span id="l6.73"> /**</span>
<a href="#l6.74"></a><span id="l6.74">  * Each abDirTreeItem corresponds to one row in the tree view.</span>
<a href="#l6.75"></a><span id="l6.75">  */</span>
<a href="#l6.76"></a><span id="l6.76"> function abDirTreeItem(aDirectory) {</span>
<a href="#l6.77"></a><span id="l6.77">   this._directory = aDirectory;</span>
<a href="#l6.78"></a><span id="l6.78"> }</span>
<a href="#l6.79"></a><span id="l6.79"> </span>
<a href="#l6.80"></a><span id="l6.80"> abDirTreeItem.prototype = {</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineat">@@ -33,32 +94,39 @@ abDirTreeItem.prototype = {</span>
<a href="#l6.82"></a><span id="l6.82"> </span>
<a href="#l6.83"></a><span id="l6.83">   _level: 0,</span>
<a href="#l6.84"></a><span id="l6.84">   get level() {</span>
<a href="#l6.85"></a><span id="l6.85">     return this._level;</span>
<a href="#l6.86"></a><span id="l6.86">   },</span>
<a href="#l6.87"></a><span id="l6.87"> </span>
<a href="#l6.88"></a><span id="l6.88">   _children: null,</span>
<a href="#l6.89"></a><span id="l6.89">   get children() {</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineplus">+    const Ci = Components.interfaces;</span>
<a href="#l6.91"></a><span id="l6.91">     if (!this._children) {</span>
<a href="#l6.92"></a><span id="l6.92">       this._children = [];</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-      const Ci = Components.interfaces;</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-      var myEnum = this._directory.childNodes;</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineplus">+      let myEnum;</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+      if (this._directory.URI == (kAllDirectoryRoot + &quot;?&quot;))</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineplus">+        myEnum = MailServices.ab.directories;</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineplus">+      else</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineplus">+        myEnum = this._directory.childNodes;</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineplus">+</span>
<a href="#l6.101"></a><span id="l6.101">       while (myEnum.hasMoreElements()) {</span>
<a href="#l6.102"></a><span id="l6.102">         var abItem = new abDirTreeItem(myEnum.getNext()</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineminus">-                                      .QueryInterface(Ci.nsIAbDirectory));</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineplus">+                                       .QueryInterface(Ci.nsIAbDirectory));</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineplus">+        if (gDirectoryTreeView&amp;&amp;</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineplus">+            this.id == kAllDirectoryRoot + &quot;?&quot; &amp;&amp;</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineplus">+            getDirectoryValue(abItem, &quot;ab_type&quot;) == &quot;ldap&quot;)</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineplus">+          gDirectoryTreeView.hasRemoteAB = true;</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineplus">+</span>
<a href="#l6.110"></a><span id="l6.110">         this._children.push(abItem);</span>
<a href="#l6.111"></a><span id="l6.111">         this._children[this._children.length - 1]._level = this._level + 1;</span>
<a href="#l6.112"></a><span id="l6.112">         this._children[this._children.length - 1]._parent = this;</span>
<a href="#l6.113"></a><span id="l6.113">       }</span>
<a href="#l6.114"></a><span id="l6.114"> </span>
<a href="#l6.115"></a><span id="l6.115" class="difflineminus">-      // We sort children based on their names</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineminus">-      this._children.sort(function nameSort(a, b) {</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineminus">-        return a._directory.dirName.localeCompare(b._directory.dirName);</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineminus">-      });</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineplus">+      this._children.sort(abSort);</span>
<a href="#l6.120"></a><span id="l6.120">     }</span>
<a href="#l6.121"></a><span id="l6.121">     return this._children;</span>
<a href="#l6.122"></a><span id="l6.122">   },</span>
<a href="#l6.123"></a><span id="l6.123"> </span>
<a href="#l6.124"></a><span id="l6.124">   getProperties: function atv_getProps() {</span>
<a href="#l6.125"></a><span id="l6.125">     let properties = [];</span>
<a href="#l6.126"></a><span id="l6.126">     if (this._directory.isMailList)</span>
<a href="#l6.127"></a><span id="l6.127">       properties.push(&quot;IsMailList-true&quot;);</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineat">@@ -74,17 +142,20 @@ abDirTreeItem.prototype = {</span>
<a href="#l6.129"></a><span id="l6.129">  * Our actual implementation of nsITreeView.</span>
<a href="#l6.130"></a><span id="l6.130">  */</span>
<a href="#l6.131"></a><span id="l6.131"> function directoryTreeView() {}</span>
<a href="#l6.132"></a><span id="l6.132"> directoryTreeView.prototype = {</span>
<a href="#l6.133"></a><span id="l6.133">   __proto__: new PROTO_TREE_VIEW(),</span>
<a href="#l6.134"></a><span id="l6.134"> </span>
<a href="#l6.135"></a><span id="l6.135">   PERMS_FILE: parseInt(&quot;0644&quot;, 8),</span>
<a href="#l6.136"></a><span id="l6.136"> </span>
<a href="#l6.137"></a><span id="l6.137" class="difflineplus">+  hasRemoteAB: false,</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineplus">+</span>
<a href="#l6.139"></a><span id="l6.139">   init: function dtv_init(aTree, aJSONFile) {</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineplus">+</span>
<a href="#l6.141"></a><span id="l6.141">     const Cc = Components.classes;</span>
<a href="#l6.142"></a><span id="l6.142">     const Ci = Components.interfaces;</span>
<a href="#l6.143"></a><span id="l6.143"> </span>
<a href="#l6.144"></a><span id="l6.144">     if (aJSONFile) {</span>
<a href="#l6.145"></a><span id="l6.145">       // Parse our persistent-open-state json file</span>
<a href="#l6.146"></a><span id="l6.146">       let file = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l6.147"></a><span id="l6.147">       file.append(aJSONFile);</span>
<a href="#l6.148"></a><span id="l6.148"> </span>
<a href="#l6.149"></a><span id="l6.149" class="difflineat">@@ -92,18 +163,19 @@ directoryTreeView.prototype = {</span>
<a href="#l6.150"></a><span id="l6.150">         let data = &quot;&quot;;</span>
<a href="#l6.151"></a><span id="l6.151">         let fstream = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l6.152"></a><span id="l6.152">                          .createInstance(Ci.nsIFileInputStream);</span>
<a href="#l6.153"></a><span id="l6.153">         let sstream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l6.154"></a><span id="l6.154">                          .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l6.155"></a><span id="l6.155">         fstream.init(file, -1, 0, 0);</span>
<a href="#l6.156"></a><span id="l6.156">         sstream.init(fstream);</span>
<a href="#l6.157"></a><span id="l6.157"> </span>
<a href="#l6.158"></a><span id="l6.158" class="difflineminus">-        while (sstream.available())</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineplus">+        while (sstream.available()) {</span>
<a href="#l6.160"></a><span id="l6.160">           data += sstream.read(4096);</span>
<a href="#l6.161"></a><span id="l6.161" class="difflineplus">+        }</span>
<a href="#l6.162"></a><span id="l6.162"> </span>
<a href="#l6.163"></a><span id="l6.163">         sstream.close();</span>
<a href="#l6.164"></a><span id="l6.164">         fstream.close();</span>
<a href="#l6.165"></a><span id="l6.165">         this._persistOpenMap = JSON.parse(data);</span>
<a href="#l6.166"></a><span id="l6.166">       }</span>
<a href="#l6.167"></a><span id="l6.167">     }</span>
<a href="#l6.168"></a><span id="l6.168"> </span>
<a href="#l6.169"></a><span id="l6.169">     this._rebuild();</span>
<a href="#l6.170"></a><span id="l6.170" class="difflineat">@@ -159,83 +231,39 @@ directoryTreeView.prototype = {</span>
<a href="#l6.171"></a><span id="l6.171">     var oldCount = this._rowMap.length;</span>
<a href="#l6.172"></a><span id="l6.172">     this._rowMap = [];</span>
<a href="#l6.173"></a><span id="l6.173"> </span>
<a href="#l6.174"></a><span id="l6.174">     const Cc = Components.classes;</span>
<a href="#l6.175"></a><span id="l6.175">     const Ci = Components.interfaces;</span>
<a href="#l6.176"></a><span id="l6.176"> </span>
<a href="#l6.177"></a><span id="l6.177">     var dirEnum = MailServices.ab.directories;</span>
<a href="#l6.178"></a><span id="l6.178"> </span>
<a href="#l6.179"></a><span id="l6.179" class="difflineminus">-    while (dirEnum.hasMoreElements()) {</span>
<a href="#l6.180"></a><span id="l6.180" class="difflineminus">-      this._rowMap.push(new abDirTreeItem(dirEnum.getNext().QueryInterface(Ci.nsIAbDirectory)));</span>
<a href="#l6.181"></a><span id="l6.181" class="difflineminus">-    }</span>
<a href="#l6.182"></a><span id="l6.182" class="difflineplus">+    // Make an entry for All Address Books.</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineplus">+    let rootAB = MailServices.ab.getDirectory(kAllDirectoryRoot + &quot;?&quot;);</span>
<a href="#l6.184"></a><span id="l6.184" class="difflineplus">+    rootAB.dirName = gAddressBookBundle.getString(&quot;allAddressBooks&quot;);</span>
<a href="#l6.185"></a><span id="l6.185" class="difflineplus">+    this._rowMap.push(new abDirTreeItem(rootAB));</span>
<a href="#l6.186"></a><span id="l6.186"> </span>
<a href="#l6.187"></a><span id="l6.187">     // Sort our addressbooks now</span>
<a href="#l6.188"></a><span id="l6.188" class="difflineminus">-</span>
<a href="#l6.189"></a><span id="l6.189" class="difflineminus">-    const AB_ORDER = [&quot;pab&quot;, &quot;mork&quot;, &quot;ldap&quot;, &quot;mapi+other&quot;, &quot;cab&quot;];</span>
<a href="#l6.190"></a><span id="l6.190" class="difflineminus">-</span>
<a href="#l6.191"></a><span id="l6.191" class="difflineminus">-    function getDirectoryValue(aDir, aKey) {</span>
<a href="#l6.192"></a><span id="l6.192" class="difflineminus">-      if (aKey == &quot;ab_type&quot;) {</span>
<a href="#l6.193"></a><span id="l6.193" class="difflineminus">-        if (aDir._directory.URI == kPersonalAddressbookURI)</span>
<a href="#l6.194"></a><span id="l6.194" class="difflineminus">-          return &quot;pab&quot;;</span>
<a href="#l6.195"></a><span id="l6.195" class="difflineminus">-        if (aDir._directory.URI == kCollectedAddressbookURI)</span>
<a href="#l6.196"></a><span id="l6.196" class="difflineminus">-          return &quot;cab&quot;;</span>
<a href="#l6.197"></a><span id="l6.197" class="difflineminus">-        if (aDir._directory instanceof Ci.nsIAbMDBDirectory)</span>
<a href="#l6.198"></a><span id="l6.198" class="difflineminus">-          return &quot;mork&quot;;</span>
<a href="#l6.199"></a><span id="l6.199" class="difflineminus">-        if (aDir._directory instanceof Ci.nsIAbLDAPDirectory)</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineminus">-          return &quot;ldap&quot;;</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineminus">-        return &quot;mapi+other&quot;;</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineminus">-      } else if (aKey == &quot;ab_name&quot;) {</span>
<a href="#l6.203"></a><span id="l6.203" class="difflineminus">-        return aDir._directory.dirName;</span>
<a href="#l6.204"></a><span id="l6.204" class="difflineminus">-      }</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineminus">-      // This should never happen.</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineminus">-      return null;</span>
<a href="#l6.207"></a><span id="l6.207" class="difflineminus">-    }</span>
<a href="#l6.208"></a><span id="l6.208" class="difflineminus">-</span>
<a href="#l6.209"></a><span id="l6.209" class="difflineminus">-    function abNameCompare(a, b) {</span>
<a href="#l6.210"></a><span id="l6.210" class="difflineminus">-      return a.localeCompare(b);</span>
<a href="#l6.211"></a><span id="l6.211" class="difflineminus">-    }</span>
<a href="#l6.212"></a><span id="l6.212" class="difflineminus">-</span>
<a href="#l6.213"></a><span id="l6.213" class="difflineminus">-    function abTypeCompare(a, b) {</span>
<a href="#l6.214"></a><span id="l6.214" class="difflineminus">-      return (AB_ORDER.indexOf(a) - AB_ORDER.indexOf(b));</span>
<a href="#l6.215"></a><span id="l6.215" class="difflineminus">-    }</span>
<a href="#l6.216"></a><span id="l6.216" class="difflineminus">-</span>
<a href="#l6.217"></a><span id="l6.217" class="difflineminus">-    const SORT_PRIORITY = [&quot;ab_type&quot;, &quot;ab_name&quot;];</span>
<a href="#l6.218"></a><span id="l6.218" class="difflineminus">-    const SORT_FUNCS = [abTypeCompare, abNameCompare];</span>
<a href="#l6.219"></a><span id="l6.219" class="difflineminus">-</span>
<a href="#l6.220"></a><span id="l6.220" class="difflineminus">-    function abSort(a, b) {</span>
<a href="#l6.221"></a><span id="l6.221" class="difflineminus">-      for (let i = 0; i &lt; SORT_FUNCS.length; i++) {</span>
<a href="#l6.222"></a><span id="l6.222" class="difflineminus">-        let sortBy = SORT_PRIORITY[i];</span>
<a href="#l6.223"></a><span id="l6.223" class="difflineminus">-        let aValue = getDirectoryValue(a, sortBy);</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineminus">-        let bValue = getDirectoryValue(b, sortBy);</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineminus">-</span>
<a href="#l6.226"></a><span id="l6.226" class="difflineminus">-        if (!aValue &amp;&amp; !bValue)</span>
<a href="#l6.227"></a><span id="l6.227" class="difflineminus">-          return 0;</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineminus">-        if (!aValue)</span>
<a href="#l6.229"></a><span id="l6.229" class="difflineminus">-          return -1;</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineminus">-        if (!bValue)</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineminus">-          return 1;</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineminus">-        if (aValue != bValue) {</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineminus">-          let result = SORT_FUNCS[i](aValue, bValue);</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineminus">-</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineminus">-          if (result != 0)</span>
<a href="#l6.236"></a><span id="l6.236" class="difflineminus">-            return result;</span>
<a href="#l6.237"></a><span id="l6.237" class="difflineminus">-        }</span>
<a href="#l6.238"></a><span id="l6.238" class="difflineminus">-      }</span>
<a href="#l6.239"></a><span id="l6.239" class="difflineminus">-      return 0;</span>
<a href="#l6.240"></a><span id="l6.240" class="difflineminus">-    }</span>
<a href="#l6.241"></a><span id="l6.241" class="difflineminus">-</span>
<a href="#l6.242"></a><span id="l6.242">     this._rowMap.sort(abSort);</span>
<a href="#l6.243"></a><span id="l6.243"> </span>
<a href="#l6.244"></a><span id="l6.244">     if (this._tree)</span>
<a href="#l6.245"></a><span id="l6.245">       this._tree.rowCountChanged(0, this._rowMap.length - oldCount);</span>
<a href="#l6.246"></a><span id="l6.246"> </span>
<a href="#l6.247"></a><span id="l6.247">     this._restoreOpenStates();</span>
<a href="#l6.248"></a><span id="l6.248">   },</span>
<a href="#l6.249"></a><span id="l6.249"> </span>
<a href="#l6.250"></a><span id="l6.250" class="difflineplus">+  getIndexForId: function(aId) {</span>
<a href="#l6.251"></a><span id="l6.251" class="difflineplus">+    for (let i = 0; i &lt; this._rowMap.length; i++) {</span>
<a href="#l6.252"></a><span id="l6.252" class="difflineplus">+      if (this._rowMap[i].id == aId)</span>
<a href="#l6.253"></a><span id="l6.253" class="difflineplus">+        return i;</span>
<a href="#l6.254"></a><span id="l6.254" class="difflineplus">+    }</span>
<a href="#l6.255"></a><span id="l6.255" class="difflineplus">+</span>
<a href="#l6.256"></a><span id="l6.256" class="difflineplus">+    return -1;</span>
<a href="#l6.257"></a><span id="l6.257" class="difflineplus">+  },</span>
<a href="#l6.258"></a><span id="l6.258" class="difflineplus">+</span>
<a href="#l6.259"></a><span id="l6.259">   // nsIAbListener interfaces</span>
<a href="#l6.260"></a><span id="l6.260">   onItemAdded: function dtv_onItemAdded(aParent, aItem) {</span>
<a href="#l6.261"></a><span id="l6.261">     if (!(aItem instanceof Components.interfaces.nsIAbDirectory))</span>
<a href="#l6.262"></a><span id="l6.262">       return;</span>
<a href="#l6.263"></a><span id="l6.263">     //xxx we can optimize this later</span>
<a href="#l6.264"></a><span id="l6.264">     this._rebuild();</span>
<a href="#l6.265"></a><span id="l6.265"> </span>
<a href="#l6.266"></a><span id="l6.266">     if (!this._tree)</span>
<a href="#l6.267"></a><span id="l6.267" class="difflineat">@@ -255,17 +283,18 @@ directoryTreeView.prototype = {</span>
<a href="#l6.268"></a><span id="l6.268">       return;</span>
<a href="#l6.269"></a><span id="l6.269">     //xxx we can optimize this later</span>
<a href="#l6.270"></a><span id="l6.270">     this._rebuild();</span>
<a href="#l6.271"></a><span id="l6.271"> </span>
<a href="#l6.272"></a><span id="l6.272">     if (!this._tree)</span>
<a href="#l6.273"></a><span id="l6.273">       return;</span>
<a href="#l6.274"></a><span id="l6.274"> </span>
<a href="#l6.275"></a><span id="l6.275">     // If we're deleting a top-level address-book, just select the first book</span>
<a href="#l6.276"></a><span id="l6.276" class="difflineminus">-    if (aParent.URI == &quot;moz-abdirectory://&quot;) {</span>
<a href="#l6.277"></a><span id="l6.277" class="difflineplus">+    if (aParent.URI == kAllDirectoryRoot ||</span>
<a href="#l6.278"></a><span id="l6.278" class="difflineplus">+        aParent.URI == kAllDirectoryRoot + &quot;?&quot;) {</span>
<a href="#l6.279"></a><span id="l6.279">       this.selection.select(0);</span>
<a href="#l6.280"></a><span id="l6.280">       return;</span>
<a href="#l6.281"></a><span id="l6.281">     }</span>
<a href="#l6.282"></a><span id="l6.282"> </span>
<a href="#l6.283"></a><span id="l6.283">     // Now select this parent item</span>
<a href="#l6.284"></a><span id="l6.284">     for (var [i, row] in Iterator(this._rowMap)) {</span>
<a href="#l6.285"></a><span id="l6.285">       if (row.id == aParent.URI) {</span>
<a href="#l6.286"></a><span id="l6.286">         this.selection.select(i);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -245,17 +245,16 @@ function GetCurrentPrefs()</span>
<a href="#l7.4"></a><span id="l7.4">       Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l7.5"></a><span id="l7.5">   // show phonetic fields if indicated by the pref</span>
<a href="#l7.6"></a><span id="l7.6">   if (showPhoneticFields == &quot;true&quot;)</span>
<a href="#l7.7"></a><span id="l7.7">     document.getElementById(&quot;cmd_SortBy_PhoneticName&quot;)</span>
<a href="#l7.8"></a><span id="l7.8">             .setAttribute(&quot;hidden&quot;, &quot;false&quot;);</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10"> }</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-</span>
<a href="#l7.13"></a><span id="l7.13"> function SetNameColumn(cmd)</span>
<a href="#l7.14"></a><span id="l7.14"> {</span>
<a href="#l7.15"></a><span id="l7.15">   var prefValue;</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17">   switch ( cmd )</span>
<a href="#l7.18"></a><span id="l7.18">   {</span>
<a href="#l7.19"></a><span id="l7.19">     case 'firstLastCmd':</span>
<a href="#l7.20"></a><span id="l7.20">       prefValue = kFirstNameFirst;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -458,17 +457,20 @@ function SetStatusText(total)</span>
<a href="#l7.22"></a><span id="l7.22">       {</span>
<a href="#l7.23"></a><span id="l7.23">         if (total == 1)</span>
<a href="#l7.24"></a><span id="l7.24">           statusText = gAddressBookBundle.getString(&quot;matchFound&quot;);</span>
<a href="#l7.25"></a><span id="l7.25">         else</span>
<a href="#l7.26"></a><span id="l7.26">           statusText = gAddressBookBundle.getFormattedString(&quot;matchesFound&quot;, [total]);</span>
<a href="#l7.27"></a><span id="l7.27">       }</span>
<a href="#l7.28"></a><span id="l7.28">     }</span>
<a href="#l7.29"></a><span id="l7.29">     else</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-      statusText = gAddressBookBundle.getFormattedString(&quot;totalContactStatus&quot;, [gAbView.directory.dirName, total]);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+      statusText =</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+        gAddressBookBundle.getFormattedString(</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+          &quot;totalContactStatus&quot;,</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+          [GetDirectoryFromURI(GetSelectedDirectory()).dirName, total]);</span>
<a href="#l7.35"></a><span id="l7.35"> </span>
<a href="#l7.36"></a><span id="l7.36">     gStatusText.setAttribute(&quot;label&quot;, statusText);</span>
<a href="#l7.37"></a><span id="l7.37">   }</span>
<a href="#l7.38"></a><span id="l7.38">   catch(ex) {</span>
<a href="#l7.39"></a><span id="l7.39">     Components.utils.reportError(&quot;ERROR: failed to set status text:  &quot; + ex );</span>
<a href="#l7.40"></a><span id="l7.40">   }</span>
<a href="#l7.41"></a><span id="l7.41"> }</span>
<a href="#l7.42"></a><span id="l7.42"> </span>
<a href="#l7.43"></a><span id="l7.43" class="difflineat">@@ -495,17 +497,16 @@ function onAdvancedAbSearch()</span>
<a href="#l7.44"></a><span id="l7.44">     window.openDialog(&quot;chrome://messenger/content/ABSearchDialog.xul&quot;, &quot;&quot;,</span>
<a href="#l7.45"></a><span id="l7.45">                       &quot;chrome,resizable,status,centerscreen,dialog=no&quot;,</span>
<a href="#l7.46"></a><span id="l7.46">                       {directory: selectedABURI});</span>
<a href="#l7.47"></a><span id="l7.47"> }</span>
<a href="#l7.48"></a><span id="l7.48"> </span>
<a href="#l7.49"></a><span id="l7.49"> function onEnterInSearchBar()</span>
<a href="#l7.50"></a><span id="l7.50"> {</span>
<a href="#l7.51"></a><span id="l7.51">   ClearCardViewPane();</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-</span>
<a href="#l7.53"></a><span id="l7.53">   if (!gQueryURIFormat) {</span>
<a href="#l7.54"></a><span id="l7.54">     gQueryURIFormat = Services.prefs</span>
<a href="#l7.55"></a><span id="l7.55">       .getComplexValue(&quot;mail.addr_book.quicksearchquery.format&quot;,</span>
<a href="#l7.56"></a><span id="l7.56">                        Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l7.57"></a><span id="l7.57"> </span>
<a href="#l7.58"></a><span id="l7.58">     // Remove the preceeding '?' as we have to prefix &quot;?and&quot; to this format.</span>
<a href="#l7.59"></a><span id="l7.59">     gQueryURIFormat = gQueryURIFormat.slice(1);</span>
<a href="#l7.60"></a><span id="l7.60">   }</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineat">@@ -521,16 +522,24 @@ function onEnterInSearchBar()</span>
<a href="#l7.62"></a><span id="l7.62">   var searchInput = document.getElementById(&quot;peopleSearchInput&quot;);</span>
<a href="#l7.63"></a><span id="l7.63">   // Use helper method to split up search query to multi-word search</span>
<a href="#l7.64"></a><span id="l7.64">   // query against multiple fields.</span>
<a href="#l7.65"></a><span id="l7.65">   if (searchInput) {</span>
<a href="#l7.66"></a><span id="l7.66">     let searchWords = getSearchTokens(searchInput.value);</span>
<a href="#l7.67"></a><span id="l7.67">     searchURI += generateQueryURI(gQueryURIFormat, searchWords);</span>
<a href="#l7.68"></a><span id="l7.68">   }</span>
<a href="#l7.69"></a><span id="l7.69"> </span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+  if (searchURI == kAllDirectoryRoot)</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+    searchURI += &quot;?&quot;;</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+  document.getElementById(&quot;localResultsOnlyMessage&quot;)</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineplus">+            .setAttribute(&quot;hidden&quot;,</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineplus">+                          !gDirectoryTreeView.hasRemoteAB ||</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+                          searchURI != kAllDirectoryRoot + &quot;?&quot;);</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+</span>
<a href="#l7.78"></a><span id="l7.78">   SetAbView(searchURI);</span>
<a href="#l7.79"></a><span id="l7.79"> </span>
<a href="#l7.80"></a><span id="l7.80">   // XXX todo</span>
<a href="#l7.81"></a><span id="l7.81">   // this works for synchronous searches of local addressbooks,</span>
<a href="#l7.82"></a><span id="l7.82">   // but not for LDAP searches</span>
<a href="#l7.83"></a><span id="l7.83">   SelectFirstCard();</span>
<a href="#l7.84"></a><span id="l7.84"> }</span>
<a href="#l7.85"></a><span id="l7.85"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -73,16 +73,17 @@</span>
<a href="#l8.4"></a><span id="l8.4">               commandupdater=&quot;true&quot;</span>
<a href="#l8.5"></a><span id="l8.5">               events=&quot;undo&quot;</span>
<a href="#l8.6"></a><span id="l8.6">               oncommandupdate=&quot;goUpdateUndoEditMenuItems()&quot;/&gt;</span>
<a href="#l8.7"></a><span id="l8.7">   &lt;commandset id=&quot;globalEditMenuItems&quot;</span>
<a href="#l8.8"></a><span id="l8.8">               commandupdater=&quot;true&quot;</span>
<a href="#l8.9"></a><span id="l8.9">               events=&quot;focus&quot;</span>
<a href="#l8.10"></a><span id="l8.10">               oncommandupdate=&quot;goUpdateGlobalEditMenuItems()&quot;/&gt;</span>
<a href="#l8.11"></a><span id="l8.11">     &lt;command id=&quot;cmd_newlist&quot; oncommand=&quot;goDoCommand('cmd_newlist');&quot;/&gt;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+    &lt;command id=&quot;cmd_newCard&quot; oncommand=&quot;goDoCommand('cmd_newCard');&quot;/&gt;</span>
<a href="#l8.13"></a><span id="l8.13">     &lt;command id=&quot;cmd_printcardpreview&quot; oncommand=&quot;AbPrintPreviewCard();&quot;/&gt;</span>
<a href="#l8.14"></a><span id="l8.14">     &lt;command id=&quot;cmd_printcard&quot; oncommand=&quot;AbPrintCard();&quot;/&gt;</span>
<a href="#l8.15"></a><span id="l8.15">     &lt;command id=&quot;cmd_properties&quot; oncommand=&quot;goDoCommand('cmd_properties');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l8.16"></a><span id="l8.16">     &lt;command id=&quot;cmd_undo&quot; oncommand=&quot;goDoCommand('cmd_undo')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l8.17"></a><span id="l8.17">     &lt;command id=&quot;cmd_redo&quot; oncommand=&quot;goDoCommand('cmd_redo')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l8.18"></a><span id="l8.18">     &lt;command id=&quot;cmd_cut&quot; oncommand=&quot;goDoCommand('cmd_cut')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l8.19"></a><span id="l8.19">     &lt;command id=&quot;cmd_copy&quot; oncommand=&quot;goDoCommand('cmd_copy')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l8.20"></a><span id="l8.20">     &lt;command id=&quot;cmd_paste&quot; oncommand=&quot;goDoCommand('cmd_paste')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineat">@@ -116,17 +117,17 @@</span>
<a href="#l8.22"></a><span id="l8.22"> &lt;keyset id=&quot;tasksKeys&quot;&gt;</span>
<a href="#l8.23"></a><span id="l8.23">   &lt;!-- File Menu --&gt;</span>
<a href="#l8.24"></a><span id="l8.24"> #ifdef XP_MACOSX</span>
<a href="#l8.25"></a><span id="l8.25">   &lt;key id=&quot;key_newMessage&quot; key=&quot;&amp;newMessageCmd.key;&quot; modifiers=&quot;accel,shift&quot; oncommand=&quot;AbNewMessage()&quot;/&gt;</span>
<a href="#l8.26"></a><span id="l8.26"> #else</span>
<a href="#l8.27"></a><span id="l8.27">   &lt;key id=&quot;key_newMessage&quot; key=&quot;&amp;newMessageCmd.key;&quot; modifiers=&quot;accel&quot; oncommand=&quot;AbNewMessage()&quot;/&gt;</span>
<a href="#l8.28"></a><span id="l8.28"> #endif</span>
<a href="#l8.29"></a><span id="l8.29">   &lt;key id=&quot;key_newCard&quot; key=&quot;&amp;newContact.key;&quot; modifiers=&quot;accel&quot;</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-       oncommand=&quot;AbNewCard();&quot;/&gt;</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+       command=&quot;cmd_newCard&quot;/&gt;</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33">   &lt;key id=&quot;key_printCard&quot; key=&quot;&amp;printContactCmd.key;&quot; command=&quot;cmd_printcard&quot;</span>
<a href="#l8.34"></a><span id="l8.34">        modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l8.35"></a><span id="l8.35">   &lt;key id=&quot;key_close&quot; key=&quot;&amp;closeCmd.key;&quot; modifiers=&quot;accel&quot; oncommand=&quot;AbClose()&quot;/&gt;</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37">   &lt;!-- Edit Menu --&gt;</span>
<a href="#l8.38"></a><span id="l8.38">   &lt;key id=&quot;key_undo&quot; key=&quot;&amp;undoCmd.key;&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l8.39"></a><span id="l8.39">   &lt;key id=&quot;key_redo&quot;</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineat">@@ -175,17 +176,17 @@</span>
<a href="#l8.41"></a><span id="l8.41"> </span>
<a href="#l8.42"></a><span id="l8.42"> &lt;menupopup id=&quot;dirTreeContext&quot;&gt;</span>
<a href="#l8.43"></a><span id="l8.43">   &lt;menuitem id=&quot;dirTreeContext-properties&quot;</span>
<a href="#l8.44"></a><span id="l8.44">             label=&quot;&amp;editButton2.label;&quot;</span>
<a href="#l8.45"></a><span id="l8.45">             accesskey=&quot;&amp;editButton2.accesskey;&quot;</span>
<a href="#l8.46"></a><span id="l8.46">             command=&quot;cmd_properties&quot;/&gt;</span>
<a href="#l8.47"></a><span id="l8.47">   &lt;menuseparator/&gt;</span>
<a href="#l8.48"></a><span id="l8.48">   &lt;menuitem id=&quot;dirTreeContext-newcard&quot; label=&quot;&amp;newContactButton.label;&quot;</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-            accesskey=&quot;&amp;newContactButton.accesskey;&quot; oncommand=&quot;AbNewCard();&quot;/&gt;</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+            accesskey=&quot;&amp;newContactButton.accesskey;&quot; command=&quot;cmd_newCard&quot;/&gt;</span>
<a href="#l8.51"></a><span id="l8.51">   &lt;menuitem id=&quot;dirTreeContext-newlist&quot;</span>
<a href="#l8.52"></a><span id="l8.52">             label=&quot;&amp;newlistButton.label;&quot;</span>
<a href="#l8.53"></a><span id="l8.53">             accesskey=&quot;&amp;newlistButton.accesskey;&quot;</span>
<a href="#l8.54"></a><span id="l8.54">             command=&quot;cmd_newlist&quot;/&gt;</span>
<a href="#l8.55"></a><span id="l8.55">   &lt;menuseparator/&gt;</span>
<a href="#l8.56"></a><span id="l8.56">   &lt;menuitem id=&quot;dirTreeContext-delete&quot;</span>
<a href="#l8.57"></a><span id="l8.57">             label=&quot;&amp;deleteButton2.label;&quot;</span>
<a href="#l8.58"></a><span id="l8.58">             accesskey=&quot;&amp;deleteButton2.accesskey;&quot;</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineat">@@ -254,17 +255,17 @@</span>
<a href="#l8.60"></a><span id="l8.60"> #else</span>
<a href="#l8.61"></a><span id="l8.61">             &lt;menupopup id=&quot;menu_FilePopup&quot;&gt;</span>
<a href="#l8.62"></a><span id="l8.62"> #endif</span>
<a href="#l8.63"></a><span id="l8.63">                 &lt;menu id=&quot;menu_New&quot; label=&quot;&amp;newMenu.label;&quot; accesskey=&quot;&amp;newMenu.accesskey;&quot;&gt;</span>
<a href="#l8.64"></a><span id="l8.64">                     &lt;menupopup id=&quot;menu_NewPopup&quot;&gt;</span>
<a href="#l8.65"></a><span id="l8.65">                       &lt;menuitem id=&quot;menu_newContact&quot;</span>
<a href="#l8.66"></a><span id="l8.66">                                 label=&quot;&amp;newContact.label;&quot;</span>
<a href="#l8.67"></a><span id="l8.67">                                 accesskey=&quot;&amp;newContact.accesskey;&quot;</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-                                key=&quot;key_newCard&quot; oncommand=&quot;AbNewCard();&quot;/&gt;</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+                                key=&quot;key_newCard&quot; command=&quot;cmd_newCard&quot;/&gt;</span>
<a href="#l8.70"></a><span id="l8.70">                       &lt;menuitem id=&quot;menu_newList&quot;</span>
<a href="#l8.71"></a><span id="l8.71">                                 label=&quot;&amp;newListCmd.label;&quot;</span>
<a href="#l8.72"></a><span id="l8.72">                                 accesskey=&quot;&amp;newListCmd.accesskey;&quot;</span>
<a href="#l8.73"></a><span id="l8.73">                                 command=&quot;cmd_newlist&quot;/&gt;</span>
<a href="#l8.74"></a><span id="l8.74">                       &lt;menuitem id=&quot;menu_newAddrbook&quot;</span>
<a href="#l8.75"></a><span id="l8.75">                                 label=&quot;&amp;newAddressBookCmd.label;&quot;</span>
<a href="#l8.76"></a><span id="l8.76">                                 accesskey=&quot;&amp;newAddressBookCmd.accesskey;&quot;</span>
<a href="#l8.77"></a><span id="l8.77">                                 oncommand=&quot;AbNewAddressBook()&quot;/&gt;</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineat">@@ -501,16 +502,20 @@</span>
<a href="#l8.79"></a><span id="l8.79">                         &lt;menuitem label=&quot;&amp;HomePhone.label;&quot;</span>
<a href="#l8.80"></a><span id="l8.80">                                   id=&quot;cmd_SortByHomePhone&quot;</span>
<a href="#l8.81"></a><span id="l8.81">                                   accesskey=&quot;&amp;HomePhone.accesskey;&quot;</span>
<a href="#l8.82"></a><span id="l8.82">                                   oncommand=&quot;SortResultPane('HomePhone');&quot; name=&quot;sortas&quot; type=&quot;radio&quot; checked=&quot;true&quot;/&gt;</span>
<a href="#l8.83"></a><span id="l8.83">                         &lt;menuitem label=&quot;&amp;WorkPhone.label;&quot;</span>
<a href="#l8.84"></a><span id="l8.84">                                   id=&quot;cmd_SortByWorkPhone&quot;</span>
<a href="#l8.85"></a><span id="l8.85">                                   accesskey=&quot;&amp;WorkPhone.accesskey;&quot;</span>
<a href="#l8.86"></a><span id="l8.86">                                   oncommand=&quot;SortResultPane('WorkPhone');&quot; name=&quot;sortas&quot; type=&quot;radio&quot; checked=&quot;true&quot;/&gt;</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineplus">+                        &lt;menuitem label=&quot;&amp;Addrbook.label;&quot;</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineplus">+                                  id=&quot;cmd_SortByaddrbook&quot;</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineplus">+                                  accesskey=&quot;&amp;Addrbook.accesskey;&quot;</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineplus">+                                  oncommand=&quot;SortResultPane('addrbook');&quot; name=&quot;sortas&quot; type=&quot;radio&quot; checked=&quot;true&quot;/&gt;</span>
<a href="#l8.91"></a><span id="l8.91">                         &lt;menuseparator/&gt;</span>
<a href="#l8.92"></a><span id="l8.92">                         &lt;menuitem id=&quot;sortAscending&quot; type=&quot;radio&quot; name=&quot;sortdirection&quot; label=&quot;&amp;sortAscending.label;&quot; accesskey=&quot;&amp;sortAscending.accesskey;&quot; oncommand=&quot;AbSortAscending()&quot;/&gt;</span>
<a href="#l8.93"></a><span id="l8.93">                         &lt;menuitem id=&quot;sortDescending&quot; type=&quot;radio&quot; name=&quot;sortdirection&quot; label=&quot;&amp;sortDescending.label;&quot; accesskey=&quot;&amp;sortDescending.accesskey;&quot; oncommand=&quot;AbSortDescending()&quot;/&gt;</span>
<a href="#l8.94"></a><span id="l8.94">                     &lt;/menupopup&gt;</span>
<a href="#l8.95"></a><span id="l8.95">                 &lt;/menu&gt;</span>
<a href="#l8.96"></a><span id="l8.96">             &lt;/menupopup&gt;</span>
<a href="#l8.97"></a><span id="l8.97">         &lt;/menu&gt;</span>
<a href="#l8.98"></a><span id="l8.98"> </span>
<a href="#l8.99"></a><span id="l8.99" class="difflineat">@@ -553,30 +558,29 @@</span>
<a href="#l8.100"></a><span id="l8.100">       &lt;!-- Help --&gt;</span>
<a href="#l8.101"></a><span id="l8.101">       &lt;menu id=&quot;helpMenu&quot;/&gt;</span>
<a href="#l8.102"></a><span id="l8.102">     &lt;/menubar&gt;</span>
<a href="#l8.103"></a><span id="l8.103">    &lt;/toolbaritem&gt;</span>
<a href="#l8.104"></a><span id="l8.104">   &lt;/toolbar&gt;</span>
<a href="#l8.105"></a><span id="l8.105"> </span>
<a href="#l8.106"></a><span id="l8.106">   &lt;toolbarpalette id=&quot;AddressBookToolbarPalette&quot;&gt;</span>
<a href="#l8.107"></a><span id="l8.107">       &lt;toolbarbutton class=&quot;toolbarbutton-1&quot; id=&quot;button-newcard&quot;</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineminus">-                     label=&quot;&amp;newContactButton.label;&quot; oncommand=&quot;AbNewCard();&quot;</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineplus">+                     label=&quot;&amp;newContactButton.label;&quot; command=&quot;cmd_newCard&quot;</span>
<a href="#l8.110"></a><span id="l8.110">                      tooltiptext=&quot;&amp;newContactButton.tooltip;&quot;/&gt;</span>
<a href="#l8.111"></a><span id="l8.111">       &lt;toolbarbutton class=&quot;toolbarbutton-1&quot; id=&quot;button-newlist&quot; label=&quot;&amp;newlistButton.label;&quot; tooltiptext=&quot;&amp;newlistButton.tooltip;&quot; command=&quot;cmd_newlist&quot;/&gt;</span>
<a href="#l8.112"></a><span id="l8.112">       &lt;toolbarbutton class=&quot;toolbarbutton-1&quot; id=&quot;button-editcard&quot;</span>
<a href="#l8.113"></a><span id="l8.113">                      label=&quot;&amp;editButton2.label;&quot;</span>
<a href="#l8.114"></a><span id="l8.114">                      tooltiptext=&quot;&amp;editButton2.tooltip;&quot;</span>
<a href="#l8.115"></a><span id="l8.115">                      command=&quot;cmd_properties&quot;/&gt;</span>
<a href="#l8.116"></a><span id="l8.116">       &lt;toolbarbutton class=&quot;toolbarbutton-1&quot; id=&quot;button-newmessage&quot; label=&quot;&amp;newmsgButton.label;&quot; tooltiptext=&quot;&amp;newmsgButton.tooltip;&quot; oncommand=&quot;AbNewMessage();&quot;/&gt;</span>
<a href="#l8.117"></a><span id="l8.117">       &lt;toolbarbutton class=&quot;toolbarbutton-1&quot; id=&quot;button-newim&quot; label=&quot;&amp;newIM.label;&quot; tooltiptext=&quot;&amp;newIM.tooltip;&quot; command=&quot;cmd_chatWithCard&quot;/&gt;</span>
<a href="#l8.118"></a><span id="l8.118">       &lt;toolbarbutton class=&quot;toolbarbutton-1&quot; id=&quot;button-abdelete&quot;</span>
<a href="#l8.119"></a><span id="l8.119">                      observes=&quot;button_delete&quot; label=&quot;&amp;deleteButton2.label;&quot;</span>
<a href="#l8.120"></a><span id="l8.120">                      tooltiptext=&quot;&amp;deleteButton2.tooltip;&quot;</span>
<a href="#l8.121"></a><span id="l8.121">                      oncommand=&quot;goDoCommand('button_delete');&quot;/&gt;</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineminus">-</span>
<a href="#l8.123"></a><span id="l8.123">       &lt;toolbaritem id=&quot;search-container&quot; title=&quot;&amp;searchItem.title;&quot;</span>
<a href="#l8.124"></a><span id="l8.124">                    align=&quot;center&quot; flex=&quot;1&quot;</span>
<a href="#l8.125"></a><span id="l8.125">                    class=&quot;chromeclass-toolbar-additional&quot;&gt;</span>
<a href="#l8.126"></a><span id="l8.126">         &lt;textbox id=&quot;peopleSearchInput&quot; flex=&quot;1&quot; timeout=&quot;800&quot;</span>
<a href="#l8.127"></a><span id="l8.127">                  type=&quot;search&quot;</span>
<a href="#l8.128"></a><span id="l8.128">                  placeholder=&quot;&amp;SearchNameOrEmail.label;&quot;</span>
<a href="#l8.129"></a><span id="l8.129">                  oncommand=&quot;onEnterInSearchBar();&quot;/&gt;</span>
<a href="#l8.130"></a><span id="l8.130">       &lt;/toolbaritem&gt;</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineat">@@ -620,17 +624,23 @@</span>
<a href="#l8.132"></a><span id="l8.132">         &lt;/treecols&gt;</span>
<a href="#l8.133"></a><span id="l8.133">         &lt;treechildren/&gt;</span>
<a href="#l8.134"></a><span id="l8.134">       &lt;/tree&gt;</span>
<a href="#l8.135"></a><span id="l8.135">     &lt;/vbox&gt;</span>
<a href="#l8.136"></a><span id="l8.136"> </span>
<a href="#l8.137"></a><span id="l8.137">     &lt;splitter id=&quot;dirTree-splitter&quot; collapse=&quot;before&quot; persist=&quot;state&quot;/&gt;</span>
<a href="#l8.138"></a><span id="l8.138"> </span>
<a href="#l8.139"></a><span id="l8.139">     &lt;vbox flex=&quot;1&quot; minwidth=&quot;100&quot;&gt;</span>
<a href="#l8.140"></a><span id="l8.140" class="difflineminus">-</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineplus">+      &lt;description id=&quot;localResultsOnlyMessage&quot;</span>
<a href="#l8.142"></a><span id="l8.142" class="difflineplus">+                   value=&quot;&amp;localResultsOnlyMessage.label;&quot;/&gt;</span>
<a href="#l8.143"></a><span id="l8.143" class="difflineplus">+      &lt;vbox id=&quot;blankResultsPaneMessageBox&quot;</span>
<a href="#l8.144"></a><span id="l8.144" class="difflineplus">+            flex=&quot;1&quot; pack=&quot;center&quot; align=&quot;center&quot;&gt;</span>
<a href="#l8.145"></a><span id="l8.145" class="difflineplus">+        &lt;description id=&quot;blankResultsPaneMessage&quot;</span>
<a href="#l8.146"></a><span id="l8.146" class="difflineplus">+                     value=&quot;&amp;blankResultsPaneMessage.label;&quot;/&gt;</span>
<a href="#l8.147"></a><span id="l8.147" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l8.148"></a><span id="l8.148">       &lt;!-- results pane --&gt;</span>
<a href="#l8.149"></a><span id="l8.149">       &lt;tree id=&quot;abResultsTree&quot; flex=&quot;1&quot; enableColumnDrag=&quot;true&quot; class=&quot;plain&quot;</span>
<a href="#l8.150"></a><span id="l8.150">             context=&quot;abResultsTreeContext&quot;</span>
<a href="#l8.151"></a><span id="l8.151">             onclick=&quot;AbResultsPaneOnClick(event);&quot;</span>
<a href="#l8.152"></a><span id="l8.152">             onkeypress=&quot;AbResultsPaneKeyPress(event);&quot;</span>
<a href="#l8.153"></a><span id="l8.153">             onselect=&quot;this.view.selectionChanged(); document.commandDispatcher.updateCommands('addrbook-select');&quot;</span>
<a href="#l8.154"></a><span id="l8.154">             sortCol=&quot;GeneratedName&quot;</span>
<a href="#l8.155"></a><span id="l8.155">             minheight=&quot;100&quot; height=&quot;100&quot;</span>
<a href="#l8.156"></a><span id="l8.156" class="difflineat">@@ -684,17 +694,21 @@</span>
<a href="#l8.157"></a><span id="l8.157">           &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.158"></a><span id="l8.158">           &lt;treecol id=&quot;HomePhone&quot;</span>
<a href="#l8.159"></a><span id="l8.159">                    persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot;</span>
<a href="#l8.160"></a><span id="l8.160">                    label=&quot;&amp;HomePhone.label;&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l8.161"></a><span id="l8.161">           &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.162"></a><span id="l8.162">           &lt;treecol id=&quot;WorkPhone&quot;</span>
<a href="#l8.163"></a><span id="l8.163">                    persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot;</span>
<a href="#l8.164"></a><span id="l8.164">                    label=&quot;&amp;WorkPhone.label;&quot;/&gt;</span>
<a href="#l8.165"></a><span id="l8.165" class="difflineminus">-</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineplus">+          &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineplus">+          &lt;treecol id=&quot;addrbook&quot;</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineplus">+                   persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot;</span>
<a href="#l8.169"></a><span id="l8.169" class="difflineplus">+                   hidden=&quot;true&quot;</span>
<a href="#l8.170"></a><span id="l8.170" class="difflineplus">+                   label=&quot;&amp;Addrbook.label;&quot;/&gt;</span>
<a href="#l8.171"></a><span id="l8.171">           &lt;!-- LOCALIZATION NOTE: _PhoneticName may be enabled for Japanese builds. --&gt;</span>
<a href="#l8.172"></a><span id="l8.172">           &lt;!--</span>
<a href="#l8.173"></a><span id="l8.173">           &lt;treecol id=&quot;_PhoneticName&quot;</span>
<a href="#l8.174"></a><span id="l8.174">                    persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot;</span>
<a href="#l8.175"></a><span id="l8.175">                    label=&quot;&amp;_PhoneticName.label;&quot; hiddenbydefault=&quot;true&quot;/&gt;</span>
<a href="#l8.176"></a><span id="l8.176">           &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.177"></a><span id="l8.177">           --&gt;</span>
<a href="#l8.178"></a><span id="l8.178">         &lt;/treecols&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l9.4"></a><span id="l9.4"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.5"></a><span id="l9.5">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.6"></a><span id="l9.6">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8"> &lt;!ENTITY addressbookWindow.title                        &quot;Address Book&quot;&gt;</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineminus">-</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+&lt;!ENTITY blankResultsPaneMessage.label                  &quot;This address book shows contacts only after a search&quot;&gt;</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+&lt;!ENTITY localResultsOnlyMessage.label                  &quot;Contacts from remote address books are not shown until you search&quot;&gt;</span>
<a href="#l9.12"></a><span id="l9.12"> &lt;!-- File Menu --&gt;</span>
<a href="#l9.13"></a><span id="l9.13"> &lt;!ENTITY fileMenu.label                                 &quot;File&quot;&gt;</span>
<a href="#l9.14"></a><span id="l9.14"> &lt;!ENTITY fileMenu.accesskey                             &quot;f&quot;&gt;</span>
<a href="#l9.15"></a><span id="l9.15"> &lt;!ENTITY newMenu.label                                  &quot;New&quot;&gt;</span>
<a href="#l9.16"></a><span id="l9.16"> &lt;!ENTITY newMenu.accesskey                              &quot;N&quot;&gt;</span>
<a href="#l9.17"></a><span id="l9.17"> &lt;!ENTITY newContact.label                               &quot;Address Book Contact&quot;&gt;</span>
<a href="#l9.18"></a><span id="l9.18"> &lt;!ENTITY newContact.accesskey                           &quot;C&quot;&gt;</span>
<a href="#l9.19"></a><span id="l9.19"> &lt;!ENTITY newContact.key                                 &quot;N&quot;&gt;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineat">@@ -155,16 +156,18 @@ because displayed names don't have the c</span>
<a href="#l9.21"></a><span id="l9.21"> &lt;!-- Search Bar --&gt;</span>
<a href="#l9.22"></a><span id="l9.22"> &lt;!ENTITY SearchNameOrEmail.label                        &quot;Name or Email&quot;&gt;</span>
<a href="#l9.23"></a><span id="l9.23"> &lt;!ENTITY SearchNameOrEmail.accesskey                    &quot;N&quot;&gt;</span>
<a href="#l9.24"></a><span id="l9.24"> &lt;!ENTITY advancedButton.tooltip                         &quot;Advanced address search&quot;&gt;</span>
<a href="#l9.25"></a><span id="l9.25"> &lt;!ENTITY quickSearchCmd.key                             &quot;k&quot;&gt;</span>
<a href="#l9.26"></a><span id="l9.26"> &lt;!ENTITY searchItem.title &quot;Quick Search&quot;&gt;</span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28"> &lt;!-- Results Pane --&gt;</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+&lt;!ENTITY Addrbook.label                                 &quot;Address Book&quot;&gt;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+&lt;!ENTITY Addrbook.accesskey                             &quot;B&quot;&gt;</span>
<a href="#l9.31"></a><span id="l9.31"> &lt;!ENTITY GeneratedName.label                            &quot;Name&quot;&gt;</span>
<a href="#l9.32"></a><span id="l9.32"> &lt;!ENTITY GeneratedName.accesskey                        &quot;N&quot;&gt;</span>
<a href="#l9.33"></a><span id="l9.33"> &lt;!ENTITY PrimaryEmail.label                             &quot;Email&quot;&gt;</span>
<a href="#l9.34"></a><span id="l9.34"> &lt;!ENTITY PrimaryEmail.accesskey                         &quot;E&quot;&gt;</span>
<a href="#l9.35"></a><span id="l9.35"> &lt;!ENTITY ChatName.label                                 &quot;Chat Name&quot;&gt;</span>
<a href="#l9.36"></a><span id="l9.36"> &lt;!ENTITY ChatName.accesskey                             &quot;C&quot;&gt;</span>
<a href="#l9.37"></a><span id="l9.37"> &lt;!ENTITY Company.label                                  &quot;Organization&quot;&gt;</span>
<a href="#l9.38"></a><span id="l9.38"> &lt;!ENTITY Company.accesskey                              &quot;z&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/addressbook/abResultsPaneOverlay.dtd</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/addressbook/abResultsPaneOverlay.dtd</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,12 +1,14 @@</span>
<a href="#l10.4"></a><span id="l10.4"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.5"></a><span id="l10.5">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.6"></a><span id="l10.6">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+&lt;!ENTITY Addrbook.label                        &quot;Address Book&quot;&gt;</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+&lt;!ENTITY Addrbook.accesskey                    &quot;B&quot;&gt;</span>
<a href="#l10.10"></a><span id="l10.10"> &lt;!ENTITY GeneratedName.label                   &quot;Name&quot;&gt;</span>
<a href="#l10.11"></a><span id="l10.11"> &lt;!ENTITY GeneratedName.accesskey               &quot;N&quot;&gt;</span>
<a href="#l10.12"></a><span id="l10.12"> &lt;!ENTITY PrimaryEmail.label                    &quot;Email&quot;&gt;</span>
<a href="#l10.13"></a><span id="l10.13"> &lt;!ENTITY PrimaryEmail.accesskey                &quot;E&quot;&gt;</span>
<a href="#l10.14"></a><span id="l10.14"> &lt;!ENTITY Company.label                         &quot;Organization&quot;&gt;</span>
<a href="#l10.15"></a><span id="l10.15"> &lt;!ENTITY Company.accesskey                     &quot;z&quot;&gt;</span>
<a href="#l10.16"></a><span id="l10.16"> &lt;!ENTITY _PhoneticName.label                   &quot;Phonetic Name&quot;&gt;</span>
<a href="#l10.17"></a><span id="l10.17"> &lt;!ENTITY _PhoneticName.accesskey               &quot;o&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/addressbook/addressBook.properties</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -4,16 +4,18 @@</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5"> #</span>
<a href="#l11.6"></a><span id="l11.6"> # The following are used by the Mailing list dialog</span>
<a href="#l11.7"></a><span id="l11.7"> #</span>
<a href="#l11.8"></a><span id="l11.8"> emptyListName=You must enter a list name.</span>
<a href="#l11.9"></a><span id="l11.9"> lastFirstFormat=%S, %S</span>
<a href="#l11.10"></a><span id="l11.10"> firstLastFormat=%S %S  </span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+allAddressBooks=All Address Books</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+</span>
<a href="#l11.14"></a><span id="l11.14"> newContactTitle=New Contact</span>
<a href="#l11.15"></a><span id="l11.15"> # %S will be the contact's display name</span>
<a href="#l11.16"></a><span id="l11.16"> newContactTitleWithDisplayName=New Contact for %S</span>
<a href="#l11.17"></a><span id="l11.17"> editContactTitle=Edit Contact</span>
<a href="#l11.18"></a><span id="l11.18"> # %S will be the contact's display name</span>
<a href="#l11.19"></a><span id="l11.19"> editContactTitleWithDisplayName=Edit Contact for %S</span>
<a href="#l11.20"></a><span id="l11.20"> # don't translate vCard</span>
<a href="#l11.21"></a><span id="l11.21"> editVCardTitle=Edit vCard</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/test/mozmill/addrbook/test-address-book.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/test/mozmill/addrbook/test-address-book.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -57,52 +57,55 @@ function setupModule(module)</span>
<a href="#l12.4"></a><span id="l12.4">   addrBook2.addMailList(mListB);</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6">   mListC = create_mailing_list(&quot;ML C&quot;);</span>
<a href="#l12.7"></a><span id="l12.7">   addrBook3.addMailList(mListC);</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9">   mListD = create_mailing_list(&quot;ML D&quot;);</span>
<a href="#l12.10"></a><span id="l12.10">   addrBook3.addMailList(mListD);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  // There are 7 address books (Personal, AB 1, AB 2, AB 3, AB 4, LDAP Book</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  // There are 8 address book lists (All, Personal, AB 1, AB 2, AB 3, AB 4, LDAP Book</span>
<a href="#l12.14"></a><span id="l12.14">   // and Collected Address Book.  So let's ensure that those address books</span>
<a href="#l12.15"></a><span id="l12.15">   // exist in the tree view before executing our tests.</span>
<a href="#l12.16"></a><span id="l12.16">   abController.waitFor(</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-    function () (abController.window.gDirectoryTreeView.rowCount == 7),</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-    &quot;Timeout waiting for all 7 address books to show up in the tree view&quot;,</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+    function () (abController.window.gDirectoryTreeView.rowCount == 8),</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+    &quot;Timeout waiting for all 8 rows in address books list to show up in the tree view&quot;,</span>
<a href="#l12.21"></a><span id="l12.21">     1000, 10);</span>
<a href="#l12.22"></a><span id="l12.22"> }</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24"> /* Test that the address book manager automatically sorts</span>
<a href="#l12.25"></a><span id="l12.25">  * address books.</span>
<a href="#l12.26"></a><span id="l12.26">  *</span>
<a href="#l12.27"></a><span id="l12.27">  * Currently, we sort address books as follows:</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">- * 1. Personal Address Book</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">- * 2. Mork Address Books</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">- * 3. LDAP / Other Address Books</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">- * 4. Collected Address Book</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+ * 1. All Address Books</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+ * 2. Personal Address Book</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+ * 3. Mork Address Books</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+ * 4. LDAP / Other Address Books</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+ * 5. Collected Address Book</span>
<a href="#l12.37"></a><span id="l12.37">  *</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">- * With the Personal and Collapsed address books existing</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+ * With the All, Personal and Collapsed address books existing</span>
<a href="#l12.40"></a><span id="l12.40">  * automatically, our address books *should* be in this order:</span>
<a href="#l12.41"></a><span id="l12.41">  *</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+ * All Address Books</span>
<a href="#l12.43"></a><span id="l12.43">  * Personal Address Book</span>
<a href="#l12.44"></a><span id="l12.44">  * AB 1</span>
<a href="#l12.45"></a><span id="l12.45">  *    ML A</span>
<a href="#l12.46"></a><span id="l12.46">  * AB 2</span>
<a href="#l12.47"></a><span id="l12.47">  *    ML B</span>
<a href="#l12.48"></a><span id="l12.48">  * AB 3</span>
<a href="#l12.49"></a><span id="l12.49">  *    ML C</span>
<a href="#l12.50"></a><span id="l12.50">  *    ML D</span>
<a href="#l12.51"></a><span id="l12.51">  * AB 4</span>
<a href="#l12.52"></a><span id="l12.52">  * LDAP Book</span>
<a href="#l12.53"></a><span id="l12.53">  * Collected Address Book</span>
<a href="#l12.54"></a><span id="l12.54">  **/</span>
<a href="#l12.55"></a><span id="l12.55"> function test_order_of_address_books()</span>
<a href="#l12.56"></a><span id="l12.56"> {</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">-  const EXPECTED_AB_ORDER = [&quot;Personal Address Book&quot;, &quot;AB 1&quot;, &quot;AB 2&quot;,</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+  const EXPECTED_AB_ORDER = [&quot;All Address Books&quot;,</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+                             &quot;Personal Address Book&quot;, &quot;AB 1&quot;, &quot;AB 2&quot;,</span>
<a href="#l12.60"></a><span id="l12.60">                              &quot;AB 3&quot;, &quot;AB 4&quot;, &quot;LDAP Book&quot;,</span>
<a href="#l12.61"></a><span id="l12.61">                              &quot;Collected Addresses&quot;];</span>
<a href="#l12.62"></a><span id="l12.62"> </span>
<a href="#l12.63"></a><span id="l12.63">   for (let i = 0; i &lt; EXPECTED_AB_ORDER.length; i++)</span>
<a href="#l12.64"></a><span id="l12.64">   {</span>
<a href="#l12.65"></a><span id="l12.65">     let abName = get_name_of_address_book_element_at(i);</span>
<a href="#l12.66"></a><span id="l12.66">     assert_equals(abName, EXPECTED_AB_ORDER[i],</span>
<a href="#l12.67"></a><span id="l12.67">                   &quot;The address books are out of order.&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/themes/linux/jar.mn</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/themes/linux/jar.mn</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -276,9 +276,9 @@ classic.jar:</span>
<a href="#l13.4"></a><span id="l13.4">   skin/classic/messenger/sanitizeDialog.css                   (mail/sanitizeDialog.css)</span>
<a href="#l13.5"></a><span id="l13.5">   skin/classic/messenger/icons/box-logo.png                   (mail/icons/box-logo.png)</span>
<a href="#l13.6"></a><span id="l13.6">   skin/classic/messenger/sharedPlatform.css                   (mail/linuxShared.css)</span>
<a href="#l13.7"></a><span id="l13.7">   skin/classic/messenger/shared/mailWindow1.css               (../shared/mail/mailWindow1.css)</span>
<a href="#l13.8"></a><span id="l13.8">   skin/classic/messenger/shared/messenger.css                 (../shared/mail/messenger.css)</span>
<a href="#l13.9"></a><span id="l13.9">   skin/classic/messenger/shared/messageHeader.css             (../shared/mail/messageHeader.css)</span>
<a href="#l13.10"></a><span id="l13.10">   skin/classic/messenger/shared/tabmail.css                   (../shared/mail/tabmail.css)</span>
<a href="#l13.11"></a><span id="l13.11">   skin/classic/messenger/shared/accountProvisioner.css         (../shared/mail/accountProvisioner.css)</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  skin/classic/messenger/shared/addressbook.css               (../shared/mail/addressbook.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/themes/linux/mail/addrbook/addressbook.css</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/themes/linux/mail/addrbook/addressbook.css</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l14.4"></a><span id="l14.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.5"></a><span id="l14.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> /* ===== addressbook.css ================================================</span>
<a href="#l14.8"></a><span id="l14.8">   == Styles for the main Address Book window.</span>
<a href="#l14.9"></a><span id="l14.9">   ======================================================================= */</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> @import url(&quot;chrome://messenger/skin/&quot;);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+@import url(&quot;chrome://messenger/skin/shared/addressbook.css&quot;);</span>
<a href="#l14.13"></a><span id="l14.13"> </span>
<a href="#l14.14"></a><span id="l14.14"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l14.15"></a><span id="l14.15"> @namespace html url(&quot;http://www.w3.org/1999/xhtml&quot;);</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17"> #addressbookWindow:-moz-lwtheme {</span>
<a href="#l14.18"></a><span id="l14.18">   background-repeat: no-repeat;</span>
<a href="#l14.19"></a><span id="l14.19">   background-position: top right;</span>
<a href="#l14.20"></a><span id="l14.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/themes/osx/jar.mn</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/themes/osx/jar.mn</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -346,9 +346,10 @@ classic.jar:</span>
<a href="#l15.4"></a><span id="l15.4">   skin/classic/messenger/icons/hightail.png                      (mail/icons/hightail.png)</span>
<a href="#l15.5"></a><span id="l15.5">   skin/classic/messenger/sanitizeDialog.css                      (mail/sanitizeDialog.css)</span>
<a href="#l15.6"></a><span id="l15.6">   skin/classic/messenger/icons/box-logo.png                      (mail/icons/box-logo.png)</span>
<a href="#l15.7"></a><span id="l15.7">   skin/classic/messenger/sharedPlatform.css                      (mail/osxShared.css)</span>
<a href="#l15.8"></a><span id="l15.8">   skin/classic/messenger/shared/mailWindow1.css                  (../shared/mail/mailWindow1.css)</span>
<a href="#l15.9"></a><span id="l15.9">   skin/classic/messenger/shared/messenger.css                    (../shared/mail/messenger.css)</span>
<a href="#l15.10"></a><span id="l15.10">   skin/classic/messenger/shared/messageHeader.css                (../shared/mail/messageHeader.css)</span>
<a href="#l15.11"></a><span id="l15.11">   skin/classic/messenger/shared/tabmail.css                      (../shared/mail/tabmail.css)</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+  skin/classic/messenger/shared/addressbook.css                  (../shared/mail/addressbook.css)</span>
<a href="#l15.13"></a><span id="l15.13">   skin/classic/messenger/shared/accountProvisioner.css           (../shared/mail/accountProvisioner.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/themes/osx/mail/addrbook/addressbook.css</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/themes/osx/mail/addrbook/addressbook.css</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l16.4"></a><span id="l16.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l16.5"></a><span id="l16.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7"> /* ===== addressbook.css ================================================</span>
<a href="#l16.8"></a><span id="l16.8">   == Styles for the main Address Book window.</span>
<a href="#l16.9"></a><span id="l16.9">   ======================================================================= */</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11"> @import url(&quot;chrome://messenger/skin/&quot;);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+@import url(&quot;chrome://messenger/skin/shared/addressbook.css&quot;);</span>
<a href="#l16.13"></a><span id="l16.13"> </span>
<a href="#l16.14"></a><span id="l16.14"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l16.15"></a><span id="l16.15"> @namespace html url(&quot;http://www.w3.org/1999/xhtml&quot;);</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17"> #addressbookWindow:-moz-lwtheme {</span>
<a href="#l16.18"></a><span id="l16.18">   background-repeat: no-repeat;</span>
<a href="#l16.19"></a><span id="l16.19">   background-position: top right;</span>
<a href="#l16.20"></a><span id="l16.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/mail/themes/shared/mail/addressbook.css</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,14 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+ *  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+ *   * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+@namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+#blankResultsPaneMessage {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+  font-style: italic;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+}</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+#localResultsOnlyMessage {</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+  font-style: italic;</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+  text-align: center;</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/themes/windows/jar.mn</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/themes/windows/jar.mn</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -292,16 +292,17 @@ classic.jar:</span>
<a href="#l18.4"></a><span id="l18.4">   skin/classic/messenger/sanitizeDialog.css                   (mail/sanitizeDialog.css)</span>
<a href="#l18.5"></a><span id="l18.5">   skin/classic/messenger/icons/hightail.png                   (mail/icons/hightail.png)</span>
<a href="#l18.6"></a><span id="l18.6">   skin/classic/messenger/icons/box-logo.png                   (mail/icons/box-logo.png)</span>
<a href="#l18.7"></a><span id="l18.7">   skin/classic/messenger/sharedPlatform.css                   (mail/windowsShared.css)</span>
<a href="#l18.8"></a><span id="l18.8">   skin/classic/messenger/shared/mailWindow1.css               (../shared/mail/mailWindow1.css)</span>
<a href="#l18.9"></a><span id="l18.9">   skin/classic/messenger/shared/messenger.css                 (../shared/mail/messenger.css)</span>
<a href="#l18.10"></a><span id="l18.10">   skin/classic/messenger/shared/messageHeader.css             (../shared/mail/messageHeader.css)</span>
<a href="#l18.11"></a><span id="l18.11">   skin/classic/messenger/shared/tabmail.css                   (../shared/mail/tabmail.css)</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+  skin/classic/messenger/shared/addressbook.css               (../shared/mail/addressbook.css)</span>
<a href="#l18.13"></a><span id="l18.13">   skin/classic/messenger/shared/accountProvisioner.css        (../shared/mail/accountProvisioner.css)</span>
<a href="#l18.14"></a><span id="l18.14"> #ifdef XP_WIN</span>
<a href="#l18.15"></a><span id="l18.15"> % skin communicator classic/1.0 %skin/classic/aero/communicator/ os=WINNT osversion&gt;=6</span>
<a href="#l18.16"></a><span id="l18.16">   skin/classic/aero/communicator/communicator.css                       (mail/communicator.css)</span>
<a href="#l18.17"></a><span id="l18.17">   skin/classic/aero/communicator/smileys.css                            (mail/smileys.css)</span>
<a href="#l18.18"></a><span id="l18.18">   skin/classic/aero/communicator/icons/smileys/smiley-smile.png         (mail/icons/smiley-smile-aero.png)</span>
<a href="#l18.19"></a><span id="l18.19">   skin/classic/aero/communicator/icons/smileys/smiley-frown.png         (mail/icons/smiley-frown-aero.png)</span>
<a href="#l18.20"></a><span id="l18.20">   skin/classic/aero/communicator/icons/smileys/smiley-wink.png          (mail/icons/smiley-wink-aero.png)</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineat">@@ -578,10 +579,11 @@ classic.jar:</span>
<a href="#l18.22"></a><span id="l18.22">   skin/classic/aero/messenger/icons/hightail.png                   (mail/icons/hightail.png)</span>
<a href="#l18.23"></a><span id="l18.23">   skin/classic/aero/messenger/sanitizeDialog.css                   (mail/sanitizeDialog.css)</span>
<a href="#l18.24"></a><span id="l18.24">   skin/classic/aero/messenger/icons/box-logo.png                   (mail/icons/box-logo.png)</span>
<a href="#l18.25"></a><span id="l18.25">   skin/classic/aero/messenger/sharedPlatform.css                   (mail/windowsShared.css)</span>
<a href="#l18.26"></a><span id="l18.26">   skin/classic/aero/messenger/shared/mailWindow1.css               (../shared/mail/mailWindow1.css)</span>
<a href="#l18.27"></a><span id="l18.27">   skin/classic/aero/messenger/shared/messenger.css                 (../shared/mail/messenger.css)</span>
<a href="#l18.28"></a><span id="l18.28">   skin/classic/aero/messenger/shared/messageHeader.css             (../shared/mail/messageHeader.css)</span>
<a href="#l18.29"></a><span id="l18.29">   skin/classic/aero/messenger/shared/tabmail.css                   (../shared/mail/tabmail.css)</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+  skin/classic/aero/messenger/shared/addressbook.css               (../shared/mail/addressbook.css)</span>
<a href="#l18.31"></a><span id="l18.31">   skin/classic/aero/messenger/shared/accountProvisioner.css        (../shared/mail/accountProvisioner.css)</span>
<a href="#l18.32"></a><span id="l18.32"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/themes/windows/mail/addrbook/addressbook-aero.css</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/themes/windows/mail/addrbook/addressbook-aero.css</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l19.4"></a><span id="l19.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l19.5"></a><span id="l19.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> /* ===== addressbook.css ================================================</span>
<a href="#l19.8"></a><span id="l19.8">    == Styles for the main Address Book window.</span>
<a href="#l19.9"></a><span id="l19.9">    ====================================================================== */</span>
<a href="#l19.10"></a><span id="l19.10"> </span>
<a href="#l19.11"></a><span id="l19.11"> @import url(&quot;chrome://messenger/skin/&quot;);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+@import url(&quot;chrome://messenger/skin/shared/addressbook.css&quot;);</span>
<a href="#l19.13"></a><span id="l19.13"> </span>
<a href="#l19.14"></a><span id="l19.14"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l19.15"></a><span id="l19.15"> @namespace html url(&quot;http://www.w3.org/1999/xhtml&quot;);</span>
<a href="#l19.16"></a><span id="l19.16"> </span>
<a href="#l19.17"></a><span id="l19.17"> #addressbookWindow:-moz-lwtheme {</span>
<a href="#l19.18"></a><span id="l19.18">   background-repeat: no-repeat;</span>
<a href="#l19.19"></a><span id="l19.19">   background-position: top right;</span>
<a href="#l19.20"></a><span id="l19.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/themes/windows/mail/addrbook/addressbook.css</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/themes/windows/mail/addrbook/addressbook.css</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l20.4"></a><span id="l20.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l20.5"></a><span id="l20.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> /* ===== addressbook.css ================================================</span>
<a href="#l20.8"></a><span id="l20.8">   == Styles for the main Address Book window.</span>
<a href="#l20.9"></a><span id="l20.9">   ======================================================================= */</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11"> @import url(&quot;chrome://messenger/skin/&quot;);</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+@import url(&quot;chrome://messenger/skin/shared/addressbook.css&quot;);</span>
<a href="#l20.13"></a><span id="l20.13"> </span>
<a href="#l20.14"></a><span id="l20.14"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l20.15"></a><span id="l20.15"> @namespace html url(&quot;http://www.w3.org/1999/xhtml&quot;);</span>
<a href="#l20.16"></a><span id="l20.16"> </span>
<a href="#l20.17"></a><span id="l20.17"> #addressbookWindow:-moz-lwtheme {</span>
<a href="#l20.18"></a><span id="l20.18">   background-repeat: no-repeat;</span>
<a href="#l20.19"></a><span id="l20.19">   background-position: top right;</span>
<a href="#l20.20"></a><span id="l20.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/addrbook/content/abAddressBookNameDialog.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/addrbook/content/abAddressBookNameDialog.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -5,16 +5,17 @@</span>
<a href="#l21.4"></a><span id="l21.4"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l21.5"></a><span id="l21.5"> </span>
<a href="#l21.6"></a><span id="l21.6"> var gOkButton;</span>
<a href="#l21.7"></a><span id="l21.7"> var gNameInput;</span>
<a href="#l21.8"></a><span id="l21.8"> var gDirectory = null;</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10"> const kPersonalAddressbookURI = &quot;moz-abmdbdirectory://abook.mab&quot;;</span>
<a href="#l21.11"></a><span id="l21.11"> const kCollectedAddressbookURI = &quot;moz-abmdbdirectory://history.mab&quot;;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+const kAllDirectoryRoot = &quot;moz-abdirectory://&quot;;</span>
<a href="#l21.13"></a><span id="l21.13"> const kPABDirectory = 2; // defined in nsDirPrefs.h</span>
<a href="#l21.14"></a><span id="l21.14"> </span>
<a href="#l21.15"></a><span id="l21.15"> function abNameOnLoad()</span>
<a href="#l21.16"></a><span id="l21.16"> {</span>
<a href="#l21.17"></a><span id="l21.17">   // Get the document elements.</span>
<a href="#l21.18"></a><span id="l21.18">   gOkButton = document.documentElement.getButton('accept');</span>
<a href="#l21.19"></a><span id="l21.19">   gNameInput = document.getElementById('name');</span>
<a href="#l21.20"></a><span id="l21.20"> </span>
<a href="#l21.21"></a><span id="l21.21" class="difflineat">@@ -29,17 +30,18 @@ function abNameOnLoad()</span>
<a href="#l21.22"></a><span id="l21.22">   // rename).</span>
<a href="#l21.23"></a><span id="l21.23">   var bundle = document.getElementById(&quot;bundle_addressBook&quot;);</span>
<a href="#l21.24"></a><span id="l21.24"> </span>
<a href="#l21.25"></a><span id="l21.25">   document.title = bundle.getString(gDirectory ?</span>
<a href="#l21.26"></a><span id="l21.26">     'renameAddressBookTitle' : 'newAddressBookTitle');</span>
<a href="#l21.27"></a><span id="l21.27"> </span>
<a href="#l21.28"></a><span id="l21.28">   if (gDirectory &amp;&amp;</span>
<a href="#l21.29"></a><span id="l21.29">      (gDirectory.URI == kCollectedAddressbookURI ||</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-       gDirectory.URI == kPersonalAddressbookURI)) {</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+       gDirectory.URI == kPersonalAddressbookURI ||</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+       gDirectory.URI == kAllDirectoryRoot + &quot;?&quot;)) {</span>
<a href="#l21.33"></a><span id="l21.33">     // Address book name is not editable, therefore disable the field and</span>
<a href="#l21.34"></a><span id="l21.34">     // only have an ok button that doesn't do anything.</span>
<a href="#l21.35"></a><span id="l21.35">     gNameInput.readOnly = true;</span>
<a href="#l21.36"></a><span id="l21.36">     document.documentElement.buttons = &quot;accept&quot;;</span>
<a href="#l21.37"></a><span id="l21.37">     document.documentElement.removeAttribute(&quot;ondialogaccept&quot;);</span>
<a href="#l21.38"></a><span id="l21.38">   } else {</span>
<a href="#l21.39"></a><span id="l21.39">     gNameInput.focus();</span>
<a href="#l21.40"></a><span id="l21.40">     abNameDoOkEnabling();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/addrbook/content/abDragDrop.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/addrbook/content/abDragDrop.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -94,16 +94,20 @@ var abDirTreeObserver = {</span>
<a href="#l22.4"></a><span id="l22.4">   {</span>
<a href="#l22.5"></a><span id="l22.5">     if (orientation != Components.interfaces.nsITreeView.DROP_ON)</span>
<a href="#l22.6"></a><span id="l22.6">       return false;</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8">     var targetURI = gDirectoryTreeView.getDirectoryAtIndex(index).URI;</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10">     var srcURI = GetSelectedDirectory();</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+    // We cannot allow copy/move to &quot;All Address Books&quot;.</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+    if (targetURI == kAllDirectoryRoot + &quot;?&quot;)</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+      return false;</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+</span>
<a href="#l22.16"></a><span id="l22.16">     // The same place case</span>
<a href="#l22.17"></a><span id="l22.17">     if (targetURI == srcURI)</span>
<a href="#l22.18"></a><span id="l22.18">       return false;</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20">     // determine if we dragging from a mailing list on a directory x to the parent (directory x).</span>
<a href="#l22.21"></a><span id="l22.21">     // if so, don't allow the drop</span>
<a href="#l22.22"></a><span id="l22.22">     if (srcURI.startsWith(targetURI))</span>
<a href="#l22.23"></a><span id="l22.23">       return false;</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineat">@@ -264,35 +268,56 @@ var abDirTreeObserver = {</span>
<a href="#l22.25"></a><span id="l22.25">       for (let j = 0; j &lt; numrows; j++) {</span>
<a href="#l22.26"></a><span id="l22.26">         let card = gAbView.getCardFromRow(rows[j]);</span>
<a href="#l22.27"></a><span id="l22.27">         if (card.isMailList) {</span>
<a href="#l22.28"></a><span id="l22.28">           // This check ensures we haven't slipped through by mistake</span>
<a href="#l22.29"></a><span id="l22.29">           if (needToCopyCard &amp;&amp; actionIsMoving) {</span>
<a href="#l22.30"></a><span id="l22.30">             directory.addMailList(GetDirectoryFromURI(card.mailListURI));</span>
<a href="#l22.31"></a><span id="l22.31">           }</span>
<a href="#l22.32"></a><span id="l22.32">         } else {</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+          let srcDirectory = null;</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineplus">+          if (srcURI == (kAllDirectoryRoot + &quot;?&quot;) &amp;&amp; actionIsMoving) {</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineplus">+            let dirId = card.directoryId.substring(0, card.directoryId.indexOf(&quot;&amp;&quot;));</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineplus">+            srcDirectory = MailServices.ab.getDirectoryFromId(dirId);</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+          }</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+</span>
<a href="#l22.39"></a><span id="l22.39">           directory.dropCard(card, needToCopyCard);</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+          // This is true only if srcURI is &quot;All ABs&quot; and action is moving.</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineplus">+          if (srcDirectory) {</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineplus">+            let cardArray =</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineplus">+              Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineplus">+                        .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineplus">+            cardArray.appendElement(card, false);</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineplus">+            srcDirectory.deleteCards(cardArray);</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineplus">+          }</span>
<a href="#l22.49"></a><span id="l22.49">         }</span>
<a href="#l22.50"></a><span id="l22.50">       }</span>
<a href="#l22.51"></a><span id="l22.51"> </span>
<a href="#l22.52"></a><span id="l22.52">       var cardsTransferredText;</span>
<a href="#l22.53"></a><span id="l22.53"> </span>
<a href="#l22.54"></a><span id="l22.54">       // If we are moving, but not moving to a directory, then delete the</span>
<a href="#l22.55"></a><span id="l22.55">       // selected cards and display the appropriate text</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineminus">-      if (actionIsMoving) {</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineplus">+      if (actionIsMoving &amp;&amp; srcURI != (kAllDirectoryRoot + &quot;?&quot;)) {</span>
<a href="#l22.58"></a><span id="l22.58">         // If we have moved the cards, then delete them as well.</span>
<a href="#l22.59"></a><span id="l22.59">         gAbView.deleteSelectedCards();</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineplus">+      }</span>
<a href="#l22.61"></a><span id="l22.61"> </span>
<a href="#l22.62"></a><span id="l22.62" class="difflineplus">+      if (actionIsMoving) {</span>
<a href="#l22.63"></a><span id="l22.63">         cardsTransferredText = PluralForm.get(numrows,</span>
<a href="#l22.64"></a><span id="l22.64">           gAddressBookBundle.getFormattedString(&quot;contactsMoved&quot;, [numrows]));</span>
<a href="#l22.65"></a><span id="l22.65">       } else {</span>
<a href="#l22.66"></a><span id="l22.66">         cardsTransferredText = PluralForm.get(numrows,</span>
<a href="#l22.67"></a><span id="l22.67">           gAddressBookBundle.getFormattedString(&quot;contactsCopied&quot;, [numrows]));</span>
<a href="#l22.68"></a><span id="l22.68">       }</span>
<a href="#l22.69"></a><span id="l22.69"> </span>
<a href="#l22.70"></a><span id="l22.70" class="difflineplus">+      if (srcURI == kAllDirectoryRoot + &quot;?&quot;) {</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineplus">+        SetAbView(srcURI);</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineplus">+      }</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineplus">+</span>
<a href="#l22.74"></a><span id="l22.74">       document.getElementById(&quot;statusText&quot;).label = cardsTransferredText;</span>
<a href="#l22.75"></a><span id="l22.75">     }</span>
<a href="#l22.76"></a><span id="l22.76">   },</span>
<a href="#l22.77"></a><span id="l22.77"> </span>
<a href="#l22.78"></a><span id="l22.78">   onToggleOpenState: function()</span>
<a href="#l22.79"></a><span id="l22.79">   {</span>
<a href="#l22.80"></a><span id="l22.80">   },</span>
<a href="#l22.81"></a><span id="l22.81"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/addrbook/content/abResultsPane.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/addrbook/content/abResultsPane.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -75,16 +75,37 @@ function SetAbView(aURI)</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5">   var actualSortColumn = gAbView.setView(directory, GetAbViewListener(),</span>
<a href="#l23.6"></a><span id="l23.6"> 					 sortColumn, sortDirection);</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8">   gAbResultsTree.treeBoxObject.view =</span>
<a href="#l23.9"></a><span id="l23.9">     gAbView.QueryInterface(Components.interfaces.nsITreeView);</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11">   UpdateSortIndicators(actualSortColumn, sortDirection);</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  // If the selected address book is LDAP and the search box is empty,</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+  // inform the user of the empty results pane.</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+  if (aURI.indexOf(&quot;moz-abldapdirectory&quot;) != -1 &amp;&amp;</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+      aURI.indexOf(&quot;?&quot;) == -1) {</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineplus">+    let element = null;</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineplus">+    if (element = document.getElementById(&quot;abResultsTree&quot;))</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineplus">+      element.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineplus">+    if (element = document.getElementById(&quot;CardViewOuterBox&quot;))</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineplus">+      element.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineplus">+    if (element = document.getElementById(&quot;blankResultsPaneMessageBox&quot;))</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineplus">+      element.setAttribute(&quot;hidden&quot;, &quot;false&quot;);</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineplus">+  } else {</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineplus">+    let element = null;</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineplus">+    if (element = document.getElementById(&quot;abResultsTree&quot;))</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineplus">+      element.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineplus">+    if (element = document.getElementById(&quot;CardViewOuterBox&quot;))</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineplus">+      element.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineplus">+    if (element = document.getElementById(&quot;blankResultsPaneMessageBox&quot;))</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineplus">+      element.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+  }</span>
<a href="#l23.33"></a><span id="l23.33"> }</span>
<a href="#l23.34"></a><span id="l23.34"> </span>
<a href="#l23.35"></a><span id="l23.35"> function CloseAbView()</span>
<a href="#l23.36"></a><span id="l23.36"> {</span>
<a href="#l23.37"></a><span id="l23.37">   if (gAbView)</span>
<a href="#l23.38"></a><span id="l23.38">     gAbView.clearView();</span>
<a href="#l23.39"></a><span id="l23.39"> }</span>
<a href="#l23.40"></a><span id="l23.40"> </span>
<a href="#l23.41"></a><span id="l23.41" class="difflineat">@@ -342,17 +363,16 @@ var ResultsPaneController =</span>
<a href="#l23.42"></a><span id="l23.42">   supportsCommand: function(command)</span>
<a href="#l23.43"></a><span id="l23.43">   {</span>
<a href="#l23.44"></a><span id="l23.44">     switch (command) {</span>
<a href="#l23.45"></a><span id="l23.45">       case &quot;cmd_selectAll&quot;:</span>
<a href="#l23.46"></a><span id="l23.46">       case &quot;cmd_delete&quot;:</span>
<a href="#l23.47"></a><span id="l23.47">       case &quot;button_delete&quot;:</span>
<a href="#l23.48"></a><span id="l23.48">       case &quot;cmd_properties&quot;:</span>
<a href="#l23.49"></a><span id="l23.49">       case &quot;cmd_newlist&quot;:</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineminus">-        return true;</span>
<a href="#l23.51"></a><span id="l23.51">       default:</span>
<a href="#l23.52"></a><span id="l23.52">         return false;</span>
<a href="#l23.53"></a><span id="l23.53">     }</span>
<a href="#l23.54"></a><span id="l23.54">   },</span>
<a href="#l23.55"></a><span id="l23.55"> </span>
<a href="#l23.56"></a><span id="l23.56">   isCommandEnabled: function(command)</span>
<a href="#l23.57"></a><span id="l23.57">   {</span>
<a href="#l23.58"></a><span id="l23.58">     switch (command) {</span>
<a href="#l23.59"></a><span id="l23.59" class="difflineat">@@ -393,17 +413,17 @@ var ResultsPaneController =</span>
<a href="#l23.60"></a><span id="l23.60">         }</span>
<a href="#l23.61"></a><span id="l23.61">         return (enabled &amp;&amp; (numSelected &gt; 0));</span>
<a href="#l23.62"></a><span id="l23.62">       case &quot;cmd_properties&quot;:</span>
<a href="#l23.63"></a><span id="l23.63">         // While &quot;Edit Contact&quot; dialogue is still modal (bug 115904, bug 135126),</span>
<a href="#l23.64"></a><span id="l23.64">         // only enable &quot;Properties&quot; button for single selection; then fix bug 119999.</span>
<a href="#l23.65"></a><span id="l23.65">         return (GetNumSelectedCards() == 1);</span>
<a href="#l23.66"></a><span id="l23.66">       case &quot;cmd_newlist&quot;:</span>
<a href="#l23.67"></a><span id="l23.67">         var selectedDir = GetSelectedDirectory();</span>
<a href="#l23.68"></a><span id="l23.68" class="difflineminus">-        if (selectedDir) {</span>
<a href="#l23.69"></a><span id="l23.69" class="difflineplus">+        if (selectedDir &amp;&amp; (selectedDir != kAllDirectoryRoot + &quot;?&quot;)) {</span>
<a href="#l23.70"></a><span id="l23.70">           var abDir = GetDirectoryFromURI(selectedDir);</span>
<a href="#l23.71"></a><span id="l23.71">           if (abDir) {</span>
<a href="#l23.72"></a><span id="l23.72">             return abDir.supportsMailingLists;</span>
<a href="#l23.73"></a><span id="l23.73">           }</span>
<a href="#l23.74"></a><span id="l23.74">         }</span>
<a href="#l23.75"></a><span id="l23.75">         return false;</span>
<a href="#l23.76"></a><span id="l23.76">       default:</span>
<a href="#l23.77"></a><span id="l23.77">         return false;</span>
<a href="#l23.78"></a><span id="l23.78" class="difflineat">@@ -435,11 +455,11 @@ var ResultsPaneController =</span>
<a href="#l23.79"></a><span id="l23.79">     // on blur events set the menu item texts back to the normal values</span>
<a href="#l23.80"></a><span id="l23.80">     if (event == &quot;blur&quot;)</span>
<a href="#l23.81"></a><span id="l23.81">       goSetMenuValue(&quot;cmd_delete&quot;, &quot;valueDefault&quot;);</span>
<a href="#l23.82"></a><span id="l23.82">   }</span>
<a href="#l23.83"></a><span id="l23.83"> };</span>
<a href="#l23.84"></a><span id="l23.84"> </span>
<a href="#l23.85"></a><span id="l23.85"> function SelectFirstCard()</span>
<a href="#l23.86"></a><span id="l23.86"> {</span>
<a href="#l23.87"></a><span id="l23.87" class="difflineminus">-  if (gAbView &amp;&amp; gAbView.selection)</span>
<a href="#l23.88"></a><span id="l23.88" class="difflineplus">+  if (gAbView &amp;&amp; gAbView.selection &amp;&amp; (gAbView.selection.count &gt; 0))</span>
<a href="#l23.89"></a><span id="l23.89">     gAbView.selection.select(0);</span>
<a href="#l23.90"></a><span id="l23.90"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/addrbook/public/nsIAbManager.idl</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/addrbook/public/nsIAbManager.idl</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -16,17 +16,17 @@ interface nsIAbBooleanExpression;</span>
<a href="#l24.4"></a><span id="l24.4"> </span>
<a href="#l24.5"></a><span id="l24.5"> /**</span>
<a href="#l24.6"></a><span id="l24.6">  * nsIAbManager is an interface to the main address book mananger</span>
<a href="#l24.7"></a><span id="l24.7">  * via the contract id &quot;@mozilla.org/abmanager;1&quot;</span>
<a href="#l24.8"></a><span id="l24.8">  *</span>
<a href="#l24.9"></a><span id="l24.9">  * It contains the main functions to create and delete address books as well</span>
<a href="#l24.10"></a><span id="l24.10">  * as some helper functions.</span>
<a href="#l24.11"></a><span id="l24.11">  */</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-[scriptable, uuid(c3b33078-0b9c-4b56-83ed-3c5e84de82c8)]</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+[scriptable, uuid(4271daa0-de0b-48ed-9c2b-934dc895383d)]</span>
<a href="#l24.14"></a><span id="l24.14"> interface nsIAbManager : nsISupports </span>
<a href="#l24.15"></a><span id="l24.15"> {</span>
<a href="#l24.16"></a><span id="l24.16">   /**</span>
<a href="#l24.17"></a><span id="l24.17">    * Returns an enumerator containing all the top-level directories</span>
<a href="#l24.18"></a><span id="l24.18">    * (non-recursive)</span>
<a href="#l24.19"></a><span id="l24.19">    */</span>
<a href="#l24.20"></a><span id="l24.20">   readonly attribute nsISimpleEnumerator directories;</span>
<a href="#l24.21"></a><span id="l24.21"> </span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -34,16 +34,24 @@ interface nsIAbManager : nsISupports</span>
<a href="#l24.23"></a><span id="l24.23">    * Returns the directory that represents the supplied URI.</span>
<a href="#l24.24"></a><span id="l24.24">    *</span>
<a href="#l24.25"></a><span id="l24.25">    * @param  aURI       The URI of the address book to find.</span>
<a href="#l24.26"></a><span id="l24.26">    * @return            The found address book.</span>
<a href="#l24.27"></a><span id="l24.27">    */</span>
<a href="#l24.28"></a><span id="l24.28">   nsIAbDirectory getDirectory(in ACString aURI);</span>
<a href="#l24.29"></a><span id="l24.29"> </span>
<a href="#l24.30"></a><span id="l24.30">   /**</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+   * Returns the directory that has the supplied dirPrefId.</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+   *</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineplus">+   * @param aDirPrefId  The dirPrefId of the directory.</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+   * @return            The found AB directory.</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+   */</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineplus">+  nsIAbDirectory getDirectoryFromId(in ACString aDirPrefId);</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineplus">+</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+  /**</span>
<a href="#l24.39"></a><span id="l24.39">    * Creates a new address book.</span>
<a href="#l24.40"></a><span id="l24.40">    *</span>
<a href="#l24.41"></a><span id="l24.41">    * @param  aDirName   The description of the address book.</span>
<a href="#l24.42"></a><span id="l24.42">    * @param  aURI       The URI for the address book. This is specific to each</span>
<a href="#l24.43"></a><span id="l24.43">    *                    type of address book.</span>
<a href="#l24.44"></a><span id="l24.44">    * @param  aType      The type of the address book (see nsDirPrefs.h)</span>
<a href="#l24.45"></a><span id="l24.45">    * @param  aPrefName  Overrides the default of ldap_2.servers.&lt;aDirName&gt;</span>
<a href="#l24.46"></a><span id="l24.46">    *                    (note that the caller must ensure its uniqueness).</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -217,16 +217,48 @@ nsAbManager::GetRootDirectory(nsIAbDirec</span>
<a href="#l25.4"></a><span id="l25.4">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.5"></a><span id="l25.5">     mCacheTopLevelAb = rootAddressBook;</span>
<a href="#l25.6"></a><span id="l25.6">   }</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8">   NS_IF_ADDREF(*aResult = mCacheTopLevelAb);</span>
<a href="#l25.9"></a><span id="l25.9">   return NS_OK;</span>
<a href="#l25.10"></a><span id="l25.10"> }</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+NS_IMETHODIMP nsAbManager::GetDirectoryFromId(const nsACString &amp;aDirPrefId,</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+                                              nsIAbDirectory **aResult)</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+{</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+  nsCOMPtr&lt;nsISimpleEnumerator&gt; enumerator;</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineplus">+  nsresult rv = GetDirectories(getter_AddRefs(enumerator));</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineplus">+  nsCOMPtr&lt;nsISupports&gt; support;</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineplus">+  nsCOMPtr&lt;nsIAbDirectory&gt; directory;</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineplus">+</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineplus">+  bool hasMore = false;</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineplus">+  while (NS_SUCCEEDED(enumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineplus">+    rv = enumerator-&gt;GetNext(getter_AddRefs(support));</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineplus">+    directory = do_QueryInterface(support, &amp;rv);</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineplus">+    if (NS_FAILED(rv)) {</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineplus">+      NS_WARNING(&quot;Unable to select Address book nsAbManager::GetDirectoryFromId()&quot;);</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineplus">+      continue;</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineplus">+    }</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+    nsCString dirPrefId;</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+    directory-&gt;GetDirPrefId(dirPrefId);</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+    if (dirPrefId.Equals(aDirPrefId)) {</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+      *aResult = directory;</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineplus">+      return NS_OK;</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineplus">+    }</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineplus">+  }</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineplus">+</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineplus">+  return NS_OK;</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineplus">+}</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineplus">+</span>
<a href="#l25.44"></a><span id="l25.44"> NS_IMETHODIMP nsAbManager::GetDirectory(const nsACString &amp;aURI,</span>
<a href="#l25.45"></a><span id="l25.45">                                         nsIAbDirectory **aResult)</span>
<a href="#l25.46"></a><span id="l25.46"> {</span>
<a href="#l25.47"></a><span id="l25.47">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l25.48"></a><span id="l25.48"> </span>
<a href="#l25.49"></a><span id="l25.49">   nsresult rv;</span>
<a href="#l25.50"></a><span id="l25.50">   nsCOMPtr&lt;nsIAbDirectory&gt; directory;</span>
<a href="#l25.51"></a><span id="l25.51"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbView.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbView.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -40,16 +40,17 @@ using namespace mozilla;</span>
<a href="#l26.4"></a><span id="l26.4"> #define PREF_MAIL_ADDR_BOOK_DISPLAYNAME_LASTNAMEFIRST &quot;mail.addr_book.displayName.lastnamefirst&quot;</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6"> // Also, our default primary sort</span>
<a href="#l26.7"></a><span id="l26.7"> #define GENERATED_NAME_COLUMN_ID &quot;GeneratedName&quot; </span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9"> NS_IMPL_ISUPPORTS(nsAbView, nsIAbView, nsITreeView, nsIAbListener, nsIObserver)</span>
<a href="#l26.10"></a><span id="l26.10"> </span>
<a href="#l26.11"></a><span id="l26.11"> nsAbView::nsAbView() : mInitialized(false),</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+                       mIsAllDirectoryRootView(false),</span>
<a href="#l26.13"></a><span id="l26.13">                        mSuppressSelectionChange(false),</span>
<a href="#l26.14"></a><span id="l26.14">                        mSuppressCountChange(false),</span>
<a href="#l26.15"></a><span id="l26.15">                        mGeneratedNameFormat(0)</span>
<a href="#l26.16"></a><span id="l26.16"> {</span>
<a href="#l26.17"></a><span id="l26.17"> }</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19"> nsAbView::~nsAbView()</span>
<a href="#l26.20"></a><span id="l26.20"> {</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineat">@@ -184,20 +185,67 @@ NS_IMETHODIMP nsAbView::SetView(nsIAbDir</span>
<a href="#l26.22"></a><span id="l26.22">     rv = RemoveCardAt(i);</span>
<a href="#l26.23"></a><span id="l26.23">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;remove card failed\n&quot;);</span>
<a href="#l26.24"></a><span id="l26.24">   }</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26">   // We replace all cards so any sorting is no longer valid.</span>
<a href="#l26.27"></a><span id="l26.27">   mSortColumn.AssignLiteral(&quot;&quot;);</span>
<a href="#l26.28"></a><span id="l26.28">   mSortDirection.AssignLiteral(&quot;&quot;);</span>
<a href="#l26.29"></a><span id="l26.29"> </span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-  mDirectory = aAddressBook;</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineplus">+  nsCString uri;</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+  aAddressBook-&gt;GetURI(uri);</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+  int32_t searchBegin = uri.FindChar('?');</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+  nsCString searchQuery(Substring(uri, searchBegin));</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineplus">+  // This is a special case, a workaround basically, to just have all ABs.</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+  if (searchQuery.EqualsLiteral(&quot;?&quot;)) {</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineplus">+    searchQuery.AssignLiteral(&quot;&quot;);</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineplus">+  }</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineplus">+</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineplus">+  if (Substring(uri, 0, searchBegin).EqualsLiteral(kAllDirectoryRoot)) {</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineplus">+    mIsAllDirectoryRootView = true;</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineplus">+    // We have special request case to search all addressbooks, so we need</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+    // to iterate over all addressbooks.</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineplus">+    // Since the request is for all addressbooks, the URI must have been</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineplus">+    // passed with an extra '?'. We still check it for sanity and trim it here.</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineplus">+    if (searchQuery.Find(&quot;??&quot;) != kNotFound)</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineplus">+      searchQuery = Substring(searchQuery, 1);</span>
<a href="#l26.48"></a><span id="l26.48" class="difflineplus">+</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineplus">+    nsCOMPtr&lt;nsIAbManager&gt; abManager(do_GetService(NS_ABMANAGER_CONTRACTID,</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineplus">+                                                   &amp;rv));</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.52"></a><span id="l26.52" class="difflineplus">+    nsCOMPtr&lt;nsISimpleEnumerator&gt; enumerator;</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineplus">+    rv = abManager-&gt;GetDirectories(getter_AddRefs(enumerator));</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.55"></a><span id="l26.55"> </span>
<a href="#l26.56"></a><span id="l26.56" class="difflineminus">-  rv = EnumerateCards();</span>
<a href="#l26.57"></a><span id="l26.57" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.58"></a><span id="l26.58" class="difflineplus">+    bool hasMore = false;</span>
<a href="#l26.59"></a><span id="l26.59" class="difflineplus">+    nsCOMPtr&lt;nsISupports&gt; support;</span>
<a href="#l26.60"></a><span id="l26.60" class="difflineplus">+    nsCOMPtr&lt;nsIAbDirectory&gt; directory;</span>
<a href="#l26.61"></a><span id="l26.61" class="difflineplus">+    while (NS_SUCCEEDED(enumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineplus">+      rv = enumerator-&gt;GetNext(getter_AddRefs(support));</span>
<a href="#l26.63"></a><span id="l26.63" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.64"></a><span id="l26.64" class="difflineplus">+      directory = do_QueryInterface(support, &amp;rv);</span>
<a href="#l26.65"></a><span id="l26.65" class="difflineplus">+</span>
<a href="#l26.66"></a><span id="l26.66" class="difflineplus">+      // If, for some reason, we are unable to get a directory, we continue.</span>
<a href="#l26.67"></a><span id="l26.67" class="difflineplus">+      if (NS_FAILED(rv))</span>
<a href="#l26.68"></a><span id="l26.68" class="difflineplus">+        continue;</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineplus">+</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+      // Get appropriate directory with search query.</span>
<a href="#l26.71"></a><span id="l26.71" class="difflineplus">+      nsCString uri;</span>
<a href="#l26.72"></a><span id="l26.72" class="difflineplus">+      directory-&gt;GetURI(uri);</span>
<a href="#l26.73"></a><span id="l26.73" class="difflineplus">+      rv = abManager-&gt;GetDirectory(uri + searchQuery, getter_AddRefs(directory));</span>
<a href="#l26.74"></a><span id="l26.74" class="difflineplus">+      mDirectory = directory;</span>
<a href="#l26.75"></a><span id="l26.75" class="difflineplus">+      rv = EnumerateCards();</span>
<a href="#l26.76"></a><span id="l26.76" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.77"></a><span id="l26.77" class="difflineplus">+    }</span>
<a href="#l26.78"></a><span id="l26.78" class="difflineplus">+  } else {</span>
<a href="#l26.79"></a><span id="l26.79" class="difflineplus">+    mIsAllDirectoryRootView = false;</span>
<a href="#l26.80"></a><span id="l26.80" class="difflineplus">+    mDirectory = aAddressBook;</span>
<a href="#l26.81"></a><span id="l26.81" class="difflineplus">+    rv = EnumerateCards();</span>
<a href="#l26.82"></a><span id="l26.82" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.83"></a><span id="l26.83" class="difflineplus">+  }</span>
<a href="#l26.84"></a><span id="l26.84"> </span>
<a href="#l26.85"></a><span id="l26.85">   NS_NAMED_LITERAL_STRING(generatedNameColumnId, GENERATED_NAME_COLUMN_ID);</span>
<a href="#l26.86"></a><span id="l26.86"> </span>
<a href="#l26.87"></a><span id="l26.87">   // See if the persisted sortColumn is valid.</span>
<a href="#l26.88"></a><span id="l26.88">   // It may not be, if you migrated from older versions, or switched between</span>
<a href="#l26.89"></a><span id="l26.89">   // a mozilla build and a commercial build, which have different columns.</span>
<a href="#l26.90"></a><span id="l26.90">   nsAutoString actualSortColumn;</span>
<a href="#l26.91"></a><span id="l26.91">   if (!generatedNameColumnId.Equals(aSortColumn) &amp;&amp; mCards.Count()) {</span>
<a href="#l26.92"></a><span id="l26.92" class="difflineat">@@ -404,16 +452,25 @@ NS_IMETHODIMP nsAbView::GetProgressMode(</span>
<a href="#l26.93"></a><span id="l26.93"> NS_IMETHODIMP nsAbView::GetCellValue(int32_t row, nsITreeColumn* col, nsAString&amp; _retval)</span>
<a href="#l26.94"></a><span id="l26.94"> {</span>
<a href="#l26.95"></a><span id="l26.95">   return NS_OK;</span>
<a href="#l26.96"></a><span id="l26.96"> }</span>
<a href="#l26.97"></a><span id="l26.97"> </span>
<a href="#l26.98"></a><span id="l26.98"> nsresult nsAbView::GetCardValue(nsIAbCard *card, const char16_t *colID,</span>
<a href="#l26.99"></a><span id="l26.99">                                 nsAString &amp;_retval)</span>
<a href="#l26.100"></a><span id="l26.100"> {</span>
<a href="#l26.101"></a><span id="l26.101" class="difflineplus">+  if (nsString(colID).EqualsLiteral(&quot;addrbook&quot;)) {</span>
<a href="#l26.102"></a><span id="l26.102" class="difflineplus">+    nsCString dirID;</span>
<a href="#l26.103"></a><span id="l26.103" class="difflineplus">+    nsresult rv = card-&gt;GetDirectoryId(dirID);</span>
<a href="#l26.104"></a><span id="l26.104" class="difflineplus">+    if (NS_SUCCEEDED(rv))</span>
<a href="#l26.105"></a><span id="l26.105" class="difflineplus">+      CopyUTF8toUTF16(Substring(dirID, dirID.FindChar('&amp;') + 1), _retval);</span>
<a href="#l26.106"></a><span id="l26.106" class="difflineplus">+</span>
<a href="#l26.107"></a><span id="l26.107" class="difflineplus">+    return rv;</span>
<a href="#l26.108"></a><span id="l26.108" class="difflineplus">+  }</span>
<a href="#l26.109"></a><span id="l26.109" class="difflineplus">+</span>
<a href="#l26.110"></a><span id="l26.110">   // &quot;G&quot; == &quot;GeneratedName&quot;, &quot;_P&quot; == &quot;_PhoneticName&quot;</span>
<a href="#l26.111"></a><span id="l26.111">   // else, standard column (like PrimaryEmail and _AimScreenName)</span>
<a href="#l26.112"></a><span id="l26.112">   if (colID[0] == char16_t('G'))</span>
<a href="#l26.113"></a><span id="l26.113">     return card-&gt;GenerateName(mGeneratedNameFormat, mABBundle, _retval);</span>
<a href="#l26.114"></a><span id="l26.114"> </span>
<a href="#l26.115"></a><span id="l26.115">   if (colID[0] == char16_t('_') &amp;&amp; colID[1] == char16_t('P'))</span>
<a href="#l26.116"></a><span id="l26.116">     // Use LN/FN order for the phonetic name</span>
<a href="#l26.117"></a><span id="l26.117">     return card-&gt;GeneratePhoneticName(true, _retval);</span>
<a href="#l26.118"></a><span id="l26.118" class="difflineat">@@ -757,23 +814,38 @@ nsresult nsAbView::GenerateCollationKeys</span>
<a href="#l26.119"></a><span id="l26.119">   </span>
<a href="#l26.120"></a><span id="l26.120">   PR_FREEIF(abcard-&gt;secondaryCollationKey);</span>
<a href="#l26.121"></a><span id="l26.121">   rv = mCollationKeyGenerator-&gt;AllocateRawSortKey(nsICollation::kCollationCaseInSensitive,</span>
<a href="#l26.122"></a><span id="l26.122">     value, &amp;(abcard-&gt;secondaryCollationKey), &amp;(abcard-&gt;secondaryCollationKeyLen));</span>
<a href="#l26.123"></a><span id="l26.123">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l26.124"></a><span id="l26.124">   return rv;</span>
<a href="#l26.125"></a><span id="l26.125"> }</span>
<a href="#l26.126"></a><span id="l26.126"> </span>
<a href="#l26.127"></a><span id="l26.127" class="difflineplus">+// A helper method currently returns true if the directory is an LDAP.</span>
<a href="#l26.128"></a><span id="l26.128" class="difflineplus">+// We can tweak this to return true for all Remote Address Books where the</span>
<a href="#l26.129"></a><span id="l26.129" class="difflineplus">+// search is asynchronous.</span>
<a href="#l26.130"></a><span id="l26.130" class="difflineplus">+bool isDirectoryRemote(nsCOMPtr&lt;nsIAbDirectory&gt; aDir)</span>
<a href="#l26.131"></a><span id="l26.131" class="difflineplus">+{</span>
<a href="#l26.132"></a><span id="l26.132" class="difflineplus">+  nsCString uri;</span>
<a href="#l26.133"></a><span id="l26.133" class="difflineplus">+  aDir-&gt;GetURI(uri);</span>
<a href="#l26.134"></a><span id="l26.134" class="difflineplus">+  return (uri.Find(&quot;moz-abldapdirectory&quot;) != kNotFound);</span>
<a href="#l26.135"></a><span id="l26.135" class="difflineplus">+}</span>
<a href="#l26.136"></a><span id="l26.136" class="difflineplus">+</span>
<a href="#l26.137"></a><span id="l26.137"> NS_IMETHODIMP nsAbView::OnItemAdded(nsISupports *parentDir, nsISupports *item)</span>
<a href="#l26.138"></a><span id="l26.138"> {</span>
<a href="#l26.139"></a><span id="l26.139">   nsresult rv;</span>
<a href="#l26.140"></a><span id="l26.140" class="difflineminus">-  nsCOMPtr &lt;nsIAbDirectory&gt; directory = do_QueryInterface(parentDir,&amp;rv);</span>
<a href="#l26.141"></a><span id="l26.141" class="difflineplus">+  nsCOMPtr &lt;nsIAbDirectory&gt; directory = do_QueryInterface(parentDir, &amp;rv);</span>
<a href="#l26.142"></a><span id="l26.142">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l26.143"></a><span id="l26.143"> </span>
<a href="#l26.144"></a><span id="l26.144" class="difflineminus">-  if (directory.get() == mDirectory.get()) {</span>
<a href="#l26.145"></a><span id="l26.145" class="difflineplus">+  bool isRemote = isDirectoryRemote(directory);</span>
<a href="#l26.146"></a><span id="l26.146" class="difflineplus">+  // If the search is performed on All Address books, its possible that the LDAP</span>
<a href="#l26.147"></a><span id="l26.147" class="difflineplus">+  // results start coming when mDirectory has changed (LDAP search works in an</span>
<a href="#l26.148"></a><span id="l26.148" class="difflineplus">+  // asynchronous manner).</span>
<a href="#l26.149"></a><span id="l26.149" class="difflineplus">+  if ((mIsAllDirectoryRootView &amp;&amp; isRemote) ||</span>
<a href="#l26.150"></a><span id="l26.150" class="difflineplus">+      directory.get() == mDirectory.get()) {</span>
<a href="#l26.151"></a><span id="l26.151">     nsCOMPtr &lt;nsIAbCard&gt; addedCard = do_QueryInterface(item);</span>
<a href="#l26.152"></a><span id="l26.152">     if (addedCard) {</span>
<a href="#l26.153"></a><span id="l26.153">       // Malloc these from an arena</span>
<a href="#l26.154"></a><span id="l26.154">       AbCard *abcard = (AbCard *) PR_Calloc(1, sizeof(struct AbCard));</span>
<a href="#l26.155"></a><span id="l26.155">       if (!abcard) </span>
<a href="#l26.156"></a><span id="l26.156">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l26.157"></a><span id="l26.157"> </span>
<a href="#l26.158"></a><span id="l26.158">       abcard-&gt;card = addedCard;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbView.h</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbView.h</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -69,14 +69,15 @@ private:</span>
<a href="#l27.4"></a><span id="l27.4">   nsVoidArray mCards;</span>
<a href="#l27.5"></a><span id="l27.5">   nsString mSortColumn;</span>
<a href="#l27.6"></a><span id="l27.6">   nsString mSortDirection;</span>
<a href="#l27.7"></a><span id="l27.7">   nsCOMPtr&lt;nsICollation&gt; mCollationKeyGenerator;</span>
<a href="#l27.8"></a><span id="l27.8">   nsCOMPtr&lt;nsIAbViewListener&gt; mAbViewListener;</span>
<a href="#l27.9"></a><span id="l27.9">   nsCOMPtr&lt;nsIStringBundle&gt; mABBundle;</span>
<a href="#l27.10"></a><span id="l27.10"> </span>
<a href="#l27.11"></a><span id="l27.11">   bool mInitialized;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+  bool mIsAllDirectoryRootView;</span>
<a href="#l27.13"></a><span id="l27.13">   bool mSuppressSelectionChange;</span>
<a href="#l27.14"></a><span id="l27.14">   bool mSuppressCountChange;</span>
<a href="#l27.15"></a><span id="l27.15">   int32_t mGeneratedNameFormat;</span>
<a href="#l27.16"></a><span id="l27.16"> };</span>
<a href="#l27.17"></a><span id="l27.17"> </span>
<a href="#l27.18"></a><span id="l27.18"> #endif /* _nsAbView_H_ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/mailnews.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/mailnews.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -365,17 +365,16 @@ pref(&quot;mail.identity.default.headers&quot;, &quot;&quot;</span>
<a href="#l28.4"></a><span id="l28.4"> </span>
<a href="#l28.5"></a><span id="l28.5"> // by default, only collect addresses the user sends to (outgoing)</span>
<a href="#l28.6"></a><span id="l28.6"> // incoming is all spam anyways</span>
<a href="#l28.7"></a><span id="l28.7"> #ifdef MOZ_SUITE</span>
<a href="#l28.8"></a><span id="l28.8"> pref(&quot;mail.collect_email_address_incoming&quot;, false);</span>
<a href="#l28.9"></a><span id="l28.9"> pref(&quot;mail.collect_email_address_newsgroup&quot;, false);</span>
<a href="#l28.10"></a><span id="l28.10"> #endif</span>
<a href="#l28.11"></a><span id="l28.11"> pref(&quot;mail.collect_email_address_outgoing&quot;, true);</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-</span>
<a href="#l28.13"></a><span id="l28.13"> // by default, use the Collected Addressbook for collection</span>
<a href="#l28.14"></a><span id="l28.14"> pref(&quot;mail.collect_addressbook&quot;, &quot;moz-abmdbdirectory://history.mab&quot;);</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16"> pref(&quot;mail.default_sendlater_uri&quot;, &quot;mailbox://nobody@Local%20Folders/Unsent%20Messages&quot;);</span>
<a href="#l28.17"></a><span id="l28.17"> </span>
<a href="#l28.18"></a><span id="l28.18"> pref(&quot;mail.smtpservers&quot;, &quot;&quot;);</span>
<a href="#l28.19"></a><span id="l28.19"> pref(&quot;mail.accountmanager.accounts&quot;, &quot;&quot;);</span>
<a href="#l28.20"></a><span id="l28.20"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

